(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const Vt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cdefs%3e%3clinearGradient%20id='farm-base'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23f6e7a0'%20/%3e%3cstop%20offset='1'%20stop-color='%23cf9b32'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='farm-ridges'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23ffecc4'%20stop-opacity='0.9'%20/%3e%3cstop%20offset='1'%20stop-color='%23b37319'%20stop-opacity='0.3'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='farm-barn'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23ff6b6b'%20/%3e%3cstop%20offset='1'%20stop-color='%23c1282a'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M64%208%20118%2064%2064%20120%2010%2064z'%20fill='url(%23farm-base)'%20stroke='%237a4a11'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M26%2068c12-22%2038-38%2066-32%2016%204%2026%2016%2030%2030L64%20112z'%20fill='url(%23farm-ridges)'%20/%3e%3cg%20fill='none'%20stroke-linecap='round'%20stroke-width='4'%3e%3cpath%20d='M30%2076c12-12%2042-20%2068-12'%20stroke='%23b37319'%20/%3e%3cpath%20d='M34%2088c16-12%2044-18%2068-10'%20stroke='%238c5113'%20/%3e%3cpath%20d='M40%20100c18-10%2044-12%2060-6'%20stroke='%23a66417'%20/%3e%3c/g%3e%3cg%20stroke-linejoin='round'%20stroke='%23611919'%20stroke-width='4'%3e%3cpath%20d='M48%2058%2064%2044l16%2014v24H48z'%20fill='url(%23farm-barn)'%20/%3e%3cpath%20d='M58%2068h12v18H58z'%20fill='%23ffe3d1'%20stroke='%23b84c2f'%20stroke-width='3'%20/%3e%3c/g%3e%3cg%20stroke='%23ffe7c9'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.7'%3e%3cpath%20d='M50%2066h12'%20/%3e%3cpath%20d='M68%2066h6'%20/%3e%3c/g%3e%3cpath%20d='M44%2096h40l-8%2018H52z'%20fill='%239c641a'%20opacity='0.6'%20/%3e%3c/svg%3e",Qt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cdefs%3e%3clinearGradient%20id='barracks-base'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23d8d8dd'%20/%3e%3cstop%20offset='1'%20stop-color='%238a8c98'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='barracks-roof'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23f04242'%20/%3e%3cstop%20offset='1'%20stop-color='%238e171f'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='barracks-banner'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23ffe876'%20/%3e%3cstop%20offset='1'%20stop-color='%23f4b10a'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M64%208%20118%2064%2064%20120%2010%2064z'%20fill='%232b2731'%20stroke='%2317131a'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M28%2070c14-26%2044-40%2072-32%2014%204%2022%2014%2026%2030L64%20112z'%20fill='%233e3544'%20opacity='0.9'%20/%3e%3cg%20stroke='%232d2b36'%20stroke-width='4'%20stroke-linejoin='round'%3e%3cpath%20d='M42%2096h44l-4-36H46z'%20fill='url(%23barracks-base)'%20/%3e%3cpath%20d='M36%2064%2064%2042l28%2022v16H36z'%20fill='url(%23barracks-roof)'%20/%3e%3c/g%3e%3cg%20fill='%23f5f5f7'%20stroke='%234a4f63'%20stroke-width='3'%20stroke-linejoin='round'%3e%3cpath%20d='M52%2092h12V76H52z'%20/%3e%3cpath%20d='M74%2092h12V76H74z'%20/%3e%3c/g%3e%3cg%20fill='url(%23barracks-banner)'%20stroke='%238e171f'%20stroke-width='3'%20stroke-linejoin='round'%3e%3cpath%20d='M64%2046v-18l10%206v12z'%20/%3e%3cpath%20d='M64%2046v-18l-10%206v12z'%20/%3e%3c/g%3e%3cg%20stroke='%23ffecc0'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.7'%3e%3cpath%20d='M48%2070h12'%20/%3e%3cpath%20d='M74%2070h12'%20/%3e%3c/g%3e%3cpath%20d='M42%20100h44l-10%2016H52z'%20fill='%236f758a'%20opacity='0.7'%20/%3e%3c/svg%3e",Jt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cdefs%3e%3clinearGradient%20id='city-base'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23e2e8f2'%20/%3e%3cstop%20offset='1'%20stop-color='%23a7b3c7'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='city-sky'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%238fc5ff'%20stop-opacity='0.9'%20/%3e%3cstop%20offset='1'%20stop-color='%233b5a96'%20stop-opacity='0.3'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='city-highlight'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23ffffff'%20stop-opacity='0.9'%20/%3e%3cstop%20offset='1'%20stop-color='%238aa1c1'%20stop-opacity='0.1'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M64%208%20118%2064%2064%20120%2010%2064z'%20fill='%2325314b'%20stroke='%23141b29'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M26%2066c14-24%2042-38%2070-34%2016%202%2026%2012%2030%2028L64%20114z'%20fill='url(%23city-sky)'%20/%3e%3cg%20stroke='%231d2533'%20stroke-width='4'%20stroke-linejoin='round'%20fill='url(%23city-base)'%3e%3cpath%20d='M40%2090h16V46l-16%208z'%20/%3e%3cpath%20d='M62%20100h18V34l-18%2010z'%20/%3e%3cpath%20d='M84%2094h14V54l-14%206z'%20/%3e%3c/g%3e%3cg%20fill='%231c2b44'%20opacity='0.8'%3e%3cpath%20d='M46%2092h6V70l-6%202z'%20/%3e%3cpath%20d='M70%2096h8V66l-8%204z'%20/%3e%3cpath%20d='M90%2090h6V70l-6%202z'%20/%3e%3c/g%3e%3cg%20fill='%2374c0ff'%20opacity='0.85'%3e%3crect%20x='48'%20y='70'%20width='4'%20height='6'%20rx='1'%20/%3e%3crect%20x='72'%20y='74'%20width='4'%20height='6'%20rx='1'%20/%3e%3crect%20x='94'%20y='72'%20width='4'%20height='6'%20rx='1'%20/%3e%3crect%20x='48'%20y='82'%20width='4'%20height='6'%20rx='1'%20/%3e%3crect%20x='72'%20y='88'%20width='4'%20height='6'%20rx='1'%20/%3e%3crect%20x='94'%20y='84'%20width='4'%20height='6'%20rx='1'%20/%3e%3c/g%3e%3cpath%20d='M34%20100h60l-12%2018H46z'%20fill='url(%23city-highlight)'%20stroke='%23202a3f'%20stroke-width='3'%20stroke-linejoin='round'%20/%3e%3cg%20stroke='%23ffffff'%20stroke-opacity='0.6'%20stroke-width='3'%20stroke-linecap='round'%3e%3cpath%20d='M54%2058h8'%20/%3e%3cpath%20d='M80%2052h10'%20/%3e%3c/g%3e%3cpath%20d='M64%2032c4-8%2010-12%2016-12%206%200%2012%206%2014%2014'%20fill='none'%20stroke='%237fb6ff'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3c/svg%3e",Zt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cdefs%3e%3clinearGradient%20id='mine-base'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%235d4639'%20/%3e%3cstop%20offset='1'%20stop-color='%232f1f16'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mine-ore'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23ffd18d'%20/%3e%3cstop%20offset='1'%20stop-color='%23ff8b47'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mine-light'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23ffefc6'%20/%3e%3cstop%20offset='1'%20stop-color='%23e9a74a'%20stop-opacity='0.4'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M64%208%20118%2064%2064%20120%2010%2064z'%20fill='url(%23mine-base)'%20stroke='%231a0d07'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M32%2090c6-26%2018-52%2032-70%2014%2018%2026%2044%2032%2070l-32%2020z'%20fill='%233b2a21'%20/%3e%3cpath%20d='M44%2096h40l-6-36H50z'%20fill='%23141010'%20stroke='%2337251c'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M58%2072h12l4%2024H54z'%20fill='%231f1a18'%20/%3e%3cpath%20d='M50%2060l14-24%2014%2024'%20fill='none'%20stroke='%23c6b098'%20stroke-width='6'%20stroke-linecap='round'%20stroke-linejoin='round'%20/%3e%3cg%20fill='url(%23mine-ore)'%20stroke='%237b330f'%20stroke-width='3'%20stroke-linejoin='round'%3e%3cpath%20d='M38%2094%2054%2080l12%2012-8%2016z'%20/%3e%3cpath%20d='M90%2088%2074%2072l-10%2010%2012%2014z'%20/%3e%3c/g%3e%3cpath%20d='M64%2044c-6%2012-10%2028-10%2036l10-6%2010%206c0-8-4-24-10-36z'%20fill='url(%23mine-light)'%20opacity='0.85'%20/%3e%3cg%20stroke='%23f6d28b'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.8'%3e%3cpath%20d='M46%2052l8-8'%20/%3e%3cpath%20d='M82%2054l-6-10'%20/%3e%3cpath%20d='M64%20102v-10'%20/%3e%3c/g%3e%3c/svg%3e",eo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cdefs%3e%3clinearGradient%20id='soldier-bg'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%2323364f'%20/%3e%3cstop%20offset='1'%20stop-color='%230f1824'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-armor'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%239fc0ff'%20/%3e%3cstop%20offset='1'%20stop-color='%234a6a9b'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-shield'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23ffe37d'%20/%3e%3cstop%20offset='1'%20stop-color='%23c46b16'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='64'%20cy='64'%20r='60'%20fill='url(%23soldier-bg)'%20stroke='%23060a0f'%20stroke-width='4'%20/%3e%3cg%20fill='url(%23soldier-armor)'%20stroke='%231a2b40'%20stroke-width='4'%20stroke-linejoin='round'%3e%3cpath%20d='M48%2098h32l-4-28H52z'%20/%3e%3cpath%20d='M54%2054c0-14%206-26%2010-30%204%204%2010%2016%2010%2030'%20/%3e%3cpath%20d='M42%2066c6-12%2016-20%2022-20s16%208%2022%2020'%20opacity='0.75'%20/%3e%3c/g%3e%3cg%20fill='%23f8f9fb'%20stroke='%2318263a'%20stroke-width='4'%20stroke-linejoin='round'%3e%3ccircle%20cx='64'%20cy='46'%20r='14'%20/%3e%3cpath%20d='M54%20108h20l-6%2012H60z'%20/%3e%3c/g%3e%3cg%20fill='url(%23soldier-shield)'%20stroke='%233c2410'%20stroke-width='5'%20stroke-linejoin='round'%3e%3cpath%20d='M32%2072c4-12%2018-24%2032-24%2014%200%2028%2012%2032%2024-8%2014-22%2026-32%2026s-24-12-32-26z'%20/%3e%3cpath%20d='M64%2056c10%200%2020%208%2024%2016-6%2010-16%2018-24%2018s-18-8-24-18c4-8%2014-16%2024-16z'%20fill='%23ffdca4'%20opacity='0.7'%20/%3e%3c/g%3e%3cg%20stroke='%23ffffff'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.7'%3e%3cpath%20d='M58%2044h12'%20/%3e%3cpath%20d='M44%2072h8'%20/%3e%3cpath%20d='M76%2072h8'%20/%3e%3c/g%3e%3cpath%20d='M72%2080c0%204-4%208-8%208s-8-4-8-8'%20fill='none'%20stroke='%23243956'%20stroke-width='4'%20stroke-linecap='round'%20/%3e%3c/svg%3e",to="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cdefs%3e%3clinearGradient%20id='archer-bg'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23264537'%20/%3e%3cstop%20offset='1'%20stop-color='%2315231a'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='archer-cloak'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%236ecf7e'%20/%3e%3cstop%20offset='1'%20stop-color='%232c8b5b'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='archer-bow'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23f6d08b'%20/%3e%3cstop%20offset='1'%20stop-color='%23a3631c'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='64'%20cy='64'%20r='60'%20fill='url(%23archer-bg)'%20stroke='%230b1510'%20stroke-width='4'%20/%3e%3cpath%20d='M44%2096c-4-24%208-52%2020-64%2012%2012%2020%2040%2016%2064'%20fill='url(%23archer-cloak)'%20stroke='%230f3a23'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M58%2090c0-12%206-24%2012-34%206%2010%2010%2022%2010%2034'%20fill='%231f4c31'%20opacity='0.7'%20/%3e%3cpath%20d='M80%2094c-10-18-20-28-34-32'%20fill='none'%20stroke='%23d6f6e0'%20stroke-width='5'%20stroke-linecap='round'%20opacity='0.6'%20/%3e%3cpath%20d='M84%2042c-18%2010-32%2024-40%2044'%20fill='none'%20stroke='url(%23archer-bow)'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3cpath%20d='M84%2042c6%2010%2010%2024%2010%2038'%20fill='none'%20stroke='%23f9e8c6'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3cpath%20d='M48%2068l30-4'%20stroke='%23e3f7f0'%20stroke-width='4'%20stroke-linecap='round'%20/%3e%3cpath%20d='M78%2060l10-4-4%2010z'%20fill='%23f4e4c4'%20/%3e%3cg%20fill='%23f8f0dc'%20stroke='%23233a2c'%20stroke-width='4'%20stroke-linejoin='round'%3e%3cpath%20d='M60%2052c-2-6%200-12%204-16s10-6%2016-2c6%204%208%2012%206%2018-4-8-12-10-18-4z'%20/%3e%3cpath%20d='M52%2088c6%206%2016%2010%2024%208l-4%2012H58z'%20/%3e%3c/g%3e%3cg%20stroke='%234b7b5a'%20stroke-width='5'%20stroke-linecap='round'%3e%3cpath%20d='M70%2080l12%2010'%20/%3e%3cpath%20d='M58%2074l-8%2012'%20/%3e%3c/g%3e%3c/svg%3e",oo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cdefs%3e%3clinearGradient%20id='avanto-marauder-bg'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%233b1115'%20/%3e%3cstop%20offset='1'%20stop-color='%23140406'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='avanto-marauder-armor'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23ff8b4d'%20/%3e%3cstop%20offset='1'%20stop-color='%23a1261f'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='avanto-marauder-blade'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0'%20stop-color='%23ffe0ce'%20/%3e%3cstop%20offset='1'%20stop-color='%23c96b4a'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='64'%20cy='64'%20r='60'%20fill='url(%23avanto-marauder-bg)'%20stroke='%23060102'%20stroke-width='4'%20/%3e%3cpath%20d='M40%2092c0-22%2012-48%2024-62%2012%2014%2024%2040%2024%2062'%20fill='url(%23avanto-marauder-armor)'%20stroke='%234f0f13'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M58%2088c2-14%208-28%2014-40%206%2012%2010%2026%2010%2040'%20fill='%235f0f13'%20opacity='0.5'%20/%3e%3cg%20fill='%23f9dfc2'%20stroke='%23431012'%20stroke-width='4'%20stroke-linejoin='round'%3e%3cpath%20d='M54%2050c-2-10%202-18%208-22s14-2%2020%206c4%206%204%2014%200%2020-6-8-16-10-24-4z'%20/%3e%3cpath%20d='M48%20102c10%206%2022%206%2032%200l-6%2014H54z'%20/%3e%3c/g%3e%3cpath%20d='M44%2074c10-8%2026-12%2040-10'%20fill='none'%20stroke='%23ffb687'%20stroke-width='6'%20stroke-linecap='round'%20opacity='0.7'%20/%3e%3cpath%20d='M78%2054l30-8-18%2032-14-8z'%20fill='url(%23avanto-marauder-blade)'%20stroke='%2355140f'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M88%2058l8-4-4%208z'%20fill='%23fff4e9'%20/%3e%3cg%20stroke='%23ffd5be'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.7'%3e%3cpath%20d='M64%2044h10'%20/%3e%3cpath%20d='M52%2072h10'%20/%3e%3c/g%3e%3cg%20stroke='%23521214'%20stroke-width='5'%20stroke-linecap='round'%3e%3cpath%20d='M60%2086l-10%2012'%20/%3e%3cpath%20d='M74%2080l12%2010'%20/%3e%3c/g%3e%3c/svg%3e";class no{listeners=new Map;on(t,o){const n=this.listeners.get(t)??[];n.push(o),this.listeners.set(t,n)}off(t,o){const n=this.listeners.get(t);if(!n)return;const r=n.indexOf(o);r!==-1&&(n.splice(r,1),n.length===0?this.listeners.delete(t):this.listeners.set(t,n))}emit(t,o){const n=this.listeners.get(t);if(n)for(const r of n)r(o)}}const v=new no;class Ke{type="farm";cost=50;beerPerTick=1}class kt{type="barracks";cost=100;trainingCapacity=1}const Mt=Math.sqrt(3),St=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function V(e,t){return{x:t*Mt*(e.q+e.r/2),y:t*(3/2)*e.r}}function ro(e,t,o){const n=(Mt/3*e-.3333333333333333*t)/o,r=2/3*t/o;return so({q:n,r})}function De(e){return St.map(t=>({q:e.q+t.q,r:e.r+t.r}))}function so(e){let t=e.q,o=e.r,n=-t-o,r=Math.round(t),s=Math.round(n),a=Math.round(o);const i=Math.abs(r-t),d=Math.abs(s-n),c=Math.abs(a-o);return i>d&&i>c?r=-s-a:d>c?s=-r-a:a=-r-s,{q:r,r:a}}const Se=new Set;let ke=32;function ao(e){return`${e.q},${e.r}`}function Fe(e,t){ke=t,Se.add(ao(e))}function io(e){if(Se.size===0)return{center:{x:0,y:0},zoom:1};const t=ke*Math.sqrt(3),o=ke*2;let n=1/0,r=1/0,s=-1/0,a=-1/0;for(const m of Se){const[b,A]=m.split(",").map(Number),{x:y,y:C}=V({q:b,r:A},ke);n=Math.min(n,y),r=Math.min(r,C),s=Math.max(s,y+t),a=Math.max(a,C+o)}const i=s-n,d=a-r,c=96,l={x:n+i/2,y:r+d/2},u=e.width/(i+c*2),f=e.height/(d+c*2),g=Math.min(u,f);return{center:l,zoom:g}}const E={x:0,y:0,zoom:1};function co(e,t=300){const o=E.x,n=E.y,r=E.zoom,s=typeof performance<"u"?performance.now():Date.now(),a=i=>{const d=Math.min((i-s)/t,1);E.x=o+(e.center.x-o)*d,E.y=n+(e.center.y-n)*d,E.zoom=r+(e.zoom-r)*d,d<1&&(typeof requestAnimationFrame<"u"?requestAnimationFrame(a):setTimeout(()=>a(typeof performance<"u"?performance.now():Date.now()),16))};typeof requestAnimationFrame<"u"?requestAnimationFrame(a):setTimeout(()=>a(typeof performance<"u"?performance.now():Date.now()),0)}function lo(){Se.clear()}async function uo(e){const t={},o={},n=[],r=Object.entries(e.images??{}).map(([a,i])=>new Promise(d=>{const c=new Image;c.onload=()=>{t[a]=c,d()},c.onerror=()=>{const l=`Failed to load image: ${i}`;console.error(l),n.push(l),d()},c.src=i})),s=Object.entries(e.sounds??{}).map(([a,i])=>new Promise(d=>{const c=new Audio;c.oncanplaythrough=()=>{o[a]=c,d()},c.onerror=()=>{const l=`Failed to load sound: ${i}`;console.error(l),n.push(l),d()},c.src=i,c.load()}));return await Promise.all([...r,...s]),{assets:{images:t,sounds:o},failures:n}}function fo(e){const t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(o){console.warn(`Failed to parse data for "${e}", clearing`,o),localStorage.removeItem(e);return}}function Be(e){return`${e.q},${e.r}`}const At={farm:()=>new Ke,barracks:()=>new kt};function ho(e){return At[e]?.()}var k=(e=>(e.SAUNA_BEER="sauna-beer",e.SAUNAKUNNIA="saunakunnia",e))(k||{});const po={"sauna-beer":1,saunakunnia:0};class mo{constructor(t,o="gameState"){this.tickInterval=t,this.storageKey=o}resources={"sauna-beer":0,saunakunnia:0};passiveGeneration={...po};lastSaved=Date.now();buildings={};buildingPlacements=new Map;policies=new Set;nightWorkSpeedMultiplier=1;tick(){Object.keys(this.passiveGeneration).forEach(t=>{this.addResource(t,this.passiveGeneration[t])})}save(){this.lastSaved=Date.now();const t={};this.buildingPlacements.forEach((n,r)=>{t[r]=n.type});const o={resources:this.resources,lastSaved:this.lastSaved,buildings:this.buildings,buildingPlacements:t};localStorage.setItem(this.storageKey,JSON.stringify(o))}load(t){const o=fo(this.storageKey);if(!o){this.lastSaved=Date.now();return}this.resources={...this.resources,...o.resources},Object.keys(this.resources).forEach(a=>{Number.isFinite(this.resources[a])||(this.resources[a]=0)});const n={};Object.entries(o.buildings??{}).forEach(([a,i])=>{At[a]&&(n[a]=i)}),this.buildings=n,this.buildingPlacements.clear(),o.buildingPlacements&&Object.entries(o.buildingPlacements).forEach(([a,i])=>{const d=ho(i);if(!d)return;this.buildingPlacements.set(a,d);const[c,l]=a.split(",").map(Number);if(t){const u=t.ensureTile(c,l);u.placeBuilding(d.type),u.reveal(),Fe({q:c,r:l},t.hexSize)}v.emit("buildingPlaced",{building:d,coord:{q:c,r:l},state:this})}),this.lastSaved=o.lastSaved??Date.now();const r=Date.now()-this.lastSaved,s=Math.floor(r/this.tickInterval);Object.keys(this.passiveGeneration).forEach(a=>{this.resources[a]+=s*this.passiveGeneration[a]})}getResource(t){return this.resources[t]}canAfford(t,o="sauna-beer"){return this.resources[o]>=t}spend(t,o="sauna-beer"){return this.canAfford(t,o)?(this.resources[o]-=t,v.emit("resourceChanged",{resource:o,amount:-t,total:this.resources[o]}),!0):!1}addResource(t,o){this.resources[t]+=o,v.emit("resourceChanged",{resource:t,amount:o,total:this.resources[t]})}modifyPassiveGeneration(t,o){this.passiveGeneration[t]=(this.passiveGeneration[t]??0)+o}construct(t,o,n="sauna-beer"){return this.spend(o,n)?(this.buildings[t]=(this.buildings[t]??0)+1,!0):!1}placeBuilding(t,o,n,r="sauna-beer"){const s=n.getTile(o.q,o.r);return!s||s.building||!this.construct(t.type,t.cost,r)?!1:(this.buildingPlacements.set(Be(o),t),s.placeBuilding(t.type),v.emit("buildingPlaced",{building:t,coord:o,state:this}),!0)}getBuildingAt(t){return this.buildingPlacements.get(Be(t))}removeBuilding(t,o){const n=Be(t),r=this.buildingPlacements.get(n);return r?(this.buildingPlacements.delete(n),o.getTile(t.q,t.r)?.placeBuilding(null),this.buildings[r.type]!==void 0&&(this.buildings[r.type]-=1,this.buildings[r.type]<=0&&delete this.buildings[r.type]),v.emit("buildingRemoved",{building:r,coord:t,state:this}),!0):!1}upgrade(t,o,n="sauna-beer"){return this.construct(`upgrade:${t}`,o,n)}applyPolicy(t,o,n="sauna-beer"){return this.spend(o,n)?(this.policies.add(t),v.emit("policyApplied",{policy:t,state:this}),!0):!1}hasPolicy(t){return this.policies.has(t)}}class go{constructor(t,o){this.baseInterval=t,this.onTick=o}timer=null;speed=1;lastTick=0;accumulator=0;start(){this.stop(),this.lastTick=Date.now();const t=this.baseInterval/this.speed;this.timer=setInterval(()=>{const o=Date.now(),n=o-this.lastTick;this.lastTick=o,this.onTick(n)},t)}stop(){this.timer!==null&&(clearInterval(this.timer),this.timer=null)}setSpeed(t){if(t<=0)throw new Error("Speed multiplier must be positive");this.speed=t,this.timer!==null&&this.start()}getSpeed(){return this.speed}getBaseInterval(){return this.baseInterval}tick(t){for(this.accumulator+=t*this.speed;this.accumulator>=this.baseInterval;)this.accumulator-=this.baseInterval,this.onTick(this.baseInterval)}}var q=(e=>(e[e.Plains=0]="Plains",e[e.Forest=1]="Forest",e[e.Hills=2]="Hills",e[e.Lake=3]="Lake",e))(q||{});function bo(e,t,o){let n=e*374761393+t*668265263+o*0x14057b7ef7678100;return n=(n^n>>13)*1274126177,n^=n>>16,(n>>>0)/4294967295}function Ze(e,t,o=0){const n=bo(e,t,o);return n<.1?3:n<.3?1:n<.5?2:0}class et{constructor(t=q.Plains,o=null,n=!0){this.terrain=t,this.building=o,this.isFogged=n}reveal(){this.isFogged=!1}placeBuilding(t){this.building=t}setFogged(t){this.isFogged=t}}class yo{constructor(t=10,o=10,n=32,r=0){this.hexSize=n,this.seed=r,this.minQ=0,this.minR=0,this.maxQ=t-1,this.maxR=o-1;for(let s=this.minR;s<=this.maxR;s++)for(let a=this.minQ;a<=this.maxQ;a++)this.tiles.set(this.key(a,s),new et(Ze(a,s,r)))}tiles=new Map;minQ;maxQ;minR;maxR;get width(){return this.maxQ-this.minQ+1}get height(){return this.maxR-this.minR+1}key(t,o){return`${t},${o}`}ensureTile(t,o){const n=this.key(t,o);let r=this.tiles.get(n);return r||(r=new et(Ze(t,o,this.seed)),this.tiles.set(n,r),this.minQ=Math.min(this.minQ,t),this.maxQ=Math.max(this.maxQ,t),this.minR=Math.min(this.minR,o),this.maxR=Math.max(this.maxR,o),r.isFogged||Fe({q:t,r:o},this.hexSize)),r}getTile(t,o){return this.ensureTile(t,o)}forEachTile(t){for(let o=this.minR;o<=this.maxR;o++)for(let n=this.minQ;n<=this.maxQ;n++){const r=this.ensureTile(n,o);t(r,{q:n,r:o})}}getNeighbors(t,o){return De({q:t,r:o}).map(n=>this.ensureTile(n.q,n.r))}revealAround(t,o){for(let s=-o;s<=o;s++){const a=Math.max(-o,-s-o),i=Math.min(o,-s+o);for(let d=a;d<=i;d++){const c={q:t.q+s,r:t.r+d};this.ensureTile(c.q,c.r).reveal(),Fe(c,this.hexSize)}}const n=typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0},r=io(n);co(r,300)}}const Ct=({policy:e,state:t})=>{e==="eco"&&(t.modifyPassiveGeneration(k.SAUNA_BEER,1),v.off("policyApplied",Ct))},Et=({policy:e,state:t})=>{e==="temperance"&&(t.nightWorkSpeedMultiplier*=1.05,v.off("policyApplied",Et))},It=({policy:e,state:t})=>{e==="steam-diplomats"&&(t.modifyPassiveGeneration(k.SAUNAKUNNIA,1),v.off("policyApplied",It))};v.on("policyApplied",Ct);v.on("policyApplied",Et);v.on("policyApplied",It);const wo="modulepreload",vo=function(e){return"/"+e},tt={},ko=function(t,o,n){let r=Promise.resolve();if(o&&o.length>0){let d=function(c){return Promise.all(c.map(l=>Promise.resolve(l).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=a?.nonce||a?.getAttribute("nonce");r=d(o.map(c=>{if(c=vo(c),c in tt)return;tt[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const f=document.createElement("link");if(f.rel=l?"stylesheet":wo,l||(f.as="script"),f.crossOrigin="",f.href=c,i&&f.setAttribute("nonce",i),document.head.appendChild(f),l)return new Promise((g,m)=>{f.addEventListener("load",g),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return r.then(a=>{for(const i of a||[])i.status==="rejected"&&s(i.reason);return t().catch(s)})},Mo=({building:e,coord:t,state:o})=>{e instanceof Ke?o.modifyPassiveGeneration(k.SAUNA_BEER,e.beerPerTick):e instanceof kt&&ko(async()=>{const{spawnUnit:n}=await import("./UnitFactory-D2hHKgUt.js");return{spawnUnit:n}},[]).then(({spawnUnit:n})=>{n(o,"soldier",`barracks-${t.q}-${t.r}`,t,"player")})},So=({building:e,state:t})=>{e instanceof Ke&&t.modifyPassiveGeneration(k.SAUNA_BEER,-e.beerPerTick)};v.on("buildingPlaced",Mo);v.on("buildingRemoved",So);function j(e){return`${e.q},${e.r}`}function Ao(e){const[t,o]=e.split(",").map(Number);return{q:t,r:o}}function ot(e,t){const o=-e.q-e.r,n=-t.q-t.r;return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(o-n))}class Co{constructor(t,o,n,r,s=[]){this.id=t,this.coord=o,this.faction=n,this.stats=r,this.priorityFactions=s,this.maxHealth=r.health}alive=!0;listeners={};maxHealth;healMarkerElapsed=0;onDeath(t){(this.listeners.death??=[]).push(t)}emitDeath(){for(const t of this.listeners.death??[])t()}isDead(){return!this.alive}getMaxHealth(){return this.maxHealth}distanceTo(t){return ot(this.coord,t)}attack(t){this.distanceTo(t.coord)<=this.stats.attackRange&&t.takeDamage(this.stats.attackDamage,this)}update(t,o){if(!(this.isDead()||!o))if(ot(this.coord,o.pos)<=o.auraRadius){const n=this.stats.health;this.stats.health=Math.min(this.stats.health+o.regenPerSec*t,this.maxHealth),this.stats.health>n&&(this.healMarkerElapsed+=t,this.healMarkerElapsed>=1&&(this.healMarkerElapsed=0,this.spawnHealMarker()))}else this.healMarkerElapsed=0}spawnHealMarker(){if(typeof document>"u")return;const t=document.getElementById("game-canvas");if(!t)return;const{x:o,y:n}=V(this.coord,32),r=document.createElement("div");r.textContent="+",r.className="heal-marker",r.style.position="absolute";const s=t.getBoundingClientRect();r.style.left=`${s.left+o}px`,r.style.top=`${s.top+n}px`,r.style.pointerEvents="none",document.body.appendChild(r),setTimeout(()=>r.remove(),1e3)}takeDamage(t,o){this.stats.health-=t,v.emit("unitDamaged",{attackerId:o?.id,targetId:this.id,amount:t,remainingHealth:this.stats.health}),this.stats.health<=0&&this.alive&&(this.stats.health=0,this.alive=!1,v.emit("unitDied",{unitId:this.id,attackerId:o?.id,unitFaction:this.faction,attackerFaction:o?.faction}),this.emitDeath())}moveTowards(t,o,n){const r=this.findPath(t,o,n);if(r.length<2)return[];let s=0;for(let i=1;i<r.length;i++){const d=j(r[i]);if(n.has(d))break;s=i}if(s===0)return[];const a=Math.min(this.stats.movementRange,s);return r.slice(0,a+1)}findPath(t,o,n){const r=this.coord,s=j(r),a=j(t),i=[r],d=new Map;for(d.set(s,null);i.length>0;){const u=i.shift(),f=j(u);if(f===a)break;for(const g of De(u)){const m=j(g);m!==a&&!this.isPassable(g,o,n)||d.has(m)||(i.push(g),d.set(m,f))}}if(!d.has(a))return[r];const c=[];let l=a;for(;l;)c.push(Ao(l)),l=d.get(l)??null;return c.reverse()}seekNearestEnemy(t,o,n){const r=new Map;for(const i of t)r.set(j(i.coord),i);const s=[this.coord],a=new Set([j(this.coord)]);for(;s.length>0;){const i=s.shift(),d=j(i),c=r.get(d);if(c)return c;for(const l of De(i)){const u=j(l),f=r.get(u);if(f)return f;this.isPassable(l,o,n)&&(a.has(u)||(a.add(u),s.push(l)))}}return null}isPassable(t,o,n){const r=o.getTile(t.q,t.r);return!r||n&&n.has(j(t))?!1:r.terrain!==q.Lake}}class Eo{static selectTarget(t,o){let n=o.filter(s=>s.faction!==t.faction&&!s.isDead());if(n.length===0)return null;if(t.priorityFactions.length>0){const s=n.filter(a=>t.priorityFactions.includes(a.faction));s.length>0&&(n=s)}const r=n.filter(s=>t.distanceTo(s.coord)<=t.stats.attackRange);return r.length>0?(r.sort((s,a)=>s.stats.health-a.stats.health),r[0]):(n.sort((s,a)=>t.distanceTo(s.coord)-t.distanceTo(a.coord)),n[0]??null)}}function be(e){return`${e.q},${e.r}`}class Io{constructor(t){this.map=t}tick(t){const o=new Set;for(const n of t)n.isDead()||o.add(be(n.coord));for(const n of t){const r=be(n.coord);if(o.delete(r),n.isDead())continue;const s=Eo.selectTarget(n,t);if(!s){o.add(r);continue}if(n.distanceTo(s.coord)>n.stats.attackRange){const a=n.moveTowards(s.coord,this.map,o);a.length>0&&(n.coord=a[a.length-1])}n.distanceTo(s.coord)<=n.stats.attackRange&&!s.isDead()&&(n.attack(s),s.isDead()&&o.delete(be(s.coord))),o.add(be(n.coord))}}}const Po={health:12,attackDamage:4,attackRange:1,movementRange:2};class To extends Co{constructor(t,o,n){super(t,o,n,{...Po})}}let D=null;const he={};function Pt(){if(D||typeof window>"u")return D;const e=window.AudioContext||window.webkitAudioContext;if(!e)return console.warn("Web Audio API not supported"),null;try{D=new e}catch(t){return console.warn("Unable to create AudioContext",t),null}if(he.click=No(),he.spawn=xo(),he.error=Ro(),he.sisu=Lo(),D.state==="suspended"){const t=()=>{D?.resume()};window.addEventListener("pointerdown",t,{once:!0})}return D}function Pe(e,t){const o=D,n=o.createBuffer(1,e,o.sampleRate),r=n.getChannelData(0);for(let s=0;s<e;s++){const a=s/o.sampleRate;r[s]=t(a)}return n}function No(){return Pe(Math.floor(D.sampleRate*.05),t=>Math.sin(2*Math.PI*1e3*t)*Math.exp(-40*t))}function xo(){return Pe(Math.floor(D.sampleRate*.2),t=>(Math.sin(2*Math.PI*440*t)+Math.sin(2*Math.PI*660*t))*.5*Math.exp(-6*t))}function Ro(){return Pe(Math.floor(D.sampleRate*.3),t=>Math.sin(2*Math.PI*110*t)*Math.exp(-8*t))}function Lo(){return Pe(Math.floor(D.sampleRate*.5),t=>Math.sin(2*Math.PI*880*t)*Math.exp(-2*t))}let Te=!1;typeof localStorage<"u"&&(Te=localStorage.getItem("sfx-muted")==="true");function nt(){return Te}function Bo(e){Te=e,typeof localStorage<"u"&&localStorage.setItem("sfx-muted",e?"true":"false")}function Tt(e){if(Te)return;const t=Pt();if(!t)return;const o=he[e];if(!o)return;t.state==="suspended"&&t.resume();const n=t.createBufferSource();n.buffer=o,n.connect(t.destination),n.start()}typeof document<"u"&&document.addEventListener("click",e=>{e.target instanceof HTMLButtonElement&&Tt("click")});Pt();const Uo={q:0,r:0},$o="Saunoja",rt=18,st=0;function at(e,t,o){return Math.min(Math.max(e,t),o)}function Nt(e){const{id:t,name:o=$o,coord:n=Uo,maxHp:r=rt,hp:s=r,steam:a=0,lastHitAt:i=st,selected:d=!1}=e,c=Number.isFinite(r)?Math.max(1,r):rt,l=Number.isFinite(s)?s:c,u=at(l,0,c),f=Number.isFinite(a)?a:0,g=at(f,0,1),m=Number.isFinite(i)?i:st,b=Math.max(0,m);return{id:t,name:o,coord:{q:n.q,r:n.r},maxHp:c,hp:u,steam:g,lastHitAt:b,selected:d}}const ce=32;function pe(e,t,o,n){e.beginPath();for(let r=0;r<6;r++){const s=Math.PI/3*r,a=t+n*Math.cos(s),i=o+n*Math.sin(s);r===0?e.moveTo(a,i):e.lineTo(a,i)}e.closePath()}function Ve(e,t,o){return Math.min(Math.max(e,t),o)}function _o(e,{centerX:t,centerY:o,hp:n,maxHp:r,radius:s=ce*.55}){const a=Number.isFinite(r)?Math.max(1,r):1,i=Number.isFinite(n)?n:a,d=Ve(i/a,0,1);if(e.save(),pe(e,t,o,s),e.fillStyle="rgba(7, 11, 18, 0.72)",e.fill(),e.restore(),d>0){e.save(),pe(e,t,o,s),e.clip();const c=e.createLinearGradient(t,o+s,t,o-s);c.addColorStop(0,"rgba(46, 160, 98, 0.35)"),c.addColorStop(1,"rgba(218, 255, 239, 0.95)"),e.fillStyle=c;const l=s*2*d,u=o+s-l;e.fillRect(t-s,u,s*2,l),e.restore()}e.save(),pe(e,t,o,s),e.lineWidth=Math.max(1,s*.12),e.strokeStyle="rgba(255, 255, 255, 0.28)",e.stroke(),e.restore()}function Go(e,{centerX:t,centerY:o,radius:n=ce,progress:r=0}){const s=Ve(r,0,1);if(s<=0)return;const a=Number.isFinite(n)&&n>0?n:ce;e.save(),e.globalCompositeOperation="lighter",e.globalAlpha=s;const i=e.createRadialGradient(t,o,Math.max(1,a*.1),t,o,a);i.addColorStop(0,"rgba(255, 255, 255, 0.92)"),i.addColorStop(.45,"rgba(255, 255, 255, 0.68)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=i,e.beginPath(),e.arc(t,o,a,0,Math.PI*2),e.fill(),e.restore()}function qo(e,{centerX:t,centerY:o,radius:n=ce*.85,intensity:r=1}){const s=Ve(r,0,1);if(s<=0)return;e.save(),pe(e,t,o,n),e.clip();const a=e.createLinearGradient(t,o+n,t,o-n);a.addColorStop(0,"rgba(255, 255, 255, 0)"),a.addColorStop(.55,`rgba(255, 255, 255, ${.12*s})`),a.addColorStop(1,`rgba(255, 255, 255, ${.35*s})`),e.globalCompositeOperation="lighter",e.fillStyle=a,e.fillRect(t-n,o-n,n*2,n*2),e.restore(),e.save(),e.globalCompositeOperation="lighter",e.lineCap="round",e.strokeStyle=`rgba(255, 255, 255, ${.25*s})`,e.lineWidth=Math.max(1,n*.08);const i=n*.75,d=n*.35;for(let c=0;c<3;c++){const l=o-n*.5+c*d;e.beginPath(),e.moveTo(t-i,l),e.bezierCurveTo(t-i*.4,l-n*.4,t+i*.4,l+n*.2,t+i,l-n*.45),e.stroke()}e.restore()}function Ho(e){return{id:"sauna",pos:e,spawnCooldown:30,timer:30,auraRadius:2,regenPerSec:1,rallyToFront:!1,update(t,o,n){if(this.timer-=t,this.timer>0)return;const r=[];for(let s=-2;s<=2;s++){const a=Math.max(-2,-s-2),i=Math.min(2,-s+2);for(let d=a;d<=i;d++){const c=Math.max(Math.abs(s),Math.abs(d),Math.abs(-s-d));if(c===0||c>2)continue;const l={q:this.pos.q+s,r:this.pos.r+d};o.some(f=>!f.isDead()&&f.coord.q===l.q&&f.coord.r===l.r)||r.push(l)}}if(r.length>0){const s=r[Math.floor(Math.random()*r.length)],a=`avantoMarauder${o.length+1}`,i="enemy",d=new To(a,s,i);n(d)}this.timer=this.spawnCooldown}}}function Qe(e){let t=e.querySelector(".hud-top-row");t||(t=document.createElement("div"),t.className="hud-top-row",e.prepend(t));let o=t.querySelector(".hud-actions");o||(o=document.createElement("div"),o.className="hud-actions",t.appendChild(o));let n=t.querySelector(".hud-right-column");if(!n){n=document.createElement("div"),n.className="hud-right-column",t.appendChild(n);const s=e.querySelector("#resource-bar");s&&n.prepend(s)}const r=e.querySelector("#build-menu");return r&&r.parentElement!==o&&o.appendChild(r),{container:t,actions:o,side:n}}function Do(e){const t=document.getElementById("ui-overlay");if(!t)return()=>{};const o=document.createElement("div");o.classList.add("sauna-control");const n=document.createElement("button");n.type="button",n.textContent="Sauna ♨️",n.classList.add("topbar-button","sauna-toggle"),n.setAttribute("aria-expanded","false"),o.appendChild(n);const r=document.createElement("div");r.classList.add("sauna-card","hud-card"),r.hidden=!0;const s=document.createElement("div");s.classList.add("sauna-progress");const a=document.createElement("div");a.classList.add("sauna-progress__fill"),s.appendChild(a),r.appendChild(s);const i=document.createElement("label");i.classList.add("sauna-option");const d=document.createElement("input");d.type="checkbox",d.classList.add("sauna-option__input"),d.checked=e.rallyToFront,d.addEventListener("change",()=>{e.rallyToFront=d.checked}),i.appendChild(d);const c=document.createElement("span");c.textContent="Rally to Front",c.classList.add("sauna-option__label"),i.appendChild(c),r.appendChild(i),o.appendChild(r);const{actions:l}=Qe(t),u=()=>{o.parentElement!==l&&l.appendChild(o);const f=l.querySelector("#topbar");return f&&f.parentElement===l?(f.nextSibling!==o&&l.insertBefore(o,f.nextSibling),!0):!1};if(!u()){const f=new MutationObserver(()=>{u()&&f.disconnect()});f.observe(l,{childList:!0})}return n.addEventListener("click",()=>{const f=!r.hidden;r.hidden=f,n.setAttribute("aria-expanded",String(!f))}),()=>{const f=1-e.timer/e.spawnCooldown;a.style.width=`${Math.max(0,Math.min(f,1))*100}%`,d.checked=e.rallyToFront}}function ye(e,t={}){const{iconSrc:o,description:n,srLabel:r}=t,s=document.createElement("div");if(s.classList.add("topbar-badge"),s.setAttribute("role","status"),s.setAttribute("aria-live","polite"),s.setAttribute("aria-atomic","true"),o){const u=document.createElement("img");u.src=o,u.alt=e,u.decoding="async",u.classList.add("topbar-badge-icon"),s.appendChild(u)}const a=document.createElement("div");a.classList.add("badge-text");const i=document.createElement("span");i.textContent=e,i.classList.add("badge-label"),a.appendChild(i);const d=document.createElement("span");d.textContent="0",d.classList.add("badge-value"),d.setAttribute("aria-hidden","true"),a.appendChild(d);const c=document.createElement("span");c.classList.add("badge-delta"),c.style.opacity="0",c.style.transform="translateY(-6px)",c.style.transition="opacity 0.5s ease, transform 0.5s ease",c.setAttribute("aria-hidden","true"),s.append(a,c),n&&(s.title=n);const l=r??e;return s.dataset.label=l,s.setAttribute("aria-label",`${l}: 0`),{container:s,value:d,delta:c,label:l}}function Fo(e,t={}){const o=document.getElementById("ui-overlay");if(!o)return()=>{};const{actions:n}=Qe(o),r=document.createElement("div");r.id="topbar",n.prepend(r);const s={[k.SAUNA_BEER]:"Sauna beer bottles chilled for construction crews and eager recruits.",[k.SAUNAKUNNIA]:"Saunakunnia—prestige earned from sauna rituals and triumphant battles."},a=ye("Saunakunnia",{iconSrc:t.saunakunnia,description:s[k.SAUNAKUNNIA],srLabel:"Saunakunnia honor"});a.container.classList.add("badge-sauna");const i=ye("SISU🔥",{iconSrc:t.sisu,srLabel:"Sisu pulse timer"});i.container.classList.add("badge-sisu"),i.container.style.display="none";const d=ye("Sauna Beer",{iconSrc:t.saunaBeer,description:s[k.SAUNA_BEER],srLabel:"Sauna beer reserves"});d.container.classList.add("badge-sauna-beer");const c=ye("Time");c.container.classList.add("badge-time"),c.delta.style.display="none",r.appendChild(a.container),r.appendChild(i.container),r.appendChild(d.container),r.appendChild(c.container);const l=document.createElement("button");l.type="button",l.textContent="SISU",l.classList.add("topbar-button","sisu-button"),l.addEventListener("click",()=>{v.emit("sisuPulse",{})}),r.appendChild(l);const u=document.createElement("button");u.type="button",u.title="Toggle sound",u.classList.add("topbar-button","sound-button");const f=document.createElement("span");if(f.textContent="Sound",t.sound){const h=document.createElement("img");h.src=t.sound,h.alt="",h.decoding="async",h.setAttribute("aria-hidden","true"),u.appendChild(h)}u.appendChild(f);function g(){const h=nt();f.textContent=h?"Muted":"Sound",u.setAttribute("aria-pressed",h?"true":"false"),u.classList.toggle("is-muted",h)}u.addEventListener("click",()=>{Bo(!nt()),g()}),g(),r.appendChild(u),v.on("sisuPulseStart",({remaining:h})=>{l.disabled=!0,i.container.style.display="block",i.value.textContent=String(h)}),v.on("sisuPulseTick",({remaining:h})=>{i.value.textContent=String(h)}),v.on("sisuPulseEnd",()=>{i.container.style.display="none"}),v.on("sisuCooldownEnd",()=>{l.disabled=!1});const m=new Intl.NumberFormat("en-US"),b=new Intl.NumberFormat("en-US",{signDisplay:"exceptZero"}),A={[k.SAUNA_BEER]:"Sauna Beer",[k.SAUNAKUNNIA]:"Saunakunnia"},y={[k.SAUNA_BEER]:{singular:"bottle",plural:"bottles"},[k.SAUNAKUNNIA]:{singular:"honor",plural:"honor"}},C={[k.SAUNA_BEER]:"🍺",[k.SAUNAKUNNIA]:"⚜️"},x={[k.SAUNA_BEER]:d,[k.SAUNAKUNNIA]:a},P={};function T(h,p){const w=Number.isFinite(p)?p:0;return h===k.SAUNA_BEER?m.format(Math.max(0,Math.floor(w))):m.format(Math.max(0,Math.round(w)))}function N(h,p){return p===0?"":`${b.format(p)} ${C[h]}`}function R(h,p){if(p===0)return"";const w=p>0?"gained":"spent",S=m.format(Math.abs(p)),U=y[h];if(U){const _=Math.abs(p)===1?U.singular:U.plural;return`${w} ${S} ${A[h]} ${_}`.trim()}return`${w} ${S} ${A[h]}`}function L(h,p,w=0){const S=x[h];if(!S)return;const U=T(h,p);if(S.value.textContent=U,w!==0){S.delta.textContent=N(h,w),S.delta.style.opacity="1",S.delta.style.transform="translateY(0)";const K=P[h];K&&clearTimeout(K),P[h]=setTimeout(()=>{S.delta.style.opacity="0",S.delta.style.transform="translateY(-6px)",delete P[h]},1e3)}else S.delta.textContent="",S.delta.style.opacity="0",S.delta.style.transform="translateY(-6px)";const _=R(h,w),W=[`${S.label} ${U}`,_].filter(Boolean);S.container.setAttribute("aria-label",W.join(" — "))}L(k.SAUNA_BEER,e.getResource(k.SAUNA_BEER)),L(k.SAUNAKUNNIA,e.getResource(k.SAUNAKUNNIA)),v.on("resourceChanged",({resource:h,amount:p,total:w})=>{const S=h;x[S]&&L(S,w,p)});let $=0;return h=>{$+=h;const p=Math.floor($/1e3),w=Math.floor(p/60),S=p%60;c.value.textContent=`${w}:${S.toString().padStart(2,"0")}`}}let Me=!1,Ue=!1;function zo(){return Me}function Oo(e,t){if(Me||Ue)return;Me=!0,Ue=!0;let o=10;v.emit("sisuPulseStart",{remaining:o});const n=[];for(const s of t)s.faction!=="player"||s.isDead()||(n.push({unit:s,move:s.stats.movementRange,attack:s.stats.attackDamage}),s.stats.movementRange*=1.2,s.stats.attackDamage*=1.2,s.fearless=!0);const r=setInterval(()=>{if(o-=1,o>0){v.emit("sisuPulseTick",{remaining:o});return}clearInterval(r),Me=!1;for(const s of n)s.unit.stats.movementRange=s.move,s.unit.stats.attackDamage=s.attack,delete s.unit.fearless;v.emit("sisuPulseEnd",{}),setTimeout(()=>{Ue=!1,v.emit("sisuCooldownEnd",{})},12e4)},1e3)}function Yo(e){const t=document.getElementById("ui-overlay");if(!t)return{log:()=>{},addEvent:()=>{}};const{side:o}=Qe(t),n=t.querySelector("#right-panel");n&&n.remove();const r=document.createElement("div");r.id="right-panel",r.classList.add("hud-card"),r.setAttribute("role","complementary"),r.setAttribute("aria-label","Policies and events");const s=document.createElement("div");s.classList.add("panel-tabs"),r.appendChild(s);const a=document.createElement("div");a.classList.add("panel-content"),r.appendChild(a);const i=document.createElement("div");i.id="right-panel-policies";const d=document.createElement("div");d.id="right-panel-events";const c=document.createElement("div");c.id="event-log",c.setAttribute("role","log"),c.setAttribute("aria-live","polite");const l={Policies:i,Events:d,Log:c};for(const[h,p]of Object.entries(l))p.classList.add("panel-section","panel-section--scroll"),p.dataset.tab=h,p.hidden=!0;c.classList.add("panel-section--log");function u(h){for(const[p,w]of Object.entries(l))w.hidden=p!==h;for(const p of Array.from(s.children)){const w=p,S=w.textContent===h;w.disabled=S,w.setAttribute("aria-pressed",S?"true":"false")}}for(const h of Object.keys(l)){const p=document.createElement("button");p.type="button",p.textContent=h;const w=l[h];w?.id&&p.setAttribute("aria-controls",w.id),p.setAttribute("aria-pressed","false"),p.addEventListener("click",()=>u(h)),s.appendChild(p),a.appendChild(l[h])}o.appendChild(r);const f=new Intl.NumberFormat("en-US"),g={[k.SAUNA_BEER]:"Sauna Beer Bottles",[k.SAUNAKUNNIA]:"Saunakunnia"},m=[{id:"eco",name:"Eco Policy",description:"Increase passive sauna beer brewing by 1 bottle per tick",cost:15,prerequisite:()=>!0},{id:"temperance",name:"Temperance",description:"+5% work speed at night",cost:25,prerequisite:()=>!0},{id:"steam-diplomats",name:"Steam Diplomats",description:"+1 Saunakunnia honor each tick",cost:8,resource:k.SAUNAKUNNIA,prerequisite:()=>!0}],b={};function A(){i.innerHTML="";for(const h of m){const p=document.createElement("button"),w=h.resource??k.SAUNA_BEER;p.textContent=`${h.name} (${f.format(h.cost)} ${g[w]})`,p.title=`${h.description}. Costs ${f.format(h.cost)} ${g[w]}.`,p.classList.add("panel-action"),p.disabled=!h.prerequisite(e)||e.hasPolicy(h.id)||!e.canAfford(h.cost,w),p.addEventListener("click",()=>{e.applyPolicy(h.id,h.cost,w)&&y()}),i.appendChild(p),b[h.id]=p}}function y(){for(const h of m){const p=b[h.id];if(p){const w=h.resource??k.SAUNA_BEER;p.disabled=!h.prerequisite(e)||e.hasPolicy(h.id)||!e.canAfford(h.cost,w)}}}A(),v.on("resourceChanged",y),v.on("policyApplied",y);const C=[];function x(){d.innerHTML="";for(const h of C){const p=document.createElement("div");p.classList.add("panel-event");const w=document.createElement("h4");w.textContent=h.headline;const S=document.createElement("p");S.textContent=h.body;const U=document.createElement("button");U.textContent=h.buttonText??"Acknowledge",U.classList.add("panel-action"),U.addEventListener("click",()=>{const _=C.findIndex(W=>W.id===h.id);_!==-1&&(C.splice(_,1),x())}),p.appendChild(w),p.appendChild(S),p.appendChild(U),d.appendChild(p)}}function P(h){C.push(h),x(),$(`Event • ${h.headline}`)}const T=100,N=[];let R=!1;function L(){for(const h of N){const p=document.createElement("div");p.textContent=h,p.classList.add("panel-log-entry"),c.appendChild(p)}for(;c.childElementCount>T;)c.removeChild(c.firstChild);c.scrollTop=c.scrollHeight,N.length=0,R=!1}function $(h){N.push(h),R||(R=!0,(typeof requestAnimationFrame=="function"?requestAnimationFrame:p=>setTimeout(p,16))(L))}return u("Policies"),{log:$,addEvent:P}}const jo=Math.sqrt(3),Xo=2;function xt(e){return{width:e*jo,height:e*Xo}}function Rt(e){return Math.min(1,Math.max(0,e))}function Ne(e){let t=e.trim();if(t.startsWith("#")&&(t=t.slice(1)),t.length===3){const o=Number.parseInt(t[0]+t[0],16),n=Number.parseInt(t[1]+t[1],16),r=Number.parseInt(t[2]+t[2],16);return[o,n,r]}if(t.length===6){const o=Number.parseInt(t,16),n=o>>16&255,r=o>>8&255,s=o&255;return[n,r,s]}return[0,0,0]}function Wo(e,t,o){const n=Rt(o),r=(s,a)=>Math.round(s+(a-s)*n);return[r(e[0],t[0]),r(e[1],t[1]),r(e[2],t[2])]}function Ko([e,t,o],n){return`rgba(${e}, ${t}, ${o}, ${Rt(n)})`}function ee(e,t,o,n){return Ko(Wo(e,t,o),n)}function Vo(e){const{ctx:t,x:o,y:n,width:r,height:s,radius:a,baseColor:i}=e,d=Ne(i);t.save(),t.lineCap="round",t.lineJoin="round";const c=ee(d,[255,255,255],.35,.24);t.strokeStyle=c,t.lineWidth=Math.max(1,a*.06);const l=3,u=6,f=o+r*.12,g=o+r*.88;for(let y=0;y<l;y++){const C=y/Math.max(1,l-1),x=n+s*.28+C*s*.32,P=a*(.18-C*.05);t.beginPath();for(let T=0;T<=u;T++){const N=T/u,R=f+(g-f)*N,L=Math.sin(N*Math.PI*1.6+y*.8)*P,$=x-Math.abs(L)*.55;T===0?t.moveTo(R,$):t.lineTo(R,$)}t.stroke()}const m=ee(d,[18,54,32],.4,.2);t.strokeStyle=m,t.lineWidth=Math.max(.75,a*.035);const b=5,A=a*.22;for(let y=0;y<b;y++){const C=o+r*(.2+y/Math.max(1,b-1)*.6),x=n+s*.55-Math.cos(y*.9)*a*.08;t.beginPath(),t.arc(C,x,A,Math.PI*.2,Math.PI*.85),t.stroke(),t.beginPath(),t.arc(C+A*.35,x-A*.1,A*.55,Math.PI*.15,Math.PI*.95),t.stroke()}t.restore()}function Qo(e){const{ctx:t,centerX:o,centerY:n,radius:r,baseColor:s}=e,a=Ne(s);t.save(),t.lineCap="round";const i=ee(a,[255,235,214],.45,.22);t.strokeStyle=i,t.lineWidth=Math.max(1,r*.05);const d=4;for(let u=0;u<d;u++){const f=u/Math.max(1,d-1),g=r*(1.25-f*.45),m=r*(.72-f*.18),b=n+r*.18*(f-.5);t.beginPath(),t.ellipse(o,b,g,m,0,Math.PI*.12,Math.PI*.88),t.stroke()}const c=ee(a,[60,36,20],.35,.18);t.strokeStyle=c,t.lineWidth=Math.max(.85,r*.032),t.setLineDash([r*.22,r*.18]);const l=3;for(let u=0;u<l;u++){const f=r*(.75-u*.1),g=n+r*.28+u*r*.08;t.beginPath(),t.arc(o+r*.08,g,f,Math.PI*.28,Math.PI*.76),t.stroke()}t.setLineDash([]),t.restore()}function Jo(e){const{ctx:t,x:o,y:n,width:r,height:s,radius:a,baseColor:i}=e,d=Ne(i);t.save(),t.lineCap="round",t.lineJoin="round";const c=ee(d,[255,255,255],.55,.28);t.strokeStyle=c,t.lineWidth=Math.max(1,a*.045);const l=4,u=7,f=o+r*.12,g=o+r*.88,m=a*.16;for(let y=0;y<l;y++){const C=y/Math.max(1,l-1),x=n+s*.3+C*s*.4;t.beginPath();for(let P=0;P<=u;P++){const T=P/u,N=f+(g-f)*T,R=Math.sin(T*Math.PI*2+y*.6)*m*(.75-C*.2),L=x+R;P===0?t.moveTo(N,L):t.lineTo(N,L)}t.stroke()}const b=ee(d,[12,52,94],.4,.2);t.strokeStyle=b,t.lineWidth=Math.max(.8,a*.03);const A=3;for(let y=0;y<A;y++){const C=y/Math.max(1,A-1),x=n+s*.35+C*s*.35;t.beginPath();for(let P=0;P<=u;P++){const T=P/u,N=f+(g-f)*T,R=Math.sin(T*Math.PI*2+y)*m*.35,L=x+R;P===0?t.moveTo(N,L):t.lineTo(N,L)}t.stroke()}t.restore()}function Lt(e){const{ctx:t,x:o,y:n,width:r,height:s,radius:a,baseColor:i}=e,d=Ne(i);t.save(),t.lineCap="round";const c=ee(d,[255,255,255],.42,.18);t.strokeStyle=c,t.lineWidth=Math.max(.85,a*.03);const l=a*.55;for(let g=-1;g<=2;g++){const m=l*g;t.beginPath(),t.moveTo(o+m,n+s*.25),t.lineTo(o+m+r*.75,n+s*.85),t.stroke()}const u=ee(d,[112,82,32],.3,.16);t.strokeStyle=u,t.lineWidth=Math.max(.7,a*.025),t.setLineDash([a*.24,a*.34]);const f=a*.48;for(let g=0;g<3;g++){const m=f*g;t.beginPath(),t.moveTo(o+r*.18+m,n+s*.78),t.lineTo(o+r*.7+m,n+s*.38),t.stroke()}t.setLineDash([]),t.restore()}const Zo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3ePlains%20Tile%3c/title%3e%3cdesc%20id='desc'%3eRolling%20plains%20with%20sunrise%20gradients%20and%20glowing%20grasses.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='plains-bg'%20cx='50%25'%20cy='50%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='plains-field'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='0%25'%3e%3cstop%20offset='0%25'%20stop-color='%23facc15'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23eab308'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='plains-haze'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f59e0b'%20stop-opacity='0.2'%20/%3e%3c/linearGradient%3e%3cfilter%20id='plains-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='5'%20stdDeviation='6'%20flood-color='%23facc15'%20flood-opacity='0.35'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23plains-bg)'%20/%3e%3cg%20filter='url(%23plains-glow)'%3e%3cpath%20d='M16%2088c20-18%2036-22%2048-22s28%204%2048%2022'%20fill='url(%23plains-field)'%20stroke='%23fef9c3'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M24%20102c16-14%2032-18%2040-18s24%204%2040%2018'%20fill='none'%20stroke='%23fde68a'%20stroke-width='5'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M32%2070c12-10%2024-14%2032-14s20%204%2032%2014'%20fill='url(%23plains-haze)'%20opacity='0.7'%20/%3e%3cpath%20d='M52%2078l4%2012m8-12l4%2012m8-12l4%2012'%20stroke='%23fef3c7'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='36'%20r='8'%20fill='%23fef08a'%20opacity='0.7'%20/%3e%3c/svg%3e",en="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eForest%20Tile%3c/title%3e%3cdesc%20id='desc'%3eStylised%20evergreen%20trees%20glowing%20against%20a%20deep%20night%20backdrop.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='forest-bg'%20cx='50%25'%20cy='40%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230b1120'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='forest-leaf'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%234ade80'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2315803d'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='forest-trunk'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23a855f7'%20/%3e%3cstop%20offset='100%25'%20stop-color='%237c3aed'%20/%3e%3c/linearGradient%3e%3cfilter%20id='forest-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%234ade80'%20flood-opacity='0.25'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23forest-bg)'%20/%3e%3cg%20filter='url(%23forest-glow)'%20stroke='%23bbf7d0'%20stroke-width='2'%3e%3cpath%20fill='url(%23forest-leaf)'%20d='M64%2026L32%2080h18l-12%2022h28l-10-22h16l-10%2022h28l-12-22h18z'%20/%3e%3crect%20x='58'%20y='74'%20width='12'%20height='18'%20rx='3'%20fill='url(%23forest-trunk)'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20stroke-opacity='0.5'%20d='M44%2086c6-4%2012-6%2020-6s14%202%2020%206'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='40'%20r='6'%20fill='%23fef3c7'%20opacity='0.6'%20/%3e%3ccircle%20cx='88'%20cy='32'%20r='4'%20fill='%23fef3c7'%20opacity='0.4'%20/%3e%3c/svg%3e",tn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eMountain%20Tile%3c/title%3e%3cdesc%20id='desc'%3eJagged%20alpine%20peaks%20with%20luminous%20snowcaps.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='mountain-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%23111827'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='mountain-rock'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2364748b'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23334155'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mountain-snow'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23cbd5f5'%20/%3e%3c/linearGradient%3e%3cfilter%20id='mountain-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%23f8fafc'%20flood-opacity='0.2'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23mountain-bg)'%20/%3e%3cg%20filter='url(%23mountain-glow)'%20stroke='%23cbd5f5'%20stroke-width='2'%20stroke-linejoin='round'%3e%3cpath%20fill='url(%23mountain-rock)'%20d='M24%20100l32-52%2014%2022%2012-18%2022%2048z'%20/%3e%3cpath%20fill='url(%23mountain-snow)'%20d='M56%2048l14%2022%2012-18%2010%2022H48z'%20opacity='0.85'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20opacity='0.6'%20d='M32%2094c10-6%2020-9%2032-9s22%203%2032%209'%20/%3e%3c/g%3e%3ccircle%20cx='92'%20cy='32'%20r='6'%20fill='%23f1f5f9'%20opacity='0.5'%20/%3e%3c/svg%3e",on="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eWater%20Tile%3c/title%3e%3cdesc%20id='desc'%3eGlowing%20waves%20surrounding%20a%20crystalline%20droplet.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='water-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230b1120'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='water-wave'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='water-drop'%20x1='50%25'%20y1='0%25'%20x2='50%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230284c7'%20/%3e%3c/linearGradient%3e%3cfilter%20id='water-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='8'%20flood-color='%2338bdf8'%20flood-opacity='0.3'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23water-bg)'%20/%3e%3cg%20filter='url(%23water-glow)'%3e%3cpath%20d='M32%2076c12-10%2024-15%2032-15s20%205%2032%2015'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3cpath%20d='M28%2092c14-12%2030-18%2040-18s26%206%2040%2018'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='6'%20stroke-linecap='round'%20opacity='0.7'%20/%3e%3cpath%20d='M40%2060c10-8%2018-12%2024-12s14%204%2024%2012'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M64%2030c-12%2020-18%2032-18%2042%200%2011%208%2020%2018%2020s18-9%2018-20c0-10-6-22-18-42z'%20fill='url(%23water-drop)'%20stroke='%23e0f2fe'%20stroke-width='2'%20/%3e%3c/g%3e%3ccircle%20cx='94'%20cy='34'%20r='6'%20fill='%23f8fafc'%20opacity='0.45'%20/%3e%3c/svg%3e",it={[q.Plains]:{baseColor:"#d8b869",icon:Zo},[q.Forest]:{baseColor:"#237a55",icon:en},[q.Hills]:{baseColor:"#b57c57",icon:tn},[q.Lake]:{baseColor:"#3185d5",icon:on}},ct=new Map;let te=null;function nn(){if(te)return te;const e="/";if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e))return te=e,te;const o=e.startsWith("/")?e:`/${e}`;return typeof window<"u"&&typeof window.location?.origin=="string"?te=`${window.location.origin}${o}`:te=`http://localhost${o}`,te}function rn(e){let t=ct.get(e);if(!t){t=new Image,t.decoding="async";const o=new URL(e,nn()).href;t.src=o,ct.set(e,t)}if(t.complete&&t.naturalWidth>0&&t.naturalHeight>0)return t}const lt="rgba(56, 189, 248, 0.85)",dt="rgba(56, 189, 248, 0.45)";let le=null,de=null;const sn={[q.Plains]:Lt,[q.Forest]:Vo,[q.Hills]:Qo,[q.Lake]:Jo};function an(){if(le&&de)return{stroke:le,glow:de};if(typeof window<"u"){const e=getComputedStyle(document.documentElement),t=e.getPropertyValue("--tile-highlight-ring").trim(),o=e.getPropertyValue("--tile-highlight-glow").trim();le=t||lt,de=o||dt}else le=lt,de=dt;return{stroke:le,glow:de}}function cn(e){const t=e.replace("#",""),o=Number.parseInt(t,16),n=o>>16&255,r=o>>8&255,s=o&255;return[n,r,s]}function ut([e,t,o],[n,r,s],a){const i=Math.min(1,Math.max(0,a)),d=(c,l)=>Math.round(c+(l-c)*i);return`rgb(${d(e,n)}, ${d(t,r)}, ${d(o,s)})`}function ft([e,t,o],n){return`rgba(${e}, ${t}, ${o}, ${n})`}class ln{constructor(t){this.mapRef=t}get hexSize(){return this.mapRef.hexSize}getOrigin(){return V({q:this.mapRef.minQ,r:this.mapRef.minR},this.hexSize)}draw(t,o,n){const{width:r,height:s}=xt(this.hexSize),a=this.getOrigin();for(const[i,d]of this.mapRef.tiles){const[c,l]=i.split(",").map(Number),{x:u,y:f}=V({q:c,r:l},this.hexSize),g=u-a.x,m=f-a.y;if(t.save(),d.isFogged&&(t.globalAlpha=.4),this.drawTerrain(t,d.terrain,g,m,r,s),d.building){const A=o[`building-${d.building}`]??o.placeholder;t.drawImage(A,g,m,r,s)}const b=n&&c===n.q&&l===n.r;this.strokeHex(t,g+this.hexSize,m+this.hexSize,this.hexSize,!!b),t.restore()}}drawToCanvas(t,o,n){const r=t.getContext("2d");if(!r)throw new Error("Canvas 2D context not available");this.draw(r,o,n)}drawTerrain(t,o,n,r,s,a){const i=it[o]??it[q.Plains],d=cn(i.baseColor),c=this.hexSize,l=n+c,u=r+c;t.save(),this.hexPath(t,n+this.hexSize,r+this.hexSize,c),t.clip();const f=t.createRadialGradient(l,u,c*.2,l,u,c*1.05);f.addColorStop(0,ut(d,[255,255,255],.3)),f.addColorStop(.7,i.baseColor),f.addColorStop(1,ut(d,[12,18,28],.4)),t.fillStyle=f,t.shadowColor=ft(d,.35),t.shadowBlur=c*.9,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillRect(n-c*.1,r-c*.1,s+c*.2,a+c*.2);const g={ctx:t,x:n,y:r,width:s,height:a,radius:c,centerX:l,centerY:u,baseColor:i.baseColor};(sn[o]??Lt)(g),t.globalCompositeOperation="lighter";const b=t.createRadialGradient(l,u,c*.85,l,u,c*1.18);b.addColorStop(0,"rgba(255, 255, 255, 0)"),b.addColorStop(1,ft(d,.18)),t.fillStyle=b,t.fillRect(n-c*.1,r-c*.1,s+c*.2,a+c*.2),t.globalCompositeOperation="source-over",t.restore();const A=rn(i.icon);if(A){const y=Math.min(s,a)*.62,C=l-y/2,x=u-y/2;t.save(),t.globalAlpha*=.92,t.drawImage(A,C,x,y,y),t.restore()}}strokeHex(t,o,n,r,s=!1){const{stroke:a,glow:i}=an();this.hexPath(t,o,n,r),t.save(),t.lineJoin="round",t.lineCap="round",s?(t.shadowColor=i,t.shadowBlur=r*.65,t.lineWidth=Math.max(2,r*.08),t.strokeStyle=a,t.stroke()):(t.lineWidth=Math.max(1,r*.05),t.strokeStyle="rgba(12, 18, 28, 0.55)",t.stroke()),t.restore()}hexPath(t,o,n,r){t.beginPath();for(let s=0;s<6;s++){const a=Math.PI/180*(60*s-30),i=o+r*Math.cos(a),d=n+r*Math.sin(a);s===0?t.moveTo(i,d):t.lineTo(i,d)}t.closePath()}}const Q={accent:"#38bdf8",accentSoft:"rgba(56, 189, 248, 0.2)",warm:"#fbbf24",surface:"rgba(15, 23, 42, 0.92)",border:"rgba(148, 163, 184, 0.34)",text:"#e2e8f0"};let J=null;function re(e,t){const o=e.trim();return o.length>0?o:t}function dn(){if(J)return J;if(typeof window>"u"||typeof document>"u")return J=Q,J;try{const e=getComputedStyle(document.documentElement);return J={accent:re(e.getPropertyValue("--color-accent"),Q.accent),accentSoft:re(e.getPropertyValue("--color-accent-soft"),Q.accentSoft),warm:re(e.getPropertyValue("--color-warning"),Q.warm),surface:re(e.getPropertyValue("--color-surface-strong"),Q.surface),border:re(e.getPropertyValue("--hud-border-strong"),Q.border),text:re(e.getPropertyValue("--color-foreground"),Q.text)},J}catch(e){return console.warn("Failed to read sauna palette tokens from computed styles",e),J=Q,J}}function un(e,t){const o=Math.max(0,e.auraRadius),n=V(e.pos,t),r=n.x+t,s=n.y+t;let a=t;if(o<=0)return t*1.6;for(const i of St){const d=V({q:e.pos.q+i.q*o,r:e.pos.r+i.r*o},t),c=d.x+t,l=d.y+t,u=Math.hypot(c-r,l-s);u>a&&(a=u)}return a+t*.65}function fn(e,t,o,n,r,s){const a=Math.max(0,Math.min(s,Math.min(n,r)/2));e.moveTo(t+a,o),e.lineTo(t+n-a,o),e.quadraticCurveTo(t+n,o,t+n,o+a),e.lineTo(t+n,o+r-a),e.quadraticCurveTo(t+n,o+r,t+n-a,o+r),e.lineTo(t+a,o+r),e.quadraticCurveTo(t,o+r,t,o+r-a),e.lineTo(t,o+a),e.quadraticCurveTo(t,o,t+a,o),e.closePath()}function hn(e,t,{origin:o,hexSize:n,timestamp:r}){if(!t)return;const s=dn(),a=Number.isFinite(r)?r:typeof performance<"u"?performance.now():Date.now(),i=.5+.5*Math.sin(a*.0035),d=V(t.pos,n),c=d.x-o.x+n,l=d.y-o.y+n,u=un(t,n);e.save(),e.globalCompositeOperation="screen";const f=u+n*(.4+i*.3),g=Math.max(n*.6,u*.58),m=e.createRadialGradient(c,l,g,c,l,f);m.addColorStop(0,s.accentSoft),m.addColorStop(.55,`rgba(56, 189, 248, ${.18+i*.12})`),m.addColorStop(1,"rgba(2, 6, 23, 0)"),e.fillStyle=m,e.beginPath(),e.arc(c,l,f,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.globalCompositeOperation="lighter",e.lineWidth=Math.max(n*.28,6),e.strokeStyle=`rgba(56, 189, 248, ${(.35+i*.2).toFixed(3)})`,e.shadowColor=`rgba(56, 189, 248, ${.45+i*.1})`,e.shadowBlur=n*(.9+i*.45),e.beginPath(),e.arc(c,l,u+n*.12,0,Math.PI*2),e.stroke(),e.restore();const b=n*.9;e.save(),e.beginPath(),e.arc(c,l,b,0,Math.PI*2),e.fillStyle=s.surface,e.globalAlpha*=.96,e.fill(),e.lineWidth=Math.max(1.5,n*.06),e.strokeStyle=s.border,e.shadowColor="rgba(8, 25, 53, 0.6)",e.shadowBlur=n*.45,e.stroke(),e.restore();const A=b*.78,y=Math.max(n*.22,5);e.save(),e.lineWidth=y,e.strokeStyle="rgba(148, 163, 184, 0.24)",e.beginPath(),e.arc(c,l,A,0,Math.PI*2),e.stroke(),e.restore();const C=t.spawnCooldown>0?t.spawnCooldown:1,P=1-Math.min(1,Math.max(0,t.timer/C)),T=-Math.PI/2,N=T+Math.PI*2*P;if(P>0){e.save(),e.lineWidth=y,e.lineCap="round";const Le=e.createLinearGradient(c,l-A,c,l+A);Le.addColorStop(0,s.accent),Le.addColorStop(1,s.warm),e.strokeStyle=Le,e.shadowColor=`rgba(56, 189, 248, ${.42+i*.18})`,e.shadowBlur=n*(.65+i*.35),e.beginPath(),e.arc(c,l,A,T,N,!1),e.stroke(),e.restore()}const R=Math.max(0,t.timer),L=Math.ceil(R);e.save(),e.font=`600 ${Math.max(12,n*.9)}px "Inter", "Manrope", "Segoe UI", sans-serif`,e.fillStyle=s.text,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(2, 6, 23, 0.6)",e.shadowBlur=n*.35,e.fillText(String(L),c,l),e.restore(),e.save(),e.font=`500 ${Math.max(10,n*.36)}px "Inter", "Manrope", "Segoe UI", sans-serif`,e.fillStyle="rgba(148, 163, 184, 0.78)",e.textAlign="center",e.textBaseline="top",e.fillText("sec",c,l+A*.45),e.restore();const $="Sauna ♨️",h=Math.max(12,n*.58);e.save(),e.font=`600 ${h}px "Inter", "Manrope", "Segoe UI", sans-serif`;const p=e.measureText($),w=n*.58,S=n*.32,U=p.width+w*2,_=h+S*2,W=c-U/2,K=l-u-_-n*.35,Kt=_/2;e.beginPath(),fn(e,W,K,U,_,Kt);const ge=e.createLinearGradient(W,K,W,K+_);ge.addColorStop(0,"rgba(15, 23, 42, 0.94)"),ge.addColorStop(.55,"rgba(15, 23, 42, 0.86)"),ge.addColorStop(1,"rgba(30, 41, 59, 0.9)"),e.fillStyle=ge,e.shadowColor="rgba(8, 25, 53, 0.6)",e.shadowBlur=n*.4,e.fill(),e.lineWidth=Math.max(1.5,n*.06);const Re=e.createLinearGradient(W,K,W+U,K);Re.addColorStop(0,`${s.accent}`),Re.addColorStop(1,`${s.warm}`),e.strokeStyle=Re,e.stroke(),e.fillStyle=s.text,e.shadowColor="rgba(8, 25, 53, 0.65)",e.shadowBlur=n*.3,e.textAlign="center",e.textBaseline="middle",e.fillText($,c,K+_/2+h*.05),e.restore()}function pn(e,t,o,n,r,s){const a=window.devicePixelRatio||1,i=e.canvas.width,d=e.canvas.height;e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i,d);const c=i/a,l=d/a;e.scale(a,a),e.translate(c/2,l/2),e.scale(E.zoom,E.zoom);const u=t.getOrigin();e.translate(-(E.x-u.x),-(E.y-u.y)),t.draw(e,o,r??void 0);const f=s?.saunojas;f&&Array.isArray(f.units)&&f.units.length>0&&f.draw(e,f.units,{originX:u.x,originY:u.y,hexRadius:t.hexSize}),mn(e,t,o,n,u),s?.sauna&&hn(e,s.sauna,{origin:u,hexSize:t.hexSize}),e.restore()}function mn(e,t,o,n,r){const{width:s,height:a}=xt(t.hexSize);for(const i of n){const{x:d,y:c}=V(i.coord,t.hexSize),l=d-r.x,u=c-r.y,f=o[`unit-${i.type}`]??o.placeholder,g=i.getMaxHealth();e.save(),i.stats.health/g<.5&&(e.filter="saturate(0)"),e.drawImage(f,l,u,s,a),zo()&&i.faction==="player"&&(e.strokeStyle="rgba(255,255,255,0.5)",e.lineWidth=2,e.strokeRect(l,u,s,a)),e.restore()}}function gn(){return`${"/".endsWith("/")?"/":"//"}${"assets/units/saunoja.svg".replace(/^\/+/,"")}`}const ht=gn();let ae=null,ue=null;function ze(e){return!!(e&&e.complete&&e.naturalWidth>0&&e.naturalHeight>0)}function bn(e,t){if(!t)return e;try{t(e)}catch(o){console.error("Saunoja icon onLoad callback failed",o)}return e}function Bt(e){const t=n=>e?n.then(r=>bn(r,e)):n;if(ze(ae))return t(Promise.resolve(ae));if(ue)return t(ue);if(typeof Image>"u")return Promise.reject(new Error("Image constructor is not available in this environment."));const o=new Image;return o.decoding="async",ae=o,ue=new Promise((n,r)=>{const s=()=>{o.onload=null,o.onerror=null},a=()=>{s(),n(o)};o.onload=a,o.onerror=i=>{s(),ae=null,ue=null;const d=new Error(`Failed to load saunoja icon from ${ht}`);console.warn(d.message,i),r(d)},o.src=ht,ze(o)&&a()}),t(ue)}function yn(e,t,{originX:o=0,originY:n=0,hexRadius:r=ce}={}){if(!e||!Array.isArray(t)||t.length===0)return;const s=ze(ae)?ae:null;if(!s)return;const a=Number.isFinite(r)&&r>0?r:ce,i=a*.98,d=[...t].sort((c,l)=>c.coord.r!==l.coord.r?c.coord.r-l.coord.r:c.coord.q!==l.coord.q?c.coord.q-l.coord.q:c.id.localeCompare(l.id));for(const c of d){const{x:l,y:u}=V(c.coord,a),f=l-o,g=u-n,m=f+a,b=g+a;e.save(),pe(e,m,b,i),e.clip();const A=a*2.15/Math.max(s.naturalWidth,s.naturalHeight||1),y=s.naturalWidth*A,C=s.naturalHeight*A,x=m-y/2,P=b-C*.72;e.save(),e.filter="grayscale(100%) contrast(112%)",e.globalAlpha*=.96,e.drawImage(s,x,P,y,C),e.restore(),e.save(),e.globalCompositeOperation="multiply";const T=e.createRadialGradient(m,b+i*.38,i*.2,m,b+i*.38,i*1.05);T.addColorStop(0,"rgba(15, 23, 42, 0.55)"),T.addColorStop(1,"rgba(15, 23, 42, 0)"),e.fillStyle=T,e.fillRect(m-i,b-i,i*2,i*2),e.restore(),e.save(),e.globalCompositeOperation="soft-light";const N=e.createLinearGradient(m,b-i,m,b+i);N.addColorStop(0,"rgba(255, 232, 210, 0.18)"),N.addColorStop(.52,"rgba(255, 183, 124, 0.32)"),N.addColorStop(1,"rgba(212, 97, 54, 0.5)"),e.fillStyle=N,e.fillRect(m-i,b-i,i*2,i*2),e.restore(),e.save(),e.globalCompositeOperation="screen",e.globalAlpha=.75;const R=e.createRadialGradient(m,b-i*.68,i*.1,m,b,i*1.12);R.addColorStop(0,"rgba(255, 255, 255, 0.85)"),R.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=R,e.fillRect(m-i,b-i,i*2,i*2),e.restore();const $=performance.now()-c.lastHitAt,h=120;if($<h){const S=1-$/h;Go(e,{centerX:m,centerY:b,radius:i,progress:S})}e.restore(),qo(e,{centerX:m,centerY:b-a*.18,radius:a*.94,intensity:c.steam});const p=a*.42,w=b+a*.34;_o(e,{centerX:m,centerY:w,hp:c.hp,maxHp:c.maxHp,radius:p})}}const $e="/",Z={saunaBeer:`${$e}assets/ui/sauna-beer.svg`,resource:`${$e}assets/ui/resource.svg`,sound:`${$e}assets/ui/sound.svg`},Ut=200,$t=3,_e=2e3,wn=1,vn=2,_t={[k.SAUNA_BEER]:"Sauna Beer",[k.SAUNAKUNNIA]:"Saunakunnia"};let Ae=null,G,ie=null,O=[];const Gt="autobattles:saunojas";function kn(e,t){const o=-e.q-e.r,n=-t.q-t.r;return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(o-n))}const Mn=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function qt(){try{return globalThis.localStorage??null}catch{return null}}function Sn(){const e=qt();if(!e)return[];try{const t=e.getItem(Gt);if(!t)return[];const o=JSON.parse(t);if(!Array.isArray(o))return[];const n=[];for(const r of o){if(!r||typeof r!="object")continue;const s=r,a=s.id;if(typeof a!="string"||a.length===0)continue;const i=s.coord,d=i&&typeof i=="object"&&typeof i.q=="number"&&Number.isFinite(i.q)&&typeof i.r=="number"&&Number.isFinite(i.r)?{q:i.q,r:i.r}:void 0;n.push(Nt({id:a,name:typeof s.name=="string"?s.name:void 0,coord:d,maxHp:typeof s.maxHp=="number"?s.maxHp:void 0,hp:typeof s.hp=="number"?s.hp:void 0,steam:typeof s.steam=="number"?s.steam:void 0,selected:!!s.selected}))}return n}catch(t){return console.warn("Failed to load Saunoja units from storage",t),[]}}function Oe(){const e=qt();if(e)try{const t=O.map(o=>({id:o.id,name:o.name,coord:{q:o.coord.q,r:o.coord.r},maxHp:o.maxHp,hp:o.hp,steam:o.steam,selected:o.selected}));e.setItem(Gt,JSON.stringify(t))}catch(t){console.warn("Failed to persist Saunoja units",t)}}function An(e,t){Ae=e,G=t,G.classList.add("sauna-roster"),G.setAttribute("role","status"),G.setAttribute("aria-live","polite"),G.setAttribute("title","Active sauna battalion on the field"),G.replaceChildren();const o=document.createElement("img");o.src=Z.saunaBeer,o.alt="Saunoja roster crest",o.decoding="async",o.classList.add("sauna-roster__icon");const n=document.createElement("span");n.classList.add("sauna-roster__text");const r=document.createElement("span");r.textContent="Saunoja Roster",r.classList.add("sauna-roster__label"),ie=document.createElement("span"),ie.textContent="0",ie.classList.add("sauna-roster__value"),n.append(r,ie),G.append(o,n),xe()}const Cn={images:{placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=","building-farm":Vt,"building-barracks":Qt,"building-city":Jt,"building-mine":Zt,"unit-soldier":eo,"unit-archer":to,"unit-avanto-marauder":oo,"icon-sauna-beer":Z.saunaBeer,"icon-resource":Z.resource,"icon-sound":Z.sound}};let Ce=null;function En(e){Ce=e}const Y=new yo(10,10,32),In=new Io(Y),Pn=new ln(Y);Y.forEachTile(e=>e.setFogged(!0));lo();const H=[];function Ht(e){return`${(e.constructor?.name??"Unit").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase()} ${e.id}`.trim()}function Dt(e){if(H.some(o=>o.id===e.id))return;H.push(e),Ae&&z();const t=e.faction==="player"?"Our":"A rival";me(`${t} ${Ht(e)} emerges from the steam.`),e.faction==="player"&&xe()}const Ft=({unit:e})=>{Dt(e)};v.on("unitSpawned",Ft);const X=new mo(1e3);X.load(Y);const Tn=2,Nn=new go(1e3,()=>{X.tick(),In.tick(H),X.save();for(const e of H)!e.isDead()&&e.faction==="player"&&Y.revealAround(e.coord,Tn);z()}),oe=Ho({q:Math.floor(Y.width/2),r:Math.floor(Y.height/2)});Y.revealAround(oe.pos,3);O=Sn();if(O.length===0)O.push(Nt({id:"saunoja-1",coord:oe.pos,selected:!0})),Oe();else{let e=!1,t=!1;for(const o of O)o.selected&&(e?(o.selected=!1,t=!0):e=!0);t&&Oe()}const xn=Do(oe),Rn=Fo(X,{saunakunnia:Z.resource,sisu:Z.resource,saunaBeer:Z.saunaBeer,sound:Z.sound}),{log:me,addEvent:ar}=Yo(X);let fe=0;v.on("sisuPulse",()=>Oo(X,H));v.on("sisuPulseStart",()=>Tt("sisu"));function Ln(e){if(e<=0)return;const t=oe.auraRadius,o=oe.pos,n=O.some(i=>kn(i.coord,o)<=t),r=H.some(i=>i.faction==="player"&&!i.isDead()&&i.distanceTo(o)<=t);if(!n&&!r){fe=0;return}if(fe+=e,fe<_e)return;const s=Math.floor(fe/_e);fe-=s*_e;const a=s*wn;a<=0||X.addResource(k.SAUNAKUNNIA,a)}X.addResource(k.SAUNA_BEER,Ut);me(`Quartermaster stocks ${Ut} bottles of ${_t[k.SAUNA_BEER]} to launch your campaign.`);X.addResource(k.SAUNAKUNNIA,$t);me(`Sauna elders honor your leadership with ${$t} ${_t[k.SAUNAKUNNIA]} to celebrate your arrival.`);let Ee=null;const Ge=O.find(e=>e.selected);Ge&&(Ee={q:Ge.coord.q,r:Ge.coord.r});function Bn(e,t){return!e||!t?e===t:e.q===t.q&&e.r===t.r}function qe(e){return Bn(Ee,e)?!1:(Ee=e?{q:e.q,r:e.r}:null,!0)}function He(e){let t=!1;for(const o of O)e&&o===e||o.selected&&(o.selected=!1,t=!0);return t}function zt(e){const t=ro(e.x-Y.hexSize,e.y-Y.hexSize,Y.hexSize),o=O.find(r=>r.coord.q===t.q&&r.coord.r===t.r);let n=!1;if(!o)He()&&(n=!0),qe(null)&&(n=!0);else{const r=!o.selected;o.selected!==r&&(o.selected=r,n=!0),r?(He(o)&&(n=!0),qe(o.coord)&&(n=!0)):(He()&&(n=!0),qe(null)&&(n=!0))}n&&(Oe(),z())}function z(){if(!Ae)return;const e=Ae.getContext("2d");!e||!Ce||pn(e,Pn,Ce.images,H,Ee,{saunojas:{units:O,draw:yn},sauna:oe})}const Ot=({policy:e})=>{me(`Sauna council toasts a fresh keg for policy: ${e}.`)};v.on("policyApplied",Ot);const Yt=({unitId:e,attackerFaction:t,unitFaction:o})=>{const n=H.findIndex(i=>i.id===e),r=n!==-1?H[n]:null;n!==-1&&(H.splice(n,1),z()),o==="player"&&xe(),t==="player"&&o&&o!=="player"&&X.addResource(k.SAUNAKUNNIA,vn);const s=o==="player"?"our":"a rival",a=r?Ht(r):`unit ${e}`;me(`The steam hushes as ${s} ${a} grows still.`)};v.on("unitDied",Yt);function Ye(){v.off("policyApplied",Ot),v.off("unitDied",Yt),v.off("unitSpawned",Ft)}async function Un(){if(!Ce){console.error("Cannot start game without loaded assets.");return}xe(),z();try{await Bt(()=>{z()}).then(()=>{z()})}catch(o){console.warn("Failed to preload Saunoja icon before starting the game",o)}let e=performance.now();function t(o){const n=o-e;e=o,Nn.tick(n),oe.update(n/1e3,H,r=>{Dt(r)}),xn(),Rn(n),Ln(n),z(),requestAnimationFrame(t)}requestAnimationFrame(t)}function $n(){const e=new Set;for(const t of H)t.faction==="player"&&!t.isDead()&&e.add(t.id);for(const t of O)t.hp>0&&e.add(t.id);return e.size}function xe(){const e=Math.max(0,Math.floor($n())),t=Mn.format(e);ie?ie.textContent=t:G&&(G.textContent=`Saunoja roster: ${t}`),G&&(G.setAttribute("aria-label",`Saunoja roster: ${t} active attendants`),G.setAttribute("title",`Saunoja roster • ${t} active attendants`))}async function _n(e){const t=Object.entries(e),o=await Promise.allSettled(t.map(([a,i])=>i.load().then(d=>({key:a,descriptor:i,value:d})))),n={},r=[],s=[];return o.forEach((a,i)=>{const[d,c]=t[i],l=c.label??String(d);if(a.status==="fulfilled"){const{value:f}=a.value;if(n[d]=f.value,f.warnings?.length)for(const g of f.warnings)r.push(l?`${l}: ${g}`:g);if(f.errors?.length)for(const g of f.errors)s.push(l?`${l}: ${g}`:g);return}const u=Gn(a.reason);s.push(l?`${l}: ${u}`:u)}),{resources:n,warnings:r,errors:s}}function Gn(e){if(e instanceof Error)return e.message;if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return String(e)}}const qn=.5,Hn=3.5,Dn=.0015,Fn=10,zn=250;function On(){if(typeof document>"u")return;const e=document.querySelector("[data-build-commit]");if(!e)return;const t="32d6464".trim(),o=t.length>0&&t!=="unknown",n=o?`#${t}`:"DEV BUILD";e.textContent=n,e.dataset.state=o?"commit":"dev";const r=e.closest("#build-id");if(r){const s=o?`Build commit ${t}`:"Development build";r.setAttribute("aria-label",s),r.title=o?`Autobattles build ${t}`:"Unversioned development build",r.dataset.buildState=o?"release":"development"}}On();const je=[];let Ie=0,I=null,Xe=!1,M=null;const B={active:!1,pointerId:null,lastX:0,lastY:0};function Yn(e){return Math.min(Hn,Math.max(qn,e))}function F(e){je.push(e)}function ne(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function jn(e){const t=window.devicePixelRatio||1,o=Math.max(window.innerWidth,1),n=Math.max(window.innerHeight,1);e.style.width=`${o}px`,e.style.height=`${n}px`,e.width=Math.round(o*t),e.height=Math.round(n*t);const r=e.getContext("2d");r&&r.setTransform(1,0,0,1,0,0),z()}function We(e,t,o,n,r){const s=e.getBoundingClientRect(),a=t-s.left,i=o-s.top,d=s.width/2,c=s.height/2;return{x:r.x+(a-d)/n,y:r.y+(i-c)/n}}function jt(e,t,o,n=E.zoom,r=E){return We(e,t,o,n,r)}function Xt(e,t,o,n){const r=Yn(n);if(r===E.zoom)return;const s={x:E.x,y:E.y},a=We(e,t,o,E.zoom,s),i=We(e,t,o,r,s);E.x+=a.x-i.x,E.y+=a.y-i.y,E.zoom=r,z()}function Je(e,t){e===0&&t===0||(E.x-=e/E.zoom,E.y-=t/E.zoom,z())}function pt(e){if(!I)return;e.preventDefault();const t=Math.exp(-e.deltaY*Dn),o=E.zoom*t;Xt(I,e.clientX,e.clientY,o)}function mt(e){I&&(e.pointerType!=="mouse"||e.button!==0||(B.active=!0,B.pointerId=e.pointerId,B.lastX=e.clientX,B.lastY=e.clientY,I.setPointerCapture?.(e.pointerId),I.style.cursor="grabbing"))}function gt(e){if(!I||!B.active||B.pointerId!==e.pointerId)return;const t=e.clientX-B.lastX,o=e.clientY-B.lastY;B.lastX=e.clientX,B.lastY=e.clientY,Je(t,o)}function se(e){I&&(!B.active||B.pointerId!==e.pointerId||(B.active=!1,B.pointerId=null,I.releasePointerCapture?.(e.pointerId),I.style.cursor=""))}function Xn(e){return!I||e.mode!=="pan"||e.startX==null||e.startY==null||e.moved&&Math.hypot((e.lastX??e.startX)-e.startX,(e.lastY??e.startY)-e.startY)>Fn?!1:ne()-e.startTime<=zn}function Wn(e){if(!I||e.startX==null||e.startY==null)return;const t=jt(I,e.startX,e.startY);zt(t)}function Kn(e){if(!M)return;const t=e.clientX-(M.lastX??e.clientX),o=e.clientY-(M.lastY??e.clientY);Math.hypot(t,o)>1&&(M.moved=!0),M.lastX=e.clientX,M.lastY=e.clientY,Je(t,o)}function Vn(e,t){if(!I)return;const o=(e.clientX+t.clientX)/2,n=(e.clientY+t.clientY)/2,r=Math.hypot(e.clientX-t.clientX,e.clientY-t.clientY);if(M?.lastDistance){const s=r/M.lastDistance,a=E.zoom*s;Xt(I,o,n,a)}if(M?.lastCenter){const s=o-M.lastCenter.x,a=n-M.lastCenter.y;Je(s,a)}M?(M.mode="pinch",M.lastCenter={x:o,y:n},M.lastDistance=r,M.moved=!0):M={mode:"pinch",lastCenter:{x:o,y:n},lastDistance:r,startTime:ne(),moved:!0}}function bt(e){if(I){if(e.touches.length===1){const t=e.touches[0];M={mode:"pan",lastX:t.clientX,lastY:t.clientY,startX:t.clientX,startY:t.clientY,startTime:ne(),moved:!1}}else if(e.touches.length>=2){const[t,o]=[e.touches[0],e.touches[1]];M={mode:"pinch",lastCenter:{x:(t.clientX+o.clientX)/2,y:(t.clientY+o.clientY)/2},lastDistance:Math.hypot(t.clientX-o.clientX,t.clientY-o.clientY),startTime:ne(),moved:!1}}}}function yt(e){if(!(!I||!M)&&e.touches.length!==0)if(e.preventDefault(),e.touches.length===1){const t=e.touches[0];if(M.mode!=="pan"){const o=M.mode==="pinch";M={mode:"pan",lastX:t.clientX,lastY:t.clientY,startX:t.clientX,startY:t.clientY,startTime:ne(),moved:o}}Kn(t)}else{const[t,o]=[e.touches[0],e.touches[1]];Vn(t,o)}}function we(e){if(!(!I||!M)){if(e.touches.length===0){Xn(M)&&Wn(M),M=null;return}if(e.touches.length===1){const t=e.touches[0],o=M.mode==="pinch";M={mode:"pan",lastX:t.clientX,lastY:t.clientY,startX:t.clientX,startY:t.clientY,startTime:ne(),moved:o}}else if(e.touches.length>=2){const[t,o]=[e.touches[0],e.touches[1]];M={mode:"pinch",lastCenter:{x:(t.clientX+o.clientX)/2,y:(t.clientY+o.clientY)/2},lastDistance:Math.hypot(t.clientX-o.clientX,t.clientY-o.clientY),startTime:ne(),moved:!0}}}}function wt(e){if(!I)return;const t=jt(I,e.clientX,e.clientY);zt(t)}function Qn(e){e.addEventListener("click",wt),F(()=>e.removeEventListener("click",wt)),e.addEventListener("wheel",pt,{passive:!1}),F(()=>e.removeEventListener("wheel",pt)),e.addEventListener("pointerdown",mt),e.addEventListener("pointermove",gt),e.addEventListener("pointerup",se),e.addEventListener("pointercancel",se),e.addEventListener("pointerleave",se),F(()=>{e.removeEventListener("pointerdown",mt),e.removeEventListener("pointermove",gt),e.removeEventListener("pointerup",se),e.removeEventListener("pointercancel",se),e.removeEventListener("pointerleave",se)}),e.addEventListener("touchstart",bt,{passive:!1}),e.addEventListener("touchmove",yt,{passive:!1}),e.addEventListener("touchend",we),e.addEventListener("touchcancel",we),F(()=>{e.removeEventListener("touchstart",bt),e.removeEventListener("touchmove",yt),e.removeEventListener("touchend",we),e.removeEventListener("touchcancel",we)})}function Jn(){for(;je.length;){const e=je.pop();try{e?.()}catch(t){console.error("Error during cleanup",t)}}}function Zn(){Ie+=1,Jn(),B.active=!1,B.pointerId=null,I&&(I.style.cursor=""),M=null,I=null,Xe=!1,er(),Ye()}function er(){document.querySelectorAll(".hud-loader").forEach(e=>{e.remove()}),document.querySelectorAll(".hud-banner-stack").forEach(e=>{e.remove()})}function tr(e="Heating the sauna stones…"){const t=document.getElementById("ui-overlay");if(!t)return{update:()=>{},clear:()=>{},dispose:()=>{}};const o=document.createElement("div");o.className="hud-loader",o.setAttribute("role","status"),o.setAttribute("aria-live","polite");const n=document.createElement("div");n.className="hud-loader__card";const r=document.createElement("div");r.className="hud-loader__spinner",r.setAttribute("aria-hidden","true");const s=document.createElement("p");s.className="hud-loader__message",s.textContent=e,n.append(r,s),o.append(n),t.append(o);let a=!1;return{update(i){s.textContent=i},clear(){a||Wt(o,"hud-loader--hidden",()=>{a=!0,o.remove()})},dispose(){a||(a=!0,o.remove())}}}function ve(e,t){const o=or();if(!o)return null;const n=document.createElement("section");n.className=`hud-banner hud-banner--${e}`,n.setAttribute("role",e==="error"?"alert":"status"),n.setAttribute("aria-live",e==="error"?"assertive":"polite");const r=document.createElement("header");r.className="hud-banner__header";const s=document.createElement("p");s.className="hud-banner__title",s.textContent=t.title??(e==="error"?"Attention required":e==="warning"?"Heads up":"Status update"),r.append(s);const a=document.createElement("ul");a.className="hud-banner__list";for(const l of t.messages){const u=document.createElement("li");u.textContent=l,a.append(u)}if(n.append(r),t.messages.length&&n.append(a),t.actions?.length){const l=document.createElement("div");l.className="hud-banner__actions";for(const u of t.actions){const f=document.createElement("button");f.type="button",f.className=u.variant==="secondary"?"hud-banner__button hud-banner__button--secondary":"hud-banner__button",f.textContent=u.label,f.addEventListener("click",()=>{u.onClick()}),l.append(f)}n.append(l)}let i,d=!1;const c=()=>{d||(d=!0,i&&window.clearTimeout(i),Wt(n,"hud-banner--hide",()=>{n.remove(),o.hasChildNodes()||o.remove()}))};if(t.dismissible!==!1){const l=document.createElement("button");l.type="button",l.className="hud-banner__close",l.setAttribute("aria-label","Dismiss notification"),l.textContent="×",l.addEventListener("click",()=>{c()}),r.append(l)}return o.append(n),t.autoCloseMs&&t.autoCloseMs>0&&(i=window.setTimeout(()=>c(),t.autoCloseMs)),{element:n,dismiss:c}}function or(){const e=document.getElementById("ui-overlay");if(!e)return null;let t=e.querySelector(".hud-banner-stack");return t||(t=document.createElement("div"),t.className="hud-banner-stack",e.append(t)),t}function Wt(e,t,o){let n=!1;const r=()=>{n||(n=!0,e.removeEventListener("transitionend",r),o())};e.addEventListener("transitionend",r),requestAnimationFrame(()=>{e.classList.add(t)}),window.setTimeout(r,400)}function vt(e){if(e instanceof Error&&e.message)return e.message;if(typeof e=="string"&&e.trim().length>0)return e;try{return JSON.stringify(e)}catch{return String(e)}}async function nr(e){const t=tr("Heating the sauna stones…");F(()=>t.dispose());try{const{resources:o,warnings:n,errors:r}=await _n({assets:{label:"Core assets",load:async()=>{const a=await uo(Cn);return{value:a.assets,errors:a.failures}}},saunojaIcon:{label:"Saunoja icon",load:async()=>{try{return{value:await Bt()}}catch(a){return{value:null,warnings:[`Unable to preload Saunoja icon (${vt(a)})`]}}}}});if(e!==Ie){t.dispose();return}t.update("Polishing sauna ambience…"),t.clear();const s=o.assets;if(!s){const a=r.length?[...r]:["Critical assets were unavailable. Please refresh to try again."];console.error("Critical assets failed to load",a);const i=ve("error",{title:"Unable to start the sauna battle",messages:a,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}],dismissible:!1});i&&F(()=>i.dismiss());return}if(r.length){console.error("Resource loader errors",r);const a=ve("error",{title:"Some resources failed to load",messages:r,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]});a&&F(()=>a.dismiss())}if(n.length){console.warn("Resource loader warnings",n);const a=ve("warning",{title:"Heads up",messages:n,autoCloseMs:12e3});a&&F(()=>a.dismiss())}En(s),Un()}catch(o){if(e!==Ie){t.dispose();return}console.error("Failed to initialize resources",o),t.clear();const n=ve("error",{title:"Failed to initialize",messages:[vt(o)],actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]});n&&F(()=>n.dismiss())}}function rr(){const e=document.getElementById("game-canvas"),t=document.getElementById("resource-bar");if(!e||!t){console.error("Autobattles4xFinsauna shell is missing the required canvas or resource bar elements.",{hasCanvas:!!e,hasResourceBar:!!t});return}Xe&&Zn();const o=++Ie;I=e,Xe=!0,An(e,t),Qn(e);const n=()=>jn(e);window.addEventListener("resize",n),F(()=>window.removeEventListener("resize",n)),window.addEventListener("beforeunload",Ye),F(()=>window.removeEventListener("beforeunload",Ye)),n(),import.meta.vitest||nr(o)}function sr(){if(typeof document>"u")return;const e=()=>{document.removeEventListener("DOMContentLoaded",e),rr()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",e);return}e()}import.meta.vitest||sr();export{k as R,Co as U,v as e,Tt as p};
