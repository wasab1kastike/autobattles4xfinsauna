(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function s(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(l){if(l.ep)return;l.ep=!0;const u=s(l);fetch(l.href,u)}})();class VS{listeners=new Map;on(a,s){const r=this.listeners.get(a)??[];r.push(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);if(!r)return;const l=r.indexOf(s);l!==-1&&(r.splice(l,1),r.length===0?this.listeners.delete(a):this.listeners.set(a,r))}emit(a,s){const r=this.listeners.get(a);if(r)for(const l of r)l(s)}}const ne=new VS;class Lh{type="farm";cost=50;beerPerTick=1}class O2{type="barracks";cost=100;trainingCapacity=1}const q2=Math.sqrt(3),z2=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function aa(n,a){return{x:a*q2*(n.q+n.r/2),y:a*(3/2)*n.r}}function Mo(n,a,s){const r=(q2/3*n-.3333333333333333*a)/s,l=2/3*a/s;return{q:r,r:l}}function XS(n,a,s){return KS(Mo(n,a,s))}function Oc(n){return z2.map(a=>({q:n.q+a.q,r:n.r+a.r}))}function Zs(n,a){const s=-n.q-n.r,r=-a.q-a.r;return Math.max(Math.abs(n.q-a.q),Math.abs(n.r-a.r),Math.abs(s-r))}function KS(n){let a=n.q,s=n.r,r=-a-s,l=Math.round(a),u=Math.round(r),f=Math.round(s);const h=Math.abs(l-a),p=Math.abs(u-r),m=Math.abs(f-s);return h>p&&h>m?l=-u-f:p>m?u=-l-f:f=-l-u,{q:l,r:f}}const qc=new Set;let _c=32;function QS(n){return`${n.q},${n.r}`}function sh(n,a){_c=a,qc.add(QS(n))}function PS(n){if(qc.size===0)return{center:{x:0,y:0},zoom:1};const a=_c*Math.sqrt(3),s=_c*2,r=a/2,l=s/2;let u=1/0,f=1/0,h=-1/0,p=-1/0;for(const I of qc){const[$,P]=I.split(",").map(Number),{x:ie,y:se}=aa({q:$,r:P},_c),oe=ie-r,ee=se-l;u=Math.min(u,oe),f=Math.min(f,ee),h=Math.max(h,oe+a),p=Math.max(p,ee+s)}const m=h-u,g=p-f,b=96,S={x:u+m/2,y:f+g/2},E=Math.max(0,Math.min(n.safeRight??0,n.width)),N=Math.max(n.width-E,1)/(m+b*2),_=n.height/(g+b*2),U=Math.min(N,_);return{center:{x:U>0?S.x-E/(2*U):S.x,y:S.y},zoom:U}}const xe={x:0,y:0,zoom:1};function ZS(n,a=300){const s=xe.x,r=xe.y,l=xe.zoom,u=typeof performance<"u"?performance.now():Date.now(),f=h=>{const p=Math.min((h-u)/a,1);xe.x=s+(n.center.x-s)*p,xe.y=r+(n.center.y-r)*p,xe.zoom=l+(n.zoom-l)*p,p<1&&(typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),16))};typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),0)}function JS(){qc.clear()}async function WS(n){const a={},s={},r=[],l=Object.entries(n.images??{}).map(([f,h])=>new Promise(p=>{const m=new Image;m.onload=()=>{a[f]=m,p()},m.onerror=()=>{const g=`Failed to load image: ${h}`;console.error(g),r.push(g),p()},m.src=h})),u=Object.entries(n.sounds??{}).map(([f,h])=>new Promise(p=>{const m=new Audio;m.oncanplaythrough=()=>{s[f]=m,p()},m.onerror=()=>{const g=`Failed to load sound: ${h}`;console.error(g),r.push(g),p()},m.src=h,m.load()}));return await Promise.all([...l,...u]),{assets:{images:a,sounds:s},failures:r}}function Uh(n){if(typeof globalThis.localStorage>"u")return;const a=globalThis.localStorage.getItem(n);if(a)try{return JSON.parse(a)}catch(s){console.warn(`Failed to parse data for "${n}", clearing`,s),globalThis.localStorage.removeItem(n);return}}var ae=(n=>(n.SAUNA_BEER="sauna-beer",n.SAUNAKUNNIA="saunakunnia",n.SISU="sisu",n))(ae||{});const sc={"sauna-beer":1,saunakunnia:0,sisu:0},B2="/assets/sauna-beer-CgafwOhX.svg",H2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eResource%20Icon%3c/title%3e%3cdesc%20id='desc'%3eA%20luminous%20crest%20symbolising%20generic%20resources.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='resource-bg'%20cx='50%25'%20cy='50%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='resource-core'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2338bdf8'%20/%3e%3c/linearGradient%3e%3cfilter%20id='resource-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='6'%20flood-color='%2338bdf8'%20flood-opacity='0.45'%20/%3e%3c/filter%3e%3c/defs%3e%3cg%20filter='url(%23resource-glow)'%3e%3ccircle%20cx='32'%20cy='32'%20r='22'%20fill='%230f172a'%20stroke='url(%23resource-bg)'%20stroke-width='4'%20/%3e%3cpath%20d='M32%2016l-12%2014%2012%2022%2012-22z'%20fill='url(%23resource-core)'%20stroke='%23f8fafc'%20stroke-width='2'%20/%3e%3cpath%20d='M20%2030l-4%208%2016%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M44%2030l4%208-16%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/g%3e%3c/svg%3e",j2="/assets/saunoja-roster-Bfn4ZKxh.svg",Gt={APPLIED:"policy:applied",REJECTED:"policy:rejected"},I2=[{id:"eco",name:"Evergreen Eco Mandate",description:"Increase passive sauna beer brewing by one bottle each production tick.",cost:15,resource:ae.SAUNAKUNNIA,prerequisites:[],visuals:{icon:H2,gradient:"linear-gradient(135deg, rgba(66, 240, 155, 0.9), rgba(13, 114, 234, 0.85))",accentColor:"#34d399",badges:["Economy","Sustainability"],flair:"Green-lit by the council of whisked sauna masters."},effects:[{event:Gt.APPLIED,once:!0,invoke:({state:n})=>{n.modifyPassiveGeneration(ae.SAUNA_BEER,1)}}],spotlight:"Sustainably expand your brewing line with solar-heated mash tuns."},{id:"temperance",name:"Aurora Temperance Treaty",description:"Boost night shift work speed by 5% once the eco initiative is live.",cost:25,resource:ae.SAUNAKUNNIA,prerequisites:[{description:"Enact the Evergreen Eco Mandate.",isSatisfied:n=>n.hasPolicy("eco")},{description:"Stockpile at least 30 Sauna Beer bottles to brief the midnight crews.",isSatisfied:n=>n.getResource(ae.SAUNA_BEER)>=30}],visuals:{icon:j2,gradient:"linear-gradient(140deg, rgba(46, 51, 227, 0.9), rgba(118, 75, 162, 0.85))",accentColor:"#6366f1",badges:["Discipline","Night Ops"],flair:"Whispers of aurora spirits keep the crew laser-focused after dusk."},effects:[{event:Gt.APPLIED,once:!0,invoke:({state:n})=>{n.nightWorkSpeedMultiplier=Number((n.nightWorkSpeedMultiplier*1.05).toFixed(4))}}],spotlight:"Glow-lit helmets and synchronized chants keep the late shift on tempo."},{id:"steam-diplomats",name:"Steam Diplomats Accord",description:"Import two additional sauna beer bottles per tick via gilded trade routes.",cost:35,resource:ae.SAUNAKUNNIA,prerequisites:[{description:"Secure the Aurora Temperance Treaty for your envoys.",isSatisfied:n=>n.hasPolicy("temperance")},{description:"Hold a reserve of 50 Sauna Beer bottles to fund the embassy festivities.",isSatisfied:n=>n.getResource(ae.SAUNA_BEER)>=50}],visuals:{icon:B2,gradient:"linear-gradient(150deg, rgba(255, 173, 94, 0.92), rgba(255, 99, 71, 0.85))",accentColor:"#fb923c",badges:["Diplomacy","Logistics"],flair:"Silver samovars arrive with diplomatic steam-born delights."},effects:[{event:Gt.APPLIED,once:!0,invoke:({state:n})=>{n.modifyPassiveGeneration(ae.SAUNA_BEER,2)}}],spotlight:"Trade envoys pipe artisanal steam through every new supply line."}],G2=new Map;for(const n of I2)G2.set(n.id,n);function Y2(){return I2}function Vg(n){return G2.get(n)}const F2="progression:ngPlusState",zo=5,$2=1831565813,er=Object.freeze({aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1}),Rc=Object.freeze({runSeed:0,ngPlusLevel:0,unlockSlots:0,enemyTuning:er});function Sf(n,a,s,r){const l=Number(n);return Number.isFinite(l)?Math.min(s,Math.max(a,l)):r}function Oh(n){return{aggressionMultiplier:Sf(n?.aggressionMultiplier,.25,6,er.aggressionMultiplier),cadenceMultiplier:Sf(n?.cadenceMultiplier,.25,4,er.cadenceMultiplier),strengthMultiplier:Sf(n?.strengthMultiplier,.25,6,er.strengthMultiplier)}}function V2(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(n){return console.warn("Local storage unavailable for NG+ state",n),null}}function rh(n,a,s){const r=Number.isFinite(n)?n:Number(n);if(!Number.isFinite(r))return a;const l=Math.trunc(r);return Math.min(s,Math.max(a,l))}function X2(n){const a=Number.isFinite(n)?n:Number(n);return!Number.isFinite(a)||a===0?0:Math.trunc(Math.abs(a))}function K2(n=Math.random){let a=n();(!Number.isFinite(a)||a<=0||a>=1)&&(a=Math.random());const s=Math.floor(a*4294967295);return s===0?$2:s}function Fa(n={}){const a=Rc,s=X2(n.runSeed??a.runSeed),r=rh(n.ngPlusLevel??a.ngPlusLevel,0,Number.MAX_SAFE_INTEGER),l=rh(n.unlockSlots??a.unlockSlots,0,zo),u=Oh(n.enemyTuning??a.enemyTuning);return{runSeed:s,ngPlusLevel:r,unlockSlots:l,enemyTuning:u}}function Ha(n,a=Math.random){const s=Fa(n);return s.runSeed!==0?s:Fa({...s,runSeed:K2(a)})}function eE(n=Math.random){const a=V2();if(!a)return Ha(Rc,n);const s=a.getItem(F2);if(!s)return Ha(Rc,n);try{const r=JSON.parse(s);return Ha(Fa(r),n)}catch(r){return console.warn("Failed to parse NG+ state",r),Ha(Rc,n)}}function oh(n){const a=V2();if(!a)return;const s=Fa(n);a.setItem(F2,JSON.stringify(s))}function tE(n,a){const s=Fa(n),r=typeof a.random=="function"?a.random:Math.random;let l=s.ngPlusLevel,u=s.unlockSlots;if(a.outcome==="win"){l+=1;const h=Math.max(0,Math.trunc(a.bonusUnlocks??1));h>0&&(u=Math.min(zo,u+h))}const f=K2(r);return Ha(Fa({runSeed:f,ngPlusLevel:l,unlockSlots:u,enemyTuning:s.enemyTuning}),r)}function nE(n){const a=Math.max(0,n.ngPlusLevel),s=Math.max(0,n.unlockSlots)*.02;return Math.min(3,1+a*.12+s)}function aE(n){const a=Math.max(0,n.ngPlusLevel),s=Math.max(0,n.unlockSlots)*.01,r=.1+a*.05+s;return Math.max(0,Math.min(.85,r))}function iE(n){const a=Math.max(0,n.ngPlusLevel),s=Math.max(.5,1+a*.25),r=Oh(n.enemyTuning??er);return Math.max(.25,Math.min(8,s*r.aggressionMultiplier))}function sE(n){const s=1+rh(n.unlockSlots,0,zo);return Math.max(3,s)}function rE(n){return Oh(n.enemyTuning??er)}function Xg(n,a=0){let s=X2(n)^(a|0);return s===0&&(s=$2^(a|0)),()=>{s=s+1831565813|0;let r=Math.imul(s^s>>>15,1|s);return r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296}}function Ef(n){return`${n.q},${n.r}`}const Q2={farm:()=>new Lh,barracks:()=>new O2};function oE(n){return Q2[n]?.()}const Kg=Object.freeze({aggression:1,cadence:1,strength:1});function tr(n,a,s,r){const l=Number(n);return Number.isFinite(l)?Math.min(s,Math.max(a,l)):r}function Qg(n,a){return{aggression:tr(a.aggression??n.aggression,.1,8,n.aggression),cadence:tr(a.cadence??n.cadence,.25,6,n.cadence),strength:tr(a.strength??n.strength,.25,12,n.strength)}}class lE{constructor(a,s="gameState"){this.tickInterval=a,this.storageKey=s}resources={[ae.SAUNA_BEER]:0,[ae.SAUNAKUNNIA]:0,[ae.SISU]:0};passiveGeneration={...sc};lastSaved=Date.now();buildings={};buildingPlacements=new Map;policies=new Set;nightWorkSpeedMultiplier=1;enemyScaling={...Kg};enemyCalmSecondsRemaining=0;ngPlus=Fa();tick(){Object.keys(this.passiveGeneration).forEach(a=>{this.addResource(a,this.passiveGeneration[a])})}save(){this.lastSaved=Date.now();const a={};this.buildingPlacements.forEach((l,u)=>{a[u]=l.type});const s={resources:this.resources,lastSaved:this.lastSaved,buildings:this.buildings,buildingPlacements:a,policies:Array.from(this.policies),passiveGeneration:{...this.passiveGeneration},nightWorkSpeedMultiplier:this.nightWorkSpeedMultiplier,enemyScaling:{...this.enemyScaling},ngPlus:this.ngPlus},r=typeof localStorage<"u"&&localStorage?localStorage:void 0;if(!r){console.warn("GameState.save: localStorage is unavailable, skipping persistence.");return}try{r.setItem(this.storageKey,JSON.stringify(s))}catch(l){console.warn("GameState.save: Failed to persist state to localStorage.",l)}}load(a){const s=Uh(this.storageKey);if(!s)return this.lastSaved=Date.now(),!1;this.resources={...this.resources,...s.resources??{}},Object.keys(this.resources).forEach(p=>{Number.isFinite(this.resources[p])||(this.resources[p]=0)}),this.enemyScaling=Qg(Kg,s.enemyScaling??{}),this.enemyCalmSecondsRemaining=0;const r={};Object.entries(s.buildings??{}).forEach(([p,m])=>{Q2[p]&&(r[p]=m)}),this.buildings=r,this.buildingPlacements.clear(),s.buildingPlacements&&Object.entries(s.buildingPlacements).forEach(([p,m])=>{const g=oE(m);if(!g)return;this.buildingPlacements.set(p,g);const[b,S]=p.split(",").map(Number);if(a){const E=a.ensureTile(b,S);E.placeBuilding(g.type),E.reveal(),sh({q:b,r:S},a.hexSize)}ne.emit("buildingPlaced",{building:g,coord:{q:b,r:S},state:this})}),this.lastSaved=s.lastSaved??Date.now();const l=s.ngPlus?Fa(s.ngPlus):this.ngPlus;if(this.ngPlus=Ha(l),this.policies=new Set,this.passiveGeneration={...sc},this.nightWorkSpeedMultiplier=1,(Array.isArray(s.policies)?s.policies.filter(p=>typeof p=="string"):[]).forEach(p=>{const m=Vg(p);m&&(this.policies.add(m.id),ne.emit(Gt.APPLIED,{policy:m,state:this}))}),s.passiveGeneration){const p={...sc};Object.keys(sc).forEach(m=>{const g=s.passiveGeneration?.[m];typeof g=="number"&&Number.isFinite(g)&&(p[m]=g)}),this.passiveGeneration=p}typeof s.nightWorkSpeedMultiplier=="number"&&Number.isFinite(s.nightWorkSpeedMultiplier)&&(this.nightWorkSpeedMultiplier=s.nightWorkSpeedMultiplier);const f=Date.now()-this.lastSaved,h=Math.floor(f/this.tickInterval);return Object.keys(this.passiveGeneration).forEach(p=>{this.resources[p]+=h*this.passiveGeneration[p]}),!0}getResource(a){return this.resources[a]}canAfford(a,s=ae.SAUNA_BEER){return this.resources[s]>=a}spendResource(a,s=ae.SAUNA_BEER){return this.spend(a,s)}spend(a,s=ae.SAUNA_BEER){return this.canAfford(a,s)?(this.resources[s]-=a,ne.emit("resourceChanged",{resource:s,amount:-a,total:this.resources[s]}),!0):!1}addResource(a,s){this.resources[a]+=s,ne.emit("resourceChanged",{resource:a,amount:s,total:this.resources[a]})}modifyPassiveGeneration(a,s){this.passiveGeneration[a]=(this.passiveGeneration[a]??0)+s}setEnemyScalingBase(a){return this.enemyScaling=Qg(this.enemyScaling,a),{...this.enemyScaling}}applyEnemyScalingModifiers(a){const s={aggression:tr(this.enemyScaling.aggression*(a.aggression??1),.1,8,this.enemyScaling.aggression),cadence:tr(this.enemyScaling.cadence*(a.cadence??1),.25,6,this.enemyScaling.cadence),strength:tr(this.enemyScaling.strength*(a.strength??1),.25,12,this.enemyScaling.strength)};return this.enemyScaling=s,{...this.enemyScaling}}getEnemyScalingSnapshot(){return{...this.enemyScaling,calmSecondsRemaining:Math.max(0,this.enemyCalmSecondsRemaining)}}requestEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(this.enemyCalmSecondsRemaining,s),this.enemyCalmSecondsRemaining)}advanceEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(0,this.enemyCalmSecondsRemaining-s),this.enemyCalmSecondsRemaining)}clearEnemyCalm(){this.enemyCalmSecondsRemaining=0}construct(a,s,r=ae.SAUNA_BEER){return this.spend(s,r)?(this.buildings[a]=(this.buildings[a]??0)+1,!0):!1}placeBuilding(a,s,r,l=ae.SAUNA_BEER){const u=r.getTile(s.q,s.r);return!u||u.building||!this.construct(a.type,a.cost,l)?!1:(this.buildingPlacements.set(Ef(s),a),u.placeBuilding(a.type),ne.emit("buildingPlaced",{building:a,coord:s,state:this}),!0)}getBuildingAt(a){return this.buildingPlacements.get(Ef(a))}removeBuilding(a,s){const r=Ef(a),l=this.buildingPlacements.get(r);return l?(this.buildingPlacements.delete(r),s.getTile(a.q,a.r)?.placeBuilding(null),this.buildings[l.type]!==void 0&&(this.buildings[l.type]-=1,this.buildings[l.type]<=0&&delete this.buildings[l.type]),ne.emit("buildingRemoved",{building:l,coord:a,state:this}),!0):!1}upgrade(a,s,r=ae.SAUNA_BEER){return this.construct(`upgrade:${a}`,s,r)}applyPolicy(a){const s=Vg(a);if(!s){const u={policyId:a,state:this,reason:"unknown-policy"};return ne.emit(Gt.REJECTED,u),!1}if(this.hasPolicy(s.id)){const u={policyId:s.id,policy:s,state:this,reason:"already-applied"};return ne.emit(Gt.REJECTED,u),!1}const r=s.prerequisites.filter(u=>!u.isSatisfied(this));if(r.length>0){const u={policyId:s.id,policy:s,state:this,reason:"prerequisites-not-met",missingPrerequisites:r};return ne.emit(Gt.REJECTED,u),!1}if(!this.spend(s.cost,s.resource)){const u={policyId:s.id,policy:s,state:this,reason:"insufficient-resources"};return ne.emit(Gt.REJECTED,u),!1}this.policies.add(s.id);const l={policy:s,state:this};return ne.emit(Gt.APPLIED,l),!0}hasPolicy(a){return this.policies.has(a)}getNgPlusState(){return{...this.ngPlus}}setNgPlusState(a){const s=Fa({...this.ngPlus,...a});return this.ngPlus=Ha(s),this.ngPlus}}class cE{constructor(a,s){this.baseInterval=a,this.onTick=s}timer=null;speed=1;lastTick=0;accumulator=0;start(){this.stop(),this.lastTick=Date.now();const a=this.baseInterval/this.speed;this.timer=setInterval(()=>{const s=Date.now(),r=s-this.lastTick;this.lastTick=s,this.onTick(r)},a)}stop(){this.timer!==null&&(clearInterval(this.timer),this.timer=null)}setSpeed(a){if(a<=0)throw new Error("Speed multiplier must be positive");this.speed=a,this.timer!==null&&this.start()}getSpeed(){return this.speed}getBaseInterval(){return this.baseInterval}tick(a){for(this.accumulator+=a*this.speed;this.accumulator>=this.baseInterval;)this.accumulator-=this.baseInterval,this.onTick(this.baseInterval)}}var xn=(n=>(n[n.Plains=0]="Plains",n[n.Forest=1]="Forest",n[n.Hills=2]="Hills",n[n.Lake=3]="Lake",n))(xn||{});function uE(n,a,s){let r=n*374761393+a*668265263+s*0x14057b7ef7678100;return r=(r^r>>13)*1274126177,r^=r>>16,(r>>>0)/4294967295}function dE(n,a,s=0){const r=uE(n,a,s);return r<.1?3:r<.3?1:r<.5?2:0}class fE{_terrain;_building;_isFogged;listeners=new Set;constructor(a=xn.Plains,s=null,r=!0){this._terrain=a,this._building=s,this._isFogged=r}get terrain(){return this._terrain}set terrain(a){this._terrain!==a&&(this._terrain=a,this.notify("terrain"))}get building(){return this._building}set building(a){this._building!==a&&(this._building=a,this.notify("building"))}get isFogged(){return this._isFogged}set isFogged(a){this._isFogged!==a&&(this._isFogged=a,this.notify("fog"))}reveal(){this.isFogged=!1}placeBuilding(a){this.building=a}setFogged(a){this.isFogged=a}addMutationListener(a){return this.listeners.add(a),()=>this.listeners.delete(a)}notify(a){for(const s of this.listeners)s(a)}}class hE{constructor(a=10,s=10,r=32,l=0){this.hexSize=r,this.seed=l,this.minQ=0,this.minR=0,this.maxQ=a-1,this.maxR=s-1}tiles=new Map;tileSubscriptions=new Map;changeListeners=new Set;minQ;maxQ;minR;maxR;get width(){return this.maxQ-this.minQ+1}get height(){return this.maxR-this.minR+1}key(a,s){return`${a},${s}`}addTileChangeListener(a){return this.changeListeners.add(a),()=>this.changeListeners.delete(a)}notifyTileChange(a,s,r){for(const l of this.changeListeners)l(a,s,r)}attachTileListener(a,s,r){const l=s.addMutationListener(u=>{this.notifyTileChange(r,s,u)});this.tileSubscriptions.set(a,l)}ensureTile(a,s){const r=this.key(a,s);let l=this.tiles.get(r);return l||(l=new fE(dE(a,s,this.seed)),this.tiles.set(r,l),this.minQ=Math.min(this.minQ,a),this.maxQ=Math.max(this.maxQ,a),this.minR=Math.min(this.minR,s),this.maxR=Math.max(this.maxR,s),this.attachTileListener(r,l,{q:a,r:s}),this.notifyTileChange({q:a,r:s},l,"created"),l.isFogged||sh({q:a,r:s},this.hexSize)),l}getTile(a,s){return this.tiles.get(this.key(a,s))}forEachTile(a){for(const[s,r]of this.tiles){const[l,u]=s.split(",").map(Number);a(r,{q:l,r:u})}}getNeighbors(a,s){return Oc({q:a,r:s}).map(r=>this.ensureTile(r.q,r.r))}revealAround(a,s,r={}){const{autoFrame:l=!0}=r;for(let h=-s;h<=s;h++){const p=Math.max(-s,-h-s),m=Math.min(s,-h+s);for(let g=p;g<=m;g++){const b={q:a.q+h,r:a.r+g};this.ensureTile(b.q,b.r).reveal(),sh(b,this.hexSize)}}if(!l)return;const u=typeof window<"u"?(()=>{const h=Math.max(window.innerWidth,0),p=Math.max(window.innerHeight,0);let m=0;if(typeof document<"u"){const b=document.getElementById("right-panel");if(b){const S=b.getBoundingClientRect();if(S.width>0){const E=b.closest("#ui-overlay");if(E){const M=E.getBoundingClientRect(),N=window.getComputedStyle(E),_=Number.parseFloat(N.paddingRight||"0"),U=M.right-S.left,H=S.width+(Number.isFinite(_)?_:0);m=Math.max(0,Math.max(U,H))}else m=Math.max(0,S.width)}}}const g=Math.min(Math.max(m,0),h);return{width:h,height:p,safeRight:g}})():{width:0,height:0,safeRight:0},f=PS(u);ZS(f,300)}}const zc={TRIGGERED:"scheduler:eventTriggered",RESOLVED:"scheduler:eventResolved"},mE=new Map;function pE(){return globalThis.localStorage??null}function lo(n){return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}function P2(n){const a=globalThis.crypto;return a?.randomUUID?a.randomUUID():`${n}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function gE(n){const a={id:String(n.id??""),label:String(n.label??""),description:n.description?String(n.description):void 0,event:n.event?String(n.event):void 0,payload:n.payload,accent:n.accent??void 0};return a.id||(a.id=P2("choice")),a.label||(a.label="Choose"),a}function Bc(n){const a={id:String(n.id??""),headline:String(n.headline??""),body:String(n.body??""),art:n.art?String(n.art):void 0,typography:n.typography,animation:n.animation,accentColor:n.accentColor?String(n.accentColor):void 0,acknowledgeText:n.acknowledgeText?String(n.acknowledgeText):void 0,choices:Array.isArray(n.choices)?n.choices.map(s=>gE(s)):void 0};return a.id||(a.id=P2("event")),a}function yE(n){return{content:Bc(n.content),trigger:n.trigger.type==="time"?{type:"time",at:Number.isFinite(n.trigger.at)?n.trigger.at:0}:{type:"condition",conditionId:String(n.trigger.conditionId),params:n.trigger.params}}}function Pg(n){return{content:Bc(n.content),triggeredAt:Number.isFinite(n.triggeredAt)?n.triggeredAt:0}}const Mf=Object.freeze({clock:0,queue:[],active:[]});class bE{storageKey;eventBus;getStorage;state=lo(Mf);subscribers=new Set;constructor(a={}){this.storageKey=a.storageKey??"autobattles:event-scheduler",this.eventBus=a.eventBus??ne,this.getStorage=a.storageProvider??pE,this.load()}subscribe(a){return this.subscribers.add(a),a(this.getActiveEvents()),()=>{this.subscribers.delete(a)}}getActiveEvents(){return this.state.active.map(a=>({...lo(a.content),triggeredAt:a.triggeredAt}))}schedule(a){const s=Bc(a.content);if(!s.headline||!s.body||this.containsEvent(s.id))return!1;const r=a.trigger.type==="condition"?{type:"condition",conditionId:String(a.trigger.conditionId),params:a.trigger.params}:{type:"time",at:this.resolveTriggerTime(a.trigger)};return this.state.queue.push({content:s,trigger:r}),this.sortQueue(),this.save(),!0}publish(a){const s=Bc(a);this.containsEvent(s.id)||(this.state.queue=this.state.queue.filter(r=>r.content.id!==s.id),this.activateEvent({content:s,triggeredAt:this.state.clock}))}tick(a,s={}){if(!Number.isFinite(a)||a<=0)return;this.state.clock+=a;const r=[],l=[];for(const u of this.state.queue)this.shouldTrigger(u.trigger,s)?r.push(u):l.push(u);this.state.queue=l;for(const u of r)this.activateEvent({content:u.content,triggeredAt:this.state.clock});this.save()}resolve(a,s){const r=this.state.active.findIndex(h=>h.content.id===a);if(r===-1)return!1;const l=this.state.active[r],u=this.pickChoice(l.content,s),f=u?u.id:null;return this.state.active.splice(r,1),this.save(),this.notify(),this.eventBus.emit(zc.RESOLVED,{eventId:a,choiceId:f,event:l.content}),u?.event&&this.eventBus.emit(u.event,{eventId:a,choiceId:f,payload:u.payload,event:l.content}),!0}reset(){this.state=lo(Mf),this.save(),this.notify()}activateEvent(a){const s=Pg(a);this.state.active.push(s),this.save(),this.notify(),this.eventBus.emit(zc.TRIGGERED,{event:{...lo(s.content),triggeredAt:s.triggeredAt}})}pickChoice(a,s){const r=a.choices??[];if(r.length!==0){if(s){const l=r.find(u=>u.id===s);if(l)return l}return r[0]}}shouldTrigger(a,s){if(a.type==="time")return this.state.clock>=a.at;const r=mE.get(a.conditionId);if(!r)return!1;try{return!!r(a.params,s)}catch(l){return console.warn("Scheduler condition evaluation failed",a.conditionId,l),!1}}resolveTriggerTime(a){if(Number.isFinite(a.at))return Number(a.at);const s=Number.isFinite(a.in)?Number(a.in):0;return Math.max(0,this.state.clock+s)}sortQueue(){this.state.queue.sort((a,s)=>{const r=a.trigger.type==="time"?a.trigger.at:Number.POSITIVE_INFINITY,l=s.trigger.type==="time"?s.trigger.at:Number.POSITIVE_INFINITY;return r-l})}containsEvent(a){return this.state.active.some(s=>s.content.id===a)||this.state.queue.some(s=>s.content.id===a)}notify(){const a=this.getActiveEvents();for(const s of this.subscribers)try{s(a)}catch(r){console.warn("Scheduler subscriber failed",r)}}load(){const a=Uh(this.storageKey);if(!a){this.state=lo(Mf);return}const s=Number(a.clock);this.state={clock:Number.isFinite(s)?s:0,queue:Array.isArray(a.queue)?a.queue.map(r=>yE(r)):[],active:Array.isArray(a.active)?a.active.map(r=>Pg(r)):[]}}save(){const a=this.getStorage();if(a)try{a.setItem(this.storageKey,JSON.stringify({clock:this.state.clock,queue:this.state.queue,active:this.state.active}))}catch(s){console.warn("Scheduler persistence failed",s)}}}const Nc=new bE;function vE(n,a){const s=new WeakSet,r=l=>{l.policy.id===n.id&&(a.once!==!1&&s.has(l.state)||(a.invoke(l),a.once!==!1&&s.add(l.state)))};ne.on(a.event,r)}for(const n of Y2())for(const a of n.effects)vE(n,a);const SE="modulepreload",EE=function(n){return"/"+n},Zg={},ME=function(a,s,r){let l=Promise.resolve();if(s&&s.length>0){let p=function(m){return Promise.all(m.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),h=f?.nonce||f?.getAttribute("nonce");l=p(s.map(m=>{if(m=EE(m),m in Zg)return;Zg[m]=!0;const g=m.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${b}`))return;const S=document.createElement("link");if(S.rel=g?"stylesheet":SE,g||(S.as="script"),S.crossOrigin="",S.href=m,h&&S.setAttribute("nonce",h),document.head.appendChild(S),g)return new Promise((E,M)=>{S.addEventListener("load",E),S.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${m}`)))})}))}function u(f){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=f,window.dispatchEvent(h),!h.defaultPrevented)throw f}return l.then(f=>{for(const h of f||[])h.status==="rejected"&&u(h.reason);return a().catch(u)})},xE=({building:n,coord:a,state:s})=>{n instanceof Lh?s.modifyPassiveGeneration(ae.SAUNA_BEER,n.beerPerTick):n instanceof O2&&ME(async()=>{const{spawnUnit:r}=await Promise.resolve().then(()=>zM);return{spawnUnit:r}},void 0).then(({spawnUnit:r})=>{r(s,"soldier",`barracks-${a.q}-${a.r}`,a,"player")})},wE=({building:n,state:a})=>{n instanceof Lh&&a.modifyPassiveGeneration(ae.SAUNA_BEER,-n.beerPerTick)};ne.on("buildingPlaced",xE);ne.on("buildingRemoved",wE);const jn={master:{defaultVolume:.9,volumeKey:"audio.mixer.master.volume",muteKey:"audio.mixer.master.muted"},music:{defaultVolume:.65,volumeKey:"audio.mixer.music.volume",muteKey:"audio.mixer.music.muted"},sfx:{defaultVolume:1,volumeKey:"audio.mixer.sfx.volume",muteKey:"audio.mixer.sfx.muted"}},Pe={master:{volume:jn.master.defaultVolume,muted:!1},music:{volume:jn.music.defaultVolume,muted:!1},sfx:{volume:jn.sfx.defaultVolume,muted:!1}},Jn={};let On=null,lh=!1;const ch=new Set;function qh(n,a){return Number.isFinite(n)?n<=0?0:n>=1?1:n:a}function iu(){if(typeof localStorage>"u")return null;try{return localStorage}catch(n){return console.warn("Audio mixer storage unavailable",n),null}}function AE(n){const a=iu();if(!a)return null;try{const s=a.getItem(jn[n].volumeKey);if(s===null)return null;const r=Number.parseFloat(s);return Number.isFinite(r)?qh(r,jn[n].defaultVolume):null}catch(s){return console.warn("Failed to restore volume setting",n,s),null}}function CE(n){const a=iu();if(!a)return null;try{const s=a.getItem(jn[n].muteKey);return s===null?null:s==="true"}catch(s){return console.warn("Failed to restore mute setting",n,s),null}}for(const n of Object.keys(jn)){const a=AE(n),s=CE(n);a!==null&&(Pe[n].volume=qh(a,jn[n].defaultVolume)),s!==null&&(Pe[n].muted=s)}function TE(n){const a=iu();if(a)try{a.setItem(jn[n].volumeKey,Pe[n].volume.toFixed(3))}catch(s){console.warn("Failed to persist volume setting",n,s)}}function _E(n){const a=iu();if(a)try{a.setItem(jn[n].muteKey,Pe[n].muted?"true":"false")}catch(s){console.warn("Failed to persist mute setting",n,s)}}function Jg(){if(typeof window>"u"||!On||lh)return;const n=()=>{On?.resume().catch(()=>{})};window.addEventListener("pointerdown",n,{once:!0}),window.addEventListener("keydown",n,{once:!0}),lh=!0}function zh(n){const a=Jn[n];if(!a)return;const{volume:s,muted:r}=Pe[n],l=r?0:s;a.gain.value=l}function Z2(n){if(!Jn.master){const a=n.createGain();a.gain.value=Pe.master.muted?0:Pe.master.volume,a.connect(n.destination),Jn.master=a}if(!Jn.music){const a=n.createGain();a.gain.value=Pe.music.muted?0:Pe.music.volume,a.connect(Jn.master),Jn.music=a}if(!Jn.sfx){const a=n.createGain();a.gain.value=Pe.sfx.muted?0:Pe.sfx.volume,a.connect(Jn.master),Jn.sfx=a}}function Bh(){if(On||typeof window>"u")return On;const n=window.AudioContext||window.webkitAudioContext;if(!n)return console.warn("Web Audio API not supported"),null;try{On=new n,Z2(On),Jg()}catch(a){return console.warn("Unable to create AudioContext",a),On=null,null}return On.state==="suspended"&&(lh=!1,Jg()),On}function RE(){return On??Bh()}function xf(n){const a=Pe.master;if(n==="master")return a.muted?0:a.volume;const s=Pe[n];return s.muted||a.muted?0:s.volume*a.volume}function Hh(n){const a=RE();if(!a)return null;Z2(a);const s=Jn[n];return s?(zh(n),s):null}function su(){return{channels:{master:{volume:Pe.master.volume,muted:Pe.master.muted,effectiveVolume:xf("master")},music:{volume:Pe.music.volume,muted:Pe.music.muted,effectiveVolume:xf("music")},sfx:{volume:Pe.sfx.volume,muted:Pe.sfx.muted,effectiveVolume:xf("sfx")}},contextState:On?.state??"uninitialized"}}function J2(){const n=su();for(const a of ch)a(n)}function jh(n){return ch.add(n),()=>{ch.delete(n)}}function Ih(n,a){const s=qh(a,jn[n].defaultVolume);Pe[n].volume!==s&&(Pe[n].volume=s,TE(n),zh(n),J2())}function Gh(n,a){Pe[n].muted!==a&&(Pe[n].muted=a,_E(n),zh(n),J2())}function NE(n){Ih("master",n)}function kE(n){Ih("music",n)}function DE(n){Ih("sfx",n)}function LE(n){Gh("master",n)}function UE(n){Gh("music",n)}function OE(n){Gh("sfx",n)}function Hc(n){return su().channels[n]}const qE=48e3;function zE(n){let a=n>>>0;return()=>{a+=1831565813;let s=a;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}}function BE(n,a,s){const{attack:r,decay:l,sustain:u,release:f,sustainLevel:h}=n;if(r>0&&s<r)return s/r;if(l>0&&s<r+l){const p=(s-r)/l;return 1-(1-h)*p}if(s<a-f)return h;if(f>0&&s<a){const p=(s-(a-f))/f;return h*(1-p)}return 0}function HE(n,a,s){const r=n.phase??0,l=n.vibrato,u=n.tremolo,f=l?1+l.depth*Math.sin(2*Math.PI*l.speed*s):1,h=u?n.gain*(1-u.depth+u.depth*Math.sin(2*Math.PI*u.speed*s)):n.gain,p=a*n.ratio*f;return h*Math.sin(2*Math.PI*p*s+r)}function jE(n,a){return n.gain*(a()*2-1)}function IE(n,a=qE){const s=Math.max(1,Math.floor(n.duration*a)),r=new Float32Array(s),l=zE(n.seed);for(let u=0;u<s;u++){const f=u/a;let h=0;for(const m of n.layers)m.type==="sine"?h+=HE(m,n.baseFrequency,f):h+=jE(m,l);const p=BE(n.envelope,n.duration,f);r[u]=h*p}return r}const wf={attack:{variants:[{id:"attack-a",label:"Gentle Birch Strike",description:"Soft mallet transient with subtle shimmer.",duration:.9,baseFrequency:220,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:421,loudness:{lufs:-13.839,peakDb:-2.134,gain:.7797}},{id:"attack-b",label:"Rounded Pluck Echo",description:"A slightly brighter chime tuned above the root.",duration:.9,baseFrequency:232,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:947,loudness:{lufs:-13.839,peakDb:-2.101,gain:.7797}},{id:"attack-c",label:"High Drift Pluck",description:"Upper register tap with airy decay.",duration:.9,baseFrequency:244,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:1337,loudness:{lufs:-13.838,peakDb:-2.076,gain:.7796}}]},death:{variants:[{id:"death-a",label:"Hollow Exhale",description:"Low cedar drum pulse with airy noise tail.",duration:1.15,baseFrequency:150,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:615,loudness:{lufs:-12.772,peakDb:-.218,gain:.6896}},{id:"death-b",label:"Soft Ember Fall",description:"Mid register thump with drifting undertone.",duration:1.15,baseFrequency:168,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:274,loudness:{lufs:-12.792,peakDb:-.185,gain:.6912}},{id:"death-c",label:"Warm Resolve",description:"Higher pitch breathy release with gentle rumble.",duration:1.15,baseFrequency:184,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:978,loudness:{lufs:-12.777,peakDb:-.16,gain:.69}}]},sisu:{variants:[{id:"sisu-a",label:"Rising Steam",description:"Slow bloom of airy sine pads with hushed texture.",duration:1.9,baseFrequency:176,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1204,loudness:{lufs:-12.561,peakDb:-.501,gain:.673}},{id:"sisu-b",label:"Glowing Drift",description:"Warmer harmonic swell with chorus shimmer.",duration:1.9,baseFrequency:188,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1642,loudness:{lufs:-12.566,peakDb:-.271,gain:.6734}},{id:"sisu-c",label:"Morning Brilliance",description:"Bright tonic swell with shimmering overtones.",duration:1.9,baseFrequency:200,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:2019,loudness:{lufs:-12.575,peakDb:-.235,gain:.6742}}]}};function Af(n){return{id:n.id,label:n.label,envelope:n.envelope,gain:n.loudness.gain,loader:a=>{const s=IE(n,a.sampleRate),r=a.createBuffer(1,s.length,a.sampleRate);return r.getChannelData(0).set(s),r}}}const GE={click:{variants:[{id:"ui-click-soft",label:"UI soft tap",envelope:{attack:0,decay:.05,sustain:0,release:.03,sustainLevel:0},loader:n=>FE(n)}],debounce:{windowMs:35,weight:.5,maxWeight:1.5},polyphony:6},spawn:{variants:[{id:"ui-spawn-chime",label:"Roster invite tone",envelope:{attack:0,decay:.2,sustain:.5,release:.2,sustainLevel:.5},loader:n=>$E(n)}],debounce:{windowMs:150,weight:.7,maxWeight:1.4},polyphony:3},error:{variants:[{id:"ui-error-tone",label:"Gentle warning tap",envelope:{attack:.01,decay:.2,sustain:.2,release:.2,sustainLevel:.2},loader:n=>VE(n)}],debounce:{windowMs:220,weight:1,maxWeight:1},polyphony:2},attack:{variants:wf.attack.variants.map(Af),debounce:{windowMs:120,weight:.6,maxWeight:1.2},polyphony:3},death:{variants:wf.death.variants.map(Af),debounce:{windowMs:360,weight:1,maxWeight:1.5},polyphony:3},sisu:{variants:wf.sisu.variants.map(Af),debounce:{windowMs:900,weight:1,maxWeight:1},polyphony:1}};let rc=null;const Wg=new Map,oc=new Map,jc=new Map,nr=new Map,xo=new Map,ey=new Map,It={node:null,destination:null,envelope:0,lastUpdate:0},co={attackSeconds:.04,releaseSeconds:.6,depth:.55,floor:.25},uh=new Set;function Yh(){const n=Hc("master"),a=Hc("sfx");return n.muted||a.muted}function YE(){const n=Yh();for(const a of uh)a(n)}function Fh(n,a,s){const r=Math.floor(n.sampleRate*a),l=n.createBuffer(1,r,n.sampleRate),u=l.getChannelData(0);for(let f=0;f<r;f++){const h=f/n.sampleRate;u[f]=s(h)}return l}function FE(n){return Fh(n,.05,a=>Math.sin(2*Math.PI*1e3*a)*Math.exp(-40*a))}function $E(n){return Fh(n,.2,a=>(Math.sin(2*Math.PI*440*a)+Math.sin(2*Math.PI*660*a))*.5*Math.exp(-6*a))}function VE(n){return Fh(n,.3,a=>Math.sin(2*Math.PI*110*a)*Math.exp(-8*a))}function ty(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function XE(n,a){return`${n}:${a}`}function KE(n,a,s){const r=XE(n,a),l=Wg.get(r);if(l)return Promise.resolve(l);const u=oc.get(r);if(u)return u;const f=$h();if(!f)return Promise.reject(new Error("Audio context unavailable"));const h=Promise.resolve(s.loader(f)).then(p=>(Wg.set(r,p),oc.delete(r),p)).catch(p=>{throw oc.delete(r),p});return oc.set(r,h),h}function ny(n){const a=n.polyphony;return!Number.isFinite(a)||!a||a<=0?Number.POSITIVE_INFINITY:a}function QE(n,a){const s=jc.get(n);if(!s||s.length===0)return[];const r=[];for(const l of s)l.time>=a&&r.push(l);return jc.set(n,r),r}function PE(n,a,s){const r=a.debounce;if(!r)return{blocked:!1,weight:0};const l=r.weight??1,u=r.windowMs,f=s-u,h=QE(n,f);let p=0;for(const m of h)p+=m.weight;return p+l>r.maxWeight?{blocked:!0}:{blocked:!1,weight:l}}function ZE(n,a,s){if(s<=0)return;const r=jc.get(n)??[];r.push({time:a,weight:s}),jc.set(n,r)}function JE(n){const a=(nr.get(n)??0)+1;nr.set(n,a)}function WE(n){const a=nr.get(n)??0;if(a<=1){nr.delete(n);return}nr.set(n,a-1)}function ay(n,a){if(!Number.isFinite(a))return!1;const s=xo.get(n)?.size??0,r=nr.get(n)??0;return s+r>=a}function eM(n,a){let s=xo.get(n);s||(s=new Set,xo.set(n,s)),s.add(a);let r=!1;const l=()=>{if(r)return;r=!0;const u=xo.get(n);u?.delete(a),u&&u.size===0&&xo.delete(n)};if(typeof a.addEventListener=="function")a.addEventListener("ended",()=>{l()},{once:!0});else{const u=a.onended;a.onended=()=>{try{u?.call(a)}finally{l()}}}return l}function tM(n,a){const s=It.node;if(!s||s.context!==n){It.node?.disconnect();const r=n.createGain();return r.gain.value=1,r.connect(a),It.node=r,It.destination=a,It.envelope=0,It.lastUpdate=n.currentTime,r}return It.destination!==a&&(s.disconnect(),s.connect(a),It.destination=a),s}function nM(n){const a=It.node;if(!a)return;const s=n.currentTime,r=.6,l=.55,u=Math.max(0,s-It.lastUpdate),f=Math.exp(-u/r);It.envelope*=f,It.envelope=Math.min(1,It.envelope+l),It.lastUpdate=s;const m=Math.max(.35,1-It.envelope*.5),g=.02;a.gain.cancelScheduledValues(s),a.gain.setValueAtTime(a.gain.value,s),a.gain.linearRampToValueAtTime(m,s+g),a.gain.setTargetAtTime(1,s+g,r)}function aM(n){const a=Hh("music");if(!a)return;const s=Hc("master"),r=Hc("music");if(s.muted||r.muted)return;const l=r.volume;if(l<=0)return;const u=n.currentTime,f=a.gain.value,h=l*(1-co.depth),p=l*co.floor,m=Math.min(f,Math.max(h,p));a.gain.cancelScheduledValues(u),a.gain.setValueAtTime(f,u),a.gain.linearRampToValueAtTime(m,u+co.attackSeconds),a.gain.setTargetAtTime(l,u+co.attackSeconds,co.releaseSeconds)}function ia(n){if(dh())return;const a=GE[n];if(!a)return;const s=a.variants;if(!s||s.length===0)return;let r=0,l=s[0];s.length>1&&(r=((ey.get(n)??Math.floor(Math.random()*s.length)-1)+1)%s.length,l=s[r],ey.set(n,r));const u=ty(),f=PE(n,a,u);if(f.blocked)return;const h=ny(a);if(ay(n,h))return;JE(n);let p=!1;const m=()=>{p||(WE(n),p=!0)};KE(n,r,l).then(g=>{if(m(),dh())return;const b=$h();if(!b)return;const S=Hh("sfx");if(!S)return;const E=ny(a);if(ay(n,E))return;const M=b.createBufferSource();M.buffer=g;const N=l.gain;let _=M;if(typeof N=="number"&&N>0&&N!==1){const I=b.createGain();I.gain.value=N,M.connect(I),_=I}const U=n==="attack"?tM(b,S):S;_.connect(U);const H=eM(n,M);try{M.start(),n==="attack"&&nM(b),n==="sisu"&&aM(b);const I=ty();!f.blocked&&f.weight>0&&ZE(n,I,f.weight)}catch(I){console.warn("Unable to start sound",I),H()}}).catch(g=>{m(),!(g instanceof Error&&g.message==="Audio context unavailable")&&console.warn("Failed to play sound",n,g)}).finally(()=>{m()})}function dh(){return Yh()}function iM(n){return uh.add(n),()=>{uh.delete(n)}}typeof document<"u"&&document.addEventListener("click",n=>{n.target instanceof HTMLButtonElement&&ia("click")});let iy=Yh();jh(n=>{const a=n.channels.master.muted||n.channels.sfx.muted;a!==iy&&(iy=a,YE())});function $h(){return rc||(rc=Bh(),rc)}$h();const sy="__autobattlesAudioEvents__",ry=globalThis;ry[sy]||(ne.on("unitDamaged",n=>{!n||n.amount<=0||ia("attack")}),ne.on("unitDied",()=>{ia("death")}),ne.on("sisuBurstStart",()=>{ia("sisu")}),ry[sy]=!0);function sM(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function rM(n){const a={};if(!n)return a;for(const[s,r]of Object.entries(n))typeof r=="function"&&(a[s]=r);return a}class oM{constructor(a=ne){this.emitter=a}modifiers=new Map;hookIndex=new Map;listeners=new Map;add(a){if(typeof a.id!="string"||a.id.length===0)throw new Error("Modifier id must be a non-empty string");if((typeof a.duration!="number"||!Number.isFinite(a.duration))&&a.duration!==1/0)throw new Error("Modifier duration must be a positive number or Infinity");if(Number.isFinite(a.duration)&&a.duration<=0)throw new Error("Modifier duration must be greater than zero");const s=rM(a.hooks),r=sM();this.modifiers.has(a.id)&&this.remove(a.id,"replaced");const l={...a,hooks:s,remaining:a.duration,appliedAt:r};this.modifiers.set(l.id,l),this.indexHooks(l);const u={runtime:this,modifier:l};return a.onApply?.(u),this.emit("modifierAdded",{modifier:l}),this.emitter?.emit("modifierAdded",{modifier:l}),Number.isFinite(l.remaining)&&l.remaining<=0&&this.remove(l.id,"expired"),l}has(a){return this.modifiers.has(a)}list(){return Array.from(this.modifiers.values()).map(a=>({...a,hooks:{...a.hooks}}))}remove(a,s="manual"){const r=this.modifiers.get(a);if(!r)return!1;this.modifiers.delete(a),this.unindexHooks(r);const l={runtime:this,modifier:r,reason:s};return r.onExpire?.(l),s==="expired"&&(this.emit("modifierExpired",{modifier:r}),this.emitter?.emit("modifierExpired",{modifier:r})),this.emit("modifierRemoved",{modifier:r,reason:s}),this.emitter?.emit("modifierRemoved",{modifier:r,reason:s}),!0}advance(a){if(typeof a!="number"||a<=0)return;const s=[];for(const r of this.modifiers.values())Number.isFinite(r.remaining)&&(r.remaining=Math.max(0,r.remaining-a),r.remaining<=0&&s.push(r.id));for(const r of s)this.remove(r,"expired")}trigger(a,s){const r=this.hookIndex.get(a);if(!r||r.size===0)return;const l=Array.from(r);for(const u of l){const f=this.modifiers.get(u);if(!f){r.delete(u);continue}const h=f.hooks[a];if(!h){r.delete(u);continue}h(s,{runtime:this,modifier:f})}}clear(){const a=Array.from(this.modifiers.keys());for(const s of a)this.remove(s,"manual")}on(a,s){const r=this.listeners.get(a)??new Set;r.add(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);r&&(r.delete(s),r.size===0&&this.listeners.delete(a))}emit(a,s){const r=this.listeners.get(a);if(!(!r||r.size===0))for(const l of Array.from(r))l(s)}indexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s)??new Set;r.add(a.id),this.hookIndex.set(s,r)}}unindexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s);r&&(r.delete(a.id),r.size===0&&this.hookIndex.delete(s))}}}const ru=new oM,lM=n=>ru.add(n),cM=(n,a="manual")=>ru.remove(n,a),uM=n=>{ru.advance(n)},lc=(n,a)=>{ru.trigger(n,a)};class dM{constructor(a,s,r){this.owner=a,this.entries=s,this.log=r}runTick(a,s){for(const{definition:r,state:l}of this.entries){if(!r.onTick)continue;const u=r.onTick({owner:this.owner,state:l,self:a,opponent:s}),f=Wi(u?.shieldDamage??0);if(f>0){const p=Math.min(a.shield,f);p>0&&(a.shield-=p,this.log.tickShieldDamage+=p)}const h=Wi(u?.hpDamage??0);if(h>0){const p=Math.min(a.health,h);p>0&&(a.health-=p,this.log.tickHpDamage+=p)}}}grantShield(a,s){let r=0;for(const{definition:l,state:u}of this.entries){if(!l.onGrantShield)continue;const f=Wi(l.onGrantShield({owner:this.owner,state:u,self:a,opponent:s})??0);f>0&&(r+=f)}return r>0&&(a.shield+=r,this.log.shieldGranted+=r),r}consumeShield(a,s,r){let l=Wi(a);if(l<=0)return 0;let u=0;for(const{definition:f,state:h}of this.entries){if(!f.onConsumeShield||l<=0)continue;const p=Wi(f.onConsumeShield({owner:this.owner,state:h,self:s,opponent:r,amount:l})??0);if(p<=0)continue;const m=Math.min(l,p);u+=m,l-=m}return u>0&&(this.log.shieldConsumed+=u),u}applyHit(a,s,r){if(a<=0)return 0;let l=0;for(const{definition:h,state:p}of this.entries){if(!h.onHit)continue;const m=Wi(h.onHit({owner:this.owner,state:p,self:s,opponent:r,hpDamage:a})??0);m>0&&(l+=m)}if(l<=0)return 0;const u=Math.max(0,s.maxHealth-s.health);if(u<=0)return 0;const f=Math.min(u,l);return f>0&&(s.health+=f,this.log.lifesteal+=f),f}getShieldValue(){let a=0;for(const{definition:s,state:r}of this.entries){if(!s.onGrantShield||r.keyword!=="Shield")continue;const l=fh(r);if(l<=0)continue;const u=Math.max(0,Number.isFinite(r.stacks)?r.stacks:0);u<=0||(a+=u*l)}return a}}function fM(){return{attacker:ly(),defender:ly()}}function oy(n,a,s){const r=hM(n);if(r.length===0)return null;const l=[];for(const u of r){const f=W2.get(u.keyword);f&&l.push({state:u,definition:f})}return l.length===0?null:new dM(a,l,s)}const W2=new Map;function ou(n,a){W2.set(n,a)}function ly(){return{tickHpDamage:0,tickShieldDamage:0,shieldGranted:0,shieldConsumed:0,lifesteal:0,keywordShieldRemaining:0}}function Wi(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function cr(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function Bo(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function hM(n){if(!n)return[];const a=[],s=n;if(typeof s[Symbol.iterator]=="function"){for(const r of s){const l=cy(r);l&&a.push(l)}return a}if(typeof n=="object")for(const r of Object.values(n)){const l=cy(r);l&&a.push(l)}return a}function cy(n){if(!n||typeof n!="object")return null;const a=n;if(!Object.prototype.hasOwnProperty.call(a,"stacks"))return null;const s=mM(a.keyword);if(!s)return null;const r=a;return r.keyword=s,r.stacks=cr(r.stacks),Object.prototype.hasOwnProperty.call(a,"potency")&&r.potency!==void 0&&(r.potency=Bo(r.potency)),r}function mM(n){if(typeof n!="string")return null;switch(n.trim().toLowerCase()){case"bleed":return"Bleed";case"burn":return"Burn";case"lifesteal":case"life-steal":return"Lifesteal";case"shield":return"Shield";default:return null}}function fh(n){const a=n.potency!==void 0?Bo(n.potency):1;return a>0?a:0}function pM(n){if(n.potency!==void 0){const r=Bo(n.potency);return r>0?r:0}const a=cr(n.stacks);if(a<=0)return 0;const s=a*.2;return s>0?s:0}ou("Bleed",{onTick({state:n,self:a}){const s=cr(n.stacks);if(s<=0||a.health<=0){n.stacks=s;return}const r=n.potency!==void 0?Bo(n.potency):1,l=s*r;if(l<=0)return;const u=Math.min(a.health,l);return n.stacks=Math.max(0,s-1),{hpDamage:u}}});ou("Burn",{onTick({state:n,self:a}){const s=cr(n.stacks);if(s<=0){n.stacks=s;return}const r=n.potency!==void 0?Bo(n.potency):1,l=s*r;if(l<=0)return;const u=Math.min(a.shield,l),f=l-u,h=Math.min(a.health,f);return n.stacks=Math.max(0,s-1),{shieldDamage:u,hpDamage:h}}});ou("Shield",{onGrantShield({state:n}){const a=cr(n.stacks);if(a<=0)return n.stacks=a,0;const s=a*fh(n);return s>0?s:0},onConsumeShield({state:n,amount:a}){const s=cr(n.stacks);if(s<=0)return n.stacks=0,0;const r=fh(n);if(r<=0)return n.stacks=0,0;const l=s*r;if(l<=0)return n.stacks=0,0;const u=Math.min(l,Wi(a)),f=u/r;return n.stacks=Math.max(0,s-f),u>0?u:0}});ou("Lifesteal",{onHit({state:n,hpDamage:a}){if(a<=0)return 0;const s=pM(n);if(s<=0)return 0;const r=a*s;return r>0?r:0}});function qn(n){return Number.isFinite(n)?Math.max(0,n):0}function uy(n,a){const s=qn(a?.health??n?.health??0),r=qn(a?.shield??n?.shield??0);return{id:n?.id??"unknown",faction:n?.faction,health:s,maxHealth:n?.maxHealth,shield:r}}function dy(n){if(!n)return!1;const a=n;return typeof a.onHit=="function"||typeof a.onKill=="function"||Array.isArray(a.onHit)||Array.isArray(a.onKill)}function fy(n){return n?Array.isArray(n)?n.filter(a=>typeof a=="function"):typeof n=="function"?[n]:[]:[]}function gM(n){if(!n)return[];if(typeof n[Symbol.iterator]=="function"){const s=[];for(const r of n)dy(r)&&s.push(r);return s}return Object.values(n).filter(s=>dy(s))}function cc(n,a,s){if(!n)return;const r=fy(n.hooks?.[a]);for(const u of r)u(s);const l=gM(n.keywords);for(const u of l)for(const f of fy(u[a]))f(s)}function hy(n){const a=qn(n?.health??0),s=qn(n?.maxHealth??a);return{health:a,maxHealth:Math.max(s,a),shield:qn(n?.shield??0)}}function yM(){return{health:0,maxHealth:0,shield:0}}function bM(n){const a=n.attacker??null,s=n.defender,r=n.baseDamage,l=qn(n.minimumDamage??1),u=Number.isFinite(r)?qn(r):qn(a?.attack??0),f=qn(s.defense??0),h=fM(),p=hy(s),m=a?hy(a):null,g=oy(s.keywords??null,"defender",h.defender),b=a?oy(a.keywords??null,"attacker",h.attacker):null,S=m??yM();g&&g.runTick(p,S),b&&m&&b.runTick(m,p);const E=p.health>0,M=qn(p.shield);g&&g.grantShield(p,S);const N=qn(p.shield),_=E?Math.max(l,u-f):0,U=E?Math.min(N,_):0,H=E?Math.max(0,_-U):0;p.shield=Math.max(0,N-U);const I=Math.min(M,U),$=Math.max(0,U-I);g&&$>0&&g.consumeShield($,p,S);const P=g?g.getShieldValue():0;h.defender.keywordShieldRemaining=P;const ie=Math.max(0,M-I);p.shield=ie+P;const se=p.health;p.health=Math.max(0,se-H);const oe=p.health,ee=oe<=0;let Y=0;b&&m?(Y=b.applyHit(H,m,p),h.attacker.keywordShieldRemaining=b.getShieldValue()):h.attacker.keywordShieldRemaining=0;const R=uy(a,m??void 0),k=uy(s,{health:oe,shield:ie+P}),A={attacker:R,defender:k,damage:_,shieldDamage:U,hpDamage:H,lethal:ee},F={...A,source:"defender"};if(cc(s,"onHit",F),lc("combat:onHit",F),a){const B={...A,source:"attacker"};cc(a,"onHit",B),lc("combat:onHit",B),ee&&(cc(a,"onKill",B),lc("combat:onKill",B))}return ee&&(cc(s,"onKill",F),lc("combat:onKill",F)),{damage:_,shieldDamage:U,hpDamage:H,lethal:ee,remainingHealth:oe,remainingShield:ie+P,attackerHealing:Y,attackerRemainingHealth:m?.health,attackerRemainingShield:m?.shield,keywordEffects:h}}const my=5;function hn(n){return`${n.q},${n.r}`}function py(n){const[a,s]=n.split(",").map(Number);return{q:a,r:s}}function Xs(n){return{q:n.q,r:n.r}}class vM{constructor(a,s,r,l,u,f=[]){this.id=a,this.type=s,this.faction=l,this.stats=u,this.priorityFactions=f,this.coord=Xs(r),this.renderCoord=Xs(r),this.maxHealth=u.health}alive=!0;listeners={};maxHealth;healMarkerElapsed=0;healAmountBuffer=0;cachedTargetKey;cachedStartKey;cachedPath;movementCooldownSeconds=0;shield=0;immortal=!1;experience=0;combatHooks=null;combatKeywords=null;coord;renderCoord;setCoord(a,s){this.coord=Xs(a),(s?.snapRender??!0)&&(this.renderCoord=Xs(a))}setRenderCoord(a){this.renderCoord=Xs(a)}snapRenderToCoord(a=this.coord){this.renderCoord=Xs(a)}onDeath(a){(this.listeners.death??=[]).push(a)}emitDeath(){for(const a of this.listeners.death??[])a()}isDead(){return!this.alive}getMaxHealth(){return this.maxHealth}distanceTo(a){return Zs(this.coord,a)}getVisionRange(){const{visionRange:a}=this.stats;return Number.isFinite(a)?a:3}attack(a){return this.distanceTo(a.coord)>this.stats.attackRange?null:a.takeDamage(this.stats.attackDamage,this)}update(a,s){if(!(this.isDead()||!s))if(Zs(this.coord,s.pos)<=s.auraRadius){const r=this.stats.health;if(this.stats.health=Math.min(this.stats.health+s.regenPerSec*a,this.maxHealth),this.stats.health>r){const l=this.stats.health-r;this.healMarkerElapsed+=a,this.healAmountBuffer+=l,(this.healMarkerElapsed>=.9||this.healAmountBuffer>=2)&&this.flushHealEvent()}}else this.healAmountBuffer>0&&this.flushHealEvent(),this.healMarkerElapsed=0,this.healAmountBuffer=0}flushHealEvent(){if(this.healAmountBuffer<=0){this.healMarkerElapsed=0;return}const a=Math.round(this.healAmountBuffer*10)/10;a>0&&ne.emit("unitHealed",{unitId:this.id,amount:a,remainingHealth:this.stats.health}),this.healAmountBuffer=0,this.healMarkerElapsed=0}takeDamage(a,s){const r=Number.isFinite(a);if(r&&a<=0||!r&&!s)return null;const l=s?s.toCombatParticipant():null,u=this.toCombatParticipant(),f=bM({attacker:l,defender:u,baseDamage:r?a:void 0});this.stats.health=f.remainingHealth,this.shield=f.remainingShield;let h=f;if(f.lethal&&this.alive&&this.immortal&&(this.stats.health=Math.max(1,this.stats.health),h={...f,lethal:!1,remainingHealth:this.stats.health,remainingShield:this.shield}),s&&f.attackerRemainingHealth!==void 0){const p=Math.min(s.getMaxHealth(),Math.max(0,f.attackerRemainingHealth));s.stats.health=p}return s&&f.attackerRemainingShield!==void 0&&s.setShield(f.attackerRemainingShield),h.damage>0&&ne.emit("unitDamaged",{attackerId:s?.id,targetId:this.id,amount:h.damage,remainingHealth:this.stats.health}),h.lethal&&this.alive&&(this.stats.health=0,this.alive=!1,this.snapRenderToCoord(),ne.emit("unitDied",{unitId:this.id,attackerId:s?.id,unitFaction:this.faction,attackerFaction:s?.faction}),this.emitDeath()),h}getShield(){return this.shield}setShield(a){if(!Number.isFinite(a)||a<=0){this.shield=0;return}this.shield=a}updateStats(a){this.stats.attackDamage=a.attackDamage,this.stats.attackRange=a.attackRange,this.stats.movementRange=a.movementRange,typeof a.defense=="number"&&Number.isFinite(a.defense)?this.stats.defense=a.defense:delete this.stats.defense,typeof a.visionRange=="number"&&Number.isFinite(a.visionRange)&&(this.stats.visionRange=a.visionRange);const s=Math.max(1,Math.round(a.health));this.maxHealth=s,this.stats.health=Math.min(s,Math.max(0,this.stats.health))}isImmortal(){return this.immortal}setImmortal(a){this.immortal=!!a}getExperience(){return this.experience}setExperience(a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;s!==this.experience&&(this.experience=s,ne.emit("unit:xpChanged",{unitId:this.id,xp:this.experience}))}addExperience(a){if(!Number.isFinite(a)||a===0)return this.experience;const s=Math.max(0,Math.floor(this.experience+a));return this.setExperience(s),this.experience}toCombatParticipant(){return{id:this.id,faction:this.faction,attack:this.stats.attackDamage,defense:this.stats.defense,health:this.stats.health,maxHealth:this.maxHealth,shield:this.shield,hooks:this.combatHooks,keywords:this.combatKeywords}}addMovementTime(a){!Number.isFinite(a)||a<=0||(this.movementCooldownSeconds+=a)}canStep(a=my){return this.movementCooldownSeconds>=a}consumeMovementCooldown(a=my){return this.canStep(a)?(this.movementCooldownSeconds-=a,!0):!1}moveTowards(a,s,r){const l=this.getPathTo(a,s,r);if(l.length<2)return[];let u=0;const f=hn(a);for(let p=1;p<l.length;p++){const m=hn(l[p]);if(r.has(m)){m!==f&&this.clearPathCache();break}u=p}if(u===0)return[];const h=Math.min(this.stats.movementRange,u);return l.slice(0,h+1)}getPathTo(a,s,r){const l=hn(this.coord),u=hn(a);return(!this.cachedPath||this.cachedTargetKey!==u||this.cachedStartKey!==l)&&(this.cachedPath=this.findPath(a,s,r),this.cachedTargetKey=u,this.cachedStartKey=l),this.cachedPath}advancePathCache(a){!this.cachedPath||a<=0||(this.cachedPath=this.cachedPath.slice(a),this.cachedPath.length>0?this.cachedStartKey=hn(this.cachedPath[0]):(this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0))}clearPathCache(){this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0}findPath(a,s,r){const l=this.coord,u=hn(l),f=hn(a),h=new Set([u]),p=new Map([[u,null]]),m=new Map([[u,0]]),g=new Map([[u,Zs(l,a)]]);for(;h.size>0;){let E=null,M=1/0;for(const U of h){const H=g.get(U)??1/0;H<M&&(M=H,E=U)}if(E===null||E===f)break;h.delete(E);const N=py(E),_=m.get(E)??1/0;for(const U of Oc(N)){const H=hn(U);if(H!==f&&!this.isPassable(U,s,r))continue;const I=_+1;I<(m.get(H)??1/0)&&(p.set(H,E),m.set(H,I),g.set(H,I+Zs(U,a)),h.add(H))}}if(!p.has(f))return[l];const b=[];let S=f;for(;S;)b.push(py(S)),S=p.get(S)??null;return b.reverse()}seekNearestEnemy(a,s,r){const l=new Map;for(const h of a)l.set(hn(h.coord),h);const u=[this.coord],f=new Set([hn(this.coord)]);for(;u.length>0;){const h=u.shift(),p=hn(h),m=l.get(p);if(m)return m;for(const g of Oc(h)){const b=hn(g),S=l.get(b);if(S)return S;this.isPassable(g,s,r)&&(f.has(b)||(f.add(b),u.push(g)))}}return null}canTraverse(a,s,r){return this.isPassable(a,s,r)}isPassable(a,s,r){const l=s.getTile(a.q,a.r);return!l||r&&r.has(hn(a))?!1:l.terrain!==xn.Lake}}class SM{static selectTarget(a,s){let r=s.filter(u=>u.faction!==a.faction&&!u.isDead());if(r.length===0)return null;if(a.priorityFactions.length>0){const u=r.filter(f=>a.priorityFactions.includes(f.faction));u.length>0&&(r=u)}const l=r.filter(u=>a.distanceTo(u.coord)<=a.stats.attackRange);return l.length>0?(l.sort((u,f)=>u.stats.health-f.stats.health),l[0]):(r.sort((u,f)=>a.distanceTo(u.coord)-a.distanceTo(f.coord)),r[0]??null)}}const EM=4,MM=8;class xM{buckets=[];bucketCount=0;currentBucket=0;minBuckets;maxBuckets;constructor(a={}){this.minBuckets=a.minBuckets??EM,this.maxBuckets=a.maxBuckets??MM}reset(){this.buckets=[],this.bucketCount=0,this.currentBucket=0}next(a){const s=a.length;if(s===0)return this.reset(),[];const r=this.computeBucketCount(s);r!==this.bucketCount&&(this.bucketCount=r,this.currentBucket=this.currentBucket%Math.max(1,r)),this.rebuildBuckets(a);const l=this.buckets[this.currentBucket]??[];return this.bucketCount>0&&(this.currentBucket=(this.currentBucket+1)%this.bucketCount),l}rebuildBuckets(a){const s=this.bucketCount;this.buckets=Array.from({length:s},()=>[]);const r=[...a].sort((l,u)=>l.id.localeCompare(u.id));for(let l=0;l<r.length;l++){const u=l%s;this.buckets[u].push(r[l])}}computeBucketCount(a){if(a<=0)return 0;const s=Math.ceil(a/12);let r=Math.max(this.minBuckets,s);return r=Math.min(this.maxBuckets,r),r=Math.min(r,a),r=Math.max(1,r),r}}function Cf(n){return`${n.q},${n.r}`}const wM=500;class AM{cache=new Map;targetIndex=new Map;targetPositions=new Map;ttlMs;constructor(a=wM){this.ttlMs=a}clearExpired(a=Date.now()){for(const[s,r]of this.cache.entries())if(r.expiresAt<=a&&(this.cache.delete(s),r.targetId)){const l=this.targetIndex.get(r.targetId);l?.delete(s),l&&l.size===0&&this.targetIndex.delete(r.targetId)}}trackUnit(a){this.invalidateIfTargetMoved(a.id,Cf(a.coord))}invalidateForUnit(a){const s=this.targetIndex.get(a);if(s){for(const r of s)this.cache.delete(r);this.targetIndex.delete(a)}this.targetPositions.delete(a)}getPath(a,s,r,l,u={}){const f=u.now??Date.now(),h=u.targetId,p=Cf(s);h&&this.invalidateIfTargetMoved(h,p);const m=this.hashObstacles(l),g=this.createCacheKey(Cf(a.coord),p,m),b=this.cache.get(g);if(b&&b.expiresAt>f)return b.path;a.clearPathCache();const S=a.getPathTo(s,r,l);if(this.cache.set(g,{path:S,expiresAt:f+this.ttlMs,targetId:h}),h){let E=this.targetIndex.get(h);E||(E=new Set,this.targetIndex.set(h,E)),E.add(g),this.targetPositions.set(h,p)}return S}invalidateIfTargetMoved(a,s){const r=this.targetPositions.get(a);if(!r){this.targetPositions.set(a,s);return}if(r===s)return;const l=this.targetIndex.get(a);if(l){for(const u of l)this.cache.delete(u);l.clear()}this.targetPositions.set(a,s)}hashObstacles(a){return a.size===0?"empty":Array.from(a).sort().join("|")}createCacheKey(a,s,r){return`${a}->${s}|${r}`}}const CM={baseThreshold:50,heatPerSecond:50/30,thresholdGrowth:.05,coolingPerSecond:0};function Ht(n,a=0){return Number.isFinite(n)?n:a}class TM{heat;threshold;baseThreshold;thresholdGrowthFactor;heatPerSecond;coolingPerSecond;maxStoredHeat;constructor(a={}){const s={...CM,...a},r=Math.max(1,Ht(s.baseThreshold,50)),l=Math.max(1,Ht(a.initialThreshold??r,r));this.baseThreshold=r,this.threshold=l,this.thresholdGrowthFactor=1+Math.max(0,Ht(s.thresholdGrowth,0)),this.heatPerSecond=Math.max(0,Ht(s.heatPerSecond,0)),this.coolingPerSecond=Math.max(0,Ht(s.coolingPerSecond,0));const u=Ht(s.maxStoredHeat??Number.NaN,Number.NaN);this.maxStoredHeat=Number.isFinite(u)&&u>=0?u:null;const f=Math.max(0,Ht(a.initialHeat??0,0));this.heat=this.setHeatInternal(f)}getHeat(){return this.heat}getThreshold(){return this.threshold}getBuildRate(){return this.heatPerSecond}getCoolingRate(){return this.coolingPerSecond}reset(){this.heat=0,this.threshold=this.baseThreshold}setHeat(a){const s=Math.max(0,Ht(a,0));return this.heat=this.setHeatInternal(s),this.heat}setHeatInternal(a){const s=Math.max(0,Ht(a,0));return this.maxStoredHeat===null?(this.heat=s,this.heat):(this.heat=Math.min(s,this.maxStoredHeat),this.heat)}addHeat(a){const s=Math.max(0,Ht(a,0));if(s<=0)return 0;const r=this.heat,l=r+s;return this.heat=this.maxStoredHeat===null?l:Math.min(l,this.maxStoredHeat),this.heat-r}cool(a){const s=Math.max(0,Ht(a,0));if(s<=0||this.heat<=0)return 0;const r=this.heat;return this.heat=Math.max(0,this.heat-s),r-this.heat}vent(a=1){const s=Math.max(0,Math.min(1,Ht(a,1)));return s<=0?0:this.cool(this.threshold*s)}advance(a,s){const r=Math.max(0,Ht(a,0)),l=this.heatPerSecond,u=r>0?l*r:0,f=Math.max(0,Ht(s?.bonusHeat??0,0)),h=u+f,p=this.addHeat(h),m=Math.max(0,Ht(s?.coolingMultiplier??1,1)),g=r>0?this.coolingPerSecond*r*m:0,b=this.cool(g);return{addedHeat:p,cooledHeat:b,heat:this.heat}}hasTriggerReady(){return this.heat>=this.threshold-1e-6}consumeTrigger(){return this.hasTriggerReady()?(this.cool(this.threshold),this.threshold=Math.max(this.baseThreshold,this.threshold*this.thresholdGrowthFactor),!0):!1}timeUntilNextTrigger(){return this.hasTriggerReady()?0:this.heatPerSecond<=0?Number.POSITIVE_INFINITY:Math.max(0,this.threshold-this.heat)/this.heatPerSecond}getCooldownSeconds(){return this.heatPerSecond<=0?Number.POSITIVE_INFINITY:this.threshold/this.heatPerSecond}}function _M(n){return new TM(n)}const gy=500;function eb(n,a,s){const r=typeof a=="number"?a:2,l=(typeof a=="number"?s:a)??[],u=[];for(let h=-r;h<=r;h++){const p=Math.max(-r,-h-r),m=Math.min(r,-h+r);for(let g=p;g<=m;g++){const b=Math.max(Math.abs(h),Math.abs(g),Math.abs(-h-g));if(b===0||b>r)continue;const S={q:n.q+h,r:n.r+g};l.some(M=>!M.isDead()&&M.coord.q===S.q&&M.coord.r===S.r)||u.push(S)}}if(u.length===0)return null;const f=Math.floor(Math.random()*u.length);return u[f]}function RM(n,a,s={}){const r=_M(a),l=r.getBuildRate(),u=r.getCooldownSeconds(),f=r.timeUntilNextTrigger(),h=Number.isFinite(s.maxRosterSize)?Math.max(0,Math.floor(s.maxRosterSize??0)):0,p=Number.isFinite(s.maxHealth)?Math.max(1,Math.floor(s.maxHealth??gy)):gy,m=Number.isFinite(s.health)?Math.max(0,Math.min(p,Math.floor(s.health??p))):p;return{id:"sauna",pos:n,auraRadius:2,regenPerSec:1,rallyToFront:!1,maxRosterSize:h,maxHealth:p,health:m,destroyed:m<=0,heat:r.getHeat(),heatPerTick:l,playerSpawnThreshold:r.getThreshold(),playerSpawnCooldown:Number.isFinite(u)?u:0,playerSpawnTimer:Number.isFinite(f)?f:0,beerUpkeepAccumulator:0,heatTracker:r}}function NM(n,a){if(!Number.isFinite(a)||a<=0||n.destroyed)return{amount:0,remainingHealth:Math.max(0,n.health),destroyed:n.destroyed};const s=Math.max(0,n.health),r=Math.min(s,Math.max(0,Math.floor(a))),l=Math.max(0,s-r);return n.health=l,l<=0&&(n.health=0,n.destroyed=!0),{amount:r,remainingHealth:n.health,destroyed:n.destroyed}}const kM=30;function jt(n){return`${n.q},${n.r}`}class DM{constructor(a,s){this.map=a,this.animator=s}scheduler=new xM;pathCache=new AM;lastKnownCoords=new Map;findExplorationGoal(a,s){const r=a.coord;if(this.map.ensureTile(r.q,r.r).isFogged&&a.canTraverse(r,this.map,s))return r;const u=new Set([jt(r)]),f=[r];for(;f.length>0;){const h=f.shift(),p=Oc(h),m=this.map.getNeighbors(h.q,h.r);for(let g=0;g<p.length;g++){const b=p[g],S=m[g],E=jt(b);if(!u.has(E)&&(u.add(E),!!a.canTraverse(b,this.map,s))){if(S.isFogged)return b;f.push(b)}}}return null}tick(a,s,r){const l=a.length,u=Date.now();if(this.pathCache.clearExpired(u),l===0){this.scheduler.reset();return}const f=new Set,h=[],p=new Set;for(const g of a){if(g.addMovementTime(s),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g),this.lastKnownCoords.delete(g.id);continue}const b=this.lastKnownCoords.get(g.id);b&&Zs(b,g.coord)>1&&this.animator?.clear(g,{snap:!0}),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r}),this.pathCache.trackUnit(g),h.push(g),f.add(jt(g.coord)),p.add(g.id)}for(const g of[...this.lastKnownCoords.keys()])p.has(g)||this.lastKnownCoords.delete(g);if(h.length===0){this.scheduler.reset();return}const m=this.scheduler.next(h);if(m.length!==0)for(const g of m){const b=jt(g.coord);if(f.delete(b),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g);continue}const S=SM.selectTarget(g,a);if(!S&&r&&!r.destroyed&&this.tryAttackSauna(g,r)){const H=jt(g.coord);f.add(H);continue}if(!S){let U=null;if(r&&!r.destroyed&&(U=r.pos),U||(U=this.findExplorationGoal(g,f)),U){const I=this.computeMovementPath(g,U,f,u);if(I.length>1&&g.stats.movementRange>0){const $=I[1],P=jt($);if(f.has(P))g.clearPathCache();else{if(!g.canStep()){f.add(b);continue}if(g.consumeMovementCooldown()){const ie={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord($,{snapRender:!1}),this.animator.enqueue(g,[ie,$])):g.setCoord($),g.advancePathCache(1);const se=jt(g.coord);se===jt(U)&&g.clearPathCache(),f.add(se),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});continue}}}else g.clearPathCache()}else g.clearPathCache();const H=jt(g.coord);f.add(H),r&&!r.destroyed&&this.tryAttackSauna(g,r);continue}if(S.isDead()){g.clearPathCache(),f.add(b);continue}const E=jt(S.coord),M=this.pathCache.getPath(g,S.coord,this.map,f,{now:u,targetId:S.id});if(M.length>1&&g.stats.movementRange>0){const U=M[1],H=jt(U),I=H===E;if(!f.has(H)||I){if(g.canStep()&&g.consumeMovementCooldown()){const $={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(U,{snapRender:!1}),this.animator.enqueue(g,[$,U])):g.setCoord(U),g.advancePathCache(1)}}else g.clearPathCache()}const N=jt(g.coord);f.add(N),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});const _=jt(S.coord);_!==E&&g.clearPathCache(),g.distanceTo(S.coord)<=g.stats.attackRange&&!S.isDead()&&((g.attack(S)?.lethal??!1)||S.isDead())&&(f.delete(_),g.clearPathCache(),this.pathCache.invalidateForUnit(S.id),this.animator?.clear(S))}}tryAttackSauna(a,s){if(a.faction==="player")return!1;const r=a.stats.attackRange;if(r<=0||a.distanceTo(s.pos)>r)return!1;const l=NM(s,a.stats.attackDamage);if(l.amount<=0)return!1;const u={attackerId:a.id,attackerFaction:a.faction,amount:l.amount,remainingHealth:l.remainingHealth};if(ne.emit("saunaDamaged",u),l.destroyed){const f={attackerId:a.id,attackerFaction:a.faction};ne.emit("saunaDestroyed",f)}return!0}computeMovementPath(a,s,r,l){const u=this.pathCache.getPath(a,s,this.map,r,{now:l});if(u.length<2)return[];let f=0;const h=jt(s);for(let m=1;m<u.length;m++){const g=jt(u[m]);if(r.has(g)){g!==h&&a.clearPathCache();break}f=m}if(f===0)return[];const p=Math.min(a.stats.movementRange,f);return u.slice(0,p+1)}}function lu(n){if(!Number.isFinite(n??NaN))return 1;const a=Math.floor(n);return Math.max(1,a)}function LM(n){return Math.max(0,lu(n)-1)}function UM(n,a="linear"){const s=LM(n);switch(a){case"accelerating":return s*(s+1)/2;case"diminishing":return s===0?0:Math.log2(s+1);case"linear":default:return s}}function OM(n,a="round"){switch(a){case"floor":return Math.floor(n);case"ceil":return Math.ceil(n);case"none":return n;case"round":default:return Math.round(n)}}function qM(n,a,s){let r=n;return Number.isFinite(a)&&(r=Math.max(r,a)),Number.isFinite(s)&&(r=Math.min(r,s)),r}function uo(n,a){const s=lu(a),r=n.curve??"linear",l=UM(s,r),u=n.base+n.growth*l,f=qM(u,n.min,n.max);return OM(f,n.round??"round")}function Ho(n,a){const s=lu(a),r=n.stats,l={health:uo(r.health,s),attackDamage:uo(r.attackDamage,s),attackRange:uo(r.attackRange,s),movementRange:uo(r.movementRange,s)};return r.visionRange&&(l.visionRange=uo(r.visionRange,s)),l}function yy(n){if(typeof n=="number"&&Number.isFinite(n))return n}function Ic(n,a){let s=n.health,r=n.attackDamage,l=n.attackRange,u=n.movementRange,f=yy(n.defense),h=yy(n.shield);for(const m of a){const g=Math.max(1,Math.round(m.quantity)),b=m.modifiers;typeof b.health=="number"&&(s+=b.health*g),typeof b.attackDamage=="number"&&(r+=b.attackDamage*g),typeof b.attackRange=="number"&&(l+=b.attackRange*g),typeof b.movementRange=="number"&&(u+=b.movementRange*g),typeof b.defense=="number"&&(f=(f??0)+b.defense*g),typeof b.shield=="number"&&(h=(h??0)+b.shield*g)}const p={health:Math.max(1,Math.round(s)),attackDamage:Math.max(0,Math.round(r)),attackRange:Math.max(0,Math.round(l)),movementRange:Math.max(0,Math.round(u))};return f!==void 0&&(p.defense=Math.max(0,Math.round(f))),h!==void 0&&(p.shield=Math.max(0,Math.round(h))),typeof n.visionRange=="number"&&Number.isFinite(n.visionRange)&&(p.visionRange=Math.max(0,Math.round(n.visionRange))),p}const Vh=Object.freeze({id:"soldier",displayName:"Sauna Soldier",cost:50,tags:["infantry","melee"],stats:{health:{base:20,growth:6,curve:"linear",round:"round"},attackDamage:{base:5,growth:1,curve:"linear",round:"round"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:0,round:"round"}}}),Xh=Object.freeze({id:"archer",displayName:"Sauna Archer",cost:75,tags:["ranged"],stats:{health:{base:15,growth:4,curve:"linear",round:"round"},attackDamage:{base:3,growth:.4,curve:"accelerating",round:"ceil"},attackRange:{base:3,growth:.5,curve:"diminishing",round:"ceil",max:5},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:.25,curve:"linear",round:"round",max:5}}}),tb=Object.freeze({id:"avanto-marauder",displayName:"Avanto Marauder",cost:0,tags:["enemy","melee"],stats:{health:{base:12,growth:5,curve:"linear",round:"round"},attackDamage:{base:4,growth:.6,curve:"accelerating",round:"ceil"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:.25,curve:"linear",round:"round",max:2},visionRange:{base:3,growth:0,round:"round"}}}),nb=Object.freeze({soldier:Vh,archer:Xh,"avanto-marauder":tb});function Kh(n){return nb[n]??null}Object.freeze(Object.keys(nb));const by=Vh.cost;Object.freeze(Ho(Vh,1));Xh.cost;Object.freeze(Ho(Xh,1));Object.freeze(Ho(tb,1));function ab(n,a,s,r,l){const u=lu(l?.level),f=Ho(n,u);return new vM(a,n.id,s,r,f,n.priorityFactions)}function ib(n,a,s,r,l){const u=Kh(n);return u?ab(u,a,s,r,l):null}function Qh(n,a,s,r,l,u){const f=Kh(a);if(!f)return null;const h=f.cost;if(!n.canAfford(h,ae.SAUNA_BEER))return ia("error"),null;n.addResource(ae.SAUNA_BEER,-h);const p=ab(f,s,r,l,u);return ia("spawn"),ne.emit("unitSpawned",{unit:p}),p}const zM=Object.freeze(Object.defineProperty({__proto__:null,createUnit:ib,spawnUnit:Qh},Symbol.toStringTag,{value:"Module"})),BM=["Aino","Eero","Ilona","Kalevi","Lumi","Mika","Noora","Oskari","Saana","Tapio","Veera","Yrj"],HM=["Emberguard","Frostwalker","Steamcaller","Dawnwatch","Gritforged","Stormchant","Snowborn","Torchbearer","Chillwarden","Sisuheart"],jM=["Aalto","Halla","Karhu","Korhonen","Laine","Mets","Niemi","Salmi","Tuomi","Virta"];function Tf(n,a){if(n.length===0)throw new Error("Cannot select a name from an empty collection.");const s=Math.floor(a()*n.length);return n[Math.min(s,n.length-1)]}function IM(n=Math.random){const a=Tf(BM,n),s=Tf(HM,n),r=Tf(jM,n);return`${a} "${s}" ${r}`}const ur=Object.freeze(["supply","weapon","focus","relic"]);function sb(){return{supply:null,weapon:null,focus:null,relic:null}}const GM=Object.freeze({supply:Object.freeze({id:"supply",label:"Supply Satchel",description:"Consumables and restorative provisions carried into battle.",maxStacks:5}),weapon:Object.freeze({id:"weapon",label:"Primary Armament",description:"The attendant's main weapon or ranged kit.",maxStacks:1}),focus:Object.freeze({id:"focus",label:"Battle Focus",description:"Tools that sharpen aim, steps, or battlefield intuition.",maxStacks:1}),relic:Object.freeze({id:"relic",label:"Sauna Relic",description:"Charms and relics that empower the attendant's resolve.",maxStacks:1})}),YM=Object.freeze({"birch-sap-satchel":Object.freeze({id:"birch-sap-satchel",slot:"supply",modifiers:{health:3},maxStacks:3}),"steamed-bandages":Object.freeze({id:"steamed-bandages",slot:"supply",modifiers:{shield:4},maxStacks:2}),"aurora-distillate":Object.freeze({id:"aurora-distillate",slot:"supply",modifiers:{attackDamage:2,defense:1},maxStacks:1}),"stolen-sauna-tokens":Object.freeze({id:"stolen-sauna-tokens",slot:"supply",modifiers:{movementRange:.5},maxStacks:5}),"midnight-bloodwine":Object.freeze({id:"midnight-bloodwine",slot:"supply",modifiers:{health:6,attackDamage:1},maxStacks:1}),"sauna-incense":Object.freeze({id:"sauna-incense",slot:"supply",modifiers:{attackRange:1},maxStacks:2}),"glacier-brand":Object.freeze({id:"glacier-brand",slot:"weapon",modifiers:{attackDamage:3},maxStacks:1}),"emberglass-arrow":Object.freeze({id:"emberglass-arrow",slot:"weapon",modifiers:{attackDamage:1,attackRange:2},maxStacks:1}),"aurora-lattice":Object.freeze({id:"aurora-lattice",slot:"focus",modifiers:{attackDamage:2,attackRange:1},maxStacks:1}),"emberglass-shard":Object.freeze({id:"emberglass-shard",slot:"focus",modifiers:{attackDamage:1,movementRange:1},maxStacks:1}),"windstep-totem":Object.freeze({id:"windstep-totem",slot:"focus",modifiers:{movementRange:1,defense:1},maxStacks:1}),"searing-chant-censer":Object.freeze({id:"searing-chant-censer",slot:"focus",modifiers:{attackDamage:2,shield:2},maxStacks:1}),"cracked-ice-amulet":Object.freeze({id:"cracked-ice-amulet",slot:"relic",modifiers:{defense:2},maxStacks:1}),"myrsky-charm":Object.freeze({id:"myrsky-charm",slot:"relic",modifiers:{attackRange:1,defense:1},maxStacks:1}),"frostwyrm-signet":Object.freeze({id:"frostwyrm-signet",slot:"relic",modifiers:{shield:5},maxStacks:1}),"spirit-oak-charm":Object.freeze({id:"spirit-oak-charm",slot:"relic",modifiers:{defense:1,health:2},maxStacks:1})});function jo(n){const a=GM[n];if(!a)throw new Error(`Unknown equipment slot: ${n}`);return a}function Io(n){return YM[n]}function rb(n){return Number.isFinite(n)?Math.max(1,Math.round(n)):1}function ob(n,a){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:a}}function lb(n,a,s,r){const l=jo(a),u=Math.max(1,Math.floor(s.maxStacks??l.maxStacks)),f=Math.min(u,r),h=s.modifiers??{};return{...ob(n,f),slot:a,maxStacks:u,modifiers:h}}function hh(n){n.equipment||(n.equipment=sb());for(const a of ur)n.equipment[a]??=null;return n.equipment}function Bn(n){const a=[];for(const s of ur){const r=n[s];r&&a.push({...r})}return a}function Ph(n){return Bn(n).map(a=>ob(a,a.quantity))}function _f(n){const a=sb();for(const s of n){const r=Io(s.id);if(!r)continue;const l=rb(s.quantity),u=a[r.slot];if(u&&u.id!==s.id)continue;const f=(u?.quantity??0)+l,h=lb(s,r.slot,r,f);a[r.slot]=h}return a}function FM(n,a){const s=Io(a.id);if(!s)return{success:!1,slot:"supply",loadout:Bn(hh(n)),item:null,reason:"unknown-item"};const r=hh(n),l=s.slot,u=jo(l),f=rb(a.quantity),h=Math.max(1,Math.floor(s.maxStacks??u.maxStacks)),p=r[l];if(p&&p.id!==a.id)return{success:!1,slot:l,loadout:Bn(r),item:p,reason:"slot-occupied"};const m=Math.min(h,(p?.quantity??0)+f);if((p?.quantity??0)+f>h)return{success:!1,slot:l,loadout:Bn(r),item:p,reason:"stack-limit"};const g=lb(a,l,s,m);return r[l]=g,n.items=Ph(r),{success:!0,slot:l,loadout:Bn(r),item:g}}function $M(n,a){const s=hh(n),r=s[a];return r?(s[a]=null,n.items=Ph(s),{success:!0,slot:a,loadout:Bn(s),removed:r}):{success:!1,slot:a,loadout:Bn(s),removed:null,reason:"empty-slot"}}function VM(n,a){return Io(n)?.slot===a}const XM={q:0,r:0},KM="Saunoja",mh=18,vy=0,ar=0,kc=10,Sy=1,uc={health:mh,attackDamage:4,attackRange:1,movementRange:1,defense:0,shield:0};function dc(n,a,s){return Math.min(Math.max(n,a),s)}function fc(n,a,s){const r=typeof n=="number"&&Number.isFinite(n)?n:a;return Math.max(s,r)}function Rf(n,a,s=0){if(typeof n=="number"&&Number.isFinite(n))return Math.max(s,n);if(typeof a=="number"&&Number.isFinite(a))return Math.max(s,a)}function Ey(n,a){if(!n||typeof n!="object")return{...a};const s=n,r=fc(s.health,a.health,1),l=fc(s.attackDamage,a.attackDamage,0),u=fc(s.attackRange,a.attackRange,0),f=fc(s.movementRange,a.movementRange,0),h=Rf(s.defense,a.defense,0),p=Rf(s.shield,a.shield,0),m=Rf(s.visionRange,a.visionRange,0);return{health:r,attackDamage:l,attackRange:u,movementRange:f,defense:h,shield:p,visionRange:m}}function QM(n,a){if(!n||typeof n!="object")return _f(a);const s=n,r=[];for(const l of Object.values(s)){const u=cb(l);u&&r.push(u)}return r.length===0?_f(a):_f(r)}function cb(n){if(!n||typeof n!="object")return null;const a=n,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const l=typeof a.description=="string"?a.description.trim():void 0,u=typeof a.icon=="string"?a.icon.trim():void 0,f=typeof a.rarity=="string"?a.rarity.trim():void 0,h=typeof a.quantity=="number"?a.quantity:Number(a.quantity),p=Number.isFinite(h)?Math.max(1,Math.round(h)):1;return{id:s,name:r,description:l,icon:u,rarity:f,quantity:p}}function PM(n){if(!n||n.length===0)return[];const a=[];for(const s of n){const r=cb(s);r&&a.push(r)}return a}function ZM(n){if(!n||typeof n!="object")return null;const a=n,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const l=a.duration;let u=1/0;typeof l=="number"&&Number.isFinite(l)?u=Math.max(0,l):l!==1/0&&(u=1/0);const f=a.remaining;let h=u;typeof f=="number"&&Number.isFinite(f)?h=Math.max(0,f):f===1/0&&(h=1/0),u!==1/0&&h===1/0&&(h=u);const p=a.appliedAt,m=typeof p=="number"&&Number.isFinite(p)?Math.max(0,p):void 0,g=a.stacks,b=typeof g=="number"&&Number.isFinite(g)?Math.max(1,Math.round(g)):void 0,S=typeof a.description=="string"?a.description.trim():void 0,E=typeof a.source=="string"?a.source.trim():void 0;return{id:s,name:r,description:S,duration:u,remaining:h,appliedAt:m,stacks:b,source:E}}function JM(n){if(!n||n.length===0)return[];const a=[];for(const s of n){const r=ZM(s);r&&a.push(r)}return a}function WM(n){if(typeof n=="string"){const a=n.trim();if(a.length>0)return a}try{return IM()}catch(a){return console.warn("Falling back to default Saunoja name",a),KM}}function Zh(n){const{id:a,name:s,coord:r=XM,maxHp:l=mh,hp:u=l,steam:f=0,defense:h,shield:p=0,traits:m=[],upkeep:g=Sy,xp:b=0,lastHitAt:S=vy,selected:E=!1,items:M,modifiers:N,combatKeywords:_=null,combatHooks:U=null}=n,H=Number.isFinite(l)?Math.max(1,l):mh,I=Number.isFinite(u)?u:H,$=dc(I,0,H),P=Number.isFinite(f)?f:0,ie=dc(P,0,1),oe=(Array.isArray(m)?m:[]).filter(Ft=>typeof Ft=="string").map(Ft=>Ft.trim()).filter(Ft=>Ft.length>0),ee=Number.isFinite(g)?g:Sy,Y=dc(ee,ar,kc),R=Number.isFinite(b)?b:0,k=Math.max(0,R),A=Number.isFinite(S)?S:vy,F=Math.max(0,A),B=Number.isFinite(p)?p:0,T=Math.max(0,B),G=Number.isFinite(h)?h:void 0,J=G!==void 0?Math.max(0,G):void 0,fe=PM(M),x=JM(N),V=QM(n.equipment,fe),te=Ph(V),W={...uc,health:H,defense:J??uc.defense,shield:uc.shield},le=Ey(n.baseStats,W),pe={...le,health:H,defense:J??le.defense,shield:T},he=Ey(n.effectiveStats,pe),Ge=Math.max(1,he.health),Ae=dc($,0,Ge),Ct=typeof he.defense=="number"?Math.max(0,he.defense):J??void 0,Wt=typeof he.shield=="number"?Math.max(0,he.shield):T,wn={...le,health:Math.max(1,le.health),defense:typeof le.defense=="number"?Math.max(0,le.defense):J??void 0,shield:typeof le.shield=="number"?Math.max(0,le.shield):uc.shield},en={...he,health:Ge,defense:Ct,shield:Wt},Yt=WM(s);return{id:a,name:Yt,coord:{q:r.q,r:r.r},maxHp:Ge,hp:Ae,defense:Ct,shield:Wt,steam:ie,traits:[...oe],upkeep:Y,xp:k,lastHitAt:F,selected:E,items:te,baseStats:wn,effectiveStats:en,equipment:V,modifiers:x,combatKeywords:_,combatHooks:U}}const dr=32;function Co(n,a,s,r){n.beginPath();for(let l=0;l<6;l++){const u=Math.PI/3*l,f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function Jh(n,a,s){return Math.min(Math.max(n,a),s)}function e3(n,{centerX:a,centerY:s,hp:r,maxHp:l,radius:u=dr*.55}){const f=Number.isFinite(l)?Math.max(1,l):1,h=Number.isFinite(r)?r:f,p=Jh(h/f,0,1);if(n.save(),Co(n,a,s,u),n.fillStyle="rgba(7, 11, 18, 0.72)",n.fill(),n.restore(),p>0){n.save(),Co(n,a,s,u),n.clip();const m=n.createLinearGradient(a,s+u,a,s-u);m.addColorStop(0,"rgba(46, 160, 98, 0.35)"),m.addColorStop(1,"rgba(218, 255, 239, 0.95)"),n.fillStyle=m;const g=u*2*p,b=s+u-g;n.fillRect(a-u,b,u*2,g),n.restore()}n.save(),Co(n,a,s,u),n.lineWidth=Math.max(1,u*.12),n.strokeStyle="rgba(255, 255, 255, 0.28)",n.stroke(),n.restore()}function t3(n,{centerX:a,centerY:s,radius:r=dr,progress:l=0}){const u=Jh(l,0,1);if(u<=0)return;const f=Number.isFinite(r)&&r>0?r:dr;n.save(),n.globalCompositeOperation="lighter",n.globalAlpha=u;const h=n.createRadialGradient(a,s,Math.max(1,f*.1),a,s,f);h.addColorStop(0,"rgba(255, 255, 255, 0.92)"),h.addColorStop(.45,"rgba(255, 255, 255, 0.68)"),h.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=h,n.beginPath(),n.arc(a,s,f,0,Math.PI*2),n.fill(),n.restore()}function n3(n,{centerX:a,centerY:s,radius:r=dr*.85,intensity:l=1}){const u=Jh(l,0,1);if(u<=0)return;n.save(),Co(n,a,s,r),n.clip();const f=n.createLinearGradient(a,s+r,a,s-r);f.addColorStop(0,"rgba(255, 255, 255, 0)"),f.addColorStop(.55,`rgba(255, 255, 255, ${.12*u})`),f.addColorStop(1,`rgba(255, 255, 255, ${.35*u})`),n.globalCompositeOperation="lighter",n.fillStyle=f,n.fillRect(a-r,s-r,r*2,r*2),n.restore(),n.save(),n.globalCompositeOperation="lighter",n.lineCap="round",n.strokeStyle=`rgba(255, 255, 255, ${.25*u})`,n.lineWidth=Math.max(1,r*.08);const h=r*.75,p=r*.35;for(let m=0;m<3;m++){const g=s-r*.5+m*p;n.beginPath(),n.moveTo(a-h,g),n.bezierCurveTo(a-h*.4,g-r*.4,a+h*.4,g+r*.2,a+h,g-r*.45),n.stroke()}n.restore()}function ph(n,a,s){return n<a?a:n>s?s:n}const Nf=Object.freeze([{id:"skirmish",label:"Skirmish Patrols",minRunSeconds:0,minClears:0,cadence:26,multiplier:1,bundleTier:0},{id:"raids",label:"Raid Pressure",minRunSeconds:90,minClears:2,cadence:19,multiplier:1.35,bundleTier:1},{id:"siege",label:"Siege Lines",minRunSeconds:210,minClears:5,cadence:13,multiplier:1.8,bundleTier:2},{id:"onslaught",label:"Winter Onslaught",minRunSeconds:360,minClears:9,cadence:8.5,multiplier:2.45,bundleTier:3},{id:"maelstrom",label:"Glacier Maelstrom",minRunSeconds:540,minClears:14,cadence:6.2,multiplier:3.25,bundleTier:4}]);function a3(n){return n>=1?1/(1+(n-1)*.45):1+(1-n)*.35}function i3(n){if(n>=1)return 1+(n-1)*.85;const a=1-n;return ph(1-a*.4,.45,1)}function s3(n){return{runSeconds:Math.max(0,Number.isFinite(n.runSeconds)?n.runSeconds:0),clears:Math.max(0,Number.isFinite(n.clears)?n.clears:0),spawnCycles:Math.max(0,Number.isFinite(n.spawnCycles)?n.spawnCycles:0)}}function My(n,a){const s=s3(a);let r=0;for(let m=0;m<Nf.length;m+=1){const g=Nf[m];if(s.runSeconds<g.minRunSeconds||s.clears<g.minClears)break;r=m}const l=Nf[r],u=a3(n),f=i3(n),h=Math.max(.75,l.cadence*u),p=l.multiplier*f;return{stage:l,stageIndex:r,cadenceTarget:h,multiplierBase:p}}function xy(n){if(n>=1){const s=Math.min(3,n-1);return ph(.93-s*.035,.82,.93)}const a=Math.min(1,1-n);return ph(.93+a*.03,.9,.97)}function wy(n){if(n>=1)return .024+Math.min(3,n-1)*.012;const a=Math.min(1,1-n);return Math.max(.012,.024-a*.01)}const ub="deepwood",db="Deepwood Wardens",fb="Reclusive guardians attuned to sauna spirits.",hb=[{id:"warding-circle",label:"Warding Circle",weight:2,units:[{unit:"soldier",level:1,quantity:2},{unit:"archer",level:1,quantity:1}],items:["spirit-oak-charm","sauna-incense"],modifiers:["barkskin-ritual"]},{id:"spirit-strike",label:"Spirit Strike",weight:1,units:[{unit:"archer",level:2,quantity:2}],items:["emberglass-arrow"],modifiers:["searing-chant","windstep"]}],r3={id:ub,name:db,description:fb,bundles:hb},o3=Object.freeze(Object.defineProperty({__proto__:null,bundles:hb,default:r3,description:fb,id:ub,name:db},Symbol.toStringTag,{value:"Module"})),mb="enemy",pb="Avanto Marauders",gb="Frostbitten raiders who harry the sauna frontier.",yb=[{id:"iceblade-scouts",label:"Iceblade Scouts",weight:3,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:1}],items:["cracked-ice-amulet"],modifiers:["frost-resilience"]},{id:"raiding-party",label:"Raiding Party",weight:2,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:2}],items:["stolen-sauna-tokens"],modifiers:["berserker-drift"]},{id:"frost-champion",label:"Frost Champion",weight:1,minRampTier:0,units:[{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand"],modifiers:["glacial-ward"]},{id:"icebreaker-vanguard",label:"Icebreaker Vanguard",weight:2.5,minRampTier:1,units:[{unit:"avanto-marauder",level:2,quantity:2},{unit:"avanto-marauder",level:1,quantity:1}],items:["stormglass-pendant"],modifiers:["frost-resilience","berserker-drift"]},{id:"glacial-phalanx",label:"Glacial Phalanx",weight:2,minRampTier:2,units:[{unit:"avanto-marauder",level:3,quantity:3},{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand","frostshard-relic"],modifiers:["glacial-ward","polar-endurance"]},{id:"avalanche-warhost",label:"Avalanche Warhost",weight:1.25,minRampTier:3,units:[{unit:"avanto-marauder",level:4,quantity:3},{unit:"avanto-marauder",level:3,quantity:2}],items:["avalanche-totem"],modifiers:["glacial-ward","polar-endurance","berserker-drift"]}],l3={id:mb,name:pb,description:gb,bundles:yb},c3=Object.freeze(Object.defineProperty({__proto__:null,bundles:yb,default:l3,description:gb,id:mb,name:pb},Symbol.toStringTag,{value:"Module"})),u3=Object.assign({"../content/factions/deepwood.json":o3,"../content/factions/enemy.json":c3}),Gc=new Map;for(const[n,a]of Object.entries(u3)){const s=d3(a),r=p3(s,n);if(Gc.has(r.id))throw new Error(`Duplicate faction bundle id: ${r.id}`);Gc.set(r.id,r)}function d3(n){return typeof n=="object"&&n!==null&&"default"in n?n.default:n}function Wh(n){return typeof n=="object"&&n!==null}function gh(n,a){if(typeof n!="string")throw new Error(`Expected string at ${a}`);const s=n.trim();if(!s)throw new Error(`Expected non-empty string at ${a}`);return s}function yh(n){if(typeof n!="string")return;const a=n.trim();return a||void 0}function Ay(n,a){if(n===void 0)return Object.freeze([]);if(!Array.isArray(n))throw new Error(`Expected array at ${a}`);const s=n.map((r,l)=>{if(typeof r!="string")throw new Error(`Expected string at ${a}[${l}]`);const u=r.trim();if(!u)throw new Error(`Expected non-empty string at ${a}[${l}]`);return u});return Object.freeze(s)}function bb(n,a){const s=typeof n=="number"?n:Number(n);return!Number.isFinite(s)||s<=0?a:s}function Cy(n,a){const s=Math.floor(bb(n,a));return s>0?s:a}function f3(n,a){if(!Wh(n))throw new Error(`Expected object at ${a}`);const s=gh(n.unit,`${a}.unit`),r=Cy(n.level,1),l=Cy(n.quantity,1);return Object.freeze({unit:s,level:r,quantity:l})}function h3(n){if(n===void 0)return;const a=Number(n);if(!Number.isFinite(a))return;const s=Math.floor(a);return s>=0?s:void 0}function m3(n,a,s){if(!Wh(n))throw new Error(`Expected object at ${a}`);const r=yh(n.id)??`${s}-bundle`,l=yh(n.label)??r,u=bb(n.weight,1),f=n.units;if(!Array.isArray(f)||f.length===0)throw new Error(`Expected non-empty units array at ${a}.units`);const h=f.map((b,S)=>f3(b,`${a}.units[${S}]`)),p=Ay(n.items,`${a}.items`),m=Ay(n.modifiers,`${a}.modifiers`),g=h3(n.minRampTier);return Object.freeze({id:r,label:l,weight:u,units:Object.freeze(h),items:p,modifiers:m,minRampTier:g})}function p3(n,a){if(!Wh(n))throw new Error(`Expected object at ${a}`);const s=gh(n.id,`${a}.id`),r=gh(n.name,`${a}.name`),l=yh(n.description);if(!Array.isArray(n.bundles)||n.bundles.length===0)throw new Error(`Expected non-empty bundles array at ${a}.bundles`);const u=n.bundles.map((f,h)=>m3(f,`${a}.bundles[${h}]`,`${s}-${h}`));return Object.freeze({id:s,name:r,description:l,bundles:Object.freeze(u)})}Object.freeze(Array.from(Gc.keys()));function g3(n){return Gc.get(n)??null}function y3(n){return g3(n)?.bundles??Object.freeze([])}function b3(){return`e${Date.now()}-${Math.floor(Math.random()*1e6)}`}function v3(n){return{level:n}}function S3(n,a,s){const r=y3(n);if(r.length===0)throw new Error(`No bundles registered for faction: ${n}`);const l=Math.max(0,Math.floor(Number.isFinite(a)?a:0)),u=r.filter(b=>(typeof b.minRampTier=="number"?b.minRampTier:0)<=l),f=u.length>0?u:r,h=typeof s=="function"?s:Math.random,p=f.reduce((b,S)=>b+S.weight,0);if(!Number.isFinite(p)||p<=0)throw new Error(`Invalid bundle weights for faction: ${n}`);const m=h()*p;let g=0;for(const b of f)if(g+=b.weight,m<g)return b;return f[f.length-1]}function E3(n){let a=Math.max(0,Math.floor(n.availableSlots));const s=[];if(a<=0)return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers};const r=n.makeId??b3,l=typeof n.random=="function"?n.random:Math.random,u=Math.max(0,Math.min(.95,typeof n.eliteOdds=="number"?n.eliteOdds:0)),f=Math.max(1,Number.isFinite(n.difficultyMultiplier)?n.difficultyMultiplier:1),h=Math.max(0,Math.floor(Number.isFinite(n.rampTier)?n.rampTier:0)),p=1+h*.25,m=Math.floor(h/2);for(const g of n.bundle.units){const b=Math.max(1,Math.round(g.quantity*f*p)),S=Math.min(b,a),E=g.unit,M=Math.max(1,Math.round((g.level+m)*f));for(let N=0;N<S;N+=1){const _=l()<u?1:0,U=Math.max(1,M+_),H=v3(U),I=n.pickEdge();if(!I)return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers};const $=ib(E,r(),I,n.factionId,H);if($&&(n.addUnit($),s.push($),a-=1,a<=0))return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers}}}return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers}}function hc(n,a,s,r=1){const l=Number(n);return Number.isFinite(l)?Math.max(a,Math.min(s,l)):r}const Ty=6;class M3{timer;interval;spawnCycles;factionId;random;makeId;difficulty;eliteOdds;cadenceDecay;multiplierGrowth;runSeconds=0;clearCount=0;boardEmpty=!0;lastClearAt=null;lastSpawnAt=null;lastCadence;lastMultiplier;rampEvaluation;rampStageIndex;currentDifficulty;cadenceScale=1;multiplierScale=1;pressureScale=1;calmUntil=null;calmSecondsRemaining=0;cadenceFloor=.3;constructor(a={}){this.factionId=a.factionId??"enemy",this.random=typeof a.random=="function"?a.random:Math.random;const s=Number.isFinite(a.difficulty)?Number(a.difficulty):1;this.difficulty=Math.max(.5,s);const r=typeof a.eliteOdds=="number"?a.eliteOdds:0;this.eliteOdds=Math.max(0,Math.min(.95,r)),this.currentDifficulty=this.difficulty,this.cadenceDecay=xy(this.currentDifficulty),this.multiplierGrowth=wy(this.currentDifficulty),this.spawnCycles=0,this.rampEvaluation=My(this.currentDifficulty,{runSeconds:0,clears:0,spawnCycles:0}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.interval=this.rampEvaluation.cadenceTarget,this.timer=this.interval,this.lastCadence=this.interval,this.lastMultiplier=this.rampEvaluation.multiplierBase;const l=(()=>{let u=0;return()=>`e${Date.now()}-${u+=1}`})();this.makeId=typeof a.idFactory=="function"?a.idFactory:l}update(a,s,r,l,u={}){if(!Number.isFinite(a)||a<=0)return;this.runSeconds+=a,this.applyRuntimeModifiers(u),this.resolveRampState();const f=this.countActiveEnemies(s);if(this.trackClears(f),this.calmUntil!==null&&this.runSeconds<this.calmUntil){const p=this.calmUntil-this.runSeconds;this.calmSecondsRemaining=p,this.timer=Math.max(this.timer,p);return}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0),this.timer-=a;let h=0;for(;this.timer<=0&&h<Ty;){const p=this.getAvailableSlots(s);if(p<=0){this.timer=Math.max(this.timer,.5);break}const m=this.resolveRampState(),g=S3(this.factionId,m.stage.bundleTier,this.random),b=this.computeMultiplier(m);if(E3({bundle:g,factionId:this.factionId,pickEdge:l,addUnit:r,makeId:this.makeId,availableSlots:p,eliteOdds:this.eliteOdds,random:this.random,difficultyMultiplier:b,rampTier:m.stage.bundleTier}).spawned.length===0){this.timer=Math.max(this.timer,.5);break}const E=this.runSeconds+this.timer;this.lastCadence=this.lastSpawnAt===null?this.interval:Math.max(.01,E-this.lastSpawnAt),this.lastSpawnAt=E,this.lastMultiplier=b,this.spawnCycles+=1,h+=1;const M=this.resolveRampState();this.interval=this.computeNextInterval(M),this.timer+=this.interval}h===Ty&&this.timer<=0&&(this.timer=this.interval)}getSnapshot(){const a=this.rampEvaluation.stage;return{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles,rampStageIndex:this.rampStageIndex,rampStageId:a.id,rampStageLabel:a.label,bundleTier:a.bundleTier,cadence:this.interval,lastCadence:this.lastCadence,lastSpawnAt:this.lastSpawnAt,lastClearAt:this.lastClearAt,difficultyMultiplier:this.lastMultiplier,effectiveDifficulty:this.currentDifficulty,aggressionMultiplier:this.currentDifficulty/this.difficulty,cadenceMultiplier:this.cadenceScale,strengthMultiplier:this.multiplierScale,pressureMultiplier:this.pressureScale,calmSecondsRemaining:this.calmSecondsRemaining}}resolveRampState(){return this.rampEvaluation=My(this.currentDifficulty,{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.rampEvaluation}applyRuntimeModifiers(a){const s=hc(a.aggressionMultiplier,.25,6,1),r=hc(a.cadenceMultiplier,.1,10,1),l=hc(a.strengthMultiplier,.1,12,1),u=hc(a.pressureMultiplier,.1,10,1),f=Number.isFinite(a.cadenceFloor)?Math.max(.1,a.cadenceFloor):this.cadenceFloor,h=Math.max(.25,this.difficulty*s);if(h!==this.currentDifficulty&&(this.currentDifficulty=h,this.cadenceDecay=xy(this.currentDifficulty),this.multiplierGrowth=wy(this.currentDifficulty),this.resolveRampState()),this.cadenceScale=r,this.multiplierScale=l,this.pressureScale=u,this.cadenceFloor=f,Object.prototype.hasOwnProperty.call(a,"calmSecondsRemaining")){const p=a.calmSecondsRemaining;p===null?this.calmUntil=null:typeof p=="number"&&Number.isFinite(p)&&p>0?this.calmUntil=this.runSeconds+p:typeof p=="number"&&p<=0&&(this.calmUntil=null)}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0)}computeNextInterval(a){const s=a.cadenceTarget*this.cadenceScale,r=Math.pow(this.spawnCycles+1,.6)*.018*this.pressureScale,l=1+Math.min(4,r),u=s/l,f=this.interval*this.cadenceDecay,h=Math.min(f,u);return Math.max(this.cadenceFloor,h)}computeMultiplier(a){const s=1+this.spawnCycles*this.multiplierGrowth*this.pressureScale,r=1+a.stageIndex*.15,l=a.multiplierBase*s*r*this.multiplierScale;return Math.min(16,Math.max(1,l))}countActiveEnemies(a){return a.filter(s=>s.faction===this.factionId&&!s.isDead()).length}getAvailableSlots(a){return kM-this.countActiveEnemies(a)}trackClears(a){if(a<=0){this.boardEmpty||(this.clearCount+=1,this.lastClearAt=this.runSeconds),this.boardEmpty=!0;return}this.boardEmpty=!1}}function x3(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(n){return console.warn("Structured telemetry storage unavailable",n),null}}function w3(n,a){const s={event:n,timestamp:Date.now(),payload:{...a}};return console.info(n,s),s}function A3(n,a,s={}){const r=x3();if(!r)return;const l=Number.isFinite(s.limit)?Math.max(1,Math.trunc(s.limit??16)):16,f=[...Uh(n)??[],a].slice(-l);try{r.setItem(n,JSON.stringify(f))}catch(h){console.warn("Failed to persist structured telemetry",{storageKey:n,error:h})}}let _y=-1,Ry=-1,kf=null,Df=0,Lf=0;const C3="telemetry:enemy-scaling:summaries";function T3(n,a={}){const s=n.rampStageIndex!==_y,r=n.spawnCycles>=Ry+10,l=n.lastClearAt!==null&&n.lastClearAt!==kf;if(!s&&!r&&!l)return;_y=n.rampStageIndex,Ry=n.spawnCycles,kf=n.lastClearAt??kf,Df=Math.max(Df,n.difficultyMultiplier);const u=Math.max(0,Math.round(n.calmSecondsRemaining*1e3));u>Lf&&(Lf=u);const f={stage:n.rampStageLabel,stageIndex:n.rampStageIndex,bundleTier:n.bundleTier,cadenceSeconds:Number(n.cadence.toFixed(2)),lastCadenceSeconds:Number(n.lastCadence.toFixed(2)),multiplier:Number(n.difficultyMultiplier.toFixed(2)),effectiveDifficulty:Number(n.effectiveDifficulty.toFixed(2)),aggressionMultiplier:Number(n.aggressionMultiplier.toFixed(2)),cadenceMultiplier:Number(n.cadenceMultiplier.toFixed(2)),strengthMultiplier:Number(n.strengthMultiplier.toFixed(2)),pressureMultiplier:Number(n.pressureMultiplier.toFixed(2)),calmSecondsRemaining:Number(n.calmSecondsRemaining.toFixed(2)),runSeconds:Math.round(n.runSeconds),spawnCycles:n.spawnCycles,clears:n.clears,wipeSince:a.wipeSince??null,longestWipeMs:a.wipeDurationMs??0,peakMultiplier:Number(Df.toFixed(2)),longestCalmMs:Lf},h=w3("enemy-scaling",f);A3(C3,h,{limit:24})}const _3=Object.freeze({ngPlusLevel:0,unlockSlots:0}),R3={default:"Included with the sauna key",ngPlusLevel:"Reach NG+ level",unlockSlots:"Earn roster unlocks"},em=Object.freeze([{id:"ember-circuit",name:"Ember Circuit",rosterCap:3,description:"Classic cedar benches with a loyal trio of attendants.",art:{badge:j2,glow:"linear-gradient(145deg, rgba(255,161,76,0.65), rgba(255,226,173,0.18))"},unlock:{type:"default",label:"Available from the first steam session"}},{id:"aurora-ward",name:"Aurora Ward",rosterCap:4,description:"Glacial glass benches and a quartet ready to repel sieges.",art:{badge:B2,glow:"linear-gradient(140deg, rgba(128,208,255,0.7), rgba(61,184,255,0.2))"},unlock:{type:"unlockSlots",slots:2,label:"Secure 2 roster unlocks"}},{id:"mythic-conclave",name:"Mythic Conclave",rosterCap:6,description:"Runic obsidian tiers where six legends guard the lyly.",art:{badge:H2,glow:"linear-gradient(135deg, rgba(176,106,255,0.72), rgba(245,199,255,0.2))"},unlock:{type:"ngPlusLevel",level:3,label:"Prestige to NG+ level 3"}}]),Go=em[0].id,Uf=new Map(em.map(n=>[n.id,n]));function vb(){return em}function oa(n){return n&&Uf.has(n)?Uf.get(n):Uf.get(Go)}function Ny(n,a,s){if(!Number.isFinite(n))return a;const r=Math.max(a,Math.min(s,n));return Number.isNaN(r)?a:r}function mc(n){if(n.label)return n.label;const a=R3[n.type];if(!a)return"";switch(n.type){case"ngPlusLevel":return`${a} ${n.level}`;case"unlockSlots":return`${a} ${n.slots}`;default:return a}}function fr(n,a){const s=a??_3;if(n.unlock.type==="default")return{tier:n,unlocked:!0,progress:1,requirementLabel:mc(n.unlock)};if(n.unlock.type==="ngPlusLevel"){const r=Ny(s.ngPlusLevel/n.unlock.level,0,1);return{tier:n,unlocked:s.ngPlusLevel>=n.unlock.level,progress:r,requirementLabel:mc(n.unlock)}}if(n.unlock.type==="unlockSlots"){const r=Ny(s.unlockSlots/n.unlock.slots,0,1);return{tier:n,unlocked:s.unlockSlots>=n.unlock.slots,progress:r,requirementLabel:mc(n.unlock)}}return{tier:n,unlocked:!1,progress:0,requirementLabel:mc(n.unlock)}}const ky=["hud-grid","grid","grid-rows-[64px_1fr_80px]","grid-cols-[280px_1fr_clamp(260px,32vw,420px)]","gap-[clamp(16px,3vw,28px)]"],Dy={top:["col-span-3","row-span-1","row-start-1"],left:["col-start-1","row-start-2","row-span-1"],content:["col-start-2","row-start-2","row-span-1"],right:["col-start-3","row-start-2","row-span-1"],bottom:["col-span-3","row-start-3","row-span-1"]};function N3(n,a){let s=n.querySelector("[data-hud-root]");return s||(s=a.createElement("div"),s.dataset.hudRoot="true",s.className="hud-layout-root",n.prepend(s)),s}function fo(n,a,s,r){let l=n.querySelector(`[data-hud-region="${s}"]`);return l||(l=a.createElement("div"),l.dataset.hudRegion=s,n.appendChild(l)),l.classList.add("hud-region",...r),l.parentElement!==n&&n.appendChild(l),l}function k3(n,a,s){if(s){n.classList.add(...ky);for(const[r,l]of Object.entries(Dy))a[r].classList.add(...l)}else{n.classList.remove(...ky);for(const[r,l]of Object.entries(Dy))a[r].classList.remove(...l)}}function mr(n){const a=n.ownerDocument??document,s=N3(n,a),r={top:fo(s,a,"top",["hud-top-row"]),left:fo(s,a,"left",["hud-actions"]),content:fo(s,a,"content",["hud-content"]),right:fo(s,a,"right",["hud-right-column"]),bottom:fo(s,a,"bottom",["hud-bottom-row"])};s.append(r.top,r.left,r.content,r.right,r.bottom);const l=n.dataset.hudVariant==="v2";if(k3(n,r,l),!l){const m=n.querySelector("#resource-bar");m&&m.parentElement!==r.right&&r.right.prepend(m)}const u=n.querySelector("#build-menu");u&&u.parentElement!==r.left&&r.left.appendChild(u);const f=n.querySelector("#build-id");f&&f.parentElement!==r.bottom&&r.bottom.appendChild(f);let h=n.querySelector(".hud-mobile-bar__tray"),p=h?.closest(".hud-mobile-bar")??null;return(!h||!p)&&(p=a.createElement("div"),p.className="hud-mobile-bar",h=a.createElement("div"),h.className="hud-mobile-bar__tray",p.appendChild(h)),p.parentElement!==r.bottom&&r.bottom.appendChild(p),{root:s,regions:r,actions:r.left,side:r.right,mobileBar:h}}const Ly=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function D3(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const r=document.createElement("div");r.classList.add("sauna-control"),r.dataset.tutorialTarget="heat";const l=()=>{const ce=a.getActiveTierId?.();return oa(ce??Go).id},u=()=>a.getTierContext?.()??null,f=document.createElement("button");f.type="button",f.textContent="Sauna ",f.classList.add("topbar-button","sauna-toggle"),f.setAttribute("aria-expanded","false"),r.appendChild(f);const h=document.createElement("div");h.classList.add("sauna-card","hud-card"),h.hidden=!0;const p=document.createElement("section");p.classList.add("sauna-health");const m=`sauna-health-label-${Math.floor(Math.random()*1e5)}`,g=document.createElement("div");g.classList.add("sauna-health__header");const b=document.createElement("span");b.id=m,b.classList.add("sauna-health__title"),b.textContent="Sauna Integrity",g.appendChild(b);const S=document.createElement("span");S.classList.add("sauna-health__value"),S.setAttribute("aria-live","polite"),g.appendChild(S),p.appendChild(g);const E=document.createElement("div");E.classList.add("sauna-health__bar"),E.setAttribute("role","meter"),E.setAttribute("aria-valuemin","0"),E.setAttribute("aria-labelledby",m);const M=document.createElement("div");M.classList.add("sauna-health__fill"),E.appendChild(M),p.appendChild(E);const N=document.createElement("div");N.classList.add("sauna-health__destruction"),N.hidden=!0,E.appendChild(N);const _=document.createElement("div");_.classList.add("sauna-progress");const U=document.createElement("div");U.classList.add("sauna-progress__fill"),_.appendChild(U),h.appendChild(p),h.appendChild(_);const H=vb(),I=new Map,$=document.createElement("section");$.classList.add("sauna-tier");const P=document.createElement("div");P.classList.add("sauna-tier__header");const ie=document.createElement("span");ie.classList.add("sauna-tier__title"),ie.textContent="Premium Tiers",P.appendChild(ie);const se=document.createElement("p");se.classList.add("sauna-tier__subtitle"),se.textContent="Align the lyly with your prestige to unlock lavish benches and roster headroom.",P.appendChild(se),$.appendChild(P);const oe=document.createElement("div");oe.classList.add("sauna-tier__grid"),$.appendChild(oe);for(const ce of H){const ve=document.createElement("button");ve.type="button",ve.classList.add("sauna-tier__option"),ve.dataset.tierId=ce.id,ve.setAttribute("aria-pressed","false");const Se=document.createElement("div");Se.classList.add("sauna-tier__badge"),Se.style.setProperty("--sauna-tier-badge-image",`url(${ce.art.badge})`),ce.art.glow&&Se.style.setProperty("--sauna-tier-glow",ce.art.glow),ve.appendChild(Se);const Re=document.createElement("div");Re.classList.add("sauna-tier__copy"),ve.appendChild(Re);const Et=document.createElement("span");Et.classList.add("sauna-tier__name"),Et.textContent=ce.name,Re.appendChild(Et);const ht=document.createElement("span");ht.classList.add("sauna-tier__cap"),ht.textContent=`Cap ${ce.rosterCap}`,Re.appendChild(ht);const Tt=document.createElement("p");Tt.classList.add("sauna-tier__description"),Tt.textContent=ce.description,Re.appendChild(Tt);const ha=document.createElement("div");ha.classList.add("sauna-tier__progress");const ma=document.createElement("div");ma.classList.add("sauna-tier__progress-fill"),ha.appendChild(ma);const pa=document.createElement("span");pa.classList.add("sauna-tier__progress-label"),ha.appendChild(pa),Re.appendChild(ha);const ga=document.createElement("span");ga.classList.add("sauna-tier__requirement"),Re.appendChild(ga);const ya={tier:ce,button:ve,fill:ma,progressLabel:pa,requirement:ga,handleClick:()=>{wn(ce,ya)}};ve.addEventListener("click",ya.handleClick),I.set(ce.id,ya),oe.appendChild(ve)}h.appendChild($),Wt();const ee=document.createElement("div");ee.classList.add("sauna-roster");const Y=document.createElement("div");Y.classList.add("sauna-roster__header");const R=document.createElement("span");R.textContent="Roster Cap",R.classList.add("sauna-roster__title"),Y.appendChild(R);const k=document.createElement("span");k.classList.add("sauna-roster__value"),k.setAttribute("aria-live","polite"),Y.appendChild(k),ee.appendChild(Y);const A=document.createElement("p");A.classList.add("sauna-roster__description"),A.textContent="Tune how many attendants may be active before new recruits wait in the steam.",ee.appendChild(A);const F=`sauna-roster-${Math.floor(Math.random()*1e5)}`,B=document.createElement("label");B.classList.add("sauna-roster__label"),B.htmlFor=F,B.textContent="Active attendants";const T=document.createElement("input");T.type="range",T.id=F,T.min="0",T.step="1",T.classList.add("sauna-roster__slider");const G=document.createElement("input");G.type="number",G.min="0",G.step="1",G.inputMode="numeric",G.classList.add("sauna-roster__number");const J=document.createElement("div");J.classList.add("sauna-roster__controls"),J.appendChild(B),J.appendChild(T),J.appendChild(G),ee.appendChild(J),h.appendChild(ee);const fe=document.createElement("label");fe.classList.add("sauna-option");const x=document.createElement("input");x.type="checkbox",x.classList.add("sauna-option__input"),x.checked=n.rallyToFront,x.addEventListener("change",()=>{n.rallyToFront=x.checked}),fe.appendChild(x);const V=document.createElement("span");V.textContent="Rally to Front",V.classList.add("sauna-option__label"),fe.appendChild(V),h.appendChild(fe),r.appendChild(h);const{regions:te}=mr(s),W=te.top,le=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null;let pe=!!le?.matches;const he=(ce,ve)=>{typeof ce.addEventListener=="function"?ce.addEventListener("change",ve):typeof ce.addListener=="function"&&ce.addListener(ve)},Ge=(ce,ve)=>{typeof ce.removeEventListener=="function"?ce.removeEventListener("change",ve):typeof ce.removeListener=="function"&&ce.removeListener(ve)},Ae=ce=>{pe=!!ce.matches,p.dataset.motion=pe?"reduced":"full"};p.dataset.motion=pe?"reduced":"full",le&&he(le,Ae);const Ct=()=>{const ce=oa(l()),ve=Math.max(0,Math.floor(ce.rosterCap)),Se=a.getRosterCapLimit?.();if(typeof Se=="number"&&Number.isFinite(Se)){const Re=Math.max(0,Math.floor(Se));return Math.max(0,Math.min(ve,Re))}return ve};function Wt(){const ce=l(),ve=u();for(const Se of I.values()){const Re=fr(Se.tier,ve),Et=Math.round(Math.max(0,Math.min(Re.progress,1))*100);Se.fill.style.width=`${Et}%`,Se.progressLabel.textContent=Re.unlocked?"Unlocked":`${Et}% ready`,Se.requirement.textContent=Re.unlocked?`Roster cap ${Se.tier.rosterCap}`:Re.requirementLabel,Se.button.dataset.state=Re.unlocked?Se.tier.id===ce?"active":"available":"locked",Se.button.setAttribute("aria-pressed",Se.tier.id===ce?"true":"false"),Se.button.setAttribute("aria-disabled",Re.unlocked?"false":"true")}}function wn(ce,ve){if(!fr(ce,u()).unlocked){ve.button.classList.remove("sauna-tier__option--denied"),ve.button.offsetWidth,ve.button.classList.add("sauna-tier__option--denied");return}(a.setActiveTierId?.(ce.id,{persist:!0})??!1)&&Yt(n.maxRosterSize,!0),Wt()}const en=(ce,ve)=>{const Se=Math.max(0,Math.min(ce,Math.floor(ve)));T.max=String(ce),T.value=String(Se),T.setAttribute("aria-valuemax",T.max),T.setAttribute("aria-valuenow",T.value),G.max=String(ce),G.value=String(Se),k.textContent=Se===0?"Paused":`${Se}`,k.dataset.state=Se===0?"paused":"active",G.setAttribute("aria-label",`Roster cap set to ${Se}`)};function Yt(ce,ve){const Se=Number(ce),Re=Ct(),Et=Number.isFinite(Se)?Math.max(0,Math.floor(Se)):0;let ht=Math.max(0,Math.min(Re,Et));return a.updateMaxRosterSize?ht=a.updateMaxRosterSize(ht,{persist:ve}):n.maxRosterSize=ht,en(Re,ht),ht}const Ft=()=>{Yt(Number(T.value),!1)},ca=()=>{Yt(Number(T.value),!0)};T.addEventListener("input",Ft),T.addEventListener("change",ca);const ua=ce=>{Yt(Number(G.value),ce)},lt=()=>{ua(!1)},da=()=>{ua(!0)},An=()=>{ua(!0)};G.addEventListener("input",lt),G.addEventListener("change",da),G.addEventListener("blur",An),Yt(n.maxRosterSize,!1);const mn=()=>{r.parentElement!==W&&W.appendChild(r);const ce=W.querySelector("#topbar");return ce&&ce.parentElement===W?(ce.nextSibling!==r&&W.insertBefore(r,ce.nextSibling),!0):!1};let $t=null;mn()||($t=new MutationObserver(()=>{mn()&&$t?.disconnect()}),$t.observe(W,{childList:!0}));const Ka=()=>{const ce=!h.hidden;h.hidden=ce,f.setAttribute("aria-expanded",String(!ce))};f.addEventListener("click",Ka);const Cn=()=>{const ce=Math.max(1,Math.floor(n.maxHealth)),ve=Math.max(0,Math.min(ce,Math.floor(Number.isFinite(n.health)?n.health:0))),Se=ce>0?ve/ce:0,Re=Math.max(0,Math.min(Se,1));M.style.width=`${Re*100}%`;const Et=Ly.format(ve),ht=Ly.format(ce);S.textContent=`${Et} / ${ht}`,E.setAttribute("aria-valuenow",String(ve)),E.setAttribute("aria-valuemax",String(ce)),E.setAttribute("aria-valuetext",`${Et} of ${ht} health`);const Tt=n.destroyed?"offline":Re<=.2?"critical":Re<=.55?"warning":"stable";E.dataset.level=Tt,S.dataset.state=Tt,p.dataset.state=n.destroyed?"destroyed":"active"},Gn=()=>{N.classList.remove("sauna-health__destruction--active"),N.hidden=!0};let Tn=null,Ue=null;const Ze=()=>{Tn!==null&&(window.clearTimeout(Tn),Tn=null),E.classList.remove("sauna-health__bar--impact")},tn=()=>{M.classList.remove("sauna-health__fill--damage")};M.addEventListener("animationend",tn);const ft=()=>{Gn()};N.addEventListener("animationend",ft);const us=()=>{Ze(),E.classList.add("sauna-health__bar--impact"),pe||(M.classList.remove("sauna-health__fill--damage"),M.offsetWidth,M.classList.add("sauna-health__fill--damage")),Tn=window.setTimeout(()=>{E.classList.remove("sauna-health__bar--impact"),Tn=null},pe?360:560)},pr=()=>{Ue!==null&&(window.clearTimeout(Ue),Ue=null),N.hidden=!1,N.classList.remove("sauna-health__destruction--active"),N.offsetWidth,N.classList.add("sauna-health__destruction--active"),Ue=window.setTimeout(()=>{Gn(),Ue=null},pe?720:1100)},ds=()=>{Cn();const ce=n.playerSpawnCooldown>0?n.playerSpawnCooldown:1,ve=1-n.playerSpawnTimer/ce;U.style.width=`${Math.max(0,Math.min(ve,1))*100}%`,x.checked=n.rallyToFront;const Se=Ct(),Re=Math.max(0,Math.min(Se,Math.floor(n.maxRosterSize)));if(Re!==n.maxRosterSize)if(a.updateMaxRosterSize){const Et=a.updateMaxRosterSize(Re,{persist:!0});en(Se,Et)}else n.maxRosterSize=Re,en(Se,Re);else en(Se,Re);Wt()};return Cn(),{update:ds,handleDamage:ce=>{Cn(),us()},handleDestroyed:ce=>{h.hidden=!1,f.setAttribute("aria-expanded","true"),Cn(),us(),pr()},dispose:()=>{$t?.disconnect(),$t=null,f.removeEventListener("click",Ka),T.removeEventListener("input",Ft),T.removeEventListener("change",ca),G.removeEventListener("input",lt),G.removeEventListener("change",da),G.removeEventListener("blur",An),le&&Ge(le,Ae),M.removeEventListener("animationend",tn),N.removeEventListener("animationend",ft),Ze(),Ue!==null&&(window.clearTimeout(Ue),Ue=null),Gn();for(const ce of I.values())ce.button.removeEventListener("click",ce.handleClick);I.clear(),r.remove()}}}function ho(n,a={}){const{iconSrc:s,description:r,srLabel:l}=a,u=document.createElement("div");if(u.classList.add("topbar-badge"),u.setAttribute("role","status"),u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),s){const b=document.createElement("img");b.src=s,b.alt=n,b.decoding="async",b.classList.add("topbar-badge-icon"),u.appendChild(b)}const f=document.createElement("div");f.classList.add("badge-text");const h=document.createElement("span");h.textContent=n,h.classList.add("badge-label"),f.appendChild(h);const p=document.createElement("span");p.textContent="0",p.classList.add("badge-value"),p.setAttribute("aria-hidden","true"),f.appendChild(p);const m=document.createElement("span");m.classList.add("badge-delta"),m.style.opacity="0",m.style.transform="translateY(-6px)",m.style.transition="opacity 0.5s ease, transform 0.5s ease",m.setAttribute("aria-hidden","true"),u.append(f,m),r&&(u.title=r);const g=l??n;return u.dataset.label=g,u.setAttribute("aria-label",`${g}: 0`),{container:u,value:p,delta:m,label:g}}function L3(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const{regions:r}=mr(s),l=r.top,u=document.createElement("div");u.id="topbar",l.prepend(u);const f=document.createElement("div");f.className="topbar-badge-row",u.appendChild(f);const h={[ae.SAUNA_BEER]:"Sauna beer bottles chilled for construction crews and eager recruits.",[ae.SAUNAKUNNIA]:"Saunakunniaprestige earned from sauna rituals and triumphant battles.",[ae.SISU]:"Sisuthe relentless grit forged when your warriors triumph on the snow."},p=ho("Sauna Beer",{iconSrc:a.saunaBeer,description:h[ae.SAUNA_BEER],srLabel:"Sauna beer reserves"});p.container.classList.add("badge-sauna-beer");const m=ho("Sisu",{iconSrc:a.sisu,description:h[ae.SISU],srLabel:"Sisu reserves"});m.container.classList.add("badge-sisu"),m.container.dataset.tutorialTarget="sisu";const g=ho("Saunakunnia",{iconSrc:a.saunakunnia,description:h[ae.SAUNAKUNNIA],srLabel:"Saunakunnia"});g.container.classList.add("badge-sauna"),g.container.dataset.tutorialTarget="victory";const b=ho("Time");b.container.classList.add("badge-time"),b.delta.style.display="none";const S=ho("Enemy Ramp",{srLabel:"Enemy ramp intensity"});S.container.classList.add("badge-ramp"),S.delta.style.display="none",S.container.dataset.tutorialTarget="enemy-ramp",S.container.title="Enemy ramp intensity and cadence.",f.appendChild(p.container),f.appendChild(m.container),f.appendChild(g.container),f.appendChild(S.container),f.appendChild(b.container);const E=new Intl.NumberFormat("en-US"),M=new Intl.NumberFormat("en-US",{signDisplay:"exceptZero"}),N={[ae.SAUNA_BEER]:"Sauna Beer",[ae.SAUNAKUNNIA]:"Saunakunnia",[ae.SISU]:"Sisu"},_={[ae.SAUNA_BEER]:{singular:"bottle",plural:"bottles"},[ae.SAUNAKUNNIA]:{singular:"Saunakunnia",plural:"Saunakunnia"},[ae.SISU]:{singular:"Sisu",plural:"Sisu"}},U={[ae.SAUNA_BEER]:"",[ae.SAUNAKUNNIA]:"",[ae.SISU]:""},H={[ae.SAUNA_BEER]:p,[ae.SAUNAKUNNIA]:g,[ae.SISU]:m},I={};let $=null;function P(A){if($=A,!A){S.value.textContent="Stage 1  1.00",S.delta.textContent="",S.delta.style.display="none",S.container.dataset.state="idle",S.container.title="Enemy ramp idle",S.container.setAttribute("aria-label","Enemy ramp idle.");return}const F=A.stage||`Stage ${A.stageIndex+1}`,B=`${A.multiplier.toFixed(2)}`,T=`${A.cadenceSeconds.toFixed(2)}s cadence`,G=`${A.effectiveDifficulty.toFixed(2)}`,J=A.calmSecondsRemaining>.05,fe=J?`Calm remaining: ${Math.ceil(A.calmSecondsRemaining)}s`:"Calm inactive";S.value.textContent=`${F}  ${B}`,S.delta.style.display=J?"":"none",S.delta.textContent=J?`Calm ${Math.ceil(A.calmSecondsRemaining)}s`:"",S.container.dataset.state=J?"calm":"active",S.container.title=[`Stage: ${F} (Tier ${A.bundleTier})`,`Cadence: ${T}`,`Multiplier: ${B}`,`Difficulty: ${G}`,`Aggression ${A.aggressionMultiplier.toFixed(2)}  Cadence ${A.cadenceMultiplier.toFixed(2)}  Strength ${A.strengthMultiplier.toFixed(2)}`,fe,`Spawn cycles: ${A.spawnCycles}`].join(`
`),S.container.setAttribute("aria-label",[`Enemy ramp ${F}`,`Multiplier ${B}`,`Cadence ${A.cadenceSeconds.toFixed(2)} seconds`,`Difficulty ${G}`,J?`Calm remaining ${Math.ceil(A.calmSecondsRemaining)} seconds`:"Calm inactive"].join("  "))}function ie(A,F){const B=Number.isFinite(F)?F:0;return A===ae.SAUNA_BEER?Math.trunc(B):Math.max(0,Math.round(B))}function se(A,F){return E.format(ie(A,F))}function oe(A,F){return F===0?"":`${M.format(F)}${U[A]}`}function ee(A,F){if(F===0)return"";const B=F>0?"gained":"spent",T=E.format(Math.abs(F)),G=_[A];if(G){const fe=Math.abs(F)===1?G.singular:G.plural,x=N[A],V=[x];fe&&fe!==x&&V.push(fe);const te=V.filter(Boolean).join(" ");return`${B} ${T}${te?` ${te}`:""}`}const J=N[A];return`${B} ${T}${J?` ${J}`:""}`}function Y(A,F,B=0){const T=H[A];if(!T)return;const G=ie(A,F),J=se(A,F);T.value.textContent=J;const fe=A===ae.SAUNA_BEER&&G<0;if(T.container.classList.toggle("topbar-badge--debt",fe),B!==0){T.delta.textContent=oe(A,B),T.delta.style.opacity="1",T.delta.style.transform="translateY(0)";const te=I[A];te&&clearTimeout(te),I[A]=setTimeout(()=>{T.delta.style.opacity="0",T.delta.style.transform="translateY(-6px)",delete I[A]},1e3)}else T.delta.textContent="",T.delta.style.opacity="0",T.delta.style.transform="translateY(-6px)";const x=ee(A,B),V=[`${T.label} ${J}`];if(fe){const te=E.format(Math.abs(G)),W=_[A];if(W){const le=Math.abs(G)===1?W.singular:W.plural,pe=le&&le!==N[A];V.push(pe?`Debt of ${te} ${le}`:`Debt of ${te}`)}else V.push(`Debt of ${te}`)}x&&V.push(x),T.container.setAttribute("aria-label",V.join("  "))}Y(ae.SAUNA_BEER,n.getResource(ae.SAUNA_BEER)),Y(ae.SAUNAKUNNIA,n.getResource(ae.SAUNAKUNNIA)),Y(ae.SISU,n.getResource(ae.SISU)),P($);const R=({resource:A,amount:F,total:B})=>{H[A]&&Y(A,B,F)};ne.on("resourceChanged",R);let k=0;return{update(A){k+=A;const F=Math.floor(k/1e3),B=Math.floor(F/60),T=F%60;b.value.textContent=`${B}:${T.toString().padStart(2,"0")}`},setEnemyRampSummary(A){P(A)},dispose(){ne.off("resourceChanged",R),Object.values(I).forEach(A=>{A&&clearTimeout(A)}),u.remove()}}}var Of={exports:{}},mo={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uy;function U3(){if(Uy)return mo;Uy=1;var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function s(r,l,u){var f=null;if(u!==void 0&&(f=""+u),l.key!==void 0&&(f=""+l.key),"key"in l){u={};for(var h in l)h!=="key"&&(u[h]=l[h])}else u=l;return l=u.ref,{$$typeof:n,type:r,key:f,ref:l!==void 0?l:null,props:u}}return mo.Fragment=a,mo.jsx=s,mo.jsxs=s,mo}var Oy;function O3(){return Oy||(Oy=1,Of.exports=U3()),Of.exports}var Zt=O3(),qf={exports:{}},po={},zf={exports:{}},Bf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qy;function q3(){return qy||(qy=1,(function(n){function a(T,G){var J=T.length;T.push(G);e:for(;0<J;){var fe=J-1>>>1,x=T[fe];if(0<l(x,G))T[fe]=G,T[J]=x,J=fe;else break e}}function s(T){return T.length===0?null:T[0]}function r(T){if(T.length===0)return null;var G=T[0],J=T.pop();if(J!==G){T[0]=J;e:for(var fe=0,x=T.length,V=x>>>1;fe<V;){var te=2*(fe+1)-1,W=T[te],le=te+1,pe=T[le];if(0>l(W,J))le<x&&0>l(pe,W)?(T[fe]=pe,T[le]=J,fe=le):(T[fe]=W,T[te]=J,fe=te);else if(le<x&&0>l(pe,J))T[fe]=pe,T[le]=J,fe=le;else break e}}return G}function l(T,G){var J=T.sortIndex-G.sortIndex;return J!==0?J:T.id-G.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,h=f.now();n.unstable_now=function(){return f.now()-h}}var p=[],m=[],g=1,b=null,S=3,E=!1,M=!1,N=!1,_=!1,U=typeof setTimeout=="function"?setTimeout:null,H=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function $(T){for(var G=s(m);G!==null;){if(G.callback===null)r(m);else if(G.startTime<=T)r(m),G.sortIndex=G.expirationTime,a(p,G);else break;G=s(m)}}function P(T){if(N=!1,$(T),!M)if(s(p)!==null)M=!0,ie||(ie=!0,k());else{var G=s(m);G!==null&&B(P,G.startTime-T)}}var ie=!1,se=-1,oe=5,ee=-1;function Y(){return _?!0:!(n.unstable_now()-ee<oe)}function R(){if(_=!1,ie){var T=n.unstable_now();ee=T;var G=!0;try{e:{M=!1,N&&(N=!1,H(se),se=-1),E=!0;var J=S;try{t:{for($(T),b=s(p);b!==null&&!(b.expirationTime>T&&Y());){var fe=b.callback;if(typeof fe=="function"){b.callback=null,S=b.priorityLevel;var x=fe(b.expirationTime<=T);if(T=n.unstable_now(),typeof x=="function"){b.callback=x,$(T),G=!0;break t}b===s(p)&&r(p),$(T)}else r(p);b=s(p)}if(b!==null)G=!0;else{var V=s(m);V!==null&&B(P,V.startTime-T),G=!1}}break e}finally{b=null,S=J,E=!1}G=void 0}}finally{G?k():ie=!1}}}var k;if(typeof I=="function")k=function(){I(R)};else if(typeof MessageChannel<"u"){var A=new MessageChannel,F=A.port2;A.port1.onmessage=R,k=function(){F.postMessage(null)}}else k=function(){U(R,0)};function B(T,G){se=U(function(){T(n.unstable_now())},G)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(T){T.callback=null},n.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):oe=0<T?Math.floor(1e3/T):5},n.unstable_getCurrentPriorityLevel=function(){return S},n.unstable_next=function(T){switch(S){case 1:case 2:case 3:var G=3;break;default:G=S}var J=S;S=G;try{return T()}finally{S=J}},n.unstable_requestPaint=function(){_=!0},n.unstable_runWithPriority=function(T,G){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var J=S;S=T;try{return G()}finally{S=J}},n.unstable_scheduleCallback=function(T,G,J){var fe=n.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?fe+J:fe):J=fe,T){case 1:var x=-1;break;case 2:x=250;break;case 5:x=1073741823;break;case 4:x=1e4;break;default:x=5e3}return x=J+x,T={id:g++,callback:G,priorityLevel:T,startTime:J,expirationTime:x,sortIndex:-1},J>fe?(T.sortIndex=J,a(m,T),s(p)===null&&T===s(m)&&(N?(H(se),se=-1):N=!0,B(P,J-fe))):(T.sortIndex=x,a(p,T),M||E||(M=!0,ie||(ie=!0,k()))),T},n.unstable_shouldYield=Y,n.unstable_wrapCallback=function(T){var G=S;return function(){var J=S;S=G;try{return T.apply(this,arguments)}finally{S=J}}}})(Bf)),Bf}var zy;function z3(){return zy||(zy=1,zf.exports=q3()),zf.exports}var Hf={exports:{}},Ee={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var By;function B3(){if(By)return Ee;By=1;var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),b=Symbol.iterator;function S(x){return x===null||typeof x!="object"?null:(x=b&&x[b]||x["@@iterator"],typeof x=="function"?x:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,N={};function _(x,V,te){this.props=x,this.context=V,this.refs=N,this.updater=te||E}_.prototype.isReactComponent={},_.prototype.setState=function(x,V){if(typeof x!="object"&&typeof x!="function"&&x!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,x,V,"setState")},_.prototype.forceUpdate=function(x){this.updater.enqueueForceUpdate(this,x,"forceUpdate")};function U(){}U.prototype=_.prototype;function H(x,V,te){this.props=x,this.context=V,this.refs=N,this.updater=te||E}var I=H.prototype=new U;I.constructor=H,M(I,_.prototype),I.isPureReactComponent=!0;var $=Array.isArray,P={H:null,A:null,T:null,S:null,V:null},ie=Object.prototype.hasOwnProperty;function se(x,V,te,W,le,pe){return te=pe.ref,{$$typeof:n,type:x,key:V,ref:te!==void 0?te:null,props:pe}}function oe(x,V){return se(x.type,V,void 0,void 0,void 0,x.props)}function ee(x){return typeof x=="object"&&x!==null&&x.$$typeof===n}function Y(x){var V={"=":"=0",":":"=2"};return"$"+x.replace(/[=:]/g,function(te){return V[te]})}var R=/\/+/g;function k(x,V){return typeof x=="object"&&x!==null&&x.key!=null?Y(""+x.key):V.toString(36)}function A(){}function F(x){switch(x.status){case"fulfilled":return x.value;case"rejected":throw x.reason;default:switch(typeof x.status=="string"?x.then(A,A):(x.status="pending",x.then(function(V){x.status==="pending"&&(x.status="fulfilled",x.value=V)},function(V){x.status==="pending"&&(x.status="rejected",x.reason=V)})),x.status){case"fulfilled":return x.value;case"rejected":throw x.reason}}throw x}function B(x,V,te,W,le){var pe=typeof x;(pe==="undefined"||pe==="boolean")&&(x=null);var he=!1;if(x===null)he=!0;else switch(pe){case"bigint":case"string":case"number":he=!0;break;case"object":switch(x.$$typeof){case n:case a:he=!0;break;case g:return he=x._init,B(he(x._payload),V,te,W,le)}}if(he)return le=le(x),he=W===""?"."+k(x,0):W,$(le)?(te="",he!=null&&(te=he.replace(R,"$&/")+"/"),B(le,V,te,"",function(Ct){return Ct})):le!=null&&(ee(le)&&(le=oe(le,te+(le.key==null||x&&x.key===le.key?"":(""+le.key).replace(R,"$&/")+"/")+he)),V.push(le)),1;he=0;var Ge=W===""?".":W+":";if($(x))for(var Ae=0;Ae<x.length;Ae++)W=x[Ae],pe=Ge+k(W,Ae),he+=B(W,V,te,pe,le);else if(Ae=S(x),typeof Ae=="function")for(x=Ae.call(x),Ae=0;!(W=x.next()).done;)W=W.value,pe=Ge+k(W,Ae++),he+=B(W,V,te,pe,le);else if(pe==="object"){if(typeof x.then=="function")return B(F(x),V,te,W,le);throw V=String(x),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return he}function T(x,V,te){if(x==null)return x;var W=[],le=0;return B(x,W,"","",function(pe){return V.call(te,pe,le++)}),W}function G(x){if(x._status===-1){var V=x._result;V=V(),V.then(function(te){(x._status===0||x._status===-1)&&(x._status=1,x._result=te)},function(te){(x._status===0||x._status===-1)&&(x._status=2,x._result=te)}),x._status===-1&&(x._status=0,x._result=V)}if(x._status===1)return x._result.default;throw x._result}var J=typeof reportError=="function"?reportError:function(x){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof x=="object"&&x!==null&&typeof x.message=="string"?String(x.message):String(x),error:x});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",x);return}console.error(x)};function fe(){}return Ee.Children={map:T,forEach:function(x,V,te){T(x,function(){V.apply(this,arguments)},te)},count:function(x){var V=0;return T(x,function(){V++}),V},toArray:function(x){return T(x,function(V){return V})||[]},only:function(x){if(!ee(x))throw Error("React.Children.only expected to receive a single React element child.");return x}},Ee.Component=_,Ee.Fragment=s,Ee.Profiler=l,Ee.PureComponent=H,Ee.StrictMode=r,Ee.Suspense=p,Ee.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,Ee.__COMPILER_RUNTIME={__proto__:null,c:function(x){return P.H.useMemoCache(x)}},Ee.cache=function(x){return function(){return x.apply(null,arguments)}},Ee.cloneElement=function(x,V,te){if(x==null)throw Error("The argument must be a React element, but you passed "+x+".");var W=M({},x.props),le=x.key,pe=void 0;if(V!=null)for(he in V.ref!==void 0&&(pe=void 0),V.key!==void 0&&(le=""+V.key),V)!ie.call(V,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&V.ref===void 0||(W[he]=V[he]);var he=arguments.length-2;if(he===1)W.children=te;else if(1<he){for(var Ge=Array(he),Ae=0;Ae<he;Ae++)Ge[Ae]=arguments[Ae+2];W.children=Ge}return se(x.type,le,void 0,void 0,pe,W)},Ee.createContext=function(x){return x={$$typeof:f,_currentValue:x,_currentValue2:x,_threadCount:0,Provider:null,Consumer:null},x.Provider=x,x.Consumer={$$typeof:u,_context:x},x},Ee.createElement=function(x,V,te){var W,le={},pe=null;if(V!=null)for(W in V.key!==void 0&&(pe=""+V.key),V)ie.call(V,W)&&W!=="key"&&W!=="__self"&&W!=="__source"&&(le[W]=V[W]);var he=arguments.length-2;if(he===1)le.children=te;else if(1<he){for(var Ge=Array(he),Ae=0;Ae<he;Ae++)Ge[Ae]=arguments[Ae+2];le.children=Ge}if(x&&x.defaultProps)for(W in he=x.defaultProps,he)le[W]===void 0&&(le[W]=he[W]);return se(x,pe,void 0,void 0,null,le)},Ee.createRef=function(){return{current:null}},Ee.forwardRef=function(x){return{$$typeof:h,render:x}},Ee.isValidElement=ee,Ee.lazy=function(x){return{$$typeof:g,_payload:{_status:-1,_result:x},_init:G}},Ee.memo=function(x,V){return{$$typeof:m,type:x,compare:V===void 0?null:V}},Ee.startTransition=function(x){var V=P.T,te={};P.T=te;try{var W=x(),le=P.S;le!==null&&le(te,W),typeof W=="object"&&W!==null&&typeof W.then=="function"&&W.then(fe,J)}catch(pe){J(pe)}finally{P.T=V}},Ee.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},Ee.use=function(x){return P.H.use(x)},Ee.useActionState=function(x,V,te){return P.H.useActionState(x,V,te)},Ee.useCallback=function(x,V){return P.H.useCallback(x,V)},Ee.useContext=function(x){return P.H.useContext(x)},Ee.useDebugValue=function(){},Ee.useDeferredValue=function(x,V){return P.H.useDeferredValue(x,V)},Ee.useEffect=function(x,V,te){var W=P.H;if(typeof te=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return W.useEffect(x,V)},Ee.useId=function(){return P.H.useId()},Ee.useImperativeHandle=function(x,V,te){return P.H.useImperativeHandle(x,V,te)},Ee.useInsertionEffect=function(x,V){return P.H.useInsertionEffect(x,V)},Ee.useLayoutEffect=function(x,V){return P.H.useLayoutEffect(x,V)},Ee.useMemo=function(x,V){return P.H.useMemo(x,V)},Ee.useOptimistic=function(x,V){return P.H.useOptimistic(x,V)},Ee.useReducer=function(x,V,te){return P.H.useReducer(x,V,te)},Ee.useRef=function(x){return P.H.useRef(x)},Ee.useState=function(x){return P.H.useState(x)},Ee.useSyncExternalStore=function(x,V,te){return P.H.useSyncExternalStore(x,V,te)},Ee.useTransition=function(){return P.H.useTransition()},Ee.version="19.1.1",Ee}var Hy;function tm(){return Hy||(Hy=1,Hf.exports=B3()),Hf.exports}var jf={exports:{}},Lt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jy;function H3(){if(jy)return Lt;jy=1;var n=tm();function a(p){var m="https://react.dev/errors/"+p;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)m+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var r={d:{f:s,r:function(){throw Error(a(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},l=Symbol.for("react.portal");function u(p,m,g){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:b==null?null:""+b,children:p,containerInfo:m,implementation:g}}var f=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(p,m){if(p==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Lt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Lt.createPortal=function(p,m){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(a(299));return u(p,m,null,g)},Lt.flushSync=function(p){var m=f.T,g=r.p;try{if(f.T=null,r.p=2,p)return p()}finally{f.T=m,r.p=g,r.d.f()}},Lt.preconnect=function(p,m){typeof p=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(p,m))},Lt.prefetchDNS=function(p){typeof p=="string"&&r.d.D(p)},Lt.preinit=function(p,m){if(typeof p=="string"&&m&&typeof m.as=="string"){var g=m.as,b=h(g,m.crossOrigin),S=typeof m.integrity=="string"?m.integrity:void 0,E=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;g==="style"?r.d.S(p,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:b,integrity:S,fetchPriority:E}):g==="script"&&r.d.X(p,{crossOrigin:b,integrity:S,fetchPriority:E,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Lt.preinitModule=function(p,m){if(typeof p=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var g=h(m.as,m.crossOrigin);r.d.M(p,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(p)},Lt.preload=function(p,m){if(typeof p=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var g=m.as,b=h(g,m.crossOrigin);r.d.L(p,g,{crossOrigin:b,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Lt.preloadModule=function(p,m){if(typeof p=="string")if(m){var g=h(m.as,m.crossOrigin);r.d.m(p,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(p)},Lt.requestFormReset=function(p){r.d.r(p)},Lt.unstable_batchedUpdates=function(p,m){return p(m)},Lt.useFormState=function(p,m,g){return f.H.useFormState(p,m,g)},Lt.useFormStatus=function(){return f.H.useHostTransitionStatus()},Lt.version="19.1.1",Lt}var Iy;function j3(){if(Iy)return jf.exports;Iy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(a){console.error(a)}}return n(),jf.exports=H3(),jf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gy;function I3(){if(Gy)return po;Gy=1;var n=z3(),a=tm(),s=j3();function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function f(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(r(188))}function p(e){var t=e.alternate;if(!t){if(t=u(e),t===null)throw Error(r(188));return t!==e?null:e}for(var i=e,o=t;;){var c=i.return;if(c===null)break;var d=c.alternate;if(d===null){if(o=c.return,o!==null){i=o;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===i)return h(c),e;if(d===o)return h(c),t;d=d.sibling}throw Error(r(188))}if(i.return!==o.return)i=c,o=d;else{for(var y=!1,v=c.child;v;){if(v===i){y=!0,i=c,o=d;break}if(v===o){y=!0,o=c,i=d;break}v=v.sibling}if(!y){for(v=d.child;v;){if(v===i){y=!0,i=d,o=c;break}if(v===o){y=!0,o=d,i=c;break}v=v.sibling}if(!y)throw Error(r(189))}}if(i.alternate!==o)throw Error(r(190))}if(i.tag!==3)throw Error(r(188));return i.stateNode.current===i?e:t}function m(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=m(e),t!==null)return t;e=e.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),U=Symbol.for("react.provider"),H=Symbol.for("react.consumer"),I=Symbol.for("react.context"),$=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),ie=Symbol.for("react.suspense_list"),se=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),ee=Symbol.for("react.activity"),Y=Symbol.for("react.memo_cache_sentinel"),R=Symbol.iterator;function k(e){return e===null||typeof e!="object"?null:(e=R&&e[R]||e["@@iterator"],typeof e=="function"?e:null)}var A=Symbol.for("react.client.reference");function F(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===A?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case M:return"Fragment";case _:return"Profiler";case N:return"StrictMode";case P:return"Suspense";case ie:return"SuspenseList";case ee:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case E:return"Portal";case I:return(e.displayName||"Context")+".Provider";case H:return(e._context.displayName||"Context")+".Consumer";case $:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case se:return t=e.displayName||null,t!==null?t:F(e.type)||"Memo";case oe:t=e._payload,e=e._init;try{return F(e(t))}catch{}}return null}var B=Array.isArray,T=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},fe=[],x=-1;function V(e){return{current:e}}function te(e){0>x||(e.current=fe[x],fe[x]=null,x--)}function W(e,t){x++,fe[x]=e.current,e.current=t}var le=V(null),pe=V(null),he=V(null),Ge=V(null);function Ae(e,t){switch(W(he,t),W(pe,e),W(le,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Sg(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Sg(t),e=Eg(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}te(le),W(le,e)}function Ct(){te(le),te(pe),te(he)}function Wt(e){e.memoizedState!==null&&W(Ge,e);var t=le.current,i=Eg(t,e.type);t!==i&&(W(pe,e),W(le,i))}function wn(e){pe.current===e&&(te(le),te(pe)),Ge.current===e&&(te(Ge),ao._currentValue=J)}var en=Object.prototype.hasOwnProperty,Yt=n.unstable_scheduleCallback,Ft=n.unstable_cancelCallback,ca=n.unstable_shouldYield,ua=n.unstable_requestPaint,lt=n.unstable_now,da=n.unstable_getCurrentPriorityLevel,An=n.unstable_ImmediatePriority,mn=n.unstable_UserBlockingPriority,$t=n.unstable_NormalPriority,Ka=n.unstable_LowPriority,Cn=n.unstable_IdlePriority,Gn=n.log,Tn=n.unstable_setDisableYieldValue,Ue=null,Ze=null;function tn(e){if(typeof Gn=="function"&&Tn(e),Ze&&typeof Ze.setStrictMode=="function")try{Ze.setStrictMode(Ue,e)}catch{}}var ft=Math.clz32?Math.clz32:ds,us=Math.log,pr=Math.LN2;function ds(e){return e>>>=0,e===0?32:31-(us(e)/pr|0)|0}var Ri=256,fa=4194304;function _n(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ce(e,t,i){var o=e.pendingLanes;if(o===0)return 0;var c=0,d=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var v=o&134217727;return v!==0?(o=v&~d,o!==0?c=_n(o):(y&=v,y!==0?c=_n(y):i||(i=v&~e,i!==0&&(c=_n(i))))):(v=o&~d,v!==0?c=_n(v):y!==0?c=_n(y):i||(i=o&~e,i!==0&&(c=_n(i)))),c===0?0:t!==0&&t!==c&&(t&d)===0&&(d=c&-c,i=t&-t,d>=i||d===32&&(i&4194048)!==0)?t:c}function ve(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Se(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Re(){var e=Ri;return Ri<<=1,(Ri&4194048)===0&&(Ri=256),e}function Et(){var e=fa;return fa<<=1,(fa&62914560)===0&&(fa=4194304),e}function ht(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Tt(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function ha(e,t,i,o,c,d){var y=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var v=e.entanglements,w=e.expirationTimes,q=e.hiddenUpdates;for(i=y&~i;0<i;){var K=31-ft(i),Z=1<<K;v[K]=0,w[K]=-1;var z=q[K];if(z!==null)for(q[K]=null,K=0;K<z.length;K++){var j=z[K];j!==null&&(j.lane&=-536870913)}i&=~Z}o!==0&&ma(e,o,0),d!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=d&~(y&~t))}function ma(e,t,i){e.pendingLanes|=t,e.suspendedLanes&=~t;var o=31-ft(t);e.entangledLanes|=t,e.entanglements[o]=e.entanglements[o]|1073741824|i&4194090}function pa(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var o=31-ft(i),c=1<<o;c&t|e[o]&t&&(e[o]|=t),i&=~c}}function ga(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ya(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Fo(){var e=G.p;return e!==0?e:(e=window.event,e===void 0?32:jg(e.type))}function $o(e,t){var i=G.p;try{return G.p=e,t()}finally{G.p=i}}var Yn=Math.random().toString(36).slice(2),Je="__reactFiber$"+Yn,mt="__reactProps$"+Yn,ba="__reactContainer$"+Yn,Qa="__reactEvents$"+Yn,Rn="__reactListeners$"+Yn,fs="__reactHandles$"+Yn,Ni="__reactResources$"+Yn,ki="__reactMarker$"+Yn;function hs(e){delete e[Je],delete e[mt],delete e[Qa],delete e[Rn],delete e[fs]}function va(e){var t=e[Je];if(t)return t;for(var i=e.parentNode;i;){if(t=i[ba]||i[Je]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=Ag(e);e!==null;){if(i=e[Je])return i;e=Ag(e)}return t}e=i,i=e.parentNode}return null}function Pa(e){if(e=e[Je]||e[ba]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function Sa(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(r(33))}function Ea(e){var t=e[Ni];return t||(t=e[Ni]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function We(e){e[ki]=!0}var ms=new Set,Vo={};function Fn(e,t){Za(e,t),Za(e+"Capture",t)}function Za(e,t){for(Vo[e]=t,e=0;e<t.length;e++)ms.add(t[e])}var Xo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ko={},Qo={};function Po(e){return en.call(Qo,e)?!0:en.call(Ko,e)?!1:Xo.test(e)?Qo[e]=!0:(Ko[e]=!0,!1)}function Di(e,t,i){if(Po(t))if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var o=t.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+i)}}function Li(e,t,i){if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+i)}}function Nn(e,t,i,o){if(o===null)e.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(t,i,""+o)}}var Zo,D;function X(e){if(Zo===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);Zo=t&&t[1]||"",D=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Zo+e+D}var re=!1;function de(e,t){if(!e||re)return"";re=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(t){var Z=function(){throw Error()};if(Object.defineProperty(Z.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Z,[])}catch(j){var z=j}Reflect.construct(e,[],Z)}else{try{Z.call()}catch(j){z=j}e.call(Z.prototype)}}else{try{throw Error()}catch(j){z=j}(Z=e())&&typeof Z.catch=="function"&&Z.catch(function(){})}}catch(j){if(j&&z&&typeof j.stack=="string")return[j.stack,z.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=o.DetermineComponentFrameRoot(),y=d[0],v=d[1];if(y&&v){var w=y.split(`
`),q=v.split(`
`);for(c=o=0;o<w.length&&!w[o].includes("DetermineComponentFrameRoot");)o++;for(;c<q.length&&!q[c].includes("DetermineComponentFrameRoot");)c++;if(o===w.length||c===q.length)for(o=w.length-1,c=q.length-1;1<=o&&0<=c&&w[o]!==q[c];)c--;for(;1<=o&&0<=c;o--,c--)if(w[o]!==q[c]){if(o!==1||c!==1)do if(o--,c--,0>c||w[o]!==q[c]){var K=`
`+w[o].replace(" at new "," at ");return e.displayName&&K.includes("<anonymous>")&&(K=K.replace("<anonymous>",e.displayName)),K}while(1<=o&&0<=c);break}}}finally{re=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?X(i):""}function Ne(e){switch(e.tag){case 26:case 27:case 5:return X(e.type);case 16:return X("Lazy");case 13:return X("Suspense");case 19:return X("SuspenseList");case 0:case 15:return de(e.type,!1);case 11:return de(e.type.render,!1);case 1:return de(e.type,!0);case 31:return X("Activity");default:return""}}function Ye(e){try{var t="";do t+=Ne(e),e=e.return;while(e);return t}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function _e(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function et(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function nn(e){var t=et(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),o=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var c=i.get,d=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(y){o=""+y,d.call(this,y)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return o},setValue:function(y){o=""+y},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Mt(e){e._valueTracker||(e._valueTracker=nn(e))}function an(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),o="";return e&&(o=et(e)?e.checked?"true":"false":e.value),e=o,e!==i?(t.setValue(e),!0):!1}function sn(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Ui=/[\n"\\]/g;function pt(e){return e.replace(Ui,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function tt(e,t,i,o,c,d,y,v){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),t!=null?y==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+_e(t)):e.value!==""+_e(t)&&(e.value=""+_e(t)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),t!=null?Wa(e,y,_e(t)):i!=null?Wa(e,y,_e(i)):o!=null&&e.removeAttribute("value"),c==null&&d!=null&&(e.defaultChecked=!!d),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?e.name=""+_e(v):e.removeAttribute("name")}function Ja(e,t,i,o,c,d,y,v){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),t!=null||i!=null){if(!(d!=="submit"&&d!=="reset"||t!=null))return;i=i!=null?""+_e(i):"",t=t!=null?""+_e(t):i,v||t===e.value||(e.value=t),e.defaultValue=t}o=o??c,o=typeof o!="function"&&typeof o!="symbol"&&!!o,e.checked=v?e.checked:!!o,e.defaultChecked=!!o,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y)}function Wa(e,t,i){t==="number"&&sn(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function Ma(e,t,i,o){if(e=e.options,t){t={};for(var c=0;c<i.length;c++)t["$"+i[c]]=!0;for(i=0;i<e.length;i++)c=t.hasOwnProperty("$"+e[i].value),e[i].selected!==c&&(e[i].selected=c),c&&o&&(e[i].defaultSelected=!0)}else{for(i=""+_e(i),t=null,c=0;c<e.length;c++){if(e[c].value===i){e[c].selected=!0,o&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function $n(e,t,i){if(t!=null&&(t=""+_e(t),t!==e.value&&(e.value=t),i==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=i!=null?""+_e(i):""}function Jo(e,t,i,o){if(t==null){if(o!=null){if(i!=null)throw Error(r(92));if(B(o)){if(1<o.length)throw Error(r(93));o=o[0]}i=o}i==null&&(i=""),t=i}i=_e(t),e.defaultValue=i,o=e.textContent,o===i&&o!==""&&o!==null&&(e.value=o)}function ps(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var Yv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Sm(e,t,i){var o=t.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?o?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":o?e.setProperty(t,i):typeof i!="number"||i===0||Yv.has(t)?t==="float"?e.cssFloat=i:e[t]=(""+i).trim():e[t]=i+"px"}function Em(e,t,i){if(t!=null&&typeof t!="object")throw Error(r(62));if(e=e.style,i!=null){for(var o in i)!i.hasOwnProperty(o)||t!=null&&t.hasOwnProperty(o)||(o.indexOf("--")===0?e.setProperty(o,""):o==="float"?e.cssFloat="":e[o]="");for(var c in t)o=t[c],t.hasOwnProperty(c)&&i[c]!==o&&Sm(e,c,o)}else for(var d in t)t.hasOwnProperty(d)&&Sm(e,d,t[d])}function bu(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),$v=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Wo(e){return $v.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var vu=null;function Su(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var gs=null,ys=null;function Mm(e){var t=Pa(e);if(t&&(e=t.stateNode)){var i=e[mt]||null;e:switch(e=t.stateNode,t.type){case"input":if(tt(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+pt(""+t)+'"][type="radio"]'),t=0;t<i.length;t++){var o=i[t];if(o!==e&&o.form===e.form){var c=o[mt]||null;if(!c)throw Error(r(90));tt(o,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(t=0;t<i.length;t++)o=i[t],o.form===e.form&&an(o)}break e;case"textarea":$n(e,i.value,i.defaultValue);break e;case"select":t=i.value,t!=null&&Ma(e,!!i.multiple,t,!1)}}}var Eu=!1;function xm(e,t,i){if(Eu)return e(t,i);Eu=!0;try{var o=e(t);return o}finally{if(Eu=!1,(gs!==null||ys!==null)&&(Bl(),gs&&(t=gs,e=ys,ys=gs=null,Mm(t),e)))for(t=0;t<e.length;t++)Mm(e[t])}}function gr(e,t){var i=e.stateNode;if(i===null)return null;var o=i[mt]||null;if(o===null)return null;i=o[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(r(231,t,typeof i));return i}var xa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mu=!1;if(xa)try{var yr={};Object.defineProperty(yr,"passive",{get:function(){Mu=!0}}),window.addEventListener("test",yr,yr),window.removeEventListener("test",yr,yr)}catch{Mu=!1}var ei=null,xu=null,el=null;function wm(){if(el)return el;var e,t=xu,i=t.length,o,c="value"in ei?ei.value:ei.textContent,d=c.length;for(e=0;e<i&&t[e]===c[e];e++);var y=i-e;for(o=1;o<=y&&t[i-o]===c[d-o];o++);return el=c.slice(e,1<o?1-o:void 0)}function tl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function nl(){return!0}function Am(){return!1}function Vt(e){function t(i,o,c,d,y){this._reactName=i,this._targetInst=c,this.type=o,this.nativeEvent=d,this.target=y,this.currentTarget=null;for(var v in e)e.hasOwnProperty(v)&&(i=e[v],this[v]=i?i(d):d[v]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?nl:Am,this.isPropagationStopped=Am,this}return g(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=nl)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=nl)},persist:function(){},isPersistent:nl}),t}var Oi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},al=Vt(Oi),br=g({},Oi,{view:0,detail:0}),Vv=Vt(br),wu,Au,vr,il=g({},br,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==vr&&(vr&&e.type==="mousemove"?(wu=e.screenX-vr.screenX,Au=e.screenY-vr.screenY):Au=wu=0,vr=e),wu)},movementY:function(e){return"movementY"in e?e.movementY:Au}}),Cm=Vt(il),Xv=g({},il,{dataTransfer:0}),Kv=Vt(Xv),Qv=g({},br,{relatedTarget:0}),Cu=Vt(Qv),Pv=g({},Oi,{animationName:0,elapsedTime:0,pseudoElement:0}),Zv=Vt(Pv),Jv=g({},Oi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Wv=Vt(Jv),e1=g({},Oi,{data:0}),Tm=Vt(e1),t1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},n1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},a1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function i1(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=a1[e])?!!t[e]:!1}function Tu(){return i1}var s1=g({},br,{key:function(e){if(e.key){var t=t1[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=tl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?n1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tu,charCode:function(e){return e.type==="keypress"?tl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?tl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),r1=Vt(s1),o1=g({},il,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_m=Vt(o1),l1=g({},br,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tu}),c1=Vt(l1),u1=g({},Oi,{propertyName:0,elapsedTime:0,pseudoElement:0}),d1=Vt(u1),f1=g({},il,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),h1=Vt(f1),m1=g({},Oi,{newState:0,oldState:0}),p1=Vt(m1),g1=[9,13,27,32],_u=xa&&"CompositionEvent"in window,Sr=null;xa&&"documentMode"in document&&(Sr=document.documentMode);var y1=xa&&"TextEvent"in window&&!Sr,Rm=xa&&(!_u||Sr&&8<Sr&&11>=Sr),Nm=" ",km=!1;function Dm(e,t){switch(e){case"keyup":return g1.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Lm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var bs=!1;function b1(e,t){switch(e){case"compositionend":return Lm(t);case"keypress":return t.which!==32?null:(km=!0,Nm);case"textInput":return e=t.data,e===Nm&&km?null:e;default:return null}}function v1(e,t){if(bs)return e==="compositionend"||!_u&&Dm(e,t)?(e=wm(),el=xu=ei=null,bs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Rm&&t.locale!=="ko"?null:t.data;default:return null}}var S1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Um(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!S1[e.type]:t==="textarea"}function Om(e,t,i,o){gs?ys?ys.push(o):ys=[o]:gs=o,t=Fl(t,"onChange"),0<t.length&&(i=new al("onChange","change",null,i,o),e.push({event:i,listeners:t}))}var Er=null,Mr=null;function E1(e){pg(e,0)}function sl(e){var t=Sa(e);if(an(t))return e}function qm(e,t){if(e==="change")return t}var zm=!1;if(xa){var Ru;if(xa){var Nu="oninput"in document;if(!Nu){var Bm=document.createElement("div");Bm.setAttribute("oninput","return;"),Nu=typeof Bm.oninput=="function"}Ru=Nu}else Ru=!1;zm=Ru&&(!document.documentMode||9<document.documentMode)}function Hm(){Er&&(Er.detachEvent("onpropertychange",jm),Mr=Er=null)}function jm(e){if(e.propertyName==="value"&&sl(Mr)){var t=[];Om(t,Mr,e,Su(e)),xm(E1,t)}}function M1(e,t,i){e==="focusin"?(Hm(),Er=t,Mr=i,Er.attachEvent("onpropertychange",jm)):e==="focusout"&&Hm()}function x1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return sl(Mr)}function w1(e,t){if(e==="click")return sl(t)}function A1(e,t){if(e==="input"||e==="change")return sl(t)}function C1(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var rn=typeof Object.is=="function"?Object.is:C1;function xr(e,t){if(rn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;for(o=0;o<i.length;o++){var c=i[o];if(!en.call(t,c)||!rn(e[c],t[c]))return!1}return!0}function Im(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Gm(e,t){var i=Im(e);e=0;for(var o;i;){if(i.nodeType===3){if(o=e+i.textContent.length,e<=t&&o>=t)return{node:i,offset:t-e};e=o}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Im(i)}}function Ym(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Ym(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Fm(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=sn(e.document);t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=sn(e.document)}return t}function ku(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var T1=xa&&"documentMode"in document&&11>=document.documentMode,vs=null,Du=null,wr=null,Lu=!1;function $m(e,t,i){var o=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Lu||vs==null||vs!==sn(o)||(o=vs,"selectionStart"in o&&ku(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),wr&&xr(wr,o)||(wr=o,o=Fl(Du,"onSelect"),0<o.length&&(t=new al("onSelect","select",null,t,i),e.push({event:t,listeners:o}),t.target=vs)))}function qi(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Ss={animationend:qi("Animation","AnimationEnd"),animationiteration:qi("Animation","AnimationIteration"),animationstart:qi("Animation","AnimationStart"),transitionrun:qi("Transition","TransitionRun"),transitionstart:qi("Transition","TransitionStart"),transitioncancel:qi("Transition","TransitionCancel"),transitionend:qi("Transition","TransitionEnd")},Uu={},Vm={};xa&&(Vm=document.createElement("div").style,"AnimationEvent"in window||(delete Ss.animationend.animation,delete Ss.animationiteration.animation,delete Ss.animationstart.animation),"TransitionEvent"in window||delete Ss.transitionend.transition);function zi(e){if(Uu[e])return Uu[e];if(!Ss[e])return e;var t=Ss[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in Vm)return Uu[e]=t[i];return e}var Xm=zi("animationend"),Km=zi("animationiteration"),Qm=zi("animationstart"),_1=zi("transitionrun"),R1=zi("transitionstart"),N1=zi("transitioncancel"),Pm=zi("transitionend"),Zm=new Map,Ou="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ou.push("scrollEnd");function kn(e,t){Zm.set(e,t),Fn(t,[e])}var Jm=new WeakMap;function pn(e,t){if(typeof e=="object"&&e!==null){var i=Jm.get(e);return i!==void 0?i:(t={value:e,source:t,stack:Ye(t)},Jm.set(e,t),t)}return{value:e,source:t,stack:Ye(t)}}var gn=[],Es=0,qu=0;function rl(){for(var e=Es,t=qu=Es=0;t<e;){var i=gn[t];gn[t++]=null;var o=gn[t];gn[t++]=null;var c=gn[t];gn[t++]=null;var d=gn[t];if(gn[t++]=null,o!==null&&c!==null){var y=o.pending;y===null?c.next=c:(c.next=y.next,y.next=c),o.pending=c}d!==0&&Wm(i,c,d)}}function ol(e,t,i,o){gn[Es++]=e,gn[Es++]=t,gn[Es++]=i,gn[Es++]=o,qu|=o,e.lanes|=o,e=e.alternate,e!==null&&(e.lanes|=o)}function zu(e,t,i,o){return ol(e,t,i,o),ll(e)}function Ms(e,t){return ol(e,null,null,t),ll(e)}function Wm(e,t,i){e.lanes|=i;var o=e.alternate;o!==null&&(o.lanes|=i);for(var c=!1,d=e.return;d!==null;)d.childLanes|=i,o=d.alternate,o!==null&&(o.childLanes|=i),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(c=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,c&&t!==null&&(c=31-ft(i),e=d.hiddenUpdates,o=e[c],o===null?e[c]=[t]:o.push(t),t.lane=i|536870912),d):null}function ll(e){if(50<Qr)throw Qr=0,Yd=null,Error(r(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var xs={};function k1(e,t,i,o){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function on(e,t,i,o){return new k1(e,t,i,o)}function Bu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function wa(e,t){var i=e.alternate;return i===null?(i=on(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function ep(e,t){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,t=i.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function cl(e,t,i,o,c,d){var y=0;if(o=e,typeof e=="function")Bu(e)&&(y=1);else if(typeof e=="string")y=LS(e,i,le.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ee:return e=on(31,i,t,c),e.elementType=ee,e.lanes=d,e;case M:return Bi(i.children,c,d,t);case N:y=8,c|=24;break;case _:return e=on(12,i,t,c|2),e.elementType=_,e.lanes=d,e;case P:return e=on(13,i,t,c),e.elementType=P,e.lanes=d,e;case ie:return e=on(19,i,t,c),e.elementType=ie,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case U:case I:y=10;break e;case H:y=9;break e;case $:y=11;break e;case se:y=14;break e;case oe:y=16,o=null;break e}y=29,i=Error(r(130,e===null?"null":typeof e,"")),o=null}return t=on(y,i,t,c),t.elementType=e,t.type=o,t.lanes=d,t}function Bi(e,t,i,o){return e=on(7,e,o,t),e.lanes=i,e}function Hu(e,t,i){return e=on(6,e,null,t),e.lanes=i,e}function ju(e,t,i){return t=on(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var ws=[],As=0,ul=null,dl=0,yn=[],bn=0,Hi=null,Aa=1,Ca="";function ji(e,t){ws[As++]=dl,ws[As++]=ul,ul=e,dl=t}function tp(e,t,i){yn[bn++]=Aa,yn[bn++]=Ca,yn[bn++]=Hi,Hi=e;var o=Aa;e=Ca;var c=32-ft(o)-1;o&=~(1<<c),i+=1;var d=32-ft(t)+c;if(30<d){var y=c-c%5;d=(o&(1<<y)-1).toString(32),o>>=y,c-=y,Aa=1<<32-ft(t)+c|i<<c|o,Ca=d+e}else Aa=1<<d|i<<c|o,Ca=e}function Iu(e){e.return!==null&&(ji(e,1),tp(e,1,0))}function Gu(e){for(;e===ul;)ul=ws[--As],ws[As]=null,dl=ws[--As],ws[As]=null;for(;e===Hi;)Hi=yn[--bn],yn[bn]=null,Ca=yn[--bn],yn[bn]=null,Aa=yn[--bn],yn[bn]=null}var Bt=null,nt=null,Le=!1,Ii=null,Vn=!1,Yu=Error(r(519));function Gi(e){var t=Error(r(418,""));throw Tr(pn(t,e)),Yu}function np(e){var t=e.stateNode,i=e.type,o=e.memoizedProps;switch(t[Je]=e,t[mt]=o,i){case"dialog":Te("cancel",t),Te("close",t);break;case"iframe":case"object":case"embed":Te("load",t);break;case"video":case"audio":for(i=0;i<Zr.length;i++)Te(Zr[i],t);break;case"source":Te("error",t);break;case"img":case"image":case"link":Te("error",t),Te("load",t);break;case"details":Te("toggle",t);break;case"input":Te("invalid",t),Ja(t,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0),Mt(t);break;case"select":Te("invalid",t);break;case"textarea":Te("invalid",t),Jo(t,o.value,o.defaultValue,o.children),Mt(t)}i=o.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||t.textContent===""+i||o.suppressHydrationWarning===!0||vg(t.textContent,i)?(o.popover!=null&&(Te("beforetoggle",t),Te("toggle",t)),o.onScroll!=null&&Te("scroll",t),o.onScrollEnd!=null&&Te("scrollend",t),o.onClick!=null&&(t.onclick=$l),t=!0):t=!1,t||Gi(e)}function ap(e){for(Bt=e.return;Bt;)switch(Bt.tag){case 5:case 13:Vn=!1;return;case 27:case 3:Vn=!0;return;default:Bt=Bt.return}}function Ar(e){if(e!==Bt)return!1;if(!Le)return ap(e),Le=!0,!1;var t=e.tag,i;if((i=t!==3&&t!==27)&&((i=t===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||rf(e.type,e.memoizedProps)),i=!i),i&&nt&&Gi(e),ap(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(i=e.data,i==="/$"){if(t===0){nt=Ln(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++;e=e.nextSibling}nt=null}}else t===27?(t=nt,gi(e.type)?(e=uf,uf=null,nt=e):nt=t):nt=Bt?Ln(e.stateNode.nextSibling):null;return!0}function Cr(){nt=Bt=null,Le=!1}function ip(){var e=Ii;return e!==null&&(Qt===null?Qt=e:Qt.push.apply(Qt,e),Ii=null),e}function Tr(e){Ii===null?Ii=[e]:Ii.push(e)}var Fu=V(null),Yi=null,Ta=null;function ti(e,t,i){W(Fu,t._currentValue),t._currentValue=i}function _a(e){e._currentValue=Fu.current,te(Fu)}function $u(e,t,i){for(;e!==null;){var o=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,o!==null&&(o.childLanes|=t)):o!==null&&(o.childLanes&t)!==t&&(o.childLanes|=t),e===i)break;e=e.return}}function Vu(e,t,i,o){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var d=c.dependencies;if(d!==null){var y=c.child;d=d.firstContext;e:for(;d!==null;){var v=d;d=c;for(var w=0;w<t.length;w++)if(v.context===t[w]){d.lanes|=i,v=d.alternate,v!==null&&(v.lanes|=i),$u(d.return,i,e),o||(y=null);break e}d=v.next}}else if(c.tag===18){if(y=c.return,y===null)throw Error(r(341));y.lanes|=i,d=y.alternate,d!==null&&(d.lanes|=i),$u(y,i,e),y=null}else y=c.child;if(y!==null)y.return=c;else for(y=c;y!==null;){if(y===e){y=null;break}if(c=y.sibling,c!==null){c.return=y.return,y=c;break}y=y.return}c=y}}function _r(e,t,i,o){e=null;for(var c=t,d=!1;c!==null;){if(!d){if((c.flags&524288)!==0)d=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var y=c.alternate;if(y===null)throw Error(r(387));if(y=y.memoizedProps,y!==null){var v=c.type;rn(c.pendingProps.value,y.value)||(e!==null?e.push(v):e=[v])}}else if(c===Ge.current){if(y=c.alternate,y===null)throw Error(r(387));y.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(ao):e=[ao])}c=c.return}e!==null&&Vu(t,e,i,o),t.flags|=262144}function fl(e){for(e=e.firstContext;e!==null;){if(!rn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Fi(e){Yi=e,Ta=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Dt(e){return sp(Yi,e)}function hl(e,t){return Yi===null&&Fi(e),sp(e,t)}function sp(e,t){var i=t._currentValue;if(t={context:t,memoizedValue:i,next:null},Ta===null){if(e===null)throw Error(r(308));Ta=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Ta=Ta.next=t;return i}var D1=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(i,o){e.push(o)}};this.abort=function(){t.aborted=!0,e.forEach(function(i){return i()})}},L1=n.unstable_scheduleCallback,U1=n.unstable_NormalPriority,gt={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xu(){return{controller:new D1,data:new Map,refCount:0}}function Rr(e){e.refCount--,e.refCount===0&&L1(U1,function(){e.controller.abort()})}var Nr=null,Ku=0,Cs=0,Ts=null;function O1(e,t){if(Nr===null){var i=Nr=[];Ku=0,Cs=Pd(),Ts={status:"pending",value:void 0,then:function(o){i.push(o)}}}return Ku++,t.then(rp,rp),t}function rp(){if(--Ku===0&&Nr!==null){Ts!==null&&(Ts.status="fulfilled");var e=Nr;Nr=null,Cs=0,Ts=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function q1(e,t){var i=[],o={status:"pending",value:null,reason:null,then:function(c){i.push(c)}};return e.then(function(){o.status="fulfilled",o.value=t;for(var c=0;c<i.length;c++)(0,i[c])(t)},function(c){for(o.status="rejected",o.reason=c,c=0;c<i.length;c++)(0,i[c])(void 0)}),o}var op=T.S;T.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&O1(e,t),op!==null&&op(e,t)};var $i=V(null);function Qu(){var e=$i.current;return e!==null?e:Ve.pooledCache}function ml(e,t){t===null?W($i,$i.current):W($i,t.pool)}function lp(){var e=Qu();return e===null?null:{parent:gt._currentValue,pool:e}}var kr=Error(r(460)),cp=Error(r(474)),pl=Error(r(542)),Pu={then:function(){}};function up(e){return e=e.status,e==="fulfilled"||e==="rejected"}function gl(){}function dp(e,t,i){switch(i=e[i],i===void 0?e.push(t):i!==t&&(t.then(gl,gl),t=i),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,hp(e),e;default:if(typeof t.status=="string")t.then(gl,gl);else{if(e=Ve,e!==null&&100<e.shellSuspendCounter)throw Error(r(482));e=t,e.status="pending",e.then(function(o){if(t.status==="pending"){var c=t;c.status="fulfilled",c.value=o}},function(o){if(t.status==="pending"){var c=t;c.status="rejected",c.reason=o}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,hp(e),e}throw Dr=t,kr}}var Dr=null;function fp(){if(Dr===null)throw Error(r(459));var e=Dr;return Dr=null,e}function hp(e){if(e===kr||e===pl)throw Error(r(483))}var ni=!1;function Zu(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ju(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ai(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ii(e,t,i){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,(Oe&2)!==0){var c=o.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),o.pending=t,t=ll(e),Wm(e,null,i),t}return ol(e,o,t,i),ll(e)}function Lr(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194048)!==0)){var o=t.lanes;o&=e.pendingLanes,i|=o,t.lanes=i,pa(e,i)}}function Wu(e,t){var i=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,i===o)){var c=null,d=null;if(i=i.firstBaseUpdate,i!==null){do{var y={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};d===null?c=d=y:d=d.next=y,i=i.next}while(i!==null);d===null?c=d=t:d=d.next=t}else c=d=t;i={baseState:o.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:o.shared,callbacks:o.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}var ed=!1;function Ur(){if(ed){var e=Ts;if(e!==null)throw e}}function Or(e,t,i,o){ed=!1;var c=e.updateQueue;ni=!1;var d=c.firstBaseUpdate,y=c.lastBaseUpdate,v=c.shared.pending;if(v!==null){c.shared.pending=null;var w=v,q=w.next;w.next=null,y===null?d=q:y.next=q,y=w;var K=e.alternate;K!==null&&(K=K.updateQueue,v=K.lastBaseUpdate,v!==y&&(v===null?K.firstBaseUpdate=q:v.next=q,K.lastBaseUpdate=w))}if(d!==null){var Z=c.baseState;y=0,K=q=w=null,v=d;do{var z=v.lane&-536870913,j=z!==v.lane;if(j?(ke&z)===z:(o&z)===z){z!==0&&z===Cs&&(ed=!0),K!==null&&(K=K.next={lane:0,tag:v.tag,payload:v.payload,callback:null,next:null});e:{var be=e,ge=v;z=t;var je=i;switch(ge.tag){case 1:if(be=ge.payload,typeof be=="function"){Z=be.call(je,Z,z);break e}Z=be;break e;case 3:be.flags=be.flags&-65537|128;case 0:if(be=ge.payload,z=typeof be=="function"?be.call(je,Z,z):be,z==null)break e;Z=g({},Z,z);break e;case 2:ni=!0}}z=v.callback,z!==null&&(e.flags|=64,j&&(e.flags|=8192),j=c.callbacks,j===null?c.callbacks=[z]:j.push(z))}else j={lane:z,tag:v.tag,payload:v.payload,callback:v.callback,next:null},K===null?(q=K=j,w=Z):K=K.next=j,y|=z;if(v=v.next,v===null){if(v=c.shared.pending,v===null)break;j=v,v=j.next,j.next=null,c.lastBaseUpdate=j,c.shared.pending=null}}while(!0);K===null&&(w=Z),c.baseState=w,c.firstBaseUpdate=q,c.lastBaseUpdate=K,d===null&&(c.shared.lanes=0),fi|=y,e.lanes=y,e.memoizedState=Z}}function mp(e,t){if(typeof e!="function")throw Error(r(191,e));e.call(t)}function pp(e,t){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)mp(i[e],t)}var _s=V(null),yl=V(0);function gp(e,t){e=Oa,W(yl,e),W(_s,t),Oa=e|t.baseLanes}function td(){W(yl,Oa),W(_s,_s.current)}function nd(){Oa=yl.current,te(_s),te(yl)}var si=0,Me=null,Be=null,ct=null,bl=!1,Rs=!1,Vi=!1,vl=0,qr=0,Ns=null,z1=0;function st(){throw Error(r(321))}function ad(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!rn(e[i],t[i]))return!1;return!0}function id(e,t,i,o,c,d){return si=d,Me=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,T.H=e===null||e.memoizedState===null?Wp:e0,Vi=!1,d=i(o,c),Vi=!1,Rs&&(d=bp(t,i,o,c)),yp(e),d}function yp(e){T.H=Al;var t=Be!==null&&Be.next!==null;if(si=0,ct=Be=Me=null,bl=!1,qr=0,Ns=null,t)throw Error(r(300));e===null||xt||(e=e.dependencies,e!==null&&fl(e)&&(xt=!0))}function bp(e,t,i,o){Me=e;var c=0;do{if(Rs&&(Ns=null),qr=0,Rs=!1,25<=c)throw Error(r(301));if(c+=1,ct=Be=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}T.H=F1,d=t(i,o)}while(Rs);return d}function B1(){var e=T.H,t=e.useState()[0];return t=typeof t.then=="function"?zr(t):t,e=e.useState()[0],(Be!==null?Be.memoizedState:null)!==e&&(Me.flags|=1024),t}function sd(){var e=vl!==0;return vl=0,e}function rd(e,t,i){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i}function od(e){if(bl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}bl=!1}si=0,ct=Be=Me=null,Rs=!1,qr=vl=0,Ns=null}function Xt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ct===null?Me.memoizedState=ct=e:ct=ct.next=e,ct}function ut(){if(Be===null){var e=Me.alternate;e=e!==null?e.memoizedState:null}else e=Be.next;var t=ct===null?Me.memoizedState:ct.next;if(t!==null)ct=t,Be=e;else{if(e===null)throw Me.alternate===null?Error(r(467)):Error(r(310));Be=e,e={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},ct===null?Me.memoizedState=ct=e:ct=ct.next=e}return ct}function ld(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function zr(e){var t=qr;return qr+=1,Ns===null&&(Ns=[]),e=dp(Ns,e,t),t=Me,(ct===null?t.memoizedState:ct.next)===null&&(t=t.alternate,T.H=t===null||t.memoizedState===null?Wp:e0),e}function Sl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return zr(e);if(e.$$typeof===I)return Dt(e)}throw Error(r(438,String(e)))}function cd(e){var t=null,i=Me.updateQueue;if(i!==null&&(t=i.memoCache),t==null){var o=Me.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(t={data:o.data.map(function(c){return c.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),i===null&&(i=ld(),Me.updateQueue=i),i.memoCache=t,i=t.data[t.index],i===void 0)for(i=t.data[t.index]=Array(e),o=0;o<e;o++)i[o]=Y;return t.index++,i}function Ra(e,t){return typeof t=="function"?t(e):t}function El(e){var t=ut();return ud(t,Be,e)}function ud(e,t,i){var o=e.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=i;var c=e.baseQueue,d=o.pending;if(d!==null){if(c!==null){var y=c.next;c.next=d.next,d.next=y}t.baseQueue=c=d,o.pending=null}if(d=e.baseState,c===null)e.memoizedState=d;else{t=c.next;var v=y=null,w=null,q=t,K=!1;do{var Z=q.lane&-536870913;if(Z!==q.lane?(ke&Z)===Z:(si&Z)===Z){var z=q.revertLane;if(z===0)w!==null&&(w=w.next={lane:0,revertLane:0,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),Z===Cs&&(K=!0);else if((si&z)===z){q=q.next,z===Cs&&(K=!0);continue}else Z={lane:0,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},w===null?(v=w=Z,y=d):w=w.next=Z,Me.lanes|=z,fi|=z;Z=q.action,Vi&&i(d,Z),d=q.hasEagerState?q.eagerState:i(d,Z)}else z={lane:Z,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},w===null?(v=w=z,y=d):w=w.next=z,Me.lanes|=Z,fi|=Z;q=q.next}while(q!==null&&q!==t);if(w===null?y=d:w.next=v,!rn(d,e.memoizedState)&&(xt=!0,K&&(i=Ts,i!==null)))throw i;e.memoizedState=d,e.baseState=y,e.baseQueue=w,o.lastRenderedState=d}return c===null&&(o.lanes=0),[e.memoizedState,o.dispatch]}function dd(e){var t=ut(),i=t.queue;if(i===null)throw Error(r(311));i.lastRenderedReducer=e;var o=i.dispatch,c=i.pending,d=t.memoizedState;if(c!==null){i.pending=null;var y=c=c.next;do d=e(d,y.action),y=y.next;while(y!==c);rn(d,t.memoizedState)||(xt=!0),t.memoizedState=d,t.baseQueue===null&&(t.baseState=d),i.lastRenderedState=d}return[d,o]}function vp(e,t,i){var o=Me,c=ut(),d=Le;if(d){if(i===void 0)throw Error(r(407));i=i()}else i=t();var y=!rn((Be||c).memoizedState,i);y&&(c.memoizedState=i,xt=!0),c=c.queue;var v=Mp.bind(null,o,c,e);if(Br(2048,8,v,[e]),c.getSnapshot!==t||y||ct!==null&&ct.memoizedState.tag&1){if(o.flags|=2048,ks(9,Ml(),Ep.bind(null,o,c,i,t),null),Ve===null)throw Error(r(349));d||(si&124)!==0||Sp(o,t,i)}return i}function Sp(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Me.updateQueue,t===null?(t=ld(),Me.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function Ep(e,t,i,o){t.value=i,t.getSnapshot=o,xp(t)&&wp(e)}function Mp(e,t,i){return i(function(){xp(t)&&wp(e)})}function xp(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!rn(e,i)}catch{return!0}}function wp(e){var t=Ms(e,2);t!==null&&fn(t,e,2)}function fd(e){var t=Xt();if(typeof e=="function"){var i=e;if(e=i(),Vi){tn(!0);try{i()}finally{tn(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ra,lastRenderedState:e},t}function Ap(e,t,i,o){return e.baseState=i,ud(e,Be,typeof o=="function"?o:Ra)}function H1(e,t,i,o,c){if(wl(e))throw Error(r(485));if(e=t.action,e!==null){var d={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){d.listeners.push(y)}};T.T!==null?i(!0):d.isTransition=!1,o(d),i=t.pending,i===null?(d.next=t.pending=d,Cp(t,d)):(d.next=i.next,t.pending=i.next=d)}}function Cp(e,t){var i=t.action,o=t.payload,c=e.state;if(t.isTransition){var d=T.T,y={};T.T=y;try{var v=i(c,o),w=T.S;w!==null&&w(y,v),Tp(e,t,v)}catch(q){hd(e,t,q)}finally{T.T=d}}else try{d=i(c,o),Tp(e,t,d)}catch(q){hd(e,t,q)}}function Tp(e,t,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(o){_p(e,t,o)},function(o){return hd(e,t,o)}):_p(e,t,i)}function _p(e,t,i){t.status="fulfilled",t.value=i,Rp(t),e.state=i,t=e.pending,t!==null&&(i=t.next,i===t?e.pending=null:(i=i.next,t.next=i,Cp(e,i)))}function hd(e,t,i){var o=e.pending;if(e.pending=null,o!==null){o=o.next;do t.status="rejected",t.reason=i,Rp(t),t=t.next;while(t!==o)}e.action=null}function Rp(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Np(e,t){return t}function kp(e,t){if(Le){var i=Ve.formState;if(i!==null){e:{var o=Me;if(Le){if(nt){t:{for(var c=nt,d=Vn;c.nodeType!==8;){if(!d){c=null;break t}if(c=Ln(c.nextSibling),c===null){c=null;break t}}d=c.data,c=d==="F!"||d==="F"?c:null}if(c){nt=Ln(c.nextSibling),o=c.data==="F!";break e}}Gi(o)}o=!1}o&&(t=i[0])}}return i=Xt(),i.memoizedState=i.baseState=t,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Np,lastRenderedState:t},i.queue=o,i=Pp.bind(null,Me,o),o.dispatch=i,o=fd(!1),d=bd.bind(null,Me,!1,o.queue),o=Xt(),c={state:t,dispatch:null,action:e,pending:null},o.queue=c,i=H1.bind(null,Me,c,d,i),c.dispatch=i,o.memoizedState=e,[t,i,!1]}function Dp(e){var t=ut();return Lp(t,Be,e)}function Lp(e,t,i){if(t=ud(e,t,Np)[0],e=El(Ra)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var o=zr(t)}catch(y){throw y===kr?pl:y}else o=t;t=ut();var c=t.queue,d=c.dispatch;return i!==t.memoizedState&&(Me.flags|=2048,ks(9,Ml(),j1.bind(null,c,i),null)),[o,d,e]}function j1(e,t){e.action=t}function Up(e){var t=ut(),i=Be;if(i!==null)return Lp(t,i,e);ut(),t=t.memoizedState,i=ut();var o=i.queue.dispatch;return i.memoizedState=e,[t,o,!1]}function ks(e,t,i,o){return e={tag:e,create:i,deps:o,inst:t,next:null},t=Me.updateQueue,t===null&&(t=ld(),Me.updateQueue=t),i=t.lastEffect,i===null?t.lastEffect=e.next=e:(o=i.next,i.next=e,e.next=o,t.lastEffect=e),e}function Ml(){return{destroy:void 0,resource:void 0}}function Op(){return ut().memoizedState}function xl(e,t,i,o){var c=Xt();o=o===void 0?null:o,Me.flags|=e,c.memoizedState=ks(1|t,Ml(),i,o)}function Br(e,t,i,o){var c=ut();o=o===void 0?null:o;var d=c.memoizedState.inst;Be!==null&&o!==null&&ad(o,Be.memoizedState.deps)?c.memoizedState=ks(t,d,i,o):(Me.flags|=e,c.memoizedState=ks(1|t,d,i,o))}function qp(e,t){xl(8390656,8,e,t)}function zp(e,t){Br(2048,8,e,t)}function Bp(e,t){return Br(4,2,e,t)}function Hp(e,t){return Br(4,4,e,t)}function jp(e,t){if(typeof t=="function"){e=e();var i=t(e);return function(){typeof i=="function"?i():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Ip(e,t,i){i=i!=null?i.concat([e]):null,Br(4,4,jp.bind(null,t,e),i)}function md(){}function Gp(e,t){var i=ut();t=t===void 0?null:t;var o=i.memoizedState;return t!==null&&ad(t,o[1])?o[0]:(i.memoizedState=[e,t],e)}function Yp(e,t){var i=ut();t=t===void 0?null:t;var o=i.memoizedState;if(t!==null&&ad(t,o[1]))return o[0];if(o=e(),Vi){tn(!0);try{e()}finally{tn(!1)}}return i.memoizedState=[o,t],o}function pd(e,t,i){return i===void 0||(si&1073741824)!==0?e.memoizedState=t:(e.memoizedState=i,e=V0(),Me.lanes|=e,fi|=e,i)}function Fp(e,t,i,o){return rn(i,t)?i:_s.current!==null?(e=pd(e,i,o),rn(e,t)||(xt=!0),e):(si&42)===0?(xt=!0,e.memoizedState=i):(e=V0(),Me.lanes|=e,fi|=e,t)}function $p(e,t,i,o,c){var d=G.p;G.p=d!==0&&8>d?d:8;var y=T.T,v={};T.T=v,bd(e,!1,t,i);try{var w=c(),q=T.S;if(q!==null&&q(v,w),w!==null&&typeof w=="object"&&typeof w.then=="function"){var K=q1(w,o);Hr(e,t,K,dn(e))}else Hr(e,t,o,dn(e))}catch(Z){Hr(e,t,{then:function(){},status:"rejected",reason:Z},dn())}finally{G.p=d,T.T=y}}function I1(){}function gd(e,t,i,o){if(e.tag!==5)throw Error(r(476));var c=Vp(e).queue;$p(e,c,t,J,i===null?I1:function(){return Xp(e),i(o)})}function Vp(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ra,lastRenderedState:J},next:null};var i={};return t.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ra,lastRenderedState:i},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Xp(e){var t=Vp(e).next.queue;Hr(e,t,{},dn())}function yd(){return Dt(ao)}function Kp(){return ut().memoizedState}function Qp(){return ut().memoizedState}function G1(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var i=dn();e=ai(i);var o=ii(t,e,i);o!==null&&(fn(o,t,i),Lr(o,t,i)),t={cache:Xu()},e.payload=t;return}t=t.return}}function Y1(e,t,i){var o=dn();i={lane:o,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},wl(e)?Zp(t,i):(i=zu(e,t,i,o),i!==null&&(fn(i,e,o),Jp(i,t,o)))}function Pp(e,t,i){var o=dn();Hr(e,t,i,o)}function Hr(e,t,i,o){var c={lane:o,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(wl(e))Zp(t,c);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=t.lastRenderedReducer,d!==null))try{var y=t.lastRenderedState,v=d(y,i);if(c.hasEagerState=!0,c.eagerState=v,rn(v,y))return ol(e,t,c,0),Ve===null&&rl(),!1}catch{}finally{}if(i=zu(e,t,c,o),i!==null)return fn(i,e,o),Jp(i,t,o),!0}return!1}function bd(e,t,i,o){if(o={lane:2,revertLane:Pd(),action:o,hasEagerState:!1,eagerState:null,next:null},wl(e)){if(t)throw Error(r(479))}else t=zu(e,i,o,2),t!==null&&fn(t,e,2)}function wl(e){var t=e.alternate;return e===Me||t!==null&&t===Me}function Zp(e,t){Rs=bl=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Jp(e,t,i){if((i&4194048)!==0){var o=t.lanes;o&=e.pendingLanes,i|=o,t.lanes=i,pa(e,i)}}var Al={readContext:Dt,use:Sl,useCallback:st,useContext:st,useEffect:st,useImperativeHandle:st,useLayoutEffect:st,useInsertionEffect:st,useMemo:st,useReducer:st,useRef:st,useState:st,useDebugValue:st,useDeferredValue:st,useTransition:st,useSyncExternalStore:st,useId:st,useHostTransitionStatus:st,useFormState:st,useActionState:st,useOptimistic:st,useMemoCache:st,useCacheRefresh:st},Wp={readContext:Dt,use:Sl,useCallback:function(e,t){return Xt().memoizedState=[e,t===void 0?null:t],e},useContext:Dt,useEffect:qp,useImperativeHandle:function(e,t,i){i=i!=null?i.concat([e]):null,xl(4194308,4,jp.bind(null,t,e),i)},useLayoutEffect:function(e,t){return xl(4194308,4,e,t)},useInsertionEffect:function(e,t){xl(4,2,e,t)},useMemo:function(e,t){var i=Xt();t=t===void 0?null:t;var o=e();if(Vi){tn(!0);try{e()}finally{tn(!1)}}return i.memoizedState=[o,t],o},useReducer:function(e,t,i){var o=Xt();if(i!==void 0){var c=i(t);if(Vi){tn(!0);try{i(t)}finally{tn(!1)}}}else c=t;return o.memoizedState=o.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},o.queue=e,e=e.dispatch=Y1.bind(null,Me,e),[o.memoizedState,e]},useRef:function(e){var t=Xt();return e={current:e},t.memoizedState=e},useState:function(e){e=fd(e);var t=e.queue,i=Pp.bind(null,Me,t);return t.dispatch=i,[e.memoizedState,i]},useDebugValue:md,useDeferredValue:function(e,t){var i=Xt();return pd(i,e,t)},useTransition:function(){var e=fd(!1);return e=$p.bind(null,Me,e.queue,!0,!1),Xt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,i){var o=Me,c=Xt();if(Le){if(i===void 0)throw Error(r(407));i=i()}else{if(i=t(),Ve===null)throw Error(r(349));(ke&124)!==0||Sp(o,t,i)}c.memoizedState=i;var d={value:i,getSnapshot:t};return c.queue=d,qp(Mp.bind(null,o,d,e),[e]),o.flags|=2048,ks(9,Ml(),Ep.bind(null,o,d,i,t),null),i},useId:function(){var e=Xt(),t=Ve.identifierPrefix;if(Le){var i=Ca,o=Aa;i=(o&~(1<<32-ft(o)-1)).toString(32)+i,t=""+t+"R"+i,i=vl++,0<i&&(t+="H"+i.toString(32)),t+=""}else i=z1++,t=""+t+"r"+i.toString(32)+"";return e.memoizedState=t},useHostTransitionStatus:yd,useFormState:kp,useActionState:kp,useOptimistic:function(e){var t=Xt();t.memoizedState=t.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=i,t=bd.bind(null,Me,!0,i),i.dispatch=t,[e,t]},useMemoCache:cd,useCacheRefresh:function(){return Xt().memoizedState=G1.bind(null,Me)}},e0={readContext:Dt,use:Sl,useCallback:Gp,useContext:Dt,useEffect:zp,useImperativeHandle:Ip,useInsertionEffect:Bp,useLayoutEffect:Hp,useMemo:Yp,useReducer:El,useRef:Op,useState:function(){return El(Ra)},useDebugValue:md,useDeferredValue:function(e,t){var i=ut();return Fp(i,Be.memoizedState,e,t)},useTransition:function(){var e=El(Ra)[0],t=ut().memoizedState;return[typeof e=="boolean"?e:zr(e),t]},useSyncExternalStore:vp,useId:Kp,useHostTransitionStatus:yd,useFormState:Dp,useActionState:Dp,useOptimistic:function(e,t){var i=ut();return Ap(i,Be,e,t)},useMemoCache:cd,useCacheRefresh:Qp},F1={readContext:Dt,use:Sl,useCallback:Gp,useContext:Dt,useEffect:zp,useImperativeHandle:Ip,useInsertionEffect:Bp,useLayoutEffect:Hp,useMemo:Yp,useReducer:dd,useRef:Op,useState:function(){return dd(Ra)},useDebugValue:md,useDeferredValue:function(e,t){var i=ut();return Be===null?pd(i,e,t):Fp(i,Be.memoizedState,e,t)},useTransition:function(){var e=dd(Ra)[0],t=ut().memoizedState;return[typeof e=="boolean"?e:zr(e),t]},useSyncExternalStore:vp,useId:Kp,useHostTransitionStatus:yd,useFormState:Up,useActionState:Up,useOptimistic:function(e,t){var i=ut();return Be!==null?Ap(i,Be,e,t):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:cd,useCacheRefresh:Qp},Ds=null,jr=0;function Cl(e){var t=jr;return jr+=1,Ds===null&&(Ds=[]),dp(Ds,e,t)}function Ir(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Tl(e,t){throw t.$$typeof===b?Error(r(525)):(e=Object.prototype.toString.call(t),Error(r(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function t0(e){var t=e._init;return t(e._payload)}function n0(e){function t(L,C){if(e){var O=L.deletions;O===null?(L.deletions=[C],L.flags|=16):O.push(C)}}function i(L,C){if(!e)return null;for(;C!==null;)t(L,C),C=C.sibling;return null}function o(L){for(var C=new Map;L!==null;)L.key!==null?C.set(L.key,L):C.set(L.index,L),L=L.sibling;return C}function c(L,C){return L=wa(L,C),L.index=0,L.sibling=null,L}function d(L,C,O){return L.index=O,e?(O=L.alternate,O!==null?(O=O.index,O<C?(L.flags|=67108866,C):O):(L.flags|=67108866,C)):(L.flags|=1048576,C)}function y(L){return e&&L.alternate===null&&(L.flags|=67108866),L}function v(L,C,O,Q){return C===null||C.tag!==6?(C=Hu(O,L.mode,Q),C.return=L,C):(C=c(C,O),C.return=L,C)}function w(L,C,O,Q){var ue=O.type;return ue===M?K(L,C,O.props.children,Q,O.key):C!==null&&(C.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===oe&&t0(ue)===C.type)?(C=c(C,O.props),Ir(C,O),C.return=L,C):(C=cl(O.type,O.key,O.props,null,L.mode,Q),Ir(C,O),C.return=L,C)}function q(L,C,O,Q){return C===null||C.tag!==4||C.stateNode.containerInfo!==O.containerInfo||C.stateNode.implementation!==O.implementation?(C=ju(O,L.mode,Q),C.return=L,C):(C=c(C,O.children||[]),C.return=L,C)}function K(L,C,O,Q,ue){return C===null||C.tag!==7?(C=Bi(O,L.mode,Q,ue),C.return=L,C):(C=c(C,O),C.return=L,C)}function Z(L,C,O){if(typeof C=="string"&&C!==""||typeof C=="number"||typeof C=="bigint")return C=Hu(""+C,L.mode,O),C.return=L,C;if(typeof C=="object"&&C!==null){switch(C.$$typeof){case S:return O=cl(C.type,C.key,C.props,null,L.mode,O),Ir(O,C),O.return=L,O;case E:return C=ju(C,L.mode,O),C.return=L,C;case oe:var Q=C._init;return C=Q(C._payload),Z(L,C,O)}if(B(C)||k(C))return C=Bi(C,L.mode,O,null),C.return=L,C;if(typeof C.then=="function")return Z(L,Cl(C),O);if(C.$$typeof===I)return Z(L,hl(L,C),O);Tl(L,C)}return null}function z(L,C,O,Q){var ue=C!==null?C.key:null;if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return ue!==null?null:v(L,C,""+O,Q);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case S:return O.key===ue?w(L,C,O,Q):null;case E:return O.key===ue?q(L,C,O,Q):null;case oe:return ue=O._init,O=ue(O._payload),z(L,C,O,Q)}if(B(O)||k(O))return ue!==null?null:K(L,C,O,Q,null);if(typeof O.then=="function")return z(L,C,Cl(O),Q);if(O.$$typeof===I)return z(L,C,hl(L,O),Q);Tl(L,O)}return null}function j(L,C,O,Q,ue){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return L=L.get(O)||null,v(C,L,""+Q,ue);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case S:return L=L.get(Q.key===null?O:Q.key)||null,w(C,L,Q,ue);case E:return L=L.get(Q.key===null?O:Q.key)||null,q(C,L,Q,ue);case oe:var we=Q._init;return Q=we(Q._payload),j(L,C,O,Q,ue)}if(B(Q)||k(Q))return L=L.get(O)||null,K(C,L,Q,ue,null);if(typeof Q.then=="function")return j(L,C,O,Cl(Q),ue);if(Q.$$typeof===I)return j(L,C,O,hl(C,Q),ue);Tl(C,Q)}return null}function be(L,C,O,Q){for(var ue=null,we=null,me=C,ye=C=0,At=null;me!==null&&ye<O.length;ye++){me.index>ye?(At=me,me=null):At=me.sibling;var De=z(L,me,O[ye],Q);if(De===null){me===null&&(me=At);break}e&&me&&De.alternate===null&&t(L,me),C=d(De,C,ye),we===null?ue=De:we.sibling=De,we=De,me=At}if(ye===O.length)return i(L,me),Le&&ji(L,ye),ue;if(me===null){for(;ye<O.length;ye++)me=Z(L,O[ye],Q),me!==null&&(C=d(me,C,ye),we===null?ue=me:we.sibling=me,we=me);return Le&&ji(L,ye),ue}for(me=o(me);ye<O.length;ye++)At=j(me,L,ye,O[ye],Q),At!==null&&(e&&At.alternate!==null&&me.delete(At.key===null?ye:At.key),C=d(At,C,ye),we===null?ue=At:we.sibling=At,we=At);return e&&me.forEach(function(Ei){return t(L,Ei)}),Le&&ji(L,ye),ue}function ge(L,C,O,Q){if(O==null)throw Error(r(151));for(var ue=null,we=null,me=C,ye=C=0,At=null,De=O.next();me!==null&&!De.done;ye++,De=O.next()){me.index>ye?(At=me,me=null):At=me.sibling;var Ei=z(L,me,De.value,Q);if(Ei===null){me===null&&(me=At);break}e&&me&&Ei.alternate===null&&t(L,me),C=d(Ei,C,ye),we===null?ue=Ei:we.sibling=Ei,we=Ei,me=At}if(De.done)return i(L,me),Le&&ji(L,ye),ue;if(me===null){for(;!De.done;ye++,De=O.next())De=Z(L,De.value,Q),De!==null&&(C=d(De,C,ye),we===null?ue=De:we.sibling=De,we=De);return Le&&ji(L,ye),ue}for(me=o(me);!De.done;ye++,De=O.next())De=j(me,L,ye,De.value,Q),De!==null&&(e&&De.alternate!==null&&me.delete(De.key===null?ye:De.key),C=d(De,C,ye),we===null?ue=De:we.sibling=De,we=De);return e&&me.forEach(function($S){return t(L,$S)}),Le&&ji(L,ye),ue}function je(L,C,O,Q){if(typeof O=="object"&&O!==null&&O.type===M&&O.key===null&&(O=O.props.children),typeof O=="object"&&O!==null){switch(O.$$typeof){case S:e:{for(var ue=O.key;C!==null;){if(C.key===ue){if(ue=O.type,ue===M){if(C.tag===7){i(L,C.sibling),Q=c(C,O.props.children),Q.return=L,L=Q;break e}}else if(C.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===oe&&t0(ue)===C.type){i(L,C.sibling),Q=c(C,O.props),Ir(Q,O),Q.return=L,L=Q;break e}i(L,C);break}else t(L,C);C=C.sibling}O.type===M?(Q=Bi(O.props.children,L.mode,Q,O.key),Q.return=L,L=Q):(Q=cl(O.type,O.key,O.props,null,L.mode,Q),Ir(Q,O),Q.return=L,L=Q)}return y(L);case E:e:{for(ue=O.key;C!==null;){if(C.key===ue)if(C.tag===4&&C.stateNode.containerInfo===O.containerInfo&&C.stateNode.implementation===O.implementation){i(L,C.sibling),Q=c(C,O.children||[]),Q.return=L,L=Q;break e}else{i(L,C);break}else t(L,C);C=C.sibling}Q=ju(O,L.mode,Q),Q.return=L,L=Q}return y(L);case oe:return ue=O._init,O=ue(O._payload),je(L,C,O,Q)}if(B(O))return be(L,C,O,Q);if(k(O)){if(ue=k(O),typeof ue!="function")throw Error(r(150));return O=ue.call(O),ge(L,C,O,Q)}if(typeof O.then=="function")return je(L,C,Cl(O),Q);if(O.$$typeof===I)return je(L,C,hl(L,O),Q);Tl(L,O)}return typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint"?(O=""+O,C!==null&&C.tag===6?(i(L,C.sibling),Q=c(C,O),Q.return=L,L=Q):(i(L,C),Q=Hu(O,L.mode,Q),Q.return=L,L=Q),y(L)):i(L,C)}return function(L,C,O,Q){try{jr=0;var ue=je(L,C,O,Q);return Ds=null,ue}catch(me){if(me===kr||me===pl)throw me;var we=on(29,me,null,L.mode);return we.lanes=Q,we.return=L,we}finally{}}}var Ls=n0(!0),a0=n0(!1),vn=V(null),Xn=null;function ri(e){var t=e.alternate;W(yt,yt.current&1),W(vn,e),Xn===null&&(t===null||_s.current!==null||t.memoizedState!==null)&&(Xn=e)}function i0(e){if(e.tag===22){if(W(yt,yt.current),W(vn,e),Xn===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(Xn=e)}}else oi()}function oi(){W(yt,yt.current),W(vn,vn.current)}function Na(e){te(vn),Xn===e&&(Xn=null),te(yt)}var yt=V(0);function _l(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||cf(i)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function vd(e,t,i,o){t=e.memoizedState,i=i(o,t),i=i==null?t:g({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Sd={enqueueSetState:function(e,t,i){e=e._reactInternals;var o=dn(),c=ai(o);c.payload=t,i!=null&&(c.callback=i),t=ii(e,c,o),t!==null&&(fn(t,e,o),Lr(t,e,o))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var o=dn(),c=ai(o);c.tag=1,c.payload=t,i!=null&&(c.callback=i),t=ii(e,c,o),t!==null&&(fn(t,e,o),Lr(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=dn(),o=ai(i);o.tag=2,t!=null&&(o.callback=t),t=ii(e,o,i),t!==null&&(fn(t,e,i),Lr(t,e,i))}};function s0(e,t,i,o,c,d,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,d,y):t.prototype&&t.prototype.isPureReactComponent?!xr(i,o)||!xr(c,d):!0}function r0(e,t,i,o){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,o),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,o),t.state!==e&&Sd.enqueueReplaceState(t,t.state,null)}function Xi(e,t){var i=t;if("ref"in t){i={};for(var o in t)o!=="ref"&&(i[o]=t[o])}if(e=e.defaultProps){i===t&&(i=g({},i));for(var c in e)i[c]===void 0&&(i[c]=e[c])}return i}var Rl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function o0(e){Rl(e)}function l0(e){console.error(e)}function c0(e){Rl(e)}function Nl(e,t){try{var i=e.onUncaughtError;i(t.value,{componentStack:t.stack})}catch(o){setTimeout(function(){throw o})}}function u0(e,t,i){try{var o=e.onCaughtError;o(i.value,{componentStack:i.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Ed(e,t,i){return i=ai(i),i.tag=3,i.payload={element:null},i.callback=function(){Nl(e,t)},i}function d0(e){return e=ai(e),e.tag=3,e}function f0(e,t,i,o){var c=i.type.getDerivedStateFromError;if(typeof c=="function"){var d=o.value;e.payload=function(){return c(d)},e.callback=function(){u0(t,i,o)}}var y=i.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){u0(t,i,o),typeof c!="function"&&(hi===null?hi=new Set([this]):hi.add(this));var v=o.stack;this.componentDidCatch(o.value,{componentStack:v!==null?v:""})})}function $1(e,t,i,o,c){if(i.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(t=i.alternate,t!==null&&_r(t,i,c,!0),i=vn.current,i!==null){switch(i.tag){case 13:return Xn===null?$d():i.alternate===null&&at===0&&(at=3),i.flags&=-257,i.flags|=65536,i.lanes=c,o===Pu?i.flags|=16384:(t=i.updateQueue,t===null?i.updateQueue=new Set([o]):t.add(o),Xd(e,o,c)),!1;case 22:return i.flags|=65536,o===Pu?i.flags|=16384:(t=i.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([o])},i.updateQueue=t):(i=t.retryQueue,i===null?t.retryQueue=new Set([o]):i.add(o)),Xd(e,o,c)),!1}throw Error(r(435,i.tag))}return Xd(e,o,c),$d(),!1}if(Le)return t=vn.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=c,o!==Yu&&(e=Error(r(422),{cause:o}),Tr(pn(e,i)))):(o!==Yu&&(t=Error(r(423),{cause:o}),Tr(pn(t,i))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,o=pn(o,i),c=Ed(e.stateNode,o,c),Wu(e,c),at!==4&&(at=2)),!1;var d=Error(r(520),{cause:o});if(d=pn(d,i),Kr===null?Kr=[d]:Kr.push(d),at!==4&&(at=2),t===null)return!0;o=pn(o,i),i=t;do{switch(i.tag){case 3:return i.flags|=65536,e=c&-c,i.lanes|=e,e=Ed(i.stateNode,o,e),Wu(i,e),!1;case 1:if(t=i.type,d=i.stateNode,(i.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(hi===null||!hi.has(d))))return i.flags|=65536,c&=-c,i.lanes|=c,c=d0(c),f0(c,e,i,o),Wu(i,c),!1}i=i.return}while(i!==null);return!1}var h0=Error(r(461)),xt=!1;function _t(e,t,i,o){t.child=e===null?a0(t,null,i,o):Ls(t,e.child,i,o)}function m0(e,t,i,o,c){i=i.render;var d=t.ref;if("ref"in o){var y={};for(var v in o)v!=="ref"&&(y[v]=o[v])}else y=o;return Fi(t),o=id(e,t,i,y,d,c),v=sd(),e!==null&&!xt?(rd(e,t,c),ka(e,t,c)):(Le&&v&&Iu(t),t.flags|=1,_t(e,t,o,c),t.child)}function p0(e,t,i,o,c){if(e===null){var d=i.type;return typeof d=="function"&&!Bu(d)&&d.defaultProps===void 0&&i.compare===null?(t.tag=15,t.type=d,g0(e,t,d,o,c)):(e=cl(i.type,null,o,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(d=e.child,!Rd(e,c)){var y=d.memoizedProps;if(i=i.compare,i=i!==null?i:xr,i(y,o)&&e.ref===t.ref)return ka(e,t,c)}return t.flags|=1,e=wa(d,o),e.ref=t.ref,e.return=t,t.child=e}function g0(e,t,i,o,c){if(e!==null){var d=e.memoizedProps;if(xr(d,o)&&e.ref===t.ref)if(xt=!1,t.pendingProps=o=d,Rd(e,c))(e.flags&131072)!==0&&(xt=!0);else return t.lanes=e.lanes,ka(e,t,c)}return Md(e,t,i,o,c)}function y0(e,t,i){var o=t.pendingProps,c=o.children,d=e!==null?e.memoizedState:null;if(o.mode==="hidden"){if((t.flags&128)!==0){if(o=d!==null?d.baseLanes|i:i,e!==null){for(c=t.child=e.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;t.childLanes=d&~o}else t.childLanes=0,t.child=null;return b0(e,t,o,i)}if((i&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&ml(t,d!==null?d.cachePool:null),d!==null?gp(t,d):td(),i0(t);else return t.lanes=t.childLanes=536870912,b0(e,t,d!==null?d.baseLanes|i:i,i)}else d!==null?(ml(t,d.cachePool),gp(t,d),oi(),t.memoizedState=null):(e!==null&&ml(t,null),td(),oi());return _t(e,t,c,i),t.child}function b0(e,t,i,o){var c=Qu();return c=c===null?null:{parent:gt._currentValue,pool:c},t.memoizedState={baseLanes:i,cachePool:c},e!==null&&ml(t,null),td(),i0(t),e!==null&&_r(e,t,o,!0),null}function kl(e,t){var i=t.ref;if(i===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(r(284));(e===null||e.ref!==i)&&(t.flags|=4194816)}}function Md(e,t,i,o,c){return Fi(t),i=id(e,t,i,o,void 0,c),o=sd(),e!==null&&!xt?(rd(e,t,c),ka(e,t,c)):(Le&&o&&Iu(t),t.flags|=1,_t(e,t,i,c),t.child)}function v0(e,t,i,o,c,d){return Fi(t),t.updateQueue=null,i=bp(t,o,i,c),yp(e),o=sd(),e!==null&&!xt?(rd(e,t,d),ka(e,t,d)):(Le&&o&&Iu(t),t.flags|=1,_t(e,t,i,d),t.child)}function S0(e,t,i,o,c){if(Fi(t),t.stateNode===null){var d=xs,y=i.contextType;typeof y=="object"&&y!==null&&(d=Dt(y)),d=new i(o,d),t.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Sd,t.stateNode=d,d._reactInternals=t,d=t.stateNode,d.props=o,d.state=t.memoizedState,d.refs={},Zu(t),y=i.contextType,d.context=typeof y=="object"&&y!==null?Dt(y):xs,d.state=t.memoizedState,y=i.getDerivedStateFromProps,typeof y=="function"&&(vd(t,i,y,o),d.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(y=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),y!==d.state&&Sd.enqueueReplaceState(d,d.state,null),Or(t,o,d,c),Ur(),d.state=t.memoizedState),typeof d.componentDidMount=="function"&&(t.flags|=4194308),o=!0}else if(e===null){d=t.stateNode;var v=t.memoizedProps,w=Xi(i,v);d.props=w;var q=d.context,K=i.contextType;y=xs,typeof K=="object"&&K!==null&&(y=Dt(K));var Z=i.getDerivedStateFromProps;K=typeof Z=="function"||typeof d.getSnapshotBeforeUpdate=="function",v=t.pendingProps!==v,K||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(v||q!==y)&&r0(t,d,o,y),ni=!1;var z=t.memoizedState;d.state=z,Or(t,o,d,c),Ur(),q=t.memoizedState,v||z!==q||ni?(typeof Z=="function"&&(vd(t,i,Z,o),q=t.memoizedState),(w=ni||s0(t,i,w,o,z,q,y))?(K||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=o,t.memoizedState=q),d.props=o,d.state=q,d.context=y,o=w):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),o=!1)}else{d=t.stateNode,Ju(e,t),y=t.memoizedProps,K=Xi(i,y),d.props=K,Z=t.pendingProps,z=d.context,q=i.contextType,w=xs,typeof q=="object"&&q!==null&&(w=Dt(q)),v=i.getDerivedStateFromProps,(q=typeof v=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(y!==Z||z!==w)&&r0(t,d,o,w),ni=!1,z=t.memoizedState,d.state=z,Or(t,o,d,c),Ur();var j=t.memoizedState;y!==Z||z!==j||ni||e!==null&&e.dependencies!==null&&fl(e.dependencies)?(typeof v=="function"&&(vd(t,i,v,o),j=t.memoizedState),(K=ni||s0(t,i,K,o,z,j,w)||e!==null&&e.dependencies!==null&&fl(e.dependencies))?(q||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(o,j,w),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(o,j,w)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=1024),t.memoizedProps=o,t.memoizedState=j),d.props=o,d.state=j,d.context=w,o=K):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=1024),o=!1)}return d=o,kl(e,t),o=(t.flags&128)!==0,d||o?(d=t.stateNode,i=o&&typeof i.getDerivedStateFromError!="function"?null:d.render(),t.flags|=1,e!==null&&o?(t.child=Ls(t,e.child,null,c),t.child=Ls(t,null,i,c)):_t(e,t,i,c),t.memoizedState=d.state,e=t.child):e=ka(e,t,c),e}function E0(e,t,i,o){return Cr(),t.flags|=256,_t(e,t,i,o),t.child}var xd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function wd(e){return{baseLanes:e,cachePool:lp()}}function Ad(e,t,i){return e=e!==null?e.childLanes&~i:0,t&&(e|=Sn),e}function M0(e,t,i){var o=t.pendingProps,c=!1,d=(t.flags&128)!==0,y;if((y=d)||(y=e!==null&&e.memoizedState===null?!1:(yt.current&2)!==0),y&&(c=!0,t.flags&=-129),y=(t.flags&32)!==0,t.flags&=-33,e===null){if(Le){if(c?ri(t):oi(),Le){var v=nt,w;if(w=v){e:{for(w=v,v=Vn;w.nodeType!==8;){if(!v){v=null;break e}if(w=Ln(w.nextSibling),w===null){v=null;break e}}v=w}v!==null?(t.memoizedState={dehydrated:v,treeContext:Hi!==null?{id:Aa,overflow:Ca}:null,retryLane:536870912,hydrationErrors:null},w=on(18,null,null,0),w.stateNode=v,w.return=t,t.child=w,Bt=t,nt=null,w=!0):w=!1}w||Gi(t)}if(v=t.memoizedState,v!==null&&(v=v.dehydrated,v!==null))return cf(v)?t.lanes=32:t.lanes=536870912,null;Na(t)}return v=o.children,o=o.fallback,c?(oi(),c=t.mode,v=Dl({mode:"hidden",children:v},c),o=Bi(o,c,i,null),v.return=t,o.return=t,v.sibling=o,t.child=v,c=t.child,c.memoizedState=wd(i),c.childLanes=Ad(e,y,i),t.memoizedState=xd,o):(ri(t),Cd(t,v))}if(w=e.memoizedState,w!==null&&(v=w.dehydrated,v!==null)){if(d)t.flags&256?(ri(t),t.flags&=-257,t=Td(e,t,i)):t.memoizedState!==null?(oi(),t.child=e.child,t.flags|=128,t=null):(oi(),c=o.fallback,v=t.mode,o=Dl({mode:"visible",children:o.children},v),c=Bi(c,v,i,null),c.flags|=2,o.return=t,c.return=t,o.sibling=c,t.child=o,Ls(t,e.child,null,i),o=t.child,o.memoizedState=wd(i),o.childLanes=Ad(e,y,i),t.memoizedState=xd,t=c);else if(ri(t),cf(v)){if(y=v.nextSibling&&v.nextSibling.dataset,y)var q=y.dgst;y=q,o=Error(r(419)),o.stack="",o.digest=y,Tr({value:o,source:null,stack:null}),t=Td(e,t,i)}else if(xt||_r(e,t,i,!1),y=(i&e.childLanes)!==0,xt||y){if(y=Ve,y!==null&&(o=i&-i,o=(o&42)!==0?1:ga(o),o=(o&(y.suspendedLanes|i))!==0?0:o,o!==0&&o!==w.retryLane))throw w.retryLane=o,Ms(e,o),fn(y,e,o),h0;v.data==="$?"||$d(),t=Td(e,t,i)}else v.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=w.treeContext,nt=Ln(v.nextSibling),Bt=t,Le=!0,Ii=null,Vn=!1,e!==null&&(yn[bn++]=Aa,yn[bn++]=Ca,yn[bn++]=Hi,Aa=e.id,Ca=e.overflow,Hi=t),t=Cd(t,o.children),t.flags|=4096);return t}return c?(oi(),c=o.fallback,v=t.mode,w=e.child,q=w.sibling,o=wa(w,{mode:"hidden",children:o.children}),o.subtreeFlags=w.subtreeFlags&65011712,q!==null?c=wa(q,c):(c=Bi(c,v,i,null),c.flags|=2),c.return=t,o.return=t,o.sibling=c,t.child=o,o=c,c=t.child,v=e.child.memoizedState,v===null?v=wd(i):(w=v.cachePool,w!==null?(q=gt._currentValue,w=w.parent!==q?{parent:q,pool:q}:w):w=lp(),v={baseLanes:v.baseLanes|i,cachePool:w}),c.memoizedState=v,c.childLanes=Ad(e,y,i),t.memoizedState=xd,o):(ri(t),i=e.child,e=i.sibling,i=wa(i,{mode:"visible",children:o.children}),i.return=t,i.sibling=null,e!==null&&(y=t.deletions,y===null?(t.deletions=[e],t.flags|=16):y.push(e)),t.child=i,t.memoizedState=null,i)}function Cd(e,t){return t=Dl({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Dl(e,t){return e=on(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Td(e,t,i){return Ls(t,e.child,null,i),e=Cd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function x0(e,t,i){e.lanes|=t;var o=e.alternate;o!==null&&(o.lanes|=t),$u(e.return,t,i)}function _d(e,t,i,o,c){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:o,tail:i,tailMode:c}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=o,d.tail=i,d.tailMode=c)}function w0(e,t,i){var o=t.pendingProps,c=o.revealOrder,d=o.tail;if(_t(e,t,o.children,i),o=yt.current,(o&2)!==0)o=o&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&x0(e,i,t);else if(e.tag===19)x0(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}switch(W(yt,o),c){case"forwards":for(i=t.child,c=null;i!==null;)e=i.alternate,e!==null&&_l(e)===null&&(c=i),i=i.sibling;i=c,i===null?(c=t.child,t.child=null):(c=i.sibling,i.sibling=null),_d(t,!1,c,i,d);break;case"backwards":for(i=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&_l(e)===null){t.child=c;break}e=c.sibling,c.sibling=i,i=c,c=e}_d(t,!0,i,null,d);break;case"together":_d(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ka(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),fi|=t.lanes,(i&t.childLanes)===0)if(e!==null){if(_r(e,t,i,!1),(i&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(r(153));if(t.child!==null){for(e=t.child,i=wa(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=wa(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function Rd(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&fl(e)))}function V1(e,t,i){switch(t.tag){case 3:Ae(t,t.stateNode.containerInfo),ti(t,gt,e.memoizedState.cache),Cr();break;case 27:case 5:Wt(t);break;case 4:Ae(t,t.stateNode.containerInfo);break;case 10:ti(t,t.type,t.memoizedProps.value);break;case 13:var o=t.memoizedState;if(o!==null)return o.dehydrated!==null?(ri(t),t.flags|=128,null):(i&t.child.childLanes)!==0?M0(e,t,i):(ri(t),e=ka(e,t,i),e!==null?e.sibling:null);ri(t);break;case 19:var c=(e.flags&128)!==0;if(o=(i&t.childLanes)!==0,o||(_r(e,t,i,!1),o=(i&t.childLanes)!==0),c){if(o)return w0(e,t,i);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),W(yt,yt.current),o)break;return null;case 22:case 23:return t.lanes=0,y0(e,t,i);case 24:ti(t,gt,e.memoizedState.cache)}return ka(e,t,i)}function A0(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps)xt=!0;else{if(!Rd(e,i)&&(t.flags&128)===0)return xt=!1,V1(e,t,i);xt=(e.flags&131072)!==0}else xt=!1,Le&&(t.flags&1048576)!==0&&tp(t,dl,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var o=t.elementType,c=o._init;if(o=c(o._payload),t.type=o,typeof o=="function")Bu(o)?(e=Xi(o,e),t.tag=1,t=S0(null,t,o,e,i)):(t.tag=0,t=Md(null,t,o,e,i));else{if(o!=null){if(c=o.$$typeof,c===$){t.tag=11,t=m0(null,t,o,e,i);break e}else if(c===se){t.tag=14,t=p0(null,t,o,e,i);break e}}throw t=F(o)||o,Error(r(306,t,""))}}return t;case 0:return Md(e,t,t.type,t.pendingProps,i);case 1:return o=t.type,c=Xi(o,t.pendingProps),S0(e,t,o,c,i);case 3:e:{if(Ae(t,t.stateNode.containerInfo),e===null)throw Error(r(387));o=t.pendingProps;var d=t.memoizedState;c=d.element,Ju(e,t),Or(t,o,null,i);var y=t.memoizedState;if(o=y.cache,ti(t,gt,o),o!==d.cache&&Vu(t,[gt],i,!0),Ur(),o=y.element,d.isDehydrated)if(d={element:o,isDehydrated:!1,cache:y.cache},t.updateQueue.baseState=d,t.memoizedState=d,t.flags&256){t=E0(e,t,o,i);break e}else if(o!==c){c=pn(Error(r(424)),t),Tr(c),t=E0(e,t,o,i);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(nt=Ln(e.firstChild),Bt=t,Le=!0,Ii=null,Vn=!0,i=a0(t,null,o,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(Cr(),o===c){t=ka(e,t,i);break e}_t(e,t,o,i)}t=t.child}return t;case 26:return kl(e,t),e===null?(i=Rg(t.type,null,t.pendingProps,null))?t.memoizedState=i:Le||(i=t.type,e=t.pendingProps,o=Vl(he.current).createElement(i),o[Je]=t,o[mt]=e,Nt(o,i,e),We(o),t.stateNode=o):t.memoizedState=Rg(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Wt(t),e===null&&Le&&(o=t.stateNode=Cg(t.type,t.pendingProps,he.current),Bt=t,Vn=!0,c=nt,gi(t.type)?(uf=c,nt=Ln(o.firstChild)):nt=c),_t(e,t,t.pendingProps.children,i),kl(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&Le&&((c=o=nt)&&(o=SS(o,t.type,t.pendingProps,Vn),o!==null?(t.stateNode=o,Bt=t,nt=Ln(o.firstChild),Vn=!1,c=!0):c=!1),c||Gi(t)),Wt(t),c=t.type,d=t.pendingProps,y=e!==null?e.memoizedProps:null,o=d.children,rf(c,d)?o=null:y!==null&&rf(c,y)&&(t.flags|=32),t.memoizedState!==null&&(c=id(e,t,B1,null,null,i),ao._currentValue=c),kl(e,t),_t(e,t,o,i),t.child;case 6:return e===null&&Le&&((e=i=nt)&&(i=ES(i,t.pendingProps,Vn),i!==null?(t.stateNode=i,Bt=t,nt=null,e=!0):e=!1),e||Gi(t)),null;case 13:return M0(e,t,i);case 4:return Ae(t,t.stateNode.containerInfo),o=t.pendingProps,e===null?t.child=Ls(t,null,o,i):_t(e,t,o,i),t.child;case 11:return m0(e,t,t.type,t.pendingProps,i);case 7:return _t(e,t,t.pendingProps,i),t.child;case 8:return _t(e,t,t.pendingProps.children,i),t.child;case 12:return _t(e,t,t.pendingProps.children,i),t.child;case 10:return o=t.pendingProps,ti(t,t.type,o.value),_t(e,t,o.children,i),t.child;case 9:return c=t.type._context,o=t.pendingProps.children,Fi(t),c=Dt(c),o=o(c),t.flags|=1,_t(e,t,o,i),t.child;case 14:return p0(e,t,t.type,t.pendingProps,i);case 15:return g0(e,t,t.type,t.pendingProps,i);case 19:return w0(e,t,i);case 31:return o=t.pendingProps,i=t.mode,o={mode:o.mode,children:o.children},e===null?(i=Dl(o,i),i.ref=t.ref,t.child=i,i.return=t,t=i):(i=wa(e.child,o),i.ref=t.ref,t.child=i,i.return=t,t=i),t;case 22:return y0(e,t,i);case 24:return Fi(t),o=Dt(gt),e===null?(c=Qu(),c===null&&(c=Ve,d=Xu(),c.pooledCache=d,d.refCount++,d!==null&&(c.pooledCacheLanes|=i),c=d),t.memoizedState={parent:o,cache:c},Zu(t),ti(t,gt,c)):((e.lanes&i)!==0&&(Ju(e,t),Or(t,null,null,i),Ur()),c=e.memoizedState,d=t.memoizedState,c.parent!==o?(c={parent:o,cache:o},t.memoizedState=c,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=c),ti(t,gt,o)):(o=d.cache,ti(t,gt,o),o!==c.cache&&Vu(t,[gt],i,!0))),_t(e,t,t.pendingProps.children,i),t.child;case 29:throw t.pendingProps}throw Error(r(156,t.tag))}function Da(e){e.flags|=4}function C0(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Ug(t)){if(t=vn.current,t!==null&&((ke&4194048)===ke?Xn!==null:(ke&62914560)!==ke&&(ke&536870912)===0||t!==Xn))throw Dr=Pu,cp;e.flags|=8192}}function Ll(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?Et():536870912,e.lanes|=t,zs|=t)}function Gr(e,t){if(!Le)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function Qe(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,o=0;if(t)for(var c=e.child;c!==null;)i|=c.lanes|c.childLanes,o|=c.subtreeFlags&65011712,o|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)i|=c.lanes|c.childLanes,o|=c.subtreeFlags,o|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=o,e.childLanes=i,t}function X1(e,t,i){var o=t.pendingProps;switch(Gu(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qe(t),null;case 1:return Qe(t),null;case 3:return i=t.stateNode,o=null,e!==null&&(o=e.memoizedState.cache),t.memoizedState.cache!==o&&(t.flags|=2048),_a(gt),Ct(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(Ar(t)?Da(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,ip())),Qe(t),null;case 26:return i=t.memoizedState,e===null?(Da(t),i!==null?(Qe(t),C0(t,i)):(Qe(t),t.flags&=-16777217)):i?i!==e.memoizedState?(Da(t),Qe(t),C0(t,i)):(Qe(t),t.flags&=-16777217):(e.memoizedProps!==o&&Da(t),Qe(t),t.flags&=-16777217),null;case 27:wn(t),i=he.current;var c=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==o&&Da(t);else{if(!o){if(t.stateNode===null)throw Error(r(166));return Qe(t),null}e=le.current,Ar(t)?np(t):(e=Cg(c,o,i),t.stateNode=e,Da(t))}return Qe(t),null;case 5:if(wn(t),i=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==o&&Da(t);else{if(!o){if(t.stateNode===null)throw Error(r(166));return Qe(t),null}if(e=le.current,Ar(t))np(t);else{switch(c=Vl(he.current),e){case 1:e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof o.is=="string"?c.createElement("select",{is:o.is}):c.createElement("select"),o.multiple?e.multiple=!0:o.size&&(e.size=o.size);break;default:e=typeof o.is=="string"?c.createElement(i,{is:o.is}):c.createElement(i)}}e[Je]=t,e[mt]=o;e:for(c=t.child;c!==null;){if(c.tag===5||c.tag===6)e.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===t)break e;for(;c.sibling===null;){if(c.return===null||c.return===t)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}t.stateNode=e;e:switch(Nt(e,i,o),i){case"button":case"input":case"select":case"textarea":e=!!o.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Da(t)}}return Qe(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==o&&Da(t);else{if(typeof o!="string"&&t.stateNode===null)throw Error(r(166));if(e=he.current,Ar(t)){if(e=t.stateNode,i=t.memoizedProps,o=null,c=Bt,c!==null)switch(c.tag){case 27:case 5:o=c.memoizedProps}e[Je]=t,e=!!(e.nodeValue===i||o!==null&&o.suppressHydrationWarning===!0||vg(e.nodeValue,i)),e||Gi(t)}else e=Vl(e).createTextNode(o),e[Je]=t,t.stateNode=e}return Qe(t),null;case 13:if(o=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=Ar(t),o!==null&&o.dehydrated!==null){if(e===null){if(!c)throw Error(r(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));c[Je]=t}else Cr(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Qe(t),c=!1}else c=ip(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return t.flags&256?(Na(t),t):(Na(t),null)}if(Na(t),(t.flags&128)!==0)return t.lanes=i,t;if(i=o!==null,e=e!==null&&e.memoizedState!==null,i){o=t.child,c=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(c=o.alternate.memoizedState.cachePool.pool);var d=null;o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),d!==c&&(o.flags|=2048)}return i!==e&&i&&(t.child.flags|=8192),Ll(t,t.updateQueue),Qe(t),null;case 4:return Ct(),e===null&&ef(t.stateNode.containerInfo),Qe(t),null;case 10:return _a(t.type),Qe(t),null;case 19:if(te(yt),c=t.memoizedState,c===null)return Qe(t),null;if(o=(t.flags&128)!==0,d=c.rendering,d===null)if(o)Gr(c,!1);else{if(at!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(d=_l(e),d!==null){for(t.flags|=128,Gr(c,!1),e=d.updateQueue,t.updateQueue=e,Ll(t,e),t.subtreeFlags=0,e=i,i=t.child;i!==null;)ep(i,e),i=i.sibling;return W(yt,yt.current&1|2),t.child}e=e.sibling}c.tail!==null&&lt()>ql&&(t.flags|=128,o=!0,Gr(c,!1),t.lanes=4194304)}else{if(!o)if(e=_l(d),e!==null){if(t.flags|=128,o=!0,e=e.updateQueue,t.updateQueue=e,Ll(t,e),Gr(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!Le)return Qe(t),null}else 2*lt()-c.renderingStartTime>ql&&i!==536870912&&(t.flags|=128,o=!0,Gr(c,!1),t.lanes=4194304);c.isBackwards?(d.sibling=t.child,t.child=d):(e=c.last,e!==null?e.sibling=d:t.child=d,c.last=d)}return c.tail!==null?(t=c.tail,c.rendering=t,c.tail=t.sibling,c.renderingStartTime=lt(),t.sibling=null,e=yt.current,W(yt,o?e&1|2:e&1),t):(Qe(t),null);case 22:case 23:return Na(t),nd(),o=t.memoizedState!==null,e!==null?e.memoizedState!==null!==o&&(t.flags|=8192):o&&(t.flags|=8192),o?(i&536870912)!==0&&(t.flags&128)===0&&(Qe(t),t.subtreeFlags&6&&(t.flags|=8192)):Qe(t),i=t.updateQueue,i!==null&&Ll(t,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),o=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),o!==i&&(t.flags|=2048),e!==null&&te($i),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),_a(gt),Qe(t),null;case 25:return null;case 30:return null}throw Error(r(156,t.tag))}function K1(e,t){switch(Gu(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return _a(gt),Ct(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return wn(t),null;case 13:if(Na(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(r(340));Cr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return te(yt),null;case 4:return Ct(),null;case 10:return _a(t.type),null;case 22:case 23:return Na(t),nd(),e!==null&&te($i),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return _a(gt),null;case 25:return null;default:return null}}function T0(e,t){switch(Gu(t),t.tag){case 3:_a(gt),Ct();break;case 26:case 27:case 5:wn(t);break;case 4:Ct();break;case 13:Na(t);break;case 19:te(yt);break;case 10:_a(t.type);break;case 22:case 23:Na(t),nd(),e!==null&&te($i);break;case 24:_a(gt)}}function Yr(e,t){try{var i=t.updateQueue,o=i!==null?i.lastEffect:null;if(o!==null){var c=o.next;i=c;do{if((i.tag&e)===e){o=void 0;var d=i.create,y=i.inst;o=d(),y.destroy=o}i=i.next}while(i!==c)}}catch(v){Fe(t,t.return,v)}}function li(e,t,i){try{var o=t.updateQueue,c=o!==null?o.lastEffect:null;if(c!==null){var d=c.next;o=d;do{if((o.tag&e)===e){var y=o.inst,v=y.destroy;if(v!==void 0){y.destroy=void 0,c=t;var w=i,q=v;try{q()}catch(K){Fe(c,w,K)}}}o=o.next}while(o!==d)}}catch(K){Fe(t,t.return,K)}}function _0(e){var t=e.updateQueue;if(t!==null){var i=e.stateNode;try{pp(t,i)}catch(o){Fe(e,e.return,o)}}}function R0(e,t,i){i.props=Xi(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(o){Fe(e,t,o)}}function Fr(e,t){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var o=e.stateNode;break;case 30:o=e.stateNode;break;default:o=e.stateNode}typeof i=="function"?e.refCleanup=i(o):i.current=o}}catch(c){Fe(e,t,c)}}function Kn(e,t){var i=e.ref,o=e.refCleanup;if(i!==null)if(typeof o=="function")try{o()}catch(c){Fe(e,t,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(c){Fe(e,t,c)}else i.current=null}function N0(e){var t=e.type,i=e.memoizedProps,o=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":i.autoFocus&&o.focus();break e;case"img":i.src?o.src=i.src:i.srcSet&&(o.srcset=i.srcSet)}}catch(c){Fe(e,e.return,c)}}function Nd(e,t,i){try{var o=e.stateNode;pS(o,e.type,i,t),o[mt]=t}catch(c){Fe(e,e.return,c)}}function k0(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&gi(e.type)||e.tag===4}function kd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||k0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&gi(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Dd(e,t,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,t):(t=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,t.appendChild(e),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=$l));else if(o!==4&&(o===27&&gi(e.type)&&(i=e.stateNode,t=null),e=e.child,e!==null))for(Dd(e,t,i),e=e.sibling;e!==null;)Dd(e,t,i),e=e.sibling}function Ul(e,t,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(o!==4&&(o===27&&gi(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(Ul(e,t,i),e=e.sibling;e!==null;)Ul(e,t,i),e=e.sibling}function D0(e){var t=e.stateNode,i=e.memoizedProps;try{for(var o=e.type,c=t.attributes;c.length;)t.removeAttributeNode(c[0]);Nt(t,o,i),t[Je]=e,t[mt]=i}catch(d){Fe(e,e.return,d)}}var La=!1,rt=!1,Ld=!1,L0=typeof WeakSet=="function"?WeakSet:Set,wt=null;function Q1(e,t){if(e=e.containerInfo,af=Jl,e=Fm(e),ku(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var o=i.getSelection&&i.getSelection();if(o&&o.rangeCount!==0){i=o.anchorNode;var c=o.anchorOffset,d=o.focusNode;o=o.focusOffset;try{i.nodeType,d.nodeType}catch{i=null;break e}var y=0,v=-1,w=-1,q=0,K=0,Z=e,z=null;t:for(;;){for(var j;Z!==i||c!==0&&Z.nodeType!==3||(v=y+c),Z!==d||o!==0&&Z.nodeType!==3||(w=y+o),Z.nodeType===3&&(y+=Z.nodeValue.length),(j=Z.firstChild)!==null;)z=Z,Z=j;for(;;){if(Z===e)break t;if(z===i&&++q===c&&(v=y),z===d&&++K===o&&(w=y),(j=Z.nextSibling)!==null)break;Z=z,z=Z.parentNode}Z=j}i=v===-1||w===-1?null:{start:v,end:w}}else i=null}i=i||{start:0,end:0}}else i=null;for(sf={focusedElem:e,selectionRange:i},Jl=!1,wt=t;wt!==null;)if(t=wt,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,wt=e;else for(;wt!==null;){switch(t=wt,d=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,i=t,c=d.memoizedProps,d=d.memoizedState,o=i.stateNode;try{var be=Xi(i.type,c,i.elementType===i.type);e=o.getSnapshotBeforeUpdate(be,d),o.__reactInternalSnapshotBeforeUpdate=e}catch(ge){Fe(i,i.return,ge)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,i=e.nodeType,i===9)lf(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":lf(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(r(163))}if(e=t.sibling,e!==null){e.return=t.return,wt=e;break}wt=t.return}}function U0(e,t,i){var o=i.flags;switch(i.tag){case 0:case 11:case 15:ci(e,i),o&4&&Yr(5,i);break;case 1:if(ci(e,i),o&4)if(e=i.stateNode,t===null)try{e.componentDidMount()}catch(y){Fe(i,i.return,y)}else{var c=Xi(i.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(c,t,e.__reactInternalSnapshotBeforeUpdate)}catch(y){Fe(i,i.return,y)}}o&64&&_0(i),o&512&&Fr(i,i.return);break;case 3:if(ci(e,i),o&64&&(e=i.updateQueue,e!==null)){if(t=null,i.child!==null)switch(i.child.tag){case 27:case 5:t=i.child.stateNode;break;case 1:t=i.child.stateNode}try{pp(e,t)}catch(y){Fe(i,i.return,y)}}break;case 27:t===null&&o&4&&D0(i);case 26:case 5:ci(e,i),t===null&&o&4&&N0(i),o&512&&Fr(i,i.return);break;case 12:ci(e,i);break;case 13:ci(e,i),o&4&&z0(e,i),o&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=iS.bind(null,i),MS(e,i))));break;case 22:if(o=i.memoizedState!==null||La,!o){t=t!==null&&t.memoizedState!==null||rt,c=La;var d=rt;La=o,(rt=t)&&!d?ui(e,i,(i.subtreeFlags&8772)!==0):ci(e,i),La=c,rt=d}break;case 30:break;default:ci(e,i)}}function O0(e){var t=e.alternate;t!==null&&(e.alternate=null,O0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&hs(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ke=null,Kt=!1;function Ua(e,t,i){for(i=i.child;i!==null;)q0(e,t,i),i=i.sibling}function q0(e,t,i){if(Ze&&typeof Ze.onCommitFiberUnmount=="function")try{Ze.onCommitFiberUnmount(Ue,i)}catch{}switch(i.tag){case 26:rt||Kn(i,t),Ua(e,t,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:rt||Kn(i,t);var o=Ke,c=Kt;gi(i.type)&&(Ke=i.stateNode,Kt=!1),Ua(e,t,i),Wr(i.stateNode),Ke=o,Kt=c;break;case 5:rt||Kn(i,t);case 6:if(o=Ke,c=Kt,Ke=null,Ua(e,t,i),Ke=o,Kt=c,Ke!==null)if(Kt)try{(Ke.nodeType===9?Ke.body:Ke.nodeName==="HTML"?Ke.ownerDocument.body:Ke).removeChild(i.stateNode)}catch(d){Fe(i,t,d)}else try{Ke.removeChild(i.stateNode)}catch(d){Fe(i,t,d)}break;case 18:Ke!==null&&(Kt?(e=Ke,wg(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),oo(e)):wg(Ke,i.stateNode));break;case 4:o=Ke,c=Kt,Ke=i.stateNode.containerInfo,Kt=!0,Ua(e,t,i),Ke=o,Kt=c;break;case 0:case 11:case 14:case 15:rt||li(2,i,t),rt||li(4,i,t),Ua(e,t,i);break;case 1:rt||(Kn(i,t),o=i.stateNode,typeof o.componentWillUnmount=="function"&&R0(i,t,o)),Ua(e,t,i);break;case 21:Ua(e,t,i);break;case 22:rt=(o=rt)||i.memoizedState!==null,Ua(e,t,i),rt=o;break;default:Ua(e,t,i)}}function z0(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{oo(e)}catch(i){Fe(t,t.return,i)}}function P1(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new L0),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new L0),t;default:throw Error(r(435,e.tag))}}function Ud(e,t){var i=P1(e);t.forEach(function(o){var c=sS.bind(null,e,o);i.has(o)||(i.add(o),o.then(c,c))})}function ln(e,t){var i=t.deletions;if(i!==null)for(var o=0;o<i.length;o++){var c=i[o],d=e,y=t,v=y;e:for(;v!==null;){switch(v.tag){case 27:if(gi(v.type)){Ke=v.stateNode,Kt=!1;break e}break;case 5:Ke=v.stateNode,Kt=!1;break e;case 3:case 4:Ke=v.stateNode.containerInfo,Kt=!0;break e}v=v.return}if(Ke===null)throw Error(r(160));q0(d,y,c),Ke=null,Kt=!1,d=c.alternate,d!==null&&(d.return=null),c.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)B0(t,e),t=t.sibling}var Dn=null;function B0(e,t){var i=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:ln(t,e),cn(e),o&4&&(li(3,e,e.return),Yr(3,e),li(5,e,e.return));break;case 1:ln(t,e),cn(e),o&512&&(rt||i===null||Kn(i,i.return)),o&64&&La&&(e=e.updateQueue,e!==null&&(o=e.callbacks,o!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?o:i.concat(o))));break;case 26:var c=Dn;if(ln(t,e),cn(e),o&512&&(rt||i===null||Kn(i,i.return)),o&4){var d=i!==null?i.memoizedState:null;if(o=e.memoizedState,i===null)if(o===null)if(e.stateNode===null){e:{o=e.type,i=e.memoizedProps,c=c.ownerDocument||c;t:switch(o){case"title":d=c.getElementsByTagName("title")[0],(!d||d[ki]||d[Je]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=c.createElement(o),c.head.insertBefore(d,c.querySelector("head > title"))),Nt(d,o,i),d[Je]=e,We(d),o=d;break e;case"link":var y=Dg("link","href",c).get(o+(i.href||""));if(y){for(var v=0;v<y.length;v++)if(d=y[v],d.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&d.getAttribute("rel")===(i.rel==null?null:i.rel)&&d.getAttribute("title")===(i.title==null?null:i.title)&&d.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){y.splice(v,1);break t}}d=c.createElement(o),Nt(d,o,i),c.head.appendChild(d);break;case"meta":if(y=Dg("meta","content",c).get(o+(i.content||""))){for(v=0;v<y.length;v++)if(d=y[v],d.getAttribute("content")===(i.content==null?null:""+i.content)&&d.getAttribute("name")===(i.name==null?null:i.name)&&d.getAttribute("property")===(i.property==null?null:i.property)&&d.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&d.getAttribute("charset")===(i.charSet==null?null:i.charSet)){y.splice(v,1);break t}}d=c.createElement(o),Nt(d,o,i),c.head.appendChild(d);break;default:throw Error(r(468,o))}d[Je]=e,We(d),o=d}e.stateNode=o}else Lg(c,e.type,e.stateNode);else e.stateNode=kg(c,o,e.memoizedProps);else d!==o?(d===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):d.count--,o===null?Lg(c,e.type,e.stateNode):kg(c,o,e.memoizedProps)):o===null&&e.stateNode!==null&&Nd(e,e.memoizedProps,i.memoizedProps)}break;case 27:ln(t,e),cn(e),o&512&&(rt||i===null||Kn(i,i.return)),i!==null&&o&4&&Nd(e,e.memoizedProps,i.memoizedProps);break;case 5:if(ln(t,e),cn(e),o&512&&(rt||i===null||Kn(i,i.return)),e.flags&32){c=e.stateNode;try{ps(c,"")}catch(j){Fe(e,e.return,j)}}o&4&&e.stateNode!=null&&(c=e.memoizedProps,Nd(e,c,i!==null?i.memoizedProps:c)),o&1024&&(Ld=!0);break;case 6:if(ln(t,e),cn(e),o&4){if(e.stateNode===null)throw Error(r(162));o=e.memoizedProps,i=e.stateNode;try{i.nodeValue=o}catch(j){Fe(e,e.return,j)}}break;case 3:if(Ql=null,c=Dn,Dn=Xl(t.containerInfo),ln(t,e),Dn=c,cn(e),o&4&&i!==null&&i.memoizedState.isDehydrated)try{oo(t.containerInfo)}catch(j){Fe(e,e.return,j)}Ld&&(Ld=!1,H0(e));break;case 4:o=Dn,Dn=Xl(e.stateNode.containerInfo),ln(t,e),cn(e),Dn=o;break;case 12:ln(t,e),cn(e);break;case 13:ln(t,e),cn(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(jd=lt()),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Ud(e,o)));break;case 22:c=e.memoizedState!==null;var w=i!==null&&i.memoizedState!==null,q=La,K=rt;if(La=q||c,rt=K||w,ln(t,e),rt=K,La=q,cn(e),o&8192)e:for(t=e.stateNode,t._visibility=c?t._visibility&-2:t._visibility|1,c&&(i===null||w||La||rt||Ki(e)),i=null,t=e;;){if(t.tag===5||t.tag===26){if(i===null){w=i=t;try{if(d=w.stateNode,c)y=d.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{v=w.stateNode;var Z=w.memoizedProps.style,z=Z!=null&&Z.hasOwnProperty("display")?Z.display:null;v.style.display=z==null||typeof z=="boolean"?"":(""+z).trim()}}catch(j){Fe(w,w.return,j)}}}else if(t.tag===6){if(i===null){w=t;try{w.stateNode.nodeValue=c?"":w.memoizedProps}catch(j){Fe(w,w.return,j)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;i===t&&(i=null),t=t.return}i===t&&(i=null),t.sibling.return=t.return,t=t.sibling}o&4&&(o=e.updateQueue,o!==null&&(i=o.retryQueue,i!==null&&(o.retryQueue=null,Ud(e,i))));break;case 19:ln(t,e),cn(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Ud(e,o)));break;case 30:break;case 21:break;default:ln(t,e),cn(e)}}function cn(e){var t=e.flags;if(t&2){try{for(var i,o=e.return;o!==null;){if(k0(o)){i=o;break}o=o.return}if(i==null)throw Error(r(160));switch(i.tag){case 27:var c=i.stateNode,d=kd(e);Ul(e,d,c);break;case 5:var y=i.stateNode;i.flags&32&&(ps(y,""),i.flags&=-33);var v=kd(e);Ul(e,v,y);break;case 3:case 4:var w=i.stateNode.containerInfo,q=kd(e);Dd(e,q,w);break;default:throw Error(r(161))}}catch(K){Fe(e,e.return,K)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function H0(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;H0(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function ci(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)U0(e,t.alternate,t),t=t.sibling}function Ki(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:li(4,t,t.return),Ki(t);break;case 1:Kn(t,t.return);var i=t.stateNode;typeof i.componentWillUnmount=="function"&&R0(t,t.return,i),Ki(t);break;case 27:Wr(t.stateNode);case 26:case 5:Kn(t,t.return),Ki(t);break;case 22:t.memoizedState===null&&Ki(t);break;case 30:Ki(t);break;default:Ki(t)}e=e.sibling}}function ui(e,t,i){for(i=i&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var o=t.alternate,c=e,d=t,y=d.flags;switch(d.tag){case 0:case 11:case 15:ui(c,d,i),Yr(4,d);break;case 1:if(ui(c,d,i),o=d,c=o.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(q){Fe(o,o.return,q)}if(o=d,c=o.updateQueue,c!==null){var v=o.stateNode;try{var w=c.shared.hiddenCallbacks;if(w!==null)for(c.shared.hiddenCallbacks=null,c=0;c<w.length;c++)mp(w[c],v)}catch(q){Fe(o,o.return,q)}}i&&y&64&&_0(d),Fr(d,d.return);break;case 27:D0(d);case 26:case 5:ui(c,d,i),i&&o===null&&y&4&&N0(d),Fr(d,d.return);break;case 12:ui(c,d,i);break;case 13:ui(c,d,i),i&&y&4&&z0(c,d);break;case 22:d.memoizedState===null&&ui(c,d,i),Fr(d,d.return);break;case 30:break;default:ui(c,d,i)}t=t.sibling}}function Od(e,t){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Rr(i))}function qd(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Rr(e))}function Qn(e,t,i,o){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)j0(e,t,i,o),t=t.sibling}function j0(e,t,i,o){var c=t.flags;switch(t.tag){case 0:case 11:case 15:Qn(e,t,i,o),c&2048&&Yr(9,t);break;case 1:Qn(e,t,i,o);break;case 3:Qn(e,t,i,o),c&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Rr(e)));break;case 12:if(c&2048){Qn(e,t,i,o),e=t.stateNode;try{var d=t.memoizedProps,y=d.id,v=d.onPostCommit;typeof v=="function"&&v(y,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(w){Fe(t,t.return,w)}}else Qn(e,t,i,o);break;case 13:Qn(e,t,i,o);break;case 23:break;case 22:d=t.stateNode,y=t.alternate,t.memoizedState!==null?d._visibility&2?Qn(e,t,i,o):$r(e,t):d._visibility&2?Qn(e,t,i,o):(d._visibility|=2,Us(e,t,i,o,(t.subtreeFlags&10256)!==0)),c&2048&&Od(y,t);break;case 24:Qn(e,t,i,o),c&2048&&qd(t.alternate,t);break;default:Qn(e,t,i,o)}}function Us(e,t,i,o,c){for(c=c&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var d=e,y=t,v=i,w=o,q=y.flags;switch(y.tag){case 0:case 11:case 15:Us(d,y,v,w,c),Yr(8,y);break;case 23:break;case 22:var K=y.stateNode;y.memoizedState!==null?K._visibility&2?Us(d,y,v,w,c):$r(d,y):(K._visibility|=2,Us(d,y,v,w,c)),c&&q&2048&&Od(y.alternate,y);break;case 24:Us(d,y,v,w,c),c&&q&2048&&qd(y.alternate,y);break;default:Us(d,y,v,w,c)}t=t.sibling}}function $r(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var i=e,o=t,c=o.flags;switch(o.tag){case 22:$r(i,o),c&2048&&Od(o.alternate,o);break;case 24:$r(i,o),c&2048&&qd(o.alternate,o);break;default:$r(i,o)}t=t.sibling}}var Vr=8192;function Os(e){if(e.subtreeFlags&Vr)for(e=e.child;e!==null;)I0(e),e=e.sibling}function I0(e){switch(e.tag){case 26:Os(e),e.flags&Vr&&e.memoizedState!==null&&OS(Dn,e.memoizedState,e.memoizedProps);break;case 5:Os(e);break;case 3:case 4:var t=Dn;Dn=Xl(e.stateNode.containerInfo),Os(e),Dn=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=Vr,Vr=16777216,Os(e),Vr=t):Os(e));break;default:Os(e)}}function G0(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Xr(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var o=t[i];wt=o,F0(o,e)}G0(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Y0(e),e=e.sibling}function Y0(e){switch(e.tag){case 0:case 11:case 15:Xr(e),e.flags&2048&&li(9,e,e.return);break;case 3:Xr(e);break;case 12:Xr(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Ol(e)):Xr(e);break;default:Xr(e)}}function Ol(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var o=t[i];wt=o,F0(o,e)}G0(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:li(8,t,t.return),Ol(t);break;case 22:i=t.stateNode,i._visibility&2&&(i._visibility&=-3,Ol(t));break;default:Ol(t)}e=e.sibling}}function F0(e,t){for(;wt!==null;){var i=wt;switch(i.tag){case 0:case 11:case 15:li(8,i,t);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var o=i.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:Rr(i.memoizedState.cache)}if(o=i.child,o!==null)o.return=i,wt=o;else e:for(i=e;wt!==null;){o=wt;var c=o.sibling,d=o.return;if(O0(o),o===i){wt=null;break e}if(c!==null){c.return=d,wt=c;break e}wt=d}}}var Z1={getCacheForType:function(e){var t=Dt(gt),i=t.data.get(e);return i===void 0&&(i=e(),t.data.set(e,i)),i}},J1=typeof WeakMap=="function"?WeakMap:Map,Oe=0,Ve=null,Ce=null,ke=0,qe=0,un=null,di=!1,qs=!1,zd=!1,Oa=0,at=0,fi=0,Qi=0,Bd=0,Sn=0,zs=0,Kr=null,Qt=null,Hd=!1,jd=0,ql=1/0,zl=null,hi=null,Rt=0,mi=null,Bs=null,Hs=0,Id=0,Gd=null,$0=null,Qr=0,Yd=null;function dn(){if((Oe&2)!==0&&ke!==0)return ke&-ke;if(T.T!==null){var e=Cs;return e!==0?e:Pd()}return Fo()}function V0(){Sn===0&&(Sn=(ke&536870912)===0||Le?Re():536870912);var e=vn.current;return e!==null&&(e.flags|=32),Sn}function fn(e,t,i){(e===Ve&&(qe===2||qe===9)||e.cancelPendingCommit!==null)&&(js(e,0),pi(e,ke,Sn,!1)),Tt(e,i),((Oe&2)===0||e!==Ve)&&(e===Ve&&((Oe&2)===0&&(Qi|=i),at===4&&pi(e,ke,Sn,!1)),Pn(e))}function X0(e,t,i){if((Oe&6)!==0)throw Error(r(327));var o=!i&&(t&124)===0&&(t&e.expiredLanes)===0||ve(e,t),c=o?tS(e,t):Vd(e,t,!0),d=o;do{if(c===0){qs&&!o&&pi(e,t,0,!1);break}else{if(i=e.current.alternate,d&&!W1(i)){c=Vd(e,t,!1),d=!1;continue}if(c===2){if(d=t,e.errorRecoveryDisabledLanes&d)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){t=y;e:{var v=e;c=Kr;var w=v.current.memoizedState.isDehydrated;if(w&&(js(v,y).flags|=256),y=Vd(v,y,!1),y!==2){if(zd&&!w){v.errorRecoveryDisabledLanes|=d,Qi|=d,c=4;break e}d=Qt,Qt=c,d!==null&&(Qt===null?Qt=d:Qt.push.apply(Qt,d))}c=y}if(d=!1,c!==2)continue}}if(c===1){js(e,0),pi(e,t,0,!0);break}e:{switch(o=e,d=c,d){case 0:case 1:throw Error(r(345));case 4:if((t&4194048)!==t)break;case 6:pi(o,t,Sn,!di);break e;case 2:Qt=null;break;case 3:case 5:break;default:throw Error(r(329))}if((t&62914560)===t&&(c=jd+300-lt(),10<c)){if(pi(o,t,Sn,!di),ce(o,0,!0)!==0)break e;o.timeoutHandle=Mg(K0.bind(null,o,i,Qt,zl,Hd,t,Sn,Qi,zs,di,d,2,-0,0),c);break e}K0(o,i,Qt,zl,Hd,t,Sn,Qi,zs,di,d,0,-0,0)}}break}while(!0);Pn(e)}function K0(e,t,i,o,c,d,y,v,w,q,K,Z,z,j){if(e.timeoutHandle=-1,Z=t.subtreeFlags,(Z&8192||(Z&16785408)===16785408)&&(no={stylesheets:null,count:0,unsuspend:US},I0(t),Z=qS(),Z!==null)){e.cancelPendingCommit=Z(tg.bind(null,e,t,d,i,o,c,y,v,w,K,1,z,j)),pi(e,d,y,!q);return}tg(e,t,d,i,o,c,y,v,w)}function W1(e){for(var t=e;;){var i=t.tag;if((i===0||i===11||i===15)&&t.flags&16384&&(i=t.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var o=0;o<i.length;o++){var c=i[o],d=c.getSnapshot;c=c.value;try{if(!rn(d(),c))return!1}catch{return!1}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function pi(e,t,i,o){t&=~Bd,t&=~Qi,e.suspendedLanes|=t,e.pingedLanes&=~t,o&&(e.warmLanes|=t),o=e.expirationTimes;for(var c=t;0<c;){var d=31-ft(c),y=1<<d;o[d]=-1,c&=~y}i!==0&&ma(e,i,t)}function Bl(){return(Oe&6)===0?(Pr(0),!1):!0}function Fd(){if(Ce!==null){if(qe===0)var e=Ce.return;else e=Ce,Ta=Yi=null,od(e),Ds=null,jr=0,e=Ce;for(;e!==null;)T0(e.alternate,e),e=e.return;Ce=null}}function js(e,t){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,yS(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),Fd(),Ve=e,Ce=i=wa(e.current,null),ke=t,qe=0,un=null,di=!1,qs=ve(e,t),zd=!1,zs=Sn=Bd=Qi=fi=at=0,Qt=Kr=null,Hd=!1,(t&8)!==0&&(t|=t&32);var o=e.entangledLanes;if(o!==0)for(e=e.entanglements,o&=t;0<o;){var c=31-ft(o),d=1<<c;t|=e[c],o&=~d}return Oa=t,rl(),i}function Q0(e,t){Me=null,T.H=Al,t===kr||t===pl?(t=fp(),qe=3):t===cp?(t=fp(),qe=4):qe=t===h0?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,un=t,Ce===null&&(at=1,Nl(e,pn(t,e.current)))}function P0(){var e=T.H;return T.H=Al,e===null?Al:e}function Z0(){var e=T.A;return T.A=Z1,e}function $d(){at=4,di||(ke&4194048)!==ke&&vn.current!==null||(qs=!0),(fi&134217727)===0&&(Qi&134217727)===0||Ve===null||pi(Ve,ke,Sn,!1)}function Vd(e,t,i){var o=Oe;Oe|=2;var c=P0(),d=Z0();(Ve!==e||ke!==t)&&(zl=null,js(e,t)),t=!1;var y=at;e:do try{if(qe!==0&&Ce!==null){var v=Ce,w=un;switch(qe){case 8:Fd(),y=6;break e;case 3:case 2:case 9:case 6:vn.current===null&&(t=!0);var q=qe;if(qe=0,un=null,Is(e,v,w,q),i&&qs){y=0;break e}break;default:q=qe,qe=0,un=null,Is(e,v,w,q)}}eS(),y=at;break}catch(K){Q0(e,K)}while(!0);return t&&e.shellSuspendCounter++,Ta=Yi=null,Oe=o,T.H=c,T.A=d,Ce===null&&(Ve=null,ke=0,rl()),y}function eS(){for(;Ce!==null;)J0(Ce)}function tS(e,t){var i=Oe;Oe|=2;var o=P0(),c=Z0();Ve!==e||ke!==t?(zl=null,ql=lt()+500,js(e,t)):qs=ve(e,t);e:do try{if(qe!==0&&Ce!==null){t=Ce;var d=un;t:switch(qe){case 1:qe=0,un=null,Is(e,t,d,1);break;case 2:case 9:if(up(d)){qe=0,un=null,W0(t);break}t=function(){qe!==2&&qe!==9||Ve!==e||(qe=7),Pn(e)},d.then(t,t);break e;case 3:qe=7;break e;case 4:qe=5;break e;case 7:up(d)?(qe=0,un=null,W0(t)):(qe=0,un=null,Is(e,t,d,7));break;case 5:var y=null;switch(Ce.tag){case 26:y=Ce.memoizedState;case 5:case 27:var v=Ce;if(!y||Ug(y)){qe=0,un=null;var w=v.sibling;if(w!==null)Ce=w;else{var q=v.return;q!==null?(Ce=q,Hl(q)):Ce=null}break t}}qe=0,un=null,Is(e,t,d,5);break;case 6:qe=0,un=null,Is(e,t,d,6);break;case 8:Fd(),at=6;break e;default:throw Error(r(462))}}nS();break}catch(K){Q0(e,K)}while(!0);return Ta=Yi=null,T.H=o,T.A=c,Oe=i,Ce!==null?0:(Ve=null,ke=0,rl(),at)}function nS(){for(;Ce!==null&&!ca();)J0(Ce)}function J0(e){var t=A0(e.alternate,e,Oa);e.memoizedProps=e.pendingProps,t===null?Hl(e):Ce=t}function W0(e){var t=e,i=t.alternate;switch(t.tag){case 15:case 0:t=v0(i,t,t.pendingProps,t.type,void 0,ke);break;case 11:t=v0(i,t,t.pendingProps,t.type.render,t.ref,ke);break;case 5:od(t);default:T0(i,t),t=Ce=ep(t,Oa),t=A0(i,t,Oa)}e.memoizedProps=e.pendingProps,t===null?Hl(e):Ce=t}function Is(e,t,i,o){Ta=Yi=null,od(t),Ds=null,jr=0;var c=t.return;try{if($1(e,c,t,i,ke)){at=1,Nl(e,pn(i,e.current)),Ce=null;return}}catch(d){if(c!==null)throw Ce=c,d;at=1,Nl(e,pn(i,e.current)),Ce=null;return}t.flags&32768?(Le||o===1?e=!0:qs||(ke&536870912)!==0?e=!1:(di=e=!0,(o===2||o===9||o===3||o===6)&&(o=vn.current,o!==null&&o.tag===13&&(o.flags|=16384))),eg(t,e)):Hl(t)}function Hl(e){var t=e;do{if((t.flags&32768)!==0){eg(t,di);return}e=t.return;var i=X1(t.alternate,t,Oa);if(i!==null){Ce=i;return}if(t=t.sibling,t!==null){Ce=t;return}Ce=t=e}while(t!==null);at===0&&(at=5)}function eg(e,t){do{var i=K1(e.alternate,e);if(i!==null){i.flags&=32767,Ce=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!t&&(e=e.sibling,e!==null)){Ce=e;return}Ce=e=i}while(e!==null);at=6,Ce=null}function tg(e,t,i,o,c,d,y,v,w){e.cancelPendingCommit=null;do jl();while(Rt!==0);if((Oe&6)!==0)throw Error(r(327));if(t!==null){if(t===e.current)throw Error(r(177));if(d=t.lanes|t.childLanes,d|=qu,ha(e,i,d,y,v,w),e===Ve&&(Ce=Ve=null,ke=0),Bs=t,mi=e,Hs=i,Id=d,Gd=c,$0=o,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,rS($t,function(){return rg(),null})):(e.callbackNode=null,e.callbackPriority=0),o=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||o){o=T.T,T.T=null,c=G.p,G.p=2,y=Oe,Oe|=4;try{Q1(e,t,i)}finally{Oe=y,G.p=c,T.T=o}}Rt=1,ng(),ag(),ig()}}function ng(){if(Rt===1){Rt=0;var e=mi,t=Bs,i=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||i){i=T.T,T.T=null;var o=G.p;G.p=2;var c=Oe;Oe|=4;try{B0(t,e);var d=sf,y=Fm(e.containerInfo),v=d.focusedElem,w=d.selectionRange;if(y!==v&&v&&v.ownerDocument&&Ym(v.ownerDocument.documentElement,v)){if(w!==null&&ku(v)){var q=w.start,K=w.end;if(K===void 0&&(K=q),"selectionStart"in v)v.selectionStart=q,v.selectionEnd=Math.min(K,v.value.length);else{var Z=v.ownerDocument||document,z=Z&&Z.defaultView||window;if(z.getSelection){var j=z.getSelection(),be=v.textContent.length,ge=Math.min(w.start,be),je=w.end===void 0?ge:Math.min(w.end,be);!j.extend&&ge>je&&(y=je,je=ge,ge=y);var L=Gm(v,ge),C=Gm(v,je);if(L&&C&&(j.rangeCount!==1||j.anchorNode!==L.node||j.anchorOffset!==L.offset||j.focusNode!==C.node||j.focusOffset!==C.offset)){var O=Z.createRange();O.setStart(L.node,L.offset),j.removeAllRanges(),ge>je?(j.addRange(O),j.extend(C.node,C.offset)):(O.setEnd(C.node,C.offset),j.addRange(O))}}}}for(Z=[],j=v;j=j.parentNode;)j.nodeType===1&&Z.push({element:j,left:j.scrollLeft,top:j.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<Z.length;v++){var Q=Z[v];Q.element.scrollLeft=Q.left,Q.element.scrollTop=Q.top}}Jl=!!af,sf=af=null}finally{Oe=c,G.p=o,T.T=i}}e.current=t,Rt=2}}function ag(){if(Rt===2){Rt=0;var e=mi,t=Bs,i=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||i){i=T.T,T.T=null;var o=G.p;G.p=2;var c=Oe;Oe|=4;try{U0(e,t.alternate,t)}finally{Oe=c,G.p=o,T.T=i}}Rt=3}}function ig(){if(Rt===4||Rt===3){Rt=0,ua();var e=mi,t=Bs,i=Hs,o=$0;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?Rt=5:(Rt=0,Bs=mi=null,sg(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(hi=null),ya(i),t=t.stateNode,Ze&&typeof Ze.onCommitFiberRoot=="function")try{Ze.onCommitFiberRoot(Ue,t,void 0,(t.current.flags&128)===128)}catch{}if(o!==null){t=T.T,c=G.p,G.p=2,T.T=null;try{for(var d=e.onRecoverableError,y=0;y<o.length;y++){var v=o[y];d(v.value,{componentStack:v.stack})}}finally{T.T=t,G.p=c}}(Hs&3)!==0&&jl(),Pn(e),c=e.pendingLanes,(i&4194090)!==0&&(c&42)!==0?e===Yd?Qr++:(Qr=0,Yd=e):Qr=0,Pr(0)}}function sg(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Rr(t)))}function jl(e){return ng(),ag(),ig(),rg()}function rg(){if(Rt!==5)return!1;var e=mi,t=Id;Id=0;var i=ya(Hs),o=T.T,c=G.p;try{G.p=32>i?32:i,T.T=null,i=Gd,Gd=null;var d=mi,y=Hs;if(Rt=0,Bs=mi=null,Hs=0,(Oe&6)!==0)throw Error(r(331));var v=Oe;if(Oe|=4,Y0(d.current),j0(d,d.current,y,i),Oe=v,Pr(0,!1),Ze&&typeof Ze.onPostCommitFiberRoot=="function")try{Ze.onPostCommitFiberRoot(Ue,d)}catch{}return!0}finally{G.p=c,T.T=o,sg(e,t)}}function og(e,t,i){t=pn(i,t),t=Ed(e.stateNode,t,2),e=ii(e,t,2),e!==null&&(Tt(e,2),Pn(e))}function Fe(e,t,i){if(e.tag===3)og(e,e,i);else for(;t!==null;){if(t.tag===3){og(t,e,i);break}else if(t.tag===1){var o=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(hi===null||!hi.has(o))){e=pn(i,e),i=d0(2),o=ii(t,i,2),o!==null&&(f0(i,o,t,e),Tt(o,2),Pn(o));break}}t=t.return}}function Xd(e,t,i){var o=e.pingCache;if(o===null){o=e.pingCache=new J1;var c=new Set;o.set(t,c)}else c=o.get(t),c===void 0&&(c=new Set,o.set(t,c));c.has(i)||(zd=!0,c.add(i),e=aS.bind(null,e,t,i),t.then(e,e))}function aS(e,t,i){var o=e.pingCache;o!==null&&o.delete(t),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Ve===e&&(ke&i)===i&&(at===4||at===3&&(ke&62914560)===ke&&300>lt()-jd?(Oe&2)===0&&js(e,0):Bd|=i,zs===ke&&(zs=0)),Pn(e)}function lg(e,t){t===0&&(t=Et()),e=Ms(e,t),e!==null&&(Tt(e,t),Pn(e))}function iS(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),lg(e,i)}function sS(e,t){var i=0;switch(e.tag){case 13:var o=e.stateNode,c=e.memoizedState;c!==null&&(i=c.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(r(314))}o!==null&&o.delete(t),lg(e,i)}function rS(e,t){return Yt(e,t)}var Il=null,Gs=null,Kd=!1,Gl=!1,Qd=!1,Pi=0;function Pn(e){e!==Gs&&e.next===null&&(Gs===null?Il=Gs=e:Gs=Gs.next=e),Gl=!0,Kd||(Kd=!0,lS())}function Pr(e,t){if(!Qd&&Gl){Qd=!0;do for(var i=!1,o=Il;o!==null;){if(e!==0){var c=o.pendingLanes;if(c===0)var d=0;else{var y=o.suspendedLanes,v=o.pingedLanes;d=(1<<31-ft(42|e)+1)-1,d&=c&~(y&~v),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(i=!0,fg(o,d))}else d=ke,d=ce(o,o===Ve?d:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),(d&3)===0||ve(o,d)||(i=!0,fg(o,d));o=o.next}while(i);Qd=!1}}function oS(){cg()}function cg(){Gl=Kd=!1;var e=0;Pi!==0&&(gS()&&(e=Pi),Pi=0);for(var t=lt(),i=null,o=Il;o!==null;){var c=o.next,d=ug(o,t);d===0?(o.next=null,i===null?Il=c:i.next=c,c===null&&(Gs=i)):(i=o,(e!==0||(d&3)!==0)&&(Gl=!0)),o=c}Pr(e)}function ug(e,t){for(var i=e.suspendedLanes,o=e.pingedLanes,c=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var y=31-ft(d),v=1<<y,w=c[y];w===-1?((v&i)===0||(v&o)!==0)&&(c[y]=Se(v,t)):w<=t&&(e.expiredLanes|=v),d&=~v}if(t=Ve,i=ke,i=ce(e,e===t?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o=e.callbackNode,i===0||e===t&&(qe===2||qe===9)||e.cancelPendingCommit!==null)return o!==null&&o!==null&&Ft(o),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||ve(e,i)){if(t=i&-i,t===e.callbackPriority)return t;switch(o!==null&&Ft(o),ya(i)){case 2:case 8:i=mn;break;case 32:i=$t;break;case 268435456:i=Cn;break;default:i=$t}return o=dg.bind(null,e),i=Yt(i,o),e.callbackPriority=t,e.callbackNode=i,t}return o!==null&&o!==null&&Ft(o),e.callbackPriority=2,e.callbackNode=null,2}function dg(e,t){if(Rt!==0&&Rt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(jl()&&e.callbackNode!==i)return null;var o=ke;return o=ce(e,e===Ve?o:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o===0?null:(X0(e,o,t),ug(e,lt()),e.callbackNode!=null&&e.callbackNode===i?dg.bind(null,e):null)}function fg(e,t){if(jl())return null;X0(e,t,!0)}function lS(){bS(function(){(Oe&6)!==0?Yt(An,oS):cg()})}function Pd(){return Pi===0&&(Pi=Re()),Pi}function hg(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Wo(""+e)}function mg(e,t){var i=t.ownerDocument.createElement("input");return i.name=t.name,i.value=t.value,e.id&&i.setAttribute("form",e.id),t.parentNode.insertBefore(i,t),e=new FormData(e),i.parentNode.removeChild(i),e}function cS(e,t,i,o,c){if(t==="submit"&&i&&i.stateNode===c){var d=hg((c[mt]||null).action),y=o.submitter;y&&(t=(t=y[mt]||null)?hg(t.formAction):y.getAttribute("formAction"),t!==null&&(d=t,y=null));var v=new al("action","action",null,o,c);e.push({event:v,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(Pi!==0){var w=y?mg(c,y):new FormData(c);gd(i,{pending:!0,data:w,method:c.method,action:d},null,w)}}else typeof d=="function"&&(v.preventDefault(),w=y?mg(c,y):new FormData(c),gd(i,{pending:!0,data:w,method:c.method,action:d},d,w))},currentTarget:c}]})}}for(var Zd=0;Zd<Ou.length;Zd++){var Jd=Ou[Zd],uS=Jd.toLowerCase(),dS=Jd[0].toUpperCase()+Jd.slice(1);kn(uS,"on"+dS)}kn(Xm,"onAnimationEnd"),kn(Km,"onAnimationIteration"),kn(Qm,"onAnimationStart"),kn("dblclick","onDoubleClick"),kn("focusin","onFocus"),kn("focusout","onBlur"),kn(_1,"onTransitionRun"),kn(R1,"onTransitionStart"),kn(N1,"onTransitionCancel"),kn(Pm,"onTransitionEnd"),Za("onMouseEnter",["mouseout","mouseover"]),Za("onMouseLeave",["mouseout","mouseover"]),Za("onPointerEnter",["pointerout","pointerover"]),Za("onPointerLeave",["pointerout","pointerover"]),Fn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Fn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Fn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Fn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Fn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Fn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zr));function pg(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var o=e[i],c=o.event;o=o.listeners;e:{var d=void 0;if(t)for(var y=o.length-1;0<=y;y--){var v=o[y],w=v.instance,q=v.currentTarget;if(v=v.listener,w!==d&&c.isPropagationStopped())break e;d=v,c.currentTarget=q;try{d(c)}catch(K){Rl(K)}c.currentTarget=null,d=w}else for(y=0;y<o.length;y++){if(v=o[y],w=v.instance,q=v.currentTarget,v=v.listener,w!==d&&c.isPropagationStopped())break e;d=v,c.currentTarget=q;try{d(c)}catch(K){Rl(K)}c.currentTarget=null,d=w}}}}function Te(e,t){var i=t[Qa];i===void 0&&(i=t[Qa]=new Set);var o=e+"__bubble";i.has(o)||(gg(t,e,2,!1),i.add(o))}function Wd(e,t,i){var o=0;t&&(o|=4),gg(i,e,o,t)}var Yl="_reactListening"+Math.random().toString(36).slice(2);function ef(e){if(!e[Yl]){e[Yl]=!0,ms.forEach(function(i){i!=="selectionchange"&&(fS.has(i)||Wd(i,!1,e),Wd(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Yl]||(t[Yl]=!0,Wd("selectionchange",!1,t))}}function gg(e,t,i,o){switch(jg(t)){case 2:var c=HS;break;case 8:c=jS;break;default:c=pf}i=c.bind(null,t,i,e),c=void 0,!Mu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),o?c!==void 0?e.addEventListener(t,i,{capture:!0,passive:c}):e.addEventListener(t,i,!0):c!==void 0?e.addEventListener(t,i,{passive:c}):e.addEventListener(t,i,!1)}function tf(e,t,i,o,c){var d=o;if((t&1)===0&&(t&2)===0&&o!==null)e:for(;;){if(o===null)return;var y=o.tag;if(y===3||y===4){var v=o.stateNode.containerInfo;if(v===c)break;if(y===4)for(y=o.return;y!==null;){var w=y.tag;if((w===3||w===4)&&y.stateNode.containerInfo===c)return;y=y.return}for(;v!==null;){if(y=va(v),y===null)return;if(w=y.tag,w===5||w===6||w===26||w===27){o=d=y;continue e}v=v.parentNode}}o=o.return}xm(function(){var q=d,K=Su(i),Z=[];e:{var z=Zm.get(e);if(z!==void 0){var j=al,be=e;switch(e){case"keypress":if(tl(i)===0)break e;case"keydown":case"keyup":j=r1;break;case"focusin":be="focus",j=Cu;break;case"focusout":be="blur",j=Cu;break;case"beforeblur":case"afterblur":j=Cu;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=Cm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=Kv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=c1;break;case Xm:case Km:case Qm:j=Zv;break;case Pm:j=d1;break;case"scroll":case"scrollend":j=Vv;break;case"wheel":j=h1;break;case"copy":case"cut":case"paste":j=Wv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=_m;break;case"toggle":case"beforetoggle":j=p1}var ge=(t&4)!==0,je=!ge&&(e==="scroll"||e==="scrollend"),L=ge?z!==null?z+"Capture":null:z;ge=[];for(var C=q,O;C!==null;){var Q=C;if(O=Q.stateNode,Q=Q.tag,Q!==5&&Q!==26&&Q!==27||O===null||L===null||(Q=gr(C,L),Q!=null&&ge.push(Jr(C,Q,O))),je)break;C=C.return}0<ge.length&&(z=new j(z,be,null,i,K),Z.push({event:z,listeners:ge}))}}if((t&7)===0){e:{if(z=e==="mouseover"||e==="pointerover",j=e==="mouseout"||e==="pointerout",z&&i!==vu&&(be=i.relatedTarget||i.fromElement)&&(va(be)||be[ba]))break e;if((j||z)&&(z=K.window===K?K:(z=K.ownerDocument)?z.defaultView||z.parentWindow:window,j?(be=i.relatedTarget||i.toElement,j=q,be=be?va(be):null,be!==null&&(je=u(be),ge=be.tag,be!==je||ge!==5&&ge!==27&&ge!==6)&&(be=null)):(j=null,be=q),j!==be)){if(ge=Cm,Q="onMouseLeave",L="onMouseEnter",C="mouse",(e==="pointerout"||e==="pointerover")&&(ge=_m,Q="onPointerLeave",L="onPointerEnter",C="pointer"),je=j==null?z:Sa(j),O=be==null?z:Sa(be),z=new ge(Q,C+"leave",j,i,K),z.target=je,z.relatedTarget=O,Q=null,va(K)===q&&(ge=new ge(L,C+"enter",be,i,K),ge.target=O,ge.relatedTarget=je,Q=ge),je=Q,j&&be)t:{for(ge=j,L=be,C=0,O=ge;O;O=Ys(O))C++;for(O=0,Q=L;Q;Q=Ys(Q))O++;for(;0<C-O;)ge=Ys(ge),C--;for(;0<O-C;)L=Ys(L),O--;for(;C--;){if(ge===L||L!==null&&ge===L.alternate)break t;ge=Ys(ge),L=Ys(L)}ge=null}else ge=null;j!==null&&yg(Z,z,j,ge,!1),be!==null&&je!==null&&yg(Z,je,be,ge,!0)}}e:{if(z=q?Sa(q):window,j=z.nodeName&&z.nodeName.toLowerCase(),j==="select"||j==="input"&&z.type==="file")var ue=qm;else if(Um(z))if(zm)ue=A1;else{ue=x1;var we=M1}else j=z.nodeName,!j||j.toLowerCase()!=="input"||z.type!=="checkbox"&&z.type!=="radio"?q&&bu(q.elementType)&&(ue=qm):ue=w1;if(ue&&(ue=ue(e,q))){Om(Z,ue,i,K);break e}we&&we(e,z,q),e==="focusout"&&q&&z.type==="number"&&q.memoizedProps.value!=null&&Wa(z,"number",z.value)}switch(we=q?Sa(q):window,e){case"focusin":(Um(we)||we.contentEditable==="true")&&(vs=we,Du=q,wr=null);break;case"focusout":wr=Du=vs=null;break;case"mousedown":Lu=!0;break;case"contextmenu":case"mouseup":case"dragend":Lu=!1,$m(Z,i,K);break;case"selectionchange":if(T1)break;case"keydown":case"keyup":$m(Z,i,K)}var me;if(_u)e:{switch(e){case"compositionstart":var ye="onCompositionStart";break e;case"compositionend":ye="onCompositionEnd";break e;case"compositionupdate":ye="onCompositionUpdate";break e}ye=void 0}else bs?Dm(e,i)&&(ye="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(ye="onCompositionStart");ye&&(Rm&&i.locale!=="ko"&&(bs||ye!=="onCompositionStart"?ye==="onCompositionEnd"&&bs&&(me=wm()):(ei=K,xu="value"in ei?ei.value:ei.textContent,bs=!0)),we=Fl(q,ye),0<we.length&&(ye=new Tm(ye,e,null,i,K),Z.push({event:ye,listeners:we}),me?ye.data=me:(me=Lm(i),me!==null&&(ye.data=me)))),(me=y1?b1(e,i):v1(e,i))&&(ye=Fl(q,"onBeforeInput"),0<ye.length&&(we=new Tm("onBeforeInput","beforeinput",null,i,K),Z.push({event:we,listeners:ye}),we.data=me)),cS(Z,e,q,i,K)}pg(Z,t)})}function Jr(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Fl(e,t){for(var i=t+"Capture",o=[];e!==null;){var c=e,d=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||d===null||(c=gr(e,i),c!=null&&o.unshift(Jr(e,c,d)),c=gr(e,t),c!=null&&o.push(Jr(e,c,d))),e.tag===3)return o;e=e.return}return[]}function Ys(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function yg(e,t,i,o,c){for(var d=t._reactName,y=[];i!==null&&i!==o;){var v=i,w=v.alternate,q=v.stateNode;if(v=v.tag,w!==null&&w===o)break;v!==5&&v!==26&&v!==27||q===null||(w=q,c?(q=gr(i,d),q!=null&&y.unshift(Jr(i,q,w))):c||(q=gr(i,d),q!=null&&y.push(Jr(i,q,w)))),i=i.return}y.length!==0&&e.push({event:t,listeners:y})}var hS=/\r\n?/g,mS=/\u0000|\uFFFD/g;function bg(e){return(typeof e=="string"?e:""+e).replace(hS,`
`).replace(mS,"")}function vg(e,t){return t=bg(t),bg(e)===t}function $l(){}function He(e,t,i,o,c,d){switch(i){case"children":typeof o=="string"?t==="body"||t==="textarea"&&o===""||ps(e,o):(typeof o=="number"||typeof o=="bigint")&&t!=="body"&&ps(e,""+o);break;case"className":Li(e,"class",o);break;case"tabIndex":Li(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":Li(e,i,o);break;case"style":Em(e,o,d);break;case"data":if(t!=="object"){Li(e,"data",o);break}case"src":case"href":if(o===""&&(t!=="a"||i!=="href")){e.removeAttribute(i);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(i);break}o=Wo(""+o),e.setAttribute(i,o);break;case"action":case"formAction":if(typeof o=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(i==="formAction"?(t!=="input"&&He(e,t,"name",c.name,c,null),He(e,t,"formEncType",c.formEncType,c,null),He(e,t,"formMethod",c.formMethod,c,null),He(e,t,"formTarget",c.formTarget,c,null)):(He(e,t,"encType",c.encType,c,null),He(e,t,"method",c.method,c,null),He(e,t,"target",c.target,c,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(i);break}o=Wo(""+o),e.setAttribute(i,o);break;case"onClick":o!=null&&(e.onclick=$l);break;case"onScroll":o!=null&&Te("scroll",e);break;case"onScrollEnd":o!=null&&Te("scrollend",e);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(i=o.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"multiple":e.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":e.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){e.removeAttribute("xlink:href");break}i=Wo(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,""+o):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":o===!0?e.setAttribute(i,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,o):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?e.setAttribute(i,o):e.removeAttribute(i);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?e.removeAttribute(i):e.setAttribute(i,o);break;case"popover":Te("beforetoggle",e),Te("toggle",e),Di(e,"popover",o);break;case"xlinkActuate":Nn(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":Nn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":Nn(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":Nn(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":Nn(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":Nn(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":Nn(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":Nn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":Nn(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":Di(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=Fv.get(i)||i,Di(e,i,o))}}function nf(e,t,i,o,c,d){switch(i){case"style":Em(e,o,d);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(i=o.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"children":typeof o=="string"?ps(e,o):(typeof o=="number"||typeof o=="bigint")&&ps(e,""+o);break;case"onScroll":o!=null&&Te("scroll",e);break;case"onScrollEnd":o!=null&&Te("scrollend",e);break;case"onClick":o!=null&&(e.onclick=$l);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Vo.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(c=i.endsWith("Capture"),t=i.slice(2,c?i.length-7:void 0),d=e[mt]||null,d=d!=null?d[i]:null,typeof d=="function"&&e.removeEventListener(t,d,c),typeof o=="function")){typeof d!="function"&&d!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(t,o,c);break e}i in e?e[i]=o:o===!0?e.setAttribute(i,""):Di(e,i,o)}}}function Nt(e,t,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Te("error",e),Te("load",e);var o=!1,c=!1,d;for(d in i)if(i.hasOwnProperty(d)){var y=i[d];if(y!=null)switch(d){case"src":o=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:He(e,t,d,y,i,null)}}c&&He(e,t,"srcSet",i.srcSet,i,null),o&&He(e,t,"src",i.src,i,null);return;case"input":Te("invalid",e);var v=d=y=c=null,w=null,q=null;for(o in i)if(i.hasOwnProperty(o)){var K=i[o];if(K!=null)switch(o){case"name":c=K;break;case"type":y=K;break;case"checked":w=K;break;case"defaultChecked":q=K;break;case"value":d=K;break;case"defaultValue":v=K;break;case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(r(137,t));break;default:He(e,t,o,K,i,null)}}Ja(e,d,v,w,q,y,c,!1),Mt(e);return;case"select":Te("invalid",e),o=y=d=null;for(c in i)if(i.hasOwnProperty(c)&&(v=i[c],v!=null))switch(c){case"value":d=v;break;case"defaultValue":y=v;break;case"multiple":o=v;default:He(e,t,c,v,i,null)}t=d,i=y,e.multiple=!!o,t!=null?Ma(e,!!o,t,!1):i!=null&&Ma(e,!!o,i,!0);return;case"textarea":Te("invalid",e),d=c=o=null;for(y in i)if(i.hasOwnProperty(y)&&(v=i[y],v!=null))switch(y){case"value":o=v;break;case"defaultValue":c=v;break;case"children":d=v;break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:He(e,t,y,v,i,null)}Jo(e,o,c,d),Mt(e);return;case"option":for(w in i)if(i.hasOwnProperty(w)&&(o=i[w],o!=null))switch(w){case"selected":e.selected=o&&typeof o!="function"&&typeof o!="symbol";break;default:He(e,t,w,o,i,null)}return;case"dialog":Te("beforetoggle",e),Te("toggle",e),Te("cancel",e),Te("close",e);break;case"iframe":case"object":Te("load",e);break;case"video":case"audio":for(o=0;o<Zr.length;o++)Te(Zr[o],e);break;case"image":Te("error",e),Te("load",e);break;case"details":Te("toggle",e);break;case"embed":case"source":case"link":Te("error",e),Te("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(q in i)if(i.hasOwnProperty(q)&&(o=i[q],o!=null))switch(q){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:He(e,t,q,o,i,null)}return;default:if(bu(t)){for(K in i)i.hasOwnProperty(K)&&(o=i[K],o!==void 0&&nf(e,t,K,o,i,void 0));return}}for(v in i)i.hasOwnProperty(v)&&(o=i[v],o!=null&&He(e,t,v,o,i,null))}function pS(e,t,i,o){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,d=null,y=null,v=null,w=null,q=null,K=null;for(j in i){var Z=i[j];if(i.hasOwnProperty(j)&&Z!=null)switch(j){case"checked":break;case"value":break;case"defaultValue":w=Z;default:o.hasOwnProperty(j)||He(e,t,j,null,o,Z)}}for(var z in o){var j=o[z];if(Z=i[z],o.hasOwnProperty(z)&&(j!=null||Z!=null))switch(z){case"type":d=j;break;case"name":c=j;break;case"checked":q=j;break;case"defaultChecked":K=j;break;case"value":y=j;break;case"defaultValue":v=j;break;case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(r(137,t));break;default:j!==Z&&He(e,t,z,j,o,Z)}}tt(e,y,v,w,q,K,d,c);return;case"select":j=y=v=z=null;for(d in i)if(w=i[d],i.hasOwnProperty(d)&&w!=null)switch(d){case"value":break;case"multiple":j=w;default:o.hasOwnProperty(d)||He(e,t,d,null,o,w)}for(c in o)if(d=o[c],w=i[c],o.hasOwnProperty(c)&&(d!=null||w!=null))switch(c){case"value":z=d;break;case"defaultValue":v=d;break;case"multiple":y=d;default:d!==w&&He(e,t,c,d,o,w)}t=v,i=y,o=j,z!=null?Ma(e,!!i,z,!1):!!o!=!!i&&(t!=null?Ma(e,!!i,t,!0):Ma(e,!!i,i?[]:"",!1));return;case"textarea":j=z=null;for(v in i)if(c=i[v],i.hasOwnProperty(v)&&c!=null&&!o.hasOwnProperty(v))switch(v){case"value":break;case"children":break;default:He(e,t,v,null,o,c)}for(y in o)if(c=o[y],d=i[y],o.hasOwnProperty(y)&&(c!=null||d!=null))switch(y){case"value":z=c;break;case"defaultValue":j=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(r(91));break;default:c!==d&&He(e,t,y,c,o,d)}$n(e,z,j);return;case"option":for(var be in i)if(z=i[be],i.hasOwnProperty(be)&&z!=null&&!o.hasOwnProperty(be))switch(be){case"selected":e.selected=!1;break;default:He(e,t,be,null,o,z)}for(w in o)if(z=o[w],j=i[w],o.hasOwnProperty(w)&&z!==j&&(z!=null||j!=null))switch(w){case"selected":e.selected=z&&typeof z!="function"&&typeof z!="symbol";break;default:He(e,t,w,z,o,j)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ge in i)z=i[ge],i.hasOwnProperty(ge)&&z!=null&&!o.hasOwnProperty(ge)&&He(e,t,ge,null,o,z);for(q in o)if(z=o[q],j=i[q],o.hasOwnProperty(q)&&z!==j&&(z!=null||j!=null))switch(q){case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(r(137,t));break;default:He(e,t,q,z,o,j)}return;default:if(bu(t)){for(var je in i)z=i[je],i.hasOwnProperty(je)&&z!==void 0&&!o.hasOwnProperty(je)&&nf(e,t,je,void 0,o,z);for(K in o)z=o[K],j=i[K],!o.hasOwnProperty(K)||z===j||z===void 0&&j===void 0||nf(e,t,K,z,o,j);return}}for(var L in i)z=i[L],i.hasOwnProperty(L)&&z!=null&&!o.hasOwnProperty(L)&&He(e,t,L,null,o,z);for(Z in o)z=o[Z],j=i[Z],!o.hasOwnProperty(Z)||z===j||z==null&&j==null||He(e,t,Z,z,o,j)}var af=null,sf=null;function Vl(e){return e.nodeType===9?e:e.ownerDocument}function Sg(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Eg(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function rf(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var of=null;function gS(){var e=window.event;return e&&e.type==="popstate"?e===of?!1:(of=e,!0):(of=null,!1)}var Mg=typeof setTimeout=="function"?setTimeout:void 0,yS=typeof clearTimeout=="function"?clearTimeout:void 0,xg=typeof Promise=="function"?Promise:void 0,bS=typeof queueMicrotask=="function"?queueMicrotask:typeof xg<"u"?function(e){return xg.resolve(null).then(e).catch(vS)}:Mg;function vS(e){setTimeout(function(){throw e})}function gi(e){return e==="head"}function wg(e,t){var i=t,o=0,c=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(0<o&&8>o){i=o;var y=e.ownerDocument;if(i&1&&Wr(y.documentElement),i&2&&Wr(y.body),i&4)for(i=y.head,Wr(i),y=i.firstChild;y;){var v=y.nextSibling,w=y.nodeName;y[ki]||w==="SCRIPT"||w==="STYLE"||w==="LINK"&&y.rel.toLowerCase()==="stylesheet"||i.removeChild(y),y=v}}if(c===0){e.removeChild(d),oo(t);return}c--}else i==="$"||i==="$?"||i==="$!"?c++:o=i.charCodeAt(0)-48;else o=0;i=d}while(i);oo(t)}function lf(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var i=t;switch(t=t.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":lf(i),hs(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function SS(e,t,i,o){for(;e.nodeType===1;){var c=i;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!o&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(o){if(!e[ki])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var d=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=Ln(e.nextSibling),e===null)break}return null}function ES(e,t,i){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=Ln(e.nextSibling),e===null))return null;return e}function cf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function MS(e,t){var i=e.ownerDocument;if(e.data!=="$?"||i.readyState==="complete")t();else{var o=function(){t(),i.removeEventListener("DOMContentLoaded",o)};i.addEventListener("DOMContentLoaded",o),e._reactRetry=o}}function Ln(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var uf=null;function Ag(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}function Cg(e,t,i){switch(t=Vl(i),e){case"html":if(e=t.documentElement,!e)throw Error(r(452));return e;case"head":if(e=t.head,!e)throw Error(r(453));return e;case"body":if(e=t.body,!e)throw Error(r(454));return e;default:throw Error(r(451))}}function Wr(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);hs(e)}var En=new Map,Tg=new Set;function Xl(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var qa=G.d;G.d={f:xS,r:wS,D:AS,C:CS,L:TS,m:_S,X:NS,S:RS,M:kS};function xS(){var e=qa.f(),t=Bl();return e||t}function wS(e){var t=Pa(e);t!==null&&t.tag===5&&t.type==="form"?Xp(t):qa.r(e)}var Fs=typeof document>"u"?null:document;function _g(e,t,i){var o=Fs;if(o&&typeof t=="string"&&t){var c=pt(t);c='link[rel="'+e+'"][href="'+c+'"]',typeof i=="string"&&(c+='[crossorigin="'+i+'"]'),Tg.has(c)||(Tg.add(c),e={rel:e,crossOrigin:i,href:t},o.querySelector(c)===null&&(t=o.createElement("link"),Nt(t,"link",e),We(t),o.head.appendChild(t)))}}function AS(e){qa.D(e),_g("dns-prefetch",e,null)}function CS(e,t){qa.C(e,t),_g("preconnect",e,t)}function TS(e,t,i){qa.L(e,t,i);var o=Fs;if(o&&e&&t){var c='link[rel="preload"][as="'+pt(t)+'"]';t==="image"&&i&&i.imageSrcSet?(c+='[imagesrcset="'+pt(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(c+='[imagesizes="'+pt(i.imageSizes)+'"]')):c+='[href="'+pt(e)+'"]';var d=c;switch(t){case"style":d=$s(e);break;case"script":d=Vs(e)}En.has(d)||(e=g({rel:"preload",href:t==="image"&&i&&i.imageSrcSet?void 0:e,as:t},i),En.set(d,e),o.querySelector(c)!==null||t==="style"&&o.querySelector(eo(d))||t==="script"&&o.querySelector(to(d))||(t=o.createElement("link"),Nt(t,"link",e),We(t),o.head.appendChild(t)))}}function _S(e,t){qa.m(e,t);var i=Fs;if(i&&e){var o=t&&typeof t.as=="string"?t.as:"script",c='link[rel="modulepreload"][as="'+pt(o)+'"][href="'+pt(e)+'"]',d=c;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=Vs(e)}if(!En.has(d)&&(e=g({rel:"modulepreload",href:e},t),En.set(d,e),i.querySelector(c)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(to(d)))return}o=i.createElement("link"),Nt(o,"link",e),We(o),i.head.appendChild(o)}}}function RS(e,t,i){qa.S(e,t,i);var o=Fs;if(o&&e){var c=Ea(o).hoistableStyles,d=$s(e);t=t||"default";var y=c.get(d);if(!y){var v={loading:0,preload:null};if(y=o.querySelector(eo(d)))v.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":t},i),(i=En.get(d))&&df(e,i);var w=y=o.createElement("link");We(w),Nt(w,"link",e),w._p=new Promise(function(q,K){w.onload=q,w.onerror=K}),w.addEventListener("load",function(){v.loading|=1}),w.addEventListener("error",function(){v.loading|=2}),v.loading|=4,Kl(y,t,o)}y={type:"stylesheet",instance:y,count:1,state:v},c.set(d,y)}}}function NS(e,t){qa.X(e,t);var i=Fs;if(i&&e){var o=Ea(i).hoistableScripts,c=Vs(e),d=o.get(c);d||(d=i.querySelector(to(c)),d||(e=g({src:e,async:!0},t),(t=En.get(c))&&ff(e,t),d=i.createElement("script"),We(d),Nt(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},o.set(c,d))}}function kS(e,t){qa.M(e,t);var i=Fs;if(i&&e){var o=Ea(i).hoistableScripts,c=Vs(e),d=o.get(c);d||(d=i.querySelector(to(c)),d||(e=g({src:e,async:!0,type:"module"},t),(t=En.get(c))&&ff(e,t),d=i.createElement("script"),We(d),Nt(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},o.set(c,d))}}function Rg(e,t,i,o){var c=(c=he.current)?Xl(c):null;if(!c)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(t=$s(i.href),i=Ea(c).hoistableStyles,o=i.get(t),o||(o={type:"style",instance:null,count:0,state:null},i.set(t,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=$s(i.href);var d=Ea(c).hoistableStyles,y=d.get(e);if(y||(c=c.ownerDocument||c,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,y),(d=c.querySelector(eo(e)))&&!d._p&&(y.instance=d,y.state.loading=5),En.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},En.set(e,i),d||DS(c,e,i,y.state))),t&&o===null)throw Error(r(528,""));return y}if(t&&o!==null)throw Error(r(529,""));return null;case"script":return t=i.async,i=i.src,typeof i=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Vs(i),i=Ea(c).hoistableScripts,o=i.get(t),o||(o={type:"script",instance:null,count:0,state:null},i.set(t,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function $s(e){return'href="'+pt(e)+'"'}function eo(e){return'link[rel="stylesheet"]['+e+"]"}function Ng(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function DS(e,t,i,o){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?o.loading=1:(t=e.createElement("link"),o.preload=t,t.addEventListener("load",function(){return o.loading|=1}),t.addEventListener("error",function(){return o.loading|=2}),Nt(t,"link",i),We(t),e.head.appendChild(t))}function Vs(e){return'[src="'+pt(e)+'"]'}function to(e){return"script[async]"+e}function kg(e,t,i){if(t.count++,t.instance===null)switch(t.type){case"style":var o=e.querySelector('style[data-href~="'+pt(i.href)+'"]');if(o)return t.instance=o,We(o),o;var c=g({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return o=(e.ownerDocument||e).createElement("style"),We(o),Nt(o,"style",c),Kl(o,i.precedence,e),t.instance=o;case"stylesheet":c=$s(i.href);var d=e.querySelector(eo(c));if(d)return t.state.loading|=4,t.instance=d,We(d),d;o=Ng(i),(c=En.get(c))&&df(o,c),d=(e.ownerDocument||e).createElement("link"),We(d);var y=d;return y._p=new Promise(function(v,w){y.onload=v,y.onerror=w}),Nt(d,"link",o),t.state.loading|=4,Kl(d,i.precedence,e),t.instance=d;case"script":return d=Vs(i.src),(c=e.querySelector(to(d)))?(t.instance=c,We(c),c):(o=i,(c=En.get(d))&&(o=g({},i),ff(o,c)),e=e.ownerDocument||e,c=e.createElement("script"),We(c),Nt(c,"link",o),e.head.appendChild(c),t.instance=c);case"void":return null;default:throw Error(r(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(o=t.instance,t.state.loading|=4,Kl(o,i.precedence,e));return t.instance}function Kl(e,t,i){for(var o=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=o.length?o[o.length-1]:null,d=c,y=0;y<o.length;y++){var v=o[y];if(v.dataset.precedence===t)d=v;else if(d!==c)break}d?d.parentNode.insertBefore(e,d.nextSibling):(t=i.nodeType===9?i.head:i,t.insertBefore(e,t.firstChild))}function df(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function ff(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Ql=null;function Dg(e,t,i){if(Ql===null){var o=new Map,c=Ql=new Map;c.set(i,o)}else c=Ql,o=c.get(i),o||(o=new Map,c.set(i,o));if(o.has(e))return o;for(o.set(e,null),i=i.getElementsByTagName(e),c=0;c<i.length;c++){var d=i[c];if(!(d[ki]||d[Je]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var y=d.getAttribute(t)||"";y=e+y;var v=o.get(y);v?v.push(d):o.set(y,[d])}}return o}function Lg(e,t,i){e=e.ownerDocument||e,e.head.insertBefore(i,t==="title"?e.querySelector("head > title"):null)}function LS(e,t,i){if(i===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function Ug(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var no=null;function US(){}function OS(e,t,i){if(no===null)throw Error(r(475));var o=no;if(t.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var c=$s(i.href),d=e.querySelector(eo(c));if(d){e=d._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(o.count++,o=Pl.bind(o),e.then(o,o)),t.state.loading|=4,t.instance=d,We(d);return}d=e.ownerDocument||e,i=Ng(i),(c=En.get(c))&&df(i,c),d=d.createElement("link"),We(d);var y=d;y._p=new Promise(function(v,w){y.onload=v,y.onerror=w}),Nt(d,"link",i),t.instance=d}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(o.count++,t=Pl.bind(o),e.addEventListener("load",t),e.addEventListener("error",t))}}function qS(){if(no===null)throw Error(r(475));var e=no;return e.stylesheets&&e.count===0&&hf(e,e.stylesheets),0<e.count?function(t){var i=setTimeout(function(){if(e.stylesheets&&hf(e,e.stylesheets),e.unsuspend){var o=e.unsuspend;e.unsuspend=null,o()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(i)}}:null}function Pl(){if(this.count--,this.count===0){if(this.stylesheets)hf(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Zl=null;function hf(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Zl=new Map,t.forEach(zS,e),Zl=null,Pl.call(e))}function zS(e,t){if(!(t.state.loading&4)){var i=Zl.get(e);if(i)var o=i.get(null);else{i=new Map,Zl.set(e,i);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<c.length;d++){var y=c[d];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(i.set(y.dataset.precedence,y),o=y)}o&&i.set(null,o)}c=t.instance,y=c.getAttribute("data-precedence"),d=i.get(y)||o,d===o&&i.set(null,c),i.set(y,c),this.count++,o=Pl.bind(this),c.addEventListener("load",o),c.addEventListener("error",o),d?d.parentNode.insertBefore(c,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),t.state.loading|=4}}var ao={$$typeof:I,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function BS(e,t,i,o,c,d,y,v){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ht(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ht(0),this.hiddenUpdates=ht(null),this.identifierPrefix=o,this.onUncaughtError=c,this.onCaughtError=d,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=v,this.incompleteTransitions=new Map}function Og(e,t,i,o,c,d,y,v,w,q,K,Z){return e=new BS(e,t,i,y,v,w,q,Z),t=1,d===!0&&(t|=24),d=on(3,null,null,t),e.current=d,d.stateNode=e,t=Xu(),t.refCount++,e.pooledCache=t,t.refCount++,d.memoizedState={element:o,isDehydrated:i,cache:t},Zu(d),e}function qg(e){return e?(e=xs,e):xs}function zg(e,t,i,o,c,d){c=qg(c),o.context===null?o.context=c:o.pendingContext=c,o=ai(t),o.payload={element:i},d=d===void 0?null:d,d!==null&&(o.callback=d),i=ii(e,o,t),i!==null&&(fn(i,e,t),Lr(i,e,t))}function Bg(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function mf(e,t){Bg(e,t),(e=e.alternate)&&Bg(e,t)}function Hg(e){if(e.tag===13){var t=Ms(e,67108864);t!==null&&fn(t,e,67108864),mf(e,67108864)}}var Jl=!0;function HS(e,t,i,o){var c=T.T;T.T=null;var d=G.p;try{G.p=2,pf(e,t,i,o)}finally{G.p=d,T.T=c}}function jS(e,t,i,o){var c=T.T;T.T=null;var d=G.p;try{G.p=8,pf(e,t,i,o)}finally{G.p=d,T.T=c}}function pf(e,t,i,o){if(Jl){var c=gf(o);if(c===null)tf(e,t,o,Wl,i),Ig(e,o);else if(GS(c,e,t,i,o))o.stopPropagation();else if(Ig(e,o),t&4&&-1<IS.indexOf(e)){for(;c!==null;){var d=Pa(c);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var y=_n(d.pendingLanes);if(y!==0){var v=d;for(v.pendingLanes|=2,v.entangledLanes|=2;y;){var w=1<<31-ft(y);v.entanglements[1]|=w,y&=~w}Pn(d),(Oe&6)===0&&(ql=lt()+500,Pr(0))}}break;case 13:v=Ms(d,2),v!==null&&fn(v,d,2),Bl(),mf(d,2)}if(d=gf(o),d===null&&tf(e,t,o,Wl,i),d===c)break;c=d}c!==null&&o.stopPropagation()}else tf(e,t,o,null,i)}}function gf(e){return e=Su(e),yf(e)}var Wl=null;function yf(e){if(Wl=null,e=va(e),e!==null){var t=u(e);if(t===null)e=null;else{var i=t.tag;if(i===13){if(e=f(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Wl=e,null}function jg(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(da()){case An:return 2;case mn:return 8;case $t:case Ka:return 32;case Cn:return 268435456;default:return 32}default:return 32}}var bf=!1,yi=null,bi=null,vi=null,io=new Map,so=new Map,Si=[],IS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ig(e,t){switch(e){case"focusin":case"focusout":yi=null;break;case"dragenter":case"dragleave":bi=null;break;case"mouseover":case"mouseout":vi=null;break;case"pointerover":case"pointerout":io.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":so.delete(t.pointerId)}}function ro(e,t,i,o,c,d){return e===null||e.nativeEvent!==d?(e={blockedOn:t,domEventName:i,eventSystemFlags:o,nativeEvent:d,targetContainers:[c]},t!==null&&(t=Pa(t),t!==null&&Hg(t)),e):(e.eventSystemFlags|=o,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function GS(e,t,i,o,c){switch(t){case"focusin":return yi=ro(yi,e,t,i,o,c),!0;case"dragenter":return bi=ro(bi,e,t,i,o,c),!0;case"mouseover":return vi=ro(vi,e,t,i,o,c),!0;case"pointerover":var d=c.pointerId;return io.set(d,ro(io.get(d)||null,e,t,i,o,c)),!0;case"gotpointercapture":return d=c.pointerId,so.set(d,ro(so.get(d)||null,e,t,i,o,c)),!0}return!1}function Gg(e){var t=va(e.target);if(t!==null){var i=u(t);if(i!==null){if(t=i.tag,t===13){if(t=f(i),t!==null){e.blockedOn=t,$o(e.priority,function(){if(i.tag===13){var o=dn();o=ga(o);var c=Ms(i,o);c!==null&&fn(c,i,o),mf(i,o)}});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ec(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=gf(e.nativeEvent);if(i===null){i=e.nativeEvent;var o=new i.constructor(i.type,i);vu=o,i.target.dispatchEvent(o),vu=null}else return t=Pa(i),t!==null&&Hg(t),e.blockedOn=i,!1;t.shift()}return!0}function Yg(e,t,i){ec(e)&&i.delete(t)}function YS(){bf=!1,yi!==null&&ec(yi)&&(yi=null),bi!==null&&ec(bi)&&(bi=null),vi!==null&&ec(vi)&&(vi=null),io.forEach(Yg),so.forEach(Yg)}function tc(e,t){e.blockedOn===t&&(e.blockedOn=null,bf||(bf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,YS)))}var nc=null;function Fg(e){nc!==e&&(nc=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){nc===e&&(nc=null);for(var t=0;t<e.length;t+=3){var i=e[t],o=e[t+1],c=e[t+2];if(typeof o!="function"){if(yf(o||i)===null)continue;break}var d=Pa(i);d!==null&&(e.splice(t,3),t-=3,gd(d,{pending:!0,data:c,method:i.method,action:o},o,c))}}))}function oo(e){function t(w){return tc(w,e)}yi!==null&&tc(yi,e),bi!==null&&tc(bi,e),vi!==null&&tc(vi,e),io.forEach(t),so.forEach(t);for(var i=0;i<Si.length;i++){var o=Si[i];o.blockedOn===e&&(o.blockedOn=null)}for(;0<Si.length&&(i=Si[0],i.blockedOn===null);)Gg(i),i.blockedOn===null&&Si.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(o=0;o<i.length;o+=3){var c=i[o],d=i[o+1],y=c[mt]||null;if(typeof d=="function")y||Fg(i);else if(y){var v=null;if(d&&d.hasAttribute("formAction")){if(c=d,y=d[mt]||null)v=y.formAction;else if(yf(c)!==null)continue}else v=y.action;typeof v=="function"?i[o+1]=v:(i.splice(o,3),o-=3),Fg(i)}}}function vf(e){this._internalRoot=e}ac.prototype.render=vf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(r(409));var i=t.current,o=dn();zg(i,o,e,t,null,null)},ac.prototype.unmount=vf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;zg(e.current,2,null,e,null,null),Bl(),t[ba]=null}};function ac(e){this._internalRoot=e}ac.prototype.unstable_scheduleHydration=function(e){if(e){var t=Fo();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Si.length&&t!==0&&t<Si[i].priority;i++);Si.splice(i,0,e),i===0&&Gg(e)}};var $g=a.version;if($g!=="19.1.1")throw Error(r(527,$g,"19.1.1"));G.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=p(t),e=e!==null?m(e):null,e=e===null?null:e.stateNode,e};var FS={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ic=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ic.isDisabled&&ic.supportsFiber)try{Ue=ic.inject(FS),Ze=ic}catch{}}return po.createRoot=function(e,t){if(!l(e))throw Error(r(299));var i=!1,o="",c=o0,d=l0,y=c0,v=null;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onUncaughtError!==void 0&&(c=t.onUncaughtError),t.onCaughtError!==void 0&&(d=t.onCaughtError),t.onRecoverableError!==void 0&&(y=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(v=t.unstable_transitionCallbacks)),t=Og(e,1,!1,null,null,i,o,c,d,y,v,null),e[ba]=t.current,ef(e),new vf(t)},po.hydrateRoot=function(e,t,i){if(!l(e))throw Error(r(299));var o=!1,c="",d=o0,y=l0,v=c0,w=null,q=null;return i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(d=i.onUncaughtError),i.onCaughtError!==void 0&&(y=i.onCaughtError),i.onRecoverableError!==void 0&&(v=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(w=i.unstable_transitionCallbacks),i.formState!==void 0&&(q=i.formState)),t=Og(e,1,!0,t,i??null,o,c,d,y,v,w,q),t.context=qg(null),i=t.current,o=dn(),o=ga(o),c=ai(o),c.callback=null,ii(i,c,o),i=o,t.current.lanes=i,Tt(t,i),Pn(t),e[ba]=t.current,ef(e),new ac(t)},po.version="19.1.1",po}var Yy;function G3(){if(Yy)return qf.exports;Yy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(a){console.error(a)}}return n(),qf.exports=I3(),qf.exports}var Y3=G3(),bt=tm();const pc=10,F3=1.5,$3=1.5,Fy=1,V3=.6,$y=" +50% attack   Barrier   Immortal",ns=5,as=3;let vt=null;function X3(){vt&&(vt.tickTimer&&clearInterval(vt.tickTimer),vt.timeout&&clearTimeout(vt.timeout),vt=null)}function nm(){return vt!==null}function Sb(){return vt?Math.max(0,vt.endTime-performance.now())/1e3:0}function K3(n,a){if(nm()||!n.spendResource(ns,ae.SISU))return!1;const s=[];for(const l of a){if(l.faction!=="player"||l.isDead())continue;const u=`sisu-burst-${l.id}`,f={unit:l,attackDelta:0,movementDelta:0,shieldBonusApplied:Fy,shieldBonusRemaining:Fy,wasImmortal:l.isImmortal()};lM({id:u,duration:pc,data:f,onApply:()=>{const h=l.stats.attackDamage,p=Math.round(h*F3);f.attackDelta=Math.max(0,p-h),f.attackDelta!==0&&(l.stats.attackDamage=h+f.attackDelta);const m=l.stats.movementRange,g=Math.max(1,Math.round(m*$3));f.movementDelta=Math.max(0,g-m),f.movementDelta!==0&&(l.stats.movementRange=m+f.movementDelta),f.shieldBonusRemaining=f.shieldBonusApplied,l.setShield(l.getShield()+f.shieldBonusApplied),l.setImmortal(!0),l.fearless=!0},onExpire:()=>{let h=!1;if(f.attackDelta!==0){const m=l.stats.attackDamage,g=Math.max(0,m-f.attackDelta);g!==m&&(l.stats.attackDamage=g,h=!0)}if(f.movementDelta!==0){const m=l.stats.movementRange,g=Math.max(0,m-f.movementDelta);g!==m&&(l.stats.movementRange=g,h=!0)}l.setImmortal(f.wasImmortal);const p=Math.max(0,Math.min(f.shieldBonusApplied,f.shieldBonusRemaining));p>0&&l.setShield(Math.max(0,l.getShield()-p)),delete l.fearless,h&&ne.emit("unit:stats:changed",{unitId:l.id,stats:{...l.stats}}),vt&&(vt.affected=vt.affected.filter(m=>m.modifierId!==u))},hooks:{"combat:onHit":h=>{const p=h;if(p.source!=="defender"||p.defender.id!==l.id||p.shieldDamage<=0||f.shieldBonusRemaining<=0)return;const m=Math.min(f.shieldBonusRemaining,p.shieldDamage);f.shieldBonusRemaining=Math.max(0,f.shieldBonusRemaining-m)}}}),s.push({unit:l,modifierId:u,state:f})}return vt={endTime:performance.now()+pc*1e3,status:$y,affected:s,tickTimer:null,timeout:null},ne.emit("sisuBurstStart",{remaining:pc,status:$y}),vt.tickTimer=setInterval(()=>{if(!vt)return;const l=Math.max(0,Math.ceil(Sb()));l>0&&ne.emit("sisuBurstTick",{remaining:l,status:vt.status})},1e3),vt.timeout=setTimeout(()=>{Q3()},pc*1e3),!0}function Q3(){if(vt){for(const n of vt.affected)cM(n.modifierId);X3(),ne.emit("sisuBurstEnd",{})}}function P3(n,a,s,r){const l=a.filter(u=>u.faction==="player"&&!u.isDead());if(l.length===0||!n.spendResource(as,ae.SISU))return!1;for(const u of l){const f=eb(s,3,a)??{...s};u.setCoord(f);const h=Math.round(u.getMaxHealth()*V3);u.stats.health=Math.min(u.getMaxHealth(),Math.max(u.stats.health,h))}return r.revealAround(s,3,{autoFrame:!1}),ne.emit("torilleRecalled",{count:l.length}),!0}let os=!1;function Eb(){return os}function Mb(n){os!==n&&(os=n,ne.emit("game:pause-changed",{paused:os}))}function Z3(){return Mb(!os),os}function J3(){os&&Mb(!1)}const W3=["/assets/sounds/sauna-forest.ogg","/assets/sounds/sauna-forest.mp3"],xb="audio_enabled",bh=new Set,cu=new Set;let is=null,gc=null,Ba=null,To=null;function ex(n){if(typeof localStorage>"u")return null;try{return localStorage.getItem(n)}catch(a){return console.warn("Unable to read ambience preference",n,a),null}}const wb=ex(xb);let Xa=wb==="true",_o=wb!==null;const vh=su();let Dc=Cb(vh.channels.music.volume,.65),ls=!1,sa=vh.channels.master.muted||vh.channels.music.muted;const Ps=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)"):null;let Ab=Ps?.matches??!1;if(Ps){const n=a=>{Ab=a.matches};typeof Ps.addEventListener=="function"?Ps.addEventListener("change",n):typeof Ps.addListener=="function"&&Ps.addListener(n)}if(typeof window<"u"&&!_o){const n=()=>{_o||(_o=!0,kb(!0),uu())};window.addEventListener("pointerdown",n,{once:!0}),window.addEventListener("keydown",n,{once:!0})}jh(n=>{const a=Cb(n.channels.music.volume,Dc),s=n.channels.master.muted||n.channels.music.muted,r=Math.abs(a-Dc)>5e-4;if(Dc=a,s!==sa){sa=s,sa?Nb():Xa?uu():(Uo(!0),Lo());return}r&&Lo()});function Cb(n,a){return Number.isFinite(n)?n<0?0:n>1?1:n:a}function Lo(){const n=Db();for(const a of bh)a(n)}function tx(n){if(!(typeof localStorage>"u"))try{localStorage.setItem(xb,n?"true":"false")}catch(a){console.warn("Unable to persist ambience preference",a)}}function Tb(n){if(Ba)return Ba;const a=n.createGain();a.gain.value=Xa&&!sa?1:0;const s=Hh("music");return s?a.connect(s):a.connect(n.destination),Ba=a,a}function Uo(n=!1){if(!Ba)return;const a=Ba.context,s=Xa&&!sa?1:0,r=a.currentTime;Ba.gain.cancelScheduledValues(r),n?Ba.gain.setValueAtTime(s,r):Ba.gain.setTargetAtTime(s,r,.25)}function nx(){return Ab?.6:4.2}function _b(){To!==null&&(clearTimeout(To),To=null)}function Sh(n){try{n.source.stop()}catch{}n.source.disconnect(),n.gain.disconnect(),cu.delete(n)}function ax(){for(const n of[...cu])Sh(n)}async function ix(n){return is||(gc||(gc=(async()=>{for(const a of W3)try{const s=await fetch(a);if(!s.ok)continue;const r=await s.arrayBuffer();return await n.decodeAudioData(r)}catch(s){console.warn("Failed to fetch ambience source",a,s)}throw new Error("No ambience sources available")})().then(a=>(is=a,a)).catch(a=>{throw gc=null,a})),gc)}function sx(n,a){if(!ls)return;_b();const s=Math.max(0,n-a.currentTime-.05);To=setTimeout(()=>{To=null,ls&&Rb(n)},s*1e3)}function Rb(n){const a=Ba?.context??Lb();if(!a||!is)return;const s=a.createGain(),r=a.createBufferSource();r.buffer=is,r.loop=!1,r.connect(s),s.connect(Tb(a));const l=Math.min(nx(),is.duration/2),u=Number.isFinite(l)&&l>0?l:.25,f=Math.max(a.currentTime,n);s.gain.setValueAtTime(0,f),s.gain.linearRampToValueAtTime(1,f+u);const h=n+is.duration,p=h-u;p>f&&s.gain.setValueAtTime(1,p),s.gain.linearRampToValueAtTime(.001,h+.1);const m={source:r,gain:s,stopTime:h};cu.add(m),r.addEventListener("ended",()=>{Sh(m)});try{r.start(n)}catch(g){console.warn("Failed to start ambience layer",g),Sh(m);return}sx(h-u,a)}async function uu(){if(ls||!Xa||sa){Uo();return}const n=Lb();if(n){Tb(n),Uo();try{const a=await ix(n);if(!Xa||sa)return;await n.resume().catch(()=>{}),ls=!0;const s=Math.max(n.currentTime+.12,n.currentTime);Rb(s),Lo()}catch(a){console.warn("Unable to start ambience",a)}}}function Nb(){if(!ls&&cu.size===0){Uo(!0);return}ls=!1,_b(),ax(),Uo(!0),Lo()}function kb(n){Xa===n&&_o||(Xa=n,_o=!0,tx(n),n?sa||uu():Nb(),Lo())}function Db(){return{enabled:Xa,playing:ls,volume:Dc,globallyMuted:sa}}function rx(n){return bh.add(n),()=>{bh.delete(n)}}Xa&&!sa&&uu();function Lb(){return Bh()}const ox='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',If={master:"Master mix",music:"Ambience soundscape",sfx:"Effects & interface"},lx={master:"Controls the overall loudness for every channel in the frontier.",music:"Shapes the ambience loops and atmospheric swells around the sauna.",sfx:"Balances unit callouts, UI clicks, and battle feedback cues."},cx="linear-gradient(90deg, rgba(59,130,246,0.85) 0%, rgba(14,165,233,0.9) VAR%, rgba(148,163,184,0.35) VAR%, rgba(71,85,105,0.2) 100%)";function Eh(n,a){n.style.backgroundImage=cx.replace(/VAR/g,`${a}%`)}function Mh(n){return`${Math.round(n)}%`}function ux(n,a,s){const r=l=>{if(l.key==="Escape"){l.preventDefault(),s();return}if(l.key!=="Tab")return;const u=a.querySelectorAll(ox);if(u.length===0){l.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],p=document.activeElement;l.shiftKey?(p===f||!a.contains(p))&&(l.preventDefault(),h.focus()):(p===h||!a.contains(p))&&(l.preventDefault(),f.focus())};return n.addEventListener("keydown",r),()=>n.removeEventListener("keydown",r)}function Ub(n,a,s){const r=a.channels[n],l=a.channels.master;if(n==="music"&&!s.enabled)return"Ambience paused";if(r.muted)return"Muted at mixer";if(n!=="master"&&l.muted)return"Master mute active";const u=Math.round(r.effectiveVolume*100);return u<=0?"Output silent":n==="master"?`Master output ${u}%`:n==="music"?`Soundscape live ${u}%`:`Effects live ${u}%`}function Gf(n,a,s,r,l,u,f){const h=n.createElement("section");h.className="rounded-hud-xl border border-white/12 bg-[linear-gradient(155deg,rgba(15,26,56,0.92),rgba(9,14,34,0.96))] p-5 shadow-[0_24px_45px_rgba(4,10,25,0.55)] backdrop-blur-[18px] backdrop-saturate-[140%]";const p=n.createElement("header");p.className="flex flex-wrap items-start justify-between gap-3";const m=n.createElement("div");m.className="space-y-1";const g=n.createElement("h3");g.className="text-lg font-semibold tracking-tight text-white",g.textContent=If[a];const b=n.createElement("p");b.className="max-w-[32ch] text-sm text-slate-300/85",b.textContent=lx[a],m.append(g,b);const S=n.createElement("span");S.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70",S.textContent=Ub(a,s,r),p.append(m,S);const E=n.createElement("div");E.className="mt-5 flex items-center gap-4";const M=n.createElement("input");M.type="range",M.min="0",M.max="100",M.step="1",M.className="h-2 flex-1 appearance-none rounded-full bg-slate-600/30 accent-accent transition-[background-image] duration-200 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",M.setAttribute("aria-label",`${If[a]} level`);const N=n.createElement("span");N.className="text-sm font-semibold text-slate-200",E.append(M,N);const _=n.createElement("div");_.className="mt-4 flex flex-wrap items-center gap-3";const U=n.createElement("button");if(U.type="button",U.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/60 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-white/80 transition-all duration-150 ease-out hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",U.setAttribute("aria-label",`Toggle mute for ${If[a]}`),U.addEventListener("click",()=>{const $=!es.channels[a].muted;l(a,$)}),_.append(U),a==="sfx"){const $=n.createElement("button");$.type="button",$.className="inline-flex items-center gap-2 rounded-full border border-accent/40 bg-accent/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-accent-200 transition-all duration-150 ease-out hover:bg-accent/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",$.textContent="Play sample",$.addEventListener("click",()=>{ia("spawn")}),_.append($)}let H;a==="music"&&f&&(H=n.createElement("button"),H.type="button",H.className="inline-flex items-center gap-2 rounded-full border border-emerald-300/25 bg-emerald-400/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-emerald-200 transition-all duration-150 ease-out hover:bg-emerald-400/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300",H.addEventListener("click",()=>{f()}),_.append(H));const I=Math.round(s.channels[a].volume*100);return M.value=String(I),Eh(M,I),N.textContent=Mh(I),U.setAttribute("aria-pressed",s.channels[a].muted?"true":"false"),U.textContent=s.channels[a].muted?"Muted":"Active",a==="music"&&(M.title=r.enabled?"Adjust ambience loudness":"Ambience paused  set the level ahead of resuming."),M.addEventListener("input",()=>{const $=Number(M.value);Eh(M,$),N.textContent=Mh($),u(a,$/100)}),h.append(p,E,_),{card:h,slider:M,value:N,muteButton:U,status:S,ambienceToggle:H}}let es=su();function dx(n){const{container:a,onClose:s}=n;if(!a)return{destroy(){},focus(){}};const r=a.ownerDocument??document,l=r.createElement("div");l.className="pointer-events-auto fixed inset-0 z-[1200] flex items-center justify-center bg-slate-950/75 p-4 backdrop-blur-[22px] backdrop-saturate-[140%]",l.setAttribute("role","presentation");const u=r.createElement("section");u.className="w-full max-w-[min(580px,92vw)] space-y-6 rounded-hud-xl border border-white/12 bg-[linear-gradient(145deg,rgba(12,22,45,0.95),rgba(7,13,29,0.97))] p-6 text-slate-100 shadow-[0_32px_60px_rgba(4,10,24,0.7)] backdrop-blur-[24px] backdrop-saturate-[150%]",u.setAttribute("role","dialog"),u.setAttribute("aria-modal","true");const f=`audio-mixer-title-${Date.now()}`;u.setAttribute("aria-labelledby",f),u.tabIndex=-1;const h=r.createElement("header");h.className="flex items-start justify-between gap-4";const p=r.createElement("div");p.className="space-y-1";const m=r.createElement("h2");m.id=f,m.className="text-2xl font-semibold tracking-tight text-white",m.textContent="Audio mixer";const g=r.createElement("p");g.className="max-w-[46ch] text-sm text-slate-300/85",g.textContent="Dial in the master bus, ambience beds, and tactical feedback without leaving the battlefield.",p.append(m,g);const b=r.createElement("button");b.type="button",b.className="rounded-full border border-white/20 bg-slate-800/70 px-3 py-1 text-sm font-semibold text-white/70 transition-all duration-150 hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",b.textContent="Close",h.append(p,b);const S=r.createElement("span");S.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70";const E=r.createElement("div");E.className="space-y-5";let M=Db();const N={master:Gf(r,"master",es,M,(Y,R)=>{LE(R)},(Y,R)=>{NE(R)},null),music:Gf(r,"music",es,M,(Y,R)=>{UE(R)},(Y,R)=>{kE(R)},()=>{kb(!M.enabled)}),sfx:Gf(r,"sfx",es,M,(Y,R)=>{OE(R)},(Y,R)=>{DE(R)},null)};E.append(N.master.card,N.music.card,N.sfx.card),u.append(h,S,E),l.append(u),a.append(l);let _=!1;function U(){const Y=N.music.ambienceToggle;Y&&(Y.setAttribute("aria-pressed",M.enabled?"true":"false"),Y.textContent=M.enabled?"Ambience enabled":"Ambience paused",Y.title=M.enabled?"Disable ambience loops":"Enable ambience loops")}function H(Y){es=Y;const R=Y.contextState==="uninitialized"?"Context idle":Y.contextState==="running"?"Context running":"Context suspended";S.textContent=R,["master","music","sfx"].forEach(k=>{const A=N[k],F=Y.channels[k],B=Math.round(F.volume*100);A.slider.value=String(B),Eh(A.slider,B),A.value.textContent=Mh(B),A.muteButton.setAttribute("aria-pressed",F.muted?"true":"false"),A.muteButton.textContent=F.muted?"Muted":"Active",A.status.textContent=Ub(k,Y,M),k==="music"&&(A.slider.title=M.enabled?"Adjust ambience loudness":"Ambience paused  set the level ahead of resuming.")}),U()}function I(){_||(_=!0,$(),l.parentElement&&l.remove(),s?.())}function $(){P.forEach(Y=>{try{Y()}catch{}}),P.length=0}const P=[],ie=Y=>{Y.target===l&&I()};l.addEventListener("click",ie),P.push(()=>l.removeEventListener("click",ie)),b.addEventListener("click",I),P.push(()=>b.removeEventListener("click",I));const se=ux(l,u,I);P.push(se);const oe=jh(Y=>{H(Y)});P.push(oe);const ee=rx(Y=>{M=Y,U(),H(es)});return P.push(ee),H(es),u.focus(),{destroy(){I()},focus(){u.focus()}}}function Vy(...n){return n.filter(Boolean).join(" ")}function Xy(n,a){return!(n.code!==a.code||(a.shift??!1)!==n.shiftKey||(a.alt??!1)!==n.altKey||(a.meta??!1)!==n.metaKey||(a.ctrl??!1)!==n.ctrlKey)}function fx(n){return!Number.isFinite(n)||n<=0?"0s":`${Math.max(0,Math.ceil(n))}s`}function hx(){const[n,a]=bt.useState(()=>{const s=nm();return{active:s,remaining:s?Math.ceil(Sb()):0,status:s?"Burst active":void 0}});return bt.useEffect(()=>{const s=({remaining:u,status:f})=>{a({active:!0,remaining:Math.ceil(u),status:f})},r=({remaining:u,status:f})=>{a(h=>({active:!0,remaining:Math.ceil(u),status:f??h.status}))},l=()=>{a({active:!1,remaining:0,status:void 0})};return ne.on("sisuBurstStart",s),ne.on("sisuBurstTick",r),ne.on("sisuBurstEnd",l),()=>{ne.off("sisuBurstStart",s),ne.off("sisuBurstTick",r),ne.off("sisuBurstEnd",l)}},[]),n}function mx(){const[n,a]=bt.useState(()=>Eb());return bt.useEffect(()=>{const s=({paused:r})=>{a(r)};return ne.on("game:pause-changed",s),()=>{ne.off("game:pause-changed",s)}},[]),n}function Ky(n){const a=n.target;if(!a)return!1;const s=a.tagName;return!!(s==="INPUT"||s==="TEXTAREA"||s==="SELECT"||a.isContentEditable)}function px({state:n,abilities:a}){const[s,r]=bt.useState(()=>n.getResource(ae.SISU)),[l,u]=bt.useState(()=>dh()),[f,h]=bt.useState(!1),[p,m]=bt.useState(null),g=bt.useRef({}),[b,S]=bt.useState(()=>new Set),E=hx(),M=mx(),N=bt.useRef(null),_=bt.useCallback(R=>{S(A=>{const F=new Set(A);return F.add(R),F});const k=g.current[R];k&&window.clearTimeout(k),g.current[R]=window.setTimeout(()=>{S(A=>{const F=new Set(A);return F.delete(R),F}),delete g.current[R]},650)},[]);bt.useEffect(()=>{const R=({resource:k,total:A})=>{k===ae.SISU&&r(A)};return ne.on("resourceChanged",R),()=>{ne.off("resourceChanged",R),Object.values(g.current).forEach(k=>{k&&window.clearTimeout(k)}),g.current={}}},[]),bt.useEffect(()=>iM(u),[]),bt.useEffect(()=>()=>{N.current?.destroy(),N.current=null},[]);const U=bt.useCallback(()=>{const R=document.getElementById("ui-overlay");if(!R)return!1;if(N.current)return N.current.destroy(),N.current=null,h(!1),!0;const k=dx({container:R,onClose:()=>{N.current=null,h(!1)}});return N.current=k,h(!0),k.focus(),!0},[]),H=a.useSisuBurst,I=a.torille,$=a.onOpenBuildPlanner,P=!H||E.active||s<ns,ie=H?E.active?"Burst already surging.":s<ns?`Requires ${ns} SISU.`:void 0:"Burst controls offline in this build.",se=!I||s<as,oe=I?s<as?`Requires ${as} SISU.`:void 0:"Torille rally is unavailable right now.",ee=bt.useMemo(()=>[{id:"burst",icon:"",label:"Sisu Burst",description:"Ignite a surge of fury and resilience across your warriors.",hotkey:{code:"KeyQ",label:"Q"},accent:"primary",cost:`-${ns} SISU`,detail:E.active?`${E.status??"Burst active"}  ${fx(E.remaining)}`:void 0,blocked:P,blockedReason:ie,interactive:!!H,onActivate:()=>H?H():!1},{id:"torille",icon:"",label:"Torille!",description:"Call every survivor home to the sauna to regroup and heal.",hotkey:{code:"KeyW",label:"W"},accent:"primary",cost:`-${as} SISU`,blocked:se,blockedReason:oe,interactive:!!I,onActivate:()=>I?I():!1},{id:"build",icon:"",label:"Build",description:"Draft new structures to reinforce your frontier.",hotkey:{code:"KeyE",label:"E"},accent:"neutral",blocked:!$,blockedReason:$?void 0:"Construction planner will unlock in a forthcoming update.",interactive:!!$,onActivate:()=>$?$()??!0:!1},{id:"sound",icon:l?"":f?"":"",label:"Audio",description:"Open the in-game mixer to balance master, ambience, and effects.",hotkey:{code:"KeyR",label:"R"},accent:"neutral",toggled:f,detail:f?"Mixer open":l?"Muted":"Live mix",interactive:!0,blocked:!1,onActivate:()=>!!U()},{id:"pause",icon:M?"":"",label:M?"Paused":"Pause",description:M?"Time is frozen  resume when your strategy is ready.":"Freeze the battlefield to reassess and issue commands.",hotkey:{code:"Space",label:"Space"},accent:"neutral",toggled:M,detail:M?"Combat frozen":"Time flowing",interactive:!0,blocked:!1,onActivate:()=>(Z3(),!0)}],[E.active,E.remaining,P,ie,I,f,l,$,M,se,oe,H]),Y=bt.useCallback(R=>{if(!R.interactive){_(R.id);return}if(R.blocked){_(R.id);return}R.onActivate?.()===!1&&_(R.id)},[_]);return bt.useEffect(()=>{const R=A=>{if(A.repeat||Ky(A))return;const F=ee.find(B=>Xy(A,B.hotkey));F&&(A.preventDefault(),m(F.id),Y(F))},k=A=>{if(Ky(A))return;const F=ee.find(B=>Xy(A,B.hotkey));F&&(A.preventDefault(),m(B=>B===F.id?null:B))};return window.addEventListener("keydown",R),window.addEventListener("keyup",k),()=>{window.removeEventListener("keydown",R),window.removeEventListener("keyup",k)}},[ee,Y]),Zt.jsx("div",{className:"pointer-events-none w-full",children:Zt.jsx("div",{className:"pointer-events-auto mx-auto flex w-full max-w-4xl flex-col gap-4 rounded-[26px] border border-white/10 bg-[linear-gradient(145deg,rgba(11,17,30,0.86),rgba(6,10,18,0.92))] p-6 shadow-[0_26px_65px_rgba(6,12,24,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)] backdrop-blur-xl","aria-label":"Combat and systems action bar",children:Zt.jsx("div",{className:"flex flex-wrap items-stretch justify-center gap-4",children:ee.map(R=>{const k=p===R.id,A=b.has(R.id),B=(R.blocked??!1)||!R.interactive,T=R.detail??R.blockedReason,G=Vy("group relative flex min-w-[150px] flex-1 flex-col gap-2 rounded-[20px] border border-white/10 px-5 py-4 text-left transition-all duration-200 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70 focus-visible:ring-offset-0","bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.22),rgba(14,25,45,0.6))] shadow-[0_18px_42px_rgba(8,25,53,0.55)]",R.accent==="primary"&&"border-sky-300/40 bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.32),rgba(11,22,45,0.7))]",R.accent==="danger"&&"border-rose-400/45 bg-[radial-gradient(circle_at_top,rgba(244,114,182,0.32),rgba(45,9,25,0.75))]",k&&"ring-2 ring-sky-300/80 ring-offset-0 translate-y-[-2px] shadow-[0_24px_48px_rgba(56,189,248,0.45)]",A&&'animate-hud-shake after:pointer-events-none after:absolute after:inset-0 after:rounded-[inherit] after:border after:border-rose-300/45 after:bg-[radial-gradient(circle_at_center,rgba(248,113,113,0.18),rgba(248,113,113,0))] after:content-[""] after:animate-hud-pulse',!B&&!k&&"hover:-translate-y-1 hover:shadow-[0_24px_50px_rgba(56,189,248,0.4)]",B&&"cursor-not-allowed opacity-70",R.toggled&&"border-sky-400/60 shadow-[0_0_36px_rgba(56,189,248,0.45)]");return Zt.jsxs("button",{type:"button",className:G,"aria-pressed":R.toggled?"true":void 0,"aria-disabled":B?"true":void 0,"data-hotkey":R.hotkey.label,onClick:J=>{if(B){J.preventDefault(),_(R.id);return}Y(R)},onKeyDown:J=>{(J.key==="Enter"||J.key===" ")&&(J.preventDefault(),Y(R))},title:Vy(R.description,R.blockedReason),children:[Zt.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Zt.jsxs("span",{className:"flex items-center gap-3 text-base font-semibold uppercase tracking-[0.18em] text-slate-100",children:[Zt.jsx("span",{"aria-hidden":"true",className:"text-2xl",children:R.icon}),R.label]}),Zt.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-slate-300/80",children:R.hotkey.label})]}),Zt.jsx("p",{className:"text-sm leading-relaxed text-slate-200/80",children:R.description}),Zt.jsxs("div",{className:"flex items-center justify-between text-xs font-medium uppercase tracking-[0.28em] text-slate-300/70",children:[Zt.jsx("span",{children:T??""}),R.cost?Zt.jsx("span",{className:"text-slate-200/90",children:R.cost}):Zt.jsx("span",{className:"opacity-0",children:"cost"})]})]},R.id)})})})})}function gx(n,a,s={}){const r=mr(a),l=a.ownerDocument.createElement("div");l.dataset.component="action-bar",l.className="flex w-full justify-center";const u=r.regions.bottom,f=u.querySelector("#build-id");f?u.insertBefore(l,f):u.appendChild(l);const h=Y3.createRoot(l);return h.render(Zt.jsx(px,{state:n,abilities:s})),{destroy(){h.unmount(),l.remove()}}}const yx="(max-width: 820px)",Ob="is-mobile",qb="is-desktop";let Un=null,Yc=null,ea=!1,yc=0;const Fc=new Set,xh=new Set,$c=n=>{for(const a of xh)a.classList.toggle(Ob,n),a.classList.toggle(qb,!n),a.dataset.viewport=n?"mobile":"desktop"},bx=n=>{if(ea!==n){ea=n,$c(ea);for(const a of Array.from(Fc))try{a(ea)}catch(s){console.error("Failed to notify mobile listener",s)}}},zb=()=>{if(Un||typeof window>"u")return;Un=window.matchMedia(yx),ea=Un.matches,$c(ea);const n=a=>{bx(a.matches)};typeof Un.addEventListener=="function"?(Un.addEventListener("change",n),Yc=()=>Un?.removeEventListener("change",n)):(Un.addListener(n),Yc=()=>Un?.removeListener(n))},vx=()=>{Un&&(Yc?.(),Yc=null,Un=null)},Bb=(n,{immediate:a=!0}={})=>(zb(),Fc.add(n),a&&n(ea),()=>{Fc.delete(n)}),Sx=({root:n,onChange:a,immediate:s=!0}={})=>{zb();const r=n??(typeof document<"u"?document.documentElement:null);r&&(xh.add(r),$c(ea)),yc+=1;let l=null;return a?l=Bb(a,{immediate:s}):s&&Un&&$c(ea),{matches:()=>ea,dispose:()=>{r&&(xh.delete(r),r.classList.remove(Ob,qb),(r.dataset.viewport==="mobile"||r.dataset.viewport==="desktop")&&delete r.dataset.viewport),l&&(l(),l=null),yc=Math.max(0,yc-1),yc===0&&Fc.size===0&&vx()}}};function Ex(n){const a=[n.name];return n.description&&a.push(n.description),n.rarity&&a.push(`Rarity: ${n.rarity}`),n.quantity>1&&a.push(`Quantity: ${n.quantity}`),a.join("  ")}function Mx(n){const a=document.createElement("span");a.classList.add("item-icon__fallback");const s=n.trim();return a.textContent=s?s[0]?.toUpperCase()??"?":"?",a.setAttribute("aria-hidden","true"),a}function xx(n,a){const s=document.createElement("img");return s.src=n,s.alt="",s.decoding="async",s.loading="lazy",s.classList.add("item-icon__image"),s.setAttribute("aria-hidden","true"),s.title=a,s}function wx(n){const a=document.createElement("li");a.classList.add("item-icon"),a.dataset.itemId=n.id;const s=Ex(n);if(a.title=s,a.setAttribute("aria-label",s),a.setAttribute("role","listitem"),n.rarity&&(a.dataset.rarity=n.rarity.toLowerCase()),n.icon&&n.icon.trim().length>0?a.appendChild(xx(n.icon,n.name)):a.appendChild(Mx(n.name)),n.quantity>1){const r=document.createElement("span");r.classList.add("item-icon__quantity"),r.textContent=`${n.quantity}`,r.setAttribute("aria-hidden","true"),a.appendChild(r)}return a}const Ax=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function wh(n){return n===1/0?"":!Number.isFinite(n)||n<=0?"0s":`${Ax.format(Math.ceil(n))}s`}function Cx(n){const a=[n.name];return n.description&&a.push(n.description),n.source&&a.push(`Source: ${n.source}`),n.duration!==1/0&&a.push(`Duration: ${wh(n.duration)}`),a.push(`Remaining: ${wh(n.remaining)}`),n.stacks&&n.stacks>1&&a.push(`Stacks: ${n.stacks}`),a.join("  ")}function Tx(n){const a=document.createElement("li");a.classList.add("mod-pill"),a.dataset.modifierId=n.id,a.title=Cx(n),a.setAttribute("aria-label",a.title),a.setAttribute("role","listitem"),a.dataset.duration=n.duration===1/0?"infinite":String(n.duration),a.dataset.remaining=n.remaining===1/0?"infinite":String(n.remaining),n.appliedAt!==void 0&&(a.dataset.appliedAt=String(n.appliedAt)),n.stacks&&n.stacks>1&&(a.dataset.stacks=String(n.stacks));const s=document.createElement("span");if(s.classList.add("mod-pill__name"),s.textContent=n.name,s.setAttribute("aria-hidden","true"),a.appendChild(s),n.stacks&&n.stacks>1){const l=document.createElement("span");l.classList.add("mod-pill__stacks"),l.textContent=`${n.stacks}`,l.setAttribute("aria-hidden","true"),a.appendChild(l)}const r=document.createElement("span");return r.classList.add("mod-pill__timer"),r.textContent=wh(n.remaining),r.setAttribute("aria-hidden","true"),a.appendChild(r),n.remaining!==1/0&&n.remaining<=5&&(a.dataset.urgent="true"),a}const Ah={engaged:"Engaged on the field",reserve:"On reserve duty",downed:"Recovering from battle"},Xe=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Qy="panel-roster-title";function _x(n){return n.length===0?"No defining traits yet":n.join("  ")}function Hb(n){return Number.isFinite(n)?Math.max(0,Math.min(100,Math.round(n*100))):0}function Rx(n){const a=Xe;if(n.xpForNext===null)return`${a.format(n.xp)} XP  Max level`;const s=Hb(n.progress);return`${a.format(n.xpIntoLevel)} / ${a.format(n.xpForNext)} XP  ${s}%`}function jb(n){const a=[],s=(r,l)=>{l>0&&a.push(`+${Xe.format(l)} ${r}`)};return s("Vigor",n.vigor),s("Focus",n.focus),s("Resolve",n.resolve),a.length===0?"No level bonuses yet":a.join("  ")}function Ks(n,a){const r=Math.round(n-(typeof a=="number"?a:0));if(r===0)return"";const l=Xe.format(Math.abs(r));return r>0?` (+${l})`:` (-${l})`}function Nx(n){if(!n)return"No stat changes";const a=[],s=(r,l)=>{if(typeof l=="number"&&l!==0){const u=l>0?"+":"";a.push(`${r} ${u}${Xe.format(Math.abs(l))}`)}};return s("HP",n.health),s("ATK",n.attackDamage),s("RNG",n.attackRange),s("MOV",n.movementRange),s("DEF",n.defense),s("Shield",n.shield),a.length===0?"No stat changes":a.join(", ")}function kx(n){const{stats:a,baseStats:s}=n,r=[`HP ${Xe.format(a.health)}/${Xe.format(a.maxHealth)}${Ks(a.maxHealth,s.maxHealth)}`];return a.shield&&a.shield>0&&r.push(`Shield ${Xe.format(a.shield)}${Ks(a.shield,s.shield)}`),r.push(`ATK ${Xe.format(a.attackDamage)}${Ks(a.attackDamage,s.attackDamage)}`),r.push(`RNG ${Xe.format(a.attackRange)}${Ks(a.attackRange,s.attackRange)}`),a.defense&&a.defense>0&&r.push(`DEF ${Xe.format(a.defense)}${Ks(a.defense,s.defense)}`),r.push(`MOV ${Xe.format(a.movementRange)}${Ks(a.movementRange,s.movementRange)}`),r.push(`Upkeep ${Xe.format(n.upkeep)} beer`),r.join("  ")}function Dx(n){const{stats:a}=n,s=[n.name,Ah[n.status]];s.push(`level ${n.progression.level}`),s.push(`health ${Xe.format(a.health)} of ${Xe.format(a.maxHealth)}`),a.shield&&a.shield>0&&s.push(`shield ${Xe.format(a.shield)}`),s.push(`attack ${Xe.format(a.attackDamage)}`),a.defense&&a.defense>0&&s.push(`defense ${Xe.format(a.defense)}`),a.attackRange>0&&s.push(`attack range ${Xe.format(a.attackRange)}`),s.push(`movement ${Xe.format(a.movementRange)}`),s.push(`upkeep ${Xe.format(n.upkeep)} beer`),n.progression.xpForNext===null?s.push(`${Xe.format(n.progression.xp)} total experience`):s.push(`${Xe.format(n.progression.xpIntoLevel)} of ${Xe.format(n.progression.xpForNext)} experience toward next level`);const r=jb(n.progression.statBonuses);r&&s.push(`level bonuses ${r}`);const l=n.equipment.filter(u=>u.item).length;return l>0&&s.push(`${l} equipped item${l===1?"":"s"}`),n.modifiers.length>0&&s.push(`${n.modifiers.length} active modifier${n.modifiers.length===1?"":"s"}`),s.join(", ")}function Lx(n,a){const s=a.filter(h=>h.status==="engaged").length,r=a.filter(h=>h.status==="reserve").length,l=a.filter(h=>h.status==="downed").length,u=(h,p,m)=>{const g=document.createElement("span");return g.classList.add("panel-roster__metric"),g.dataset.status=m,g.textContent=`${Xe.format(p)} ${h}`,g.setAttribute("aria-label",g.textContent),g},f=document.createElement("div");f.classList.add("panel-roster__metrics"),f.append(u("engaged",s,"engaged"),u("reserve",r,"reserve"),u("downed",l,"downed")),n.appendChild(f)}function Ux(n,a,s){const r=document.createElement("div");r.classList.add("panel-roster__loadout");const l=document.createElement("ul");l.classList.add("panel-roster__slots"),l.setAttribute("role","list"),l.setAttribute("aria-label",`${a.name} equipment slots`);for(const u of a.equipment){const f=document.createElement("li");f.classList.add("panel-roster__slot"),f.dataset.slot=u.id;const h=document.createElement("div");h.classList.add("panel-roster__slot-header");const p=document.createElement("span");p.classList.add("panel-roster__slot-label"),p.textContent=u.label,p.title=u.description,h.appendChild(p);const m=document.createElement("span");if(m.classList.add("panel-roster__slot-summary"),m.textContent=u.item?u.item.name:"Empty",m.title=u.description,h.appendChild(m),f.appendChild(h),u.item){const M=document.createElement("ul");M.classList.add("panel-roster__slot-icons"),M.setAttribute("role","list"),M.appendChild(wx(u.item)),f.appendChild(M)}const g=document.createElement("span");g.classList.add("panel-roster__slot-modifiers"),g.textContent=Nx(u.modifiers),g.title=g.textContent,f.appendChild(g);const b=document.createElement("div");b.classList.add("panel-roster__slot-actions");const S=document.createElement("button");S.type="button",S.classList.add("panel-roster__slot-action"),S.textContent=u.item?"Replace":"Equip",S.setAttribute("aria-label",`Equip ${u.label} for ${a.name}`),S.addEventListener("click",M=>{M.stopPropagation(),s.onEquipSlot?.(a.id,u.id)}),b.appendChild(S);const E=document.createElement("button");E.type="button",E.classList.add("panel-roster__slot-action"),E.textContent="Unequip",E.disabled=u.item===null,E.setAttribute("aria-label",`Unequip ${u.label} from ${a.name}`),E.addEventListener("click",M=>{M.stopPropagation(),E.disabled||s.onUnequipSlot?.(a.id,u.id)}),b.appendChild(E),f.appendChild(b),l.appendChild(f)}if(r.appendChild(l),a.modifiers.length>0){const u=document.createElement("ul");u.classList.add("panel-roster__mods"),u.setAttribute("role","list"),u.setAttribute("aria-label",`${a.name} active modifiers`),u.title=a.modifiers.map(f=>f.name).join(", ");for(const f of a.modifiers)u.appendChild(Tx(f));r.appendChild(u)}n.appendChild(r)}function Ox(n,a={}){return{render:r=>{n.innerHTML="",n.dataset.count=String(r.length),n.classList.add("panel-roster");const l=document.createElement("div");l.classList.add("panel-roster__header");const u=document.createElement("h4");u.classList.add("panel-roster__title"),u.textContent="Battalion Roster",u.id=Qy,l.appendChild(u),n.setAttribute("aria-labelledby",Qy);const f=r.length===0?"No attendants mustered yet":`${Xe.format(r.length)} attendant${r.length===1?"":"s"} enlisted`,h=document.createElement("span");if(h.classList.add("panel-roster__count"),h.textContent=f,l.appendChild(h),n.appendChild(l),r.length===0){const m=document.createElement("p");m.classList.add("panel-roster__empty"),m.textContent="No attendants have rallied to the sauna yet.",n.appendChild(m);return}Lx(n,r);const p=document.createElement("ul");p.classList.add("panel-roster__list"),p.setAttribute("role","list");for(const m of r){const g=document.createElement("li");g.classList.add("panel-roster__row");const b=document.createElement("button");b.type="button",b.classList.add("panel-roster__item"),b.dataset.unitId=m.id,b.dataset.status=m.status,b.setAttribute("aria-pressed",m.selected?"true":"false"),b.setAttribute("aria-label",Dx(m)),b.title=`${m.name}  ${Ah[m.status]}`,m.selected&&b.classList.add("is-selected"),m.status==="downed"&&b.classList.add("is-downed");const S=document.createElement("div");S.classList.add("panel-roster__name-row");const E=document.createElement("div");E.classList.add("panel-roster__identity");const M=document.createElement("span");M.classList.add("panel-roster__level"),M.dataset.level=String(m.progression.level),M.style.setProperty("--level-progress","0%");const N=Hb(m.progression.progress);M.style.setProperty("--level-progress",`${N}%`),M.setAttribute("role","img");const _=m.progression.xpForNext===null?`Level ${m.progression.level}, at mastery`:`Level ${m.progression.level}, ${N}% toward next level`;M.setAttribute("aria-label",_);const U=document.createElement("span");U.classList.add("panel-roster__level-value"),U.textContent=String(m.progression.level),M.appendChild(U);const H=document.createElement("span");H.classList.add("panel-roster__name"),H.textContent=m.name,H.title=m.name,E.append(M,H),S.appendChild(E);const I=document.createElement("span");I.classList.add("panel-roster__status"),I.dataset.status=m.status,I.textContent=Ah[m.status],S.appendChild(I);const $=document.createElement("div");$.classList.add("panel-roster__meta");const P=kx(m);$.textContent=P,$.title=P;const ie=document.createElement("div");ie.classList.add("panel-roster__xp");const se=Rx(m.progression);ie.textContent=se,ie.title=se;const oe=document.createElement("div");oe.classList.add("panel-roster__callouts");const ee=jb(m.progression.statBonuses);oe.textContent=ee,oe.title=ee;const Y=document.createElement("div");Y.classList.add("panel-roster__health");const R=document.createElement("div");R.classList.add("panel-roster__health-fill");const k=m.stats.maxHealth>0?Math.max(0,Math.min(100,Math.round(m.stats.health/m.stats.maxHealth*100))):0;R.style.width=`${k}%`,R.dataset.percent=`${k}`,Y.appendChild(R);const A=document.createElement("div");A.classList.add("panel-roster__traits");const F=_x(m.traits);A.textContent=F,A.title=F,b.append(S,ie,$,oe,Y,A),Ux(b,m,a),typeof a.onSelect=="function"&&b.addEventListener("click",()=>a.onSelect?.(m.id)),g.appendChild(b),p.appendChild(g)}n.appendChild(p)}}}const qx=150,zx="autobattles:log-history:v2",Ib="autobattles:log-preferences:v1",am=typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:null;let Py=0;const Zy=()=>(Py+=1,`${Date.now().toString(36)}-${Py.toString(36)}`),wo=n=>{if(Array.isArray(n))return n.map(a=>typeof a=="string"?a.trim():"").filter(a=>a.length>0);if(typeof n=="string"){const a=n.trim();return a?[a]:[]}return[]},Yf=n=>n?typeof n!="object"?{}:{...n}:{},Bx=n=>{if(!n)return null;if(typeof n.unitId=="string"&&n.unitId.trim().length>0)return n.unitId.trim();const a=wo(n.unitIds);return a.length>0?a[a.length-1]:null},Hx=(n,a)=>{const s=wo(n.unitIds??n.unitId),r=wo(a.unitIds??a.unitId),l=Array.from(new Set([...s,...r])),u=wo(n.unitNames??n.unitName),f=wo(a.unitNames??a.unitName),h=Array.from(new Set([...u,...f])),p=typeof a.steward=="string"?a.steward:n.steward,m={...n,...a,unitIds:l,unitNames:h};return typeof p=="string"&&(m.steward=p),h.length>0&&(m.unitName=h[h.length-1]),l.length>0&&(m.unitId=l[l.length-1]),m};class jx{history=[];listeners=new Set;storage;storageKey;maxEntries;constructor(a={}){this.storage=a.storage??am,this.storageKey=a.storageKey??zx,this.maxEntries=Math.max(1,a.maxEntries??qx),this.hydrate()}hydrate(){if(this.storage)try{const a=this.storage.getItem(this.storageKey);if(!a)return;const s=JSON.parse(a);if(!Array.isArray(s))return;const r=[];for(const l of s){if(!l||typeof l!="object")continue;const u=l;if(typeof u.type!="string"||typeof u.message!="string")continue;const f={id:typeof u.id=="string"?u.id:Zy(),type:u.type,message:u.message,metadata:Yf(u.metadata),timestamp:typeof u.timestamp=="number"&&Number.isFinite(u.timestamp)?u.timestamp:Date.now(),occurrences:typeof u.occurrences=="number"&&u.occurrences>0?Math.floor(u.occurrences):1};r.push(f)}r.length>0&&(r.length>this.maxEntries?this.history=r.slice(-this.maxEntries):this.history=r)}catch{this.history=[]}}persist(){if(this.storage)try{const a=JSON.stringify(this.history.map(s=>({id:s.id,type:s.type,message:s.message,metadata:s.metadata,timestamp:s.timestamp,occurrences:s.occurrences})));this.storage.setItem(this.storageKey,a)}catch{}}getHistory(){return this.history.map(a=>({...a,metadata:Yf(a.metadata)}))}subscribe(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}clear(){if(this.history.length===0)return;const a=this.history.slice();this.history=[],this.persist(),this.emitChange({kind:"remove",entries:a})}emit(a){const s=Yf(a.metadata),r={id:Zy(),type:a.type,message:a.message,metadata:s,timestamp:Date.now(),occurrences:1},l=this.tryAggregate(r);if(l)return this.history[l.index]=l.entry,this.persist(),this.emitChange({kind:"update",entry:l.entry,index:l.index}),l.entry;this.history.push(r);const u=[];for(;this.history.length>this.maxEntries;){const h=this.history.shift();h&&u.push(h)}this.persist(),u.length>0&&this.emitChange({kind:"remove",entries:u});const f=this.history.length-1;return this.emitChange({kind:"append",entry:r,index:f}),r}tryAggregate(a){if(a.type!=="spawn"||!Bx(a.metadata)||this.history.length===0)return null;const r=this.history.length-1,l=this.history[r];return l.type!=="spawn"?null:{entry:{...l,id:l.id,message:a.message,metadata:Hx(l.metadata??{},a.metadata??{}),timestamp:a.timestamp,occurrences:l.occurrences+a.occurrences},index:r}}emitChange(a){for(const s of this.listeners)try{s(a)}catch(r){console.warn("Failed to handle log change",r)}}}const im=new jx,qt=n=>im.emit(n),Ix=n=>im.subscribe(n),Gx=()=>im.getHistory(),Ro={combat:{label:"Combat",accent:"var(--color-accent-red)"},spawn:{label:"Reinforcements",accent:"var(--color-accent-green)"},loot:{label:"Loot",accent:"var(--color-accent-gold)"},progression:{label:"Progression",accent:"var(--color-accent-blue)"},ability:{label:"Abilities",accent:"var(--color-accent-purple)"},resource:{label:"Economy",accent:"var(--color-accent-cyan)"},policy:{label:"Policies",accent:"var(--color-accent-orange)"},event:{label:"Events",accent:"var(--color-accent-pink)"},system:{label:"Systems",accent:"var(--color-muted)"}},Jy=["combat","spawn","loot","progression","ability","resource","policy","event","system"],bc={mutedTypes:[]},Yx=(n=am)=>{if(!n)return{...bc};try{const a=n.getItem(Ib);if(!a)return{...bc};const s=JSON.parse(a);if(!s||typeof s!="object")return{...bc};const r=Array.isArray(s.mutedTypes)?s.mutedTypes.filter(l=>typeof l=="string"&&l in Ro):[];return{mutedTypes:Array.from(new Set(r))}}catch{return{...bc}}},Fx=(n,a=am)=>{if(a)try{const s=Array.isArray(n.mutedTypes)?n.mutedTypes.filter(r=>r in Ro):[];a.setItem(Ib,JSON.stringify({mutedTypes:Array.from(new Set(s))}))}catch{}},Ff=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function $x(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{log:()=>{},addEvent:()=>{},renderRoster:()=>{},dispose:()=>{}};const{regions:r,mobileBar:l}=mr(s),u=r.top,f=r.right,h=s.querySelector("#right-panel");h&&h.remove();const p=s.querySelector(".right-panel-slide");p&&p.remove();const m=s.querySelector("#right-panel-toggle");m&&m.remove();const g=document.createElement("div");g.id="right-panel",g.classList.add("hud-card"),g.setAttribute("role","complementary"),g.setAttribute("aria-label","Sauna command console"),g.tabIndex=-1;const b=document.createElement("div");b.className="right-panel-slide",b.setAttribute("aria-hidden","true");const S=document.createElement("div");S.className="right-panel-slide__backdrop",S.setAttribute("aria-hidden","true");const E=document.createElement("div");E.className="right-panel-slide__sheet",E.appendChild(g),b.append(S,E);const M=window.matchMedia("(max-width: 1040px)"),N=[],_=document.createElement("button");_.type="button",_.id="right-panel-toggle",_.classList.add("hud-panel-toggle"),_.setAttribute("aria-controls",g.id);const U=document.createElement("span");U.classList.add("hud-panel-toggle__icon"),U.setAttribute("aria-hidden","true");const H=document.createElement("span");H.classList.add("hud-panel-toggle__icon-bars"),U.appendChild(H);const I=document.createElement("span");I.classList.add("hud-panel-toggle__text");const $=document.createElement("span");$.classList.add("hud-panel-toggle__title"),$.textContent="Command Console";const P=document.createElement("span");P.classList.add("hud-panel-toggle__state"),I.append($,P),_.append(U,I);const ie=()=>{const D=u.querySelector("#topbar");D&&D.parentElement===u?D.insertAdjacentElement("afterend",_):u.prepend(_)};let se=!1,oe=!1,ee=!1,Y=!1;const R="is-mobile-panel-open",k=()=>{ee?P.textContent=Y?"Close":"Menu":P.textContent=se?"Open":"Close"},A=()=>{if(ee){_.setAttribute("aria-expanded",Y?"true":"false");const D=Y?"Close command console panel":"Open command console panel";_.setAttribute("aria-label",D),_.title=Y?"Close the sauna command console overlay":"Open the sauna command console overlay"}else{_.setAttribute("aria-expanded",se?"false":"true");const D=se?"Open command console panel":"Close command console panel";_.setAttribute("aria-label",D),_.title=se?"Open the sauna command console overlay":"Close the sauna command console overlay"}},F=()=>{k(),A()},B=(D,X=M.matches)=>{if(ee)return;const re=se;X&&(oe=D);const de=D&&X;se=de,g.classList.toggle("right-panel--collapsed",de),g.setAttribute("aria-hidden",de?"true":"false"),F(),re&&!de&&X&&g.focus({preventScroll:!0})},T=D=>{!ee||!Y||D.key==="Escape"&&(D.preventDefault(),V())};let G=!1;const J=()=>{G||(document.addEventListener("keydown",T),G=!0)},fe=()=>{G&&(document.removeEventListener("keydown",T),G=!1)},x=()=>{!ee||Y||(Y=!0,b.classList.add("right-panel-slide--open"),b.setAttribute("aria-hidden","false"),g.setAttribute("aria-hidden","false"),document.body.classList.add(R),b.style.setProperty("--panel-drag-progress","1"),F(),J(),requestAnimationFrame(()=>{g.focus({preventScroll:!0})}))},V=({skipFocus:D=!1}={})=>{!ee||!Y||(Ae(),Y=!1,b.classList.remove("right-panel-slide--open"),b.setAttribute("aria-hidden","true"),g.setAttribute("aria-hidden","true"),document.body.classList.remove(R),b.style.setProperty("--panel-drag-progress","0"),F(),fe(),D||_.focus({preventScroll:!0}))},te=D=>{if(ee)return;const X=D.matches;_.hidden=!X,B(X?oe:!1,X)};typeof M.addEventListener=="function"?(M.addEventListener("change",te),N.push(()=>M.removeEventListener("change",te))):(M.addListener(te),N.push(()=>M.removeListener(te)));const W=()=>{if(ee){Y?V():x();return}B(!se)};_.addEventListener("click",W),N.push(()=>_.removeEventListener("click",W));const le=()=>{V()};S.addEventListener("click",le),N.push(()=>S.removeEventListener("click",le));let pe=null,he=0,Ge=0;const Ae=()=>{pe!==null&&(E.releasePointerCapture(pe),pe=null),E.style.transition="",E.style.transform="",b.style.setProperty("--panel-drag-progress",Y?"1":"0")},Ct=D=>{!ee||!Y||D.pointerType==="mouse"&&D.button!==0||(pe=D.pointerId,he=D.clientX,Ge=0,E.style.transition="none",E.setPointerCapture(D.pointerId))},Wt=D=>{if(!ee||D.pointerId!==pe||!Y)return;Ge=Math.max(0,D.clientX-he);const X=E.offsetWidth||1,re=Math.min(Ge,X);E.style.transform=`translateX(${re}px)`,b.style.setProperty("--panel-drag-progress",String(1-re/X))},wn=D=>{Ae(),D&&V()},en=D=>{if(D.pointerId!==pe)return;const X=E.offsetWidth||1,re=Ge>X*.35;wn(re)},Yt=()=>{wn(!1)};E.addEventListener("pointerdown",Ct),E.addEventListener("pointermove",Wt),E.addEventListener("pointerup",en),E.addEventListener("pointercancel",Yt),N.push(()=>{E.removeEventListener("pointerdown",Ct),E.removeEventListener("pointermove",Wt),E.removeEventListener("pointerup",en),E.removeEventListener("pointercancel",Yt)});const Ft=Bb(D=>{ee=D,ee?(E.appendChild(g),b.isConnected||s.appendChild(b),l.appendChild(_),_.classList.add("hud-panel-toggle--mobile"),_.hidden=!1,Y||(g.setAttribute("aria-hidden","true"),b.setAttribute("aria-hidden","true"),b.style.setProperty("--panel-drag-progress","0"))):(V({skipFocus:!0}),b.style.setProperty("--panel-drag-progress","1"),b.remove(),f.appendChild(g),ie(),_.classList.remove("hud-panel-toggle--mobile"),_.hidden=!M.matches,g.setAttribute("aria-hidden","false"),B(oe,M.matches)),F()});N.push(Ft);const ca=document.createElement("div");ca.classList.add("panel-tabs"),g.appendChild(ca);const ua=document.createElement("div");ua.classList.add("panel-content"),g.appendChild(ua);const lt=document.createElement("div");lt.id="right-panel-roster",lt.setAttribute("role","region"),lt.setAttribute("aria-live","polite"),lt.setAttribute("aria-label","Battalion roster");const da=document.createElement("div");da.id="right-panel-policies";const An=document.createElement("div");An.id="right-panel-events";const mn=document.createElement("div");mn.id="right-panel-log",mn.setAttribute("role","region"),mn.setAttribute("aria-label","Combat log");const $t=document.createElement("section");$t.className="panel-log";const Ka=document.createElement("header");Ka.className="panel-log__header";const Cn=document.createElement("h3");Cn.className="panel-log__title",Cn.textContent="Combat Log";const Gn=document.createElement("span");Gn.className="panel-log__total",Gn.textContent="0 entries",Ka.append(Cn,Gn);const Tn=document.createElement("div");Tn.className="panel-log__filters";const Ue=document.createElement("div");Ue.id="event-log",Ue.className="panel-log__feed",Ue.setAttribute("role","log"),Ue.setAttribute("aria-live","polite"),$t.append(Ka,Tn,Ue),mn.appendChild($t);const Ze={Roster:lt,Policies:da,Events:An,Log:mn},{onRosterSelect:tn,onRosterRendererReady:ft,onRosterEquipSlot:us,onRosterUnequipSlot:pr}=a;for(const[D,X]of Object.entries(Ze))X.classList.add("panel-section","panel-section--scroll"),X.dataset.tab=D,X.hidden=!0;mn.classList.add("panel-section--log");function ds(D){for(const[X,re]of Object.entries(Ze))re.hidden=X!==D;for(const X of Array.from(ca.children)){const re=X,de=re.textContent===D;re.disabled=de,re.setAttribute("aria-pressed",de?"true":"false")}}for(const D of Object.keys(Ze)){const X=document.createElement("button");X.type="button",X.textContent=D;const re=Ze[D];re?.id&&X.setAttribute("aria-controls",re.id),X.setAttribute("aria-pressed","false");const de=()=>ds(D);X.addEventListener("click",de),N.push(()=>X.removeEventListener("click",de)),ca.appendChild(X),ua.appendChild(Ze[D])}const Ri=Ox(lt,{onSelect:tn,onEquipSlot:us,onUnequipSlot:pr}),fa=D=>{Ri.render(D)};fa([]),typeof ft=="function"&&ft(fa);const _n={[ae.SAUNA_BEER]:"Sauna Beer Bottles",[ae.SAUNAKUNNIA]:"Saunakunnia",[ae.SISU]:"Sisu"},ce=Y2(),ve=new Map;function Se(D){const X=document.createElement("span");return X.className="policy-card__badge",X.textContent=D,X}function Re(D){const X=document.createElement("article");X.className="policy-card",X.style.setProperty("--policy-gradient",D.visuals.gradient),X.style.setProperty("--policy-accent",D.visuals.accentColor);const re=document.createElement("div");re.className="policy-card__header";const de=document.createElement("div");de.className="policy-card__icon-frame";const Ne=document.createElement("img");Ne.className="policy-card__icon",Ne.src=D.visuals.icon,Ne.alt=`${D.name} icon`,de.appendChild(Ne);const Ye=document.createElement("div");Ye.className="policy-card__heading";const _e=document.createElement("h4");if(_e.className="policy-card__title",_e.textContent=D.name,Ye.appendChild(_e),D.visuals.badges?.length){const $n=document.createElement("div");$n.className="policy-card__badges",D.visuals.badges.forEach(Jo=>$n.appendChild(Se(Jo))),Ye.appendChild($n)}const et=document.createElement("span");et.className="policy-card__state",et.textContent="Ready",re.append(de,Ye,et);const nn=document.createElement("p");nn.className="policy-card__description",nn.textContent=D.description;const Mt=D.visuals.flair?(()=>{const $n=document.createElement("p");return $n.className="policy-card__flair",$n.textContent=D.visuals.flair??"",$n})():null,an=document.createElement("div");an.className="policy-card__actions";const sn=document.createElement("span");sn.className="policy-card__cost";const Ui=document.createElement("span");Ui.className="policy-card__cost-label",Ui.textContent="Cost";const pt=document.createElement("span");pt.className="policy-card__cost-value",pt.textContent=`${Ff.format(D.cost)} ${_n[D.resource]}`,sn.append(Ui,pt);const tt=document.createElement("button");tt.type="button",tt.className="policy-card__action",tt.textContent="Enact Policy";const Ja=document.createElement("p");Ja.className="policy-card__status";const Wa=document.createElement("ul");Wa.className="policy-card__requirements",Wa.hidden=!0,an.append(sn,tt);const Ma=()=>{n.applyPolicy(D.id)&&ht(D)};return tt.addEventListener("click",Ma),N.push(()=>tt.removeEventListener("click",Ma)),X.append(re,nn),Mt&&X.appendChild(Mt),X.append(an,Ja,Wa),ve.set(D.id,{card:X,action:tt,stateBadge:et,statusCopy:Ja,requirements:Wa,costChip:sn}),X}function Et(){da.innerHTML="",ve.clear();const D=document.createElement("div");D.className="policy-grid",ce.forEach(X=>{const re=Re(X);D.appendChild(re)}),da.appendChild(D),Tt()}function ht(D){const X=ve.get(D.id);if(!X)return;const re=n.hasPolicy(D.id),de=D.prerequisites.filter(Mt=>!Mt.isSatisfied(n)),Ne=n.canAfford(D.cost,D.resource);X.action.disabled=re||de.length>0||!Ne,X.action.textContent=re?"Enacted":"Enact Policy";let Ye="ready",_e="Ready",et=D.spotlight??"All signals point to go.";X.requirements.innerHTML="",X.requirements.hidden=!0,re?(Ye="applied",_e="Enacted",et=D.visuals.flair??"Policy active."):de.length>0?(Ye="locked",_e="Locked",et="Awaiting requirements:",X.requirements.hidden=!1,de.forEach(Mt=>{const an=document.createElement("li");an.textContent=Mt.description,X.requirements.appendChild(an)})):Ne||(Ye="budget",_e="Needs Resources",et=`Earn ${Ff.format(D.cost)} ${_n[D.resource]} to enact this edict.`),X.card.dataset.status=Ye,X.stateBadge.textContent=_e,X.statusCopy.textContent=et;const nn=!re&&de.length===0&&!Ne;X.costChip.classList.toggle("policy-card__cost--warning",nn)}function Tt(){ce.forEach(D=>ht(D))}Et();const ha=D=>Tt(),ma=D=>Tt(),pa=D=>Tt();ne.on("resourceChanged",ha),ne.on(Gt.APPLIED,ma),ne.on(Gt.REJECTED,pa),N.push(()=>{ne.off("resourceChanged",ha),ne.off(Gt.APPLIED,ma),ne.off(Gt.REJECTED,pa)});function ga(D,X){const re=document.createElement("button");re.type="button",re.classList.add("event-card__choice"),X.accent&&re.classList.add(`event-card__choice--${X.accent}`),re.dataset.choiceId=X.id;const de=document.createElement("span");if(de.className="event-card__choice-label",de.textContent=X.label,re.appendChild(de),X.description){const Ne=document.createElement("span");Ne.className="event-card__choice-detail",Ne.textContent=X.description,re.appendChild(Ne)}return re.addEventListener("click",()=>{if(!re.isConnected)return;re.disabled=!0,Nc.resolve(D.id,X.id)||(re.disabled=!1)}),re}function ya(D){if(An.innerHTML="",D.length===0){const re=document.createElement("div");re.className="event-card event-card--empty";const de=document.createElement("p");de.className="event-card__empty",de.textContent="All clear. Command will notify you when new briefings arrive.",re.appendChild(de),An.appendChild(re);return}const X=document.createDocumentFragment();for(const re of D){const de=document.createElement("article");de.className="event-card",de.dataset.eventId=re.id,de.style.setProperty("--event-accent",re.accentColor??"var(--color-accent)");const Ne=(re.typography??"sans").toLowerCase();de.classList.add(`event-card--${["serif","mono"].includes(Ne)?Ne:"sans"}`);const Ye=(re.animation??"").toLowerCase();["aurora","pulse","tilt"].includes(Ye)&&de.classList.add(`event-card--${Ye}`);const _e=document.createElement("div");if(_e.className="event-card__frame",re.art){const tt=document.createElement("div");tt.className="event-card__media",tt.style.backgroundImage=`url(${re.art})`,_e.appendChild(tt)}const et=document.createElement("div");et.className="event-card__body";const nn=document.createElement("span");nn.className="event-card__badge",nn.textContent="Priority Dispatch",et.appendChild(nn);const Mt=document.createElement("h4");Mt.className="event-card__headline",Mt.textContent=re.headline,et.appendChild(Mt);const an=document.createElement("p");an.className="event-card__copy",an.textContent=re.body,et.appendChild(an);const sn=document.createElement("div");sn.className="event-card__choices";const Ui=re.choices&&re.choices.length>0?re.choices:[{id:"acknowledge",label:re.acknowledgeText??"Acknowledge"}];for(const tt of Ui){const Ja=ga(re,{id:tt.id,label:tt.label,description:tt.description,event:tt.event,payload:tt.payload,accent:tt.accent});sn.appendChild(Ja)}et.appendChild(sn),_e.appendChild(et);const pt=document.createElement("span");pt.className="event-card__shimmer",de.append(_e,pt),X.appendChild(de)}An.appendChild(X)}const Fo=Nc.subscribe(ya);N.push(Fo);const $o=({event:D})=>{qt({type:"event",message:`Event  ${D.headline}`,metadata:{eventId:D?.id??D.headline,headline:D.headline}})};ne.on(zc.TRIGGERED,$o),N.push(()=>{ne.off(zc.TRIGGERED,$o)});function Yn(D){Nc.publish(D)}const Je=new Map,mt=new Map,ba=new Map,Qa=new Set(Yx().mutedTypes??[]),Rn=new Set;for(const D of Jy)Qa.has(D)||Rn.add(D),mt.set(D,0);let fs=0,Ni=!0;const ki=typeof requestAnimationFrame=="function"?requestAnimationFrame:D=>setTimeout(D,16),hs=D=>Ff.format(Math.max(0,D)),va=()=>{const D=fs===1?"entry":"entries";Gn.textContent=`${hs(fs)} ${D}`},Pa=D=>{const X=ba.get(D);X&&(X.textContent=hs(mt.get(D)??0))},Sa=(D,X)=>{if(X===0)return;const re=mt.get(D)??0;mt.set(D,Math.max(0,re+X)),fs=Math.max(0,fs+X),Pa(D),va()},Ea=()=>Ue.scrollHeight-(Ue.scrollTop+Ue.clientHeight)<48,We=()=>{ki(()=>{Ue.scrollTop=Ue.scrollHeight,Ni=!0})},ms=D=>{const X=Rn.has(D.type);D.element.hidden=!X,D.element.classList.toggle("panel-log-entry--muted",!X)},Vo=D=>{const X=D.metadata??{};return(Array.isArray(X.unitNames)?X.unitNames:typeof X.unitName=="string"?[X.unitName]:[]).map(de=>typeof de=="string"?de.trim():"").filter(de=>de.length>0)},Fn=(D,X)=>{if(X.type!=="spawn"){D.replaceChildren(),D.hidden=!0;return}const re=Vo(X),de=re.map(Ye=>{const _e=document.createElement("span");return _e.className="panel-log-entry__token",_e.textContent=Ye,_e}),Ne=X.occurrences-re.length;if(Ne>0){const Ye=document.createElement("span");Ye.className="panel-log-entry__token panel-log-entry__token--more",Ye.textContent=`+${Ne}`,de.push(Ye)}de.length===0?(D.replaceChildren(),D.hidden=!0):(D.replaceChildren(...de),D.hidden=!1)},Za=D=>{const X=document.createElement("article");X.className="panel-log-entry",X.dataset.logType=D.type,X.style.setProperty("--log-entry-accent",Ro[D.type]?.accent??"var(--color-accent)");const re=document.createElement("div");re.className="panel-log-entry__header";const de=document.createElement("span");de.className="panel-log-entry__type",de.textContent=Ro[D.type]?.label??D.type;const Ne=document.createElement("span");Ne.className="panel-log-entry__badge";const Ye=document.createElement("p");Ye.className="panel-log-entry__message",Ye.textContent=D.message;const _e=document.createElement("div");_e.className="panel-log-entry__tokens",_e.hidden=!0,re.append(de,Ne),X.append(re,Ye,_e);const et=Mt=>{Mt<=1?(Ne.textContent="",Ne.hidden=!0):(Ne.hidden=!1,Ne.textContent=`${Mt}`)},nn={element:X,type:D.type,occurrences:D.occurrences,badge:Ne,message:Ye,tokens:_e,setBadge:et};return et(D.occurrences),Fn(_e,D),nn},Xo=(D,X=!1)=>{const re=X?!0:Ea()||Ni,de=Za(D);Je.set(D.id,de),Ue.appendChild(de.element),Sa(de.type,de.occurrences),ms(de),re&&We()},Ko=D=>{const X=Je.get(D.id);if(!X)return;const re=D.occurrences-X.occurrences;re!==0&&(X.occurrences=D.occurrences,Sa(X.type,re)),X.message.textContent=D.message,X.setBadge(D.occurrences),X.tokens&&Fn(X.tokens,D),ms(X),Ni&&We()},Qo=D=>{const X=Je.get(D.id);X&&(Je.delete(D.id),Sa(X.type,-X.occurrences),X.element.parentElement===Ue&&Ue.removeChild(X.element))},Po=()=>{for(const D of Je.values())ms(D)};for(const D of Jy){const X=Ro[D],re=document.createElement("button");re.type="button",re.className="log-chip",re.dataset.logFilter=D,re.style.setProperty("--log-chip-accent",X?.accent??"var(--color-accent)"),re.setAttribute("aria-pressed",Rn.has(D)?"true":"false"),re.setAttribute("aria-label",`${X?.label??D} log filter`);const de=document.createElement("span");de.className="log-chip__label",de.textContent=X?.label??D;const Ne=document.createElement("span");Ne.className="log-chip__count",Ne.textContent="0",ba.set(D,Ne),Rn.has(D)||re.classList.add("is-muted"),re.append(de,Ne),Tn.appendChild(re),re.addEventListener("click",()=>{Rn.has(D)?(Rn.delete(D),Qa.add(D)):(Rn.add(D),Qa.delete(D)),re.classList.toggle("is-muted",!Rn.has(D)),re.setAttribute("aria-pressed",Rn.has(D)?"true":"false"),Fx({mutedTypes:Array.from(Qa)}),Po()})}va();const Di=()=>{Ni=Ea()};Ue.addEventListener("scroll",Di,{passive:!0}),N.push(()=>Ue.removeEventListener("scroll",Di));const Li=Gx();if(Li.length>0){for(const D of Li)Xo(D,!0);We()}const Nn=Ix(D=>{if(D.kind==="append")Xo(D.entry);else if(D.kind==="update")Ko(D.entry);else if(D.kind==="remove")for(const X of D.entries)Qo(X)});return N.push(Nn),Po(),ds("Roster"),{log:D=>{qt(D)},addEvent:Yn,renderRoster:fa,dispose:()=>{for(const D of N.splice(0))try{D()}catch(X){console.warn("Failed to dispose HUD listener",X)}fe(),Ae(),document.body.classList.remove(R),b.remove(),_.remove(),g.remove()}}}const Vx=n=>`[data-tutorial-target="${n}"]`,Zn=16,vc=12,Wy="is-tutorial-highlighted",Xx=[{id:"heat",target:"heat",title:"Heat the Sauna",description:"Keep the sauna fires roaring. This control shows when the next warrior emerges from the steam."},{id:"upkeep",target:"upkeep",title:"Mind Your Upkeep",description:"Every attendant draws upkeep. Track totals and see a featured roster member to balance your economy."},{id:"sisu",target:"sisu",title:"Stockpile SISU",description:"SISU fuels heroic bursts. Watch this meter to know when your grit reserves can power signature moves."},{id:"combat",target:"combat",title:"Command the Fight",description:"Trigger a Sisu Burst to supercharge allied attacks or rally everyone home with a Torille call."},{id:"victory",target:"victory",title:"Claim Victory",description:"Saunakunnia measures renown. Push it ever higher to unlock triumphs and close the campaign in glory."}];function Kx(n,a,s){return Math.max(a,Math.min(s,n))}function Qx(n={}){const a=n.steps??Xx;if(a.length===0)throw new Error("Tutorial requires at least one step.");let s=-1,r=null,l=!1;const u=document.createElement("div");u.className="tutorial-overlay";const f=document.createElement("div");f.className="tutorial-overlay__spotlight",f.setAttribute("aria-hidden","true");const h=document.createElement("section");h.className="tutorial-card",h.setAttribute("role","dialog"),h.setAttribute("aria-modal","false"),h.tabIndex=-1;const p=document.createElement("header");p.className="tutorial-card__header";const m=document.createElement("h2");m.className="tutorial-card__title";const g=document.createElement("button");g.type="button",g.className="tutorial-card__close",g.setAttribute("aria-label","Dismiss tutorial"),g.textContent="",p.append(m,g);const b=document.createElement("p");b.className="tutorial-card__description";const S=document.createElement("p");S.className="tutorial-card__progress";const E=document.createElement("div");E.className="tutorial-card__controls";const M=document.createElement("button");M.type="button",M.className="tutorial-card__button tutorial-card__button--secondary",M.textContent="Back";const N=document.createElement("button");N.type="button",N.className="tutorial-card__button",N.textContent="Next";const _=document.createElement("button");_.type="button",_.className="tutorial-card__skip",_.textContent="Skip tutorial",E.append(M,N),h.append(p,b,S,E,_),u.append(f,h);const U=typeof ResizeObserver<"u"?new ResizeObserver(()=>{s>=0&&se()}):null,H=()=>{s>=0&&se()};function I(){l||(document.body.appendChild(u),window.addEventListener("resize",se),document.addEventListener("scroll",H,!0),U?.observe(h),l=!0)}function $(){l&&(window.removeEventListener("resize",se),document.removeEventListener("scroll",H,!0),U?.disconnect(),u.remove(),l=!1)}function P(B){if(r&&r!==B&&(r.classList.remove(Wy),r.removeAttribute("data-tutorial-highlight")),r=B,!B){f.style.opacity="0";return}B.classList.add(Wy),B.setAttribute("data-tutorial-highlight","true"),f.style.opacity="1"}function ie(){if(!r)return null;const B=r.getBoundingClientRect();return B.width===0&&B.height===0?null:{top:B.top,left:B.left,width:B.width,height:B.height}}function se(){const B=ie();if(!B){h.style.top=`${Zn}px`,h.style.left=`${Zn}px`,h.classList.add("tutorial-card--floating"),f.style.opacity="0";return}h.classList.remove("tutorial-card--floating"),f.style.opacity="1";const T=B.top-vc,G=B.left-vc,J=B.width+vc*2,fe=B.height+vc*2;f.style.top=`${T}px`,f.style.left=`${G}px`,f.style.width=`${J}px`,f.style.height=`${fe}px`;const x=h.getBoundingClientRect();let te=window.innerHeight-B.top-B.height>=B.top?B.top+B.height+Zn:B.top-x.height-Zn;te<Zn?te=Zn:te+x.height>window.innerHeight-Zn&&(te=window.innerHeight-Zn-x.height);let le=B.left+B.width/2-x.width/2;le=Kx(le,Zn,window.innerWidth-x.width-Zn),h.style.top=`${Math.round(te)}px`,h.style.left=`${Math.round(le)}px`}function oe(){requestAnimationFrame(()=>{h.focus({preventScroll:!0})})}function ee(B){if(B<0||B>=a.length)return;I(),s=B;const T=a[B];m.textContent=T.title,b.textContent=T.description,S.textContent=`Step ${B+1} of ${a.length}`,M.disabled=B===0,N.textContent=B===a.length-1?"Finish":"Next";const G=document.querySelector(Vx(T.target));P(G??null),se(),oe()}function Y(){if(s===-1){ee(0);return}if(s>=a.length-1){F();return}ee(s+1)}function R(){s<=0||ee(s-1)}function k(){P(null),$(),s=-1}function A(){n.onSkip?.(),k()}function F(){n.onComplete?.(),k()}return M.addEventListener("click",()=>{R()}),N.addEventListener("click",()=>{Y()}),_.addEventListener("click",()=>{A()}),g.addEventListener("click",()=>{A()}),h.addEventListener("keydown",B=>{B.defaultPrevented||(B.key==="ArrowRight"?(B.preventDefault(),Y()):B.key==="ArrowLeft"?(B.preventDefault(),R()):B.key==="Escape"&&(B.preventDefault(),A()))}),{start(){s===-1&&ee(0)},next:Y,previous:R,skip:A,finish:F,destroy(){k()}}}const Px=Math.sqrt(3),Zx=2;function Vc(n){return{width:n*Px,height:n*Zx}}const ja=16,Sc=2;function Jx(){return typeof window<"u"&&window.devicePixelRatio||1}function Wx(n,a){const s=Math.max(n.qMin,a.minQ),r=Math.min(n.qMax,a.maxQ),l=Math.max(n.rMin,a.minR),u=Math.min(n.rMax,a.maxR);return s>r||l>u?null:{qMin:s,qMax:r,rMin:l,rMax:u}}function ew(n,a){const s=Jx(),r=a.width/(s*n.zoom),l=a.height/(s*n.zoom);return{x:n.x-r/2,y:n.y-l/2,width:r,height:l}}function tw(n,a){const s=[Mo(n.x,n.y,a),Mo(n.x+n.width,n.y,a),Mo(n.x,n.y+n.height,a),Mo(n.x+n.width,n.y+n.height,a)];let r=1/0,l=-1/0,u=1/0,f=-1/0;for(const h of s)r=Math.min(r,h.q),l=Math.max(l,h.q),u=Math.min(u,h.r),f=Math.max(f,h.r);return{qMin:Math.floor(r)-Sc,qMax:Math.ceil(l)+Sc,rMin:Math.floor(u)-Sc,rMax:Math.ceil(f)+Sc}}function nw(n,a,s,r){if(!s||typeof s.width!="number"||typeof s.height!="number")return{qMin:n.minQ,qMax:n.maxQ,rMin:n.minR,rMax:n.maxR};if(s.width===0||s.height===0)return{qMin:n.minQ,qMax:n.maxQ,rMin:n.minR,rMax:n.maxR};const l=ew(a,s);return Wx(tw(l,r),n)}function Js(n){return Math.floor(n/ja)}function Gb(n){return`${n.q},${n.r}`}function aw(n,a){return Gb({q:Js(n),r:Js(a)})}function iw(n){return{qMin:Js(n.qMin),qMax:Js(n.qMax),rMin:Js(n.rMin),rMax:Js(n.rMax)}}function Yb(n){const a=[];for(let s=n.rMin;s<=n.rMax;s++)for(let r=n.qMin;r<=n.qMax;r++)a.push({q:r,r:s});return a}function sw(n,a){const s=a.q*ja,r=a.r*ja,l=s+ja-1,u=r+ja-1,f=Math.max(s,n.minQ),h=Math.min(l,n.maxQ),p=Math.max(r,n.minR),m=Math.min(u,n.maxR);if(!(f>h||p>m))for(let g=p;g<=m;g++)for(let b=f;b<=h;b++)n.ensureTile(b,g)}function rw(n,a){for(const s of Yb(a))sw(n,s)}const ow="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3ePlains%20Tile%3c/title%3e%3cdesc%20id='desc'%3eRolling%20plains%20with%20sunrise%20gradients%20and%20glowing%20grasses.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='plains-bg'%20cx='50%25'%20cy='50%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='plains-field'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='0%25'%3e%3cstop%20offset='0%25'%20stop-color='%23facc15'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23eab308'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='plains-haze'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f59e0b'%20stop-opacity='0.2'%20/%3e%3c/linearGradient%3e%3cfilter%20id='plains-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='5'%20stdDeviation='6'%20flood-color='%23facc15'%20flood-opacity='0.35'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23plains-bg)'%20/%3e%3cg%20filter='url(%23plains-glow)'%3e%3cpath%20d='M16%2088c20-18%2036-22%2048-22s28%204%2048%2022'%20fill='url(%23plains-field)'%20stroke='%23fef9c3'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M24%20102c16-14%2032-18%2040-18s24%204%2040%2018'%20fill='none'%20stroke='%23fde68a'%20stroke-width='5'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M32%2070c12-10%2024-14%2032-14s20%204%2032%2014'%20fill='url(%23plains-haze)'%20opacity='0.7'%20/%3e%3cpath%20d='M52%2078l4%2012m8-12l4%2012m8-12l4%2012'%20stroke='%23fef3c7'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='36'%20r='8'%20fill='%23fef08a'%20opacity='0.7'%20/%3e%3c/svg%3e",lw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eForest%20Tile%3c/title%3e%3cdesc%20id='desc'%3eStylised%20evergreen%20trees%20glowing%20against%20a%20deep%20night%20backdrop.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='forest-bg'%20cx='50%25'%20cy='40%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230b1120'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='forest-leaf'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%234ade80'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2315803d'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='forest-trunk'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23a855f7'%20/%3e%3cstop%20offset='100%25'%20stop-color='%237c3aed'%20/%3e%3c/linearGradient%3e%3cfilter%20id='forest-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%234ade80'%20flood-opacity='0.25'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23forest-bg)'%20/%3e%3cg%20filter='url(%23forest-glow)'%20stroke='%23bbf7d0'%20stroke-width='2'%3e%3cpath%20fill='url(%23forest-leaf)'%20d='M64%2026L32%2080h18l-12%2022h28l-10-22h16l-10%2022h28l-12-22h18z'%20/%3e%3crect%20x='58'%20y='74'%20width='12'%20height='18'%20rx='3'%20fill='url(%23forest-trunk)'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20stroke-opacity='0.5'%20d='M44%2086c6-4%2012-6%2020-6s14%202%2020%206'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='40'%20r='6'%20fill='%23fef3c7'%20opacity='0.6'%20/%3e%3ccircle%20cx='88'%20cy='32'%20r='4'%20fill='%23fef3c7'%20opacity='0.4'%20/%3e%3c/svg%3e",cw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eMountain%20Tile%3c/title%3e%3cdesc%20id='desc'%3eJagged%20alpine%20peaks%20with%20luminous%20snowcaps.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='mountain-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%23111827'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='mountain-rock'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2364748b'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23334155'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mountain-snow'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23cbd5f5'%20/%3e%3c/linearGradient%3e%3cfilter%20id='mountain-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%23f8fafc'%20flood-opacity='0.2'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23mountain-bg)'%20/%3e%3cg%20filter='url(%23mountain-glow)'%20stroke='%23cbd5f5'%20stroke-width='2'%20stroke-linejoin='round'%3e%3cpath%20fill='url(%23mountain-rock)'%20d='M24%20100l32-52%2014%2022%2012-18%2022%2048z'%20/%3e%3cpath%20fill='url(%23mountain-snow)'%20d='M56%2048l14%2022%2012-18%2010%2022H48z'%20opacity='0.85'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20opacity='0.6'%20d='M32%2094c10-6%2020-9%2032-9s22%203%2032%209'%20/%3e%3c/g%3e%3ccircle%20cx='92'%20cy='32'%20r='6'%20fill='%23f1f5f9'%20opacity='0.5'%20/%3e%3c/svg%3e",uw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eWater%20Tile%3c/title%3e%3cdesc%20id='desc'%3eGlowing%20waves%20surrounding%20a%20crystalline%20droplet.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='water-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230b1120'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='water-wave'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='water-drop'%20x1='50%25'%20y1='0%25'%20x2='50%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230284c7'%20/%3e%3c/linearGradient%3e%3cfilter%20id='water-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='8'%20flood-color='%2338bdf8'%20flood-opacity='0.3'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23water-bg)'%20/%3e%3cg%20filter='url(%23water-glow)'%3e%3cpath%20d='M32%2076c12-10%2024-15%2032-15s20%205%2032%2015'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3cpath%20d='M28%2092c14-12%2030-18%2040-18s26%206%2040%2018'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='6'%20stroke-linecap='round'%20opacity='0.7'%20/%3e%3cpath%20d='M40%2060c10-8%2018-12%2024-12s14%204%2024%2012'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M64%2030c-12%2020-18%2032-18%2042%200%2011%208%2020%2018%2020s18-9%2018-20c0-10-6-22-18-42z'%20fill='url(%23water-drop)'%20stroke='%23e0f2fe'%20stroke-width='2'%20/%3e%3c/g%3e%3ccircle%20cx='94'%20cy='34'%20r='6'%20fill='%23f8fafc'%20opacity='0.45'%20/%3e%3c/svg%3e",dw=.01;function Fb(n){return!Number.isFinite(n)||n<=dw?1:n}function fw(n,a){return n/Fb(a)}function ta(n,a){const s=Fb(a);return Math.round(n*s)/s}const e2={[xn.Plains]:{baseColor:"#d8b869",icon:ow},[xn.Forest]:{baseColor:"#237a55",icon:lw},[xn.Hills]:{baseColor:"#b57c57",icon:cw},[xn.Lake]:{baseColor:"#3185d5",icon:uw}},hw=[255,255,255],sm=[12,18,28],mw=[0,0,0],t2="rgba(56, 189, 248, 0.85)",n2="rgba(56, 189, 248, 0.45)";let go=null,yo=null;const pw=n=>Math.min(1,Math.max(0,n));function gw(n){let a=n.trim().replace("#","");a.length===3&&(a=a.split("").map(r=>r+r).join(""));const s=Number.parseInt(a,16);return[s>>16&255,s>>8&255,s&255]}function Xc(n,a,s){const r=pw(s);return[Math.round(n[0]+(a[0]-n[0])*r),Math.round(n[1]+(a[1]-n[1])*r),Math.round(n[2]+(a[2]-n[2])*r)]}function a2(n){return`rgb(${n[0]}, ${n[1]}, ${n[2]})`}function Kc(n,a=1){return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${a})`}function Qc(n,a=1){return Kc(Xc(sm,hw,n),a)}function ir(n,a=1){return Kc(Xc(sm,mw,n),a)}const yw={terrain:.05,hover:.065,selection:.085},bw={terrain:1,hover:1.35,selection:2.1};function Pc(n,a,s="terrain"){const r=n*yw[s],l=fw(r,a);return Math.max(bw[s],l)}function vw(){if(go&&yo)return{stroke:go,glow:yo};if(typeof window<"u"){const n=getComputedStyle(document.documentElement),a=n.getPropertyValue("--tile-highlight-ring").trim(),s=n.getPropertyValue("--tile-highlight-glow").trim();go=a||t2,yo=s||n2}else go=t2,yo=n2;return{stroke:go,glow:yo}}function $b(n){return Math.min(1,Math.max(0,n))}function du(n){let a=n.trim();if(a.startsWith("#")&&(a=a.slice(1)),a.length===3){const s=Number.parseInt(a[0]+a[0],16),r=Number.parseInt(a[1]+a[1],16),l=Number.parseInt(a[2]+a[2],16);return[s,r,l]}if(a.length===6){const s=Number.parseInt(a,16),r=s>>16&255,l=s>>8&255,u=s&255;return[r,l,u]}return[0,0,0]}function Sw(n,a,s){const r=$b(s),l=(u,f)=>Math.round(u+(f-u)*r);return[l(n[0],a[0]),l(n[1],a[1]),l(n[2],a[2])]}function Ew([n,a,s],r){return`rgba(${n}, ${a}, ${s}, ${$b(r)})`}function _i(n,a,s,r){return Ew(Sw(n,a,s),r)}function Mw(n){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=n,p=du(h);a.save(),a.lineCap="round",a.lineJoin="round";const m=_i(p,[255,255,255],.35,.24);a.strokeStyle=m,a.lineWidth=Math.max(1,f*.06);const g=3,b=6,S=s+l*.12,E=s+l*.88;for(let U=0;U<g;U++){const H=U/Math.max(1,g-1),I=r+u*.28+H*u*.32,$=f*(.18-H*.05);a.beginPath();for(let P=0;P<=b;P++){const ie=P/b,se=S+(E-S)*ie,oe=Math.sin(ie*Math.PI*1.6+U*.8)*$,ee=I-Math.abs(oe)*.55;P===0?a.moveTo(se,ee):a.lineTo(se,ee)}a.stroke()}const M=_i(p,[18,54,32],.4,.2);a.strokeStyle=M,a.lineWidth=Math.max(.75,f*.035);const N=5,_=f*.22;for(let U=0;U<N;U++){const H=s+l*(.2+U/Math.max(1,N-1)*.6),I=r+u*.55-Math.cos(U*.9)*f*.08;a.beginPath(),a.arc(H,I,_,Math.PI*.2,Math.PI*.85),a.stroke(),a.beginPath(),a.arc(H+_*.35,I-_*.1,_*.55,Math.PI*.15,Math.PI*.95),a.stroke()}a.restore()}function xw(n){const{ctx:a,centerX:s,centerY:r,radius:l,baseColor:u}=n,f=du(u);a.save(),a.lineCap="round";const h=_i(f,[255,235,214],.45,.22);a.strokeStyle=h,a.lineWidth=Math.max(1,l*.05);const p=4;for(let b=0;b<p;b++){const S=b/Math.max(1,p-1),E=l*(1.25-S*.45),M=l*(.72-S*.18),N=r+l*.18*(S-.5);a.beginPath(),a.ellipse(s,N,E,M,0,Math.PI*.12,Math.PI*.88),a.stroke()}const m=_i(f,[60,36,20],.35,.18);a.strokeStyle=m,a.lineWidth=Math.max(.85,l*.032),a.setLineDash([l*.22,l*.18]);const g=3;for(let b=0;b<g;b++){const S=l*(.75-b*.1),E=r+l*.28+b*l*.08;a.beginPath(),a.arc(s+l*.08,E,S,Math.PI*.28,Math.PI*.76),a.stroke()}a.setLineDash([]),a.restore()}function ww(n){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=n,p=du(h);a.save(),a.lineCap="round",a.lineJoin="round";const m=_i(p,[255,255,255],.55,.28);a.strokeStyle=m,a.lineWidth=Math.max(1,f*.045);const g=4,b=7,S=s+l*.12,E=s+l*.88,M=f*.16;for(let U=0;U<g;U++){const H=U/Math.max(1,g-1),I=r+u*.3+H*u*.4;a.beginPath();for(let $=0;$<=b;$++){const P=$/b,ie=S+(E-S)*P,se=Math.sin(P*Math.PI*2+U*.6)*M*(.75-H*.2),oe=I+se;$===0?a.moveTo(ie,oe):a.lineTo(ie,oe)}a.stroke()}const N=_i(p,[12,52,94],.4,.2);a.strokeStyle=N,a.lineWidth=Math.max(.8,f*.03);const _=3;for(let U=0;U<_;U++){const H=U/Math.max(1,_-1),I=r+u*.35+H*u*.35;a.beginPath();for(let $=0;$<=b;$++){const P=$/b,ie=S+(E-S)*P,se=Math.sin(P*Math.PI*2+U)*M*.35,oe=I+se;$===0?a.moveTo(ie,oe):a.lineTo(ie,oe)}a.stroke()}a.restore()}function Vb(n){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=n,p=du(h);a.save(),a.lineCap="round";const m=_i(p,[255,255,255],.42,.18);a.strokeStyle=m,a.lineWidth=Math.max(.85,f*.03);const g=f*.55;for(let E=-1;E<=2;E++){const M=g*E;a.beginPath(),a.moveTo(s+M,r+u*.25),a.lineTo(s+M+l*.75,r+u*.85),a.stroke()}const b=_i(p,[112,82,32],.3,.16);a.strokeStyle=b,a.lineWidth=Math.max(.7,f*.025),a.setLineDash([f*.24,f*.34]);const S=f*.48;for(let E=0;E<3;E++){const M=S*E;a.beginPath(),a.moveTo(s+l*.18+M,r+u*.78),a.lineTo(s+l*.7+M,r+u*.38),a.stroke()}a.setLineDash([]),a.restore()}const i2=new Map;let Zi=null;function Aw(){if(Zi)return Zi;const n="/";if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(n))return Zi=n,Zi;const s=n.startsWith("/")?n:`/${n}`;return typeof window<"u"&&typeof window.location?.origin=="string"?Zi=`${window.location.origin}${s}`:Zi=`http://localhost${s}`,Zi}function Cw(n){let a=i2.get(n);if(!a){a=new Image,a.decoding="async";const s=new URL(n,Aw()).href;a.src=s,i2.set(n,a)}if(a.complete&&a.naturalWidth>0&&a.naturalHeight>0)return a}const Tw={[xn.Plains]:Vb,[xn.Forest]:Mw,[xn.Hills]:xw,[xn.Lake]:ww};function Xb(n,a,s,r){n.beginPath();for(let l=0;l<6;l++){const u=Math.PI/180*(60*l-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function _w(n,a,s,r){Xb(n,a,s,r),n.save(),n.lineJoin="round",n.lineCap="round",n.lineWidth=Pc(r,1,"terrain"),n.strokeStyle=Qc(.16,.6),n.stroke(),n.restore()}function Rw(n,a,s,r,l,u,f,h){const p=e2[a.terrain]??e2[xn.Plains],m=gw(p.baseColor),g=r+u/2,b=l+f/2;n.save(),Xb(n,g,b,h),n.clip();const S=n.createRadialGradient(g,b,h*.2,g,b,h*1.05);S.addColorStop(0,a2(Xc(m,[255,255,255],.3))),S.addColorStop(.7,p.baseColor),S.addColorStop(1,a2(Xc(m,sm,.4))),n.fillStyle=S,n.shadowColor=Kc(m,.35),n.shadowBlur=h*.9,n.shadowOffsetX=0,n.shadowOffsetY=0,n.fillRect(r-h*.1,l-h*.1,u+h*.2,f+h*.2);const E={ctx:n,x:r,y:l,width:u,height:f,radius:h,centerX:g,centerY:b,baseColor:p.baseColor};(Tw[a.terrain]??Vb)(E),n.globalCompositeOperation="lighter";const N=n.createRadialGradient(g,b,h*.85,g,b,h*1.18);N.addColorStop(0,"rgba(255, 255, 255, 0)"),N.addColorStop(1,Kc(m,.18)),n.fillStyle=N,n.fillRect(r-h*.1,l-h*.1,u+h*.2,f+h*.2),n.globalCompositeOperation="source-over",n.restore();const _=Cw(p.icon);if(_){const U=Math.min(u,f)*.62,H=g-U/2,I=b-U/2;n.save(),n.globalAlpha*=.92,n.drawImage(_,H,I,U,U),n.restore()}if(a.building){const U=s[`building-${a.building}`]??s.placeholder;n.drawImage(U,r,l,u,f)}}function Nw(n,a){const s=Math.max(n.q*ja,a.minQ),r=Math.min(s+ja-1,a.maxQ),l=Math.max(n.r*ja,a.minR),u=Math.min(l+ja-1,a.maxR);return{qStart:s,qEnd:r,rStart:l,rEnd:u}}class kw{constructor(a){this.map=a,this.unsubscribe=a.addTileChangeListener((s,r,l)=>{this.onTileChange(s,l)})}chunkCanvases=new Map;dirtyChunks=new Set;cachedImages;unsubscribe;dispose(){this.unsubscribe(),this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}invalidate(){this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}markChunkDirty(a){this.dirtyChunks.add(a)}markTileDirty(a,s){this.dirtyChunks.add(aw(a,s))}getRenderableChunks(a,s,r,l){this.refreshAssets(r);const u=[],{width:f,height:h}=Vc(s);for(const p of Yb(a)){const m=Gb(p),g=this.ensureChunk(m,p,s,f,h,r,l);g&&u.push(g)}return u}refreshAssets(a){if(this.cachedImages!==a){this.cachedImages=a;for(const s of this.chunkCanvases.keys())this.dirtyChunks.add(s)}}onTileChange(a,s){(s==="created"||s==="terrain"||s==="building"||s==="fog")&&this.markTileDirty(a.q,a.r)}ensureChunk(a,s,r,l,u,f,h){const p=this.chunkCanvases.get(a);if(!p||this.dirtyChunks.has(a)){const m=this.renderChunk(a,s,r,l,u,f,h,p);return this.dirtyChunks.delete(a),m?(this.chunkCanvases.set(a,m),m):(this.chunkCanvases.delete(a),null)}return p}renderChunk(a,s,r,l,u,f,h,p){if(typeof document>"u")return null;const{qStart:m,qEnd:g,rStart:b,rEnd:S}=Nw(s,this.map);if(m>g||b>S)return null;const E=l/2,M=u/2;let N=1/0,_=1/0,U=-1/0,H=-1/0;const I=[];for(let oe=m;oe<=g;oe++)for(let ee=b;ee<=S;ee++){const Y=this.map.getTile(oe,ee);if(!Y||Y.isFogged)continue;const{x:R,y:k}=aa({q:oe,r:ee},r),A=R-h.x-E,F=k-h.y-M;N=Math.min(N,A),_=Math.min(_,F),U=Math.max(U,A+l),H=Math.max(H,F+u),I.push({tile:Y,x:A,y:F})}if(!Number.isFinite(N)||!Number.isFinite(_)||!Number.isFinite(U)||!Number.isFinite(H))return null;const $=Math.max(1,Math.ceil(U-N)),P=Math.max(1,Math.ceil(H-_));let ie=p?.canvas;(!ie||ie.width!==$||ie.height!==P)&&(ie=document.createElement("canvas"),ie.width=$,ie.height=P);const se=ie.getContext("2d");if(!se)throw new Error("Canvas 2D context not available for chunk rendering");se.setTransform(1,0,0,1,0,0),se.clearRect(0,0,$,P);for(const{tile:oe,x:ee,y:Y}of I){const R=ee-N,k=Y-_;se.save(),Rw(se,oe,f,R,k,l,u,r),_w(se,R+l/2,k+u/2,r),se.restore()}return{key:a,canvas:ie,origin:{x:N,y:_},width:$,height:P}}}const Dw=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],za=new Array(512);for(let n=0;n<512;n++)za[n]=Dw[n%256];const s2=new Map,r2=n=>n*n*n*(n*(n*6-15)+10),$f=(n,a,s)=>n+s*(a-n),Ec=(n,a,s)=>{switch(n&3){case 0:return a+s;case 1:return-a+s;case 2:return a-s;default:return-a-s}};function Lw(n,a){const s=Math.floor(n)&255,r=Math.floor(a)&255,l=n-Math.floor(n),u=a-Math.floor(a),f=za[za[s+1]+r+1],h=za[za[s]+r+1],p=za[za[s+1]+r],m=za[za[s]+r],g=r2(l),b=r2(u),S=$f(Ec(m,l,u),Ec(p,l-1,u),g),E=$f(Ec(h,l,u-1),Ec(f,l-1,u-1),g);return $f(S,E,b)}function Uw(n,a,s=4){let r=0,l=1,u=1,f=0;for(let h=0;h<s;h++)r+=Lw(n*l,a*l)*u,f+=u,u*=.5,l*=2;return f>0?r/f:0}function Ow(n){const a=Math.max(32,Math.min(512,Math.round(n))),s=a,r=s2.get(s);if(r)return r;if(typeof document>"u")return null;const l=document.createElement("canvas");l.width=a,l.height=a;const u=l.getContext("2d");if(!u)return null;const f=u.createImageData(a,a),h=a/48;let p=0;for(let m=0;m<a;m++)for(let g=0;g<a;g++){const b=Uw(g/h,m/h,5),S=Math.pow((b+1)/2,1.35),E=Math.round(S*255);f.data[p]=255,f.data[p+1]=255,f.data[p+2]=255,f.data[p+3]=E,p+=4}return u.putImageData(f,0,0),s2.set(s,l),l}function o2(n,a,s,r){n.beginPath();for(let l=0;l<6;l++){const u=Math.PI/180*(60*l-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function qw(n,a,s,r){const l=n.createRadialGradient(a,s,r*.08,a,s,r*1.12);return l.addColorStop(0,Qc(.4,.35)),l.addColorStop(.35,Qc(.2,.55)),l.addColorStop(.6,ir(.1,.78)),l.addColorStop(.82,ir(.2,.88)),l.addColorStop(1,ir(.35,.95)),l}function zw(n,a,s,r,l){if(r<=0)return;const u=Ow(r*2.2),f=r*2.5,h=a-f/2,p=s-f/2;n.save(),o2(n,a,s,r),n.clip();const m=qw(n,a,s,r);n.fillStyle=m,n.fillRect(h,p,f,f),u&&(n.save(),n.globalCompositeOperation="lighter",n.globalAlpha*=.32,n.drawImage(u,a-r,s-r,r*2,r*2),n.restore()),n.restore(),n.save(),o2(n,a,s,r*.99),n.lineJoin="round",n.lineCap="round",n.lineWidth=Pc(r,l,"hover"),n.strokeStyle=ir(.3,.88),n.shadowColor=ir(.45,.42),n.shadowBlur=Math.max(3,r*.45/Math.max(l,.1)),n.stroke(),n.restore()}class Bw{constructor(a){this.mapRef=a,this.terrainCache=new kw(a),this.cachedHexSize=a.hexSize}terrainCache;cachedHexSize;get hexSize(){return this.mapRef.hexSize}getOrigin(){return aa({q:this.mapRef.minQ,r:this.mapRef.minR},this.hexSize)}invalidateCache(){this.terrainCache.invalidate()}dispose(){this.terrainCache.dispose()}draw(a,s,r){this.ensureHexSize();const l=a.canvas??null,u=nw(this.mapRef,xe,l,this.hexSize);if(!u)return;const f=iw(u);rw(this.mapRef,f);const h=this.getOrigin(),p=this.terrainCache.getRenderableChunks(f,this.hexSize,s,h);this.drawChunks(a,p),this.drawFogLayer(a,h,u),r&&this.drawSelection(a,h,r)}drawToCanvas(a,s,r){const l=a.getContext("2d");if(!l)throw new Error("Canvas 2D context not available");this.draw(l,s,r)}ensureHexSize(){this.cachedHexSize!==this.hexSize&&(this.cachedHexSize=this.hexSize,this.terrainCache.invalidate())}drawChunks(a,s){if(s.length!==0)for(const r of s)a.drawImage(r.canvas,r.origin.x,r.origin.y)}drawSelection(a,s,r){const{width:l,height:u}=Vc(this.hexSize),{x:f,y:h}=aa(r,this.hexSize),p=f-s.x-l/2,m=h-s.y-u/2;this.strokeHex(a,p+l/2,m+u/2,this.hexSize,!0)}drawFogLayer(a,s,r){const{width:l,height:u}=Vc(this.hexSize),f=l/2,h=u/2;for(let p=r.rMin;p<=r.rMax;p++)for(let m=r.qMin;m<=r.qMax;m++){const g=this.mapRef.getTile(m,p);if(!g||!g.isFogged)continue;const{x:b,y:S}=aa({q:m,r:p},this.hexSize),E=b-s.x-f,M=S-s.y-h,N=this.hexSize,_=E+l/2,U=M+u/2;zw(a,_,U,N,xe.zoom)}}strokeHex(a,s,r,l,u=!1){const{stroke:f,glow:h}=vw();this.hexPath(a,s,r,l),a.save(),a.lineJoin="round",a.lineCap="round",u?(a.shadowColor=h,a.shadowBlur=Math.max(6,l*.65/Math.max(xe.zoom,.1)),a.lineWidth=Pc(l,xe.zoom,"selection"),a.strokeStyle=f,a.stroke()):(a.lineWidth=Pc(l,xe.zoom,"hover"),a.shadowColor=Qc(.1,.45),a.shadowBlur=Math.max(2,l*.4/Math.max(xe.zoom,.1)),a.strokeStyle=ir(.1,.72),a.stroke()),a.restore()}hexPath(a,s,r,l){a.beginPath();for(let u=0;u<6;u++){const f=Math.PI/180*(60*u-30),h=s+l*Math.cos(f),p=r+l*Math.sin(f);u===0?a.moveTo(h,p):a.lineTo(h,p)}a.closePath()}}const Mi={accent:"#38bdf8",accentSoft:"rgba(56, 189, 248, 0.2)",warm:"#fbbf24",surface:"rgba(15, 23, 42, 0.92)",border:"rgba(148, 163, 184, 0.34)",text:"#e2e8f0"};let xi=null;function Qs(n,a){const s=n.trim();return s.length>0?s:a}function Hw(){if(xi)return xi;if(typeof window>"u"||typeof document>"u")return xi=Mi,xi;try{const n=getComputedStyle(document.documentElement);return xi={accent:Qs(n.getPropertyValue("--color-accent"),Mi.accent),accentSoft:Qs(n.getPropertyValue("--color-accent-soft"),Mi.accentSoft),warm:Qs(n.getPropertyValue("--color-warning"),Mi.warm),surface:Qs(n.getPropertyValue("--color-surface-strong"),Mi.surface),border:Qs(n.getPropertyValue("--hud-border-strong"),Mi.border),text:Qs(n.getPropertyValue("--color-foreground"),Mi.text)},xi}catch(n){return console.warn("Failed to read sauna palette tokens from computed styles",n),xi=Mi,xi}}function jw(n,a){const s=Math.max(0,n.auraRadius),r=aa(n.pos,a),l=r.x+a,u=r.y+a;let f=a;if(s<=0)return a*1.6;for(const h of z2){const p=aa({q:n.pos.q+h.q*s,r:n.pos.r+h.r*s},a),m=p.x+a,g=p.y+a,b=Math.hypot(m-l,g-u);b>f&&(f=b)}return f+a*.65}function Iw(n,a,s,r,l,u){const f=Math.max(0,Math.min(u,Math.min(r,l)/2));n.moveTo(a+f,s),n.lineTo(a+r-f,s),n.quadraticCurveTo(a+r,s,a+r,s+f),n.lineTo(a+r,s+l-f),n.quadraticCurveTo(a+r,s+l,a+r-f,s+l),n.lineTo(a+f,s+l),n.quadraticCurveTo(a,s+l,a,s+l-f),n.lineTo(a,s+f),n.quadraticCurveTo(a,s,a+f,s),n.closePath()}function Gw(n,a,{origin:s,hexSize:r,timestamp:l}){if(!a)return;const u=Hw(),f=Number.isFinite(l)?l:typeof performance<"u"?performance.now():Date.now(),h=.5+.5*Math.sin(f*.0035),p=aa(a.pos,r),m=p.x-s.x+r,g=p.y-s.y+r,b=jw(a,r);n.save(),n.globalCompositeOperation="screen";const S=b+r*(.4+h*.3),E=Math.max(r*.6,b*.58),M=n.createRadialGradient(m,g,E,m,g,S);M.addColorStop(0,u.accentSoft),M.addColorStop(.55,`rgba(56, 189, 248, ${.18+h*.12})`),M.addColorStop(1,"rgba(2, 6, 23, 0)"),n.fillStyle=M,n.beginPath(),n.arc(m,g,S,0,Math.PI*2),n.fill(),n.restore(),n.save(),n.globalCompositeOperation="lighter",n.lineWidth=Math.max(r*.28,6),n.strokeStyle=`rgba(56, 189, 248, ${(.35+h*.2).toFixed(3)})`,n.shadowColor=`rgba(56, 189, 248, ${.45+h*.1})`,n.shadowBlur=r*(.9+h*.45),n.beginPath(),n.arc(m,g,b+r*.12,0,Math.PI*2),n.stroke(),n.restore();const N=r*.9;n.save(),n.beginPath(),n.arc(m,g,N,0,Math.PI*2),n.fillStyle=u.surface,n.globalAlpha*=.96,n.fill(),n.lineWidth=Math.max(1.5,r*.06),n.strokeStyle=u.border,n.shadowColor="rgba(8, 25, 53, 0.6)",n.shadowBlur=r*.45,n.stroke(),n.restore();const _=N*.78,U=Math.max(r*.22,5);n.save(),n.lineWidth=U,n.strokeStyle="rgba(148, 163, 184, 0.24)",n.beginPath(),n.arc(m,g,_,0,Math.PI*2),n.stroke(),n.restore();const H=a.playerSpawnCooldown>0?a.playerSpawnCooldown:1,$=1-Math.min(1,Math.max(0,a.playerSpawnTimer/H)),P=-Math.PI/2,ie=P+Math.PI*2*$;if($>0){n.save(),n.lineWidth=U,n.lineCap="round";const V=n.createLinearGradient(m,g-_,m,g+_);V.addColorStop(0,u.accent),V.addColorStop(1,u.warm),n.strokeStyle=V,n.shadowColor=`rgba(56, 189, 248, ${.42+h*.18})`,n.shadowBlur=r*(.65+h*.35),n.beginPath(),n.arc(m,g,_,P,ie,!1),n.stroke(),n.restore()}const se=Math.max(0,a.playerSpawnTimer),oe=Math.ceil(se);n.save(),n.font=`600 ${Math.max(12,r*.9)}px "Inter", "Manrope", "Segoe UI", sans-serif`,n.fillStyle=u.text,n.textAlign="center",n.textBaseline="middle",n.shadowColor="rgba(2, 6, 23, 0.6)",n.shadowBlur=r*.35,n.fillText(String(oe),m,g),n.restore(),n.save(),n.font=`500 ${Math.max(10,r*.36)}px "Inter", "Manrope", "Segoe UI", sans-serif`,n.fillStyle="rgba(148, 163, 184, 0.78)",n.textAlign="center",n.textBaseline="top",n.fillText("sec",m,g+_*.45),n.restore();const ee="Sauna ",Y=Math.max(12,r*.58);n.save(),n.font=`600 ${Y}px "Inter", "Manrope", "Segoe UI", sans-serif`;const R=n.measureText(ee),k=r*.58,A=r*.32,F=R.width+k*2,B=Y+A*2,T=m-F/2,G=g-b-B-r*.35,J=B/2;n.beginPath(),Iw(n,T,G,F,B,J);const fe=n.createLinearGradient(T,G,T,G+B);fe.addColorStop(0,"rgba(15, 23, 42, 0.94)"),fe.addColorStop(.55,"rgba(15, 23, 42, 0.86)"),fe.addColorStop(1,"rgba(30, 41, 59, 0.9)"),n.fillStyle=fe,n.shadowColor="rgba(8, 25, 53, 0.6)",n.shadowBlur=r*.4,n.fill(),n.lineWidth=Math.max(1.5,r*.06);const x=n.createLinearGradient(T,G,T+F,G);x.addColorStop(0,`${u.accent}`),x.addColorStop(1,`${u.warm}`),n.strokeStyle=x,n.stroke(),n.fillStyle=u.text,n.shadowColor="rgba(8, 25, 53, 0.65)",n.shadowBlur=r*.3,n.textAlign="center",n.textBaseline="middle",n.fillText(ee,m,G+B/2+Y*.05),n.restore()}const Kb={nativeSize:{width:64,height:64},anchor:{x:.5,y:.92},scale:{x:1,y:1},nudge:{x:0,y:-.05}},Yw={default:Kb,soldier:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.9},scale:{x:1.12,y:1.24},nudge:{x:0,y:-.14}},archer:{nativeSize:{width:128,height:128},anchor:{x:.46,y:.88},scale:{x:1.1,y:1.22},nudge:{x:-.04,y:-.12}},"avanto-marauder":{nativeSize:{width:128,height:128},anchor:{x:.5,y:.92},scale:{x:1.18,y:1.3},nudge:{x:0,y:-.18}},saunoja:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.66},scale:{x:1,y:1},nudge:{x:0,y:-.02}}};function Qb(n){return Yw[n]??Kb}function Pb(n,a,s,r){const{x:l,y:u}=aa(n,a),f=r.nudge.x*a,h=r.nudge.y*a;return{x:l-s.x+f,y:u-s.y+h}}function Fw({coord:n,hexSize:a,origin:s,zoom:r,type:l}){const u=Qb(l),f=Pb(n,a,s,u);return{x:ta(f.x,r),y:ta(f.y,r)}}function $w({coord:n,hexSize:a,origin:s,zoom:r,type:l}){const u=Qb(l),f=Pb(n,a,s,u),{width:h,height:p}=Vc(a),m=h*u.scale.x,g=p*u.scale.y,b=ta(f.x-m*u.anchor.x,r),S=ta(f.y-g*u.anchor.y,r),E=ta(m,r),M=ta(g,r),N=b+E*u.anchor.x,_=S+M*u.anchor.y;return{drawX:b,drawY:S,width:E,height:M,centerX:N,centerY:_,metadata:u}}function Vw(n){if(!n||typeof n!="object")return!1;const a=n;return!!a.coord&&typeof a.coord=="object"&&typeof a.coord.q=="number"&&typeof a.coord.r=="number"&&typeof a.range=="number"}function Xw(n){if(!n)return null;if(Vw(n)){const a=Number.isFinite(n.range)?Math.max(0,n.range):0;return{coord:n.coord,range:a}}if("pos"in n&&"auraRadius"in n){const a=Number.isFinite(n.auraRadius)?Math.max(0,n.auraRadius):0;return{coord:n.pos,range:a}}return null}function Kw(n,a,s,r,l,u){const f=window.devicePixelRatio||1,h=n.canvas.width,p=n.canvas.height;n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,h,p);const m=h/f,g=p/f;n.scale(f,f),n.translate(m/2,g/2),n.scale(xe.zoom,xe.zoom);const b=a.getOrigin();n.translate(-(xe.x-b.x),-(xe.y-b.y)),a.draw(n,s,l??void 0);const S=u?.saunojas;S&&Array.isArray(S.units)&&S.units.length>0&&S.draw(n,S.units,{originX:b.x,originY:b.y,hexRadius:a.hexSize,zoom:xe.zoom,resolveRenderCoord:S.resolveRenderCoord}),Qw(n,a,s,r,b,u?.fx,u?.friendlyVisionSources,u?.saunaVision??u?.sauna??null),u?.sauna&&Gw(n,u.sauna,{origin:b,hexSize:a.hexSize}),n.restore()}function Qw(n,a,s,r,l,u,f,h){const m=(f??r).filter(b=>b.faction==="player"&&!b.isDead()).map(b=>({coord:b.coord,range:b.getVisionRange()})),g=Xw(h);g&&m.push(g);for(const b of r){if(b.isDead()||b.faction==="enemy"&&!m.some(({coord:P,range:ie})=>Zs(P,b.coord)<=ie))continue;const S=s[`unit-${b.type}`]??s.placeholder,E=b.getMaxHealth();n.save();const M=u?.getUnitAlpha?.(b);if(typeof M=="number"){const P=Math.min(1,Math.max(0,M));if(P<=0){n.restore();continue}n.globalAlpha*=P}b.stats.health/E<.5&&(n.filter="saturate(0)");const N=b.renderCoord??b.coord,_=$w({coord:N,hexSize:a.hexSize,origin:l,zoom:xe.zoom,type:b.type}),U=[];b.stats.health/E<.5&&U.push("saturate(0)");const H=Math.abs(N.q-b.coord.q),I=Math.abs(N.r-b.coord.r),$=Math.min(1,H+I);$>.01?(U.push("contrast(1.08)"),n.shadowColor="rgba(255, 255, 255, 0.28)",n.shadowBlur=Math.max(6,12*xe.zoom*$)):(n.shadowColor="rgba(0, 0, 0, 0)",n.shadowBlur=0),n.filter=U.length>0?U.join(" "):"none",n.drawImage(S,_.drawX,_.drawY,_.width,_.height),nm()&&b.faction==="player"&&(n.strokeStyle="rgba(255,255,255,0.5)",n.lineWidth=2,n.strokeRect(_.drawX,_.drawY,_.width,_.height)),n.restore()}}const Pw=200,l2=.001;function Vf(n){return{q:n.q,r:n.r}}function Mc(n,a){return!n||!a?!1:Math.abs(n.q-a.q)<l2&&Math.abs(n.r-a.r)<l2}class Zw{constructor(a){this.redraw=a}tracks=new Map;rafId=null;enqueue(a,s){const r=this.normalizePath(s);if(r.length<2){this.clear(a,{snap:!0});return}const l=r[0];let u=this.tracks.get(a.id);u?u.current?Mc(u.current.to,l)||(u=this.resetTrack(a,l)):Mc(a.renderCoord,l)||(u=this.resetTrack(a,l)):(u={unit:a,queue:[]},this.tracks.set(a.id,u),Mc(a.renderCoord,l)||a.setRenderCoord(l));for(let f=1;f<r.length;f++)u.queue.push(Vf(r[f]));this.ensureRunning()}clear(a,s){if(!this.tracks.delete(a.id)){s?.snap&&(a.snapRenderToCoord(),this.redraw());return}(s?.snap??!0)&&(a.snapRenderToCoord(),this.redraw()),this.tracks.size===0&&this.rafId!==null&&(typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null)}clearAll(){for(const a of this.tracks.values())a.unit.snapRenderToCoord();this.tracks.clear(),this.rafId!==null&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null,this.redraw()}resetTrack(a,s){this.clear(a,{snap:!1});const r={unit:a,queue:[]};return this.tracks.set(a.id,r),a.setRenderCoord(s),r}ensureRunning(){this.rafId!==null||this.tracks.size===0||(this.rafId=requestAnimationFrame(this.step))}normalizePath(a){const s=[];for(const r of a){const l=Vf(r);(s.length===0||!Mc(s[s.length-1],l))&&s.push(l)}return s}ease(a){return a<=0?0:a>=1?1:a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2}step=a=>{if(this.rafId=null,this.tracks.size===0)return;let s=!1;for(const[r,l]of this.tracks){if(!l.current){const S=l.queue.shift();if(!S){this.tracks.delete(r);continue}l.current={from:Vf(l.unit.renderCoord??l.unit.coord),to:S,start:a}}const u=l.current;if(!u)continue;const h=(a-u.start)/Pw,p=Math.min(1,Math.max(0,h)),m=this.ease(p),g=u.from.q+(u.to.q-u.from.q)*m,b=u.from.r+(u.to.r-u.from.r)*m;l.unit.setRenderCoord({q:g,r:b}),s=!0,p>=1&&(l.unit.setRenderCoord(u.to),l.current=void 0,l.queue.length===0&&this.tracks.delete(r))}s&&this.redraw(),this.tracks.size>0&&(this.rafId=requestAnimationFrame(this.step))}}const Jw=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,Ww=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null,eA=900,tA=650;function nA(n){switch(n){case"down":return{x:0,y:36};case"left":return{x:-26,y:-18};case"right":return{x:26,y:-18};case"up":default:return{x:0,y:-40}}}function aA(n){const a=document.createElement("div");a.className="ui-floater-layer",n.appendChild(a);const s=!!Jw?.matches,r=!!Ww?.matches;return{spawn:({text:f,x:h,y:p,color:m,direction:g="up",durationMs:b,fontSize:S})=>{const E=document.createElement("span");E.className="ui-floater",E.textContent=f,E.style.left=`${Math.round(h)}px`,E.style.top=`${Math.round(p)}px`,m&&(E.style.color=m),S&&(E.style.fontSize=`${S}px`);const M=r?12:24;for(;a.childElementCount>=M;)a.firstElementChild?.remove();a.appendChild(E);const N=b??(r?tA:eA);if(s||!E.animate){E.style.opacity="0",E.style.transition=`opacity ${Math.round(N*.8)}ms ease-out`,requestAnimationFrame(()=>{E.style.opacity="1",requestAnimationFrame(()=>{E.style.opacity="0"})}),window.setTimeout(()=>{E.remove()},N);return}const _=nA(g),U=[{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:0},{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:1,offset:.18},{transform:`translate3d(-50%, -50%, 0) translate3d(${_.x}px, ${_.y}px, 0)`,opacity:0}],H=E.animate(U,{duration:N,easing:"cubic-bezier(0.18, 0.89, 0.32, 1.28)",fill:"forwards"});H.onfinish=()=>{E.remove()}},destroy:()=>{a.remove()}}}const c2=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),iA=new Intl.NumberFormat("en-US",{maximumFractionDigits:1,minimumFractionDigits:0});function u2(n){return 1-(1-n)*(1-n)}function xc(n,a,s){return Math.min(s,Math.max(a,n))}const sA="var(--color-danger)",rA="color-mix(in srgb, #34d399 88%, white 12%)",oA=720,lA=540,cA=220,uA=180,dA=6,fA=3,hA="color-mix(in srgb, #fbbf24 82%, white 10%)",mA=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,pA=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null;function gA(n){const{canvas:a,overlay:s,mapRenderer:r,getUnitById:l,requestDraw:u}=n,f=aA(s),h=new Map,p=new Map,m=[],g={x:0,y:0},b=!!mA?.matches,S=!!pA?.matches,E=S?lA:oA,M=S?uA:cA,N=S?fA:dA,_=()=>{u&&(typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>u()):u())},U=Y=>{const R=a.getBoundingClientRect(),k=s.getBoundingClientRect();if(R.width===0||R.height===0)return null;const{x:A,y:F}=aa(Y,r.hexSize),B=(A-xe.x)*xe.zoom+R.width/2,T=(F-xe.y)*xe.zoom+R.height/2,G=r.hexSize*xe.zoom*.75;return{x:B+(R.left-k.left),y:T+(R.top-k.top)-G}},H=(Y,R,k,A="up")=>{const F=l(Y);if(!F)return;const B=U(F.renderCoord??F.coord);B&&f.spawn({text:R,x:B.x,y:B.y,color:k,direction:A,fontSize:S?18:void 0})},I=Y=>{if(!Y||Y.amount<=0)return;const R=c2.format(Math.max(1,Math.round(Y.amount)));if(H(Y.targetId,`-${R}`,sA,"up"),!b){const k=typeof performance<"u"?performance.now():Date.now();m.push({start:k,duration:M,intensity:N,seedX:Math.random()*500,seedY:Math.random()*500})}_()},$=Y=>{if(!Y||Y.amount<=0)return;const R=Y.amount>=1?c2.format(Math.round(Y.amount)):iA.format(xc(Y.amount,0,9.9));H(Y.unitId,`+${R}`,rA,"up"),_()},P=Y=>{if(!Y)return;const R=typeof performance<"u"?performance.now():Date.now();h.set(Y.unitId,{start:R,duration:E}),H(Y.unitId,"",hA,"down"),_()};return ne.on("unitDamaged",I),ne.on("unitHealed",$),ne.on("unitDied",P),{step:Y=>{if(b)g.x=0,g.y=0;else{let R=0,k=0;for(let A=m.length-1;A>=0;A--){const F=m[A],B=Y-F.start;if(B>=F.duration){m.splice(A,1);continue}const T=xc(B/F.duration,0,1),G=F.intensity*u2(1-T);R+=Math.sin((Y+F.seedX)/16)*G,k+=Math.cos((Y+F.seedY)/18)*G}g.x=R,g.y=k}for(const[R,k]of h){const A=Y-k.start,F=xc(A/k.duration,0,1),B=1-u2(F);if(F>=1){p.delete(R),h.delete(R);continue}p.set(R,xc(B,0,1))}},getShakeOffset:()=>({x:g.x,y:g.y}),getUnitAlpha:Y=>p.get(Y)??1,dispose:()=>{ne.off("unitDamaged",I),ne.off("unitHealed",$),ne.off("unitDied",P),m.length=0,h.clear(),p.clear(),f.destroy()}}}function yA(){return`${"/".endsWith("/")?"/":"//"}${"assets/units/saunoja.svg".replace(/^\/+/,"")}`}const d2=yA();let Ws=null,bo=null;function Ch(n){return!!(n&&n.complete&&n.naturalWidth>0&&n.naturalHeight>0)}function bA(n,a){if(!a)return n;try{a(n)}catch(s){console.error("Saunoja icon onLoad callback failed",s)}return n}function Zb(n){const a=r=>n?r.then(l=>bA(l,n)):r;if(Ch(Ws))return a(Promise.resolve(Ws));if(bo)return a(bo);if(typeof Image>"u")return Promise.reject(new Error("Image constructor is not available in this environment."));const s=new Image;return s.decoding="async",Ws=s,bo=new Promise((r,l)=>{const u=()=>{s.onload=null,s.onerror=null},f=()=>{u(),r(s)};s.onload=f,s.onerror=h=>{u(),Ws=null,bo=null;const p=new Error(`Failed to load saunoja icon from ${d2}`);console.warn(p.message,h),l(p)},s.src=d2,Ch(s)&&f()}),a(bo)}function vA(n,a,{originX:s=0,originY:r=0,hexRadius:l=dr,zoom:u=1,resolveRenderCoord:f}={}){if(!n||!Array.isArray(a)||a.length===0)return;const h=Ch(Ws)?Ws:null;if(!h)return;const p=Number.isFinite(l)&&l>0?l:dr,m=p*.965,g=a.map(b=>{const S=f?.(b),M=S&&typeof S=="object"&&Number.isFinite(S.q)&&Number.isFinite(S.r)?{q:S.q,r:S.r}:b.coord;return{unit:b,coord:M}}).sort((b,S)=>b.coord.r!==S.coord.r?b.coord.r-S.coord.r:b.coord.q!==S.coord.q?b.coord.q-S.coord.q:b.unit.id.localeCompare(S.unit.id));for(const{unit:b,coord:S}of g){const{x:E,y:M}=Fw({coord:S,hexSize:p,origin:{x:s,y:r},zoom:u,type:"saunoja"});n.save(),Co(n,E,M,m),n.clip();const N=h.naturalWidth||1,_=h.naturalHeight||1,U=m*1.85,H=m*2.4,I=Math.min(U/N,H/_),$=ta(N*I,u),P=ta(_*I,u),ie=ta(E-$/2,u),se=ta(M-P*.78,u);n.save(),n.filter="saturate(112%) contrast(108%) brightness(1.04)",n.drawImage(h,ie,se,$,P),n.restore(),n.save(),n.globalCompositeOperation="multiply";const oe=n.createRadialGradient(E,M+m*.38,m*.2,E,M+m*.38,m*1.05);oe.addColorStop(0,"rgba(22, 30, 50, 0.58)"),oe.addColorStop(1,"rgba(22, 30, 50, 0)"),n.fillStyle=oe,n.fillRect(E-m,M-m,m*2,m*2),n.restore(),n.save(),n.globalCompositeOperation="soft-light";const ee=n.createLinearGradient(E,M-m,E,M+m);ee.addColorStop(0,"rgba(233, 224, 255, 0.28)"),ee.addColorStop(.52,"rgba(196, 148, 255, 0.26)"),ee.addColorStop(1,"rgba(94, 75, 168, 0.35)"),n.fillStyle=ee,n.fillRect(E-m,M-m,m*2,m*2),n.restore(),n.save(),n.globalCompositeOperation="screen",n.globalAlpha=.68;const Y=n.createRadialGradient(E,M-m*.68,m*.1,E,M,m*1.12);Y.addColorStop(0,"rgba(255, 255, 255, 0.85)"),Y.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=Y,n.fillRect(E-m,M-m,m*2,m*2),n.restore();const k=performance.now()-b.lastHitAt,A=120;if(k<A){const T=1-k/A;t3(n,{centerX:E,centerY:M,radius:m,progress:T})}n.restore(),n3(n,{centerX:E,centerY:M-p*.18,radius:p*.94,intensity:b.steam});const F=p*.42,B=M+p*.34;e3(n,{centerX:E,centerY:B,hp:b.hp,maxHp:b.maxHp,radius:F})}}const SA=["Resolute Sauna Guardian","Steam Scholar","Frost-Hardened","Loyal Watchbearer","Aura Whisperer","Shield Brother","Stonefooted Scout","Sisu-Forged Veteran","Brewmaster Quartermaster","Icebreaker Herald","Runic Tactician","Torchbearer"],EA=["Heat Fickle","Soot Allergic","Slow to Spark","Overconfident","Distracted Dreamer","Stubborn Stoker","Thirsty Between Battles","Clumsy Footwork","Rust-Prone Gear","Echo-Lost Listener"];function f2(n,a,s){const r=[...n],l=[],u=Math.max(0,Math.min(a,r.length));for(let f=0;f<u;f++){const h=Math.floor(s()*r.length),[p]=r.splice(h,1);p&&l.push(p)}return l}function MA(n,a){for(let s=n.length-1;s>0;s--){const r=Math.floor(a()*(s+1));[n[s],n[r]]=[n[r],n[s]]}return n}function xA(n=Math.random){typeof n!="function"&&(n=Math.random);const a=f2(SA,2,n),s=f2(EA,1,n),r=[...a,...s];return MA(r,n).map(l=>l.trim()).filter(l=>l.length>0)}const wA=1;function vo(n,a=0){return Number.isFinite(n)?n:a}function AA(n){const{heat:a,pickSpawnTile:s,spawnUnit:r,maxSpawns:l,tierHelpers:u}=n,f=Math.max(wA,ar),h=Math.max(0,vo(n.minUpkeepReserve??f,f));let p=Math.max(0,vo(n.availableUpkeep,0));const m=Math.max(0,Math.floor(vo(l??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY))),g=vo(n.rosterCap??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),b=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.POSITIVE_INFINITY,S=typeof n.getRosterCount=="function"?n.getRosterCount:()=>0;let E=0,M=0,N=0,_=0,U=0,H=0,I=0;for(;(a.hasTriggerReady()||u?.hasQueuedSpawn())&&E<m;){E+=1;const $=u?.getSnapshot()??null;if(Math.max(0,Math.floor(vo(S()??0,0)))>=b){H+=1;let ee=!1;$&&u&&(ee=u.queueBlockedSpawn($,()=>a.consumeTrigger())),ee?M+=a.vent(.15):M+=a.vent(.35);break}let ie=!1;if($&&u&&u.hasQueuedSpawn()&&(ie=u.takeQueuedSpawn($)),!ie&&!a.hasTriggerReady())break;if(p<h){_+=1,ie&&$&&u?.restoreQueuedSpawn($),M+=a.vent(.5);break}const se=s();if(!se){U+=1,ie&&$&&u?.restoreQueuedSpawn($),M+=a.vent(.25);break}if(!r(se)){I+=1,ie&&$&&u?.restoreQueuedSpawn($),M+=a.vent(.25);break}if(!ie&&!a.consumeTrigger()){I+=1;break}N+=1,p=Math.max(0,p-h),$&&u?.onSpawnResolved?.($,{usedQueue:ie})}return{spawned:N,blockedByUpkeep:_,blockedByPosition:U,blockedByRoster:H,failedSpawns:I,ventedHeat:M,remainingUpkeep:p}}function Xf(n,a=0){return Number.isFinite(n)?n:a}function CA(n){const a=Math.max(0,Xf(n.dt,0)),{addedHeat:s,cooledHeat:r}=n.heat.advance(a);let l=0;for(const E of n.units){if(E.isDead()||E.faction!=="player")continue;const M=Math.max(0,Xf(n.getUnitUpkeep(E),0));M>0&&(l+=M)}const u=5;let h=Math.max(0,Xf(n.sauna.beerUpkeepAccumulator,0)),p=0;if(l>0){if(h+=a,h>=u){const E=Math.floor(h/u);p=l*E,h-=E*u}}else h=0;n.sauna.beerUpkeepAccumulator=h,p>0&&n.state.addResource(ae.SAUNA_BEER,-p);const m=n.state.getResource(ae.SAUNA_BEER),g=AA({heat:n.heat,availableUpkeep:m,pickSpawnTile:n.pickSpawnTile,spawnUnit:n.spawnBaseUnit,minUpkeepReserve:n.minUpkeepReserve,maxSpawns:n.maxSpawns,rosterCap:n.rosterCap,getRosterCount:n.getRosterCount,tierHelpers:n.tierHelpers}),b=n.heat.getCooldownSeconds(),S=n.heat.timeUntilNextTrigger();return n.sauna.heat=n.heat.getHeat(),n.sauna.playerSpawnThreshold=n.heat.getThreshold(),n.sauna.playerSpawnCooldown=Number.isFinite(b)?b:0,n.sauna.playerSpawnTimer=Number.isFinite(S)?S:0,n.sauna.heatPerTick=n.heat.getBuildRate(),{addedHeat:s,cooledHeat:r,upkeepDrain:p,spawn:g,beerRemaining:n.state.getResource(ae.SAUNA_BEER),availableUpkeep:g.remainingUpkeep}}function TA(){try{return globalThis.localStorage??null}catch(n){return console.warn("Unable to access localStorage for inventory persistence",n),null}}function _A(n,a){const s=n.getItem(a);if(s)try{return JSON.parse(s)}catch(r){console.warn(`Failed to parse persisted inventory for "${a}", clearing.`,r),n.removeItem(a);return}}function wc(n,a,s){const r=Number.isFinite(n.quantity)?n.quantity:1,l=Math.max(1,Math.round(r)),u=typeof n.rarity=="string"?n.rarity.trim():void 0,f=typeof n.icon=="string"?n.icon:void 0,h=typeof n.description=="string"?n.description:void 0;return{id:n.id,name:n.name,description:h,icon:f,rarity:u,quantity:l,acquiredAt:a,sourceTableId:s?.tableId,sourceEntryId:s?.entryId}}class RA{listeners=new Set;storageKey;now;maxStashSize;storage;autoEquip;stash=[];inventory=[];constructor(a={}){this.storageKey=a.storageKey??"autobattles:inventory",this.now=typeof a.now=="function"?a.now:()=>Date.now(),this.maxStashSize=Math.max(1,Math.floor(a.maxStashSize??24)),this.storage=TA(),this.autoEquip=a.autoEquip??!0,this.load()}load(){if(!this.storage)return;const a=_A(this.storage,this.storageKey);if(a){if(typeof a.autoEquip=="boolean"&&(this.autoEquip=a.autoEquip),Array.isArray(a.stash)){const s=[];for(const r of a.stash){if(!r||typeof r!="object")continue;const{id:l,name:u,quantity:f}=r;if(typeof l!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(wc({id:l,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.stash=s.slice(0,this.maxStashSize)}if(Array.isArray(a.inventory)){const s=[];for(const r of a.inventory){if(!r||typeof r!="object")continue;const{id:l,name:u,quantity:f}=r;if(typeof l!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(wc({id:l,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.inventory=s}}}persist(){if(!this.storage)return;const a={autoEquip:this.autoEquip,stash:this.stash.map(s=>({...s})),inventory:this.inventory.map(s=>({...s}))};try{this.storage.setItem(this.storageKey,JSON.stringify(a))}catch(s){console.warn("Failed to persist inventory state",s)}}emit(a){for(const s of this.listeners)s(a)}normalizeEquipResult(a){return typeof a=="boolean"?{success:a}:!a||typeof a!="object"?{success:!1}:{success:!!a.success,comparison:a.comparison,reason:a.reason}}on(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}isAutoEquipEnabled(){return this.autoEquip}setAutoEquip(a){this.autoEquip!==a&&(this.autoEquip=a,this.persist(),this.emit({type:"settings-updated",autoEquip:this.autoEquip}))}getStash(){return this.stash.map(a=>({...a}))}getStashSize(){return this.stash.length}getInventory(){return this.inventory.map(a=>({...a}))}getInventorySize(){return this.inventory.length}addLoot(a,s={}){return this.addItem({...a.item},{...s,sourceTableId:s.sourceTableId,sourceEntryId:s.sourceEntryId??a.entryId})}addItem(a,s={}){const r=Math.max(0,Math.round(this.now())),l=wc(a,r,{tableId:s.sourceTableId,entryId:s.sourceEntryId}),u=s.autoEquip??this.autoEquip;let f={success:!1};if(u&&s.unitId&&typeof s.equip=="function"){try{f=this.normalizeEquipResult(s.equip(s.unitId,l))}catch(h){console.warn("Failed to auto-equip inventory item",{item:l,error:h}),f={success:!1}}if(f.success)return this.persist(),this.emit({type:"item-acquired",item:l,equipped:!0,location:"equipped",unitId:s.unitId,stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:l,equipped:!0,location:"equipped"}}if(this.stash.push(l),this.stash.length>this.maxStashSize){const h=this.stash.splice(0,this.stash.length-this.maxStashSize);h.length>0&&console.warn("Inventory stash full, trimming oldest items",h)}return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-acquired",item:l,equipped:!1,unitId:s.unitId,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:l,equipped:!1,location:"stash",stashIndex:this.stash.length-1}}equipFromStash(a,s,r){if(a<0||a>=this.stash.length)return!1;const l=this.stash[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,l))}catch(h){console.warn("Failed to equip stash item",{item:l,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}equipFromInventory(a,s,r){if(a<0||a>=this.inventory.length)return!1;const l=this.inventory[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,l))}catch(h){console.warn("Failed to equip inventory item",{item:l,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}moveToInventory(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.inventory.push(s),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-moved",item:s,from:"stash",to:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}moveToStash(a){if(this.stash.length>=this.maxStashSize||a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.stash.push(s),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-moved",item:s,from:"inventory",to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}discardFromInventory(a){if(a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-discarded",item:s,location:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}unequipToStash(a,s,r){if(this.stash.length>=this.maxStashSize)return!1;let l=null;try{l=r(a,s)??null}catch(h){console.warn("Failed to unequip item",{unitId:a,slot:s,error:h}),l=null}if(!l)return!1;const u=Math.max(0,Math.round(this.now())),f=wc(l,u);return this.stash.push(f),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-unequipped",item:f,unitId:a,slot:s,to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),!0}discardFromStash(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-discarded",item:s,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}}const h2={toast:990},NA={stash:"Quartermaster Stash",inventory:"Ready Inventory"},kA={stash:"Your stash is empty. Conquer enemy elites to gather new equipment.",inventory:"No gear staged. Move items into the ready inventory for quick equipping."},DA={mythic:6,legendary:5,epic:4,rare:3,uncommon:2,common:1},LA=["health","attackDamage","attackRange","movementRange","defense","shield"],UA={"birch-sap-satchel":["healing","support"],"steamed-bandages":["restoration","shielding"],"aurora-distillate":["damage","defense"],"stolen-sauna-tokens":["mobility"],"midnight-bloodwine":["healing","damage"],"sauna-incense":["range","focus"],"glacier-brand":["damage"],"emberglass-arrow":["damage","range"],"aurora-lattice":["damage","range"],"emberglass-shard":["damage","mobility"],"windstep-totem":["mobility","defense"],"searing-chant-censer":["damage","shielding"],"cracked-ice-amulet":["defense"],"myrsky-charm":["range","defense"],"frostwyrm-signet":["shielding"],"spirit-oak-charm":["healing","defense"]};function Ia(n){return(n??"").trim().toLowerCase()}function Kf(n){const a=new Set;for(const s of n){const r=Ia(s);r&&a.add(r)}return a}function Qf(n,a){return{id:n.id,name:n.name,quantity:typeof a=="number"?a:n.quantity,rarity:n.rarity}}function Ac(n){return n?{id:n.id,name:n.name,quantity:n.quantity,rarity:n.rarity}:null}function m2(n){return UA[n]??[]}function p2(n){const a=Ia(n)||"common",s=a.charAt(0).toUpperCase()+a.slice(1);return{key:a,label:s,rank:DA[a]??0}}function OA(n){const a=Io(n.id);if(!a){const l=p2(n.rarity);return{slot:null,slotLabel:"Unassigned",rarity:l.key,rarityRank:l.rank,tags:m2(n.id),acquiredAt:n.acquiredAt}}const s=jo(a.slot),r=p2(n.rarity);return{slot:a.slot,slotLabel:s.label,rarity:r.key,rarityRank:r.rank,tags:m2(n.id),acquiredAt:n.acquiredAt}}function qA(n,a,s,r,l){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:l,slot:a,maxStacks:s,modifiers:r??{}}}function g2(n,a){const s=n[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function zA(n,a){const s=Io(n.item.id);if(!s)return{slot:null,canEquip:!1,reason:"unknown-item",equipped:null,projected:Qf(n.item),stats:[]};const r=s.slot,l=jo(r),u=a.loadout.find(_=>_.slot===r)??null,f=Math.max(1,Math.round(n.item.quantity)),h=Math.max(1,Math.floor(s.maxStacks??l.maxStacks)),p=(u?.quantity??0)+f,m=p>h;if(u&&u.id!==n.item.id)return{slot:r,canEquip:!1,reason:"slot-occupied",equipped:Ac(u),projected:Qf(n.item),stats:[]};if(m&&(!u||u.id!==n.item.id))return{slot:r,canEquip:!1,reason:"stack-limit",equipped:Ac(u),projected:Qf(n.item,Math.min(h,p)),stats:[]};const g=Math.min(h,p),b=[];for(const _ of a.loadout)_.slot!==r&&b.push({..._});const S=u&&u.id===n.item.id?{...u,quantity:g}:qA(n.item,r,h,s.modifiers,g);b.push(S);const E=a.currentStats??Ic(a.baseStats,a.loadout),M=Ic(a.baseStats,b),N=LA.map(_=>{const U=g2(E,_),H=g2(M,_);return{stat:_,current:U,projected:H,delta:H-U}});return{slot:r,canEquip:!0,equipped:Ac(u),projected:Ac(S),stats:N}}function y2(n,a){return n.map((s,r)=>({item:s,index:r,location:a,metadata:OA(s)}))}function BA(n,a){const s=new Map,r=new Map,l=new Map;for(const p of n){const{metadata:m}=p;if(m.slot){const E=m.slot,M=s.get(E);M?M.count+=1:s.set(E,{label:m.slotLabel,count:1})}const g=m.rarity,b=g.charAt(0).toUpperCase()+g.slice(1),S=r.get(g);S?S.count+=1:r.set(g,{label:b,count:1,rank:m.rarityRank});for(const E of m.tags){const M=Ia(E);if(!M)continue;const N=E.split(/[-_]/g).map(U=>U.charAt(0).toUpperCase()+U.slice(1)).join(" "),_=l.get(M);_?_.count+=1:l.set(M,{label:N,count:1})}}const u=Array.from(s.entries()).sort((p,m)=>{const g=ur.indexOf(p[0]),b=ur.indexOf(m[0]);return g-b}).map(([p,m])=>({id:p,label:m.label,count:m.count,active:a.slots.has(Ia(p))})),f=Array.from(r.entries()).sort((p,m)=>(m[1].rank??0)-(p[1].rank??0)).map(([p,m])=>({id:p,label:m.label,count:m.count,active:a.rarities.has(Ia(p))})),h=Array.from(l.entries()).sort((p,m)=>p[1].label.localeCompare(m[1].label)).map(([p,m])=>({id:p,label:m.label,count:m.count,active:a.tags.has(Ia(p))}));return{slots:u,rarities:f,tags:h}}function HA(n,a){if(a.slots.size>0){const s=n.metadata.slot?Ia(n.metadata.slot):"";if(!s||!a.slots.has(s))return!1}return!(a.rarities.size>0&&!a.rarities.has(n.metadata.rarity)||a.tags.size>0&&!n.metadata.tags.map(l=>Ia(l)).some(l=>a.tags.has(l)))}function jA(n,a){return a?[n.item.name,n.item.description??"",n.metadata.tags.join(" ")].join(" ").toLowerCase().includes(a):!0}function IA(n,a){switch(a){case"oldest":n.sort((s,r)=>s.metadata.acquiredAt-r.metadata.acquiredAt);break;case"rarity":n.sort((s,r)=>r.metadata.rarityRank!==s.metadata.rarityRank?r.metadata.rarityRank-s.metadata.rarityRank:r.metadata.acquiredAt-s.metadata.acquiredAt);break;case"name":n.sort((s,r)=>s.item.name.localeCompare(r.item.name));break;case"newest":default:n.sort((s,r)=>r.metadata.acquiredAt-s.metadata.acquiredAt);break}}function b2(n){const a={slots:Kf(n.filters.slots??new Set),rarities:Kf(n.filters.rarities??new Set),tags:Kf(n.filters.tags??new Set)},s=Ia(n.search),r=Math.max(1,Math.floor(n.page||1)),l=Math.max(1,Math.floor(n.pageSize||24)),u=n.collection??"stash",f=y2(n.stash,"stash"),h=y2(n.inventory,"inventory"),p=[...f,...h],m=BA(p,a),g=u==="stash"?f:h,S=[...g.filter(I=>HA(I,a)&&jA(I,s))];IA(S,n.sort??"newest");const E=Math.min(S.length,r*l),M=S.slice(0,E),N=S.length>E,_=n.comparisonContext??null,U=M.map(I=>({item:I.item,index:I.index,location:I.location,metadata:I.metadata,comparison:_?zA(I,_):null})),H=["stash","inventory"].map(I=>({id:I,label:NA[I],count:I==="stash"?n.stash.length:n.inventory.length,active:I===u}));return{collection:u,collections:H,filters:m,items:U,total:g.length,filteredTotal:S.length,search:n.search,sort:n.sort??"newest",hasMore:N,emptyMessage:kA[u]}}function GA(){return{slots:new Set,rarities:new Set,tags:new Set}}const YA="_panel_7op0d_1",FA="_header_7op0d_32",$A="_title_7op0d_42",VA="_meta_7op0d_49",XA="_close_7op0d_54",KA="_controls_7op0d_74",QA="_settings_7op0d_82",PA="_settingRow_7op0d_93",ZA="_settingCopy_7op0d_107",JA="_settingLabel_7op0d_114",WA="_settingHint_7op0d_120",e5="_settingControl_7op0d_127",t5="_settingState_7op0d_133",n5="_settingInput_7op0d_143",a5="_settingSwitch_7op0d_149",i5="_settingTrack_7op0d_169",s5="_settingThumb_7op0d_181",r5="_collections_7op0d_197",o5="_collectionButton_7op0d_205",l5="_searchRow_7op0d_234",c5="_search_7op0d_234",u5="_searchIcon_7op0d_266",d5="_sortSelect_7op0d_276",f5="_body_7op0d_286",h5="_grid_7op0d_292",m5="_empty_7op0d_301",p5="_footer_7op0d_312",g5="_loadMore_7op0d_317",ze={panel:YA,header:FA,title:$A,meta:VA,close:XA,controls:KA,settings:QA,settingRow:PA,settingCopy:ZA,settingLabel:JA,settingHint:WA,settingControl:e5,settingState:t5,settingInput:n5,settingSwitch:a5,settingTrack:i5,settingThumb:s5,collections:r5,collectionButton:o5,searchRow:l5,search:c5,searchIcon:u5,sortSelect:d5,body:f5,grid:h5,empty:m5,footer:p5,loadMore:g5},y5="_group_18afl_1",b5="_label_18afl_11",v5="_row_18afl_19",S5="_chip_18afl_25",E5="_count_18afl_55",No={group:y5,label:b5,row:v5,chip:S5,count:E5},M5="_card_1o0cv_1",x5="_header_1o0cv_26",w5="_icon_1o0cv_32",A5="_details_1o0cv_44",C5="_titleRow_1o0cv_51",T5="_title_1o0cv_51",_5="_rarity_1o0cv_63",R5="_slot_1o0cv_70",N5="_tags_1o0cv_75",k5="_tag_1o0cv_75",D5="_compare_1o0cv_91",L5="_tooltip_1o0cv_113",U5="_statList_1o0cv_144",O5="_stat_1o0cv_144",q5="_actions_1o0cv_169",z5="_action_1o0cv_169",B5="_primary_1o0cv_198",H5="_danger_1o0cv_209",j5="_badge_1o0cv_224",ot={card:M5,header:x5,icon:w5,details:A5,titleRow:C5,title:T5,rarity:_5,slot:R5,tags:N5,tag:k5,compare:D5,tooltip:L5,statList:U5,stat:O5,actions:q5,action:z5,primary:B5,danger:H5,badge:j5},I5={health:"HP",attackDamage:"ATK",attackRange:"Range",movementRange:"Move",defense:"Defense",shield:"Shield"},v2={"slot-occupied":"Slot occupied. Unequip the current item first.","stack-limit":"Stack limit reached for this item.","unknown-item":"This item cannot be equipped yet."},Lc=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function G5(n,a){if(a.item.icon){const r=document.createElement("img");r.src=a.item.icon,r.alt="",r.loading="lazy",r.decoding="async",r.width=48,r.height=48,n.appendChild(r);return}const s=document.createElement("span");s.textContent=a.item.name.trim()[0]?.toUpperCase()??"?",n.appendChild(s)}function Jb(n){if(!(!n||n.canEquip))return n.reason&&v2[n.reason]?v2[n.reason]:"Unable to equip this item right now."}function Y5(n,a){const s=document.createElement("div");s.className=ot.tooltip;const r=document.createElement("h4");if(a.projected?r.textContent=a.canEquip?"Projected stats":"Current loadout":r.textContent="Stats",s.appendChild(r),!a.canEquip){const u=Jb(a);if(u){const f=document.createElement("p");f.textContent=u,f.style.margin="0 0 0.5rem",f.style.fontSize="0.78rem",s.appendChild(f)}}const l=document.createElement("ul");l.className=ot.statList;for(const u of n){const f=document.createElement("li");f.className=ot.stat,u.delta>0?f.dataset.delta="positive":u.delta<0&&(f.dataset.delta="negative");const h=document.createElement("span");h.textContent=I5[u.stat]??u.stat;const p=document.createElement("span"),m=Lc.format(u.current),g=Lc.format(u.projected),b=u.delta,S=b===0?"0":`${b>0?"+":""}${Lc.format(Math.abs(b))}`;p.textContent=`${m}  ${g} (${S})`,f.append(h,p),l.appendChild(f)}return s.appendChild(l),s}function F5(n){const a=n.comparison;if(!a)return null;const s=document.createElement("div"),r=document.createElement("button");r.type="button",r.className=ot.compare,r.textContent=a.canEquip?"Compare stats":"View details";const l=`${n.item.id}-compare-${n.location}-${n.index}`;r.setAttribute("aria-controls",l),r.setAttribute("aria-expanded","false"),r.setAttribute("aria-describedby",l),r.addEventListener("focus",()=>{r.setAttribute("aria-expanded","true")}),r.addEventListener("blur",()=>{r.setAttribute("aria-expanded","false")}),s.appendChild(r);const u=Y5(a.stats,a);return u.id=l,s.appendChild(u),s}function $5(n,a){if(a&&!a.canEquip){n.disabled=!0;const s=Jb(a);s&&(n.title=s)}}function V5(n){return n.map(a=>{const s=a.trim();return s&&s.split(/[-_\s]/g).map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")})}function X5(n,a,s){const r=document.createElement("div");r.className=ot.actions;const l=document.createElement("button");l.type="button",l.className=`${ot.action} ${ot.primary}`,l.textContent="Equip",$5(l,a.comparison),l.addEventListener("click",()=>{s.onEquip?.()}),r.appendChild(l);const u=document.createElement("button");u.type="button",u.className=ot.action,u.textContent=a.location==="stash"?"Send to inventory":"Return to stash",u.addEventListener("click",()=>{s.onTransfer?.()}),r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=`${ot.action} ${ot.danger}`,f.textContent="Trash";let h=null;const p=()=>{h!==null&&(window.clearTimeout(h),h=null),f.dataset.confirm="false",f.textContent="Trash"};f.addEventListener("click",()=>{if(h!==null){p(),s.onTrash?.();return}f.dataset.confirm="true",f.textContent="Confirm trash",h=window.setTimeout(()=>{p()},2600)}),r.appendChild(f),n.appendChild(r)}function K5(n,a){const s=document.createElement("li");s.className=ot.card,s.dataset.location=n.location,s.setAttribute("role","listitem");const r=document.createElement("div");r.className=ot.header;const l=document.createElement("div");l.className=ot.icon,G5(l,n),r.appendChild(l);const u=document.createElement("div");u.className=ot.details;const f=document.createElement("div");f.className=ot.titleRow;const h=document.createElement("h4");h.className=ot.title,h.textContent=n.item.name,f.appendChild(h);const p=document.createElement("span");p.className=ot.rarity,p.textContent=n.metadata.rarity.toUpperCase(),f.appendChild(p),u.appendChild(f);const m=document.createElement("span");if(m.className=ot.slot,m.textContent=n.metadata.slot?n.metadata.slotLabel:"No slot",u.appendChild(m),n.metadata.tags.length>0){const b=document.createElement("div");b.className=ot.tags;for(const S of V5(n.metadata.tags)){const E=document.createElement("span");E.className=ot.tag,E.textContent=S,b.appendChild(E)}u.appendChild(b)}const g=F5(n);if(g&&u.appendChild(g),r.appendChild(u),s.appendChild(r),n.item.quantity>1){const b=document.createElement("span");b.className=ot.badge,b.textContent=`${Lc.format(n.item.quantity)}`,s.appendChild(b)}return X5(s,n,a),s}const Q5={newest:"Newest",oldest:"Oldest",rarity:"Rarity",name:"Name A-Z"};function Pf(n){const a=document.createElement("div");a.className=No.row;const s=document.createElement("div");s.className=No.label,s.textContent=n;const r=document.createElement("div");return r.className=No.group,a.append(s,r),{row:a,group:r}}function P5(n){const a=document.createElement("section");a.className=ze.panel,a.tabIndex=-1,a.dataset.open="false",a.setAttribute("aria-label","Quartermaster stash");const s=document.createElement("header");s.className=ze.header;const r=document.createElement("div"),l=document.createElement("h2");l.className=ze.title,l.textContent="Quartermaster Stash",r.appendChild(l);const u=document.createElement("div");u.className=ze.meta,u.textContent="Loading",r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=ze.close,f.textContent="Close",f.addEventListener("click",()=>n.onClose?.()),s.append(r,f),a.appendChild(s);const h=document.createElement("div");h.className=ze.controls;const p=document.createElement("div");p.className=ze.collections;const m={stash:document.createElement("button"),inventory:document.createElement("button")};m.stash.type="button",m.stash.className=ze.collectionButton,m.stash.textContent="Stash",m.stash.addEventListener("click",()=>n.onCollectionChange?.("stash")),m.inventory.type="button",m.inventory.className=ze.collectionButton,m.inventory.textContent="Ready",m.inventory.addEventListener("click",()=>n.onCollectionChange?.("inventory")),p.append(m.stash,m.inventory),h.appendChild(p);const g=document.createElement("div");g.className=ze.searchRow;const b=document.createElement("div");b.className=ze.search;const S=document.createElement("input");S.type="search",S.placeholder="Search stash",S.addEventListener("input",()=>n.onSearchChange?.(S.value));const E=document.createElement("span");E.className=ze.searchIcon,E.textContent="",b.append(E,S),g.appendChild(b);const M=document.createElement("select");M.className=ze.sortSelect,["newest","oldest","rarity","name"].forEach(A=>{const F=document.createElement("option");F.value=A,F.textContent=Q5[A],M.appendChild(F)}),M.addEventListener("change",()=>n.onSortChange?.(M.value)),g.appendChild(M),h.appendChild(g);const N=document.createElement("div");N.className=ze.settings;const _=(A,F,B,T)=>{const G=document.createElement("div");G.className=ze.settingRow;const J=document.createElement("div");J.className=ze.settingCopy;const fe=document.createElement("span");fe.className=ze.settingLabel,fe.textContent=F,J.appendChild(fe);const x=document.createElement("p");x.className=ze.settingHint,x.textContent=B,J.appendChild(x);const V=document.createElement("div");V.className=ze.settingControl;const te=document.createElement("span");te.className=ze.settingState,te.textContent="Off";const W=document.createElement("input");W.type="checkbox",W.id=A,W.className=ze.settingInput;const le=document.createElement("label");le.className=ze.settingSwitch,le.htmlFor=A,le.dataset.state="off";const pe=document.createElement("span");pe.className=ze.settingTrack;const he=document.createElement("span");he.className=ze.settingThumb,le.append(pe,he);const Ge=Ae=>{W.checked=Ae,le.dataset.state=Ae?"on":"off",te.textContent=Ae?"On":"Off"};return W.addEventListener("change",()=>{Ge(W.checked),T?.(W.checked)}),V.append(te,W,le),G.append(J,V),{root:G,setChecked:Ge}},U=_("inventory-autoequip-toggle","Auto-equip loot","Try outfitting the selected attendant as soon as new gear arrives.",A=>n.onAutoEquipChange?.(A)),H=_("inventory-ui-variant-toggle","Experimental HUD","Swap to the React/Tailwind HUD. You can revert at any time.",A=>n.onUiV2Change?.(A));U.setChecked(n.getAutoEquipState?.()??!1),H.setChecked(n.getUiV2State?.()??!1),N.append(U.root,H.root),h.appendChild(N);const I=document.createElement("div"),$={slots:Pf("Slots"),rarities:Pf("Rarity"),tags:Pf("Tags")};I.append($.slots.row,$.rarities.row,$.tags.row),h.appendChild(I),a.appendChild(h);const P=document.createElement("div");P.className=ze.body;const ie=document.createElement("ul");ie.className=ze.grid;const se=document.createElement("div");se.className=ze.empty,se.textContent="No items match the current filters.",se.hidden=!0,P.append(ie,se),a.appendChild(P);const oe=document.createElement("div");oe.className=ze.footer;const ee=document.createElement("button");ee.type="button",ee.className=ze.loadMore,ee.textContent="Show more",ee.addEventListener("click",()=>n.onLoadMore?.()),oe.appendChild(ee),a.appendChild(oe);function Y(A,F,B){A.group.innerHTML="",A.row.hidden=B.length===0;for(const T of B){const G=document.createElement("button");if(G.type="button",G.className=No.chip,G.dataset.active=T.active?"true":"false",G.textContent=T.label,T.count>0){const J=document.createElement("span");J.className=No.count,J.textContent=String(T.count),G.appendChild(J)}G.addEventListener("click",()=>n.onFilterToggle?.(F,T.id)),A.group.appendChild(G)}}function R(A){ie.replaceChildren();const F=document.createDocumentFragment();for(const B of A.items){const T={onEquip:()=>n.onItemEquip?.(B),onTransfer:()=>n.onItemTransfer?.(B),onTrash:()=>n.onItemTrash?.(B)};F.appendChild(K5(B,T))}ie.appendChild(F),se.hidden=A.filteredTotal!==0,se.hidden||(se.textContent=A.emptyMessage)}return{element:a,render(A){u.textContent=A.total===0?"No items yet":`${A.filteredTotal} of ${A.total} item${A.total===1?"":"s"}`;for(const[F,B]of Object.entries(m))B.dataset.active=F===A.collection?"true":"false";S.value!==A.search&&(S.value=A.search),M.value!==A.sort&&(M.value=A.sort),Y($.slots,"slots",A.filters.slots),Y($.rarities,"rarities",A.filters.rarities),Y($.tags,"tags",A.filters.tags),R(A),ee.hidden=!A.hasMore},setOpen(A){a.dataset.open=A?"true":"false"},focus(){const A=a.focus.bind(a);try{A({preventScroll:!0})}catch(F){console.warn("Stash panel focus without scroll prevention fallback",F);try{A()}catch(B){console.warn("Unable to focus stash panel element",B)}}},destroy(){a.remove()},setAutoEquip(A){U.setChecked(A)},setUiV2(A){H.setChecked(A)}}}const Zf=24,Z5=4500,J5=400,W5={health:"HP",attackDamage:"ATK",attackRange:"RNG",movementRange:"MOV",defense:"DEF",shield:"Shield"},S2="pointer-events-none ml-auto flex w-full max-w-[min(22rem,90vw)] flex-col gap-[clamp(6px,1vw,12px)]",eC="pointer-events-auto flex w-full items-center gap-[clamp(4px,0.8vw,12px)] rounded-hud-md border border-white/15 px-4 py-3 text-[0.9rem] font-semibold leading-[1.35] shadow-[0_18px_32px_rgba(15,23,42,0.22)] backdrop-blur-[14px] backdrop-saturate-[135%] transition-all duration-300 ease-out",tC={loot:"bg-[linear-gradient(135deg,rgba(255,255,255,0.95),rgba(215,229,255,0.95))] text-slate-900",info:"bg-[linear-gradient(135deg,rgba(219,245,255,0.95),rgba(197,228,255,0.95))] text-slate-900",warn:"bg-[linear-gradient(135deg,rgba(255,231,217,0.95),rgba(255,214,196,0.95))] text-amber-900"},nC=["-translate-y-2","opacity-0"];function Zc(n){n.hidden=n.childElementCount===0}function aC(n,a){const s=n.querySelector('[data-ui="loot-toast-stack"]');if(s)return s.parentElement!==a&&a.appendChild(s),s.className=S2,s.style.zIndex=String(h2.toast),Zc(s),s;const l=(n.ownerDocument??document).createElement("div");return l.dataset.ui="loot-toast-stack",l.className=S2,l.setAttribute("aria-live","polite"),l.setAttribute("role","status"),l.style.zIndex=String(h2.toast),Zc(l),a.appendChild(l),l}function Pt(n,a,s){const r=(n.ownerDocument??document).createElement("div");r.dataset.variant=s,r.className=`${eC} ${tC[s]}`,r.textContent=a,n.appendChild(r),Zc(n);const l=()=>{r.remove(),Zc(n)},u=window.setTimeout(()=>{r.classList.add(...nC),window.setTimeout(l,J5)},Z5);r.addEventListener("click",()=>{window.clearTimeout(u),l()})}function iC(n,a){n.has(a)?n.delete(a):n.add(a)}function sC(n){const a=n.comparison?.deltas??[];return a.length===0?null:a.map(r=>{const l=W5[r.stat]??r.stat;return`${r.delta>0?"+":""}${r.delta} ${l}`}).join(", ")}function Jf(n){switch(n){case"inventory":return"ready inventory";case"stash":return"stash";case"equipped":default:return"loadout"}}function rC(){const n=document.createElement("button");n.type="button",n.dataset.testid="inventory-badge",n.dataset.ui="inventory-badge",n.className="group inline-flex items-center gap-2 rounded-hud-pill border border-white/15 bg-[linear-gradient(135deg,rgba(27,36,56,0.9),rgba(39,74,110,0.9))] px-3.5 py-2 font-semibold text-sky-50 shadow-hud-sm transition-all duration-150 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent hover:-translate-y-0.5 hover:shadow-hud-md data-[autoequip=off]:bg-[linear-gradient(135deg,rgba(56,44,25,0.9),rgba(92,72,40,0.9))]",n.setAttribute("aria-expanded","false"),n.setAttribute("aria-controls","inventory-stash-panel"),n.setAttribute("aria-label","Open quartermaster stash");const a=document.createElement("span");a.className="relative flex h-[1.65rem] w-[1.65rem] flex-shrink-0 items-center justify-center rounded-full bg-[radial-gradient(circle_at_30%_30%,rgba(255,255,255,0.9),rgba(225,235,255,0.2))] text-slate-900 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.35)]",a.setAttribute("aria-hidden","true");const s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg");r.setAttribute("viewBox","0 0 24 24"),r.setAttribute("aria-hidden","true"),r.setAttribute("focusable","false"),r.setAttribute("class","h-[76%] w-[76%]");const l=document.createElementNS(s,"path");l.setAttribute("d","M8.25 7V6a3.75 3.75 0 0 1 7.5 0v1m3 0h-14.25a1.5 1.5 0 0 0-1.485 1.342l-.75 9a3 3 0 0 0 2.985 3.158h9.78a3 3 0 0 0 2.985-3.158l-.75-9A1.5 1.5 0 0 0 18.75 7Z"),l.setAttribute("fill","rgba(194, 216, 255, 0.32)"),l.setAttribute("stroke","rgba(255, 255, 255, 0.92)"),l.setAttribute("stroke-width","1.6"),l.setAttribute("stroke-linecap","round"),l.setAttribute("stroke-linejoin","round");const u=document.createElementNS(s,"path");u.setAttribute("d","M9.75 12.25h4.5"),u.setAttribute("fill","none"),u.setAttribute("stroke","rgba(255, 255, 255, 0.85)"),u.setAttribute("stroke-width","1.4"),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("opacity","0.9"),r.append(l,u),a.appendChild(r),n.appendChild(a);const f=document.createElement("span");f.className="text-[0.75rem] uppercase tracking-[0.08em]",f.textContent="Stash",n.appendChild(f);const h=document.createElement("span");return h.className="min-w-[1.5rem] rounded-full bg-white/15 px-2 py-[0.1rem] text-center text-xs font-semibold text-white/90",h.textContent="0",h.setAttribute("aria-hidden","true"),n.appendChild(h),{button:n,count:h}}function oC(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{destroy:()=>{}};const{regions:r}=mr(s),l=r.top,u=aC(s,l);s.querySelectorAll('[data-testid="inventory-badge"]').forEach(k=>k.remove());const{button:f,count:h}=rC();f.dataset.autoequip=n.isAutoEquipEnabled()?"on":"off",l.appendChild(f),s.querySelector("#inventory-stash-panel")?.remove();const m=P5({onClose:()=>_(!1),onCollectionChange:k=>{b!==k&&(b=k,N=1,H())},onFilterToggle:(k,A)=>{const F=S[k];iC(F,A),N=1,H()},onSearchChange:k=>{E=k,N=1,H()},onSortChange:k=>{M=k,N=1,H()},onLoadMore:()=>{N+=1,H()},onItemEquip:k=>{$(k)},onItemTransfer:k=>{P(k)},onItemTrash:k=>{ie(k)},getAutoEquipState:()=>n.isAutoEquipEnabled(),onAutoEquipChange:k=>{n.setAutoEquip(k),f.dataset.autoequip=k?"on":"off",Pt(u,k?"Auto-equip enabled. Newly recovered gear will try to arm your selected attendant.":"Auto-equip disabled. Loot will head to the stash until you equip it manually.","info")},getUiV2State:()=>a.getUseUiV2?.()??!1,onUiV2Change:k=>{a.onUseUiV2Change?.(k),Pt(u,k?"Experimental HUD enabled. Reload to try the React/Tailwind experience.":"Classic HUD restored for your next session.","info")}});m.element.id="inventory-stash-panel",s.appendChild(m.element);let g=!1,b="stash";const S=GA();let E="",M="newest",N=1;function _(k){if(g!==k)if(g=k,m.setOpen(g),f.setAttribute("aria-expanded",g?"true":"false"),f.setAttribute("aria-label",g?"Close quartermaster stash":"Open quartermaster stash"),g){s.classList.add("inventory-panel-open");try{m.focus()}catch(A){console.warn("Unable to focus stash panel",A)}}else s.classList.remove("inventory-panel-open")}function U(){const k=a.getComparisonContext?.()??null;let A=b2({stash:n.getStash(),inventory:n.getInventory(),filters:S,search:E,sort:M,page:N,pageSize:Zf,collection:b,comparisonContext:k});if(A.filteredTotal>0){const F=Math.max(1,Math.ceil(A.filteredTotal/Zf));N>F&&(N=F,A=b2({stash:n.getStash(),inventory:n.getInventory(),filters:S,search:E,sort:M,page:N,pageSize:Zf,collection:b,comparisonContext:k}))}return A}function H(){const k=U(),F=k.collections.find(B=>B.id==="stash")?.count??0;h.textContent=String(F),f.dataset.count=String(F),m.render(k)}function I(){const k=a.getSelectedUnitId?.()??null;return k||(Pt(u,"Select an attendant before equipping an item.","warn"),null)}function $(k){const A=I();if(!A)return;const F=a.onEquip??(()=>({success:!1}));(k.location==="stash"?n.equipFromStash(k.index,A,(G,J)=>F(G,J,"stash")):n.equipFromInventory(k.index,A,(G,J)=>F(G,J,"inventory")))||Pt(u,"Unable to equip that item right now.","warn")}function P(k){const A=k.location==="stash"?n.moveToInventory(k.index):n.moveToStash(k.index);if(!A){Pt(u,"Unable to move that item right now.","warn");return}const F=k.location==="stash"?"ready inventory":"stash";Pt(u,`Moved ${A.name} to the ${F}.`,"info"),N=1,H()}function ie(k){const A=k.location==="stash"?n.discardFromStash(k.index):n.discardFromInventory(k.index);if(!A){Pt(u,"That item was already removed.","warn");return}const F=k.location==="stash"?"stash":"ready inventory";Pt(u,`${A.name} discarded from the ${F}.`,"warn"),H()}function se(k){switch(k.type){case"stash-updated":case"inventory-updated":H();break;case"item-acquired":if(k.equipped)Pt(u,`${k.item.name} auto-equipped successfully.`,"info");else{const A=Jf(k.location);Pt(u,`New item secured: ${k.item.name} (${A}).`,"loot")}break;case"item-equipped":{const A=sC(k),F=A?` (${A})`:"";Pt(u,`Equipped ${k.item.name}${F}.`,"info");break}case"item-unequipped":Pt(u,`${k.item.name} returned to the stash from slot ${k.slot}.`,"info");break;case"item-moved":{const A=Jf(k.to);Pt(u,`Moved ${k.item.name} to the ${A}.`,"info");break}case"item-discarded":{const A=Jf(k.location);Pt(u,`${k.item.name} discarded from the ${A}.`,"warn");break}case"settings-updated":f.dataset.autoequip=k.autoEquip?"on":"off",m.setAutoEquip(k.autoEquip);break}}const oe=n.on(k=>se(k)),ee=()=>{_(!g)};f.addEventListener("click",ee);const Y=k=>{k.defaultPrevented||k.code==="KeyI"&&!k.metaKey&&!k.ctrlKey&&!k.altKey&&(k.preventDefault(),_(!g))};return window.addEventListener("keydown",Y),H(),{destroy:()=>{oe(),f.removeEventListener("click",ee),window.removeEventListener("keydown",Y),f.remove(),m.destroy(),s.classList.remove("inventory-panel-open"),u.hasChildNodes()||u.remove()}}}const lC=Object.freeze({common:1,uncommon:.6,rare:.35,epic:.18,legendary:.08,mythic:.03}),cC=Object.freeze({id:"general-salvage",label:"General Salvage",entries:Object.freeze([{id:"birch-sap-satchel",name:"Birch Sap Satchel",description:"Soothing birch sap that doubles as a brisk field tonic.",rarity:"common",quantity:{min:1,max:3},weight:6},{id:"steamed-bandages",name:"Steamed Linen Bandages",description:"Freshly steamed bandages infused with pine oils.",rarity:"common",quantity:1,weight:5},{id:"emberglass-shard",name:"Emberglass Shard",description:"A radiant shard used to kindle sauna braziers.",rarity:"uncommon",quantity:1,weight:3},{id:"aurora-distillate",name:"Aurora Distillate",description:"Vials of shimmering condensation that empower sauna rituals.",rarity:"rare",quantity:1,weight:1.5},{id:"myrsky-charm",name:"Myrsky Charm",description:"Storm-forged charm rumored to call down aurora flares.",rarity:"epic",quantity:1,weight:.7}])}),uC=Object.freeze({base:Object.freeze({id:"enemy-raiders",label:"Avanto Marauder Spoils",entries:Object.freeze([{id:"cracked-ice-amulet",name:"Cracked Ice Amulet",description:"Necklace of frostbitten charms that hum when danger nears.",rarity:"common",quantity:1,weight:5},{id:"stolen-sauna-tokens",name:"Stolen Sauna Tokens",description:"Pilfered entrance tokens, gladly accepted back at any sauna hall.",rarity:"uncommon",quantity:{min:2,max:5},weight:3},{id:"glacier-brand",name:"Glacier Brand",description:"A cleaver chilled in glacial meltwater that never dulls.",rarity:"rare",quantity:1,weight:1.25}])}),elite:Object.freeze({id:"enemy-champions",label:"Avanto Champion Cache",entries:Object.freeze([{id:"frostwyrm-signet",name:"Frostwyrm Signet",description:"An icy signet ring that wreathes its bearer in frozen vapour.",rarity:"epic",quantity:1,weight:1.1},{id:"aurora-lattice",name:"Aurora Lattice",description:"Filigree latticework that channels auroral light into focused beams.",rarity:"legendary",quantity:1,weight:.4},{id:"midnight-bloodwine",name:"Midnight Bloodwine",description:"A mythical draught said to rekindle a warrior's lost resolve.",rarity:"mythic",quantity:1,weight:.12}])})}),dC=Object.freeze({base:Object.freeze({id:"deepwood-offerings",label:"Deepwood Offerings",entries:Object.freeze([{id:"spirit-oak-charm",name:"Spirit Oak Charm",description:"Carved from living oak, it whispers guidance between sauna rounds.",rarity:"uncommon",quantity:1,weight:4},{id:"sauna-incense",name:"Sauna Incense Pouches",description:"Fragrant blends that steady breathing before the next engagement.",rarity:"common",quantity:{min:1,max:4},weight:5},{id:"emberglass-arrow",name:"Emberglass Arrow Bundle",description:"Arrowheads that glow amber when a perfect shot reveals itself.",rarity:"rare",quantity:{min:1,max:2},weight:1.75}])}),elite:Object.freeze({id:"deepwood-ritual-cache",label:"Deepwood Ritual Cache",entries:Object.freeze([{id:"windstep-totem",name:"Windstep Totem",description:"Totem etched with gale sigils that lighten every cautious stride.",rarity:"epic",quantity:1,weight:.9},{id:"searing-chant-censer",name:"Searing Chant Censer",description:"An ornate censer that empowers allies with smouldering hymns.",rarity:"legendary",quantity:1,weight:.35}])})}),fC=Object.freeze({enemy:uC,deepwood:dC});function hC(n){return fC[n]??{base:cC}}function mC(n,a=!1){const s=hC(n);return a&&s.elite?s.elite:s.base}function pC(n){if(!Number.isFinite(n))return 1;const a=Math.floor(n);return a<=0?0:Math.min(10,a)}function gC(n,a){if(typeof n=="number"&&Number.isFinite(n))return Math.max(1,Math.round(n));if(!n)return 1;const s=n,r=Math.max(1,Math.round(s.min)),u=Math.max(r,Math.round(s.max))-r+1,f=Math.floor(Math.max(0,Math.min(.999999,a()))*u);return r+f}function yC(n){const a=lC[n.rarity]??1,s=typeof n.weight=="number"?n.weight:1;return Math.max(0,s)*Math.max(0,a)}function bC(n,a){const s=n.map(f=>({entry:f,weight:yC(f)})).filter(f=>f.weight>0);if(s.length===0)return null;const r=s.reduce((f,h)=>f+h.weight,0),l=Math.max(0,Math.min(.999999,a()))*r;let u=0;for(const f of s)if(u+=f.weight,l<u)return f.entry;return s[s.length-1]?.entry??null}function vC(n,a){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:a}}function SC(n){const a=typeof n.random=="function"?n.random:Math.random,s=!!n.elite,r=n.table??mC(n.factionId,s),l=pC(n.rolls),u=[];if(l<=0||r.entries.length===0)return{factionId:n.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u};for(let f=0;f<l;f+=1){const h=bC(r.entries,a);if(!h)break;const p=gC(h.quantity,a);u.push({entryId:h.id,rarity:h.rarity,quantity:p,item:vC(h,p)})}return{factionId:n.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u}}const EC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23a4d67a'%20/%3e%3cpolygon%20points='16,48%2032,16%2048,48'%20fill='%23d2691e'%20/%3e%3crect%20x='24'%20y='32'%20width='16'%20height='16'%20fill='%23f4a460'%20/%3e%3c/svg%3e",MC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23c0c0c0'%20/%3e%3crect%20x='8'%20y='24'%20width='48'%20height='24'%20fill='%23808080'%20/%3e%3crect%20x='24'%20y='16'%20width='16'%20height='8'%20fill='%23606060'%20/%3e%3c/svg%3e",xC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23e0e0e0'%20/%3e%3crect%20x='10'%20y='22'%20width='12'%20height='30'%20fill='%23a9a9a9'%20/%3e%3crect%20x='26'%20y='14'%20width='12'%20height='38'%20fill='%23808080'%20/%3e%3crect%20x='42'%20y='26'%20width='12'%20height='26'%20fill='%23a9a9a9'%20/%3e%3c/svg%3e",wC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%238b4513'%20/%3e%3cpolygon%20points='32,10%2042,22%2022,22'%20fill='%23555'%20/%3e%3crect%20x='30'%20y='22'%20width='4'%20height='32'%20fill='%23ccc'%20/%3e%3c/svg%3e",AC="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eAuric%20Warder%3c/title%3e%3cdesc%20id='desc'%3eRunic%20soldier%20with%20aurora-lit%20shield,%20sculpted%20armor,%20and%20crystalline%20broadsword.%3c/desc%3e%3cdefs%3e%3clinearGradient%20id='soldier-panel'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23091522'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23102a46'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-halo'%20cx='52%25'%20cy='18%25'%20r='68%25'%3e%3cstop%20offset='0%25'%20stop-color='rgba(186,%20230,%20253,%200.92)'%20/%3e%3cstop%20offset='45%25'%20stop-color='rgba(59,%20130,%20246,%200.42)'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(15,%2023,%2042,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-armor'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='55%25'%20stop-color='%23cbd5f5'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23475569'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-gold'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20/%3e%3cstop%20offset='45%25'%20stop-color='%23fbbf24'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f97316'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-cloak'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%231d4ed8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-shield'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23bfdbfe'%20/%3e%3cstop%20offset='65%25'%20stop-color='%2360a5fa'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231d4ed8'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-shield-core'%20cx='40%25'%20cy='40%25'%20r='45%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fef3c7'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(248,%20250,%20252,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-sword'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231f2937'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='128'%20height='128'%20rx='18'%20fill='url(%23soldier-panel)'%20/%3e%3ccircle%20cx='64'%20cy='40'%20r='46'%20fill='url(%23soldier-halo)'%20/%3e%3cellipse%20cx='64'%20cy='110'%20rx='34'%20ry='11'%20fill='%230f172a'%20opacity='0.45'%20/%3e%3cpath%20d='M34%2038c-8%2015-11%2034-6%2052l18%2010c-2-22%206-40%2020-50-12-4-22-8-32-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.88'%20/%3e%3cpath%20d='M94%2038c8%2015%2011%2034%206%2052l-18%2010c2-22-6-40-20-50%2012-4%2022-8%2032-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.68'%20/%3e%3cpath%20d='M58%2018l-12%2014c-5%207-8%2017-8%2028v20l14%2042h24l14-42V60c0-11-3-21-8-28L70%2018H58z'%20fill='url(%23soldier-armor)'%20stroke='%231f2937'%20stroke-width='2.4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M46%2060h36l6%2016c-10%2010-20%2016-24%2016s-14-6-24-16l6-16z'%20fill='%23e0f2fe'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2024c-7%200-14%205-20%2012l8%2010c8-6%2024-6%2032%200l8-10c-6-7-13-12-20-12z'%20fill='%23f8fafc'%20stroke='%23cbd5f5'%20stroke-width='2'%20/%3e%3cpath%20d='M56%2016h16l6%208-14%208-14-8%206-8z'%20fill='%23e2e8f0'%20stroke='%2394a3b8'%20stroke-width='1.8'%20/%3e%3cpath%20d='M52%2074h12l2%2020-10%2012-10-12%206-20z'%20fill='url(%23soldier-gold)'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2096l10%2010%2010-12-6-20H66l-2%2022z'%20fill='%23fef3c7'%20opacity='0.72'%20/%3e%3cpath%20d='M32%2068l-12%206%2014%2032%2016-8-18-30z'%20fill='url(%23soldier-shield)'%20stroke='%231e3a8a'%20stroke-width='2.2'%20/%3e%3ccircle%20cx='36'%20cy='82'%20r='8'%20fill='url(%23soldier-shield-core)'%20/%3e%3cpath%20d='M96%2060l-6-6-22%2044%208%2010%2020-48z'%20fill='url(%23soldier-sword)'%20stroke='%230f172a'%20stroke-width='2.2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M86%2050l-18%2040%2012%206%2016-36-10-10z'%20fill='%23f8fafc'%20opacity='0.7'%20/%3e%3cpath%20d='M64%20102c-9%200-18%207-22%2016%208%206%2014%208%2022%208s14-2%2022-8c-4-9-13-16-22-16z'%20fill='%23dbeafe'%20stroke='%2393c5fd'%20stroke-width='1.6'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M58%2056h12l3%2010-9%206-9-6%203-10z'%20fill='%231f2937'%20opacity='0.85'%20/%3e%3ccircle%20cx='64'%20cy='58'%20r='7'%20fill='%23f1f5f9'%20stroke='%23cbd5f5'%20stroke-width='1.4'%20/%3e%3cpath%20d='M54%2044c-5%200-8%205-8%2012%206-3%2012-6%2018-6s12%203%2018%206c0-7-3-12-8-12H54z'%20fill='%230f172a'%20opacity='0.82'%20/%3e%3c/svg%3e",CC="/assets/archer-DIBoEfQj.svg",TC="/assets/avanto-marauder-B6bFdUJV.svg",So="/",wi={saunaBeer:`${So}assets/ui/sauna-beer.svg`,saunojaRoster:`${So}assets/ui/saunoja-roster.svg`,resource:`${So}assets/ui/resource.svg`,sisu:`${So}assets/ui/resource.svg`,sound:`${So}assets/ui/sound.svg`},_C={images:{placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=","building-farm":EC,"building-barracks":MC,"building-city":xC,"building-mine":wC,"unit-soldier":AC,"unit-archer":CC,"unit-avanto-marauder":TC,"icon-sauna-beer":wi.saunaBeer,"icon-saunoja-roster":wi.saunojaRoster,"icon-resource":wi.resource,"icon-sound":wi.sound}};let Wb=null;function RC(n){Wb=n}function ev(){return Wb}const NC=["city"],kC=1e4,DC=12e3;function LC(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function E2(n){return Object.freeze({strongholds:{...n.strongholds},roster:{...n.roster},economy:{...n.economy},sauna:{...n.sauna},startedAt:n.startedAt})}function M2(n){const a={[ae.SAUNA_BEER]:0,[ae.SAUNAKUNNIA]:0,[ae.SISU]:0};return Object.values(ae).forEach(s=>{a[s]=n.getResource(s)}),a}class UC{timeSource;state;map;getRosterCount;sauna;strongholdTypes;rosterGraceMs;bankruptcyGraceMs;progress;startResources;strongholds=new Map;progressListeners=new Set;resolutionListeners=new Set;mapDisposer=null;rosterTimeout=null;bankruptcyTimeout=null;bankruptSince=null;wipeSince=null;saunaDestroyedAt=null;resolution=null;disposed=!1;constructor(a){this.timeSource=typeof a.timeSource=="function"?a.timeSource:LC,this.state=a.state,this.map=a.map,this.getRosterCount=a.getRosterCount,this.sauna=a.sauna??null;const s=a.strongholdTypes?.length?a.strongholdTypes:NC;this.strongholdTypes=new Set(s),this.rosterGraceMs=Math.max(0,a.rosterWipeGraceMs??kC),this.bankruptcyGraceMs=Math.max(0,a.bankruptcyGraceMs??DC),this.startResources=M2(this.state);const r=this.state.getResource(ae.SAUNA_BEER),l=Math.max(0,Math.round(this.getRosterCount()))||0;this.progress={strongholds:{total:0,destroyed:0,remaining:0},roster:{active:l,totalDeaths:0,wipeSince:null,wipeDurationMs:0},economy:{beer:r,worstBeer:r,bankruptSince:null,bankruptDurationMs:0},sauna:this.createSaunaProgress(),startedAt:this.timeSource()},this.bootstrapStrongholds(),this.attachMapListener(),this.attachEventListeners(),this.emitProgress(),this.evaluateResolution()}onProgress(a){this.progressListeners.add(a)}offProgress(a){this.progressListeners.delete(a)}onResolution(a){if(this.resolution){a(this.resolution);return}this.resolutionListeners.add(a)}offResolution(a){this.resolutionListeners.delete(a)}getProgress(){return E2(this.progress)}dispose(){if(!this.disposed){if(this.disposed=!0,this.clearRosterTimer(),this.clearBankruptcyTimer(),this.mapDisposer){try{this.mapDisposer()}catch(a){console.warn("Failed to detach map listener",a)}this.mapDisposer=null}ne.off("unitDied",this.handleUnitDied),ne.off("unitSpawned",this.handleUnitSpawned),ne.off("resourceChanged",this.handleResourceChanged),ne.off("saunaDamaged",this.handleSaunaDamaged),ne.off("saunaDestroyed",this.handleSaunaDestroyed)}}bootstrapStrongholds(){this.map.forEachTile((a,s)=>{if(this.isStronghold(a.building)){const r=this.coordKey(s);this.strongholds.set(r,{alive:!0})}}),this.updateStrongholdTotals()}attachMapListener(){this.mapDisposer=this.map.addTileChangeListener((a,s,r)=>{if(r!=="building"&&r!=="created")return;const l=this.coordKey(a),u=this.strongholds.get(l);this.isStronghold(s.building)?u?u.alive||(u.alive=!0):this.strongholds.set(l,{alive:!0}):u?.alive&&(u.alive=!1),this.updateStrongholdTotals(),this.emitProgress(),this.evaluateResolution()})}attachEventListeners(){ne.on("unitDied",this.handleUnitDied),ne.on("unitSpawned",this.handleUnitSpawned),ne.on("resourceChanged",this.handleResourceChanged),ne.on("saunaDamaged",this.handleSaunaDamaged),ne.on("saunaDestroyed",this.handleSaunaDestroyed)}handleUnitDied=({unitFaction:a})=>{a==="player"&&(this.progress.roster.totalDeaths+=1,this.refreshRosterStatus(),this.emitProgress(),this.evaluateResolution())};handleUnitSpawned=({unit:a})=>{a.faction==="player"&&(this.refreshRosterStatus(),this.emitProgress())};handleResourceChanged=({resource:a,total:s})=>{a===ae.SAUNA_BEER&&(this.progress.economy.beer=s,s<this.progress.economy.worstBeer&&(this.progress.economy.worstBeer=s),s<0?this.bankruptSince===null&&(this.bankruptSince=this.timeSource(),this.progress.economy.bankruptSince=this.bankruptSince,this.startBankruptcyTimer()):(this.updateBankruptcyDuration(),this.bankruptSince=null,this.progress.economy.bankruptSince=null,this.clearBankruptcyTimer()),this.emitProgress())};handleSaunaDamaged=({remainingHealth:a})=>{this.disposed||(this.updateSaunaSnapshot(a),this.emitProgress())};handleSaunaDestroyed=a=>{this.disposed||(this.markSaunaDestroyed(),this.emitProgress(),this.resolve("lose","saunaDestroyed"))};startBankruptcyTimer(){if(this.bankruptcyTimeout===null){if(this.bankruptcyGraceMs<=0){this.resolve("lose","bankruptcy");return}this.bankruptcyTimeout=setTimeout(()=>{this.updateBankruptcyDuration(),this.resolve("lose","bankruptcy")},this.bankruptcyGraceMs)}}clearBankruptcyTimer(){this.bankruptcyTimeout!==null&&(clearTimeout(this.bankruptcyTimeout),this.bankruptcyTimeout=null)}startRosterTimer(){if(this.rosterTimeout===null){if(this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.rosterTimeout=setTimeout(()=>{this.updateRosterDuration(),this.resolve("lose","rosterWipe")},this.rosterGraceMs)}}clearRosterTimer(){this.rosterTimeout!==null&&(clearTimeout(this.rosterTimeout),this.rosterTimeout=null)}updateStrongholdTotals(){const a=this.strongholds.size;let s=0;for(const r of this.strongholds.values())r.alive&&(s+=1);this.progress.strongholds.total=a,this.progress.strongholds.remaining=s,this.progress.strongholds.destroyed=Math.max(0,a-s)}refreshRosterStatus(){const a=Math.max(0,Math.round(this.getRosterCount()));this.progress.roster.active=a,a<=0?(this.wipeSince===null&&(this.wipeSince=this.timeSource(),this.progress.roster.wipeSince=this.wipeSince),this.startRosterTimer()):(this.updateRosterDuration(),this.wipeSince=null,this.progress.roster.wipeSince=null,this.clearRosterTimer())}updateBankruptcyDuration(){if(this.bankruptSince===null)return;const a=this.timeSource()-this.bankruptSince;a>this.progress.economy.bankruptDurationMs&&(this.progress.economy.bankruptDurationMs=a)}updateRosterDuration(){if(this.wipeSince===null)return;const a=this.timeSource()-this.wipeSince;a>this.progress.roster.wipeDurationMs&&(this.progress.roster.wipeDurationMs=a)}evaluateResolution(){if(!this.resolution){if(this.progress.sauna.destroyed){this.resolve("lose","saunaDestroyed");return}if(this.progress.strongholds.total>0&&this.progress.strongholds.remaining===0){this.resolve("win","strongholds");return}if(this.wipeSince!==null&&this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.bankruptSince!==null&&this.bankruptcyGraceMs<=0&&this.resolve("lose","bankruptcy")}}resolve(a,s){if(this.resolution)return;this.updateRosterDuration(),this.updateBankruptcyDuration();const r=this.timeSource(),l=Math.max(0,r-this.progress.startedAt),u=E2({...this.progress,roster:{...this.progress.roster,wipeSince:this.wipeSince},economy:{...this.progress.economy,bankruptSince:this.bankruptSince},sauna:{...this.progress.sauna,destroyedAt:this.saunaDestroyedAt}}),f=this.computeRewards();this.resolution=Object.freeze({outcome:a,cause:s,timestamp:r,durationMs:l,summary:u,rewards:f}),this.emitResolution(),this.dispose()}emitProgress(){const a=this.getProgress();for(const s of this.progressListeners)try{s(a)}catch(r){console.error("Objective progress listener failed",r)}}emitResolution(){if(!this.resolution)return;const a=this.resolution;for(const s of this.resolutionListeners)try{s(a)}catch(r){console.error("Objective resolution listener failed",r)}this.resolutionListeners.clear()}computeRewards(){const a=M2(this.state);return{resources:{[ae.SAUNA_BEER]:{final:a[ae.SAUNA_BEER],delta:a[ae.SAUNA_BEER]-this.startResources[ae.SAUNA_BEER]},[ae.SAUNAKUNNIA]:{final:a[ae.SAUNAKUNNIA],delta:a[ae.SAUNAKUNNIA]-this.startResources[ae.SAUNAKUNNIA]},[ae.SISU]:{final:a[ae.SISU],delta:a[ae.SISU]-this.startResources[ae.SISU]}}}}coordKey(a){return`${a.q},${a.r}`}isStronghold(a){return a?this.strongholdTypes.has(a):!1}createSaunaProgress(){if(!this.sauna)return{maxHealth:0,health:0,destroyed:!1,destroyedAt:null};const a=Math.max(0,Math.round(this.sauna.maxHealth??0)),s=Math.max(0,Math.round(this.sauna.health??0)),r=!!this.sauna.destroyed||s<=0;return r&&this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),{maxHealth:a,health:s,destroyed:r,destroyedAt:r?this.saunaDestroyedAt:null}}updateSaunaSnapshot(a){const s=Number.isFinite(a)?Math.max(0,Math.round(a)):0,r=this.sauna?Math.max(0,Math.round(this.sauna.maxHealth??0)):0,l=this.progress.sauna.maxHealth,u=Math.max(l,r,s);this.progress.sauna.maxHealth=u;const f=Math.max(0,Math.min(u,s));this.progress.sauna.health=f,f>0&&(this.progress.sauna.destroyed=!1,this.progress.sauna.destroyedAt=null,this.saunaDestroyedAt=null)}markSaunaDestroyed(){if(this.sauna){const a=Math.max(0,Math.round(this.sauna.maxHealth??0));a>this.progress.sauna.maxHealth&&(this.progress.sauna.maxHealth=a)}this.progress.sauna.health=0,this.progress.sauna.destroyed=!0,this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),this.progress.sauna.destroyedAt=this.saunaDestroyedAt}}function OC(n){return new UC(n)}const zn=[{level:1,xpToNext:180,cumulativeXp:0,statAwards:{vigor:0,focus:0,resolve:0}},{level:2,xpToNext:220,cumulativeXp:180,statAwards:{vigor:5,focus:2,resolve:1}},{level:3,xpToNext:260,cumulativeXp:400,statAwards:{vigor:4,focus:3,resolve:1}},{level:4,xpToNext:320,cumulativeXp:660,statAwards:{vigor:4,focus:2,resolve:2}},{level:5,xpToNext:380,cumulativeXp:980,statAwards:{vigor:6,focus:3,resolve:2}},{level:6,xpToNext:460,cumulativeXp:1360,statAwards:{vigor:7,focus:3,resolve:3}},{level:7,xpToNext:540,cumulativeXp:1820,statAwards:{vigor:6,focus:4,resolve:3}},{level:8,xpToNext:640,cumulativeXp:2360,statAwards:{vigor:7,focus:4,resolve:4}},{level:9,xpToNext:760,cumulativeXp:3e3,statAwards:{vigor:8,focus:5,resolve:4}},{level:10,xpToNext:900,cumulativeXp:3760,statAwards:{vigor:9,focus:6,resolve:5}},{level:11,xpToNext:1060,cumulativeXp:4660,statAwards:{vigor:10,focus:6,resolve:6}},{level:12,xpToNext:null,cumulativeXp:5720,statAwards:{vigor:12,focus:7,resolve:6}}];function qC(n){return Number.isNaN(n)||!Number.isFinite(n)?0:Math.max(0,Math.floor(n))}function Th(){return{vigor:0,focus:0,resolve:0}}function zC(n){return{vigor:n.vigor,focus:n.focus,resolve:n.resolve}}function Jc(n){const a=qC(n);let s=zn[0];for(const f of zn)if(a>=f.cumulativeXp)s=f;else break;const r=a-s.cumulativeXp,l=s.xpToNext,u=l?Math.min(1,r/l):1;return{level:s.level,xpIntoLevel:r,xpForNext:l,progressToNext:u,statAwards:s.statAwards}}function BC(n){const a=zn[zn.length-1].level,s=Math.max(zn[0].level,Math.min(n,a)),r=zn.find(l=>l.level===s);return r?zC(r.statAwards):Th()}function HC(n){if(n<=zn[0].level)return Th();const a=zn[zn.length-1].level,s=Math.min(n,a),r=Th();for(const l of zn){if(l.level>s)break;l.level!==zn[0].level&&(r.vigor+=l.statAwards.vigor,r.focus+=l.statAwards.focus,r.resolve+=l.statAwards.resolve)}return r}function jC(n){return Jc(n).level}function Wf(n){return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function Cc(n,a){return a<=0?"":`${n}/${a}`}function IC(n){let a=0;const s=Math.max(0,Wf(n.queueCapacity??2)),r=(f,h)=>{f&&typeof n.log=="function"&&n.log({type:"system",message:f,metadata:{context:"spawn-queue",...h}})},l=()=>{const f=n.getTier();if(!f)return null;const h=Wf(n.getRosterLimit()),p=Wf(n.getRosterCount());return{tierId:f.id,tierName:f.name,rosterLimit:h,rosterCount:p,queued:a}};return{getSnapshot:()=>l(),hasQueuedSpawn:()=>a>0,takeQueuedSpawn:f=>a<=0?!1:(a-=1,a<=0?r(`The benches of ${f.tierName} exhale  queued attendants take the field.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} deploys a queued attendant. Relief teams remaining: ${Cc(a,s)}.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0),restoreQueuedSpawn:f=>{s>0&&a>=s||(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} keeps the relief attendant on standby (${Cc(a,s)} ready).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},queueBlockedSpawn:(f,h)=>s>0&&a>=s?(r(`${f.tierName} cannot hold more relief attendants  clear a slot to vent the pressure.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!1):h()?(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} queues a ready attendant in the wings (${Cc(a,s)} poised).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0):!1,onSpawnResolved:(f,h)=>{h.usedQueue&&(a>0?r(`${f.tierName} still has relief attendants waiting (${Cc(a,s)}).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} has cleared the relief queue.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},clearQueue:f=>{if(!(a<=0)&&(a=0,f==="tier-change")){const h=n.getTier();h&&r(`${h.name} ushers its queued attendants into the new hall.`,{tierId:h.id,tierName:h.name,queue:a,capacity:s})}}}}const tv="autobattles:saunojas";function nv(){try{return globalThis.localStorage??null}catch{return null}}function GC(){const n=nv();if(!n)return[];try{const a=n.getItem(tv);if(!a)return[];const s=JSON.parse(a);if(!Array.isArray(s))return[];const r=[];for(const l of s){if(!l||typeof l!="object")continue;const u=l,f=u.id;if(typeof f!="string"||f.length===0)continue;const h=u.coord,p=h&&typeof h=="object"&&typeof h.q=="number"&&Number.isFinite(h.q)&&typeof h.r=="number"&&Number.isFinite(h.r)?{q:h.q,r:h.r}:void 0,m=u.traits,g=Array.isArray(m)?m.filter(E=>typeof E=="string"):void 0,b=typeof u.upkeep=="number"?u.upkeep:void 0,S=typeof u.xp=="number"?u.xp:void 0;r.push(Zh({id:f,name:typeof u.name=="string"?u.name:void 0,coord:p,maxHp:typeof u.maxHp=="number"?u.maxHp:void 0,hp:typeof u.hp=="number"?u.hp:void 0,steam:typeof u.steam=="number"?u.steam:void 0,traits:g,upkeep:b,xp:S,selected:!!u.selected,items:Array.isArray(u.items)?u.items:void 0,baseStats:u.baseStats,effectiveStats:u.effectiveStats,equipment:u.equipment,modifiers:Array.isArray(u.modifiers)?u.modifiers:void 0}))}return r}catch(a){return console.warn("Failed to load Saunoja units from storage",a),[]}}function YC(n){const a=nv();if(a)try{const s=n.map(r=>({id:r.id,name:r.name,coord:{q:r.coord.q,r:r.coord.r},maxHp:r.maxHp,hp:r.hp,steam:r.steam,traits:[...r.traits],upkeep:r.upkeep,xp:r.xp,selected:r.selected,baseStats:{health:r.baseStats.health,attackDamage:r.baseStats.attackDamage,attackRange:r.baseStats.attackRange,movementRange:r.baseStats.movementRange,...typeof r.baseStats.defense=="number"&&Number.isFinite(r.baseStats.defense)?{defense:r.baseStats.defense}:{},...typeof r.baseStats.shield=="number"&&Number.isFinite(r.baseStats.shield)?{shield:r.baseStats.shield}:{},...typeof r.baseStats.visionRange=="number"&&Number.isFinite(r.baseStats.visionRange)?{visionRange:r.baseStats.visionRange}:{}},effectiveStats:{health:r.effectiveStats.health,attackDamage:r.effectiveStats.attackDamage,attackRange:r.effectiveStats.attackRange,movementRange:r.effectiveStats.movementRange,...typeof r.effectiveStats.defense=="number"&&Number.isFinite(r.effectiveStats.defense)?{defense:r.effectiveStats.defense}:{},...typeof r.effectiveStats.shield=="number"&&Number.isFinite(r.effectiveStats.shield)?{shield:r.effectiveStats.shield}:{},...typeof r.effectiveStats.visionRange=="number"&&Number.isFinite(r.effectiveStats.visionRange)?{visionRange:r.effectiveStats.visionRange}:{}},equipment:ur.reduce((l,u)=>{const f=r.equipment?.[u]??null;return l[u]=f?{id:f.id,name:f.name,description:f.description,icon:f.icon,rarity:f.rarity,quantity:f.quantity,slot:f.slot}:null,l},{}),items:r.items.map(l=>({id:l.id,name:l.name,description:l.description,icon:l.icon,rarity:l.rarity,quantity:l.quantity})),modifiers:r.modifiers.map(l=>({id:l.id,name:l.name,description:l.description,remaining:l.remaining,duration:l.duration,appliedAt:l.appliedAt,stacks:l.stacks,source:l.source}))}));a.setItem(tv,JSON.stringify(s))}catch(s){console.warn("Failed to persist Saunoja units",s)}}const av="autobattles:sauna-settings";function iv(){try{return globalThis.localStorage??null}catch{return null}}function FC(n){return typeof n=="string"?oa(n).id:Go}function x2(n){return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function rm(n,a){const s=x2(n),r=x2(a),l=1+zo;return Math.max(0,Math.min(l,s,r))}function sv(n,a,s){const r=rm(s,s),l=typeof n=="number"&&Number.isFinite(n)?n:a,u=Math.max(0,Math.floor(l));return Math.max(0,Math.min(r,u))}function rv(n){return n===!0||n==="true"}function Eo(n,a){const s=FC(n?.activeTierId),r=oa(s),l=rm(r.rosterCap,a);return{activeTierId:r.id,maxRosterSize:sv(n?.maxRosterSize,l,l),useUiV2:rv(n?.useUiV2)}}function ov(n=1+zo){const a=iv();if(!a)return Eo(null,n);try{const s=a.getItem(av);if(!s)return Eo(null,n);const r=JSON.parse(s);return Eo(!r||typeof r!="object"?null:r,n)}catch(s){return console.warn("Failed to load sauna settings from storage",s),Eo(null,n)}}function lv(n){const a=iv();if(!a)return;const s=oa(n.activeTierId),r=rm(s.rosterCap,s.rosterCap),l={activeTierId:s.id,maxRosterSize:sv(n.maxRosterSize,r,r),useUiV2:rv(n.useUiV2)};try{a.setItem(av,JSON.stringify(l))}catch(u){console.warn("Failed to persist sauna settings",u)}}const $C=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),VC=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function cv(n){return Number.isFinite(n)?Math.max(0,Math.min(100,Math.round(n*100))):0}function XC(n){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});if(n.xpForNext===null)return`${a.format(n.xp)} XP  Max level`;const s=cv(n.progress);return`${a.format(n.xpIntoLevel)} / ${a.format(n.xpForNext)} XP  ${s}%`}function KC(n){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),s=[];return n.vigor>0&&s.push(`+${a.format(n.vigor)} Vigor`),n.focus>0&&s.push(`+${a.format(n.focus)} Focus`),n.resolve>0&&s.push(`+${a.format(n.resolve)} Resolve`),s.length>0?s.join("  "):"No level bonuses yet"}function QC(n,a){const{rosterIcon:s,summaryLabel:r="Saunoja Roster"}=a;n.classList.add("sauna-roster"),n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("title","Active sauna battalion on the field"),n.dataset.tutorialTarget="upkeep",n.replaceChildren();const l=document.createElement("div");l.classList.add("sauna-roster__summary");const u=document.createElement("img");u.src=s,u.alt="Saunoja roster crest",u.decoding="async",u.classList.add("sauna-roster__icon");const f=document.createElement("div");f.classList.add("sauna-roster__text");const h=document.createElement("span");h.textContent=r,h.classList.add("sauna-roster__label");const p=document.createElement("span");p.textContent="0",p.classList.add("sauna-roster__value"),f.append(h,p),l.append(u,f);const m=document.createElement("div");m.classList.add("saunoja-card"),m.setAttribute("aria-live","polite"),m.hidden=!0;const g=document.createElement("div");g.classList.add("saunoja-card__header");const b=document.createElement("div");b.classList.add("saunoja-card__level"),b.setAttribute("role","img"),b.style.setProperty("--level-progress","0%");const S=document.createElement("span");S.classList.add("saunoja-card__level-value"),S.textContent="1",b.appendChild(S);const E=document.createElement("div");E.classList.add("saunoja-card__identity");const M=document.createElement("h3");M.classList.add("saunoja-card__name"),M.textContent="Saunoja";const N=document.createElement("div");N.classList.add("saunoja-card__xp"),N.textContent="0 / 0 XP  0%",E.append(M,N),g.append(b,E);const _=document.createElement("p");_.classList.add("saunoja-card__traits");const U=document.createElement("div");U.classList.add("saunoja-card__callouts"),U.textContent="No level bonuses yet";const H=document.createElement("p");H.classList.add("saunoja-card__upkeep"),m.append(g,_,U,H),n.append(l,m);let I=null,$=null;function P(R){if(!R){m.hidden=!0;return}m.hidden=!1,m.dataset.unitId=R.id,M.textContent=R.name||"Saunoja";const k=R.traits.filter(x=>x.length>0),A=k.length>0?k.join(", "):"No notable traits yet";_.textContent=A,_.title=A;const F=XC(R.progression);N.textContent=F,N.title=F;const B=cv(R.progression.progress);b.style.setProperty("--level-progress",`${B}%`),S.textContent=String(R.progression.level);const T=R.progression.xpForNext===null?`Level ${R.progression.level}, at mastery`:`Level ${R.progression.level}, ${B}% toward next level`;b.setAttribute("aria-label",T);const G=KC(R.progression.statBonuses);U.textContent=G,U.title=G;const J=Math.max(0,Math.round(R.upkeep)),fe=`Upkeep: ${VC.format(J)} Beer`;H.textContent=fe,H.title=fe}function ie(R){return R===1/0?"inf":!Number.isFinite(R)||R<=0?"0":String(Math.ceil(R))}function se(R){return[R.id,R.name,R.icon??"",R.rarity??"",R.description??"",R.quantity].join("^")}function oe(R){return[R.id,R.name,R.description??"",ie(R.duration),ie(R.remaining),R.appliedAt??"",R.stacks??1,R.source??""].join("^")}function ee(R){const{stats:k}=R,A=R.traits.join("|"),F=R.items.map(se).join("|"),B=R.modifiers.map(oe).join("|");return[R.id,R.name,R.upkeep,R.status,R.selected?1:0,R.progression.level,R.progression.xp,R.progression.xpIntoLevel,R.progression.xpForNext??"max",k.health,k.maxHealth,k.attackDamage,k.attackRange,k.movementRange,k.defense??0,k.shield??0,A,F,B].join("~")}function Y(R){return`${R.length}:${R.map(ee).join("||")}`}return{updateSummary(R){const k=Math.max(0,Math.floor(R.count)),A=$C.format(k);p.textContent=A,n.setAttribute("aria-label",`Saunoja roster: ${A} active attendants`),n.setAttribute("title",`Saunoja roster  ${A} active attendants`),P(R.card)},installRenderer(R){$=null,I=R},renderRoster(R){if(!I)return;const k=Y(R);k!==$&&($=k,I(R))},destroy(){I=null,$=null,n.replaceChildren()}}}const PC={[ae.SAUNA_BEER]:"Sauna Beer",[ae.SAUNAKUNNIA]:"Saunakunnia",[ae.SISU]:"Sisu"},ZC='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function JC(n){if(!Number.isFinite(n)||n<=0)return"0:00";const a=Math.round(n/1e3),s=Math.max(0,a%60).toString().padStart(2,"0"),r=Math.floor(a/60),l=(r%60).toString().padStart(2,"0"),u=Math.floor(r/60);return u>0?`${u}:${l}:${s}`:`${r}:${s}`}function WC(n){switch(n.cause){case"strongholds":return"All rival strongholds have fallen.";case"rosterWipe":return"Every attendant is downno one remains to hold the line.";case"bankruptcy":return"Upkeep debts have exhausted the steam reserves.";case"saunaDestroyed":return"The sauna collapsed under relentless assaultthe sacred steamline has fallen silent.";default:return""}}function eT(n){if(!Number.isFinite(n)||n===0)return"0";const a=Math.round(n*100)/100;return`${a>0?"+":""}${a}`}function tT(n,a){const s=document.createElement("ul");s.className="end-screen__rewards-list";for(const r of Object.values(ae)){const l=n.rewards.resources[r];if(!l)continue;const u=document.createElement("li");u.className="end-screen__reward-item";const f=document.createElement("span");f.className="end-screen__reward-label",f.textContent=a[r]??r;const h=document.createElement("span");h.className="end-screen__reward-value",h.textContent=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(l.final));const p=document.createElement("span");p.className="end-screen__reward-delta",p.textContent=eT(l.delta),p.dataset.polarity=l.delta>=0?"positive":"negative",u.append(f,h,p),s.append(u)}return s}function nT(n,a,s){const r=l=>{if(l.key==="Escape"){l.preventDefault(),s?.();return}if(l.key!=="Tab")return;const u=a.querySelectorAll(ZC);if(u.length===0){l.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],p=document.activeElement;l.shiftKey?(p===f||!a.contains(p))&&(l.preventDefault(),h.focus()):(p===h||!a.contains(p))&&(l.preventDefault(),f.focus())};return n.addEventListener("keydown",r),()=>n.removeEventListener("keydown",r)}function aT(n){const{container:a,resolution:s,onNewRun:r,onDismiss:l,currentNgPlusLevel:u}=n;if(!a)return{destroy(){},focusPrimary(){}};const f={...PC,...n.resourceLabels??{}},h=document.createElement("div");h.className="end-screen",h.setAttribute("role","presentation");const p=document.createElement("section");p.className="end-screen__panel",p.setAttribute("role","dialog"),p.setAttribute("aria-modal","true");const m=`end-screen-title-${Date.now()}`;p.setAttribute("aria-labelledby",m),p.tabIndex=-1,p.dataset.outcome=s.outcome;const g=document.createElement("h2");g.className="end-screen__title",g.id=m,g.textContent=s.outcome==="win"?"Steamforged Victory":"Sauna Lost";const b=document.createElement("p");b.className="end-screen__subtitle",b.textContent=WC(s);const S=document.createElement("dl");S.className="end-screen__metrics";const E=(oe,ee)=>{const Y=document.createElement("dt");Y.textContent=oe,Y.className="end-screen__metric-label";const R=document.createElement("dd");R.textContent=ee,R.className="end-screen__metric-value",S.append(Y,R)};E("Run time",JC(s.durationMs)),E("Strongholds",`${s.summary.strongholds.destroyed}/${s.summary.strongholds.total}`),E("Roster losses",`${s.summary.roster.totalDeaths}`),E("Deepest beer reserve",`${Math.round(s.summary.economy.worstBeer)}`);const M=document.createElement("div");M.className="end-screen__badges";const N=document.createElement("span");N.className="end-screen__badge",N.textContent=`NG+ ${Math.max(0,u)}`,M.append(N);const _=document.createElement("h3");_.className="end-screen__section-title",_.textContent="Rewards";const U=tT(s,f),H=document.createElement("div");H.className="end-screen__actions";const I=document.createElement("button");I.type="button",I.className="end-screen__button end-screen__button--primary",I.textContent="New run (NG+)",I.addEventListener("click",()=>{r()});const $=document.createElement("button");$.type="button",$.className="end-screen__button",$.textContent="Review battlefield",$.addEventListener("click",()=>{l?.()}),H.append(I,$),p.append(g,b,M,S,_,U,H),h.append(p),a.append(h);const P=nT(h,p,l),ie=()=>{P(),h.remove()},se=()=>{requestAnimationFrame(()=>{I.focus({preventScroll:!0})})};return se(),{destroy:ie,focusPrimary:se}}const uv="autobattles4x.flags";function dv(){if(typeof window>"u")return null;try{if("localStorage"in window&&window.localStorage)return window.localStorage}catch(n){console.warn("Unable to access localStorage for local flags",n)}return null}function fv(){const n=dv();if(!n)return{};try{const a=n.getItem(uv);if(!a)return{};const s=JSON.parse(a);if(s&&typeof s=="object")return s}catch(a){console.warn("Failed to parse local flags, resetting.",a)}return{}}function iT(n){const a=dv();if(a)try{const s={};n.tutorial_done&&(s.tutorial_done=!0),a.setItem(uv,JSON.stringify(s))}catch(s){console.warn("Failed to persist local flags",s)}}function sT(){return fv().tutorial_done===!0}function w2(n){const a={...fv()};a.tutorial_done=!0,iT(a)}const eh=200,th=3,rT=2,A2=6,oT=40,lT=250,cT=200,uT=jC(Number.MAX_SAFE_INTEGER),_h={[ae.SAUNA_BEER]:"Sauna Beer",[ae.SAUNAKUNNIA]:"Saunakunnia",[ae.SISU]:"Sisu"};function hv(n,a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;if(!Number.isFinite(n))return s;const r=Math.max(0,Math.floor(n));return Math.max(0,Math.min(s,r))}let Ot=Ha(eE()),mv=1,om=0,fu=1,Uc={aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1},pv=1,gv=Math.random,yv=Math.random,lm=null;function Wc(n){Ot=Ha(n),mv=nE(Ot),om=aE(Ot),fu=sE(Ot),Uc=rE(Ot),pv=iE(Ot),gv=Xg(Ot.runSeed,1),yv=Xg(Ot.runSeed,2),lm?.({persist:!0})}Wc(Ot);let eu=null,Ie=[];const ra=new Map,Ai=new Map,cs=new Map;let C2=0,tu=null,na=null,$a=null,sr=null,Hn=null,rr=null,kt=null,ss=null,ko=null,Ga=null,Ci=null,rs=!1,Mn=null,Ti=null,Wn=null,Do=null,ts=0;function cm(n){const a=Ai.get(n.id);return a?cs.get(a)??null:null}function bv(n,a){n.effectiveStats={...a},n.maxHp=Math.max(1,Math.round(a.health)),n.hp=Math.min(n.maxHp,Math.max(0,Math.round(n.hp))),n.defense=typeof a.defense=="number"?Math.max(0,a.defense):void 0,n.shield=typeof a.shield=="number"?Math.max(0,a.shield):0;const s=cm(n);if(s){const r={health:n.effectiveStats.health,attackDamage:n.effectiveStats.attackDamage,attackRange:n.effectiveStats.attackRange,movementRange:n.effectiveStats.movementRange};typeof n.effectiveStats.defense=="number"&&(r.defense=n.effectiveStats.defense),typeof n.effectiveStats.visionRange=="number"&&(r.visionRange=n.effectiveStats.visionRange),s.updateStats(r),typeof n.effectiveStats.shield=="number"?s.setShield(n.effectiveStats.shield):n.shield<=0&&s.setShield(0)}}function hu(n,a){const s=a??Bn(n.equipment),r=Ic(n.baseStats,s);return bv(n,r),r}function vv(n){const a=Jc(n.xp);return{level:a.level,xp:Math.max(0,Math.floor(n.xp)),xpIntoLevel:a.xpIntoLevel,xpForNext:a.xpForNext,progress:a.progressToNext,statBonuses:HC(a.level)}}function dT(n){const a=[];return n.vigor>0&&a.push(`+${n.vigor} Vigor`),n.focus>0&&a.push(`+${n.focus} Focus`),n.resolve>0&&a.push(`+${n.resolve} Resolve`),a.length>0?a.join(", "):"+0 Vigor, +0 Focus, +0 Resolve"}function Sv(n,a,s){if(!Number.isFinite(a)||a<=0)return null;const r=Jc(n.xp),l=Math.max(0,Math.floor(n.xp+a));if(l===n.xp)return null;n.xp=l;const u=Jc(n.xp),f=Math.max(0,u.level-r.level),h={vigor:0,focus:0,resolve:0};let p=0;if(f>0){for(let g=r.level+1;g<=u.level&&g<=uT;g++){const b=BC(g);h.vigor+=b.vigor,h.focus+=b.focus,h.resolve+=b.resolve;const S=Number.isFinite(n.baseStats.health)?n.baseStats.health:n.effectiveStats.health;n.baseStats.health=Math.max(1,Math.round(S+b.vigor));const E=Number.isFinite(n.baseStats.attackDamage)?n.baseStats.attackDamage:n.effectiveStats.attackDamage;n.baseStats.attackDamage=Math.max(0,Math.round(E+b.focus));const N=(Number.isFinite(n.baseStats.defense)?n.baseStats.defense??0:n.effectiveStats.defense??0)+b.resolve;n.baseStats.defense=N>0?N:void 0}p=h.vigor}p>0&&(n.hp+=p),hu(n);const m=cm(n);if(m&&m.setExperience(n.xp),s.source==="kill"){const g=n.name?.trim()||"Our champion",b=s.label?.trim()||"their foe",S=s.boss?" Boss toppled!":s.elite?" Elite threat routed!":"";qt({type:"combat",message:`${g} earns ${a} XP for defeating ${b}.${S}`,metadata:{slayer:g,foe:b,xpAward:a,boss:!!s.boss,elite:!!s.elite}})}if(f>0){const g=dT(h),b=n.name?.trim()||"Our champion";qt({type:"progression",message:`${b} reaches Level ${u.level}! ${g}.`,metadata:{unit:b,level:u.level,levelsGained:f,bonuses:h}})}return{xpAwarded:a,totalXp:n.xp,level:u.level,levelsGained:f,statBonuses:h}}function fT(n,a,s){if(!n)return null;const r=ra.get(n.id);return r?Sv(r,a,s):null}function hT(n,a){if(!Number.isFinite(n)||n<=0)return!1;let s=!1;for(const r of Ie)Sv(r,n,a)&&(s=!0);return s}function mT(n){return n?(n.type?.toLowerCase?.()??"").includes("boss")?{xp:lT,elite:!0,boss:!0}:Uv(n)?{xp:oT,elite:!0,boss:!1}:{xp:A2,elite:!1,boss:!1}:{xp:A2,elite:!1,boss:!1}}const Ev=n=>{if(!n)return;const a=Math.max(0,Math.floor(n.strongholds.destroyed));if(a>ts){const s=a-ts,r=cT*s;hT(r,{source:"objective",label:"stronghold"})&&(la(),In(),qt({type:"progression",message:`Strategists toast the captured stronghold  roster gains ${r} XP.`,metadata:{source:"stronghold",xpAward:r}}))}if(a<ts){ts=a;return}ts=a},pT=Object.freeze(["health","attackDamage","attackRange","movementRange","defense","shield"]);function T2(n){return n?{id:n.id,name:n.name,quantity:n.quantity,rarity:n.rarity}:null}function _2(n,a){const s=n[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function gT(n,a){const s=[];for(const r of pT){const l=_2(a,r),u=_2(n,r),f=l-u;f!==0&&s.push({stat:r,delta:f})}return s}function yT(n,a){if(!a||Bn(n.equipment).length>0)return;const r={health:Math.max(1,Math.round(a.getMaxHealth())),attackDamage:Math.max(0,Math.round(a.stats.attackDamage)),attackRange:Math.max(0,Math.round(a.stats.attackRange)),movementRange:Math.max(0,Math.round(a.stats.movementRange)),defense:typeof a.stats.defense=="number"&&Number.isFinite(a.stats.defense)?Math.max(0,a.stats.defense):n.baseStats.defense,shield:n.baseStats.shield??0,visionRange:typeof a.stats.visionRange=="number"&&Number.isFinite(a.stats.visionRange)?Math.max(0,a.stats.visionRange):n.baseStats.visionRange};n.baseStats=r,hu(n)}function Ao(){Do&&(Do.destroy(),Do=null)}function bT(){if(sT()){Ao();return}Ao(),Do=Qx({onComplete:()=>{w2(),Ao()},onSkip:()=>{w2(),Ao()}}),Do.start()}function R2(n){ko=n,kt&&(kt.installRenderer(n),Ga&&(kt.renderRoster(Ga),Ga=null))}function vT(){return GC()}function la(){YC(Ie)}function ST(n=Math.random){typeof n!="function"&&(n=Math.random);const a=Math.max(0,Math.floor(ar)),s=Math.max(a,Math.floor(kc));if(s===a)return Math.max(ar,Math.min(kc,a));const r=s-a+1,l=Math.floor(n()*r)+a;return Math.max(ar,Math.min(kc,l))}function ET(n){const s=(Array.isArray(n.traits)?n.traits:[]).length>=3,r=Number.isFinite(n.upkeep),l=Number.isFinite(n.xp);return!s||!r||!l}function Mv(n){n.traits=xA(),n.upkeep=ST(),n.xp=0}function MT(n,a,s,r={}){const l=r.hudVariant??"classic",u=l==="classic";s.dataset.hudVariant=l,eu=n,Mn&&(Mn.dispose(),Mn=null),Mn=gA({canvas:n,overlay:s,mapRenderer:um,getUnitById:h=>cs.get(h),requestDraw:()=>{zt()}}),kt&&(kt.destroy(),kt=null),u?(kt=QC(a,{rosterIcon:wi.saunojaRoster}),ko&&kt.installRenderer(ko),Ga&&(kt.renderRoster(Ga),Ga=null),ss&&(kt.updateSummary(ss),ss=null)):(ko=null,Ga=null,ss=null),Hn?.dispose(),Hn=null,u&&(Hn=D3(it,{getRosterCapLimit:()=>pu(),updateMaxRosterSize:(h,p)=>qo(h,{persist:p?.persist}),getActiveTierId:()=>dt,setActiveTierId:(h,p)=>(kT(h,{persist:p?.persist})&&Hn?.update(),dt),getTierContext:()=>gm()})),$a?.dispose(),$a=null,sr?.destroy(),sr=null;const f={useSisuBurst:()=>{const h=K3($e,St);return h?(ia("sisu"),qt({type:"ability",message:`Sisu bursts forth, spending ${ns} grit to steel our attendants.`,metadata:{ability:"sisu-burst",cost:ns}})):ia("error"),h},torille:()=>{const h=P3($e,St,it.pos,Jt);return h?qt({type:"ability",message:`Torille! Our warriors regroup at the sauna to rally their spirits for ${as} SISU.`,metadata:{ability:"torille",cost:as}}):ia("error"),h}};u&&($a=L3($e,{saunakunnia:wi.resource,sisu:wi.sisu,saunaBeer:wi.saunaBeer})),sr=gx($e,s,f),rr?.destroy(),rr=null,u&&(rr=oC(Oo,{getSelectedUnitId:()=>Ie.find(h=>h.selected)?.id??null,getComparisonContext:()=>OT(),onEquip:(h,p,m)=>bm(h,p),getUseUiV2:RT,onUseUiV2Change:NT})),u?(qT(),dm(),In(),bT()):na&&(na(),na=null)}const Jt=new hE(10,10,32),xv=new Zw(()=>zt()),xT=new DM(Jt,xv),um=new Bw(Jt),nu=()=>{um.invalidateCache(),zt()};ne.on("buildingPlaced",nu);ne.on("buildingRemoved",nu);Jt.forEachTile(n=>n.setFogged(!0));JS();const St=[];function N2(n){return`${n.q},${n.r}`}function wT(){const n=new Set;for(const p of St)p.isDead()||n.add(N2(p.coord));const a=[],{minQ:s,maxQ:r,minR:l,maxR:u}=Jt,f=p=>{const m=N2(p);n.has(m)||(Jt.ensureTile(p.q,p.r),a.push(p))};for(let p=s;p<=r;p++)f({q:p,r:l}),u!==l&&f({q:p,r:u});for(let p=l+1;p<=u-1;p++)f({q:s,r:p}),r!==s&&f({q:r,r:p});if(a.length===0)return;const h=Math.floor(Math.random()*a.length);return a[h]}function AT(n){const a=ra.get(n);a&&(ra.delete(n),Ai.get(a.id)===n&&Ai.delete(a.id))}function CT(n){const a=ra.get(n.id);if(a)return{saunoja:a,created:!1,attached:!1};let s=Ie.find(f=>f.id===n.id);s||(s=Ie.find(f=>!Ai.has(f.id)));let r=!1;s||(s=Zh({id:`saunoja-${Ie.length+1}`,coord:{q:n.coord.q,r:n.coord.r}}),Ie.push(s),r=!0);const l=Ai.get(s.id);l&&l!==n.id&&ra.delete(l),ra.set(n.id,s),Ai.set(s.id,n.id),yT(s,n),bv(s,s.effectiveStats),n.setExperience(s.xp);const u=ET(s);return(r||u)&&Mv(s),{saunoja:s,created:r,attached:!0}}function dm(){let n=!1;for(const a of St){if(a.faction!=="player"||a.isDead())continue;const{saunoja:s,created:r,attached:l}=CT(a);(r||l)&&(n=!0);const u=Number.isFinite(a.stats.health)?Math.max(0,a.stats.health):0;s.hp!==u&&(s.hp=u,n=!0);const f=Number.isFinite(a.getMaxHealth())?Math.max(1,a.getMaxHealth()):1;s.maxHp!==f&&(s.maxHp=f,n=!0);const h=a.getShield(),p=Number.isFinite(h)?Math.max(0,h):0;s.shield!==p&&(s.shield=p,n=!0);const g=a?.lastHitAt;Number.isFinite(g)&&s.lastHitAt!==g&&(s.lastHitAt=g,n=!0);const{q:b,r:S}=a.coord;(s.coord.q!==b||s.coord.r!==S)&&(s.coord={q:b,r:S},n=!0,s.selected&&ym(s.coord))}return n&&la(),n}function wv(n,a){if(n.faction==="player"){const u=(a??ra.get(n.id)??null)?.name?.trim();if(u)return u}return`${(n.constructor?.name??"Unit").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase()} ${n.id}`.trim()}function mu(n){if(cs.has(n.id))return;St.push(n),cs.set(n.id,n);let a=null;if(n.faction==="player"&&(dm()||Yo(),a=ra.get(n.id)??null),eu&&zt(),n.faction==="player"){const r=wv(n,a);qt({type:"spawn",message:`Our ${r} emerges from the steam.`,metadata:{unitId:n.id,unitName:r,steward:"Our"}}),In()}}const Av=({unit:n})=>{mu(n)};ne.on("unitSpawned",Av);const Cv=()=>{Yo()},or=()=>{Yo()};ne.on("inventoryChanged",Cv);ne.on("modifierAdded",or);ne.on("modifierRemoved",or);ne.on("modifierExpired",or);const Tv=n=>{Hn?.handleDamage?.(n)},_v=n=>{Hn?.handleDestroyed?.(n)};ne.on("saunaDamaged",Tv);ne.on("saunaDestroyed",_v);const Rv=()=>{In()};ne.on("unit:stats:changed",Rv);function TT(n){const a=ra.get(n.id);if(!a)return 0;const s=Number.isFinite(a.upkeep)?a.upkeep:0;return s>0?s*mv:0}const $e=new lE(1e3),Oo=new RA,fm=$e.load(Jt);if(fm){const n=$e.getNgPlusState();Wc(n),oh(n)}else{const n=$e.setNgPlusState(Ot);Wc(n),oh(n)}$e.setEnemyScalingBase({aggression:Uc.aggressionMultiplier,cadence:Uc.cadenceMultiplier,strength:Uc.strengthMultiplier});if(!fm&&Ot.ngPlusLevel>0){const n=Math.round(75*Ot.ngPlusLevel);n>0&&$e.addResource(ae.SAUNA_BEER,n)}const lr=ov(fu),Nv=()=>({ngPlusLevel:Ot.ngPlusLevel,unlockSlots:Ot.unlockSlots});let dt=lr.activeTierId,hr=lr.useUiV2;const _T=fr(oa(dt),Nv());_T.unlocked||(dt=Go);const pu=()=>{const n=oa(dt),a=Math.max(0,Math.floor(n.rosterCap));return Math.min(a,fu)},au=hv(lr.maxRosterSize,pu());(au!==lr.maxRosterSize||lr.activeTierId!==dt||lr.useUiV2!==hr)&&lv({maxRosterSize:au,activeTierId:dt,useUiV2:hr});const it=RM({q:Math.floor(Jt.width/2),r:Math.floor(Jt.height/2)},void 0,{maxRosterSize:au}),RT=()=>hr,NT=n=>{const a=!!n;hr!==a&&pm(it.maxRosterSize,{useUiV2:a})},hm=IC({getTier:()=>oa(dt),getRosterLimit:()=>pu(),getRosterCount:()=>gu(),log:n=>qt(n),queueCapacity:3});let kv=au,mm=dt;const pm=(n,a)=>{typeof a?.useUiV2=="boolean"&&(hr=a.useUiV2),lv({maxRosterSize:n,activeTierId:dt,useUiV2:hr}),kv=n,mm=dt},gm=()=>Nv(),qo=(n,a={})=>{const s=pu(),r=hv(n,s);return r!==it.maxRosterSize&&(it.maxRosterSize=r),a.persist&&(dt!==mm||r!==kv)&&pm(r),r};lm=(n={})=>{const a=gm(),s=vb();let r=Go;for(const f of s)if(fr(f,a).unlocked)r=f.id;else break;if(!fr(oa(dt),a).unlocked||dt!==r){const f=dt;dt=r,hm.clearQueue?.("tier-change"),qo(it.maxRosterSize,{persist:n.persist}),f!==dt&&Hn?.update?.();return}n.persist&&qo(it.maxRosterSize,{persist:!0})};lm({persist:!0});const kT=(n,a={})=>{const s=oa(n);return fr(s,gm()).unlocked?s.id===dt?(a.persist&&dt!==mm&&pm(it.maxRosterSize),!0):(dt=s.id,hm.clearQueue?.("tier-change"),qo(it.maxRosterSize,{persist:a.persist}),!0):!1},DT=n=>{C2+=1;const a=`p${Date.now()}-${C2}`,s=Qh($e,"soldier",a,n,"player");return s&&mu(s),s??null},k2=new M3({difficulty:pv,random:gv,eliteOdds:om}),Dv=new cE(1e3,n=>{const a=n/1e3;$e.tick(),Nc.tick(a,{state:$e});const s=$e.getEnemyScalingSnapshot(),r=qo(it.maxRosterSize);CA({dt:a,state:$e,sauna:it,heat:it.heatTracker,units:St,getUnitUpkeep:TT,pickSpawnTile:()=>eb(it.pos,St),spawnBaseUnit:DT,minUpkeepReserve:Math.max(1,ar),maxSpawns:fu,rosterCap:r,getRosterCount:gu,tierHelpers:hm});const l={aggressionMultiplier:s.aggression,cadenceMultiplier:s.cadence,strengthMultiplier:s.strength,calmSecondsRemaining:s.calmSecondsRemaining};k2.update(a,St,mu,wT,l),$e.advanceEnemyCalm(a);const u=k2.getSnapshot(),f=Math.max(s.calmSecondsRemaining,u.calmSecondsRemaining);if($a){const p={stage:u.rampStageLabel,stageIndex:u.rampStageIndex,bundleTier:u.bundleTier,multiplier:u.difficultyMultiplier,cadenceSeconds:u.cadence,effectiveDifficulty:u.effectiveDifficulty,aggressionMultiplier:u.aggressionMultiplier,cadenceMultiplier:u.cadenceMultiplier,strengthMultiplier:u.strengthMultiplier,calmSecondsRemaining:f,spawnCycles:u.spawnCycles};$a.setEnemyRampSummary(p)}const h=Ti?.getProgress().roster;T3(u,{wipeSince:h?.wipeSince??null,wipeDurationMs:h?.wipeDurationMs??0}),xT.tick(St,a,it),uM(a),dm()&&In(),$e.save();for(const p of St)p.isDead()||p.faction!=="player"||Jt.revealAround(p.coord,p.getVisionRange(),{autoFrame:!1});zt()}),LT=n=>{rs&&(rs=!1),Dv.stop(),Ci!==null&&(cancelAnimationFrame(Ci),Ci=null),zt();const a=document.getElementById("ui-overlay");if(!a)return;Wn&&(Wn.destroy(),Wn=null);const s=Ot.ngPlusLevel,r=tE(Ot,{outcome:n.outcome});oh(r),$e.setNgPlusState(r),Wc(r),Wn=aT({container:a,resolution:n,currentNgPlusLevel:s,resourceLabels:_h,onNewRun:()=>{try{typeof window<"u"&&window.localStorage?.removeItem?.("gameState")}catch(u){console.warn("Failed to reset saved game state for NG+",u)}typeof window<"u"&&typeof window.location?.reload=="function"&&window.setTimeout(()=>window.location.reload(),75)},onDismiss:()=>{Wn&&(Wn.destroy(),Wn=null)}})};Ie=vT();if(Ie.length===0){const n=Zh({id:"saunoja-1",coord:it.pos,selected:!0,upkeep:0});Mv(n),n.upkeep=0,Ie.push(n),la()}else{let n=!1,a=!1;for(const s of Ie)s.selected&&(n?(s.selected=!1,a=!0):n=!0);a&&la()}const UT=St.some(n=>n.faction==="player"&&!n.isDead());if(!UT){$e.canAfford(by,ae.SAUNA_BEER)||$e.addResource(ae.SAUNA_BEER,by);const n=`u${St.length+1}`,a=Qh($e,"soldier",n,it.pos,"player");a&&mu(a)}Jt.revealAround(it.pos,3);Ti=OC({state:$e,map:Jt,getRosterCount:gu,sauna:it,rosterWipeGraceMs:8e3,bankruptcyGraceMs:12e3});ts=Ti.getProgress().strongholds.destroyed;Ti.onProgress(Ev);Ti.onResolution(LT);function OT(){const n=Ie.find(a=>a.selected)??null;return n?{baseStats:{...n.baseStats},loadout:Bn(n.equipment),currentStats:{...n.effectiveStats}}:null}function qT(){na&&(na(),na=null);const n=$x($e,{onRosterSelect:jT,onRosterRendererReady:R2,onRosterEquipSlot:GT,onRosterUnequipSlot:YT});n.addEvent,R2(n.renderRoster),na=n.dispose}function zT(){Hn?.update()}function D2(n){$a?.update(n)}fm||($e.addResource(ae.SAUNA_BEER,eh),qt({type:"resource",message:`Quartermaster stocks ${eh} bottles of ${_h[ae.SAUNA_BEER]} to launch your campaign.`,metadata:{resource:ae.SAUNA_BEER,amount:eh,context:"initial"}}),$e.addResource(ae.SAUNAKUNNIA,th),qt({type:"resource",message:`Sauna elders honor your leadership with ${th} ${_h[ae.SAUNAKUNNIA]} to celebrate your arrival.`,metadata:{resource:ae.SAUNAKUNNIA,amount:th,context:"initial"}}));const nh=Ie.find(n=>n.selected);nh&&(tu={q:nh.coord.q,r:nh.coord.r});function BT(n,a){return!n||!a?n===a:n.q===a.q&&n.r===a.r}function ym(n){return BT(tu,n)?!1:(tu=n?{q:n.q,r:n.r}:null,!0)}function Lv(n){let a=!1;for(const s of Ie)n&&s===n||s.selected&&(s.selected=!1,a=!0);return a}function HT(){let n=!1;return Lv()&&(n=!0),ym(null)&&(n=!0),n}function Uv(n){if(!n)return!1;const a=Kh(n.type);if(!a)return!1;const s=Ho(a,1),r=n.stats;return r.health>s.health||r.attackDamage>s.attackDamage||r.attackRange>s.attackRange||r.movementRange>s.movementRange}function Ov(n){let a=!1;return n.selected||(n.selected=!0,a=!0),Lv(n)&&(a=!0),ym(n.coord)&&(a=!0),a}function jT(n){const a=Ie.find(s=>s.id===n);a&&Ov(a)&&(la(),In(),zt())}function qv(n){const a=XS(n.x,n.y,Jt.hexSize),s=Ie.find(l=>l.coord.q===a.q&&l.coord.r===a.r);(s?Ov(s):HT())&&(la(),In(),zt())}function bm(n,a){const s=Ie.find(m=>m.id===n);if(!s)return{success:!1,reason:"unit-missing"};const r=Bn(s.equipment),l=Ic(s.baseStats,r),u=FM(s,a);if(!u.success)return{success:!1,reason:u.reason};const f=hu(s,u.loadout);ne.emit("unit:stats:changed",{unitId:s.id,stats:f}),ne.emit("inventoryChanged",{}),la(),In();const h=r.find(m=>m.slot===u.slot)??null;return{success:!0,comparison:{slot:u.slot,previous:T2(h),next:T2(u.item??null),deltas:gT(l,f)}}}function IT(n,a){const s=Ie.find(b=>b.id===n);if(!s)return null;const r=$M(s,a);if(!r.success||!r.removed)return null;const l=hu(s,r.loadout);ne.emit("unit:stats:changed",{unitId:s.id,stats:l}),ne.emit("inventoryChanged",{}),la(),In();const{id:u,name:f,description:h,icon:p,rarity:m,quantity:g}=r.removed;return{id:u,name:f,description:h,icon:p,rarity:m,quantity:g}}function GT(n,a){const r=Oo.getStash().findIndex(l=>VM(l.id,a));return r===-1?!1:Oo.equipFromStash(r,n,bm)}function YT(n,a){return Oo.unequipToStash(n,a,IT)}function zt(){if(!eu)return;const n=eu.getContext("2d"),a=ev();if(!n||!a)return;if(Mn){const p=typeof performance<"u"?performance.now():Date.now();Mn.step(p)}const s=Mn?.getShakeOffset()??{x:0,y:0},r=Mn?{getUnitAlpha:p=>Mn.getUnitAlpha(p.id)}:void 0,l=Array.isArray(Ie)&&Ie.length>0,u=St.filter(p=>p.faction==="player"&&!p.isDead()),f=it?{coord:it.pos,range:it.auraRadius}:null,h=l?St.filter(p=>p.faction!=="player"):St;n.save(),(s.x!==0||s.y!==0)&&n.translate(s.x,s.y),Kw(n,um,a.images,h,tu,{saunojas:{units:Ie,draw:vA,resolveRenderCoord:p=>{const m=cm(p);return m?m.renderCoord??m.coord:null}},sauna:it,saunaVision:f,fx:r,friendlyVisionSources:u}),n.restore()}const zv=({policy:n})=>{qt({type:"policy",message:`Sauna council toasts a fresh keg for policy: ${n.name}.`,metadata:{policy:n.id,name:n.name}})};ne.on(Gt.APPLIED,zv);const Bv=({unitId:n,attackerId:a,attackerFaction:s,unitFaction:r})=>{const l=St.findIndex(S=>S.id===n),u=l!==-1?St[l]:null,f=u?{q:u.coord.q,r:u.coord.r}:null,h=r==="player"?ra.get(n)??null:null;let p=!1;if(r==="player"){const S=h??Ie.find(E=>Ai.get(E.id)===n||E.id===n)??null;S&&(S.hp!==0&&(S.hp=0,p=!0),S.shield!==0&&(S.shield=0,p=!0))}const m=u?wv(u,h):`unit ${n}`;let g=!1;if(s==="player"&&r&&r!=="player"){const S=a?cs.get(a)??null:null,{xp:E,elite:M,boss:N}=mT(u);E>0&&fT(S,E,{source:"kill",label:m,elite:M,boss:N})&&(g=!0)}if(l!==-1&&(u&&xv.clear(u,{snap:!0}),St.splice(l,1),cs.delete(n),AT(n),zt()),(p||g)&&la(),(r==="player"||g)&&In(),s==="player"&&r&&r!=="player"){const S=Uv(u??null)||yv()<om,E=SC({factionId:r,elite:S});if(E.rolls.length>0){const M=Ie.find(N=>N.selected)??null;for(const N of E.rolls)if(Oo.addLoot(N,{unitId:M?.id,sourceTableId:E.tableId,equip:bm}).equipped){const U=M?.name??"our champion";qt({type:"loot",message:`Quartermaster fastens ${N.item.name} to ${U}.`,metadata:{item:N.item.name,equipped:!0,owner:U,source:m}})}else qt({type:"loot",message:`Quartermaster stores ${N.item.name} recovered from ${m}.`,metadata:{item:N.item.name,equipped:!1,source:m}})}}s==="player"&&r&&r!=="player"&&($e.addResource(ae.SAUNAKUNNIA,rT),$e.addResource(ae.SISU,1),qt({type:"resource",message:"Our grit surges  +1 SISU earned for the vanquished foe.",metadata:{resource:ae.SISU,amount:1,context:"victory"}})),f&&Jt.revealAround(f,1,{autoFrame:!1});const b=r==="player"?"our":"a rival";qt({type:"combat",message:`The steam hushes as ${b} ${m} grows still.`,metadata:{side:b,unit:m}})};ne.on("unitDied",Bv);function Rh(){rs=!1,Ti?.offProgress(Ev),Ti?.dispose(),Ti=null,ts=0,J3(),Wn&&(Wn.destroy(),Wn=null),Ci!==null&&(cancelAnimationFrame(Ci),Ci=null);try{$e.save()}catch(n){console.warn("Failed to persist game state during cleanup",n)}try{la()}catch(n){console.warn("Failed to persist Saunoja roster during cleanup",n)}Mn&&(Mn.dispose(),Mn=null),ne.off(Gt.APPLIED,zv),ne.off("unitDied",Bv),ne.off("unitSpawned",Av),ne.off("inventoryChanged",Cv),ne.off("modifierAdded",or),ne.off("modifierRemoved",or),ne.off("modifierExpired",or),ne.off("unit:stats:changed",Rv),ne.off("saunaDamaged",Tv),ne.off("saunaDestroyed",_v),ne.off("buildingPlaced",nu),ne.off("buildingRemoved",nu),na&&(na(),na=null),rr&&(rr.destroy(),rr=null),Hn&&(Hn.dispose(),Hn=null),$a&&($a.dispose(),$a=null),sr&&(sr.destroy(),sr=null),kt&&(kt.destroy(),kt=null),Ga=null,ss=null,ko=null,Ao()}async function FT(){if(rs)return;if(!ev()){console.error("Cannot start game without loaded assets.");return}rs=!0,In(),zt();try{await Zb(()=>{zt()}).then(()=>{zt()})}catch(r){console.warn("Failed to preload Saunoja icon before starting the game",r)}let a=performance.now();function s(r){if(!rs)return;const l=r-a;a=r,Eb()?D2(0):(Dv.tick(l),zT(),D2(l),Yo()),zt(),rs&&(Ci=requestAnimationFrame(s))}Ci=requestAnimationFrame(s)}function gu(){let n=0;for(const a of St)a.faction==="player"&&!a.isDead()&&(n+=1);return n}function $T(){const n={engaged:0,reserve:1,downed:2},a=Ie.map(s=>{const r=Ai.get(s.id),l=r?cs.get(r):void 0,u=l?!l.isDead()&&l.stats.health>0:!1,f=s.effectiveStats,h=s.baseStats,p=Math.round(l?Math.max(0,l.stats.health):Math.max(0,s.hp)),m=Math.round(l?Math.max(1,l.getMaxHealth()):Math.max(1,f.health)),g=Math.round(l?Math.max(0,l.stats.attackDamage):Math.max(0,f.attackDamage)),b=Math.round(l?Math.max(0,l.stats.attackRange):Math.max(0,f.attackRange)),S=Math.round(l?Math.max(0,l.stats.movementRange):Math.max(0,f.movementRange)),E=l?.stats.defense??f.defense??0,M=Math.round(Math.max(0,E)),N=l?l.getShield():f.shield??s.shield,_=Math.round(Math.max(0,N)),U=Math.max(0,Math.round(s.upkeep)),H=p<=0?"downed":u?"engaged":"reserve",I=vv(s),$=s.items.map(oe=>({...oe})),P=s.modifiers.map(oe=>({...oe})),ie=ur.map(oe=>{const ee=jo(oe),Y=s.equipment[oe],R=Y?{id:Y.id,name:Y.name,description:Y.description,icon:Y.icon,rarity:Y.rarity,quantity:Y.quantity,slot:oe}:null,k=Y?XT(Y.modifiers,Y.quantity):null;return{id:oe,label:ee.label,description:ee.description,maxStacks:ee.maxStacks,item:R,modifiers:k}}),se={health:Math.round(Math.max(0,h.health)),maxHealth:Math.round(Math.max(1,h.health)),attackDamage:Math.round(Math.max(0,h.attackDamage)),attackRange:Math.round(Math.max(0,h.attackRange)),movementRange:Math.round(Math.max(0,h.movementRange)),defense:typeof h.defense=="number"&&h.defense>0?Math.round(h.defense):void 0,shield:typeof h.shield=="number"&&h.shield>0?Math.round(h.shield):void 0};return{id:s.id,name:s.name,upkeep:U,status:H,selected:!!s.selected,traits:[...s.traits],stats:{health:p,maxHealth:m,attackDamage:g,attackRange:b,movementRange:S,defense:M>0?M:void 0,shield:_>0?_:void 0},baseStats:se,progression:I,equipment:ie,items:$,modifiers:P}});return a.sort((s,r)=>{const l=n[s.status]-n[r.status];return l!==0?l:s.name.localeCompare(r.name,"en")}),a}function VT(){return Ie.length===0?null:Ie.find(n=>n.selected)??Ie.find(n=>n.hp>0)??Ie[0]}function XT(n,a){const s=Math.max(1,Math.round(a)),r={};return typeof n.health=="number"&&(r.health=n.health*s),typeof n.attackDamage=="number"&&(r.attackDamage=n.attackDamage*s),typeof n.attackRange=="number"&&(r.attackRange=n.attackRange*s),typeof n.movementRange=="number"&&(r.movementRange=n.movementRange*s),typeof n.defense=="number"&&(r.defense=n.defense*s),typeof n.shield=="number"&&(r.shield=n.shield*s),r}function KT(){const n=gu(),a=VT();let s=null;return a&&(s={id:a.id,name:a.name||"Saunoja",traits:[...a.traits],upkeep:Math.max(0,Math.round(a.upkeep)),progression:vv(a)}),{count:n,card:s}}function Yo(n){const a=$T();Ga=a,kt&&kt.renderRoster(a)}function In(){const n=KT();kt?(kt.updateSummary(n),ss=null):ss=n,Yo()}function QT(n){const{overlay:a,resourceBar:s}=n,r=mr(a),{regions:l}=r,u=document.createElement("div");u.className="pointer-events-none absolute inset-0 grid place-items-center bg-[radial-gradient(circle_at_top,rgba(18,28,45,0.92),rgba(6,10,18,0.94))] p-[clamp(1.5rem,4vw,3.25rem)] z-overlay";const f=document.createElement("section");f.className="pointer-events-auto relative grid w-full max-w-[min(640px,90vw)] gap-4 overflow-hidden rounded-[28px] border border-[rgba(128,168,236,0.28)] bg-[linear-gradient(145deg,rgba(31,46,74,0.95),rgba(14,20,33,0.95))] p-[clamp(1.75rem,4vw,2.5rem)] text-slate-100 shadow-[0_40px_90px_rgba(10,14,28,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)]",f.setAttribute("aria-live","polite"),f.setAttribute("role","status");const h=document.createElement("h1");h.className="m-0 text-[clamp(1.6rem,3vw,2.1rem)] font-semibold uppercase tracking-[0.04em]",h.textContent="Experimental HUD Enabled",f.appendChild(h);const p=document.createElement("p");p.className="m-0 text-base leading-relaxed text-slate-100/90",p.textContent="The React/Tailwind interface is bootstrapped for this session. Gameplay systems continue to run, and classic HUD elements are paused while the new shell is under construction.",f.appendChild(p);const m=document.createElement("p");m.className="m-0 text-sm leading-relaxed text-slate-200/75",m.textContent="Toggle the experimental HUD off from the quartermaster settings to return to the classic layout.",f.appendChild(m);const g=document.createElement("div");g.className="pointer-events-none absolute -left-[30%] -top-[40%] h-[420px] w-[420px] bg-[radial-gradient(circle,rgba(90,164,255,0.35),rgba(90,164,255,0))] blur-[0.5px]",f.appendChild(g);const b=document.createElement("div");return b.className="mt-2 rounded-[18px] border border-[rgba(128,168,236,0.2)] bg-[rgba(10,16,26,0.55)] p-4 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]",b.appendChild(s),f.appendChild(b),u.appendChild(f),l.content.appendChild(u),{destroy(){b.contains(s)&&a.prepend(s),u.remove()}}}function Hv(n){if(!n)return{showLoader:()=>({update:()=>{},clear:()=>{},dispose:()=>{}}),showBanner:()=>null,removeTransientUI:()=>{}};const a=()=>{let f=n.querySelector(".hud-banner-stack");return f||(f=document.createElement("div"),f.className="hud-banner-stack",n.append(f)),f},s=(f,h,p)=>{let m=!1;const g=()=>{m||(m=!0,f.removeEventListener("transitionend",g),p())};f.addEventListener("transitionend",g),requestAnimationFrame(()=>{f.classList.add(h)}),window.setTimeout(g,400)};return{showLoader:(f="Heating the sauna stones")=>{const h=document.createElement("div");h.className="hud-loader",h.setAttribute("role","status"),h.setAttribute("aria-live","polite");const p=document.createElement("div");p.className="hud-loader__card";const m=document.createElement("div");m.className="hud-loader__spinner",m.setAttribute("aria-hidden","true");const g=document.createElement("p");g.className="hud-loader__message",g.textContent=f,p.append(m,g),h.append(p),n.append(h);let b=!1;return{update(S){g.textContent=S},clear(){b||s(h,"hud-loader--hidden",()=>{b=!0,h.remove()})},dispose(){b||(b=!0,h.remove())}}},showBanner:(f,h)=>{const p=a(),m=document.createElement("section");m.className=`hud-banner hud-banner--${f}`,m.setAttribute("role",f==="error"?"alert":"status"),m.setAttribute("aria-live",f==="error"?"assertive":"polite");const g=document.createElement("header");g.className="hud-banner__header";const b=document.createElement("p");b.className="hud-banner__title",b.textContent=h.title??(f==="error"?"Attention required":f==="warning"?"Heads up":"Status update"),g.append(b);const S=document.createElement("ul");S.className="hud-banner__list";for(const _ of h.messages){const U=document.createElement("li");U.textContent=_,S.append(U)}if(m.append(g),h.messages.length&&m.append(S),h.actions?.length){const _=document.createElement("div");_.className="hud-banner__actions";for(const U of h.actions){const H=document.createElement("button");H.type="button",H.className=U.variant==="secondary"?"hud-banner__button hud-banner__button--secondary":"hud-banner__button",H.textContent=U.label,H.addEventListener("click",()=>{U.onClick()}),_.append(H)}m.append(_)}let E,M=!1;const N=()=>{M||(M=!0,E&&window.clearTimeout(E),s(m,"hud-banner--hide",()=>{m.remove(),p.hasChildNodes()||p.remove()}))};if(h.dismissible!==!1){const _=document.createElement("button");_.type="button",_.className="hud-banner__close",_.setAttribute("aria-label","Dismiss notification"),_.textContent="",_.addEventListener("click",()=>{N()}),g.append(_)}return p.append(m),h.autoCloseMs&&h.autoCloseMs>0&&(E=window.setTimeout(()=>N(),h.autoCloseMs)),{element:m,dismiss:N}},removeTransientUI:()=>{n.querySelectorAll(".hud-loader").forEach(f=>{f.remove()}),n.querySelectorAll(".hud-banner-stack").forEach(f=>{f.remove()})}}}async function PT(n){const a=Object.entries(n),s=await Promise.allSettled(a.map(([f,h])=>h.load().then(p=>({key:f,descriptor:h,value:p})))),r={},l=[],u=[];return s.forEach((f,h)=>{const[p,m]=a[h],g=m.label??String(p);if(f.status==="fulfilled"){const{value:S}=f.value;if(r[p]=S.value,S.warnings?.length)for(const E of S.warnings)l.push(g?`${g}: ${E}`:E);if(S.errors?.length)for(const E of S.errors)u.push(g?`${g}: ${E}`:E);return}const b=ZT(f.reason);u.push(g?`${g}: ${b}`:b)}),{resources:r,warnings:l,errors:u}}function ZT(n){if(n instanceof Error)return n.message;if(typeof n=="string")return n;try{return JSON.stringify(n)}catch{return String(n)}}const JT="Heating the sauna stones",WT="Polishing sauna ambience";function e_(n){if(n instanceof Error&&n.message)return n.message;if(typeof n=="string"&&n.trim().length>0)return n;try{return JSON.stringify(n)}catch{return String(n)}}function t_(n){const a=new Set,s=f=>{a.forEach(h=>h(f))},r=n.formatError??e_;return{run:async f=>{s({type:"status",phase:"start",message:JT});try{const{resources:h,warnings:p,errors:m}=await PT({assets:{label:"Core assets",load:async()=>{const b=await n.loadAssets(n.assetPaths);return{value:b.assets,errors:b.failures}}},saunojaIcon:{label:"Saunoja icon",load:async()=>{try{return await n.preloadSaunojaIcon(),{value:!0}}catch(b){return{value:!1,warnings:[`Unable to preload Saunoja icon (${r(b)})`]}}}}});if(n.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"status",phase:"progress",message:WT});const g=h.assets;if(!g){const b=m.length?[...m]:["Critical assets were unavailable. Please refresh to try again."];s({type:"fatal",messages:b});return}if(m.length&&s({type:"errors",errors:m}),p.length&&s({type:"warnings",warnings:p}),n.setAssets(g),n.shouldAbort?.(f)){s({type:"cancelled"});return}n.startGame(),s({type:"ready",assets:g,warnings:p,errors:m})}catch(h){if(n.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"failure",error:h,message:r(h)})}},subscribe:f=>(a.add(f),()=>{a.delete(f)})}}const n_="grabbing";function a_(n,a){const s=a.dragCursor??n_;let r=!1,l=null,u=0,f=0,h=null;const p=E=>{E.pointerType!=="mouse"||E.button!==0||(r=!0,l=E.pointerId,u=E.clientX,f=E.clientY,h=n.style.cursor??"",n.setPointerCapture?.(E.pointerId),n.style.cursor=s,a.onPanStart?.(E))},m=E=>{if(!r||l!==E.pointerId)return;const M=E.clientX-u,N=E.clientY-f;u=E.clientX,f=E.clientY,a.onPan(M,N,E)},g=E=>{!r||l!==E.pointerId||(r=!1,l=null,n.releasePointerCapture?.(E.pointerId),n.style.cursor=h??"",a.onPanEnd?.(E))},b=E=>{g(E)},S=E=>{g(E)};return n.addEventListener("pointerdown",p),n.addEventListener("pointermove",m),n.addEventListener("pointerup",b),n.addEventListener("pointercancel",S),n.addEventListener("pointerleave",S),()=>{n.removeEventListener("pointerdown",p),n.removeEventListener("pointermove",m),n.removeEventListener("pointerup",b),n.removeEventListener("pointercancel",S),n.removeEventListener("pointerleave",S),r&&l!==null&&n.releasePointerCapture?.(l),n.style.cursor=h??""}}const i_=10,s_=250;function Ji(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function r_(n,a){const s=a.tapMaxMovement??i_,r=a.tapMaxDuration??s_;let l=null;const u=b=>{if(b.touches.length===1){const S=b.touches[0];l={mode:"pan",lastX:S.clientX,lastY:S.clientY,startX:S.clientX,startY:S.clientY,startTime:Ji(),moved:!1};return}if(b.touches.length>=2){const[S,E]=[b.touches[0],b.touches[1]];l={mode:"pinch",lastCenterX:(S.clientX+E.clientX)/2,lastCenterY:(S.clientY+E.clientY)/2,lastDistance:Math.hypot(S.clientX-E.clientX,S.clientY-E.clientY),startTime:Ji(),moved:!1}}},f=(b,S)=>{if(!l||l.mode!=="pan")return;const E=b.clientX-l.lastX,M=b.clientY-l.lastY;!l.moved&&Math.hypot(E,M)>1&&(l.moved=!0),l.lastX=b.clientX,l.lastY=b.clientY,a.onPan(E,M,S)},h=(b,S,E)=>{const M=(b.clientX+S.clientX)/2,N=(b.clientY+S.clientY)/2,_=Math.hypot(b.clientX-S.clientX,b.clientY-S.clientY);let U=1,H=0,I=0;l&&l.mode==="pinch"?(U=_/l.lastDistance,H=M-l.lastCenterX,I=N-l.lastCenterY):l={mode:"pinch",lastCenterX:M,lastCenterY:N,lastDistance:_,startTime:Ji(),moved:!1},!(!l||l.mode!=="pinch")&&(l.lastCenterX=M,l.lastCenterY=N,l.lastDistance=_,l.moved=!0,a.onPinch({centerX:M,centerY:N,scale:U,deltaCenterX:H,deltaCenterY:I},E))},p=b=>{if(!l||b.touches.length===0)return;if(b.preventDefault(),b.touches.length===1){const M=b.touches[0];l.mode!=="pan"&&(l={mode:"pan",lastX:M.clientX,lastY:M.clientY,startX:M.clientX,startY:M.clientY,startTime:Ji(),moved:!0}),f(M,b);return}const[S,E]=[b.touches[0],b.touches[1]];h(S,E,b)},m=()=>!l||l.mode!=="pan"||Math.hypot(l.lastX-l.startX,l.lastY-l.startY)>s?!1:Ji()-l.startTime<=r,g=b=>{if(l){if(b.touches.length===0){l.mode==="pan"&&a.onTap&&m()&&a.onTap({x:l.startX,y:l.startY},b),l=null;return}if(b.touches.length===1){const S=b.touches[0];l={mode:"pan",lastX:S.clientX,lastY:S.clientY,startX:S.clientX,startY:S.clientY,startTime:Ji(),moved:!0};return}if(b.touches.length>=2){const[S,E]=[b.touches[0],b.touches[1]];l={mode:"pinch",lastCenterX:(S.clientX+E.clientX)/2,lastCenterY:(S.clientY+E.clientY)/2,lastDistance:Math.hypot(S.clientX-E.clientX,S.clientY-E.clientY),startTime:Ji(),moved:!0}}}};return n.addEventListener("touchstart",u,{passive:!1}),n.addEventListener("touchmove",p,{passive:!1}),n.addEventListener("touchend",g),n.addEventListener("touchcancel",g),()=>{n.removeEventListener("touchstart",u),n.removeEventListener("touchmove",p),n.removeEventListener("touchend",g),n.removeEventListener("touchcancel",g),l=null}}const o_=.5,l_=3.5;function Nh(n,a,s,r,l){const u=n.getBoundingClientRect(),f=a-u.left,h=s-u.top,p=u.width/2,m=u.height/2;return{x:l.x+(f-p)/r,y:l.y+(h-m)/r}}function c_(n){return Math.min(l_,Math.max(o_,n))}function jv(n,a,s,r=xe.zoom,l=xe){return Nh(n,a,s,r,l)}function Iv(n,a,s,r){const l=c_(r);if(l===xe.zoom)return;const u={x:xe.x,y:xe.y},f=Nh(n,a,s,xe.zoom,u),h=Nh(n,a,s,l,u);xe.x+=f.x-h.x,xe.y+=f.y-h.y,xe.zoom=l,zt()}function ah(n,a){n===0&&a===0||(xe.x-=n/xe.zoom,xe.y-=a/xe.zoom,zt())}function u_(n){const a=window.devicePixelRatio||1,s=Math.max(window.innerWidth,1),r=Math.max(window.innerHeight,1);n.style.width=`${s}px`,n.style.height=`${r}px`,n.width=Math.round(s*a),n.height=Math.round(r*a);const l=n.getContext("2d");l&&l.setTransform(1,0,0,1,0,0),zt()}const d_=.0015,kh=[];let vm=0,Va=null,yu=Hv(null),Ut=null,ih="classic",Dh=null;function f_(){if(typeof document>"u")return;const n=document.querySelector("[data-build-commit]");if(!n)return;const a="1d99b2e".trim(),s=a.length>0&&a!=="unknown",r=s?`#${a}`:"DEV BUILD";n.textContent=r,n.dataset.state=s?"commit":"dev";const l=n.closest("#build-id");if(l){const u=s?`Build commit ${a}`:"Development build";l.setAttribute("aria-label",u),l.title=s?`Autobattles build ${a}`:"Unversioned development build",l.dataset.buildState=s?"release":"development"}}f_();function Ya(n){kh.push(n)}function h_(){for(;kh.length;){const n=kh.pop();try{n?.()}catch(a){console.error("Error during cleanup",a)}}}function m_(n){Ya(()=>n.dispose())}function Tc(n,a){const s=yu.showBanner(n,a);s&&Ya(()=>s.dismiss())}function p_(n){switch(n.type){case"status":if(n.phase==="start"){Ut?.dispose();const a=yu.showLoader(n.message);Ut=a,m_(a)}else Ut&&(Ut.update(n.message),Ut.clear(),Ut=null);break;case"ready":Ut?.clear(),Ut=null;break;case"warnings":n.warnings.length&&(console.warn("Resource loader warnings",n.warnings),Tc("warning",{title:"Heads up",messages:n.warnings,autoCloseMs:12e3}));break;case"errors":n.errors.length&&(console.error("Resource loader errors",n.errors),Tc("error",{title:"Some resources failed to load",messages:n.errors,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]}));break;case"fatal":console.error("Critical assets failed to load",n.messages),Ut?.clear(),Ut=null,Tc("error",{title:"Unable to start the sauna battle",messages:n.messages,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}],dismissible:!1});break;case"failure":console.error("Failed to initialize resources",n.error),Ut?.clear(),Ut=null,Tc("error",{title:"Failed to initialize",messages:[n.message],actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]});break;case"cancelled":Ut?.dispose(),Ut=null;break}}const Gv=t_({assetPaths:_C,loadAssets:WS,preloadSaunojaIcon:Zb,setAssets:RC,startGame:FT,shouldAbort:n=>n!==vm});Gv.subscribe(p_);function L2(n){if(!Va)return;n.preventDefault();const a=Math.exp(-n.deltaY*d_),s=xe.zoom*a;Iv(Va,n.clientX,n.clientY,s)}function U2(n){if(!Va)return;const a=jv(Va,n.clientX,n.clientY);qv(a)}function g_(n){n.addEventListener("click",U2),Ya(()=>n.removeEventListener("click",U2)),n.addEventListener("wheel",L2,{passive:!1}),Ya(()=>n.removeEventListener("wheel",L2));const a=a_(n,{onPan:(r,l)=>{ah(r,l)},dragCursor:"grabbing"});Ya(a);const s=r_(n,{onPan:(r,l)=>{ah(r,l)},onPinch:({centerX:r,centerY:l,scale:u,deltaCenterX:f,deltaCenterY:h})=>{Iv(n,r,l,xe.zoom*u),ah(f,h)},onTap:r=>{const l=jv(n,r.x,r.y);qv(l)}});Ya(s)}function y_(){vm+=1,h_(),Dh?.destroy(),Dh=null,Ut?.dispose(),Ut=null,Va&&(Va.style.cursor=""),Va=null,yu.removeTransientUI(),Rh()}function b_(){const n=document.getElementById("game-canvas"),a=document.getElementById("resource-bar"),s=document.getElementById("ui-overlay");if(!n||!a||!s){console.error("Autobattles4xFinsauna shell is missing the required canvas, overlay, or resource bar elements.",{hasCanvas:!!n,hasResourceBar:!!a,hasOverlay:!!s});return}Va&&y_();const r=++vm;ih=ov().useUiV2?"v2":"classic",Va=n,yu=Hv(s);const u=Sx();Ya(()=>u.dispose()),MT(n,a,s,{hudVariant:ih}),ih==="v2"&&(Dh=QT({overlay:s,resourceBar:a})),g_(n);const f=()=>u_(n);window.addEventListener("resize",f),Ya(()=>window.removeEventListener("resize",f)),window.addEventListener("beforeunload",Rh),Ya(()=>window.removeEventListener("beforeunload",Rh)),f(),import.meta.vitest||Gv.run(r)}function v_(){if(typeof document>"u")return;const n=()=>{document.removeEventListener("DOMContentLoaded",n),b_()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",n);return}n()}import.meta.vitest||v_();
