(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function s(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=s(o);fetch(o.href,u)}})();class VS{listeners=new Map;on(a,s){const r=this.listeners.get(a)??[];r.push(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);if(!r)return;const o=r.indexOf(s);o!==-1&&(r.splice(o,1),r.length===0?this.listeners.delete(a):this.listeners.set(a,r))}emit(a,s){const r=this.listeners.get(a);if(r)for(const o of r)o(s)}}const ne=new VS;class Uh{type="farm";cost=50;beerPerTick=1}class O2{type="barracks";cost=100;trainingCapacity=1}const q2=Math.sqrt(3),z2=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function Jn(n,a){return{x:a*q2*(n.q+n.r/2),y:a*(3/2)*n.r}}function hl(n,a,s){const r=(q2/3*n-.3333333333333333*a)/s,o=2/3*a/s;return{q:r,r:o}}function XS(n,a,s){return KS(hl(n,a,s))}function kc(n){return z2.map(a=>({q:n.q+a.q,r:n.r+a.r}))}function Gs(n,a){const s=-n.q-n.r,r=-a.q-a.r;return Math.max(Math.abs(n.q-a.q),Math.abs(n.r-a.r),Math.abs(s-r))}function KS(n){let a=n.q,s=n.r,r=-a-s,o=Math.round(a),u=Math.round(r),f=Math.round(s);const h=Math.abs(o-a),m=Math.abs(u-r),p=Math.abs(f-s);return h>m&&h>p?o=-u-f:m>p?u=-o-f:f=-o-u,{q:o,r:f}}const Dc=new Set;let Ac=32;function QS(n){return`${n.q},${n.r}`}function sh(n,a){Ac=a,Dc.add(QS(n))}function PS(n){if(Dc.size===0)return{center:{x:0,y:0},zoom:1};const a=Ac*Math.sqrt(3),s=Ac*2,r=a/2,o=s/2;let u=1/0,f=1/0,h=-1/0,m=-1/0;for(const j of Dc){const[F,Q]=j.split(",").map(Number),{x:se,y:ee}=Jn({q:F,r:Q},Ac),le=se-r,P=ee-o;u=Math.min(u,le),f=Math.min(f,P),h=Math.max(h,le+a),m=Math.max(m,P+s)}const p=h-u,g=m-f,b=96,v={x:u+p/2,y:f+g/2},E=Math.max(0,Math.min(n.safeRight??0,n.width)),C=Math.max(n.width-E,1)/(p+b*2),R=n.height/(g+b*2),N=Math.min(C,R);return{center:{x:N>0?v.x-E/(2*N):v.x,y:v.y},zoom:N}}const Ee={x:0,y:0,zoom:1};function ZS(n,a=300){const s=Ee.x,r=Ee.y,o=Ee.zoom,u=typeof performance<"u"?performance.now():Date.now(),f=h=>{const m=Math.min((h-u)/a,1);Ee.x=s+(n.center.x-s)*m,Ee.y=r+(n.center.y-r)*m,Ee.zoom=o+(n.zoom-o)*m,m<1&&(typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),16))};typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),0)}function JS(){Dc.clear()}async function WS(n){const a={},s={},r=[],o=Object.entries(n.images??{}).map(([f,h])=>new Promise(m=>{const p=new Image;p.onload=()=>{a[f]=p,m()},p.onerror=()=>{const g=`Failed to load image: ${h}`;console.error(g),r.push(g),m()},p.src=h})),u=Object.entries(n.sounds??{}).map(([f,h])=>new Promise(m=>{const p=new Audio;p.oncanplaythrough=()=>{s[f]=p,m()},p.onerror=()=>{const g=`Failed to load sound: ${h}`;console.error(g),r.push(g),m()},p.src=h,p.load()}));return await Promise.all([...o,...u]),{assets:{images:a,sounds:s},failures:r}}function Oh(n){if(typeof globalThis.localStorage>"u")return;const a=globalThis.localStorage.getItem(n);if(a)try{return JSON.parse(a)}catch(s){console.warn(`Failed to parse data for "${n}", clearing`,s),globalThis.localStorage.removeItem(n);return}}var ie=(n=>(n.SAUNA_BEER="sauna-beer",n.SAUNAKUNNIA="saunakunnia",n.SISU="sisu",n))(ie||{});const nc={"sauna-beer":1,saunakunnia:0,sisu:0},B2="/assets/sauna-beer-CgafwOhX.svg",H2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eResource%20Icon%3c/title%3e%3cdesc%20id='desc'%3eA%20luminous%20crest%20symbolising%20generic%20resources.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='resource-bg'%20cx='50%25'%20cy='50%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='resource-core'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2338bdf8'%20/%3e%3c/linearGradient%3e%3cfilter%20id='resource-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='6'%20flood-color='%2338bdf8'%20flood-opacity='0.45'%20/%3e%3c/filter%3e%3c/defs%3e%3cg%20filter='url(%23resource-glow)'%3e%3ccircle%20cx='32'%20cy='32'%20r='22'%20fill='%230f172a'%20stroke='url(%23resource-bg)'%20stroke-width='4'%20/%3e%3cpath%20d='M32%2016l-12%2014%2012%2022%2012-22z'%20fill='url(%23resource-core)'%20stroke='%23f8fafc'%20stroke-width='2'%20/%3e%3cpath%20d='M20%2030l-4%208%2016%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M44%2030l4%208-16%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/g%3e%3c/svg%3e",j2="/assets/saunoja-roster-Bfn4ZKxh.svg",Ht={APPLIED:"policy:applied",REJECTED:"policy:rejected"},G2=[{id:"eco",name:"Evergreen Eco Mandate",description:"Increase passive sauna beer brewing by one bottle each production tick.",cost:15,resource:ie.SAUNAKUNNIA,prerequisites:[],visuals:{icon:H2,gradient:"linear-gradient(135deg, rgba(66, 240, 155, 0.9), rgba(13, 114, 234, 0.85))",accentColor:"#34d399",badges:["Economy","Sustainability"],flair:"Green-lit by the council of whisked sauna masters."},effects:[{event:Ht.APPLIED,once:!0,invoke:({state:n})=>{n.modifyPassiveGeneration(ie.SAUNA_BEER,1)}}],spotlight:"Sustainably expand your brewing line with solar-heated mash tuns."},{id:"temperance",name:"Aurora Temperance Treaty",description:"Boost night shift work speed by 5% once the eco initiative is live.",cost:25,resource:ie.SAUNAKUNNIA,prerequisites:[{description:"Enact the Evergreen Eco Mandate.",isSatisfied:n=>n.hasPolicy("eco")},{description:"Stockpile at least 30 Sauna Beer bottles to brief the midnight crews.",isSatisfied:n=>n.getResource(ie.SAUNA_BEER)>=30}],visuals:{icon:j2,gradient:"linear-gradient(140deg, rgba(46, 51, 227, 0.9), rgba(118, 75, 162, 0.85))",accentColor:"#6366f1",badges:["Discipline","Night Ops"],flair:"Whispers of aurora spirits keep the crew laser-focused after dusk."},effects:[{event:Ht.APPLIED,once:!0,invoke:({state:n})=>{n.nightWorkSpeedMultiplier=Number((n.nightWorkSpeedMultiplier*1.05).toFixed(4))}}],spotlight:"Glow-lit helmets and synchronized chants keep the late shift on tempo."},{id:"steam-diplomats",name:"Steam Diplomats Accord",description:"Import two additional sauna beer bottles per tick via gilded trade routes.",cost:35,resource:ie.SAUNAKUNNIA,prerequisites:[{description:"Secure the Aurora Temperance Treaty for your envoys.",isSatisfied:n=>n.hasPolicy("temperance")},{description:"Hold a reserve of 50 Sauna Beer bottles to fund the embassy festivities.",isSatisfied:n=>n.getResource(ie.SAUNA_BEER)>=50}],visuals:{icon:B2,gradient:"linear-gradient(150deg, rgba(255, 173, 94, 0.92), rgba(255, 99, 71, 0.85))",accentColor:"#fb923c",badges:["Diplomacy","Logistics"],flair:"Silver samovars arrive with diplomatic steam-born delights."},effects:[{event:Ht.APPLIED,once:!0,invoke:({state:n})=>{n.modifyPassiveGeneration(ie.SAUNA_BEER,2)}}],spotlight:"Trade envoys pipe artisanal steam through every new supply line."}],I2=new Map;for(const n of G2)I2.set(n.id,n);function Y2(){return G2}function Xg(n){return I2.get(n)}const F2="progression:ngPlusState",Rl=5,$2=1831565813,Fs=Object.freeze({aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1}),Cc=Object.freeze({runSeed:0,ngPlusLevel:0,unlockSlots:0,enemyTuning:Fs});function Sf(n,a,s,r){const o=Number(n);return Number.isFinite(o)?Math.min(s,Math.max(a,o)):r}function qh(n){return{aggressionMultiplier:Sf(n?.aggressionMultiplier,.25,6,Fs.aggressionMultiplier),cadenceMultiplier:Sf(n?.cadenceMultiplier,.25,4,Fs.cadenceMultiplier),strengthMultiplier:Sf(n?.strengthMultiplier,.25,6,Fs.strengthMultiplier)}}function V2(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(n){return console.warn("Local storage unavailable for NG+ state",n),null}}function rh(n,a,s){const r=Number.isFinite(n)?n:Number(n);if(!Number.isFinite(r))return a;const o=Math.trunc(r);return Math.min(s,Math.max(a,o))}function X2(n){const a=Number.isFinite(n)?n:Number(n);return!Number.isFinite(a)||a===0?0:Math.trunc(Math.abs(a))}function K2(n=Math.random){let a=n();(!Number.isFinite(a)||a<=0||a>=1)&&(a=Math.random());const s=Math.floor(a*4294967295);return s===0?$2:s}function ka(n={}){const a=Cc,s=X2(n.runSeed??a.runSeed),r=rh(n.ngPlusLevel??a.ngPlusLevel,0,Number.MAX_SAFE_INTEGER),o=rh(n.unlockSlots??a.unlockSlots,0,Rl),u=qh(n.enemyTuning??a.enemyTuning);return{runSeed:s,ngPlusLevel:r,unlockSlots:o,enemyTuning:u}}function Ca(n,a=Math.random){const s=ka(n);return s.runSeed!==0?s:ka({...s,runSeed:K2(a)})}function eE(n=Math.random){const a=V2();if(!a)return Ca(Cc,n);const s=a.getItem(F2);if(!s)return Ca(Cc,n);try{const r=JSON.parse(s);return Ca(ka(r),n)}catch(r){return console.warn("Failed to parse NG+ state",r),Ca(Cc,n)}}function lh(n){const a=V2();if(!a)return;const s=ka(n);a.setItem(F2,JSON.stringify(s))}function tE(n,a){const s=ka(n),r=typeof a.random=="function"?a.random:Math.random;let o=s.ngPlusLevel,u=s.unlockSlots;if(a.outcome==="win"){o+=1;const h=Math.max(0,Math.trunc(a.bonusUnlocks??1));h>0&&(u=Math.min(Rl,u+h))}const f=K2(r);return Ca(ka({runSeed:f,ngPlusLevel:o,unlockSlots:u,enemyTuning:s.enemyTuning}),r)}function nE(n){const a=Math.max(0,n.ngPlusLevel),s=Math.max(0,n.unlockSlots)*.02;return Math.min(3,1+a*.12+s)}function aE(n){const a=Math.max(0,n.ngPlusLevel),s=Math.max(0,n.unlockSlots)*.01,r=.1+a*.05+s;return Math.max(0,Math.min(.85,r))}function iE(n){const a=Math.max(0,n.ngPlusLevel),s=Math.max(.5,1+a*.25),r=qh(n.enemyTuning??Fs);return Math.max(.25,Math.min(8,s*r.aggressionMultiplier))}function sE(n){const s=1+rh(n.unlockSlots,0,Rl);return Math.max(3,s)}function rE(n){return qh(n.enemyTuning??Fs)}function Kg(n,a=0){let s=X2(n)^(a|0);return s===0&&(s=$2^(a|0)),()=>{s=s+1831565813|0;let r=Math.imul(s^s>>>15,1|s);return r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296}}function Ef(n){return`${n.q},${n.r}`}const Q2={farm:()=>new Uh,barracks:()=>new O2};function lE(n){return Q2[n]?.()}const Qg=Object.freeze({aggression:1,cadence:1,strength:1});function $s(n,a,s,r){const o=Number(n);return Number.isFinite(o)?Math.min(s,Math.max(a,o)):r}function Pg(n,a){return{aggression:$s(a.aggression??n.aggression,.1,8,n.aggression),cadence:$s(a.cadence??n.cadence,.25,6,n.cadence),strength:$s(a.strength??n.strength,.25,12,n.strength)}}class oE{constructor(a,s="gameState"){this.tickInterval=a,this.storageKey=s}resources={[ie.SAUNA_BEER]:0,[ie.SAUNAKUNNIA]:0,[ie.SISU]:0};passiveGeneration={...nc};lastSaved=Date.now();buildings={};buildingPlacements=new Map;policies=new Set;nightWorkSpeedMultiplier=1;enemyScaling={...Qg};enemyCalmSecondsRemaining=0;ngPlus=ka();tick(){Object.keys(this.passiveGeneration).forEach(a=>{this.addResource(a,this.passiveGeneration[a])})}save(){this.lastSaved=Date.now();const a={};this.buildingPlacements.forEach((o,u)=>{a[u]=o.type});const s={resources:this.resources,lastSaved:this.lastSaved,buildings:this.buildings,buildingPlacements:a,policies:Array.from(this.policies),passiveGeneration:{...this.passiveGeneration},nightWorkSpeedMultiplier:this.nightWorkSpeedMultiplier,enemyScaling:{...this.enemyScaling},ngPlus:this.ngPlus},r=typeof localStorage<"u"&&localStorage?localStorage:void 0;if(!r){console.warn("GameState.save: localStorage is unavailable, skipping persistence.");return}try{r.setItem(this.storageKey,JSON.stringify(s))}catch(o){console.warn("GameState.save: Failed to persist state to localStorage.",o)}}load(a){const s=Oh(this.storageKey);if(!s)return this.lastSaved=Date.now(),!1;this.resources={...this.resources,...s.resources??{}},Object.keys(this.resources).forEach(m=>{Number.isFinite(this.resources[m])||(this.resources[m]=0)}),this.enemyScaling=Pg(Qg,s.enemyScaling??{}),this.enemyCalmSecondsRemaining=0;const r={};Object.entries(s.buildings??{}).forEach(([m,p])=>{Q2[m]&&(r[m]=p)}),this.buildings=r,this.buildingPlacements.clear(),s.buildingPlacements&&Object.entries(s.buildingPlacements).forEach(([m,p])=>{const g=lE(p);if(!g)return;this.buildingPlacements.set(m,g);const[b,v]=m.split(",").map(Number);if(a){const E=a.ensureTile(b,v);E.placeBuilding(g.type),E.reveal(),sh({q:b,r:v},a.hexSize)}ne.emit("buildingPlaced",{building:g,coord:{q:b,r:v},state:this})}),this.lastSaved=s.lastSaved??Date.now();const o=s.ngPlus?ka(s.ngPlus):this.ngPlus;if(this.ngPlus=Ca(o),this.policies=new Set,this.passiveGeneration={...nc},this.nightWorkSpeedMultiplier=1,(Array.isArray(s.policies)?s.policies.filter(m=>typeof m=="string"):[]).forEach(m=>{const p=Xg(m);p&&(this.policies.add(p.id),ne.emit(Ht.APPLIED,{policy:p,state:this}))}),s.passiveGeneration){const m={...nc};Object.keys(nc).forEach(p=>{const g=s.passiveGeneration?.[p];typeof g=="number"&&Number.isFinite(g)&&(m[p]=g)}),this.passiveGeneration=m}typeof s.nightWorkSpeedMultiplier=="number"&&Number.isFinite(s.nightWorkSpeedMultiplier)&&(this.nightWorkSpeedMultiplier=s.nightWorkSpeedMultiplier);const f=Date.now()-this.lastSaved,h=Math.floor(f/this.tickInterval);return Object.keys(this.passiveGeneration).forEach(m=>{this.resources[m]+=h*this.passiveGeneration[m]}),!0}getResource(a){return this.resources[a]}canAfford(a,s=ie.SAUNA_BEER){return this.resources[s]>=a}spendResource(a,s=ie.SAUNA_BEER){return this.spend(a,s)}spend(a,s=ie.SAUNA_BEER){return this.canAfford(a,s)?(this.resources[s]-=a,ne.emit("resourceChanged",{resource:s,amount:-a,total:this.resources[s]}),!0):!1}addResource(a,s){this.resources[a]+=s,ne.emit("resourceChanged",{resource:a,amount:s,total:this.resources[a]})}modifyPassiveGeneration(a,s){this.passiveGeneration[a]=(this.passiveGeneration[a]??0)+s}setEnemyScalingBase(a){return this.enemyScaling=Pg(this.enemyScaling,a),{...this.enemyScaling}}applyEnemyScalingModifiers(a){const s={aggression:$s(this.enemyScaling.aggression*(a.aggression??1),.1,8,this.enemyScaling.aggression),cadence:$s(this.enemyScaling.cadence*(a.cadence??1),.25,6,this.enemyScaling.cadence),strength:$s(this.enemyScaling.strength*(a.strength??1),.25,12,this.enemyScaling.strength)};return this.enemyScaling=s,{...this.enemyScaling}}getEnemyScalingSnapshot(){return{...this.enemyScaling,calmSecondsRemaining:Math.max(0,this.enemyCalmSecondsRemaining)}}requestEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(this.enemyCalmSecondsRemaining,s),this.enemyCalmSecondsRemaining)}advanceEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(0,this.enemyCalmSecondsRemaining-s),this.enemyCalmSecondsRemaining)}clearEnemyCalm(){this.enemyCalmSecondsRemaining=0}construct(a,s,r=ie.SAUNA_BEER){return this.spend(s,r)?(this.buildings[a]=(this.buildings[a]??0)+1,!0):!1}placeBuilding(a,s,r,o=ie.SAUNA_BEER){const u=r.getTile(s.q,s.r);return!u||u.building||!this.construct(a.type,a.cost,o)?!1:(this.buildingPlacements.set(Ef(s),a),u.placeBuilding(a.type),ne.emit("buildingPlaced",{building:a,coord:s,state:this}),!0)}getBuildingAt(a){return this.buildingPlacements.get(Ef(a))}removeBuilding(a,s){const r=Ef(a),o=this.buildingPlacements.get(r);return o?(this.buildingPlacements.delete(r),s.getTile(a.q,a.r)?.placeBuilding(null),this.buildings[o.type]!==void 0&&(this.buildings[o.type]-=1,this.buildings[o.type]<=0&&delete this.buildings[o.type]),ne.emit("buildingRemoved",{building:o,coord:a,state:this}),!0):!1}upgrade(a,s,r=ie.SAUNA_BEER){return this.construct(`upgrade:${a}`,s,r)}applyPolicy(a){const s=Xg(a);if(!s){const u={policyId:a,state:this,reason:"unknown-policy"};return ne.emit(Ht.REJECTED,u),!1}if(this.hasPolicy(s.id)){const u={policyId:s.id,policy:s,state:this,reason:"already-applied"};return ne.emit(Ht.REJECTED,u),!1}const r=s.prerequisites.filter(u=>!u.isSatisfied(this));if(r.length>0){const u={policyId:s.id,policy:s,state:this,reason:"prerequisites-not-met",missingPrerequisites:r};return ne.emit(Ht.REJECTED,u),!1}if(!this.spend(s.cost,s.resource)){const u={policyId:s.id,policy:s,state:this,reason:"insufficient-resources"};return ne.emit(Ht.REJECTED,u),!1}this.policies.add(s.id);const o={policy:s,state:this};return ne.emit(Ht.APPLIED,o),!0}hasPolicy(a){return this.policies.has(a)}getNgPlusState(){return{...this.ngPlus}}setNgPlusState(a){const s=ka({...this.ngPlus,...a});return this.ngPlus=Ca(s),this.ngPlus}}class cE{constructor(a,s){this.baseInterval=a,this.onTick=s}timer=null;speed=1;lastTick=0;accumulator=0;start(){this.stop(),this.lastTick=Date.now();const a=this.baseInterval/this.speed;this.timer=setInterval(()=>{const s=Date.now(),r=s-this.lastTick;this.lastTick=s,this.onTick(r)},a)}stop(){this.timer!==null&&(clearInterval(this.timer),this.timer=null)}setSpeed(a){if(a<=0)throw new Error("Speed multiplier must be positive");this.speed=a,this.timer!==null&&this.start()}getSpeed(){return this.speed}getBaseInterval(){return this.baseInterval}tick(a){for(this.accumulator+=a*this.speed;this.accumulator>=this.baseInterval;)this.accumulator-=this.baseInterval,this.onTick(this.baseInterval)}}var Sn=(n=>(n[n.Plains=0]="Plains",n[n.Forest=1]="Forest",n[n.Hills=2]="Hills",n[n.Lake=3]="Lake",n))(Sn||{});function uE(n,a,s){let r=n*374761393+a*668265263+s*0x14057b7ef7678100;return r=(r^r>>13)*1274126177,r^=r>>16,(r>>>0)/4294967295}function dE(n,a,s=0){const r=uE(n,a,s);return r<.1?3:r<.3?1:r<.5?2:0}class fE{_terrain;_building;_isFogged;listeners=new Set;constructor(a=Sn.Plains,s=null,r=!0){this._terrain=a,this._building=s,this._isFogged=r}get terrain(){return this._terrain}set terrain(a){this._terrain!==a&&(this._terrain=a,this.notify("terrain"))}get building(){return this._building}set building(a){this._building!==a&&(this._building=a,this.notify("building"))}get isFogged(){return this._isFogged}set isFogged(a){this._isFogged!==a&&(this._isFogged=a,this.notify("fog"))}reveal(){this.isFogged=!1}placeBuilding(a){this.building=a}setFogged(a){this.isFogged=a}addMutationListener(a){return this.listeners.add(a),()=>this.listeners.delete(a)}notify(a){for(const s of this.listeners)s(a)}}class hE{constructor(a=10,s=10,r=32,o=0){this.hexSize=r,this.seed=o,this.minQ=0,this.minR=0,this.maxQ=a-1,this.maxR=s-1}tiles=new Map;tileSubscriptions=new Map;changeListeners=new Set;minQ;maxQ;minR;maxR;get width(){return this.maxQ-this.minQ+1}get height(){return this.maxR-this.minR+1}key(a,s){return`${a},${s}`}addTileChangeListener(a){return this.changeListeners.add(a),()=>this.changeListeners.delete(a)}notifyTileChange(a,s,r){for(const o of this.changeListeners)o(a,s,r)}attachTileListener(a,s,r){const o=s.addMutationListener(u=>{this.notifyTileChange(r,s,u)});this.tileSubscriptions.set(a,o)}ensureTile(a,s){const r=this.key(a,s);let o=this.tiles.get(r);return o||(o=new fE(dE(a,s,this.seed)),this.tiles.set(r,o),this.minQ=Math.min(this.minQ,a),this.maxQ=Math.max(this.maxQ,a),this.minR=Math.min(this.minR,s),this.maxR=Math.max(this.maxR,s),this.attachTileListener(r,o,{q:a,r:s}),this.notifyTileChange({q:a,r:s},o,"created"),o.isFogged||sh({q:a,r:s},this.hexSize)),o}getTile(a,s){return this.tiles.get(this.key(a,s))}forEachTile(a){for(const[s,r]of this.tiles){const[o,u]=s.split(",").map(Number);a(r,{q:o,r:u})}}getNeighbors(a,s){return kc({q:a,r:s}).map(r=>this.ensureTile(r.q,r.r))}revealAround(a,s,r={}){const{autoFrame:o=!0}=r;for(let h=-s;h<=s;h++){const m=Math.max(-s,-h-s),p=Math.min(s,-h+s);for(let g=m;g<=p;g++){const b={q:a.q+h,r:a.r+g};this.ensureTile(b.q,b.r).reveal(),sh(b,this.hexSize)}}if(!o)return;const u=typeof window<"u"?(()=>{const h=Math.max(window.innerWidth,0),m=Math.max(window.innerHeight,0);let p=0;if(typeof document<"u"){const b=document.getElementById("right-panel");if(b){const v=b.getBoundingClientRect();if(v.width>0){const E=b.closest("#ui-overlay");if(E){const M=E.getBoundingClientRect(),C=window.getComputedStyle(E),R=Number.parseFloat(C.paddingRight||"0"),N=M.right-v.left,q=v.width+(Number.isFinite(R)?R:0);p=Math.max(0,Math.max(N,q))}else p=Math.max(0,v.width)}}}const g=Math.min(Math.max(p,0),h);return{width:h,height:m,safeRight:g}})():{width:0,height:0,safeRight:0},f=PS(u);ZS(f,300)}}const Lc={TRIGGERED:"scheduler:eventTriggered",RESOLVED:"scheduler:eventResolved"},mE=new Map;function pE(){return globalThis.localStorage??null}function el(n){return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}function P2(n){const a=globalThis.crypto;return a?.randomUUID?a.randomUUID():`${n}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function gE(n){const a={id:String(n.id??""),label:String(n.label??""),description:n.description?String(n.description):void 0,event:n.event?String(n.event):void 0,payload:n.payload,accent:n.accent??void 0};return a.id||(a.id=P2("choice")),a.label||(a.label="Choose"),a}function Uc(n){const a={id:String(n.id??""),headline:String(n.headline??""),body:String(n.body??""),art:n.art?String(n.art):void 0,typography:n.typography,animation:n.animation,accentColor:n.accentColor?String(n.accentColor):void 0,acknowledgeText:n.acknowledgeText?String(n.acknowledgeText):void 0,choices:Array.isArray(n.choices)?n.choices.map(s=>gE(s)):void 0};return a.id||(a.id=P2("event")),a}function yE(n){return{content:Uc(n.content),trigger:n.trigger.type==="time"?{type:"time",at:Number.isFinite(n.trigger.at)?n.trigger.at:0}:{type:"condition",conditionId:String(n.trigger.conditionId),params:n.trigger.params}}}function Zg(n){return{content:Uc(n.content),triggeredAt:Number.isFinite(n.triggeredAt)?n.triggeredAt:0}}const Mf=Object.freeze({clock:0,queue:[],active:[]});class bE{storageKey;eventBus;getStorage;state=el(Mf);subscribers=new Set;constructor(a={}){this.storageKey=a.storageKey??"autobattles:event-scheduler",this.eventBus=a.eventBus??ne,this.getStorage=a.storageProvider??pE,this.load()}subscribe(a){return this.subscribers.add(a),a(this.getActiveEvents()),()=>{this.subscribers.delete(a)}}getActiveEvents(){return this.state.active.map(a=>({...el(a.content),triggeredAt:a.triggeredAt}))}schedule(a){const s=Uc(a.content);if(!s.headline||!s.body||this.containsEvent(s.id))return!1;const r=a.trigger.type==="condition"?{type:"condition",conditionId:String(a.trigger.conditionId),params:a.trigger.params}:{type:"time",at:this.resolveTriggerTime(a.trigger)};return this.state.queue.push({content:s,trigger:r}),this.sortQueue(),this.save(),!0}publish(a){const s=Uc(a);this.containsEvent(s.id)||(this.state.queue=this.state.queue.filter(r=>r.content.id!==s.id),this.activateEvent({content:s,triggeredAt:this.state.clock}))}tick(a,s={}){if(!Number.isFinite(a)||a<=0)return;this.state.clock+=a;const r=[],o=[];for(const u of this.state.queue)this.shouldTrigger(u.trigger,s)?r.push(u):o.push(u);this.state.queue=o;for(const u of r)this.activateEvent({content:u.content,triggeredAt:this.state.clock});this.save()}resolve(a,s){const r=this.state.active.findIndex(h=>h.content.id===a);if(r===-1)return!1;const o=this.state.active[r],u=this.pickChoice(o.content,s),f=u?u.id:null;return this.state.active.splice(r,1),this.save(),this.notify(),this.eventBus.emit(Lc.RESOLVED,{eventId:a,choiceId:f,event:o.content}),u?.event&&this.eventBus.emit(u.event,{eventId:a,choiceId:f,payload:u.payload,event:o.content}),!0}reset(){this.state=el(Mf),this.save(),this.notify()}activateEvent(a){const s=Zg(a);this.state.active.push(s),this.save(),this.notify(),this.eventBus.emit(Lc.TRIGGERED,{event:{...el(s.content),triggeredAt:s.triggeredAt}})}pickChoice(a,s){const r=a.choices??[];if(r.length!==0){if(s){const o=r.find(u=>u.id===s);if(o)return o}return r[0]}}shouldTrigger(a,s){if(a.type==="time")return this.state.clock>=a.at;const r=mE.get(a.conditionId);if(!r)return!1;try{return!!r(a.params,s)}catch(o){return console.warn("Scheduler condition evaluation failed",a.conditionId,o),!1}}resolveTriggerTime(a){if(Number.isFinite(a.at))return Number(a.at);const s=Number.isFinite(a.in)?Number(a.in):0;return Math.max(0,this.state.clock+s)}sortQueue(){this.state.queue.sort((a,s)=>{const r=a.trigger.type==="time"?a.trigger.at:Number.POSITIVE_INFINITY,o=s.trigger.type==="time"?s.trigger.at:Number.POSITIVE_INFINITY;return r-o})}containsEvent(a){return this.state.active.some(s=>s.content.id===a)||this.state.queue.some(s=>s.content.id===a)}notify(){const a=this.getActiveEvents();for(const s of this.subscribers)try{s(a)}catch(r){console.warn("Scheduler subscriber failed",r)}}load(){const a=Oh(this.storageKey);if(!a){this.state=el(Mf);return}const s=Number(a.clock);this.state={clock:Number.isFinite(s)?s:0,queue:Array.isArray(a.queue)?a.queue.map(r=>yE(r)):[],active:Array.isArray(a.active)?a.active.map(r=>Zg(r)):[]}}save(){const a=this.getStorage();if(a)try{a.setItem(this.storageKey,JSON.stringify({clock:this.state.clock,queue:this.state.queue,active:this.state.active}))}catch(s){console.warn("Scheduler persistence failed",s)}}}const Tc=new bE;function vE(n,a){const s=new WeakSet,r=o=>{o.policy.id===n.id&&(a.once!==!1&&s.has(o.state)||(a.invoke(o),a.once!==!1&&s.add(o.state)))};ne.on(a.event,r)}for(const n of Y2())for(const a of n.effects)vE(n,a);const SE="modulepreload",EE=function(n){return"/"+n},Jg={},ME=function(a,s,r){let o=Promise.resolve();if(s&&s.length>0){let m=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),h=f?.nonce||f?.getAttribute("nonce");o=m(s.map(p=>{if(p=EE(p),p in Jg)return;Jg[p]=!0;const g=p.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const v=document.createElement("link");if(v.rel=g?"stylesheet":SE,g||(v.as="script"),v.crossOrigin="",v.href=p,h&&v.setAttribute("nonce",h),document.head.appendChild(v),g)return new Promise((E,M)=>{v.addEventListener("load",E),v.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${p}`)))})}))}function u(f){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=f,window.dispatchEvent(h),!h.defaultPrevented)throw f}return o.then(f=>{for(const h of f||[])h.status==="rejected"&&u(h.reason);return a().catch(u)})},xE=({building:n,coord:a,state:s})=>{n instanceof Uh?s.modifyPassiveGeneration(ie.SAUNA_BEER,n.beerPerTick):n instanceof O2&&ME(async()=>{const{spawnUnit:r}=await Promise.resolve().then(()=>zM);return{spawnUnit:r}},void 0).then(({spawnUnit:r})=>{r(s,"soldier",`barracks-${a.q}-${a.r}`,a,"player")})},wE=({building:n,state:a})=>{n instanceof Uh&&a.modifyPassiveGeneration(ie.SAUNA_BEER,-n.beerPerTick)};ne.on("buildingPlaced",xE);ne.on("buildingRemoved",wE);const Ln={master:{defaultVolume:.9,volumeKey:"audio.mixer.master.volume",muteKey:"audio.mixer.master.muted"},music:{defaultVolume:.65,volumeKey:"audio.mixer.music.volume",muteKey:"audio.mixer.music.muted"},sfx:{defaultVolume:1,volumeKey:"audio.mixer.sfx.volume",muteKey:"audio.mixer.sfx.muted"}},Ze={master:{volume:Ln.master.defaultVolume,muted:!1},music:{volume:Ln.music.defaultVolume,muted:!1},sfx:{volume:Ln.sfx.defaultVolume,muted:!1}},Xn={};let _n=null,oh=!1;const ch=new Set;function zh(n,a){return Number.isFinite(n)?n<=0?0:n>=1?1:n:a}function tu(){if(typeof localStorage>"u")return null;try{return localStorage}catch(n){return console.warn("Audio mixer storage unavailable",n),null}}function AE(n){const a=tu();if(!a)return null;try{const s=a.getItem(Ln[n].volumeKey);if(s===null)return null;const r=Number.parseFloat(s);return Number.isFinite(r)?zh(r,Ln[n].defaultVolume):null}catch(s){return console.warn("Failed to restore volume setting",n,s),null}}function CE(n){const a=tu();if(!a)return null;try{const s=a.getItem(Ln[n].muteKey);return s===null?null:s==="true"}catch(s){return console.warn("Failed to restore mute setting",n,s),null}}for(const n of Object.keys(Ln)){const a=AE(n),s=CE(n);a!==null&&(Ze[n].volume=zh(a,Ln[n].defaultVolume)),s!==null&&(Ze[n].muted=s)}function TE(n){const a=tu();if(a)try{a.setItem(Ln[n].volumeKey,Ze[n].volume.toFixed(3))}catch(s){console.warn("Failed to persist volume setting",n,s)}}function _E(n){const a=tu();if(a)try{a.setItem(Ln[n].muteKey,Ze[n].muted?"true":"false")}catch(s){console.warn("Failed to persist mute setting",n,s)}}function Wg(){if(typeof window>"u"||!_n||oh)return;const n=()=>{_n?.resume().catch(()=>{})};window.addEventListener("pointerdown",n,{once:!0}),window.addEventListener("keydown",n,{once:!0}),oh=!0}function Bh(n){const a=Xn[n];if(!a)return;const{volume:s,muted:r}=Ze[n],o=r?0:s;a.gain.value=o}function Z2(n){if(!Xn.master){const a=n.createGain();a.gain.value=Ze.master.muted?0:Ze.master.volume,a.connect(n.destination),Xn.master=a}if(!Xn.music){const a=n.createGain();a.gain.value=Ze.music.muted?0:Ze.music.volume,a.connect(Xn.master),Xn.music=a}if(!Xn.sfx){const a=n.createGain();a.gain.value=Ze.sfx.muted?0:Ze.sfx.volume,a.connect(Xn.master),Xn.sfx=a}}function Hh(){if(_n||typeof window>"u")return _n;const n=window.AudioContext||window.webkitAudioContext;if(!n)return console.warn("Web Audio API not supported"),null;try{_n=new n,Z2(_n),Wg()}catch(a){return console.warn("Unable to create AudioContext",a),_n=null,null}return _n.state==="suspended"&&(oh=!1,Wg()),_n}function RE(){return _n??Hh()}function xf(n){const a=Ze.master;if(n==="master")return a.muted?0:a.volume;const s=Ze[n];return s.muted||a.muted?0:s.volume*a.volume}function jh(n){const a=RE();if(!a)return null;Z2(a);const s=Xn[n];return s?(Bh(n),s):null}function nu(){return{channels:{master:{volume:Ze.master.volume,muted:Ze.master.muted,effectiveVolume:xf("master")},music:{volume:Ze.music.volume,muted:Ze.music.muted,effectiveVolume:xf("music")},sfx:{volume:Ze.sfx.volume,muted:Ze.sfx.muted,effectiveVolume:xf("sfx")}},contextState:_n?.state??"uninitialized"}}function J2(){const n=nu();for(const a of ch)a(n)}function Gh(n){return ch.add(n),()=>{ch.delete(n)}}function Ih(n,a){const s=zh(a,Ln[n].defaultVolume);Ze[n].volume!==s&&(Ze[n].volume=s,TE(n),Bh(n),J2())}function Yh(n,a){Ze[n].muted!==a&&(Ze[n].muted=a,_E(n),Bh(n),J2())}function NE(n){Ih("master",n)}function kE(n){Ih("music",n)}function DE(n){Ih("sfx",n)}function LE(n){Yh("master",n)}function UE(n){Yh("music",n)}function OE(n){Yh("sfx",n)}function Oc(n){return nu().channels[n]}const qE=48e3;function zE(n){let a=n>>>0;return()=>{a+=1831565813;let s=a;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}}function BE(n,a,s){const{attack:r,decay:o,sustain:u,release:f,sustainLevel:h}=n;if(r>0&&s<r)return s/r;if(o>0&&s<r+o){const m=(s-r)/o;return 1-(1-h)*m}if(s<a-f)return h;if(f>0&&s<a){const m=(s-(a-f))/f;return h*(1-m)}return 0}function HE(n,a,s){const r=n.phase??0,o=n.vibrato,u=n.tremolo,f=o?1+o.depth*Math.sin(2*Math.PI*o.speed*s):1,h=u?n.gain*(1-u.depth+u.depth*Math.sin(2*Math.PI*u.speed*s)):n.gain,m=a*n.ratio*f;return h*Math.sin(2*Math.PI*m*s+r)}function jE(n,a){return n.gain*(a()*2-1)}function GE(n,a=qE){const s=Math.max(1,Math.floor(n.duration*a)),r=new Float32Array(s),o=zE(n.seed);for(let u=0;u<s;u++){const f=u/a;let h=0;for(const p of n.layers)p.type==="sine"?h+=HE(p,n.baseFrequency,f):h+=jE(p,o);const m=BE(n.envelope,n.duration,f);r[u]=h*m}return r}const wf={attack:{variants:[{id:"attack-a",label:"Gentle Birch Strike",description:"Soft mallet transient with subtle shimmer.",duration:.9,baseFrequency:220,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:421,loudness:{lufs:-14.775,peakDb:-2.134,gain:.8684}},{id:"attack-b",label:"Rounded Pluck Echo",description:"A slightly brighter chime tuned above the root.",duration:.9,baseFrequency:232,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:947,loudness:{lufs:-14.758,peakDb:-2.101,gain:.8667}},{id:"attack-c",label:"High Drift Pluck",description:"Upper register tap with airy decay.",duration:.9,baseFrequency:244,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:1337,loudness:{lufs:-14.731,peakDb:-2.076,gain:.8641}}]},death:{variants:[{id:"death-a",label:"Hollow Exhale",description:"Low cedar drum pulse with airy noise tail.",duration:1.15,baseFrequency:150,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:615,loudness:{lufs:-14.365,peakDb:-.218,gain:.8284}},{id:"death-b",label:"Soft Ember Fall",description:"Mid register thump with drifting undertone.",duration:1.15,baseFrequency:168,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:274,loudness:{lufs:-14.204,peakDb:-.185,gain:.8132}},{id:"death-c",label:"Warm Resolve",description:"Higher pitch breathy release with gentle rumble.",duration:1.15,baseFrequency:184,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:978,loudness:{lufs:-14.079,peakDb:-.16,gain:.8015}}]},sisu:{variants:[{id:"sisu-a",label:"Rising Steam",description:"Slow bloom of airy sine pads with hushed texture.",duration:1.9,baseFrequency:176,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1204,loudness:{lufs:-12.754,peakDb:-.501,gain:.6882}},{id:"sisu-b",label:"Glowing Drift",description:"Warmer harmonic swell with chorus shimmer.",duration:1.9,baseFrequency:188,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1642,loudness:{lufs:-12.943,peakDb:-.271,gain:.7033}},{id:"sisu-c",label:"Morning Brilliance",description:"Bright tonic swell with shimmering overtones.",duration:1.9,baseFrequency:200,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:2019,loudness:{lufs:-12.888,peakDb:-.235,gain:.6989}}]}};function Af(n){return{id:n.id,label:n.label,envelope:n.envelope,gain:n.loudness.gain,loader:a=>{const s=GE(n,a.sampleRate),r=a.createBuffer(1,s.length,a.sampleRate);return r.getChannelData(0).set(s),r}}}const IE={click:{variants:[{id:"ui-click-soft",label:"UI soft tap",envelope:{attack:0,decay:.05,sustain:0,release:.03,sustainLevel:0},loader:n=>FE(n)}],debounce:{windowMs:35,weight:.5,maxWeight:1.5},polyphony:6},spawn:{variants:[{id:"ui-spawn-chime",label:"Roster invite tone",envelope:{attack:0,decay:.2,sustain:.5,release:.2,sustainLevel:.5},loader:n=>$E(n)}],debounce:{windowMs:150,weight:.7,maxWeight:1.4},polyphony:3},error:{variants:[{id:"ui-error-tone",label:"Gentle warning tap",envelope:{attack:.01,decay:.2,sustain:.2,release:.2,sustainLevel:.2},loader:n=>VE(n)}],debounce:{windowMs:220,weight:1,maxWeight:1},polyphony:2},attack:{variants:wf.attack.variants.map(Af),debounce:{windowMs:120,weight:.6,maxWeight:1.2},polyphony:3},death:{variants:wf.death.variants.map(Af),debounce:{windowMs:360,weight:1,maxWeight:1.5},polyphony:3},sisu:{variants:wf.sisu.variants.map(Af),debounce:{windowMs:900,weight:1,maxWeight:1},polyphony:1}};let ac=null;const ey=new Map,ic=new Map,qc=new Map,Vs=new Map,ml=new Map,ty=new Map,Bt={node:null,destination:null,envelope:0,lastUpdate:0},tl={attackSeconds:.04,releaseSeconds:.6,depth:.55,floor:.25},uh=new Set;function Fh(){const n=Oc("master"),a=Oc("sfx");return n.muted||a.muted}function YE(){const n=Fh();for(const a of uh)a(n)}function $h(n,a,s){const r=Math.floor(n.sampleRate*a),o=n.createBuffer(1,r,n.sampleRate),u=o.getChannelData(0);for(let f=0;f<r;f++){const h=f/n.sampleRate;u[f]=s(h)}return o}function FE(n){return $h(n,.05,a=>Math.sin(2*Math.PI*1e3*a)*Math.exp(-40*a))}function $E(n){return $h(n,.2,a=>(Math.sin(2*Math.PI*440*a)+Math.sin(2*Math.PI*660*a))*.5*Math.exp(-6*a))}function VE(n){return $h(n,.3,a=>Math.sin(2*Math.PI*110*a)*Math.exp(-8*a))}function ny(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function XE(n,a){return`${n}:${a}`}function KE(n,a,s){const r=XE(n,a),o=ey.get(r);if(o)return Promise.resolve(o);const u=ic.get(r);if(u)return u;const f=Vh();if(!f)return Promise.reject(new Error("Audio context unavailable"));const h=Promise.resolve(s.loader(f)).then(m=>(ey.set(r,m),ic.delete(r),m)).catch(m=>{throw ic.delete(r),m});return ic.set(r,h),h}function ay(n){const a=n.polyphony;return!Number.isFinite(a)||!a||a<=0?Number.POSITIVE_INFINITY:a}function QE(n,a){const s=qc.get(n);if(!s||s.length===0)return[];const r=[];for(const o of s)o.time>=a&&r.push(o);return qc.set(n,r),r}function PE(n,a,s){const r=a.debounce;if(!r)return{blocked:!1,weight:0};const o=r.weight??1,u=r.windowMs,f=s-u,h=QE(n,f);let m=0;for(const p of h)m+=p.weight;return m+o>r.maxWeight?{blocked:!0}:{blocked:!1,weight:o}}function ZE(n,a,s){if(s<=0)return;const r=qc.get(n)??[];r.push({time:a,weight:s}),qc.set(n,r)}function JE(n){const a=(Vs.get(n)??0)+1;Vs.set(n,a)}function WE(n){const a=Vs.get(n)??0;if(a<=1){Vs.delete(n);return}Vs.set(n,a-1)}function iy(n,a){if(!Number.isFinite(a))return!1;const s=ml.get(n)?.size??0,r=Vs.get(n)??0;return s+r>=a}function eM(n,a){let s=ml.get(n);s||(s=new Set,ml.set(n,s)),s.add(a);let r=!1;const o=()=>{if(r)return;r=!0;const u=ml.get(n);u?.delete(a),u&&u.size===0&&ml.delete(n)};if(typeof a.addEventListener=="function")a.addEventListener("ended",()=>{o()},{once:!0});else{const u=a.onended;a.onended=()=>{try{u?.call(a)}finally{o()}}}return o}function tM(n,a){const s=Bt.node;if(!s||s.context!==n){Bt.node?.disconnect();const r=n.createGain();return r.gain.value=1,r.connect(a),Bt.node=r,Bt.destination=a,Bt.envelope=0,Bt.lastUpdate=n.currentTime,r}return Bt.destination!==a&&(s.disconnect(),s.connect(a),Bt.destination=a),s}function nM(n){const a=Bt.node;if(!a)return;const s=n.currentTime,r=.6,o=.55,u=Math.max(0,s-Bt.lastUpdate),f=Math.exp(-u/r);Bt.envelope*=f,Bt.envelope=Math.min(1,Bt.envelope+o),Bt.lastUpdate=s;const p=Math.max(.35,1-Bt.envelope*.5),g=.02;a.gain.cancelScheduledValues(s),a.gain.setValueAtTime(a.gain.value,s),a.gain.linearRampToValueAtTime(p,s+g),a.gain.setTargetAtTime(1,s+g,r)}function aM(n){const a=jh("music");if(!a)return;const s=Oc("master"),r=Oc("music");if(s.muted||r.muted)return;const o=r.volume;if(o<=0)return;const u=n.currentTime,f=a.gain.value,h=o*(1-tl.depth),m=o*tl.floor,p=Math.min(f,Math.max(h,m));a.gain.cancelScheduledValues(u),a.gain.setValueAtTime(f,u),a.gain.linearRampToValueAtTime(p,u+tl.attackSeconds),a.gain.setTargetAtTime(o,u+tl.attackSeconds,tl.releaseSeconds)}function Wn(n){if(dh())return;const a=IE[n];if(!a)return;const s=a.variants;if(!s||s.length===0)return;let r=0,o=s[0];s.length>1&&(r=((ty.get(n)??Math.floor(Math.random()*s.length)-1)+1)%s.length,o=s[r],ty.set(n,r));const u=ny(),f=PE(n,a,u);if(f.blocked)return;const h=ay(a);if(iy(n,h))return;JE(n);let m=!1;const p=()=>{m||(WE(n),m=!0)};KE(n,r,o).then(g=>{if(p(),dh())return;const b=Vh();if(!b)return;const v=jh("sfx");if(!v)return;const E=ay(a);if(iy(n,E))return;const M=b.createBufferSource();M.buffer=g;const C=o.gain;let R=M;if(typeof C=="number"&&C>0&&C!==1){const j=b.createGain();j.gain.value=C,M.connect(j),R=j}const N=n==="attack"?tM(b,v):v;R.connect(N);const q=eM(n,M);try{M.start(),n==="attack"&&nM(b),n==="sisu"&&aM(b);const j=ny();!f.blocked&&f.weight>0&&ZE(n,j,f.weight)}catch(j){console.warn("Unable to start sound",j),q()}}).catch(g=>{p(),!(g instanceof Error&&g.message==="Audio context unavailable")&&console.warn("Failed to play sound",n,g)}).finally(()=>{p()})}function dh(){return Fh()}function iM(n){return uh.add(n),()=>{uh.delete(n)}}typeof document<"u"&&document.addEventListener("click",n=>{n.target instanceof HTMLButtonElement&&Wn("click")});let sy=Fh();Gh(n=>{const a=n.channels.master.muted||n.channels.sfx.muted;a!==sy&&(sy=a,YE())});function Vh(){return ac||(ac=Hh(),ac)}Vh();const ry="__autobattlesAudioEvents__",ly=globalThis;ly[ry]||(ne.on("unitDamaged",n=>{!n||n.amount<=0||Wn("attack")}),ne.on("unitDied",()=>{Wn("death")}),ne.on("sisuBurstStart",()=>{Wn("sisu")}),ly[ry]=!0);function sM(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function rM(n){const a={};if(!n)return a;for(const[s,r]of Object.entries(n))typeof r=="function"&&(a[s]=r);return a}class lM{constructor(a=ne){this.emitter=a}modifiers=new Map;hookIndex=new Map;listeners=new Map;add(a){if(typeof a.id!="string"||a.id.length===0)throw new Error("Modifier id must be a non-empty string");if((typeof a.duration!="number"||!Number.isFinite(a.duration))&&a.duration!==1/0)throw new Error("Modifier duration must be a positive number or Infinity");if(Number.isFinite(a.duration)&&a.duration<=0)throw new Error("Modifier duration must be greater than zero");const s=rM(a.hooks),r=sM();this.modifiers.has(a.id)&&this.remove(a.id,"replaced");const o={...a,hooks:s,remaining:a.duration,appliedAt:r};this.modifiers.set(o.id,o),this.indexHooks(o);const u={runtime:this,modifier:o};return a.onApply?.(u),this.emit("modifierAdded",{modifier:o}),this.emitter?.emit("modifierAdded",{modifier:o}),Number.isFinite(o.remaining)&&o.remaining<=0&&this.remove(o.id,"expired"),o}has(a){return this.modifiers.has(a)}list(){return Array.from(this.modifiers.values()).map(a=>({...a,hooks:{...a.hooks}}))}remove(a,s="manual"){const r=this.modifiers.get(a);if(!r)return!1;this.modifiers.delete(a),this.unindexHooks(r);const o={runtime:this,modifier:r,reason:s};return r.onExpire?.(o),s==="expired"&&(this.emit("modifierExpired",{modifier:r}),this.emitter?.emit("modifierExpired",{modifier:r})),this.emit("modifierRemoved",{modifier:r,reason:s}),this.emitter?.emit("modifierRemoved",{modifier:r,reason:s}),!0}advance(a){if(typeof a!="number"||a<=0)return;const s=[];for(const r of this.modifiers.values())Number.isFinite(r.remaining)&&(r.remaining=Math.max(0,r.remaining-a),r.remaining<=0&&s.push(r.id));for(const r of s)this.remove(r,"expired")}trigger(a,s){const r=this.hookIndex.get(a);if(!r||r.size===0)return;const o=Array.from(r);for(const u of o){const f=this.modifiers.get(u);if(!f){r.delete(u);continue}const h=f.hooks[a];if(!h){r.delete(u);continue}h(s,{runtime:this,modifier:f})}}clear(){const a=Array.from(this.modifiers.keys());for(const s of a)this.remove(s,"manual")}on(a,s){const r=this.listeners.get(a)??new Set;r.add(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);r&&(r.delete(s),r.size===0&&this.listeners.delete(a))}emit(a,s){const r=this.listeners.get(a);if(!(!r||r.size===0))for(const o of Array.from(r))o(s)}indexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s)??new Set;r.add(a.id),this.hookIndex.set(s,r)}}unindexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s);r&&(r.delete(a.id),r.size===0&&this.hookIndex.delete(s))}}}const au=new lM,oM=n=>au.add(n),cM=(n,a="manual")=>au.remove(n,a),uM=n=>{au.advance(n)},sc=(n,a)=>{au.trigger(n,a)};class dM{constructor(a,s,r){this.owner=a,this.entries=s,this.log=r}runTick(a,s){for(const{definition:r,state:o}of this.entries){if(!r.onTick)continue;const u=r.onTick({owner:this.owner,state:o,self:a,opponent:s}),f=Ii(u?.shieldDamage??0);if(f>0){const m=Math.min(a.shield,f);m>0&&(a.shield-=m,this.log.tickShieldDamage+=m)}const h=Ii(u?.hpDamage??0);if(h>0){const m=Math.min(a.health,h);m>0&&(a.health-=m,this.log.tickHpDamage+=m)}}}grantShield(a,s){let r=0;for(const{definition:o,state:u}of this.entries){if(!o.onGrantShield)continue;const f=Ii(o.onGrantShield({owner:this.owner,state:u,self:a,opponent:s})??0);f>0&&(r+=f)}return r>0&&(a.shield+=r,this.log.shieldGranted+=r),r}consumeShield(a,s,r){let o=Ii(a);if(o<=0)return 0;let u=0;for(const{definition:f,state:h}of this.entries){if(!f.onConsumeShield||o<=0)continue;const m=Ii(f.onConsumeShield({owner:this.owner,state:h,self:s,opponent:r,amount:o})??0);if(m<=0)continue;const p=Math.min(o,m);u+=p,o-=p}return u>0&&(this.log.shieldConsumed+=u),u}applyHit(a,s,r){if(a<=0)return 0;let o=0;for(const{definition:h,state:m}of this.entries){if(!h.onHit)continue;const p=Ii(h.onHit({owner:this.owner,state:m,self:s,opponent:r,hpDamage:a})??0);p>0&&(o+=p)}if(o<=0)return 0;const u=Math.max(0,s.maxHealth-s.health);if(u<=0)return 0;const f=Math.min(u,o);return f>0&&(s.health+=f,this.log.lifesteal+=f),f}getShieldValue(){let a=0;for(const{definition:s,state:r}of this.entries){if(!s.onGrantShield||r.keyword!=="Shield")continue;const o=fh(r);if(o<=0)continue;const u=Math.max(0,Number.isFinite(r.stacks)?r.stacks:0);u<=0||(a+=u*o)}return a}}function fM(){return{attacker:cy(),defender:cy()}}function oy(n,a,s){const r=hM(n);if(r.length===0)return null;const o=[];for(const u of r){const f=W2.get(u.keyword);f&&o.push({state:u,definition:f})}return o.length===0?null:new dM(a,o,s)}const W2=new Map;function iu(n,a){W2.set(n,a)}function cy(){return{tickHpDamage:0,tickShieldDamage:0,shieldGranted:0,shieldConsumed:0,lifesteal:0,keywordShieldRemaining:0}}function Ii(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function Js(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function Nl(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function hM(n){if(!n)return[];const a=[],s=n;if(typeof s[Symbol.iterator]=="function"){for(const r of s){const o=uy(r);o&&a.push(o)}return a}if(typeof n=="object")for(const r of Object.values(n)){const o=uy(r);o&&a.push(o)}return a}function uy(n){if(!n||typeof n!="object")return null;const a=n;if(!Object.prototype.hasOwnProperty.call(a,"stacks"))return null;const s=mM(a.keyword);if(!s)return null;const r=a;return r.keyword=s,r.stacks=Js(r.stacks),Object.prototype.hasOwnProperty.call(a,"potency")&&r.potency!==void 0&&(r.potency=Nl(r.potency)),r}function mM(n){if(typeof n!="string")return null;switch(n.trim().toLowerCase()){case"bleed":return"Bleed";case"burn":return"Burn";case"lifesteal":case"life-steal":return"Lifesteal";case"shield":return"Shield";default:return null}}function fh(n){const a=n.potency!==void 0?Nl(n.potency):1;return a>0?a:0}function pM(n){if(n.potency!==void 0){const r=Nl(n.potency);return r>0?r:0}const a=Js(n.stacks);if(a<=0)return 0;const s=a*.2;return s>0?s:0}iu("Bleed",{onTick({state:n,self:a}){const s=Js(n.stacks);if(s<=0||a.health<=0){n.stacks=s;return}const r=n.potency!==void 0?Nl(n.potency):1,o=s*r;if(o<=0)return;const u=Math.min(a.health,o);return n.stacks=Math.max(0,s-1),{hpDamage:u}}});iu("Burn",{onTick({state:n,self:a}){const s=Js(n.stacks);if(s<=0){n.stacks=s;return}const r=n.potency!==void 0?Nl(n.potency):1,o=s*r;if(o<=0)return;const u=Math.min(a.shield,o),f=o-u,h=Math.min(a.health,f);return n.stacks=Math.max(0,s-1),{shieldDamage:u,hpDamage:h}}});iu("Shield",{onGrantShield({state:n}){const a=Js(n.stacks);if(a<=0)return n.stacks=a,0;const s=a*fh(n);return s>0?s:0},onConsumeShield({state:n,amount:a}){const s=Js(n.stacks);if(s<=0)return n.stacks=0,0;const r=fh(n);if(r<=0)return n.stacks=0,0;const o=s*r;if(o<=0)return n.stacks=0,0;const u=Math.min(o,Ii(a)),f=u/r;return n.stacks=Math.max(0,s-f),u>0?u:0}});iu("Lifesteal",{onHit({state:n,hpDamage:a}){if(a<=0)return 0;const s=pM(n);if(s<=0)return 0;const r=a*s;return r>0?r:0}});function Rn(n){return Number.isFinite(n)?Math.max(0,n):0}function dy(n,a){const s=Rn(a?.health??n?.health??0),r=Rn(a?.shield??n?.shield??0);return{id:n?.id??"unknown",faction:n?.faction,health:s,maxHealth:n?.maxHealth,shield:r}}function fy(n){if(!n)return!1;const a=n;return typeof a.onHit=="function"||typeof a.onKill=="function"||Array.isArray(a.onHit)||Array.isArray(a.onKill)}function hy(n){return n?Array.isArray(n)?n.filter(a=>typeof a=="function"):typeof n=="function"?[n]:[]:[]}function gM(n){if(!n)return[];if(typeof n[Symbol.iterator]=="function"){const s=[];for(const r of n)fy(r)&&s.push(r);return s}return Object.values(n).filter(s=>fy(s))}function rc(n,a,s){if(!n)return;const r=hy(n.hooks?.[a]);for(const u of r)u(s);const o=gM(n.keywords);for(const u of o)for(const f of hy(u[a]))f(s)}function my(n){const a=Rn(n?.health??0),s=Rn(n?.maxHealth??a);return{health:a,maxHealth:Math.max(s,a),shield:Rn(n?.shield??0)}}function yM(){return{health:0,maxHealth:0,shield:0}}function bM(n){const a=n.attacker??null,s=n.defender,r=n.baseDamage,o=Rn(n.minimumDamage??1),u=Number.isFinite(r)?Rn(r):Rn(a?.attack??0),f=Rn(s.defense??0),h=fM(),m=my(s),p=a?my(a):null,g=oy(s.keywords??null,"defender",h.defender),b=a?oy(a.keywords??null,"attacker",h.attacker):null,v=p??yM();g&&g.runTick(m,v),b&&p&&b.runTick(p,m);const E=m.health>0,M=Rn(m.shield);g&&g.grantShield(m,v);const C=Rn(m.shield),R=E?Math.max(o,u-f):0,N=E?Math.min(C,R):0,q=E?Math.max(0,R-N):0;m.shield=Math.max(0,C-N);const j=Math.min(M,N),F=Math.max(0,N-j);g&&F>0&&g.consumeShield(F,m,v);const Q=g?g.getShieldValue():0;h.defender.keywordShieldRemaining=Q;const se=Math.max(0,M-j);m.shield=se+Q;const ee=m.health;m.health=Math.max(0,ee-q);const le=m.health,P=le<=0;let I=0;b&&p?(I=b.applyHit(q,p,m),h.attacker.keywordShieldRemaining=b.getShieldValue()):h.attacker.keywordShieldRemaining=0;const T=dy(a,p??void 0),k=dy(s,{health:le,shield:se+Q}),A={attacker:T,defender:k,damage:R,shieldDamage:N,hpDamage:q,lethal:P},Y={...A,source:"defender"};if(rc(s,"onHit",Y),sc("combat:onHit",Y),a){const B={...A,source:"attacker"};rc(a,"onHit",B),sc("combat:onHit",B),P&&(rc(a,"onKill",B),sc("combat:onKill",B))}return P&&(rc(s,"onKill",Y),sc("combat:onKill",Y)),{damage:R,shieldDamage:N,hpDamage:q,lethal:P,remainingHealth:le,remainingShield:se+Q,attackerHealing:I,attackerRemainingHealth:p?.health,attackerRemainingShield:p?.shield,keywordEffects:h}}const py=5;function ln(n){return`${n.q},${n.r}`}function gy(n){const[a,s]=n.split(",").map(Number);return{q:a,r:s}}function zs(n){return{q:n.q,r:n.r}}class vM{constructor(a,s,r,o,u,f=[]){this.id=a,this.type=s,this.faction=o,this.stats=u,this.priorityFactions=f,this.coord=zs(r),this.renderCoord=zs(r),this.maxHealth=u.health}alive=!0;listeners={};maxHealth;healMarkerElapsed=0;healAmountBuffer=0;cachedTargetKey;cachedStartKey;cachedPath;movementCooldownSeconds=0;shield=0;immortal=!1;experience=0;combatHooks=null;combatKeywords=null;coord;renderCoord;setCoord(a,s){this.coord=zs(a),(s?.snapRender??!0)&&(this.renderCoord=zs(a))}setRenderCoord(a){this.renderCoord=zs(a)}snapRenderToCoord(a=this.coord){this.renderCoord=zs(a)}onDeath(a){(this.listeners.death??=[]).push(a)}emitDeath(){for(const a of this.listeners.death??[])a()}isDead(){return!this.alive}getMaxHealth(){return this.maxHealth}distanceTo(a){return Gs(this.coord,a)}getVisionRange(){const{visionRange:a}=this.stats;return Number.isFinite(a)?a:3}attack(a){return this.distanceTo(a.coord)>this.stats.attackRange?null:a.takeDamage(this.stats.attackDamage,this)}update(a,s){if(!(this.isDead()||!s))if(Gs(this.coord,s.pos)<=s.auraRadius){const r=this.stats.health;if(this.stats.health=Math.min(this.stats.health+s.regenPerSec*a,this.maxHealth),this.stats.health>r){const o=this.stats.health-r;this.healMarkerElapsed+=a,this.healAmountBuffer+=o,(this.healMarkerElapsed>=.9||this.healAmountBuffer>=2)&&this.flushHealEvent()}}else this.healAmountBuffer>0&&this.flushHealEvent(),this.healMarkerElapsed=0,this.healAmountBuffer=0}flushHealEvent(){if(this.healAmountBuffer<=0){this.healMarkerElapsed=0;return}const a=Math.round(this.healAmountBuffer*10)/10;a>0&&ne.emit("unitHealed",{unitId:this.id,amount:a,remainingHealth:this.stats.health}),this.healAmountBuffer=0,this.healMarkerElapsed=0}takeDamage(a,s){const r=Number.isFinite(a);if(r&&a<=0||!r&&!s)return null;const o=s?s.toCombatParticipant():null,u=this.toCombatParticipant(),f=bM({attacker:o,defender:u,baseDamage:r?a:void 0});this.stats.health=f.remainingHealth,this.shield=f.remainingShield;let h=f;if(f.lethal&&this.alive&&this.immortal&&(this.stats.health=Math.max(1,this.stats.health),h={...f,lethal:!1,remainingHealth:this.stats.health,remainingShield:this.shield}),s&&f.attackerRemainingHealth!==void 0){const m=Math.min(s.getMaxHealth(),Math.max(0,f.attackerRemainingHealth));s.stats.health=m}return s&&f.attackerRemainingShield!==void 0&&s.setShield(f.attackerRemainingShield),h.damage>0&&ne.emit("unitDamaged",{attackerId:s?.id,targetId:this.id,amount:h.damage,remainingHealth:this.stats.health}),h.lethal&&this.alive&&(this.stats.health=0,this.alive=!1,this.snapRenderToCoord(),ne.emit("unitDied",{unitId:this.id,attackerId:s?.id,unitFaction:this.faction,attackerFaction:s?.faction}),this.emitDeath()),h}getShield(){return this.shield}setShield(a){if(!Number.isFinite(a)||a<=0){this.shield=0;return}this.shield=a}updateStats(a){this.stats.attackDamage=a.attackDamage,this.stats.attackRange=a.attackRange,this.stats.movementRange=a.movementRange,typeof a.defense=="number"&&Number.isFinite(a.defense)?this.stats.defense=a.defense:delete this.stats.defense,typeof a.visionRange=="number"&&Number.isFinite(a.visionRange)&&(this.stats.visionRange=a.visionRange);const s=Math.max(1,Math.round(a.health));this.maxHealth=s,this.stats.health=Math.min(s,Math.max(0,this.stats.health))}isImmortal(){return this.immortal}setImmortal(a){this.immortal=!!a}getExperience(){return this.experience}setExperience(a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;s!==this.experience&&(this.experience=s,ne.emit("unit:xpChanged",{unitId:this.id,xp:this.experience}))}addExperience(a){if(!Number.isFinite(a)||a===0)return this.experience;const s=Math.max(0,Math.floor(this.experience+a));return this.setExperience(s),this.experience}toCombatParticipant(){return{id:this.id,faction:this.faction,attack:this.stats.attackDamage,defense:this.stats.defense,health:this.stats.health,maxHealth:this.maxHealth,shield:this.shield,hooks:this.combatHooks,keywords:this.combatKeywords}}addMovementTime(a){!Number.isFinite(a)||a<=0||(this.movementCooldownSeconds+=a)}canStep(a=py){return this.movementCooldownSeconds>=a}consumeMovementCooldown(a=py){return this.canStep(a)?(this.movementCooldownSeconds-=a,!0):!1}moveTowards(a,s,r){const o=this.getPathTo(a,s,r);if(o.length<2)return[];let u=0;const f=ln(a);for(let m=1;m<o.length;m++){const p=ln(o[m]);if(r.has(p)){p!==f&&this.clearPathCache();break}u=m}if(u===0)return[];const h=Math.min(this.stats.movementRange,u);return o.slice(0,h+1)}getPathTo(a,s,r){const o=ln(this.coord),u=ln(a);return(!this.cachedPath||this.cachedTargetKey!==u||this.cachedStartKey!==o)&&(this.cachedPath=this.findPath(a,s,r),this.cachedTargetKey=u,this.cachedStartKey=o),this.cachedPath}advancePathCache(a){!this.cachedPath||a<=0||(this.cachedPath=this.cachedPath.slice(a),this.cachedPath.length>0?this.cachedStartKey=ln(this.cachedPath[0]):(this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0))}clearPathCache(){this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0}findPath(a,s,r){const o=this.coord,u=ln(o),f=ln(a),h=new Set([u]),m=new Map([[u,null]]),p=new Map([[u,0]]),g=new Map([[u,Gs(o,a)]]);for(;h.size>0;){let E=null,M=1/0;for(const N of h){const q=g.get(N)??1/0;q<M&&(M=q,E=N)}if(E===null||E===f)break;h.delete(E);const C=gy(E),R=p.get(E)??1/0;for(const N of kc(C)){const q=ln(N);if(q!==f&&!this.isPassable(N,s,r))continue;const j=R+1;j<(p.get(q)??1/0)&&(m.set(q,E),p.set(q,j),g.set(q,j+Gs(N,a)),h.add(q))}}if(!m.has(f))return[o];const b=[];let v=f;for(;v;)b.push(gy(v)),v=m.get(v)??null;return b.reverse()}seekNearestEnemy(a,s,r){const o=new Map;for(const h of a)o.set(ln(h.coord),h);const u=[this.coord],f=new Set([ln(this.coord)]);for(;u.length>0;){const h=u.shift(),m=ln(h),p=o.get(m);if(p)return p;for(const g of kc(h)){const b=ln(g),v=o.get(b);if(v)return v;this.isPassable(g,s,r)&&(f.has(b)||(f.add(b),u.push(g)))}}return null}canTraverse(a,s,r){return this.isPassable(a,s,r)}isPassable(a,s,r){const o=s.getTile(a.q,a.r);return!o||r&&r.has(ln(a))?!1:o.terrain!==Sn.Lake}}class SM{static selectTarget(a,s){let r=s.filter(u=>u.faction!==a.faction&&!u.isDead());if(r.length===0)return null;if(a.priorityFactions.length>0){const u=r.filter(f=>a.priorityFactions.includes(f.faction));u.length>0&&(r=u)}const o=r.filter(u=>a.distanceTo(u.coord)<=a.stats.attackRange);return o.length>0?(o.sort((u,f)=>u.stats.health-f.stats.health),o[0]):(r.sort((u,f)=>a.distanceTo(u.coord)-a.distanceTo(f.coord)),r[0]??null)}}const EM=4,MM=8;class xM{buckets=[];bucketCount=0;currentBucket=0;minBuckets;maxBuckets;constructor(a={}){this.minBuckets=a.minBuckets??EM,this.maxBuckets=a.maxBuckets??MM}reset(){this.buckets=[],this.bucketCount=0,this.currentBucket=0}next(a){const s=a.length;if(s===0)return this.reset(),[];const r=this.computeBucketCount(s);r!==this.bucketCount&&(this.bucketCount=r,this.currentBucket=this.currentBucket%Math.max(1,r)),this.rebuildBuckets(a);const o=this.buckets[this.currentBucket]??[];return this.bucketCount>0&&(this.currentBucket=(this.currentBucket+1)%this.bucketCount),o}rebuildBuckets(a){const s=this.bucketCount;this.buckets=Array.from({length:s},()=>[]);const r=[...a].sort((o,u)=>o.id.localeCompare(u.id));for(let o=0;o<r.length;o++){const u=o%s;this.buckets[u].push(r[o])}}computeBucketCount(a){if(a<=0)return 0;const s=Math.ceil(a/12);let r=Math.max(this.minBuckets,s);return r=Math.min(this.maxBuckets,r),r=Math.min(r,a),r=Math.max(1,r),r}}function Cf(n){return`${n.q},${n.r}`}const wM=500;class AM{cache=new Map;targetIndex=new Map;targetPositions=new Map;ttlMs;constructor(a=wM){this.ttlMs=a}clearExpired(a=Date.now()){for(const[s,r]of this.cache.entries())if(r.expiresAt<=a&&(this.cache.delete(s),r.targetId)){const o=this.targetIndex.get(r.targetId);o?.delete(s),o&&o.size===0&&this.targetIndex.delete(r.targetId)}}trackUnit(a){this.invalidateIfTargetMoved(a.id,Cf(a.coord))}invalidateForUnit(a){const s=this.targetIndex.get(a);if(s){for(const r of s)this.cache.delete(r);this.targetIndex.delete(a)}this.targetPositions.delete(a)}getPath(a,s,r,o,u={}){const f=u.now??Date.now(),h=u.targetId,m=Cf(s);h&&this.invalidateIfTargetMoved(h,m);const p=this.hashObstacles(o),g=this.createCacheKey(Cf(a.coord),m,p),b=this.cache.get(g);if(b&&b.expiresAt>f)return b.path;a.clearPathCache();const v=a.getPathTo(s,r,o);if(this.cache.set(g,{path:v,expiresAt:f+this.ttlMs,targetId:h}),h){let E=this.targetIndex.get(h);E||(E=new Set,this.targetIndex.set(h,E)),E.add(g),this.targetPositions.set(h,m)}return v}invalidateIfTargetMoved(a,s){const r=this.targetPositions.get(a);if(!r){this.targetPositions.set(a,s);return}if(r===s)return;const o=this.targetIndex.get(a);if(o){for(const u of o)this.cache.delete(u);o.clear()}this.targetPositions.set(a,s)}hashObstacles(a){return a.size===0?"empty":Array.from(a).sort().join("|")}createCacheKey(a,s,r){return`${a}->${s}|${r}`}}const CM={baseThreshold:50,heatPerSecond:50/30,thresholdGrowth:.05,coolingPerSecond:0};function qt(n,a=0){return Number.isFinite(n)?n:a}class TM{heat;threshold;baseThreshold;thresholdGrowthFactor;heatPerSecond;coolingPerSecond;maxStoredHeat;constructor(a={}){const s={...CM,...a},r=Math.max(1,qt(s.baseThreshold,50)),o=Math.max(1,qt(a.initialThreshold??r,r));this.baseThreshold=r,this.threshold=o,this.thresholdGrowthFactor=1+Math.max(0,qt(s.thresholdGrowth,0)),this.heatPerSecond=Math.max(0,qt(s.heatPerSecond,0)),this.coolingPerSecond=Math.max(0,qt(s.coolingPerSecond,0));const u=qt(s.maxStoredHeat??Number.NaN,Number.NaN);this.maxStoredHeat=Number.isFinite(u)&&u>=0?u:null;const f=Math.max(0,qt(a.initialHeat??0,0));this.heat=this.setHeatInternal(f)}getHeat(){return this.heat}getThreshold(){return this.threshold}getBuildRate(){return this.heatPerSecond}getCoolingRate(){return this.coolingPerSecond}reset(){this.heat=0,this.threshold=this.baseThreshold}setHeat(a){const s=Math.max(0,qt(a,0));return this.heat=this.setHeatInternal(s),this.heat}setHeatInternal(a){const s=Math.max(0,qt(a,0));return this.maxStoredHeat===null?(this.heat=s,this.heat):(this.heat=Math.min(s,this.maxStoredHeat),this.heat)}addHeat(a){const s=Math.max(0,qt(a,0));if(s<=0)return 0;const r=this.heat,o=r+s;return this.heat=this.maxStoredHeat===null?o:Math.min(o,this.maxStoredHeat),this.heat-r}cool(a){const s=Math.max(0,qt(a,0));if(s<=0||this.heat<=0)return 0;const r=this.heat;return this.heat=Math.max(0,this.heat-s),r-this.heat}vent(a=1){const s=Math.max(0,Math.min(1,qt(a,1)));return s<=0?0:this.cool(this.threshold*s)}advance(a,s){const r=Math.max(0,qt(a,0)),o=this.heatPerSecond,u=r>0?o*r:0,f=Math.max(0,qt(s?.bonusHeat??0,0)),h=u+f,m=this.addHeat(h),p=Math.max(0,qt(s?.coolingMultiplier??1,1)),g=r>0?this.coolingPerSecond*r*p:0,b=this.cool(g);return{addedHeat:m,cooledHeat:b,heat:this.heat}}hasTriggerReady(){return this.heat>=this.threshold-1e-6}consumeTrigger(){return this.hasTriggerReady()?(this.cool(this.threshold),this.threshold=Math.max(this.baseThreshold,this.threshold*this.thresholdGrowthFactor),!0):!1}timeUntilNextTrigger(){return this.hasTriggerReady()?0:this.heatPerSecond<=0?Number.POSITIVE_INFINITY:Math.max(0,this.threshold-this.heat)/this.heatPerSecond}getCooldownSeconds(){return this.heatPerSecond<=0?Number.POSITIVE_INFINITY:this.threshold/this.heatPerSecond}}function _M(n){return new TM(n)}const yy=500;function eb(n,a,s){const r=typeof a=="number"?a:2,o=(typeof a=="number"?s:a)??[],u=[];for(let h=-r;h<=r;h++){const m=Math.max(-r,-h-r),p=Math.min(r,-h+r);for(let g=m;g<=p;g++){const b=Math.max(Math.abs(h),Math.abs(g),Math.abs(-h-g));if(b===0||b>r)continue;const v={q:n.q+h,r:n.r+g};o.some(M=>!M.isDead()&&M.coord.q===v.q&&M.coord.r===v.r)||u.push(v)}}if(u.length===0)return null;const f=Math.floor(Math.random()*u.length);return u[f]}function RM(n,a,s={}){const r=_M(a),o=r.getBuildRate(),u=r.getCooldownSeconds(),f=r.timeUntilNextTrigger(),h=Number.isFinite(s.maxRosterSize)?Math.max(0,Math.floor(s.maxRosterSize??0)):0,m=Number.isFinite(s.maxHealth)?Math.max(1,Math.floor(s.maxHealth??yy)):yy,p=Number.isFinite(s.health)?Math.max(0,Math.min(m,Math.floor(s.health??m))):m;return{id:"sauna",pos:n,auraRadius:2,regenPerSec:1,rallyToFront:!1,maxRosterSize:h,maxHealth:m,health:p,destroyed:p<=0,heat:r.getHeat(),heatPerTick:o,playerSpawnThreshold:r.getThreshold(),playerSpawnCooldown:Number.isFinite(u)?u:0,playerSpawnTimer:Number.isFinite(f)?f:0,beerUpkeepAccumulator:0,heatTracker:r}}function NM(n,a){if(!Number.isFinite(a)||a<=0||n.destroyed)return{amount:0,remainingHealth:Math.max(0,n.health),destroyed:n.destroyed};const s=Math.max(0,n.health),r=Math.min(s,Math.max(0,Math.floor(a))),o=Math.max(0,s-r);return n.health=o,o<=0&&(n.health=0,n.destroyed=!0),{amount:r,remainingHealth:n.health,destroyed:n.destroyed}}const kM=30;function zt(n){return`${n.q},${n.r}`}class DM{constructor(a,s){this.map=a,this.animator=s}scheduler=new xM;pathCache=new AM;lastKnownCoords=new Map;findExplorationGoal(a,s){const r=a.coord;if(this.map.ensureTile(r.q,r.r).isFogged&&a.canTraverse(r,this.map,s))return r;const u=new Set([zt(r)]),f=[r];for(;f.length>0;){const h=f.shift(),m=kc(h),p=this.map.getNeighbors(h.q,h.r);for(let g=0;g<m.length;g++){const b=m[g],v=p[g],E=zt(b);if(!u.has(E)&&(u.add(E),!!a.canTraverse(b,this.map,s))){if(v.isFogged)return b;f.push(b)}}}return null}tick(a,s,r){const o=a.length,u=Date.now();if(this.pathCache.clearExpired(u),o===0){this.scheduler.reset();return}const f=new Set,h=[],m=new Set;for(const g of a){if(g.addMovementTime(s),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g),this.lastKnownCoords.delete(g.id);continue}const b=this.lastKnownCoords.get(g.id);b&&Gs(b,g.coord)>1&&this.animator?.clear(g,{snap:!0}),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r}),this.pathCache.trackUnit(g),h.push(g),f.add(zt(g.coord)),m.add(g.id)}for(const g of[...this.lastKnownCoords.keys()])m.has(g)||this.lastKnownCoords.delete(g);if(h.length===0){this.scheduler.reset();return}const p=this.scheduler.next(h);if(p.length!==0)for(const g of p){const b=zt(g.coord);if(f.delete(b),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g);continue}const v=SM.selectTarget(g,a);if(!v&&r&&!r.destroyed&&this.tryAttackSauna(g,r)){const q=zt(g.coord);f.add(q);continue}if(!v){let N=null;if(r&&!r.destroyed&&(N=r.pos),N||(N=this.findExplorationGoal(g,f)),N){const j=this.computeMovementPath(g,N,f,u);if(j.length>1&&g.stats.movementRange>0){const F=j[1],Q=zt(F);if(f.has(Q))g.clearPathCache();else{if(!g.canStep()){f.add(b);continue}if(g.consumeMovementCooldown()){const se={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(F,{snapRender:!1}),this.animator.enqueue(g,[se,F])):g.setCoord(F),g.advancePathCache(1);const ee=zt(g.coord);ee===zt(N)&&g.clearPathCache(),f.add(ee),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});continue}}}else g.clearPathCache()}else g.clearPathCache();const q=zt(g.coord);f.add(q),r&&!r.destroyed&&this.tryAttackSauna(g,r);continue}if(v.isDead()){g.clearPathCache(),f.add(b);continue}const E=zt(v.coord),M=this.pathCache.getPath(g,v.coord,this.map,f,{now:u,targetId:v.id});if(M.length>1&&g.stats.movementRange>0){const N=M[1],q=zt(N),j=q===E;if(!f.has(q)||j){if(g.canStep()&&g.consumeMovementCooldown()){const F={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(N,{snapRender:!1}),this.animator.enqueue(g,[F,N])):g.setCoord(N),g.advancePathCache(1)}}else g.clearPathCache()}const C=zt(g.coord);f.add(C),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});const R=zt(v.coord);R!==E&&g.clearPathCache(),g.distanceTo(v.coord)<=g.stats.attackRange&&!v.isDead()&&((g.attack(v)?.lethal??!1)||v.isDead())&&(f.delete(R),g.clearPathCache(),this.pathCache.invalidateForUnit(v.id),this.animator?.clear(v))}}tryAttackSauna(a,s){if(a.faction==="player")return!1;const r=a.stats.attackRange;if(r<=0||a.distanceTo(s.pos)>r)return!1;const o=NM(s,a.stats.attackDamage);if(o.amount<=0)return!1;const u={attackerId:a.id,attackerFaction:a.faction,amount:o.amount,remainingHealth:o.remainingHealth};if(ne.emit("saunaDamaged",u),o.destroyed){const f={attackerId:a.id,attackerFaction:a.faction};ne.emit("saunaDestroyed",f)}return!0}computeMovementPath(a,s,r,o){const u=this.pathCache.getPath(a,s,this.map,r,{now:o});if(u.length<2)return[];let f=0;const h=zt(s);for(let p=1;p<u.length;p++){const g=zt(u[p]);if(r.has(g)){g!==h&&a.clearPathCache();break}f=p}if(f===0)return[];const m=Math.min(a.stats.movementRange,f);return u.slice(0,m+1)}}function su(n){if(!Number.isFinite(n??NaN))return 1;const a=Math.floor(n);return Math.max(1,a)}function LM(n){return Math.max(0,su(n)-1)}function UM(n,a="linear"){const s=LM(n);switch(a){case"accelerating":return s*(s+1)/2;case"diminishing":return s===0?0:Math.log2(s+1);case"linear":default:return s}}function OM(n,a="round"){switch(a){case"floor":return Math.floor(n);case"ceil":return Math.ceil(n);case"none":return n;case"round":default:return Math.round(n)}}function qM(n,a,s){let r=n;return Number.isFinite(a)&&(r=Math.max(r,a)),Number.isFinite(s)&&(r=Math.min(r,s)),r}function nl(n,a){const s=su(a),r=n.curve??"linear",o=UM(s,r),u=n.base+n.growth*o,f=qM(u,n.min,n.max);return OM(f,n.round??"round")}function kl(n,a){const s=su(a),r=n.stats,o={health:nl(r.health,s),attackDamage:nl(r.attackDamage,s),attackRange:nl(r.attackRange,s),movementRange:nl(r.movementRange,s)};return r.visionRange&&(o.visionRange=nl(r.visionRange,s)),o}function by(n){if(typeof n=="number"&&Number.isFinite(n))return n}function zc(n,a){let s=n.health,r=n.attackDamage,o=n.attackRange,u=n.movementRange,f=by(n.defense),h=by(n.shield);for(const p of a){const g=Math.max(1,Math.round(p.quantity)),b=p.modifiers;typeof b.health=="number"&&(s+=b.health*g),typeof b.attackDamage=="number"&&(r+=b.attackDamage*g),typeof b.attackRange=="number"&&(o+=b.attackRange*g),typeof b.movementRange=="number"&&(u+=b.movementRange*g),typeof b.defense=="number"&&(f=(f??0)+b.defense*g),typeof b.shield=="number"&&(h=(h??0)+b.shield*g)}const m={health:Math.max(1,Math.round(s)),attackDamage:Math.max(0,Math.round(r)),attackRange:Math.max(0,Math.round(o)),movementRange:Math.max(0,Math.round(u))};return f!==void 0&&(m.defense=Math.max(0,Math.round(f))),h!==void 0&&(m.shield=Math.max(0,Math.round(h))),typeof n.visionRange=="number"&&Number.isFinite(n.visionRange)&&(m.visionRange=Math.max(0,Math.round(n.visionRange))),m}const Xh=Object.freeze({id:"soldier",displayName:"Sauna Soldier",cost:50,tags:["infantry","melee"],stats:{health:{base:20,growth:6,curve:"linear",round:"round"},attackDamage:{base:5,growth:1,curve:"linear",round:"round"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:0,round:"round"}}}),Kh=Object.freeze({id:"archer",displayName:"Sauna Archer",cost:75,tags:["ranged"],stats:{health:{base:15,growth:4,curve:"linear",round:"round"},attackDamage:{base:3,growth:.4,curve:"accelerating",round:"ceil"},attackRange:{base:3,growth:.5,curve:"diminishing",round:"ceil",max:5},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:.25,curve:"linear",round:"round",max:5}}}),tb=Object.freeze({id:"avanto-marauder",displayName:"Avanto Marauder",cost:0,tags:["enemy","melee"],stats:{health:{base:12,growth:5,curve:"linear",round:"round"},attackDamage:{base:4,growth:.6,curve:"accelerating",round:"ceil"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:.25,curve:"linear",round:"round",max:2},visionRange:{base:3,growth:0,round:"round"}}}),nb=Object.freeze({soldier:Xh,archer:Kh,"avanto-marauder":tb});function Qh(n){return nb[n]??null}Object.freeze(Object.keys(nb));const vy=Xh.cost;Object.freeze(kl(Xh,1));Kh.cost;Object.freeze(kl(Kh,1));Object.freeze(kl(tb,1));function ab(n,a,s,r,o){const u=su(o?.level),f=kl(n,u);return new vM(a,n.id,s,r,f,n.priorityFactions)}function ib(n,a,s,r,o){const u=Qh(n);return u?ab(u,a,s,r,o):null}function Ph(n,a,s,r,o,u){const f=Qh(a);if(!f)return null;const h=f.cost;if(!n.canAfford(h,ie.SAUNA_BEER))return Wn("error"),null;n.addResource(ie.SAUNA_BEER,-h);const m=ab(f,s,r,o,u);return Wn("spawn"),ne.emit("unitSpawned",{unit:m}),m}const zM=Object.freeze(Object.defineProperty({__proto__:null,createUnit:ib,spawnUnit:Ph},Symbol.toStringTag,{value:"Module"})),BM=["Aino","Eero","Ilona","Kalevi","Lumi","Mika","Noora","Oskari","Saana","Tapio","Veera","Yrjö"],HM=["Emberguard","Frostwalker","Steamcaller","Dawnwatch","Gritforged","Stormchant","Snowborn","Torchbearer","Chillwarden","Sisuheart"],jM=["Aalto","Halla","Karhu","Korhonen","Laine","Metsä","Niemi","Salmi","Tuomi","Virta"];function Tf(n,a){if(n.length===0)throw new Error("Cannot select a name from an empty collection.");const s=Math.floor(a()*n.length);return n[Math.min(s,n.length-1)]}function GM(n=Math.random){const a=Tf(BM,n),s=Tf(HM,n),r=Tf(jM,n);return`${a} "${s}" ${r}`}const Ws=Object.freeze(["supply","weapon","focus","relic"]);function sb(){return{supply:null,weapon:null,focus:null,relic:null}}const IM=Object.freeze({supply:Object.freeze({id:"supply",label:"Supply Satchel",description:"Consumables and restorative provisions carried into battle.",maxStacks:5}),weapon:Object.freeze({id:"weapon",label:"Primary Armament",description:"The attendant's main weapon or ranged kit.",maxStacks:1}),focus:Object.freeze({id:"focus",label:"Battle Focus",description:"Tools that sharpen aim, steps, or battlefield intuition.",maxStacks:1}),relic:Object.freeze({id:"relic",label:"Sauna Relic",description:"Charms and relics that empower the attendant's resolve.",maxStacks:1})}),YM=Object.freeze({"birch-sap-satchel":Object.freeze({id:"birch-sap-satchel",slot:"supply",modifiers:{health:3},maxStacks:3}),"steamed-bandages":Object.freeze({id:"steamed-bandages",slot:"supply",modifiers:{shield:4},maxStacks:2}),"aurora-distillate":Object.freeze({id:"aurora-distillate",slot:"supply",modifiers:{attackDamage:2,defense:1},maxStacks:1}),"stolen-sauna-tokens":Object.freeze({id:"stolen-sauna-tokens",slot:"supply",modifiers:{movementRange:.5},maxStacks:5}),"midnight-bloodwine":Object.freeze({id:"midnight-bloodwine",slot:"supply",modifiers:{health:6,attackDamage:1},maxStacks:1}),"sauna-incense":Object.freeze({id:"sauna-incense",slot:"supply",modifiers:{attackRange:1},maxStacks:2}),"glacier-brand":Object.freeze({id:"glacier-brand",slot:"weapon",modifiers:{attackDamage:3},maxStacks:1}),"emberglass-arrow":Object.freeze({id:"emberglass-arrow",slot:"weapon",modifiers:{attackDamage:1,attackRange:2},maxStacks:1}),"aurora-lattice":Object.freeze({id:"aurora-lattice",slot:"focus",modifiers:{attackDamage:2,attackRange:1},maxStacks:1}),"emberglass-shard":Object.freeze({id:"emberglass-shard",slot:"focus",modifiers:{attackDamage:1,movementRange:1},maxStacks:1}),"windstep-totem":Object.freeze({id:"windstep-totem",slot:"focus",modifiers:{movementRange:1,defense:1},maxStacks:1}),"searing-chant-censer":Object.freeze({id:"searing-chant-censer",slot:"focus",modifiers:{attackDamage:2,shield:2},maxStacks:1}),"cracked-ice-amulet":Object.freeze({id:"cracked-ice-amulet",slot:"relic",modifiers:{defense:2},maxStacks:1}),"myrsky-charm":Object.freeze({id:"myrsky-charm",slot:"relic",modifiers:{attackRange:1,defense:1},maxStacks:1}),"frostwyrm-signet":Object.freeze({id:"frostwyrm-signet",slot:"relic",modifiers:{shield:5},maxStacks:1}),"spirit-oak-charm":Object.freeze({id:"spirit-oak-charm",slot:"relic",modifiers:{defense:1,health:2},maxStacks:1})});function Dl(n){const a=IM[n];if(!a)throw new Error(`Unknown equipment slot: ${n}`);return a}function Ll(n){return YM[n]}function rb(n){return Number.isFinite(n)?Math.max(1,Math.round(n)):1}function lb(n,a){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:a}}function ob(n,a,s,r){const o=Dl(a),u=Math.max(1,Math.floor(s.maxStacks??o.maxStacks)),f=Math.min(u,r),h=s.modifiers??{};return{...lb(n,f),slot:a,maxStacks:u,modifiers:h}}function hh(n){n.equipment||(n.equipment=sb());for(const a of Ws)n.equipment[a]??=null;return n.equipment}function kn(n){const a=[];for(const s of Ws){const r=n[s];r&&a.push({...r})}return a}function Zh(n){return kn(n).map(a=>lb(a,a.quantity))}function _f(n){const a=sb();for(const s of n){const r=Ll(s.id);if(!r)continue;const o=rb(s.quantity),u=a[r.slot];if(u&&u.id!==s.id)continue;const f=(u?.quantity??0)+o,h=ob(s,r.slot,r,f);a[r.slot]=h}return a}function FM(n,a){const s=Ll(a.id);if(!s)return{success:!1,slot:"supply",loadout:kn(hh(n)),item:null,reason:"unknown-item"};const r=hh(n),o=s.slot,u=Dl(o),f=rb(a.quantity),h=Math.max(1,Math.floor(s.maxStacks??u.maxStacks)),m=r[o];if(m&&m.id!==a.id)return{success:!1,slot:o,loadout:kn(r),item:m,reason:"slot-occupied"};const p=Math.min(h,(m?.quantity??0)+f);if((m?.quantity??0)+f>h)return{success:!1,slot:o,loadout:kn(r),item:m,reason:"stack-limit"};const g=ob(a,o,s,p);return r[o]=g,n.items=Zh(r),{success:!0,slot:o,loadout:kn(r),item:g}}function $M(n,a){const s=hh(n),r=s[a];return r?(s[a]=null,n.items=Zh(s),{success:!0,slot:a,loadout:kn(s),removed:r}):{success:!1,slot:a,loadout:kn(s),removed:null,reason:"empty-slot"}}function VM(n,a){return Ll(n)?.slot===a}const XM={q:0,r:0},KM="Saunoja",mh=18,Sy=0,wl=1,ph=4,Bc=1,lc={health:mh,attackDamage:4,attackRange:1,movementRange:1,defense:0,shield:0};function oc(n,a,s){return Math.min(Math.max(n,a),s)}function cc(n,a,s){const r=typeof n=="number"&&Number.isFinite(n)?n:a;return Math.max(s,r)}function Rf(n,a,s=0){if(typeof n=="number"&&Number.isFinite(n))return Math.max(s,n);if(typeof a=="number"&&Number.isFinite(a))return Math.max(s,a)}function Ey(n,a){if(!n||typeof n!="object")return{...a};const s=n,r=cc(s.health,a.health,1),o=cc(s.attackDamage,a.attackDamage,0),u=cc(s.attackRange,a.attackRange,0),f=cc(s.movementRange,a.movementRange,0),h=Rf(s.defense,a.defense,0),m=Rf(s.shield,a.shield,0),p=Rf(s.visionRange,a.visionRange,0);return{health:r,attackDamage:o,attackRange:u,movementRange:f,defense:h,shield:m,visionRange:p}}function QM(n,a){if(!n||typeof n!="object")return _f(a);const s=n,r=[];for(const o of Object.values(s)){const u=cb(o);u&&r.push(u)}return r.length===0?_f(a):_f(r)}function cb(n){if(!n||typeof n!="object")return null;const a=n,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const o=typeof a.description=="string"?a.description.trim():void 0,u=typeof a.icon=="string"?a.icon.trim():void 0,f=typeof a.rarity=="string"?a.rarity.trim():void 0,h=typeof a.quantity=="number"?a.quantity:Number(a.quantity),m=Number.isFinite(h)?Math.max(1,Math.round(h)):1;return{id:s,name:r,description:o,icon:u,rarity:f,quantity:m}}function PM(n){if(!n||n.length===0)return[];const a=[];for(const s of n){const r=cb(s);r&&a.push(r)}return a}function ZM(n){if(!n||typeof n!="object")return null;const a=n,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const o=a.duration;let u=1/0;typeof o=="number"&&Number.isFinite(o)?u=Math.max(0,o):o!==1/0&&(u=1/0);const f=a.remaining;let h=u;typeof f=="number"&&Number.isFinite(f)?h=Math.max(0,f):f===1/0&&(h=1/0),u!==1/0&&h===1/0&&(h=u);const m=a.appliedAt,p=typeof m=="number"&&Number.isFinite(m)?Math.max(0,m):void 0,g=a.stacks,b=typeof g=="number"&&Number.isFinite(g)?Math.max(1,Math.round(g)):void 0,v=typeof a.description=="string"?a.description.trim():void 0,E=typeof a.source=="string"?a.source.trim():void 0;return{id:s,name:r,description:v,duration:u,remaining:h,appliedAt:p,stacks:b,source:E}}function JM(n){if(!n||n.length===0)return[];const a=[];for(const s of n){const r=ZM(s);r&&a.push(r)}return a}function WM(n){if(typeof n=="string"){const a=n.trim();if(a.length>0)return a}try{return GM()}catch(a){return console.warn("Falling back to default Saunoja name",a),KM}}function Jh(n){const{id:a,name:s,coord:r=XM,maxHp:o=mh,hp:u=o,steam:f=0,defense:h,shield:m=0,traits:p=[],upkeep:g=Bc,xp:b=0,lastHitAt:v=Sy,selected:E=!1,items:M,modifiers:C,combatKeywords:R=null,combatHooks:N=null}=n,q=Number.isFinite(o)?Math.max(1,o):mh,j=Number.isFinite(u)?u:q,F=oc(j,0,q),Q=Number.isFinite(f)?f:0,se=oc(Q,0,1),le=(Array.isArray(p)?p:[]).filter(un=>typeof un=="string").map(un=>un.trim()).filter(un=>un.length>0),P=Number.isFinite(g)?g:Bc,I=oc(P,wl,ph),T=Number.isFinite(b)?b:0,k=Math.max(0,T),A=Number.isFinite(v)?v:Sy,Y=Math.max(0,A),B=Number.isFinite(m)?m:0,D=Math.max(0,B),V=Number.isFinite(h)?h:void 0,te=V!==void 0?Math.max(0,V):void 0,he=PM(M),w=JM(C),$=QM(n.equipment,he),W=Zh($),ae={...lc,health:q,defense:te??lc.defense,shield:lc.shield},oe=Ey(n.baseStats,ae),ge={...oe,health:q,defense:te??oe.defense,shield:D},de=Ey(n.effectiveStats,ge),Te=Math.max(1,de.health),xe=oc(F,0,Te),xt=typeof de.defense=="number"?Math.max(0,de.defense):te??void 0,on=typeof de.shield=="number"?Math.max(0,de.shield):D,cn={...oe,health:Math.max(1,oe.health),defense:typeof oe.defense=="number"?Math.max(0,oe.defense):te??void 0,shield:typeof oe.shield=="number"?Math.max(0,oe.shield):lc.shield},Un={...de,health:Te,defense:xt,shield:on},On=WM(s);return{id:a,name:On,coord:{q:r.q,r:r.r},maxHp:Te,hp:xe,defense:xt,shield:on,steam:se,traits:[...le],upkeep:I,xp:k,lastHitAt:Y,selected:E,items:W,baseStats:cn,effectiveStats:Un,equipment:$,modifiers:w,combatKeywords:R,combatHooks:N}}const er=32;function yl(n,a,s,r){n.beginPath();for(let o=0;o<6;o++){const u=Math.PI/3*o,f=a+r*Math.cos(u),h=s+r*Math.sin(u);o===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function Wh(n,a,s){return Math.min(Math.max(n,a),s)}function e3(n,{centerX:a,centerY:s,hp:r,maxHp:o,radius:u=er*.55}){const f=Number.isFinite(o)?Math.max(1,o):1,h=Number.isFinite(r)?r:f,m=Wh(h/f,0,1);if(n.save(),yl(n,a,s,u),n.fillStyle="rgba(7, 11, 18, 0.72)",n.fill(),n.restore(),m>0){n.save(),yl(n,a,s,u),n.clip();const p=n.createLinearGradient(a,s+u,a,s-u);p.addColorStop(0,"rgba(46, 160, 98, 0.35)"),p.addColorStop(1,"rgba(218, 255, 239, 0.95)"),n.fillStyle=p;const g=u*2*m,b=s+u-g;n.fillRect(a-u,b,u*2,g),n.restore()}n.save(),yl(n,a,s,u),n.lineWidth=Math.max(1,u*.12),n.strokeStyle="rgba(255, 255, 255, 0.28)",n.stroke(),n.restore()}function t3(n,{centerX:a,centerY:s,radius:r=er,progress:o=0}){const u=Wh(o,0,1);if(u<=0)return;const f=Number.isFinite(r)&&r>0?r:er;n.save(),n.globalCompositeOperation="lighter",n.globalAlpha=u;const h=n.createRadialGradient(a,s,Math.max(1,f*.1),a,s,f);h.addColorStop(0,"rgba(255, 255, 255, 0.92)"),h.addColorStop(.45,"rgba(255, 255, 255, 0.68)"),h.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=h,n.beginPath(),n.arc(a,s,f,0,Math.PI*2),n.fill(),n.restore()}function n3(n,{centerX:a,centerY:s,radius:r=er*.85,intensity:o=1}){const u=Wh(o,0,1);if(u<=0)return;n.save(),yl(n,a,s,r),n.clip();const f=n.createLinearGradient(a,s+r,a,s-r);f.addColorStop(0,"rgba(255, 255, 255, 0)"),f.addColorStop(.55,`rgba(255, 255, 255, ${.12*u})`),f.addColorStop(1,`rgba(255, 255, 255, ${.35*u})`),n.globalCompositeOperation="lighter",n.fillStyle=f,n.fillRect(a-r,s-r,r*2,r*2),n.restore(),n.save(),n.globalCompositeOperation="lighter",n.lineCap="round",n.strokeStyle=`rgba(255, 255, 255, ${.25*u})`,n.lineWidth=Math.max(1,r*.08);const h=r*.75,m=r*.35;for(let p=0;p<3;p++){const g=s-r*.5+p*m;n.beginPath(),n.moveTo(a-h,g),n.bezierCurveTo(a-h*.4,g-r*.4,a+h*.4,g+r*.2,a+h,g-r*.45),n.stroke()}n.restore()}function gh(n,a,s){return n<a?a:n>s?s:n}const Nf=Object.freeze([{id:"skirmish",label:"Skirmish Patrols",minRunSeconds:0,minClears:0,cadence:26,multiplier:1,bundleTier:0},{id:"raids",label:"Raid Pressure",minRunSeconds:90,minClears:2,cadence:19,multiplier:1.35,bundleTier:1},{id:"siege",label:"Siege Lines",minRunSeconds:210,minClears:5,cadence:13,multiplier:1.8,bundleTier:2},{id:"onslaught",label:"Winter Onslaught",minRunSeconds:360,minClears:9,cadence:8.5,multiplier:2.45,bundleTier:3},{id:"maelstrom",label:"Glacier Maelstrom",minRunSeconds:540,minClears:14,cadence:6.2,multiplier:3.25,bundleTier:4}]);function a3(n){return n>=1?1/(1+(n-1)*.45):1+(1-n)*.35}function i3(n){if(n>=1)return 1+(n-1)*.85;const a=1-n;return gh(1-a*.4,.45,1)}function s3(n){return{runSeconds:Math.max(0,Number.isFinite(n.runSeconds)?n.runSeconds:0),clears:Math.max(0,Number.isFinite(n.clears)?n.clears:0),spawnCycles:Math.max(0,Number.isFinite(n.spawnCycles)?n.spawnCycles:0)}}function My(n,a){const s=s3(a);let r=0;for(let p=0;p<Nf.length;p+=1){const g=Nf[p];if(s.runSeconds<g.minRunSeconds||s.clears<g.minClears)break;r=p}const o=Nf[r],u=a3(n),f=i3(n),h=Math.max(.75,o.cadence*u),m=o.multiplier*f;return{stage:o,stageIndex:r,cadenceTarget:h,multiplierBase:m}}function xy(n){if(n>=1){const s=Math.min(3,n-1);return gh(.93-s*.035,.82,.93)}const a=Math.min(1,1-n);return gh(.93+a*.03,.9,.97)}function wy(n){if(n>=1)return .024+Math.min(3,n-1)*.012;const a=Math.min(1,1-n);return Math.max(.012,.024-a*.01)}const ub="deepwood",db="Deepwood Wardens",fb="Reclusive guardians attuned to sauna spirits.",hb=[{id:"warding-circle",label:"Warding Circle",weight:2,units:[{unit:"soldier",level:1,quantity:2},{unit:"archer",level:1,quantity:1}],items:["spirit-oak-charm","sauna-incense"],modifiers:["barkskin-ritual"]},{id:"spirit-strike",label:"Spirit Strike",weight:1,units:[{unit:"archer",level:2,quantity:2}],items:["emberglass-arrow"],modifiers:["searing-chant","windstep"]}],r3={id:ub,name:db,description:fb,bundles:hb},l3=Object.freeze(Object.defineProperty({__proto__:null,bundles:hb,default:r3,description:fb,id:ub,name:db},Symbol.toStringTag,{value:"Module"})),mb="enemy",pb="Avanto Marauders",gb="Frostbitten raiders who harry the sauna frontier.",yb=[{id:"iceblade-scouts",label:"Iceblade Scouts",weight:3,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:1}],items:["cracked-ice-amulet"],modifiers:["frost-resilience"]},{id:"raiding-party",label:"Raiding Party",weight:2,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:2}],items:["stolen-sauna-tokens"],modifiers:["berserker-drift"]},{id:"frost-champion",label:"Frost Champion",weight:1,minRampTier:0,units:[{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand"],modifiers:["glacial-ward"]},{id:"icebreaker-vanguard",label:"Icebreaker Vanguard",weight:2.5,minRampTier:1,units:[{unit:"avanto-marauder",level:2,quantity:2},{unit:"avanto-marauder",level:1,quantity:1}],items:["stormglass-pendant"],modifiers:["frost-resilience","berserker-drift"]},{id:"glacial-phalanx",label:"Glacial Phalanx",weight:2,minRampTier:2,units:[{unit:"avanto-marauder",level:3,quantity:3},{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand","frostshard-relic"],modifiers:["glacial-ward","polar-endurance"]},{id:"avalanche-warhost",label:"Avalanche Warhost",weight:1.25,minRampTier:3,units:[{unit:"avanto-marauder",level:4,quantity:3},{unit:"avanto-marauder",level:3,quantity:2}],items:["avalanche-totem"],modifiers:["glacial-ward","polar-endurance","berserker-drift"]}],o3={id:mb,name:pb,description:gb,bundles:yb},c3=Object.freeze(Object.defineProperty({__proto__:null,bundles:yb,default:o3,description:gb,id:mb,name:pb},Symbol.toStringTag,{value:"Module"})),u3=Object.assign({"../content/factions/deepwood.json":l3,"../content/factions/enemy.json":c3}),Hc=new Map;for(const[n,a]of Object.entries(u3)){const s=d3(a),r=p3(s,n);if(Hc.has(r.id))throw new Error(`Duplicate faction bundle id: ${r.id}`);Hc.set(r.id,r)}function d3(n){return typeof n=="object"&&n!==null&&"default"in n?n.default:n}function em(n){return typeof n=="object"&&n!==null}function yh(n,a){if(typeof n!="string")throw new Error(`Expected string at ${a}`);const s=n.trim();if(!s)throw new Error(`Expected non-empty string at ${a}`);return s}function bh(n){if(typeof n!="string")return;const a=n.trim();return a||void 0}function Ay(n,a){if(n===void 0)return Object.freeze([]);if(!Array.isArray(n))throw new Error(`Expected array at ${a}`);const s=n.map((r,o)=>{if(typeof r!="string")throw new Error(`Expected string at ${a}[${o}]`);const u=r.trim();if(!u)throw new Error(`Expected non-empty string at ${a}[${o}]`);return u});return Object.freeze(s)}function bb(n,a){const s=typeof n=="number"?n:Number(n);return!Number.isFinite(s)||s<=0?a:s}function Cy(n,a){const s=Math.floor(bb(n,a));return s>0?s:a}function f3(n,a){if(!em(n))throw new Error(`Expected object at ${a}`);const s=yh(n.unit,`${a}.unit`),r=Cy(n.level,1),o=Cy(n.quantity,1);return Object.freeze({unit:s,level:r,quantity:o})}function h3(n){if(n===void 0)return;const a=Number(n);if(!Number.isFinite(a))return;const s=Math.floor(a);return s>=0?s:void 0}function m3(n,a,s){if(!em(n))throw new Error(`Expected object at ${a}`);const r=bh(n.id)??`${s}-bundle`,o=bh(n.label)??r,u=bb(n.weight,1),f=n.units;if(!Array.isArray(f)||f.length===0)throw new Error(`Expected non-empty units array at ${a}.units`);const h=f.map((b,v)=>f3(b,`${a}.units[${v}]`)),m=Ay(n.items,`${a}.items`),p=Ay(n.modifiers,`${a}.modifiers`),g=h3(n.minRampTier);return Object.freeze({id:r,label:o,weight:u,units:Object.freeze(h),items:m,modifiers:p,minRampTier:g})}function p3(n,a){if(!em(n))throw new Error(`Expected object at ${a}`);const s=yh(n.id,`${a}.id`),r=yh(n.name,`${a}.name`),o=bh(n.description);if(!Array.isArray(n.bundles)||n.bundles.length===0)throw new Error(`Expected non-empty bundles array at ${a}.bundles`);const u=n.bundles.map((f,h)=>m3(f,`${a}.bundles[${h}]`,`${s}-${h}`));return Object.freeze({id:s,name:r,description:o,bundles:Object.freeze(u)})}Object.freeze(Array.from(Hc.keys()));function g3(n){return Hc.get(n)??null}function y3(n){return g3(n)?.bundles??Object.freeze([])}function b3(){return`e${Date.now()}-${Math.floor(Math.random()*1e6)}`}function v3(n){return{level:n}}function S3(n,a,s){const r=y3(n);if(r.length===0)throw new Error(`No bundles registered for faction: ${n}`);const o=Math.max(0,Math.floor(Number.isFinite(a)?a:0)),u=r.filter(b=>(typeof b.minRampTier=="number"?b.minRampTier:0)<=o),f=u.length>0?u:r,h=typeof s=="function"?s:Math.random,m=f.reduce((b,v)=>b+v.weight,0);if(!Number.isFinite(m)||m<=0)throw new Error(`Invalid bundle weights for faction: ${n}`);const p=h()*m;let g=0;for(const b of f)if(g+=b.weight,p<g)return b;return f[f.length-1]}function E3(n){let a=Math.max(0,Math.floor(n.availableSlots));const s=[];if(a<=0)return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers};const r=n.makeId??b3,o=typeof n.random=="function"?n.random:Math.random,u=Math.max(0,Math.min(.95,typeof n.eliteOdds=="number"?n.eliteOdds:0)),f=Math.max(1,Number.isFinite(n.difficultyMultiplier)?n.difficultyMultiplier:1),h=Math.max(0,Math.floor(Number.isFinite(n.rampTier)?n.rampTier:0)),m=1+h*.25,p=Math.floor(h/2);for(const g of n.bundle.units){const b=Math.max(1,Math.round(g.quantity*f*m)),v=Math.min(b,a),E=g.unit,M=Math.max(1,Math.round((g.level+p)*f));for(let C=0;C<v;C+=1){const R=o()<u?1:0,N=Math.max(1,M+R),q=v3(N),j=n.pickEdge();if(!j)return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers};const F=ib(E,r(),j,n.factionId,q);if(F&&(n.addUnit(F),s.push(F),a-=1,a<=0))return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers}}}return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers}}function uc(n,a,s,r=1){const o=Number(n);return Number.isFinite(o)?Math.max(a,Math.min(s,o)):r}const Ty=6;class M3{timer;interval;spawnCycles;factionId;random;makeId;difficulty;eliteOdds;cadenceDecay;multiplierGrowth;runSeconds=0;clearCount=0;boardEmpty=!0;lastClearAt=null;lastSpawnAt=null;lastCadence;lastMultiplier;rampEvaluation;rampStageIndex;currentDifficulty;cadenceScale=1;multiplierScale=1;pressureScale=1;calmUntil=null;calmSecondsRemaining=0;cadenceFloor=.3;constructor(a={}){this.factionId=a.factionId??"enemy",this.random=typeof a.random=="function"?a.random:Math.random;const s=Number.isFinite(a.difficulty)?Number(a.difficulty):1;this.difficulty=Math.max(.5,s);const r=typeof a.eliteOdds=="number"?a.eliteOdds:0;this.eliteOdds=Math.max(0,Math.min(.95,r)),this.currentDifficulty=this.difficulty,this.cadenceDecay=xy(this.currentDifficulty),this.multiplierGrowth=wy(this.currentDifficulty),this.spawnCycles=0,this.rampEvaluation=My(this.currentDifficulty,{runSeconds:0,clears:0,spawnCycles:0}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.interval=this.rampEvaluation.cadenceTarget,this.timer=this.interval,this.lastCadence=this.interval,this.lastMultiplier=this.rampEvaluation.multiplierBase;const o=(()=>{let u=0;return()=>`e${Date.now()}-${u+=1}`})();this.makeId=typeof a.idFactory=="function"?a.idFactory:o}update(a,s,r,o,u={}){if(!Number.isFinite(a)||a<=0)return;this.runSeconds+=a,this.applyRuntimeModifiers(u),this.resolveRampState();const f=this.countActiveEnemies(s);if(this.trackClears(f),this.calmUntil!==null&&this.runSeconds<this.calmUntil){const m=this.calmUntil-this.runSeconds;this.calmSecondsRemaining=m,this.timer=Math.max(this.timer,m);return}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0),this.timer-=a;let h=0;for(;this.timer<=0&&h<Ty;){const m=this.getAvailableSlots(s);if(m<=0){this.timer=Math.max(this.timer,.5);break}const p=this.resolveRampState(),g=S3(this.factionId,p.stage.bundleTier,this.random),b=this.computeMultiplier(p);if(E3({bundle:g,factionId:this.factionId,pickEdge:o,addUnit:r,makeId:this.makeId,availableSlots:m,eliteOdds:this.eliteOdds,random:this.random,difficultyMultiplier:b,rampTier:p.stage.bundleTier}).spawned.length===0){this.timer=Math.max(this.timer,.5);break}const E=this.runSeconds+this.timer;this.lastCadence=this.lastSpawnAt===null?this.interval:Math.max(.01,E-this.lastSpawnAt),this.lastSpawnAt=E,this.lastMultiplier=b,this.spawnCycles+=1,h+=1;const M=this.resolveRampState();this.interval=this.computeNextInterval(M),this.timer+=this.interval}h===Ty&&this.timer<=0&&(this.timer=this.interval)}getSnapshot(){const a=this.rampEvaluation.stage;return{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles,rampStageIndex:this.rampStageIndex,rampStageId:a.id,rampStageLabel:a.label,bundleTier:a.bundleTier,cadence:this.interval,lastCadence:this.lastCadence,lastSpawnAt:this.lastSpawnAt,lastClearAt:this.lastClearAt,difficultyMultiplier:this.lastMultiplier,effectiveDifficulty:this.currentDifficulty,aggressionMultiplier:this.currentDifficulty/this.difficulty,cadenceMultiplier:this.cadenceScale,strengthMultiplier:this.multiplierScale,pressureMultiplier:this.pressureScale,calmSecondsRemaining:this.calmSecondsRemaining}}resolveRampState(){return this.rampEvaluation=My(this.currentDifficulty,{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.rampEvaluation}applyRuntimeModifiers(a){const s=uc(a.aggressionMultiplier,.25,6,1),r=uc(a.cadenceMultiplier,.1,10,1),o=uc(a.strengthMultiplier,.1,12,1),u=uc(a.pressureMultiplier,.1,10,1),f=Number.isFinite(a.cadenceFloor)?Math.max(.1,a.cadenceFloor):this.cadenceFloor,h=Math.max(.25,this.difficulty*s);if(h!==this.currentDifficulty&&(this.currentDifficulty=h,this.cadenceDecay=xy(this.currentDifficulty),this.multiplierGrowth=wy(this.currentDifficulty),this.resolveRampState()),this.cadenceScale=r,this.multiplierScale=o,this.pressureScale=u,this.cadenceFloor=f,Object.prototype.hasOwnProperty.call(a,"calmSecondsRemaining")){const m=a.calmSecondsRemaining;m===null?this.calmUntil=null:typeof m=="number"&&Number.isFinite(m)&&m>0?this.calmUntil=this.runSeconds+m:typeof m=="number"&&m<=0&&(this.calmUntil=null)}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0)}computeNextInterval(a){const s=a.cadenceTarget*this.cadenceScale,r=Math.pow(this.spawnCycles+1,.6)*.018*this.pressureScale,o=1+Math.min(4,r),u=s/o,f=this.interval*this.cadenceDecay,h=Math.min(f,u);return Math.max(this.cadenceFloor,h)}computeMultiplier(a){const s=1+this.spawnCycles*this.multiplierGrowth*this.pressureScale,r=1+a.stageIndex*.15,o=a.multiplierBase*s*r*this.multiplierScale;return Math.min(16,Math.max(1,o))}countActiveEnemies(a){return a.filter(s=>s.faction===this.factionId&&!s.isDead()).length}getAvailableSlots(a){return kM-this.countActiveEnemies(a)}trackClears(a){if(a<=0){this.boardEmpty||(this.clearCount+=1,this.lastClearAt=this.runSeconds),this.boardEmpty=!0;return}this.boardEmpty=!1}}function x3(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(n){return console.warn("Structured telemetry storage unavailable",n),null}}function w3(n,a){const s={event:n,timestamp:Date.now(),payload:{...a}};return console.info(n,s),s}function A3(n,a,s={}){const r=x3();if(!r)return;const o=Number.isFinite(s.limit)?Math.max(1,Math.trunc(s.limit??16)):16,f=[...Oh(n)??[],a].slice(-o);try{r.setItem(n,JSON.stringify(f))}catch(h){console.warn("Failed to persist structured telemetry",{storageKey:n,error:h})}}let _y=-1,Ry=-1,kf=null,Df=0,Lf=0;const C3="telemetry:enemy-scaling:summaries";function T3(n,a={}){const s=n.rampStageIndex!==_y,r=n.spawnCycles>=Ry+10,o=n.lastClearAt!==null&&n.lastClearAt!==kf;if(!s&&!r&&!o)return;_y=n.rampStageIndex,Ry=n.spawnCycles,kf=n.lastClearAt??kf,Df=Math.max(Df,n.difficultyMultiplier);const u=Math.max(0,Math.round(n.calmSecondsRemaining*1e3));u>Lf&&(Lf=u);const f={stage:n.rampStageLabel,stageIndex:n.rampStageIndex,bundleTier:n.bundleTier,cadenceSeconds:Number(n.cadence.toFixed(2)),lastCadenceSeconds:Number(n.lastCadence.toFixed(2)),multiplier:Number(n.difficultyMultiplier.toFixed(2)),effectiveDifficulty:Number(n.effectiveDifficulty.toFixed(2)),aggressionMultiplier:Number(n.aggressionMultiplier.toFixed(2)),cadenceMultiplier:Number(n.cadenceMultiplier.toFixed(2)),strengthMultiplier:Number(n.strengthMultiplier.toFixed(2)),pressureMultiplier:Number(n.pressureMultiplier.toFixed(2)),calmSecondsRemaining:Number(n.calmSecondsRemaining.toFixed(2)),runSeconds:Math.round(n.runSeconds),spawnCycles:n.spawnCycles,clears:n.clears,wipeSince:a.wipeSince??null,longestWipeMs:a.wipeDurationMs??0,peakMultiplier:Number(Df.toFixed(2)),longestCalmMs:Lf},h=w3("enemy-scaling",f);A3(C3,h,{limit:24})}const _3=Object.freeze({ngPlusLevel:0,unlockSlots:0}),R3={default:"Included with the sauna key",ngPlusLevel:"Reach NG+ level",unlockSlots:"Earn roster unlocks"},tm=Object.freeze([{id:"ember-circuit",name:"Ember Circuit",rosterCap:3,description:"Classic cedar benches with a loyal trio of attendants.",art:{badge:j2,glow:"linear-gradient(145deg, rgba(255,161,76,0.65), rgba(255,226,173,0.18))"},unlock:{type:"default",label:"Available from the first steam session"}},{id:"aurora-ward",name:"Aurora Ward",rosterCap:4,description:"Glacial glass benches and a quartet ready to repel sieges.",art:{badge:B2,glow:"linear-gradient(140deg, rgba(128,208,255,0.7), rgba(61,184,255,0.2))"},unlock:{type:"unlockSlots",slots:2,label:"Secure 2 roster unlocks"}},{id:"mythic-conclave",name:"Mythic Conclave",rosterCap:6,description:"Runic obsidian tiers where six legends guard the löyly.",art:{badge:H2,glow:"linear-gradient(135deg, rgba(176,106,255,0.72), rgba(245,199,255,0.2))"},unlock:{type:"ngPlusLevel",level:3,label:"Prestige to NG+ level 3"}}]),Ul=tm[0].id,Uf=new Map(tm.map(n=>[n.id,n]));function vb(){return tm}function Oa(n){return n&&Uf.has(n)?Uf.get(n):Uf.get(Ul)}function Ny(n,a,s){if(!Number.isFinite(n))return a;const r=Math.max(a,Math.min(s,n));return Number.isNaN(r)?a:r}function dc(n){if(n.label)return n.label;const a=R3[n.type];if(!a)return"";switch(n.type){case"ngPlusLevel":return`${a} ${n.level}`;case"unlockSlots":return`${a} ${n.slots}`;default:return a}}function tr(n,a){const s=a??_3;if(n.unlock.type==="default")return{tier:n,unlocked:!0,progress:1,requirementLabel:dc(n.unlock)};if(n.unlock.type==="ngPlusLevel"){const r=Ny(s.ngPlusLevel/n.unlock.level,0,1);return{tier:n,unlocked:s.ngPlusLevel>=n.unlock.level,progress:r,requirementLabel:dc(n.unlock)}}if(n.unlock.type==="unlockSlots"){const r=Ny(s.unlockSlots/n.unlock.slots,0,1);return{tier:n,unlocked:s.unlockSlots>=n.unlock.slots,progress:r,requirementLabel:dc(n.unlock)}}return{tier:n,unlocked:!1,progress:0,requirementLabel:dc(n.unlock)}}const ky=["hud-grid","grid","grid-rows-[64px_1fr_80px]","grid-cols-[280px_1fr_clamp(260px,32vw,420px)]","gap-[clamp(16px,3vw,28px)]"],Dy={top:["col-span-3","row-span-1","row-start-1"],left:["col-start-1","row-start-2","row-span-1"],content:["col-start-2","row-start-2","row-span-1"],right:["col-start-3","row-start-2","row-span-1"],bottom:["col-span-3","row-start-3","row-span-1"]};function N3(n,a){let s=n.querySelector("[data-hud-root]");return s||(s=a.createElement("div"),s.dataset.hudRoot="true",s.className="hud-layout-root",n.prepend(s)),s}function al(n,a,s,r){let o=n.querySelector(`[data-hud-region="${s}"]`);return o||(o=a.createElement("div"),o.dataset.hudRegion=s,n.appendChild(o)),o.classList.add("hud-region",...r),o.parentElement!==n&&n.appendChild(o),o}function k3(n,a,s){if(s){n.classList.add(...ky);for(const[r,o]of Object.entries(Dy))a[r].classList.add(...o)}else{n.classList.remove(...ky);for(const[r,o]of Object.entries(Dy))a[r].classList.remove(...o)}}function ar(n){const a=n.ownerDocument??document,s=N3(n,a),r={top:al(s,a,"top",["hud-top-row"]),left:al(s,a,"left",["hud-actions"]),content:al(s,a,"content",["hud-content"]),right:al(s,a,"right",["hud-right-column"]),bottom:al(s,a,"bottom",["hud-bottom-row"])};s.append(r.top,r.left,r.content,r.right,r.bottom);const o=n.dataset.hudVariant==="v2";if(k3(n,r,o),!o){const p=n.querySelector("#resource-bar");p&&p.parentElement!==r.right&&r.right.prepend(p)}const u=n.querySelector("#build-menu");u&&u.parentElement!==r.left&&r.left.appendChild(u);const f=n.querySelector("#build-id");f&&f.parentElement!==r.bottom&&r.bottom.appendChild(f);let h=n.querySelector(".hud-mobile-bar__tray"),m=h?.closest(".hud-mobile-bar")??null;return(!h||!m)&&(m=a.createElement("div"),m.className="hud-mobile-bar",h=a.createElement("div"),h.className="hud-mobile-bar__tray",m.appendChild(h)),m.parentElement!==r.bottom&&r.bottom.appendChild(m),{root:s,regions:r,actions:r.left,side:r.right,mobileBar:h}}const Ly=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function D3(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const r=document.createElement("div");r.classList.add("sauna-control"),r.dataset.tutorialTarget="heat";const o=()=>{const ce=a.getActiveTierId?.();return Oa(ce??Ul).id},u=()=>a.getTierContext?.()??null,f=document.createElement("button");f.type="button",f.textContent="Sauna ♨️",f.classList.add("topbar-button","sauna-toggle"),f.setAttribute("aria-expanded","false"),r.appendChild(f);const h=document.createElement("div");h.classList.add("sauna-card","hud-card"),h.hidden=!0;const m=document.createElement("section");m.classList.add("sauna-health");const p=`sauna-health-label-${Math.floor(Math.random()*1e5)}`,g=document.createElement("div");g.classList.add("sauna-health__header");const b=document.createElement("span");b.id=p,b.classList.add("sauna-health__title"),b.textContent="Sauna Integrity",g.appendChild(b);const v=document.createElement("span");v.classList.add("sauna-health__value"),v.setAttribute("aria-live","polite"),g.appendChild(v),m.appendChild(g);const E=document.createElement("div");E.classList.add("sauna-health__bar"),E.setAttribute("role","meter"),E.setAttribute("aria-valuemin","0"),E.setAttribute("aria-labelledby",p);const M=document.createElement("div");M.classList.add("sauna-health__fill"),E.appendChild(M),m.appendChild(E);const C=document.createElement("div");C.classList.add("sauna-health__destruction"),C.hidden=!0,E.appendChild(C);const R=document.createElement("div");R.classList.add("sauna-progress");const N=document.createElement("div");N.classList.add("sauna-progress__fill"),R.appendChild(N),h.appendChild(m),h.appendChild(R);const q=vb(),j=new Map,F=document.createElement("section");F.classList.add("sauna-tier");const Q=document.createElement("div");Q.classList.add("sauna-tier__header");const se=document.createElement("span");se.classList.add("sauna-tier__title"),se.textContent="Premium Tiers",Q.appendChild(se);const ee=document.createElement("p");ee.classList.add("sauna-tier__subtitle"),ee.textContent="Align the löyly with your prestige to unlock lavish benches and roster headroom.",Q.appendChild(ee),F.appendChild(Q);const le=document.createElement("div");le.classList.add("sauna-tier__grid"),F.appendChild(le);for(const ce of q){const _e=document.createElement("button");_e.type="button",_e.classList.add("sauna-tier__option"),_e.dataset.tierId=ce.id,_e.setAttribute("aria-pressed","false");const Ge=document.createElement("div");Ge.classList.add("sauna-tier__badge"),Ge.style.setProperty("--sauna-tier-badge-image",`url(${ce.art.badge})`),ce.art.glow&&Ge.style.setProperty("--sauna-tier-glow",ce.art.glow),_e.appendChild(Ge);const qe=document.createElement("div");qe.classList.add("sauna-tier__copy"),_e.appendChild(qe);const bt=document.createElement("span");bt.classList.add("sauna-tier__name"),bt.textContent=ce.name,qe.appendChild(bt);const dn=document.createElement("span");dn.classList.add("sauna-tier__cap"),dn.textContent=`Cap ${ce.rosterCap}`,qe.appendChild(dn);const Qt=document.createElement("p");Qt.classList.add("sauna-tier__description"),Qt.textContent=ce.description,qe.appendChild(Qt);const En=document.createElement("div");En.classList.add("sauna-tier__progress");const aa=document.createElement("div");aa.classList.add("sauna-tier__progress-fill"),En.appendChild(aa);const Xe=document.createElement("span");Xe.classList.add("sauna-tier__progress-label"),En.appendChild(Xe),qe.appendChild(En);const Qe=document.createElement("span");Qe.classList.add("sauna-tier__requirement"),qe.appendChild(Qe);const Gt={tier:ce,button:_e,fill:aa,progressLabel:Xe,requirement:Qe,handleClick:()=>{w(ce,Gt)}};_e.addEventListener("click",Gt.handleClick),j.set(ce.id,Gt),le.appendChild(_e)}h.appendChild(F),he();const P=document.createElement("label");P.classList.add("sauna-option");const I=document.createElement("input");I.type="checkbox",I.classList.add("sauna-option__input"),I.checked=n.rallyToFront,I.addEventListener("change",()=>{n.rallyToFront=I.checked}),P.appendChild(I);const T=document.createElement("span");T.textContent="Rally to Front",T.classList.add("sauna-option__label"),P.appendChild(T),h.appendChild(P),r.appendChild(h);const{regions:k}=ar(s),A=k.top,Y=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null;let B=!!Y?.matches;const D=(ce,_e)=>{typeof ce.addEventListener=="function"?ce.addEventListener("change",_e):typeof ce.addListener=="function"&&ce.addListener(_e)},V=(ce,_e)=>{typeof ce.removeEventListener=="function"?ce.removeEventListener("change",_e):typeof ce.removeListener=="function"&&ce.removeListener(_e)},te=ce=>{B=!!ce.matches,m.dataset.motion=B?"reduced":"full"};m.dataset.motion=B?"reduced":"full",Y&&D(Y,te);function he(){const ce=o(),_e=u();for(const Ge of j.values()){const qe=tr(Ge.tier,_e),bt=Math.round(Math.max(0,Math.min(qe.progress,1))*100);Ge.fill.style.width=`${bt}%`,Ge.progressLabel.textContent=qe.unlocked?"Unlocked":`${bt}% ready`,Ge.requirement.textContent=qe.unlocked?`Roster cap ${Ge.tier.rosterCap}`:qe.requirementLabel,Ge.button.dataset.state=qe.unlocked?Ge.tier.id===ce?"active":"available":"locked",Ge.button.setAttribute("aria-pressed",Ge.tier.id===ce?"true":"false"),Ge.button.setAttribute("aria-disabled",qe.unlocked?"false":"true")}}function w(ce,_e){if(!tr(ce,u()).unlocked){_e.button.classList.remove("sauna-tier__option--denied"),_e.button.offsetWidth,_e.button.classList.add("sauna-tier__option--denied");return}a.setActiveTierId?.(ce.id,{persist:!0}),he()}const $=()=>{r.parentElement!==A&&A.appendChild(r);const ce=A.querySelector("#topbar");return ce&&ce.parentElement===A?(ce.nextSibling!==r&&A.insertBefore(r,ce.nextSibling),!0):!1};let W=null;$()||(W=new MutationObserver(()=>{$()&&W?.disconnect()}),W.observe(A,{childList:!0}));const ae=()=>{const ce=!h.hidden;h.hidden=ce,f.setAttribute("aria-expanded",String(!ce))};f.addEventListener("click",ae);const oe=()=>{const ce=Math.max(1,Math.floor(n.maxHealth)),_e=Math.max(0,Math.min(ce,Math.floor(Number.isFinite(n.health)?n.health:0))),Ge=ce>0?_e/ce:0,qe=Math.max(0,Math.min(Ge,1));M.style.width=`${qe*100}%`;const bt=Ly.format(_e),dn=Ly.format(ce);v.textContent=`${bt} / ${dn}`,E.setAttribute("aria-valuenow",String(_e)),E.setAttribute("aria-valuemax",String(ce)),E.setAttribute("aria-valuetext",`${bt} of ${dn} health`);const Qt=n.destroyed?"offline":qe<=.2?"critical":qe<=.55?"warning":"stable";E.dataset.level=Qt,v.dataset.state=Qt,m.dataset.state=n.destroyed?"destroyed":"active"},ge=()=>{C.classList.remove("sauna-health__destruction--active"),C.hidden=!0};let de=null,Te=null;const xe=()=>{de!==null&&(window.clearTimeout(de),de=null),E.classList.remove("sauna-health__bar--impact")},xt=()=>{M.classList.remove("sauna-health__fill--damage")};M.addEventListener("animationend",xt);const on=()=>{ge()};C.addEventListener("animationend",on);const cn=()=>{xe(),E.classList.add("sauna-health__bar--impact"),B||(M.classList.remove("sauna-health__fill--damage"),M.offsetWidth,M.classList.add("sauna-health__fill--damage")),de=window.setTimeout(()=>{E.classList.remove("sauna-health__bar--impact"),de=null},B?360:560)},Un=()=>{Te!==null&&(window.clearTimeout(Te),Te=null),C.hidden=!1,C.classList.remove("sauna-health__destruction--active"),C.offsetWidth,C.classList.add("sauna-health__destruction--active"),Te=window.setTimeout(()=>{ge(),Te=null},B?720:1100)},On=()=>{oe();const ce=n.playerSpawnCooldown>0?n.playerSpawnCooldown:1,_e=1-n.playerSpawnTimer/ce;N.style.width=`${Math.max(0,Math.min(_e,1))*100}%`,I.checked=n.rallyToFront,he()};return oe(),{update:On,handleDamage:ce=>{oe(),cn()},handleDestroyed:ce=>{h.hidden=!1,f.setAttribute("aria-expanded","true"),oe(),cn(),Un()},dispose:()=>{W?.disconnect(),W=null,f.removeEventListener("click",ae),Y&&V(Y,te),M.removeEventListener("animationend",xt),C.removeEventListener("animationend",on),xe(),Te!==null&&(window.clearTimeout(Te),Te=null),ge();for(const ce of j.values())ce.button.removeEventListener("click",ce.handleClick);j.clear(),r.remove()}}}function il(n,a={}){const{iconSrc:s,description:r,srLabel:o}=a,u=document.createElement("div");if(u.classList.add("topbar-badge"),u.setAttribute("role","status"),u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),s){const b=document.createElement("img");b.src=s,b.alt=n,b.decoding="async",b.classList.add("topbar-badge-icon"),u.appendChild(b)}const f=document.createElement("div");f.classList.add("badge-text");const h=document.createElement("span");h.textContent=n,h.classList.add("badge-label"),f.appendChild(h);const m=document.createElement("span");m.textContent="0",m.classList.add("badge-value"),m.setAttribute("aria-hidden","true"),f.appendChild(m);const p=document.createElement("span");p.classList.add("badge-delta"),p.style.opacity="0",p.style.transform="translateY(-6px)",p.style.transition="opacity 0.5s ease, transform 0.5s ease",p.setAttribute("aria-hidden","true"),u.append(f,p),r&&(u.title=r);const g=o??n;return u.dataset.label=g,u.setAttribute("aria-label",`${g}: 0`),{container:u,value:m,delta:p,label:g}}function L3(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const{regions:r}=ar(s),o=r.top,u=document.createElement("div");u.id="topbar",o.prepend(u);const f=document.createElement("div");f.className="topbar-badge-row",u.appendChild(f);const h={[ie.SAUNA_BEER]:"Sauna beer bottles chilled for construction crews and eager recruits.",[ie.SAUNAKUNNIA]:"Saunakunnia—prestige earned from sauna rituals and triumphant battles.",[ie.SISU]:"Sisu—the relentless grit forged when your warriors triumph on the snow."},m=il("Sauna Beer",{iconSrc:a.saunaBeer,description:h[ie.SAUNA_BEER],srLabel:"Sauna beer reserves"});m.container.classList.add("badge-sauna-beer");const p=il("Sisu",{iconSrc:a.sisu,description:h[ie.SISU],srLabel:"Sisu reserves"});p.container.classList.add("badge-sisu"),p.container.dataset.tutorialTarget="sisu";const g=il("Saunakunnia",{iconSrc:a.saunakunnia,description:h[ie.SAUNAKUNNIA],srLabel:"Saunakunnia"});g.container.classList.add("badge-sauna"),g.container.dataset.tutorialTarget="victory";const b=il("Time");b.container.classList.add("badge-time"),b.delta.style.display="none";const v=il("Enemy Ramp",{srLabel:"Enemy ramp intensity"});v.container.classList.add("badge-ramp"),v.delta.style.display="none",v.container.dataset.tutorialTarget="enemy-ramp",v.container.title="Enemy ramp intensity and cadence.",f.appendChild(m.container),f.appendChild(p.container),f.appendChild(g.container),f.appendChild(v.container),f.appendChild(b.container);const E=new Intl.NumberFormat("en-US"),M=new Intl.NumberFormat("en-US",{signDisplay:"exceptZero"}),C={[ie.SAUNA_BEER]:"Sauna Beer",[ie.SAUNAKUNNIA]:"Saunakunnia",[ie.SISU]:"Sisu"},R={[ie.SAUNA_BEER]:{singular:"bottle",plural:"bottles"},[ie.SAUNAKUNNIA]:{singular:"Saunakunnia",plural:"Saunakunnia"},[ie.SISU]:{singular:"Sisu",plural:"Sisu"}},N={[ie.SAUNA_BEER]:"🍺",[ie.SAUNAKUNNIA]:"⚜️",[ie.SISU]:"🔥"},q={[ie.SAUNA_BEER]:m,[ie.SAUNAKUNNIA]:g,[ie.SISU]:p},j={};let F=null;function Q(A){if(F=A,!A){v.value.textContent="Stage 1 · ×1.00",v.delta.textContent="",v.delta.style.display="none",v.container.dataset.state="idle",v.container.title="Enemy ramp idle",v.container.setAttribute("aria-label","Enemy ramp idle.");return}const Y=A.stage||`Stage ${A.stageIndex+1}`,B=`×${A.multiplier.toFixed(2)}`,D=`${A.cadenceSeconds.toFixed(2)}s cadence`,V=`×${A.effectiveDifficulty.toFixed(2)}`,te=A.calmSecondsRemaining>.05,he=te?`Calm remaining: ${Math.ceil(A.calmSecondsRemaining)}s`:"Calm inactive";v.value.textContent=`${Y} · ${B}`,v.delta.style.display=te?"":"none",v.delta.textContent=te?`Calm ${Math.ceil(A.calmSecondsRemaining)}s`:"",v.container.dataset.state=te?"calm":"active",v.container.title=[`Stage: ${Y} (Tier ${A.bundleTier})`,`Cadence: ${D}`,`Multiplier: ${B}`,`Difficulty: ${V}`,`Aggression ×${A.aggressionMultiplier.toFixed(2)} · Cadence ×${A.cadenceMultiplier.toFixed(2)} · Strength ×${A.strengthMultiplier.toFixed(2)}`,he,`Spawn cycles: ${A.spawnCycles}`].join(`
`),v.container.setAttribute("aria-label",[`Enemy ramp ${Y}`,`Multiplier ${B}`,`Cadence ${A.cadenceSeconds.toFixed(2)} seconds`,`Difficulty ${V}`,te?`Calm remaining ${Math.ceil(A.calmSecondsRemaining)} seconds`:"Calm inactive"].join(" — "))}function se(A,Y){const B=Number.isFinite(Y)?Y:0;return A===ie.SAUNA_BEER?Math.trunc(B):Math.max(0,Math.round(B))}function ee(A,Y){return E.format(se(A,Y))}function le(A,Y){return Y===0?"":`${M.format(Y)} ${N[A]}`}function P(A,Y){if(Y===0)return"";const B=Y>0?"gained":"spent",D=E.format(Math.abs(Y)),V=R[A];if(V){const he=Math.abs(Y)===1?V.singular:V.plural,w=C[A],$=[w];he&&he!==w&&$.push(he);const W=$.filter(Boolean).join(" ");return`${B} ${D}${W?` ${W}`:""}`}const te=C[A];return`${B} ${D}${te?` ${te}`:""}`}function I(A,Y,B=0){const D=q[A];if(!D)return;const V=se(A,Y),te=ee(A,Y);D.value.textContent=te;const he=A===ie.SAUNA_BEER&&V<0;if(D.container.classList.toggle("topbar-badge--debt",he),B!==0){D.delta.textContent=le(A,B),D.delta.style.opacity="1",D.delta.style.transform="translateY(0)";const W=j[A];W&&clearTimeout(W),j[A]=setTimeout(()=>{D.delta.style.opacity="0",D.delta.style.transform="translateY(-6px)",delete j[A]},1e3)}else D.delta.textContent="",D.delta.style.opacity="0",D.delta.style.transform="translateY(-6px)";const w=P(A,B),$=[`${D.label} ${te}`];if(he){const W=E.format(Math.abs(V)),ae=R[A];if(ae){const oe=Math.abs(V)===1?ae.singular:ae.plural,ge=oe&&oe!==C[A];$.push(ge?`Debt of ${W} ${oe}`:`Debt of ${W}`)}else $.push(`Debt of ${W}`)}w&&$.push(w),D.container.setAttribute("aria-label",$.join(" — "))}I(ie.SAUNA_BEER,n.getResource(ie.SAUNA_BEER)),I(ie.SAUNAKUNNIA,n.getResource(ie.SAUNAKUNNIA)),I(ie.SISU,n.getResource(ie.SISU)),Q(F);const T=({resource:A,amount:Y,total:B})=>{q[A]&&I(A,B,Y)};ne.on("resourceChanged",T);let k=0;return{update(A){k+=A;const Y=Math.floor(k/1e3),B=Math.floor(Y/60),D=Y%60;b.value.textContent=`${B}:${D.toString().padStart(2,"0")}`},setEnemyRampSummary(A){Q(A)},dispose(){ne.off("resourceChanged",T),Object.values(j).forEach(A=>{A&&clearTimeout(A)}),u.remove()}}}var Of={exports:{}},sl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uy;function U3(){if(Uy)return sl;Uy=1;var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function s(r,o,u){var f=null;if(u!==void 0&&(f=""+u),o.key!==void 0&&(f=""+o.key),"key"in o){u={};for(var h in o)h!=="key"&&(u[h]=o[h])}else u=o;return o=u.ref,{$$typeof:n,type:r,key:f,ref:o!==void 0?o:null,props:u}}return sl.Fragment=a,sl.jsx=s,sl.jsxs=s,sl}var Oy;function O3(){return Oy||(Oy=1,Of.exports=U3()),Of.exports}var Xt=O3(),qf={exports:{}},rl={},zf={exports:{}},Bf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qy;function q3(){return qy||(qy=1,(function(n){function a(D,V){var te=D.length;D.push(V);e:for(;0<te;){var he=te-1>>>1,w=D[he];if(0<o(w,V))D[he]=V,D[te]=w,te=he;else break e}}function s(D){return D.length===0?null:D[0]}function r(D){if(D.length===0)return null;var V=D[0],te=D.pop();if(te!==V){D[0]=te;e:for(var he=0,w=D.length,$=w>>>1;he<$;){var W=2*(he+1)-1,ae=D[W],oe=W+1,ge=D[oe];if(0>o(ae,te))oe<w&&0>o(ge,ae)?(D[he]=ge,D[oe]=te,he=oe):(D[he]=ae,D[W]=te,he=W);else if(oe<w&&0>o(ge,te))D[he]=ge,D[oe]=te,he=oe;else break e}}return V}function o(D,V){var te=D.sortIndex-V.sortIndex;return te!==0?te:D.id-V.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,h=f.now();n.unstable_now=function(){return f.now()-h}}var m=[],p=[],g=1,b=null,v=3,E=!1,M=!1,C=!1,R=!1,N=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function F(D){for(var V=s(p);V!==null;){if(V.callback===null)r(p);else if(V.startTime<=D)r(p),V.sortIndex=V.expirationTime,a(m,V);else break;V=s(p)}}function Q(D){if(C=!1,F(D),!M)if(s(m)!==null)M=!0,se||(se=!0,k());else{var V=s(p);V!==null&&B(Q,V.startTime-D)}}var se=!1,ee=-1,le=5,P=-1;function I(){return R?!0:!(n.unstable_now()-P<le)}function T(){if(R=!1,se){var D=n.unstable_now();P=D;var V=!0;try{e:{M=!1,C&&(C=!1,q(ee),ee=-1),E=!0;var te=v;try{t:{for(F(D),b=s(m);b!==null&&!(b.expirationTime>D&&I());){var he=b.callback;if(typeof he=="function"){b.callback=null,v=b.priorityLevel;var w=he(b.expirationTime<=D);if(D=n.unstable_now(),typeof w=="function"){b.callback=w,F(D),V=!0;break t}b===s(m)&&r(m),F(D)}else r(m);b=s(m)}if(b!==null)V=!0;else{var $=s(p);$!==null&&B(Q,$.startTime-D),V=!1}}break e}finally{b=null,v=te,E=!1}V=void 0}}finally{V?k():se=!1}}}var k;if(typeof j=="function")k=function(){j(T)};else if(typeof MessageChannel<"u"){var A=new MessageChannel,Y=A.port2;A.port1.onmessage=T,k=function(){Y.postMessage(null)}}else k=function(){N(T,0)};function B(D,V){ee=N(function(){D(n.unstable_now())},V)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(D){D.callback=null},n.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):le=0<D?Math.floor(1e3/D):5},n.unstable_getCurrentPriorityLevel=function(){return v},n.unstable_next=function(D){switch(v){case 1:case 2:case 3:var V=3;break;default:V=v}var te=v;v=V;try{return D()}finally{v=te}},n.unstable_requestPaint=function(){R=!0},n.unstable_runWithPriority=function(D,V){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var te=v;v=D;try{return V()}finally{v=te}},n.unstable_scheduleCallback=function(D,V,te){var he=n.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?he+te:he):te=he,D){case 1:var w=-1;break;case 2:w=250;break;case 5:w=1073741823;break;case 4:w=1e4;break;default:w=5e3}return w=te+w,D={id:g++,callback:V,priorityLevel:D,startTime:te,expirationTime:w,sortIndex:-1},te>he?(D.sortIndex=te,a(p,D),s(m)===null&&D===s(p)&&(C?(q(ee),ee=-1):C=!0,B(Q,te-he))):(D.sortIndex=w,a(m,D),M||E||(M=!0,se||(se=!0,k()))),D},n.unstable_shouldYield=I,n.unstable_wrapCallback=function(D){var V=v;return function(){var te=v;v=V;try{return D.apply(this,arguments)}finally{v=te}}}})(Bf)),Bf}var zy;function z3(){return zy||(zy=1,zf.exports=q3()),zf.exports}var Hf={exports:{}},ve={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var By;function B3(){if(By)return ve;By=1;var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),b=Symbol.iterator;function v(w){return w===null||typeof w!="object"?null:(w=b&&w[b]||w["@@iterator"],typeof w=="function"?w:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,C={};function R(w,$,W){this.props=w,this.context=$,this.refs=C,this.updater=W||E}R.prototype.isReactComponent={},R.prototype.setState=function(w,$){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,$,"setState")},R.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function N(){}N.prototype=R.prototype;function q(w,$,W){this.props=w,this.context=$,this.refs=C,this.updater=W||E}var j=q.prototype=new N;j.constructor=q,M(j,R.prototype),j.isPureReactComponent=!0;var F=Array.isArray,Q={H:null,A:null,T:null,S:null,V:null},se=Object.prototype.hasOwnProperty;function ee(w,$,W,ae,oe,ge){return W=ge.ref,{$$typeof:n,type:w,key:$,ref:W!==void 0?W:null,props:ge}}function le(w,$){return ee(w.type,$,void 0,void 0,void 0,w.props)}function P(w){return typeof w=="object"&&w!==null&&w.$$typeof===n}function I(w){var $={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(W){return $[W]})}var T=/\/+/g;function k(w,$){return typeof w=="object"&&w!==null&&w.key!=null?I(""+w.key):$.toString(36)}function A(){}function Y(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(A,A):(w.status="pending",w.then(function($){w.status==="pending"&&(w.status="fulfilled",w.value=$)},function($){w.status==="pending"&&(w.status="rejected",w.reason=$)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function B(w,$,W,ae,oe){var ge=typeof w;(ge==="undefined"||ge==="boolean")&&(w=null);var de=!1;if(w===null)de=!0;else switch(ge){case"bigint":case"string":case"number":de=!0;break;case"object":switch(w.$$typeof){case n:case a:de=!0;break;case g:return de=w._init,B(de(w._payload),$,W,ae,oe)}}if(de)return oe=oe(w),de=ae===""?"."+k(w,0):ae,F(oe)?(W="",de!=null&&(W=de.replace(T,"$&/")+"/"),B(oe,$,W,"",function(xt){return xt})):oe!=null&&(P(oe)&&(oe=le(oe,W+(oe.key==null||w&&w.key===oe.key?"":(""+oe.key).replace(T,"$&/")+"/")+de)),$.push(oe)),1;de=0;var Te=ae===""?".":ae+":";if(F(w))for(var xe=0;xe<w.length;xe++)ae=w[xe],ge=Te+k(ae,xe),de+=B(ae,$,W,ge,oe);else if(xe=v(w),typeof xe=="function")for(w=xe.call(w),xe=0;!(ae=w.next()).done;)ae=ae.value,ge=Te+k(ae,xe++),de+=B(ae,$,W,ge,oe);else if(ge==="object"){if(typeof w.then=="function")return B(Y(w),$,W,ae,oe);throw $=String(w),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return de}function D(w,$,W){if(w==null)return w;var ae=[],oe=0;return B(w,ae,"","",function(ge){return $.call(W,ge,oe++)}),ae}function V(w){if(w._status===-1){var $=w._result;$=$(),$.then(function(W){(w._status===0||w._status===-1)&&(w._status=1,w._result=W)},function(W){(w._status===0||w._status===-1)&&(w._status=2,w._result=W)}),w._status===-1&&(w._status=0,w._result=$)}if(w._status===1)return w._result.default;throw w._result}var te=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)};function he(){}return ve.Children={map:D,forEach:function(w,$,W){D(w,function(){$.apply(this,arguments)},W)},count:function(w){var $=0;return D(w,function(){$++}),$},toArray:function(w){return D(w,function($){return $})||[]},only:function(w){if(!P(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},ve.Component=R,ve.Fragment=s,ve.Profiler=o,ve.PureComponent=q,ve.StrictMode=r,ve.Suspense=m,ve.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Q,ve.__COMPILER_RUNTIME={__proto__:null,c:function(w){return Q.H.useMemoCache(w)}},ve.cache=function(w){return function(){return w.apply(null,arguments)}},ve.cloneElement=function(w,$,W){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var ae=M({},w.props),oe=w.key,ge=void 0;if($!=null)for(de in $.ref!==void 0&&(ge=void 0),$.key!==void 0&&(oe=""+$.key),$)!se.call($,de)||de==="key"||de==="__self"||de==="__source"||de==="ref"&&$.ref===void 0||(ae[de]=$[de]);var de=arguments.length-2;if(de===1)ae.children=W;else if(1<de){for(var Te=Array(de),xe=0;xe<de;xe++)Te[xe]=arguments[xe+2];ae.children=Te}return ee(w.type,oe,void 0,void 0,ge,ae)},ve.createContext=function(w){return w={$$typeof:f,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:u,_context:w},w},ve.createElement=function(w,$,W){var ae,oe={},ge=null;if($!=null)for(ae in $.key!==void 0&&(ge=""+$.key),$)se.call($,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(oe[ae]=$[ae]);var de=arguments.length-2;if(de===1)oe.children=W;else if(1<de){for(var Te=Array(de),xe=0;xe<de;xe++)Te[xe]=arguments[xe+2];oe.children=Te}if(w&&w.defaultProps)for(ae in de=w.defaultProps,de)oe[ae]===void 0&&(oe[ae]=de[ae]);return ee(w,ge,void 0,void 0,null,oe)},ve.createRef=function(){return{current:null}},ve.forwardRef=function(w){return{$$typeof:h,render:w}},ve.isValidElement=P,ve.lazy=function(w){return{$$typeof:g,_payload:{_status:-1,_result:w},_init:V}},ve.memo=function(w,$){return{$$typeof:p,type:w,compare:$===void 0?null:$}},ve.startTransition=function(w){var $=Q.T,W={};Q.T=W;try{var ae=w(),oe=Q.S;oe!==null&&oe(W,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(he,te)}catch(ge){te(ge)}finally{Q.T=$}},ve.unstable_useCacheRefresh=function(){return Q.H.useCacheRefresh()},ve.use=function(w){return Q.H.use(w)},ve.useActionState=function(w,$,W){return Q.H.useActionState(w,$,W)},ve.useCallback=function(w,$){return Q.H.useCallback(w,$)},ve.useContext=function(w){return Q.H.useContext(w)},ve.useDebugValue=function(){},ve.useDeferredValue=function(w,$){return Q.H.useDeferredValue(w,$)},ve.useEffect=function(w,$,W){var ae=Q.H;if(typeof W=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ae.useEffect(w,$)},ve.useId=function(){return Q.H.useId()},ve.useImperativeHandle=function(w,$,W){return Q.H.useImperativeHandle(w,$,W)},ve.useInsertionEffect=function(w,$){return Q.H.useInsertionEffect(w,$)},ve.useLayoutEffect=function(w,$){return Q.H.useLayoutEffect(w,$)},ve.useMemo=function(w,$){return Q.H.useMemo(w,$)},ve.useOptimistic=function(w,$){return Q.H.useOptimistic(w,$)},ve.useReducer=function(w,$,W){return Q.H.useReducer(w,$,W)},ve.useRef=function(w){return Q.H.useRef(w)},ve.useState=function(w){return Q.H.useState(w)},ve.useSyncExternalStore=function(w,$,W){return Q.H.useSyncExternalStore(w,$,W)},ve.useTransition=function(){return Q.H.useTransition()},ve.version="19.1.1",ve}var Hy;function nm(){return Hy||(Hy=1,Hf.exports=B3()),Hf.exports}var jf={exports:{}},Nt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jy;function H3(){if(jy)return Nt;jy=1;var n=nm();function a(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var r={d:{f:s,r:function(){throw Error(a(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(m,p,g){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:b==null?null:""+b,children:m,containerInfo:p,implementation:g}}var f=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Nt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Nt.createPortal=function(m,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(a(299));return u(m,p,null,g)},Nt.flushSync=function(m){var p=f.T,g=r.p;try{if(f.T=null,r.p=2,m)return m()}finally{f.T=p,r.p=g,r.d.f()}},Nt.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,r.d.C(m,p))},Nt.prefetchDNS=function(m){typeof m=="string"&&r.d.D(m)},Nt.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var g=p.as,b=h(g,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,E=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;g==="style"?r.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:b,integrity:v,fetchPriority:E}):g==="script"&&r.d.X(m,{crossOrigin:b,integrity:v,fetchPriority:E,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Nt.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var g=h(p.as,p.crossOrigin);r.d.M(m,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&r.d.M(m)},Nt.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var g=p.as,b=h(g,p.crossOrigin);r.d.L(m,g,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Nt.preloadModule=function(m,p){if(typeof m=="string")if(p){var g=h(p.as,p.crossOrigin);r.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else r.d.m(m)},Nt.requestFormReset=function(m){r.d.r(m)},Nt.unstable_batchedUpdates=function(m,p){return m(p)},Nt.useFormState=function(m,p,g){return f.H.useFormState(m,p,g)},Nt.useFormStatus=function(){return f.H.useHostTransitionStatus()},Nt.version="19.1.1",Nt}var Gy;function j3(){if(Gy)return jf.exports;Gy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(a){console.error(a)}}return n(),jf.exports=H3(),jf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Iy;function G3(){if(Iy)return rl;Iy=1;var n=z3(),a=nm(),s=j3();function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function f(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(r(188))}function m(e){var t=e.alternate;if(!t){if(t=u(e),t===null)throw Error(r(188));return t!==e?null:e}for(var i=e,l=t;;){var c=i.return;if(c===null)break;var d=c.alternate;if(d===null){if(l=c.return,l!==null){i=l;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===i)return h(c),e;if(d===l)return h(c),t;d=d.sibling}throw Error(r(188))}if(i.return!==l.return)i=c,l=d;else{for(var y=!1,S=c.child;S;){if(S===i){y=!0,i=c,l=d;break}if(S===l){y=!0,l=c,i=d;break}S=S.sibling}if(!y){for(S=d.child;S;){if(S===i){y=!0,i=d,l=c;break}if(S===l){y=!0,l=d,i=c;break}S=S.sibling}if(!y)throw Error(r(189))}}if(i.alternate!==l)throw Error(r(190))}if(i.tag!==3)throw Error(r(188));return i.stateNode.current===i?e:t}function p(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=p(e),t!==null)return t;e=e.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),q=Symbol.for("react.consumer"),j=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),se=Symbol.for("react.suspense_list"),ee=Symbol.for("react.memo"),le=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),I=Symbol.for("react.memo_cache_sentinel"),T=Symbol.iterator;function k(e){return e===null||typeof e!="object"?null:(e=T&&e[T]||e["@@iterator"],typeof e=="function"?e:null)}var A=Symbol.for("react.client.reference");function Y(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===A?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case M:return"Fragment";case R:return"Profiler";case C:return"StrictMode";case Q:return"Suspense";case se:return"SuspenseList";case P:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case E:return"Portal";case j:return(e.displayName||"Context")+".Provider";case q:return(e._context.displayName||"Context")+".Consumer";case F:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ee:return t=e.displayName||null,t!==null?t:Y(e.type)||"Memo";case le:t=e._payload,e=e._init;try{return Y(e(t))}catch{}}return null}var B=Array.isArray,D=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},he=[],w=-1;function $(e){return{current:e}}function W(e){0>w||(e.current=he[w],he[w]=null,w--)}function ae(e,t){w++,he[w]=e.current,e.current=t}var oe=$(null),ge=$(null),de=$(null),Te=$(null);function xe(e,t){switch(ae(de,t),ae(ge,e),ae(oe,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Eg(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Eg(t),e=Mg(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(oe),ae(oe,e)}function xt(){W(oe),W(ge),W(de)}function on(e){e.memoizedState!==null&&ae(Te,e);var t=oe.current,i=Mg(t,e.type);t!==i&&(ae(ge,e),ae(oe,i))}function cn(e){ge.current===e&&(W(oe),W(ge)),Te.current===e&&(W(Te),Qr._currentValue=te)}var Un=Object.prototype.hasOwnProperty,On=n.unstable_scheduleCallback,un=n.unstable_cancelCallback,yi=n.unstable_shouldYield,Wi=n.unstable_requestPaint,ce=n.unstable_now,_e=n.unstable_getCurrentPriorityLevel,Ge=n.unstable_ImmediatePriority,qe=n.unstable_UserBlockingPriority,bt=n.unstable_NormalPriority,dn=n.unstable_LowPriority,Qt=n.unstable_IdlePriority,En=n.log,aa=n.unstable_setDisableYieldValue,Xe=null,Qe=null;function Gt(e){if(typeof En=="function"&&aa(e),Qe&&typeof Qe.setStrictMode=="function")try{Qe.setStrictMode(Xe,e)}catch{}}var _t=Math.clz32?Math.clz32:ql,pu=Math.log,gu=Math.LN2;function ql(e){return e>>>=0,e===0?32:31-(pu(e)/gu|0)|0}var es=256,qa=4194304;function qn(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function bi(e,t,i){var l=e.pendingLanes;if(l===0)return 0;var c=0,d=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var S=l&134217727;return S!==0?(l=S&~d,l!==0?c=qn(l):(y&=S,y!==0?c=qn(y):i||(i=S&~e,i!==0&&(c=qn(i))))):(S=l&~d,S!==0?c=qn(S):y!==0?c=qn(y):i||(i=l&~e,i!==0&&(c=qn(i)))),c===0?0:t!==0&&t!==c&&(t&d)===0&&(d=c&-c,i=t&-t,d>=i||d===32&&(i&4194048)!==0)?t:c}function ia(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function yu(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zl(){var e=es;return es<<=1,(es&4194048)===0&&(es=256),e}function Bl(){var e=qa;return qa<<=1,(qa&62914560)===0&&(qa=4194304),e}function ts(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function zn(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Hl(e,t,i,l,c,d){var y=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var S=e.entanglements,x=e.expirationTimes,z=e.hiddenUpdates;for(i=y&~i;0<i;){var K=31-_t(i),J=1<<K;S[K]=0,x[K]=-1;var H=z[K];if(H!==null)for(z[K]=null,K=0;K<H.length;K++){var G=H[K];G!==null&&(G.lane&=-536870913)}i&=~J}l!==0&&ir(e,l,0),d!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=d&~(y&~t))}function ir(e,t,i){e.pendingLanes|=t,e.suspendedLanes&=~t;var l=31-_t(t);e.entangledLanes|=t,e.entanglements[l]=e.entanglements[l]|1073741824|i&4194090}function sr(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var l=31-_t(i),c=1<<l;c&t|e[l]&t&&(e[l]|=t),i&=~c}}function rr(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function lr(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function jl(){var e=V.p;return e!==0?e:(e=window.event,e===void 0?32:Gg(e.type))}function Gl(e,t){var i=V.p;try{return V.p=e,t()}finally{V.p=i}}var Bn=Math.random().toString(36).slice(2),We="__reactFiber$"+Bn,ut="__reactProps$"+Bn,sa="__reactContainer$"+Bn,za="__reactEvents$"+Bn,Mn="__reactListeners$"+Bn,ns="__reactHandles$"+Bn,vi="__reactResources$"+Bn,Si="__reactMarker$"+Bn;function as(e){delete e[We],delete e[ut],delete e[za],delete e[Mn],delete e[ns]}function ra(e){var t=e[We];if(t)return t;for(var i=e.parentNode;i;){if(t=i[sa]||i[We]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=Cg(e);e!==null;){if(i=e[We])return i;e=Cg(e)}return t}e=i,i=e.parentNode}return null}function Ba(e){if(e=e[We]||e[sa]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function la(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(r(33))}function oa(e){var t=e[vi];return t||(t=e[vi]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function et(e){e[Si]=!0}var is=new Set,Il={};function Hn(e,t){Ha(e,t),Ha(e+"Capture",t)}function Ha(e,t){for(Il[e]=t,e=0;e<t.length;e++)is.add(t[e])}var Yl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Fl={},$l={};function Vl(e){return Un.call($l,e)?!0:Un.call(Fl,e)?!1:Yl.test(e)?$l[e]=!0:(Fl[e]=!0,!1)}function Ei(e,t,i){if(Vl(t))if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var l=t.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+i)}}function Mi(e,t,i){if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+i)}}function xn(e,t,i,l){if(l===null)e.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(t,i,""+l)}}var Xl,L;function X(e){if(Xl===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);Xl=t&&t[1]||"",L=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Xl+e+L}var re=!1;function fe(e,t){if(!e||re)return"";re=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(t){var J=function(){throw Error()};if(Object.defineProperty(J.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(J,[])}catch(G){var H=G}Reflect.construct(e,[],J)}else{try{J.call()}catch(G){H=G}e.call(J.prototype)}}else{try{throw Error()}catch(G){H=G}(J=e())&&typeof J.catch=="function"&&J.catch(function(){})}}catch(G){if(G&&H&&typeof G.stack=="string")return[G.stack,H.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=l.DetermineComponentFrameRoot(),y=d[0],S=d[1];if(y&&S){var x=y.split(`
`),z=S.split(`
`);for(c=l=0;l<x.length&&!x[l].includes("DetermineComponentFrameRoot");)l++;for(;c<z.length&&!z[c].includes("DetermineComponentFrameRoot");)c++;if(l===x.length||c===z.length)for(l=x.length-1,c=z.length-1;1<=l&&0<=c&&x[l]!==z[c];)c--;for(;1<=l&&0<=c;l--,c--)if(x[l]!==z[c]){if(l!==1||c!==1)do if(l--,c--,0>c||x[l]!==z[c]){var K=`
`+x[l].replace(" at new "," at ");return e.displayName&&K.includes("<anonymous>")&&(K=K.replace("<anonymous>",e.displayName)),K}while(1<=l&&0<=c);break}}}finally{re=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?X(i):""}function Re(e){switch(e.tag){case 26:case 27:case 5:return X(e.type);case 16:return X("Lazy");case 13:return X("Suspense");case 19:return X("SuspenseList");case 0:case 15:return fe(e.type,!1);case 11:return fe(e.type.render,!1);case 1:return fe(e.type,!0);case 31:return X("Activity");default:return""}}function Ie(e){try{var t="";do t+=Re(e),e=e.return;while(e);return t}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function Ce(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function tt(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Pt(e){var t=tt(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),l=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var c=i.get,d=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(y){l=""+y,d.call(this,y)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return l},setValue:function(y){l=""+y},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function vt(e){e._valueTracker||(e._valueTracker=Pt(e))}function Zt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),l="";return e&&(l=tt(e)?e.checked?"true":"false":e.value),e=l,e!==i?(t.setValue(e),!0):!1}function Jt(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var xi=/[\n"\\]/g;function dt(e){return e.replace(xi,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function nt(e,t,i,l,c,d,y,S){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),t!=null?y==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Ce(t)):e.value!==""+Ce(t)&&(e.value=""+Ce(t)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),t!=null?Ga(e,y,Ce(t)):i!=null?Ga(e,y,Ce(i)):l!=null&&e.removeAttribute("value"),c==null&&d!=null&&(e.defaultChecked=!!d),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?e.name=""+Ce(S):e.removeAttribute("name")}function ja(e,t,i,l,c,d,y,S){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),t!=null||i!=null){if(!(d!=="submit"&&d!=="reset"||t!=null))return;i=i!=null?""+Ce(i):"",t=t!=null?""+Ce(t):i,S||t===e.value||(e.value=t),e.defaultValue=t}l=l??c,l=typeof l!="function"&&typeof l!="symbol"&&!!l,e.checked=S?e.checked:!!l,e.defaultChecked=!!l,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y)}function Ga(e,t,i){t==="number"&&Jt(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function ca(e,t,i,l){if(e=e.options,t){t={};for(var c=0;c<i.length;c++)t["$"+i[c]]=!0;for(i=0;i<e.length;i++)c=t.hasOwnProperty("$"+e[i].value),e[i].selected!==c&&(e[i].selected=c),c&&l&&(e[i].defaultSelected=!0)}else{for(i=""+Ce(i),t=null,c=0;c<e.length;c++){if(e[c].value===i){e[c].selected=!0,l&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function jn(e,t,i){if(t!=null&&(t=""+Ce(t),t!==e.value&&(e.value=t),i==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=i!=null?""+Ce(i):""}function Kl(e,t,i,l){if(t==null){if(l!=null){if(i!=null)throw Error(r(92));if(B(l)){if(1<l.length)throw Error(r(93));l=l[0]}i=l}i==null&&(i=""),t=i}i=Ce(t),e.defaultValue=i,l=e.textContent,l===i&&l!==""&&l!==null&&(e.value=l)}function ss(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var Yv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Em(e,t,i){var l=t.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?l?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":l?e.setProperty(t,i):typeof i!="number"||i===0||Yv.has(t)?t==="float"?e.cssFloat=i:e[t]=(""+i).trim():e[t]=i+"px"}function Mm(e,t,i){if(t!=null&&typeof t!="object")throw Error(r(62));if(e=e.style,i!=null){for(var l in i)!i.hasOwnProperty(l)||t!=null&&t.hasOwnProperty(l)||(l.indexOf("--")===0?e.setProperty(l,""):l==="float"?e.cssFloat="":e[l]="");for(var c in t)l=t[c],t.hasOwnProperty(c)&&i[c]!==l&&Em(e,c,l)}else for(var d in t)t.hasOwnProperty(d)&&Em(e,d,t[d])}function bu(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),$v=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ql(e){return $v.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var vu=null;function Su(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var rs=null,ls=null;function xm(e){var t=Ba(e);if(t&&(e=t.stateNode)){var i=e[ut]||null;e:switch(e=t.stateNode,t.type){case"input":if(nt(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+dt(""+t)+'"][type="radio"]'),t=0;t<i.length;t++){var l=i[t];if(l!==e&&l.form===e.form){var c=l[ut]||null;if(!c)throw Error(r(90));nt(l,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(t=0;t<i.length;t++)l=i[t],l.form===e.form&&Zt(l)}break e;case"textarea":jn(e,i.value,i.defaultValue);break e;case"select":t=i.value,t!=null&&ca(e,!!i.multiple,t,!1)}}}var Eu=!1;function wm(e,t,i){if(Eu)return e(t,i);Eu=!0;try{var l=e(t);return l}finally{if(Eu=!1,(rs!==null||ls!==null)&&(Oo(),rs&&(t=rs,e=ls,ls=rs=null,xm(t),e)))for(t=0;t<e.length;t++)xm(e[t])}}function or(e,t){var i=e.stateNode;if(i===null)return null;var l=i[ut]||null;if(l===null)return null;i=l[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(r(231,t,typeof i));return i}var ua=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mu=!1;if(ua)try{var cr={};Object.defineProperty(cr,"passive",{get:function(){Mu=!0}}),window.addEventListener("test",cr,cr),window.removeEventListener("test",cr,cr)}catch{Mu=!1}var Ia=null,xu=null,Pl=null;function Am(){if(Pl)return Pl;var e,t=xu,i=t.length,l,c="value"in Ia?Ia.value:Ia.textContent,d=c.length;for(e=0;e<i&&t[e]===c[e];e++);var y=i-e;for(l=1;l<=y&&t[i-l]===c[d-l];l++);return Pl=c.slice(e,1<l?1-l:void 0)}function Zl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Jl(){return!0}function Cm(){return!1}function It(e){function t(i,l,c,d,y){this._reactName=i,this._targetInst=c,this.type=l,this.nativeEvent=d,this.target=y,this.currentTarget=null;for(var S in e)e.hasOwnProperty(S)&&(i=e[S],this[S]=i?i(d):d[S]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?Jl:Cm,this.isPropagationStopped=Cm,this}return g(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Jl)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Jl)},persist:function(){},isPersistent:Jl}),t}var wi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wl=It(wi),ur=g({},wi,{view:0,detail:0}),Vv=It(ur),wu,Au,dr,eo=g({},ur,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==dr&&(dr&&e.type==="mousemove"?(wu=e.screenX-dr.screenX,Au=e.screenY-dr.screenY):Au=wu=0,dr=e),wu)},movementY:function(e){return"movementY"in e?e.movementY:Au}}),Tm=It(eo),Xv=g({},eo,{dataTransfer:0}),Kv=It(Xv),Qv=g({},ur,{relatedTarget:0}),Cu=It(Qv),Pv=g({},wi,{animationName:0,elapsedTime:0,pseudoElement:0}),Zv=It(Pv),Jv=g({},wi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Wv=It(Jv),e1=g({},wi,{data:0}),_m=It(e1),t1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},n1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},a1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function i1(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=a1[e])?!!t[e]:!1}function Tu(){return i1}var s1=g({},ur,{key:function(e){if(e.key){var t=t1[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Zl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?n1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tu,charCode:function(e){return e.type==="keypress"?Zl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Zl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),r1=It(s1),l1=g({},eo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rm=It(l1),o1=g({},ur,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tu}),c1=It(o1),u1=g({},wi,{propertyName:0,elapsedTime:0,pseudoElement:0}),d1=It(u1),f1=g({},eo,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),h1=It(f1),m1=g({},wi,{newState:0,oldState:0}),p1=It(m1),g1=[9,13,27,32],_u=ua&&"CompositionEvent"in window,fr=null;ua&&"documentMode"in document&&(fr=document.documentMode);var y1=ua&&"TextEvent"in window&&!fr,Nm=ua&&(!_u||fr&&8<fr&&11>=fr),km=" ",Dm=!1;function Lm(e,t){switch(e){case"keyup":return g1.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Um(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var os=!1;function b1(e,t){switch(e){case"compositionend":return Um(t);case"keypress":return t.which!==32?null:(Dm=!0,km);case"textInput":return e=t.data,e===km&&Dm?null:e;default:return null}}function v1(e,t){if(os)return e==="compositionend"||!_u&&Lm(e,t)?(e=Am(),Pl=xu=Ia=null,os=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Nm&&t.locale!=="ko"?null:t.data;default:return null}}var S1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Om(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!S1[e.type]:t==="textarea"}function qm(e,t,i,l){rs?ls?ls.push(l):ls=[l]:rs=l,t=Go(t,"onChange"),0<t.length&&(i=new Wl("onChange","change",null,i,l),e.push({event:i,listeners:t}))}var hr=null,mr=null;function E1(e){gg(e,0)}function to(e){var t=la(e);if(Zt(t))return e}function zm(e,t){if(e==="change")return t}var Bm=!1;if(ua){var Ru;if(ua){var Nu="oninput"in document;if(!Nu){var Hm=document.createElement("div");Hm.setAttribute("oninput","return;"),Nu=typeof Hm.oninput=="function"}Ru=Nu}else Ru=!1;Bm=Ru&&(!document.documentMode||9<document.documentMode)}function jm(){hr&&(hr.detachEvent("onpropertychange",Gm),mr=hr=null)}function Gm(e){if(e.propertyName==="value"&&to(mr)){var t=[];qm(t,mr,e,Su(e)),wm(E1,t)}}function M1(e,t,i){e==="focusin"?(jm(),hr=t,mr=i,hr.attachEvent("onpropertychange",Gm)):e==="focusout"&&jm()}function x1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return to(mr)}function w1(e,t){if(e==="click")return to(t)}function A1(e,t){if(e==="input"||e==="change")return to(t)}function C1(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Wt=typeof Object.is=="function"?Object.is:C1;function pr(e,t){if(Wt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),l=Object.keys(t);if(i.length!==l.length)return!1;for(l=0;l<i.length;l++){var c=i[l];if(!Un.call(t,c)||!Wt(e[c],t[c]))return!1}return!0}function Im(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ym(e,t){var i=Im(e);e=0;for(var l;i;){if(i.nodeType===3){if(l=e+i.textContent.length,e<=t&&l>=t)return{node:i,offset:t-e};e=l}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Im(i)}}function Fm(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Fm(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function $m(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=Jt(e.document);t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=Jt(e.document)}return t}function ku(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var T1=ua&&"documentMode"in document&&11>=document.documentMode,cs=null,Du=null,gr=null,Lu=!1;function Vm(e,t,i){var l=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Lu||cs==null||cs!==Jt(l)||(l=cs,"selectionStart"in l&&ku(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),gr&&pr(gr,l)||(gr=l,l=Go(Du,"onSelect"),0<l.length&&(t=new Wl("onSelect","select",null,t,i),e.push({event:t,listeners:l}),t.target=cs)))}function Ai(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var us={animationend:Ai("Animation","AnimationEnd"),animationiteration:Ai("Animation","AnimationIteration"),animationstart:Ai("Animation","AnimationStart"),transitionrun:Ai("Transition","TransitionRun"),transitionstart:Ai("Transition","TransitionStart"),transitioncancel:Ai("Transition","TransitionCancel"),transitionend:Ai("Transition","TransitionEnd")},Uu={},Xm={};ua&&(Xm=document.createElement("div").style,"AnimationEvent"in window||(delete us.animationend.animation,delete us.animationiteration.animation,delete us.animationstart.animation),"TransitionEvent"in window||delete us.transitionend.transition);function Ci(e){if(Uu[e])return Uu[e];if(!us[e])return e;var t=us[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in Xm)return Uu[e]=t[i];return e}var Km=Ci("animationend"),Qm=Ci("animationiteration"),Pm=Ci("animationstart"),_1=Ci("transitionrun"),R1=Ci("transitionstart"),N1=Ci("transitioncancel"),Zm=Ci("transitionend"),Jm=new Map,Ou="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ou.push("scrollEnd");function wn(e,t){Jm.set(e,t),Hn(t,[e])}var Wm=new WeakMap;function fn(e,t){if(typeof e=="object"&&e!==null){var i=Wm.get(e);return i!==void 0?i:(t={value:e,source:t,stack:Ie(t)},Wm.set(e,t),t)}return{value:e,source:t,stack:Ie(t)}}var hn=[],ds=0,qu=0;function no(){for(var e=ds,t=qu=ds=0;t<e;){var i=hn[t];hn[t++]=null;var l=hn[t];hn[t++]=null;var c=hn[t];hn[t++]=null;var d=hn[t];if(hn[t++]=null,l!==null&&c!==null){var y=l.pending;y===null?c.next=c:(c.next=y.next,y.next=c),l.pending=c}d!==0&&ep(i,c,d)}}function ao(e,t,i,l){hn[ds++]=e,hn[ds++]=t,hn[ds++]=i,hn[ds++]=l,qu|=l,e.lanes|=l,e=e.alternate,e!==null&&(e.lanes|=l)}function zu(e,t,i,l){return ao(e,t,i,l),io(e)}function fs(e,t){return ao(e,null,null,t),io(e)}function ep(e,t,i){e.lanes|=i;var l=e.alternate;l!==null&&(l.lanes|=i);for(var c=!1,d=e.return;d!==null;)d.childLanes|=i,l=d.alternate,l!==null&&(l.childLanes|=i),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(c=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,c&&t!==null&&(c=31-_t(i),e=d.hiddenUpdates,l=e[c],l===null?e[c]=[t]:l.push(t),t.lane=i|536870912),d):null}function io(e){if(50<Gr)throw Gr=0,Yd=null,Error(r(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var hs={};function k1(e,t,i,l){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function en(e,t,i,l){return new k1(e,t,i,l)}function Bu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function da(e,t){var i=e.alternate;return i===null?(i=en(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function tp(e,t){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,t=i.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function so(e,t,i,l,c,d){var y=0;if(l=e,typeof e=="function")Bu(e)&&(y=1);else if(typeof e=="string")y=LS(e,i,oe.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case P:return e=en(31,i,t,c),e.elementType=P,e.lanes=d,e;case M:return Ti(i.children,c,d,t);case C:y=8,c|=24;break;case R:return e=en(12,i,t,c|2),e.elementType=R,e.lanes=d,e;case Q:return e=en(13,i,t,c),e.elementType=Q,e.lanes=d,e;case se:return e=en(19,i,t,c),e.elementType=se,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case N:case j:y=10;break e;case q:y=9;break e;case F:y=11;break e;case ee:y=14;break e;case le:y=16,l=null;break e}y=29,i=Error(r(130,e===null?"null":typeof e,"")),l=null}return t=en(y,i,t,c),t.elementType=e,t.type=l,t.lanes=d,t}function Ti(e,t,i,l){return e=en(7,e,l,t),e.lanes=i,e}function Hu(e,t,i){return e=en(6,e,null,t),e.lanes=i,e}function ju(e,t,i){return t=en(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var ms=[],ps=0,ro=null,lo=0,mn=[],pn=0,_i=null,fa=1,ha="";function Ri(e,t){ms[ps++]=lo,ms[ps++]=ro,ro=e,lo=t}function np(e,t,i){mn[pn++]=fa,mn[pn++]=ha,mn[pn++]=_i,_i=e;var l=fa;e=ha;var c=32-_t(l)-1;l&=~(1<<c),i+=1;var d=32-_t(t)+c;if(30<d){var y=c-c%5;d=(l&(1<<y)-1).toString(32),l>>=y,c-=y,fa=1<<32-_t(t)+c|i<<c|l,ha=d+e}else fa=1<<d|i<<c|l,ha=e}function Gu(e){e.return!==null&&(Ri(e,1),np(e,1,0))}function Iu(e){for(;e===ro;)ro=ms[--ps],ms[ps]=null,lo=ms[--ps],ms[ps]=null;for(;e===_i;)_i=mn[--pn],mn[pn]=null,ha=mn[--pn],mn[pn]=null,fa=mn[--pn],mn[pn]=null}var Ot=null,at=null,De=!1,Ni=null,Gn=!1,Yu=Error(r(519));function ki(e){var t=Error(r(418,""));throw vr(fn(t,e)),Yu}function ap(e){var t=e.stateNode,i=e.type,l=e.memoizedProps;switch(t[We]=e,t[ut]=l,i){case"dialog":Ae("cancel",t),Ae("close",t);break;case"iframe":case"object":case"embed":Ae("load",t);break;case"video":case"audio":for(i=0;i<Yr.length;i++)Ae(Yr[i],t);break;case"source":Ae("error",t);break;case"img":case"image":case"link":Ae("error",t),Ae("load",t);break;case"details":Ae("toggle",t);break;case"input":Ae("invalid",t),ja(t,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0),vt(t);break;case"select":Ae("invalid",t);break;case"textarea":Ae("invalid",t),Kl(t,l.value,l.defaultValue,l.children),vt(t)}i=l.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||t.textContent===""+i||l.suppressHydrationWarning===!0||Sg(t.textContent,i)?(l.popover!=null&&(Ae("beforetoggle",t),Ae("toggle",t)),l.onScroll!=null&&Ae("scroll",t),l.onScrollEnd!=null&&Ae("scrollend",t),l.onClick!=null&&(t.onclick=Io),t=!0):t=!1,t||ki(e)}function ip(e){for(Ot=e.return;Ot;)switch(Ot.tag){case 5:case 13:Gn=!1;return;case 27:case 3:Gn=!0;return;default:Ot=Ot.return}}function yr(e){if(e!==Ot)return!1;if(!De)return ip(e),De=!0,!1;var t=e.tag,i;if((i=t!==3&&t!==27)&&((i=t===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||rf(e.type,e.memoizedProps)),i=!i),i&&at&&ki(e),ip(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(i=e.data,i==="/$"){if(t===0){at=Cn(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++;e=e.nextSibling}at=null}}else t===27?(t=at,ii(e.type)?(e=uf,uf=null,at=e):at=t):at=Ot?Cn(e.stateNode.nextSibling):null;return!0}function br(){at=Ot=null,De=!1}function sp(){var e=Ni;return e!==null&&($t===null?$t=e:$t.push.apply($t,e),Ni=null),e}function vr(e){Ni===null?Ni=[e]:Ni.push(e)}var Fu=$(null),Di=null,ma=null;function Ya(e,t,i){ae(Fu,t._currentValue),t._currentValue=i}function pa(e){e._currentValue=Fu.current,W(Fu)}function $u(e,t,i){for(;e!==null;){var l=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,l!==null&&(l.childLanes|=t)):l!==null&&(l.childLanes&t)!==t&&(l.childLanes|=t),e===i)break;e=e.return}}function Vu(e,t,i,l){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var d=c.dependencies;if(d!==null){var y=c.child;d=d.firstContext;e:for(;d!==null;){var S=d;d=c;for(var x=0;x<t.length;x++)if(S.context===t[x]){d.lanes|=i,S=d.alternate,S!==null&&(S.lanes|=i),$u(d.return,i,e),l||(y=null);break e}d=S.next}}else if(c.tag===18){if(y=c.return,y===null)throw Error(r(341));y.lanes|=i,d=y.alternate,d!==null&&(d.lanes|=i),$u(y,i,e),y=null}else y=c.child;if(y!==null)y.return=c;else for(y=c;y!==null;){if(y===e){y=null;break}if(c=y.sibling,c!==null){c.return=y.return,y=c;break}y=y.return}c=y}}function Sr(e,t,i,l){e=null;for(var c=t,d=!1;c!==null;){if(!d){if((c.flags&524288)!==0)d=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var y=c.alternate;if(y===null)throw Error(r(387));if(y=y.memoizedProps,y!==null){var S=c.type;Wt(c.pendingProps.value,y.value)||(e!==null?e.push(S):e=[S])}}else if(c===Te.current){if(y=c.alternate,y===null)throw Error(r(387));y.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(Qr):e=[Qr])}c=c.return}e!==null&&Vu(t,e,i,l),t.flags|=262144}function oo(e){for(e=e.firstContext;e!==null;){if(!Wt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Li(e){Di=e,ma=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Rt(e){return rp(Di,e)}function co(e,t){return Di===null&&Li(e),rp(e,t)}function rp(e,t){var i=t._currentValue;if(t={context:t,memoizedValue:i,next:null},ma===null){if(e===null)throw Error(r(308));ma=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ma=ma.next=t;return i}var D1=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(i,l){e.push(l)}};this.abort=function(){t.aborted=!0,e.forEach(function(i){return i()})}},L1=n.unstable_scheduleCallback,U1=n.unstable_NormalPriority,ft={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xu(){return{controller:new D1,data:new Map,refCount:0}}function Er(e){e.refCount--,e.refCount===0&&L1(U1,function(){e.controller.abort()})}var Mr=null,Ku=0,gs=0,ys=null;function O1(e,t){if(Mr===null){var i=Mr=[];Ku=0,gs=Pd(),ys={status:"pending",value:void 0,then:function(l){i.push(l)}}}return Ku++,t.then(lp,lp),t}function lp(){if(--Ku===0&&Mr!==null){ys!==null&&(ys.status="fulfilled");var e=Mr;Mr=null,gs=0,ys=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function q1(e,t){var i=[],l={status:"pending",value:null,reason:null,then:function(c){i.push(c)}};return e.then(function(){l.status="fulfilled",l.value=t;for(var c=0;c<i.length;c++)(0,i[c])(t)},function(c){for(l.status="rejected",l.reason=c,c=0;c<i.length;c++)(0,i[c])(void 0)}),l}var op=D.S;D.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&O1(e,t),op!==null&&op(e,t)};var Ui=$(null);function Qu(){var e=Ui.current;return e!==null?e:$e.pooledCache}function uo(e,t){t===null?ae(Ui,Ui.current):ae(Ui,t.pool)}function cp(){var e=Qu();return e===null?null:{parent:ft._currentValue,pool:e}}var xr=Error(r(460)),up=Error(r(474)),fo=Error(r(542)),Pu={then:function(){}};function dp(e){return e=e.status,e==="fulfilled"||e==="rejected"}function ho(){}function fp(e,t,i){switch(i=e[i],i===void 0?e.push(t):i!==t&&(t.then(ho,ho),t=i),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,mp(e),e;default:if(typeof t.status=="string")t.then(ho,ho);else{if(e=$e,e!==null&&100<e.shellSuspendCounter)throw Error(r(482));e=t,e.status="pending",e.then(function(l){if(t.status==="pending"){var c=t;c.status="fulfilled",c.value=l}},function(l){if(t.status==="pending"){var c=t;c.status="rejected",c.reason=l}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,mp(e),e}throw wr=t,xr}}var wr=null;function hp(){if(wr===null)throw Error(r(459));var e=wr;return wr=null,e}function mp(e){if(e===xr||e===fo)throw Error(r(483))}var Fa=!1;function Zu(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ju(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function $a(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Va(e,t,i){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,(Le&2)!==0){var c=l.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),l.pending=t,t=io(e),ep(e,null,i),t}return ao(e,l,t,i),io(e)}function Ar(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194048)!==0)){var l=t.lanes;l&=e.pendingLanes,i|=l,t.lanes=i,sr(e,i)}}function Wu(e,t){var i=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,i===l)){var c=null,d=null;if(i=i.firstBaseUpdate,i!==null){do{var y={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};d===null?c=d=y:d=d.next=y,i=i.next}while(i!==null);d===null?c=d=t:d=d.next=t}else c=d=t;i={baseState:l.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:l.shared,callbacks:l.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}var ed=!1;function Cr(){if(ed){var e=ys;if(e!==null)throw e}}function Tr(e,t,i,l){ed=!1;var c=e.updateQueue;Fa=!1;var d=c.firstBaseUpdate,y=c.lastBaseUpdate,S=c.shared.pending;if(S!==null){c.shared.pending=null;var x=S,z=x.next;x.next=null,y===null?d=z:y.next=z,y=x;var K=e.alternate;K!==null&&(K=K.updateQueue,S=K.lastBaseUpdate,S!==y&&(S===null?K.firstBaseUpdate=z:S.next=z,K.lastBaseUpdate=x))}if(d!==null){var J=c.baseState;y=0,K=z=x=null,S=d;do{var H=S.lane&-536870913,G=H!==S.lane;if(G?(Ne&H)===H:(l&H)===H){H!==0&&H===gs&&(ed=!0),K!==null&&(K=K.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var be=e,pe=S;H=t;var He=i;switch(pe.tag){case 1:if(be=pe.payload,typeof be=="function"){J=be.call(He,J,H);break e}J=be;break e;case 3:be.flags=be.flags&-65537|128;case 0:if(be=pe.payload,H=typeof be=="function"?be.call(He,J,H):be,H==null)break e;J=g({},J,H);break e;case 2:Fa=!0}}H=S.callback,H!==null&&(e.flags|=64,G&&(e.flags|=8192),G=c.callbacks,G===null?c.callbacks=[H]:G.push(H))}else G={lane:H,tag:S.tag,payload:S.payload,callback:S.callback,next:null},K===null?(z=K=G,x=J):K=K.next=G,y|=H;if(S=S.next,S===null){if(S=c.shared.pending,S===null)break;G=S,S=G.next,G.next=null,c.lastBaseUpdate=G,c.shared.pending=null}}while(!0);K===null&&(x=J),c.baseState=x,c.firstBaseUpdate=z,c.lastBaseUpdate=K,d===null&&(c.shared.lanes=0),ei|=y,e.lanes=y,e.memoizedState=J}}function pp(e,t){if(typeof e!="function")throw Error(r(191,e));e.call(t)}function gp(e,t){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)pp(i[e],t)}var bs=$(null),mo=$(0);function yp(e,t){e=Ma,ae(mo,e),ae(bs,t),Ma=e|t.baseLanes}function td(){ae(mo,Ma),ae(bs,bs.current)}function nd(){Ma=mo.current,W(bs),W(mo)}var Xa=0,Se=null,ze=null,ot=null,po=!1,vs=!1,Oi=!1,go=0,_r=0,Ss=null,z1=0;function st(){throw Error(r(321))}function ad(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!Wt(e[i],t[i]))return!1;return!0}function id(e,t,i,l,c,d){return Xa=d,Se=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,D.H=e===null||e.memoizedState===null?e0:t0,Oi=!1,d=i(l,c),Oi=!1,vs&&(d=vp(t,i,l,c)),bp(e),d}function bp(e){D.H=Mo;var t=ze!==null&&ze.next!==null;if(Xa=0,ot=ze=Se=null,po=!1,_r=0,Ss=null,t)throw Error(r(300));e===null||St||(e=e.dependencies,e!==null&&oo(e)&&(St=!0))}function vp(e,t,i,l){Se=e;var c=0;do{if(vs&&(Ss=null),_r=0,vs=!1,25<=c)throw Error(r(301));if(c+=1,ot=ze=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}D.H=F1,d=t(i,l)}while(vs);return d}function B1(){var e=D.H,t=e.useState()[0];return t=typeof t.then=="function"?Rr(t):t,e=e.useState()[0],(ze!==null?ze.memoizedState:null)!==e&&(Se.flags|=1024),t}function sd(){var e=go!==0;return go=0,e}function rd(e,t,i){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i}function ld(e){if(po){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}po=!1}Xa=0,ot=ze=Se=null,vs=!1,_r=go=0,Ss=null}function Yt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ot===null?Se.memoizedState=ot=e:ot=ot.next=e,ot}function ct(){if(ze===null){var e=Se.alternate;e=e!==null?e.memoizedState:null}else e=ze.next;var t=ot===null?Se.memoizedState:ot.next;if(t!==null)ot=t,ze=e;else{if(e===null)throw Se.alternate===null?Error(r(467)):Error(r(310));ze=e,e={memoizedState:ze.memoizedState,baseState:ze.baseState,baseQueue:ze.baseQueue,queue:ze.queue,next:null},ot===null?Se.memoizedState=ot=e:ot=ot.next=e}return ot}function od(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Rr(e){var t=_r;return _r+=1,Ss===null&&(Ss=[]),e=fp(Ss,e,t),t=Se,(ot===null?t.memoizedState:ot.next)===null&&(t=t.alternate,D.H=t===null||t.memoizedState===null?e0:t0),e}function yo(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Rr(e);if(e.$$typeof===j)return Rt(e)}throw Error(r(438,String(e)))}function cd(e){var t=null,i=Se.updateQueue;if(i!==null&&(t=i.memoCache),t==null){var l=Se.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(t={data:l.data.map(function(c){return c.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),i===null&&(i=od(),Se.updateQueue=i),i.memoCache=t,i=t.data[t.index],i===void 0)for(i=t.data[t.index]=Array(e),l=0;l<e;l++)i[l]=I;return t.index++,i}function ga(e,t){return typeof t=="function"?t(e):t}function bo(e){var t=ct();return ud(t,ze,e)}function ud(e,t,i){var l=e.queue;if(l===null)throw Error(r(311));l.lastRenderedReducer=i;var c=e.baseQueue,d=l.pending;if(d!==null){if(c!==null){var y=c.next;c.next=d.next,d.next=y}t.baseQueue=c=d,l.pending=null}if(d=e.baseState,c===null)e.memoizedState=d;else{t=c.next;var S=y=null,x=null,z=t,K=!1;do{var J=z.lane&-536870913;if(J!==z.lane?(Ne&J)===J:(Xa&J)===J){var H=z.revertLane;if(H===0)x!==null&&(x=x.next={lane:0,revertLane:0,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),J===gs&&(K=!0);else if((Xa&H)===H){z=z.next,H===gs&&(K=!0);continue}else J={lane:0,revertLane:z.revertLane,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},x===null?(S=x=J,y=d):x=x.next=J,Se.lanes|=H,ei|=H;J=z.action,Oi&&i(d,J),d=z.hasEagerState?z.eagerState:i(d,J)}else H={lane:J,revertLane:z.revertLane,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},x===null?(S=x=H,y=d):x=x.next=H,Se.lanes|=J,ei|=J;z=z.next}while(z!==null&&z!==t);if(x===null?y=d:x.next=S,!Wt(d,e.memoizedState)&&(St=!0,K&&(i=ys,i!==null)))throw i;e.memoizedState=d,e.baseState=y,e.baseQueue=x,l.lastRenderedState=d}return c===null&&(l.lanes=0),[e.memoizedState,l.dispatch]}function dd(e){var t=ct(),i=t.queue;if(i===null)throw Error(r(311));i.lastRenderedReducer=e;var l=i.dispatch,c=i.pending,d=t.memoizedState;if(c!==null){i.pending=null;var y=c=c.next;do d=e(d,y.action),y=y.next;while(y!==c);Wt(d,t.memoizedState)||(St=!0),t.memoizedState=d,t.baseQueue===null&&(t.baseState=d),i.lastRenderedState=d}return[d,l]}function Sp(e,t,i){var l=Se,c=ct(),d=De;if(d){if(i===void 0)throw Error(r(407));i=i()}else i=t();var y=!Wt((ze||c).memoizedState,i);y&&(c.memoizedState=i,St=!0),c=c.queue;var S=xp.bind(null,l,c,e);if(Nr(2048,8,S,[e]),c.getSnapshot!==t||y||ot!==null&&ot.memoizedState.tag&1){if(l.flags|=2048,Es(9,vo(),Mp.bind(null,l,c,i,t),null),$e===null)throw Error(r(349));d||(Xa&124)!==0||Ep(l,t,i)}return i}function Ep(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Se.updateQueue,t===null?(t=od(),Se.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function Mp(e,t,i,l){t.value=i,t.getSnapshot=l,wp(t)&&Ap(e)}function xp(e,t,i){return i(function(){wp(t)&&Ap(e)})}function wp(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!Wt(e,i)}catch{return!0}}function Ap(e){var t=fs(e,2);t!==null&&rn(t,e,2)}function fd(e){var t=Yt();if(typeof e=="function"){var i=e;if(e=i(),Oi){Gt(!0);try{i()}finally{Gt(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:e},t}function Cp(e,t,i,l){return e.baseState=i,ud(e,ze,typeof l=="function"?l:ga)}function H1(e,t,i,l,c){if(Eo(e))throw Error(r(485));if(e=t.action,e!==null){var d={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){d.listeners.push(y)}};D.T!==null?i(!0):d.isTransition=!1,l(d),i=t.pending,i===null?(d.next=t.pending=d,Tp(t,d)):(d.next=i.next,t.pending=i.next=d)}}function Tp(e,t){var i=t.action,l=t.payload,c=e.state;if(t.isTransition){var d=D.T,y={};D.T=y;try{var S=i(c,l),x=D.S;x!==null&&x(y,S),_p(e,t,S)}catch(z){hd(e,t,z)}finally{D.T=d}}else try{d=i(c,l),_p(e,t,d)}catch(z){hd(e,t,z)}}function _p(e,t,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(l){Rp(e,t,l)},function(l){return hd(e,t,l)}):Rp(e,t,i)}function Rp(e,t,i){t.status="fulfilled",t.value=i,Np(t),e.state=i,t=e.pending,t!==null&&(i=t.next,i===t?e.pending=null:(i=i.next,t.next=i,Tp(e,i)))}function hd(e,t,i){var l=e.pending;if(e.pending=null,l!==null){l=l.next;do t.status="rejected",t.reason=i,Np(t),t=t.next;while(t!==l)}e.action=null}function Np(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function kp(e,t){return t}function Dp(e,t){if(De){var i=$e.formState;if(i!==null){e:{var l=Se;if(De){if(at){t:{for(var c=at,d=Gn;c.nodeType!==8;){if(!d){c=null;break t}if(c=Cn(c.nextSibling),c===null){c=null;break t}}d=c.data,c=d==="F!"||d==="F"?c:null}if(c){at=Cn(c.nextSibling),l=c.data==="F!";break e}}ki(l)}l=!1}l&&(t=i[0])}}return i=Yt(),i.memoizedState=i.baseState=t,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:kp,lastRenderedState:t},i.queue=l,i=Zp.bind(null,Se,l),l.dispatch=i,l=fd(!1),d=bd.bind(null,Se,!1,l.queue),l=Yt(),c={state:t,dispatch:null,action:e,pending:null},l.queue=c,i=H1.bind(null,Se,c,d,i),c.dispatch=i,l.memoizedState=e,[t,i,!1]}function Lp(e){var t=ct();return Up(t,ze,e)}function Up(e,t,i){if(t=ud(e,t,kp)[0],e=bo(ga)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var l=Rr(t)}catch(y){throw y===xr?fo:y}else l=t;t=ct();var c=t.queue,d=c.dispatch;return i!==t.memoizedState&&(Se.flags|=2048,Es(9,vo(),j1.bind(null,c,i),null)),[l,d,e]}function j1(e,t){e.action=t}function Op(e){var t=ct(),i=ze;if(i!==null)return Up(t,i,e);ct(),t=t.memoizedState,i=ct();var l=i.queue.dispatch;return i.memoizedState=e,[t,l,!1]}function Es(e,t,i,l){return e={tag:e,create:i,deps:l,inst:t,next:null},t=Se.updateQueue,t===null&&(t=od(),Se.updateQueue=t),i=t.lastEffect,i===null?t.lastEffect=e.next=e:(l=i.next,i.next=e,e.next=l,t.lastEffect=e),e}function vo(){return{destroy:void 0,resource:void 0}}function qp(){return ct().memoizedState}function So(e,t,i,l){var c=Yt();l=l===void 0?null:l,Se.flags|=e,c.memoizedState=Es(1|t,vo(),i,l)}function Nr(e,t,i,l){var c=ct();l=l===void 0?null:l;var d=c.memoizedState.inst;ze!==null&&l!==null&&ad(l,ze.memoizedState.deps)?c.memoizedState=Es(t,d,i,l):(Se.flags|=e,c.memoizedState=Es(1|t,d,i,l))}function zp(e,t){So(8390656,8,e,t)}function Bp(e,t){Nr(2048,8,e,t)}function Hp(e,t){return Nr(4,2,e,t)}function jp(e,t){return Nr(4,4,e,t)}function Gp(e,t){if(typeof t=="function"){e=e();var i=t(e);return function(){typeof i=="function"?i():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Ip(e,t,i){i=i!=null?i.concat([e]):null,Nr(4,4,Gp.bind(null,t,e),i)}function md(){}function Yp(e,t){var i=ct();t=t===void 0?null:t;var l=i.memoizedState;return t!==null&&ad(t,l[1])?l[0]:(i.memoizedState=[e,t],e)}function Fp(e,t){var i=ct();t=t===void 0?null:t;var l=i.memoizedState;if(t!==null&&ad(t,l[1]))return l[0];if(l=e(),Oi){Gt(!0);try{e()}finally{Gt(!1)}}return i.memoizedState=[l,t],l}function pd(e,t,i){return i===void 0||(Xa&1073741824)!==0?e.memoizedState=t:(e.memoizedState=i,e=X0(),Se.lanes|=e,ei|=e,i)}function $p(e,t,i,l){return Wt(i,t)?i:bs.current!==null?(e=pd(e,i,l),Wt(e,t)||(St=!0),e):(Xa&42)===0?(St=!0,e.memoizedState=i):(e=X0(),Se.lanes|=e,ei|=e,t)}function Vp(e,t,i,l,c){var d=V.p;V.p=d!==0&&8>d?d:8;var y=D.T,S={};D.T=S,bd(e,!1,t,i);try{var x=c(),z=D.S;if(z!==null&&z(S,x),x!==null&&typeof x=="object"&&typeof x.then=="function"){var K=q1(x,l);kr(e,t,K,sn(e))}else kr(e,t,l,sn(e))}catch(J){kr(e,t,{then:function(){},status:"rejected",reason:J},sn())}finally{V.p=d,D.T=y}}function G1(){}function gd(e,t,i,l){if(e.tag!==5)throw Error(r(476));var c=Xp(e).queue;Vp(e,c,t,te,i===null?G1:function(){return Kp(e),i(l)})}function Xp(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:te},next:null};var i={};return t.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:i},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Kp(e){var t=Xp(e).next.queue;kr(e,t,{},sn())}function yd(){return Rt(Qr)}function Qp(){return ct().memoizedState}function Pp(){return ct().memoizedState}function I1(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var i=sn();e=$a(i);var l=Va(t,e,i);l!==null&&(rn(l,t,i),Ar(l,t,i)),t={cache:Xu()},e.payload=t;return}t=t.return}}function Y1(e,t,i){var l=sn();i={lane:l,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},Eo(e)?Jp(t,i):(i=zu(e,t,i,l),i!==null&&(rn(i,e,l),Wp(i,t,l)))}function Zp(e,t,i){var l=sn();kr(e,t,i,l)}function kr(e,t,i,l){var c={lane:l,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(Eo(e))Jp(t,c);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=t.lastRenderedReducer,d!==null))try{var y=t.lastRenderedState,S=d(y,i);if(c.hasEagerState=!0,c.eagerState=S,Wt(S,y))return ao(e,t,c,0),$e===null&&no(),!1}catch{}finally{}if(i=zu(e,t,c,l),i!==null)return rn(i,e,l),Wp(i,t,l),!0}return!1}function bd(e,t,i,l){if(l={lane:2,revertLane:Pd(),action:l,hasEagerState:!1,eagerState:null,next:null},Eo(e)){if(t)throw Error(r(479))}else t=zu(e,i,l,2),t!==null&&rn(t,e,2)}function Eo(e){var t=e.alternate;return e===Se||t!==null&&t===Se}function Jp(e,t){vs=po=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Wp(e,t,i){if((i&4194048)!==0){var l=t.lanes;l&=e.pendingLanes,i|=l,t.lanes=i,sr(e,i)}}var Mo={readContext:Rt,use:yo,useCallback:st,useContext:st,useEffect:st,useImperativeHandle:st,useLayoutEffect:st,useInsertionEffect:st,useMemo:st,useReducer:st,useRef:st,useState:st,useDebugValue:st,useDeferredValue:st,useTransition:st,useSyncExternalStore:st,useId:st,useHostTransitionStatus:st,useFormState:st,useActionState:st,useOptimistic:st,useMemoCache:st,useCacheRefresh:st},e0={readContext:Rt,use:yo,useCallback:function(e,t){return Yt().memoizedState=[e,t===void 0?null:t],e},useContext:Rt,useEffect:zp,useImperativeHandle:function(e,t,i){i=i!=null?i.concat([e]):null,So(4194308,4,Gp.bind(null,t,e),i)},useLayoutEffect:function(e,t){return So(4194308,4,e,t)},useInsertionEffect:function(e,t){So(4,2,e,t)},useMemo:function(e,t){var i=Yt();t=t===void 0?null:t;var l=e();if(Oi){Gt(!0);try{e()}finally{Gt(!1)}}return i.memoizedState=[l,t],l},useReducer:function(e,t,i){var l=Yt();if(i!==void 0){var c=i(t);if(Oi){Gt(!0);try{i(t)}finally{Gt(!1)}}}else c=t;return l.memoizedState=l.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},l.queue=e,e=e.dispatch=Y1.bind(null,Se,e),[l.memoizedState,e]},useRef:function(e){var t=Yt();return e={current:e},t.memoizedState=e},useState:function(e){e=fd(e);var t=e.queue,i=Zp.bind(null,Se,t);return t.dispatch=i,[e.memoizedState,i]},useDebugValue:md,useDeferredValue:function(e,t){var i=Yt();return pd(i,e,t)},useTransition:function(){var e=fd(!1);return e=Vp.bind(null,Se,e.queue,!0,!1),Yt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,i){var l=Se,c=Yt();if(De){if(i===void 0)throw Error(r(407));i=i()}else{if(i=t(),$e===null)throw Error(r(349));(Ne&124)!==0||Ep(l,t,i)}c.memoizedState=i;var d={value:i,getSnapshot:t};return c.queue=d,zp(xp.bind(null,l,d,e),[e]),l.flags|=2048,Es(9,vo(),Mp.bind(null,l,d,i,t),null),i},useId:function(){var e=Yt(),t=$e.identifierPrefix;if(De){var i=ha,l=fa;i=(l&~(1<<32-_t(l)-1)).toString(32)+i,t="«"+t+"R"+i,i=go++,0<i&&(t+="H"+i.toString(32)),t+="»"}else i=z1++,t="«"+t+"r"+i.toString(32)+"»";return e.memoizedState=t},useHostTransitionStatus:yd,useFormState:Dp,useActionState:Dp,useOptimistic:function(e){var t=Yt();t.memoizedState=t.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=i,t=bd.bind(null,Se,!0,i),i.dispatch=t,[e,t]},useMemoCache:cd,useCacheRefresh:function(){return Yt().memoizedState=I1.bind(null,Se)}},t0={readContext:Rt,use:yo,useCallback:Yp,useContext:Rt,useEffect:Bp,useImperativeHandle:Ip,useInsertionEffect:Hp,useLayoutEffect:jp,useMemo:Fp,useReducer:bo,useRef:qp,useState:function(){return bo(ga)},useDebugValue:md,useDeferredValue:function(e,t){var i=ct();return $p(i,ze.memoizedState,e,t)},useTransition:function(){var e=bo(ga)[0],t=ct().memoizedState;return[typeof e=="boolean"?e:Rr(e),t]},useSyncExternalStore:Sp,useId:Qp,useHostTransitionStatus:yd,useFormState:Lp,useActionState:Lp,useOptimistic:function(e,t){var i=ct();return Cp(i,ze,e,t)},useMemoCache:cd,useCacheRefresh:Pp},F1={readContext:Rt,use:yo,useCallback:Yp,useContext:Rt,useEffect:Bp,useImperativeHandle:Ip,useInsertionEffect:Hp,useLayoutEffect:jp,useMemo:Fp,useReducer:dd,useRef:qp,useState:function(){return dd(ga)},useDebugValue:md,useDeferredValue:function(e,t){var i=ct();return ze===null?pd(i,e,t):$p(i,ze.memoizedState,e,t)},useTransition:function(){var e=dd(ga)[0],t=ct().memoizedState;return[typeof e=="boolean"?e:Rr(e),t]},useSyncExternalStore:Sp,useId:Qp,useHostTransitionStatus:yd,useFormState:Op,useActionState:Op,useOptimistic:function(e,t){var i=ct();return ze!==null?Cp(i,ze,e,t):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:cd,useCacheRefresh:Pp},Ms=null,Dr=0;function xo(e){var t=Dr;return Dr+=1,Ms===null&&(Ms=[]),fp(Ms,e,t)}function Lr(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function wo(e,t){throw t.$$typeof===b?Error(r(525)):(e=Object.prototype.toString.call(t),Error(r(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function n0(e){var t=e._init;return t(e._payload)}function a0(e){function t(U,_){if(e){var O=U.deletions;O===null?(U.deletions=[_],U.flags|=16):O.push(_)}}function i(U,_){if(!e)return null;for(;_!==null;)t(U,_),_=_.sibling;return null}function l(U){for(var _=new Map;U!==null;)U.key!==null?_.set(U.key,U):_.set(U.index,U),U=U.sibling;return _}function c(U,_){return U=da(U,_),U.index=0,U.sibling=null,U}function d(U,_,O){return U.index=O,e?(O=U.alternate,O!==null?(O=O.index,O<_?(U.flags|=67108866,_):O):(U.flags|=67108866,_)):(U.flags|=1048576,_)}function y(U){return e&&U.alternate===null&&(U.flags|=67108866),U}function S(U,_,O,Z){return _===null||_.tag!==6?(_=Hu(O,U.mode,Z),_.return=U,_):(_=c(_,O),_.return=U,_)}function x(U,_,O,Z){var ue=O.type;return ue===M?K(U,_,O.props.children,Z,O.key):_!==null&&(_.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===le&&n0(ue)===_.type)?(_=c(_,O.props),Lr(_,O),_.return=U,_):(_=so(O.type,O.key,O.props,null,U.mode,Z),Lr(_,O),_.return=U,_)}function z(U,_,O,Z){return _===null||_.tag!==4||_.stateNode.containerInfo!==O.containerInfo||_.stateNode.implementation!==O.implementation?(_=ju(O,U.mode,Z),_.return=U,_):(_=c(_,O.children||[]),_.return=U,_)}function K(U,_,O,Z,ue){return _===null||_.tag!==7?(_=Ti(O,U.mode,Z,ue),_.return=U,_):(_=c(_,O),_.return=U,_)}function J(U,_,O){if(typeof _=="string"&&_!==""||typeof _=="number"||typeof _=="bigint")return _=Hu(""+_,U.mode,O),_.return=U,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case v:return O=so(_.type,_.key,_.props,null,U.mode,O),Lr(O,_),O.return=U,O;case E:return _=ju(_,U.mode,O),_.return=U,_;case le:var Z=_._init;return _=Z(_._payload),J(U,_,O)}if(B(_)||k(_))return _=Ti(_,U.mode,O,null),_.return=U,_;if(typeof _.then=="function")return J(U,xo(_),O);if(_.$$typeof===j)return J(U,co(U,_),O);wo(U,_)}return null}function H(U,_,O,Z){var ue=_!==null?_.key:null;if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return ue!==null?null:S(U,_,""+O,Z);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case v:return O.key===ue?x(U,_,O,Z):null;case E:return O.key===ue?z(U,_,O,Z):null;case le:return ue=O._init,O=ue(O._payload),H(U,_,O,Z)}if(B(O)||k(O))return ue!==null?null:K(U,_,O,Z,null);if(typeof O.then=="function")return H(U,_,xo(O),Z);if(O.$$typeof===j)return H(U,_,co(U,O),Z);wo(U,O)}return null}function G(U,_,O,Z,ue){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return U=U.get(O)||null,S(_,U,""+Z,ue);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case v:return U=U.get(Z.key===null?O:Z.key)||null,x(_,U,Z,ue);case E:return U=U.get(Z.key===null?O:Z.key)||null,z(_,U,Z,ue);case le:var Me=Z._init;return Z=Me(Z._payload),G(U,_,O,Z,ue)}if(B(Z)||k(Z))return U=U.get(O)||null,K(_,U,Z,ue,null);if(typeof Z.then=="function")return G(U,_,O,xo(Z),ue);if(Z.$$typeof===j)return G(U,_,O,co(_,Z),ue);wo(_,Z)}return null}function be(U,_,O,Z){for(var ue=null,Me=null,me=_,ye=_=0,Mt=null;me!==null&&ye<O.length;ye++){me.index>ye?(Mt=me,me=null):Mt=me.sibling;var ke=H(U,me,O[ye],Z);if(ke===null){me===null&&(me=Mt);break}e&&me&&ke.alternate===null&&t(U,me),_=d(ke,_,ye),Me===null?ue=ke:Me.sibling=ke,Me=ke,me=Mt}if(ye===O.length)return i(U,me),De&&Ri(U,ye),ue;if(me===null){for(;ye<O.length;ye++)me=J(U,O[ye],Z),me!==null&&(_=d(me,_,ye),Me===null?ue=me:Me.sibling=me,Me=me);return De&&Ri(U,ye),ue}for(me=l(me);ye<O.length;ye++)Mt=G(me,U,ye,O[ye],Z),Mt!==null&&(e&&Mt.alternate!==null&&me.delete(Mt.key===null?ye:Mt.key),_=d(Mt,_,ye),Me===null?ue=Mt:Me.sibling=Mt,Me=Mt);return e&&me.forEach(function(ci){return t(U,ci)}),De&&Ri(U,ye),ue}function pe(U,_,O,Z){if(O==null)throw Error(r(151));for(var ue=null,Me=null,me=_,ye=_=0,Mt=null,ke=O.next();me!==null&&!ke.done;ye++,ke=O.next()){me.index>ye?(Mt=me,me=null):Mt=me.sibling;var ci=H(U,me,ke.value,Z);if(ci===null){me===null&&(me=Mt);break}e&&me&&ci.alternate===null&&t(U,me),_=d(ci,_,ye),Me===null?ue=ci:Me.sibling=ci,Me=ci,me=Mt}if(ke.done)return i(U,me),De&&Ri(U,ye),ue;if(me===null){for(;!ke.done;ye++,ke=O.next())ke=J(U,ke.value,Z),ke!==null&&(_=d(ke,_,ye),Me===null?ue=ke:Me.sibling=ke,Me=ke);return De&&Ri(U,ye),ue}for(me=l(me);!ke.done;ye++,ke=O.next())ke=G(me,U,ye,ke.value,Z),ke!==null&&(e&&ke.alternate!==null&&me.delete(ke.key===null?ye:ke.key),_=d(ke,_,ye),Me===null?ue=ke:Me.sibling=ke,Me=ke);return e&&me.forEach(function($S){return t(U,$S)}),De&&Ri(U,ye),ue}function He(U,_,O,Z){if(typeof O=="object"&&O!==null&&O.type===M&&O.key===null&&(O=O.props.children),typeof O=="object"&&O!==null){switch(O.$$typeof){case v:e:{for(var ue=O.key;_!==null;){if(_.key===ue){if(ue=O.type,ue===M){if(_.tag===7){i(U,_.sibling),Z=c(_,O.props.children),Z.return=U,U=Z;break e}}else if(_.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===le&&n0(ue)===_.type){i(U,_.sibling),Z=c(_,O.props),Lr(Z,O),Z.return=U,U=Z;break e}i(U,_);break}else t(U,_);_=_.sibling}O.type===M?(Z=Ti(O.props.children,U.mode,Z,O.key),Z.return=U,U=Z):(Z=so(O.type,O.key,O.props,null,U.mode,Z),Lr(Z,O),Z.return=U,U=Z)}return y(U);case E:e:{for(ue=O.key;_!==null;){if(_.key===ue)if(_.tag===4&&_.stateNode.containerInfo===O.containerInfo&&_.stateNode.implementation===O.implementation){i(U,_.sibling),Z=c(_,O.children||[]),Z.return=U,U=Z;break e}else{i(U,_);break}else t(U,_);_=_.sibling}Z=ju(O,U.mode,Z),Z.return=U,U=Z}return y(U);case le:return ue=O._init,O=ue(O._payload),He(U,_,O,Z)}if(B(O))return be(U,_,O,Z);if(k(O)){if(ue=k(O),typeof ue!="function")throw Error(r(150));return O=ue.call(O),pe(U,_,O,Z)}if(typeof O.then=="function")return He(U,_,xo(O),Z);if(O.$$typeof===j)return He(U,_,co(U,O),Z);wo(U,O)}return typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint"?(O=""+O,_!==null&&_.tag===6?(i(U,_.sibling),Z=c(_,O),Z.return=U,U=Z):(i(U,_),Z=Hu(O,U.mode,Z),Z.return=U,U=Z),y(U)):i(U,_)}return function(U,_,O,Z){try{Dr=0;var ue=He(U,_,O,Z);return Ms=null,ue}catch(me){if(me===xr||me===fo)throw me;var Me=en(29,me,null,U.mode);return Me.lanes=Z,Me.return=U,Me}finally{}}}var xs=a0(!0),i0=a0(!1),gn=$(null),In=null;function Ka(e){var t=e.alternate;ae(ht,ht.current&1),ae(gn,e),In===null&&(t===null||bs.current!==null||t.memoizedState!==null)&&(In=e)}function s0(e){if(e.tag===22){if(ae(ht,ht.current),ae(gn,e),In===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(In=e)}}else Qa()}function Qa(){ae(ht,ht.current),ae(gn,gn.current)}function ya(e){W(gn),In===e&&(In=null),W(ht)}var ht=$(0);function Ao(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||cf(i)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function vd(e,t,i,l){t=e.memoizedState,i=i(l,t),i=i==null?t:g({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Sd={enqueueSetState:function(e,t,i){e=e._reactInternals;var l=sn(),c=$a(l);c.payload=t,i!=null&&(c.callback=i),t=Va(e,c,l),t!==null&&(rn(t,e,l),Ar(t,e,l))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var l=sn(),c=$a(l);c.tag=1,c.payload=t,i!=null&&(c.callback=i),t=Va(e,c,l),t!==null&&(rn(t,e,l),Ar(t,e,l))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=sn(),l=$a(i);l.tag=2,t!=null&&(l.callback=t),t=Va(e,l,i),t!==null&&(rn(t,e,i),Ar(t,e,i))}};function r0(e,t,i,l,c,d,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,d,y):t.prototype&&t.prototype.isPureReactComponent?!pr(i,l)||!pr(c,d):!0}function l0(e,t,i,l){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,l),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,l),t.state!==e&&Sd.enqueueReplaceState(t,t.state,null)}function qi(e,t){var i=t;if("ref"in t){i={};for(var l in t)l!=="ref"&&(i[l]=t[l])}if(e=e.defaultProps){i===t&&(i=g({},i));for(var c in e)i[c]===void 0&&(i[c]=e[c])}return i}var Co=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function o0(e){Co(e)}function c0(e){console.error(e)}function u0(e){Co(e)}function To(e,t){try{var i=e.onUncaughtError;i(t.value,{componentStack:t.stack})}catch(l){setTimeout(function(){throw l})}}function d0(e,t,i){try{var l=e.onCaughtError;l(i.value,{componentStack:i.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Ed(e,t,i){return i=$a(i),i.tag=3,i.payload={element:null},i.callback=function(){To(e,t)},i}function f0(e){return e=$a(e),e.tag=3,e}function h0(e,t,i,l){var c=i.type.getDerivedStateFromError;if(typeof c=="function"){var d=l.value;e.payload=function(){return c(d)},e.callback=function(){d0(t,i,l)}}var y=i.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){d0(t,i,l),typeof c!="function"&&(ti===null?ti=new Set([this]):ti.add(this));var S=l.stack;this.componentDidCatch(l.value,{componentStack:S!==null?S:""})})}function $1(e,t,i,l,c){if(i.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(t=i.alternate,t!==null&&Sr(t,i,c,!0),i=gn.current,i!==null){switch(i.tag){case 13:return In===null?$d():i.alternate===null&&it===0&&(it=3),i.flags&=-257,i.flags|=65536,i.lanes=c,l===Pu?i.flags|=16384:(t=i.updateQueue,t===null?i.updateQueue=new Set([l]):t.add(l),Xd(e,l,c)),!1;case 22:return i.flags|=65536,l===Pu?i.flags|=16384:(t=i.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([l])},i.updateQueue=t):(i=t.retryQueue,i===null?t.retryQueue=new Set([l]):i.add(l)),Xd(e,l,c)),!1}throw Error(r(435,i.tag))}return Xd(e,l,c),$d(),!1}if(De)return t=gn.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=c,l!==Yu&&(e=Error(r(422),{cause:l}),vr(fn(e,i)))):(l!==Yu&&(t=Error(r(423),{cause:l}),vr(fn(t,i))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,l=fn(l,i),c=Ed(e.stateNode,l,c),Wu(e,c),it!==4&&(it=2)),!1;var d=Error(r(520),{cause:l});if(d=fn(d,i),jr===null?jr=[d]:jr.push(d),it!==4&&(it=2),t===null)return!0;l=fn(l,i),i=t;do{switch(i.tag){case 3:return i.flags|=65536,e=c&-c,i.lanes|=e,e=Ed(i.stateNode,l,e),Wu(i,e),!1;case 1:if(t=i.type,d=i.stateNode,(i.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(ti===null||!ti.has(d))))return i.flags|=65536,c&=-c,i.lanes|=c,c=f0(c),h0(c,e,i,l),Wu(i,c),!1}i=i.return}while(i!==null);return!1}var m0=Error(r(461)),St=!1;function wt(e,t,i,l){t.child=e===null?i0(t,null,i,l):xs(t,e.child,i,l)}function p0(e,t,i,l,c){i=i.render;var d=t.ref;if("ref"in l){var y={};for(var S in l)S!=="ref"&&(y[S]=l[S])}else y=l;return Li(t),l=id(e,t,i,y,d,c),S=sd(),e!==null&&!St?(rd(e,t,c),ba(e,t,c)):(De&&S&&Gu(t),t.flags|=1,wt(e,t,l,c),t.child)}function g0(e,t,i,l,c){if(e===null){var d=i.type;return typeof d=="function"&&!Bu(d)&&d.defaultProps===void 0&&i.compare===null?(t.tag=15,t.type=d,y0(e,t,d,l,c)):(e=so(i.type,null,l,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(d=e.child,!Rd(e,c)){var y=d.memoizedProps;if(i=i.compare,i=i!==null?i:pr,i(y,l)&&e.ref===t.ref)return ba(e,t,c)}return t.flags|=1,e=da(d,l),e.ref=t.ref,e.return=t,t.child=e}function y0(e,t,i,l,c){if(e!==null){var d=e.memoizedProps;if(pr(d,l)&&e.ref===t.ref)if(St=!1,t.pendingProps=l=d,Rd(e,c))(e.flags&131072)!==0&&(St=!0);else return t.lanes=e.lanes,ba(e,t,c)}return Md(e,t,i,l,c)}function b0(e,t,i){var l=t.pendingProps,c=l.children,d=e!==null?e.memoizedState:null;if(l.mode==="hidden"){if((t.flags&128)!==0){if(l=d!==null?d.baseLanes|i:i,e!==null){for(c=t.child=e.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;t.childLanes=d&~l}else t.childLanes=0,t.child=null;return v0(e,t,l,i)}if((i&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&uo(t,d!==null?d.cachePool:null),d!==null?yp(t,d):td(),s0(t);else return t.lanes=t.childLanes=536870912,v0(e,t,d!==null?d.baseLanes|i:i,i)}else d!==null?(uo(t,d.cachePool),yp(t,d),Qa(),t.memoizedState=null):(e!==null&&uo(t,null),td(),Qa());return wt(e,t,c,i),t.child}function v0(e,t,i,l){var c=Qu();return c=c===null?null:{parent:ft._currentValue,pool:c},t.memoizedState={baseLanes:i,cachePool:c},e!==null&&uo(t,null),td(),s0(t),e!==null&&Sr(e,t,l,!0),null}function _o(e,t){var i=t.ref;if(i===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(r(284));(e===null||e.ref!==i)&&(t.flags|=4194816)}}function Md(e,t,i,l,c){return Li(t),i=id(e,t,i,l,void 0,c),l=sd(),e!==null&&!St?(rd(e,t,c),ba(e,t,c)):(De&&l&&Gu(t),t.flags|=1,wt(e,t,i,c),t.child)}function S0(e,t,i,l,c,d){return Li(t),t.updateQueue=null,i=vp(t,l,i,c),bp(e),l=sd(),e!==null&&!St?(rd(e,t,d),ba(e,t,d)):(De&&l&&Gu(t),t.flags|=1,wt(e,t,i,d),t.child)}function E0(e,t,i,l,c){if(Li(t),t.stateNode===null){var d=hs,y=i.contextType;typeof y=="object"&&y!==null&&(d=Rt(y)),d=new i(l,d),t.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Sd,t.stateNode=d,d._reactInternals=t,d=t.stateNode,d.props=l,d.state=t.memoizedState,d.refs={},Zu(t),y=i.contextType,d.context=typeof y=="object"&&y!==null?Rt(y):hs,d.state=t.memoizedState,y=i.getDerivedStateFromProps,typeof y=="function"&&(vd(t,i,y,l),d.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(y=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),y!==d.state&&Sd.enqueueReplaceState(d,d.state,null),Tr(t,l,d,c),Cr(),d.state=t.memoizedState),typeof d.componentDidMount=="function"&&(t.flags|=4194308),l=!0}else if(e===null){d=t.stateNode;var S=t.memoizedProps,x=qi(i,S);d.props=x;var z=d.context,K=i.contextType;y=hs,typeof K=="object"&&K!==null&&(y=Rt(K));var J=i.getDerivedStateFromProps;K=typeof J=="function"||typeof d.getSnapshotBeforeUpdate=="function",S=t.pendingProps!==S,K||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(S||z!==y)&&l0(t,d,l,y),Fa=!1;var H=t.memoizedState;d.state=H,Tr(t,l,d,c),Cr(),z=t.memoizedState,S||H!==z||Fa?(typeof J=="function"&&(vd(t,i,J,l),z=t.memoizedState),(x=Fa||r0(t,i,x,l,H,z,y))?(K||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=l,t.memoizedState=z),d.props=l,d.state=z,d.context=y,l=x):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),l=!1)}else{d=t.stateNode,Ju(e,t),y=t.memoizedProps,K=qi(i,y),d.props=K,J=t.pendingProps,H=d.context,z=i.contextType,x=hs,typeof z=="object"&&z!==null&&(x=Rt(z)),S=i.getDerivedStateFromProps,(z=typeof S=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(y!==J||H!==x)&&l0(t,d,l,x),Fa=!1,H=t.memoizedState,d.state=H,Tr(t,l,d,c),Cr();var G=t.memoizedState;y!==J||H!==G||Fa||e!==null&&e.dependencies!==null&&oo(e.dependencies)?(typeof S=="function"&&(vd(t,i,S,l),G=t.memoizedState),(K=Fa||r0(t,i,K,l,H,G,x)||e!==null&&e.dependencies!==null&&oo(e.dependencies))?(z||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(l,G,x),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(l,G,x)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(t.flags|=1024),t.memoizedProps=l,t.memoizedState=G),d.props=l,d.state=G,d.context=x,l=K):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(t.flags|=1024),l=!1)}return d=l,_o(e,t),l=(t.flags&128)!==0,d||l?(d=t.stateNode,i=l&&typeof i.getDerivedStateFromError!="function"?null:d.render(),t.flags|=1,e!==null&&l?(t.child=xs(t,e.child,null,c),t.child=xs(t,null,i,c)):wt(e,t,i,c),t.memoizedState=d.state,e=t.child):e=ba(e,t,c),e}function M0(e,t,i,l){return br(),t.flags|=256,wt(e,t,i,l),t.child}var xd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function wd(e){return{baseLanes:e,cachePool:cp()}}function Ad(e,t,i){return e=e!==null?e.childLanes&~i:0,t&&(e|=yn),e}function x0(e,t,i){var l=t.pendingProps,c=!1,d=(t.flags&128)!==0,y;if((y=d)||(y=e!==null&&e.memoizedState===null?!1:(ht.current&2)!==0),y&&(c=!0,t.flags&=-129),y=(t.flags&32)!==0,t.flags&=-33,e===null){if(De){if(c?Ka(t):Qa(),De){var S=at,x;if(x=S){e:{for(x=S,S=Gn;x.nodeType!==8;){if(!S){S=null;break e}if(x=Cn(x.nextSibling),x===null){S=null;break e}}S=x}S!==null?(t.memoizedState={dehydrated:S,treeContext:_i!==null?{id:fa,overflow:ha}:null,retryLane:536870912,hydrationErrors:null},x=en(18,null,null,0),x.stateNode=S,x.return=t,t.child=x,Ot=t,at=null,x=!0):x=!1}x||ki(t)}if(S=t.memoizedState,S!==null&&(S=S.dehydrated,S!==null))return cf(S)?t.lanes=32:t.lanes=536870912,null;ya(t)}return S=l.children,l=l.fallback,c?(Qa(),c=t.mode,S=Ro({mode:"hidden",children:S},c),l=Ti(l,c,i,null),S.return=t,l.return=t,S.sibling=l,t.child=S,c=t.child,c.memoizedState=wd(i),c.childLanes=Ad(e,y,i),t.memoizedState=xd,l):(Ka(t),Cd(t,S))}if(x=e.memoizedState,x!==null&&(S=x.dehydrated,S!==null)){if(d)t.flags&256?(Ka(t),t.flags&=-257,t=Td(e,t,i)):t.memoizedState!==null?(Qa(),t.child=e.child,t.flags|=128,t=null):(Qa(),c=l.fallback,S=t.mode,l=Ro({mode:"visible",children:l.children},S),c=Ti(c,S,i,null),c.flags|=2,l.return=t,c.return=t,l.sibling=c,t.child=l,xs(t,e.child,null,i),l=t.child,l.memoizedState=wd(i),l.childLanes=Ad(e,y,i),t.memoizedState=xd,t=c);else if(Ka(t),cf(S)){if(y=S.nextSibling&&S.nextSibling.dataset,y)var z=y.dgst;y=z,l=Error(r(419)),l.stack="",l.digest=y,vr({value:l,source:null,stack:null}),t=Td(e,t,i)}else if(St||Sr(e,t,i,!1),y=(i&e.childLanes)!==0,St||y){if(y=$e,y!==null&&(l=i&-i,l=(l&42)!==0?1:rr(l),l=(l&(y.suspendedLanes|i))!==0?0:l,l!==0&&l!==x.retryLane))throw x.retryLane=l,fs(e,l),rn(y,e,l),m0;S.data==="$?"||$d(),t=Td(e,t,i)}else S.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=x.treeContext,at=Cn(S.nextSibling),Ot=t,De=!0,Ni=null,Gn=!1,e!==null&&(mn[pn++]=fa,mn[pn++]=ha,mn[pn++]=_i,fa=e.id,ha=e.overflow,_i=t),t=Cd(t,l.children),t.flags|=4096);return t}return c?(Qa(),c=l.fallback,S=t.mode,x=e.child,z=x.sibling,l=da(x,{mode:"hidden",children:l.children}),l.subtreeFlags=x.subtreeFlags&65011712,z!==null?c=da(z,c):(c=Ti(c,S,i,null),c.flags|=2),c.return=t,l.return=t,l.sibling=c,t.child=l,l=c,c=t.child,S=e.child.memoizedState,S===null?S=wd(i):(x=S.cachePool,x!==null?(z=ft._currentValue,x=x.parent!==z?{parent:z,pool:z}:x):x=cp(),S={baseLanes:S.baseLanes|i,cachePool:x}),c.memoizedState=S,c.childLanes=Ad(e,y,i),t.memoizedState=xd,l):(Ka(t),i=e.child,e=i.sibling,i=da(i,{mode:"visible",children:l.children}),i.return=t,i.sibling=null,e!==null&&(y=t.deletions,y===null?(t.deletions=[e],t.flags|=16):y.push(e)),t.child=i,t.memoizedState=null,i)}function Cd(e,t){return t=Ro({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Ro(e,t){return e=en(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Td(e,t,i){return xs(t,e.child,null,i),e=Cd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function w0(e,t,i){e.lanes|=t;var l=e.alternate;l!==null&&(l.lanes|=t),$u(e.return,t,i)}function _d(e,t,i,l,c){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:l,tail:i,tailMode:c}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=l,d.tail=i,d.tailMode=c)}function A0(e,t,i){var l=t.pendingProps,c=l.revealOrder,d=l.tail;if(wt(e,t,l.children,i),l=ht.current,(l&2)!==0)l=l&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&w0(e,i,t);else if(e.tag===19)w0(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}l&=1}switch(ae(ht,l),c){case"forwards":for(i=t.child,c=null;i!==null;)e=i.alternate,e!==null&&Ao(e)===null&&(c=i),i=i.sibling;i=c,i===null?(c=t.child,t.child=null):(c=i.sibling,i.sibling=null),_d(t,!1,c,i,d);break;case"backwards":for(i=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&Ao(e)===null){t.child=c;break}e=c.sibling,c.sibling=i,i=c,c=e}_d(t,!0,i,null,d);break;case"together":_d(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ba(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),ei|=t.lanes,(i&t.childLanes)===0)if(e!==null){if(Sr(e,t,i,!1),(i&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(r(153));if(t.child!==null){for(e=t.child,i=da(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=da(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function Rd(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&oo(e)))}function V1(e,t,i){switch(t.tag){case 3:xe(t,t.stateNode.containerInfo),Ya(t,ft,e.memoizedState.cache),br();break;case 27:case 5:on(t);break;case 4:xe(t,t.stateNode.containerInfo);break;case 10:Ya(t,t.type,t.memoizedProps.value);break;case 13:var l=t.memoizedState;if(l!==null)return l.dehydrated!==null?(Ka(t),t.flags|=128,null):(i&t.child.childLanes)!==0?x0(e,t,i):(Ka(t),e=ba(e,t,i),e!==null?e.sibling:null);Ka(t);break;case 19:var c=(e.flags&128)!==0;if(l=(i&t.childLanes)!==0,l||(Sr(e,t,i,!1),l=(i&t.childLanes)!==0),c){if(l)return A0(e,t,i);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),ae(ht,ht.current),l)break;return null;case 22:case 23:return t.lanes=0,b0(e,t,i);case 24:Ya(t,ft,e.memoizedState.cache)}return ba(e,t,i)}function C0(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps)St=!0;else{if(!Rd(e,i)&&(t.flags&128)===0)return St=!1,V1(e,t,i);St=(e.flags&131072)!==0}else St=!1,De&&(t.flags&1048576)!==0&&np(t,lo,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var l=t.elementType,c=l._init;if(l=c(l._payload),t.type=l,typeof l=="function")Bu(l)?(e=qi(l,e),t.tag=1,t=E0(null,t,l,e,i)):(t.tag=0,t=Md(null,t,l,e,i));else{if(l!=null){if(c=l.$$typeof,c===F){t.tag=11,t=p0(null,t,l,e,i);break e}else if(c===ee){t.tag=14,t=g0(null,t,l,e,i);break e}}throw t=Y(l)||l,Error(r(306,t,""))}}return t;case 0:return Md(e,t,t.type,t.pendingProps,i);case 1:return l=t.type,c=qi(l,t.pendingProps),E0(e,t,l,c,i);case 3:e:{if(xe(t,t.stateNode.containerInfo),e===null)throw Error(r(387));l=t.pendingProps;var d=t.memoizedState;c=d.element,Ju(e,t),Tr(t,l,null,i);var y=t.memoizedState;if(l=y.cache,Ya(t,ft,l),l!==d.cache&&Vu(t,[ft],i,!0),Cr(),l=y.element,d.isDehydrated)if(d={element:l,isDehydrated:!1,cache:y.cache},t.updateQueue.baseState=d,t.memoizedState=d,t.flags&256){t=M0(e,t,l,i);break e}else if(l!==c){c=fn(Error(r(424)),t),vr(c),t=M0(e,t,l,i);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(at=Cn(e.firstChild),Ot=t,De=!0,Ni=null,Gn=!0,i=i0(t,null,l,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(br(),l===c){t=ba(e,t,i);break e}wt(e,t,l,i)}t=t.child}return t;case 26:return _o(e,t),e===null?(i=Ng(t.type,null,t.pendingProps,null))?t.memoizedState=i:De||(i=t.type,e=t.pendingProps,l=Yo(de.current).createElement(i),l[We]=t,l[ut]=e,Ct(l,i,e),et(l),t.stateNode=l):t.memoizedState=Ng(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return on(t),e===null&&De&&(l=t.stateNode=Tg(t.type,t.pendingProps,de.current),Ot=t,Gn=!0,c=at,ii(t.type)?(uf=c,at=Cn(l.firstChild)):at=c),wt(e,t,t.pendingProps.children,i),_o(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&De&&((c=l=at)&&(l=SS(l,t.type,t.pendingProps,Gn),l!==null?(t.stateNode=l,Ot=t,at=Cn(l.firstChild),Gn=!1,c=!0):c=!1),c||ki(t)),on(t),c=t.type,d=t.pendingProps,y=e!==null?e.memoizedProps:null,l=d.children,rf(c,d)?l=null:y!==null&&rf(c,y)&&(t.flags|=32),t.memoizedState!==null&&(c=id(e,t,B1,null,null,i),Qr._currentValue=c),_o(e,t),wt(e,t,l,i),t.child;case 6:return e===null&&De&&((e=i=at)&&(i=ES(i,t.pendingProps,Gn),i!==null?(t.stateNode=i,Ot=t,at=null,e=!0):e=!1),e||ki(t)),null;case 13:return x0(e,t,i);case 4:return xe(t,t.stateNode.containerInfo),l=t.pendingProps,e===null?t.child=xs(t,null,l,i):wt(e,t,l,i),t.child;case 11:return p0(e,t,t.type,t.pendingProps,i);case 7:return wt(e,t,t.pendingProps,i),t.child;case 8:return wt(e,t,t.pendingProps.children,i),t.child;case 12:return wt(e,t,t.pendingProps.children,i),t.child;case 10:return l=t.pendingProps,Ya(t,t.type,l.value),wt(e,t,l.children,i),t.child;case 9:return c=t.type._context,l=t.pendingProps.children,Li(t),c=Rt(c),l=l(c),t.flags|=1,wt(e,t,l,i),t.child;case 14:return g0(e,t,t.type,t.pendingProps,i);case 15:return y0(e,t,t.type,t.pendingProps,i);case 19:return A0(e,t,i);case 31:return l=t.pendingProps,i=t.mode,l={mode:l.mode,children:l.children},e===null?(i=Ro(l,i),i.ref=t.ref,t.child=i,i.return=t,t=i):(i=da(e.child,l),i.ref=t.ref,t.child=i,i.return=t,t=i),t;case 22:return b0(e,t,i);case 24:return Li(t),l=Rt(ft),e===null?(c=Qu(),c===null&&(c=$e,d=Xu(),c.pooledCache=d,d.refCount++,d!==null&&(c.pooledCacheLanes|=i),c=d),t.memoizedState={parent:l,cache:c},Zu(t),Ya(t,ft,c)):((e.lanes&i)!==0&&(Ju(e,t),Tr(t,null,null,i),Cr()),c=e.memoizedState,d=t.memoizedState,c.parent!==l?(c={parent:l,cache:l},t.memoizedState=c,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=c),Ya(t,ft,l)):(l=d.cache,Ya(t,ft,l),l!==c.cache&&Vu(t,[ft],i,!0))),wt(e,t,t.pendingProps.children,i),t.child;case 29:throw t.pendingProps}throw Error(r(156,t.tag))}function va(e){e.flags|=4}function T0(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Og(t)){if(t=gn.current,t!==null&&((Ne&4194048)===Ne?In!==null:(Ne&62914560)!==Ne&&(Ne&536870912)===0||t!==In))throw wr=Pu,up;e.flags|=8192}}function No(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?Bl():536870912,e.lanes|=t,Ts|=t)}function Ur(e,t){if(!De)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function Pe(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,l=0;if(t)for(var c=e.child;c!==null;)i|=c.lanes|c.childLanes,l|=c.subtreeFlags&65011712,l|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)i|=c.lanes|c.childLanes,l|=c.subtreeFlags,l|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=l,e.childLanes=i,t}function X1(e,t,i){var l=t.pendingProps;switch(Iu(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pe(t),null;case 1:return Pe(t),null;case 3:return i=t.stateNode,l=null,e!==null&&(l=e.memoizedState.cache),t.memoizedState.cache!==l&&(t.flags|=2048),pa(ft),xt(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(yr(t)?va(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,sp())),Pe(t),null;case 26:return i=t.memoizedState,e===null?(va(t),i!==null?(Pe(t),T0(t,i)):(Pe(t),t.flags&=-16777217)):i?i!==e.memoizedState?(va(t),Pe(t),T0(t,i)):(Pe(t),t.flags&=-16777217):(e.memoizedProps!==l&&va(t),Pe(t),t.flags&=-16777217),null;case 27:cn(t),i=de.current;var c=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==l&&va(t);else{if(!l){if(t.stateNode===null)throw Error(r(166));return Pe(t),null}e=oe.current,yr(t)?ap(t):(e=Tg(c,l,i),t.stateNode=e,va(t))}return Pe(t),null;case 5:if(cn(t),i=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==l&&va(t);else{if(!l){if(t.stateNode===null)throw Error(r(166));return Pe(t),null}if(e=oe.current,yr(t))ap(t);else{switch(c=Yo(de.current),e){case 1:e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof l.is=="string"?c.createElement("select",{is:l.is}):c.createElement("select"),l.multiple?e.multiple=!0:l.size&&(e.size=l.size);break;default:e=typeof l.is=="string"?c.createElement(i,{is:l.is}):c.createElement(i)}}e[We]=t,e[ut]=l;e:for(c=t.child;c!==null;){if(c.tag===5||c.tag===6)e.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===t)break e;for(;c.sibling===null;){if(c.return===null||c.return===t)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}t.stateNode=e;e:switch(Ct(e,i,l),i){case"button":case"input":case"select":case"textarea":e=!!l.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&va(t)}}return Pe(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==l&&va(t);else{if(typeof l!="string"&&t.stateNode===null)throw Error(r(166));if(e=de.current,yr(t)){if(e=t.stateNode,i=t.memoizedProps,l=null,c=Ot,c!==null)switch(c.tag){case 27:case 5:l=c.memoizedProps}e[We]=t,e=!!(e.nodeValue===i||l!==null&&l.suppressHydrationWarning===!0||Sg(e.nodeValue,i)),e||ki(t)}else e=Yo(e).createTextNode(l),e[We]=t,t.stateNode=e}return Pe(t),null;case 13:if(l=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=yr(t),l!==null&&l.dehydrated!==null){if(e===null){if(!c)throw Error(r(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));c[We]=t}else br(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Pe(t),c=!1}else c=sp(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return t.flags&256?(ya(t),t):(ya(t),null)}if(ya(t),(t.flags&128)!==0)return t.lanes=i,t;if(i=l!==null,e=e!==null&&e.memoizedState!==null,i){l=t.child,c=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(c=l.alternate.memoizedState.cachePool.pool);var d=null;l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(d=l.memoizedState.cachePool.pool),d!==c&&(l.flags|=2048)}return i!==e&&i&&(t.child.flags|=8192),No(t,t.updateQueue),Pe(t),null;case 4:return xt(),e===null&&ef(t.stateNode.containerInfo),Pe(t),null;case 10:return pa(t.type),Pe(t),null;case 19:if(W(ht),c=t.memoizedState,c===null)return Pe(t),null;if(l=(t.flags&128)!==0,d=c.rendering,d===null)if(l)Ur(c,!1);else{if(it!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(d=Ao(e),d!==null){for(t.flags|=128,Ur(c,!1),e=d.updateQueue,t.updateQueue=e,No(t,e),t.subtreeFlags=0,e=i,i=t.child;i!==null;)tp(i,e),i=i.sibling;return ae(ht,ht.current&1|2),t.child}e=e.sibling}c.tail!==null&&ce()>Lo&&(t.flags|=128,l=!0,Ur(c,!1),t.lanes=4194304)}else{if(!l)if(e=Ao(d),e!==null){if(t.flags|=128,l=!0,e=e.updateQueue,t.updateQueue=e,No(t,e),Ur(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!De)return Pe(t),null}else 2*ce()-c.renderingStartTime>Lo&&i!==536870912&&(t.flags|=128,l=!0,Ur(c,!1),t.lanes=4194304);c.isBackwards?(d.sibling=t.child,t.child=d):(e=c.last,e!==null?e.sibling=d:t.child=d,c.last=d)}return c.tail!==null?(t=c.tail,c.rendering=t,c.tail=t.sibling,c.renderingStartTime=ce(),t.sibling=null,e=ht.current,ae(ht,l?e&1|2:e&1),t):(Pe(t),null);case 22:case 23:return ya(t),nd(),l=t.memoizedState!==null,e!==null?e.memoizedState!==null!==l&&(t.flags|=8192):l&&(t.flags|=8192),l?(i&536870912)!==0&&(t.flags&128)===0&&(Pe(t),t.subtreeFlags&6&&(t.flags|=8192)):Pe(t),i=t.updateQueue,i!==null&&No(t,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),l=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(l=t.memoizedState.cachePool.pool),l!==i&&(t.flags|=2048),e!==null&&W(Ui),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),pa(ft),Pe(t),null;case 25:return null;case 30:return null}throw Error(r(156,t.tag))}function K1(e,t){switch(Iu(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return pa(ft),xt(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return cn(t),null;case 13:if(ya(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(r(340));br()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return W(ht),null;case 4:return xt(),null;case 10:return pa(t.type),null;case 22:case 23:return ya(t),nd(),e!==null&&W(Ui),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return pa(ft),null;case 25:return null;default:return null}}function _0(e,t){switch(Iu(t),t.tag){case 3:pa(ft),xt();break;case 26:case 27:case 5:cn(t);break;case 4:xt();break;case 13:ya(t);break;case 19:W(ht);break;case 10:pa(t.type);break;case 22:case 23:ya(t),nd(),e!==null&&W(Ui);break;case 24:pa(ft)}}function Or(e,t){try{var i=t.updateQueue,l=i!==null?i.lastEffect:null;if(l!==null){var c=l.next;i=c;do{if((i.tag&e)===e){l=void 0;var d=i.create,y=i.inst;l=d(),y.destroy=l}i=i.next}while(i!==c)}}catch(S){Ye(t,t.return,S)}}function Pa(e,t,i){try{var l=t.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var d=c.next;l=d;do{if((l.tag&e)===e){var y=l.inst,S=y.destroy;if(S!==void 0){y.destroy=void 0,c=t;var x=i,z=S;try{z()}catch(K){Ye(c,x,K)}}}l=l.next}while(l!==d)}}catch(K){Ye(t,t.return,K)}}function R0(e){var t=e.updateQueue;if(t!==null){var i=e.stateNode;try{gp(t,i)}catch(l){Ye(e,e.return,l)}}}function N0(e,t,i){i.props=qi(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(l){Ye(e,t,l)}}function qr(e,t){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var l=e.stateNode;break;case 30:l=e.stateNode;break;default:l=e.stateNode}typeof i=="function"?e.refCleanup=i(l):i.current=l}}catch(c){Ye(e,t,c)}}function Yn(e,t){var i=e.ref,l=e.refCleanup;if(i!==null)if(typeof l=="function")try{l()}catch(c){Ye(e,t,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(c){Ye(e,t,c)}else i.current=null}function k0(e){var t=e.type,i=e.memoizedProps,l=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":i.autoFocus&&l.focus();break e;case"img":i.src?l.src=i.src:i.srcSet&&(l.srcset=i.srcSet)}}catch(c){Ye(e,e.return,c)}}function Nd(e,t,i){try{var l=e.stateNode;pS(l,e.type,i,t),l[ut]=t}catch(c){Ye(e,e.return,c)}}function D0(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&ii(e.type)||e.tag===4}function kd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||D0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&ii(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Dd(e,t,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,t):(t=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,t.appendChild(e),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=Io));else if(l!==4&&(l===27&&ii(e.type)&&(i=e.stateNode,t=null),e=e.child,e!==null))for(Dd(e,t,i),e=e.sibling;e!==null;)Dd(e,t,i),e=e.sibling}function ko(e,t,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(l!==4&&(l===27&&ii(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(ko(e,t,i),e=e.sibling;e!==null;)ko(e,t,i),e=e.sibling}function L0(e){var t=e.stateNode,i=e.memoizedProps;try{for(var l=e.type,c=t.attributes;c.length;)t.removeAttributeNode(c[0]);Ct(t,l,i),t[We]=e,t[ut]=i}catch(d){Ye(e,e.return,d)}}var Sa=!1,rt=!1,Ld=!1,U0=typeof WeakSet=="function"?WeakSet:Set,Et=null;function Q1(e,t){if(e=e.containerInfo,af=Qo,e=$m(e),ku(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var l=i.getSelection&&i.getSelection();if(l&&l.rangeCount!==0){i=l.anchorNode;var c=l.anchorOffset,d=l.focusNode;l=l.focusOffset;try{i.nodeType,d.nodeType}catch{i=null;break e}var y=0,S=-1,x=-1,z=0,K=0,J=e,H=null;t:for(;;){for(var G;J!==i||c!==0&&J.nodeType!==3||(S=y+c),J!==d||l!==0&&J.nodeType!==3||(x=y+l),J.nodeType===3&&(y+=J.nodeValue.length),(G=J.firstChild)!==null;)H=J,J=G;for(;;){if(J===e)break t;if(H===i&&++z===c&&(S=y),H===d&&++K===l&&(x=y),(G=J.nextSibling)!==null)break;J=H,H=J.parentNode}J=G}i=S===-1||x===-1?null:{start:S,end:x}}else i=null}i=i||{start:0,end:0}}else i=null;for(sf={focusedElem:e,selectionRange:i},Qo=!1,Et=t;Et!==null;)if(t=Et,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,Et=e;else for(;Et!==null;){switch(t=Et,d=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,i=t,c=d.memoizedProps,d=d.memoizedState,l=i.stateNode;try{var be=qi(i.type,c,i.elementType===i.type);e=l.getSnapshotBeforeUpdate(be,d),l.__reactInternalSnapshotBeforeUpdate=e}catch(pe){Ye(i,i.return,pe)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,i=e.nodeType,i===9)of(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":of(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(r(163))}if(e=t.sibling,e!==null){e.return=t.return,Et=e;break}Et=t.return}}function O0(e,t,i){var l=i.flags;switch(i.tag){case 0:case 11:case 15:Za(e,i),l&4&&Or(5,i);break;case 1:if(Za(e,i),l&4)if(e=i.stateNode,t===null)try{e.componentDidMount()}catch(y){Ye(i,i.return,y)}else{var c=qi(i.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(c,t,e.__reactInternalSnapshotBeforeUpdate)}catch(y){Ye(i,i.return,y)}}l&64&&R0(i),l&512&&qr(i,i.return);break;case 3:if(Za(e,i),l&64&&(e=i.updateQueue,e!==null)){if(t=null,i.child!==null)switch(i.child.tag){case 27:case 5:t=i.child.stateNode;break;case 1:t=i.child.stateNode}try{gp(e,t)}catch(y){Ye(i,i.return,y)}}break;case 27:t===null&&l&4&&L0(i);case 26:case 5:Za(e,i),t===null&&l&4&&k0(i),l&512&&qr(i,i.return);break;case 12:Za(e,i);break;case 13:Za(e,i),l&4&&B0(e,i),l&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=iS.bind(null,i),MS(e,i))));break;case 22:if(l=i.memoizedState!==null||Sa,!l){t=t!==null&&t.memoizedState!==null||rt,c=Sa;var d=rt;Sa=l,(rt=t)&&!d?Ja(e,i,(i.subtreeFlags&8772)!==0):Za(e,i),Sa=c,rt=d}break;case 30:break;default:Za(e,i)}}function q0(e){var t=e.alternate;t!==null&&(e.alternate=null,q0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&as(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ke=null,Ft=!1;function Ea(e,t,i){for(i=i.child;i!==null;)z0(e,t,i),i=i.sibling}function z0(e,t,i){if(Qe&&typeof Qe.onCommitFiberUnmount=="function")try{Qe.onCommitFiberUnmount(Xe,i)}catch{}switch(i.tag){case 26:rt||Yn(i,t),Ea(e,t,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:rt||Yn(i,t);var l=Ke,c=Ft;ii(i.type)&&(Ke=i.stateNode,Ft=!1),Ea(e,t,i),$r(i.stateNode),Ke=l,Ft=c;break;case 5:rt||Yn(i,t);case 6:if(l=Ke,c=Ft,Ke=null,Ea(e,t,i),Ke=l,Ft=c,Ke!==null)if(Ft)try{(Ke.nodeType===9?Ke.body:Ke.nodeName==="HTML"?Ke.ownerDocument.body:Ke).removeChild(i.stateNode)}catch(d){Ye(i,t,d)}else try{Ke.removeChild(i.stateNode)}catch(d){Ye(i,t,d)}break;case 18:Ke!==null&&(Ft?(e=Ke,Ag(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),Wr(e)):Ag(Ke,i.stateNode));break;case 4:l=Ke,c=Ft,Ke=i.stateNode.containerInfo,Ft=!0,Ea(e,t,i),Ke=l,Ft=c;break;case 0:case 11:case 14:case 15:rt||Pa(2,i,t),rt||Pa(4,i,t),Ea(e,t,i);break;case 1:rt||(Yn(i,t),l=i.stateNode,typeof l.componentWillUnmount=="function"&&N0(i,t,l)),Ea(e,t,i);break;case 21:Ea(e,t,i);break;case 22:rt=(l=rt)||i.memoizedState!==null,Ea(e,t,i),rt=l;break;default:Ea(e,t,i)}}function B0(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Wr(e)}catch(i){Ye(t,t.return,i)}}function P1(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new U0),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new U0),t;default:throw Error(r(435,e.tag))}}function Ud(e,t){var i=P1(e);t.forEach(function(l){var c=sS.bind(null,e,l);i.has(l)||(i.add(l),l.then(c,c))})}function tn(e,t){var i=t.deletions;if(i!==null)for(var l=0;l<i.length;l++){var c=i[l],d=e,y=t,S=y;e:for(;S!==null;){switch(S.tag){case 27:if(ii(S.type)){Ke=S.stateNode,Ft=!1;break e}break;case 5:Ke=S.stateNode,Ft=!1;break e;case 3:case 4:Ke=S.stateNode.containerInfo,Ft=!0;break e}S=S.return}if(Ke===null)throw Error(r(160));z0(d,y,c),Ke=null,Ft=!1,d=c.alternate,d!==null&&(d.return=null),c.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)H0(t,e),t=t.sibling}var An=null;function H0(e,t){var i=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:tn(t,e),nn(e),l&4&&(Pa(3,e,e.return),Or(3,e),Pa(5,e,e.return));break;case 1:tn(t,e),nn(e),l&512&&(rt||i===null||Yn(i,i.return)),l&64&&Sa&&(e=e.updateQueue,e!==null&&(l=e.callbacks,l!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?l:i.concat(l))));break;case 26:var c=An;if(tn(t,e),nn(e),l&512&&(rt||i===null||Yn(i,i.return)),l&4){var d=i!==null?i.memoizedState:null;if(l=e.memoizedState,i===null)if(l===null)if(e.stateNode===null){e:{l=e.type,i=e.memoizedProps,c=c.ownerDocument||c;t:switch(l){case"title":d=c.getElementsByTagName("title")[0],(!d||d[Si]||d[We]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=c.createElement(l),c.head.insertBefore(d,c.querySelector("head > title"))),Ct(d,l,i),d[We]=e,et(d),l=d;break e;case"link":var y=Lg("link","href",c).get(l+(i.href||""));if(y){for(var S=0;S<y.length;S++)if(d=y[S],d.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&d.getAttribute("rel")===(i.rel==null?null:i.rel)&&d.getAttribute("title")===(i.title==null?null:i.title)&&d.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){y.splice(S,1);break t}}d=c.createElement(l),Ct(d,l,i),c.head.appendChild(d);break;case"meta":if(y=Lg("meta","content",c).get(l+(i.content||""))){for(S=0;S<y.length;S++)if(d=y[S],d.getAttribute("content")===(i.content==null?null:""+i.content)&&d.getAttribute("name")===(i.name==null?null:i.name)&&d.getAttribute("property")===(i.property==null?null:i.property)&&d.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&d.getAttribute("charset")===(i.charSet==null?null:i.charSet)){y.splice(S,1);break t}}d=c.createElement(l),Ct(d,l,i),c.head.appendChild(d);break;default:throw Error(r(468,l))}d[We]=e,et(d),l=d}e.stateNode=l}else Ug(c,e.type,e.stateNode);else e.stateNode=Dg(c,l,e.memoizedProps);else d!==l?(d===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):d.count--,l===null?Ug(c,e.type,e.stateNode):Dg(c,l,e.memoizedProps)):l===null&&e.stateNode!==null&&Nd(e,e.memoizedProps,i.memoizedProps)}break;case 27:tn(t,e),nn(e),l&512&&(rt||i===null||Yn(i,i.return)),i!==null&&l&4&&Nd(e,e.memoizedProps,i.memoizedProps);break;case 5:if(tn(t,e),nn(e),l&512&&(rt||i===null||Yn(i,i.return)),e.flags&32){c=e.stateNode;try{ss(c,"")}catch(G){Ye(e,e.return,G)}}l&4&&e.stateNode!=null&&(c=e.memoizedProps,Nd(e,c,i!==null?i.memoizedProps:c)),l&1024&&(Ld=!0);break;case 6:if(tn(t,e),nn(e),l&4){if(e.stateNode===null)throw Error(r(162));l=e.memoizedProps,i=e.stateNode;try{i.nodeValue=l}catch(G){Ye(e,e.return,G)}}break;case 3:if(Vo=null,c=An,An=Fo(t.containerInfo),tn(t,e),An=c,nn(e),l&4&&i!==null&&i.memoizedState.isDehydrated)try{Wr(t.containerInfo)}catch(G){Ye(e,e.return,G)}Ld&&(Ld=!1,j0(e));break;case 4:l=An,An=Fo(e.stateNode.containerInfo),tn(t,e),nn(e),An=l;break;case 12:tn(t,e),nn(e);break;case 13:tn(t,e),nn(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(jd=ce()),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,Ud(e,l)));break;case 22:c=e.memoizedState!==null;var x=i!==null&&i.memoizedState!==null,z=Sa,K=rt;if(Sa=z||c,rt=K||x,tn(t,e),rt=K,Sa=z,nn(e),l&8192)e:for(t=e.stateNode,t._visibility=c?t._visibility&-2:t._visibility|1,c&&(i===null||x||Sa||rt||zi(e)),i=null,t=e;;){if(t.tag===5||t.tag===26){if(i===null){x=i=t;try{if(d=x.stateNode,c)y=d.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{S=x.stateNode;var J=x.memoizedProps.style,H=J!=null&&J.hasOwnProperty("display")?J.display:null;S.style.display=H==null||typeof H=="boolean"?"":(""+H).trim()}}catch(G){Ye(x,x.return,G)}}}else if(t.tag===6){if(i===null){x=t;try{x.stateNode.nodeValue=c?"":x.memoizedProps}catch(G){Ye(x,x.return,G)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;i===t&&(i=null),t=t.return}i===t&&(i=null),t.sibling.return=t.return,t=t.sibling}l&4&&(l=e.updateQueue,l!==null&&(i=l.retryQueue,i!==null&&(l.retryQueue=null,Ud(e,i))));break;case 19:tn(t,e),nn(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,Ud(e,l)));break;case 30:break;case 21:break;default:tn(t,e),nn(e)}}function nn(e){var t=e.flags;if(t&2){try{for(var i,l=e.return;l!==null;){if(D0(l)){i=l;break}l=l.return}if(i==null)throw Error(r(160));switch(i.tag){case 27:var c=i.stateNode,d=kd(e);ko(e,d,c);break;case 5:var y=i.stateNode;i.flags&32&&(ss(y,""),i.flags&=-33);var S=kd(e);ko(e,S,y);break;case 3:case 4:var x=i.stateNode.containerInfo,z=kd(e);Dd(e,z,x);break;default:throw Error(r(161))}}catch(K){Ye(e,e.return,K)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function j0(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;j0(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function Za(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)O0(e,t.alternate,t),t=t.sibling}function zi(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Pa(4,t,t.return),zi(t);break;case 1:Yn(t,t.return);var i=t.stateNode;typeof i.componentWillUnmount=="function"&&N0(t,t.return,i),zi(t);break;case 27:$r(t.stateNode);case 26:case 5:Yn(t,t.return),zi(t);break;case 22:t.memoizedState===null&&zi(t);break;case 30:zi(t);break;default:zi(t)}e=e.sibling}}function Ja(e,t,i){for(i=i&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var l=t.alternate,c=e,d=t,y=d.flags;switch(d.tag){case 0:case 11:case 15:Ja(c,d,i),Or(4,d);break;case 1:if(Ja(c,d,i),l=d,c=l.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(z){Ye(l,l.return,z)}if(l=d,c=l.updateQueue,c!==null){var S=l.stateNode;try{var x=c.shared.hiddenCallbacks;if(x!==null)for(c.shared.hiddenCallbacks=null,c=0;c<x.length;c++)pp(x[c],S)}catch(z){Ye(l,l.return,z)}}i&&y&64&&R0(d),qr(d,d.return);break;case 27:L0(d);case 26:case 5:Ja(c,d,i),i&&l===null&&y&4&&k0(d),qr(d,d.return);break;case 12:Ja(c,d,i);break;case 13:Ja(c,d,i),i&&y&4&&B0(c,d);break;case 22:d.memoizedState===null&&Ja(c,d,i),qr(d,d.return);break;case 30:break;default:Ja(c,d,i)}t=t.sibling}}function Od(e,t){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Er(i))}function qd(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Er(e))}function Fn(e,t,i,l){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)G0(e,t,i,l),t=t.sibling}function G0(e,t,i,l){var c=t.flags;switch(t.tag){case 0:case 11:case 15:Fn(e,t,i,l),c&2048&&Or(9,t);break;case 1:Fn(e,t,i,l);break;case 3:Fn(e,t,i,l),c&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Er(e)));break;case 12:if(c&2048){Fn(e,t,i,l),e=t.stateNode;try{var d=t.memoizedProps,y=d.id,S=d.onPostCommit;typeof S=="function"&&S(y,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(x){Ye(t,t.return,x)}}else Fn(e,t,i,l);break;case 13:Fn(e,t,i,l);break;case 23:break;case 22:d=t.stateNode,y=t.alternate,t.memoizedState!==null?d._visibility&2?Fn(e,t,i,l):zr(e,t):d._visibility&2?Fn(e,t,i,l):(d._visibility|=2,ws(e,t,i,l,(t.subtreeFlags&10256)!==0)),c&2048&&Od(y,t);break;case 24:Fn(e,t,i,l),c&2048&&qd(t.alternate,t);break;default:Fn(e,t,i,l)}}function ws(e,t,i,l,c){for(c=c&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var d=e,y=t,S=i,x=l,z=y.flags;switch(y.tag){case 0:case 11:case 15:ws(d,y,S,x,c),Or(8,y);break;case 23:break;case 22:var K=y.stateNode;y.memoizedState!==null?K._visibility&2?ws(d,y,S,x,c):zr(d,y):(K._visibility|=2,ws(d,y,S,x,c)),c&&z&2048&&Od(y.alternate,y);break;case 24:ws(d,y,S,x,c),c&&z&2048&&qd(y.alternate,y);break;default:ws(d,y,S,x,c)}t=t.sibling}}function zr(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var i=e,l=t,c=l.flags;switch(l.tag){case 22:zr(i,l),c&2048&&Od(l.alternate,l);break;case 24:zr(i,l),c&2048&&qd(l.alternate,l);break;default:zr(i,l)}t=t.sibling}}var Br=8192;function As(e){if(e.subtreeFlags&Br)for(e=e.child;e!==null;)I0(e),e=e.sibling}function I0(e){switch(e.tag){case 26:As(e),e.flags&Br&&e.memoizedState!==null&&OS(An,e.memoizedState,e.memoizedProps);break;case 5:As(e);break;case 3:case 4:var t=An;An=Fo(e.stateNode.containerInfo),As(e),An=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=Br,Br=16777216,As(e),Br=t):As(e));break;default:As(e)}}function Y0(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Hr(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var l=t[i];Et=l,$0(l,e)}Y0(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)F0(e),e=e.sibling}function F0(e){switch(e.tag){case 0:case 11:case 15:Hr(e),e.flags&2048&&Pa(9,e,e.return);break;case 3:Hr(e);break;case 12:Hr(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Do(e)):Hr(e);break;default:Hr(e)}}function Do(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var l=t[i];Et=l,$0(l,e)}Y0(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Pa(8,t,t.return),Do(t);break;case 22:i=t.stateNode,i._visibility&2&&(i._visibility&=-3,Do(t));break;default:Do(t)}e=e.sibling}}function $0(e,t){for(;Et!==null;){var i=Et;switch(i.tag){case 0:case 11:case 15:Pa(8,i,t);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var l=i.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Er(i.memoizedState.cache)}if(l=i.child,l!==null)l.return=i,Et=l;else e:for(i=e;Et!==null;){l=Et;var c=l.sibling,d=l.return;if(q0(l),l===i){Et=null;break e}if(c!==null){c.return=d,Et=c;break e}Et=d}}}var Z1={getCacheForType:function(e){var t=Rt(ft),i=t.data.get(e);return i===void 0&&(i=e(),t.data.set(e,i)),i}},J1=typeof WeakMap=="function"?WeakMap:Map,Le=0,$e=null,we=null,Ne=0,Ue=0,an=null,Wa=!1,Cs=!1,zd=!1,Ma=0,it=0,ei=0,Bi=0,Bd=0,yn=0,Ts=0,jr=null,$t=null,Hd=!1,jd=0,Lo=1/0,Uo=null,ti=null,At=0,ni=null,_s=null,Rs=0,Gd=0,Id=null,V0=null,Gr=0,Yd=null;function sn(){if((Le&2)!==0&&Ne!==0)return Ne&-Ne;if(D.T!==null){var e=gs;return e!==0?e:Pd()}return jl()}function X0(){yn===0&&(yn=(Ne&536870912)===0||De?zl():536870912);var e=gn.current;return e!==null&&(e.flags|=32),yn}function rn(e,t,i){(e===$e&&(Ue===2||Ue===9)||e.cancelPendingCommit!==null)&&(Ns(e,0),ai(e,Ne,yn,!1)),zn(e,i),((Le&2)===0||e!==$e)&&(e===$e&&((Le&2)===0&&(Bi|=i),it===4&&ai(e,Ne,yn,!1)),$n(e))}function K0(e,t,i){if((Le&6)!==0)throw Error(r(327));var l=!i&&(t&124)===0&&(t&e.expiredLanes)===0||ia(e,t),c=l?tS(e,t):Vd(e,t,!0),d=l;do{if(c===0){Cs&&!l&&ai(e,t,0,!1);break}else{if(i=e.current.alternate,d&&!W1(i)){c=Vd(e,t,!1),d=!1;continue}if(c===2){if(d=t,e.errorRecoveryDisabledLanes&d)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){t=y;e:{var S=e;c=jr;var x=S.current.memoizedState.isDehydrated;if(x&&(Ns(S,y).flags|=256),y=Vd(S,y,!1),y!==2){if(zd&&!x){S.errorRecoveryDisabledLanes|=d,Bi|=d,c=4;break e}d=$t,$t=c,d!==null&&($t===null?$t=d:$t.push.apply($t,d))}c=y}if(d=!1,c!==2)continue}}if(c===1){Ns(e,0),ai(e,t,0,!0);break}e:{switch(l=e,d=c,d){case 0:case 1:throw Error(r(345));case 4:if((t&4194048)!==t)break;case 6:ai(l,t,yn,!Wa);break e;case 2:$t=null;break;case 3:case 5:break;default:throw Error(r(329))}if((t&62914560)===t&&(c=jd+300-ce(),10<c)){if(ai(l,t,yn,!Wa),bi(l,0,!0)!==0)break e;l.timeoutHandle=xg(Q0.bind(null,l,i,$t,Uo,Hd,t,yn,Bi,Ts,Wa,d,2,-0,0),c);break e}Q0(l,i,$t,Uo,Hd,t,yn,Bi,Ts,Wa,d,0,-0,0)}}break}while(!0);$n(e)}function Q0(e,t,i,l,c,d,y,S,x,z,K,J,H,G){if(e.timeoutHandle=-1,J=t.subtreeFlags,(J&8192||(J&16785408)===16785408)&&(Kr={stylesheets:null,count:0,unsuspend:US},I0(t),J=qS(),J!==null)){e.cancelPendingCommit=J(ng.bind(null,e,t,d,i,l,c,y,S,x,K,1,H,G)),ai(e,d,y,!z);return}ng(e,t,d,i,l,c,y,S,x)}function W1(e){for(var t=e;;){var i=t.tag;if((i===0||i===11||i===15)&&t.flags&16384&&(i=t.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var l=0;l<i.length;l++){var c=i[l],d=c.getSnapshot;c=c.value;try{if(!Wt(d(),c))return!1}catch{return!1}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ai(e,t,i,l){t&=~Bd,t&=~Bi,e.suspendedLanes|=t,e.pingedLanes&=~t,l&&(e.warmLanes|=t),l=e.expirationTimes;for(var c=t;0<c;){var d=31-_t(c),y=1<<d;l[d]=-1,c&=~y}i!==0&&ir(e,i,t)}function Oo(){return(Le&6)===0?(Ir(0),!1):!0}function Fd(){if(we!==null){if(Ue===0)var e=we.return;else e=we,ma=Di=null,ld(e),Ms=null,Dr=0,e=we;for(;e!==null;)_0(e.alternate,e),e=e.return;we=null}}function Ns(e,t){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,yS(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),Fd(),$e=e,we=i=da(e.current,null),Ne=t,Ue=0,an=null,Wa=!1,Cs=ia(e,t),zd=!1,Ts=yn=Bd=Bi=ei=it=0,$t=jr=null,Hd=!1,(t&8)!==0&&(t|=t&32);var l=e.entangledLanes;if(l!==0)for(e=e.entanglements,l&=t;0<l;){var c=31-_t(l),d=1<<c;t|=e[c],l&=~d}return Ma=t,no(),i}function P0(e,t){Se=null,D.H=Mo,t===xr||t===fo?(t=hp(),Ue=3):t===up?(t=hp(),Ue=4):Ue=t===m0?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,an=t,we===null&&(it=1,To(e,fn(t,e.current)))}function Z0(){var e=D.H;return D.H=Mo,e===null?Mo:e}function J0(){var e=D.A;return D.A=Z1,e}function $d(){it=4,Wa||(Ne&4194048)!==Ne&&gn.current!==null||(Cs=!0),(ei&134217727)===0&&(Bi&134217727)===0||$e===null||ai($e,Ne,yn,!1)}function Vd(e,t,i){var l=Le;Le|=2;var c=Z0(),d=J0();($e!==e||Ne!==t)&&(Uo=null,Ns(e,t)),t=!1;var y=it;e:do try{if(Ue!==0&&we!==null){var S=we,x=an;switch(Ue){case 8:Fd(),y=6;break e;case 3:case 2:case 9:case 6:gn.current===null&&(t=!0);var z=Ue;if(Ue=0,an=null,ks(e,S,x,z),i&&Cs){y=0;break e}break;default:z=Ue,Ue=0,an=null,ks(e,S,x,z)}}eS(),y=it;break}catch(K){P0(e,K)}while(!0);return t&&e.shellSuspendCounter++,ma=Di=null,Le=l,D.H=c,D.A=d,we===null&&($e=null,Ne=0,no()),y}function eS(){for(;we!==null;)W0(we)}function tS(e,t){var i=Le;Le|=2;var l=Z0(),c=J0();$e!==e||Ne!==t?(Uo=null,Lo=ce()+500,Ns(e,t)):Cs=ia(e,t);e:do try{if(Ue!==0&&we!==null){t=we;var d=an;t:switch(Ue){case 1:Ue=0,an=null,ks(e,t,d,1);break;case 2:case 9:if(dp(d)){Ue=0,an=null,eg(t);break}t=function(){Ue!==2&&Ue!==9||$e!==e||(Ue=7),$n(e)},d.then(t,t);break e;case 3:Ue=7;break e;case 4:Ue=5;break e;case 7:dp(d)?(Ue=0,an=null,eg(t)):(Ue=0,an=null,ks(e,t,d,7));break;case 5:var y=null;switch(we.tag){case 26:y=we.memoizedState;case 5:case 27:var S=we;if(!y||Og(y)){Ue=0,an=null;var x=S.sibling;if(x!==null)we=x;else{var z=S.return;z!==null?(we=z,qo(z)):we=null}break t}}Ue=0,an=null,ks(e,t,d,5);break;case 6:Ue=0,an=null,ks(e,t,d,6);break;case 8:Fd(),it=6;break e;default:throw Error(r(462))}}nS();break}catch(K){P0(e,K)}while(!0);return ma=Di=null,D.H=l,D.A=c,Le=i,we!==null?0:($e=null,Ne=0,no(),it)}function nS(){for(;we!==null&&!yi();)W0(we)}function W0(e){var t=C0(e.alternate,e,Ma);e.memoizedProps=e.pendingProps,t===null?qo(e):we=t}function eg(e){var t=e,i=t.alternate;switch(t.tag){case 15:case 0:t=S0(i,t,t.pendingProps,t.type,void 0,Ne);break;case 11:t=S0(i,t,t.pendingProps,t.type.render,t.ref,Ne);break;case 5:ld(t);default:_0(i,t),t=we=tp(t,Ma),t=C0(i,t,Ma)}e.memoizedProps=e.pendingProps,t===null?qo(e):we=t}function ks(e,t,i,l){ma=Di=null,ld(t),Ms=null,Dr=0;var c=t.return;try{if($1(e,c,t,i,Ne)){it=1,To(e,fn(i,e.current)),we=null;return}}catch(d){if(c!==null)throw we=c,d;it=1,To(e,fn(i,e.current)),we=null;return}t.flags&32768?(De||l===1?e=!0:Cs||(Ne&536870912)!==0?e=!1:(Wa=e=!0,(l===2||l===9||l===3||l===6)&&(l=gn.current,l!==null&&l.tag===13&&(l.flags|=16384))),tg(t,e)):qo(t)}function qo(e){var t=e;do{if((t.flags&32768)!==0){tg(t,Wa);return}e=t.return;var i=X1(t.alternate,t,Ma);if(i!==null){we=i;return}if(t=t.sibling,t!==null){we=t;return}we=t=e}while(t!==null);it===0&&(it=5)}function tg(e,t){do{var i=K1(e.alternate,e);if(i!==null){i.flags&=32767,we=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!t&&(e=e.sibling,e!==null)){we=e;return}we=e=i}while(e!==null);it=6,we=null}function ng(e,t,i,l,c,d,y,S,x){e.cancelPendingCommit=null;do zo();while(At!==0);if((Le&6)!==0)throw Error(r(327));if(t!==null){if(t===e.current)throw Error(r(177));if(d=t.lanes|t.childLanes,d|=qu,Hl(e,i,d,y,S,x),e===$e&&(we=$e=null,Ne=0),_s=t,ni=e,Rs=i,Gd=d,Id=c,V0=l,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,rS(bt,function(){return lg(),null})):(e.callbackNode=null,e.callbackPriority=0),l=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||l){l=D.T,D.T=null,c=V.p,V.p=2,y=Le,Le|=4;try{Q1(e,t,i)}finally{Le=y,V.p=c,D.T=l}}At=1,ag(),ig(),sg()}}function ag(){if(At===1){At=0;var e=ni,t=_s,i=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||i){i=D.T,D.T=null;var l=V.p;V.p=2;var c=Le;Le|=4;try{H0(t,e);var d=sf,y=$m(e.containerInfo),S=d.focusedElem,x=d.selectionRange;if(y!==S&&S&&S.ownerDocument&&Fm(S.ownerDocument.documentElement,S)){if(x!==null&&ku(S)){var z=x.start,K=x.end;if(K===void 0&&(K=z),"selectionStart"in S)S.selectionStart=z,S.selectionEnd=Math.min(K,S.value.length);else{var J=S.ownerDocument||document,H=J&&J.defaultView||window;if(H.getSelection){var G=H.getSelection(),be=S.textContent.length,pe=Math.min(x.start,be),He=x.end===void 0?pe:Math.min(x.end,be);!G.extend&&pe>He&&(y=He,He=pe,pe=y);var U=Ym(S,pe),_=Ym(S,He);if(U&&_&&(G.rangeCount!==1||G.anchorNode!==U.node||G.anchorOffset!==U.offset||G.focusNode!==_.node||G.focusOffset!==_.offset)){var O=J.createRange();O.setStart(U.node,U.offset),G.removeAllRanges(),pe>He?(G.addRange(O),G.extend(_.node,_.offset)):(O.setEnd(_.node,_.offset),G.addRange(O))}}}}for(J=[],G=S;G=G.parentNode;)G.nodeType===1&&J.push({element:G,left:G.scrollLeft,top:G.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<J.length;S++){var Z=J[S];Z.element.scrollLeft=Z.left,Z.element.scrollTop=Z.top}}Qo=!!af,sf=af=null}finally{Le=c,V.p=l,D.T=i}}e.current=t,At=2}}function ig(){if(At===2){At=0;var e=ni,t=_s,i=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||i){i=D.T,D.T=null;var l=V.p;V.p=2;var c=Le;Le|=4;try{O0(e,t.alternate,t)}finally{Le=c,V.p=l,D.T=i}}At=3}}function sg(){if(At===4||At===3){At=0,Wi();var e=ni,t=_s,i=Rs,l=V0;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?At=5:(At=0,_s=ni=null,rg(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(ti=null),lr(i),t=t.stateNode,Qe&&typeof Qe.onCommitFiberRoot=="function")try{Qe.onCommitFiberRoot(Xe,t,void 0,(t.current.flags&128)===128)}catch{}if(l!==null){t=D.T,c=V.p,V.p=2,D.T=null;try{for(var d=e.onRecoverableError,y=0;y<l.length;y++){var S=l[y];d(S.value,{componentStack:S.stack})}}finally{D.T=t,V.p=c}}(Rs&3)!==0&&zo(),$n(e),c=e.pendingLanes,(i&4194090)!==0&&(c&42)!==0?e===Yd?Gr++:(Gr=0,Yd=e):Gr=0,Ir(0)}}function rg(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Er(t)))}function zo(e){return ag(),ig(),sg(),lg()}function lg(){if(At!==5)return!1;var e=ni,t=Gd;Gd=0;var i=lr(Rs),l=D.T,c=V.p;try{V.p=32>i?32:i,D.T=null,i=Id,Id=null;var d=ni,y=Rs;if(At=0,_s=ni=null,Rs=0,(Le&6)!==0)throw Error(r(331));var S=Le;if(Le|=4,F0(d.current),G0(d,d.current,y,i),Le=S,Ir(0,!1),Qe&&typeof Qe.onPostCommitFiberRoot=="function")try{Qe.onPostCommitFiberRoot(Xe,d)}catch{}return!0}finally{V.p=c,D.T=l,rg(e,t)}}function og(e,t,i){t=fn(i,t),t=Ed(e.stateNode,t,2),e=Va(e,t,2),e!==null&&(zn(e,2),$n(e))}function Ye(e,t,i){if(e.tag===3)og(e,e,i);else for(;t!==null;){if(t.tag===3){og(t,e,i);break}else if(t.tag===1){var l=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(ti===null||!ti.has(l))){e=fn(i,e),i=f0(2),l=Va(t,i,2),l!==null&&(h0(i,l,t,e),zn(l,2),$n(l));break}}t=t.return}}function Xd(e,t,i){var l=e.pingCache;if(l===null){l=e.pingCache=new J1;var c=new Set;l.set(t,c)}else c=l.get(t),c===void 0&&(c=new Set,l.set(t,c));c.has(i)||(zd=!0,c.add(i),e=aS.bind(null,e,t,i),t.then(e,e))}function aS(e,t,i){var l=e.pingCache;l!==null&&l.delete(t),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,$e===e&&(Ne&i)===i&&(it===4||it===3&&(Ne&62914560)===Ne&&300>ce()-jd?(Le&2)===0&&Ns(e,0):Bd|=i,Ts===Ne&&(Ts=0)),$n(e)}function cg(e,t){t===0&&(t=Bl()),e=fs(e,t),e!==null&&(zn(e,t),$n(e))}function iS(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),cg(e,i)}function sS(e,t){var i=0;switch(e.tag){case 13:var l=e.stateNode,c=e.memoizedState;c!==null&&(i=c.retryLane);break;case 19:l=e.stateNode;break;case 22:l=e.stateNode._retryCache;break;default:throw Error(r(314))}l!==null&&l.delete(t),cg(e,i)}function rS(e,t){return On(e,t)}var Bo=null,Ds=null,Kd=!1,Ho=!1,Qd=!1,Hi=0;function $n(e){e!==Ds&&e.next===null&&(Ds===null?Bo=Ds=e:Ds=Ds.next=e),Ho=!0,Kd||(Kd=!0,oS())}function Ir(e,t){if(!Qd&&Ho){Qd=!0;do for(var i=!1,l=Bo;l!==null;){if(e!==0){var c=l.pendingLanes;if(c===0)var d=0;else{var y=l.suspendedLanes,S=l.pingedLanes;d=(1<<31-_t(42|e)+1)-1,d&=c&~(y&~S),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(i=!0,hg(l,d))}else d=Ne,d=bi(l,l===$e?d:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(d&3)===0||ia(l,d)||(i=!0,hg(l,d));l=l.next}while(i);Qd=!1}}function lS(){ug()}function ug(){Ho=Kd=!1;var e=0;Hi!==0&&(gS()&&(e=Hi),Hi=0);for(var t=ce(),i=null,l=Bo;l!==null;){var c=l.next,d=dg(l,t);d===0?(l.next=null,i===null?Bo=c:i.next=c,c===null&&(Ds=i)):(i=l,(e!==0||(d&3)!==0)&&(Ho=!0)),l=c}Ir(e)}function dg(e,t){for(var i=e.suspendedLanes,l=e.pingedLanes,c=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var y=31-_t(d),S=1<<y,x=c[y];x===-1?((S&i)===0||(S&l)!==0)&&(c[y]=yu(S,t)):x<=t&&(e.expiredLanes|=S),d&=~S}if(t=$e,i=Ne,i=bi(e,e===t?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l=e.callbackNode,i===0||e===t&&(Ue===2||Ue===9)||e.cancelPendingCommit!==null)return l!==null&&l!==null&&un(l),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||ia(e,i)){if(t=i&-i,t===e.callbackPriority)return t;switch(l!==null&&un(l),lr(i)){case 2:case 8:i=qe;break;case 32:i=bt;break;case 268435456:i=Qt;break;default:i=bt}return l=fg.bind(null,e),i=On(i,l),e.callbackPriority=t,e.callbackNode=i,t}return l!==null&&l!==null&&un(l),e.callbackPriority=2,e.callbackNode=null,2}function fg(e,t){if(At!==0&&At!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(zo()&&e.callbackNode!==i)return null;var l=Ne;return l=bi(e,e===$e?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l===0?null:(K0(e,l,t),dg(e,ce()),e.callbackNode!=null&&e.callbackNode===i?fg.bind(null,e):null)}function hg(e,t){if(zo())return null;K0(e,t,!0)}function oS(){bS(function(){(Le&6)!==0?On(Ge,lS):ug()})}function Pd(){return Hi===0&&(Hi=zl()),Hi}function mg(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Ql(""+e)}function pg(e,t){var i=t.ownerDocument.createElement("input");return i.name=t.name,i.value=t.value,e.id&&i.setAttribute("form",e.id),t.parentNode.insertBefore(i,t),e=new FormData(e),i.parentNode.removeChild(i),e}function cS(e,t,i,l,c){if(t==="submit"&&i&&i.stateNode===c){var d=mg((c[ut]||null).action),y=l.submitter;y&&(t=(t=y[ut]||null)?mg(t.formAction):y.getAttribute("formAction"),t!==null&&(d=t,y=null));var S=new Wl("action","action",null,l,c);e.push({event:S,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(Hi!==0){var x=y?pg(c,y):new FormData(c);gd(i,{pending:!0,data:x,method:c.method,action:d},null,x)}}else typeof d=="function"&&(S.preventDefault(),x=y?pg(c,y):new FormData(c),gd(i,{pending:!0,data:x,method:c.method,action:d},d,x))},currentTarget:c}]})}}for(var Zd=0;Zd<Ou.length;Zd++){var Jd=Ou[Zd],uS=Jd.toLowerCase(),dS=Jd[0].toUpperCase()+Jd.slice(1);wn(uS,"on"+dS)}wn(Km,"onAnimationEnd"),wn(Qm,"onAnimationIteration"),wn(Pm,"onAnimationStart"),wn("dblclick","onDoubleClick"),wn("focusin","onFocus"),wn("focusout","onBlur"),wn(_1,"onTransitionRun"),wn(R1,"onTransitionStart"),wn(N1,"onTransitionCancel"),wn(Zm,"onTransitionEnd"),Ha("onMouseEnter",["mouseout","mouseover"]),Ha("onMouseLeave",["mouseout","mouseover"]),Ha("onPointerEnter",["pointerout","pointerover"]),Ha("onPointerLeave",["pointerout","pointerover"]),Hn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Hn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Hn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Hn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Hn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Hn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Yr));function gg(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var l=e[i],c=l.event;l=l.listeners;e:{var d=void 0;if(t)for(var y=l.length-1;0<=y;y--){var S=l[y],x=S.instance,z=S.currentTarget;if(S=S.listener,x!==d&&c.isPropagationStopped())break e;d=S,c.currentTarget=z;try{d(c)}catch(K){Co(K)}c.currentTarget=null,d=x}else for(y=0;y<l.length;y++){if(S=l[y],x=S.instance,z=S.currentTarget,S=S.listener,x!==d&&c.isPropagationStopped())break e;d=S,c.currentTarget=z;try{d(c)}catch(K){Co(K)}c.currentTarget=null,d=x}}}}function Ae(e,t){var i=t[za];i===void 0&&(i=t[za]=new Set);var l=e+"__bubble";i.has(l)||(yg(t,e,2,!1),i.add(l))}function Wd(e,t,i){var l=0;t&&(l|=4),yg(i,e,l,t)}var jo="_reactListening"+Math.random().toString(36).slice(2);function ef(e){if(!e[jo]){e[jo]=!0,is.forEach(function(i){i!=="selectionchange"&&(fS.has(i)||Wd(i,!1,e),Wd(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[jo]||(t[jo]=!0,Wd("selectionchange",!1,t))}}function yg(e,t,i,l){switch(Gg(t)){case 2:var c=HS;break;case 8:c=jS;break;default:c=pf}i=c.bind(null,t,i,e),c=void 0,!Mu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),l?c!==void 0?e.addEventListener(t,i,{capture:!0,passive:c}):e.addEventListener(t,i,!0):c!==void 0?e.addEventListener(t,i,{passive:c}):e.addEventListener(t,i,!1)}function tf(e,t,i,l,c){var d=l;if((t&1)===0&&(t&2)===0&&l!==null)e:for(;;){if(l===null)return;var y=l.tag;if(y===3||y===4){var S=l.stateNode.containerInfo;if(S===c)break;if(y===4)for(y=l.return;y!==null;){var x=y.tag;if((x===3||x===4)&&y.stateNode.containerInfo===c)return;y=y.return}for(;S!==null;){if(y=ra(S),y===null)return;if(x=y.tag,x===5||x===6||x===26||x===27){l=d=y;continue e}S=S.parentNode}}l=l.return}wm(function(){var z=d,K=Su(i),J=[];e:{var H=Jm.get(e);if(H!==void 0){var G=Wl,be=e;switch(e){case"keypress":if(Zl(i)===0)break e;case"keydown":case"keyup":G=r1;break;case"focusin":be="focus",G=Cu;break;case"focusout":be="blur",G=Cu;break;case"beforeblur":case"afterblur":G=Cu;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=Tm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=Kv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=c1;break;case Km:case Qm:case Pm:G=Zv;break;case Zm:G=d1;break;case"scroll":case"scrollend":G=Vv;break;case"wheel":G=h1;break;case"copy":case"cut":case"paste":G=Wv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=Rm;break;case"toggle":case"beforetoggle":G=p1}var pe=(t&4)!==0,He=!pe&&(e==="scroll"||e==="scrollend"),U=pe?H!==null?H+"Capture":null:H;pe=[];for(var _=z,O;_!==null;){var Z=_;if(O=Z.stateNode,Z=Z.tag,Z!==5&&Z!==26&&Z!==27||O===null||U===null||(Z=or(_,U),Z!=null&&pe.push(Fr(_,Z,O))),He)break;_=_.return}0<pe.length&&(H=new G(H,be,null,i,K),J.push({event:H,listeners:pe}))}}if((t&7)===0){e:{if(H=e==="mouseover"||e==="pointerover",G=e==="mouseout"||e==="pointerout",H&&i!==vu&&(be=i.relatedTarget||i.fromElement)&&(ra(be)||be[sa]))break e;if((G||H)&&(H=K.window===K?K:(H=K.ownerDocument)?H.defaultView||H.parentWindow:window,G?(be=i.relatedTarget||i.toElement,G=z,be=be?ra(be):null,be!==null&&(He=u(be),pe=be.tag,be!==He||pe!==5&&pe!==27&&pe!==6)&&(be=null)):(G=null,be=z),G!==be)){if(pe=Tm,Z="onMouseLeave",U="onMouseEnter",_="mouse",(e==="pointerout"||e==="pointerover")&&(pe=Rm,Z="onPointerLeave",U="onPointerEnter",_="pointer"),He=G==null?H:la(G),O=be==null?H:la(be),H=new pe(Z,_+"leave",G,i,K),H.target=He,H.relatedTarget=O,Z=null,ra(K)===z&&(pe=new pe(U,_+"enter",be,i,K),pe.target=O,pe.relatedTarget=He,Z=pe),He=Z,G&&be)t:{for(pe=G,U=be,_=0,O=pe;O;O=Ls(O))_++;for(O=0,Z=U;Z;Z=Ls(Z))O++;for(;0<_-O;)pe=Ls(pe),_--;for(;0<O-_;)U=Ls(U),O--;for(;_--;){if(pe===U||U!==null&&pe===U.alternate)break t;pe=Ls(pe),U=Ls(U)}pe=null}else pe=null;G!==null&&bg(J,H,G,pe,!1),be!==null&&He!==null&&bg(J,He,be,pe,!0)}}e:{if(H=z?la(z):window,G=H.nodeName&&H.nodeName.toLowerCase(),G==="select"||G==="input"&&H.type==="file")var ue=zm;else if(Om(H))if(Bm)ue=A1;else{ue=x1;var Me=M1}else G=H.nodeName,!G||G.toLowerCase()!=="input"||H.type!=="checkbox"&&H.type!=="radio"?z&&bu(z.elementType)&&(ue=zm):ue=w1;if(ue&&(ue=ue(e,z))){qm(J,ue,i,K);break e}Me&&Me(e,H,z),e==="focusout"&&z&&H.type==="number"&&z.memoizedProps.value!=null&&Ga(H,"number",H.value)}switch(Me=z?la(z):window,e){case"focusin":(Om(Me)||Me.contentEditable==="true")&&(cs=Me,Du=z,gr=null);break;case"focusout":gr=Du=cs=null;break;case"mousedown":Lu=!0;break;case"contextmenu":case"mouseup":case"dragend":Lu=!1,Vm(J,i,K);break;case"selectionchange":if(T1)break;case"keydown":case"keyup":Vm(J,i,K)}var me;if(_u)e:{switch(e){case"compositionstart":var ye="onCompositionStart";break e;case"compositionend":ye="onCompositionEnd";break e;case"compositionupdate":ye="onCompositionUpdate";break e}ye=void 0}else os?Lm(e,i)&&(ye="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(ye="onCompositionStart");ye&&(Nm&&i.locale!=="ko"&&(os||ye!=="onCompositionStart"?ye==="onCompositionEnd"&&os&&(me=Am()):(Ia=K,xu="value"in Ia?Ia.value:Ia.textContent,os=!0)),Me=Go(z,ye),0<Me.length&&(ye=new _m(ye,e,null,i,K),J.push({event:ye,listeners:Me}),me?ye.data=me:(me=Um(i),me!==null&&(ye.data=me)))),(me=y1?b1(e,i):v1(e,i))&&(ye=Go(z,"onBeforeInput"),0<ye.length&&(Me=new _m("onBeforeInput","beforeinput",null,i,K),J.push({event:Me,listeners:ye}),Me.data=me)),cS(J,e,z,i,K)}gg(J,t)})}function Fr(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Go(e,t){for(var i=t+"Capture",l=[];e!==null;){var c=e,d=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||d===null||(c=or(e,i),c!=null&&l.unshift(Fr(e,c,d)),c=or(e,t),c!=null&&l.push(Fr(e,c,d))),e.tag===3)return l;e=e.return}return[]}function Ls(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function bg(e,t,i,l,c){for(var d=t._reactName,y=[];i!==null&&i!==l;){var S=i,x=S.alternate,z=S.stateNode;if(S=S.tag,x!==null&&x===l)break;S!==5&&S!==26&&S!==27||z===null||(x=z,c?(z=or(i,d),z!=null&&y.unshift(Fr(i,z,x))):c||(z=or(i,d),z!=null&&y.push(Fr(i,z,x)))),i=i.return}y.length!==0&&e.push({event:t,listeners:y})}var hS=/\r\n?/g,mS=/\u0000|\uFFFD/g;function vg(e){return(typeof e=="string"?e:""+e).replace(hS,`
`).replace(mS,"")}function Sg(e,t){return t=vg(t),vg(e)===t}function Io(){}function Be(e,t,i,l,c,d){switch(i){case"children":typeof l=="string"?t==="body"||t==="textarea"&&l===""||ss(e,l):(typeof l=="number"||typeof l=="bigint")&&t!=="body"&&ss(e,""+l);break;case"className":Mi(e,"class",l);break;case"tabIndex":Mi(e,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Mi(e,i,l);break;case"style":Mm(e,l,d);break;case"data":if(t!=="object"){Mi(e,"data",l);break}case"src":case"href":if(l===""&&(t!=="a"||i!=="href")){e.removeAttribute(i);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(i);break}l=Ql(""+l),e.setAttribute(i,l);break;case"action":case"formAction":if(typeof l=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(i==="formAction"?(t!=="input"&&Be(e,t,"name",c.name,c,null),Be(e,t,"formEncType",c.formEncType,c,null),Be(e,t,"formMethod",c.formMethod,c,null),Be(e,t,"formTarget",c.formTarget,c,null)):(Be(e,t,"encType",c.encType,c,null),Be(e,t,"method",c.method,c,null),Be(e,t,"target",c.target,c,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(i);break}l=Ql(""+l),e.setAttribute(i,l);break;case"onClick":l!=null&&(e.onclick=Io);break;case"onScroll":l!=null&&Ae("scroll",e);break;case"onScrollEnd":l!=null&&Ae("scrollend",e);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(r(61));if(i=l.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"multiple":e.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":e.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){e.removeAttribute("xlink:href");break}i=Ql(""+l),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,""+l):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":l===!0?e.setAttribute(i,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,l):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?e.setAttribute(i,l):e.removeAttribute(i);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?e.removeAttribute(i):e.setAttribute(i,l);break;case"popover":Ae("beforetoggle",e),Ae("toggle",e),Ei(e,"popover",l);break;case"xlinkActuate":xn(e,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":xn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":xn(e,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":xn(e,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":xn(e,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":xn(e,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":xn(e,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":xn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":xn(e,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":Ei(e,"is",l);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=Fv.get(i)||i,Ei(e,i,l))}}function nf(e,t,i,l,c,d){switch(i){case"style":Mm(e,l,d);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(r(61));if(i=l.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"children":typeof l=="string"?ss(e,l):(typeof l=="number"||typeof l=="bigint")&&ss(e,""+l);break;case"onScroll":l!=null&&Ae("scroll",e);break;case"onScrollEnd":l!=null&&Ae("scrollend",e);break;case"onClick":l!=null&&(e.onclick=Io);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Il.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(c=i.endsWith("Capture"),t=i.slice(2,c?i.length-7:void 0),d=e[ut]||null,d=d!=null?d[i]:null,typeof d=="function"&&e.removeEventListener(t,d,c),typeof l=="function")){typeof d!="function"&&d!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(t,l,c);break e}i in e?e[i]=l:l===!0?e.setAttribute(i,""):Ei(e,i,l)}}}function Ct(e,t,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ae("error",e),Ae("load",e);var l=!1,c=!1,d;for(d in i)if(i.hasOwnProperty(d)){var y=i[d];if(y!=null)switch(d){case"src":l=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:Be(e,t,d,y,i,null)}}c&&Be(e,t,"srcSet",i.srcSet,i,null),l&&Be(e,t,"src",i.src,i,null);return;case"input":Ae("invalid",e);var S=d=y=c=null,x=null,z=null;for(l in i)if(i.hasOwnProperty(l)){var K=i[l];if(K!=null)switch(l){case"name":c=K;break;case"type":y=K;break;case"checked":x=K;break;case"defaultChecked":z=K;break;case"value":d=K;break;case"defaultValue":S=K;break;case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(r(137,t));break;default:Be(e,t,l,K,i,null)}}ja(e,d,S,x,z,y,c,!1),vt(e);return;case"select":Ae("invalid",e),l=y=d=null;for(c in i)if(i.hasOwnProperty(c)&&(S=i[c],S!=null))switch(c){case"value":d=S;break;case"defaultValue":y=S;break;case"multiple":l=S;default:Be(e,t,c,S,i,null)}t=d,i=y,e.multiple=!!l,t!=null?ca(e,!!l,t,!1):i!=null&&ca(e,!!l,i,!0);return;case"textarea":Ae("invalid",e),d=c=l=null;for(y in i)if(i.hasOwnProperty(y)&&(S=i[y],S!=null))switch(y){case"value":l=S;break;case"defaultValue":c=S;break;case"children":d=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(r(91));break;default:Be(e,t,y,S,i,null)}Kl(e,l,c,d),vt(e);return;case"option":for(x in i)if(i.hasOwnProperty(x)&&(l=i[x],l!=null))switch(x){case"selected":e.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:Be(e,t,x,l,i,null)}return;case"dialog":Ae("beforetoggle",e),Ae("toggle",e),Ae("cancel",e),Ae("close",e);break;case"iframe":case"object":Ae("load",e);break;case"video":case"audio":for(l=0;l<Yr.length;l++)Ae(Yr[l],e);break;case"image":Ae("error",e),Ae("load",e);break;case"details":Ae("toggle",e);break;case"embed":case"source":case"link":Ae("error",e),Ae("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(z in i)if(i.hasOwnProperty(z)&&(l=i[z],l!=null))switch(z){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:Be(e,t,z,l,i,null)}return;default:if(bu(t)){for(K in i)i.hasOwnProperty(K)&&(l=i[K],l!==void 0&&nf(e,t,K,l,i,void 0));return}}for(S in i)i.hasOwnProperty(S)&&(l=i[S],l!=null&&Be(e,t,S,l,i,null))}function pS(e,t,i,l){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,d=null,y=null,S=null,x=null,z=null,K=null;for(G in i){var J=i[G];if(i.hasOwnProperty(G)&&J!=null)switch(G){case"checked":break;case"value":break;case"defaultValue":x=J;default:l.hasOwnProperty(G)||Be(e,t,G,null,l,J)}}for(var H in l){var G=l[H];if(J=i[H],l.hasOwnProperty(H)&&(G!=null||J!=null))switch(H){case"type":d=G;break;case"name":c=G;break;case"checked":z=G;break;case"defaultChecked":K=G;break;case"value":y=G;break;case"defaultValue":S=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(r(137,t));break;default:G!==J&&Be(e,t,H,G,l,J)}}nt(e,y,S,x,z,K,d,c);return;case"select":G=y=S=H=null;for(d in i)if(x=i[d],i.hasOwnProperty(d)&&x!=null)switch(d){case"value":break;case"multiple":G=x;default:l.hasOwnProperty(d)||Be(e,t,d,null,l,x)}for(c in l)if(d=l[c],x=i[c],l.hasOwnProperty(c)&&(d!=null||x!=null))switch(c){case"value":H=d;break;case"defaultValue":S=d;break;case"multiple":y=d;default:d!==x&&Be(e,t,c,d,l,x)}t=S,i=y,l=G,H!=null?ca(e,!!i,H,!1):!!l!=!!i&&(t!=null?ca(e,!!i,t,!0):ca(e,!!i,i?[]:"",!1));return;case"textarea":G=H=null;for(S in i)if(c=i[S],i.hasOwnProperty(S)&&c!=null&&!l.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:Be(e,t,S,null,l,c)}for(y in l)if(c=l[y],d=i[y],l.hasOwnProperty(y)&&(c!=null||d!=null))switch(y){case"value":H=c;break;case"defaultValue":G=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(r(91));break;default:c!==d&&Be(e,t,y,c,l,d)}jn(e,H,G);return;case"option":for(var be in i)if(H=i[be],i.hasOwnProperty(be)&&H!=null&&!l.hasOwnProperty(be))switch(be){case"selected":e.selected=!1;break;default:Be(e,t,be,null,l,H)}for(x in l)if(H=l[x],G=i[x],l.hasOwnProperty(x)&&H!==G&&(H!=null||G!=null))switch(x){case"selected":e.selected=H&&typeof H!="function"&&typeof H!="symbol";break;default:Be(e,t,x,H,l,G)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pe in i)H=i[pe],i.hasOwnProperty(pe)&&H!=null&&!l.hasOwnProperty(pe)&&Be(e,t,pe,null,l,H);for(z in l)if(H=l[z],G=i[z],l.hasOwnProperty(z)&&H!==G&&(H!=null||G!=null))switch(z){case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(r(137,t));break;default:Be(e,t,z,H,l,G)}return;default:if(bu(t)){for(var He in i)H=i[He],i.hasOwnProperty(He)&&H!==void 0&&!l.hasOwnProperty(He)&&nf(e,t,He,void 0,l,H);for(K in l)H=l[K],G=i[K],!l.hasOwnProperty(K)||H===G||H===void 0&&G===void 0||nf(e,t,K,H,l,G);return}}for(var U in i)H=i[U],i.hasOwnProperty(U)&&H!=null&&!l.hasOwnProperty(U)&&Be(e,t,U,null,l,H);for(J in l)H=l[J],G=i[J],!l.hasOwnProperty(J)||H===G||H==null&&G==null||Be(e,t,J,H,l,G)}var af=null,sf=null;function Yo(e){return e.nodeType===9?e:e.ownerDocument}function Eg(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Mg(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function rf(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var lf=null;function gS(){var e=window.event;return e&&e.type==="popstate"?e===lf?!1:(lf=e,!0):(lf=null,!1)}var xg=typeof setTimeout=="function"?setTimeout:void 0,yS=typeof clearTimeout=="function"?clearTimeout:void 0,wg=typeof Promise=="function"?Promise:void 0,bS=typeof queueMicrotask=="function"?queueMicrotask:typeof wg<"u"?function(e){return wg.resolve(null).then(e).catch(vS)}:xg;function vS(e){setTimeout(function(){throw e})}function ii(e){return e==="head"}function Ag(e,t){var i=t,l=0,c=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(0<l&&8>l){i=l;var y=e.ownerDocument;if(i&1&&$r(y.documentElement),i&2&&$r(y.body),i&4)for(i=y.head,$r(i),y=i.firstChild;y;){var S=y.nextSibling,x=y.nodeName;y[Si]||x==="SCRIPT"||x==="STYLE"||x==="LINK"&&y.rel.toLowerCase()==="stylesheet"||i.removeChild(y),y=S}}if(c===0){e.removeChild(d),Wr(t);return}c--}else i==="$"||i==="$?"||i==="$!"?c++:l=i.charCodeAt(0)-48;else l=0;i=d}while(i);Wr(t)}function of(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var i=t;switch(t=t.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":of(i),as(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function SS(e,t,i,l){for(;e.nodeType===1;){var c=i;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!l&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(l){if(!e[Si])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var d=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=Cn(e.nextSibling),e===null)break}return null}function ES(e,t,i){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=Cn(e.nextSibling),e===null))return null;return e}function cf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function MS(e,t){var i=e.ownerDocument;if(e.data!=="$?"||i.readyState==="complete")t();else{var l=function(){t(),i.removeEventListener("DOMContentLoaded",l)};i.addEventListener("DOMContentLoaded",l),e._reactRetry=l}}function Cn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var uf=null;function Cg(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}function Tg(e,t,i){switch(t=Yo(i),e){case"html":if(e=t.documentElement,!e)throw Error(r(452));return e;case"head":if(e=t.head,!e)throw Error(r(453));return e;case"body":if(e=t.body,!e)throw Error(r(454));return e;default:throw Error(r(451))}}function $r(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);as(e)}var bn=new Map,_g=new Set;function Fo(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var xa=V.d;V.d={f:xS,r:wS,D:AS,C:CS,L:TS,m:_S,X:NS,S:RS,M:kS};function xS(){var e=xa.f(),t=Oo();return e||t}function wS(e){var t=Ba(e);t!==null&&t.tag===5&&t.type==="form"?Kp(t):xa.r(e)}var Us=typeof document>"u"?null:document;function Rg(e,t,i){var l=Us;if(l&&typeof t=="string"&&t){var c=dt(t);c='link[rel="'+e+'"][href="'+c+'"]',typeof i=="string"&&(c+='[crossorigin="'+i+'"]'),_g.has(c)||(_g.add(c),e={rel:e,crossOrigin:i,href:t},l.querySelector(c)===null&&(t=l.createElement("link"),Ct(t,"link",e),et(t),l.head.appendChild(t)))}}function AS(e){xa.D(e),Rg("dns-prefetch",e,null)}function CS(e,t){xa.C(e,t),Rg("preconnect",e,t)}function TS(e,t,i){xa.L(e,t,i);var l=Us;if(l&&e&&t){var c='link[rel="preload"][as="'+dt(t)+'"]';t==="image"&&i&&i.imageSrcSet?(c+='[imagesrcset="'+dt(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(c+='[imagesizes="'+dt(i.imageSizes)+'"]')):c+='[href="'+dt(e)+'"]';var d=c;switch(t){case"style":d=Os(e);break;case"script":d=qs(e)}bn.has(d)||(e=g({rel:"preload",href:t==="image"&&i&&i.imageSrcSet?void 0:e,as:t},i),bn.set(d,e),l.querySelector(c)!==null||t==="style"&&l.querySelector(Vr(d))||t==="script"&&l.querySelector(Xr(d))||(t=l.createElement("link"),Ct(t,"link",e),et(t),l.head.appendChild(t)))}}function _S(e,t){xa.m(e,t);var i=Us;if(i&&e){var l=t&&typeof t.as=="string"?t.as:"script",c='link[rel="modulepreload"][as="'+dt(l)+'"][href="'+dt(e)+'"]',d=c;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=qs(e)}if(!bn.has(d)&&(e=g({rel:"modulepreload",href:e},t),bn.set(d,e),i.querySelector(c)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(Xr(d)))return}l=i.createElement("link"),Ct(l,"link",e),et(l),i.head.appendChild(l)}}}function RS(e,t,i){xa.S(e,t,i);var l=Us;if(l&&e){var c=oa(l).hoistableStyles,d=Os(e);t=t||"default";var y=c.get(d);if(!y){var S={loading:0,preload:null};if(y=l.querySelector(Vr(d)))S.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":t},i),(i=bn.get(d))&&df(e,i);var x=y=l.createElement("link");et(x),Ct(x,"link",e),x._p=new Promise(function(z,K){x.onload=z,x.onerror=K}),x.addEventListener("load",function(){S.loading|=1}),x.addEventListener("error",function(){S.loading|=2}),S.loading|=4,$o(y,t,l)}y={type:"stylesheet",instance:y,count:1,state:S},c.set(d,y)}}}function NS(e,t){xa.X(e,t);var i=Us;if(i&&e){var l=oa(i).hoistableScripts,c=qs(e),d=l.get(c);d||(d=i.querySelector(Xr(c)),d||(e=g({src:e,async:!0},t),(t=bn.get(c))&&ff(e,t),d=i.createElement("script"),et(d),Ct(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},l.set(c,d))}}function kS(e,t){xa.M(e,t);var i=Us;if(i&&e){var l=oa(i).hoistableScripts,c=qs(e),d=l.get(c);d||(d=i.querySelector(Xr(c)),d||(e=g({src:e,async:!0,type:"module"},t),(t=bn.get(c))&&ff(e,t),d=i.createElement("script"),et(d),Ct(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},l.set(c,d))}}function Ng(e,t,i,l){var c=(c=de.current)?Fo(c):null;if(!c)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(t=Os(i.href),i=oa(c).hoistableStyles,l=i.get(t),l||(l={type:"style",instance:null,count:0,state:null},i.set(t,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=Os(i.href);var d=oa(c).hoistableStyles,y=d.get(e);if(y||(c=c.ownerDocument||c,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,y),(d=c.querySelector(Vr(e)))&&!d._p&&(y.instance=d,y.state.loading=5),bn.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},bn.set(e,i),d||DS(c,e,i,y.state))),t&&l===null)throw Error(r(528,""));return y}if(t&&l!==null)throw Error(r(529,""));return null;case"script":return t=i.async,i=i.src,typeof i=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=qs(i),i=oa(c).hoistableScripts,l=i.get(t),l||(l={type:"script",instance:null,count:0,state:null},i.set(t,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function Os(e){return'href="'+dt(e)+'"'}function Vr(e){return'link[rel="stylesheet"]['+e+"]"}function kg(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function DS(e,t,i,l){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?l.loading=1:(t=e.createElement("link"),l.preload=t,t.addEventListener("load",function(){return l.loading|=1}),t.addEventListener("error",function(){return l.loading|=2}),Ct(t,"link",i),et(t),e.head.appendChild(t))}function qs(e){return'[src="'+dt(e)+'"]'}function Xr(e){return"script[async]"+e}function Dg(e,t,i){if(t.count++,t.instance===null)switch(t.type){case"style":var l=e.querySelector('style[data-href~="'+dt(i.href)+'"]');if(l)return t.instance=l,et(l),l;var c=g({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return l=(e.ownerDocument||e).createElement("style"),et(l),Ct(l,"style",c),$o(l,i.precedence,e),t.instance=l;case"stylesheet":c=Os(i.href);var d=e.querySelector(Vr(c));if(d)return t.state.loading|=4,t.instance=d,et(d),d;l=kg(i),(c=bn.get(c))&&df(l,c),d=(e.ownerDocument||e).createElement("link"),et(d);var y=d;return y._p=new Promise(function(S,x){y.onload=S,y.onerror=x}),Ct(d,"link",l),t.state.loading|=4,$o(d,i.precedence,e),t.instance=d;case"script":return d=qs(i.src),(c=e.querySelector(Xr(d)))?(t.instance=c,et(c),c):(l=i,(c=bn.get(d))&&(l=g({},i),ff(l,c)),e=e.ownerDocument||e,c=e.createElement("script"),et(c),Ct(c,"link",l),e.head.appendChild(c),t.instance=c);case"void":return null;default:throw Error(r(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(l=t.instance,t.state.loading|=4,$o(l,i.precedence,e));return t.instance}function $o(e,t,i){for(var l=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=l.length?l[l.length-1]:null,d=c,y=0;y<l.length;y++){var S=l[y];if(S.dataset.precedence===t)d=S;else if(d!==c)break}d?d.parentNode.insertBefore(e,d.nextSibling):(t=i.nodeType===9?i.head:i,t.insertBefore(e,t.firstChild))}function df(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function ff(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Vo=null;function Lg(e,t,i){if(Vo===null){var l=new Map,c=Vo=new Map;c.set(i,l)}else c=Vo,l=c.get(i),l||(l=new Map,c.set(i,l));if(l.has(e))return l;for(l.set(e,null),i=i.getElementsByTagName(e),c=0;c<i.length;c++){var d=i[c];if(!(d[Si]||d[We]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var y=d.getAttribute(t)||"";y=e+y;var S=l.get(y);S?S.push(d):l.set(y,[d])}}return l}function Ug(e,t,i){e=e.ownerDocument||e,e.head.insertBefore(i,t==="title"?e.querySelector("head > title"):null)}function LS(e,t,i){if(i===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function Og(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var Kr=null;function US(){}function OS(e,t,i){if(Kr===null)throw Error(r(475));var l=Kr;if(t.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var c=Os(i.href),d=e.querySelector(Vr(c));if(d){e=d._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(l.count++,l=Xo.bind(l),e.then(l,l)),t.state.loading|=4,t.instance=d,et(d);return}d=e.ownerDocument||e,i=kg(i),(c=bn.get(c))&&df(i,c),d=d.createElement("link"),et(d);var y=d;y._p=new Promise(function(S,x){y.onload=S,y.onerror=x}),Ct(d,"link",i),t.instance=d}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(l.count++,t=Xo.bind(l),e.addEventListener("load",t),e.addEventListener("error",t))}}function qS(){if(Kr===null)throw Error(r(475));var e=Kr;return e.stylesheets&&e.count===0&&hf(e,e.stylesheets),0<e.count?function(t){var i=setTimeout(function(){if(e.stylesheets&&hf(e,e.stylesheets),e.unsuspend){var l=e.unsuspend;e.unsuspend=null,l()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(i)}}:null}function Xo(){if(this.count--,this.count===0){if(this.stylesheets)hf(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Ko=null;function hf(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Ko=new Map,t.forEach(zS,e),Ko=null,Xo.call(e))}function zS(e,t){if(!(t.state.loading&4)){var i=Ko.get(e);if(i)var l=i.get(null);else{i=new Map,Ko.set(e,i);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<c.length;d++){var y=c[d];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(i.set(y.dataset.precedence,y),l=y)}l&&i.set(null,l)}c=t.instance,y=c.getAttribute("data-precedence"),d=i.get(y)||l,d===l&&i.set(null,c),i.set(y,c),this.count++,l=Xo.bind(this),c.addEventListener("load",l),c.addEventListener("error",l),d?d.parentNode.insertBefore(c,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),t.state.loading|=4}}var Qr={$$typeof:j,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function BS(e,t,i,l,c,d,y,S){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ts(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ts(0),this.hiddenUpdates=ts(null),this.identifierPrefix=l,this.onUncaughtError=c,this.onCaughtError=d,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=S,this.incompleteTransitions=new Map}function qg(e,t,i,l,c,d,y,S,x,z,K,J){return e=new BS(e,t,i,y,S,x,z,J),t=1,d===!0&&(t|=24),d=en(3,null,null,t),e.current=d,d.stateNode=e,t=Xu(),t.refCount++,e.pooledCache=t,t.refCount++,d.memoizedState={element:l,isDehydrated:i,cache:t},Zu(d),e}function zg(e){return e?(e=hs,e):hs}function Bg(e,t,i,l,c,d){c=zg(c),l.context===null?l.context=c:l.pendingContext=c,l=$a(t),l.payload={element:i},d=d===void 0?null:d,d!==null&&(l.callback=d),i=Va(e,l,t),i!==null&&(rn(i,e,t),Ar(i,e,t))}function Hg(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function mf(e,t){Hg(e,t),(e=e.alternate)&&Hg(e,t)}function jg(e){if(e.tag===13){var t=fs(e,67108864);t!==null&&rn(t,e,67108864),mf(e,67108864)}}var Qo=!0;function HS(e,t,i,l){var c=D.T;D.T=null;var d=V.p;try{V.p=2,pf(e,t,i,l)}finally{V.p=d,D.T=c}}function jS(e,t,i,l){var c=D.T;D.T=null;var d=V.p;try{V.p=8,pf(e,t,i,l)}finally{V.p=d,D.T=c}}function pf(e,t,i,l){if(Qo){var c=gf(l);if(c===null)tf(e,t,l,Po,i),Ig(e,l);else if(IS(c,e,t,i,l))l.stopPropagation();else if(Ig(e,l),t&4&&-1<GS.indexOf(e)){for(;c!==null;){var d=Ba(c);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var y=qn(d.pendingLanes);if(y!==0){var S=d;for(S.pendingLanes|=2,S.entangledLanes|=2;y;){var x=1<<31-_t(y);S.entanglements[1]|=x,y&=~x}$n(d),(Le&6)===0&&(Lo=ce()+500,Ir(0))}}break;case 13:S=fs(d,2),S!==null&&rn(S,d,2),Oo(),mf(d,2)}if(d=gf(l),d===null&&tf(e,t,l,Po,i),d===c)break;c=d}c!==null&&l.stopPropagation()}else tf(e,t,l,null,i)}}function gf(e){return e=Su(e),yf(e)}var Po=null;function yf(e){if(Po=null,e=ra(e),e!==null){var t=u(e);if(t===null)e=null;else{var i=t.tag;if(i===13){if(e=f(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Po=e,null}function Gg(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_e()){case Ge:return 2;case qe:return 8;case bt:case dn:return 32;case Qt:return 268435456;default:return 32}default:return 32}}var bf=!1,si=null,ri=null,li=null,Pr=new Map,Zr=new Map,oi=[],GS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ig(e,t){switch(e){case"focusin":case"focusout":si=null;break;case"dragenter":case"dragleave":ri=null;break;case"mouseover":case"mouseout":li=null;break;case"pointerover":case"pointerout":Pr.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zr.delete(t.pointerId)}}function Jr(e,t,i,l,c,d){return e===null||e.nativeEvent!==d?(e={blockedOn:t,domEventName:i,eventSystemFlags:l,nativeEvent:d,targetContainers:[c]},t!==null&&(t=Ba(t),t!==null&&jg(t)),e):(e.eventSystemFlags|=l,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function IS(e,t,i,l,c){switch(t){case"focusin":return si=Jr(si,e,t,i,l,c),!0;case"dragenter":return ri=Jr(ri,e,t,i,l,c),!0;case"mouseover":return li=Jr(li,e,t,i,l,c),!0;case"pointerover":var d=c.pointerId;return Pr.set(d,Jr(Pr.get(d)||null,e,t,i,l,c)),!0;case"gotpointercapture":return d=c.pointerId,Zr.set(d,Jr(Zr.get(d)||null,e,t,i,l,c)),!0}return!1}function Yg(e){var t=ra(e.target);if(t!==null){var i=u(t);if(i!==null){if(t=i.tag,t===13){if(t=f(i),t!==null){e.blockedOn=t,Gl(e.priority,function(){if(i.tag===13){var l=sn();l=rr(l);var c=fs(i,l);c!==null&&rn(c,i,l),mf(i,l)}});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Zo(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=gf(e.nativeEvent);if(i===null){i=e.nativeEvent;var l=new i.constructor(i.type,i);vu=l,i.target.dispatchEvent(l),vu=null}else return t=Ba(i),t!==null&&jg(t),e.blockedOn=i,!1;t.shift()}return!0}function Fg(e,t,i){Zo(e)&&i.delete(t)}function YS(){bf=!1,si!==null&&Zo(si)&&(si=null),ri!==null&&Zo(ri)&&(ri=null),li!==null&&Zo(li)&&(li=null),Pr.forEach(Fg),Zr.forEach(Fg)}function Jo(e,t){e.blockedOn===t&&(e.blockedOn=null,bf||(bf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,YS)))}var Wo=null;function $g(e){Wo!==e&&(Wo=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Wo===e&&(Wo=null);for(var t=0;t<e.length;t+=3){var i=e[t],l=e[t+1],c=e[t+2];if(typeof l!="function"){if(yf(l||i)===null)continue;break}var d=Ba(i);d!==null&&(e.splice(t,3),t-=3,gd(d,{pending:!0,data:c,method:i.method,action:l},l,c))}}))}function Wr(e){function t(x){return Jo(x,e)}si!==null&&Jo(si,e),ri!==null&&Jo(ri,e),li!==null&&Jo(li,e),Pr.forEach(t),Zr.forEach(t);for(var i=0;i<oi.length;i++){var l=oi[i];l.blockedOn===e&&(l.blockedOn=null)}for(;0<oi.length&&(i=oi[0],i.blockedOn===null);)Yg(i),i.blockedOn===null&&oi.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(l=0;l<i.length;l+=3){var c=i[l],d=i[l+1],y=c[ut]||null;if(typeof d=="function")y||$g(i);else if(y){var S=null;if(d&&d.hasAttribute("formAction")){if(c=d,y=d[ut]||null)S=y.formAction;else if(yf(c)!==null)continue}else S=y.action;typeof S=="function"?i[l+1]=S:(i.splice(l,3),l-=3),$g(i)}}}function vf(e){this._internalRoot=e}ec.prototype.render=vf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(r(409));var i=t.current,l=sn();Bg(i,l,e,t,null,null)},ec.prototype.unmount=vf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Bg(e.current,2,null,e,null,null),Oo(),t[sa]=null}};function ec(e){this._internalRoot=e}ec.prototype.unstable_scheduleHydration=function(e){if(e){var t=jl();e={blockedOn:null,target:e,priority:t};for(var i=0;i<oi.length&&t!==0&&t<oi[i].priority;i++);oi.splice(i,0,e),i===0&&Yg(e)}};var Vg=a.version;if(Vg!=="19.1.1")throw Error(r(527,Vg,"19.1.1"));V.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=m(t),e=e!==null?p(e):null,e=e===null?null:e.stateNode,e};var FS={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tc.isDisabled&&tc.supportsFiber)try{Xe=tc.inject(FS),Qe=tc}catch{}}return rl.createRoot=function(e,t){if(!o(e))throw Error(r(299));var i=!1,l="",c=o0,d=c0,y=u0,S=null;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(l=t.identifierPrefix),t.onUncaughtError!==void 0&&(c=t.onUncaughtError),t.onCaughtError!==void 0&&(d=t.onCaughtError),t.onRecoverableError!==void 0&&(y=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(S=t.unstable_transitionCallbacks)),t=qg(e,1,!1,null,null,i,l,c,d,y,S,null),e[sa]=t.current,ef(e),new vf(t)},rl.hydrateRoot=function(e,t,i){if(!o(e))throw Error(r(299));var l=!1,c="",d=o0,y=c0,S=u0,x=null,z=null;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(d=i.onUncaughtError),i.onCaughtError!==void 0&&(y=i.onCaughtError),i.onRecoverableError!==void 0&&(S=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(x=i.unstable_transitionCallbacks),i.formState!==void 0&&(z=i.formState)),t=qg(e,1,!0,t,i??null,l,c,d,y,S,x,z),t.context=zg(null),i=t.current,l=sn(),l=rr(l),c=$a(l),c.callback=null,Va(i,c,l),i=l,t.current.lanes=i,zn(t,i),$n(t),e[sa]=t.current,ef(e),new ec(t)},rl.version="19.1.1",rl}var Yy;function I3(){if(Yy)return qf.exports;Yy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(a){console.error(a)}}return n(),qf.exports=G3(),qf.exports}var Y3=I3(),mt=nm();const fc=10,F3=1.5,$3=1.5,Fy=1,V3=.6,$y="⚔️ +50% attack · 🛡️ Barrier · ♾️ Immortal",$i=5,Vi=3;let pt=null;function X3(){pt&&(pt.tickTimer&&clearInterval(pt.tickTimer),pt.timeout&&clearTimeout(pt.timeout),pt=null)}function am(){return pt!==null}function Sb(){return pt?Math.max(0,pt.endTime-performance.now())/1e3:0}function K3(n,a){if(am()||!n.spendResource($i,ie.SISU))return!1;const s=[];for(const o of a){if(o.faction!=="player"||o.isDead())continue;const u=`sisu-burst-${o.id}`,f={unit:o,attackDelta:0,movementDelta:0,shieldBonusApplied:Fy,shieldBonusRemaining:Fy,wasImmortal:o.isImmortal()};oM({id:u,duration:fc,data:f,onApply:()=>{const h=o.stats.attackDamage,m=Math.round(h*F3);f.attackDelta=Math.max(0,m-h),f.attackDelta!==0&&(o.stats.attackDamage=h+f.attackDelta);const p=o.stats.movementRange,g=Math.max(1,Math.round(p*$3));f.movementDelta=Math.max(0,g-p),f.movementDelta!==0&&(o.stats.movementRange=p+f.movementDelta),f.shieldBonusRemaining=f.shieldBonusApplied,o.setShield(o.getShield()+f.shieldBonusApplied),o.setImmortal(!0),o.fearless=!0},onExpire:()=>{let h=!1;if(f.attackDelta!==0){const p=o.stats.attackDamage,g=Math.max(0,p-f.attackDelta);g!==p&&(o.stats.attackDamage=g,h=!0)}if(f.movementDelta!==0){const p=o.stats.movementRange,g=Math.max(0,p-f.movementDelta);g!==p&&(o.stats.movementRange=g,h=!0)}o.setImmortal(f.wasImmortal);const m=Math.max(0,Math.min(f.shieldBonusApplied,f.shieldBonusRemaining));m>0&&o.setShield(Math.max(0,o.getShield()-m)),delete o.fearless,h&&ne.emit("unit:stats:changed",{unitId:o.id,stats:{...o.stats}}),pt&&(pt.affected=pt.affected.filter(p=>p.modifierId!==u))},hooks:{"combat:onHit":h=>{const m=h;if(m.source!=="defender"||m.defender.id!==o.id||m.shieldDamage<=0||f.shieldBonusRemaining<=0)return;const p=Math.min(f.shieldBonusRemaining,m.shieldDamage);f.shieldBonusRemaining=Math.max(0,f.shieldBonusRemaining-p)}}}),s.push({unit:o,modifierId:u,state:f})}return pt={endTime:performance.now()+fc*1e3,status:$y,affected:s,tickTimer:null,timeout:null},ne.emit("sisuBurstStart",{remaining:fc,status:$y}),pt.tickTimer=setInterval(()=>{if(!pt)return;const o=Math.max(0,Math.ceil(Sb()));o>0&&ne.emit("sisuBurstTick",{remaining:o,status:pt.status})},1e3),pt.timeout=setTimeout(()=>{Q3()},fc*1e3),!0}function Q3(){if(pt){for(const n of pt.affected)cM(n.modifierId);X3(),ne.emit("sisuBurstEnd",{})}}function P3(n,a,s,r){const o=a.filter(u=>u.faction==="player"&&!u.isDead());if(o.length===0||!n.spendResource(Vi,ie.SISU))return!1;for(const u of o){const f=eb(s,3,a)??{...s};u.setCoord(f);const h=Math.round(u.getMaxHealth()*V3);u.stats.health=Math.min(u.getMaxHealth(),Math.max(u.stats.health,h))}return r.revealAround(s,3,{autoFrame:!1}),ne.emit("torilleRecalled",{count:o.length}),!0}let Pi=!1;function Eb(){return Pi}function Mb(n){Pi!==n&&(Pi=n,ne.emit("game:pause-changed",{paused:Pi}))}function Z3(){return Mb(!Pi),Pi}function J3(){Pi&&Mb(!1)}const W3=["/assets/sounds/sauna-forest.ogg","/assets/sounds/sauna-forest.mp3"],xb="audio_enabled",vh=new Set,ru=new Set;let Xi=null,hc=null,Aa=null,bl=null;function ex(n){if(typeof localStorage>"u")return null;try{return localStorage.getItem(n)}catch(a){return console.warn("Unable to read ambience preference",n,a),null}}const wb=ex(xb);let Ua=wb==="true",vl=wb!==null;const Sh=nu();let _c=Cb(Sh.channels.music.volume,.65),Zi=!1,ea=Sh.channels.master.muted||Sh.channels.music.muted;const js=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)"):null;let Ab=js?.matches??!1;if(js){const n=a=>{Ab=a.matches};typeof js.addEventListener=="function"?js.addEventListener("change",n):typeof js.addListener=="function"&&js.addListener(n)}if(typeof window<"u"&&!vl){const n=()=>{vl||(vl=!0,kb(!0),lu())};window.addEventListener("pointerdown",n,{once:!0}),window.addEventListener("keydown",n,{once:!0})}Gh(n=>{const a=Cb(n.channels.music.volume,_c),s=n.channels.master.muted||n.channels.music.muted,r=Math.abs(a-_c)>5e-4;if(_c=a,s!==ea){ea=s,ea?Nb():Ua?lu():(Cl(!0),Al());return}r&&Al()});function Cb(n,a){return Number.isFinite(n)?n<0?0:n>1?1:n:a}function Al(){const n=Db();for(const a of vh)a(n)}function tx(n){if(!(typeof localStorage>"u"))try{localStorage.setItem(xb,n?"true":"false")}catch(a){console.warn("Unable to persist ambience preference",a)}}function Tb(n){if(Aa)return Aa;const a=n.createGain();a.gain.value=Ua&&!ea?1:0;const s=jh("music");return s?a.connect(s):a.connect(n.destination),Aa=a,a}function Cl(n=!1){if(!Aa)return;const a=Aa.context,s=Ua&&!ea?1:0,r=a.currentTime;Aa.gain.cancelScheduledValues(r),n?Aa.gain.setValueAtTime(s,r):Aa.gain.setTargetAtTime(s,r,.25)}function nx(){return Ab?.6:4.2}function _b(){bl!==null&&(clearTimeout(bl),bl=null)}function Eh(n){try{n.source.stop()}catch{}n.source.disconnect(),n.gain.disconnect(),ru.delete(n)}function ax(){for(const n of[...ru])Eh(n)}async function ix(n){return Xi||(hc||(hc=(async()=>{for(const a of W3)try{const s=await fetch(a);if(!s.ok)continue;const r=await s.arrayBuffer();return await n.decodeAudioData(r)}catch(s){console.warn("Failed to fetch ambience source",a,s)}throw new Error("No ambience sources available")})().then(a=>(Xi=a,a)).catch(a=>{throw hc=null,a})),hc)}function sx(n,a){if(!Zi)return;_b();const s=Math.max(0,n-a.currentTime-.05);bl=setTimeout(()=>{bl=null,Zi&&Rb(n)},s*1e3)}function Rb(n){const a=Aa?.context??Lb();if(!a||!Xi)return;const s=a.createGain(),r=a.createBufferSource();r.buffer=Xi,r.loop=!1,r.connect(s),s.connect(Tb(a));const o=Math.min(nx(),Xi.duration/2),u=Number.isFinite(o)&&o>0?o:.25,f=Math.max(a.currentTime,n);s.gain.setValueAtTime(0,f),s.gain.linearRampToValueAtTime(1,f+u);const h=n+Xi.duration,m=h-u;m>f&&s.gain.setValueAtTime(1,m),s.gain.linearRampToValueAtTime(.001,h+.1);const p={source:r,gain:s,stopTime:h};ru.add(p),r.addEventListener("ended",()=>{Eh(p)});try{r.start(n)}catch(g){console.warn("Failed to start ambience layer",g),Eh(p);return}sx(h-u,a)}async function lu(){if(Zi||!Ua||ea){Cl();return}const n=Lb();if(n){Tb(n),Cl();try{const a=await ix(n);if(!Ua||ea)return;await n.resume().catch(()=>{}),Zi=!0;const s=Math.max(n.currentTime+.12,n.currentTime);Rb(s),Al()}catch(a){console.warn("Unable to start ambience",a)}}}function Nb(){if(!Zi&&ru.size===0){Cl(!0);return}Zi=!1,_b(),ax(),Cl(!0),Al()}function kb(n){Ua===n&&vl||(Ua=n,vl=!0,tx(n),n?ea||lu():Nb(),Al())}function Db(){return{enabled:Ua,playing:Zi,volume:_c,globallyMuted:ea}}function rx(n){return vh.add(n),()=>{vh.delete(n)}}Ua&&!ea&&lu();function Lb(){return Hh()}const lx='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',Gf={master:"Master mix",music:"Ambience soundscape",sfx:"Effects & interface"},ox={master:"Controls the overall loudness for every channel in the frontier.",music:"Shapes the ambience loops and atmospheric swells around the sauna.",sfx:"Balances unit callouts, UI clicks, and battle feedback cues."},cx="linear-gradient(90deg, rgba(59,130,246,0.85) 0%, rgba(14,165,233,0.9) VAR%, rgba(148,163,184,0.35) VAR%, rgba(71,85,105,0.2) 100%)";function Mh(n,a){n.style.backgroundImage=cx.replace(/VAR/g,`${a}%`)}function xh(n){return`${Math.round(n)}%`}function ux(n,a,s){const r=o=>{if(o.key==="Escape"){o.preventDefault(),s();return}if(o.key!=="Tab")return;const u=a.querySelectorAll(lx);if(u.length===0){o.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;o.shiftKey?(m===f||!a.contains(m))&&(o.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(o.preventDefault(),f.focus())};return n.addEventListener("keydown",r),()=>n.removeEventListener("keydown",r)}function Ub(n,a,s){const r=a.channels[n],o=a.channels.master;if(n==="music"&&!s.enabled)return"Ambience paused";if(r.muted)return"Muted at mixer";if(n!=="master"&&o.muted)return"Master mute active";const u=Math.round(r.effectiveVolume*100);return u<=0?"Output silent":n==="master"?`Master output ${u}%`:n==="music"?`Soundscape live ${u}%`:`Effects live ${u}%`}function If(n,a,s,r,o,u,f){const h=n.createElement("section");h.className="rounded-hud-xl border border-white/12 bg-[linear-gradient(155deg,rgba(15,26,56,0.92),rgba(9,14,34,0.96))] p-5 shadow-[0_24px_45px_rgba(4,10,25,0.55)] backdrop-blur-[18px] backdrop-saturate-[140%]";const m=n.createElement("header");m.className="flex flex-wrap items-start justify-between gap-3";const p=n.createElement("div");p.className="space-y-1";const g=n.createElement("h3");g.className="text-lg font-semibold tracking-tight text-white",g.textContent=Gf[a];const b=n.createElement("p");b.className="max-w-[32ch] text-sm text-slate-300/85",b.textContent=ox[a],p.append(g,b);const v=n.createElement("span");v.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70",v.textContent=Ub(a,s,r),m.append(p,v);const E=n.createElement("div");E.className="mt-5 flex items-center gap-4";const M=n.createElement("input");M.type="range",M.min="0",M.max="100",M.step="1",M.className="h-2 flex-1 appearance-none rounded-full bg-slate-600/30 accent-accent transition-[background-image] duration-200 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",M.setAttribute("aria-label",`${Gf[a]} level`);const C=n.createElement("span");C.className="text-sm font-semibold text-slate-200",E.append(M,C);const R=n.createElement("div");R.className="mt-4 flex flex-wrap items-center gap-3";const N=n.createElement("button");if(N.type="button",N.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/60 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-white/80 transition-all duration-150 ease-out hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",N.setAttribute("aria-label",`Toggle mute for ${Gf[a]}`),N.addEventListener("click",()=>{const F=!Yi.channels[a].muted;o(a,F)}),R.append(N),a==="sfx"){const F=n.createElement("button");F.type="button",F.className="inline-flex items-center gap-2 rounded-full border border-accent/40 bg-accent/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-accent-200 transition-all duration-150 ease-out hover:bg-accent/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",F.textContent="Play sample",F.addEventListener("click",()=>{Wn("spawn")}),R.append(F)}let q;a==="music"&&f&&(q=n.createElement("button"),q.type="button",q.className="inline-flex items-center gap-2 rounded-full border border-emerald-300/25 bg-emerald-400/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-emerald-200 transition-all duration-150 ease-out hover:bg-emerald-400/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300",q.addEventListener("click",()=>{f()}),R.append(q));const j=Math.round(s.channels[a].volume*100);return M.value=String(j),Mh(M,j),C.textContent=xh(j),N.setAttribute("aria-pressed",s.channels[a].muted?"true":"false"),N.textContent=s.channels[a].muted?"Muted":"Active",a==="music"&&(M.title=r.enabled?"Adjust ambience loudness":"Ambience paused — set the level ahead of resuming."),M.addEventListener("input",()=>{const F=Number(M.value);Mh(M,F),C.textContent=xh(F),u(a,F/100)}),h.append(m,E,R),{card:h,slider:M,value:C,muteButton:N,status:v,ambienceToggle:q}}let Yi=nu();function dx(n){const{container:a,onClose:s}=n;if(!a)return{destroy(){},focus(){}};const r=a.ownerDocument??document,o=r.createElement("div");o.className="pointer-events-auto fixed inset-0 z-[1200] flex items-center justify-center bg-slate-950/75 p-4 backdrop-blur-[22px] backdrop-saturate-[140%]",o.setAttribute("role","presentation");const u=r.createElement("section");u.className="w-full max-w-[min(580px,92vw)] space-y-6 rounded-hud-xl border border-white/12 bg-[linear-gradient(145deg,rgba(12,22,45,0.95),rgba(7,13,29,0.97))] p-6 text-slate-100 shadow-[0_32px_60px_rgba(4,10,24,0.7)] backdrop-blur-[24px] backdrop-saturate-[150%]",u.setAttribute("role","dialog"),u.setAttribute("aria-modal","true");const f=`audio-mixer-title-${Date.now()}`;u.setAttribute("aria-labelledby",f),u.tabIndex=-1;const h=r.createElement("header");h.className="flex items-start justify-between gap-4";const m=r.createElement("div");m.className="space-y-1";const p=r.createElement("h2");p.id=f,p.className="text-2xl font-semibold tracking-tight text-white",p.textContent="Audio mixer";const g=r.createElement("p");g.className="max-w-[46ch] text-sm text-slate-300/85",g.textContent="Dial in the master bus, ambience beds, and tactical feedback without leaving the battlefield.",m.append(p,g);const b=r.createElement("button");b.type="button",b.className="rounded-full border border-white/20 bg-slate-800/70 px-3 py-1 text-sm font-semibold text-white/70 transition-all duration-150 hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",b.textContent="Close",h.append(m,b);const v=r.createElement("span");v.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70";const E=r.createElement("div");E.className="space-y-5";let M=Db();const C={master:If(r,"master",Yi,M,(I,T)=>{LE(T)},(I,T)=>{NE(T)},null),music:If(r,"music",Yi,M,(I,T)=>{UE(T)},(I,T)=>{kE(T)},()=>{kb(!M.enabled)}),sfx:If(r,"sfx",Yi,M,(I,T)=>{OE(T)},(I,T)=>{DE(T)},null)};E.append(C.master.card,C.music.card,C.sfx.card),u.append(h,v,E),o.append(u),a.append(o);let R=!1;function N(){const I=C.music.ambienceToggle;I&&(I.setAttribute("aria-pressed",M.enabled?"true":"false"),I.textContent=M.enabled?"Ambience enabled":"Ambience paused",I.title=M.enabled?"Disable ambience loops":"Enable ambience loops")}function q(I){Yi=I;const T=I.contextState==="uninitialized"?"Context idle":I.contextState==="running"?"Context running":"Context suspended";v.textContent=T,["master","music","sfx"].forEach(k=>{const A=C[k],Y=I.channels[k],B=Math.round(Y.volume*100);A.slider.value=String(B),Mh(A.slider,B),A.value.textContent=xh(B),A.muteButton.setAttribute("aria-pressed",Y.muted?"true":"false"),A.muteButton.textContent=Y.muted?"Muted":"Active",A.status.textContent=Ub(k,I,M),k==="music"&&(A.slider.title=M.enabled?"Adjust ambience loudness":"Ambience paused — set the level ahead of resuming.")}),N()}function j(){R||(R=!0,F(),o.parentElement&&o.remove(),s?.())}function F(){Q.forEach(I=>{try{I()}catch{}}),Q.length=0}const Q=[],se=I=>{I.target===o&&j()};o.addEventListener("click",se),Q.push(()=>o.removeEventListener("click",se)),b.addEventListener("click",j),Q.push(()=>b.removeEventListener("click",j));const ee=ux(o,u,j);Q.push(ee);const le=Gh(I=>{q(I)});Q.push(le);const P=rx(I=>{M=I,N(),q(Yi)});return Q.push(P),q(Yi),u.focus(),{destroy(){j()},focus(){u.focus()}}}function Vy(...n){return n.filter(Boolean).join(" ")}function Xy(n,a){return!(n.code!==a.code||(a.shift??!1)!==n.shiftKey||(a.alt??!1)!==n.altKey||(a.meta??!1)!==n.metaKey||(a.ctrl??!1)!==n.ctrlKey)}function fx(n){return!Number.isFinite(n)||n<=0?"0s":`${Math.max(0,Math.ceil(n))}s`}function hx(){const[n,a]=mt.useState(()=>{const s=am();return{active:s,remaining:s?Math.ceil(Sb()):0,status:s?"Burst active":void 0}});return mt.useEffect(()=>{const s=({remaining:u,status:f})=>{a({active:!0,remaining:Math.ceil(u),status:f})},r=({remaining:u,status:f})=>{a(h=>({active:!0,remaining:Math.ceil(u),status:f??h.status}))},o=()=>{a({active:!1,remaining:0,status:void 0})};return ne.on("sisuBurstStart",s),ne.on("sisuBurstTick",r),ne.on("sisuBurstEnd",o),()=>{ne.off("sisuBurstStart",s),ne.off("sisuBurstTick",r),ne.off("sisuBurstEnd",o)}},[]),n}function mx(){const[n,a]=mt.useState(()=>Eb());return mt.useEffect(()=>{const s=({paused:r})=>{a(r)};return ne.on("game:pause-changed",s),()=>{ne.off("game:pause-changed",s)}},[]),n}function Ky(n){const a=n.target;if(!a)return!1;const s=a.tagName;return!!(s==="INPUT"||s==="TEXTAREA"||s==="SELECT"||a.isContentEditable)}function px({state:n,abilities:a}){const[s,r]=mt.useState(()=>n.getResource(ie.SISU)),[o,u]=mt.useState(()=>dh()),[f,h]=mt.useState(!1),[m,p]=mt.useState(null),g=mt.useRef({}),[b,v]=mt.useState(()=>new Set),E=hx(),M=mx(),C=mt.useRef(null),R=mt.useCallback(T=>{v(A=>{const Y=new Set(A);return Y.add(T),Y});const k=g.current[T];k&&window.clearTimeout(k),g.current[T]=window.setTimeout(()=>{v(A=>{const Y=new Set(A);return Y.delete(T),Y}),delete g.current[T]},650)},[]);mt.useEffect(()=>{const T=({resource:k,total:A})=>{k===ie.SISU&&r(A)};return ne.on("resourceChanged",T),()=>{ne.off("resourceChanged",T),Object.values(g.current).forEach(k=>{k&&window.clearTimeout(k)}),g.current={}}},[]),mt.useEffect(()=>iM(u),[]),mt.useEffect(()=>()=>{C.current?.destroy(),C.current=null},[]);const N=mt.useCallback(()=>{const T=document.getElementById("ui-overlay");if(!T)return!1;if(C.current)return C.current.destroy(),C.current=null,h(!1),!0;const k=dx({container:T,onClose:()=>{C.current=null,h(!1)}});return C.current=k,h(!0),k.focus(),!0},[]),q=a.useSisuBurst,j=a.torille,F=a.onOpenBuildPlanner,Q=!q||E.active||s<$i,se=q?E.active?"Burst already surging.":s<$i?`Requires ${$i} SISU.`:void 0:"Burst controls offline in this build.",ee=!j||s<Vi,le=j?s<Vi?`Requires ${Vi} SISU.`:void 0:"Torille rally is unavailable right now.",P=mt.useMemo(()=>[{id:"burst",icon:"⚡️",label:"Sisu Burst",description:"Ignite a surge of fury and resilience across your warriors.",hotkey:{code:"KeyQ",label:"Q"},accent:"primary",cost:`-${$i} SISU`,detail:E.active?`${E.status??"Burst active"} · ${fx(E.remaining)}`:void 0,blocked:Q,blockedReason:se,interactive:!!q,onActivate:()=>q?q():!1},{id:"torille",icon:"📣",label:"Torille!",description:"Call every survivor home to the sauna to regroup and heal.",hotkey:{code:"KeyW",label:"W"},accent:"primary",cost:`-${Vi} SISU`,blocked:ee,blockedReason:le,interactive:!!j,onActivate:()=>j?j():!1},{id:"build",icon:"🛠️",label:"Build",description:"Draft new structures to reinforce your frontier.",hotkey:{code:"KeyE",label:"E"},accent:"neutral",blocked:!F,blockedReason:F?void 0:"Construction planner will unlock in a forthcoming update.",interactive:!!F,onActivate:()=>F?F()??!0:!1},{id:"sound",icon:o?"🔇":f?"🎚️":"🎛️",label:"Audio",description:"Open the in-game mixer to balance master, ambience, and effects.",hotkey:{code:"KeyR",label:"R"},accent:"neutral",toggled:f,detail:f?"Mixer open":o?"Muted":"Live mix",interactive:!0,blocked:!1,onActivate:()=>!!N()},{id:"pause",icon:M?"⏸️":"▶️",label:M?"Paused":"Pause",description:M?"Time is frozen — resume when your strategy is ready.":"Freeze the battlefield to reassess and issue commands.",hotkey:{code:"Space",label:"Space"},accent:"neutral",toggled:M,detail:M?"Combat frozen":"Time flowing",interactive:!0,blocked:!1,onActivate:()=>(Z3(),!0)}],[E.active,E.remaining,Q,se,j,f,o,F,M,ee,le,q]),I=mt.useCallback(T=>{if(!T.interactive){R(T.id);return}if(T.blocked){R(T.id);return}T.onActivate?.()===!1&&R(T.id)},[R]);return mt.useEffect(()=>{const T=A=>{if(A.repeat||Ky(A))return;const Y=P.find(B=>Xy(A,B.hotkey));Y&&(A.preventDefault(),p(Y.id),I(Y))},k=A=>{if(Ky(A))return;const Y=P.find(B=>Xy(A,B.hotkey));Y&&(A.preventDefault(),p(B=>B===Y.id?null:B))};return window.addEventListener("keydown",T),window.addEventListener("keyup",k),()=>{window.removeEventListener("keydown",T),window.removeEventListener("keyup",k)}},[P,I]),Xt.jsx("div",{className:"pointer-events-none w-full",children:Xt.jsx("div",{className:"pointer-events-auto mx-auto flex w-full max-w-4xl flex-col gap-4 rounded-[26px] border border-white/10 bg-[linear-gradient(145deg,rgba(11,17,30,0.86),rgba(6,10,18,0.92))] p-6 shadow-[0_26px_65px_rgba(6,12,24,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)] backdrop-blur-xl","aria-label":"Combat and systems action bar",children:Xt.jsx("div",{className:"flex flex-wrap items-stretch justify-center gap-4",children:P.map(T=>{const k=m===T.id,A=b.has(T.id),B=(T.blocked??!1)||!T.interactive,D=T.detail??T.blockedReason,V=Vy("group relative flex min-w-[150px] flex-1 flex-col gap-2 rounded-[20px] border border-white/10 px-5 py-4 text-left transition-all duration-200 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70 focus-visible:ring-offset-0","bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.22),rgba(14,25,45,0.6))] shadow-[0_18px_42px_rgba(8,25,53,0.55)]",T.accent==="primary"&&"border-sky-300/40 bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.32),rgba(11,22,45,0.7))]",T.accent==="danger"&&"border-rose-400/45 bg-[radial-gradient(circle_at_top,rgba(244,114,182,0.32),rgba(45,9,25,0.75))]",k&&"ring-2 ring-sky-300/80 ring-offset-0 translate-y-[-2px] shadow-[0_24px_48px_rgba(56,189,248,0.45)]",A&&'animate-hud-shake after:pointer-events-none after:absolute after:inset-0 after:rounded-[inherit] after:border after:border-rose-300/45 after:bg-[radial-gradient(circle_at_center,rgba(248,113,113,0.18),rgba(248,113,113,0))] after:content-[""] after:animate-hud-pulse',!B&&!k&&"hover:-translate-y-1 hover:shadow-[0_24px_50px_rgba(56,189,248,0.4)]",B&&"cursor-not-allowed opacity-70",T.toggled&&"border-sky-400/60 shadow-[0_0_36px_rgba(56,189,248,0.45)]");return Xt.jsxs("button",{type:"button",className:V,"aria-pressed":T.toggled?"true":void 0,"aria-disabled":B?"true":void 0,"data-hotkey":T.hotkey.label,onClick:te=>{if(B){te.preventDefault(),R(T.id);return}I(T)},onKeyDown:te=>{(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),I(T))},title:Vy(T.description,T.blockedReason),children:[Xt.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Xt.jsxs("span",{className:"flex items-center gap-3 text-base font-semibold uppercase tracking-[0.18em] text-slate-100",children:[Xt.jsx("span",{"aria-hidden":"true",className:"text-2xl",children:T.icon}),T.label]}),Xt.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-slate-300/80",children:T.hotkey.label})]}),Xt.jsx("p",{className:"text-sm leading-relaxed text-slate-200/80",children:T.description}),Xt.jsxs("div",{className:"flex items-center justify-between text-xs font-medium uppercase tracking-[0.28em] text-slate-300/70",children:[Xt.jsx("span",{children:D??"​"}),T.cost?Xt.jsx("span",{className:"text-slate-200/90",children:T.cost}):Xt.jsx("span",{className:"opacity-0",children:"cost"})]})]},T.id)})})})})}function gx(n,a,s={}){const r=ar(a),o=a.ownerDocument.createElement("div");o.dataset.component="action-bar",o.dataset.tutorialTarget="combat",o.className="flex w-full justify-center";const u=r.regions.bottom,f=u.querySelector("#build-id");f?u.insertBefore(o,f):u.appendChild(o);const h=Y3.createRoot(o);return h.render(Xt.jsx(px,{state:n,abilities:s})),{destroy(){h.unmount(),o.remove()}}}const yx="(max-width: 820px)",Ob="is-mobile",qb="is-desktop";let Tn=null,jc=null,Qn=!1,mc=0;const Gc=new Set,wh=new Set,Ic=n=>{for(const a of wh)a.classList.toggle(Ob,n),a.classList.toggle(qb,!n),a.dataset.viewport=n?"mobile":"desktop"},bx=n=>{if(Qn!==n){Qn=n,Ic(Qn);for(const a of Array.from(Gc))try{a(Qn)}catch(s){console.error("Failed to notify mobile listener",s)}}},zb=()=>{if(Tn||typeof window>"u")return;Tn=window.matchMedia(yx),Qn=Tn.matches,Ic(Qn);const n=a=>{bx(a.matches)};typeof Tn.addEventListener=="function"?(Tn.addEventListener("change",n),jc=()=>Tn?.removeEventListener("change",n)):(Tn.addListener(n),jc=()=>Tn?.removeListener(n))},vx=()=>{Tn&&(jc?.(),jc=null,Tn=null)},Bb=(n,{immediate:a=!0}={})=>(zb(),Gc.add(n),a&&n(Qn),()=>{Gc.delete(n)}),Sx=({root:n,onChange:a,immediate:s=!0}={})=>{zb();const r=n??(typeof document<"u"?document.documentElement:null);r&&(wh.add(r),Ic(Qn)),mc+=1;let o=null;return a?o=Bb(a,{immediate:s}):s&&Tn&&Ic(Qn),{matches:()=>Qn,dispose:()=>{r&&(wh.delete(r),r.classList.remove(Ob,qb),(r.dataset.viewport==="mobile"||r.dataset.viewport==="desktop")&&delete r.dataset.viewport),o&&(o(),o=null),mc=Math.max(0,mc-1),mc===0&&Gc.size===0&&vx()}}};function Ex(n){const a=[n.name];return n.description&&a.push(n.description),n.rarity&&a.push(`Rarity: ${n.rarity}`),n.quantity>1&&a.push(`Quantity: ${n.quantity}`),a.join(" — ")}function Mx(n){const a=document.createElement("span");a.classList.add("item-icon__fallback");const s=n.trim();return a.textContent=s?s[0]?.toUpperCase()??"?":"?",a.setAttribute("aria-hidden","true"),a}function xx(n,a){const s=document.createElement("img");return s.src=n,s.alt="",s.decoding="async",s.loading="lazy",s.classList.add("item-icon__image"),s.setAttribute("aria-hidden","true"),s.title=a,s}function wx(n){const a=document.createElement("li");a.classList.add("item-icon"),a.dataset.itemId=n.id;const s=Ex(n);if(a.title=s,a.setAttribute("aria-label",s),a.setAttribute("role","listitem"),n.rarity&&(a.dataset.rarity=n.rarity.toLowerCase()),n.icon&&n.icon.trim().length>0?a.appendChild(xx(n.icon,n.name)):a.appendChild(Mx(n.name)),n.quantity>1){const r=document.createElement("span");r.classList.add("item-icon__quantity"),r.textContent=`×${n.quantity}`,r.setAttribute("aria-hidden","true"),a.appendChild(r)}return a}const Ax=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Ah(n){return n===1/0?"∞":!Number.isFinite(n)||n<=0?"0s":`${Ax.format(Math.ceil(n))}s`}function Cx(n){const a=[n.name];return n.description&&a.push(n.description),n.source&&a.push(`Source: ${n.source}`),n.duration!==1/0&&a.push(`Duration: ${Ah(n.duration)}`),a.push(`Remaining: ${Ah(n.remaining)}`),n.stacks&&n.stacks>1&&a.push(`Stacks: ${n.stacks}`),a.join(" — ")}function Tx(n){const a=document.createElement("li");a.classList.add("mod-pill"),a.dataset.modifierId=n.id,a.title=Cx(n),a.setAttribute("aria-label",a.title),a.setAttribute("role","listitem"),a.dataset.duration=n.duration===1/0?"infinite":String(n.duration),a.dataset.remaining=n.remaining===1/0?"infinite":String(n.remaining),n.appliedAt!==void 0&&(a.dataset.appliedAt=String(n.appliedAt)),n.stacks&&n.stacks>1&&(a.dataset.stacks=String(n.stacks));const s=document.createElement("span");if(s.classList.add("mod-pill__name"),s.textContent=n.name,s.setAttribute("aria-hidden","true"),a.appendChild(s),n.stacks&&n.stacks>1){const o=document.createElement("span");o.classList.add("mod-pill__stacks"),o.textContent=`×${n.stacks}`,o.setAttribute("aria-hidden","true"),a.appendChild(o)}const r=document.createElement("span");return r.classList.add("mod-pill__timer"),r.textContent=Ah(n.remaining),r.setAttribute("aria-hidden","true"),a.appendChild(r),n.remaining!==1/0&&n.remaining<=5&&(a.dataset.urgent="true"),a}const Ch={engaged:"Engaged on the field",reserve:"On reserve duty",downed:"Recovering from battle"},Ve=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Qy="panel-roster-title";function _x(n){return n.length===0?"No defining traits yet":n.join(" • ")}function Hb(n){return Number.isFinite(n)?Math.max(0,Math.min(100,Math.round(n*100))):0}function Rx(n){const a=Ve;if(n.xpForNext===null)return`${a.format(n.xp)} XP • Max level`;const s=Hb(n.progress);return`${a.format(n.xpIntoLevel)} / ${a.format(n.xpForNext)} XP • ${s}%`}function jb(n){const a=[],s=(r,o)=>{o>0&&a.push(`+${Ve.format(o)} ${r}`)};return s("Vigor",n.vigor),s("Focus",n.focus),s("Resolve",n.resolve),a.length===0?"No level bonuses yet":a.join(" • ")}function Bs(n,a){const r=Math.round(n-(typeof a=="number"?a:0));if(r===0)return"";const o=Ve.format(Math.abs(r));return r>0?` (+${o})`:` (-${o})`}function Nx(n){if(!n)return"No stat changes";const a=[],s=(r,o)=>{if(typeof o=="number"&&o!==0){const u=o>0?"+":"−";a.push(`${r} ${u}${Ve.format(Math.abs(o))}`)}};return s("HP",n.health),s("ATK",n.attackDamage),s("RNG",n.attackRange),s("MOV",n.movementRange),s("DEF",n.defense),s("Shield",n.shield),a.length===0?"No stat changes":a.join(", ")}function kx(n){const{stats:a,baseStats:s}=n,r=[`HP ${Ve.format(a.health)}/${Ve.format(a.maxHealth)}${Bs(a.maxHealth,s.maxHealth)}`];return a.shield&&a.shield>0&&r.push(`Shield ${Ve.format(a.shield)}${Bs(a.shield,s.shield)}`),r.push(`ATK ${Ve.format(a.attackDamage)}${Bs(a.attackDamage,s.attackDamage)}`),r.push(`RNG ${Ve.format(a.attackRange)}${Bs(a.attackRange,s.attackRange)}`),a.defense&&a.defense>0&&r.push(`DEF ${Ve.format(a.defense)}${Bs(a.defense,s.defense)}`),r.push(`MOV ${Ve.format(a.movementRange)}${Bs(a.movementRange,s.movementRange)}`),r.push(`Upkeep ${Ve.format(n.upkeep)} beer`),r.join(" • ")}function Dx(n){const{stats:a}=n,s=[n.name,Ch[n.status]];s.push(`level ${n.progression.level}`),s.push(`health ${Ve.format(a.health)} of ${Ve.format(a.maxHealth)}`),a.shield&&a.shield>0&&s.push(`shield ${Ve.format(a.shield)}`),s.push(`attack ${Ve.format(a.attackDamage)}`),a.defense&&a.defense>0&&s.push(`defense ${Ve.format(a.defense)}`),a.attackRange>0&&s.push(`attack range ${Ve.format(a.attackRange)}`),s.push(`movement ${Ve.format(a.movementRange)}`),s.push(`upkeep ${Ve.format(n.upkeep)} beer`),n.progression.xpForNext===null?s.push(`${Ve.format(n.progression.xp)} total experience`):s.push(`${Ve.format(n.progression.xpIntoLevel)} of ${Ve.format(n.progression.xpForNext)} experience toward next level`);const r=jb(n.progression.statBonuses);r&&s.push(`level bonuses ${r}`);const o=n.equipment.filter(u=>u.item).length;return o>0&&s.push(`${o} equipped item${o===1?"":"s"}`),n.modifiers.length>0&&s.push(`${n.modifiers.length} active modifier${n.modifiers.length===1?"":"s"}`),s.join(", ")}function Lx(n,a){const s=a.filter(h=>h.status==="engaged").length,r=a.filter(h=>h.status==="reserve").length,o=a.filter(h=>h.status==="downed").length,u=(h,m,p)=>{const g=document.createElement("span");return g.classList.add("panel-roster__metric"),g.dataset.status=p,g.textContent=`${Ve.format(m)} ${h}`,g.setAttribute("aria-label",g.textContent),g},f=document.createElement("div");f.classList.add("panel-roster__metrics"),f.append(u("engaged",s,"engaged"),u("reserve",r,"reserve"),u("downed",o,"downed")),n.appendChild(f)}function Ux(n,a,s){const r=document.createElement("div");r.classList.add("panel-roster__loadout");const o=document.createElement("ul");o.classList.add("panel-roster__slots"),o.setAttribute("role","list"),o.setAttribute("aria-label",`${a.name} equipment slots`);for(const u of a.equipment){const f=document.createElement("li");f.classList.add("panel-roster__slot"),f.dataset.slot=u.id;const h=document.createElement("div");h.classList.add("panel-roster__slot-header");const m=document.createElement("span");m.classList.add("panel-roster__slot-label"),m.textContent=u.label,m.title=u.description,h.appendChild(m);const p=document.createElement("span");if(p.classList.add("panel-roster__slot-summary"),p.textContent=u.item?u.item.name:"Empty",p.title=u.description,h.appendChild(p),f.appendChild(h),u.item){const M=document.createElement("ul");M.classList.add("panel-roster__slot-icons"),M.setAttribute("role","list"),M.appendChild(wx(u.item)),f.appendChild(M)}const g=document.createElement("span");g.classList.add("panel-roster__slot-modifiers"),g.textContent=Nx(u.modifiers),g.title=g.textContent,f.appendChild(g);const b=document.createElement("div");b.classList.add("panel-roster__slot-actions");const v=document.createElement("button");v.type="button",v.classList.add("panel-roster__slot-action"),v.textContent=u.item?"Replace":"Equip",v.setAttribute("aria-label",`Equip ${u.label} for ${a.name}`),v.addEventListener("click",M=>{M.stopPropagation(),s.onEquipSlot?.(a.id,u.id)}),b.appendChild(v);const E=document.createElement("button");E.type="button",E.classList.add("panel-roster__slot-action"),E.textContent="Unequip",E.disabled=u.item===null,E.setAttribute("aria-label",`Unequip ${u.label} from ${a.name}`),E.addEventListener("click",M=>{M.stopPropagation(),E.disabled||s.onUnequipSlot?.(a.id,u.id)}),b.appendChild(E),f.appendChild(b),o.appendChild(f)}if(r.appendChild(o),a.modifiers.length>0){const u=document.createElement("ul");u.classList.add("panel-roster__mods"),u.setAttribute("role","list"),u.setAttribute("aria-label",`${a.name} active modifiers`),u.title=a.modifiers.map(f=>f.name).join(", ");for(const f of a.modifiers)u.appendChild(Tx(f));r.appendChild(u)}n.appendChild(r)}function Ox(n,a={}){return{render:r=>{n.innerHTML="",n.dataset.count=String(r.length),n.classList.add("panel-roster");const o=document.createElement("div");o.classList.add("panel-roster__header");const u=document.createElement("h4");u.classList.add("panel-roster__title"),u.textContent="Battalion Roster",u.id=Qy,o.appendChild(u),n.setAttribute("aria-labelledby",Qy);const f=r.length===0?"No attendants mustered yet":`${Ve.format(r.length)} attendant${r.length===1?"":"s"} enlisted`,h=document.createElement("span");if(h.classList.add("panel-roster__count"),h.textContent=f,o.appendChild(h),n.appendChild(o),(()=>{if(typeof a.getRosterCapLimit!="function"||typeof a.getRosterCap!="function")return;const g=document.createElement("section");g.classList.add("panel-roster__cap");const b=document.createElement("div");b.classList.add("panel-roster__cap-header");const v=document.createElement("span");v.classList.add("panel-roster__cap-title"),v.textContent="Roster Cap",b.appendChild(v);const E=document.createElement("span");E.classList.add("panel-roster__cap-value"),E.setAttribute("aria-live","polite"),b.appendChild(E),g.appendChild(b);const M=document.createElement("p");M.classList.add("panel-roster__cap-description"),M.textContent="Tune how many attendants rally before new recruits await the steam.",g.appendChild(M);const C=`panel-roster-cap-${Math.floor(Math.random()*1e5)}`,R=document.createElement("label");R.classList.add("panel-roster__cap-label"),R.htmlFor=C,R.textContent="Active attendants";const N=document.createElement("input");N.type="range",N.id=C,N.min="0",N.step="1",N.classList.add("panel-roster__cap-slider"),N.setAttribute("aria-label","Roster cap");const q=document.createElement("input");q.type="number",q.min="0",q.step="1",q.inputMode="numeric",q.classList.add("panel-roster__cap-number");const j=document.createElement("div");j.classList.add("panel-roster__cap-controls"),j.append(R,N,q),g.appendChild(j);const F=()=>{const P=a.getRosterCapLimit?.();return typeof P!="number"||!Number.isFinite(P)?0:Math.max(0,Math.floor(P))},Q=()=>{const P=a.getRosterCap?.();return typeof P!="number"||!Number.isFinite(P)?0:Math.max(0,Math.floor(P))},se=(P,I)=>{const T=Math.max(0,Math.min(P,Math.floor(I))),k=Ve.format(T);N.max=String(P),N.value=String(T),N.setAttribute("aria-valuemin","0"),N.setAttribute("aria-valuemax",N.max),N.setAttribute("aria-valuenow",N.value),q.max=String(P),q.value=String(T),q.setAttribute("aria-label",`Roster cap set to ${k}`);const A=T===0?"Paused":k;E.textContent=A,E.dataset.state=T===0?"paused":"active"},ee=typeof a.updateMaxRosterSize=="function";N.disabled=!ee,q.disabled=!ee;const le=(P,I)=>{const T=F(),k=Math.max(0,Math.min(T,Number.isFinite(P)?Math.floor(P):0));let A=k;ee&&(A=a.updateMaxRosterSize(k,{persist:I})),se(T,A)};if(se(F(),Q()),ee){N.addEventListener("input",()=>{le(Number(N.value),!1)}),N.addEventListener("change",()=>{le(Number(N.value),!0)});const P=I=>{le(Number(q.value),I)};q.addEventListener("input",()=>P(!1)),q.addEventListener("change",()=>P(!0)),q.addEventListener("blur",()=>P(!0))}n.appendChild(g)})(),r.length===0){const g=document.createElement("p");g.classList.add("panel-roster__empty"),g.textContent="No attendants have rallied to the sauna yet.",n.appendChild(g);return}Lx(n,r);const p=document.createElement("ul");p.classList.add("panel-roster__list"),p.setAttribute("role","list");for(const g of r){const b=document.createElement("li");b.classList.add("panel-roster__row");const v=document.createElement("button");v.type="button",v.classList.add("panel-roster__item"),v.dataset.unitId=g.id,v.dataset.status=g.status,v.setAttribute("aria-pressed",g.selected?"true":"false"),v.setAttribute("aria-label",Dx(g)),v.title=`${g.name} • ${Ch[g.status]}`,g.selected&&v.classList.add("is-selected"),g.status==="downed"&&v.classList.add("is-downed");const E=document.createElement("div");E.classList.add("panel-roster__name-row");const M=document.createElement("div");M.classList.add("panel-roster__identity");const C=document.createElement("span");C.classList.add("panel-roster__level"),C.dataset.level=String(g.progression.level),C.style.setProperty("--level-progress","0%");const R=Hb(g.progression.progress);C.style.setProperty("--level-progress",`${R}%`),C.setAttribute("role","img");const N=g.progression.xpForNext===null?`Level ${g.progression.level}, at mastery`:`Level ${g.progression.level}, ${R}% toward next level`;C.setAttribute("aria-label",N);const q=document.createElement("span");q.classList.add("panel-roster__level-value"),q.textContent=String(g.progression.level),C.appendChild(q);const j=document.createElement("span");j.classList.add("panel-roster__name"),j.textContent=g.name,j.title=g.name,M.append(C,j),E.appendChild(M);const F=document.createElement("span");F.classList.add("panel-roster__status"),F.dataset.status=g.status,F.textContent=Ch[g.status],E.appendChild(F);const Q=document.createElement("div");Q.classList.add("panel-roster__meta");const se=kx(g);Q.textContent=se,Q.title=se;const ee=document.createElement("div");ee.classList.add("panel-roster__xp");const le=Rx(g.progression);ee.textContent=le,ee.title=le;const P=document.createElement("div");P.classList.add("panel-roster__callouts");const I=jb(g.progression.statBonuses);P.textContent=I,P.title=I;const T=document.createElement("div");T.classList.add("panel-roster__health");const k=document.createElement("div");k.classList.add("panel-roster__health-fill");const A=g.stats.maxHealth>0?Math.max(0,Math.min(100,Math.round(g.stats.health/g.stats.maxHealth*100))):0;k.style.width=`${A}%`,k.dataset.percent=`${A}`,T.appendChild(k);const Y=document.createElement("div");Y.classList.add("panel-roster__traits");const B=_x(g.traits);Y.textContent=B,Y.title=B,v.append(E,ee,Q,P,T,Y),Ux(v,g,a),typeof a.onSelect=="function"&&v.addEventListener("click",()=>a.onSelect?.(g.id)),b.appendChild(v),p.appendChild(b)}n.appendChild(p)}}}const qx=150,zx="autobattles:log-history:v2",Gb="autobattles:log-preferences:v1",im=typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:null;let Py=0;const Zy=()=>(Py+=1,`${Date.now().toString(36)}-${Py.toString(36)}`),pl=n=>{if(Array.isArray(n))return n.map(a=>typeof a=="string"?a.trim():"").filter(a=>a.length>0);if(typeof n=="string"){const a=n.trim();return a?[a]:[]}return[]},Yf=n=>n?typeof n!="object"?{}:{...n}:{},Bx=n=>{if(!n)return null;if(typeof n.unitId=="string"&&n.unitId.trim().length>0)return n.unitId.trim();const a=pl(n.unitIds);return a.length>0?a[a.length-1]:null},Hx=(n,a)=>{const s=pl(n.unitIds??n.unitId),r=pl(a.unitIds??a.unitId),o=Array.from(new Set([...s,...r])),u=pl(n.unitNames??n.unitName),f=pl(a.unitNames??a.unitName),h=Array.from(new Set([...u,...f])),m=typeof a.steward=="string"?a.steward:n.steward,p={...n,...a,unitIds:o,unitNames:h};return typeof m=="string"&&(p.steward=m),h.length>0&&(p.unitName=h[h.length-1]),o.length>0&&(p.unitId=o[o.length-1]),p};class jx{history=[];listeners=new Set;storage;storageKey;maxEntries;constructor(a={}){this.storage=a.storage??im,this.storageKey=a.storageKey??zx,this.maxEntries=Math.max(1,a.maxEntries??qx),this.hydrate()}hydrate(){if(this.storage)try{const a=this.storage.getItem(this.storageKey);if(!a)return;const s=JSON.parse(a);if(!Array.isArray(s))return;const r=[];for(const o of s){if(!o||typeof o!="object")continue;const u=o;if(typeof u.type!="string"||typeof u.message!="string")continue;const f={id:typeof u.id=="string"?u.id:Zy(),type:u.type,message:u.message,metadata:Yf(u.metadata),timestamp:typeof u.timestamp=="number"&&Number.isFinite(u.timestamp)?u.timestamp:Date.now(),occurrences:typeof u.occurrences=="number"&&u.occurrences>0?Math.floor(u.occurrences):1};r.push(f)}r.length>0&&(r.length>this.maxEntries?this.history=r.slice(-this.maxEntries):this.history=r)}catch{this.history=[]}}persist(){if(this.storage)try{const a=JSON.stringify(this.history.map(s=>({id:s.id,type:s.type,message:s.message,metadata:s.metadata,timestamp:s.timestamp,occurrences:s.occurrences})));this.storage.setItem(this.storageKey,a)}catch{}}getHistory(){return this.history.map(a=>({...a,metadata:Yf(a.metadata)}))}subscribe(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}clear(){if(this.history.length===0)return;const a=this.history.slice();this.history=[],this.persist(),this.emitChange({kind:"remove",entries:a})}emit(a){const s=Yf(a.metadata),r={id:Zy(),type:a.type,message:a.message,metadata:s,timestamp:Date.now(),occurrences:1},o=this.tryAggregate(r);if(o)return this.history[o.index]=o.entry,this.persist(),this.emitChange({kind:"update",entry:o.entry,index:o.index}),o.entry;this.history.push(r);const u=[];for(;this.history.length>this.maxEntries;){const h=this.history.shift();h&&u.push(h)}this.persist(),u.length>0&&this.emitChange({kind:"remove",entries:u});const f=this.history.length-1;return this.emitChange({kind:"append",entry:r,index:f}),r}tryAggregate(a){if(a.type!=="spawn"||!Bx(a.metadata)||this.history.length===0)return null;const r=this.history.length-1,o=this.history[r];return o.type!=="spawn"?null:{entry:{...o,id:o.id,message:a.message,metadata:Hx(o.metadata??{},a.metadata??{}),timestamp:a.timestamp,occurrences:o.occurrences+a.occurrences},index:r}}emitChange(a){for(const s of this.listeners)try{s(a)}catch(r){console.warn("Failed to handle log change",r)}}}const sm=new jx,Lt=n=>sm.emit(n),Gx=n=>sm.subscribe(n),Ix=()=>sm.getHistory(),Sl={combat:{label:"Combat",accent:"var(--color-accent-red)"},spawn:{label:"Reinforcements",accent:"var(--color-accent-green)"},loot:{label:"Loot",accent:"var(--color-accent-gold)"},progression:{label:"Progression",accent:"var(--color-accent-blue)"},ability:{label:"Abilities",accent:"var(--color-accent-purple)"},resource:{label:"Economy",accent:"var(--color-accent-cyan)"},policy:{label:"Policies",accent:"var(--color-accent-orange)"},event:{label:"Events",accent:"var(--color-accent-pink)"},system:{label:"Systems",accent:"var(--color-muted)"}},Jy=["combat","spawn","loot","progression","ability","resource","policy","event","system"],pc={mutedTypes:[]},Yx=(n=im)=>{if(!n)return{...pc};try{const a=n.getItem(Gb);if(!a)return{...pc};const s=JSON.parse(a);if(!s||typeof s!="object")return{...pc};const r=Array.isArray(s.mutedTypes)?s.mutedTypes.filter(o=>typeof o=="string"&&o in Sl):[];return{mutedTypes:Array.from(new Set(r))}}catch{return{...pc}}},Fx=(n,a=im)=>{if(a)try{const s=Array.isArray(n.mutedTypes)?n.mutedTypes.filter(r=>r in Sl):[];a.setItem(Gb,JSON.stringify({mutedTypes:Array.from(new Set(s))}))}catch{}},Ff=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function $x(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{log:()=>{},addEvent:()=>{},renderRoster:()=>{},dispose:()=>{}};const{regions:r,mobileBar:o}=ar(s),u=r.top,f=r.right,h=s.querySelector("#right-panel");h&&h.remove();const m=s.querySelector(".right-panel-slide");m&&m.remove();const p=s.querySelector("#right-panel-toggle");p&&p.remove();const g=document.createElement("div");g.id="right-panel",g.classList.add("hud-card"),g.setAttribute("role","complementary"),g.setAttribute("aria-label","Sauna command console"),g.tabIndex=-1;const b=document.createElement("div");b.className="right-panel-slide",b.setAttribute("aria-hidden","true");const v=document.createElement("div");v.className="right-panel-slide__backdrop",v.setAttribute("aria-hidden","true");const E=document.createElement("div");E.className="right-panel-slide__sheet",E.appendChild(g),b.append(v,E);const M=window.matchMedia("(max-width: 1040px)"),C=[],R=document.createElement("button");R.type="button",R.id="right-panel-toggle",R.classList.add("hud-panel-toggle"),R.setAttribute("aria-controls",g.id);const N=document.createElement("span");N.classList.add("hud-panel-toggle__icon"),N.setAttribute("aria-hidden","true");const q=document.createElement("span");q.classList.add("hud-panel-toggle__icon-bars"),N.appendChild(q);const j=document.createElement("span");j.classList.add("hud-panel-toggle__text");const F=document.createElement("span");F.classList.add("hud-panel-toggle__title"),F.textContent="Command Console";const Q=document.createElement("span");Q.classList.add("hud-panel-toggle__state"),j.append(F,Q),R.append(N,j);const se=()=>{const L=u.querySelector("#topbar");L&&L.parentElement===u?L.insertAdjacentElement("afterend",R):u.prepend(R)};let ee=!1,le=!1,P=!1,I=!1;const T="is-mobile-panel-open",k=()=>{P?Q.textContent=I?"Close":"Menu":Q.textContent=ee?"Open":"Close"},A=()=>{if(P){R.setAttribute("aria-expanded",I?"true":"false");const L=I?"Close command console panel":"Open command console panel";R.setAttribute("aria-label",L),R.title=I?"Close the sauna command console overlay":"Open the sauna command console overlay"}else{R.setAttribute("aria-expanded",ee?"false":"true");const L=ee?"Open command console panel":"Close command console panel";R.setAttribute("aria-label",L),R.title=ee?"Open the sauna command console overlay":"Close the sauna command console overlay"}},Y=()=>{k(),A()},B=(L,X=M.matches)=>{if(P)return;const re=ee;X&&(le=L);const fe=L&&X;ee=fe,g.classList.toggle("right-panel--collapsed",fe),g.setAttribute("aria-hidden",fe?"true":"false"),Y(),re&&!fe&&X&&g.focus({preventScroll:!0})},D=L=>{!P||!I||L.key==="Escape"&&(L.preventDefault(),$())};let V=!1;const te=()=>{V||(document.addEventListener("keydown",D),V=!0)},he=()=>{V&&(document.removeEventListener("keydown",D),V=!1)},w=()=>{!P||I||(I=!0,b.classList.add("right-panel-slide--open"),b.setAttribute("aria-hidden","false"),g.setAttribute("aria-hidden","false"),document.body.classList.add(T),b.style.setProperty("--panel-drag-progress","1"),Y(),te(),requestAnimationFrame(()=>{g.focus({preventScroll:!0})}))},$=({skipFocus:L=!1}={})=>{!P||!I||(xe(),I=!1,b.classList.remove("right-panel-slide--open"),b.setAttribute("aria-hidden","true"),g.setAttribute("aria-hidden","true"),document.body.classList.remove(T),b.style.setProperty("--panel-drag-progress","0"),Y(),he(),L||R.focus({preventScroll:!0}))},W=L=>{if(P)return;const X=L.matches;R.hidden=!X,B(X?le:!1,X)};typeof M.addEventListener=="function"?(M.addEventListener("change",W),C.push(()=>M.removeEventListener("change",W))):(M.addListener(W),C.push(()=>M.removeListener(W)));const ae=()=>{if(P){I?$():w();return}B(!ee)};R.addEventListener("click",ae),C.push(()=>R.removeEventListener("click",ae));const oe=()=>{$()};v.addEventListener("click",oe),C.push(()=>v.removeEventListener("click",oe));let ge=null,de=0,Te=0;const xe=()=>{ge!==null&&(E.releasePointerCapture(ge),ge=null),E.style.transition="",E.style.transform="",b.style.setProperty("--panel-drag-progress",I?"1":"0")},xt=L=>{!P||!I||L.pointerType==="mouse"&&L.button!==0||(ge=L.pointerId,de=L.clientX,Te=0,E.style.transition="none",E.setPointerCapture(L.pointerId))},on=L=>{if(!P||L.pointerId!==ge||!I)return;Te=Math.max(0,L.clientX-de);const X=E.offsetWidth||1,re=Math.min(Te,X);E.style.transform=`translateX(${re}px)`,b.style.setProperty("--panel-drag-progress",String(1-re/X))},cn=L=>{xe(),L&&$()},Un=L=>{if(L.pointerId!==ge)return;const X=E.offsetWidth||1,re=Te>X*.35;cn(re)},On=()=>{cn(!1)};E.addEventListener("pointerdown",xt),E.addEventListener("pointermove",on),E.addEventListener("pointerup",Un),E.addEventListener("pointercancel",On),C.push(()=>{E.removeEventListener("pointerdown",xt),E.removeEventListener("pointermove",on),E.removeEventListener("pointerup",Un),E.removeEventListener("pointercancel",On)});const un=Bb(L=>{P=L,P?(E.appendChild(g),b.isConnected||s.appendChild(b),o.appendChild(R),R.classList.add("hud-panel-toggle--mobile"),R.hidden=!1,I||(g.setAttribute("aria-hidden","true"),b.setAttribute("aria-hidden","true"),b.style.setProperty("--panel-drag-progress","0"))):($({skipFocus:!0}),b.style.setProperty("--panel-drag-progress","1"),b.remove(),f.appendChild(g),se(),R.classList.remove("hud-panel-toggle--mobile"),R.hidden=!M.matches,g.setAttribute("aria-hidden","false"),B(le,M.matches)),Y()});C.push(un);const yi=document.createElement("div");yi.classList.add("panel-tabs"),g.appendChild(yi);const Wi=document.createElement("div");Wi.classList.add("panel-content"),g.appendChild(Wi);const ce=document.createElement("div");ce.id="right-panel-roster",ce.setAttribute("role","region"),ce.setAttribute("aria-live","polite"),ce.setAttribute("aria-label","Battalion roster");const _e=document.createElement("div");_e.id="right-panel-policies";const Ge=document.createElement("div");Ge.id="right-panel-events";const qe=document.createElement("div");qe.id="right-panel-log",qe.setAttribute("role","region"),qe.setAttribute("aria-label","Combat log");const bt=document.createElement("section");bt.className="panel-log";const dn=document.createElement("header");dn.className="panel-log__header";const Qt=document.createElement("h3");Qt.className="panel-log__title",Qt.textContent="Combat Log";const En=document.createElement("span");En.className="panel-log__total",En.textContent="0 entries",dn.append(Qt,En);const aa=document.createElement("div");aa.className="panel-log__filters";const Xe=document.createElement("div");Xe.id="event-log",Xe.className="panel-log__feed",Xe.setAttribute("role","log"),Xe.setAttribute("aria-live","polite"),bt.append(dn,aa,Xe),qe.appendChild(bt);const Qe={Roster:ce,Policies:_e,Events:Ge,Log:qe},{onRosterSelect:Gt,onRosterRendererReady:_t,onRosterEquipSlot:pu,onRosterUnequipSlot:gu}=a;for(const[L,X]of Object.entries(Qe))X.classList.add("panel-section","panel-section--scroll"),X.dataset.tab=L,X.hidden=!0;qe.classList.add("panel-section--log");function ql(L){for(const[X,re]of Object.entries(Qe))re.hidden=X!==L;for(const X of Array.from(yi.children)){const re=X,fe=re.textContent===L;re.disabled=fe,re.setAttribute("aria-pressed",fe?"true":"false")}}for(const L of Object.keys(Qe)){const X=document.createElement("button");X.type="button",X.textContent=L;const re=Qe[L];re?.id&&X.setAttribute("aria-controls",re.id),X.setAttribute("aria-pressed","false");const fe=()=>ql(L);X.addEventListener("click",fe),C.push(()=>X.removeEventListener("click",fe)),yi.appendChild(X),Wi.appendChild(Qe[L])}const es=Ox(ce,{onSelect:Gt,onEquipSlot:pu,onUnequipSlot:gu,getRosterCap:a.getRosterCap,getRosterCapLimit:a.getRosterCapLimit,updateMaxRosterSize:a.updateMaxRosterSize}),qa=L=>{es.render(L)};qa([]),typeof _t=="function"&&_t(qa);const qn={[ie.SAUNA_BEER]:"Sauna Beer Bottles",[ie.SAUNAKUNNIA]:"Saunakunnia",[ie.SISU]:"Sisu"},bi=Y2(),ia=new Map;function yu(L){const X=document.createElement("span");return X.className="policy-card__badge",X.textContent=L,X}function zl(L){const X=document.createElement("article");X.className="policy-card",X.style.setProperty("--policy-gradient",L.visuals.gradient),X.style.setProperty("--policy-accent",L.visuals.accentColor);const re=document.createElement("div");re.className="policy-card__header";const fe=document.createElement("div");fe.className="policy-card__icon-frame";const Re=document.createElement("img");Re.className="policy-card__icon",Re.src=L.visuals.icon,Re.alt=`${L.name} icon`,fe.appendChild(Re);const Ie=document.createElement("div");Ie.className="policy-card__heading";const Ce=document.createElement("h4");if(Ce.className="policy-card__title",Ce.textContent=L.name,Ie.appendChild(Ce),L.visuals.badges?.length){const jn=document.createElement("div");jn.className="policy-card__badges",L.visuals.badges.forEach(Kl=>jn.appendChild(yu(Kl))),Ie.appendChild(jn)}const tt=document.createElement("span");tt.className="policy-card__state",tt.textContent="Ready",re.append(fe,Ie,tt);const Pt=document.createElement("p");Pt.className="policy-card__description",Pt.textContent=L.description;const vt=L.visuals.flair?(()=>{const jn=document.createElement("p");return jn.className="policy-card__flair",jn.textContent=L.visuals.flair??"",jn})():null,Zt=document.createElement("div");Zt.className="policy-card__actions";const Jt=document.createElement("span");Jt.className="policy-card__cost";const xi=document.createElement("span");xi.className="policy-card__cost-label",xi.textContent="Cost";const dt=document.createElement("span");dt.className="policy-card__cost-value",dt.textContent=`${Ff.format(L.cost)} ${qn[L.resource]}`,Jt.append(xi,dt);const nt=document.createElement("button");nt.type="button",nt.className="policy-card__action",nt.textContent="Enact Policy";const ja=document.createElement("p");ja.className="policy-card__status";const Ga=document.createElement("ul");Ga.className="policy-card__requirements",Ga.hidden=!0,Zt.append(Jt,nt);const ca=()=>{n.applyPolicy(L.id)&&ts(L)};return nt.addEventListener("click",ca),C.push(()=>nt.removeEventListener("click",ca)),X.append(re,Pt),vt&&X.appendChild(vt),X.append(Zt,ja,Ga),ia.set(L.id,{card:X,action:nt,stateBadge:tt,statusCopy:ja,requirements:Ga,costChip:Jt}),X}function Bl(){_e.innerHTML="",ia.clear();const L=document.createElement("div");L.className="policy-grid",bi.forEach(X=>{const re=zl(X);L.appendChild(re)}),_e.appendChild(L),zn()}function ts(L){const X=ia.get(L.id);if(!X)return;const re=n.hasPolicy(L.id),fe=L.prerequisites.filter(vt=>!vt.isSatisfied(n)),Re=n.canAfford(L.cost,L.resource);X.action.disabled=re||fe.length>0||!Re,X.action.textContent=re?"Enacted":"Enact Policy";let Ie="ready",Ce="Ready",tt=L.spotlight??"All signals point to go.";X.requirements.innerHTML="",X.requirements.hidden=!0,re?(Ie="applied",Ce="Enacted",tt=L.visuals.flair??"Policy active."):fe.length>0?(Ie="locked",Ce="Locked",tt="Awaiting requirements:",X.requirements.hidden=!1,fe.forEach(vt=>{const Zt=document.createElement("li");Zt.textContent=vt.description,X.requirements.appendChild(Zt)})):Re||(Ie="budget",Ce="Needs Resources",tt=`Earn ${Ff.format(L.cost)} ${qn[L.resource]} to enact this edict.`),X.card.dataset.status=Ie,X.stateBadge.textContent=Ce,X.statusCopy.textContent=tt;const Pt=!re&&fe.length===0&&!Re;X.costChip.classList.toggle("policy-card__cost--warning",Pt)}function zn(){bi.forEach(L=>ts(L))}Bl();const Hl=L=>zn(),ir=L=>zn(),sr=L=>zn();ne.on("resourceChanged",Hl),ne.on(Ht.APPLIED,ir),ne.on(Ht.REJECTED,sr),C.push(()=>{ne.off("resourceChanged",Hl),ne.off(Ht.APPLIED,ir),ne.off(Ht.REJECTED,sr)});function rr(L,X){const re=document.createElement("button");re.type="button",re.classList.add("event-card__choice"),X.accent&&re.classList.add(`event-card__choice--${X.accent}`),re.dataset.choiceId=X.id;const fe=document.createElement("span");if(fe.className="event-card__choice-label",fe.textContent=X.label,re.appendChild(fe),X.description){const Re=document.createElement("span");Re.className="event-card__choice-detail",Re.textContent=X.description,re.appendChild(Re)}return re.addEventListener("click",()=>{if(!re.isConnected)return;re.disabled=!0,Tc.resolve(L.id,X.id)||(re.disabled=!1)}),re}function lr(L){if(Ge.innerHTML="",L.length===0){const re=document.createElement("div");re.className="event-card event-card--empty";const fe=document.createElement("p");fe.className="event-card__empty",fe.textContent="All clear. Command will notify you when new briefings arrive.",re.appendChild(fe),Ge.appendChild(re);return}const X=document.createDocumentFragment();for(const re of L){const fe=document.createElement("article");fe.className="event-card",fe.dataset.eventId=re.id,fe.style.setProperty("--event-accent",re.accentColor??"var(--color-accent)");const Re=(re.typography??"sans").toLowerCase();fe.classList.add(`event-card--${["serif","mono"].includes(Re)?Re:"sans"}`);const Ie=(re.animation??"").toLowerCase();["aurora","pulse","tilt"].includes(Ie)&&fe.classList.add(`event-card--${Ie}`);const Ce=document.createElement("div");if(Ce.className="event-card__frame",re.art){const nt=document.createElement("div");nt.className="event-card__media",nt.style.backgroundImage=`url(${re.art})`,Ce.appendChild(nt)}const tt=document.createElement("div");tt.className="event-card__body";const Pt=document.createElement("span");Pt.className="event-card__badge",Pt.textContent="Priority Dispatch",tt.appendChild(Pt);const vt=document.createElement("h4");vt.className="event-card__headline",vt.textContent=re.headline,tt.appendChild(vt);const Zt=document.createElement("p");Zt.className="event-card__copy",Zt.textContent=re.body,tt.appendChild(Zt);const Jt=document.createElement("div");Jt.className="event-card__choices";const xi=re.choices&&re.choices.length>0?re.choices:[{id:"acknowledge",label:re.acknowledgeText??"Acknowledge"}];for(const nt of xi){const ja=rr(re,{id:nt.id,label:nt.label,description:nt.description,event:nt.event,payload:nt.payload,accent:nt.accent});Jt.appendChild(ja)}tt.appendChild(Jt),Ce.appendChild(tt);const dt=document.createElement("span");dt.className="event-card__shimmer",fe.append(Ce,dt),X.appendChild(fe)}Ge.appendChild(X)}const jl=Tc.subscribe(lr);C.push(jl);const Gl=({event:L})=>{Lt({type:"event",message:`Event • ${L.headline}`,metadata:{eventId:L?.id??L.headline,headline:L.headline}})};ne.on(Lc.TRIGGERED,Gl),C.push(()=>{ne.off(Lc.TRIGGERED,Gl)});function Bn(L){Tc.publish(L)}const We=new Map,ut=new Map,sa=new Map,za=new Set(Yx().mutedTypes??[]),Mn=new Set;for(const L of Jy)za.has(L)||Mn.add(L),ut.set(L,0);let ns=0,vi=!0;const Si=typeof requestAnimationFrame=="function"?requestAnimationFrame:L=>setTimeout(L,16),as=L=>Ff.format(Math.max(0,L)),ra=()=>{const L=ns===1?"entry":"entries";En.textContent=`${as(ns)} ${L}`},Ba=L=>{const X=sa.get(L);X&&(X.textContent=as(ut.get(L)??0))},la=(L,X)=>{if(X===0)return;const re=ut.get(L)??0;ut.set(L,Math.max(0,re+X)),ns=Math.max(0,ns+X),Ba(L),ra()},oa=()=>Xe.scrollHeight-(Xe.scrollTop+Xe.clientHeight)<48,et=()=>{Si(()=>{Xe.scrollTop=Xe.scrollHeight,vi=!0})},is=L=>{const X=Mn.has(L.type);L.element.hidden=!X,L.element.classList.toggle("panel-log-entry--muted",!X)},Il=L=>{const X=L.metadata??{};return(Array.isArray(X.unitNames)?X.unitNames:typeof X.unitName=="string"?[X.unitName]:[]).map(fe=>typeof fe=="string"?fe.trim():"").filter(fe=>fe.length>0)},Hn=(L,X)=>{if(X.type!=="spawn"){L.replaceChildren(),L.hidden=!0;return}const re=Il(X),fe=re.map(Ie=>{const Ce=document.createElement("span");return Ce.className="panel-log-entry__token",Ce.textContent=Ie,Ce}),Re=X.occurrences-re.length;if(Re>0){const Ie=document.createElement("span");Ie.className="panel-log-entry__token panel-log-entry__token--more",Ie.textContent=`+${Re}`,fe.push(Ie)}fe.length===0?(L.replaceChildren(),L.hidden=!0):(L.replaceChildren(...fe),L.hidden=!1)},Ha=L=>{const X=document.createElement("article");X.className="panel-log-entry",X.dataset.logType=L.type,X.style.setProperty("--log-entry-accent",Sl[L.type]?.accent??"var(--color-accent)");const re=document.createElement("div");re.className="panel-log-entry__header";const fe=document.createElement("span");fe.className="panel-log-entry__type",fe.textContent=Sl[L.type]?.label??L.type;const Re=document.createElement("span");Re.className="panel-log-entry__badge";const Ie=document.createElement("p");Ie.className="panel-log-entry__message",Ie.textContent=L.message;const Ce=document.createElement("div");Ce.className="panel-log-entry__tokens",Ce.hidden=!0,re.append(fe,Re),X.append(re,Ie,Ce);const tt=vt=>{vt<=1?(Re.textContent="",Re.hidden=!0):(Re.hidden=!1,Re.textContent=`×${vt}`)},Pt={element:X,type:L.type,occurrences:L.occurrences,badge:Re,message:Ie,tokens:Ce,setBadge:tt};return tt(L.occurrences),Hn(Ce,L),Pt},Yl=(L,X=!1)=>{const re=X?!0:oa()||vi,fe=Ha(L);We.set(L.id,fe),Xe.appendChild(fe.element),la(fe.type,fe.occurrences),is(fe),re&&et()},Fl=L=>{const X=We.get(L.id);if(!X)return;const re=L.occurrences-X.occurrences;re!==0&&(X.occurrences=L.occurrences,la(X.type,re)),X.message.textContent=L.message,X.setBadge(L.occurrences),X.tokens&&Hn(X.tokens,L),is(X),vi&&et()},$l=L=>{const X=We.get(L.id);X&&(We.delete(L.id),la(X.type,-X.occurrences),X.element.parentElement===Xe&&Xe.removeChild(X.element))},Vl=()=>{for(const L of We.values())is(L)};for(const L of Jy){const X=Sl[L],re=document.createElement("button");re.type="button",re.className="log-chip",re.dataset.logFilter=L,re.style.setProperty("--log-chip-accent",X?.accent??"var(--color-accent)"),re.setAttribute("aria-pressed",Mn.has(L)?"true":"false"),re.setAttribute("aria-label",`${X?.label??L} log filter`);const fe=document.createElement("span");fe.className="log-chip__label",fe.textContent=X?.label??L;const Re=document.createElement("span");Re.className="log-chip__count",Re.textContent="0",sa.set(L,Re),Mn.has(L)||re.classList.add("is-muted"),re.append(fe,Re),aa.appendChild(re),re.addEventListener("click",()=>{Mn.has(L)?(Mn.delete(L),za.add(L)):(Mn.add(L),za.delete(L)),re.classList.toggle("is-muted",!Mn.has(L)),re.setAttribute("aria-pressed",Mn.has(L)?"true":"false"),Fx({mutedTypes:Array.from(za)}),Vl()})}ra();const Ei=()=>{vi=oa()};Xe.addEventListener("scroll",Ei,{passive:!0}),C.push(()=>Xe.removeEventListener("scroll",Ei));const Mi=Ix();if(Mi.length>0){for(const L of Mi)Yl(L,!0);et()}const xn=Gx(L=>{if(L.kind==="append")Yl(L.entry);else if(L.kind==="update")Fl(L.entry);else if(L.kind==="remove")for(const X of L.entries)$l(X)});return C.push(xn),Vl(),ql("Roster"),{log:L=>{Lt(L)},addEvent:Bn,renderRoster:qa,dispose:()=>{for(const L of C.splice(0))try{L()}catch(X){console.warn("Failed to dispose HUD listener",X)}he(),xe(),document.body.classList.remove(T),b.remove(),R.remove(),g.remove()}}}const Vx=n=>`[data-tutorial-target="${n}"]`,Vn=16,gc=12,Wy="is-tutorial-highlighted",Xx=[{id:"heat",target:"heat",title:"Heat the Sauna",description:"Keep the sauna fires roaring. This control shows when the next warrior emerges from the steam."},{id:"upkeep",target:"upkeep",title:"Mind Your Upkeep",description:"Every attendant draws upkeep. Track totals and see a featured roster member to balance your economy."},{id:"sisu",target:"sisu",title:"Stockpile SISU",description:"SISU fuels heroic bursts. Watch this meter to know when your grit reserves can power signature moves."},{id:"enemy-ramp",target:"enemy-ramp",title:"Read the Enemy Ramp",description:"The badge shows the current stage, upcoming multiplier surges, and calm lulls before the next pressure wave."},{id:"combat",target:"combat",title:"Command the Fight",description:"Trigger a Sisu Burst to supercharge allied attacks or rally everyone home with a Torille call."},{id:"victory",target:"victory",title:"Claim Victory",description:"Saunakunnia measures renown. Push it ever higher to unlock triumphs and close the campaign in glory."}];function Kx(n,a,s){return Math.max(a,Math.min(s,n))}function Qx(n={}){const a=n.steps??Xx;if(a.length===0)throw new Error("Tutorial requires at least one step.");let s=-1,r=null,o=!1;const u=document.createElement("div");u.className="tutorial-overlay";const f=document.createElement("div");f.className="tutorial-overlay__spotlight",f.setAttribute("aria-hidden","true");const h=document.createElement("section");h.className="tutorial-card",h.setAttribute("role","dialog"),h.setAttribute("aria-modal","false"),h.tabIndex=-1;const m=document.createElement("header");m.className="tutorial-card__header";const p=document.createElement("h2");p.className="tutorial-card__title";const g=document.createElement("button");g.type="button",g.className="tutorial-card__close",g.setAttribute("aria-label","Dismiss tutorial"),g.textContent="×",m.append(p,g);const b=document.createElement("p");b.className="tutorial-card__description";const v=document.createElement("p");v.className="tutorial-card__progress";const E=document.createElement("div");E.className="tutorial-card__controls";const M=document.createElement("button");M.type="button",M.className="tutorial-card__button tutorial-card__button--secondary",M.textContent="Back";const C=document.createElement("button");C.type="button",C.className="tutorial-card__button",C.textContent="Next";const R=document.createElement("button");R.type="button",R.className="tutorial-card__skip",R.textContent="Skip tutorial",E.append(M,C),h.append(m,b,v,E,R),u.append(f,h);const N=typeof ResizeObserver<"u"?new ResizeObserver(()=>{s>=0&&ee()}):null,q=()=>{s>=0&&ee()};function j(){o||(document.body.appendChild(u),window.addEventListener("resize",ee),document.addEventListener("scroll",q,!0),N?.observe(h),o=!0)}function F(){o&&(window.removeEventListener("resize",ee),document.removeEventListener("scroll",q,!0),N?.disconnect(),u.remove(),o=!1)}function Q(B){if(r&&r!==B&&(r.classList.remove(Wy),r.removeAttribute("data-tutorial-highlight")),r=B,!B){f.style.opacity="0";return}B.classList.add(Wy),B.setAttribute("data-tutorial-highlight","true"),f.style.opacity="1"}function se(){if(!r)return null;const B=r.getBoundingClientRect();return B.width===0&&B.height===0?null:{top:B.top,left:B.left,width:B.width,height:B.height}}function ee(){const B=se();if(!B){h.style.top=`${Vn}px`,h.style.left=`${Vn}px`,h.classList.add("tutorial-card--floating"),f.style.opacity="0";return}h.classList.remove("tutorial-card--floating"),f.style.opacity="1";const D=B.top-gc,V=B.left-gc,te=B.width+gc*2,he=B.height+gc*2;f.style.top=`${D}px`,f.style.left=`${V}px`,f.style.width=`${te}px`,f.style.height=`${he}px`;const w=h.getBoundingClientRect();let W=window.innerHeight-B.top-B.height>=B.top?B.top+B.height+Vn:B.top-w.height-Vn;W<Vn?W=Vn:W+w.height>window.innerHeight-Vn&&(W=window.innerHeight-Vn-w.height);let oe=B.left+B.width/2-w.width/2;oe=Kx(oe,Vn,window.innerWidth-w.width-Vn),h.style.top=`${Math.round(W)}px`,h.style.left=`${Math.round(oe)}px`}function le(){requestAnimationFrame(()=>{h.focus({preventScroll:!0})})}function P(B){if(B<0||B>=a.length)return;j(),s=B;const D=a[B];p.textContent=D.title,b.textContent=D.description,v.textContent=`Step ${B+1} of ${a.length}`,M.disabled=B===0,C.textContent=B===a.length-1?"Finish":"Next";const V=document.querySelector(Vx(D.target));Q(V??null),ee(),le()}function I(){if(s===-1){P(0);return}if(s>=a.length-1){Y();return}P(s+1)}function T(){s<=0||P(s-1)}function k(){Q(null),F(),s=-1}function A(){n.onSkip?.(),k()}function Y(){n.onComplete?.(),k()}return M.addEventListener("click",()=>{T()}),C.addEventListener("click",()=>{I()}),R.addEventListener("click",()=>{A()}),g.addEventListener("click",()=>{A()}),h.addEventListener("keydown",B=>{B.defaultPrevented||(B.key==="ArrowRight"?(B.preventDefault(),I()):B.key==="ArrowLeft"?(B.preventDefault(),T()):B.key==="Escape"&&(B.preventDefault(),A()))}),{start(){s===-1&&P(0)},next:I,previous:T,skip:A,finish:Y,destroy(){k()}}}const Px=Math.sqrt(3),Zx=2;function Yc(n){return{width:n*Px,height:n*Zx}}const Ta=16,yc=2;function Jx(){return typeof window<"u"&&window.devicePixelRatio||1}function Wx(n,a){const s=Math.max(n.qMin,a.minQ),r=Math.min(n.qMax,a.maxQ),o=Math.max(n.rMin,a.minR),u=Math.min(n.rMax,a.maxR);return s>r||o>u?null:{qMin:s,qMax:r,rMin:o,rMax:u}}function ew(n,a){const s=Jx(),r=a.width/(s*n.zoom),o=a.height/(s*n.zoom);return{x:n.x-r/2,y:n.y-o/2,width:r,height:o}}function tw(n,a){const s=[hl(n.x,n.y,a),hl(n.x+n.width,n.y,a),hl(n.x,n.y+n.height,a),hl(n.x+n.width,n.y+n.height,a)];let r=1/0,o=-1/0,u=1/0,f=-1/0;for(const h of s)r=Math.min(r,h.q),o=Math.max(o,h.q),u=Math.min(u,h.r),f=Math.max(f,h.r);return{qMin:Math.floor(r)-yc,qMax:Math.ceil(o)+yc,rMin:Math.floor(u)-yc,rMax:Math.ceil(f)+yc}}function nw(n,a,s,r){if(!s||typeof s.width!="number"||typeof s.height!="number")return{qMin:n.minQ,qMax:n.maxQ,rMin:n.minR,rMax:n.maxR};if(s.width===0||s.height===0)return{qMin:n.minQ,qMax:n.maxQ,rMin:n.minR,rMax:n.maxR};const o=ew(a,s);return Wx(tw(o,r),n)}function Is(n){return Math.floor(n/Ta)}function Ib(n){return`${n.q},${n.r}`}function aw(n,a){return Ib({q:Is(n),r:Is(a)})}function iw(n){return{qMin:Is(n.qMin),qMax:Is(n.qMax),rMin:Is(n.rMin),rMax:Is(n.rMax)}}function Yb(n){const a=[];for(let s=n.rMin;s<=n.rMax;s++)for(let r=n.qMin;r<=n.qMax;r++)a.push({q:r,r:s});return a}function sw(n,a){const s=a.q*Ta,r=a.r*Ta,o=s+Ta-1,u=r+Ta-1,f=Math.max(s,n.minQ),h=Math.min(o,n.maxQ),m=Math.max(r,n.minR),p=Math.min(u,n.maxR);if(!(f>h||m>p))for(let g=m;g<=p;g++)for(let b=f;b<=h;b++)n.ensureTile(b,g)}function rw(n,a){for(const s of Yb(a))sw(n,s)}const lw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3ePlains%20Tile%3c/title%3e%3cdesc%20id='desc'%3eRolling%20plains%20with%20sunrise%20gradients%20and%20glowing%20grasses.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='plains-bg'%20cx='50%25'%20cy='50%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='plains-field'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='0%25'%3e%3cstop%20offset='0%25'%20stop-color='%23facc15'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23eab308'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='plains-haze'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f59e0b'%20stop-opacity='0.2'%20/%3e%3c/linearGradient%3e%3cfilter%20id='plains-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='5'%20stdDeviation='6'%20flood-color='%23facc15'%20flood-opacity='0.35'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23plains-bg)'%20/%3e%3cg%20filter='url(%23plains-glow)'%3e%3cpath%20d='M16%2088c20-18%2036-22%2048-22s28%204%2048%2022'%20fill='url(%23plains-field)'%20stroke='%23fef9c3'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M24%20102c16-14%2032-18%2040-18s24%204%2040%2018'%20fill='none'%20stroke='%23fde68a'%20stroke-width='5'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M32%2070c12-10%2024-14%2032-14s20%204%2032%2014'%20fill='url(%23plains-haze)'%20opacity='0.7'%20/%3e%3cpath%20d='M52%2078l4%2012m8-12l4%2012m8-12l4%2012'%20stroke='%23fef3c7'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='36'%20r='8'%20fill='%23fef08a'%20opacity='0.7'%20/%3e%3c/svg%3e",ow="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eForest%20Tile%3c/title%3e%3cdesc%20id='desc'%3eStylised%20evergreen%20trees%20glowing%20against%20a%20deep%20night%20backdrop.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='forest-bg'%20cx='50%25'%20cy='40%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230b1120'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='forest-leaf'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%234ade80'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2315803d'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='forest-trunk'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23a855f7'%20/%3e%3cstop%20offset='100%25'%20stop-color='%237c3aed'%20/%3e%3c/linearGradient%3e%3cfilter%20id='forest-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%234ade80'%20flood-opacity='0.25'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23forest-bg)'%20/%3e%3cg%20filter='url(%23forest-glow)'%20stroke='%23bbf7d0'%20stroke-width='2'%3e%3cpath%20fill='url(%23forest-leaf)'%20d='M64%2026L32%2080h18l-12%2022h28l-10-22h16l-10%2022h28l-12-22h18z'%20/%3e%3crect%20x='58'%20y='74'%20width='12'%20height='18'%20rx='3'%20fill='url(%23forest-trunk)'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20stroke-opacity='0.5'%20d='M44%2086c6-4%2012-6%2020-6s14%202%2020%206'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='40'%20r='6'%20fill='%23fef3c7'%20opacity='0.6'%20/%3e%3ccircle%20cx='88'%20cy='32'%20r='4'%20fill='%23fef3c7'%20opacity='0.4'%20/%3e%3c/svg%3e",cw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eMountain%20Tile%3c/title%3e%3cdesc%20id='desc'%3eJagged%20alpine%20peaks%20with%20luminous%20snowcaps.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='mountain-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%23111827'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='mountain-rock'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2364748b'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23334155'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mountain-snow'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23cbd5f5'%20/%3e%3c/linearGradient%3e%3cfilter%20id='mountain-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%23f8fafc'%20flood-opacity='0.2'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23mountain-bg)'%20/%3e%3cg%20filter='url(%23mountain-glow)'%20stroke='%23cbd5f5'%20stroke-width='2'%20stroke-linejoin='round'%3e%3cpath%20fill='url(%23mountain-rock)'%20d='M24%20100l32-52%2014%2022%2012-18%2022%2048z'%20/%3e%3cpath%20fill='url(%23mountain-snow)'%20d='M56%2048l14%2022%2012-18%2010%2022H48z'%20opacity='0.85'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20opacity='0.6'%20d='M32%2094c10-6%2020-9%2032-9s22%203%2032%209'%20/%3e%3c/g%3e%3ccircle%20cx='92'%20cy='32'%20r='6'%20fill='%23f1f5f9'%20opacity='0.5'%20/%3e%3c/svg%3e",uw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eWater%20Tile%3c/title%3e%3cdesc%20id='desc'%3eGlowing%20waves%20surrounding%20a%20crystalline%20droplet.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='water-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230b1120'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='water-wave'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='water-drop'%20x1='50%25'%20y1='0%25'%20x2='50%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230284c7'%20/%3e%3c/linearGradient%3e%3cfilter%20id='water-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='8'%20flood-color='%2338bdf8'%20flood-opacity='0.3'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23water-bg)'%20/%3e%3cg%20filter='url(%23water-glow)'%3e%3cpath%20d='M32%2076c12-10%2024-15%2032-15s20%205%2032%2015'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3cpath%20d='M28%2092c14-12%2030-18%2040-18s26%206%2040%2018'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='6'%20stroke-linecap='round'%20opacity='0.7'%20/%3e%3cpath%20d='M40%2060c10-8%2018-12%2024-12s14%204%2024%2012'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M64%2030c-12%2020-18%2032-18%2042%200%2011%208%2020%2018%2020s18-9%2018-20c0-10-6-22-18-42z'%20fill='url(%23water-drop)'%20stroke='%23e0f2fe'%20stroke-width='2'%20/%3e%3c/g%3e%3ccircle%20cx='94'%20cy='34'%20r='6'%20fill='%23f8fafc'%20opacity='0.45'%20/%3e%3c/svg%3e",dw=.01;function Fb(n){return!Number.isFinite(n)||n<=dw?1:n}function fw(n,a){return n/Fb(a)}function Pn(n,a){const s=Fb(a);return Math.round(n*s)/s}const e2={[Sn.Plains]:{baseColor:"#d8b869",icon:lw},[Sn.Forest]:{baseColor:"#237a55",icon:ow},[Sn.Hills]:{baseColor:"#b57c57",icon:cw},[Sn.Lake]:{baseColor:"#3185d5",icon:uw}},hw=[255,255,255],rm=[12,18,28],mw=[0,0,0],t2="rgba(56, 189, 248, 0.85)",n2="rgba(56, 189, 248, 0.45)";let ll=null,ol=null;const pw=n=>Math.min(1,Math.max(0,n));function gw(n){let a=n.trim().replace("#","");a.length===3&&(a=a.split("").map(r=>r+r).join(""));const s=Number.parseInt(a,16);return[s>>16&255,s>>8&255,s&255]}function Fc(n,a,s){const r=pw(s);return[Math.round(n[0]+(a[0]-n[0])*r),Math.round(n[1]+(a[1]-n[1])*r),Math.round(n[2]+(a[2]-n[2])*r)]}function a2(n){return`rgb(${n[0]}, ${n[1]}, ${n[2]})`}function $c(n,a=1){return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${a})`}function Vc(n,a=1){return $c(Fc(rm,hw,n),a)}function Xs(n,a=1){return $c(Fc(rm,mw,n),a)}const yw={terrain:.05,hover:.065,selection:.085},bw={terrain:1,hover:1.35,selection:2.1};function Xc(n,a,s="terrain"){const r=n*yw[s],o=fw(r,a);return Math.max(bw[s],o)}function vw(){if(ll&&ol)return{stroke:ll,glow:ol};if(typeof window<"u"){const n=getComputedStyle(document.documentElement),a=n.getPropertyValue("--tile-highlight-ring").trim(),s=n.getPropertyValue("--tile-highlight-glow").trim();ll=a||t2,ol=s||n2}else ll=t2,ol=n2;return{stroke:ll,glow:ol}}function $b(n){return Math.min(1,Math.max(0,n))}function ou(n){let a=n.trim();if(a.startsWith("#")&&(a=a.slice(1)),a.length===3){const s=Number.parseInt(a[0]+a[0],16),r=Number.parseInt(a[1]+a[1],16),o=Number.parseInt(a[2]+a[2],16);return[s,r,o]}if(a.length===6){const s=Number.parseInt(a,16),r=s>>16&255,o=s>>8&255,u=s&255;return[r,o,u]}return[0,0,0]}function Sw(n,a,s){const r=$b(s),o=(u,f)=>Math.round(u+(f-u)*r);return[o(n[0],a[0]),o(n[1],a[1]),o(n[2],a[2])]}function Ew([n,a,s],r){return`rgba(${n}, ${a}, ${s}, ${$b(r)})`}function gi(n,a,s,r){return Ew(Sw(n,a,s),r)}function Mw(n){const{ctx:a,x:s,y:r,width:o,height:u,radius:f,baseColor:h}=n,m=ou(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=gi(m,[255,255,255],.35,.24);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.06);const g=3,b=6,v=s+o*.12,E=s+o*.88;for(let N=0;N<g;N++){const q=N/Math.max(1,g-1),j=r+u*.28+q*u*.32,F=f*(.18-q*.05);a.beginPath();for(let Q=0;Q<=b;Q++){const se=Q/b,ee=v+(E-v)*se,le=Math.sin(se*Math.PI*1.6+N*.8)*F,P=j-Math.abs(le)*.55;Q===0?a.moveTo(ee,P):a.lineTo(ee,P)}a.stroke()}const M=gi(m,[18,54,32],.4,.2);a.strokeStyle=M,a.lineWidth=Math.max(.75,f*.035);const C=5,R=f*.22;for(let N=0;N<C;N++){const q=s+o*(.2+N/Math.max(1,C-1)*.6),j=r+u*.55-Math.cos(N*.9)*f*.08;a.beginPath(),a.arc(q,j,R,Math.PI*.2,Math.PI*.85),a.stroke(),a.beginPath(),a.arc(q+R*.35,j-R*.1,R*.55,Math.PI*.15,Math.PI*.95),a.stroke()}a.restore()}function xw(n){const{ctx:a,centerX:s,centerY:r,radius:o,baseColor:u}=n,f=ou(u);a.save(),a.lineCap="round";const h=gi(f,[255,235,214],.45,.22);a.strokeStyle=h,a.lineWidth=Math.max(1,o*.05);const m=4;for(let b=0;b<m;b++){const v=b/Math.max(1,m-1),E=o*(1.25-v*.45),M=o*(.72-v*.18),C=r+o*.18*(v-.5);a.beginPath(),a.ellipse(s,C,E,M,0,Math.PI*.12,Math.PI*.88),a.stroke()}const p=gi(f,[60,36,20],.35,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,o*.032),a.setLineDash([o*.22,o*.18]);const g=3;for(let b=0;b<g;b++){const v=o*(.75-b*.1),E=r+o*.28+b*o*.08;a.beginPath(),a.arc(s+o*.08,E,v,Math.PI*.28,Math.PI*.76),a.stroke()}a.setLineDash([]),a.restore()}function ww(n){const{ctx:a,x:s,y:r,width:o,height:u,radius:f,baseColor:h}=n,m=ou(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=gi(m,[255,255,255],.55,.28);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.045);const g=4,b=7,v=s+o*.12,E=s+o*.88,M=f*.16;for(let N=0;N<g;N++){const q=N/Math.max(1,g-1),j=r+u*.3+q*u*.4;a.beginPath();for(let F=0;F<=b;F++){const Q=F/b,se=v+(E-v)*Q,ee=Math.sin(Q*Math.PI*2+N*.6)*M*(.75-q*.2),le=j+ee;F===0?a.moveTo(se,le):a.lineTo(se,le)}a.stroke()}const C=gi(m,[12,52,94],.4,.2);a.strokeStyle=C,a.lineWidth=Math.max(.8,f*.03);const R=3;for(let N=0;N<R;N++){const q=N/Math.max(1,R-1),j=r+u*.35+q*u*.35;a.beginPath();for(let F=0;F<=b;F++){const Q=F/b,se=v+(E-v)*Q,ee=Math.sin(Q*Math.PI*2+N)*M*.35,le=j+ee;F===0?a.moveTo(se,le):a.lineTo(se,le)}a.stroke()}a.restore()}function Vb(n){const{ctx:a,x:s,y:r,width:o,height:u,radius:f,baseColor:h}=n,m=ou(h);a.save(),a.lineCap="round";const p=gi(m,[255,255,255],.42,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,f*.03);const g=f*.55;for(let E=-1;E<=2;E++){const M=g*E;a.beginPath(),a.moveTo(s+M,r+u*.25),a.lineTo(s+M+o*.75,r+u*.85),a.stroke()}const b=gi(m,[112,82,32],.3,.16);a.strokeStyle=b,a.lineWidth=Math.max(.7,f*.025),a.setLineDash([f*.24,f*.34]);const v=f*.48;for(let E=0;E<3;E++){const M=v*E;a.beginPath(),a.moveTo(s+o*.18+M,r+u*.78),a.lineTo(s+o*.7+M,r+u*.38),a.stroke()}a.setLineDash([]),a.restore()}const i2=new Map;let ji=null;function Aw(){if(ji)return ji;const n="/";if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(n))return ji=n,ji;const s=n.startsWith("/")?n:`/${n}`;return typeof window<"u"&&typeof window.location?.origin=="string"?ji=`${window.location.origin}${s}`:ji=`http://localhost${s}`,ji}function Cw(n){let a=i2.get(n);if(!a){a=new Image,a.decoding="async";const s=new URL(n,Aw()).href;a.src=s,i2.set(n,a)}if(a.complete&&a.naturalWidth>0&&a.naturalHeight>0)return a}const Tw={[Sn.Plains]:Vb,[Sn.Forest]:Mw,[Sn.Hills]:xw,[Sn.Lake]:ww};function Xb(n,a,s,r){n.beginPath();for(let o=0;o<6;o++){const u=Math.PI/180*(60*o-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);o===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function _w(n,a,s,r){Xb(n,a,s,r),n.save(),n.lineJoin="round",n.lineCap="round",n.lineWidth=Xc(r,1,"terrain"),n.strokeStyle=Vc(.16,.6),n.stroke(),n.restore()}function Rw(n,a,s,r,o,u,f,h){const m=e2[a.terrain]??e2[Sn.Plains],p=gw(m.baseColor),g=r+u/2,b=o+f/2;n.save(),Xb(n,g,b,h),n.clip();const v=n.createRadialGradient(g,b,h*.2,g,b,h*1.05);v.addColorStop(0,a2(Fc(p,[255,255,255],.3))),v.addColorStop(.7,m.baseColor),v.addColorStop(1,a2(Fc(p,rm,.4))),n.fillStyle=v,n.shadowColor=$c(p,.35),n.shadowBlur=h*.9,n.shadowOffsetX=0,n.shadowOffsetY=0,n.fillRect(r-h*.1,o-h*.1,u+h*.2,f+h*.2);const E={ctx:n,x:r,y:o,width:u,height:f,radius:h,centerX:g,centerY:b,baseColor:m.baseColor};(Tw[a.terrain]??Vb)(E),n.globalCompositeOperation="lighter";const C=n.createRadialGradient(g,b,h*.85,g,b,h*1.18);C.addColorStop(0,"rgba(255, 255, 255, 0)"),C.addColorStop(1,$c(p,.18)),n.fillStyle=C,n.fillRect(r-h*.1,o-h*.1,u+h*.2,f+h*.2),n.globalCompositeOperation="source-over",n.restore();const R=Cw(m.icon);if(R){const N=Math.min(u,f)*.62,q=g-N/2,j=b-N/2;n.save(),n.globalAlpha*=.92,n.drawImage(R,q,j,N,N),n.restore()}if(a.building){const N=s[`building-${a.building}`]??s.placeholder;n.drawImage(N,r,o,u,f)}}function Nw(n,a){const s=Math.max(n.q*Ta,a.minQ),r=Math.min(s+Ta-1,a.maxQ),o=Math.max(n.r*Ta,a.minR),u=Math.min(o+Ta-1,a.maxR);return{qStart:s,qEnd:r,rStart:o,rEnd:u}}class kw{constructor(a){this.map=a,this.unsubscribe=a.addTileChangeListener((s,r,o)=>{this.onTileChange(s,o)})}chunkCanvases=new Map;dirtyChunks=new Set;cachedImages;unsubscribe;dispose(){this.unsubscribe(),this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}invalidate(){this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}markChunkDirty(a){this.dirtyChunks.add(a)}markTileDirty(a,s){this.dirtyChunks.add(aw(a,s))}getRenderableChunks(a,s,r,o){this.refreshAssets(r);const u=[],{width:f,height:h}=Yc(s);for(const m of Yb(a)){const p=Ib(m),g=this.ensureChunk(p,m,s,f,h,r,o);g&&u.push(g)}return u}refreshAssets(a){if(this.cachedImages!==a){this.cachedImages=a;for(const s of this.chunkCanvases.keys())this.dirtyChunks.add(s)}}onTileChange(a,s){(s==="created"||s==="terrain"||s==="building"||s==="fog")&&this.markTileDirty(a.q,a.r)}ensureChunk(a,s,r,o,u,f,h){const m=this.chunkCanvases.get(a);if(!m||this.dirtyChunks.has(a)){const p=this.renderChunk(a,s,r,o,u,f,h,m);return this.dirtyChunks.delete(a),p?(this.chunkCanvases.set(a,p),p):(this.chunkCanvases.delete(a),null)}return m}renderChunk(a,s,r,o,u,f,h,m){if(typeof document>"u")return null;const{qStart:p,qEnd:g,rStart:b,rEnd:v}=Nw(s,this.map);if(p>g||b>v)return null;const E=o/2,M=u/2;let C=1/0,R=1/0,N=-1/0,q=-1/0;const j=[];for(let le=p;le<=g;le++)for(let P=b;P<=v;P++){const I=this.map.getTile(le,P);if(!I||I.isFogged)continue;const{x:T,y:k}=Jn({q:le,r:P},r),A=T-h.x-E,Y=k-h.y-M;C=Math.min(C,A),R=Math.min(R,Y),N=Math.max(N,A+o),q=Math.max(q,Y+u),j.push({tile:I,x:A,y:Y})}if(!Number.isFinite(C)||!Number.isFinite(R)||!Number.isFinite(N)||!Number.isFinite(q))return null;const F=Math.max(1,Math.ceil(N-C)),Q=Math.max(1,Math.ceil(q-R));let se=m?.canvas;(!se||se.width!==F||se.height!==Q)&&(se=document.createElement("canvas"),se.width=F,se.height=Q);const ee=se.getContext("2d");if(!ee)throw new Error("Canvas 2D context not available for chunk rendering");ee.setTransform(1,0,0,1,0,0),ee.clearRect(0,0,F,Q);for(const{tile:le,x:P,y:I}of j){const T=P-C,k=I-R;ee.save(),Rw(ee,le,f,T,k,o,u,r),_w(ee,T+o/2,k+u/2,r),ee.restore()}return{key:a,canvas:se,origin:{x:C,y:R},width:F,height:Q}}}const Dw=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],wa=new Array(512);for(let n=0;n<512;n++)wa[n]=Dw[n%256];const s2=new Map,r2=n=>n*n*n*(n*(n*6-15)+10),$f=(n,a,s)=>n+s*(a-n),bc=(n,a,s)=>{switch(n&3){case 0:return a+s;case 1:return-a+s;case 2:return a-s;default:return-a-s}};function Lw(n,a){const s=Math.floor(n)&255,r=Math.floor(a)&255,o=n-Math.floor(n),u=a-Math.floor(a),f=wa[wa[s+1]+r+1],h=wa[wa[s]+r+1],m=wa[wa[s+1]+r],p=wa[wa[s]+r],g=r2(o),b=r2(u),v=$f(bc(p,o,u),bc(m,o-1,u),g),E=$f(bc(h,o,u-1),bc(f,o-1,u-1),g);return $f(v,E,b)}function Uw(n,a,s=4){let r=0,o=1,u=1,f=0;for(let h=0;h<s;h++)r+=Lw(n*o,a*o)*u,f+=u,u*=.5,o*=2;return f>0?r/f:0}function Ow(n){const a=Math.max(32,Math.min(512,Math.round(n))),s=a,r=s2.get(s);if(r)return r;if(typeof document>"u")return null;const o=document.createElement("canvas");o.width=a,o.height=a;const u=o.getContext("2d");if(!u)return null;const f=u.createImageData(a,a),h=a/48;let m=0;for(let p=0;p<a;p++)for(let g=0;g<a;g++){const b=Uw(g/h,p/h,5),v=Math.pow((b+1)/2,1.35),E=Math.round(v*255);f.data[m]=255,f.data[m+1]=255,f.data[m+2]=255,f.data[m+3]=E,m+=4}return u.putImageData(f,0,0),s2.set(s,o),o}function l2(n,a,s,r){n.beginPath();for(let o=0;o<6;o++){const u=Math.PI/180*(60*o-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);o===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function qw(n,a,s,r){const o=n.createRadialGradient(a,s,r*.08,a,s,r*1.12);return o.addColorStop(0,Vc(.4,.35)),o.addColorStop(.35,Vc(.2,.55)),o.addColorStop(.6,Xs(.1,.78)),o.addColorStop(.82,Xs(.2,.88)),o.addColorStop(1,Xs(.35,.95)),o}function zw(n,a,s,r,o){if(r<=0)return;const u=Ow(r*2.2),f=r*2.5,h=a-f/2,m=s-f/2;n.save(),l2(n,a,s,r),n.clip();const p=qw(n,a,s,r);n.fillStyle=p,n.fillRect(h,m,f,f),u&&(n.save(),n.globalCompositeOperation="lighter",n.globalAlpha*=.32,n.drawImage(u,a-r,s-r,r*2,r*2),n.restore()),n.restore(),n.save(),l2(n,a,s,r*.99),n.lineJoin="round",n.lineCap="round",n.lineWidth=Xc(r,o,"hover"),n.strokeStyle=Xs(.3,.88),n.shadowColor=Xs(.45,.42),n.shadowBlur=Math.max(3,r*.45/Math.max(o,.1)),n.stroke(),n.restore()}class Bw{constructor(a){this.mapRef=a,this.terrainCache=new kw(a),this.cachedHexSize=a.hexSize}terrainCache;cachedHexSize;get hexSize(){return this.mapRef.hexSize}getOrigin(){return Jn({q:this.mapRef.minQ,r:this.mapRef.minR},this.hexSize)}invalidateCache(){this.terrainCache.invalidate()}dispose(){this.terrainCache.dispose()}draw(a,s,r){this.ensureHexSize();const o=a.canvas??null,u=nw(this.mapRef,Ee,o,this.hexSize);if(!u)return;const f=iw(u);rw(this.mapRef,f);const h=this.getOrigin(),m=this.terrainCache.getRenderableChunks(f,this.hexSize,s,h);this.drawChunks(a,m),this.drawFogLayer(a,h,u),r&&this.drawSelection(a,h,r)}drawToCanvas(a,s,r){const o=a.getContext("2d");if(!o)throw new Error("Canvas 2D context not available");this.draw(o,s,r)}ensureHexSize(){this.cachedHexSize!==this.hexSize&&(this.cachedHexSize=this.hexSize,this.terrainCache.invalidate())}drawChunks(a,s){if(s.length!==0)for(const r of s)a.drawImage(r.canvas,r.origin.x,r.origin.y)}drawSelection(a,s,r){const{width:o,height:u}=Yc(this.hexSize),{x:f,y:h}=Jn(r,this.hexSize),m=f-s.x-o/2,p=h-s.y-u/2;this.strokeHex(a,m+o/2,p+u/2,this.hexSize,!0)}drawFogLayer(a,s,r){const{width:o,height:u}=Yc(this.hexSize),f=o/2,h=u/2;for(let m=r.rMin;m<=r.rMax;m++)for(let p=r.qMin;p<=r.qMax;p++){const g=this.mapRef.getTile(p,m);if(!g||!g.isFogged)continue;const{x:b,y:v}=Jn({q:p,r:m},this.hexSize),E=b-s.x-f,M=v-s.y-h,C=this.hexSize,R=E+o/2,N=M+u/2;zw(a,R,N,C,Ee.zoom)}}strokeHex(a,s,r,o,u=!1){const{stroke:f,glow:h}=vw();this.hexPath(a,s,r,o),a.save(),a.lineJoin="round",a.lineCap="round",u?(a.shadowColor=h,a.shadowBlur=Math.max(6,o*.65/Math.max(Ee.zoom,.1)),a.lineWidth=Xc(o,Ee.zoom,"selection"),a.strokeStyle=f,a.stroke()):(a.lineWidth=Xc(o,Ee.zoom,"hover"),a.shadowColor=Vc(.1,.45),a.shadowBlur=Math.max(2,o*.4/Math.max(Ee.zoom,.1)),a.strokeStyle=Xs(.1,.72),a.stroke()),a.restore()}hexPath(a,s,r,o){a.beginPath();for(let u=0;u<6;u++){const f=Math.PI/180*(60*u-30),h=s+o*Math.cos(f),m=r+o*Math.sin(f);u===0?a.moveTo(h,m):a.lineTo(h,m)}a.closePath()}}const ui={accent:"#38bdf8",accentSoft:"rgba(56, 189, 248, 0.2)",warm:"#fbbf24",surface:"rgba(15, 23, 42, 0.92)",border:"rgba(148, 163, 184, 0.34)",text:"#e2e8f0"};let di=null;function Hs(n,a){const s=n.trim();return s.length>0?s:a}function Hw(){if(di)return di;if(typeof window>"u"||typeof document>"u")return di=ui,di;try{const n=getComputedStyle(document.documentElement);return di={accent:Hs(n.getPropertyValue("--color-accent"),ui.accent),accentSoft:Hs(n.getPropertyValue("--color-accent-soft"),ui.accentSoft),warm:Hs(n.getPropertyValue("--color-warning"),ui.warm),surface:Hs(n.getPropertyValue("--color-surface-strong"),ui.surface),border:Hs(n.getPropertyValue("--hud-border-strong"),ui.border),text:Hs(n.getPropertyValue("--color-foreground"),ui.text)},di}catch(n){return console.warn("Failed to read sauna palette tokens from computed styles",n),di=ui,di}}function jw(n,a){const s=Math.max(0,n.auraRadius),r=Jn(n.pos,a),o=r.x+a,u=r.y+a;let f=a;if(s<=0)return a*1.6;for(const h of z2){const m=Jn({q:n.pos.q+h.q*s,r:n.pos.r+h.r*s},a),p=m.x+a,g=m.y+a,b=Math.hypot(p-o,g-u);b>f&&(f=b)}return f+a*.65}function Gw(n,a,s,r,o,u){const f=Math.max(0,Math.min(u,Math.min(r,o)/2));n.moveTo(a+f,s),n.lineTo(a+r-f,s),n.quadraticCurveTo(a+r,s,a+r,s+f),n.lineTo(a+r,s+o-f),n.quadraticCurveTo(a+r,s+o,a+r-f,s+o),n.lineTo(a+f,s+o),n.quadraticCurveTo(a,s+o,a,s+o-f),n.lineTo(a,s+f),n.quadraticCurveTo(a,s,a+f,s),n.closePath()}function Iw(n,a,{origin:s,hexSize:r,timestamp:o}){if(!a)return;const u=Hw(),f=Number.isFinite(o)?o:typeof performance<"u"?performance.now():Date.now(),h=.5+.5*Math.sin(f*.0035),m=Jn(a.pos,r),p=m.x-s.x+r,g=m.y-s.y+r,b=jw(a,r);n.save(),n.globalCompositeOperation="screen";const v=b+r*(.4+h*.3),E=Math.max(r*.6,b*.58),M=n.createRadialGradient(p,g,E,p,g,v);M.addColorStop(0,u.accentSoft),M.addColorStop(.55,`rgba(56, 189, 248, ${.18+h*.12})`),M.addColorStop(1,"rgba(2, 6, 23, 0)"),n.fillStyle=M,n.beginPath(),n.arc(p,g,v,0,Math.PI*2),n.fill(),n.restore(),n.save(),n.globalCompositeOperation="lighter",n.lineWidth=Math.max(r*.28,6),n.strokeStyle=`rgba(56, 189, 248, ${(.35+h*.2).toFixed(3)})`,n.shadowColor=`rgba(56, 189, 248, ${.45+h*.1})`,n.shadowBlur=r*(.9+h*.45),n.beginPath(),n.arc(p,g,b+r*.12,0,Math.PI*2),n.stroke(),n.restore();const C=r*.9;n.save(),n.beginPath(),n.arc(p,g,C,0,Math.PI*2),n.fillStyle=u.surface,n.globalAlpha*=.96,n.fill(),n.lineWidth=Math.max(1.5,r*.06),n.strokeStyle=u.border,n.shadowColor="rgba(8, 25, 53, 0.6)",n.shadowBlur=r*.45,n.stroke(),n.restore();const R=C*.78,N=Math.max(r*.22,5);n.save(),n.lineWidth=N,n.strokeStyle="rgba(148, 163, 184, 0.24)",n.beginPath(),n.arc(p,g,R,0,Math.PI*2),n.stroke(),n.restore();const q=a.playerSpawnCooldown>0?a.playerSpawnCooldown:1,F=1-Math.min(1,Math.max(0,a.playerSpawnTimer/q)),Q=-Math.PI/2,se=Q+Math.PI*2*F;if(F>0){n.save(),n.lineWidth=N,n.lineCap="round";const $=n.createLinearGradient(p,g-R,p,g+R);$.addColorStop(0,u.accent),$.addColorStop(1,u.warm),n.strokeStyle=$,n.shadowColor=`rgba(56, 189, 248, ${.42+h*.18})`,n.shadowBlur=r*(.65+h*.35),n.beginPath(),n.arc(p,g,R,Q,se,!1),n.stroke(),n.restore()}const ee=Math.max(0,a.playerSpawnTimer),le=Math.ceil(ee);n.save(),n.font=`600 ${Math.max(12,r*.9)}px "Inter", "Manrope", "Segoe UI", sans-serif`,n.fillStyle=u.text,n.textAlign="center",n.textBaseline="middle",n.shadowColor="rgba(2, 6, 23, 0.6)",n.shadowBlur=r*.35,n.fillText(String(le),p,g),n.restore(),n.save(),n.font=`500 ${Math.max(10,r*.36)}px "Inter", "Manrope", "Segoe UI", sans-serif`,n.fillStyle="rgba(148, 163, 184, 0.78)",n.textAlign="center",n.textBaseline="top",n.fillText("sec",p,g+R*.45),n.restore();const P="Sauna ♨️",I=Math.max(12,r*.58);n.save(),n.font=`600 ${I}px "Inter", "Manrope", "Segoe UI", sans-serif`;const T=n.measureText(P),k=r*.58,A=r*.32,Y=T.width+k*2,B=I+A*2,D=p-Y/2,V=g-b-B-r*.35,te=B/2;n.beginPath(),Gw(n,D,V,Y,B,te);const he=n.createLinearGradient(D,V,D,V+B);he.addColorStop(0,"rgba(15, 23, 42, 0.94)"),he.addColorStop(.55,"rgba(15, 23, 42, 0.86)"),he.addColorStop(1,"rgba(30, 41, 59, 0.9)"),n.fillStyle=he,n.shadowColor="rgba(8, 25, 53, 0.6)",n.shadowBlur=r*.4,n.fill(),n.lineWidth=Math.max(1.5,r*.06);const w=n.createLinearGradient(D,V,D+Y,V);w.addColorStop(0,`${u.accent}`),w.addColorStop(1,`${u.warm}`),n.strokeStyle=w,n.stroke(),n.fillStyle=u.text,n.shadowColor="rgba(8, 25, 53, 0.65)",n.shadowBlur=r*.3,n.textAlign="center",n.textBaseline="middle",n.fillText(P,p,V+B/2+I*.05),n.restore()}const Kb={nativeSize:{width:64,height:64},anchor:{x:.5,y:.92},scale:{x:1,y:1},nudge:{x:0,y:-.05}},Yw={default:Kb,soldier:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.9},scale:{x:1.12,y:1.24},nudge:{x:0,y:-.14}},archer:{nativeSize:{width:128,height:128},anchor:{x:.46,y:.88},scale:{x:1.1,y:1.22},nudge:{x:-.04,y:-.12}},"avanto-marauder":{nativeSize:{width:128,height:128},anchor:{x:.5,y:.92},scale:{x:1.18,y:1.3},nudge:{x:0,y:-.18}},saunoja:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.66},scale:{x:1,y:1},nudge:{x:0,y:-.02}}};function Qb(n){return Yw[n]??Kb}function Pb(n,a,s,r){const{x:o,y:u}=Jn(n,a),f=r.nudge.x*a,h=r.nudge.y*a;return{x:o-s.x+f,y:u-s.y+h}}function Fw({coord:n,hexSize:a,origin:s,zoom:r,type:o}){const u=Qb(o),f=Pb(n,a,s,u);return{x:Pn(f.x,r),y:Pn(f.y,r)}}function $w({coord:n,hexSize:a,origin:s,zoom:r,type:o}){const u=Qb(o),f=Pb(n,a,s,u),{width:h,height:m}=Yc(a),p=h*u.scale.x,g=m*u.scale.y,b=Pn(f.x-p*u.anchor.x,r),v=Pn(f.y-g*u.anchor.y,r),E=Pn(p,r),M=Pn(g,r),C=b+E*u.anchor.x,R=v+M*u.anchor.y;return{drawX:b,drawY:v,width:E,height:M,centerX:C,centerY:R,metadata:u}}function Vw(n){if(!n||typeof n!="object")return!1;const a=n;return!!a.coord&&typeof a.coord=="object"&&typeof a.coord.q=="number"&&typeof a.coord.r=="number"&&typeof a.range=="number"}function Xw(n){if(!n)return null;if(Vw(n)){const a=Number.isFinite(n.range)?Math.max(0,n.range):0;return{coord:n.coord,range:a}}if("pos"in n&&"auraRadius"in n){const a=Number.isFinite(n.auraRadius)?Math.max(0,n.auraRadius):0;return{coord:n.pos,range:a}}return null}function Kw(n,a,s,r,o,u){const f=window.devicePixelRatio||1,h=n.canvas.width,m=n.canvas.height;n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,h,m);const p=h/f,g=m/f;n.scale(f,f),n.translate(p/2,g/2),n.scale(Ee.zoom,Ee.zoom);const b=a.getOrigin();n.translate(-(Ee.x-b.x),-(Ee.y-b.y)),a.draw(n,s,o??void 0);const v=u?.saunojas;v&&Array.isArray(v.units)&&v.units.length>0&&v.draw(n,v.units,{originX:b.x,originY:b.y,hexRadius:a.hexSize,zoom:Ee.zoom,resolveRenderCoord:v.resolveRenderCoord}),Qw(n,a,s,r,b,u?.fx,u?.friendlyVisionSources,u?.saunaVision??u?.sauna??null),u?.sauna&&Iw(n,u.sauna,{origin:b,hexSize:a.hexSize}),n.restore()}function Qw(n,a,s,r,o,u,f,h){const p=(f??r).filter(b=>b.faction==="player"&&!b.isDead()).map(b=>({coord:b.coord,range:b.getVisionRange()})),g=Xw(h);g&&p.push(g);for(const b of r){if(b.isDead()||b.faction==="enemy"&&!p.some(({coord:Q,range:se})=>Gs(Q,b.coord)<=se))continue;const v=s[`unit-${b.type}`]??s.placeholder,E=b.getMaxHealth();n.save();const M=u?.getUnitAlpha?.(b);if(typeof M=="number"){const Q=Math.min(1,Math.max(0,M));if(Q<=0){n.restore();continue}n.globalAlpha*=Q}b.stats.health/E<.5&&(n.filter="saturate(0)");const C=b.renderCoord??b.coord,R=$w({coord:C,hexSize:a.hexSize,origin:o,zoom:Ee.zoom,type:b.type}),N=[];b.stats.health/E<.5&&N.push("saturate(0)");const q=Math.abs(C.q-b.coord.q),j=Math.abs(C.r-b.coord.r),F=Math.min(1,q+j);F>.01?(N.push("contrast(1.08)"),n.shadowColor="rgba(255, 255, 255, 0.28)",n.shadowBlur=Math.max(6,12*Ee.zoom*F)):(n.shadowColor="rgba(0, 0, 0, 0)",n.shadowBlur=0),n.filter=N.length>0?N.join(" "):"none",n.drawImage(v,R.drawX,R.drawY,R.width,R.height),am()&&b.faction==="player"&&(n.strokeStyle="rgba(255,255,255,0.5)",n.lineWidth=2,n.strokeRect(R.drawX,R.drawY,R.width,R.height)),n.restore()}}const Pw=200,o2=.001;function Vf(n){return{q:n.q,r:n.r}}function vc(n,a){return!n||!a?!1:Math.abs(n.q-a.q)<o2&&Math.abs(n.r-a.r)<o2}class Zw{constructor(a){this.redraw=a}tracks=new Map;rafId=null;enqueue(a,s){const r=this.normalizePath(s);if(r.length<2){this.clear(a,{snap:!0});return}const o=r[0];let u=this.tracks.get(a.id);u?u.current?vc(u.current.to,o)||(u=this.resetTrack(a,o)):vc(a.renderCoord,o)||(u=this.resetTrack(a,o)):(u={unit:a,queue:[]},this.tracks.set(a.id,u),vc(a.renderCoord,o)||a.setRenderCoord(o));for(let f=1;f<r.length;f++)u.queue.push(Vf(r[f]));this.ensureRunning()}clear(a,s){if(!this.tracks.delete(a.id)){s?.snap&&(a.snapRenderToCoord(),this.redraw());return}(s?.snap??!0)&&(a.snapRenderToCoord(),this.redraw()),this.tracks.size===0&&this.rafId!==null&&(typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null)}clearAll(){for(const a of this.tracks.values())a.unit.snapRenderToCoord();this.tracks.clear(),this.rafId!==null&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null,this.redraw()}resetTrack(a,s){this.clear(a,{snap:!1});const r={unit:a,queue:[]};return this.tracks.set(a.id,r),a.setRenderCoord(s),r}ensureRunning(){this.rafId!==null||this.tracks.size===0||(this.rafId=requestAnimationFrame(this.step))}normalizePath(a){const s=[];for(const r of a){const o=Vf(r);(s.length===0||!vc(s[s.length-1],o))&&s.push(o)}return s}ease(a){return a<=0?0:a>=1?1:a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2}step=a=>{if(this.rafId=null,this.tracks.size===0)return;let s=!1;for(const[r,o]of this.tracks){if(!o.current){const v=o.queue.shift();if(!v){this.tracks.delete(r);continue}o.current={from:Vf(o.unit.renderCoord??o.unit.coord),to:v,start:a}}const u=o.current;if(!u)continue;const h=(a-u.start)/Pw,m=Math.min(1,Math.max(0,h)),p=this.ease(m),g=u.from.q+(u.to.q-u.from.q)*p,b=u.from.r+(u.to.r-u.from.r)*p;o.unit.setRenderCoord({q:g,r:b}),s=!0,m>=1&&(o.unit.setRenderCoord(u.to),o.current=void 0,o.queue.length===0&&this.tracks.delete(r))}s&&this.redraw(),this.tracks.size>0&&(this.rafId=requestAnimationFrame(this.step))}}const Jw=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,Ww=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null,eA=900,tA=650;function nA(n){switch(n){case"down":return{x:0,y:36};case"left":return{x:-26,y:-18};case"right":return{x:26,y:-18};case"up":default:return{x:0,y:-40}}}function aA(n){const a=document.createElement("div");a.className="ui-floater-layer",n.appendChild(a);const s=!!Jw?.matches,r=!!Ww?.matches;return{spawn:({text:f,x:h,y:m,color:p,direction:g="up",durationMs:b,fontSize:v})=>{const E=document.createElement("span");E.className="ui-floater",E.textContent=f,E.style.left=`${Math.round(h)}px`,E.style.top=`${Math.round(m)}px`,p&&(E.style.color=p),v&&(E.style.fontSize=`${v}px`);const M=r?12:24;for(;a.childElementCount>=M;)a.firstElementChild?.remove();a.appendChild(E);const C=b??(r?tA:eA);if(s||!E.animate){E.style.opacity="0",E.style.transition=`opacity ${Math.round(C*.8)}ms ease-out`,requestAnimationFrame(()=>{E.style.opacity="1",requestAnimationFrame(()=>{E.style.opacity="0"})}),window.setTimeout(()=>{E.remove()},C);return}const R=nA(g),N=[{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:0},{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:1,offset:.18},{transform:`translate3d(-50%, -50%, 0) translate3d(${R.x}px, ${R.y}px, 0)`,opacity:0}],q=E.animate(N,{duration:C,easing:"cubic-bezier(0.18, 0.89, 0.32, 1.28)",fill:"forwards"});q.onfinish=()=>{E.remove()}},destroy:()=>{a.remove()}}}const c2=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),iA=new Intl.NumberFormat("en-US",{maximumFractionDigits:1,minimumFractionDigits:0});function u2(n){return 1-(1-n)*(1-n)}function Sc(n,a,s){return Math.min(s,Math.max(a,n))}const sA="var(--color-danger)",rA="color-mix(in srgb, #34d399 88%, white 12%)",lA=720,oA=540,cA=220,uA=180,dA=6,fA=3,hA="color-mix(in srgb, #fbbf24 82%, white 10%)",mA=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,pA=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null;function gA(n){const{canvas:a,overlay:s,mapRenderer:r,getUnitById:o,requestDraw:u}=n,f=aA(s),h=new Map,m=new Map,p=[],g={x:0,y:0},b=!!mA?.matches,v=!!pA?.matches,E=v?oA:lA,M=v?uA:cA,C=v?fA:dA,R=()=>{u&&(typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>u()):u())},N=I=>{const T=a.getBoundingClientRect(),k=s.getBoundingClientRect();if(T.width===0||T.height===0)return null;const{x:A,y:Y}=Jn(I,r.hexSize),B=(A-Ee.x)*Ee.zoom+T.width/2,D=(Y-Ee.y)*Ee.zoom+T.height/2,V=r.hexSize*Ee.zoom*.75;return{x:B+(T.left-k.left),y:D+(T.top-k.top)-V}},q=(I,T,k,A="up")=>{const Y=o(I);if(!Y)return;const B=N(Y.renderCoord??Y.coord);B&&f.spawn({text:T,x:B.x,y:B.y,color:k,direction:A,fontSize:v?18:void 0})},j=I=>{if(!I||I.amount<=0)return;const T=c2.format(Math.max(1,Math.round(I.amount)));if(q(I.targetId,`-${T}`,sA,"up"),!b){const k=typeof performance<"u"?performance.now():Date.now();p.push({start:k,duration:M,intensity:C,seedX:Math.random()*500,seedY:Math.random()*500})}R()},F=I=>{if(!I||I.amount<=0)return;const T=I.amount>=1?c2.format(Math.round(I.amount)):iA.format(Sc(I.amount,0,9.9));q(I.unitId,`+${T}`,rA,"up"),R()},Q=I=>{if(!I)return;const T=typeof performance<"u"?performance.now():Date.now();h.set(I.unitId,{start:T,duration:E}),q(I.unitId,"✖",hA,"down"),R()};return ne.on("unitDamaged",j),ne.on("unitHealed",F),ne.on("unitDied",Q),{step:I=>{if(b)g.x=0,g.y=0;else{let T=0,k=0;for(let A=p.length-1;A>=0;A--){const Y=p[A],B=I-Y.start;if(B>=Y.duration){p.splice(A,1);continue}const D=Sc(B/Y.duration,0,1),V=Y.intensity*u2(1-D);T+=Math.sin((I+Y.seedX)/16)*V,k+=Math.cos((I+Y.seedY)/18)*V}g.x=T,g.y=k}for(const[T,k]of h){const A=I-k.start,Y=Sc(A/k.duration,0,1),B=1-u2(Y);if(Y>=1){m.delete(T),h.delete(T);continue}m.set(T,Sc(B,0,1))}},getShakeOffset:()=>({x:g.x,y:g.y}),getUnitAlpha:I=>m.get(I)??1,dispose:()=>{ne.off("unitDamaged",j),ne.off("unitHealed",F),ne.off("unitDied",Q),p.length=0,h.clear(),m.clear(),f.destroy()}}}function yA(){return`${"/".endsWith("/")?"/":"//"}${"assets/units/saunoja.svg".replace(/^\/+/,"")}`}const d2=yA();let Ys=null,cl=null;function Th(n){return!!(n&&n.complete&&n.naturalWidth>0&&n.naturalHeight>0)}function bA(n,a){if(!a)return n;try{a(n)}catch(s){console.error("Saunoja icon onLoad callback failed",s)}return n}function Zb(n){const a=r=>n?r.then(o=>bA(o,n)):r;if(Th(Ys))return a(Promise.resolve(Ys));if(cl)return a(cl);if(typeof Image>"u")return Promise.reject(new Error("Image constructor is not available in this environment."));const s=new Image;return s.decoding="async",Ys=s,cl=new Promise((r,o)=>{const u=()=>{s.onload=null,s.onerror=null},f=()=>{u(),r(s)};s.onload=f,s.onerror=h=>{u(),Ys=null,cl=null;const m=new Error(`Failed to load saunoja icon from ${d2}`);console.warn(m.message,h),o(m)},s.src=d2,Th(s)&&f()}),a(cl)}function vA(n,a,{originX:s=0,originY:r=0,hexRadius:o=er,zoom:u=1,resolveRenderCoord:f}={}){if(!n||!Array.isArray(a)||a.length===0)return;const h=Th(Ys)?Ys:null;if(!h)return;const m=Number.isFinite(o)&&o>0?o:er,p=m*.965,g=a.map(b=>{const v=f?.(b),M=v&&typeof v=="object"&&Number.isFinite(v.q)&&Number.isFinite(v.r)?{q:v.q,r:v.r}:b.coord;return{unit:b,coord:M}}).sort((b,v)=>b.coord.r!==v.coord.r?b.coord.r-v.coord.r:b.coord.q!==v.coord.q?b.coord.q-v.coord.q:b.unit.id.localeCompare(v.unit.id));for(const{unit:b,coord:v}of g){const{x:E,y:M}=Fw({coord:v,hexSize:m,origin:{x:s,y:r},zoom:u,type:"saunoja"});n.save(),yl(n,E,M,p),n.clip();const C=h.naturalWidth||1,R=h.naturalHeight||1,N=p*1.85,q=p*2.4,j=Math.min(N/C,q/R),F=Pn(C*j,u),Q=Pn(R*j,u),se=Pn(E-F/2,u),ee=Pn(M-Q*.78,u);n.save(),n.filter="saturate(112%) contrast(108%) brightness(1.04)",n.drawImage(h,se,ee,F,Q),n.restore(),n.save(),n.globalCompositeOperation="multiply";const le=n.createRadialGradient(E,M+p*.38,p*.2,E,M+p*.38,p*1.05);le.addColorStop(0,"rgba(22, 30, 50, 0.58)"),le.addColorStop(1,"rgba(22, 30, 50, 0)"),n.fillStyle=le,n.fillRect(E-p,M-p,p*2,p*2),n.restore(),n.save(),n.globalCompositeOperation="soft-light";const P=n.createLinearGradient(E,M-p,E,M+p);P.addColorStop(0,"rgba(233, 224, 255, 0.28)"),P.addColorStop(.52,"rgba(196, 148, 255, 0.26)"),P.addColorStop(1,"rgba(94, 75, 168, 0.35)"),n.fillStyle=P,n.fillRect(E-p,M-p,p*2,p*2),n.restore(),n.save(),n.globalCompositeOperation="screen",n.globalAlpha=.68;const I=n.createRadialGradient(E,M-p*.68,p*.1,E,M,p*1.12);I.addColorStop(0,"rgba(255, 255, 255, 0.85)"),I.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=I,n.fillRect(E-p,M-p,p*2,p*2),n.restore();const k=performance.now()-b.lastHitAt,A=120;if(k<A){const D=1-k/A;t3(n,{centerX:E,centerY:M,radius:p,progress:D})}n.restore(),n3(n,{centerX:E,centerY:M-m*.18,radius:m*.94,intensity:b.steam});const Y=m*.42,B=M+m*.34;e3(n,{centerX:E,centerY:B,hp:b.hp,maxHp:b.maxHp,radius:Y})}}const SA=["Resolute Sauna Guardian","Steam Scholar","Frost-Hardened","Loyal Watchbearer","Aura Whisperer","Shield Brother","Stonefooted Scout","Sisu-Forged Veteran","Brewmaster Quartermaster","Icebreaker Herald","Runic Tactician","Torchbearer"],EA=["Heat Fickle","Soot Allergic","Slow to Spark","Overconfident","Distracted Dreamer","Stubborn Stoker","Thirsty Between Battles","Clumsy Footwork","Rust-Prone Gear","Echo-Lost Listener"];function f2(n,a,s){const r=[...n],o=[],u=Math.max(0,Math.min(a,r.length));for(let f=0;f<u;f++){const h=Math.floor(s()*r.length),[m]=r.splice(h,1);m&&o.push(m)}return o}function MA(n,a){for(let s=n.length-1;s>0;s--){const r=Math.floor(a()*(s+1));[n[s],n[r]]=[n[r],n[s]]}return n}function xA(n=Math.random){typeof n!="function"&&(n=Math.random);const a=f2(SA,2,n),s=f2(EA,1,n),r=[...a,...s];return MA(r,n).map(o=>o.trim()).filter(o=>o.length>0)}const wA=1;function ul(n,a=0){return Number.isFinite(n)?n:a}function AA(n){const{heat:a,pickSpawnTile:s,spawnUnit:r,maxSpawns:o,tierHelpers:u}=n,f=Math.max(wA,wl),h=Math.max(0,ul(n.minUpkeepReserve??f,f));let m=Math.max(0,ul(n.availableUpkeep,0));const p=Math.max(0,Math.floor(ul(o??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY))),g=ul(n.rosterCap??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),b=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.POSITIVE_INFINITY,v=typeof n.getRosterCount=="function"?n.getRosterCount:()=>0;let E=0,M=0,C=0,R=0,N=0,q=0,j=0;for(;(a.hasTriggerReady()||u?.hasQueuedSpawn())&&E<p;){E+=1;const F=u?.getSnapshot()??null;if(Math.max(0,Math.floor(ul(v()??0,0)))>=b){q+=1;let P=!1;F&&u&&(P=u.queueBlockedSpawn(F,()=>a.consumeTrigger())),P?M+=a.vent(.15):M+=a.vent(.35);break}let se=!1;if(F&&u&&u.hasQueuedSpawn()&&(se=u.takeQueuedSpawn(F)),!se&&!a.hasTriggerReady())break;if(m<h){R+=1,se&&F&&u?.restoreQueuedSpawn(F),M+=a.vent(.5);break}const ee=s();if(!ee){N+=1,se&&F&&u?.restoreQueuedSpawn(F),M+=a.vent(.25);break}if(!r(ee)){j+=1,se&&F&&u?.restoreQueuedSpawn(F),M+=a.vent(.25);break}if(!se&&!a.consumeTrigger()){j+=1;break}C+=1,m=Math.max(0,m-h),F&&u?.onSpawnResolved?.(F,{usedQueue:se})}return{spawned:C,blockedByUpkeep:R,blockedByPosition:N,blockedByRoster:q,failedSpawns:j,ventedHeat:M,remainingUpkeep:m}}function Xf(n,a=0){return Number.isFinite(n)?n:a}function CA(n){const a=Math.max(0,Xf(n.dt,0)),{addedHeat:s,cooledHeat:r}=n.heat.advance(a);let o=0;for(const E of n.units){if(E.isDead()||E.faction!=="player")continue;const M=Math.max(0,Xf(n.getUnitUpkeep(E),0));M>0&&(o+=M)}const u=5;let h=Math.max(0,Xf(n.sauna.beerUpkeepAccumulator,0)),m=0;if(o>0){if(h+=a,h>=u){const E=Math.floor(h/u);m=o*E,h-=E*u}}else h=0;n.sauna.beerUpkeepAccumulator=h,m>0&&n.state.addResource(ie.SAUNA_BEER,-m);const p=n.state.getResource(ie.SAUNA_BEER),g=AA({heat:n.heat,availableUpkeep:p,pickSpawnTile:n.pickSpawnTile,spawnUnit:n.spawnBaseUnit,minUpkeepReserve:n.minUpkeepReserve,maxSpawns:n.maxSpawns,rosterCap:n.rosterCap,getRosterCount:n.getRosterCount,tierHelpers:n.tierHelpers}),b=n.heat.getCooldownSeconds(),v=n.heat.timeUntilNextTrigger();return n.sauna.heat=n.heat.getHeat(),n.sauna.playerSpawnThreshold=n.heat.getThreshold(),n.sauna.playerSpawnCooldown=Number.isFinite(b)?b:0,n.sauna.playerSpawnTimer=Number.isFinite(v)?v:0,n.sauna.heatPerTick=n.heat.getBuildRate(),{addedHeat:s,cooledHeat:r,upkeepDrain:m,spawn:g,beerRemaining:n.state.getResource(ie.SAUNA_BEER),availableUpkeep:g.remainingUpkeep}}function TA(){try{return globalThis.localStorage??null}catch(n){return console.warn("Unable to access localStorage for inventory persistence",n),null}}function _A(n,a){const s=n.getItem(a);if(s)try{return JSON.parse(s)}catch(r){console.warn(`Failed to parse persisted inventory for "${a}", clearing.`,r),n.removeItem(a);return}}function Ec(n,a,s){const r=Number.isFinite(n.quantity)?n.quantity:1,o=Math.max(1,Math.round(r)),u=typeof n.rarity=="string"?n.rarity.trim():void 0,f=typeof n.icon=="string"?n.icon:void 0,h=typeof n.description=="string"?n.description:void 0;return{id:n.id,name:n.name,description:h,icon:f,rarity:u,quantity:o,acquiredAt:a,sourceTableId:s?.tableId,sourceEntryId:s?.entryId}}class RA{listeners=new Set;storageKey;now;maxStashSize;storage;autoEquip;stash=[];inventory=[];constructor(a={}){this.storageKey=a.storageKey??"autobattles:inventory",this.now=typeof a.now=="function"?a.now:()=>Date.now(),this.maxStashSize=Math.max(1,Math.floor(a.maxStashSize??24)),this.storage=TA(),this.autoEquip=a.autoEquip??!0,this.load()}load(){if(!this.storage)return;const a=_A(this.storage,this.storageKey);if(a){if(typeof a.autoEquip=="boolean"&&(this.autoEquip=a.autoEquip),Array.isArray(a.stash)){const s=[];for(const r of a.stash){if(!r||typeof r!="object")continue;const{id:o,name:u,quantity:f}=r;if(typeof o!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(Ec({id:o,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.stash=s.slice(0,this.maxStashSize)}if(Array.isArray(a.inventory)){const s=[];for(const r of a.inventory){if(!r||typeof r!="object")continue;const{id:o,name:u,quantity:f}=r;if(typeof o!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(Ec({id:o,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.inventory=s}}}persist(){if(!this.storage)return;const a={autoEquip:this.autoEquip,stash:this.stash.map(s=>({...s})),inventory:this.inventory.map(s=>({...s}))};try{this.storage.setItem(this.storageKey,JSON.stringify(a))}catch(s){console.warn("Failed to persist inventory state",s)}}emit(a){for(const s of this.listeners)s(a)}normalizeEquipResult(a){return typeof a=="boolean"?{success:a}:!a||typeof a!="object"?{success:!1}:{success:!!a.success,comparison:a.comparison,reason:a.reason}}on(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}isAutoEquipEnabled(){return this.autoEquip}setAutoEquip(a){this.autoEquip!==a&&(this.autoEquip=a,this.persist(),this.emit({type:"settings-updated",autoEquip:this.autoEquip}))}getStash(){return this.stash.map(a=>({...a}))}getStashSize(){return this.stash.length}getInventory(){return this.inventory.map(a=>({...a}))}getInventorySize(){return this.inventory.length}addLoot(a,s={}){return this.addItem({...a.item},{...s,sourceTableId:s.sourceTableId,sourceEntryId:s.sourceEntryId??a.entryId})}addItem(a,s={}){const r=Math.max(0,Math.round(this.now())),o=Ec(a,r,{tableId:s.sourceTableId,entryId:s.sourceEntryId}),u=s.autoEquip??this.autoEquip;let f={success:!1};if(u&&s.unitId&&typeof s.equip=="function"){try{f=this.normalizeEquipResult(s.equip(s.unitId,o))}catch(h){console.warn("Failed to auto-equip inventory item",{item:o,error:h}),f={success:!1}}if(f.success)return this.persist(),this.emit({type:"item-acquired",item:o,equipped:!0,location:"equipped",unitId:s.unitId,stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:o,equipped:!0,location:"equipped"}}if(this.stash.push(o),this.stash.length>this.maxStashSize){const h=this.stash.splice(0,this.stash.length-this.maxStashSize);h.length>0&&console.warn("Inventory stash full, trimming oldest items",h)}return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-acquired",item:o,equipped:!1,unitId:s.unitId,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:o,equipped:!1,location:"stash",stashIndex:this.stash.length-1}}equipFromStash(a,s,r){if(a<0||a>=this.stash.length)return!1;const o=this.stash[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,o))}catch(h){console.warn("Failed to equip stash item",{item:o,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}equipFromInventory(a,s,r){if(a<0||a>=this.inventory.length)return!1;const o=this.inventory[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,o))}catch(h){console.warn("Failed to equip inventory item",{item:o,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}moveToInventory(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.inventory.push(s),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-moved",item:s,from:"stash",to:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}moveToStash(a){if(this.stash.length>=this.maxStashSize||a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.stash.push(s),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-moved",item:s,from:"inventory",to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}discardFromInventory(a){if(a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-discarded",item:s,location:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}unequipToStash(a,s,r){if(this.stash.length>=this.maxStashSize)return!1;let o=null;try{o=r(a,s)??null}catch(h){console.warn("Failed to unequip item",{unitId:a,slot:s,error:h}),o=null}if(!o)return!1;const u=Math.max(0,Math.round(this.now())),f=Ec(o,u);return this.stash.push(f),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-unequipped",item:f,unitId:a,slot:s,to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),!0}discardFromStash(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-discarded",item:s,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}}const h2={toast:990},NA={stash:"Quartermaster Stash",inventory:"Ready Inventory"},kA={stash:"Your stash is empty. Conquer enemy elites to gather new equipment.",inventory:"No gear staged. Move items into the ready inventory for quick equipping."},DA={mythic:6,legendary:5,epic:4,rare:3,uncommon:2,common:1},LA=["health","attackDamage","attackRange","movementRange","defense","shield"],UA={"birch-sap-satchel":["healing","support"],"steamed-bandages":["restoration","shielding"],"aurora-distillate":["damage","defense"],"stolen-sauna-tokens":["mobility"],"midnight-bloodwine":["healing","damage"],"sauna-incense":["range","focus"],"glacier-brand":["damage"],"emberglass-arrow":["damage","range"],"aurora-lattice":["damage","range"],"emberglass-shard":["damage","mobility"],"windstep-totem":["mobility","defense"],"searing-chant-censer":["damage","shielding"],"cracked-ice-amulet":["defense"],"myrsky-charm":["range","defense"],"frostwyrm-signet":["shielding"],"spirit-oak-charm":["healing","defense"]};function _a(n){return(n??"").trim().toLowerCase()}function Kf(n){const a=new Set;for(const s of n){const r=_a(s);r&&a.add(r)}return a}function Qf(n,a){return{id:n.id,name:n.name,quantity:typeof a=="number"?a:n.quantity,rarity:n.rarity}}function Mc(n){return n?{id:n.id,name:n.name,quantity:n.quantity,rarity:n.rarity}:null}function m2(n){return UA[n]??[]}function p2(n){const a=_a(n)||"common",s=a.charAt(0).toUpperCase()+a.slice(1);return{key:a,label:s,rank:DA[a]??0}}function OA(n){const a=Ll(n.id);if(!a){const o=p2(n.rarity);return{slot:null,slotLabel:"Unassigned",rarity:o.key,rarityRank:o.rank,tags:m2(n.id),acquiredAt:n.acquiredAt}}const s=Dl(a.slot),r=p2(n.rarity);return{slot:a.slot,slotLabel:s.label,rarity:r.key,rarityRank:r.rank,tags:m2(n.id),acquiredAt:n.acquiredAt}}function qA(n,a,s,r,o){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:o,slot:a,maxStacks:s,modifiers:r??{}}}function g2(n,a){const s=n[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function zA(n,a){const s=Ll(n.item.id);if(!s)return{slot:null,canEquip:!1,reason:"unknown-item",equipped:null,projected:Qf(n.item),stats:[]};const r=s.slot,o=Dl(r),u=a.loadout.find(R=>R.slot===r)??null,f=Math.max(1,Math.round(n.item.quantity)),h=Math.max(1,Math.floor(s.maxStacks??o.maxStacks)),m=(u?.quantity??0)+f,p=m>h;if(u&&u.id!==n.item.id)return{slot:r,canEquip:!1,reason:"slot-occupied",equipped:Mc(u),projected:Qf(n.item),stats:[]};if(p&&(!u||u.id!==n.item.id))return{slot:r,canEquip:!1,reason:"stack-limit",equipped:Mc(u),projected:Qf(n.item,Math.min(h,m)),stats:[]};const g=Math.min(h,m),b=[];for(const R of a.loadout)R.slot!==r&&b.push({...R});const v=u&&u.id===n.item.id?{...u,quantity:g}:qA(n.item,r,h,s.modifiers,g);b.push(v);const E=a.currentStats??zc(a.baseStats,a.loadout),M=zc(a.baseStats,b),C=LA.map(R=>{const N=g2(E,R),q=g2(M,R);return{stat:R,current:N,projected:q,delta:q-N}});return{slot:r,canEquip:!0,equipped:Mc(u),projected:Mc(v),stats:C}}function y2(n,a){return n.map((s,r)=>({item:s,index:r,location:a,metadata:OA(s)}))}function BA(n,a){const s=new Map,r=new Map,o=new Map;for(const m of n){const{metadata:p}=m;if(p.slot){const E=p.slot,M=s.get(E);M?M.count+=1:s.set(E,{label:p.slotLabel,count:1})}const g=p.rarity,b=g.charAt(0).toUpperCase()+g.slice(1),v=r.get(g);v?v.count+=1:r.set(g,{label:b,count:1,rank:p.rarityRank});for(const E of p.tags){const M=_a(E);if(!M)continue;const C=E.split(/[-_]/g).map(N=>N.charAt(0).toUpperCase()+N.slice(1)).join(" "),R=o.get(M);R?R.count+=1:o.set(M,{label:C,count:1})}}const u=Array.from(s.entries()).sort((m,p)=>{const g=Ws.indexOf(m[0]),b=Ws.indexOf(p[0]);return g-b}).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.slots.has(_a(m))})),f=Array.from(r.entries()).sort((m,p)=>(p[1].rank??0)-(m[1].rank??0)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.rarities.has(_a(m))})),h=Array.from(o.entries()).sort((m,p)=>m[1].label.localeCompare(p[1].label)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.tags.has(_a(m))}));return{slots:u,rarities:f,tags:h}}function HA(n,a){if(a.slots.size>0){const s=n.metadata.slot?_a(n.metadata.slot):"";if(!s||!a.slots.has(s))return!1}return!(a.rarities.size>0&&!a.rarities.has(n.metadata.rarity)||a.tags.size>0&&!n.metadata.tags.map(o=>_a(o)).some(o=>a.tags.has(o)))}function jA(n,a){return a?[n.item.name,n.item.description??"",n.metadata.tags.join(" ")].join(" ").toLowerCase().includes(a):!0}function GA(n,a){switch(a){case"oldest":n.sort((s,r)=>s.metadata.acquiredAt-r.metadata.acquiredAt);break;case"rarity":n.sort((s,r)=>r.metadata.rarityRank!==s.metadata.rarityRank?r.metadata.rarityRank-s.metadata.rarityRank:r.metadata.acquiredAt-s.metadata.acquiredAt);break;case"name":n.sort((s,r)=>s.item.name.localeCompare(r.item.name));break;case"newest":default:n.sort((s,r)=>r.metadata.acquiredAt-s.metadata.acquiredAt);break}}function b2(n){const a={slots:Kf(n.filters.slots??new Set),rarities:Kf(n.filters.rarities??new Set),tags:Kf(n.filters.tags??new Set)},s=_a(n.search),r=Math.max(1,Math.floor(n.page||1)),o=Math.max(1,Math.floor(n.pageSize||24)),u=n.collection??"stash",f=y2(n.stash,"stash"),h=y2(n.inventory,"inventory"),m=[...f,...h],p=BA(m,a),g=u==="stash"?f:h,v=[...g.filter(j=>HA(j,a)&&jA(j,s))];GA(v,n.sort??"newest");const E=Math.min(v.length,r*o),M=v.slice(0,E),C=v.length>E,R=n.comparisonContext??null,N=M.map(j=>({item:j.item,index:j.index,location:j.location,metadata:j.metadata,comparison:R?zA(j,R):null})),q=["stash","inventory"].map(j=>({id:j,label:NA[j],count:j==="stash"?n.stash.length:n.inventory.length,active:j===u}));return{collection:u,collections:q,filters:p,items:N,total:g.length,filteredTotal:v.length,search:n.search,sort:n.sort??"newest",hasMore:C,emptyMessage:kA[u]}}function IA(){return{slots:new Set,rarities:new Set,tags:new Set}}const YA="_panel_7op0d_1",FA="_header_7op0d_32",$A="_title_7op0d_42",VA="_meta_7op0d_49",XA="_close_7op0d_54",KA="_controls_7op0d_74",QA="_settings_7op0d_82",PA="_settingRow_7op0d_93",ZA="_settingCopy_7op0d_107",JA="_settingLabel_7op0d_114",WA="_settingHint_7op0d_120",e5="_settingControl_7op0d_127",t5="_settingState_7op0d_133",n5="_settingInput_7op0d_143",a5="_settingSwitch_7op0d_149",i5="_settingTrack_7op0d_169",s5="_settingThumb_7op0d_181",r5="_collections_7op0d_197",l5="_collectionButton_7op0d_205",o5="_searchRow_7op0d_234",c5="_search_7op0d_234",u5="_searchIcon_7op0d_266",d5="_sortSelect_7op0d_276",f5="_body_7op0d_286",h5="_grid_7op0d_292",m5="_empty_7op0d_301",p5="_footer_7op0d_312",g5="_loadMore_7op0d_317",Oe={panel:YA,header:FA,title:$A,meta:VA,close:XA,controls:KA,settings:QA,settingRow:PA,settingCopy:ZA,settingLabel:JA,settingHint:WA,settingControl:e5,settingState:t5,settingInput:n5,settingSwitch:a5,settingTrack:i5,settingThumb:s5,collections:r5,collectionButton:l5,searchRow:o5,search:c5,searchIcon:u5,sortSelect:d5,body:f5,grid:h5,empty:m5,footer:p5,loadMore:g5},y5="_group_18afl_1",b5="_label_18afl_11",v5="_row_18afl_19",S5="_chip_18afl_25",E5="_count_18afl_55",El={group:y5,label:b5,row:v5,chip:S5,count:E5},M5="_card_1o0cv_1",x5="_header_1o0cv_26",w5="_icon_1o0cv_32",A5="_details_1o0cv_44",C5="_titleRow_1o0cv_51",T5="_title_1o0cv_51",_5="_rarity_1o0cv_63",R5="_slot_1o0cv_70",N5="_tags_1o0cv_75",k5="_tag_1o0cv_75",D5="_compare_1o0cv_91",L5="_tooltip_1o0cv_113",U5="_statList_1o0cv_144",O5="_stat_1o0cv_144",q5="_actions_1o0cv_169",z5="_action_1o0cv_169",B5="_primary_1o0cv_198",H5="_danger_1o0cv_209",j5="_badge_1o0cv_224",lt={card:M5,header:x5,icon:w5,details:A5,titleRow:C5,title:T5,rarity:_5,slot:R5,tags:N5,tag:k5,compare:D5,tooltip:L5,statList:U5,stat:O5,actions:q5,action:z5,primary:B5,danger:H5,badge:j5},G5={health:"HP",attackDamage:"ATK",attackRange:"Range",movementRange:"Move",defense:"Defense",shield:"Shield"},v2={"slot-occupied":"Slot occupied. Unequip the current item first.","stack-limit":"Stack limit reached for this item.","unknown-item":"This item cannot be equipped yet."},Rc=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function I5(n,a){if(a.item.icon){const r=document.createElement("img");r.src=a.item.icon,r.alt="",r.loading="lazy",r.decoding="async",r.width=48,r.height=48,n.appendChild(r);return}const s=document.createElement("span");s.textContent=a.item.name.trim()[0]?.toUpperCase()??"?",n.appendChild(s)}function Jb(n){if(!(!n||n.canEquip))return n.reason&&v2[n.reason]?v2[n.reason]:"Unable to equip this item right now."}function Y5(n,a){const s=document.createElement("div");s.className=lt.tooltip;const r=document.createElement("h4");if(a.projected?r.textContent=a.canEquip?"Projected stats":"Current loadout":r.textContent="Stats",s.appendChild(r),!a.canEquip){const u=Jb(a);if(u){const f=document.createElement("p");f.textContent=u,f.style.margin="0 0 0.5rem",f.style.fontSize="0.78rem",s.appendChild(f)}}const o=document.createElement("ul");o.className=lt.statList;for(const u of n){const f=document.createElement("li");f.className=lt.stat,u.delta>0?f.dataset.delta="positive":u.delta<0&&(f.dataset.delta="negative");const h=document.createElement("span");h.textContent=G5[u.stat]??u.stat;const m=document.createElement("span"),p=Rc.format(u.current),g=Rc.format(u.projected),b=u.delta,v=b===0?"±0":`${b>0?"+":"−"}${Rc.format(Math.abs(b))}`;m.textContent=`${p} → ${g} (${v})`,f.append(h,m),o.appendChild(f)}return s.appendChild(o),s}function F5(n){const a=n.comparison;if(!a)return null;const s=document.createElement("div"),r=document.createElement("button");r.type="button",r.className=lt.compare,r.textContent=a.canEquip?"Compare stats":"View details";const o=`${n.item.id}-compare-${n.location}-${n.index}`;r.setAttribute("aria-controls",o),r.setAttribute("aria-expanded","false"),r.setAttribute("aria-describedby",o),r.addEventListener("focus",()=>{r.setAttribute("aria-expanded","true")}),r.addEventListener("blur",()=>{r.setAttribute("aria-expanded","false")}),s.appendChild(r);const u=Y5(a.stats,a);return u.id=o,s.appendChild(u),s}function $5(n,a){if(a&&!a.canEquip){n.disabled=!0;const s=Jb(a);s&&(n.title=s)}}function V5(n){return n.map(a=>{const s=a.trim();return s&&s.split(/[-_\s]/g).map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")})}function X5(n,a,s){const r=document.createElement("div");r.className=lt.actions;const o=document.createElement("button");o.type="button",o.className=`${lt.action} ${lt.primary}`,o.textContent="Equip",$5(o,a.comparison),o.addEventListener("click",()=>{s.onEquip?.()}),r.appendChild(o);const u=document.createElement("button");u.type="button",u.className=lt.action,u.textContent=a.location==="stash"?"Send to inventory":"Return to stash",u.addEventListener("click",()=>{s.onTransfer?.()}),r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=`${lt.action} ${lt.danger}`,f.textContent="Trash";let h=null;const m=()=>{h!==null&&(window.clearTimeout(h),h=null),f.dataset.confirm="false",f.textContent="Trash"};f.addEventListener("click",()=>{if(h!==null){m(),s.onTrash?.();return}f.dataset.confirm="true",f.textContent="Confirm trash",h=window.setTimeout(()=>{m()},2600)}),r.appendChild(f),n.appendChild(r)}function K5(n,a){const s=document.createElement("li");s.className=lt.card,s.dataset.location=n.location,s.setAttribute("role","listitem");const r=document.createElement("div");r.className=lt.header;const o=document.createElement("div");o.className=lt.icon,I5(o,n),r.appendChild(o);const u=document.createElement("div");u.className=lt.details;const f=document.createElement("div");f.className=lt.titleRow;const h=document.createElement("h4");h.className=lt.title,h.textContent=n.item.name,f.appendChild(h);const m=document.createElement("span");m.className=lt.rarity,m.textContent=n.metadata.rarity.toUpperCase(),f.appendChild(m),u.appendChild(f);const p=document.createElement("span");if(p.className=lt.slot,p.textContent=n.metadata.slot?n.metadata.slotLabel:"No slot",u.appendChild(p),n.metadata.tags.length>0){const b=document.createElement("div");b.className=lt.tags;for(const v of V5(n.metadata.tags)){const E=document.createElement("span");E.className=lt.tag,E.textContent=v,b.appendChild(E)}u.appendChild(b)}const g=F5(n);if(g&&u.appendChild(g),r.appendChild(u),s.appendChild(r),n.item.quantity>1){const b=document.createElement("span");b.className=lt.badge,b.textContent=`×${Rc.format(n.item.quantity)}`,s.appendChild(b)}return X5(s,n,a),s}const Q5={newest:"Newest",oldest:"Oldest",rarity:"Rarity",name:"Name A-Z"};function Pf(n){const a=document.createElement("div");a.className=El.row;const s=document.createElement("div");s.className=El.label,s.textContent=n;const r=document.createElement("div");return r.className=El.group,a.append(s,r),{row:a,group:r}}function P5(n){const a=document.createElement("section");a.className=Oe.panel,a.tabIndex=-1,a.dataset.open="false",a.setAttribute("aria-label","Quartermaster stash");const s=document.createElement("header");s.className=Oe.header;const r=document.createElement("div"),o=document.createElement("h2");o.className=Oe.title,o.textContent="Quartermaster Stash",r.appendChild(o);const u=document.createElement("div");u.className=Oe.meta,u.textContent="Loading…",r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=Oe.close,f.textContent="Close",f.addEventListener("click",()=>n.onClose?.()),s.append(r,f),a.appendChild(s);const h=document.createElement("div");h.className=Oe.controls;const m=document.createElement("div");m.className=Oe.collections;const p={stash:document.createElement("button"),inventory:document.createElement("button")};p.stash.type="button",p.stash.className=Oe.collectionButton,p.stash.textContent="Stash",p.stash.addEventListener("click",()=>n.onCollectionChange?.("stash")),p.inventory.type="button",p.inventory.className=Oe.collectionButton,p.inventory.textContent="Ready",p.inventory.addEventListener("click",()=>n.onCollectionChange?.("inventory")),m.append(p.stash,p.inventory),h.appendChild(m);const g=document.createElement("div");g.className=Oe.searchRow;const b=document.createElement("div");b.className=Oe.search;const v=document.createElement("input");v.type="search",v.placeholder="Search stash…",v.addEventListener("input",()=>n.onSearchChange?.(v.value));const E=document.createElement("span");E.className=Oe.searchIcon,E.textContent="🔍",b.append(E,v),g.appendChild(b);const M=document.createElement("select");M.className=Oe.sortSelect,["newest","oldest","rarity","name"].forEach(A=>{const Y=document.createElement("option");Y.value=A,Y.textContent=Q5[A],M.appendChild(Y)}),M.addEventListener("change",()=>n.onSortChange?.(M.value)),g.appendChild(M),h.appendChild(g);const C=document.createElement("div");C.className=Oe.settings;const R=(A,Y,B,D)=>{const V=document.createElement("div");V.className=Oe.settingRow;const te=document.createElement("div");te.className=Oe.settingCopy;const he=document.createElement("span");he.className=Oe.settingLabel,he.textContent=Y,te.appendChild(he);const w=document.createElement("p");w.className=Oe.settingHint,w.textContent=B,te.appendChild(w);const $=document.createElement("div");$.className=Oe.settingControl;const W=document.createElement("span");W.className=Oe.settingState,W.textContent="Off";const ae=document.createElement("input");ae.type="checkbox",ae.id=A,ae.className=Oe.settingInput;const oe=document.createElement("label");oe.className=Oe.settingSwitch,oe.htmlFor=A,oe.dataset.state="off";const ge=document.createElement("span");ge.className=Oe.settingTrack;const de=document.createElement("span");de.className=Oe.settingThumb,oe.append(ge,de);const Te=xe=>{ae.checked=xe,oe.dataset.state=xe?"on":"off",W.textContent=xe?"On":"Off"};return ae.addEventListener("change",()=>{Te(ae.checked),D?.(ae.checked)}),$.append(W,ae,oe),V.append(te,$),{root:V,setChecked:Te}},N=R("inventory-autoequip-toggle","Auto-equip loot","Try outfitting the selected attendant as soon as new gear arrives.",A=>n.onAutoEquipChange?.(A)),q=R("inventory-ui-variant-toggle","Experimental HUD","Swap to the React/Tailwind HUD. You can revert at any time.",A=>n.onUiV2Change?.(A));N.setChecked(n.getAutoEquipState?.()??!1),q.setChecked(n.getUiV2State?.()??!1),C.append(N.root,q.root),h.appendChild(C);const j=document.createElement("div"),F={slots:Pf("Slots"),rarities:Pf("Rarity"),tags:Pf("Tags")};j.append(F.slots.row,F.rarities.row,F.tags.row),h.appendChild(j),a.appendChild(h);const Q=document.createElement("div");Q.className=Oe.body;const se=document.createElement("ul");se.className=Oe.grid;const ee=document.createElement("div");ee.className=Oe.empty,ee.textContent="No items match the current filters.",ee.hidden=!0,Q.append(se,ee),a.appendChild(Q);const le=document.createElement("div");le.className=Oe.footer;const P=document.createElement("button");P.type="button",P.className=Oe.loadMore,P.textContent="Show more",P.addEventListener("click",()=>n.onLoadMore?.()),le.appendChild(P),a.appendChild(le);function I(A,Y,B){A.group.innerHTML="",A.row.hidden=B.length===0;for(const D of B){const V=document.createElement("button");if(V.type="button",V.className=El.chip,V.dataset.active=D.active?"true":"false",V.textContent=D.label,D.count>0){const te=document.createElement("span");te.className=El.count,te.textContent=String(D.count),V.appendChild(te)}V.addEventListener("click",()=>n.onFilterToggle?.(Y,D.id)),A.group.appendChild(V)}}function T(A){se.replaceChildren();const Y=document.createDocumentFragment();for(const B of A.items){const D={onEquip:()=>n.onItemEquip?.(B),onTransfer:()=>n.onItemTransfer?.(B),onTrash:()=>n.onItemTrash?.(B)};Y.appendChild(K5(B,D))}se.appendChild(Y),ee.hidden=A.filteredTotal!==0,ee.hidden||(ee.textContent=A.emptyMessage)}return{element:a,render(A){u.textContent=A.total===0?"No items yet":`${A.filteredTotal} of ${A.total} item${A.total===1?"":"s"}`;for(const[Y,B]of Object.entries(p))B.dataset.active=Y===A.collection?"true":"false";v.value!==A.search&&(v.value=A.search),M.value!==A.sort&&(M.value=A.sort),I(F.slots,"slots",A.filters.slots),I(F.rarities,"rarities",A.filters.rarities),I(F.tags,"tags",A.filters.tags),T(A),P.hidden=!A.hasMore},setOpen(A){a.dataset.open=A?"true":"false"},focus(){const A=a.focus.bind(a);try{A({preventScroll:!0})}catch(Y){console.warn("Stash panel focus without scroll prevention fallback",Y);try{A()}catch(B){console.warn("Unable to focus stash panel element",B)}}},destroy(){a.remove()},setAutoEquip(A){N.setChecked(A)},setUiV2(A){q.setChecked(A)}}}const Zf=24,Z5=4500,J5=400,W5={health:"HP",attackDamage:"ATK",attackRange:"RNG",movementRange:"MOV",defense:"DEF",shield:"Shield"},S2="pointer-events-none ml-auto flex w-full max-w-[min(22rem,90vw)] flex-col gap-[clamp(6px,1vw,12px)]",eC="pointer-events-auto flex w-full items-center gap-[clamp(4px,0.8vw,12px)] rounded-hud-md border border-white/15 px-4 py-3 text-[0.9rem] font-semibold leading-[1.35] shadow-[0_18px_32px_rgba(15,23,42,0.22)] backdrop-blur-[14px] backdrop-saturate-[135%] transition-all duration-300 ease-out",tC={loot:"bg-[linear-gradient(135deg,rgba(255,255,255,0.95),rgba(215,229,255,0.95))] text-slate-900",info:"bg-[linear-gradient(135deg,rgba(219,245,255,0.95),rgba(197,228,255,0.95))] text-slate-900",warn:"bg-[linear-gradient(135deg,rgba(255,231,217,0.95),rgba(255,214,196,0.95))] text-amber-900"},nC=["-translate-y-2","opacity-0"];function Kc(n){n.hidden=n.childElementCount===0}function aC(n,a){const s=n.querySelector('[data-ui="loot-toast-stack"]');if(s)return s.parentElement!==a&&a.appendChild(s),s.className=S2,s.style.zIndex=String(h2.toast),Kc(s),s;const o=(n.ownerDocument??document).createElement("div");return o.dataset.ui="loot-toast-stack",o.className=S2,o.setAttribute("aria-live","polite"),o.setAttribute("role","status"),o.style.zIndex=String(h2.toast),Kc(o),a.appendChild(o),o}function Vt(n,a,s){const r=(n.ownerDocument??document).createElement("div");r.dataset.variant=s,r.className=`${eC} ${tC[s]}`,r.textContent=a,n.appendChild(r),Kc(n);const o=()=>{r.remove(),Kc(n)},u=window.setTimeout(()=>{r.classList.add(...nC),window.setTimeout(o,J5)},Z5);r.addEventListener("click",()=>{window.clearTimeout(u),o()})}function iC(n,a){n.has(a)?n.delete(a):n.add(a)}function sC(n){const a=n.comparison?.deltas??[];return a.length===0?null:a.map(r=>{const o=W5[r.stat]??r.stat;return`${r.delta>0?"+":""}${r.delta} ${o}`}).join(", ")}function Jf(n){switch(n){case"inventory":return"ready inventory";case"stash":return"stash";case"equipped":default:return"loadout"}}function rC(){const n=document.createElement("button");n.type="button",n.dataset.testid="inventory-badge",n.dataset.ui="inventory-badge",n.className="group inline-flex items-center gap-2 rounded-hud-pill border border-white/15 bg-[linear-gradient(135deg,rgba(27,36,56,0.9),rgba(39,74,110,0.9))] px-3.5 py-2 font-semibold text-sky-50 shadow-hud-sm transition-all duration-150 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent hover:-translate-y-0.5 hover:shadow-hud-md data-[autoequip=off]:bg-[linear-gradient(135deg,rgba(56,44,25,0.9),rgba(92,72,40,0.9))]",n.setAttribute("aria-expanded","false"),n.setAttribute("aria-controls","inventory-stash-panel"),n.setAttribute("aria-label","Open quartermaster stash");const a=document.createElement("span");a.className="relative flex h-[1.65rem] w-[1.65rem] flex-shrink-0 items-center justify-center rounded-full bg-[radial-gradient(circle_at_30%_30%,rgba(255,255,255,0.9),rgba(225,235,255,0.2))] text-slate-900 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.35)]",a.setAttribute("aria-hidden","true");const s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg");r.setAttribute("viewBox","0 0 24 24"),r.setAttribute("aria-hidden","true"),r.setAttribute("focusable","false"),r.setAttribute("class","h-[76%] w-[76%]");const o=document.createElementNS(s,"path");o.setAttribute("d","M8.25 7V6a3.75 3.75 0 0 1 7.5 0v1m3 0h-14.25a1.5 1.5 0 0 0-1.485 1.342l-.75 9a3 3 0 0 0 2.985 3.158h9.78a3 3 0 0 0 2.985-3.158l-.75-9A1.5 1.5 0 0 0 18.75 7Z"),o.setAttribute("fill","rgba(194, 216, 255, 0.32)"),o.setAttribute("stroke","rgba(255, 255, 255, 0.92)"),o.setAttribute("stroke-width","1.6"),o.setAttribute("stroke-linecap","round"),o.setAttribute("stroke-linejoin","round");const u=document.createElementNS(s,"path");u.setAttribute("d","M9.75 12.25h4.5"),u.setAttribute("fill","none"),u.setAttribute("stroke","rgba(255, 255, 255, 0.85)"),u.setAttribute("stroke-width","1.4"),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("opacity","0.9"),r.append(o,u),a.appendChild(r),n.appendChild(a);const f=document.createElement("span");f.className="text-[0.75rem] uppercase tracking-[0.08em]",f.textContent="Stash",n.appendChild(f);const h=document.createElement("span");return h.className="min-w-[1.5rem] rounded-full bg-white/15 px-2 py-[0.1rem] text-center text-xs font-semibold text-white/90",h.textContent="0",h.setAttribute("aria-hidden","true"),n.appendChild(h),{button:n,count:h}}function lC(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{destroy:()=>{}};const{regions:r}=ar(s),o=r.top,u=aC(s,o);s.querySelectorAll('[data-testid="inventory-badge"]').forEach(k=>k.remove());const{button:f,count:h}=rC();f.dataset.autoequip=n.isAutoEquipEnabled()?"on":"off",o.appendChild(f),s.querySelector("#inventory-stash-panel")?.remove();const p=P5({onClose:()=>R(!1),onCollectionChange:k=>{b!==k&&(b=k,C=1,q())},onFilterToggle:(k,A)=>{const Y=v[k];iC(Y,A),C=1,q()},onSearchChange:k=>{E=k,C=1,q()},onSortChange:k=>{M=k,C=1,q()},onLoadMore:()=>{C+=1,q()},onItemEquip:k=>{F(k)},onItemTransfer:k=>{Q(k)},onItemTrash:k=>{se(k)},getAutoEquipState:()=>n.isAutoEquipEnabled(),onAutoEquipChange:k=>{n.setAutoEquip(k),f.dataset.autoequip=k?"on":"off",Vt(u,k?"Auto-equip enabled. Newly recovered gear will try to arm your selected attendant.":"Auto-equip disabled. Loot will head to the stash until you equip it manually.","info")},getUiV2State:()=>a.getUseUiV2?.()??!1,onUiV2Change:k=>{a.onUseUiV2Change?.(k),Vt(u,k?"Experimental HUD enabled. Reload to try the React/Tailwind experience.":"Classic HUD restored for your next session.","info")}});p.element.id="inventory-stash-panel",s.appendChild(p.element);let g=!1,b="stash";const v=IA();let E="",M="newest",C=1;function R(k){if(g!==k)if(g=k,p.setOpen(g),f.setAttribute("aria-expanded",g?"true":"false"),f.setAttribute("aria-label",g?"Close quartermaster stash":"Open quartermaster stash"),g){s.classList.add("inventory-panel-open");try{p.focus()}catch(A){console.warn("Unable to focus stash panel",A)}}else s.classList.remove("inventory-panel-open")}function N(){const k=a.getComparisonContext?.()??null;let A=b2({stash:n.getStash(),inventory:n.getInventory(),filters:v,search:E,sort:M,page:C,pageSize:Zf,collection:b,comparisonContext:k});if(A.filteredTotal>0){const Y=Math.max(1,Math.ceil(A.filteredTotal/Zf));C>Y&&(C=Y,A=b2({stash:n.getStash(),inventory:n.getInventory(),filters:v,search:E,sort:M,page:C,pageSize:Zf,collection:b,comparisonContext:k}))}return A}function q(){const k=N(),Y=k.collections.find(B=>B.id==="stash")?.count??0;h.textContent=String(Y),f.dataset.count=String(Y),p.render(k)}function j(){const k=a.getSelectedUnitId?.()??null;return k||(Vt(u,"Select an attendant before equipping an item.","warn"),null)}function F(k){const A=j();if(!A)return;const Y=a.onEquip??(()=>({success:!1}));(k.location==="stash"?n.equipFromStash(k.index,A,(V,te)=>Y(V,te,"stash")):n.equipFromInventory(k.index,A,(V,te)=>Y(V,te,"inventory")))||Vt(u,"Unable to equip that item right now.","warn")}function Q(k){const A=k.location==="stash"?n.moveToInventory(k.index):n.moveToStash(k.index);if(!A){Vt(u,"Unable to move that item right now.","warn");return}const Y=k.location==="stash"?"ready inventory":"stash";Vt(u,`Moved ${A.name} to the ${Y}.`,"info"),C=1,q()}function se(k){const A=k.location==="stash"?n.discardFromStash(k.index):n.discardFromInventory(k.index);if(!A){Vt(u,"That item was already removed.","warn");return}const Y=k.location==="stash"?"stash":"ready inventory";Vt(u,`${A.name} discarded from the ${Y}.`,"warn"),q()}function ee(k){switch(k.type){case"stash-updated":case"inventory-updated":q();break;case"item-acquired":if(k.equipped)Vt(u,`${k.item.name} auto-equipped successfully.`,"info");else{const A=Jf(k.location);Vt(u,`New item secured: ${k.item.name} (${A}).`,"loot")}break;case"item-equipped":{const A=sC(k),Y=A?` (${A})`:"";Vt(u,`Equipped ${k.item.name}${Y}.`,"info");break}case"item-unequipped":Vt(u,`${k.item.name} returned to the stash from slot ${k.slot}.`,"info");break;case"item-moved":{const A=Jf(k.to);Vt(u,`Moved ${k.item.name} to the ${A}.`,"info");break}case"item-discarded":{const A=Jf(k.location);Vt(u,`${k.item.name} discarded from the ${A}.`,"warn");break}case"settings-updated":f.dataset.autoequip=k.autoEquip?"on":"off",p.setAutoEquip(k.autoEquip);break}}const le=n.on(k=>ee(k)),P=()=>{R(!g)};f.addEventListener("click",P);const I=k=>{k.defaultPrevented||k.code==="KeyI"&&!k.metaKey&&!k.ctrlKey&&!k.altKey&&(k.preventDefault(),R(!g))};return window.addEventListener("keydown",I),q(),{destroy:()=>{le(),f.removeEventListener("click",P),window.removeEventListener("keydown",I),f.remove(),p.destroy(),s.classList.remove("inventory-panel-open"),u.hasChildNodes()||u.remove()}}}const oC=Object.freeze({common:1,uncommon:.6,rare:.35,epic:.18,legendary:.08,mythic:.03}),cC=Object.freeze({id:"general-salvage",label:"General Salvage",entries:Object.freeze([{id:"birch-sap-satchel",name:"Birch Sap Satchel",description:"Soothing birch sap that doubles as a brisk field tonic.",rarity:"common",quantity:{min:1,max:3},weight:6},{id:"steamed-bandages",name:"Steamed Linen Bandages",description:"Freshly steamed bandages infused with pine oils.",rarity:"common",quantity:1,weight:5},{id:"emberglass-shard",name:"Emberglass Shard",description:"A radiant shard used to kindle sauna braziers.",rarity:"uncommon",quantity:1,weight:3},{id:"aurora-distillate",name:"Aurora Distillate",description:"Vials of shimmering condensation that empower sauna rituals.",rarity:"rare",quantity:1,weight:1.5},{id:"myrsky-charm",name:"Myrsky Charm",description:"Storm-forged charm rumored to call down aurora flares.",rarity:"epic",quantity:1,weight:.7}])}),uC=Object.freeze({base:Object.freeze({id:"enemy-raiders",label:"Avanto Marauder Spoils",entries:Object.freeze([{id:"cracked-ice-amulet",name:"Cracked Ice Amulet",description:"Necklace of frostbitten charms that hum when danger nears.",rarity:"common",quantity:1,weight:5},{id:"stolen-sauna-tokens",name:"Stolen Sauna Tokens",description:"Pilfered entrance tokens, gladly accepted back at any sauna hall.",rarity:"uncommon",quantity:{min:2,max:5},weight:3},{id:"glacier-brand",name:"Glacier Brand",description:"A cleaver chilled in glacial meltwater that never dulls.",rarity:"rare",quantity:1,weight:1.25}])}),elite:Object.freeze({id:"enemy-champions",label:"Avanto Champion Cache",entries:Object.freeze([{id:"frostwyrm-signet",name:"Frostwyrm Signet",description:"An icy signet ring that wreathes its bearer in frozen vapour.",rarity:"epic",quantity:1,weight:1.1},{id:"aurora-lattice",name:"Aurora Lattice",description:"Filigree latticework that channels auroral light into focused beams.",rarity:"legendary",quantity:1,weight:.4},{id:"midnight-bloodwine",name:"Midnight Bloodwine",description:"A mythical draught said to rekindle a warrior's lost resolve.",rarity:"mythic",quantity:1,weight:.12}])})}),dC=Object.freeze({base:Object.freeze({id:"deepwood-offerings",label:"Deepwood Offerings",entries:Object.freeze([{id:"spirit-oak-charm",name:"Spirit Oak Charm",description:"Carved from living oak, it whispers guidance between sauna rounds.",rarity:"uncommon",quantity:1,weight:4},{id:"sauna-incense",name:"Sauna Incense Pouches",description:"Fragrant blends that steady breathing before the next engagement.",rarity:"common",quantity:{min:1,max:4},weight:5},{id:"emberglass-arrow",name:"Emberglass Arrow Bundle",description:"Arrowheads that glow amber when a perfect shot reveals itself.",rarity:"rare",quantity:{min:1,max:2},weight:1.75}])}),elite:Object.freeze({id:"deepwood-ritual-cache",label:"Deepwood Ritual Cache",entries:Object.freeze([{id:"windstep-totem",name:"Windstep Totem",description:"Totem etched with gale sigils that lighten every cautious stride.",rarity:"epic",quantity:1,weight:.9},{id:"searing-chant-censer",name:"Searing Chant Censer",description:"An ornate censer that empowers allies with smouldering hymns.",rarity:"legendary",quantity:1,weight:.35}])})}),fC=Object.freeze({enemy:uC,deepwood:dC});function hC(n){return fC[n]??{base:cC}}function mC(n,a=!1){const s=hC(n);return a&&s.elite?s.elite:s.base}function pC(n){if(!Number.isFinite(n))return 1;const a=Math.floor(n);return a<=0?0:Math.min(10,a)}function gC(n,a){if(typeof n=="number"&&Number.isFinite(n))return Math.max(1,Math.round(n));if(!n)return 1;const s=n,r=Math.max(1,Math.round(s.min)),u=Math.max(r,Math.round(s.max))-r+1,f=Math.floor(Math.max(0,Math.min(.999999,a()))*u);return r+f}function yC(n){const a=oC[n.rarity]??1,s=typeof n.weight=="number"?n.weight:1;return Math.max(0,s)*Math.max(0,a)}function bC(n,a){const s=n.map(f=>({entry:f,weight:yC(f)})).filter(f=>f.weight>0);if(s.length===0)return null;const r=s.reduce((f,h)=>f+h.weight,0),o=Math.max(0,Math.min(.999999,a()))*r;let u=0;for(const f of s)if(u+=f.weight,o<u)return f.entry;return s[s.length-1]?.entry??null}function vC(n,a){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:a}}function SC(n){const a=typeof n.random=="function"?n.random:Math.random,s=!!n.elite,r=n.table??mC(n.factionId,s),o=pC(n.rolls),u=[];if(o<=0||r.entries.length===0)return{factionId:n.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u};for(let f=0;f<o;f+=1){const h=bC(r.entries,a);if(!h)break;const m=gC(h.quantity,a);u.push({entryId:h.id,rarity:h.rarity,quantity:m,item:vC(h,m)})}return{factionId:n.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u}}const EC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23a4d67a'%20/%3e%3cpolygon%20points='16,48%2032,16%2048,48'%20fill='%23d2691e'%20/%3e%3crect%20x='24'%20y='32'%20width='16'%20height='16'%20fill='%23f4a460'%20/%3e%3c/svg%3e",MC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23c0c0c0'%20/%3e%3crect%20x='8'%20y='24'%20width='48'%20height='24'%20fill='%23808080'%20/%3e%3crect%20x='24'%20y='16'%20width='16'%20height='8'%20fill='%23606060'%20/%3e%3c/svg%3e",xC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23e0e0e0'%20/%3e%3crect%20x='10'%20y='22'%20width='12'%20height='30'%20fill='%23a9a9a9'%20/%3e%3crect%20x='26'%20y='14'%20width='12'%20height='38'%20fill='%23808080'%20/%3e%3crect%20x='42'%20y='26'%20width='12'%20height='26'%20fill='%23a9a9a9'%20/%3e%3c/svg%3e",wC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%238b4513'%20/%3e%3cpolygon%20points='32,10%2042,22%2022,22'%20fill='%23555'%20/%3e%3crect%20x='30'%20y='22'%20width='4'%20height='32'%20fill='%23ccc'%20/%3e%3c/svg%3e",AC="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eAuric%20Warder%3c/title%3e%3cdesc%20id='desc'%3eRunic%20soldier%20with%20aurora-lit%20shield,%20sculpted%20armor,%20and%20crystalline%20broadsword.%3c/desc%3e%3cdefs%3e%3clinearGradient%20id='soldier-panel'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23091522'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23102a46'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-halo'%20cx='52%25'%20cy='18%25'%20r='68%25'%3e%3cstop%20offset='0%25'%20stop-color='rgba(186,%20230,%20253,%200.92)'%20/%3e%3cstop%20offset='45%25'%20stop-color='rgba(59,%20130,%20246,%200.42)'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(15,%2023,%2042,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-armor'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='55%25'%20stop-color='%23cbd5f5'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23475569'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-gold'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20/%3e%3cstop%20offset='45%25'%20stop-color='%23fbbf24'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f97316'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-cloak'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%231d4ed8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-shield'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23bfdbfe'%20/%3e%3cstop%20offset='65%25'%20stop-color='%2360a5fa'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231d4ed8'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-shield-core'%20cx='40%25'%20cy='40%25'%20r='45%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fef3c7'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(248,%20250,%20252,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-sword'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231f2937'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='128'%20height='128'%20rx='18'%20fill='url(%23soldier-panel)'%20/%3e%3ccircle%20cx='64'%20cy='40'%20r='46'%20fill='url(%23soldier-halo)'%20/%3e%3cellipse%20cx='64'%20cy='110'%20rx='34'%20ry='11'%20fill='%230f172a'%20opacity='0.45'%20/%3e%3cpath%20d='M34%2038c-8%2015-11%2034-6%2052l18%2010c-2-22%206-40%2020-50-12-4-22-8-32-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.88'%20/%3e%3cpath%20d='M94%2038c8%2015%2011%2034%206%2052l-18%2010c2-22-6-40-20-50%2012-4%2022-8%2032-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.68'%20/%3e%3cpath%20d='M58%2018l-12%2014c-5%207-8%2017-8%2028v20l14%2042h24l14-42V60c0-11-3-21-8-28L70%2018H58z'%20fill='url(%23soldier-armor)'%20stroke='%231f2937'%20stroke-width='2.4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M46%2060h36l6%2016c-10%2010-20%2016-24%2016s-14-6-24-16l6-16z'%20fill='%23e0f2fe'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2024c-7%200-14%205-20%2012l8%2010c8-6%2024-6%2032%200l8-10c-6-7-13-12-20-12z'%20fill='%23f8fafc'%20stroke='%23cbd5f5'%20stroke-width='2'%20/%3e%3cpath%20d='M56%2016h16l6%208-14%208-14-8%206-8z'%20fill='%23e2e8f0'%20stroke='%2394a3b8'%20stroke-width='1.8'%20/%3e%3cpath%20d='M52%2074h12l2%2020-10%2012-10-12%206-20z'%20fill='url(%23soldier-gold)'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2096l10%2010%2010-12-6-20H66l-2%2022z'%20fill='%23fef3c7'%20opacity='0.72'%20/%3e%3cpath%20d='M32%2068l-12%206%2014%2032%2016-8-18-30z'%20fill='url(%23soldier-shield)'%20stroke='%231e3a8a'%20stroke-width='2.2'%20/%3e%3ccircle%20cx='36'%20cy='82'%20r='8'%20fill='url(%23soldier-shield-core)'%20/%3e%3cpath%20d='M96%2060l-6-6-22%2044%208%2010%2020-48z'%20fill='url(%23soldier-sword)'%20stroke='%230f172a'%20stroke-width='2.2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M86%2050l-18%2040%2012%206%2016-36-10-10z'%20fill='%23f8fafc'%20opacity='0.7'%20/%3e%3cpath%20d='M64%20102c-9%200-18%207-22%2016%208%206%2014%208%2022%208s14-2%2022-8c-4-9-13-16-22-16z'%20fill='%23dbeafe'%20stroke='%2393c5fd'%20stroke-width='1.6'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M58%2056h12l3%2010-9%206-9-6%203-10z'%20fill='%231f2937'%20opacity='0.85'%20/%3e%3ccircle%20cx='64'%20cy='58'%20r='7'%20fill='%23f1f5f9'%20stroke='%23cbd5f5'%20stroke-width='1.4'%20/%3e%3cpath%20d='M54%2044c-5%200-8%205-8%2012%206-3%2012-6%2018-6s12%203%2018%206c0-7-3-12-8-12H54z'%20fill='%230f172a'%20opacity='0.82'%20/%3e%3c/svg%3e",CC="/assets/archer-DIBoEfQj.svg",TC="/assets/avanto-marauder-B6bFdUJV.svg",dl="/",fi={saunaBeer:`${dl}assets/ui/sauna-beer.svg`,saunojaRoster:`${dl}assets/ui/saunoja-roster.svg`,resource:`${dl}assets/ui/resource.svg`,sisu:`${dl}assets/ui/resource.svg`,sound:`${dl}assets/ui/sound.svg`},_C={images:{placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=","building-farm":EC,"building-barracks":MC,"building-city":xC,"building-mine":wC,"unit-soldier":AC,"unit-archer":CC,"unit-avanto-marauder":TC,"icon-sauna-beer":fi.saunaBeer,"icon-saunoja-roster":fi.saunojaRoster,"icon-resource":fi.resource,"icon-sound":fi.sound}};let Wb=null;function RC(n){Wb=n}function ev(){return Wb}const NC=["city"],kC=1e4,DC=12e3;function LC(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function E2(n){return Object.freeze({strongholds:{...n.strongholds},roster:{...n.roster},economy:{...n.economy},sauna:{...n.sauna},startedAt:n.startedAt})}function M2(n){const a={[ie.SAUNA_BEER]:0,[ie.SAUNAKUNNIA]:0,[ie.SISU]:0};return Object.values(ie).forEach(s=>{a[s]=n.getResource(s)}),a}class UC{timeSource;state;map;getRosterCount;sauna;strongholdTypes;rosterGraceMs;bankruptcyGraceMs;progress;startResources;strongholds=new Map;progressListeners=new Set;resolutionListeners=new Set;mapDisposer=null;rosterTimeout=null;bankruptcyTimeout=null;bankruptSince=null;wipeSince=null;saunaDestroyedAt=null;resolution=null;disposed=!1;constructor(a){this.timeSource=typeof a.timeSource=="function"?a.timeSource:LC,this.state=a.state,this.map=a.map,this.getRosterCount=a.getRosterCount,this.sauna=a.sauna??null;const s=a.strongholdTypes?.length?a.strongholdTypes:NC;this.strongholdTypes=new Set(s),this.rosterGraceMs=Math.max(0,a.rosterWipeGraceMs??kC),this.bankruptcyGraceMs=Math.max(0,a.bankruptcyGraceMs??DC),this.startResources=M2(this.state);const r=this.state.getResource(ie.SAUNA_BEER),o=Math.max(0,Math.round(this.getRosterCount()))||0;this.progress={strongholds:{total:0,destroyed:0,remaining:0},roster:{active:o,totalDeaths:0,wipeSince:null,wipeDurationMs:0},economy:{beer:r,worstBeer:r,bankruptSince:null,bankruptDurationMs:0},sauna:this.createSaunaProgress(),startedAt:this.timeSource()},this.bootstrapStrongholds(),this.attachMapListener(),this.attachEventListeners(),this.emitProgress(),this.evaluateResolution()}onProgress(a){this.progressListeners.add(a)}offProgress(a){this.progressListeners.delete(a)}onResolution(a){if(this.resolution){a(this.resolution);return}this.resolutionListeners.add(a)}offResolution(a){this.resolutionListeners.delete(a)}getProgress(){return E2(this.progress)}dispose(){if(!this.disposed){if(this.disposed=!0,this.clearRosterTimer(),this.clearBankruptcyTimer(),this.mapDisposer){try{this.mapDisposer()}catch(a){console.warn("Failed to detach map listener",a)}this.mapDisposer=null}ne.off("unitDied",this.handleUnitDied),ne.off("unitSpawned",this.handleUnitSpawned),ne.off("resourceChanged",this.handleResourceChanged),ne.off("saunaDamaged",this.handleSaunaDamaged),ne.off("saunaDestroyed",this.handleSaunaDestroyed)}}bootstrapStrongholds(){this.map.forEachTile((a,s)=>{if(this.isStronghold(a.building)){const r=this.coordKey(s);this.strongholds.set(r,{alive:!0})}}),this.updateStrongholdTotals()}attachMapListener(){this.mapDisposer=this.map.addTileChangeListener((a,s,r)=>{if(r!=="building"&&r!=="created")return;const o=this.coordKey(a),u=this.strongholds.get(o);this.isStronghold(s.building)?u?u.alive||(u.alive=!0):this.strongholds.set(o,{alive:!0}):u?.alive&&(u.alive=!1),this.updateStrongholdTotals(),this.emitProgress(),this.evaluateResolution()})}attachEventListeners(){ne.on("unitDied",this.handleUnitDied),ne.on("unitSpawned",this.handleUnitSpawned),ne.on("resourceChanged",this.handleResourceChanged),ne.on("saunaDamaged",this.handleSaunaDamaged),ne.on("saunaDestroyed",this.handleSaunaDestroyed)}handleUnitDied=({unitFaction:a})=>{a==="player"&&(this.progress.roster.totalDeaths+=1,this.refreshRosterStatus(),this.emitProgress(),this.evaluateResolution())};handleUnitSpawned=({unit:a})=>{a.faction==="player"&&(this.refreshRosterStatus(),this.emitProgress())};handleResourceChanged=({resource:a,total:s})=>{a===ie.SAUNA_BEER&&(this.progress.economy.beer=s,s<this.progress.economy.worstBeer&&(this.progress.economy.worstBeer=s),s<0?this.bankruptSince===null&&(this.bankruptSince=this.timeSource(),this.progress.economy.bankruptSince=this.bankruptSince,this.startBankruptcyTimer()):(this.updateBankruptcyDuration(),this.bankruptSince=null,this.progress.economy.bankruptSince=null,this.clearBankruptcyTimer()),this.emitProgress())};handleSaunaDamaged=({remainingHealth:a})=>{this.disposed||(this.updateSaunaSnapshot(a),this.emitProgress())};handleSaunaDestroyed=a=>{this.disposed||(this.markSaunaDestroyed(),this.emitProgress(),this.resolve("lose","saunaDestroyed"))};startBankruptcyTimer(){if(this.bankruptcyTimeout===null){if(this.bankruptcyGraceMs<=0){this.resolve("lose","bankruptcy");return}this.bankruptcyTimeout=setTimeout(()=>{this.updateBankruptcyDuration(),this.resolve("lose","bankruptcy")},this.bankruptcyGraceMs)}}clearBankruptcyTimer(){this.bankruptcyTimeout!==null&&(clearTimeout(this.bankruptcyTimeout),this.bankruptcyTimeout=null)}startRosterTimer(){if(this.rosterTimeout===null){if(this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.rosterTimeout=setTimeout(()=>{this.updateRosterDuration(),this.resolve("lose","rosterWipe")},this.rosterGraceMs)}}clearRosterTimer(){this.rosterTimeout!==null&&(clearTimeout(this.rosterTimeout),this.rosterTimeout=null)}updateStrongholdTotals(){const a=this.strongholds.size;let s=0;for(const r of this.strongholds.values())r.alive&&(s+=1);this.progress.strongholds.total=a,this.progress.strongholds.remaining=s,this.progress.strongholds.destroyed=Math.max(0,a-s)}refreshRosterStatus(){const a=Math.max(0,Math.round(this.getRosterCount()));this.progress.roster.active=a,a<=0?(this.wipeSince===null&&(this.wipeSince=this.timeSource(),this.progress.roster.wipeSince=this.wipeSince),this.startRosterTimer()):(this.updateRosterDuration(),this.wipeSince=null,this.progress.roster.wipeSince=null,this.clearRosterTimer())}updateBankruptcyDuration(){if(this.bankruptSince===null)return;const a=this.timeSource()-this.bankruptSince;a>this.progress.economy.bankruptDurationMs&&(this.progress.economy.bankruptDurationMs=a)}updateRosterDuration(){if(this.wipeSince===null)return;const a=this.timeSource()-this.wipeSince;a>this.progress.roster.wipeDurationMs&&(this.progress.roster.wipeDurationMs=a)}evaluateResolution(){if(!this.resolution){if(this.progress.sauna.destroyed){this.resolve("lose","saunaDestroyed");return}if(this.progress.strongholds.total>0&&this.progress.strongholds.remaining===0){this.resolve("win","strongholds");return}if(this.wipeSince!==null&&this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.bankruptSince!==null&&this.bankruptcyGraceMs<=0&&this.resolve("lose","bankruptcy")}}resolve(a,s){if(this.resolution)return;this.updateRosterDuration(),this.updateBankruptcyDuration();const r=this.timeSource(),o=Math.max(0,r-this.progress.startedAt),u=E2({...this.progress,roster:{...this.progress.roster,wipeSince:this.wipeSince},economy:{...this.progress.economy,bankruptSince:this.bankruptSince},sauna:{...this.progress.sauna,destroyedAt:this.saunaDestroyedAt}}),f=this.computeRewards();this.resolution=Object.freeze({outcome:a,cause:s,timestamp:r,durationMs:o,summary:u,rewards:f}),this.emitResolution(),this.dispose()}emitProgress(){const a=this.getProgress();for(const s of this.progressListeners)try{s(a)}catch(r){console.error("Objective progress listener failed",r)}}emitResolution(){if(!this.resolution)return;const a=this.resolution;for(const s of this.resolutionListeners)try{s(a)}catch(r){console.error("Objective resolution listener failed",r)}this.resolutionListeners.clear()}computeRewards(){const a=M2(this.state);return{resources:{[ie.SAUNA_BEER]:{final:a[ie.SAUNA_BEER],delta:a[ie.SAUNA_BEER]-this.startResources[ie.SAUNA_BEER]},[ie.SAUNAKUNNIA]:{final:a[ie.SAUNAKUNNIA],delta:a[ie.SAUNAKUNNIA]-this.startResources[ie.SAUNAKUNNIA]},[ie.SISU]:{final:a[ie.SISU],delta:a[ie.SISU]-this.startResources[ie.SISU]}}}}coordKey(a){return`${a.q},${a.r}`}isStronghold(a){return a?this.strongholdTypes.has(a):!1}createSaunaProgress(){if(!this.sauna)return{maxHealth:0,health:0,destroyed:!1,destroyedAt:null};const a=Math.max(0,Math.round(this.sauna.maxHealth??0)),s=Math.max(0,Math.round(this.sauna.health??0)),r=!!this.sauna.destroyed||s<=0;return r&&this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),{maxHealth:a,health:s,destroyed:r,destroyedAt:r?this.saunaDestroyedAt:null}}updateSaunaSnapshot(a){const s=Number.isFinite(a)?Math.max(0,Math.round(a)):0,r=this.sauna?Math.max(0,Math.round(this.sauna.maxHealth??0)):0,o=this.progress.sauna.maxHealth,u=Math.max(o,r,s);this.progress.sauna.maxHealth=u;const f=Math.max(0,Math.min(u,s));this.progress.sauna.health=f,f>0&&(this.progress.sauna.destroyed=!1,this.progress.sauna.destroyedAt=null,this.saunaDestroyedAt=null)}markSaunaDestroyed(){if(this.sauna){const a=Math.max(0,Math.round(this.sauna.maxHealth??0));a>this.progress.sauna.maxHealth&&(this.progress.sauna.maxHealth=a)}this.progress.sauna.health=0,this.progress.sauna.destroyed=!0,this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),this.progress.sauna.destroyedAt=this.saunaDestroyedAt}}function OC(n){return new UC(n)}const Nn=[{level:1,xpToNext:180,cumulativeXp:0,statAwards:{vigor:0,focus:0,resolve:0}},{level:2,xpToNext:220,cumulativeXp:180,statAwards:{vigor:5,focus:2,resolve:1}},{level:3,xpToNext:260,cumulativeXp:400,statAwards:{vigor:4,focus:3,resolve:1}},{level:4,xpToNext:320,cumulativeXp:660,statAwards:{vigor:4,focus:2,resolve:2}},{level:5,xpToNext:380,cumulativeXp:980,statAwards:{vigor:6,focus:3,resolve:2}},{level:6,xpToNext:460,cumulativeXp:1360,statAwards:{vigor:7,focus:3,resolve:3}},{level:7,xpToNext:540,cumulativeXp:1820,statAwards:{vigor:6,focus:4,resolve:3}},{level:8,xpToNext:640,cumulativeXp:2360,statAwards:{vigor:7,focus:4,resolve:4}},{level:9,xpToNext:760,cumulativeXp:3e3,statAwards:{vigor:8,focus:5,resolve:4}},{level:10,xpToNext:900,cumulativeXp:3760,statAwards:{vigor:9,focus:6,resolve:5}},{level:11,xpToNext:1060,cumulativeXp:4660,statAwards:{vigor:10,focus:6,resolve:6}},{level:12,xpToNext:null,cumulativeXp:5720,statAwards:{vigor:12,focus:7,resolve:6}}];function qC(n){return Number.isNaN(n)||!Number.isFinite(n)?0:Math.max(0,Math.floor(n))}function _h(){return{vigor:0,focus:0,resolve:0}}function zC(n){return{vigor:n.vigor,focus:n.focus,resolve:n.resolve}}function Qc(n){const a=qC(n);let s=Nn[0];for(const f of Nn)if(a>=f.cumulativeXp)s=f;else break;const r=a-s.cumulativeXp,o=s.xpToNext,u=o?Math.min(1,r/o):1;return{level:s.level,xpIntoLevel:r,xpForNext:o,progressToNext:u,statAwards:s.statAwards}}function BC(n){const a=Nn[Nn.length-1].level,s=Math.max(Nn[0].level,Math.min(n,a)),r=Nn.find(o=>o.level===s);return r?zC(r.statAwards):_h()}function HC(n){if(n<=Nn[0].level)return _h();const a=Nn[Nn.length-1].level,s=Math.min(n,a),r=_h();for(const o of Nn){if(o.level>s)break;o.level!==Nn[0].level&&(r.vigor+=o.statAwards.vigor,r.focus+=o.statAwards.focus,r.resolve+=o.statAwards.resolve)}return r}function jC(n){return Qc(n).level}function Wf(n){return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function xc(n,a){return a<=0?"":`${n}/${a}`}function GC(n){let a=0;const s=Math.max(0,Wf(n.queueCapacity??2)),r=(f,h)=>{f&&typeof n.log=="function"&&n.log({type:"system",message:f,metadata:{context:"spawn-queue",...h}})},o=()=>{const f=n.getTier();if(!f)return null;const h=Wf(n.getRosterLimit()),m=Wf(n.getRosterCount());return{tierId:f.id,tierName:f.name,rosterLimit:h,rosterCount:m,queued:a}};return{getSnapshot:()=>o(),hasQueuedSpawn:()=>a>0,takeQueuedSpawn:f=>a<=0?!1:(a-=1,a<=0?r(`The benches of ${f.tierName} exhale — queued attendants take the field.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} deploys a queued attendant. Relief teams remaining: ${xc(a,s)}.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0),restoreQueuedSpawn:f=>{s>0&&a>=s||(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} keeps the relief attendant on standby (${xc(a,s)} ready).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},queueBlockedSpawn:(f,h)=>s>0&&a>=s?(r(`${f.tierName} cannot hold more relief attendants — clear a slot to vent the pressure.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!1):h()?(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} queues a ready attendant in the wings (${xc(a,s)} poised).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0):!1,onSpawnResolved:(f,h)=>{h.usedQueue&&(a>0?r(`${f.tierName} still has relief attendants waiting (${xc(a,s)}).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} has cleared the relief queue.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},clearQueue:f=>{if(!(a<=0)&&(a=0,f==="tier-change")){const h=n.getTier();h&&r(`${h.name} ushers its queued attendants into the new hall.`,{tierId:h.id,tierName:h.name,queue:a,capacity:s})}}}}const tv="autobattles:saunojas";function nv(){try{return globalThis.localStorage??null}catch{return null}}function IC(){const n=nv();if(!n)return[];try{const a=n.getItem(tv);if(!a)return[];const s=JSON.parse(a);if(!Array.isArray(s))return[];const r=[];for(const o of s){if(!o||typeof o!="object")continue;const u=o,f=u.id;if(typeof f!="string"||f.length===0)continue;const h=u.coord,m=h&&typeof h=="object"&&typeof h.q=="number"&&Number.isFinite(h.q)&&typeof h.r=="number"&&Number.isFinite(h.r)?{q:h.q,r:h.r}:void 0,p=u.traits,g=Array.isArray(p)?p.filter(E=>typeof E=="string"):void 0,b=typeof u.upkeep=="number"?u.upkeep:void 0,v=typeof u.xp=="number"?u.xp:void 0;r.push(Jh({id:f,name:typeof u.name=="string"?u.name:void 0,coord:m,maxHp:typeof u.maxHp=="number"?u.maxHp:void 0,hp:typeof u.hp=="number"?u.hp:void 0,steam:typeof u.steam=="number"?u.steam:void 0,traits:g,upkeep:b,xp:v,selected:!!u.selected,items:Array.isArray(u.items)?u.items:void 0,baseStats:u.baseStats,effectiveStats:u.effectiveStats,equipment:u.equipment,modifiers:Array.isArray(u.modifiers)?u.modifiers:void 0}))}return r}catch(a){return console.warn("Failed to load Saunoja units from storage",a),[]}}function YC(n){const a=nv();if(a)try{const s=n.map(r=>({id:r.id,name:r.name,coord:{q:r.coord.q,r:r.coord.r},maxHp:r.maxHp,hp:r.hp,steam:r.steam,traits:[...r.traits],upkeep:r.upkeep,xp:r.xp,selected:r.selected,baseStats:{health:r.baseStats.health,attackDamage:r.baseStats.attackDamage,attackRange:r.baseStats.attackRange,movementRange:r.baseStats.movementRange,...typeof r.baseStats.defense=="number"&&Number.isFinite(r.baseStats.defense)?{defense:r.baseStats.defense}:{},...typeof r.baseStats.shield=="number"&&Number.isFinite(r.baseStats.shield)?{shield:r.baseStats.shield}:{},...typeof r.baseStats.visionRange=="number"&&Number.isFinite(r.baseStats.visionRange)?{visionRange:r.baseStats.visionRange}:{}},effectiveStats:{health:r.effectiveStats.health,attackDamage:r.effectiveStats.attackDamage,attackRange:r.effectiveStats.attackRange,movementRange:r.effectiveStats.movementRange,...typeof r.effectiveStats.defense=="number"&&Number.isFinite(r.effectiveStats.defense)?{defense:r.effectiveStats.defense}:{},...typeof r.effectiveStats.shield=="number"&&Number.isFinite(r.effectiveStats.shield)?{shield:r.effectiveStats.shield}:{},...typeof r.effectiveStats.visionRange=="number"&&Number.isFinite(r.effectiveStats.visionRange)?{visionRange:r.effectiveStats.visionRange}:{}},equipment:Ws.reduce((o,u)=>{const f=r.equipment?.[u]??null;return o[u]=f?{id:f.id,name:f.name,description:f.description,icon:f.icon,rarity:f.rarity,quantity:f.quantity,slot:f.slot}:null,o},{}),items:r.items.map(o=>({id:o.id,name:o.name,description:o.description,icon:o.icon,rarity:o.rarity,quantity:o.quantity})),modifiers:r.modifiers.map(o=>({id:o.id,name:o.name,description:o.description,remaining:o.remaining,duration:o.duration,appliedAt:o.appliedAt,stacks:o.stacks,source:o.source}))}));a.setItem(tv,JSON.stringify(s))}catch(s){console.warn("Failed to persist Saunoja units",s)}}const av="autobattles:sauna-settings";function iv(){try{return globalThis.localStorage??null}catch{return null}}function FC(n){return typeof n=="string"?Oa(n).id:Ul}function x2(n){return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function lm(n,a){const s=x2(n),r=x2(a),o=1+Rl;return Math.max(0,Math.min(o,s,r))}function sv(n,a,s){const r=lm(s,s),o=typeof n=="number"&&Number.isFinite(n)?n:a,u=Math.max(0,Math.floor(o));return Math.max(0,Math.min(r,u))}function rv(n){return n===!0||n==="true"}function fl(n,a){const s=FC(n?.activeTierId),r=Oa(s),o=lm(r.rosterCap,a);return{activeTierId:r.id,maxRosterSize:sv(n?.maxRosterSize,o,o),useUiV2:rv(n?.useUiV2)}}function lv(n=1+Rl){const a=iv();if(!a)return fl(null,n);try{const s=a.getItem(av);if(!s)return fl(null,n);const r=JSON.parse(s);return fl(!r||typeof r!="object"?null:r,n)}catch(s){return console.warn("Failed to load sauna settings from storage",s),fl(null,n)}}function ov(n){const a=iv();if(!a)return;const s=Oa(n.activeTierId),r=lm(s.rosterCap,s.rosterCap),o={activeTierId:s.id,maxRosterSize:sv(n.maxRosterSize,r,r),useUiV2:rv(n.useUiV2)};try{a.setItem(av,JSON.stringify(o))}catch(u){console.warn("Failed to persist sauna settings",u)}}const $C=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),VC=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function cv(n){return Number.isFinite(n)?Math.max(0,Math.min(100,Math.round(n*100))):0}function XC(n){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});if(n.xpForNext===null)return`${a.format(n.xp)} XP • Max level`;const s=cv(n.progress);return`${a.format(n.xpIntoLevel)} / ${a.format(n.xpForNext)} XP • ${s}%`}function KC(n){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),s=[];return n.vigor>0&&s.push(`+${a.format(n.vigor)} Vigor`),n.focus>0&&s.push(`+${a.format(n.focus)} Focus`),n.resolve>0&&s.push(`+${a.format(n.resolve)} Resolve`),s.length>0?s.join(" • "):"No level bonuses yet"}function QC(n,a){const{rosterIcon:s,summaryLabel:r="Saunoja Roster"}=a;n.classList.add("sauna-roster"),n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("title","Active sauna battalion on the field"),n.dataset.tutorialTarget="upkeep",n.replaceChildren();const o=document.createElement("div");o.classList.add("sauna-roster__summary");const u=document.createElement("img");u.src=s,u.alt="Saunoja roster crest",u.decoding="async",u.classList.add("sauna-roster__icon");const f=document.createElement("div");f.classList.add("sauna-roster__text");const h=document.createElement("span");h.textContent=r,h.classList.add("sauna-roster__label");const m=document.createElement("span");m.textContent="0",m.classList.add("sauna-roster__value"),f.append(h,m),o.append(u,f);const p=document.createElement("div");p.classList.add("saunoja-card"),p.setAttribute("aria-live","polite"),p.hidden=!0;const g=document.createElement("div");g.classList.add("saunoja-card__header");const b=document.createElement("div");b.classList.add("saunoja-card__level"),b.setAttribute("role","img"),b.style.setProperty("--level-progress","0%");const v=document.createElement("span");v.classList.add("saunoja-card__level-value"),v.textContent="1",b.appendChild(v);const E=document.createElement("div");E.classList.add("saunoja-card__identity");const M=document.createElement("h3");M.classList.add("saunoja-card__name"),M.textContent="Saunoja";const C=document.createElement("div");C.classList.add("saunoja-card__xp"),C.textContent="0 / 0 XP • 0%",E.append(M,C),g.append(b,E);const R=document.createElement("p");R.classList.add("saunoja-card__traits");const N=document.createElement("div");N.classList.add("saunoja-card__callouts"),N.textContent="No level bonuses yet";const q=document.createElement("p");q.classList.add("saunoja-card__upkeep"),p.append(g,R,N,q),n.append(o,p);let j=null,F=null;function Q(T){if(!T){p.hidden=!0;return}p.hidden=!1,p.dataset.unitId=T.id,M.textContent=T.name||"Saunoja";const k=T.traits.filter(w=>w.length>0),A=k.length>0?k.join(", "):"No notable traits yet";R.textContent=A,R.title=A;const Y=XC(T.progression);C.textContent=Y,C.title=Y;const B=cv(T.progression.progress);b.style.setProperty("--level-progress",`${B}%`),v.textContent=String(T.progression.level);const D=T.progression.xpForNext===null?`Level ${T.progression.level}, at mastery`:`Level ${T.progression.level}, ${B}% toward next level`;b.setAttribute("aria-label",D);const V=KC(T.progression.statBonuses);N.textContent=V,N.title=V;const te=Math.max(0,Math.round(T.upkeep)),he=`Upkeep: ${VC.format(te)} Beer`;q.textContent=he,q.title=he}function se(T){return T===1/0?"inf":!Number.isFinite(T)||T<=0?"0":String(Math.ceil(T))}function ee(T){return[T.id,T.name,T.icon??"",T.rarity??"",T.description??"",T.quantity].join("^")}function le(T){return[T.id,T.name,T.description??"",se(T.duration),se(T.remaining),T.appliedAt??"",T.stacks??1,T.source??""].join("^")}function P(T){const{stats:k}=T,A=T.traits.join("|"),Y=T.items.map(ee).join("|"),B=T.modifiers.map(le).join("|");return[T.id,T.name,T.upkeep,T.status,T.selected?1:0,T.progression.level,T.progression.xp,T.progression.xpIntoLevel,T.progression.xpForNext??"max",k.health,k.maxHealth,k.attackDamage,k.attackRange,k.movementRange,k.defense??0,k.shield??0,A,Y,B].join("~")}function I(T){return`${T.length}:${T.map(P).join("||")}`}return{updateSummary(T){const k=Math.max(0,Math.floor(T.count)),A=$C.format(k);m.textContent=A,n.setAttribute("aria-label",`Saunoja roster: ${A} active attendants`),n.setAttribute("title",`Saunoja roster • ${A} active attendants`),Q(T.card)},installRenderer(T){F=null,j=T},renderRoster(T){if(!j)return;const k=I(T);k!==F&&(F=k,j(T))},destroy(){j=null,F=null,n.replaceChildren()}}}const PC={[ie.SAUNA_BEER]:"Sauna Beer",[ie.SAUNAKUNNIA]:"Saunakunnia",[ie.SISU]:"Sisu"},ZC='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function JC(n){if(!Number.isFinite(n)||n<=0)return"0:00";const a=Math.round(n/1e3),s=Math.max(0,a%60).toString().padStart(2,"0"),r=Math.floor(a/60),o=(r%60).toString().padStart(2,"0"),u=Math.floor(r/60);return u>0?`${u}:${o}:${s}`:`${r}:${s}`}function WC(n){switch(n.cause){case"strongholds":return"All rival strongholds have fallen.";case"rosterWipe":return"Every attendant is down—no one remains to hold the line.";case"bankruptcy":return"Upkeep debts have exhausted the steam reserves.";case"saunaDestroyed":return"The sauna collapsed under relentless assault—the sacred steamline has fallen silent.";default:return""}}function eT(n){if(!Number.isFinite(n)||n===0)return"±0";const a=Math.round(n*100)/100;return`${a>0?"+":""}${a}`}function tT(n,a){const s=document.createElement("ul");s.className="end-screen__rewards-list";for(const r of Object.values(ie)){const o=n.rewards.resources[r];if(!o)continue;const u=document.createElement("li");u.className="end-screen__reward-item";const f=document.createElement("span");f.className="end-screen__reward-label",f.textContent=a[r]??r;const h=document.createElement("span");h.className="end-screen__reward-value",h.textContent=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(o.final));const m=document.createElement("span");m.className="end-screen__reward-delta",m.textContent=eT(o.delta),m.dataset.polarity=o.delta>=0?"positive":"negative",u.append(f,h,m),s.append(u)}return s}function nT(n,a,s){const r=o=>{if(o.key==="Escape"){o.preventDefault(),s?.();return}if(o.key!=="Tab")return;const u=a.querySelectorAll(ZC);if(u.length===0){o.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;o.shiftKey?(m===f||!a.contains(m))&&(o.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(o.preventDefault(),f.focus())};return n.addEventListener("keydown",r),()=>n.removeEventListener("keydown",r)}function aT(n){const{container:a,resolution:s,onNewRun:r,onDismiss:o,currentNgPlusLevel:u}=n;if(!a)return{destroy(){},focusPrimary(){}};const f={...PC,...n.resourceLabels??{}},h=document.createElement("div");h.className="end-screen",h.setAttribute("role","presentation");const m=document.createElement("section");m.className="end-screen__panel",m.setAttribute("role","dialog"),m.setAttribute("aria-modal","true");const p=`end-screen-title-${Date.now()}`;m.setAttribute("aria-labelledby",p),m.tabIndex=-1,m.dataset.outcome=s.outcome;const g=document.createElement("h2");g.className="end-screen__title",g.id=p,g.textContent=s.outcome==="win"?"Steamforged Victory":"Sauna Lost";const b=document.createElement("p");b.className="end-screen__subtitle",b.textContent=WC(s);const v=document.createElement("dl");v.className="end-screen__metrics";const E=(le,P)=>{const I=document.createElement("dt");I.textContent=le,I.className="end-screen__metric-label";const T=document.createElement("dd");T.textContent=P,T.className="end-screen__metric-value",v.append(I,T)};E("Run time",JC(s.durationMs)),E("Strongholds",`${s.summary.strongholds.destroyed}/${s.summary.strongholds.total}`),E("Roster losses",`${s.summary.roster.totalDeaths}`),E("Deepest beer reserve",`${Math.round(s.summary.economy.worstBeer)}`);const M=document.createElement("div");M.className="end-screen__badges";const C=document.createElement("span");C.className="end-screen__badge",C.textContent=`NG+ ${Math.max(0,u)}`,M.append(C);const R=document.createElement("h3");R.className="end-screen__section-title",R.textContent="Rewards";const N=tT(s,f),q=document.createElement("div");q.className="end-screen__actions";const j=document.createElement("button");j.type="button",j.className="end-screen__button end-screen__button--primary",j.textContent="New run (NG+)",j.addEventListener("click",()=>{r()});const F=document.createElement("button");F.type="button",F.className="end-screen__button",F.textContent="Review battlefield",F.addEventListener("click",()=>{o?.()}),q.append(j,F),m.append(g,b,M,v,R,N,q),h.append(m),a.append(h);const Q=nT(h,m,o),se=()=>{Q(),h.remove()},ee=()=>{requestAnimationFrame(()=>{j.focus({preventScroll:!0})})};return ee(),{destroy:se,focusPrimary:ee}}const uv="autobattles4x.flags";function dv(){if(typeof window>"u")return null;try{if("localStorage"in window&&window.localStorage)return window.localStorage}catch(n){console.warn("Unable to access localStorage for local flags",n)}return null}function fv(){const n=dv();if(!n)return{};try{const a=n.getItem(uv);if(!a)return{};const s=JSON.parse(a);if(s&&typeof s=="object")return s}catch(a){console.warn("Failed to parse local flags, resetting.",a)}return{}}function iT(n){const a=dv();if(a)try{const s={};n.tutorial_done&&(s.tutorial_done=!0),a.setItem(uv,JSON.stringify(s))}catch(s){console.warn("Failed to persist local flags",s)}}function sT(){return fv().tutorial_done===!0}function w2(n){const a={...fv()};a.tutorial_done=!0,iT(a)}const eh=200,th=3,rT=2,A2=6,lT=40,oT=250,cT=200,uT=jC(Number.MAX_SAFE_INTEGER),Rh={[ie.SAUNA_BEER]:"Sauna Beer",[ie.SAUNAKUNNIA]:"Saunakunnia",[ie.SISU]:"Sisu"};function hv(n,a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;if(!Number.isFinite(n))return s;const r=Math.max(0,Math.floor(n));return Math.max(0,Math.min(s,r))}let Dt=Ca(eE()),mv=1,om=0,cu=1,Nc={aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1},pv=1,gv=Math.random,yv=Math.random,cm=null;function Pc(n){Dt=Ca(n),mv=nE(Dt),om=aE(Dt),cu=sE(Dt),Nc=rE(Dt),pv=iE(Dt),gv=Kg(Dt.runSeed,1),yv=Kg(Dt.runSeed,2),cm?.({persist:!0})}Pc(Dt);let Zc=null,je=[];const ta=new Map,hi=new Map,Ji=new Map;let C2=0,Jc=null,Zn=null,Da=null,Ks=null,Dn=null,Qs=null,Tt=null,Ki=null,Ml=null,Ra=null,mi=null,Qi=!1,vn=null,pi=null,Kn=null,xl=null,Fi=0;function um(n){const a=hi.get(n.id);return a?Ji.get(a)??null:null}function bv(n,a){n.effectiveStats={...a},n.maxHp=Math.max(1,Math.round(a.health)),n.hp=Math.min(n.maxHp,Math.max(0,Math.round(n.hp))),n.defense=typeof a.defense=="number"?Math.max(0,a.defense):void 0,n.shield=typeof a.shield=="number"?Math.max(0,a.shield):0;const s=um(n);if(s){const r={health:n.effectiveStats.health,attackDamage:n.effectiveStats.attackDamage,attackRange:n.effectiveStats.attackRange,movementRange:n.effectiveStats.movementRange};typeof n.effectiveStats.defense=="number"&&(r.defense=n.effectiveStats.defense),typeof n.effectiveStats.visionRange=="number"&&(r.visionRange=n.effectiveStats.visionRange),s.updateStats(r),typeof n.effectiveStats.shield=="number"?s.setShield(n.effectiveStats.shield):n.shield<=0&&s.setShield(0)}}function uu(n,a){const s=a??kn(n.equipment),r=zc(n.baseStats,s);return bv(n,r),r}function vv(n){const a=Qc(n.xp);return{level:a.level,xp:Math.max(0,Math.floor(n.xp)),xpIntoLevel:a.xpIntoLevel,xpForNext:a.xpForNext,progress:a.progressToNext,statBonuses:HC(a.level)}}function dT(n){const a=[];return n.vigor>0&&a.push(`+${n.vigor} Vigor`),n.focus>0&&a.push(`+${n.focus} Focus`),n.resolve>0&&a.push(`+${n.resolve} Resolve`),a.length>0?a.join(", "):"+0 Vigor, +0 Focus, +0 Resolve"}function Sv(n,a,s){if(!Number.isFinite(a)||a<=0)return null;const r=Qc(n.xp),o=Math.max(0,Math.floor(n.xp+a));if(o===n.xp)return null;n.xp=o;const u=Qc(n.xp),f=Math.max(0,u.level-r.level),h={vigor:0,focus:0,resolve:0};let m=0;if(f>0){for(let g=r.level+1;g<=u.level&&g<=uT;g++){const b=BC(g);h.vigor+=b.vigor,h.focus+=b.focus,h.resolve+=b.resolve;const v=Number.isFinite(n.baseStats.health)?n.baseStats.health:n.effectiveStats.health;n.baseStats.health=Math.max(1,Math.round(v+b.vigor));const E=Number.isFinite(n.baseStats.attackDamage)?n.baseStats.attackDamage:n.effectiveStats.attackDamage;n.baseStats.attackDamage=Math.max(0,Math.round(E+b.focus));const C=(Number.isFinite(n.baseStats.defense)?n.baseStats.defense??0:n.effectiveStats.defense??0)+b.resolve;n.baseStats.defense=C>0?C:void 0}m=h.vigor}m>0&&(n.hp+=m),uu(n);const p=um(n);if(p&&p.setExperience(n.xp),s.source==="kill"){const g=n.name?.trim()||"Our champion",b=s.label?.trim()||"their foe",v=s.boss?" Boss toppled!":s.elite?" Elite threat routed!":"";Lt({type:"combat",message:`${g} earns ${a} XP for defeating ${b}.${v}`,metadata:{slayer:g,foe:b,xpAward:a,boss:!!s.boss,elite:!!s.elite}})}if(f>0){const g=dT(h),b=n.name?.trim()||"Our champion";Lt({type:"progression",message:`${b} reaches Level ${u.level}! ${g}.`,metadata:{unit:b,level:u.level,levelsGained:f,bonuses:h}})}return{xpAwarded:a,totalXp:n.xp,level:u.level,levelsGained:f,statBonuses:h}}function fT(n,a,s){if(!n)return null;const r=ta.get(n.id);return r?Sv(r,a,s):null}function hT(n,a){if(!Number.isFinite(n)||n<=0)return!1;let s=!1;for(const r of je)Sv(r,n,a)&&(s=!0);return s}function mT(n){return n?(n.type?.toLowerCase?.()??"").includes("boss")?{xp:oT,elite:!0,boss:!0}:Uv(n)?{xp:lT,elite:!0,boss:!1}:{xp:A2,elite:!1,boss:!1}:{xp:A2,elite:!1,boss:!1}}const Ev=n=>{if(!n)return;const a=Math.max(0,Math.floor(n.strongholds.destroyed));if(a>Fi){const s=a-Fi,r=cT*s;hT(r,{source:"objective",label:"stronghold"})&&(na(),jt(),Lt({type:"progression",message:`Strategists toast the captured stronghold — roster gains ${r} XP.`,metadata:{source:"stronghold",xpAward:r}}))}if(a<Fi){Fi=a;return}Fi=a},pT=Object.freeze(["health","attackDamage","attackRange","movementRange","defense","shield"]);function T2(n){return n?{id:n.id,name:n.name,quantity:n.quantity,rarity:n.rarity}:null}function _2(n,a){const s=n[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function gT(n,a){const s=[];for(const r of pT){const o=_2(a,r),u=_2(n,r),f=o-u;f!==0&&s.push({stat:r,delta:f})}return s}function yT(n,a){if(!a||kn(n.equipment).length>0)return;const r={health:Math.max(1,Math.round(a.getMaxHealth())),attackDamage:Math.max(0,Math.round(a.stats.attackDamage)),attackRange:Math.max(0,Math.round(a.stats.attackRange)),movementRange:Math.max(0,Math.round(a.stats.movementRange)),defense:typeof a.stats.defense=="number"&&Number.isFinite(a.stats.defense)?Math.max(0,a.stats.defense):n.baseStats.defense,shield:n.baseStats.shield??0,visionRange:typeof a.stats.visionRange=="number"&&Number.isFinite(a.stats.visionRange)?Math.max(0,a.stats.visionRange):n.baseStats.visionRange};n.baseStats=r,uu(n)}function gl(){xl&&(xl.destroy(),xl=null)}function bT(){if(sT()){gl();return}gl(),xl=Qx({onComplete:()=>{w2(),gl()},onSkip:()=>{w2(),gl()}}),xl.start()}function R2(n){Ml=n,Tt&&(Tt.installRenderer(n),Ra&&(Tt.renderRoster(Ra),Ra=null))}function vT(){return IC()}function na(){YC(je)}function ST(n=Math.random){const a=typeof n=="function"?n:Math.random,s=Math.ceil(Math.min(wl,ph)),r=Math.floor(Math.max(wl,ph)),o=Math.max(1,r-s+1),u=Number(a()),f=Number.isFinite(u)?u:Math.random(),h=Math.min(Math.max(f,0),1),m=Math.min(Math.floor(h*o),o-1);return s+m}function ET(n){const s=(Array.isArray(n.traits)?n.traits:[]).length>=3,r=Number.isFinite(n.upkeep),o=Number.isFinite(n.xp);return!s||!r||!o}function Mv(n){n.traits=xA(),n.upkeep=ST(),n.xp=0}function MT(n,a,s,r={}){const o=r.hudVariant??"classic",u=o==="classic";s.dataset.hudVariant=o,Zc=n,vn&&(vn.dispose(),vn=null),vn=gA({canvas:n,overlay:s,mapRenderer:dm,getUnitById:h=>Ji.get(h),requestDraw:()=>{Ut()}}),Tt&&(Tt.destroy(),Tt=null),u?(Tt=QC(a,{rosterIcon:fi.saunojaRoster}),Ml&&Tt.installRenderer(Ml),Ra&&(Tt.renderRoster(Ra),Ra=null),Ki&&(Tt.updateSummary(Ki),Ki=null)):(Ml=null,Ra=null,Ki=null),Dn?.dispose(),Dn=null,u&&(Dn=D3(Je,{getActiveTierId:()=>yt,setActiveTierId:(h,m)=>{const p=kT(h,{persist:m?.persist});return p&&(Dn?.update(),jt()),p},getTierContext:()=>ym()})),Da?.dispose(),Da=null,Ks?.destroy(),Ks=null;const f={useSisuBurst:()=>{const h=K3(Fe,gt);return h?(Wn("sisu"),Lt({type:"ability",message:`Sisu bursts forth, spending ${$i} grit to steel our attendants.`,metadata:{ability:"sisu-burst",cost:$i}})):Wn("error"),h},torille:()=>{const h=P3(Fe,gt,Je.pos,Kt);return h?Lt({type:"ability",message:`Torille! Our warriors regroup at the sauna to rally their spirits for ${Vi} SISU.`,metadata:{ability:"torille",cost:Vi}}):Wn("error"),h}};u&&(Da=L3(Fe,{saunakunnia:fi.resource,sisu:fi.sisu,saunaBeer:fi.saunaBeer})),Ks=gx(Fe,s,f),Qs?.destroy(),Qs=null,u&&(Qs=lC(Tl,{getSelectedUnitId:()=>je.find(h=>h.selected)?.id??null,getComparisonContext:()=>OT(),onEquip:(h,m,p)=>vm(h,m),getUseUiV2:RT,onUseUiV2Change:NT})),u?(qT(),fm(),jt(),bT()):Zn&&(Zn(),Zn=null)}const Kt=new hE(10,10,32),xv=new Zw(()=>Ut()),xT=new DM(Kt,xv),dm=new Bw(Kt),Wc=()=>{dm.invalidateCache(),Ut()};ne.on("buildingPlaced",Wc);ne.on("buildingRemoved",Wc);Kt.forEachTile(n=>n.setFogged(!0));JS();const gt=[];function N2(n){return`${n.q},${n.r}`}function wT(){const n=new Set;for(const m of gt)m.isDead()||n.add(N2(m.coord));const a=[],{minQ:s,maxQ:r,minR:o,maxR:u}=Kt,f=m=>{const p=N2(m);n.has(p)||(Kt.ensureTile(m.q,m.r),a.push(m))};for(let m=s;m<=r;m++)f({q:m,r:o}),u!==o&&f({q:m,r:u});for(let m=o+1;m<=u-1;m++)f({q:s,r:m}),r!==s&&f({q:r,r:m});if(a.length===0)return;const h=Math.floor(Math.random()*a.length);return a[h]}function AT(n){const a=ta.get(n);a&&(ta.delete(n),hi.get(a.id)===n&&hi.delete(a.id))}function CT(n){const a=ta.get(n.id);if(a)return{saunoja:a,created:!1,attached:!1};let s=je.find(f=>f.id===n.id);s||(s=je.find(f=>!hi.has(f.id)));let r=!1;s||(s=Jh({id:`saunoja-${je.length+1}`,coord:{q:n.coord.q,r:n.coord.r}}),je.push(s),r=!0);const o=hi.get(s.id);o&&o!==n.id&&ta.delete(o),ta.set(n.id,s),hi.set(s.id,n.id),yT(s,n),bv(s,s.effectiveStats),n.setExperience(s.xp);const u=ET(s);return(r||u)&&Mv(s),{saunoja:s,created:r,attached:!0}}function fm(){let n=!1;for(const a of gt){if(a.faction!=="player"||a.isDead())continue;const{saunoja:s,created:r,attached:o}=CT(a);(r||o)&&(n=!0);const u=Number.isFinite(a.stats.health)?Math.max(0,a.stats.health):0;s.hp!==u&&(s.hp=u,n=!0);const f=Number.isFinite(a.getMaxHealth())?Math.max(1,a.getMaxHealth()):1;s.maxHp!==f&&(s.maxHp=f,n=!0);const h=a.getShield(),m=Number.isFinite(h)?Math.max(0,h):0;s.shield!==m&&(s.shield=m,n=!0);const g=a?.lastHitAt;Number.isFinite(g)&&s.lastHitAt!==g&&(s.lastHitAt=g,n=!0);const{q:b,r:v}=a.coord;(s.coord.q!==b||s.coord.r!==v)&&(s.coord={q:b,r:v},n=!0,s.selected&&bm(s.coord))}return n&&na(),n}function wv(n,a){if(n.faction==="player"){const u=(a??ta.get(n.id)??null)?.name?.trim();if(u)return u}return`${(n.constructor?.name??"Unit").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase()} ${n.id}`.trim()}function du(n){if(Ji.has(n.id))return;gt.push(n),Ji.set(n.id,n);let a=null;if(n.faction==="player"&&(fm()||Ol(),a=ta.get(n.id)??null),Zc&&Ut(),n.faction==="player"){const r=wv(n,a);Lt({type:"spawn",message:`Our ${r} emerges from the steam.`,metadata:{unitId:n.id,unitName:r,steward:"Our"}}),jt()}}const Av=({unit:n})=>{du(n)};ne.on("unitSpawned",Av);const Cv=()=>{Ol()},Ps=()=>{Ol()};ne.on("inventoryChanged",Cv);ne.on("modifierAdded",Ps);ne.on("modifierRemoved",Ps);ne.on("modifierExpired",Ps);const Tv=n=>{Dn?.handleDamage?.(n)},_v=n=>{Dn?.handleDestroyed?.(n)};ne.on("saunaDamaged",Tv);ne.on("saunaDestroyed",_v);const Rv=()=>{jt()};ne.on("unit:stats:changed",Rv);function TT(n){const a=ta.get(n.id);if(!a)return 0;const s=Number.isFinite(a.upkeep)?a.upkeep:0;return s>0?s*mv:0}const Fe=new oE(1e3),Tl=new RA,hm=Fe.load(Kt);if(hm){const n=Fe.getNgPlusState();Pc(n),lh(n)}else{const n=Fe.setNgPlusState(Dt);Pc(n),lh(n)}Fe.setEnemyScalingBase({aggression:Nc.aggressionMultiplier,cadence:Nc.cadenceMultiplier,strength:Nc.strengthMultiplier});if(!hm&&Dt.ngPlusLevel>0){const n=Math.round(75*Dt.ngPlusLevel);n>0&&Fe.addResource(ie.SAUNA_BEER,n)}const Zs=lv(cu),Nv=()=>({ngPlusLevel:Dt.ngPlusLevel,unlockSlots:Dt.unlockSlots});let yt=Zs.activeTierId,nr=Zs.useUiV2;const _T=tr(Oa(yt),Nv());_T.unlocked||(yt=Ul);const fu=()=>{const n=Oa(yt),a=Math.max(0,Math.floor(n.rosterCap));return Math.min(a,cu)},eu=hv(Zs.maxRosterSize,fu());(eu!==Zs.maxRosterSize||Zs.activeTierId!==yt||Zs.useUiV2!==nr)&&ov({maxRosterSize:eu,activeTierId:yt,useUiV2:nr});const Je=RM({q:Math.floor(Kt.width/2),r:Math.floor(Kt.height/2)},void 0,{maxRosterSize:eu}),RT=()=>nr,NT=n=>{const a=!!n;nr!==a&&gm(Je.maxRosterSize,{useUiV2:a})},mm=GC({getTier:()=>Oa(yt),getRosterLimit:()=>fu(),getRosterCount:()=>hu(),log:n=>Lt(n),queueCapacity:3});let kv=eu,pm=yt;const gm=(n,a)=>{typeof a?.useUiV2=="boolean"&&(nr=a.useUiV2),ov({maxRosterSize:n,activeTierId:yt,useUiV2:nr}),kv=n,pm=yt},ym=()=>Nv(),_l=(n,a={})=>{const s=fu(),r=hv(n,s);return r!==Je.maxRosterSize&&(Je.maxRosterSize=r),a.persist&&(yt!==pm||r!==kv)&&gm(r),r};cm=(n={})=>{const a=ym(),s=vb();let r=Ul;for(const f of s)if(tr(f,a).unlocked)r=f.id;else break;if(!tr(Oa(yt),a).unlocked||yt!==r){const f=yt;yt=r,mm.clearQueue?.("tier-change"),_l(Je.maxRosterSize,{persist:n.persist}),f!==yt&&Dn?.update?.(),jt();return}n.persist&&(_l(Je.maxRosterSize,{persist:!0}),jt())};cm({persist:!0});const kT=(n,a={})=>{const s=Oa(n);return tr(s,ym()).unlocked?s.id===yt?(a.persist&&yt!==pm&&gm(Je.maxRosterSize),!0):(yt=s.id,mm.clearQueue?.("tier-change"),_l(Je.maxRosterSize,{persist:a.persist}),!0):!1},DT=n=>{C2+=1;const a=`p${Date.now()}-${C2}`,s=Ph(Fe,"soldier",a,n,"player");return s&&du(s),s??null},k2=new M3({difficulty:pv,random:gv,eliteOdds:om}),Dv=new cE(1e3,n=>{const a=n/1e3;Fe.tick(),Tc.tick(a,{state:Fe});const s=Fe.getEnemyScalingSnapshot(),r=_l(Je.maxRosterSize);CA({dt:a,state:Fe,sauna:Je,heat:Je.heatTracker,units:gt,getUnitUpkeep:TT,pickSpawnTile:()=>eb(Je.pos,gt),spawnBaseUnit:DT,minUpkeepReserve:Math.max(1,wl),maxSpawns:cu,rosterCap:r,getRosterCount:hu,tierHelpers:mm});const o={aggressionMultiplier:s.aggression,cadenceMultiplier:s.cadence,strengthMultiplier:s.strength,calmSecondsRemaining:s.calmSecondsRemaining};k2.update(a,gt,du,wT,o),Fe.advanceEnemyCalm(a);const u=k2.getSnapshot(),f=Math.max(s.calmSecondsRemaining,u.calmSecondsRemaining);if(Da){const m={stage:u.rampStageLabel,stageIndex:u.rampStageIndex,bundleTier:u.bundleTier,multiplier:u.difficultyMultiplier,cadenceSeconds:u.cadence,effectiveDifficulty:u.effectiveDifficulty,aggressionMultiplier:u.aggressionMultiplier,cadenceMultiplier:u.cadenceMultiplier,strengthMultiplier:u.strengthMultiplier,calmSecondsRemaining:f,spawnCycles:u.spawnCycles};Da.setEnemyRampSummary(m)}const h=pi?.getProgress().roster;T3(u,{wipeSince:h?.wipeSince??null,wipeDurationMs:h?.wipeDurationMs??0}),xT.tick(gt,a,Je),uM(a),fm()&&jt(),Fe.save();for(const m of gt)m.isDead()||m.faction!=="player"||Kt.revealAround(m.coord,m.getVisionRange(),{autoFrame:!1});Ut()}),LT=n=>{Qi&&(Qi=!1),Dv.stop(),mi!==null&&(cancelAnimationFrame(mi),mi=null),Ut();const a=document.getElementById("ui-overlay");if(!a)return;Kn&&(Kn.destroy(),Kn=null);const s=Dt.ngPlusLevel,r=tE(Dt,{outcome:n.outcome});lh(r),Fe.setNgPlusState(r),Pc(r),Kn=aT({container:a,resolution:n,currentNgPlusLevel:s,resourceLabels:Rh,onNewRun:()=>{try{typeof window<"u"&&window.localStorage?.removeItem?.("gameState")}catch(u){console.warn("Failed to reset saved game state for NG+",u)}typeof window<"u"&&typeof window.location?.reload=="function"&&window.setTimeout(()=>window.location.reload(),75)},onDismiss:()=>{Kn&&(Kn.destroy(),Kn=null)}})};je=vT();if(je.length===0){const n=Jh({id:"saunoja-1",coord:Je.pos,selected:!0,upkeep:Bc});Mv(n),n.upkeep=Bc,je.push(n),na()}else{let n=!1,a=!1;for(const s of je)s.selected&&(n?(s.selected=!1,a=!0):n=!0);a&&na()}const UT=gt.some(n=>n.faction==="player"&&!n.isDead());if(!UT){Fe.canAfford(vy,ie.SAUNA_BEER)||Fe.addResource(ie.SAUNA_BEER,vy);const n=`u${gt.length+1}`,a=Ph(Fe,"soldier",n,Je.pos,"player");a&&du(a)}Kt.revealAround(Je.pos,3);pi=OC({state:Fe,map:Kt,getRosterCount:hu,sauna:Je,rosterWipeGraceMs:8e3,bankruptcyGraceMs:12e3});Fi=pi.getProgress().strongholds.destroyed;pi.onProgress(Ev);pi.onResolution(LT);function OT(){const n=je.find(a=>a.selected)??null;return n?{baseStats:{...n.baseStats},loadout:kn(n.equipment),currentStats:{...n.effectiveStats}}:null}function qT(){Zn&&(Zn(),Zn=null);const n=$x(Fe,{onRosterSelect:jT,onRosterRendererReady:R2,onRosterEquipSlot:IT,onRosterUnequipSlot:YT,getRosterCap:()=>Math.max(0,Math.floor(Je.maxRosterSize)),getRosterCapLimit:()=>fu(),updateMaxRosterSize:(a,s)=>{const r=_l(a,{persist:s?.persist});return s?.persist&&jt(),r}});n.addEvent,R2(n.renderRoster),Zn=n.dispose}function zT(){Dn?.update()}function D2(n){Da?.update(n)}hm||(Fe.addResource(ie.SAUNA_BEER,eh),Lt({type:"resource",message:`Quartermaster stocks ${eh} bottles of ${Rh[ie.SAUNA_BEER]} to launch your campaign.`,metadata:{resource:ie.SAUNA_BEER,amount:eh,context:"initial"}}),Fe.addResource(ie.SAUNAKUNNIA,th),Lt({type:"resource",message:`Sauna elders honor your leadership with ${th} ${Rh[ie.SAUNAKUNNIA]} to celebrate your arrival.`,metadata:{resource:ie.SAUNAKUNNIA,amount:th,context:"initial"}}));const nh=je.find(n=>n.selected);nh&&(Jc={q:nh.coord.q,r:nh.coord.r});function BT(n,a){return!n||!a?n===a:n.q===a.q&&n.r===a.r}function bm(n){return BT(Jc,n)?!1:(Jc=n?{q:n.q,r:n.r}:null,!0)}function Lv(n){let a=!1;for(const s of je)n&&s===n||s.selected&&(s.selected=!1,a=!0);return a}function HT(){let n=!1;return Lv()&&(n=!0),bm(null)&&(n=!0),n}function Uv(n){if(!n)return!1;const a=Qh(n.type);if(!a)return!1;const s=kl(a,1),r=n.stats;return r.health>s.health||r.attackDamage>s.attackDamage||r.attackRange>s.attackRange||r.movementRange>s.movementRange}function Ov(n){let a=!1;return n.selected||(n.selected=!0,a=!0),Lv(n)&&(a=!0),bm(n.coord)&&(a=!0),a}function jT(n){const a=je.find(s=>s.id===n);a&&Ov(a)&&(na(),jt(),Ut())}function qv(n){const a=XS(n.x,n.y,Kt.hexSize),s=je.find(o=>o.coord.q===a.q&&o.coord.r===a.r);(s?Ov(s):HT())&&(na(),jt(),Ut())}function vm(n,a){const s=je.find(p=>p.id===n);if(!s)return{success:!1,reason:"unit-missing"};const r=kn(s.equipment),o=zc(s.baseStats,r),u=FM(s,a);if(!u.success)return{success:!1,reason:u.reason};const f=uu(s,u.loadout);ne.emit("unit:stats:changed",{unitId:s.id,stats:f}),ne.emit("inventoryChanged",{}),na(),jt();const h=r.find(p=>p.slot===u.slot)??null;return{success:!0,comparison:{slot:u.slot,previous:T2(h),next:T2(u.item??null),deltas:gT(o,f)}}}function GT(n,a){const s=je.find(b=>b.id===n);if(!s)return null;const r=$M(s,a);if(!r.success||!r.removed)return null;const o=uu(s,r.loadout);ne.emit("unit:stats:changed",{unitId:s.id,stats:o}),ne.emit("inventoryChanged",{}),na(),jt();const{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}=r.removed;return{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}}function IT(n,a){const r=Tl.getStash().findIndex(o=>VM(o.id,a));return r===-1?!1:Tl.equipFromStash(r,n,vm)}function YT(n,a){return Tl.unequipToStash(n,a,GT)}function Ut(){if(!Zc)return;const n=Zc.getContext("2d"),a=ev();if(!n||!a)return;if(vn){const m=typeof performance<"u"?performance.now():Date.now();vn.step(m)}const s=vn?.getShakeOffset()??{x:0,y:0},r=vn?{getUnitAlpha:m=>vn.getUnitAlpha(m.id)}:void 0,o=Array.isArray(je)&&je.length>0,u=gt.filter(m=>m.faction==="player"&&!m.isDead()),f=Je?{coord:Je.pos,range:Je.auraRadius}:null,h=o?gt.filter(m=>m.faction!=="player"):gt;n.save(),(s.x!==0||s.y!==0)&&n.translate(s.x,s.y),Kw(n,dm,a.images,h,Jc,{saunojas:{units:je,draw:vA,resolveRenderCoord:m=>{const p=um(m);return p?p.renderCoord??p.coord:null}},sauna:Je,saunaVision:f,fx:r,friendlyVisionSources:u}),n.restore()}const zv=({policy:n})=>{Lt({type:"policy",message:`Sauna council toasts a fresh keg for policy: ${n.name}.`,metadata:{policy:n.id,name:n.name}})};ne.on(Ht.APPLIED,zv);const Bv=({unitId:n,attackerId:a,attackerFaction:s,unitFaction:r})=>{const o=gt.findIndex(v=>v.id===n),u=o!==-1?gt[o]:null,f=u?{q:u.coord.q,r:u.coord.r}:null,h=r==="player"?ta.get(n)??null:null;let m=!1;if(r==="player"){const v=h??je.find(E=>hi.get(E.id)===n||E.id===n)??null;v&&(v.hp!==0&&(v.hp=0,m=!0),v.shield!==0&&(v.shield=0,m=!0))}const p=u?wv(u,h):`unit ${n}`;let g=!1;if(s==="player"&&r&&r!=="player"){const v=a?Ji.get(a)??null:null,{xp:E,elite:M,boss:C}=mT(u);E>0&&fT(v,E,{source:"kill",label:p,elite:M,boss:C})&&(g=!0)}if(o!==-1&&(u&&xv.clear(u,{snap:!0}),gt.splice(o,1),Ji.delete(n),AT(n),Ut()),(m||g)&&na(),(r==="player"||g)&&jt(),s==="player"&&r&&r!=="player"){const v=Uv(u??null)||yv()<om,E=SC({factionId:r,elite:v});if(E.rolls.length>0){const M=je.find(C=>C.selected)??null;for(const C of E.rolls)if(Tl.addLoot(C,{unitId:M?.id,sourceTableId:E.tableId,equip:vm}).equipped){const N=M?.name??"our champion";Lt({type:"loot",message:`Quartermaster fastens ${C.item.name} to ${N}.`,metadata:{item:C.item.name,equipped:!0,owner:N,source:p}})}else Lt({type:"loot",message:`Quartermaster stores ${C.item.name} recovered from ${p}.`,metadata:{item:C.item.name,equipped:!1,source:p}})}}s==="player"&&r&&r!=="player"&&(Fe.addResource(ie.SAUNAKUNNIA,rT),Fe.addResource(ie.SISU,1),Lt({type:"resource",message:"Our grit surges — +1 SISU earned for the vanquished foe.",metadata:{resource:ie.SISU,amount:1,context:"victory"}})),f&&Kt.revealAround(f,1,{autoFrame:!1});const b=r==="player"?"our":"a rival";Lt({type:"combat",message:`The steam hushes as ${b} ${p} grows still.`,metadata:{side:b,unit:p}})};ne.on("unitDied",Bv);function Nh(){Qi=!1,pi?.offProgress(Ev),pi?.dispose(),pi=null,Fi=0,J3(),Kn&&(Kn.destroy(),Kn=null),mi!==null&&(cancelAnimationFrame(mi),mi=null);try{Fe.save()}catch(n){console.warn("Failed to persist game state during cleanup",n)}try{na()}catch(n){console.warn("Failed to persist Saunoja roster during cleanup",n)}vn&&(vn.dispose(),vn=null),ne.off(Ht.APPLIED,zv),ne.off("unitDied",Bv),ne.off("unitSpawned",Av),ne.off("inventoryChanged",Cv),ne.off("modifierAdded",Ps),ne.off("modifierRemoved",Ps),ne.off("modifierExpired",Ps),ne.off("unit:stats:changed",Rv),ne.off("saunaDamaged",Tv),ne.off("saunaDestroyed",_v),ne.off("buildingPlaced",Wc),ne.off("buildingRemoved",Wc),Zn&&(Zn(),Zn=null),Qs&&(Qs.destroy(),Qs=null),Dn&&(Dn.dispose(),Dn=null),Da&&(Da.dispose(),Da=null),Ks&&(Ks.destroy(),Ks=null),Tt&&(Tt.destroy(),Tt=null),Ra=null,Ki=null,Ml=null,gl()}async function FT(){if(Qi)return;if(!ev()){console.error("Cannot start game without loaded assets.");return}Qi=!0,jt(),Ut();try{await Zb(()=>{Ut()}).then(()=>{Ut()})}catch(r){console.warn("Failed to preload Saunoja icon before starting the game",r)}let a=performance.now();function s(r){if(!Qi)return;const o=r-a;a=r,Eb()?D2(0):(Dv.tick(o),zT(),D2(o),Ol()),Ut(),Qi&&(mi=requestAnimationFrame(s))}mi=requestAnimationFrame(s)}function hu(){let n=0;for(const a of gt)a.faction==="player"&&!a.isDead()&&(n+=1);return n}function $T(){const n={engaged:0,reserve:1,downed:2},a=je.map(s=>{const r=hi.get(s.id),o=r?Ji.get(r):void 0,u=o?!o.isDead()&&o.stats.health>0:!1,f=s.effectiveStats,h=s.baseStats,m=Math.round(o?Math.max(0,o.stats.health):Math.max(0,s.hp)),p=Math.round(o?Math.max(1,o.getMaxHealth()):Math.max(1,f.health)),g=Math.round(o?Math.max(0,o.stats.attackDamage):Math.max(0,f.attackDamage)),b=Math.round(o?Math.max(0,o.stats.attackRange):Math.max(0,f.attackRange)),v=Math.round(o?Math.max(0,o.stats.movementRange):Math.max(0,f.movementRange)),E=o?.stats.defense??f.defense??0,M=Math.round(Math.max(0,E)),C=o?o.getShield():f.shield??s.shield,R=Math.round(Math.max(0,C)),N=Math.max(0,Math.round(s.upkeep)),q=m<=0?"downed":u?"engaged":"reserve",j=vv(s),F=s.items.map(le=>({...le})),Q=s.modifiers.map(le=>({...le})),se=Ws.map(le=>{const P=Dl(le),I=s.equipment[le],T=I?{id:I.id,name:I.name,description:I.description,icon:I.icon,rarity:I.rarity,quantity:I.quantity,slot:le}:null,k=I?XT(I.modifiers,I.quantity):null;return{id:le,label:P.label,description:P.description,maxStacks:P.maxStacks,item:T,modifiers:k}}),ee={health:Math.round(Math.max(0,h.health)),maxHealth:Math.round(Math.max(1,h.health)),attackDamage:Math.round(Math.max(0,h.attackDamage)),attackRange:Math.round(Math.max(0,h.attackRange)),movementRange:Math.round(Math.max(0,h.movementRange)),defense:typeof h.defense=="number"&&h.defense>0?Math.round(h.defense):void 0,shield:typeof h.shield=="number"&&h.shield>0?Math.round(h.shield):void 0};return{id:s.id,name:s.name,upkeep:N,status:q,selected:!!s.selected,traits:[...s.traits],stats:{health:m,maxHealth:p,attackDamage:g,attackRange:b,movementRange:v,defense:M>0?M:void 0,shield:R>0?R:void 0},baseStats:ee,progression:j,equipment:se,items:F,modifiers:Q}});return a.sort((s,r)=>{const o=n[s.status]-n[r.status];return o!==0?o:s.name.localeCompare(r.name,"en")}),a}function VT(){return je.length===0?null:je.find(n=>n.selected)??je.find(n=>n.hp>0)??je[0]}function XT(n,a){const s=Math.max(1,Math.round(a)),r={};return typeof n.health=="number"&&(r.health=n.health*s),typeof n.attackDamage=="number"&&(r.attackDamage=n.attackDamage*s),typeof n.attackRange=="number"&&(r.attackRange=n.attackRange*s),typeof n.movementRange=="number"&&(r.movementRange=n.movementRange*s),typeof n.defense=="number"&&(r.defense=n.defense*s),typeof n.shield=="number"&&(r.shield=n.shield*s),r}function KT(){const n=hu(),a=VT();let s=null;return a&&(s={id:a.id,name:a.name||"Saunoja",traits:[...a.traits],upkeep:Math.max(0,Math.round(a.upkeep)),progression:vv(a)}),{count:n,card:s}}function Ol(n){const a=$T();Ra=a,Tt&&Tt.renderRoster(a)}function jt(){const n=KT();Tt?(Tt.updateSummary(n),Ki=null):Ki=n,Ol()}function QT(n){const{overlay:a,resourceBar:s}=n,r=ar(a),{regions:o}=r,u=document.createElement("div");u.className="pointer-events-none absolute inset-0 grid place-items-center bg-[radial-gradient(circle_at_top,rgba(18,28,45,0.92),rgba(6,10,18,0.94))] p-[clamp(1.5rem,4vw,3.25rem)] z-overlay";const f=document.createElement("section");f.className="pointer-events-auto relative grid w-full max-w-[min(640px,90vw)] gap-4 overflow-hidden rounded-[28px] border border-[rgba(128,168,236,0.28)] bg-[linear-gradient(145deg,rgba(31,46,74,0.95),rgba(14,20,33,0.95))] p-[clamp(1.75rem,4vw,2.5rem)] text-slate-100 shadow-[0_40px_90px_rgba(10,14,28,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)]",f.setAttribute("aria-live","polite"),f.setAttribute("role","status");const h=document.createElement("h1");h.className="m-0 text-[clamp(1.6rem,3vw,2.1rem)] font-semibold uppercase tracking-[0.04em]",h.textContent="Experimental HUD Enabled",f.appendChild(h);const m=document.createElement("p");m.className="m-0 text-base leading-relaxed text-slate-100/90",m.textContent="The React/Tailwind interface is bootstrapped for this session. Gameplay systems continue to run, and classic HUD elements are paused while the new shell is under construction.",f.appendChild(m);const p=document.createElement("p");p.className="m-0 text-sm leading-relaxed text-slate-200/75",p.textContent="Toggle the experimental HUD off from the quartermaster settings to return to the classic layout.",f.appendChild(p);const g=document.createElement("div");g.className="pointer-events-none absolute -left-[30%] -top-[40%] h-[420px] w-[420px] bg-[radial-gradient(circle,rgba(90,164,255,0.35),rgba(90,164,255,0))] blur-[0.5px]",f.appendChild(g);const b=document.createElement("div");return b.className="mt-2 rounded-[18px] border border-[rgba(128,168,236,0.2)] bg-[rgba(10,16,26,0.55)] p-4 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]",b.appendChild(s),f.appendChild(b),u.appendChild(f),o.content.appendChild(u),{destroy(){b.contains(s)&&a.prepend(s),u.remove()}}}function Hv(n){if(!n)return{showLoader:()=>({update:()=>{},clear:()=>{},dispose:()=>{}}),showBanner:()=>null,removeTransientUI:()=>{}};const a=()=>{let f=n.querySelector(".hud-banner-stack");return f||(f=document.createElement("div"),f.className="hud-banner-stack",n.append(f)),f},s=(f,h,m)=>{let p=!1;const g=()=>{p||(p=!0,f.removeEventListener("transitionend",g),m())};f.addEventListener("transitionend",g),requestAnimationFrame(()=>{f.classList.add(h)}),window.setTimeout(g,400)};return{showLoader:(f="Heating the sauna stones…")=>{const h=document.createElement("div");h.className="hud-loader",h.setAttribute("role","status"),h.setAttribute("aria-live","polite");const m=document.createElement("div");m.className="hud-loader__card";const p=document.createElement("div");p.className="hud-loader__spinner",p.setAttribute("aria-hidden","true");const g=document.createElement("p");g.className="hud-loader__message",g.textContent=f,m.append(p,g),h.append(m),n.append(h);let b=!1;return{update(v){g.textContent=v},clear(){b||s(h,"hud-loader--hidden",()=>{b=!0,h.remove()})},dispose(){b||(b=!0,h.remove())}}},showBanner:(f,h)=>{const m=a(),p=document.createElement("section");p.className=`hud-banner hud-banner--${f}`,p.setAttribute("role",f==="error"?"alert":"status"),p.setAttribute("aria-live",f==="error"?"assertive":"polite");const g=document.createElement("header");g.className="hud-banner__header";const b=document.createElement("p");b.className="hud-banner__title",b.textContent=h.title??(f==="error"?"Attention required":f==="warning"?"Heads up":"Status update"),g.append(b);const v=document.createElement("ul");v.className="hud-banner__list";for(const R of h.messages){const N=document.createElement("li");N.textContent=R,v.append(N)}if(p.append(g),h.messages.length&&p.append(v),h.actions?.length){const R=document.createElement("div");R.className="hud-banner__actions";for(const N of h.actions){const q=document.createElement("button");q.type="button",q.className=N.variant==="secondary"?"hud-banner__button hud-banner__button--secondary":"hud-banner__button",q.textContent=N.label,q.addEventListener("click",()=>{N.onClick()}),R.append(q)}p.append(R)}let E,M=!1;const C=()=>{M||(M=!0,E&&window.clearTimeout(E),s(p,"hud-banner--hide",()=>{p.remove(),m.hasChildNodes()||m.remove()}))};if(h.dismissible!==!1){const R=document.createElement("button");R.type="button",R.className="hud-banner__close",R.setAttribute("aria-label","Dismiss notification"),R.textContent="×",R.addEventListener("click",()=>{C()}),g.append(R)}return m.append(p),h.autoCloseMs&&h.autoCloseMs>0&&(E=window.setTimeout(()=>C(),h.autoCloseMs)),{element:p,dismiss:C}},removeTransientUI:()=>{n.querySelectorAll(".hud-loader").forEach(f=>{f.remove()}),n.querySelectorAll(".hud-banner-stack").forEach(f=>{f.remove()})}}}async function PT(n){const a=Object.entries(n),s=await Promise.allSettled(a.map(([f,h])=>h.load().then(m=>({key:f,descriptor:h,value:m})))),r={},o=[],u=[];return s.forEach((f,h)=>{const[m,p]=a[h],g=p.label??String(m);if(f.status==="fulfilled"){const{value:v}=f.value;if(r[m]=v.value,v.warnings?.length)for(const E of v.warnings)o.push(g?`${g}: ${E}`:E);if(v.errors?.length)for(const E of v.errors)u.push(g?`${g}: ${E}`:E);return}const b=ZT(f.reason);u.push(g?`${g}: ${b}`:b)}),{resources:r,warnings:o,errors:u}}function ZT(n){if(n instanceof Error)return n.message;if(typeof n=="string")return n;try{return JSON.stringify(n)}catch{return String(n)}}const JT="Heating the sauna stones…",WT="Polishing sauna ambience…";function e_(n){if(n instanceof Error&&n.message)return n.message;if(typeof n=="string"&&n.trim().length>0)return n;try{return JSON.stringify(n)}catch{return String(n)}}function t_(n){const a=new Set,s=f=>{a.forEach(h=>h(f))},r=n.formatError??e_;return{run:async f=>{s({type:"status",phase:"start",message:JT});try{const{resources:h,warnings:m,errors:p}=await PT({assets:{label:"Core assets",load:async()=>{const b=await n.loadAssets(n.assetPaths);return{value:b.assets,errors:b.failures}}},saunojaIcon:{label:"Saunoja icon",load:async()=>{try{return await n.preloadSaunojaIcon(),{value:!0}}catch(b){return{value:!1,warnings:[`Unable to preload Saunoja icon (${r(b)})`]}}}}});if(n.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"status",phase:"progress",message:WT});const g=h.assets;if(!g){const b=p.length?[...p]:["Critical assets were unavailable. Please refresh to try again."];s({type:"fatal",messages:b});return}if(p.length&&s({type:"errors",errors:p}),m.length&&s({type:"warnings",warnings:m}),n.setAssets(g),n.shouldAbort?.(f)){s({type:"cancelled"});return}n.startGame(),s({type:"ready",assets:g,warnings:m,errors:p})}catch(h){if(n.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"failure",error:h,message:r(h)})}},subscribe:f=>(a.add(f),()=>{a.delete(f)})}}const n_="grabbing";function a_(n,a){const s=a.dragCursor??n_;let r=!1,o=null,u=0,f=0,h=null;const m=E=>{E.pointerType!=="mouse"||E.button!==0||(r=!0,o=E.pointerId,u=E.clientX,f=E.clientY,h=n.style.cursor??"",n.setPointerCapture?.(E.pointerId),n.style.cursor=s,a.onPanStart?.(E))},p=E=>{if(!r||o!==E.pointerId)return;const M=E.clientX-u,C=E.clientY-f;u=E.clientX,f=E.clientY,a.onPan(M,C,E)},g=E=>{!r||o!==E.pointerId||(r=!1,o=null,n.releasePointerCapture?.(E.pointerId),n.style.cursor=h??"",a.onPanEnd?.(E))},b=E=>{g(E)},v=E=>{g(E)};return n.addEventListener("pointerdown",m),n.addEventListener("pointermove",p),n.addEventListener("pointerup",b),n.addEventListener("pointercancel",v),n.addEventListener("pointerleave",v),()=>{n.removeEventListener("pointerdown",m),n.removeEventListener("pointermove",p),n.removeEventListener("pointerup",b),n.removeEventListener("pointercancel",v),n.removeEventListener("pointerleave",v),r&&o!==null&&n.releasePointerCapture?.(o),n.style.cursor=h??""}}const i_=10,s_=250;function Gi(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function r_(n,a){const s=a.tapMaxMovement??i_,r=a.tapMaxDuration??s_;let o=null;const u=b=>{if(b.touches.length===1){const v=b.touches[0];o={mode:"pan",lastX:v.clientX,lastY:v.clientY,startX:v.clientX,startY:v.clientY,startTime:Gi(),moved:!1};return}if(b.touches.length>=2){const[v,E]=[b.touches[0],b.touches[1]];o={mode:"pinch",lastCenterX:(v.clientX+E.clientX)/2,lastCenterY:(v.clientY+E.clientY)/2,lastDistance:Math.hypot(v.clientX-E.clientX,v.clientY-E.clientY),startTime:Gi(),moved:!1}}},f=(b,v)=>{if(!o||o.mode!=="pan")return;const E=b.clientX-o.lastX,M=b.clientY-o.lastY;!o.moved&&Math.hypot(E,M)>1&&(o.moved=!0),o.lastX=b.clientX,o.lastY=b.clientY,a.onPan(E,M,v)},h=(b,v,E)=>{const M=(b.clientX+v.clientX)/2,C=(b.clientY+v.clientY)/2,R=Math.hypot(b.clientX-v.clientX,b.clientY-v.clientY);let N=1,q=0,j=0;o&&o.mode==="pinch"?(N=R/o.lastDistance,q=M-o.lastCenterX,j=C-o.lastCenterY):o={mode:"pinch",lastCenterX:M,lastCenterY:C,lastDistance:R,startTime:Gi(),moved:!1},!(!o||o.mode!=="pinch")&&(o.lastCenterX=M,o.lastCenterY=C,o.lastDistance=R,o.moved=!0,a.onPinch({centerX:M,centerY:C,scale:N,deltaCenterX:q,deltaCenterY:j},E))},m=b=>{if(!o||b.touches.length===0)return;if(b.preventDefault(),b.touches.length===1){const M=b.touches[0];o.mode!=="pan"&&(o={mode:"pan",lastX:M.clientX,lastY:M.clientY,startX:M.clientX,startY:M.clientY,startTime:Gi(),moved:!0}),f(M,b);return}const[v,E]=[b.touches[0],b.touches[1]];h(v,E,b)},p=()=>!o||o.mode!=="pan"||Math.hypot(o.lastX-o.startX,o.lastY-o.startY)>s?!1:Gi()-o.startTime<=r,g=b=>{if(o){if(b.touches.length===0){o.mode==="pan"&&a.onTap&&p()&&a.onTap({x:o.startX,y:o.startY},b),o=null;return}if(b.touches.length===1){const v=b.touches[0];o={mode:"pan",lastX:v.clientX,lastY:v.clientY,startX:v.clientX,startY:v.clientY,startTime:Gi(),moved:!0};return}if(b.touches.length>=2){const[v,E]=[b.touches[0],b.touches[1]];o={mode:"pinch",lastCenterX:(v.clientX+E.clientX)/2,lastCenterY:(v.clientY+E.clientY)/2,lastDistance:Math.hypot(v.clientX-E.clientX,v.clientY-E.clientY),startTime:Gi(),moved:!0}}}};return n.addEventListener("touchstart",u,{passive:!1}),n.addEventListener("touchmove",m,{passive:!1}),n.addEventListener("touchend",g),n.addEventListener("touchcancel",g),()=>{n.removeEventListener("touchstart",u),n.removeEventListener("touchmove",m),n.removeEventListener("touchend",g),n.removeEventListener("touchcancel",g),o=null}}const l_=.5,o_=3.5;function kh(n,a,s,r,o){const u=n.getBoundingClientRect(),f=a-u.left,h=s-u.top,m=u.width/2,p=u.height/2;return{x:o.x+(f-m)/r,y:o.y+(h-p)/r}}function c_(n){return Math.min(o_,Math.max(l_,n))}function jv(n,a,s,r=Ee.zoom,o=Ee){return kh(n,a,s,r,o)}function Gv(n,a,s,r){const o=c_(r);if(o===Ee.zoom)return;const u={x:Ee.x,y:Ee.y},f=kh(n,a,s,Ee.zoom,u),h=kh(n,a,s,o,u);Ee.x+=f.x-h.x,Ee.y+=f.y-h.y,Ee.zoom=o,Ut()}function ah(n,a){n===0&&a===0||(Ee.x-=n/Ee.zoom,Ee.y-=a/Ee.zoom,Ut())}function u_(n){const a=window.devicePixelRatio||1,s=Math.max(window.innerWidth,1),r=Math.max(window.innerHeight,1);n.style.width=`${s}px`,n.style.height=`${r}px`,n.width=Math.round(s*a),n.height=Math.round(r*a);const o=n.getContext("2d");o&&o.setTransform(1,0,0,1,0,0),Ut()}const d_=.0015,Dh=[];let Sm=0,La=null,mu=Hv(null),kt=null,ih="classic",Lh=null;function f_(){if(typeof document>"u")return;const n=document.querySelector("[data-build-commit]");if(!n)return;const a="b6f8b59".trim(),s=a.length>0&&a!=="unknown",r=s?`#${a}`:"DEV BUILD";n.textContent=r,n.dataset.state=s?"commit":"dev";const o=n.closest("#build-id");if(o){const u=s?`Build commit ${a}`:"Development build";o.setAttribute("aria-label",u),o.title=s?`Autobattles build ${a}`:"Unversioned development build",o.dataset.buildState=s?"release":"development"}}f_();function Na(n){Dh.push(n)}function h_(){for(;Dh.length;){const n=Dh.pop();try{n?.()}catch(a){console.error("Error during cleanup",a)}}}function m_(n){Na(()=>n.dispose())}function wc(n,a){const s=mu.showBanner(n,a);s&&Na(()=>s.dismiss())}function p_(n){switch(n.type){case"status":if(n.phase==="start"){kt?.dispose();const a=mu.showLoader(n.message);kt=a,m_(a)}else kt&&(kt.update(n.message),kt.clear(),kt=null);break;case"ready":kt?.clear(),kt=null;break;case"warnings":n.warnings.length&&(console.warn("Resource loader warnings",n.warnings),wc("warning",{title:"Heads up",messages:n.warnings,autoCloseMs:12e3}));break;case"errors":n.errors.length&&(console.error("Resource loader errors",n.errors),wc("error",{title:"Some resources failed to load",messages:n.errors,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]}));break;case"fatal":console.error("Critical assets failed to load",n.messages),kt?.clear(),kt=null,wc("error",{title:"Unable to start the sauna battle",messages:n.messages,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}],dismissible:!1});break;case"failure":console.error("Failed to initialize resources",n.error),kt?.clear(),kt=null,wc("error",{title:"Failed to initialize",messages:[n.message],actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]});break;case"cancelled":kt?.dispose(),kt=null;break}}const Iv=t_({assetPaths:_C,loadAssets:WS,preloadSaunojaIcon:Zb,setAssets:RC,startGame:FT,shouldAbort:n=>n!==Sm});Iv.subscribe(p_);function L2(n){if(!La)return;n.preventDefault();const a=Math.exp(-n.deltaY*d_),s=Ee.zoom*a;Gv(La,n.clientX,n.clientY,s)}function U2(n){if(!La)return;const a=jv(La,n.clientX,n.clientY);qv(a)}function g_(n){n.addEventListener("click",U2),Na(()=>n.removeEventListener("click",U2)),n.addEventListener("wheel",L2,{passive:!1}),Na(()=>n.removeEventListener("wheel",L2));const a=a_(n,{onPan:(r,o)=>{ah(r,o)},dragCursor:"grabbing"});Na(a);const s=r_(n,{onPan:(r,o)=>{ah(r,o)},onPinch:({centerX:r,centerY:o,scale:u,deltaCenterX:f,deltaCenterY:h})=>{Gv(n,r,o,Ee.zoom*u),ah(f,h)},onTap:r=>{const o=jv(n,r.x,r.y);qv(o)}});Na(s)}function y_(){Sm+=1,h_(),Lh?.destroy(),Lh=null,kt?.dispose(),kt=null,La&&(La.style.cursor=""),La=null,mu.removeTransientUI(),Nh()}function b_(){const n=document.getElementById("game-canvas"),a=document.getElementById("resource-bar"),s=document.getElementById("ui-overlay");if(!n||!a||!s){console.error("Autobattles4xFinsauna shell is missing the required canvas, overlay, or resource bar elements.",{hasCanvas:!!n,hasResourceBar:!!a,hasOverlay:!!s});return}La&&y_();const r=++Sm;ih=lv().useUiV2?"v2":"classic",La=n,mu=Hv(s);const u=Sx();Na(()=>u.dispose()),MT(n,a,s,{hudVariant:ih}),ih==="v2"&&(Lh=QT({overlay:s,resourceBar:a})),g_(n);const f=()=>u_(n);window.addEventListener("resize",f),Na(()=>window.removeEventListener("resize",f)),window.addEventListener("beforeunload",Nh),Na(()=>window.removeEventListener("beforeunload",Nh)),f(),import.meta.vitest||Iv.run(r)}function v_(){if(typeof document>"u")return;const n=()=>{document.removeEventListener("DOMContentLoaded",n),b_()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",n);return}n()}import.meta.vitest||v_();
