(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function s(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=s(o);fetch(o.href,u)}})();class VS{listeners=new Map;on(a,s){const r=this.listeners.get(a)??[];r.push(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);if(!r)return;const o=r.indexOf(s);o!==-1&&(r.splice(o,1),r.length===0?this.listeners.delete(a):this.listeners.set(a,r))}emit(a,s){const r=this.listeners.get(a);if(r)for(const o of r)o(s)}}const te=new VS;class Lh{type="farm";cost=50;beerPerTick=1}class Uy{type="barracks";cost=100;trainingCapacity=1}const Oy=Math.sqrt(3),qy=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function aa(n,a){return{x:a*Oy*(n.q+n.r/2),y:a*(3/2)*n.r}}function El(n,a,s){const r=(Oy/3*n-.3333333333333333*a)/s,o=2/3*a/s;return{q:r,r:o}}function XS(n,a,s){return KS(El(n,a,s))}function Oc(n){return qy.map(a=>({q:n.q+a.q,r:n.r+a.r}))}function Zs(n,a){const s=-n.q-n.r,r=-a.q-a.r;return Math.max(Math.abs(n.q-a.q),Math.abs(n.r-a.r),Math.abs(s-r))}function KS(n){let a=n.q,s=n.r,r=-a-s,o=Math.round(a),u=Math.round(r),f=Math.round(s);const h=Math.abs(o-a),m=Math.abs(u-r),p=Math.abs(f-s);return h>m&&h>p?o=-u-f:m>p?u=-o-f:f=-o-u,{q:o,r:f}}const qc=new Set;let _c=32;function QS(n){return`${n.q},${n.r}`}function sh(n,a){_c=a,qc.add(QS(n))}function PS(n){if(qc.size===0)return{center:{x:0,y:0},zoom:1};const a=_c*Math.sqrt(3),s=_c*2,r=a/2,o=s/2;let u=1/0,f=1/0,h=-1/0,m=-1/0;for(const G of qc){const[F,P]=G.split(",").map(Number),{x:ie,y:se}=aa({q:F,r:P},_c),le=ie-r,ne=se-o;u=Math.min(u,le),f=Math.min(f,ne),h=Math.max(h,le+a),m=Math.max(m,ne+s)}const p=h-u,g=m-f,b=96,S={x:u+p/2,y:f+g/2},E=Math.max(0,Math.min(n.safeRight??0,n.width)),R=Math.max(n.width-E,1)/(p+b*2),_=n.height/(g+b*2),U=Math.min(R,_);return{center:{x:U>0?S.x-E/(2*U):S.x,y:S.y},zoom:U}}const xe={x:0,y:0,zoom:1};function ZS(n,a=300){const s=xe.x,r=xe.y,o=xe.zoom,u=typeof performance<"u"?performance.now():Date.now(),f=h=>{const m=Math.min((h-u)/a,1);xe.x=s+(n.center.x-s)*m,xe.y=r+(n.center.y-r)*m,xe.zoom=o+(n.zoom-o)*m,m<1&&(typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),16))};typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),0)}function JS(){qc.clear()}async function WS(n){const a={},s={},r=[],o=Object.entries(n.images??{}).map(([f,h])=>new Promise(m=>{const p=new Image;p.onload=()=>{a[f]=p,m()},p.onerror=()=>{const g=`Failed to load image: ${h}`;console.error(g),r.push(g),m()},p.src=h})),u=Object.entries(n.sounds??{}).map(([f,h])=>new Promise(m=>{const p=new Audio;p.oncanplaythrough=()=>{s[f]=p,m()},p.onerror=()=>{const g=`Failed to load sound: ${h}`;console.error(g),r.push(g),m()},p.src=h,p.load()}));return await Promise.all([...o,...u]),{assets:{images:a,sounds:s},failures:r}}function Uh(n){if(typeof globalThis.localStorage>"u")return;const a=globalThis.localStorage.getItem(n);if(a)try{return JSON.parse(a)}catch(s){console.warn(`Failed to parse data for "${n}", clearing`,s),globalThis.localStorage.removeItem(n);return}}var ae=(n=>(n.SAUNA_BEER="sauna-beer",n.SAUNAKUNNIA="saunakunnia",n.SISU="sisu",n))(ae||{});const sc={"sauna-beer":1,saunakunnia:0,sisu:0},zy="/assets/sauna-beer-CgafwOhX.svg",By="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eResource%20Icon%3c/title%3e%3cdesc%20id='desc'%3eA%20luminous%20crest%20symbolising%20generic%20resources.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='resource-bg'%20cx='50%25'%20cy='50%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='resource-core'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2338bdf8'%20/%3e%3c/linearGradient%3e%3cfilter%20id='resource-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='6'%20flood-color='%2338bdf8'%20flood-opacity='0.45'%20/%3e%3c/filter%3e%3c/defs%3e%3cg%20filter='url(%23resource-glow)'%3e%3ccircle%20cx='32'%20cy='32'%20r='22'%20fill='%230f172a'%20stroke='url(%23resource-bg)'%20stroke-width='4'%20/%3e%3cpath%20d='M32%2016l-12%2014%2012%2022%2012-22z'%20fill='url(%23resource-core)'%20stroke='%23f8fafc'%20stroke-width='2'%20/%3e%3cpath%20d='M20%2030l-4%208%2016%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M44%2030l4%208-16%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/g%3e%3c/svg%3e",Hy="/assets/saunoja-roster-Bfn4ZKxh.svg",It={APPLIED:"policy:applied",REJECTED:"policy:rejected"},jy=[{id:"eco",name:"Evergreen Eco Mandate",description:"Increase passive sauna beer brewing by one bottle each production tick.",cost:15,resource:ae.SAUNAKUNNIA,prerequisites:[],visuals:{icon:By,gradient:"linear-gradient(135deg, rgba(66, 240, 155, 0.9), rgba(13, 114, 234, 0.85))",accentColor:"#34d399",badges:["Economy","Sustainability"],flair:"Green-lit by the council of whisked sauna masters."},effects:[{event:It.APPLIED,once:!0,invoke:({state:n})=>{n.modifyPassiveGeneration(ae.SAUNA_BEER,1)}}],spotlight:"Sustainably expand your brewing line with solar-heated mash tuns."},{id:"temperance",name:"Aurora Temperance Treaty",description:"Boost night shift work speed by 5% once the eco initiative is live.",cost:25,resource:ae.SAUNAKUNNIA,prerequisites:[{description:"Enact the Evergreen Eco Mandate.",isSatisfied:n=>n.hasPolicy("eco")},{description:"Stockpile at least 30 Sauna Beer bottles to brief the midnight crews.",isSatisfied:n=>n.getResource(ae.SAUNA_BEER)>=30}],visuals:{icon:Hy,gradient:"linear-gradient(140deg, rgba(46, 51, 227, 0.9), rgba(118, 75, 162, 0.85))",accentColor:"#6366f1",badges:["Discipline","Night Ops"],flair:"Whispers of aurora spirits keep the crew laser-focused after dusk."},effects:[{event:It.APPLIED,once:!0,invoke:({state:n})=>{n.nightWorkSpeedMultiplier=Number((n.nightWorkSpeedMultiplier*1.05).toFixed(4))}}],spotlight:"Glow-lit helmets and synchronized chants keep the late shift on tempo."},{id:"steam-diplomats",name:"Steam Diplomats Accord",description:"Import two additional sauna beer bottles per tick via gilded trade routes.",cost:35,resource:ae.SAUNAKUNNIA,prerequisites:[{description:"Secure the Aurora Temperance Treaty for your envoys.",isSatisfied:n=>n.hasPolicy("temperance")},{description:"Hold a reserve of 50 Sauna Beer bottles to fund the embassy festivities.",isSatisfied:n=>n.getResource(ae.SAUNA_BEER)>=50}],visuals:{icon:zy,gradient:"linear-gradient(150deg, rgba(255, 173, 94, 0.92), rgba(255, 99, 71, 0.85))",accentColor:"#fb923c",badges:["Diplomacy","Logistics"],flair:"Silver samovars arrive with diplomatic steam-born delights."},effects:[{event:It.APPLIED,once:!0,invoke:({state:n})=>{n.modifyPassiveGeneration(ae.SAUNA_BEER,2)}}],spotlight:"Trade envoys pipe artisanal steam through every new supply line."}],Gy=new Map;for(const n of jy)Gy.set(n.id,n);function Iy(){return jy}function $g(n){return Gy.get(n)}const Yy="progression:ngPlusState",ql=5,Fy=1831565813,er=Object.freeze({aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1}),Rc=Object.freeze({runSeed:0,ngPlusLevel:0,unlockSlots:0,enemyTuning:er});function Sf(n,a,s,r){const o=Number(n);return Number.isFinite(o)?Math.min(s,Math.max(a,o)):r}function Oh(n){return{aggressionMultiplier:Sf(n?.aggressionMultiplier,.25,6,er.aggressionMultiplier),cadenceMultiplier:Sf(n?.cadenceMultiplier,.25,4,er.cadenceMultiplier),strengthMultiplier:Sf(n?.strengthMultiplier,.25,6,er.strengthMultiplier)}}function $y(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(n){return console.warn("Local storage unavailable for NG+ state",n),null}}function rh(n,a,s){const r=Number.isFinite(n)?n:Number(n);if(!Number.isFinite(r))return a;const o=Math.trunc(r);return Math.min(s,Math.max(a,o))}function Vy(n){const a=Number.isFinite(n)?n:Number(n);return!Number.isFinite(a)||a===0?0:Math.trunc(Math.abs(a))}function Xy(n=Math.random){let a=n();(!Number.isFinite(a)||a<=0||a>=1)&&(a=Math.random());const s=Math.floor(a*4294967295);return s===0?Fy:s}function Fa(n={}){const a=Rc,s=Vy(n.runSeed??a.runSeed),r=rh(n.ngPlusLevel??a.ngPlusLevel,0,Number.MAX_SAFE_INTEGER),o=rh(n.unlockSlots??a.unlockSlots,0,ql),u=Oh(n.enemyTuning??a.enemyTuning);return{runSeed:s,ngPlusLevel:r,unlockSlots:o,enemyTuning:u}}function Ha(n,a=Math.random){const s=Fa(n);return s.runSeed!==0?s:Fa({...s,runSeed:Xy(a)})}function e3(n=Math.random){const a=$y();if(!a)return Ha(Rc,n);const s=a.getItem(Yy);if(!s)return Ha(Rc,n);try{const r=JSON.parse(s);return Ha(Fa(r),n)}catch(r){return console.warn("Failed to parse NG+ state",r),Ha(Rc,n)}}function lh(n){const a=$y();if(!a)return;const s=Fa(n);a.setItem(Yy,JSON.stringify(s))}function t3(n,a){const s=Fa(n),r=typeof a.random=="function"?a.random:Math.random;let o=s.ngPlusLevel,u=s.unlockSlots;if(a.outcome==="win"){o+=1;const h=Math.max(0,Math.trunc(a.bonusUnlocks??1));h>0&&(u=Math.min(ql,u+h))}const f=Xy(r);return Ha(Fa({runSeed:f,ngPlusLevel:o,unlockSlots:u,enemyTuning:s.enemyTuning}),r)}function n3(n){const a=Math.max(0,n.ngPlusLevel),s=Math.max(0,n.unlockSlots)*.02;return Math.min(3,1+a*.12+s)}function a3(n){const a=Math.max(0,n.ngPlusLevel),s=Math.max(0,n.unlockSlots)*.01,r=.1+a*.05+s;return Math.max(0,Math.min(.85,r))}function i3(n){const a=Math.max(0,n.ngPlusLevel),s=Math.max(.5,1+a*.25),r=Oh(n.enemyTuning??er);return Math.max(.25,Math.min(8,s*r.aggressionMultiplier))}function s3(n){const s=1+rh(n.unlockSlots,0,ql);return Math.max(3,s)}function r3(n){return Oh(n.enemyTuning??er)}function Vg(n,a=0){let s=Vy(n)^(a|0);return s===0&&(s=Fy^(a|0)),()=>{s=s+1831565813|0;let r=Math.imul(s^s>>>15,1|s);return r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296}}function Ef(n){return`${n.q},${n.r}`}const Ky={farm:()=>new Lh,barracks:()=>new Uy};function l3(n){return Ky[n]?.()}const Xg=Object.freeze({aggression:1,cadence:1,strength:1});function tr(n,a,s,r){const o=Number(n);return Number.isFinite(o)?Math.min(s,Math.max(a,o)):r}function Kg(n,a){return{aggression:tr(a.aggression??n.aggression,.1,8,n.aggression),cadence:tr(a.cadence??n.cadence,.25,6,n.cadence),strength:tr(a.strength??n.strength,.25,12,n.strength)}}class o3{constructor(a,s="gameState"){this.tickInterval=a,this.storageKey=s}resources={[ae.SAUNA_BEER]:0,[ae.SAUNAKUNNIA]:0,[ae.SISU]:0};passiveGeneration={...sc};lastSaved=Date.now();buildings={};buildingPlacements=new Map;policies=new Set;nightWorkSpeedMultiplier=1;enemyScaling={...Xg};enemyCalmSecondsRemaining=0;ngPlus=Fa();tick(){Object.keys(this.passiveGeneration).forEach(a=>{this.addResource(a,this.passiveGeneration[a])})}save(){this.lastSaved=Date.now();const a={};this.buildingPlacements.forEach((o,u)=>{a[u]=o.type});const s={resources:this.resources,lastSaved:this.lastSaved,buildings:this.buildings,buildingPlacements:a,policies:Array.from(this.policies),passiveGeneration:{...this.passiveGeneration},nightWorkSpeedMultiplier:this.nightWorkSpeedMultiplier,enemyScaling:{...this.enemyScaling},ngPlus:this.ngPlus},r=typeof localStorage<"u"&&localStorage?localStorage:void 0;if(!r){console.warn("GameState.save: localStorage is unavailable, skipping persistence.");return}try{r.setItem(this.storageKey,JSON.stringify(s))}catch(o){console.warn("GameState.save: Failed to persist state to localStorage.",o)}}load(a){const s=Uh(this.storageKey);if(!s)return this.lastSaved=Date.now(),!1;this.resources={...this.resources,...s.resources??{}},Object.keys(this.resources).forEach(m=>{Number.isFinite(this.resources[m])||(this.resources[m]=0)}),this.enemyScaling=Kg(Xg,s.enemyScaling??{}),this.enemyCalmSecondsRemaining=0;const r={};Object.entries(s.buildings??{}).forEach(([m,p])=>{Ky[m]&&(r[m]=p)}),this.buildings=r,this.buildingPlacements.clear(),s.buildingPlacements&&Object.entries(s.buildingPlacements).forEach(([m,p])=>{const g=l3(p);if(!g)return;this.buildingPlacements.set(m,g);const[b,S]=m.split(",").map(Number);if(a){const E=a.ensureTile(b,S);E.placeBuilding(g.type),E.reveal(),sh({q:b,r:S},a.hexSize)}te.emit("buildingPlaced",{building:g,coord:{q:b,r:S},state:this})}),this.lastSaved=s.lastSaved??Date.now();const o=s.ngPlus?Fa(s.ngPlus):this.ngPlus;if(this.ngPlus=Ha(o),this.policies=new Set,this.passiveGeneration={...sc},this.nightWorkSpeedMultiplier=1,(Array.isArray(s.policies)?s.policies.filter(m=>typeof m=="string"):[]).forEach(m=>{const p=$g(m);p&&(this.policies.add(p.id),te.emit(It.APPLIED,{policy:p,state:this}))}),s.passiveGeneration){const m={...sc};Object.keys(sc).forEach(p=>{const g=s.passiveGeneration?.[p];typeof g=="number"&&Number.isFinite(g)&&(m[p]=g)}),this.passiveGeneration=m}typeof s.nightWorkSpeedMultiplier=="number"&&Number.isFinite(s.nightWorkSpeedMultiplier)&&(this.nightWorkSpeedMultiplier=s.nightWorkSpeedMultiplier);const f=Date.now()-this.lastSaved,h=Math.floor(f/this.tickInterval);return Object.keys(this.passiveGeneration).forEach(m=>{this.resources[m]+=h*this.passiveGeneration[m]}),!0}getResource(a){return this.resources[a]}canAfford(a,s=ae.SAUNA_BEER){return this.resources[s]>=a}spendResource(a,s=ae.SAUNA_BEER){return this.spend(a,s)}spend(a,s=ae.SAUNA_BEER){return this.canAfford(a,s)?(this.resources[s]-=a,te.emit("resourceChanged",{resource:s,amount:-a,total:this.resources[s]}),!0):!1}addResource(a,s){this.resources[a]+=s,te.emit("resourceChanged",{resource:a,amount:s,total:this.resources[a]})}modifyPassiveGeneration(a,s){this.passiveGeneration[a]=(this.passiveGeneration[a]??0)+s}setEnemyScalingBase(a){return this.enemyScaling=Kg(this.enemyScaling,a),{...this.enemyScaling}}applyEnemyScalingModifiers(a){const s={aggression:tr(this.enemyScaling.aggression*(a.aggression??1),.1,8,this.enemyScaling.aggression),cadence:tr(this.enemyScaling.cadence*(a.cadence??1),.25,6,this.enemyScaling.cadence),strength:tr(this.enemyScaling.strength*(a.strength??1),.25,12,this.enemyScaling.strength)};return this.enemyScaling=s,{...this.enemyScaling}}getEnemyScalingSnapshot(){return{...this.enemyScaling,calmSecondsRemaining:Math.max(0,this.enemyCalmSecondsRemaining)}}requestEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(this.enemyCalmSecondsRemaining,s),this.enemyCalmSecondsRemaining)}advanceEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(0,this.enemyCalmSecondsRemaining-s),this.enemyCalmSecondsRemaining)}clearEnemyCalm(){this.enemyCalmSecondsRemaining=0}construct(a,s,r=ae.SAUNA_BEER){return this.spend(s,r)?(this.buildings[a]=(this.buildings[a]??0)+1,!0):!1}placeBuilding(a,s,r,o=ae.SAUNA_BEER){const u=r.getTile(s.q,s.r);return!u||u.building||!this.construct(a.type,a.cost,o)?!1:(this.buildingPlacements.set(Ef(s),a),u.placeBuilding(a.type),te.emit("buildingPlaced",{building:a,coord:s,state:this}),!0)}getBuildingAt(a){return this.buildingPlacements.get(Ef(a))}removeBuilding(a,s){const r=Ef(a),o=this.buildingPlacements.get(r);return o?(this.buildingPlacements.delete(r),s.getTile(a.q,a.r)?.placeBuilding(null),this.buildings[o.type]!==void 0&&(this.buildings[o.type]-=1,this.buildings[o.type]<=0&&delete this.buildings[o.type]),te.emit("buildingRemoved",{building:o,coord:a,state:this}),!0):!1}upgrade(a,s,r=ae.SAUNA_BEER){return this.construct(`upgrade:${a}`,s,r)}applyPolicy(a){const s=$g(a);if(!s){const u={policyId:a,state:this,reason:"unknown-policy"};return te.emit(It.REJECTED,u),!1}if(this.hasPolicy(s.id)){const u={policyId:s.id,policy:s,state:this,reason:"already-applied"};return te.emit(It.REJECTED,u),!1}const r=s.prerequisites.filter(u=>!u.isSatisfied(this));if(r.length>0){const u={policyId:s.id,policy:s,state:this,reason:"prerequisites-not-met",missingPrerequisites:r};return te.emit(It.REJECTED,u),!1}if(!this.spend(s.cost,s.resource)){const u={policyId:s.id,policy:s,state:this,reason:"insufficient-resources"};return te.emit(It.REJECTED,u),!1}this.policies.add(s.id);const o={policy:s,state:this};return te.emit(It.APPLIED,o),!0}hasPolicy(a){return this.policies.has(a)}getNgPlusState(){return{...this.ngPlus}}setNgPlusState(a){const s=Fa({...this.ngPlus,...a});return this.ngPlus=Ha(s),this.ngPlus}}class c3{constructor(a,s){this.baseInterval=a,this.onTick=s}timer=null;speed=1;lastTick=0;accumulator=0;start(){this.stop(),this.lastTick=Date.now();const a=this.baseInterval/this.speed;this.timer=setInterval(()=>{const s=Date.now(),r=s-this.lastTick;this.lastTick=s,this.onTick(r)},a)}stop(){this.timer!==null&&(clearInterval(this.timer),this.timer=null)}setSpeed(a){if(a<=0)throw new Error("Speed multiplier must be positive");this.speed=a,this.timer!==null&&this.start()}getSpeed(){return this.speed}getBaseInterval(){return this.baseInterval}tick(a){for(this.accumulator+=a*this.speed;this.accumulator>=this.baseInterval;)this.accumulator-=this.baseInterval,this.onTick(this.baseInterval)}}var xn=(n=>(n[n.Plains=0]="Plains",n[n.Forest=1]="Forest",n[n.Hills=2]="Hills",n[n.Lake=3]="Lake",n))(xn||{});function u3(n,a,s){let r=n*374761393+a*668265263+s*0x14057b7ef7678100;return r=(r^r>>13)*1274126177,r^=r>>16,(r>>>0)/4294967295}function d3(n,a,s=0){const r=u3(n,a,s);return r<.1?3:r<.3?1:r<.5?2:0}class f3{_terrain;_building;_isFogged;listeners=new Set;constructor(a=xn.Plains,s=null,r=!0){this._terrain=a,this._building=s,this._isFogged=r}get terrain(){return this._terrain}set terrain(a){this._terrain!==a&&(this._terrain=a,this.notify("terrain"))}get building(){return this._building}set building(a){this._building!==a&&(this._building=a,this.notify("building"))}get isFogged(){return this._isFogged}set isFogged(a){this._isFogged!==a&&(this._isFogged=a,this.notify("fog"))}reveal(){this.isFogged=!1}placeBuilding(a){this.building=a}setFogged(a){this.isFogged=a}addMutationListener(a){return this.listeners.add(a),()=>this.listeners.delete(a)}notify(a){for(const s of this.listeners)s(a)}}class h3{constructor(a=10,s=10,r=32,o=0){this.hexSize=r,this.seed=o,this.minQ=0,this.minR=0,this.maxQ=a-1,this.maxR=s-1}tiles=new Map;tileSubscriptions=new Map;changeListeners=new Set;minQ;maxQ;minR;maxR;get width(){return this.maxQ-this.minQ+1}get height(){return this.maxR-this.minR+1}key(a,s){return`${a},${s}`}addTileChangeListener(a){return this.changeListeners.add(a),()=>this.changeListeners.delete(a)}notifyTileChange(a,s,r){for(const o of this.changeListeners)o(a,s,r)}attachTileListener(a,s,r){const o=s.addMutationListener(u=>{this.notifyTileChange(r,s,u)});this.tileSubscriptions.set(a,o)}ensureTile(a,s){const r=this.key(a,s);let o=this.tiles.get(r);return o||(o=new f3(d3(a,s,this.seed)),this.tiles.set(r,o),this.minQ=Math.min(this.minQ,a),this.maxQ=Math.max(this.maxQ,a),this.minR=Math.min(this.minR,s),this.maxR=Math.max(this.maxR,s),this.attachTileListener(r,o,{q:a,r:s}),this.notifyTileChange({q:a,r:s},o,"created"),o.isFogged||sh({q:a,r:s},this.hexSize)),o}getTile(a,s){return this.tiles.get(this.key(a,s))}forEachTile(a){for(const[s,r]of this.tiles){const[o,u]=s.split(",").map(Number);a(r,{q:o,r:u})}}getNeighbors(a,s){return Oc({q:a,r:s}).map(r=>this.ensureTile(r.q,r.r))}revealAround(a,s,r={}){const{autoFrame:o=!0}=r;for(let h=-s;h<=s;h++){const m=Math.max(-s,-h-s),p=Math.min(s,-h+s);for(let g=m;g<=p;g++){const b={q:a.q+h,r:a.r+g};this.ensureTile(b.q,b.r).reveal(),sh(b,this.hexSize)}}if(!o)return;const u=typeof window<"u"?(()=>{const h=Math.max(window.innerWidth,0),m=Math.max(window.innerHeight,0);let p=0;if(typeof document<"u"){const b=document.getElementById("right-panel");if(b){const S=b.getBoundingClientRect();if(S.width>0){const E=b.closest("#ui-overlay");if(E){const w=E.getBoundingClientRect(),R=window.getComputedStyle(E),_=Number.parseFloat(R.paddingRight||"0"),U=w.right-S.left,B=S.width+(Number.isFinite(_)?_:0);p=Math.max(0,Math.max(U,B))}else p=Math.max(0,S.width)}}}const g=Math.min(Math.max(p,0),h);return{width:h,height:m,safeRight:g}})():{width:0,height:0,safeRight:0},f=PS(u);ZS(f,300)}}const zc={TRIGGERED:"scheduler:eventTriggered",RESOLVED:"scheduler:eventResolved"},m3=new Map;function p3(){return globalThis.localStorage??null}function ol(n){return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}function Qy(n){const a=globalThis.crypto;return a?.randomUUID?a.randomUUID():`${n}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function g3(n){const a={id:String(n.id??""),label:String(n.label??""),description:n.description?String(n.description):void 0,event:n.event?String(n.event):void 0,payload:n.payload,accent:n.accent??void 0};return a.id||(a.id=Qy("choice")),a.label||(a.label="Choose"),a}function Bc(n){const a={id:String(n.id??""),headline:String(n.headline??""),body:String(n.body??""),art:n.art?String(n.art):void 0,typography:n.typography,animation:n.animation,accentColor:n.accentColor?String(n.accentColor):void 0,acknowledgeText:n.acknowledgeText?String(n.acknowledgeText):void 0,choices:Array.isArray(n.choices)?n.choices.map(s=>g3(s)):void 0};return a.id||(a.id=Qy("event")),a}function y3(n){return{content:Bc(n.content),trigger:n.trigger.type==="time"?{type:"time",at:Number.isFinite(n.trigger.at)?n.trigger.at:0}:{type:"condition",conditionId:String(n.trigger.conditionId),params:n.trigger.params}}}function Qg(n){return{content:Bc(n.content),triggeredAt:Number.isFinite(n.triggeredAt)?n.triggeredAt:0}}const Mf=Object.freeze({clock:0,queue:[],active:[]});class b3{storageKey;eventBus;getStorage;state=ol(Mf);subscribers=new Set;constructor(a={}){this.storageKey=a.storageKey??"autobattles:event-scheduler",this.eventBus=a.eventBus??te,this.getStorage=a.storageProvider??p3,this.load()}subscribe(a){return this.subscribers.add(a),a(this.getActiveEvents()),()=>{this.subscribers.delete(a)}}getActiveEvents(){return this.state.active.map(a=>({...ol(a.content),triggeredAt:a.triggeredAt}))}schedule(a){const s=Bc(a.content);if(!s.headline||!s.body||this.containsEvent(s.id))return!1;const r=a.trigger.type==="condition"?{type:"condition",conditionId:String(a.trigger.conditionId),params:a.trigger.params}:{type:"time",at:this.resolveTriggerTime(a.trigger)};return this.state.queue.push({content:s,trigger:r}),this.sortQueue(),this.save(),!0}publish(a){const s=Bc(a);this.containsEvent(s.id)||(this.state.queue=this.state.queue.filter(r=>r.content.id!==s.id),this.activateEvent({content:s,triggeredAt:this.state.clock}))}tick(a,s={}){if(!Number.isFinite(a)||a<=0)return;this.state.clock+=a;const r=[],o=[];for(const u of this.state.queue)this.shouldTrigger(u.trigger,s)?r.push(u):o.push(u);this.state.queue=o;for(const u of r)this.activateEvent({content:u.content,triggeredAt:this.state.clock});this.save()}resolve(a,s){const r=this.state.active.findIndex(h=>h.content.id===a);if(r===-1)return!1;const o=this.state.active[r],u=this.pickChoice(o.content,s),f=u?u.id:null;return this.state.active.splice(r,1),this.save(),this.notify(),this.eventBus.emit(zc.RESOLVED,{eventId:a,choiceId:f,event:o.content}),u?.event&&this.eventBus.emit(u.event,{eventId:a,choiceId:f,payload:u.payload,event:o.content}),!0}reset(){this.state=ol(Mf),this.save(),this.notify()}activateEvent(a){const s=Qg(a);this.state.active.push(s),this.save(),this.notify(),this.eventBus.emit(zc.TRIGGERED,{event:{...ol(s.content),triggeredAt:s.triggeredAt}})}pickChoice(a,s){const r=a.choices??[];if(r.length!==0){if(s){const o=r.find(u=>u.id===s);if(o)return o}return r[0]}}shouldTrigger(a,s){if(a.type==="time")return this.state.clock>=a.at;const r=m3.get(a.conditionId);if(!r)return!1;try{return!!r(a.params,s)}catch(o){return console.warn("Scheduler condition evaluation failed",a.conditionId,o),!1}}resolveTriggerTime(a){if(Number.isFinite(a.at))return Number(a.at);const s=Number.isFinite(a.in)?Number(a.in):0;return Math.max(0,this.state.clock+s)}sortQueue(){this.state.queue.sort((a,s)=>{const r=a.trigger.type==="time"?a.trigger.at:Number.POSITIVE_INFINITY,o=s.trigger.type==="time"?s.trigger.at:Number.POSITIVE_INFINITY;return r-o})}containsEvent(a){return this.state.active.some(s=>s.content.id===a)||this.state.queue.some(s=>s.content.id===a)}notify(){const a=this.getActiveEvents();for(const s of this.subscribers)try{s(a)}catch(r){console.warn("Scheduler subscriber failed",r)}}load(){const a=Uh(this.storageKey);if(!a){this.state=ol(Mf);return}const s=Number(a.clock);this.state={clock:Number.isFinite(s)?s:0,queue:Array.isArray(a.queue)?a.queue.map(r=>y3(r)):[],active:Array.isArray(a.active)?a.active.map(r=>Qg(r)):[]}}save(){const a=this.getStorage();if(a)try{a.setItem(this.storageKey,JSON.stringify({clock:this.state.clock,queue:this.state.queue,active:this.state.active}))}catch(s){console.warn("Scheduler persistence failed",s)}}}const Nc=new b3;function v3(n,a){const s=new WeakSet,r=o=>{o.policy.id===n.id&&(a.once!==!1&&s.has(o.state)||(a.invoke(o),a.once!==!1&&s.add(o.state)))};te.on(a.event,r)}for(const n of Iy())for(const a of n.effects)v3(n,a);const S3="modulepreload",E3=function(n){return"/"+n},Pg={},M3=function(a,s,r){let o=Promise.resolve();if(s&&s.length>0){let m=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),h=f?.nonce||f?.getAttribute("nonce");o=m(s.map(p=>{if(p=E3(p),p in Pg)return;Pg[p]=!0;const g=p.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const S=document.createElement("link");if(S.rel=g?"stylesheet":S3,g||(S.as="script"),S.crossOrigin="",S.href=p,h&&S.setAttribute("nonce",h),document.head.appendChild(S),g)return new Promise((E,w)=>{S.addEventListener("load",E),S.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${p}`)))})}))}function u(f){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=f,window.dispatchEvent(h),!h.defaultPrevented)throw f}return o.then(f=>{for(const h of f||[])h.status==="rejected"&&u(h.reason);return a().catch(u)})},x3=({building:n,coord:a,state:s})=>{n instanceof Lh?s.modifyPassiveGeneration(ae.SAUNA_BEER,n.beerPerTick):n instanceof Uy&&M3(async()=>{const{spawnUnit:r}=await Promise.resolve().then(()=>zE);return{spawnUnit:r}},void 0).then(({spawnUnit:r})=>{r(s,"soldier",`barracks-${a.q}-${a.r}`,a,"player")})},w3=({building:n,state:a})=>{n instanceof Lh&&a.modifyPassiveGeneration(ae.SAUNA_BEER,-n.beerPerTick)};te.on("buildingPlaced",x3);te.on("buildingRemoved",w3);const jn={master:{defaultVolume:.9,volumeKey:"audio.mixer.master.volume",muteKey:"audio.mixer.master.muted"},music:{defaultVolume:.65,volumeKey:"audio.mixer.music.volume",muteKey:"audio.mixer.music.muted"},sfx:{defaultVolume:1,volumeKey:"audio.mixer.sfx.volume",muteKey:"audio.mixer.sfx.muted"}},Pe={master:{volume:jn.master.defaultVolume,muted:!1},music:{volume:jn.music.defaultVolume,muted:!1},sfx:{volume:jn.sfx.defaultVolume,muted:!1}},Jn={};let On=null,oh=!1;const ch=new Set;function qh(n,a){return Number.isFinite(n)?n<=0?0:n>=1?1:n:a}function iu(){if(typeof localStorage>"u")return null;try{return localStorage}catch(n){return console.warn("Audio mixer storage unavailable",n),null}}function A3(n){const a=iu();if(!a)return null;try{const s=a.getItem(jn[n].volumeKey);if(s===null)return null;const r=Number.parseFloat(s);return Number.isFinite(r)?qh(r,jn[n].defaultVolume):null}catch(s){return console.warn("Failed to restore volume setting",n,s),null}}function C3(n){const a=iu();if(!a)return null;try{const s=a.getItem(jn[n].muteKey);return s===null?null:s==="true"}catch(s){return console.warn("Failed to restore mute setting",n,s),null}}for(const n of Object.keys(jn)){const a=A3(n),s=C3(n);a!==null&&(Pe[n].volume=qh(a,jn[n].defaultVolume)),s!==null&&(Pe[n].muted=s)}function T3(n){const a=iu();if(a)try{a.setItem(jn[n].volumeKey,Pe[n].volume.toFixed(3))}catch(s){console.warn("Failed to persist volume setting",n,s)}}function _3(n){const a=iu();if(a)try{a.setItem(jn[n].muteKey,Pe[n].muted?"true":"false")}catch(s){console.warn("Failed to persist mute setting",n,s)}}function Zg(){if(typeof window>"u"||!On||oh)return;const n=()=>{On?.resume().catch(()=>{})};window.addEventListener("pointerdown",n,{once:!0}),window.addEventListener("keydown",n,{once:!0}),oh=!0}function zh(n){const a=Jn[n];if(!a)return;const{volume:s,muted:r}=Pe[n],o=r?0:s;a.gain.value=o}function Py(n){if(!Jn.master){const a=n.createGain();a.gain.value=Pe.master.muted?0:Pe.master.volume,a.connect(n.destination),Jn.master=a}if(!Jn.music){const a=n.createGain();a.gain.value=Pe.music.muted?0:Pe.music.volume,a.connect(Jn.master),Jn.music=a}if(!Jn.sfx){const a=n.createGain();a.gain.value=Pe.sfx.muted?0:Pe.sfx.volume,a.connect(Jn.master),Jn.sfx=a}}function Bh(){if(On||typeof window>"u")return On;const n=window.AudioContext||window.webkitAudioContext;if(!n)return console.warn("Web Audio API not supported"),null;try{On=new n,Py(On),Zg()}catch(a){return console.warn("Unable to create AudioContext",a),On=null,null}return On.state==="suspended"&&(oh=!1,Zg()),On}function R3(){return On??Bh()}function xf(n){const a=Pe.master;if(n==="master")return a.muted?0:a.volume;const s=Pe[n];return s.muted||a.muted?0:s.volume*a.volume}function Hh(n){const a=R3();if(!a)return null;Py(a);const s=Jn[n];return s?(zh(n),s):null}function su(){return{channels:{master:{volume:Pe.master.volume,muted:Pe.master.muted,effectiveVolume:xf("master")},music:{volume:Pe.music.volume,muted:Pe.music.muted,effectiveVolume:xf("music")},sfx:{volume:Pe.sfx.volume,muted:Pe.sfx.muted,effectiveVolume:xf("sfx")}},contextState:On?.state??"uninitialized"}}function Zy(){const n=su();for(const a of ch)a(n)}function jh(n){return ch.add(n),()=>{ch.delete(n)}}function Gh(n,a){const s=qh(a,jn[n].defaultVolume);Pe[n].volume!==s&&(Pe[n].volume=s,T3(n),zh(n),Zy())}function Ih(n,a){Pe[n].muted!==a&&(Pe[n].muted=a,_3(n),zh(n),Zy())}function N3(n){Gh("master",n)}function k3(n){Gh("music",n)}function D3(n){Gh("sfx",n)}function L3(n){Ih("master",n)}function U3(n){Ih("music",n)}function O3(n){Ih("sfx",n)}function Hc(n){return su().channels[n]}const q3=48e3;function z3(n){let a=n>>>0;return()=>{a+=1831565813;let s=a;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}}function B3(n,a,s){const{attack:r,decay:o,sustain:u,release:f,sustainLevel:h}=n;if(r>0&&s<r)return s/r;if(o>0&&s<r+o){const m=(s-r)/o;return 1-(1-h)*m}if(s<a-f)return h;if(f>0&&s<a){const m=(s-(a-f))/f;return h*(1-m)}return 0}function H3(n,a,s){const r=n.phase??0,o=n.vibrato,u=n.tremolo,f=o?1+o.depth*Math.sin(2*Math.PI*o.speed*s):1,h=u?n.gain*(1-u.depth+u.depth*Math.sin(2*Math.PI*u.speed*s)):n.gain,m=a*n.ratio*f;return h*Math.sin(2*Math.PI*m*s+r)}function j3(n,a){return n.gain*(a()*2-1)}function G3(n,a=q3){const s=Math.max(1,Math.floor(n.duration*a)),r=new Float32Array(s),o=z3(n.seed);for(let u=0;u<s;u++){const f=u/a;let h=0;for(const p of n.layers)p.type==="sine"?h+=H3(p,n.baseFrequency,f):h+=j3(p,o);const m=B3(n.envelope,n.duration,f);r[u]=h*m}return r}const wf={attack:{variants:[{id:"attack-a",label:"Gentle Birch Strike",description:"Soft mallet transient with subtle shimmer.",duration:.9,baseFrequency:220,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:421,loudness:{lufs:-13.839,peakDb:-2.134,gain:.7797}},{id:"attack-b",label:"Rounded Pluck Echo",description:"A slightly brighter chime tuned above the root.",duration:.9,baseFrequency:232,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:947,loudness:{lufs:-13.839,peakDb:-2.101,gain:.7797}},{id:"attack-c",label:"High Drift Pluck",description:"Upper register tap with airy decay.",duration:.9,baseFrequency:244,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:1337,loudness:{lufs:-13.838,peakDb:-2.076,gain:.7796}}]},death:{variants:[{id:"death-a",label:"Hollow Exhale",description:"Low cedar drum pulse with airy noise tail.",duration:1.15,baseFrequency:150,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:615,loudness:{lufs:-12.772,peakDb:-.218,gain:.6896}},{id:"death-b",label:"Soft Ember Fall",description:"Mid register thump with drifting undertone.",duration:1.15,baseFrequency:168,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:274,loudness:{lufs:-12.792,peakDb:-.185,gain:.6912}},{id:"death-c",label:"Warm Resolve",description:"Higher pitch breathy release with gentle rumble.",duration:1.15,baseFrequency:184,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:978,loudness:{lufs:-12.777,peakDb:-.16,gain:.69}}]},sisu:{variants:[{id:"sisu-a",label:"Rising Steam",description:"Slow bloom of airy sine pads with hushed texture.",duration:1.9,baseFrequency:176,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1204,loudness:{lufs:-12.561,peakDb:-.501,gain:.673}},{id:"sisu-b",label:"Glowing Drift",description:"Warmer harmonic swell with chorus shimmer.",duration:1.9,baseFrequency:188,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1642,loudness:{lufs:-12.566,peakDb:-.271,gain:.6734}},{id:"sisu-c",label:"Morning Brilliance",description:"Bright tonic swell with shimmering overtones.",duration:1.9,baseFrequency:200,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:2019,loudness:{lufs:-12.575,peakDb:-.235,gain:.6742}}]}};function Af(n){return{id:n.id,label:n.label,envelope:n.envelope,gain:n.loudness.gain,loader:a=>{const s=G3(n,a.sampleRate),r=a.createBuffer(1,s.length,a.sampleRate);return r.getChannelData(0).set(s),r}}}const I3={click:{variants:[{id:"ui-click-soft",label:"UI soft tap",envelope:{attack:0,decay:.05,sustain:0,release:.03,sustainLevel:0},loader:n=>F3(n)}],debounce:{windowMs:35,weight:.5,maxWeight:1.5},polyphony:6},spawn:{variants:[{id:"ui-spawn-chime",label:"Roster invite tone",envelope:{attack:0,decay:.2,sustain:.5,release:.2,sustainLevel:.5},loader:n=>$3(n)}],debounce:{windowMs:150,weight:.7,maxWeight:1.4},polyphony:3},error:{variants:[{id:"ui-error-tone",label:"Gentle warning tap",envelope:{attack:.01,decay:.2,sustain:.2,release:.2,sustainLevel:.2},loader:n=>V3(n)}],debounce:{windowMs:220,weight:1,maxWeight:1},polyphony:2},attack:{variants:wf.attack.variants.map(Af),debounce:{windowMs:120,weight:.6,maxWeight:1.2},polyphony:3},death:{variants:wf.death.variants.map(Af),debounce:{windowMs:360,weight:1,maxWeight:1.5},polyphony:3},sisu:{variants:wf.sisu.variants.map(Af),debounce:{windowMs:900,weight:1,maxWeight:1},polyphony:1}};let rc=null;const Jg=new Map,lc=new Map,jc=new Map,nr=new Map,Ml=new Map,Wg=new Map,Gt={node:null,destination:null,envelope:0,lastUpdate:0},cl={attackSeconds:.04,releaseSeconds:.6,depth:.55,floor:.25},uh=new Set;function Yh(){const n=Hc("master"),a=Hc("sfx");return n.muted||a.muted}function Y3(){const n=Yh();for(const a of uh)a(n)}function Fh(n,a,s){const r=Math.floor(n.sampleRate*a),o=n.createBuffer(1,r,n.sampleRate),u=o.getChannelData(0);for(let f=0;f<r;f++){const h=f/n.sampleRate;u[f]=s(h)}return o}function F3(n){return Fh(n,.05,a=>Math.sin(2*Math.PI*1e3*a)*Math.exp(-40*a))}function $3(n){return Fh(n,.2,a=>(Math.sin(2*Math.PI*440*a)+Math.sin(2*Math.PI*660*a))*.5*Math.exp(-6*a))}function V3(n){return Fh(n,.3,a=>Math.sin(2*Math.PI*110*a)*Math.exp(-8*a))}function e2(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function X3(n,a){return`${n}:${a}`}function K3(n,a,s){const r=X3(n,a),o=Jg.get(r);if(o)return Promise.resolve(o);const u=lc.get(r);if(u)return u;const f=$h();if(!f)return Promise.reject(new Error("Audio context unavailable"));const h=Promise.resolve(s.loader(f)).then(m=>(Jg.set(r,m),lc.delete(r),m)).catch(m=>{throw lc.delete(r),m});return lc.set(r,h),h}function t2(n){const a=n.polyphony;return!Number.isFinite(a)||!a||a<=0?Number.POSITIVE_INFINITY:a}function Q3(n,a){const s=jc.get(n);if(!s||s.length===0)return[];const r=[];for(const o of s)o.time>=a&&r.push(o);return jc.set(n,r),r}function P3(n,a,s){const r=a.debounce;if(!r)return{blocked:!1,weight:0};const o=r.weight??1,u=r.windowMs,f=s-u,h=Q3(n,f);let m=0;for(const p of h)m+=p.weight;return m+o>r.maxWeight?{blocked:!0}:{blocked:!1,weight:o}}function Z3(n,a,s){if(s<=0)return;const r=jc.get(n)??[];r.push({time:a,weight:s}),jc.set(n,r)}function J3(n){const a=(nr.get(n)??0)+1;nr.set(n,a)}function W3(n){const a=nr.get(n)??0;if(a<=1){nr.delete(n);return}nr.set(n,a-1)}function n2(n,a){if(!Number.isFinite(a))return!1;const s=Ml.get(n)?.size??0,r=nr.get(n)??0;return s+r>=a}function eE(n,a){let s=Ml.get(n);s||(s=new Set,Ml.set(n,s)),s.add(a);let r=!1;const o=()=>{if(r)return;r=!0;const u=Ml.get(n);u?.delete(a),u&&u.size===0&&Ml.delete(n)};if(typeof a.addEventListener=="function")a.addEventListener("ended",()=>{o()},{once:!0});else{const u=a.onended;a.onended=()=>{try{u?.call(a)}finally{o()}}}return o}function tE(n,a){const s=Gt.node;if(!s||s.context!==n){Gt.node?.disconnect();const r=n.createGain();return r.gain.value=1,r.connect(a),Gt.node=r,Gt.destination=a,Gt.envelope=0,Gt.lastUpdate=n.currentTime,r}return Gt.destination!==a&&(s.disconnect(),s.connect(a),Gt.destination=a),s}function nE(n){const a=Gt.node;if(!a)return;const s=n.currentTime,r=.6,o=.55,u=Math.max(0,s-Gt.lastUpdate),f=Math.exp(-u/r);Gt.envelope*=f,Gt.envelope=Math.min(1,Gt.envelope+o),Gt.lastUpdate=s;const p=Math.max(.35,1-Gt.envelope*.5),g=.02;a.gain.cancelScheduledValues(s),a.gain.setValueAtTime(a.gain.value,s),a.gain.linearRampToValueAtTime(p,s+g),a.gain.setTargetAtTime(1,s+g,r)}function aE(n){const a=Hh("music");if(!a)return;const s=Hc("master"),r=Hc("music");if(s.muted||r.muted)return;const o=r.volume;if(o<=0)return;const u=n.currentTime,f=a.gain.value,h=o*(1-cl.depth),m=o*cl.floor,p=Math.min(f,Math.max(h,m));a.gain.cancelScheduledValues(u),a.gain.setValueAtTime(f,u),a.gain.linearRampToValueAtTime(p,u+cl.attackSeconds),a.gain.setTargetAtTime(o,u+cl.attackSeconds,cl.releaseSeconds)}function ia(n){if(dh())return;const a=I3[n];if(!a)return;const s=a.variants;if(!s||s.length===0)return;let r=0,o=s[0];s.length>1&&(r=((Wg.get(n)??Math.floor(Math.random()*s.length)-1)+1)%s.length,o=s[r],Wg.set(n,r));const u=e2(),f=P3(n,a,u);if(f.blocked)return;const h=t2(a);if(n2(n,h))return;J3(n);let m=!1;const p=()=>{m||(W3(n),m=!0)};K3(n,r,o).then(g=>{if(p(),dh())return;const b=$h();if(!b)return;const S=Hh("sfx");if(!S)return;const E=t2(a);if(n2(n,E))return;const w=b.createBufferSource();w.buffer=g;const R=o.gain;let _=w;if(typeof R=="number"&&R>0&&R!==1){const G=b.createGain();G.gain.value=R,w.connect(G),_=G}const U=n==="attack"?tE(b,S):S;_.connect(U);const B=eE(n,w);try{w.start(),n==="attack"&&nE(b),n==="sisu"&&aE(b);const G=e2();!f.blocked&&f.weight>0&&Z3(n,G,f.weight)}catch(G){console.warn("Unable to start sound",G),B()}}).catch(g=>{p(),!(g instanceof Error&&g.message==="Audio context unavailable")&&console.warn("Failed to play sound",n,g)}).finally(()=>{p()})}function dh(){return Yh()}function iE(n){return uh.add(n),()=>{uh.delete(n)}}typeof document<"u"&&document.addEventListener("click",n=>{n.target instanceof HTMLButtonElement&&ia("click")});let a2=Yh();jh(n=>{const a=n.channels.master.muted||n.channels.sfx.muted;a!==a2&&(a2=a,Y3())});function $h(){return rc||(rc=Bh(),rc)}$h();const i2="__autobattlesAudioEvents__",s2=globalThis;s2[i2]||(te.on("unitDamaged",n=>{!n||n.amount<=0||ia("attack")}),te.on("unitDied",()=>{ia("death")}),te.on("sisuBurstStart",()=>{ia("sisu")}),s2[i2]=!0);function sE(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function rE(n){const a={};if(!n)return a;for(const[s,r]of Object.entries(n))typeof r=="function"&&(a[s]=r);return a}class lE{constructor(a=te){this.emitter=a}modifiers=new Map;hookIndex=new Map;listeners=new Map;add(a){if(typeof a.id!="string"||a.id.length===0)throw new Error("Modifier id must be a non-empty string");if((typeof a.duration!="number"||!Number.isFinite(a.duration))&&a.duration!==1/0)throw new Error("Modifier duration must be a positive number or Infinity");if(Number.isFinite(a.duration)&&a.duration<=0)throw new Error("Modifier duration must be greater than zero");const s=rE(a.hooks),r=sE();this.modifiers.has(a.id)&&this.remove(a.id,"replaced");const o={...a,hooks:s,remaining:a.duration,appliedAt:r};this.modifiers.set(o.id,o),this.indexHooks(o);const u={runtime:this,modifier:o};return a.onApply?.(u),this.emit("modifierAdded",{modifier:o}),this.emitter?.emit("modifierAdded",{modifier:o}),Number.isFinite(o.remaining)&&o.remaining<=0&&this.remove(o.id,"expired"),o}has(a){return this.modifiers.has(a)}list(){return Array.from(this.modifiers.values()).map(a=>({...a,hooks:{...a.hooks}}))}remove(a,s="manual"){const r=this.modifiers.get(a);if(!r)return!1;this.modifiers.delete(a),this.unindexHooks(r);const o={runtime:this,modifier:r,reason:s};return r.onExpire?.(o),s==="expired"&&(this.emit("modifierExpired",{modifier:r}),this.emitter?.emit("modifierExpired",{modifier:r})),this.emit("modifierRemoved",{modifier:r,reason:s}),this.emitter?.emit("modifierRemoved",{modifier:r,reason:s}),!0}advance(a){if(typeof a!="number"||a<=0)return;const s=[];for(const r of this.modifiers.values())Number.isFinite(r.remaining)&&(r.remaining=Math.max(0,r.remaining-a),r.remaining<=0&&s.push(r.id));for(const r of s)this.remove(r,"expired")}trigger(a,s){const r=this.hookIndex.get(a);if(!r||r.size===0)return;const o=Array.from(r);for(const u of o){const f=this.modifiers.get(u);if(!f){r.delete(u);continue}const h=f.hooks[a];if(!h){r.delete(u);continue}h(s,{runtime:this,modifier:f})}}clear(){const a=Array.from(this.modifiers.keys());for(const s of a)this.remove(s,"manual")}on(a,s){const r=this.listeners.get(a)??new Set;r.add(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);r&&(r.delete(s),r.size===0&&this.listeners.delete(a))}emit(a,s){const r=this.listeners.get(a);if(!(!r||r.size===0))for(const o of Array.from(r))o(s)}indexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s)??new Set;r.add(a.id),this.hookIndex.set(s,r)}}unindexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s);r&&(r.delete(a.id),r.size===0&&this.hookIndex.delete(s))}}}const ru=new lE,oE=n=>ru.add(n),cE=(n,a="manual")=>ru.remove(n,a),uE=n=>{ru.advance(n)},oc=(n,a)=>{ru.trigger(n,a)};class dE{constructor(a,s,r){this.owner=a,this.entries=s,this.log=r}runTick(a,s){for(const{definition:r,state:o}of this.entries){if(!r.onTick)continue;const u=r.onTick({owner:this.owner,state:o,self:a,opponent:s}),f=Wi(u?.shieldDamage??0);if(f>0){const m=Math.min(a.shield,f);m>0&&(a.shield-=m,this.log.tickShieldDamage+=m)}const h=Wi(u?.hpDamage??0);if(h>0){const m=Math.min(a.health,h);m>0&&(a.health-=m,this.log.tickHpDamage+=m)}}}grantShield(a,s){let r=0;for(const{definition:o,state:u}of this.entries){if(!o.onGrantShield)continue;const f=Wi(o.onGrantShield({owner:this.owner,state:u,self:a,opponent:s})??0);f>0&&(r+=f)}return r>0&&(a.shield+=r,this.log.shieldGranted+=r),r}consumeShield(a,s,r){let o=Wi(a);if(o<=0)return 0;let u=0;for(const{definition:f,state:h}of this.entries){if(!f.onConsumeShield||o<=0)continue;const m=Wi(f.onConsumeShield({owner:this.owner,state:h,self:s,opponent:r,amount:o})??0);if(m<=0)continue;const p=Math.min(o,m);u+=p,o-=p}return u>0&&(this.log.shieldConsumed+=u),u}applyHit(a,s,r){if(a<=0)return 0;let o=0;for(const{definition:h,state:m}of this.entries){if(!h.onHit)continue;const p=Wi(h.onHit({owner:this.owner,state:m,self:s,opponent:r,hpDamage:a})??0);p>0&&(o+=p)}if(o<=0)return 0;const u=Math.max(0,s.maxHealth-s.health);if(u<=0)return 0;const f=Math.min(u,o);return f>0&&(s.health+=f,this.log.lifesteal+=f),f}getShieldValue(){let a=0;for(const{definition:s,state:r}of this.entries){if(!s.onGrantShield||r.keyword!=="Shield")continue;const o=fh(r);if(o<=0)continue;const u=Math.max(0,Number.isFinite(r.stacks)?r.stacks:0);u<=0||(a+=u*o)}return a}}function fE(){return{attacker:l2(),defender:l2()}}function r2(n,a,s){const r=hE(n);if(r.length===0)return null;const o=[];for(const u of r){const f=Jy.get(u.keyword);f&&o.push({state:u,definition:f})}return o.length===0?null:new dE(a,o,s)}const Jy=new Map;function lu(n,a){Jy.set(n,a)}function l2(){return{tickHpDamage:0,tickShieldDamage:0,shieldGranted:0,shieldConsumed:0,lifesteal:0,keywordShieldRemaining:0}}function Wi(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function cr(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function zl(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function hE(n){if(!n)return[];const a=[],s=n;if(typeof s[Symbol.iterator]=="function"){for(const r of s){const o=o2(r);o&&a.push(o)}return a}if(typeof n=="object")for(const r of Object.values(n)){const o=o2(r);o&&a.push(o)}return a}function o2(n){if(!n||typeof n!="object")return null;const a=n;if(!Object.prototype.hasOwnProperty.call(a,"stacks"))return null;const s=mE(a.keyword);if(!s)return null;const r=a;return r.keyword=s,r.stacks=cr(r.stacks),Object.prototype.hasOwnProperty.call(a,"potency")&&r.potency!==void 0&&(r.potency=zl(r.potency)),r}function mE(n){if(typeof n!="string")return null;switch(n.trim().toLowerCase()){case"bleed":return"Bleed";case"burn":return"Burn";case"lifesteal":case"life-steal":return"Lifesteal";case"shield":return"Shield";default:return null}}function fh(n){const a=n.potency!==void 0?zl(n.potency):1;return a>0?a:0}function pE(n){if(n.potency!==void 0){const r=zl(n.potency);return r>0?r:0}const a=cr(n.stacks);if(a<=0)return 0;const s=a*.2;return s>0?s:0}lu("Bleed",{onTick({state:n,self:a}){const s=cr(n.stacks);if(s<=0||a.health<=0){n.stacks=s;return}const r=n.potency!==void 0?zl(n.potency):1,o=s*r;if(o<=0)return;const u=Math.min(a.health,o);return n.stacks=Math.max(0,s-1),{hpDamage:u}}});lu("Burn",{onTick({state:n,self:a}){const s=cr(n.stacks);if(s<=0){n.stacks=s;return}const r=n.potency!==void 0?zl(n.potency):1,o=s*r;if(o<=0)return;const u=Math.min(a.shield,o),f=o-u,h=Math.min(a.health,f);return n.stacks=Math.max(0,s-1),{shieldDamage:u,hpDamage:h}}});lu("Shield",{onGrantShield({state:n}){const a=cr(n.stacks);if(a<=0)return n.stacks=a,0;const s=a*fh(n);return s>0?s:0},onConsumeShield({state:n,amount:a}){const s=cr(n.stacks);if(s<=0)return n.stacks=0,0;const r=fh(n);if(r<=0)return n.stacks=0,0;const o=s*r;if(o<=0)return n.stacks=0,0;const u=Math.min(o,Wi(a)),f=u/r;return n.stacks=Math.max(0,s-f),u>0?u:0}});lu("Lifesteal",{onHit({state:n,hpDamage:a}){if(a<=0)return 0;const s=pE(n);if(s<=0)return 0;const r=a*s;return r>0?r:0}});function qn(n){return Number.isFinite(n)?Math.max(0,n):0}function c2(n,a){const s=qn(a?.health??n?.health??0),r=qn(a?.shield??n?.shield??0);return{id:n?.id??"unknown",faction:n?.faction,health:s,maxHealth:n?.maxHealth,shield:r}}function u2(n){if(!n)return!1;const a=n;return typeof a.onHit=="function"||typeof a.onKill=="function"||Array.isArray(a.onHit)||Array.isArray(a.onKill)}function d2(n){return n?Array.isArray(n)?n.filter(a=>typeof a=="function"):typeof n=="function"?[n]:[]:[]}function gE(n){if(!n)return[];if(typeof n[Symbol.iterator]=="function"){const s=[];for(const r of n)u2(r)&&s.push(r);return s}return Object.values(n).filter(s=>u2(s))}function cc(n,a,s){if(!n)return;const r=d2(n.hooks?.[a]);for(const u of r)u(s);const o=gE(n.keywords);for(const u of o)for(const f of d2(u[a]))f(s)}function f2(n){const a=qn(n?.health??0),s=qn(n?.maxHealth??a);return{health:a,maxHealth:Math.max(s,a),shield:qn(n?.shield??0)}}function yE(){return{health:0,maxHealth:0,shield:0}}function bE(n){const a=n.attacker??null,s=n.defender,r=n.baseDamage,o=qn(n.minimumDamage??1),u=Number.isFinite(r)?qn(r):qn(a?.attack??0),f=qn(s.defense??0),h=fE(),m=f2(s),p=a?f2(a):null,g=r2(s.keywords??null,"defender",h.defender),b=a?r2(a.keywords??null,"attacker",h.attacker):null,S=p??yE();g&&g.runTick(m,S),b&&p&&b.runTick(p,m);const E=m.health>0,w=qn(m.shield);g&&g.grantShield(m,S);const R=qn(m.shield),_=E?Math.max(o,u-f):0,U=E?Math.min(R,_):0,B=E?Math.max(0,_-U):0;m.shield=Math.max(0,R-U);const G=Math.min(w,U),F=Math.max(0,U-G);g&&F>0&&g.consumeShield(F,m,S);const P=g?g.getShieldValue():0;h.defender.keywordShieldRemaining=P;const ie=Math.max(0,w-G);m.shield=ie+P;const se=m.health;m.health=Math.max(0,se-B);const le=m.health,ne=le<=0;let Y=0;b&&p?(Y=b.applyHit(B,p,m),h.attacker.keywordShieldRemaining=b.getShieldValue()):h.attacker.keywordShieldRemaining=0;const N=c2(a,p??void 0),L=c2(s,{health:le,shield:ie+P}),A={attacker:N,defender:L,damage:_,shieldDamage:U,hpDamage:B,lethal:ne},$={...A,source:"defender"};if(cc(s,"onHit",$),oc("combat:onHit",$),a){const H={...A,source:"attacker"};cc(a,"onHit",H),oc("combat:onHit",H),ne&&(cc(a,"onKill",H),oc("combat:onKill",H))}return ne&&(cc(s,"onKill",$),oc("combat:onKill",$)),{damage:_,shieldDamage:U,hpDamage:B,lethal:ne,remainingHealth:le,remainingShield:ie+P,attackerHealing:Y,attackerRemainingHealth:p?.health,attackerRemainingShield:p?.shield,keywordEffects:h}}const h2=5;function hn(n){return`${n.q},${n.r}`}function m2(n){const[a,s]=n.split(",").map(Number);return{q:a,r:s}}function Xs(n){return{q:n.q,r:n.r}}class vE{constructor(a,s,r,o,u,f=[]){this.id=a,this.type=s,this.faction=o,this.stats=u,this.priorityFactions=f,this.coord=Xs(r),this.renderCoord=Xs(r),this.maxHealth=u.health}alive=!0;listeners={};maxHealth;healMarkerElapsed=0;healAmountBuffer=0;cachedTargetKey;cachedStartKey;cachedPath;movementCooldownSeconds=0;shield=0;immortal=!1;experience=0;combatHooks=null;combatKeywords=null;coord;renderCoord;setCoord(a,s){this.coord=Xs(a),(s?.snapRender??!0)&&(this.renderCoord=Xs(a))}setRenderCoord(a){this.renderCoord=Xs(a)}snapRenderToCoord(a=this.coord){this.renderCoord=Xs(a)}onDeath(a){(this.listeners.death??=[]).push(a)}emitDeath(){for(const a of this.listeners.death??[])a()}isDead(){return!this.alive}getMaxHealth(){return this.maxHealth}distanceTo(a){return Zs(this.coord,a)}getVisionRange(){const{visionRange:a}=this.stats;return Number.isFinite(a)?a:3}attack(a){return this.distanceTo(a.coord)>this.stats.attackRange?null:a.takeDamage(this.stats.attackDamage,this)}update(a,s){if(!(this.isDead()||!s))if(Zs(this.coord,s.pos)<=s.auraRadius){const r=this.stats.health;if(this.stats.health=Math.min(this.stats.health+s.regenPerSec*a,this.maxHealth),this.stats.health>r){const o=this.stats.health-r;this.healMarkerElapsed+=a,this.healAmountBuffer+=o,(this.healMarkerElapsed>=.9||this.healAmountBuffer>=2)&&this.flushHealEvent()}}else this.healAmountBuffer>0&&this.flushHealEvent(),this.healMarkerElapsed=0,this.healAmountBuffer=0}flushHealEvent(){if(this.healAmountBuffer<=0){this.healMarkerElapsed=0;return}const a=Math.round(this.healAmountBuffer*10)/10;a>0&&te.emit("unitHealed",{unitId:this.id,amount:a,remainingHealth:this.stats.health}),this.healAmountBuffer=0,this.healMarkerElapsed=0}takeDamage(a,s){const r=Number.isFinite(a);if(r&&a<=0||!r&&!s)return null;const o=s?s.toCombatParticipant():null,u=this.toCombatParticipant(),f=bE({attacker:o,defender:u,baseDamage:r?a:void 0});this.stats.health=f.remainingHealth,this.shield=f.remainingShield;let h=f;if(f.lethal&&this.alive&&this.immortal&&(this.stats.health=Math.max(1,this.stats.health),h={...f,lethal:!1,remainingHealth:this.stats.health,remainingShield:this.shield}),s&&f.attackerRemainingHealth!==void 0){const m=Math.min(s.getMaxHealth(),Math.max(0,f.attackerRemainingHealth));s.stats.health=m}return s&&f.attackerRemainingShield!==void 0&&s.setShield(f.attackerRemainingShield),h.damage>0&&te.emit("unitDamaged",{attackerId:s?.id,targetId:this.id,amount:h.damage,remainingHealth:this.stats.health}),h.lethal&&this.alive&&(this.stats.health=0,this.alive=!1,this.snapRenderToCoord(),te.emit("unitDied",{unitId:this.id,attackerId:s?.id,unitFaction:this.faction,attackerFaction:s?.faction}),this.emitDeath()),h}getShield(){return this.shield}setShield(a){if(!Number.isFinite(a)||a<=0){this.shield=0;return}this.shield=a}updateStats(a){this.stats.attackDamage=a.attackDamage,this.stats.attackRange=a.attackRange,this.stats.movementRange=a.movementRange,typeof a.defense=="number"&&Number.isFinite(a.defense)?this.stats.defense=a.defense:delete this.stats.defense,typeof a.visionRange=="number"&&Number.isFinite(a.visionRange)&&(this.stats.visionRange=a.visionRange);const s=Math.max(1,Math.round(a.health));this.maxHealth=s,this.stats.health=Math.min(s,Math.max(0,this.stats.health))}isImmortal(){return this.immortal}setImmortal(a){this.immortal=!!a}getExperience(){return this.experience}setExperience(a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;s!==this.experience&&(this.experience=s,te.emit("unit:xpChanged",{unitId:this.id,xp:this.experience}))}addExperience(a){if(!Number.isFinite(a)||a===0)return this.experience;const s=Math.max(0,Math.floor(this.experience+a));return this.setExperience(s),this.experience}toCombatParticipant(){return{id:this.id,faction:this.faction,attack:this.stats.attackDamage,defense:this.stats.defense,health:this.stats.health,maxHealth:this.maxHealth,shield:this.shield,hooks:this.combatHooks,keywords:this.combatKeywords}}addMovementTime(a){!Number.isFinite(a)||a<=0||(this.movementCooldownSeconds+=a)}canStep(a=h2){return this.movementCooldownSeconds>=a}consumeMovementCooldown(a=h2){return this.canStep(a)?(this.movementCooldownSeconds-=a,!0):!1}moveTowards(a,s,r){const o=this.getPathTo(a,s,r);if(o.length<2)return[];let u=0;const f=hn(a);for(let m=1;m<o.length;m++){const p=hn(o[m]);if(r.has(p)){p!==f&&this.clearPathCache();break}u=m}if(u===0)return[];const h=Math.min(this.stats.movementRange,u);return o.slice(0,h+1)}getPathTo(a,s,r){const o=hn(this.coord),u=hn(a);return(!this.cachedPath||this.cachedTargetKey!==u||this.cachedStartKey!==o)&&(this.cachedPath=this.findPath(a,s,r),this.cachedTargetKey=u,this.cachedStartKey=o),this.cachedPath}advancePathCache(a){!this.cachedPath||a<=0||(this.cachedPath=this.cachedPath.slice(a),this.cachedPath.length>0?this.cachedStartKey=hn(this.cachedPath[0]):(this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0))}clearPathCache(){this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0}findPath(a,s,r){const o=this.coord,u=hn(o),f=hn(a),h=new Set([u]),m=new Map([[u,null]]),p=new Map([[u,0]]),g=new Map([[u,Zs(o,a)]]);for(;h.size>0;){let E=null,w=1/0;for(const U of h){const B=g.get(U)??1/0;B<w&&(w=B,E=U)}if(E===null||E===f)break;h.delete(E);const R=m2(E),_=p.get(E)??1/0;for(const U of Oc(R)){const B=hn(U);if(B!==f&&!this.isPassable(U,s,r))continue;const G=_+1;G<(p.get(B)??1/0)&&(m.set(B,E),p.set(B,G),g.set(B,G+Zs(U,a)),h.add(B))}}if(!m.has(f))return[o];const b=[];let S=f;for(;S;)b.push(m2(S)),S=m.get(S)??null;return b.reverse()}seekNearestEnemy(a,s,r){const o=new Map;for(const h of a)o.set(hn(h.coord),h);const u=[this.coord],f=new Set([hn(this.coord)]);for(;u.length>0;){const h=u.shift(),m=hn(h),p=o.get(m);if(p)return p;for(const g of Oc(h)){const b=hn(g),S=o.get(b);if(S)return S;this.isPassable(g,s,r)&&(f.has(b)||(f.add(b),u.push(g)))}}return null}canTraverse(a,s,r){return this.isPassable(a,s,r)}isPassable(a,s,r){const o=s.getTile(a.q,a.r);return!o||r&&r.has(hn(a))?!1:o.terrain!==xn.Lake}}class SE{static selectTarget(a,s){let r=s.filter(u=>u.faction!==a.faction&&!u.isDead());if(r.length===0)return null;if(a.priorityFactions.length>0){const u=r.filter(f=>a.priorityFactions.includes(f.faction));u.length>0&&(r=u)}const o=r.filter(u=>a.distanceTo(u.coord)<=a.stats.attackRange);return o.length>0?(o.sort((u,f)=>u.stats.health-f.stats.health),o[0]):(r.sort((u,f)=>a.distanceTo(u.coord)-a.distanceTo(f.coord)),r[0]??null)}}const EE=4,ME=8;class xE{buckets=[];bucketCount=0;currentBucket=0;minBuckets;maxBuckets;constructor(a={}){this.minBuckets=a.minBuckets??EE,this.maxBuckets=a.maxBuckets??ME}reset(){this.buckets=[],this.bucketCount=0,this.currentBucket=0}next(a){const s=a.length;if(s===0)return this.reset(),[];const r=this.computeBucketCount(s);r!==this.bucketCount&&(this.bucketCount=r,this.currentBucket=this.currentBucket%Math.max(1,r)),this.rebuildBuckets(a);const o=this.buckets[this.currentBucket]??[];return this.bucketCount>0&&(this.currentBucket=(this.currentBucket+1)%this.bucketCount),o}rebuildBuckets(a){const s=this.bucketCount;this.buckets=Array.from({length:s},()=>[]);const r=[...a].sort((o,u)=>o.id.localeCompare(u.id));for(let o=0;o<r.length;o++){const u=o%s;this.buckets[u].push(r[o])}}computeBucketCount(a){if(a<=0)return 0;const s=Math.ceil(a/12);let r=Math.max(this.minBuckets,s);return r=Math.min(this.maxBuckets,r),r=Math.min(r,a),r=Math.max(1,r),r}}function Cf(n){return`${n.q},${n.r}`}const wE=500;class AE{cache=new Map;targetIndex=new Map;targetPositions=new Map;ttlMs;constructor(a=wE){this.ttlMs=a}clearExpired(a=Date.now()){for(const[s,r]of this.cache.entries())if(r.expiresAt<=a&&(this.cache.delete(s),r.targetId)){const o=this.targetIndex.get(r.targetId);o?.delete(s),o&&o.size===0&&this.targetIndex.delete(r.targetId)}}trackUnit(a){this.invalidateIfTargetMoved(a.id,Cf(a.coord))}invalidateForUnit(a){const s=this.targetIndex.get(a);if(s){for(const r of s)this.cache.delete(r);this.targetIndex.delete(a)}this.targetPositions.delete(a)}getPath(a,s,r,o,u={}){const f=u.now??Date.now(),h=u.targetId,m=Cf(s);h&&this.invalidateIfTargetMoved(h,m);const p=this.hashObstacles(o),g=this.createCacheKey(Cf(a.coord),m,p),b=this.cache.get(g);if(b&&b.expiresAt>f)return b.path;a.clearPathCache();const S=a.getPathTo(s,r,o);if(this.cache.set(g,{path:S,expiresAt:f+this.ttlMs,targetId:h}),h){let E=this.targetIndex.get(h);E||(E=new Set,this.targetIndex.set(h,E)),E.add(g),this.targetPositions.set(h,m)}return S}invalidateIfTargetMoved(a,s){const r=this.targetPositions.get(a);if(!r){this.targetPositions.set(a,s);return}if(r===s)return;const o=this.targetIndex.get(a);if(o){for(const u of o)this.cache.delete(u);o.clear()}this.targetPositions.set(a,s)}hashObstacles(a){return a.size===0?"empty":Array.from(a).sort().join("|")}createCacheKey(a,s,r){return`${a}->${s}|${r}`}}const CE={baseThreshold:50,heatPerSecond:50/30,thresholdGrowth:.05,coolingPerSecond:0};function Ht(n,a=0){return Number.isFinite(n)?n:a}class TE{heat;threshold;baseThreshold;thresholdGrowthFactor;heatPerSecond;coolingPerSecond;maxStoredHeat;constructor(a={}){const s={...CE,...a},r=Math.max(1,Ht(s.baseThreshold,50)),o=Math.max(1,Ht(a.initialThreshold??r,r));this.baseThreshold=r,this.threshold=o,this.thresholdGrowthFactor=1+Math.max(0,Ht(s.thresholdGrowth,0)),this.heatPerSecond=Math.max(0,Ht(s.heatPerSecond,0)),this.coolingPerSecond=Math.max(0,Ht(s.coolingPerSecond,0));const u=Ht(s.maxStoredHeat??Number.NaN,Number.NaN);this.maxStoredHeat=Number.isFinite(u)&&u>=0?u:null;const f=Math.max(0,Ht(a.initialHeat??0,0));this.heat=this.setHeatInternal(f)}getHeat(){return this.heat}getThreshold(){return this.threshold}getBuildRate(){return this.heatPerSecond}getCoolingRate(){return this.coolingPerSecond}reset(){this.heat=0,this.threshold=this.baseThreshold}setHeat(a){const s=Math.max(0,Ht(a,0));return this.heat=this.setHeatInternal(s),this.heat}setHeatInternal(a){const s=Math.max(0,Ht(a,0));return this.maxStoredHeat===null?(this.heat=s,this.heat):(this.heat=Math.min(s,this.maxStoredHeat),this.heat)}addHeat(a){const s=Math.max(0,Ht(a,0));if(s<=0)return 0;const r=this.heat,o=r+s;return this.heat=this.maxStoredHeat===null?o:Math.min(o,this.maxStoredHeat),this.heat-r}cool(a){const s=Math.max(0,Ht(a,0));if(s<=0||this.heat<=0)return 0;const r=this.heat;return this.heat=Math.max(0,this.heat-s),r-this.heat}vent(a=1){const s=Math.max(0,Math.min(1,Ht(a,1)));return s<=0?0:this.cool(this.threshold*s)}advance(a,s){const r=Math.max(0,Ht(a,0)),o=this.heatPerSecond,u=r>0?o*r:0,f=Math.max(0,Ht(s?.bonusHeat??0,0)),h=u+f,m=this.addHeat(h),p=Math.max(0,Ht(s?.coolingMultiplier??1,1)),g=r>0?this.coolingPerSecond*r*p:0,b=this.cool(g);return{addedHeat:m,cooledHeat:b,heat:this.heat}}hasTriggerReady(){return this.heat>=this.threshold-1e-6}consumeTrigger(){return this.hasTriggerReady()?(this.cool(this.threshold),this.threshold=Math.max(this.baseThreshold,this.threshold*this.thresholdGrowthFactor),!0):!1}timeUntilNextTrigger(){return this.hasTriggerReady()?0:this.heatPerSecond<=0?Number.POSITIVE_INFINITY:Math.max(0,this.threshold-this.heat)/this.heatPerSecond}getCooldownSeconds(){return this.heatPerSecond<=0?Number.POSITIVE_INFINITY:this.threshold/this.heatPerSecond}}function _E(n){return new TE(n)}const p2=500;function Wy(n,a,s){const r=typeof a=="number"?a:2,o=(typeof a=="number"?s:a)??[],u=[];for(let h=-r;h<=r;h++){const m=Math.max(-r,-h-r),p=Math.min(r,-h+r);for(let g=m;g<=p;g++){const b=Math.max(Math.abs(h),Math.abs(g),Math.abs(-h-g));if(b===0||b>r)continue;const S={q:n.q+h,r:n.r+g};o.some(w=>!w.isDead()&&w.coord.q===S.q&&w.coord.r===S.r)||u.push(S)}}if(u.length===0)return null;const f=Math.floor(Math.random()*u.length);return u[f]}function RE(n,a,s={}){const r=_E(a),o=r.getBuildRate(),u=r.getCooldownSeconds(),f=r.timeUntilNextTrigger(),h=Number.isFinite(s.maxRosterSize)?Math.max(0,Math.floor(s.maxRosterSize??0)):0,m=Number.isFinite(s.maxHealth)?Math.max(1,Math.floor(s.maxHealth??p2)):p2,p=Number.isFinite(s.health)?Math.max(0,Math.min(m,Math.floor(s.health??m))):m;return{id:"sauna",pos:n,auraRadius:2,regenPerSec:1,rallyToFront:!1,maxRosterSize:h,maxHealth:m,health:p,destroyed:p<=0,heat:r.getHeat(),heatPerTick:o,playerSpawnThreshold:r.getThreshold(),playerSpawnCooldown:Number.isFinite(u)?u:0,playerSpawnTimer:Number.isFinite(f)?f:0,beerUpkeepAccumulator:0,heatTracker:r}}function NE(n,a){if(!Number.isFinite(a)||a<=0||n.destroyed)return{amount:0,remainingHealth:Math.max(0,n.health),destroyed:n.destroyed};const s=Math.max(0,n.health),r=Math.min(s,Math.max(0,Math.floor(a))),o=Math.max(0,s-r);return n.health=o,o<=0&&(n.health=0,n.destroyed=!0),{amount:r,remainingHealth:n.health,destroyed:n.destroyed}}const kE=30;function jt(n){return`${n.q},${n.r}`}class DE{constructor(a,s){this.map=a,this.animator=s}scheduler=new xE;pathCache=new AE;lastKnownCoords=new Map;findExplorationGoal(a,s){const r=a.coord;if(this.map.ensureTile(r.q,r.r).isFogged&&a.canTraverse(r,this.map,s))return r;const u=new Set([jt(r)]),f=[r];for(;f.length>0;){const h=f.shift(),m=Oc(h),p=this.map.getNeighbors(h.q,h.r);for(let g=0;g<m.length;g++){const b=m[g],S=p[g],E=jt(b);if(!u.has(E)&&(u.add(E),!!a.canTraverse(b,this.map,s))){if(S.isFogged)return b;f.push(b)}}}return null}tick(a,s,r){const o=a.length,u=Date.now();if(this.pathCache.clearExpired(u),o===0){this.scheduler.reset();return}const f=new Set,h=[],m=new Set;for(const g of a){if(g.addMovementTime(s),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g),this.lastKnownCoords.delete(g.id);continue}const b=this.lastKnownCoords.get(g.id);b&&Zs(b,g.coord)>1&&this.animator?.clear(g,{snap:!0}),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r}),this.pathCache.trackUnit(g),h.push(g),f.add(jt(g.coord)),m.add(g.id)}for(const g of[...this.lastKnownCoords.keys()])m.has(g)||this.lastKnownCoords.delete(g);if(h.length===0){this.scheduler.reset();return}const p=this.scheduler.next(h);if(p.length!==0)for(const g of p){const b=jt(g.coord);if(f.delete(b),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g);continue}const S=SE.selectTarget(g,a);if(!S&&r&&!r.destroyed&&this.tryAttackSauna(g,r)){const B=jt(g.coord);f.add(B);continue}if(!S){let U=null;if(r&&!r.destroyed&&(U=r.pos),U||(U=this.findExplorationGoal(g,f)),U){const G=this.computeMovementPath(g,U,f,u);if(G.length>1&&g.stats.movementRange>0){const F=G[1],P=jt(F);if(f.has(P))g.clearPathCache();else{if(!g.canStep()){f.add(b);continue}if(g.consumeMovementCooldown()){const ie={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(F,{snapRender:!1}),this.animator.enqueue(g,[ie,F])):g.setCoord(F),g.advancePathCache(1);const se=jt(g.coord);se===jt(U)&&g.clearPathCache(),f.add(se),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});continue}}}else g.clearPathCache()}else g.clearPathCache();const B=jt(g.coord);f.add(B),r&&!r.destroyed&&this.tryAttackSauna(g,r);continue}if(S.isDead()){g.clearPathCache(),f.add(b);continue}const E=jt(S.coord),w=this.pathCache.getPath(g,S.coord,this.map,f,{now:u,targetId:S.id});if(w.length>1&&g.stats.movementRange>0){const U=w[1],B=jt(U),G=B===E;if(!f.has(B)||G){if(g.canStep()&&g.consumeMovementCooldown()){const F={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(U,{snapRender:!1}),this.animator.enqueue(g,[F,U])):g.setCoord(U),g.advancePathCache(1)}}else g.clearPathCache()}const R=jt(g.coord);f.add(R),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});const _=jt(S.coord);_!==E&&g.clearPathCache(),g.distanceTo(S.coord)<=g.stats.attackRange&&!S.isDead()&&((g.attack(S)?.lethal??!1)||S.isDead())&&(f.delete(_),g.clearPathCache(),this.pathCache.invalidateForUnit(S.id),this.animator?.clear(S))}}tryAttackSauna(a,s){if(a.faction==="player")return!1;const r=a.stats.attackRange;if(r<=0||a.distanceTo(s.pos)>r)return!1;const o=NE(s,a.stats.attackDamage);if(o.amount<=0)return!1;const u={attackerId:a.id,attackerFaction:a.faction,amount:o.amount,remainingHealth:o.remainingHealth};if(te.emit("saunaDamaged",u),o.destroyed){const f={attackerId:a.id,attackerFaction:a.faction};te.emit("saunaDestroyed",f)}return!0}computeMovementPath(a,s,r,o){const u=this.pathCache.getPath(a,s,this.map,r,{now:o});if(u.length<2)return[];let f=0;const h=jt(s);for(let p=1;p<u.length;p++){const g=jt(u[p]);if(r.has(g)){g!==h&&a.clearPathCache();break}f=p}if(f===0)return[];const m=Math.min(a.stats.movementRange,f);return u.slice(0,m+1)}}function ou(n){if(!Number.isFinite(n??NaN))return 1;const a=Math.floor(n);return Math.max(1,a)}function LE(n){return Math.max(0,ou(n)-1)}function UE(n,a="linear"){const s=LE(n);switch(a){case"accelerating":return s*(s+1)/2;case"diminishing":return s===0?0:Math.log2(s+1);case"linear":default:return s}}function OE(n,a="round"){switch(a){case"floor":return Math.floor(n);case"ceil":return Math.ceil(n);case"none":return n;case"round":default:return Math.round(n)}}function qE(n,a,s){let r=n;return Number.isFinite(a)&&(r=Math.max(r,a)),Number.isFinite(s)&&(r=Math.min(r,s)),r}function ul(n,a){const s=ou(a),r=n.curve??"linear",o=UE(s,r),u=n.base+n.growth*o,f=qE(u,n.min,n.max);return OE(f,n.round??"round")}function Bl(n,a){const s=ou(a),r=n.stats,o={health:ul(r.health,s),attackDamage:ul(r.attackDamage,s),attackRange:ul(r.attackRange,s),movementRange:ul(r.movementRange,s)};return r.visionRange&&(o.visionRange=ul(r.visionRange,s)),o}function g2(n){if(typeof n=="number"&&Number.isFinite(n))return n}function Gc(n,a){let s=n.health,r=n.attackDamage,o=n.attackRange,u=n.movementRange,f=g2(n.defense),h=g2(n.shield);for(const p of a){const g=Math.max(1,Math.round(p.quantity)),b=p.modifiers;typeof b.health=="number"&&(s+=b.health*g),typeof b.attackDamage=="number"&&(r+=b.attackDamage*g),typeof b.attackRange=="number"&&(o+=b.attackRange*g),typeof b.movementRange=="number"&&(u+=b.movementRange*g),typeof b.defense=="number"&&(f=(f??0)+b.defense*g),typeof b.shield=="number"&&(h=(h??0)+b.shield*g)}const m={health:Math.max(1,Math.round(s)),attackDamage:Math.max(0,Math.round(r)),attackRange:Math.max(0,Math.round(o)),movementRange:Math.max(0,Math.round(u))};return f!==void 0&&(m.defense=Math.max(0,Math.round(f))),h!==void 0&&(m.shield=Math.max(0,Math.round(h))),typeof n.visionRange=="number"&&Number.isFinite(n.visionRange)&&(m.visionRange=Math.max(0,Math.round(n.visionRange))),m}const Vh=Object.freeze({id:"soldier",displayName:"Sauna Soldier",cost:50,tags:["infantry","melee"],stats:{health:{base:20,growth:6,curve:"linear",round:"round"},attackDamage:{base:5,growth:1,curve:"linear",round:"round"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:0,round:"round"}}}),Xh=Object.freeze({id:"archer",displayName:"Sauna Archer",cost:75,tags:["ranged"],stats:{health:{base:15,growth:4,curve:"linear",round:"round"},attackDamage:{base:3,growth:.4,curve:"accelerating",round:"ceil"},attackRange:{base:3,growth:.5,curve:"diminishing",round:"ceil",max:5},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:.25,curve:"linear",round:"round",max:5}}}),eb=Object.freeze({id:"avanto-marauder",displayName:"Avanto Marauder",cost:0,tags:["enemy","melee"],stats:{health:{base:12,growth:5,curve:"linear",round:"round"},attackDamage:{base:4,growth:.6,curve:"accelerating",round:"ceil"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:.25,curve:"linear",round:"round",max:2},visionRange:{base:3,growth:0,round:"round"}}}),tb=Object.freeze({soldier:Vh,archer:Xh,"avanto-marauder":eb});function Kh(n){return tb[n]??null}Object.freeze(Object.keys(tb));const y2=Vh.cost;Object.freeze(Bl(Vh,1));Xh.cost;Object.freeze(Bl(Xh,1));Object.freeze(Bl(eb,1));function nb(n,a,s,r,o){const u=ou(o?.level),f=Bl(n,u);return new vE(a,n.id,s,r,f,n.priorityFactions)}function ab(n,a,s,r,o){const u=Kh(n);return u?nb(u,a,s,r,o):null}function Qh(n,a,s,r,o,u){const f=Kh(a);if(!f)return null;const h=f.cost;if(!n.canAfford(h,ae.SAUNA_BEER))return ia("error"),null;n.addResource(ae.SAUNA_BEER,-h);const m=nb(f,s,r,o,u);return ia("spawn"),te.emit("unitSpawned",{unit:m}),m}const zE=Object.freeze(Object.defineProperty({__proto__:null,createUnit:ab,spawnUnit:Qh},Symbol.toStringTag,{value:"Module"})),BE=["Aino","Eero","Ilona","Kalevi","Lumi","Mika","Noora","Oskari","Saana","Tapio","Veera","Yrjö"],HE=["Emberguard","Frostwalker","Steamcaller","Dawnwatch","Gritforged","Stormchant","Snowborn","Torchbearer","Chillwarden","Sisuheart"],jE=["Aalto","Halla","Karhu","Korhonen","Laine","Metsä","Niemi","Salmi","Tuomi","Virta"];function Tf(n,a){if(n.length===0)throw new Error("Cannot select a name from an empty collection.");const s=Math.floor(a()*n.length);return n[Math.min(s,n.length-1)]}function GE(n=Math.random){const a=Tf(BE,n),s=Tf(HE,n),r=Tf(jE,n);return`${a} "${s}" ${r}`}const ur=Object.freeze(["supply","weapon","focus","relic"]);function ib(){return{supply:null,weapon:null,focus:null,relic:null}}const IE=Object.freeze({supply:Object.freeze({id:"supply",label:"Supply Satchel",description:"Consumables and restorative provisions carried into battle.",maxStacks:5}),weapon:Object.freeze({id:"weapon",label:"Primary Armament",description:"The attendant's main weapon or ranged kit.",maxStacks:1}),focus:Object.freeze({id:"focus",label:"Battle Focus",description:"Tools that sharpen aim, steps, or battlefield intuition.",maxStacks:1}),relic:Object.freeze({id:"relic",label:"Sauna Relic",description:"Charms and relics that empower the attendant's resolve.",maxStacks:1})}),YE=Object.freeze({"birch-sap-satchel":Object.freeze({id:"birch-sap-satchel",slot:"supply",modifiers:{health:3},maxStacks:3}),"steamed-bandages":Object.freeze({id:"steamed-bandages",slot:"supply",modifiers:{shield:4},maxStacks:2}),"aurora-distillate":Object.freeze({id:"aurora-distillate",slot:"supply",modifiers:{attackDamage:2,defense:1},maxStacks:1}),"stolen-sauna-tokens":Object.freeze({id:"stolen-sauna-tokens",slot:"supply",modifiers:{movementRange:.5},maxStacks:5}),"midnight-bloodwine":Object.freeze({id:"midnight-bloodwine",slot:"supply",modifiers:{health:6,attackDamage:1},maxStacks:1}),"sauna-incense":Object.freeze({id:"sauna-incense",slot:"supply",modifiers:{attackRange:1},maxStacks:2}),"glacier-brand":Object.freeze({id:"glacier-brand",slot:"weapon",modifiers:{attackDamage:3},maxStacks:1}),"emberglass-arrow":Object.freeze({id:"emberglass-arrow",slot:"weapon",modifiers:{attackDamage:1,attackRange:2},maxStacks:1}),"aurora-lattice":Object.freeze({id:"aurora-lattice",slot:"focus",modifiers:{attackDamage:2,attackRange:1},maxStacks:1}),"emberglass-shard":Object.freeze({id:"emberglass-shard",slot:"focus",modifiers:{attackDamage:1,movementRange:1},maxStacks:1}),"windstep-totem":Object.freeze({id:"windstep-totem",slot:"focus",modifiers:{movementRange:1,defense:1},maxStacks:1}),"searing-chant-censer":Object.freeze({id:"searing-chant-censer",slot:"focus",modifiers:{attackDamage:2,shield:2},maxStacks:1}),"cracked-ice-amulet":Object.freeze({id:"cracked-ice-amulet",slot:"relic",modifiers:{defense:2},maxStacks:1}),"myrsky-charm":Object.freeze({id:"myrsky-charm",slot:"relic",modifiers:{attackRange:1,defense:1},maxStacks:1}),"frostwyrm-signet":Object.freeze({id:"frostwyrm-signet",slot:"relic",modifiers:{shield:5},maxStacks:1}),"spirit-oak-charm":Object.freeze({id:"spirit-oak-charm",slot:"relic",modifiers:{defense:1,health:2},maxStacks:1})});function Hl(n){const a=IE[n];if(!a)throw new Error(`Unknown equipment slot: ${n}`);return a}function jl(n){return YE[n]}function sb(n){return Number.isFinite(n)?Math.max(1,Math.round(n)):1}function rb(n,a){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:a}}function lb(n,a,s,r){const o=Hl(a),u=Math.max(1,Math.floor(s.maxStacks??o.maxStacks)),f=Math.min(u,r),h=s.modifiers??{};return{...rb(n,f),slot:a,maxStacks:u,modifiers:h}}function hh(n){n.equipment||(n.equipment=ib());for(const a of ur)n.equipment[a]??=null;return n.equipment}function Bn(n){const a=[];for(const s of ur){const r=n[s];r&&a.push({...r})}return a}function Ph(n){return Bn(n).map(a=>rb(a,a.quantity))}function _f(n){const a=ib();for(const s of n){const r=jl(s.id);if(!r)continue;const o=sb(s.quantity),u=a[r.slot];if(u&&u.id!==s.id)continue;const f=(u?.quantity??0)+o,h=lb(s,r.slot,r,f);a[r.slot]=h}return a}function FE(n,a){const s=jl(a.id);if(!s)return{success:!1,slot:"supply",loadout:Bn(hh(n)),item:null,reason:"unknown-item"};const r=hh(n),o=s.slot,u=Hl(o),f=sb(a.quantity),h=Math.max(1,Math.floor(s.maxStacks??u.maxStacks)),m=r[o];if(m&&m.id!==a.id)return{success:!1,slot:o,loadout:Bn(r),item:m,reason:"slot-occupied"};const p=Math.min(h,(m?.quantity??0)+f);if((m?.quantity??0)+f>h)return{success:!1,slot:o,loadout:Bn(r),item:m,reason:"stack-limit"};const g=lb(a,o,s,p);return r[o]=g,n.items=Ph(r),{success:!0,slot:o,loadout:Bn(r),item:g}}function $E(n,a){const s=hh(n),r=s[a];return r?(s[a]=null,n.items=Ph(s),{success:!0,slot:a,loadout:Bn(s),removed:r}):{success:!1,slot:a,loadout:Bn(s),removed:null,reason:"empty-slot"}}function VE(n,a){return jl(n)?.slot===a}const XE={q:0,r:0},KE="Saunoja",mh=18,b2=0,ar=0,kc=10,v2=1,uc={health:mh,attackDamage:4,attackRange:1,movementRange:1,defense:0,shield:0};function dc(n,a,s){return Math.min(Math.max(n,a),s)}function fc(n,a,s){const r=typeof n=="number"&&Number.isFinite(n)?n:a;return Math.max(s,r)}function Rf(n,a,s=0){if(typeof n=="number"&&Number.isFinite(n))return Math.max(s,n);if(typeof a=="number"&&Number.isFinite(a))return Math.max(s,a)}function S2(n,a){if(!n||typeof n!="object")return{...a};const s=n,r=fc(s.health,a.health,1),o=fc(s.attackDamage,a.attackDamage,0),u=fc(s.attackRange,a.attackRange,0),f=fc(s.movementRange,a.movementRange,0),h=Rf(s.defense,a.defense,0),m=Rf(s.shield,a.shield,0),p=Rf(s.visionRange,a.visionRange,0);return{health:r,attackDamage:o,attackRange:u,movementRange:f,defense:h,shield:m,visionRange:p}}function QE(n,a){if(!n||typeof n!="object")return _f(a);const s=n,r=[];for(const o of Object.values(s)){const u=ob(o);u&&r.push(u)}return r.length===0?_f(a):_f(r)}function ob(n){if(!n||typeof n!="object")return null;const a=n,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const o=typeof a.description=="string"?a.description.trim():void 0,u=typeof a.icon=="string"?a.icon.trim():void 0,f=typeof a.rarity=="string"?a.rarity.trim():void 0,h=typeof a.quantity=="number"?a.quantity:Number(a.quantity),m=Number.isFinite(h)?Math.max(1,Math.round(h)):1;return{id:s,name:r,description:o,icon:u,rarity:f,quantity:m}}function PE(n){if(!n||n.length===0)return[];const a=[];for(const s of n){const r=ob(s);r&&a.push(r)}return a}function ZE(n){if(!n||typeof n!="object")return null;const a=n,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const o=a.duration;let u=1/0;typeof o=="number"&&Number.isFinite(o)?u=Math.max(0,o):o!==1/0&&(u=1/0);const f=a.remaining;let h=u;typeof f=="number"&&Number.isFinite(f)?h=Math.max(0,f):f===1/0&&(h=1/0),u!==1/0&&h===1/0&&(h=u);const m=a.appliedAt,p=typeof m=="number"&&Number.isFinite(m)?Math.max(0,m):void 0,g=a.stacks,b=typeof g=="number"&&Number.isFinite(g)?Math.max(1,Math.round(g)):void 0,S=typeof a.description=="string"?a.description.trim():void 0,E=typeof a.source=="string"?a.source.trim():void 0;return{id:s,name:r,description:S,duration:u,remaining:h,appliedAt:p,stacks:b,source:E}}function JE(n){if(!n||n.length===0)return[];const a=[];for(const s of n){const r=ZE(s);r&&a.push(r)}return a}function WE(n){if(typeof n=="string"){const a=n.trim();if(a.length>0)return a}try{return GE()}catch(a){return console.warn("Falling back to default Saunoja name",a),KE}}function Zh(n){const{id:a,name:s,coord:r=XE,maxHp:o=mh,hp:u=o,steam:f=0,defense:h,shield:m=0,traits:p=[],upkeep:g=v2,xp:b=0,lastHitAt:S=b2,selected:E=!1,items:w,modifiers:R,combatKeywords:_=null,combatHooks:U=null}=n,B=Number.isFinite(o)?Math.max(1,o):mh,G=Number.isFinite(u)?u:B,F=dc(G,0,B),P=Number.isFinite(f)?f:0,ie=dc(P,0,1),le=(Array.isArray(p)?p:[]).filter(Ft=>typeof Ft=="string").map(Ft=>Ft.trim()).filter(Ft=>Ft.length>0),ne=Number.isFinite(g)?g:v2,Y=dc(ne,ar,kc),N=Number.isFinite(b)?b:0,L=Math.max(0,N),A=Number.isFinite(S)?S:b2,$=Math.max(0,A),H=Number.isFinite(m)?m:0,T=Math.max(0,H),I=Number.isFinite(h)?h:void 0,J=I!==void 0?Math.max(0,I):void 0,fe=PE(w),M=JE(R),V=QE(n.equipment,fe),ee=Ph(V),W={...uc,health:B,defense:J??uc.defense,shield:uc.shield},oe=S2(n.baseStats,W),pe={...oe,health:B,defense:J??oe.defense,shield:T},he=S2(n.effectiveStats,pe),Ie=Math.max(1,he.health),Ae=dc(F,0,Ie),Ct=typeof he.defense=="number"?Math.max(0,he.defense):J??void 0,Wt=typeof he.shield=="number"?Math.max(0,he.shield):T,wn={...oe,health:Math.max(1,oe.health),defense:typeof oe.defense=="number"?Math.max(0,oe.defense):J??void 0,shield:typeof oe.shield=="number"?Math.max(0,oe.shield):uc.shield},en={...he,health:Ie,defense:Ct,shield:Wt},Yt=WE(s);return{id:a,name:Yt,coord:{q:r.q,r:r.r},maxHp:Ie,hp:Ae,defense:Ct,shield:Wt,steam:ie,traits:[...le],upkeep:Y,xp:L,lastHitAt:$,selected:E,items:ee,baseStats:wn,effectiveStats:en,equipment:V,modifiers:M,combatKeywords:_,combatHooks:U}}const dr=32;function Al(n,a,s,r){n.beginPath();for(let o=0;o<6;o++){const u=Math.PI/3*o,f=a+r*Math.cos(u),h=s+r*Math.sin(u);o===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function Jh(n,a,s){return Math.min(Math.max(n,a),s)}function eM(n,{centerX:a,centerY:s,hp:r,maxHp:o,radius:u=dr*.55}){const f=Number.isFinite(o)?Math.max(1,o):1,h=Number.isFinite(r)?r:f,m=Jh(h/f,0,1);if(n.save(),Al(n,a,s,u),n.fillStyle="rgba(7, 11, 18, 0.72)",n.fill(),n.restore(),m>0){n.save(),Al(n,a,s,u),n.clip();const p=n.createLinearGradient(a,s+u,a,s-u);p.addColorStop(0,"rgba(46, 160, 98, 0.35)"),p.addColorStop(1,"rgba(218, 255, 239, 0.95)"),n.fillStyle=p;const g=u*2*m,b=s+u-g;n.fillRect(a-u,b,u*2,g),n.restore()}n.save(),Al(n,a,s,u),n.lineWidth=Math.max(1,u*.12),n.strokeStyle="rgba(255, 255, 255, 0.28)",n.stroke(),n.restore()}function tM(n,{centerX:a,centerY:s,radius:r=dr,progress:o=0}){const u=Jh(o,0,1);if(u<=0)return;const f=Number.isFinite(r)&&r>0?r:dr;n.save(),n.globalCompositeOperation="lighter",n.globalAlpha=u;const h=n.createRadialGradient(a,s,Math.max(1,f*.1),a,s,f);h.addColorStop(0,"rgba(255, 255, 255, 0.92)"),h.addColorStop(.45,"rgba(255, 255, 255, 0.68)"),h.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=h,n.beginPath(),n.arc(a,s,f,0,Math.PI*2),n.fill(),n.restore()}function nM(n,{centerX:a,centerY:s,radius:r=dr*.85,intensity:o=1}){const u=Jh(o,0,1);if(u<=0)return;n.save(),Al(n,a,s,r),n.clip();const f=n.createLinearGradient(a,s+r,a,s-r);f.addColorStop(0,"rgba(255, 255, 255, 0)"),f.addColorStop(.55,`rgba(255, 255, 255, ${.12*u})`),f.addColorStop(1,`rgba(255, 255, 255, ${.35*u})`),n.globalCompositeOperation="lighter",n.fillStyle=f,n.fillRect(a-r,s-r,r*2,r*2),n.restore(),n.save(),n.globalCompositeOperation="lighter",n.lineCap="round",n.strokeStyle=`rgba(255, 255, 255, ${.25*u})`,n.lineWidth=Math.max(1,r*.08);const h=r*.75,m=r*.35;for(let p=0;p<3;p++){const g=s-r*.5+p*m;n.beginPath(),n.moveTo(a-h,g),n.bezierCurveTo(a-h*.4,g-r*.4,a+h*.4,g+r*.2,a+h,g-r*.45),n.stroke()}n.restore()}function ph(n,a,s){return n<a?a:n>s?s:n}const Nf=Object.freeze([{id:"skirmish",label:"Skirmish Patrols",minRunSeconds:0,minClears:0,cadence:26,multiplier:1,bundleTier:0},{id:"raids",label:"Raid Pressure",minRunSeconds:90,minClears:2,cadence:19,multiplier:1.35,bundleTier:1},{id:"siege",label:"Siege Lines",minRunSeconds:210,minClears:5,cadence:13,multiplier:1.8,bundleTier:2},{id:"onslaught",label:"Winter Onslaught",minRunSeconds:360,minClears:9,cadence:8.5,multiplier:2.45,bundleTier:3},{id:"maelstrom",label:"Glacier Maelstrom",minRunSeconds:540,minClears:14,cadence:6.2,multiplier:3.25,bundleTier:4}]);function aM(n){return n>=1?1/(1+(n-1)*.45):1+(1-n)*.35}function iM(n){if(n>=1)return 1+(n-1)*.85;const a=1-n;return ph(1-a*.4,.45,1)}function sM(n){return{runSeconds:Math.max(0,Number.isFinite(n.runSeconds)?n.runSeconds:0),clears:Math.max(0,Number.isFinite(n.clears)?n.clears:0),spawnCycles:Math.max(0,Number.isFinite(n.spawnCycles)?n.spawnCycles:0)}}function E2(n,a){const s=sM(a);let r=0;for(let p=0;p<Nf.length;p+=1){const g=Nf[p];if(s.runSeconds<g.minRunSeconds||s.clears<g.minClears)break;r=p}const o=Nf[r],u=aM(n),f=iM(n),h=Math.max(.75,o.cadence*u),m=o.multiplier*f;return{stage:o,stageIndex:r,cadenceTarget:h,multiplierBase:m}}function M2(n){if(n>=1){const s=Math.min(3,n-1);return ph(.93-s*.035,.82,.93)}const a=Math.min(1,1-n);return ph(.93+a*.03,.9,.97)}function x2(n){if(n>=1)return .024+Math.min(3,n-1)*.012;const a=Math.min(1,1-n);return Math.max(.012,.024-a*.01)}const cb="deepwood",ub="Deepwood Wardens",db="Reclusive guardians attuned to sauna spirits.",fb=[{id:"warding-circle",label:"Warding Circle",weight:2,units:[{unit:"soldier",level:1,quantity:2},{unit:"archer",level:1,quantity:1}],items:["spirit-oak-charm","sauna-incense"],modifiers:["barkskin-ritual"]},{id:"spirit-strike",label:"Spirit Strike",weight:1,units:[{unit:"archer",level:2,quantity:2}],items:["emberglass-arrow"],modifiers:["searing-chant","windstep"]}],rM={id:cb,name:ub,description:db,bundles:fb},lM=Object.freeze(Object.defineProperty({__proto__:null,bundles:fb,default:rM,description:db,id:cb,name:ub},Symbol.toStringTag,{value:"Module"})),hb="enemy",mb="Avanto Marauders",pb="Frostbitten raiders who harry the sauna frontier.",gb=[{id:"iceblade-scouts",label:"Iceblade Scouts",weight:3,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:1}],items:["cracked-ice-amulet"],modifiers:["frost-resilience"]},{id:"raiding-party",label:"Raiding Party",weight:2,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:2}],items:["stolen-sauna-tokens"],modifiers:["berserker-drift"]},{id:"frost-champion",label:"Frost Champion",weight:1,minRampTier:0,units:[{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand"],modifiers:["glacial-ward"]},{id:"icebreaker-vanguard",label:"Icebreaker Vanguard",weight:2.5,minRampTier:1,units:[{unit:"avanto-marauder",level:2,quantity:2},{unit:"avanto-marauder",level:1,quantity:1}],items:["stormglass-pendant"],modifiers:["frost-resilience","berserker-drift"]},{id:"glacial-phalanx",label:"Glacial Phalanx",weight:2,minRampTier:2,units:[{unit:"avanto-marauder",level:3,quantity:3},{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand","frostshard-relic"],modifiers:["glacial-ward","polar-endurance"]},{id:"avalanche-warhost",label:"Avalanche Warhost",weight:1.25,minRampTier:3,units:[{unit:"avanto-marauder",level:4,quantity:3},{unit:"avanto-marauder",level:3,quantity:2}],items:["avalanche-totem"],modifiers:["glacial-ward","polar-endurance","berserker-drift"]}],oM={id:hb,name:mb,description:pb,bundles:gb},cM=Object.freeze(Object.defineProperty({__proto__:null,bundles:gb,default:oM,description:pb,id:hb,name:mb},Symbol.toStringTag,{value:"Module"})),uM=Object.assign({"../content/factions/deepwood.json":lM,"../content/factions/enemy.json":cM}),Ic=new Map;for(const[n,a]of Object.entries(uM)){const s=dM(a),r=pM(s,n);if(Ic.has(r.id))throw new Error(`Duplicate faction bundle id: ${r.id}`);Ic.set(r.id,r)}function dM(n){return typeof n=="object"&&n!==null&&"default"in n?n.default:n}function Wh(n){return typeof n=="object"&&n!==null}function gh(n,a){if(typeof n!="string")throw new Error(`Expected string at ${a}`);const s=n.trim();if(!s)throw new Error(`Expected non-empty string at ${a}`);return s}function yh(n){if(typeof n!="string")return;const a=n.trim();return a||void 0}function w2(n,a){if(n===void 0)return Object.freeze([]);if(!Array.isArray(n))throw new Error(`Expected array at ${a}`);const s=n.map((r,o)=>{if(typeof r!="string")throw new Error(`Expected string at ${a}[${o}]`);const u=r.trim();if(!u)throw new Error(`Expected non-empty string at ${a}[${o}]`);return u});return Object.freeze(s)}function yb(n,a){const s=typeof n=="number"?n:Number(n);return!Number.isFinite(s)||s<=0?a:s}function A2(n,a){const s=Math.floor(yb(n,a));return s>0?s:a}function fM(n,a){if(!Wh(n))throw new Error(`Expected object at ${a}`);const s=gh(n.unit,`${a}.unit`),r=A2(n.level,1),o=A2(n.quantity,1);return Object.freeze({unit:s,level:r,quantity:o})}function hM(n){if(n===void 0)return;const a=Number(n);if(!Number.isFinite(a))return;const s=Math.floor(a);return s>=0?s:void 0}function mM(n,a,s){if(!Wh(n))throw new Error(`Expected object at ${a}`);const r=yh(n.id)??`${s}-bundle`,o=yh(n.label)??r,u=yb(n.weight,1),f=n.units;if(!Array.isArray(f)||f.length===0)throw new Error(`Expected non-empty units array at ${a}.units`);const h=f.map((b,S)=>fM(b,`${a}.units[${S}]`)),m=w2(n.items,`${a}.items`),p=w2(n.modifiers,`${a}.modifiers`),g=hM(n.minRampTier);return Object.freeze({id:r,label:o,weight:u,units:Object.freeze(h),items:m,modifiers:p,minRampTier:g})}function pM(n,a){if(!Wh(n))throw new Error(`Expected object at ${a}`);const s=gh(n.id,`${a}.id`),r=gh(n.name,`${a}.name`),o=yh(n.description);if(!Array.isArray(n.bundles)||n.bundles.length===0)throw new Error(`Expected non-empty bundles array at ${a}.bundles`);const u=n.bundles.map((f,h)=>mM(f,`${a}.bundles[${h}]`,`${s}-${h}`));return Object.freeze({id:s,name:r,description:o,bundles:Object.freeze(u)})}Object.freeze(Array.from(Ic.keys()));function gM(n){return Ic.get(n)??null}function yM(n){return gM(n)?.bundles??Object.freeze([])}function bM(){return`e${Date.now()}-${Math.floor(Math.random()*1e6)}`}function vM(n){return{level:n}}function SM(n,a,s){const r=yM(n);if(r.length===0)throw new Error(`No bundles registered for faction: ${n}`);const o=Math.max(0,Math.floor(Number.isFinite(a)?a:0)),u=r.filter(b=>(typeof b.minRampTier=="number"?b.minRampTier:0)<=o),f=u.length>0?u:r,h=typeof s=="function"?s:Math.random,m=f.reduce((b,S)=>b+S.weight,0);if(!Number.isFinite(m)||m<=0)throw new Error(`Invalid bundle weights for faction: ${n}`);const p=h()*m;let g=0;for(const b of f)if(g+=b.weight,p<g)return b;return f[f.length-1]}function EM(n){let a=Math.max(0,Math.floor(n.availableSlots));const s=[];if(a<=0)return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers};const r=n.makeId??bM,o=typeof n.random=="function"?n.random:Math.random,u=Math.max(0,Math.min(.95,typeof n.eliteOdds=="number"?n.eliteOdds:0)),f=Math.max(1,Number.isFinite(n.difficultyMultiplier)?n.difficultyMultiplier:1),h=Math.max(0,Math.floor(Number.isFinite(n.rampTier)?n.rampTier:0)),m=1+h*.25,p=Math.floor(h/2);for(const g of n.bundle.units){const b=Math.max(1,Math.round(g.quantity*f*m)),S=Math.min(b,a),E=g.unit,w=Math.max(1,Math.round((g.level+p)*f));for(let R=0;R<S;R+=1){const _=o()<u?1:0,U=Math.max(1,w+_),B=vM(U),G=n.pickEdge();if(!G)return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers};const F=ab(E,r(),G,n.factionId,B);if(F&&(n.addUnit(F),s.push(F),a-=1,a<=0))return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers}}}return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers}}function hc(n,a,s,r=1){const o=Number(n);return Number.isFinite(o)?Math.max(a,Math.min(s,o)):r}const C2=6;class MM{timer;interval;spawnCycles;factionId;random;makeId;difficulty;eliteOdds;cadenceDecay;multiplierGrowth;runSeconds=0;clearCount=0;boardEmpty=!0;lastClearAt=null;lastSpawnAt=null;lastCadence;lastMultiplier;rampEvaluation;rampStageIndex;currentDifficulty;cadenceScale=1;multiplierScale=1;pressureScale=1;calmUntil=null;calmSecondsRemaining=0;cadenceFloor=.3;constructor(a={}){this.factionId=a.factionId??"enemy",this.random=typeof a.random=="function"?a.random:Math.random;const s=Number.isFinite(a.difficulty)?Number(a.difficulty):1;this.difficulty=Math.max(.5,s);const r=typeof a.eliteOdds=="number"?a.eliteOdds:0;this.eliteOdds=Math.max(0,Math.min(.95,r)),this.currentDifficulty=this.difficulty,this.cadenceDecay=M2(this.currentDifficulty),this.multiplierGrowth=x2(this.currentDifficulty),this.spawnCycles=0,this.rampEvaluation=E2(this.currentDifficulty,{runSeconds:0,clears:0,spawnCycles:0}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.interval=this.rampEvaluation.cadenceTarget,this.timer=this.interval,this.lastCadence=this.interval,this.lastMultiplier=this.rampEvaluation.multiplierBase;const o=(()=>{let u=0;return()=>`e${Date.now()}-${u+=1}`})();this.makeId=typeof a.idFactory=="function"?a.idFactory:o}update(a,s,r,o,u={}){if(!Number.isFinite(a)||a<=0)return;this.runSeconds+=a,this.applyRuntimeModifiers(u),this.resolveRampState();const f=this.countActiveEnemies(s);if(this.trackClears(f),this.calmUntil!==null&&this.runSeconds<this.calmUntil){const m=this.calmUntil-this.runSeconds;this.calmSecondsRemaining=m,this.timer=Math.max(this.timer,m);return}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0),this.timer-=a;let h=0;for(;this.timer<=0&&h<C2;){const m=this.getAvailableSlots(s);if(m<=0){this.timer=Math.max(this.timer,.5);break}const p=this.resolveRampState(),g=SM(this.factionId,p.stage.bundleTier,this.random),b=this.computeMultiplier(p);if(EM({bundle:g,factionId:this.factionId,pickEdge:o,addUnit:r,makeId:this.makeId,availableSlots:m,eliteOdds:this.eliteOdds,random:this.random,difficultyMultiplier:b,rampTier:p.stage.bundleTier}).spawned.length===0){this.timer=Math.max(this.timer,.5);break}const E=this.runSeconds+this.timer;this.lastCadence=this.lastSpawnAt===null?this.interval:Math.max(.01,E-this.lastSpawnAt),this.lastSpawnAt=E,this.lastMultiplier=b,this.spawnCycles+=1,h+=1;const w=this.resolveRampState();this.interval=this.computeNextInterval(w),this.timer+=this.interval}h===C2&&this.timer<=0&&(this.timer=this.interval)}getSnapshot(){const a=this.rampEvaluation.stage;return{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles,rampStageIndex:this.rampStageIndex,rampStageId:a.id,rampStageLabel:a.label,bundleTier:a.bundleTier,cadence:this.interval,lastCadence:this.lastCadence,lastSpawnAt:this.lastSpawnAt,lastClearAt:this.lastClearAt,difficultyMultiplier:this.lastMultiplier,effectiveDifficulty:this.currentDifficulty,aggressionMultiplier:this.currentDifficulty/this.difficulty,cadenceMultiplier:this.cadenceScale,strengthMultiplier:this.multiplierScale,pressureMultiplier:this.pressureScale,calmSecondsRemaining:this.calmSecondsRemaining}}resolveRampState(){return this.rampEvaluation=E2(this.currentDifficulty,{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.rampEvaluation}applyRuntimeModifiers(a){const s=hc(a.aggressionMultiplier,.25,6,1),r=hc(a.cadenceMultiplier,.1,10,1),o=hc(a.strengthMultiplier,.1,12,1),u=hc(a.pressureMultiplier,.1,10,1),f=Number.isFinite(a.cadenceFloor)?Math.max(.1,a.cadenceFloor):this.cadenceFloor,h=Math.max(.25,this.difficulty*s);if(h!==this.currentDifficulty&&(this.currentDifficulty=h,this.cadenceDecay=M2(this.currentDifficulty),this.multiplierGrowth=x2(this.currentDifficulty),this.resolveRampState()),this.cadenceScale=r,this.multiplierScale=o,this.pressureScale=u,this.cadenceFloor=f,Object.prototype.hasOwnProperty.call(a,"calmSecondsRemaining")){const m=a.calmSecondsRemaining;m===null?this.calmUntil=null:typeof m=="number"&&Number.isFinite(m)&&m>0?this.calmUntil=this.runSeconds+m:typeof m=="number"&&m<=0&&(this.calmUntil=null)}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0)}computeNextInterval(a){const s=a.cadenceTarget*this.cadenceScale,r=Math.pow(this.spawnCycles+1,.6)*.018*this.pressureScale,o=1+Math.min(4,r),u=s/o,f=this.interval*this.cadenceDecay,h=Math.min(f,u);return Math.max(this.cadenceFloor,h)}computeMultiplier(a){const s=1+this.spawnCycles*this.multiplierGrowth*this.pressureScale,r=1+a.stageIndex*.15,o=a.multiplierBase*s*r*this.multiplierScale;return Math.min(16,Math.max(1,o))}countActiveEnemies(a){return a.filter(s=>s.faction===this.factionId&&!s.isDead()).length}getAvailableSlots(a){return kE-this.countActiveEnemies(a)}trackClears(a){if(a<=0){this.boardEmpty||(this.clearCount+=1,this.lastClearAt=this.runSeconds),this.boardEmpty=!0;return}this.boardEmpty=!1}}function xM(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(n){return console.warn("Structured telemetry storage unavailable",n),null}}function wM(n,a){const s={event:n,timestamp:Date.now(),payload:{...a}};return console.info(n,s),s}function AM(n,a,s={}){const r=xM();if(!r)return;const o=Number.isFinite(s.limit)?Math.max(1,Math.trunc(s.limit??16)):16,f=[...Uh(n)??[],a].slice(-o);try{r.setItem(n,JSON.stringify(f))}catch(h){console.warn("Failed to persist structured telemetry",{storageKey:n,error:h})}}let T2=-1,_2=-1,kf=null,Df=0,Lf=0;const CM="telemetry:enemy-scaling:summaries";function TM(n,a={}){const s=n.rampStageIndex!==T2,r=n.spawnCycles>=_2+10,o=n.lastClearAt!==null&&n.lastClearAt!==kf;if(!s&&!r&&!o)return;T2=n.rampStageIndex,_2=n.spawnCycles,kf=n.lastClearAt??kf,Df=Math.max(Df,n.difficultyMultiplier);const u=Math.max(0,Math.round(n.calmSecondsRemaining*1e3));u>Lf&&(Lf=u);const f={stage:n.rampStageLabel,stageIndex:n.rampStageIndex,bundleTier:n.bundleTier,cadenceSeconds:Number(n.cadence.toFixed(2)),lastCadenceSeconds:Number(n.lastCadence.toFixed(2)),multiplier:Number(n.difficultyMultiplier.toFixed(2)),effectiveDifficulty:Number(n.effectiveDifficulty.toFixed(2)),aggressionMultiplier:Number(n.aggressionMultiplier.toFixed(2)),cadenceMultiplier:Number(n.cadenceMultiplier.toFixed(2)),strengthMultiplier:Number(n.strengthMultiplier.toFixed(2)),pressureMultiplier:Number(n.pressureMultiplier.toFixed(2)),calmSecondsRemaining:Number(n.calmSecondsRemaining.toFixed(2)),runSeconds:Math.round(n.runSeconds),spawnCycles:n.spawnCycles,clears:n.clears,wipeSince:a.wipeSince??null,longestWipeMs:a.wipeDurationMs??0,peakMultiplier:Number(Df.toFixed(2)),longestCalmMs:Lf},h=wM("enemy-scaling",f);AM(CM,h,{limit:24})}const _M=Object.freeze({ngPlusLevel:0,unlockSlots:0}),RM={default:"Included with the sauna key",ngPlusLevel:"Reach NG+ level",unlockSlots:"Earn roster unlocks"},em=Object.freeze([{id:"ember-circuit",name:"Ember Circuit",rosterCap:3,description:"Classic cedar benches with a loyal trio of attendants.",art:{badge:Hy,glow:"linear-gradient(145deg, rgba(255,161,76,0.65), rgba(255,226,173,0.18))"},unlock:{type:"default",label:"Available from the first steam session"}},{id:"aurora-ward",name:"Aurora Ward",rosterCap:4,description:"Glacial glass benches and a quartet ready to repel sieges.",art:{badge:zy,glow:"linear-gradient(140deg, rgba(128,208,255,0.7), rgba(61,184,255,0.2))"},unlock:{type:"unlockSlots",slots:2,label:"Secure 2 roster unlocks"}},{id:"mythic-conclave",name:"Mythic Conclave",rosterCap:6,description:"Runic obsidian tiers where six legends guard the löyly.",art:{badge:By,glow:"linear-gradient(135deg, rgba(176,106,255,0.72), rgba(245,199,255,0.2))"},unlock:{type:"ngPlusLevel",level:3,label:"Prestige to NG+ level 3"}}]),Gl=em[0].id,Uf=new Map(em.map(n=>[n.id,n]));function bb(){return em}function la(n){return n&&Uf.has(n)?Uf.get(n):Uf.get(Gl)}function R2(n,a,s){if(!Number.isFinite(n))return a;const r=Math.max(a,Math.min(s,n));return Number.isNaN(r)?a:r}function mc(n){if(n.label)return n.label;const a=RM[n.type];if(!a)return"";switch(n.type){case"ngPlusLevel":return`${a} ${n.level}`;case"unlockSlots":return`${a} ${n.slots}`;default:return a}}function fr(n,a){const s=a??_M;if(n.unlock.type==="default")return{tier:n,unlocked:!0,progress:1,requirementLabel:mc(n.unlock)};if(n.unlock.type==="ngPlusLevel"){const r=R2(s.ngPlusLevel/n.unlock.level,0,1);return{tier:n,unlocked:s.ngPlusLevel>=n.unlock.level,progress:r,requirementLabel:mc(n.unlock)}}if(n.unlock.type==="unlockSlots"){const r=R2(s.unlockSlots/n.unlock.slots,0,1);return{tier:n,unlocked:s.unlockSlots>=n.unlock.slots,progress:r,requirementLabel:mc(n.unlock)}}return{tier:n,unlocked:!1,progress:0,requirementLabel:mc(n.unlock)}}const N2=["hud-grid","grid","grid-rows-[64px_1fr_80px]","grid-cols-[280px_1fr_340px]","gap-[clamp(16px,3vw,28px)]"],k2={top:["col-span-3","row-span-1","row-start-1"],left:["col-start-1","row-start-2","row-span-1"],content:["col-start-2","row-start-2","row-span-1"],right:["col-start-3","row-start-2","row-span-1"],bottom:["col-span-3","row-start-3","row-span-1"]};function NM(n,a){let s=n.querySelector("[data-hud-root]");return s||(s=a.createElement("div"),s.dataset.hudRoot="true",s.className="hud-layout-root",n.prepend(s)),s}function dl(n,a,s,r){let o=n.querySelector(`[data-hud-region="${s}"]`);return o||(o=a.createElement("div"),o.dataset.hudRegion=s,n.appendChild(o)),o.classList.add("hud-region",...r),o.parentElement!==n&&n.appendChild(o),o}function kM(n,a,s){if(s){n.classList.add(...N2);for(const[r,o]of Object.entries(k2))a[r].classList.add(...o)}else{n.classList.remove(...N2);for(const[r,o]of Object.entries(k2))a[r].classList.remove(...o)}}function mr(n){const a=n.ownerDocument??document,s=NM(n,a),r={top:dl(s,a,"top",["hud-top-row"]),left:dl(s,a,"left",["hud-actions"]),content:dl(s,a,"content",["hud-content"]),right:dl(s,a,"right",["hud-right-column"]),bottom:dl(s,a,"bottom",["hud-bottom-row"])};s.append(r.top,r.left,r.content,r.right,r.bottom);const o=n.dataset.hudVariant==="v2";if(kM(n,r,o),!o){const p=n.querySelector("#resource-bar");p&&p.parentElement!==r.right&&r.right.prepend(p)}const u=n.querySelector("#build-menu");u&&u.parentElement!==r.left&&r.left.appendChild(u);const f=n.querySelector("#build-id");f&&f.parentElement!==r.bottom&&r.bottom.appendChild(f);let h=n.querySelector(".hud-mobile-bar__tray"),m=h?.closest(".hud-mobile-bar")??null;return(!h||!m)&&(m=a.createElement("div"),m.className="hud-mobile-bar",h=a.createElement("div"),h.className="hud-mobile-bar__tray",m.appendChild(h)),m.parentElement!==r.bottom&&r.bottom.appendChild(m),{root:s,regions:r,actions:r.left,side:r.right,mobileBar:h}}const D2=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function DM(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const r=document.createElement("div");r.classList.add("sauna-control"),r.dataset.tutorialTarget="heat";const o=()=>{const ce=a.getActiveTierId?.();return la(ce??Gl).id},u=()=>a.getTierContext?.()??null,f=document.createElement("button");f.type="button",f.textContent="Sauna ♨️",f.classList.add("topbar-button","sauna-toggle"),f.setAttribute("aria-expanded","false"),r.appendChild(f);const h=document.createElement("div");h.classList.add("sauna-card","hud-card"),h.hidden=!0;const m=document.createElement("section");m.classList.add("sauna-health");const p=`sauna-health-label-${Math.floor(Math.random()*1e5)}`,g=document.createElement("div");g.classList.add("sauna-health__header");const b=document.createElement("span");b.id=p,b.classList.add("sauna-health__title"),b.textContent="Sauna Integrity",g.appendChild(b);const S=document.createElement("span");S.classList.add("sauna-health__value"),S.setAttribute("aria-live","polite"),g.appendChild(S),m.appendChild(g);const E=document.createElement("div");E.classList.add("sauna-health__bar"),E.setAttribute("role","meter"),E.setAttribute("aria-valuemin","0"),E.setAttribute("aria-labelledby",p);const w=document.createElement("div");w.classList.add("sauna-health__fill"),E.appendChild(w),m.appendChild(E);const R=document.createElement("div");R.classList.add("sauna-health__destruction"),R.hidden=!0,E.appendChild(R);const _=document.createElement("div");_.classList.add("sauna-progress");const U=document.createElement("div");U.classList.add("sauna-progress__fill"),_.appendChild(U),h.appendChild(m),h.appendChild(_);const B=bb(),G=new Map,F=document.createElement("section");F.classList.add("sauna-tier");const P=document.createElement("div");P.classList.add("sauna-tier__header");const ie=document.createElement("span");ie.classList.add("sauna-tier__title"),ie.textContent="Premium Tiers",P.appendChild(ie);const se=document.createElement("p");se.classList.add("sauna-tier__subtitle"),se.textContent="Align the löyly with your prestige to unlock lavish benches and roster headroom.",P.appendChild(se),F.appendChild(P);const le=document.createElement("div");le.classList.add("sauna-tier__grid"),F.appendChild(le);for(const ce of B){const ve=document.createElement("button");ve.type="button",ve.classList.add("sauna-tier__option"),ve.dataset.tierId=ce.id,ve.setAttribute("aria-pressed","false");const Se=document.createElement("div");Se.classList.add("sauna-tier__badge"),Se.style.setProperty("--sauna-tier-badge-image",`url(${ce.art.badge})`),ce.art.glow&&Se.style.setProperty("--sauna-tier-glow",ce.art.glow),ve.appendChild(Se);const Re=document.createElement("div");Re.classList.add("sauna-tier__copy"),ve.appendChild(Re);const Et=document.createElement("span");Et.classList.add("sauna-tier__name"),Et.textContent=ce.name,Re.appendChild(Et);const ht=document.createElement("span");ht.classList.add("sauna-tier__cap"),ht.textContent=`Cap ${ce.rosterCap}`,Re.appendChild(ht);const Tt=document.createElement("p");Tt.classList.add("sauna-tier__description"),Tt.textContent=ce.description,Re.appendChild(Tt);const ha=document.createElement("div");ha.classList.add("sauna-tier__progress");const ma=document.createElement("div");ma.classList.add("sauna-tier__progress-fill"),ha.appendChild(ma);const pa=document.createElement("span");pa.classList.add("sauna-tier__progress-label"),ha.appendChild(pa),Re.appendChild(ha);const ga=document.createElement("span");ga.classList.add("sauna-tier__requirement"),Re.appendChild(ga);const ya={tier:ce,button:ve,fill:ma,progressLabel:pa,requirement:ga,handleClick:()=>{wn(ce,ya)}};ve.addEventListener("click",ya.handleClick),G.set(ce.id,ya),le.appendChild(ve)}h.appendChild(F),Wt();const ne=document.createElement("div");ne.classList.add("sauna-roster");const Y=document.createElement("div");Y.classList.add("sauna-roster__header");const N=document.createElement("span");N.textContent="Roster Cap",N.classList.add("sauna-roster__title"),Y.appendChild(N);const L=document.createElement("span");L.classList.add("sauna-roster__value"),L.setAttribute("aria-live","polite"),Y.appendChild(L),ne.appendChild(Y);const A=document.createElement("p");A.classList.add("sauna-roster__description"),A.textContent="Tune how many attendants may be active before new recruits wait in the steam.",ne.appendChild(A);const $=`sauna-roster-${Math.floor(Math.random()*1e5)}`,H=document.createElement("label");H.classList.add("sauna-roster__label"),H.htmlFor=$,H.textContent="Active attendants";const T=document.createElement("input");T.type="range",T.id=$,T.min="0",T.step="1",T.classList.add("sauna-roster__slider");const I=document.createElement("input");I.type="number",I.min="0",I.step="1",I.inputMode="numeric",I.classList.add("sauna-roster__number");const J=document.createElement("div");J.classList.add("sauna-roster__controls"),J.appendChild(H),J.appendChild(T),J.appendChild(I),ne.appendChild(J),h.appendChild(ne);const fe=document.createElement("label");fe.classList.add("sauna-option");const M=document.createElement("input");M.type="checkbox",M.classList.add("sauna-option__input"),M.checked=n.rallyToFront,M.addEventListener("change",()=>{n.rallyToFront=M.checked}),fe.appendChild(M);const V=document.createElement("span");V.textContent="Rally to Front",V.classList.add("sauna-option__label"),fe.appendChild(V),h.appendChild(fe),r.appendChild(h);const{regions:ee}=mr(s),W=ee.top,oe=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null;let pe=!!oe?.matches;const he=(ce,ve)=>{typeof ce.addEventListener=="function"?ce.addEventListener("change",ve):typeof ce.addListener=="function"&&ce.addListener(ve)},Ie=(ce,ve)=>{typeof ce.removeEventListener=="function"?ce.removeEventListener("change",ve):typeof ce.removeListener=="function"&&ce.removeListener(ve)},Ae=ce=>{pe=!!ce.matches,m.dataset.motion=pe?"reduced":"full"};m.dataset.motion=pe?"reduced":"full",oe&&he(oe,Ae);const Ct=()=>{const ce=la(o()),ve=Math.max(0,Math.floor(ce.rosterCap)),Se=a.getRosterCapLimit?.();if(typeof Se=="number"&&Number.isFinite(Se)){const Re=Math.max(0,Math.floor(Se));return Math.max(0,Math.min(ve,Re))}return ve};function Wt(){const ce=o(),ve=u();for(const Se of G.values()){const Re=fr(Se.tier,ve),Et=Math.round(Math.max(0,Math.min(Re.progress,1))*100);Se.fill.style.width=`${Et}%`,Se.progressLabel.textContent=Re.unlocked?"Unlocked":`${Et}% ready`,Se.requirement.textContent=Re.unlocked?`Roster cap ${Se.tier.rosterCap}`:Re.requirementLabel,Se.button.dataset.state=Re.unlocked?Se.tier.id===ce?"active":"available":"locked",Se.button.setAttribute("aria-pressed",Se.tier.id===ce?"true":"false"),Se.button.setAttribute("aria-disabled",Re.unlocked?"false":"true")}}function wn(ce,ve){if(!fr(ce,u()).unlocked){ve.button.classList.remove("sauna-tier__option--denied"),ve.button.offsetWidth,ve.button.classList.add("sauna-tier__option--denied");return}(a.setActiveTierId?.(ce.id,{persist:!0})??!1)&&Yt(n.maxRosterSize,!0),Wt()}const en=(ce,ve)=>{const Se=Math.max(0,Math.min(ce,Math.floor(ve)));T.max=String(ce),T.value=String(Se),T.setAttribute("aria-valuemax",T.max),T.setAttribute("aria-valuenow",T.value),I.max=String(ce),I.value=String(Se),L.textContent=Se===0?"Paused":`${Se}`,L.dataset.state=Se===0?"paused":"active",I.setAttribute("aria-label",`Roster cap set to ${Se}`)};function Yt(ce,ve){const Se=Number(ce),Re=Ct(),Et=Number.isFinite(Se)?Math.max(0,Math.floor(Se)):0;let ht=Math.max(0,Math.min(Re,Et));return a.updateMaxRosterSize?ht=a.updateMaxRosterSize(ht,{persist:ve}):n.maxRosterSize=ht,en(Re,ht),ht}const Ft=()=>{Yt(Number(T.value),!1)},ca=()=>{Yt(Number(T.value),!0)};T.addEventListener("input",Ft),T.addEventListener("change",ca);const ua=ce=>{Yt(Number(I.value),ce)},ot=()=>{ua(!1)},da=()=>{ua(!0)},An=()=>{ua(!0)};I.addEventListener("input",ot),I.addEventListener("change",da),I.addEventListener("blur",An),Yt(n.maxRosterSize,!1);const mn=()=>{r.parentElement!==W&&W.appendChild(r);const ce=W.querySelector("#topbar");return ce&&ce.parentElement===W?(ce.nextSibling!==r&&W.insertBefore(r,ce.nextSibling),!0):!1};let $t=null;mn()||($t=new MutationObserver(()=>{mn()&&$t?.disconnect()}),$t.observe(W,{childList:!0}));const Ka=()=>{const ce=!h.hidden;h.hidden=ce,f.setAttribute("aria-expanded",String(!ce))};f.addEventListener("click",Ka);const Cn=()=>{const ce=Math.max(1,Math.floor(n.maxHealth)),ve=Math.max(0,Math.min(ce,Math.floor(Number.isFinite(n.health)?n.health:0))),Se=ce>0?ve/ce:0,Re=Math.max(0,Math.min(Se,1));w.style.width=`${Re*100}%`;const Et=D2.format(ve),ht=D2.format(ce);S.textContent=`${Et} / ${ht}`,E.setAttribute("aria-valuenow",String(ve)),E.setAttribute("aria-valuemax",String(ce)),E.setAttribute("aria-valuetext",`${Et} of ${ht} health`);const Tt=n.destroyed?"offline":Re<=.2?"critical":Re<=.55?"warning":"stable";E.dataset.level=Tt,S.dataset.state=Tt,m.dataset.state=n.destroyed?"destroyed":"active"},In=()=>{R.classList.remove("sauna-health__destruction--active"),R.hidden=!0};let Tn=null,Ue=null;const Ze=()=>{Tn!==null&&(window.clearTimeout(Tn),Tn=null),E.classList.remove("sauna-health__bar--impact")},tn=()=>{w.classList.remove("sauna-health__fill--damage")};w.addEventListener("animationend",tn);const ft=()=>{In()};R.addEventListener("animationend",ft);const us=()=>{Ze(),E.classList.add("sauna-health__bar--impact"),pe||(w.classList.remove("sauna-health__fill--damage"),w.offsetWidth,w.classList.add("sauna-health__fill--damage")),Tn=window.setTimeout(()=>{E.classList.remove("sauna-health__bar--impact"),Tn=null},pe?360:560)},pr=()=>{Ue!==null&&(window.clearTimeout(Ue),Ue=null),R.hidden=!1,R.classList.remove("sauna-health__destruction--active"),R.offsetWidth,R.classList.add("sauna-health__destruction--active"),Ue=window.setTimeout(()=>{In(),Ue=null},pe?720:1100)},ds=()=>{Cn();const ce=n.playerSpawnCooldown>0?n.playerSpawnCooldown:1,ve=1-n.playerSpawnTimer/ce;U.style.width=`${Math.max(0,Math.min(ve,1))*100}%`,M.checked=n.rallyToFront;const Se=Ct(),Re=Math.max(0,Math.min(Se,Math.floor(n.maxRosterSize)));if(Re!==n.maxRosterSize)if(a.updateMaxRosterSize){const Et=a.updateMaxRosterSize(Re,{persist:!0});en(Se,Et)}else n.maxRosterSize=Re,en(Se,Re);else en(Se,Re);Wt()};return Cn(),{update:ds,handleDamage:ce=>{Cn(),us()},handleDestroyed:ce=>{h.hidden=!1,f.setAttribute("aria-expanded","true"),Cn(),us(),pr()},dispose:()=>{$t?.disconnect(),$t=null,f.removeEventListener("click",Ka),T.removeEventListener("input",Ft),T.removeEventListener("change",ca),I.removeEventListener("input",ot),I.removeEventListener("change",da),I.removeEventListener("blur",An),oe&&Ie(oe,Ae),w.removeEventListener("animationend",tn),R.removeEventListener("animationend",ft),Ze(),Ue!==null&&(window.clearTimeout(Ue),Ue=null),In();for(const ce of G.values())ce.button.removeEventListener("click",ce.handleClick);G.clear(),r.remove()}}}function fl(n,a={}){const{iconSrc:s,description:r,srLabel:o}=a,u=document.createElement("div");if(u.classList.add("topbar-badge"),u.setAttribute("role","status"),u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),s){const b=document.createElement("img");b.src=s,b.alt=n,b.decoding="async",b.classList.add("topbar-badge-icon"),u.appendChild(b)}const f=document.createElement("div");f.classList.add("badge-text");const h=document.createElement("span");h.textContent=n,h.classList.add("badge-label"),f.appendChild(h);const m=document.createElement("span");m.textContent="0",m.classList.add("badge-value"),m.setAttribute("aria-hidden","true"),f.appendChild(m);const p=document.createElement("span");p.classList.add("badge-delta"),p.style.opacity="0",p.style.transform="translateY(-6px)",p.style.transition="opacity 0.5s ease, transform 0.5s ease",p.setAttribute("aria-hidden","true"),u.append(f,p),r&&(u.title=r);const g=o??n;return u.dataset.label=g,u.setAttribute("aria-label",`${g}: 0`),{container:u,value:m,delta:p,label:g}}function LM(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const{regions:r}=mr(s),o=r.top,u=document.createElement("div");u.id="topbar",o.prepend(u);const f=document.createElement("div");f.className="topbar-badge-row",u.appendChild(f);const h={[ae.SAUNA_BEER]:"Sauna beer bottles chilled for construction crews and eager recruits.",[ae.SAUNAKUNNIA]:"Saunakunnia—prestige earned from sauna rituals and triumphant battles.",[ae.SISU]:"Sisu—the relentless grit forged when your warriors triumph on the snow."},m=fl("Sauna Beer",{iconSrc:a.saunaBeer,description:h[ae.SAUNA_BEER],srLabel:"Sauna beer reserves"});m.container.classList.add("badge-sauna-beer");const p=fl("Sisu",{iconSrc:a.sisu,description:h[ae.SISU],srLabel:"Sisu reserves"});p.container.classList.add("badge-sisu"),p.container.dataset.tutorialTarget="sisu";const g=fl("Saunakunnia",{iconSrc:a.saunakunnia,description:h[ae.SAUNAKUNNIA],srLabel:"Saunakunnia"});g.container.classList.add("badge-sauna"),g.container.dataset.tutorialTarget="victory";const b=fl("Time");b.container.classList.add("badge-time"),b.delta.style.display="none";const S=fl("Enemy Ramp",{srLabel:"Enemy ramp intensity"});S.container.classList.add("badge-ramp"),S.delta.style.display="none",S.container.dataset.tutorialTarget="enemy-ramp",S.container.title="Enemy ramp intensity and cadence.",f.appendChild(m.container),f.appendChild(p.container),f.appendChild(g.container),f.appendChild(S.container),f.appendChild(b.container);const E=new Intl.NumberFormat("en-US"),w=new Intl.NumberFormat("en-US",{signDisplay:"exceptZero"}),R={[ae.SAUNA_BEER]:"Sauna Beer",[ae.SAUNAKUNNIA]:"Saunakunnia",[ae.SISU]:"Sisu"},_={[ae.SAUNA_BEER]:{singular:"bottle",plural:"bottles"},[ae.SAUNAKUNNIA]:{singular:"Saunakunnia",plural:"Saunakunnia"},[ae.SISU]:{singular:"Sisu",plural:"Sisu"}},U={[ae.SAUNA_BEER]:"🍺",[ae.SAUNAKUNNIA]:"⚜️",[ae.SISU]:"🔥"},B={[ae.SAUNA_BEER]:m,[ae.SAUNAKUNNIA]:g,[ae.SISU]:p},G={};let F=null;function P(A){if(F=A,!A){S.value.textContent="Stage 1 · ×1.00",S.delta.textContent="",S.delta.style.display="none",S.container.dataset.state="idle",S.container.title="Enemy ramp idle",S.container.setAttribute("aria-label","Enemy ramp idle.");return}const $=A.stage||`Stage ${A.stageIndex+1}`,H=`×${A.multiplier.toFixed(2)}`,T=`${A.cadenceSeconds.toFixed(2)}s cadence`,I=`×${A.effectiveDifficulty.toFixed(2)}`,J=A.calmSecondsRemaining>.05,fe=J?`Calm remaining: ${Math.ceil(A.calmSecondsRemaining)}s`:"Calm inactive";S.value.textContent=`${$} · ${H}`,S.delta.style.display=J?"":"none",S.delta.textContent=J?`Calm ${Math.ceil(A.calmSecondsRemaining)}s`:"",S.container.dataset.state=J?"calm":"active",S.container.title=[`Stage: ${$} (Tier ${A.bundleTier})`,`Cadence: ${T}`,`Multiplier: ${H}`,`Difficulty: ${I}`,`Aggression ×${A.aggressionMultiplier.toFixed(2)} · Cadence ×${A.cadenceMultiplier.toFixed(2)} · Strength ×${A.strengthMultiplier.toFixed(2)}`,fe,`Spawn cycles: ${A.spawnCycles}`].join(`
`),S.container.setAttribute("aria-label",[`Enemy ramp ${$}`,`Multiplier ${H}`,`Cadence ${A.cadenceSeconds.toFixed(2)} seconds`,`Difficulty ${I}`,J?`Calm remaining ${Math.ceil(A.calmSecondsRemaining)} seconds`:"Calm inactive"].join(" — "))}function ie(A,$){const H=Number.isFinite($)?$:0;return A===ae.SAUNA_BEER?Math.trunc(H):Math.max(0,Math.round(H))}function se(A,$){return E.format(ie(A,$))}function le(A,$){return $===0?"":`${w.format($)} ${U[A]}`}function ne(A,$){if($===0)return"";const H=$>0?"gained":"spent",T=E.format(Math.abs($)),I=_[A];if(I){const fe=Math.abs($)===1?I.singular:I.plural,M=R[A],V=[M];fe&&fe!==M&&V.push(fe);const ee=V.filter(Boolean).join(" ");return`${H} ${T}${ee?` ${ee}`:""}`}const J=R[A];return`${H} ${T}${J?` ${J}`:""}`}function Y(A,$,H=0){const T=B[A];if(!T)return;const I=ie(A,$),J=se(A,$);T.value.textContent=J;const fe=A===ae.SAUNA_BEER&&I<0;if(T.container.classList.toggle("topbar-badge--debt",fe),H!==0){T.delta.textContent=le(A,H),T.delta.style.opacity="1",T.delta.style.transform="translateY(0)";const ee=G[A];ee&&clearTimeout(ee),G[A]=setTimeout(()=>{T.delta.style.opacity="0",T.delta.style.transform="translateY(-6px)",delete G[A]},1e3)}else T.delta.textContent="",T.delta.style.opacity="0",T.delta.style.transform="translateY(-6px)";const M=ne(A,H),V=[`${T.label} ${J}`];if(fe){const ee=E.format(Math.abs(I)),W=_[A];if(W){const oe=Math.abs(I)===1?W.singular:W.plural,pe=oe&&oe!==R[A];V.push(pe?`Debt of ${ee} ${oe}`:`Debt of ${ee}`)}else V.push(`Debt of ${ee}`)}M&&V.push(M),T.container.setAttribute("aria-label",V.join(" — "))}Y(ae.SAUNA_BEER,n.getResource(ae.SAUNA_BEER)),Y(ae.SAUNAKUNNIA,n.getResource(ae.SAUNAKUNNIA)),Y(ae.SISU,n.getResource(ae.SISU)),P(F);const N=({resource:A,amount:$,total:H})=>{B[A]&&Y(A,H,$)};te.on("resourceChanged",N);let L=0;return{update(A){L+=A;const $=Math.floor(L/1e3),H=Math.floor($/60),T=$%60;b.value.textContent=`${H}:${T.toString().padStart(2,"0")}`},setEnemyRampSummary(A){P(A)},dispose(){te.off("resourceChanged",N),Object.values(G).forEach(A=>{A&&clearTimeout(A)}),u.remove()}}}var Of={exports:{}},hl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L2;function UM(){if(L2)return hl;L2=1;var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function s(r,o,u){var f=null;if(u!==void 0&&(f=""+u),o.key!==void 0&&(f=""+o.key),"key"in o){u={};for(var h in o)h!=="key"&&(u[h]=o[h])}else u=o;return o=u.ref,{$$typeof:n,type:r,key:f,ref:o!==void 0?o:null,props:u}}return hl.Fragment=a,hl.jsx=s,hl.jsxs=s,hl}var U2;function OM(){return U2||(U2=1,Of.exports=UM()),Of.exports}var Zt=OM(),qf={exports:{}},ml={},zf={exports:{}},Bf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O2;function qM(){return O2||(O2=1,(function(n){function a(T,I){var J=T.length;T.push(I);e:for(;0<J;){var fe=J-1>>>1,M=T[fe];if(0<o(M,I))T[fe]=I,T[J]=M,J=fe;else break e}}function s(T){return T.length===0?null:T[0]}function r(T){if(T.length===0)return null;var I=T[0],J=T.pop();if(J!==I){T[0]=J;e:for(var fe=0,M=T.length,V=M>>>1;fe<V;){var ee=2*(fe+1)-1,W=T[ee],oe=ee+1,pe=T[oe];if(0>o(W,J))oe<M&&0>o(pe,W)?(T[fe]=pe,T[oe]=J,fe=oe):(T[fe]=W,T[ee]=J,fe=ee);else if(oe<M&&0>o(pe,J))T[fe]=pe,T[oe]=J,fe=oe;else break e}}return I}function o(T,I){var J=T.sortIndex-I.sortIndex;return J!==0?J:T.id-I.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,h=f.now();n.unstable_now=function(){return f.now()-h}}var m=[],p=[],g=1,b=null,S=3,E=!1,w=!1,R=!1,_=!1,U=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,G=typeof setImmediate<"u"?setImmediate:null;function F(T){for(var I=s(p);I!==null;){if(I.callback===null)r(p);else if(I.startTime<=T)r(p),I.sortIndex=I.expirationTime,a(m,I);else break;I=s(p)}}function P(T){if(R=!1,F(T),!w)if(s(m)!==null)w=!0,ie||(ie=!0,L());else{var I=s(p);I!==null&&H(P,I.startTime-T)}}var ie=!1,se=-1,le=5,ne=-1;function Y(){return _?!0:!(n.unstable_now()-ne<le)}function N(){if(_=!1,ie){var T=n.unstable_now();ne=T;var I=!0;try{e:{w=!1,R&&(R=!1,B(se),se=-1),E=!0;var J=S;try{t:{for(F(T),b=s(m);b!==null&&!(b.expirationTime>T&&Y());){var fe=b.callback;if(typeof fe=="function"){b.callback=null,S=b.priorityLevel;var M=fe(b.expirationTime<=T);if(T=n.unstable_now(),typeof M=="function"){b.callback=M,F(T),I=!0;break t}b===s(m)&&r(m),F(T)}else r(m);b=s(m)}if(b!==null)I=!0;else{var V=s(p);V!==null&&H(P,V.startTime-T),I=!1}}break e}finally{b=null,S=J,E=!1}I=void 0}}finally{I?L():ie=!1}}}var L;if(typeof G=="function")L=function(){G(N)};else if(typeof MessageChannel<"u"){var A=new MessageChannel,$=A.port2;A.port1.onmessage=N,L=function(){$.postMessage(null)}}else L=function(){U(N,0)};function H(T,I){se=U(function(){T(n.unstable_now())},I)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(T){T.callback=null},n.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):le=0<T?Math.floor(1e3/T):5},n.unstable_getCurrentPriorityLevel=function(){return S},n.unstable_next=function(T){switch(S){case 1:case 2:case 3:var I=3;break;default:I=S}var J=S;S=I;try{return T()}finally{S=J}},n.unstable_requestPaint=function(){_=!0},n.unstable_runWithPriority=function(T,I){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var J=S;S=T;try{return I()}finally{S=J}},n.unstable_scheduleCallback=function(T,I,J){var fe=n.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?fe+J:fe):J=fe,T){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=J+M,T={id:g++,callback:I,priorityLevel:T,startTime:J,expirationTime:M,sortIndex:-1},J>fe?(T.sortIndex=J,a(p,T),s(m)===null&&T===s(p)&&(R?(B(se),se=-1):R=!0,H(P,J-fe))):(T.sortIndex=M,a(m,T),w||E||(w=!0,ie||(ie=!0,L()))),T},n.unstable_shouldYield=Y,n.unstable_wrapCallback=function(T){var I=S;return function(){var J=S;S=I;try{return T.apply(this,arguments)}finally{S=J}}}})(Bf)),Bf}var q2;function zM(){return q2||(q2=1,zf.exports=qM()),zf.exports}var Hf={exports:{}},Ee={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z2;function BM(){if(z2)return Ee;z2=1;var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),b=Symbol.iterator;function S(M){return M===null||typeof M!="object"?null:(M=b&&M[b]||M["@@iterator"],typeof M=="function"?M:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,R={};function _(M,V,ee){this.props=M,this.context=V,this.refs=R,this.updater=ee||E}_.prototype.isReactComponent={},_.prototype.setState=function(M,V){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,V,"setState")},_.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function U(){}U.prototype=_.prototype;function B(M,V,ee){this.props=M,this.context=V,this.refs=R,this.updater=ee||E}var G=B.prototype=new U;G.constructor=B,w(G,_.prototype),G.isPureReactComponent=!0;var F=Array.isArray,P={H:null,A:null,T:null,S:null,V:null},ie=Object.prototype.hasOwnProperty;function se(M,V,ee,W,oe,pe){return ee=pe.ref,{$$typeof:n,type:M,key:V,ref:ee!==void 0?ee:null,props:pe}}function le(M,V){return se(M.type,V,void 0,void 0,void 0,M.props)}function ne(M){return typeof M=="object"&&M!==null&&M.$$typeof===n}function Y(M){var V={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(ee){return V[ee]})}var N=/\/+/g;function L(M,V){return typeof M=="object"&&M!==null&&M.key!=null?Y(""+M.key):V.toString(36)}function A(){}function $(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(A,A):(M.status="pending",M.then(function(V){M.status==="pending"&&(M.status="fulfilled",M.value=V)},function(V){M.status==="pending"&&(M.status="rejected",M.reason=V)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function H(M,V,ee,W,oe){var pe=typeof M;(pe==="undefined"||pe==="boolean")&&(M=null);var he=!1;if(M===null)he=!0;else switch(pe){case"bigint":case"string":case"number":he=!0;break;case"object":switch(M.$$typeof){case n:case a:he=!0;break;case g:return he=M._init,H(he(M._payload),V,ee,W,oe)}}if(he)return oe=oe(M),he=W===""?"."+L(M,0):W,F(oe)?(ee="",he!=null&&(ee=he.replace(N,"$&/")+"/"),H(oe,V,ee,"",function(Ct){return Ct})):oe!=null&&(ne(oe)&&(oe=le(oe,ee+(oe.key==null||M&&M.key===oe.key?"":(""+oe.key).replace(N,"$&/")+"/")+he)),V.push(oe)),1;he=0;var Ie=W===""?".":W+":";if(F(M))for(var Ae=0;Ae<M.length;Ae++)W=M[Ae],pe=Ie+L(W,Ae),he+=H(W,V,ee,pe,oe);else if(Ae=S(M),typeof Ae=="function")for(M=Ae.call(M),Ae=0;!(W=M.next()).done;)W=W.value,pe=Ie+L(W,Ae++),he+=H(W,V,ee,pe,oe);else if(pe==="object"){if(typeof M.then=="function")return H($(M),V,ee,W,oe);throw V=String(M),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return he}function T(M,V,ee){if(M==null)return M;var W=[],oe=0;return H(M,W,"","",function(pe){return V.call(ee,pe,oe++)}),W}function I(M){if(M._status===-1){var V=M._result;V=V(),V.then(function(ee){(M._status===0||M._status===-1)&&(M._status=1,M._result=ee)},function(ee){(M._status===0||M._status===-1)&&(M._status=2,M._result=ee)}),M._status===-1&&(M._status=0,M._result=V)}if(M._status===1)return M._result.default;throw M._result}var J=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)};function fe(){}return Ee.Children={map:T,forEach:function(M,V,ee){T(M,function(){V.apply(this,arguments)},ee)},count:function(M){var V=0;return T(M,function(){V++}),V},toArray:function(M){return T(M,function(V){return V})||[]},only:function(M){if(!ne(M))throw Error("React.Children.only expected to receive a single React element child.");return M}},Ee.Component=_,Ee.Fragment=s,Ee.Profiler=o,Ee.PureComponent=B,Ee.StrictMode=r,Ee.Suspense=m,Ee.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,Ee.__COMPILER_RUNTIME={__proto__:null,c:function(M){return P.H.useMemoCache(M)}},Ee.cache=function(M){return function(){return M.apply(null,arguments)}},Ee.cloneElement=function(M,V,ee){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var W=w({},M.props),oe=M.key,pe=void 0;if(V!=null)for(he in V.ref!==void 0&&(pe=void 0),V.key!==void 0&&(oe=""+V.key),V)!ie.call(V,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&V.ref===void 0||(W[he]=V[he]);var he=arguments.length-2;if(he===1)W.children=ee;else if(1<he){for(var Ie=Array(he),Ae=0;Ae<he;Ae++)Ie[Ae]=arguments[Ae+2];W.children=Ie}return se(M.type,oe,void 0,void 0,pe,W)},Ee.createContext=function(M){return M={$$typeof:f,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:u,_context:M},M},Ee.createElement=function(M,V,ee){var W,oe={},pe=null;if(V!=null)for(W in V.key!==void 0&&(pe=""+V.key),V)ie.call(V,W)&&W!=="key"&&W!=="__self"&&W!=="__source"&&(oe[W]=V[W]);var he=arguments.length-2;if(he===1)oe.children=ee;else if(1<he){for(var Ie=Array(he),Ae=0;Ae<he;Ae++)Ie[Ae]=arguments[Ae+2];oe.children=Ie}if(M&&M.defaultProps)for(W in he=M.defaultProps,he)oe[W]===void 0&&(oe[W]=he[W]);return se(M,pe,void 0,void 0,null,oe)},Ee.createRef=function(){return{current:null}},Ee.forwardRef=function(M){return{$$typeof:h,render:M}},Ee.isValidElement=ne,Ee.lazy=function(M){return{$$typeof:g,_payload:{_status:-1,_result:M},_init:I}},Ee.memo=function(M,V){return{$$typeof:p,type:M,compare:V===void 0?null:V}},Ee.startTransition=function(M){var V=P.T,ee={};P.T=ee;try{var W=M(),oe=P.S;oe!==null&&oe(ee,W),typeof W=="object"&&W!==null&&typeof W.then=="function"&&W.then(fe,J)}catch(pe){J(pe)}finally{P.T=V}},Ee.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},Ee.use=function(M){return P.H.use(M)},Ee.useActionState=function(M,V,ee){return P.H.useActionState(M,V,ee)},Ee.useCallback=function(M,V){return P.H.useCallback(M,V)},Ee.useContext=function(M){return P.H.useContext(M)},Ee.useDebugValue=function(){},Ee.useDeferredValue=function(M,V){return P.H.useDeferredValue(M,V)},Ee.useEffect=function(M,V,ee){var W=P.H;if(typeof ee=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return W.useEffect(M,V)},Ee.useId=function(){return P.H.useId()},Ee.useImperativeHandle=function(M,V,ee){return P.H.useImperativeHandle(M,V,ee)},Ee.useInsertionEffect=function(M,V){return P.H.useInsertionEffect(M,V)},Ee.useLayoutEffect=function(M,V){return P.H.useLayoutEffect(M,V)},Ee.useMemo=function(M,V){return P.H.useMemo(M,V)},Ee.useOptimistic=function(M,V){return P.H.useOptimistic(M,V)},Ee.useReducer=function(M,V,ee){return P.H.useReducer(M,V,ee)},Ee.useRef=function(M){return P.H.useRef(M)},Ee.useState=function(M){return P.H.useState(M)},Ee.useSyncExternalStore=function(M,V,ee){return P.H.useSyncExternalStore(M,V,ee)},Ee.useTransition=function(){return P.H.useTransition()},Ee.version="19.1.1",Ee}var B2;function tm(){return B2||(B2=1,Hf.exports=BM()),Hf.exports}var jf={exports:{}},Lt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H2;function HM(){if(H2)return Lt;H2=1;var n=tm();function a(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var r={d:{f:s,r:function(){throw Error(a(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(m,p,g){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:b==null?null:""+b,children:m,containerInfo:p,implementation:g}}var f=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Lt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Lt.createPortal=function(m,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(a(299));return u(m,p,null,g)},Lt.flushSync=function(m){var p=f.T,g=r.p;try{if(f.T=null,r.p=2,m)return m()}finally{f.T=p,r.p=g,r.d.f()}},Lt.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,r.d.C(m,p))},Lt.prefetchDNS=function(m){typeof m=="string"&&r.d.D(m)},Lt.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var g=p.as,b=h(g,p.crossOrigin),S=typeof p.integrity=="string"?p.integrity:void 0,E=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;g==="style"?r.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:b,integrity:S,fetchPriority:E}):g==="script"&&r.d.X(m,{crossOrigin:b,integrity:S,fetchPriority:E,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Lt.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var g=h(p.as,p.crossOrigin);r.d.M(m,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&r.d.M(m)},Lt.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var g=p.as,b=h(g,p.crossOrigin);r.d.L(m,g,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Lt.preloadModule=function(m,p){if(typeof m=="string")if(p){var g=h(p.as,p.crossOrigin);r.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else r.d.m(m)},Lt.requestFormReset=function(m){r.d.r(m)},Lt.unstable_batchedUpdates=function(m,p){return m(p)},Lt.useFormState=function(m,p,g){return f.H.useFormState(m,p,g)},Lt.useFormStatus=function(){return f.H.useHostTransitionStatus()},Lt.version="19.1.1",Lt}var j2;function jM(){if(j2)return jf.exports;j2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(a){console.error(a)}}return n(),jf.exports=HM(),jf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G2;function GM(){if(G2)return ml;G2=1;var n=zM(),a=tm(),s=jM();function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function f(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(r(188))}function m(e){var t=e.alternate;if(!t){if(t=u(e),t===null)throw Error(r(188));return t!==e?null:e}for(var i=e,l=t;;){var c=i.return;if(c===null)break;var d=c.alternate;if(d===null){if(l=c.return,l!==null){i=l;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===i)return h(c),e;if(d===l)return h(c),t;d=d.sibling}throw Error(r(188))}if(i.return!==l.return)i=c,l=d;else{for(var y=!1,v=c.child;v;){if(v===i){y=!0,i=c,l=d;break}if(v===l){y=!0,l=c,i=d;break}v=v.sibling}if(!y){for(v=d.child;v;){if(v===i){y=!0,i=d,l=c;break}if(v===l){y=!0,l=d,i=c;break}v=v.sibling}if(!y)throw Error(r(189))}}if(i.alternate!==l)throw Error(r(190))}if(i.tag!==3)throw Error(r(188));return i.stateNode.current===i?e:t}function p(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=p(e),t!==null)return t;e=e.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),U=Symbol.for("react.provider"),B=Symbol.for("react.consumer"),G=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),ie=Symbol.for("react.suspense_list"),se=Symbol.for("react.memo"),le=Symbol.for("react.lazy"),ne=Symbol.for("react.activity"),Y=Symbol.for("react.memo_cache_sentinel"),N=Symbol.iterator;function L(e){return e===null||typeof e!="object"?null:(e=N&&e[N]||e["@@iterator"],typeof e=="function"?e:null)}var A=Symbol.for("react.client.reference");function $(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===A?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case w:return"Fragment";case _:return"Profiler";case R:return"StrictMode";case P:return"Suspense";case ie:return"SuspenseList";case ne:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case E:return"Portal";case G:return(e.displayName||"Context")+".Provider";case B:return(e._context.displayName||"Context")+".Consumer";case F:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case se:return t=e.displayName||null,t!==null?t:$(e.type)||"Memo";case le:t=e._payload,e=e._init;try{return $(e(t))}catch{}}return null}var H=Array.isArray,T=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},fe=[],M=-1;function V(e){return{current:e}}function ee(e){0>M||(e.current=fe[M],fe[M]=null,M--)}function W(e,t){M++,fe[M]=e.current,e.current=t}var oe=V(null),pe=V(null),he=V(null),Ie=V(null);function Ae(e,t){switch(W(he,t),W(pe,e),W(oe,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?vg(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=vg(t),e=Sg(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}ee(oe),W(oe,e)}function Ct(){ee(oe),ee(pe),ee(he)}function Wt(e){e.memoizedState!==null&&W(Ie,e);var t=oe.current,i=Sg(t,e.type);t!==i&&(W(pe,e),W(oe,i))}function wn(e){pe.current===e&&(ee(oe),ee(pe)),Ie.current===e&&(ee(Ie),al._currentValue=J)}var en=Object.prototype.hasOwnProperty,Yt=n.unstable_scheduleCallback,Ft=n.unstable_cancelCallback,ca=n.unstable_shouldYield,ua=n.unstable_requestPaint,ot=n.unstable_now,da=n.unstable_getCurrentPriorityLevel,An=n.unstable_ImmediatePriority,mn=n.unstable_UserBlockingPriority,$t=n.unstable_NormalPriority,Ka=n.unstable_LowPriority,Cn=n.unstable_IdlePriority,In=n.log,Tn=n.unstable_setDisableYieldValue,Ue=null,Ze=null;function tn(e){if(typeof In=="function"&&Tn(e),Ze&&typeof Ze.setStrictMode=="function")try{Ze.setStrictMode(Ue,e)}catch{}}var ft=Math.clz32?Math.clz32:ds,us=Math.log,pr=Math.LN2;function ds(e){return e>>>=0,e===0?32:31-(us(e)/pr|0)|0}var Ri=256,fa=4194304;function _n(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ce(e,t,i){var l=e.pendingLanes;if(l===0)return 0;var c=0,d=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var v=l&134217727;return v!==0?(l=v&~d,l!==0?c=_n(l):(y&=v,y!==0?c=_n(y):i||(i=v&~e,i!==0&&(c=_n(i))))):(v=l&~d,v!==0?c=_n(v):y!==0?c=_n(y):i||(i=l&~e,i!==0&&(c=_n(i)))),c===0?0:t!==0&&t!==c&&(t&d)===0&&(d=c&-c,i=t&-t,d>=i||d===32&&(i&4194048)!==0)?t:c}function ve(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Se(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Re(){var e=Ri;return Ri<<=1,(Ri&4194048)===0&&(Ri=256),e}function Et(){var e=fa;return fa<<=1,(fa&62914560)===0&&(fa=4194304),e}function ht(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Tt(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function ha(e,t,i,l,c,d){var y=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var v=e.entanglements,x=e.expirationTimes,q=e.hiddenUpdates;for(i=y&~i;0<i;){var K=31-ft(i),Z=1<<K;v[K]=0,x[K]=-1;var z=q[K];if(z!==null)for(q[K]=null,K=0;K<z.length;K++){var j=z[K];j!==null&&(j.lane&=-536870913)}i&=~Z}l!==0&&ma(e,l,0),d!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=d&~(y&~t))}function ma(e,t,i){e.pendingLanes|=t,e.suspendedLanes&=~t;var l=31-ft(t);e.entangledLanes|=t,e.entanglements[l]=e.entanglements[l]|1073741824|i&4194090}function pa(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var l=31-ft(i),c=1<<l;c&t|e[l]&t&&(e[l]|=t),i&=~c}}function ga(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ya(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Yl(){var e=I.p;return e!==0?e:(e=window.event,e===void 0?32:Hg(e.type))}function Fl(e,t){var i=I.p;try{return I.p=e,t()}finally{I.p=i}}var Yn=Math.random().toString(36).slice(2),Je="__reactFiber$"+Yn,mt="__reactProps$"+Yn,ba="__reactContainer$"+Yn,Qa="__reactEvents$"+Yn,Rn="__reactListeners$"+Yn,fs="__reactHandles$"+Yn,Ni="__reactResources$"+Yn,ki="__reactMarker$"+Yn;function hs(e){delete e[Je],delete e[mt],delete e[Qa],delete e[Rn],delete e[fs]}function va(e){var t=e[Je];if(t)return t;for(var i=e.parentNode;i;){if(t=i[ba]||i[Je]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=wg(e);e!==null;){if(i=e[Je])return i;e=wg(e)}return t}e=i,i=e.parentNode}return null}function Pa(e){if(e=e[Je]||e[ba]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function Sa(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(r(33))}function Ea(e){var t=e[Ni];return t||(t=e[Ni]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function We(e){e[ki]=!0}var ms=new Set,$l={};function Fn(e,t){Za(e,t),Za(e+"Capture",t)}function Za(e,t){for($l[e]=t,e=0;e<t.length;e++)ms.add(t[e])}var Vl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Xl={},Kl={};function Ql(e){return en.call(Kl,e)?!0:en.call(Xl,e)?!1:Vl.test(e)?Kl[e]=!0:(Xl[e]=!0,!1)}function Di(e,t,i){if(Ql(t))if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var l=t.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+i)}}function Li(e,t,i){if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+i)}}function Nn(e,t,i,l){if(l===null)e.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(t,i,""+l)}}var Pl,k;function X(e){if(Pl===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);Pl=t&&t[1]||"",k=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Pl+e+k}var re=!1;function de(e,t){if(!e||re)return"";re=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(t){var Z=function(){throw Error()};if(Object.defineProperty(Z.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Z,[])}catch(j){var z=j}Reflect.construct(e,[],Z)}else{try{Z.call()}catch(j){z=j}e.call(Z.prototype)}}else{try{throw Error()}catch(j){z=j}(Z=e())&&typeof Z.catch=="function"&&Z.catch(function(){})}}catch(j){if(j&&z&&typeof j.stack=="string")return[j.stack,z.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=l.DetermineComponentFrameRoot(),y=d[0],v=d[1];if(y&&v){var x=y.split(`
`),q=v.split(`
`);for(c=l=0;l<x.length&&!x[l].includes("DetermineComponentFrameRoot");)l++;for(;c<q.length&&!q[c].includes("DetermineComponentFrameRoot");)c++;if(l===x.length||c===q.length)for(l=x.length-1,c=q.length-1;1<=l&&0<=c&&x[l]!==q[c];)c--;for(;1<=l&&0<=c;l--,c--)if(x[l]!==q[c]){if(l!==1||c!==1)do if(l--,c--,0>c||x[l]!==q[c]){var K=`
`+x[l].replace(" at new "," at ");return e.displayName&&K.includes("<anonymous>")&&(K=K.replace("<anonymous>",e.displayName)),K}while(1<=l&&0<=c);break}}}finally{re=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?X(i):""}function Ne(e){switch(e.tag){case 26:case 27:case 5:return X(e.type);case 16:return X("Lazy");case 13:return X("Suspense");case 19:return X("SuspenseList");case 0:case 15:return de(e.type,!1);case 11:return de(e.type.render,!1);case 1:return de(e.type,!0);case 31:return X("Activity");default:return""}}function Ye(e){try{var t="";do t+=Ne(e),e=e.return;while(e);return t}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function _e(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function et(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function nn(e){var t=et(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),l=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var c=i.get,d=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(y){l=""+y,d.call(this,y)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return l},setValue:function(y){l=""+y},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Mt(e){e._valueTracker||(e._valueTracker=nn(e))}function an(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),l="";return e&&(l=et(e)?e.checked?"true":"false":e.value),e=l,e!==i?(t.setValue(e),!0):!1}function sn(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Ui=/[\n"\\]/g;function pt(e){return e.replace(Ui,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function tt(e,t,i,l,c,d,y,v){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),t!=null?y==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+_e(t)):e.value!==""+_e(t)&&(e.value=""+_e(t)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),t!=null?Wa(e,y,_e(t)):i!=null?Wa(e,y,_e(i)):l!=null&&e.removeAttribute("value"),c==null&&d!=null&&(e.defaultChecked=!!d),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?e.name=""+_e(v):e.removeAttribute("name")}function Ja(e,t,i,l,c,d,y,v){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),t!=null||i!=null){if(!(d!=="submit"&&d!=="reset"||t!=null))return;i=i!=null?""+_e(i):"",t=t!=null?""+_e(t):i,v||t===e.value||(e.value=t),e.defaultValue=t}l=l??c,l=typeof l!="function"&&typeof l!="symbol"&&!!l,e.checked=v?e.checked:!!l,e.defaultChecked=!!l,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y)}function Wa(e,t,i){t==="number"&&sn(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function Ma(e,t,i,l){if(e=e.options,t){t={};for(var c=0;c<i.length;c++)t["$"+i[c]]=!0;for(i=0;i<e.length;i++)c=t.hasOwnProperty("$"+e[i].value),e[i].selected!==c&&(e[i].selected=c),c&&l&&(e[i].defaultSelected=!0)}else{for(i=""+_e(i),t=null,c=0;c<e.length;c++){if(e[c].value===i){e[c].selected=!0,l&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function $n(e,t,i){if(t!=null&&(t=""+_e(t),t!==e.value&&(e.value=t),i==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=i!=null?""+_e(i):""}function Zl(e,t,i,l){if(t==null){if(l!=null){if(i!=null)throw Error(r(92));if(H(l)){if(1<l.length)throw Error(r(93));l=l[0]}i=l}i==null&&(i=""),t=i}i=_e(t),e.defaultValue=i,l=e.textContent,l===i&&l!==""&&l!==null&&(e.value=l)}function ps(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var Yv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function vm(e,t,i){var l=t.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?l?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":l?e.setProperty(t,i):typeof i!="number"||i===0||Yv.has(t)?t==="float"?e.cssFloat=i:e[t]=(""+i).trim():e[t]=i+"px"}function Sm(e,t,i){if(t!=null&&typeof t!="object")throw Error(r(62));if(e=e.style,i!=null){for(var l in i)!i.hasOwnProperty(l)||t!=null&&t.hasOwnProperty(l)||(l.indexOf("--")===0?e.setProperty(l,""):l==="float"?e.cssFloat="":e[l]="");for(var c in t)l=t[c],t.hasOwnProperty(c)&&i[c]!==l&&vm(e,c,l)}else for(var d in t)t.hasOwnProperty(d)&&vm(e,d,t[d])}function bu(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),$v=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Jl(e){return $v.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var vu=null;function Su(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var gs=null,ys=null;function Em(e){var t=Pa(e);if(t&&(e=t.stateNode)){var i=e[mt]||null;e:switch(e=t.stateNode,t.type){case"input":if(tt(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+pt(""+t)+'"][type="radio"]'),t=0;t<i.length;t++){var l=i[t];if(l!==e&&l.form===e.form){var c=l[mt]||null;if(!c)throw Error(r(90));tt(l,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(t=0;t<i.length;t++)l=i[t],l.form===e.form&&an(l)}break e;case"textarea":$n(e,i.value,i.defaultValue);break e;case"select":t=i.value,t!=null&&Ma(e,!!i.multiple,t,!1)}}}var Eu=!1;function Mm(e,t,i){if(Eu)return e(t,i);Eu=!0;try{var l=e(t);return l}finally{if(Eu=!1,(gs!==null||ys!==null)&&(Bo(),gs&&(t=gs,e=ys,ys=gs=null,Em(t),e)))for(t=0;t<e.length;t++)Em(e[t])}}function gr(e,t){var i=e.stateNode;if(i===null)return null;var l=i[mt]||null;if(l===null)return null;i=l[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(r(231,t,typeof i));return i}var xa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mu=!1;if(xa)try{var yr={};Object.defineProperty(yr,"passive",{get:function(){Mu=!0}}),window.addEventListener("test",yr,yr),window.removeEventListener("test",yr,yr)}catch{Mu=!1}var ei=null,xu=null,Wl=null;function xm(){if(Wl)return Wl;var e,t=xu,i=t.length,l,c="value"in ei?ei.value:ei.textContent,d=c.length;for(e=0;e<i&&t[e]===c[e];e++);var y=i-e;for(l=1;l<=y&&t[i-l]===c[d-l];l++);return Wl=c.slice(e,1<l?1-l:void 0)}function eo(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function to(){return!0}function wm(){return!1}function Vt(e){function t(i,l,c,d,y){this._reactName=i,this._targetInst=c,this.type=l,this.nativeEvent=d,this.target=y,this.currentTarget=null;for(var v in e)e.hasOwnProperty(v)&&(i=e[v],this[v]=i?i(d):d[v]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?to:wm,this.isPropagationStopped=wm,this}return g(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=to)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=to)},persist:function(){},isPersistent:to}),t}var Oi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},no=Vt(Oi),br=g({},Oi,{view:0,detail:0}),Vv=Vt(br),wu,Au,vr,ao=g({},br,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==vr&&(vr&&e.type==="mousemove"?(wu=e.screenX-vr.screenX,Au=e.screenY-vr.screenY):Au=wu=0,vr=e),wu)},movementY:function(e){return"movementY"in e?e.movementY:Au}}),Am=Vt(ao),Xv=g({},ao,{dataTransfer:0}),Kv=Vt(Xv),Qv=g({},br,{relatedTarget:0}),Cu=Vt(Qv),Pv=g({},Oi,{animationName:0,elapsedTime:0,pseudoElement:0}),Zv=Vt(Pv),Jv=g({},Oi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Wv=Vt(Jv),e1=g({},Oi,{data:0}),Cm=Vt(e1),t1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},n1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},a1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function i1(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=a1[e])?!!t[e]:!1}function Tu(){return i1}var s1=g({},br,{key:function(e){if(e.key){var t=t1[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=eo(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?n1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tu,charCode:function(e){return e.type==="keypress"?eo(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?eo(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),r1=Vt(s1),l1=g({},ao,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tm=Vt(l1),o1=g({},br,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tu}),c1=Vt(o1),u1=g({},Oi,{propertyName:0,elapsedTime:0,pseudoElement:0}),d1=Vt(u1),f1=g({},ao,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),h1=Vt(f1),m1=g({},Oi,{newState:0,oldState:0}),p1=Vt(m1),g1=[9,13,27,32],_u=xa&&"CompositionEvent"in window,Sr=null;xa&&"documentMode"in document&&(Sr=document.documentMode);var y1=xa&&"TextEvent"in window&&!Sr,_m=xa&&(!_u||Sr&&8<Sr&&11>=Sr),Rm=" ",Nm=!1;function km(e,t){switch(e){case"keyup":return g1.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var bs=!1;function b1(e,t){switch(e){case"compositionend":return Dm(t);case"keypress":return t.which!==32?null:(Nm=!0,Rm);case"textInput":return e=t.data,e===Rm&&Nm?null:e;default:return null}}function v1(e,t){if(bs)return e==="compositionend"||!_u&&km(e,t)?(e=xm(),Wl=xu=ei=null,bs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return _m&&t.locale!=="ko"?null:t.data;default:return null}}var S1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!S1[e.type]:t==="textarea"}function Um(e,t,i,l){gs?ys?ys.push(l):ys=[l]:gs=l,t=Fo(t,"onChange"),0<t.length&&(i=new no("onChange","change",null,i,l),e.push({event:i,listeners:t}))}var Er=null,Mr=null;function E1(e){mg(e,0)}function io(e){var t=Sa(e);if(an(t))return e}function Om(e,t){if(e==="change")return t}var qm=!1;if(xa){var Ru;if(xa){var Nu="oninput"in document;if(!Nu){var zm=document.createElement("div");zm.setAttribute("oninput","return;"),Nu=typeof zm.oninput=="function"}Ru=Nu}else Ru=!1;qm=Ru&&(!document.documentMode||9<document.documentMode)}function Bm(){Er&&(Er.detachEvent("onpropertychange",Hm),Mr=Er=null)}function Hm(e){if(e.propertyName==="value"&&io(Mr)){var t=[];Um(t,Mr,e,Su(e)),Mm(E1,t)}}function M1(e,t,i){e==="focusin"?(Bm(),Er=t,Mr=i,Er.attachEvent("onpropertychange",Hm)):e==="focusout"&&Bm()}function x1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return io(Mr)}function w1(e,t){if(e==="click")return io(t)}function A1(e,t){if(e==="input"||e==="change")return io(t)}function C1(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var rn=typeof Object.is=="function"?Object.is:C1;function xr(e,t){if(rn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),l=Object.keys(t);if(i.length!==l.length)return!1;for(l=0;l<i.length;l++){var c=i[l];if(!en.call(t,c)||!rn(e[c],t[c]))return!1}return!0}function jm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Gm(e,t){var i=jm(e);e=0;for(var l;i;){if(i.nodeType===3){if(l=e+i.textContent.length,e<=t&&l>=t)return{node:i,offset:t-e};e=l}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=jm(i)}}function Im(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Im(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Ym(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=sn(e.document);t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=sn(e.document)}return t}function ku(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var T1=xa&&"documentMode"in document&&11>=document.documentMode,vs=null,Du=null,wr=null,Lu=!1;function Fm(e,t,i){var l=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Lu||vs==null||vs!==sn(l)||(l=vs,"selectionStart"in l&&ku(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),wr&&xr(wr,l)||(wr=l,l=Fo(Du,"onSelect"),0<l.length&&(t=new no("onSelect","select",null,t,i),e.push({event:t,listeners:l}),t.target=vs)))}function qi(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Ss={animationend:qi("Animation","AnimationEnd"),animationiteration:qi("Animation","AnimationIteration"),animationstart:qi("Animation","AnimationStart"),transitionrun:qi("Transition","TransitionRun"),transitionstart:qi("Transition","TransitionStart"),transitioncancel:qi("Transition","TransitionCancel"),transitionend:qi("Transition","TransitionEnd")},Uu={},$m={};xa&&($m=document.createElement("div").style,"AnimationEvent"in window||(delete Ss.animationend.animation,delete Ss.animationiteration.animation,delete Ss.animationstart.animation),"TransitionEvent"in window||delete Ss.transitionend.transition);function zi(e){if(Uu[e])return Uu[e];if(!Ss[e])return e;var t=Ss[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in $m)return Uu[e]=t[i];return e}var Vm=zi("animationend"),Xm=zi("animationiteration"),Km=zi("animationstart"),_1=zi("transitionrun"),R1=zi("transitionstart"),N1=zi("transitioncancel"),Qm=zi("transitionend"),Pm=new Map,Ou="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ou.push("scrollEnd");function kn(e,t){Pm.set(e,t),Fn(t,[e])}var Zm=new WeakMap;function pn(e,t){if(typeof e=="object"&&e!==null){var i=Zm.get(e);return i!==void 0?i:(t={value:e,source:t,stack:Ye(t)},Zm.set(e,t),t)}return{value:e,source:t,stack:Ye(t)}}var gn=[],Es=0,qu=0;function so(){for(var e=Es,t=qu=Es=0;t<e;){var i=gn[t];gn[t++]=null;var l=gn[t];gn[t++]=null;var c=gn[t];gn[t++]=null;var d=gn[t];if(gn[t++]=null,l!==null&&c!==null){var y=l.pending;y===null?c.next=c:(c.next=y.next,y.next=c),l.pending=c}d!==0&&Jm(i,c,d)}}function ro(e,t,i,l){gn[Es++]=e,gn[Es++]=t,gn[Es++]=i,gn[Es++]=l,qu|=l,e.lanes|=l,e=e.alternate,e!==null&&(e.lanes|=l)}function zu(e,t,i,l){return ro(e,t,i,l),lo(e)}function Ms(e,t){return ro(e,null,null,t),lo(e)}function Jm(e,t,i){e.lanes|=i;var l=e.alternate;l!==null&&(l.lanes|=i);for(var c=!1,d=e.return;d!==null;)d.childLanes|=i,l=d.alternate,l!==null&&(l.childLanes|=i),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(c=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,c&&t!==null&&(c=31-ft(i),e=d.hiddenUpdates,l=e[c],l===null?e[c]=[t]:l.push(t),t.lane=i|536870912),d):null}function lo(e){if(50<Qr)throw Qr=0,Yd=null,Error(r(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var xs={};function k1(e,t,i,l){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ln(e,t,i,l){return new k1(e,t,i,l)}function Bu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function wa(e,t){var i=e.alternate;return i===null?(i=ln(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function Wm(e,t){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,t=i.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function oo(e,t,i,l,c,d){var y=0;if(l=e,typeof e=="function")Bu(e)&&(y=1);else if(typeof e=="string")y=LS(e,i,oe.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ne:return e=ln(31,i,t,c),e.elementType=ne,e.lanes=d,e;case w:return Bi(i.children,c,d,t);case R:y=8,c|=24;break;case _:return e=ln(12,i,t,c|2),e.elementType=_,e.lanes=d,e;case P:return e=ln(13,i,t,c),e.elementType=P,e.lanes=d,e;case ie:return e=ln(19,i,t,c),e.elementType=ie,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case U:case G:y=10;break e;case B:y=9;break e;case F:y=11;break e;case se:y=14;break e;case le:y=16,l=null;break e}y=29,i=Error(r(130,e===null?"null":typeof e,"")),l=null}return t=ln(y,i,t,c),t.elementType=e,t.type=l,t.lanes=d,t}function Bi(e,t,i,l){return e=ln(7,e,l,t),e.lanes=i,e}function Hu(e,t,i){return e=ln(6,e,null,t),e.lanes=i,e}function ju(e,t,i){return t=ln(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var ws=[],As=0,co=null,uo=0,yn=[],bn=0,Hi=null,Aa=1,Ca="";function ji(e,t){ws[As++]=uo,ws[As++]=co,co=e,uo=t}function e0(e,t,i){yn[bn++]=Aa,yn[bn++]=Ca,yn[bn++]=Hi,Hi=e;var l=Aa;e=Ca;var c=32-ft(l)-1;l&=~(1<<c),i+=1;var d=32-ft(t)+c;if(30<d){var y=c-c%5;d=(l&(1<<y)-1).toString(32),l>>=y,c-=y,Aa=1<<32-ft(t)+c|i<<c|l,Ca=d+e}else Aa=1<<d|i<<c|l,Ca=e}function Gu(e){e.return!==null&&(ji(e,1),e0(e,1,0))}function Iu(e){for(;e===co;)co=ws[--As],ws[As]=null,uo=ws[--As],ws[As]=null;for(;e===Hi;)Hi=yn[--bn],yn[bn]=null,Ca=yn[--bn],yn[bn]=null,Aa=yn[--bn],yn[bn]=null}var Bt=null,nt=null,Le=!1,Gi=null,Vn=!1,Yu=Error(r(519));function Ii(e){var t=Error(r(418,""));throw Tr(pn(t,e)),Yu}function t0(e){var t=e.stateNode,i=e.type,l=e.memoizedProps;switch(t[Je]=e,t[mt]=l,i){case"dialog":Te("cancel",t),Te("close",t);break;case"iframe":case"object":case"embed":Te("load",t);break;case"video":case"audio":for(i=0;i<Zr.length;i++)Te(Zr[i],t);break;case"source":Te("error",t);break;case"img":case"image":case"link":Te("error",t),Te("load",t);break;case"details":Te("toggle",t);break;case"input":Te("invalid",t),Ja(t,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0),Mt(t);break;case"select":Te("invalid",t);break;case"textarea":Te("invalid",t),Zl(t,l.value,l.defaultValue,l.children),Mt(t)}i=l.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||t.textContent===""+i||l.suppressHydrationWarning===!0||bg(t.textContent,i)?(l.popover!=null&&(Te("beforetoggle",t),Te("toggle",t)),l.onScroll!=null&&Te("scroll",t),l.onScrollEnd!=null&&Te("scrollend",t),l.onClick!=null&&(t.onclick=$o),t=!0):t=!1,t||Ii(e)}function n0(e){for(Bt=e.return;Bt;)switch(Bt.tag){case 5:case 13:Vn=!1;return;case 27:case 3:Vn=!0;return;default:Bt=Bt.return}}function Ar(e){if(e!==Bt)return!1;if(!Le)return n0(e),Le=!0,!1;var t=e.tag,i;if((i=t!==3&&t!==27)&&((i=t===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||rf(e.type,e.memoizedProps)),i=!i),i&&nt&&Ii(e),n0(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(i=e.data,i==="/$"){if(t===0){nt=Ln(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++;e=e.nextSibling}nt=null}}else t===27?(t=nt,gi(e.type)?(e=uf,uf=null,nt=e):nt=t):nt=Bt?Ln(e.stateNode.nextSibling):null;return!0}function Cr(){nt=Bt=null,Le=!1}function a0(){var e=Gi;return e!==null&&(Qt===null?Qt=e:Qt.push.apply(Qt,e),Gi=null),e}function Tr(e){Gi===null?Gi=[e]:Gi.push(e)}var Fu=V(null),Yi=null,Ta=null;function ti(e,t,i){W(Fu,t._currentValue),t._currentValue=i}function _a(e){e._currentValue=Fu.current,ee(Fu)}function $u(e,t,i){for(;e!==null;){var l=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,l!==null&&(l.childLanes|=t)):l!==null&&(l.childLanes&t)!==t&&(l.childLanes|=t),e===i)break;e=e.return}}function Vu(e,t,i,l){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var d=c.dependencies;if(d!==null){var y=c.child;d=d.firstContext;e:for(;d!==null;){var v=d;d=c;for(var x=0;x<t.length;x++)if(v.context===t[x]){d.lanes|=i,v=d.alternate,v!==null&&(v.lanes|=i),$u(d.return,i,e),l||(y=null);break e}d=v.next}}else if(c.tag===18){if(y=c.return,y===null)throw Error(r(341));y.lanes|=i,d=y.alternate,d!==null&&(d.lanes|=i),$u(y,i,e),y=null}else y=c.child;if(y!==null)y.return=c;else for(y=c;y!==null;){if(y===e){y=null;break}if(c=y.sibling,c!==null){c.return=y.return,y=c;break}y=y.return}c=y}}function _r(e,t,i,l){e=null;for(var c=t,d=!1;c!==null;){if(!d){if((c.flags&524288)!==0)d=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var y=c.alternate;if(y===null)throw Error(r(387));if(y=y.memoizedProps,y!==null){var v=c.type;rn(c.pendingProps.value,y.value)||(e!==null?e.push(v):e=[v])}}else if(c===Ie.current){if(y=c.alternate,y===null)throw Error(r(387));y.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(al):e=[al])}c=c.return}e!==null&&Vu(t,e,i,l),t.flags|=262144}function fo(e){for(e=e.firstContext;e!==null;){if(!rn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Fi(e){Yi=e,Ta=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Dt(e){return i0(Yi,e)}function ho(e,t){return Yi===null&&Fi(e),i0(e,t)}function i0(e,t){var i=t._currentValue;if(t={context:t,memoizedValue:i,next:null},Ta===null){if(e===null)throw Error(r(308));Ta=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Ta=Ta.next=t;return i}var D1=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(i,l){e.push(l)}};this.abort=function(){t.aborted=!0,e.forEach(function(i){return i()})}},L1=n.unstable_scheduleCallback,U1=n.unstable_NormalPriority,gt={$$typeof:G,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xu(){return{controller:new D1,data:new Map,refCount:0}}function Rr(e){e.refCount--,e.refCount===0&&L1(U1,function(){e.controller.abort()})}var Nr=null,Ku=0,Cs=0,Ts=null;function O1(e,t){if(Nr===null){var i=Nr=[];Ku=0,Cs=Pd(),Ts={status:"pending",value:void 0,then:function(l){i.push(l)}}}return Ku++,t.then(s0,s0),t}function s0(){if(--Ku===0&&Nr!==null){Ts!==null&&(Ts.status="fulfilled");var e=Nr;Nr=null,Cs=0,Ts=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function q1(e,t){var i=[],l={status:"pending",value:null,reason:null,then:function(c){i.push(c)}};return e.then(function(){l.status="fulfilled",l.value=t;for(var c=0;c<i.length;c++)(0,i[c])(t)},function(c){for(l.status="rejected",l.reason=c,c=0;c<i.length;c++)(0,i[c])(void 0)}),l}var r0=T.S;T.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&O1(e,t),r0!==null&&r0(e,t)};var $i=V(null);function Qu(){var e=$i.current;return e!==null?e:Ve.pooledCache}function mo(e,t){t===null?W($i,$i.current):W($i,t.pool)}function l0(){var e=Qu();return e===null?null:{parent:gt._currentValue,pool:e}}var kr=Error(r(460)),o0=Error(r(474)),po=Error(r(542)),Pu={then:function(){}};function c0(e){return e=e.status,e==="fulfilled"||e==="rejected"}function go(){}function u0(e,t,i){switch(i=e[i],i===void 0?e.push(t):i!==t&&(t.then(go,go),t=i),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,f0(e),e;default:if(typeof t.status=="string")t.then(go,go);else{if(e=Ve,e!==null&&100<e.shellSuspendCounter)throw Error(r(482));e=t,e.status="pending",e.then(function(l){if(t.status==="pending"){var c=t;c.status="fulfilled",c.value=l}},function(l){if(t.status==="pending"){var c=t;c.status="rejected",c.reason=l}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,f0(e),e}throw Dr=t,kr}}var Dr=null;function d0(){if(Dr===null)throw Error(r(459));var e=Dr;return Dr=null,e}function f0(e){if(e===kr||e===po)throw Error(r(483))}var ni=!1;function Zu(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ju(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ai(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ii(e,t,i){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,(Oe&2)!==0){var c=l.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),l.pending=t,t=lo(e),Jm(e,null,i),t}return ro(e,l,t,i),lo(e)}function Lr(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194048)!==0)){var l=t.lanes;l&=e.pendingLanes,i|=l,t.lanes=i,pa(e,i)}}function Wu(e,t){var i=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,i===l)){var c=null,d=null;if(i=i.firstBaseUpdate,i!==null){do{var y={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};d===null?c=d=y:d=d.next=y,i=i.next}while(i!==null);d===null?c=d=t:d=d.next=t}else c=d=t;i={baseState:l.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:l.shared,callbacks:l.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}var ed=!1;function Ur(){if(ed){var e=Ts;if(e!==null)throw e}}function Or(e,t,i,l){ed=!1;var c=e.updateQueue;ni=!1;var d=c.firstBaseUpdate,y=c.lastBaseUpdate,v=c.shared.pending;if(v!==null){c.shared.pending=null;var x=v,q=x.next;x.next=null,y===null?d=q:y.next=q,y=x;var K=e.alternate;K!==null&&(K=K.updateQueue,v=K.lastBaseUpdate,v!==y&&(v===null?K.firstBaseUpdate=q:v.next=q,K.lastBaseUpdate=x))}if(d!==null){var Z=c.baseState;y=0,K=q=x=null,v=d;do{var z=v.lane&-536870913,j=z!==v.lane;if(j?(ke&z)===z:(l&z)===z){z!==0&&z===Cs&&(ed=!0),K!==null&&(K=K.next={lane:0,tag:v.tag,payload:v.payload,callback:null,next:null});e:{var be=e,ge=v;z=t;var je=i;switch(ge.tag){case 1:if(be=ge.payload,typeof be=="function"){Z=be.call(je,Z,z);break e}Z=be;break e;case 3:be.flags=be.flags&-65537|128;case 0:if(be=ge.payload,z=typeof be=="function"?be.call(je,Z,z):be,z==null)break e;Z=g({},Z,z);break e;case 2:ni=!0}}z=v.callback,z!==null&&(e.flags|=64,j&&(e.flags|=8192),j=c.callbacks,j===null?c.callbacks=[z]:j.push(z))}else j={lane:z,tag:v.tag,payload:v.payload,callback:v.callback,next:null},K===null?(q=K=j,x=Z):K=K.next=j,y|=z;if(v=v.next,v===null){if(v=c.shared.pending,v===null)break;j=v,v=j.next,j.next=null,c.lastBaseUpdate=j,c.shared.pending=null}}while(!0);K===null&&(x=Z),c.baseState=x,c.firstBaseUpdate=q,c.lastBaseUpdate=K,d===null&&(c.shared.lanes=0),fi|=y,e.lanes=y,e.memoizedState=Z}}function h0(e,t){if(typeof e!="function")throw Error(r(191,e));e.call(t)}function m0(e,t){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)h0(i[e],t)}var _s=V(null),yo=V(0);function p0(e,t){e=Oa,W(yo,e),W(_s,t),Oa=e|t.baseLanes}function td(){W(yo,Oa),W(_s,_s.current)}function nd(){Oa=yo.current,ee(_s),ee(yo)}var si=0,Me=null,Be=null,ct=null,bo=!1,Rs=!1,Vi=!1,vo=0,qr=0,Ns=null,z1=0;function st(){throw Error(r(321))}function ad(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!rn(e[i],t[i]))return!1;return!0}function id(e,t,i,l,c,d){return si=d,Me=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,T.H=e===null||e.memoizedState===null?J0:W0,Vi=!1,d=i(l,c),Vi=!1,Rs&&(d=y0(t,i,l,c)),g0(e),d}function g0(e){T.H=Ao;var t=Be!==null&&Be.next!==null;if(si=0,ct=Be=Me=null,bo=!1,qr=0,Ns=null,t)throw Error(r(300));e===null||xt||(e=e.dependencies,e!==null&&fo(e)&&(xt=!0))}function y0(e,t,i,l){Me=e;var c=0;do{if(Rs&&(Ns=null),qr=0,Rs=!1,25<=c)throw Error(r(301));if(c+=1,ct=Be=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}T.H=F1,d=t(i,l)}while(Rs);return d}function B1(){var e=T.H,t=e.useState()[0];return t=typeof t.then=="function"?zr(t):t,e=e.useState()[0],(Be!==null?Be.memoizedState:null)!==e&&(Me.flags|=1024),t}function sd(){var e=vo!==0;return vo=0,e}function rd(e,t,i){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i}function ld(e){if(bo){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}bo=!1}si=0,ct=Be=Me=null,Rs=!1,qr=vo=0,Ns=null}function Xt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ct===null?Me.memoizedState=ct=e:ct=ct.next=e,ct}function ut(){if(Be===null){var e=Me.alternate;e=e!==null?e.memoizedState:null}else e=Be.next;var t=ct===null?Me.memoizedState:ct.next;if(t!==null)ct=t,Be=e;else{if(e===null)throw Me.alternate===null?Error(r(467)):Error(r(310));Be=e,e={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},ct===null?Me.memoizedState=ct=e:ct=ct.next=e}return ct}function od(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function zr(e){var t=qr;return qr+=1,Ns===null&&(Ns=[]),e=u0(Ns,e,t),t=Me,(ct===null?t.memoizedState:ct.next)===null&&(t=t.alternate,T.H=t===null||t.memoizedState===null?J0:W0),e}function So(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return zr(e);if(e.$$typeof===G)return Dt(e)}throw Error(r(438,String(e)))}function cd(e){var t=null,i=Me.updateQueue;if(i!==null&&(t=i.memoCache),t==null){var l=Me.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(t={data:l.data.map(function(c){return c.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),i===null&&(i=od(),Me.updateQueue=i),i.memoCache=t,i=t.data[t.index],i===void 0)for(i=t.data[t.index]=Array(e),l=0;l<e;l++)i[l]=Y;return t.index++,i}function Ra(e,t){return typeof t=="function"?t(e):t}function Eo(e){var t=ut();return ud(t,Be,e)}function ud(e,t,i){var l=e.queue;if(l===null)throw Error(r(311));l.lastRenderedReducer=i;var c=e.baseQueue,d=l.pending;if(d!==null){if(c!==null){var y=c.next;c.next=d.next,d.next=y}t.baseQueue=c=d,l.pending=null}if(d=e.baseState,c===null)e.memoizedState=d;else{t=c.next;var v=y=null,x=null,q=t,K=!1;do{var Z=q.lane&-536870913;if(Z!==q.lane?(ke&Z)===Z:(si&Z)===Z){var z=q.revertLane;if(z===0)x!==null&&(x=x.next={lane:0,revertLane:0,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),Z===Cs&&(K=!0);else if((si&z)===z){q=q.next,z===Cs&&(K=!0);continue}else Z={lane:0,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},x===null?(v=x=Z,y=d):x=x.next=Z,Me.lanes|=z,fi|=z;Z=q.action,Vi&&i(d,Z),d=q.hasEagerState?q.eagerState:i(d,Z)}else z={lane:Z,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},x===null?(v=x=z,y=d):x=x.next=z,Me.lanes|=Z,fi|=Z;q=q.next}while(q!==null&&q!==t);if(x===null?y=d:x.next=v,!rn(d,e.memoizedState)&&(xt=!0,K&&(i=Ts,i!==null)))throw i;e.memoizedState=d,e.baseState=y,e.baseQueue=x,l.lastRenderedState=d}return c===null&&(l.lanes=0),[e.memoizedState,l.dispatch]}function dd(e){var t=ut(),i=t.queue;if(i===null)throw Error(r(311));i.lastRenderedReducer=e;var l=i.dispatch,c=i.pending,d=t.memoizedState;if(c!==null){i.pending=null;var y=c=c.next;do d=e(d,y.action),y=y.next;while(y!==c);rn(d,t.memoizedState)||(xt=!0),t.memoizedState=d,t.baseQueue===null&&(t.baseState=d),i.lastRenderedState=d}return[d,l]}function b0(e,t,i){var l=Me,c=ut(),d=Le;if(d){if(i===void 0)throw Error(r(407));i=i()}else i=t();var y=!rn((Be||c).memoizedState,i);y&&(c.memoizedState=i,xt=!0),c=c.queue;var v=E0.bind(null,l,c,e);if(Br(2048,8,v,[e]),c.getSnapshot!==t||y||ct!==null&&ct.memoizedState.tag&1){if(l.flags|=2048,ks(9,Mo(),S0.bind(null,l,c,i,t),null),Ve===null)throw Error(r(349));d||(si&124)!==0||v0(l,t,i)}return i}function v0(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Me.updateQueue,t===null?(t=od(),Me.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function S0(e,t,i,l){t.value=i,t.getSnapshot=l,M0(t)&&x0(e)}function E0(e,t,i){return i(function(){M0(t)&&x0(e)})}function M0(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!rn(e,i)}catch{return!0}}function x0(e){var t=Ms(e,2);t!==null&&fn(t,e,2)}function fd(e){var t=Xt();if(typeof e=="function"){var i=e;if(e=i(),Vi){tn(!0);try{i()}finally{tn(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ra,lastRenderedState:e},t}function w0(e,t,i,l){return e.baseState=i,ud(e,Be,typeof l=="function"?l:Ra)}function H1(e,t,i,l,c){if(wo(e))throw Error(r(485));if(e=t.action,e!==null){var d={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){d.listeners.push(y)}};T.T!==null?i(!0):d.isTransition=!1,l(d),i=t.pending,i===null?(d.next=t.pending=d,A0(t,d)):(d.next=i.next,t.pending=i.next=d)}}function A0(e,t){var i=t.action,l=t.payload,c=e.state;if(t.isTransition){var d=T.T,y={};T.T=y;try{var v=i(c,l),x=T.S;x!==null&&x(y,v),C0(e,t,v)}catch(q){hd(e,t,q)}finally{T.T=d}}else try{d=i(c,l),C0(e,t,d)}catch(q){hd(e,t,q)}}function C0(e,t,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(l){T0(e,t,l)},function(l){return hd(e,t,l)}):T0(e,t,i)}function T0(e,t,i){t.status="fulfilled",t.value=i,_0(t),e.state=i,t=e.pending,t!==null&&(i=t.next,i===t?e.pending=null:(i=i.next,t.next=i,A0(e,i)))}function hd(e,t,i){var l=e.pending;if(e.pending=null,l!==null){l=l.next;do t.status="rejected",t.reason=i,_0(t),t=t.next;while(t!==l)}e.action=null}function _0(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function R0(e,t){return t}function N0(e,t){if(Le){var i=Ve.formState;if(i!==null){e:{var l=Me;if(Le){if(nt){t:{for(var c=nt,d=Vn;c.nodeType!==8;){if(!d){c=null;break t}if(c=Ln(c.nextSibling),c===null){c=null;break t}}d=c.data,c=d==="F!"||d==="F"?c:null}if(c){nt=Ln(c.nextSibling),l=c.data==="F!";break e}}Ii(l)}l=!1}l&&(t=i[0])}}return i=Xt(),i.memoizedState=i.baseState=t,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:R0,lastRenderedState:t},i.queue=l,i=Q0.bind(null,Me,l),l.dispatch=i,l=fd(!1),d=bd.bind(null,Me,!1,l.queue),l=Xt(),c={state:t,dispatch:null,action:e,pending:null},l.queue=c,i=H1.bind(null,Me,c,d,i),c.dispatch=i,l.memoizedState=e,[t,i,!1]}function k0(e){var t=ut();return D0(t,Be,e)}function D0(e,t,i){if(t=ud(e,t,R0)[0],e=Eo(Ra)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var l=zr(t)}catch(y){throw y===kr?po:y}else l=t;t=ut();var c=t.queue,d=c.dispatch;return i!==t.memoizedState&&(Me.flags|=2048,ks(9,Mo(),j1.bind(null,c,i),null)),[l,d,e]}function j1(e,t){e.action=t}function L0(e){var t=ut(),i=Be;if(i!==null)return D0(t,i,e);ut(),t=t.memoizedState,i=ut();var l=i.queue.dispatch;return i.memoizedState=e,[t,l,!1]}function ks(e,t,i,l){return e={tag:e,create:i,deps:l,inst:t,next:null},t=Me.updateQueue,t===null&&(t=od(),Me.updateQueue=t),i=t.lastEffect,i===null?t.lastEffect=e.next=e:(l=i.next,i.next=e,e.next=l,t.lastEffect=e),e}function Mo(){return{destroy:void 0,resource:void 0}}function U0(){return ut().memoizedState}function xo(e,t,i,l){var c=Xt();l=l===void 0?null:l,Me.flags|=e,c.memoizedState=ks(1|t,Mo(),i,l)}function Br(e,t,i,l){var c=ut();l=l===void 0?null:l;var d=c.memoizedState.inst;Be!==null&&l!==null&&ad(l,Be.memoizedState.deps)?c.memoizedState=ks(t,d,i,l):(Me.flags|=e,c.memoizedState=ks(1|t,d,i,l))}function O0(e,t){xo(8390656,8,e,t)}function q0(e,t){Br(2048,8,e,t)}function z0(e,t){return Br(4,2,e,t)}function B0(e,t){return Br(4,4,e,t)}function H0(e,t){if(typeof t=="function"){e=e();var i=t(e);return function(){typeof i=="function"?i():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function j0(e,t,i){i=i!=null?i.concat([e]):null,Br(4,4,H0.bind(null,t,e),i)}function md(){}function G0(e,t){var i=ut();t=t===void 0?null:t;var l=i.memoizedState;return t!==null&&ad(t,l[1])?l[0]:(i.memoizedState=[e,t],e)}function I0(e,t){var i=ut();t=t===void 0?null:t;var l=i.memoizedState;if(t!==null&&ad(t,l[1]))return l[0];if(l=e(),Vi){tn(!0);try{e()}finally{tn(!1)}}return i.memoizedState=[l,t],l}function pd(e,t,i){return i===void 0||(si&1073741824)!==0?e.memoizedState=t:(e.memoizedState=i,e=$p(),Me.lanes|=e,fi|=e,i)}function Y0(e,t,i,l){return rn(i,t)?i:_s.current!==null?(e=pd(e,i,l),rn(e,t)||(xt=!0),e):(si&42)===0?(xt=!0,e.memoizedState=i):(e=$p(),Me.lanes|=e,fi|=e,t)}function F0(e,t,i,l,c){var d=I.p;I.p=d!==0&&8>d?d:8;var y=T.T,v={};T.T=v,bd(e,!1,t,i);try{var x=c(),q=T.S;if(q!==null&&q(v,x),x!==null&&typeof x=="object"&&typeof x.then=="function"){var K=q1(x,l);Hr(e,t,K,dn(e))}else Hr(e,t,l,dn(e))}catch(Z){Hr(e,t,{then:function(){},status:"rejected",reason:Z},dn())}finally{I.p=d,T.T=y}}function G1(){}function gd(e,t,i,l){if(e.tag!==5)throw Error(r(476));var c=$0(e).queue;F0(e,c,t,J,i===null?G1:function(){return V0(e),i(l)})}function $0(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ra,lastRenderedState:J},next:null};var i={};return t.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ra,lastRenderedState:i},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function V0(e){var t=$0(e).next.queue;Hr(e,t,{},dn())}function yd(){return Dt(al)}function X0(){return ut().memoizedState}function K0(){return ut().memoizedState}function I1(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var i=dn();e=ai(i);var l=ii(t,e,i);l!==null&&(fn(l,t,i),Lr(l,t,i)),t={cache:Xu()},e.payload=t;return}t=t.return}}function Y1(e,t,i){var l=dn();i={lane:l,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},wo(e)?P0(t,i):(i=zu(e,t,i,l),i!==null&&(fn(i,e,l),Z0(i,t,l)))}function Q0(e,t,i){var l=dn();Hr(e,t,i,l)}function Hr(e,t,i,l){var c={lane:l,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(wo(e))P0(t,c);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=t.lastRenderedReducer,d!==null))try{var y=t.lastRenderedState,v=d(y,i);if(c.hasEagerState=!0,c.eagerState=v,rn(v,y))return ro(e,t,c,0),Ve===null&&so(),!1}catch{}finally{}if(i=zu(e,t,c,l),i!==null)return fn(i,e,l),Z0(i,t,l),!0}return!1}function bd(e,t,i,l){if(l={lane:2,revertLane:Pd(),action:l,hasEagerState:!1,eagerState:null,next:null},wo(e)){if(t)throw Error(r(479))}else t=zu(e,i,l,2),t!==null&&fn(t,e,2)}function wo(e){var t=e.alternate;return e===Me||t!==null&&t===Me}function P0(e,t){Rs=bo=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Z0(e,t,i){if((i&4194048)!==0){var l=t.lanes;l&=e.pendingLanes,i|=l,t.lanes=i,pa(e,i)}}var Ao={readContext:Dt,use:So,useCallback:st,useContext:st,useEffect:st,useImperativeHandle:st,useLayoutEffect:st,useInsertionEffect:st,useMemo:st,useReducer:st,useRef:st,useState:st,useDebugValue:st,useDeferredValue:st,useTransition:st,useSyncExternalStore:st,useId:st,useHostTransitionStatus:st,useFormState:st,useActionState:st,useOptimistic:st,useMemoCache:st,useCacheRefresh:st},J0={readContext:Dt,use:So,useCallback:function(e,t){return Xt().memoizedState=[e,t===void 0?null:t],e},useContext:Dt,useEffect:O0,useImperativeHandle:function(e,t,i){i=i!=null?i.concat([e]):null,xo(4194308,4,H0.bind(null,t,e),i)},useLayoutEffect:function(e,t){return xo(4194308,4,e,t)},useInsertionEffect:function(e,t){xo(4,2,e,t)},useMemo:function(e,t){var i=Xt();t=t===void 0?null:t;var l=e();if(Vi){tn(!0);try{e()}finally{tn(!1)}}return i.memoizedState=[l,t],l},useReducer:function(e,t,i){var l=Xt();if(i!==void 0){var c=i(t);if(Vi){tn(!0);try{i(t)}finally{tn(!1)}}}else c=t;return l.memoizedState=l.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},l.queue=e,e=e.dispatch=Y1.bind(null,Me,e),[l.memoizedState,e]},useRef:function(e){var t=Xt();return e={current:e},t.memoizedState=e},useState:function(e){e=fd(e);var t=e.queue,i=Q0.bind(null,Me,t);return t.dispatch=i,[e.memoizedState,i]},useDebugValue:md,useDeferredValue:function(e,t){var i=Xt();return pd(i,e,t)},useTransition:function(){var e=fd(!1);return e=F0.bind(null,Me,e.queue,!0,!1),Xt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,i){var l=Me,c=Xt();if(Le){if(i===void 0)throw Error(r(407));i=i()}else{if(i=t(),Ve===null)throw Error(r(349));(ke&124)!==0||v0(l,t,i)}c.memoizedState=i;var d={value:i,getSnapshot:t};return c.queue=d,O0(E0.bind(null,l,d,e),[e]),l.flags|=2048,ks(9,Mo(),S0.bind(null,l,d,i,t),null),i},useId:function(){var e=Xt(),t=Ve.identifierPrefix;if(Le){var i=Ca,l=Aa;i=(l&~(1<<32-ft(l)-1)).toString(32)+i,t="«"+t+"R"+i,i=vo++,0<i&&(t+="H"+i.toString(32)),t+="»"}else i=z1++,t="«"+t+"r"+i.toString(32)+"»";return e.memoizedState=t},useHostTransitionStatus:yd,useFormState:N0,useActionState:N0,useOptimistic:function(e){var t=Xt();t.memoizedState=t.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=i,t=bd.bind(null,Me,!0,i),i.dispatch=t,[e,t]},useMemoCache:cd,useCacheRefresh:function(){return Xt().memoizedState=I1.bind(null,Me)}},W0={readContext:Dt,use:So,useCallback:G0,useContext:Dt,useEffect:q0,useImperativeHandle:j0,useInsertionEffect:z0,useLayoutEffect:B0,useMemo:I0,useReducer:Eo,useRef:U0,useState:function(){return Eo(Ra)},useDebugValue:md,useDeferredValue:function(e,t){var i=ut();return Y0(i,Be.memoizedState,e,t)},useTransition:function(){var e=Eo(Ra)[0],t=ut().memoizedState;return[typeof e=="boolean"?e:zr(e),t]},useSyncExternalStore:b0,useId:X0,useHostTransitionStatus:yd,useFormState:k0,useActionState:k0,useOptimistic:function(e,t){var i=ut();return w0(i,Be,e,t)},useMemoCache:cd,useCacheRefresh:K0},F1={readContext:Dt,use:So,useCallback:G0,useContext:Dt,useEffect:q0,useImperativeHandle:j0,useInsertionEffect:z0,useLayoutEffect:B0,useMemo:I0,useReducer:dd,useRef:U0,useState:function(){return dd(Ra)},useDebugValue:md,useDeferredValue:function(e,t){var i=ut();return Be===null?pd(i,e,t):Y0(i,Be.memoizedState,e,t)},useTransition:function(){var e=dd(Ra)[0],t=ut().memoizedState;return[typeof e=="boolean"?e:zr(e),t]},useSyncExternalStore:b0,useId:X0,useHostTransitionStatus:yd,useFormState:L0,useActionState:L0,useOptimistic:function(e,t){var i=ut();return Be!==null?w0(i,Be,e,t):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:cd,useCacheRefresh:K0},Ds=null,jr=0;function Co(e){var t=jr;return jr+=1,Ds===null&&(Ds=[]),u0(Ds,e,t)}function Gr(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function To(e,t){throw t.$$typeof===b?Error(r(525)):(e=Object.prototype.toString.call(t),Error(r(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function ep(e){var t=e._init;return t(e._payload)}function tp(e){function t(D,C){if(e){var O=D.deletions;O===null?(D.deletions=[C],D.flags|=16):O.push(C)}}function i(D,C){if(!e)return null;for(;C!==null;)t(D,C),C=C.sibling;return null}function l(D){for(var C=new Map;D!==null;)D.key!==null?C.set(D.key,D):C.set(D.index,D),D=D.sibling;return C}function c(D,C){return D=wa(D,C),D.index=0,D.sibling=null,D}function d(D,C,O){return D.index=O,e?(O=D.alternate,O!==null?(O=O.index,O<C?(D.flags|=67108866,C):O):(D.flags|=67108866,C)):(D.flags|=1048576,C)}function y(D){return e&&D.alternate===null&&(D.flags|=67108866),D}function v(D,C,O,Q){return C===null||C.tag!==6?(C=Hu(O,D.mode,Q),C.return=D,C):(C=c(C,O),C.return=D,C)}function x(D,C,O,Q){var ue=O.type;return ue===w?K(D,C,O.props.children,Q,O.key):C!==null&&(C.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===le&&ep(ue)===C.type)?(C=c(C,O.props),Gr(C,O),C.return=D,C):(C=oo(O.type,O.key,O.props,null,D.mode,Q),Gr(C,O),C.return=D,C)}function q(D,C,O,Q){return C===null||C.tag!==4||C.stateNode.containerInfo!==O.containerInfo||C.stateNode.implementation!==O.implementation?(C=ju(O,D.mode,Q),C.return=D,C):(C=c(C,O.children||[]),C.return=D,C)}function K(D,C,O,Q,ue){return C===null||C.tag!==7?(C=Bi(O,D.mode,Q,ue),C.return=D,C):(C=c(C,O),C.return=D,C)}function Z(D,C,O){if(typeof C=="string"&&C!==""||typeof C=="number"||typeof C=="bigint")return C=Hu(""+C,D.mode,O),C.return=D,C;if(typeof C=="object"&&C!==null){switch(C.$$typeof){case S:return O=oo(C.type,C.key,C.props,null,D.mode,O),Gr(O,C),O.return=D,O;case E:return C=ju(C,D.mode,O),C.return=D,C;case le:var Q=C._init;return C=Q(C._payload),Z(D,C,O)}if(H(C)||L(C))return C=Bi(C,D.mode,O,null),C.return=D,C;if(typeof C.then=="function")return Z(D,Co(C),O);if(C.$$typeof===G)return Z(D,ho(D,C),O);To(D,C)}return null}function z(D,C,O,Q){var ue=C!==null?C.key:null;if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return ue!==null?null:v(D,C,""+O,Q);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case S:return O.key===ue?x(D,C,O,Q):null;case E:return O.key===ue?q(D,C,O,Q):null;case le:return ue=O._init,O=ue(O._payload),z(D,C,O,Q)}if(H(O)||L(O))return ue!==null?null:K(D,C,O,Q,null);if(typeof O.then=="function")return z(D,C,Co(O),Q);if(O.$$typeof===G)return z(D,C,ho(D,O),Q);To(D,O)}return null}function j(D,C,O,Q,ue){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return D=D.get(O)||null,v(C,D,""+Q,ue);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case S:return D=D.get(Q.key===null?O:Q.key)||null,x(C,D,Q,ue);case E:return D=D.get(Q.key===null?O:Q.key)||null,q(C,D,Q,ue);case le:var we=Q._init;return Q=we(Q._payload),j(D,C,O,Q,ue)}if(H(Q)||L(Q))return D=D.get(O)||null,K(C,D,Q,ue,null);if(typeof Q.then=="function")return j(D,C,O,Co(Q),ue);if(Q.$$typeof===G)return j(D,C,O,ho(C,Q),ue);To(C,Q)}return null}function be(D,C,O,Q){for(var ue=null,we=null,me=C,ye=C=0,At=null;me!==null&&ye<O.length;ye++){me.index>ye?(At=me,me=null):At=me.sibling;var De=z(D,me,O[ye],Q);if(De===null){me===null&&(me=At);break}e&&me&&De.alternate===null&&t(D,me),C=d(De,C,ye),we===null?ue=De:we.sibling=De,we=De,me=At}if(ye===O.length)return i(D,me),Le&&ji(D,ye),ue;if(me===null){for(;ye<O.length;ye++)me=Z(D,O[ye],Q),me!==null&&(C=d(me,C,ye),we===null?ue=me:we.sibling=me,we=me);return Le&&ji(D,ye),ue}for(me=l(me);ye<O.length;ye++)At=j(me,D,ye,O[ye],Q),At!==null&&(e&&At.alternate!==null&&me.delete(At.key===null?ye:At.key),C=d(At,C,ye),we===null?ue=At:we.sibling=At,we=At);return e&&me.forEach(function(Ei){return t(D,Ei)}),Le&&ji(D,ye),ue}function ge(D,C,O,Q){if(O==null)throw Error(r(151));for(var ue=null,we=null,me=C,ye=C=0,At=null,De=O.next();me!==null&&!De.done;ye++,De=O.next()){me.index>ye?(At=me,me=null):At=me.sibling;var Ei=z(D,me,De.value,Q);if(Ei===null){me===null&&(me=At);break}e&&me&&Ei.alternate===null&&t(D,me),C=d(Ei,C,ye),we===null?ue=Ei:we.sibling=Ei,we=Ei,me=At}if(De.done)return i(D,me),Le&&ji(D,ye),ue;if(me===null){for(;!De.done;ye++,De=O.next())De=Z(D,De.value,Q),De!==null&&(C=d(De,C,ye),we===null?ue=De:we.sibling=De,we=De);return Le&&ji(D,ye),ue}for(me=l(me);!De.done;ye++,De=O.next())De=j(me,D,ye,De.value,Q),De!==null&&(e&&De.alternate!==null&&me.delete(De.key===null?ye:De.key),C=d(De,C,ye),we===null?ue=De:we.sibling=De,we=De);return e&&me.forEach(function($S){return t(D,$S)}),Le&&ji(D,ye),ue}function je(D,C,O,Q){if(typeof O=="object"&&O!==null&&O.type===w&&O.key===null&&(O=O.props.children),typeof O=="object"&&O!==null){switch(O.$$typeof){case S:e:{for(var ue=O.key;C!==null;){if(C.key===ue){if(ue=O.type,ue===w){if(C.tag===7){i(D,C.sibling),Q=c(C,O.props.children),Q.return=D,D=Q;break e}}else if(C.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===le&&ep(ue)===C.type){i(D,C.sibling),Q=c(C,O.props),Gr(Q,O),Q.return=D,D=Q;break e}i(D,C);break}else t(D,C);C=C.sibling}O.type===w?(Q=Bi(O.props.children,D.mode,Q,O.key),Q.return=D,D=Q):(Q=oo(O.type,O.key,O.props,null,D.mode,Q),Gr(Q,O),Q.return=D,D=Q)}return y(D);case E:e:{for(ue=O.key;C!==null;){if(C.key===ue)if(C.tag===4&&C.stateNode.containerInfo===O.containerInfo&&C.stateNode.implementation===O.implementation){i(D,C.sibling),Q=c(C,O.children||[]),Q.return=D,D=Q;break e}else{i(D,C);break}else t(D,C);C=C.sibling}Q=ju(O,D.mode,Q),Q.return=D,D=Q}return y(D);case le:return ue=O._init,O=ue(O._payload),je(D,C,O,Q)}if(H(O))return be(D,C,O,Q);if(L(O)){if(ue=L(O),typeof ue!="function")throw Error(r(150));return O=ue.call(O),ge(D,C,O,Q)}if(typeof O.then=="function")return je(D,C,Co(O),Q);if(O.$$typeof===G)return je(D,C,ho(D,O),Q);To(D,O)}return typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint"?(O=""+O,C!==null&&C.tag===6?(i(D,C.sibling),Q=c(C,O),Q.return=D,D=Q):(i(D,C),Q=Hu(O,D.mode,Q),Q.return=D,D=Q),y(D)):i(D,C)}return function(D,C,O,Q){try{jr=0;var ue=je(D,C,O,Q);return Ds=null,ue}catch(me){if(me===kr||me===po)throw me;var we=ln(29,me,null,D.mode);return we.lanes=Q,we.return=D,we}finally{}}}var Ls=tp(!0),np=tp(!1),vn=V(null),Xn=null;function ri(e){var t=e.alternate;W(yt,yt.current&1),W(vn,e),Xn===null&&(t===null||_s.current!==null||t.memoizedState!==null)&&(Xn=e)}function ap(e){if(e.tag===22){if(W(yt,yt.current),W(vn,e),Xn===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(Xn=e)}}else li()}function li(){W(yt,yt.current),W(vn,vn.current)}function Na(e){ee(vn),Xn===e&&(Xn=null),ee(yt)}var yt=V(0);function _o(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||cf(i)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function vd(e,t,i,l){t=e.memoizedState,i=i(l,t),i=i==null?t:g({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Sd={enqueueSetState:function(e,t,i){e=e._reactInternals;var l=dn(),c=ai(l);c.payload=t,i!=null&&(c.callback=i),t=ii(e,c,l),t!==null&&(fn(t,e,l),Lr(t,e,l))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var l=dn(),c=ai(l);c.tag=1,c.payload=t,i!=null&&(c.callback=i),t=ii(e,c,l),t!==null&&(fn(t,e,l),Lr(t,e,l))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=dn(),l=ai(i);l.tag=2,t!=null&&(l.callback=t),t=ii(e,l,i),t!==null&&(fn(t,e,i),Lr(t,e,i))}};function ip(e,t,i,l,c,d,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,d,y):t.prototype&&t.prototype.isPureReactComponent?!xr(i,l)||!xr(c,d):!0}function sp(e,t,i,l){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,l),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,l),t.state!==e&&Sd.enqueueReplaceState(t,t.state,null)}function Xi(e,t){var i=t;if("ref"in t){i={};for(var l in t)l!=="ref"&&(i[l]=t[l])}if(e=e.defaultProps){i===t&&(i=g({},i));for(var c in e)i[c]===void 0&&(i[c]=e[c])}return i}var Ro=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function rp(e){Ro(e)}function lp(e){console.error(e)}function op(e){Ro(e)}function No(e,t){try{var i=e.onUncaughtError;i(t.value,{componentStack:t.stack})}catch(l){setTimeout(function(){throw l})}}function cp(e,t,i){try{var l=e.onCaughtError;l(i.value,{componentStack:i.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Ed(e,t,i){return i=ai(i),i.tag=3,i.payload={element:null},i.callback=function(){No(e,t)},i}function up(e){return e=ai(e),e.tag=3,e}function dp(e,t,i,l){var c=i.type.getDerivedStateFromError;if(typeof c=="function"){var d=l.value;e.payload=function(){return c(d)},e.callback=function(){cp(t,i,l)}}var y=i.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){cp(t,i,l),typeof c!="function"&&(hi===null?hi=new Set([this]):hi.add(this));var v=l.stack;this.componentDidCatch(l.value,{componentStack:v!==null?v:""})})}function $1(e,t,i,l,c){if(i.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(t=i.alternate,t!==null&&_r(t,i,c,!0),i=vn.current,i!==null){switch(i.tag){case 13:return Xn===null?$d():i.alternate===null&&at===0&&(at=3),i.flags&=-257,i.flags|=65536,i.lanes=c,l===Pu?i.flags|=16384:(t=i.updateQueue,t===null?i.updateQueue=new Set([l]):t.add(l),Xd(e,l,c)),!1;case 22:return i.flags|=65536,l===Pu?i.flags|=16384:(t=i.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([l])},i.updateQueue=t):(i=t.retryQueue,i===null?t.retryQueue=new Set([l]):i.add(l)),Xd(e,l,c)),!1}throw Error(r(435,i.tag))}return Xd(e,l,c),$d(),!1}if(Le)return t=vn.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=c,l!==Yu&&(e=Error(r(422),{cause:l}),Tr(pn(e,i)))):(l!==Yu&&(t=Error(r(423),{cause:l}),Tr(pn(t,i))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,l=pn(l,i),c=Ed(e.stateNode,l,c),Wu(e,c),at!==4&&(at=2)),!1;var d=Error(r(520),{cause:l});if(d=pn(d,i),Kr===null?Kr=[d]:Kr.push(d),at!==4&&(at=2),t===null)return!0;l=pn(l,i),i=t;do{switch(i.tag){case 3:return i.flags|=65536,e=c&-c,i.lanes|=e,e=Ed(i.stateNode,l,e),Wu(i,e),!1;case 1:if(t=i.type,d=i.stateNode,(i.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(hi===null||!hi.has(d))))return i.flags|=65536,c&=-c,i.lanes|=c,c=up(c),dp(c,e,i,l),Wu(i,c),!1}i=i.return}while(i!==null);return!1}var fp=Error(r(461)),xt=!1;function _t(e,t,i,l){t.child=e===null?np(t,null,i,l):Ls(t,e.child,i,l)}function hp(e,t,i,l,c){i=i.render;var d=t.ref;if("ref"in l){var y={};for(var v in l)v!=="ref"&&(y[v]=l[v])}else y=l;return Fi(t),l=id(e,t,i,y,d,c),v=sd(),e!==null&&!xt?(rd(e,t,c),ka(e,t,c)):(Le&&v&&Gu(t),t.flags|=1,_t(e,t,l,c),t.child)}function mp(e,t,i,l,c){if(e===null){var d=i.type;return typeof d=="function"&&!Bu(d)&&d.defaultProps===void 0&&i.compare===null?(t.tag=15,t.type=d,pp(e,t,d,l,c)):(e=oo(i.type,null,l,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(d=e.child,!Rd(e,c)){var y=d.memoizedProps;if(i=i.compare,i=i!==null?i:xr,i(y,l)&&e.ref===t.ref)return ka(e,t,c)}return t.flags|=1,e=wa(d,l),e.ref=t.ref,e.return=t,t.child=e}function pp(e,t,i,l,c){if(e!==null){var d=e.memoizedProps;if(xr(d,l)&&e.ref===t.ref)if(xt=!1,t.pendingProps=l=d,Rd(e,c))(e.flags&131072)!==0&&(xt=!0);else return t.lanes=e.lanes,ka(e,t,c)}return Md(e,t,i,l,c)}function gp(e,t,i){var l=t.pendingProps,c=l.children,d=e!==null?e.memoizedState:null;if(l.mode==="hidden"){if((t.flags&128)!==0){if(l=d!==null?d.baseLanes|i:i,e!==null){for(c=t.child=e.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;t.childLanes=d&~l}else t.childLanes=0,t.child=null;return yp(e,t,l,i)}if((i&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&mo(t,d!==null?d.cachePool:null),d!==null?p0(t,d):td(),ap(t);else return t.lanes=t.childLanes=536870912,yp(e,t,d!==null?d.baseLanes|i:i,i)}else d!==null?(mo(t,d.cachePool),p0(t,d),li(),t.memoizedState=null):(e!==null&&mo(t,null),td(),li());return _t(e,t,c,i),t.child}function yp(e,t,i,l){var c=Qu();return c=c===null?null:{parent:gt._currentValue,pool:c},t.memoizedState={baseLanes:i,cachePool:c},e!==null&&mo(t,null),td(),ap(t),e!==null&&_r(e,t,l,!0),null}function ko(e,t){var i=t.ref;if(i===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(r(284));(e===null||e.ref!==i)&&(t.flags|=4194816)}}function Md(e,t,i,l,c){return Fi(t),i=id(e,t,i,l,void 0,c),l=sd(),e!==null&&!xt?(rd(e,t,c),ka(e,t,c)):(Le&&l&&Gu(t),t.flags|=1,_t(e,t,i,c),t.child)}function bp(e,t,i,l,c,d){return Fi(t),t.updateQueue=null,i=y0(t,l,i,c),g0(e),l=sd(),e!==null&&!xt?(rd(e,t,d),ka(e,t,d)):(Le&&l&&Gu(t),t.flags|=1,_t(e,t,i,d),t.child)}function vp(e,t,i,l,c){if(Fi(t),t.stateNode===null){var d=xs,y=i.contextType;typeof y=="object"&&y!==null&&(d=Dt(y)),d=new i(l,d),t.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Sd,t.stateNode=d,d._reactInternals=t,d=t.stateNode,d.props=l,d.state=t.memoizedState,d.refs={},Zu(t),y=i.contextType,d.context=typeof y=="object"&&y!==null?Dt(y):xs,d.state=t.memoizedState,y=i.getDerivedStateFromProps,typeof y=="function"&&(vd(t,i,y,l),d.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(y=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),y!==d.state&&Sd.enqueueReplaceState(d,d.state,null),Or(t,l,d,c),Ur(),d.state=t.memoizedState),typeof d.componentDidMount=="function"&&(t.flags|=4194308),l=!0}else if(e===null){d=t.stateNode;var v=t.memoizedProps,x=Xi(i,v);d.props=x;var q=d.context,K=i.contextType;y=xs,typeof K=="object"&&K!==null&&(y=Dt(K));var Z=i.getDerivedStateFromProps;K=typeof Z=="function"||typeof d.getSnapshotBeforeUpdate=="function",v=t.pendingProps!==v,K||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(v||q!==y)&&sp(t,d,l,y),ni=!1;var z=t.memoizedState;d.state=z,Or(t,l,d,c),Ur(),q=t.memoizedState,v||z!==q||ni?(typeof Z=="function"&&(vd(t,i,Z,l),q=t.memoizedState),(x=ni||ip(t,i,x,l,z,q,y))?(K||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=l,t.memoizedState=q),d.props=l,d.state=q,d.context=y,l=x):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),l=!1)}else{d=t.stateNode,Ju(e,t),y=t.memoizedProps,K=Xi(i,y),d.props=K,Z=t.pendingProps,z=d.context,q=i.contextType,x=xs,typeof q=="object"&&q!==null&&(x=Dt(q)),v=i.getDerivedStateFromProps,(q=typeof v=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(y!==Z||z!==x)&&sp(t,d,l,x),ni=!1,z=t.memoizedState,d.state=z,Or(t,l,d,c),Ur();var j=t.memoizedState;y!==Z||z!==j||ni||e!==null&&e.dependencies!==null&&fo(e.dependencies)?(typeof v=="function"&&(vd(t,i,v,l),j=t.memoizedState),(K=ni||ip(t,i,K,l,z,j,x)||e!==null&&e.dependencies!==null&&fo(e.dependencies))?(q||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(l,j,x),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(l,j,x)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=1024),t.memoizedProps=l,t.memoizedState=j),d.props=l,d.state=j,d.context=x,l=K):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=1024),l=!1)}return d=l,ko(e,t),l=(t.flags&128)!==0,d||l?(d=t.stateNode,i=l&&typeof i.getDerivedStateFromError!="function"?null:d.render(),t.flags|=1,e!==null&&l?(t.child=Ls(t,e.child,null,c),t.child=Ls(t,null,i,c)):_t(e,t,i,c),t.memoizedState=d.state,e=t.child):e=ka(e,t,c),e}function Sp(e,t,i,l){return Cr(),t.flags|=256,_t(e,t,i,l),t.child}var xd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function wd(e){return{baseLanes:e,cachePool:l0()}}function Ad(e,t,i){return e=e!==null?e.childLanes&~i:0,t&&(e|=Sn),e}function Ep(e,t,i){var l=t.pendingProps,c=!1,d=(t.flags&128)!==0,y;if((y=d)||(y=e!==null&&e.memoizedState===null?!1:(yt.current&2)!==0),y&&(c=!0,t.flags&=-129),y=(t.flags&32)!==0,t.flags&=-33,e===null){if(Le){if(c?ri(t):li(),Le){var v=nt,x;if(x=v){e:{for(x=v,v=Vn;x.nodeType!==8;){if(!v){v=null;break e}if(x=Ln(x.nextSibling),x===null){v=null;break e}}v=x}v!==null?(t.memoizedState={dehydrated:v,treeContext:Hi!==null?{id:Aa,overflow:Ca}:null,retryLane:536870912,hydrationErrors:null},x=ln(18,null,null,0),x.stateNode=v,x.return=t,t.child=x,Bt=t,nt=null,x=!0):x=!1}x||Ii(t)}if(v=t.memoizedState,v!==null&&(v=v.dehydrated,v!==null))return cf(v)?t.lanes=32:t.lanes=536870912,null;Na(t)}return v=l.children,l=l.fallback,c?(li(),c=t.mode,v=Do({mode:"hidden",children:v},c),l=Bi(l,c,i,null),v.return=t,l.return=t,v.sibling=l,t.child=v,c=t.child,c.memoizedState=wd(i),c.childLanes=Ad(e,y,i),t.memoizedState=xd,l):(ri(t),Cd(t,v))}if(x=e.memoizedState,x!==null&&(v=x.dehydrated,v!==null)){if(d)t.flags&256?(ri(t),t.flags&=-257,t=Td(e,t,i)):t.memoizedState!==null?(li(),t.child=e.child,t.flags|=128,t=null):(li(),c=l.fallback,v=t.mode,l=Do({mode:"visible",children:l.children},v),c=Bi(c,v,i,null),c.flags|=2,l.return=t,c.return=t,l.sibling=c,t.child=l,Ls(t,e.child,null,i),l=t.child,l.memoizedState=wd(i),l.childLanes=Ad(e,y,i),t.memoizedState=xd,t=c);else if(ri(t),cf(v)){if(y=v.nextSibling&&v.nextSibling.dataset,y)var q=y.dgst;y=q,l=Error(r(419)),l.stack="",l.digest=y,Tr({value:l,source:null,stack:null}),t=Td(e,t,i)}else if(xt||_r(e,t,i,!1),y=(i&e.childLanes)!==0,xt||y){if(y=Ve,y!==null&&(l=i&-i,l=(l&42)!==0?1:ga(l),l=(l&(y.suspendedLanes|i))!==0?0:l,l!==0&&l!==x.retryLane))throw x.retryLane=l,Ms(e,l),fn(y,e,l),fp;v.data==="$?"||$d(),t=Td(e,t,i)}else v.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=x.treeContext,nt=Ln(v.nextSibling),Bt=t,Le=!0,Gi=null,Vn=!1,e!==null&&(yn[bn++]=Aa,yn[bn++]=Ca,yn[bn++]=Hi,Aa=e.id,Ca=e.overflow,Hi=t),t=Cd(t,l.children),t.flags|=4096);return t}return c?(li(),c=l.fallback,v=t.mode,x=e.child,q=x.sibling,l=wa(x,{mode:"hidden",children:l.children}),l.subtreeFlags=x.subtreeFlags&65011712,q!==null?c=wa(q,c):(c=Bi(c,v,i,null),c.flags|=2),c.return=t,l.return=t,l.sibling=c,t.child=l,l=c,c=t.child,v=e.child.memoizedState,v===null?v=wd(i):(x=v.cachePool,x!==null?(q=gt._currentValue,x=x.parent!==q?{parent:q,pool:q}:x):x=l0(),v={baseLanes:v.baseLanes|i,cachePool:x}),c.memoizedState=v,c.childLanes=Ad(e,y,i),t.memoizedState=xd,l):(ri(t),i=e.child,e=i.sibling,i=wa(i,{mode:"visible",children:l.children}),i.return=t,i.sibling=null,e!==null&&(y=t.deletions,y===null?(t.deletions=[e],t.flags|=16):y.push(e)),t.child=i,t.memoizedState=null,i)}function Cd(e,t){return t=Do({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Do(e,t){return e=ln(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Td(e,t,i){return Ls(t,e.child,null,i),e=Cd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Mp(e,t,i){e.lanes|=t;var l=e.alternate;l!==null&&(l.lanes|=t),$u(e.return,t,i)}function _d(e,t,i,l,c){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:l,tail:i,tailMode:c}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=l,d.tail=i,d.tailMode=c)}function xp(e,t,i){var l=t.pendingProps,c=l.revealOrder,d=l.tail;if(_t(e,t,l.children,i),l=yt.current,(l&2)!==0)l=l&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Mp(e,i,t);else if(e.tag===19)Mp(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}l&=1}switch(W(yt,l),c){case"forwards":for(i=t.child,c=null;i!==null;)e=i.alternate,e!==null&&_o(e)===null&&(c=i),i=i.sibling;i=c,i===null?(c=t.child,t.child=null):(c=i.sibling,i.sibling=null),_d(t,!1,c,i,d);break;case"backwards":for(i=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&_o(e)===null){t.child=c;break}e=c.sibling,c.sibling=i,i=c,c=e}_d(t,!0,i,null,d);break;case"together":_d(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ka(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),fi|=t.lanes,(i&t.childLanes)===0)if(e!==null){if(_r(e,t,i,!1),(i&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(r(153));if(t.child!==null){for(e=t.child,i=wa(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=wa(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function Rd(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&fo(e)))}function V1(e,t,i){switch(t.tag){case 3:Ae(t,t.stateNode.containerInfo),ti(t,gt,e.memoizedState.cache),Cr();break;case 27:case 5:Wt(t);break;case 4:Ae(t,t.stateNode.containerInfo);break;case 10:ti(t,t.type,t.memoizedProps.value);break;case 13:var l=t.memoizedState;if(l!==null)return l.dehydrated!==null?(ri(t),t.flags|=128,null):(i&t.child.childLanes)!==0?Ep(e,t,i):(ri(t),e=ka(e,t,i),e!==null?e.sibling:null);ri(t);break;case 19:var c=(e.flags&128)!==0;if(l=(i&t.childLanes)!==0,l||(_r(e,t,i,!1),l=(i&t.childLanes)!==0),c){if(l)return xp(e,t,i);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),W(yt,yt.current),l)break;return null;case 22:case 23:return t.lanes=0,gp(e,t,i);case 24:ti(t,gt,e.memoizedState.cache)}return ka(e,t,i)}function wp(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps)xt=!0;else{if(!Rd(e,i)&&(t.flags&128)===0)return xt=!1,V1(e,t,i);xt=(e.flags&131072)!==0}else xt=!1,Le&&(t.flags&1048576)!==0&&e0(t,uo,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var l=t.elementType,c=l._init;if(l=c(l._payload),t.type=l,typeof l=="function")Bu(l)?(e=Xi(l,e),t.tag=1,t=vp(null,t,l,e,i)):(t.tag=0,t=Md(null,t,l,e,i));else{if(l!=null){if(c=l.$$typeof,c===F){t.tag=11,t=hp(null,t,l,e,i);break e}else if(c===se){t.tag=14,t=mp(null,t,l,e,i);break e}}throw t=$(l)||l,Error(r(306,t,""))}}return t;case 0:return Md(e,t,t.type,t.pendingProps,i);case 1:return l=t.type,c=Xi(l,t.pendingProps),vp(e,t,l,c,i);case 3:e:{if(Ae(t,t.stateNode.containerInfo),e===null)throw Error(r(387));l=t.pendingProps;var d=t.memoizedState;c=d.element,Ju(e,t),Or(t,l,null,i);var y=t.memoizedState;if(l=y.cache,ti(t,gt,l),l!==d.cache&&Vu(t,[gt],i,!0),Ur(),l=y.element,d.isDehydrated)if(d={element:l,isDehydrated:!1,cache:y.cache},t.updateQueue.baseState=d,t.memoizedState=d,t.flags&256){t=Sp(e,t,l,i);break e}else if(l!==c){c=pn(Error(r(424)),t),Tr(c),t=Sp(e,t,l,i);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(nt=Ln(e.firstChild),Bt=t,Le=!0,Gi=null,Vn=!0,i=np(t,null,l,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(Cr(),l===c){t=ka(e,t,i);break e}_t(e,t,l,i)}t=t.child}return t;case 26:return ko(e,t),e===null?(i=_g(t.type,null,t.pendingProps,null))?t.memoizedState=i:Le||(i=t.type,e=t.pendingProps,l=Vo(he.current).createElement(i),l[Je]=t,l[mt]=e,Nt(l,i,e),We(l),t.stateNode=l):t.memoizedState=_g(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Wt(t),e===null&&Le&&(l=t.stateNode=Ag(t.type,t.pendingProps,he.current),Bt=t,Vn=!0,c=nt,gi(t.type)?(uf=c,nt=Ln(l.firstChild)):nt=c),_t(e,t,t.pendingProps.children,i),ko(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&Le&&((c=l=nt)&&(l=SS(l,t.type,t.pendingProps,Vn),l!==null?(t.stateNode=l,Bt=t,nt=Ln(l.firstChild),Vn=!1,c=!0):c=!1),c||Ii(t)),Wt(t),c=t.type,d=t.pendingProps,y=e!==null?e.memoizedProps:null,l=d.children,rf(c,d)?l=null:y!==null&&rf(c,y)&&(t.flags|=32),t.memoizedState!==null&&(c=id(e,t,B1,null,null,i),al._currentValue=c),ko(e,t),_t(e,t,l,i),t.child;case 6:return e===null&&Le&&((e=i=nt)&&(i=ES(i,t.pendingProps,Vn),i!==null?(t.stateNode=i,Bt=t,nt=null,e=!0):e=!1),e||Ii(t)),null;case 13:return Ep(e,t,i);case 4:return Ae(t,t.stateNode.containerInfo),l=t.pendingProps,e===null?t.child=Ls(t,null,l,i):_t(e,t,l,i),t.child;case 11:return hp(e,t,t.type,t.pendingProps,i);case 7:return _t(e,t,t.pendingProps,i),t.child;case 8:return _t(e,t,t.pendingProps.children,i),t.child;case 12:return _t(e,t,t.pendingProps.children,i),t.child;case 10:return l=t.pendingProps,ti(t,t.type,l.value),_t(e,t,l.children,i),t.child;case 9:return c=t.type._context,l=t.pendingProps.children,Fi(t),c=Dt(c),l=l(c),t.flags|=1,_t(e,t,l,i),t.child;case 14:return mp(e,t,t.type,t.pendingProps,i);case 15:return pp(e,t,t.type,t.pendingProps,i);case 19:return xp(e,t,i);case 31:return l=t.pendingProps,i=t.mode,l={mode:l.mode,children:l.children},e===null?(i=Do(l,i),i.ref=t.ref,t.child=i,i.return=t,t=i):(i=wa(e.child,l),i.ref=t.ref,t.child=i,i.return=t,t=i),t;case 22:return gp(e,t,i);case 24:return Fi(t),l=Dt(gt),e===null?(c=Qu(),c===null&&(c=Ve,d=Xu(),c.pooledCache=d,d.refCount++,d!==null&&(c.pooledCacheLanes|=i),c=d),t.memoizedState={parent:l,cache:c},Zu(t),ti(t,gt,c)):((e.lanes&i)!==0&&(Ju(e,t),Or(t,null,null,i),Ur()),c=e.memoizedState,d=t.memoizedState,c.parent!==l?(c={parent:l,cache:l},t.memoizedState=c,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=c),ti(t,gt,l)):(l=d.cache,ti(t,gt,l),l!==c.cache&&Vu(t,[gt],i,!0))),_t(e,t,t.pendingProps.children,i),t.child;case 29:throw t.pendingProps}throw Error(r(156,t.tag))}function Da(e){e.flags|=4}function Ap(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Lg(t)){if(t=vn.current,t!==null&&((ke&4194048)===ke?Xn!==null:(ke&62914560)!==ke&&(ke&536870912)===0||t!==Xn))throw Dr=Pu,o0;e.flags|=8192}}function Lo(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?Et():536870912,e.lanes|=t,zs|=t)}function Ir(e,t){if(!Le)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function Qe(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,l=0;if(t)for(var c=e.child;c!==null;)i|=c.lanes|c.childLanes,l|=c.subtreeFlags&65011712,l|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)i|=c.lanes|c.childLanes,l|=c.subtreeFlags,l|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=l,e.childLanes=i,t}function X1(e,t,i){var l=t.pendingProps;switch(Iu(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qe(t),null;case 1:return Qe(t),null;case 3:return i=t.stateNode,l=null,e!==null&&(l=e.memoizedState.cache),t.memoizedState.cache!==l&&(t.flags|=2048),_a(gt),Ct(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(Ar(t)?Da(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,a0())),Qe(t),null;case 26:return i=t.memoizedState,e===null?(Da(t),i!==null?(Qe(t),Ap(t,i)):(Qe(t),t.flags&=-16777217)):i?i!==e.memoizedState?(Da(t),Qe(t),Ap(t,i)):(Qe(t),t.flags&=-16777217):(e.memoizedProps!==l&&Da(t),Qe(t),t.flags&=-16777217),null;case 27:wn(t),i=he.current;var c=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==l&&Da(t);else{if(!l){if(t.stateNode===null)throw Error(r(166));return Qe(t),null}e=oe.current,Ar(t)?t0(t):(e=Ag(c,l,i),t.stateNode=e,Da(t))}return Qe(t),null;case 5:if(wn(t),i=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==l&&Da(t);else{if(!l){if(t.stateNode===null)throw Error(r(166));return Qe(t),null}if(e=oe.current,Ar(t))t0(t);else{switch(c=Vo(he.current),e){case 1:e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof l.is=="string"?c.createElement("select",{is:l.is}):c.createElement("select"),l.multiple?e.multiple=!0:l.size&&(e.size=l.size);break;default:e=typeof l.is=="string"?c.createElement(i,{is:l.is}):c.createElement(i)}}e[Je]=t,e[mt]=l;e:for(c=t.child;c!==null;){if(c.tag===5||c.tag===6)e.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===t)break e;for(;c.sibling===null;){if(c.return===null||c.return===t)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}t.stateNode=e;e:switch(Nt(e,i,l),i){case"button":case"input":case"select":case"textarea":e=!!l.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Da(t)}}return Qe(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==l&&Da(t);else{if(typeof l!="string"&&t.stateNode===null)throw Error(r(166));if(e=he.current,Ar(t)){if(e=t.stateNode,i=t.memoizedProps,l=null,c=Bt,c!==null)switch(c.tag){case 27:case 5:l=c.memoizedProps}e[Je]=t,e=!!(e.nodeValue===i||l!==null&&l.suppressHydrationWarning===!0||bg(e.nodeValue,i)),e||Ii(t)}else e=Vo(e).createTextNode(l),e[Je]=t,t.stateNode=e}return Qe(t),null;case 13:if(l=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=Ar(t),l!==null&&l.dehydrated!==null){if(e===null){if(!c)throw Error(r(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));c[Je]=t}else Cr(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Qe(t),c=!1}else c=a0(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return t.flags&256?(Na(t),t):(Na(t),null)}if(Na(t),(t.flags&128)!==0)return t.lanes=i,t;if(i=l!==null,e=e!==null&&e.memoizedState!==null,i){l=t.child,c=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(c=l.alternate.memoizedState.cachePool.pool);var d=null;l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(d=l.memoizedState.cachePool.pool),d!==c&&(l.flags|=2048)}return i!==e&&i&&(t.child.flags|=8192),Lo(t,t.updateQueue),Qe(t),null;case 4:return Ct(),e===null&&ef(t.stateNode.containerInfo),Qe(t),null;case 10:return _a(t.type),Qe(t),null;case 19:if(ee(yt),c=t.memoizedState,c===null)return Qe(t),null;if(l=(t.flags&128)!==0,d=c.rendering,d===null)if(l)Ir(c,!1);else{if(at!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(d=_o(e),d!==null){for(t.flags|=128,Ir(c,!1),e=d.updateQueue,t.updateQueue=e,Lo(t,e),t.subtreeFlags=0,e=i,i=t.child;i!==null;)Wm(i,e),i=i.sibling;return W(yt,yt.current&1|2),t.child}e=e.sibling}c.tail!==null&&ot()>qo&&(t.flags|=128,l=!0,Ir(c,!1),t.lanes=4194304)}else{if(!l)if(e=_o(d),e!==null){if(t.flags|=128,l=!0,e=e.updateQueue,t.updateQueue=e,Lo(t,e),Ir(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!Le)return Qe(t),null}else 2*ot()-c.renderingStartTime>qo&&i!==536870912&&(t.flags|=128,l=!0,Ir(c,!1),t.lanes=4194304);c.isBackwards?(d.sibling=t.child,t.child=d):(e=c.last,e!==null?e.sibling=d:t.child=d,c.last=d)}return c.tail!==null?(t=c.tail,c.rendering=t,c.tail=t.sibling,c.renderingStartTime=ot(),t.sibling=null,e=yt.current,W(yt,l?e&1|2:e&1),t):(Qe(t),null);case 22:case 23:return Na(t),nd(),l=t.memoizedState!==null,e!==null?e.memoizedState!==null!==l&&(t.flags|=8192):l&&(t.flags|=8192),l?(i&536870912)!==0&&(t.flags&128)===0&&(Qe(t),t.subtreeFlags&6&&(t.flags|=8192)):Qe(t),i=t.updateQueue,i!==null&&Lo(t,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),l=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(l=t.memoizedState.cachePool.pool),l!==i&&(t.flags|=2048),e!==null&&ee($i),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),_a(gt),Qe(t),null;case 25:return null;case 30:return null}throw Error(r(156,t.tag))}function K1(e,t){switch(Iu(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return _a(gt),Ct(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return wn(t),null;case 13:if(Na(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(r(340));Cr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ee(yt),null;case 4:return Ct(),null;case 10:return _a(t.type),null;case 22:case 23:return Na(t),nd(),e!==null&&ee($i),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return _a(gt),null;case 25:return null;default:return null}}function Cp(e,t){switch(Iu(t),t.tag){case 3:_a(gt),Ct();break;case 26:case 27:case 5:wn(t);break;case 4:Ct();break;case 13:Na(t);break;case 19:ee(yt);break;case 10:_a(t.type);break;case 22:case 23:Na(t),nd(),e!==null&&ee($i);break;case 24:_a(gt)}}function Yr(e,t){try{var i=t.updateQueue,l=i!==null?i.lastEffect:null;if(l!==null){var c=l.next;i=c;do{if((i.tag&e)===e){l=void 0;var d=i.create,y=i.inst;l=d(),y.destroy=l}i=i.next}while(i!==c)}}catch(v){Fe(t,t.return,v)}}function oi(e,t,i){try{var l=t.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var d=c.next;l=d;do{if((l.tag&e)===e){var y=l.inst,v=y.destroy;if(v!==void 0){y.destroy=void 0,c=t;var x=i,q=v;try{q()}catch(K){Fe(c,x,K)}}}l=l.next}while(l!==d)}}catch(K){Fe(t,t.return,K)}}function Tp(e){var t=e.updateQueue;if(t!==null){var i=e.stateNode;try{m0(t,i)}catch(l){Fe(e,e.return,l)}}}function _p(e,t,i){i.props=Xi(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(l){Fe(e,t,l)}}function Fr(e,t){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var l=e.stateNode;break;case 30:l=e.stateNode;break;default:l=e.stateNode}typeof i=="function"?e.refCleanup=i(l):i.current=l}}catch(c){Fe(e,t,c)}}function Kn(e,t){var i=e.ref,l=e.refCleanup;if(i!==null)if(typeof l=="function")try{l()}catch(c){Fe(e,t,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(c){Fe(e,t,c)}else i.current=null}function Rp(e){var t=e.type,i=e.memoizedProps,l=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":i.autoFocus&&l.focus();break e;case"img":i.src?l.src=i.src:i.srcSet&&(l.srcset=i.srcSet)}}catch(c){Fe(e,e.return,c)}}function Nd(e,t,i){try{var l=e.stateNode;pS(l,e.type,i,t),l[mt]=t}catch(c){Fe(e,e.return,c)}}function Np(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&gi(e.type)||e.tag===4}function kd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Np(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&gi(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Dd(e,t,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,t):(t=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,t.appendChild(e),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=$o));else if(l!==4&&(l===27&&gi(e.type)&&(i=e.stateNode,t=null),e=e.child,e!==null))for(Dd(e,t,i),e=e.sibling;e!==null;)Dd(e,t,i),e=e.sibling}function Uo(e,t,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(l!==4&&(l===27&&gi(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(Uo(e,t,i),e=e.sibling;e!==null;)Uo(e,t,i),e=e.sibling}function kp(e){var t=e.stateNode,i=e.memoizedProps;try{for(var l=e.type,c=t.attributes;c.length;)t.removeAttributeNode(c[0]);Nt(t,l,i),t[Je]=e,t[mt]=i}catch(d){Fe(e,e.return,d)}}var La=!1,rt=!1,Ld=!1,Dp=typeof WeakSet=="function"?WeakSet:Set,wt=null;function Q1(e,t){if(e=e.containerInfo,af=Jo,e=Ym(e),ku(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var l=i.getSelection&&i.getSelection();if(l&&l.rangeCount!==0){i=l.anchorNode;var c=l.anchorOffset,d=l.focusNode;l=l.focusOffset;try{i.nodeType,d.nodeType}catch{i=null;break e}var y=0,v=-1,x=-1,q=0,K=0,Z=e,z=null;t:for(;;){for(var j;Z!==i||c!==0&&Z.nodeType!==3||(v=y+c),Z!==d||l!==0&&Z.nodeType!==3||(x=y+l),Z.nodeType===3&&(y+=Z.nodeValue.length),(j=Z.firstChild)!==null;)z=Z,Z=j;for(;;){if(Z===e)break t;if(z===i&&++q===c&&(v=y),z===d&&++K===l&&(x=y),(j=Z.nextSibling)!==null)break;Z=z,z=Z.parentNode}Z=j}i=v===-1||x===-1?null:{start:v,end:x}}else i=null}i=i||{start:0,end:0}}else i=null;for(sf={focusedElem:e,selectionRange:i},Jo=!1,wt=t;wt!==null;)if(t=wt,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,wt=e;else for(;wt!==null;){switch(t=wt,d=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,i=t,c=d.memoizedProps,d=d.memoizedState,l=i.stateNode;try{var be=Xi(i.type,c,i.elementType===i.type);e=l.getSnapshotBeforeUpdate(be,d),l.__reactInternalSnapshotBeforeUpdate=e}catch(ge){Fe(i,i.return,ge)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,i=e.nodeType,i===9)of(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":of(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(r(163))}if(e=t.sibling,e!==null){e.return=t.return,wt=e;break}wt=t.return}}function Lp(e,t,i){var l=i.flags;switch(i.tag){case 0:case 11:case 15:ci(e,i),l&4&&Yr(5,i);break;case 1:if(ci(e,i),l&4)if(e=i.stateNode,t===null)try{e.componentDidMount()}catch(y){Fe(i,i.return,y)}else{var c=Xi(i.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(c,t,e.__reactInternalSnapshotBeforeUpdate)}catch(y){Fe(i,i.return,y)}}l&64&&Tp(i),l&512&&Fr(i,i.return);break;case 3:if(ci(e,i),l&64&&(e=i.updateQueue,e!==null)){if(t=null,i.child!==null)switch(i.child.tag){case 27:case 5:t=i.child.stateNode;break;case 1:t=i.child.stateNode}try{m0(e,t)}catch(y){Fe(i,i.return,y)}}break;case 27:t===null&&l&4&&kp(i);case 26:case 5:ci(e,i),t===null&&l&4&&Rp(i),l&512&&Fr(i,i.return);break;case 12:ci(e,i);break;case 13:ci(e,i),l&4&&qp(e,i),l&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=iS.bind(null,i),MS(e,i))));break;case 22:if(l=i.memoizedState!==null||La,!l){t=t!==null&&t.memoizedState!==null||rt,c=La;var d=rt;La=l,(rt=t)&&!d?ui(e,i,(i.subtreeFlags&8772)!==0):ci(e,i),La=c,rt=d}break;case 30:break;default:ci(e,i)}}function Up(e){var t=e.alternate;t!==null&&(e.alternate=null,Up(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&hs(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ke=null,Kt=!1;function Ua(e,t,i){for(i=i.child;i!==null;)Op(e,t,i),i=i.sibling}function Op(e,t,i){if(Ze&&typeof Ze.onCommitFiberUnmount=="function")try{Ze.onCommitFiberUnmount(Ue,i)}catch{}switch(i.tag){case 26:rt||Kn(i,t),Ua(e,t,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:rt||Kn(i,t);var l=Ke,c=Kt;gi(i.type)&&(Ke=i.stateNode,Kt=!1),Ua(e,t,i),Wr(i.stateNode),Ke=l,Kt=c;break;case 5:rt||Kn(i,t);case 6:if(l=Ke,c=Kt,Ke=null,Ua(e,t,i),Ke=l,Kt=c,Ke!==null)if(Kt)try{(Ke.nodeType===9?Ke.body:Ke.nodeName==="HTML"?Ke.ownerDocument.body:Ke).removeChild(i.stateNode)}catch(d){Fe(i,t,d)}else try{Ke.removeChild(i.stateNode)}catch(d){Fe(i,t,d)}break;case 18:Ke!==null&&(Kt?(e=Ke,xg(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),ll(e)):xg(Ke,i.stateNode));break;case 4:l=Ke,c=Kt,Ke=i.stateNode.containerInfo,Kt=!0,Ua(e,t,i),Ke=l,Kt=c;break;case 0:case 11:case 14:case 15:rt||oi(2,i,t),rt||oi(4,i,t),Ua(e,t,i);break;case 1:rt||(Kn(i,t),l=i.stateNode,typeof l.componentWillUnmount=="function"&&_p(i,t,l)),Ua(e,t,i);break;case 21:Ua(e,t,i);break;case 22:rt=(l=rt)||i.memoizedState!==null,Ua(e,t,i),rt=l;break;default:Ua(e,t,i)}}function qp(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{ll(e)}catch(i){Fe(t,t.return,i)}}function P1(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new Dp),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new Dp),t;default:throw Error(r(435,e.tag))}}function Ud(e,t){var i=P1(e);t.forEach(function(l){var c=sS.bind(null,e,l);i.has(l)||(i.add(l),l.then(c,c))})}function on(e,t){var i=t.deletions;if(i!==null)for(var l=0;l<i.length;l++){var c=i[l],d=e,y=t,v=y;e:for(;v!==null;){switch(v.tag){case 27:if(gi(v.type)){Ke=v.stateNode,Kt=!1;break e}break;case 5:Ke=v.stateNode,Kt=!1;break e;case 3:case 4:Ke=v.stateNode.containerInfo,Kt=!0;break e}v=v.return}if(Ke===null)throw Error(r(160));Op(d,y,c),Ke=null,Kt=!1,d=c.alternate,d!==null&&(d.return=null),c.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)zp(t,e),t=t.sibling}var Dn=null;function zp(e,t){var i=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:on(t,e),cn(e),l&4&&(oi(3,e,e.return),Yr(3,e),oi(5,e,e.return));break;case 1:on(t,e),cn(e),l&512&&(rt||i===null||Kn(i,i.return)),l&64&&La&&(e=e.updateQueue,e!==null&&(l=e.callbacks,l!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?l:i.concat(l))));break;case 26:var c=Dn;if(on(t,e),cn(e),l&512&&(rt||i===null||Kn(i,i.return)),l&4){var d=i!==null?i.memoizedState:null;if(l=e.memoizedState,i===null)if(l===null)if(e.stateNode===null){e:{l=e.type,i=e.memoizedProps,c=c.ownerDocument||c;t:switch(l){case"title":d=c.getElementsByTagName("title")[0],(!d||d[ki]||d[Je]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=c.createElement(l),c.head.insertBefore(d,c.querySelector("head > title"))),Nt(d,l,i),d[Je]=e,We(d),l=d;break e;case"link":var y=kg("link","href",c).get(l+(i.href||""));if(y){for(var v=0;v<y.length;v++)if(d=y[v],d.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&d.getAttribute("rel")===(i.rel==null?null:i.rel)&&d.getAttribute("title")===(i.title==null?null:i.title)&&d.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){y.splice(v,1);break t}}d=c.createElement(l),Nt(d,l,i),c.head.appendChild(d);break;case"meta":if(y=kg("meta","content",c).get(l+(i.content||""))){for(v=0;v<y.length;v++)if(d=y[v],d.getAttribute("content")===(i.content==null?null:""+i.content)&&d.getAttribute("name")===(i.name==null?null:i.name)&&d.getAttribute("property")===(i.property==null?null:i.property)&&d.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&d.getAttribute("charset")===(i.charSet==null?null:i.charSet)){y.splice(v,1);break t}}d=c.createElement(l),Nt(d,l,i),c.head.appendChild(d);break;default:throw Error(r(468,l))}d[Je]=e,We(d),l=d}e.stateNode=l}else Dg(c,e.type,e.stateNode);else e.stateNode=Ng(c,l,e.memoizedProps);else d!==l?(d===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):d.count--,l===null?Dg(c,e.type,e.stateNode):Ng(c,l,e.memoizedProps)):l===null&&e.stateNode!==null&&Nd(e,e.memoizedProps,i.memoizedProps)}break;case 27:on(t,e),cn(e),l&512&&(rt||i===null||Kn(i,i.return)),i!==null&&l&4&&Nd(e,e.memoizedProps,i.memoizedProps);break;case 5:if(on(t,e),cn(e),l&512&&(rt||i===null||Kn(i,i.return)),e.flags&32){c=e.stateNode;try{ps(c,"")}catch(j){Fe(e,e.return,j)}}l&4&&e.stateNode!=null&&(c=e.memoizedProps,Nd(e,c,i!==null?i.memoizedProps:c)),l&1024&&(Ld=!0);break;case 6:if(on(t,e),cn(e),l&4){if(e.stateNode===null)throw Error(r(162));l=e.memoizedProps,i=e.stateNode;try{i.nodeValue=l}catch(j){Fe(e,e.return,j)}}break;case 3:if(Qo=null,c=Dn,Dn=Xo(t.containerInfo),on(t,e),Dn=c,cn(e),l&4&&i!==null&&i.memoizedState.isDehydrated)try{ll(t.containerInfo)}catch(j){Fe(e,e.return,j)}Ld&&(Ld=!1,Bp(e));break;case 4:l=Dn,Dn=Xo(e.stateNode.containerInfo),on(t,e),cn(e),Dn=l;break;case 12:on(t,e),cn(e);break;case 13:on(t,e),cn(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(jd=ot()),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,Ud(e,l)));break;case 22:c=e.memoizedState!==null;var x=i!==null&&i.memoizedState!==null,q=La,K=rt;if(La=q||c,rt=K||x,on(t,e),rt=K,La=q,cn(e),l&8192)e:for(t=e.stateNode,t._visibility=c?t._visibility&-2:t._visibility|1,c&&(i===null||x||La||rt||Ki(e)),i=null,t=e;;){if(t.tag===5||t.tag===26){if(i===null){x=i=t;try{if(d=x.stateNode,c)y=d.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{v=x.stateNode;var Z=x.memoizedProps.style,z=Z!=null&&Z.hasOwnProperty("display")?Z.display:null;v.style.display=z==null||typeof z=="boolean"?"":(""+z).trim()}}catch(j){Fe(x,x.return,j)}}}else if(t.tag===6){if(i===null){x=t;try{x.stateNode.nodeValue=c?"":x.memoizedProps}catch(j){Fe(x,x.return,j)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;i===t&&(i=null),t=t.return}i===t&&(i=null),t.sibling.return=t.return,t=t.sibling}l&4&&(l=e.updateQueue,l!==null&&(i=l.retryQueue,i!==null&&(l.retryQueue=null,Ud(e,i))));break;case 19:on(t,e),cn(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,Ud(e,l)));break;case 30:break;case 21:break;default:on(t,e),cn(e)}}function cn(e){var t=e.flags;if(t&2){try{for(var i,l=e.return;l!==null;){if(Np(l)){i=l;break}l=l.return}if(i==null)throw Error(r(160));switch(i.tag){case 27:var c=i.stateNode,d=kd(e);Uo(e,d,c);break;case 5:var y=i.stateNode;i.flags&32&&(ps(y,""),i.flags&=-33);var v=kd(e);Uo(e,v,y);break;case 3:case 4:var x=i.stateNode.containerInfo,q=kd(e);Dd(e,q,x);break;default:throw Error(r(161))}}catch(K){Fe(e,e.return,K)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Bp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;Bp(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function ci(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)Lp(e,t.alternate,t),t=t.sibling}function Ki(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:oi(4,t,t.return),Ki(t);break;case 1:Kn(t,t.return);var i=t.stateNode;typeof i.componentWillUnmount=="function"&&_p(t,t.return,i),Ki(t);break;case 27:Wr(t.stateNode);case 26:case 5:Kn(t,t.return),Ki(t);break;case 22:t.memoizedState===null&&Ki(t);break;case 30:Ki(t);break;default:Ki(t)}e=e.sibling}}function ui(e,t,i){for(i=i&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var l=t.alternate,c=e,d=t,y=d.flags;switch(d.tag){case 0:case 11:case 15:ui(c,d,i),Yr(4,d);break;case 1:if(ui(c,d,i),l=d,c=l.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(q){Fe(l,l.return,q)}if(l=d,c=l.updateQueue,c!==null){var v=l.stateNode;try{var x=c.shared.hiddenCallbacks;if(x!==null)for(c.shared.hiddenCallbacks=null,c=0;c<x.length;c++)h0(x[c],v)}catch(q){Fe(l,l.return,q)}}i&&y&64&&Tp(d),Fr(d,d.return);break;case 27:kp(d);case 26:case 5:ui(c,d,i),i&&l===null&&y&4&&Rp(d),Fr(d,d.return);break;case 12:ui(c,d,i);break;case 13:ui(c,d,i),i&&y&4&&qp(c,d);break;case 22:d.memoizedState===null&&ui(c,d,i),Fr(d,d.return);break;case 30:break;default:ui(c,d,i)}t=t.sibling}}function Od(e,t){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Rr(i))}function qd(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Rr(e))}function Qn(e,t,i,l){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Hp(e,t,i,l),t=t.sibling}function Hp(e,t,i,l){var c=t.flags;switch(t.tag){case 0:case 11:case 15:Qn(e,t,i,l),c&2048&&Yr(9,t);break;case 1:Qn(e,t,i,l);break;case 3:Qn(e,t,i,l),c&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Rr(e)));break;case 12:if(c&2048){Qn(e,t,i,l),e=t.stateNode;try{var d=t.memoizedProps,y=d.id,v=d.onPostCommit;typeof v=="function"&&v(y,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(x){Fe(t,t.return,x)}}else Qn(e,t,i,l);break;case 13:Qn(e,t,i,l);break;case 23:break;case 22:d=t.stateNode,y=t.alternate,t.memoizedState!==null?d._visibility&2?Qn(e,t,i,l):$r(e,t):d._visibility&2?Qn(e,t,i,l):(d._visibility|=2,Us(e,t,i,l,(t.subtreeFlags&10256)!==0)),c&2048&&Od(y,t);break;case 24:Qn(e,t,i,l),c&2048&&qd(t.alternate,t);break;default:Qn(e,t,i,l)}}function Us(e,t,i,l,c){for(c=c&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var d=e,y=t,v=i,x=l,q=y.flags;switch(y.tag){case 0:case 11:case 15:Us(d,y,v,x,c),Yr(8,y);break;case 23:break;case 22:var K=y.stateNode;y.memoizedState!==null?K._visibility&2?Us(d,y,v,x,c):$r(d,y):(K._visibility|=2,Us(d,y,v,x,c)),c&&q&2048&&Od(y.alternate,y);break;case 24:Us(d,y,v,x,c),c&&q&2048&&qd(y.alternate,y);break;default:Us(d,y,v,x,c)}t=t.sibling}}function $r(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var i=e,l=t,c=l.flags;switch(l.tag){case 22:$r(i,l),c&2048&&Od(l.alternate,l);break;case 24:$r(i,l),c&2048&&qd(l.alternate,l);break;default:$r(i,l)}t=t.sibling}}var Vr=8192;function Os(e){if(e.subtreeFlags&Vr)for(e=e.child;e!==null;)jp(e),e=e.sibling}function jp(e){switch(e.tag){case 26:Os(e),e.flags&Vr&&e.memoizedState!==null&&OS(Dn,e.memoizedState,e.memoizedProps);break;case 5:Os(e);break;case 3:case 4:var t=Dn;Dn=Xo(e.stateNode.containerInfo),Os(e),Dn=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=Vr,Vr=16777216,Os(e),Vr=t):Os(e));break;default:Os(e)}}function Gp(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Xr(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var l=t[i];wt=l,Yp(l,e)}Gp(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Ip(e),e=e.sibling}function Ip(e){switch(e.tag){case 0:case 11:case 15:Xr(e),e.flags&2048&&oi(9,e,e.return);break;case 3:Xr(e);break;case 12:Xr(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Oo(e)):Xr(e);break;default:Xr(e)}}function Oo(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var l=t[i];wt=l,Yp(l,e)}Gp(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:oi(8,t,t.return),Oo(t);break;case 22:i=t.stateNode,i._visibility&2&&(i._visibility&=-3,Oo(t));break;default:Oo(t)}e=e.sibling}}function Yp(e,t){for(;wt!==null;){var i=wt;switch(i.tag){case 0:case 11:case 15:oi(8,i,t);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var l=i.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Rr(i.memoizedState.cache)}if(l=i.child,l!==null)l.return=i,wt=l;else e:for(i=e;wt!==null;){l=wt;var c=l.sibling,d=l.return;if(Up(l),l===i){wt=null;break e}if(c!==null){c.return=d,wt=c;break e}wt=d}}}var Z1={getCacheForType:function(e){var t=Dt(gt),i=t.data.get(e);return i===void 0&&(i=e(),t.data.set(e,i)),i}},J1=typeof WeakMap=="function"?WeakMap:Map,Oe=0,Ve=null,Ce=null,ke=0,qe=0,un=null,di=!1,qs=!1,zd=!1,Oa=0,at=0,fi=0,Qi=0,Bd=0,Sn=0,zs=0,Kr=null,Qt=null,Hd=!1,jd=0,qo=1/0,zo=null,hi=null,Rt=0,mi=null,Bs=null,Hs=0,Gd=0,Id=null,Fp=null,Qr=0,Yd=null;function dn(){if((Oe&2)!==0&&ke!==0)return ke&-ke;if(T.T!==null){var e=Cs;return e!==0?e:Pd()}return Yl()}function $p(){Sn===0&&(Sn=(ke&536870912)===0||Le?Re():536870912);var e=vn.current;return e!==null&&(e.flags|=32),Sn}function fn(e,t,i){(e===Ve&&(qe===2||qe===9)||e.cancelPendingCommit!==null)&&(js(e,0),pi(e,ke,Sn,!1)),Tt(e,i),((Oe&2)===0||e!==Ve)&&(e===Ve&&((Oe&2)===0&&(Qi|=i),at===4&&pi(e,ke,Sn,!1)),Pn(e))}function Vp(e,t,i){if((Oe&6)!==0)throw Error(r(327));var l=!i&&(t&124)===0&&(t&e.expiredLanes)===0||ve(e,t),c=l?tS(e,t):Vd(e,t,!0),d=l;do{if(c===0){qs&&!l&&pi(e,t,0,!1);break}else{if(i=e.current.alternate,d&&!W1(i)){c=Vd(e,t,!1),d=!1;continue}if(c===2){if(d=t,e.errorRecoveryDisabledLanes&d)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){t=y;e:{var v=e;c=Kr;var x=v.current.memoizedState.isDehydrated;if(x&&(js(v,y).flags|=256),y=Vd(v,y,!1),y!==2){if(zd&&!x){v.errorRecoveryDisabledLanes|=d,Qi|=d,c=4;break e}d=Qt,Qt=c,d!==null&&(Qt===null?Qt=d:Qt.push.apply(Qt,d))}c=y}if(d=!1,c!==2)continue}}if(c===1){js(e,0),pi(e,t,0,!0);break}e:{switch(l=e,d=c,d){case 0:case 1:throw Error(r(345));case 4:if((t&4194048)!==t)break;case 6:pi(l,t,Sn,!di);break e;case 2:Qt=null;break;case 3:case 5:break;default:throw Error(r(329))}if((t&62914560)===t&&(c=jd+300-ot(),10<c)){if(pi(l,t,Sn,!di),ce(l,0,!0)!==0)break e;l.timeoutHandle=Eg(Xp.bind(null,l,i,Qt,zo,Hd,t,Sn,Qi,zs,di,d,2,-0,0),c);break e}Xp(l,i,Qt,zo,Hd,t,Sn,Qi,zs,di,d,0,-0,0)}}break}while(!0);Pn(e)}function Xp(e,t,i,l,c,d,y,v,x,q,K,Z,z,j){if(e.timeoutHandle=-1,Z=t.subtreeFlags,(Z&8192||(Z&16785408)===16785408)&&(nl={stylesheets:null,count:0,unsuspend:US},jp(t),Z=qS(),Z!==null)){e.cancelPendingCommit=Z(eg.bind(null,e,t,d,i,l,c,y,v,x,K,1,z,j)),pi(e,d,y,!q);return}eg(e,t,d,i,l,c,y,v,x)}function W1(e){for(var t=e;;){var i=t.tag;if((i===0||i===11||i===15)&&t.flags&16384&&(i=t.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var l=0;l<i.length;l++){var c=i[l],d=c.getSnapshot;c=c.value;try{if(!rn(d(),c))return!1}catch{return!1}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function pi(e,t,i,l){t&=~Bd,t&=~Qi,e.suspendedLanes|=t,e.pingedLanes&=~t,l&&(e.warmLanes|=t),l=e.expirationTimes;for(var c=t;0<c;){var d=31-ft(c),y=1<<d;l[d]=-1,c&=~y}i!==0&&ma(e,i,t)}function Bo(){return(Oe&6)===0?(Pr(0),!1):!0}function Fd(){if(Ce!==null){if(qe===0)var e=Ce.return;else e=Ce,Ta=Yi=null,ld(e),Ds=null,jr=0,e=Ce;for(;e!==null;)Cp(e.alternate,e),e=e.return;Ce=null}}function js(e,t){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,yS(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),Fd(),Ve=e,Ce=i=wa(e.current,null),ke=t,qe=0,un=null,di=!1,qs=ve(e,t),zd=!1,zs=Sn=Bd=Qi=fi=at=0,Qt=Kr=null,Hd=!1,(t&8)!==0&&(t|=t&32);var l=e.entangledLanes;if(l!==0)for(e=e.entanglements,l&=t;0<l;){var c=31-ft(l),d=1<<c;t|=e[c],l&=~d}return Oa=t,so(),i}function Kp(e,t){Me=null,T.H=Ao,t===kr||t===po?(t=d0(),qe=3):t===o0?(t=d0(),qe=4):qe=t===fp?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,un=t,Ce===null&&(at=1,No(e,pn(t,e.current)))}function Qp(){var e=T.H;return T.H=Ao,e===null?Ao:e}function Pp(){var e=T.A;return T.A=Z1,e}function $d(){at=4,di||(ke&4194048)!==ke&&vn.current!==null||(qs=!0),(fi&134217727)===0&&(Qi&134217727)===0||Ve===null||pi(Ve,ke,Sn,!1)}function Vd(e,t,i){var l=Oe;Oe|=2;var c=Qp(),d=Pp();(Ve!==e||ke!==t)&&(zo=null,js(e,t)),t=!1;var y=at;e:do try{if(qe!==0&&Ce!==null){var v=Ce,x=un;switch(qe){case 8:Fd(),y=6;break e;case 3:case 2:case 9:case 6:vn.current===null&&(t=!0);var q=qe;if(qe=0,un=null,Gs(e,v,x,q),i&&qs){y=0;break e}break;default:q=qe,qe=0,un=null,Gs(e,v,x,q)}}eS(),y=at;break}catch(K){Kp(e,K)}while(!0);return t&&e.shellSuspendCounter++,Ta=Yi=null,Oe=l,T.H=c,T.A=d,Ce===null&&(Ve=null,ke=0,so()),y}function eS(){for(;Ce!==null;)Zp(Ce)}function tS(e,t){var i=Oe;Oe|=2;var l=Qp(),c=Pp();Ve!==e||ke!==t?(zo=null,qo=ot()+500,js(e,t)):qs=ve(e,t);e:do try{if(qe!==0&&Ce!==null){t=Ce;var d=un;t:switch(qe){case 1:qe=0,un=null,Gs(e,t,d,1);break;case 2:case 9:if(c0(d)){qe=0,un=null,Jp(t);break}t=function(){qe!==2&&qe!==9||Ve!==e||(qe=7),Pn(e)},d.then(t,t);break e;case 3:qe=7;break e;case 4:qe=5;break e;case 7:c0(d)?(qe=0,un=null,Jp(t)):(qe=0,un=null,Gs(e,t,d,7));break;case 5:var y=null;switch(Ce.tag){case 26:y=Ce.memoizedState;case 5:case 27:var v=Ce;if(!y||Lg(y)){qe=0,un=null;var x=v.sibling;if(x!==null)Ce=x;else{var q=v.return;q!==null?(Ce=q,Ho(q)):Ce=null}break t}}qe=0,un=null,Gs(e,t,d,5);break;case 6:qe=0,un=null,Gs(e,t,d,6);break;case 8:Fd(),at=6;break e;default:throw Error(r(462))}}nS();break}catch(K){Kp(e,K)}while(!0);return Ta=Yi=null,T.H=l,T.A=c,Oe=i,Ce!==null?0:(Ve=null,ke=0,so(),at)}function nS(){for(;Ce!==null&&!ca();)Zp(Ce)}function Zp(e){var t=wp(e.alternate,e,Oa);e.memoizedProps=e.pendingProps,t===null?Ho(e):Ce=t}function Jp(e){var t=e,i=t.alternate;switch(t.tag){case 15:case 0:t=bp(i,t,t.pendingProps,t.type,void 0,ke);break;case 11:t=bp(i,t,t.pendingProps,t.type.render,t.ref,ke);break;case 5:ld(t);default:Cp(i,t),t=Ce=Wm(t,Oa),t=wp(i,t,Oa)}e.memoizedProps=e.pendingProps,t===null?Ho(e):Ce=t}function Gs(e,t,i,l){Ta=Yi=null,ld(t),Ds=null,jr=0;var c=t.return;try{if($1(e,c,t,i,ke)){at=1,No(e,pn(i,e.current)),Ce=null;return}}catch(d){if(c!==null)throw Ce=c,d;at=1,No(e,pn(i,e.current)),Ce=null;return}t.flags&32768?(Le||l===1?e=!0:qs||(ke&536870912)!==0?e=!1:(di=e=!0,(l===2||l===9||l===3||l===6)&&(l=vn.current,l!==null&&l.tag===13&&(l.flags|=16384))),Wp(t,e)):Ho(t)}function Ho(e){var t=e;do{if((t.flags&32768)!==0){Wp(t,di);return}e=t.return;var i=X1(t.alternate,t,Oa);if(i!==null){Ce=i;return}if(t=t.sibling,t!==null){Ce=t;return}Ce=t=e}while(t!==null);at===0&&(at=5)}function Wp(e,t){do{var i=K1(e.alternate,e);if(i!==null){i.flags&=32767,Ce=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!t&&(e=e.sibling,e!==null)){Ce=e;return}Ce=e=i}while(e!==null);at=6,Ce=null}function eg(e,t,i,l,c,d,y,v,x){e.cancelPendingCommit=null;do jo();while(Rt!==0);if((Oe&6)!==0)throw Error(r(327));if(t!==null){if(t===e.current)throw Error(r(177));if(d=t.lanes|t.childLanes,d|=qu,ha(e,i,d,y,v,x),e===Ve&&(Ce=Ve=null,ke=0),Bs=t,mi=e,Hs=i,Gd=d,Id=c,Fp=l,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,rS($t,function(){return sg(),null})):(e.callbackNode=null,e.callbackPriority=0),l=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||l){l=T.T,T.T=null,c=I.p,I.p=2,y=Oe,Oe|=4;try{Q1(e,t,i)}finally{Oe=y,I.p=c,T.T=l}}Rt=1,tg(),ng(),ag()}}function tg(){if(Rt===1){Rt=0;var e=mi,t=Bs,i=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||i){i=T.T,T.T=null;var l=I.p;I.p=2;var c=Oe;Oe|=4;try{zp(t,e);var d=sf,y=Ym(e.containerInfo),v=d.focusedElem,x=d.selectionRange;if(y!==v&&v&&v.ownerDocument&&Im(v.ownerDocument.documentElement,v)){if(x!==null&&ku(v)){var q=x.start,K=x.end;if(K===void 0&&(K=q),"selectionStart"in v)v.selectionStart=q,v.selectionEnd=Math.min(K,v.value.length);else{var Z=v.ownerDocument||document,z=Z&&Z.defaultView||window;if(z.getSelection){var j=z.getSelection(),be=v.textContent.length,ge=Math.min(x.start,be),je=x.end===void 0?ge:Math.min(x.end,be);!j.extend&&ge>je&&(y=je,je=ge,ge=y);var D=Gm(v,ge),C=Gm(v,je);if(D&&C&&(j.rangeCount!==1||j.anchorNode!==D.node||j.anchorOffset!==D.offset||j.focusNode!==C.node||j.focusOffset!==C.offset)){var O=Z.createRange();O.setStart(D.node,D.offset),j.removeAllRanges(),ge>je?(j.addRange(O),j.extend(C.node,C.offset)):(O.setEnd(C.node,C.offset),j.addRange(O))}}}}for(Z=[],j=v;j=j.parentNode;)j.nodeType===1&&Z.push({element:j,left:j.scrollLeft,top:j.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<Z.length;v++){var Q=Z[v];Q.element.scrollLeft=Q.left,Q.element.scrollTop=Q.top}}Jo=!!af,sf=af=null}finally{Oe=c,I.p=l,T.T=i}}e.current=t,Rt=2}}function ng(){if(Rt===2){Rt=0;var e=mi,t=Bs,i=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||i){i=T.T,T.T=null;var l=I.p;I.p=2;var c=Oe;Oe|=4;try{Lp(e,t.alternate,t)}finally{Oe=c,I.p=l,T.T=i}}Rt=3}}function ag(){if(Rt===4||Rt===3){Rt=0,ua();var e=mi,t=Bs,i=Hs,l=Fp;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?Rt=5:(Rt=0,Bs=mi=null,ig(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(hi=null),ya(i),t=t.stateNode,Ze&&typeof Ze.onCommitFiberRoot=="function")try{Ze.onCommitFiberRoot(Ue,t,void 0,(t.current.flags&128)===128)}catch{}if(l!==null){t=T.T,c=I.p,I.p=2,T.T=null;try{for(var d=e.onRecoverableError,y=0;y<l.length;y++){var v=l[y];d(v.value,{componentStack:v.stack})}}finally{T.T=t,I.p=c}}(Hs&3)!==0&&jo(),Pn(e),c=e.pendingLanes,(i&4194090)!==0&&(c&42)!==0?e===Yd?Qr++:(Qr=0,Yd=e):Qr=0,Pr(0)}}function ig(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Rr(t)))}function jo(e){return tg(),ng(),ag(),sg()}function sg(){if(Rt!==5)return!1;var e=mi,t=Gd;Gd=0;var i=ya(Hs),l=T.T,c=I.p;try{I.p=32>i?32:i,T.T=null,i=Id,Id=null;var d=mi,y=Hs;if(Rt=0,Bs=mi=null,Hs=0,(Oe&6)!==0)throw Error(r(331));var v=Oe;if(Oe|=4,Ip(d.current),Hp(d,d.current,y,i),Oe=v,Pr(0,!1),Ze&&typeof Ze.onPostCommitFiberRoot=="function")try{Ze.onPostCommitFiberRoot(Ue,d)}catch{}return!0}finally{I.p=c,T.T=l,ig(e,t)}}function rg(e,t,i){t=pn(i,t),t=Ed(e.stateNode,t,2),e=ii(e,t,2),e!==null&&(Tt(e,2),Pn(e))}function Fe(e,t,i){if(e.tag===3)rg(e,e,i);else for(;t!==null;){if(t.tag===3){rg(t,e,i);break}else if(t.tag===1){var l=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(hi===null||!hi.has(l))){e=pn(i,e),i=up(2),l=ii(t,i,2),l!==null&&(dp(i,l,t,e),Tt(l,2),Pn(l));break}}t=t.return}}function Xd(e,t,i){var l=e.pingCache;if(l===null){l=e.pingCache=new J1;var c=new Set;l.set(t,c)}else c=l.get(t),c===void 0&&(c=new Set,l.set(t,c));c.has(i)||(zd=!0,c.add(i),e=aS.bind(null,e,t,i),t.then(e,e))}function aS(e,t,i){var l=e.pingCache;l!==null&&l.delete(t),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Ve===e&&(ke&i)===i&&(at===4||at===3&&(ke&62914560)===ke&&300>ot()-jd?(Oe&2)===0&&js(e,0):Bd|=i,zs===ke&&(zs=0)),Pn(e)}function lg(e,t){t===0&&(t=Et()),e=Ms(e,t),e!==null&&(Tt(e,t),Pn(e))}function iS(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),lg(e,i)}function sS(e,t){var i=0;switch(e.tag){case 13:var l=e.stateNode,c=e.memoizedState;c!==null&&(i=c.retryLane);break;case 19:l=e.stateNode;break;case 22:l=e.stateNode._retryCache;break;default:throw Error(r(314))}l!==null&&l.delete(t),lg(e,i)}function rS(e,t){return Yt(e,t)}var Go=null,Is=null,Kd=!1,Io=!1,Qd=!1,Pi=0;function Pn(e){e!==Is&&e.next===null&&(Is===null?Go=Is=e:Is=Is.next=e),Io=!0,Kd||(Kd=!0,oS())}function Pr(e,t){if(!Qd&&Io){Qd=!0;do for(var i=!1,l=Go;l!==null;){if(e!==0){var c=l.pendingLanes;if(c===0)var d=0;else{var y=l.suspendedLanes,v=l.pingedLanes;d=(1<<31-ft(42|e)+1)-1,d&=c&~(y&~v),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(i=!0,dg(l,d))}else d=ke,d=ce(l,l===Ve?d:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(d&3)===0||ve(l,d)||(i=!0,dg(l,d));l=l.next}while(i);Qd=!1}}function lS(){og()}function og(){Io=Kd=!1;var e=0;Pi!==0&&(gS()&&(e=Pi),Pi=0);for(var t=ot(),i=null,l=Go;l!==null;){var c=l.next,d=cg(l,t);d===0?(l.next=null,i===null?Go=c:i.next=c,c===null&&(Is=i)):(i=l,(e!==0||(d&3)!==0)&&(Io=!0)),l=c}Pr(e)}function cg(e,t){for(var i=e.suspendedLanes,l=e.pingedLanes,c=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var y=31-ft(d),v=1<<y,x=c[y];x===-1?((v&i)===0||(v&l)!==0)&&(c[y]=Se(v,t)):x<=t&&(e.expiredLanes|=v),d&=~v}if(t=Ve,i=ke,i=ce(e,e===t?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l=e.callbackNode,i===0||e===t&&(qe===2||qe===9)||e.cancelPendingCommit!==null)return l!==null&&l!==null&&Ft(l),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||ve(e,i)){if(t=i&-i,t===e.callbackPriority)return t;switch(l!==null&&Ft(l),ya(i)){case 2:case 8:i=mn;break;case 32:i=$t;break;case 268435456:i=Cn;break;default:i=$t}return l=ug.bind(null,e),i=Yt(i,l),e.callbackPriority=t,e.callbackNode=i,t}return l!==null&&l!==null&&Ft(l),e.callbackPriority=2,e.callbackNode=null,2}function ug(e,t){if(Rt!==0&&Rt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(jo()&&e.callbackNode!==i)return null;var l=ke;return l=ce(e,e===Ve?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l===0?null:(Vp(e,l,t),cg(e,ot()),e.callbackNode!=null&&e.callbackNode===i?ug.bind(null,e):null)}function dg(e,t){if(jo())return null;Vp(e,t,!0)}function oS(){bS(function(){(Oe&6)!==0?Yt(An,lS):og()})}function Pd(){return Pi===0&&(Pi=Re()),Pi}function fg(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Jl(""+e)}function hg(e,t){var i=t.ownerDocument.createElement("input");return i.name=t.name,i.value=t.value,e.id&&i.setAttribute("form",e.id),t.parentNode.insertBefore(i,t),e=new FormData(e),i.parentNode.removeChild(i),e}function cS(e,t,i,l,c){if(t==="submit"&&i&&i.stateNode===c){var d=fg((c[mt]||null).action),y=l.submitter;y&&(t=(t=y[mt]||null)?fg(t.formAction):y.getAttribute("formAction"),t!==null&&(d=t,y=null));var v=new no("action","action",null,l,c);e.push({event:v,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(Pi!==0){var x=y?hg(c,y):new FormData(c);gd(i,{pending:!0,data:x,method:c.method,action:d},null,x)}}else typeof d=="function"&&(v.preventDefault(),x=y?hg(c,y):new FormData(c),gd(i,{pending:!0,data:x,method:c.method,action:d},d,x))},currentTarget:c}]})}}for(var Zd=0;Zd<Ou.length;Zd++){var Jd=Ou[Zd],uS=Jd.toLowerCase(),dS=Jd[0].toUpperCase()+Jd.slice(1);kn(uS,"on"+dS)}kn(Vm,"onAnimationEnd"),kn(Xm,"onAnimationIteration"),kn(Km,"onAnimationStart"),kn("dblclick","onDoubleClick"),kn("focusin","onFocus"),kn("focusout","onBlur"),kn(_1,"onTransitionRun"),kn(R1,"onTransitionStart"),kn(N1,"onTransitionCancel"),kn(Qm,"onTransitionEnd"),Za("onMouseEnter",["mouseout","mouseover"]),Za("onMouseLeave",["mouseout","mouseover"]),Za("onPointerEnter",["pointerout","pointerover"]),Za("onPointerLeave",["pointerout","pointerover"]),Fn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Fn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Fn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Fn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Fn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Fn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zr));function mg(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var l=e[i],c=l.event;l=l.listeners;e:{var d=void 0;if(t)for(var y=l.length-1;0<=y;y--){var v=l[y],x=v.instance,q=v.currentTarget;if(v=v.listener,x!==d&&c.isPropagationStopped())break e;d=v,c.currentTarget=q;try{d(c)}catch(K){Ro(K)}c.currentTarget=null,d=x}else for(y=0;y<l.length;y++){if(v=l[y],x=v.instance,q=v.currentTarget,v=v.listener,x!==d&&c.isPropagationStopped())break e;d=v,c.currentTarget=q;try{d(c)}catch(K){Ro(K)}c.currentTarget=null,d=x}}}}function Te(e,t){var i=t[Qa];i===void 0&&(i=t[Qa]=new Set);var l=e+"__bubble";i.has(l)||(pg(t,e,2,!1),i.add(l))}function Wd(e,t,i){var l=0;t&&(l|=4),pg(i,e,l,t)}var Yo="_reactListening"+Math.random().toString(36).slice(2);function ef(e){if(!e[Yo]){e[Yo]=!0,ms.forEach(function(i){i!=="selectionchange"&&(fS.has(i)||Wd(i,!1,e),Wd(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Yo]||(t[Yo]=!0,Wd("selectionchange",!1,t))}}function pg(e,t,i,l){switch(Hg(t)){case 2:var c=HS;break;case 8:c=jS;break;default:c=pf}i=c.bind(null,t,i,e),c=void 0,!Mu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),l?c!==void 0?e.addEventListener(t,i,{capture:!0,passive:c}):e.addEventListener(t,i,!0):c!==void 0?e.addEventListener(t,i,{passive:c}):e.addEventListener(t,i,!1)}function tf(e,t,i,l,c){var d=l;if((t&1)===0&&(t&2)===0&&l!==null)e:for(;;){if(l===null)return;var y=l.tag;if(y===3||y===4){var v=l.stateNode.containerInfo;if(v===c)break;if(y===4)for(y=l.return;y!==null;){var x=y.tag;if((x===3||x===4)&&y.stateNode.containerInfo===c)return;y=y.return}for(;v!==null;){if(y=va(v),y===null)return;if(x=y.tag,x===5||x===6||x===26||x===27){l=d=y;continue e}v=v.parentNode}}l=l.return}Mm(function(){var q=d,K=Su(i),Z=[];e:{var z=Pm.get(e);if(z!==void 0){var j=no,be=e;switch(e){case"keypress":if(eo(i)===0)break e;case"keydown":case"keyup":j=r1;break;case"focusin":be="focus",j=Cu;break;case"focusout":be="blur",j=Cu;break;case"beforeblur":case"afterblur":j=Cu;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=Am;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=Kv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=c1;break;case Vm:case Xm:case Km:j=Zv;break;case Qm:j=d1;break;case"scroll":case"scrollend":j=Vv;break;case"wheel":j=h1;break;case"copy":case"cut":case"paste":j=Wv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=Tm;break;case"toggle":case"beforetoggle":j=p1}var ge=(t&4)!==0,je=!ge&&(e==="scroll"||e==="scrollend"),D=ge?z!==null?z+"Capture":null:z;ge=[];for(var C=q,O;C!==null;){var Q=C;if(O=Q.stateNode,Q=Q.tag,Q!==5&&Q!==26&&Q!==27||O===null||D===null||(Q=gr(C,D),Q!=null&&ge.push(Jr(C,Q,O))),je)break;C=C.return}0<ge.length&&(z=new j(z,be,null,i,K),Z.push({event:z,listeners:ge}))}}if((t&7)===0){e:{if(z=e==="mouseover"||e==="pointerover",j=e==="mouseout"||e==="pointerout",z&&i!==vu&&(be=i.relatedTarget||i.fromElement)&&(va(be)||be[ba]))break e;if((j||z)&&(z=K.window===K?K:(z=K.ownerDocument)?z.defaultView||z.parentWindow:window,j?(be=i.relatedTarget||i.toElement,j=q,be=be?va(be):null,be!==null&&(je=u(be),ge=be.tag,be!==je||ge!==5&&ge!==27&&ge!==6)&&(be=null)):(j=null,be=q),j!==be)){if(ge=Am,Q="onMouseLeave",D="onMouseEnter",C="mouse",(e==="pointerout"||e==="pointerover")&&(ge=Tm,Q="onPointerLeave",D="onPointerEnter",C="pointer"),je=j==null?z:Sa(j),O=be==null?z:Sa(be),z=new ge(Q,C+"leave",j,i,K),z.target=je,z.relatedTarget=O,Q=null,va(K)===q&&(ge=new ge(D,C+"enter",be,i,K),ge.target=O,ge.relatedTarget=je,Q=ge),je=Q,j&&be)t:{for(ge=j,D=be,C=0,O=ge;O;O=Ys(O))C++;for(O=0,Q=D;Q;Q=Ys(Q))O++;for(;0<C-O;)ge=Ys(ge),C--;for(;0<O-C;)D=Ys(D),O--;for(;C--;){if(ge===D||D!==null&&ge===D.alternate)break t;ge=Ys(ge),D=Ys(D)}ge=null}else ge=null;j!==null&&gg(Z,z,j,ge,!1),be!==null&&je!==null&&gg(Z,je,be,ge,!0)}}e:{if(z=q?Sa(q):window,j=z.nodeName&&z.nodeName.toLowerCase(),j==="select"||j==="input"&&z.type==="file")var ue=Om;else if(Lm(z))if(qm)ue=A1;else{ue=x1;var we=M1}else j=z.nodeName,!j||j.toLowerCase()!=="input"||z.type!=="checkbox"&&z.type!=="radio"?q&&bu(q.elementType)&&(ue=Om):ue=w1;if(ue&&(ue=ue(e,q))){Um(Z,ue,i,K);break e}we&&we(e,z,q),e==="focusout"&&q&&z.type==="number"&&q.memoizedProps.value!=null&&Wa(z,"number",z.value)}switch(we=q?Sa(q):window,e){case"focusin":(Lm(we)||we.contentEditable==="true")&&(vs=we,Du=q,wr=null);break;case"focusout":wr=Du=vs=null;break;case"mousedown":Lu=!0;break;case"contextmenu":case"mouseup":case"dragend":Lu=!1,Fm(Z,i,K);break;case"selectionchange":if(T1)break;case"keydown":case"keyup":Fm(Z,i,K)}var me;if(_u)e:{switch(e){case"compositionstart":var ye="onCompositionStart";break e;case"compositionend":ye="onCompositionEnd";break e;case"compositionupdate":ye="onCompositionUpdate";break e}ye=void 0}else bs?km(e,i)&&(ye="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(ye="onCompositionStart");ye&&(_m&&i.locale!=="ko"&&(bs||ye!=="onCompositionStart"?ye==="onCompositionEnd"&&bs&&(me=xm()):(ei=K,xu="value"in ei?ei.value:ei.textContent,bs=!0)),we=Fo(q,ye),0<we.length&&(ye=new Cm(ye,e,null,i,K),Z.push({event:ye,listeners:we}),me?ye.data=me:(me=Dm(i),me!==null&&(ye.data=me)))),(me=y1?b1(e,i):v1(e,i))&&(ye=Fo(q,"onBeforeInput"),0<ye.length&&(we=new Cm("onBeforeInput","beforeinput",null,i,K),Z.push({event:we,listeners:ye}),we.data=me)),cS(Z,e,q,i,K)}mg(Z,t)})}function Jr(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Fo(e,t){for(var i=t+"Capture",l=[];e!==null;){var c=e,d=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||d===null||(c=gr(e,i),c!=null&&l.unshift(Jr(e,c,d)),c=gr(e,t),c!=null&&l.push(Jr(e,c,d))),e.tag===3)return l;e=e.return}return[]}function Ys(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function gg(e,t,i,l,c){for(var d=t._reactName,y=[];i!==null&&i!==l;){var v=i,x=v.alternate,q=v.stateNode;if(v=v.tag,x!==null&&x===l)break;v!==5&&v!==26&&v!==27||q===null||(x=q,c?(q=gr(i,d),q!=null&&y.unshift(Jr(i,q,x))):c||(q=gr(i,d),q!=null&&y.push(Jr(i,q,x)))),i=i.return}y.length!==0&&e.push({event:t,listeners:y})}var hS=/\r\n?/g,mS=/\u0000|\uFFFD/g;function yg(e){return(typeof e=="string"?e:""+e).replace(hS,`
`).replace(mS,"")}function bg(e,t){return t=yg(t),yg(e)===t}function $o(){}function He(e,t,i,l,c,d){switch(i){case"children":typeof l=="string"?t==="body"||t==="textarea"&&l===""||ps(e,l):(typeof l=="number"||typeof l=="bigint")&&t!=="body"&&ps(e,""+l);break;case"className":Li(e,"class",l);break;case"tabIndex":Li(e,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Li(e,i,l);break;case"style":Sm(e,l,d);break;case"data":if(t!=="object"){Li(e,"data",l);break}case"src":case"href":if(l===""&&(t!=="a"||i!=="href")){e.removeAttribute(i);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(i);break}l=Jl(""+l),e.setAttribute(i,l);break;case"action":case"formAction":if(typeof l=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(i==="formAction"?(t!=="input"&&He(e,t,"name",c.name,c,null),He(e,t,"formEncType",c.formEncType,c,null),He(e,t,"formMethod",c.formMethod,c,null),He(e,t,"formTarget",c.formTarget,c,null)):(He(e,t,"encType",c.encType,c,null),He(e,t,"method",c.method,c,null),He(e,t,"target",c.target,c,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(i);break}l=Jl(""+l),e.setAttribute(i,l);break;case"onClick":l!=null&&(e.onclick=$o);break;case"onScroll":l!=null&&Te("scroll",e);break;case"onScrollEnd":l!=null&&Te("scrollend",e);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(r(61));if(i=l.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"multiple":e.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":e.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){e.removeAttribute("xlink:href");break}i=Jl(""+l),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,""+l):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":l===!0?e.setAttribute(i,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,l):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?e.setAttribute(i,l):e.removeAttribute(i);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?e.removeAttribute(i):e.setAttribute(i,l);break;case"popover":Te("beforetoggle",e),Te("toggle",e),Di(e,"popover",l);break;case"xlinkActuate":Nn(e,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":Nn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":Nn(e,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":Nn(e,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":Nn(e,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":Nn(e,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":Nn(e,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":Nn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":Nn(e,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":Di(e,"is",l);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=Fv.get(i)||i,Di(e,i,l))}}function nf(e,t,i,l,c,d){switch(i){case"style":Sm(e,l,d);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(r(61));if(i=l.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"children":typeof l=="string"?ps(e,l):(typeof l=="number"||typeof l=="bigint")&&ps(e,""+l);break;case"onScroll":l!=null&&Te("scroll",e);break;case"onScrollEnd":l!=null&&Te("scrollend",e);break;case"onClick":l!=null&&(e.onclick=$o);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$l.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(c=i.endsWith("Capture"),t=i.slice(2,c?i.length-7:void 0),d=e[mt]||null,d=d!=null?d[i]:null,typeof d=="function"&&e.removeEventListener(t,d,c),typeof l=="function")){typeof d!="function"&&d!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(t,l,c);break e}i in e?e[i]=l:l===!0?e.setAttribute(i,""):Di(e,i,l)}}}function Nt(e,t,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Te("error",e),Te("load",e);var l=!1,c=!1,d;for(d in i)if(i.hasOwnProperty(d)){var y=i[d];if(y!=null)switch(d){case"src":l=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:He(e,t,d,y,i,null)}}c&&He(e,t,"srcSet",i.srcSet,i,null),l&&He(e,t,"src",i.src,i,null);return;case"input":Te("invalid",e);var v=d=y=c=null,x=null,q=null;for(l in i)if(i.hasOwnProperty(l)){var K=i[l];if(K!=null)switch(l){case"name":c=K;break;case"type":y=K;break;case"checked":x=K;break;case"defaultChecked":q=K;break;case"value":d=K;break;case"defaultValue":v=K;break;case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(r(137,t));break;default:He(e,t,l,K,i,null)}}Ja(e,d,v,x,q,y,c,!1),Mt(e);return;case"select":Te("invalid",e),l=y=d=null;for(c in i)if(i.hasOwnProperty(c)&&(v=i[c],v!=null))switch(c){case"value":d=v;break;case"defaultValue":y=v;break;case"multiple":l=v;default:He(e,t,c,v,i,null)}t=d,i=y,e.multiple=!!l,t!=null?Ma(e,!!l,t,!1):i!=null&&Ma(e,!!l,i,!0);return;case"textarea":Te("invalid",e),d=c=l=null;for(y in i)if(i.hasOwnProperty(y)&&(v=i[y],v!=null))switch(y){case"value":l=v;break;case"defaultValue":c=v;break;case"children":d=v;break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:He(e,t,y,v,i,null)}Zl(e,l,c,d),Mt(e);return;case"option":for(x in i)if(i.hasOwnProperty(x)&&(l=i[x],l!=null))switch(x){case"selected":e.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:He(e,t,x,l,i,null)}return;case"dialog":Te("beforetoggle",e),Te("toggle",e),Te("cancel",e),Te("close",e);break;case"iframe":case"object":Te("load",e);break;case"video":case"audio":for(l=0;l<Zr.length;l++)Te(Zr[l],e);break;case"image":Te("error",e),Te("load",e);break;case"details":Te("toggle",e);break;case"embed":case"source":case"link":Te("error",e),Te("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(q in i)if(i.hasOwnProperty(q)&&(l=i[q],l!=null))switch(q){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:He(e,t,q,l,i,null)}return;default:if(bu(t)){for(K in i)i.hasOwnProperty(K)&&(l=i[K],l!==void 0&&nf(e,t,K,l,i,void 0));return}}for(v in i)i.hasOwnProperty(v)&&(l=i[v],l!=null&&He(e,t,v,l,i,null))}function pS(e,t,i,l){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,d=null,y=null,v=null,x=null,q=null,K=null;for(j in i){var Z=i[j];if(i.hasOwnProperty(j)&&Z!=null)switch(j){case"checked":break;case"value":break;case"defaultValue":x=Z;default:l.hasOwnProperty(j)||He(e,t,j,null,l,Z)}}for(var z in l){var j=l[z];if(Z=i[z],l.hasOwnProperty(z)&&(j!=null||Z!=null))switch(z){case"type":d=j;break;case"name":c=j;break;case"checked":q=j;break;case"defaultChecked":K=j;break;case"value":y=j;break;case"defaultValue":v=j;break;case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(r(137,t));break;default:j!==Z&&He(e,t,z,j,l,Z)}}tt(e,y,v,x,q,K,d,c);return;case"select":j=y=v=z=null;for(d in i)if(x=i[d],i.hasOwnProperty(d)&&x!=null)switch(d){case"value":break;case"multiple":j=x;default:l.hasOwnProperty(d)||He(e,t,d,null,l,x)}for(c in l)if(d=l[c],x=i[c],l.hasOwnProperty(c)&&(d!=null||x!=null))switch(c){case"value":z=d;break;case"defaultValue":v=d;break;case"multiple":y=d;default:d!==x&&He(e,t,c,d,l,x)}t=v,i=y,l=j,z!=null?Ma(e,!!i,z,!1):!!l!=!!i&&(t!=null?Ma(e,!!i,t,!0):Ma(e,!!i,i?[]:"",!1));return;case"textarea":j=z=null;for(v in i)if(c=i[v],i.hasOwnProperty(v)&&c!=null&&!l.hasOwnProperty(v))switch(v){case"value":break;case"children":break;default:He(e,t,v,null,l,c)}for(y in l)if(c=l[y],d=i[y],l.hasOwnProperty(y)&&(c!=null||d!=null))switch(y){case"value":z=c;break;case"defaultValue":j=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(r(91));break;default:c!==d&&He(e,t,y,c,l,d)}$n(e,z,j);return;case"option":for(var be in i)if(z=i[be],i.hasOwnProperty(be)&&z!=null&&!l.hasOwnProperty(be))switch(be){case"selected":e.selected=!1;break;default:He(e,t,be,null,l,z)}for(x in l)if(z=l[x],j=i[x],l.hasOwnProperty(x)&&z!==j&&(z!=null||j!=null))switch(x){case"selected":e.selected=z&&typeof z!="function"&&typeof z!="symbol";break;default:He(e,t,x,z,l,j)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ge in i)z=i[ge],i.hasOwnProperty(ge)&&z!=null&&!l.hasOwnProperty(ge)&&He(e,t,ge,null,l,z);for(q in l)if(z=l[q],j=i[q],l.hasOwnProperty(q)&&z!==j&&(z!=null||j!=null))switch(q){case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(r(137,t));break;default:He(e,t,q,z,l,j)}return;default:if(bu(t)){for(var je in i)z=i[je],i.hasOwnProperty(je)&&z!==void 0&&!l.hasOwnProperty(je)&&nf(e,t,je,void 0,l,z);for(K in l)z=l[K],j=i[K],!l.hasOwnProperty(K)||z===j||z===void 0&&j===void 0||nf(e,t,K,z,l,j);return}}for(var D in i)z=i[D],i.hasOwnProperty(D)&&z!=null&&!l.hasOwnProperty(D)&&He(e,t,D,null,l,z);for(Z in l)z=l[Z],j=i[Z],!l.hasOwnProperty(Z)||z===j||z==null&&j==null||He(e,t,Z,z,l,j)}var af=null,sf=null;function Vo(e){return e.nodeType===9?e:e.ownerDocument}function vg(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Sg(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function rf(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var lf=null;function gS(){var e=window.event;return e&&e.type==="popstate"?e===lf?!1:(lf=e,!0):(lf=null,!1)}var Eg=typeof setTimeout=="function"?setTimeout:void 0,yS=typeof clearTimeout=="function"?clearTimeout:void 0,Mg=typeof Promise=="function"?Promise:void 0,bS=typeof queueMicrotask=="function"?queueMicrotask:typeof Mg<"u"?function(e){return Mg.resolve(null).then(e).catch(vS)}:Eg;function vS(e){setTimeout(function(){throw e})}function gi(e){return e==="head"}function xg(e,t){var i=t,l=0,c=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(0<l&&8>l){i=l;var y=e.ownerDocument;if(i&1&&Wr(y.documentElement),i&2&&Wr(y.body),i&4)for(i=y.head,Wr(i),y=i.firstChild;y;){var v=y.nextSibling,x=y.nodeName;y[ki]||x==="SCRIPT"||x==="STYLE"||x==="LINK"&&y.rel.toLowerCase()==="stylesheet"||i.removeChild(y),y=v}}if(c===0){e.removeChild(d),ll(t);return}c--}else i==="$"||i==="$?"||i==="$!"?c++:l=i.charCodeAt(0)-48;else l=0;i=d}while(i);ll(t)}function of(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var i=t;switch(t=t.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":of(i),hs(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function SS(e,t,i,l){for(;e.nodeType===1;){var c=i;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!l&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(l){if(!e[ki])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var d=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=Ln(e.nextSibling),e===null)break}return null}function ES(e,t,i){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=Ln(e.nextSibling),e===null))return null;return e}function cf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function MS(e,t){var i=e.ownerDocument;if(e.data!=="$?"||i.readyState==="complete")t();else{var l=function(){t(),i.removeEventListener("DOMContentLoaded",l)};i.addEventListener("DOMContentLoaded",l),e._reactRetry=l}}function Ln(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var uf=null;function wg(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}function Ag(e,t,i){switch(t=Vo(i),e){case"html":if(e=t.documentElement,!e)throw Error(r(452));return e;case"head":if(e=t.head,!e)throw Error(r(453));return e;case"body":if(e=t.body,!e)throw Error(r(454));return e;default:throw Error(r(451))}}function Wr(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);hs(e)}var En=new Map,Cg=new Set;function Xo(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var qa=I.d;I.d={f:xS,r:wS,D:AS,C:CS,L:TS,m:_S,X:NS,S:RS,M:kS};function xS(){var e=qa.f(),t=Bo();return e||t}function wS(e){var t=Pa(e);t!==null&&t.tag===5&&t.type==="form"?V0(t):qa.r(e)}var Fs=typeof document>"u"?null:document;function Tg(e,t,i){var l=Fs;if(l&&typeof t=="string"&&t){var c=pt(t);c='link[rel="'+e+'"][href="'+c+'"]',typeof i=="string"&&(c+='[crossorigin="'+i+'"]'),Cg.has(c)||(Cg.add(c),e={rel:e,crossOrigin:i,href:t},l.querySelector(c)===null&&(t=l.createElement("link"),Nt(t,"link",e),We(t),l.head.appendChild(t)))}}function AS(e){qa.D(e),Tg("dns-prefetch",e,null)}function CS(e,t){qa.C(e,t),Tg("preconnect",e,t)}function TS(e,t,i){qa.L(e,t,i);var l=Fs;if(l&&e&&t){var c='link[rel="preload"][as="'+pt(t)+'"]';t==="image"&&i&&i.imageSrcSet?(c+='[imagesrcset="'+pt(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(c+='[imagesizes="'+pt(i.imageSizes)+'"]')):c+='[href="'+pt(e)+'"]';var d=c;switch(t){case"style":d=$s(e);break;case"script":d=Vs(e)}En.has(d)||(e=g({rel:"preload",href:t==="image"&&i&&i.imageSrcSet?void 0:e,as:t},i),En.set(d,e),l.querySelector(c)!==null||t==="style"&&l.querySelector(el(d))||t==="script"&&l.querySelector(tl(d))||(t=l.createElement("link"),Nt(t,"link",e),We(t),l.head.appendChild(t)))}}function _S(e,t){qa.m(e,t);var i=Fs;if(i&&e){var l=t&&typeof t.as=="string"?t.as:"script",c='link[rel="modulepreload"][as="'+pt(l)+'"][href="'+pt(e)+'"]',d=c;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=Vs(e)}if(!En.has(d)&&(e=g({rel:"modulepreload",href:e},t),En.set(d,e),i.querySelector(c)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(tl(d)))return}l=i.createElement("link"),Nt(l,"link",e),We(l),i.head.appendChild(l)}}}function RS(e,t,i){qa.S(e,t,i);var l=Fs;if(l&&e){var c=Ea(l).hoistableStyles,d=$s(e);t=t||"default";var y=c.get(d);if(!y){var v={loading:0,preload:null};if(y=l.querySelector(el(d)))v.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":t},i),(i=En.get(d))&&df(e,i);var x=y=l.createElement("link");We(x),Nt(x,"link",e),x._p=new Promise(function(q,K){x.onload=q,x.onerror=K}),x.addEventListener("load",function(){v.loading|=1}),x.addEventListener("error",function(){v.loading|=2}),v.loading|=4,Ko(y,t,l)}y={type:"stylesheet",instance:y,count:1,state:v},c.set(d,y)}}}function NS(e,t){qa.X(e,t);var i=Fs;if(i&&e){var l=Ea(i).hoistableScripts,c=Vs(e),d=l.get(c);d||(d=i.querySelector(tl(c)),d||(e=g({src:e,async:!0},t),(t=En.get(c))&&ff(e,t),d=i.createElement("script"),We(d),Nt(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},l.set(c,d))}}function kS(e,t){qa.M(e,t);var i=Fs;if(i&&e){var l=Ea(i).hoistableScripts,c=Vs(e),d=l.get(c);d||(d=i.querySelector(tl(c)),d||(e=g({src:e,async:!0,type:"module"},t),(t=En.get(c))&&ff(e,t),d=i.createElement("script"),We(d),Nt(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},l.set(c,d))}}function _g(e,t,i,l){var c=(c=he.current)?Xo(c):null;if(!c)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(t=$s(i.href),i=Ea(c).hoistableStyles,l=i.get(t),l||(l={type:"style",instance:null,count:0,state:null},i.set(t,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=$s(i.href);var d=Ea(c).hoistableStyles,y=d.get(e);if(y||(c=c.ownerDocument||c,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,y),(d=c.querySelector(el(e)))&&!d._p&&(y.instance=d,y.state.loading=5),En.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},En.set(e,i),d||DS(c,e,i,y.state))),t&&l===null)throw Error(r(528,""));return y}if(t&&l!==null)throw Error(r(529,""));return null;case"script":return t=i.async,i=i.src,typeof i=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Vs(i),i=Ea(c).hoistableScripts,l=i.get(t),l||(l={type:"script",instance:null,count:0,state:null},i.set(t,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function $s(e){return'href="'+pt(e)+'"'}function el(e){return'link[rel="stylesheet"]['+e+"]"}function Rg(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function DS(e,t,i,l){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?l.loading=1:(t=e.createElement("link"),l.preload=t,t.addEventListener("load",function(){return l.loading|=1}),t.addEventListener("error",function(){return l.loading|=2}),Nt(t,"link",i),We(t),e.head.appendChild(t))}function Vs(e){return'[src="'+pt(e)+'"]'}function tl(e){return"script[async]"+e}function Ng(e,t,i){if(t.count++,t.instance===null)switch(t.type){case"style":var l=e.querySelector('style[data-href~="'+pt(i.href)+'"]');if(l)return t.instance=l,We(l),l;var c=g({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return l=(e.ownerDocument||e).createElement("style"),We(l),Nt(l,"style",c),Ko(l,i.precedence,e),t.instance=l;case"stylesheet":c=$s(i.href);var d=e.querySelector(el(c));if(d)return t.state.loading|=4,t.instance=d,We(d),d;l=Rg(i),(c=En.get(c))&&df(l,c),d=(e.ownerDocument||e).createElement("link"),We(d);var y=d;return y._p=new Promise(function(v,x){y.onload=v,y.onerror=x}),Nt(d,"link",l),t.state.loading|=4,Ko(d,i.precedence,e),t.instance=d;case"script":return d=Vs(i.src),(c=e.querySelector(tl(d)))?(t.instance=c,We(c),c):(l=i,(c=En.get(d))&&(l=g({},i),ff(l,c)),e=e.ownerDocument||e,c=e.createElement("script"),We(c),Nt(c,"link",l),e.head.appendChild(c),t.instance=c);case"void":return null;default:throw Error(r(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(l=t.instance,t.state.loading|=4,Ko(l,i.precedence,e));return t.instance}function Ko(e,t,i){for(var l=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=l.length?l[l.length-1]:null,d=c,y=0;y<l.length;y++){var v=l[y];if(v.dataset.precedence===t)d=v;else if(d!==c)break}d?d.parentNode.insertBefore(e,d.nextSibling):(t=i.nodeType===9?i.head:i,t.insertBefore(e,t.firstChild))}function df(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function ff(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Qo=null;function kg(e,t,i){if(Qo===null){var l=new Map,c=Qo=new Map;c.set(i,l)}else c=Qo,l=c.get(i),l||(l=new Map,c.set(i,l));if(l.has(e))return l;for(l.set(e,null),i=i.getElementsByTagName(e),c=0;c<i.length;c++){var d=i[c];if(!(d[ki]||d[Je]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var y=d.getAttribute(t)||"";y=e+y;var v=l.get(y);v?v.push(d):l.set(y,[d])}}return l}function Dg(e,t,i){e=e.ownerDocument||e,e.head.insertBefore(i,t==="title"?e.querySelector("head > title"):null)}function LS(e,t,i){if(i===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function Lg(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var nl=null;function US(){}function OS(e,t,i){if(nl===null)throw Error(r(475));var l=nl;if(t.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var c=$s(i.href),d=e.querySelector(el(c));if(d){e=d._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(l.count++,l=Po.bind(l),e.then(l,l)),t.state.loading|=4,t.instance=d,We(d);return}d=e.ownerDocument||e,i=Rg(i),(c=En.get(c))&&df(i,c),d=d.createElement("link"),We(d);var y=d;y._p=new Promise(function(v,x){y.onload=v,y.onerror=x}),Nt(d,"link",i),t.instance=d}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(l.count++,t=Po.bind(l),e.addEventListener("load",t),e.addEventListener("error",t))}}function qS(){if(nl===null)throw Error(r(475));var e=nl;return e.stylesheets&&e.count===0&&hf(e,e.stylesheets),0<e.count?function(t){var i=setTimeout(function(){if(e.stylesheets&&hf(e,e.stylesheets),e.unsuspend){var l=e.unsuspend;e.unsuspend=null,l()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(i)}}:null}function Po(){if(this.count--,this.count===0){if(this.stylesheets)hf(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Zo=null;function hf(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Zo=new Map,t.forEach(zS,e),Zo=null,Po.call(e))}function zS(e,t){if(!(t.state.loading&4)){var i=Zo.get(e);if(i)var l=i.get(null);else{i=new Map,Zo.set(e,i);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<c.length;d++){var y=c[d];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(i.set(y.dataset.precedence,y),l=y)}l&&i.set(null,l)}c=t.instance,y=c.getAttribute("data-precedence"),d=i.get(y)||l,d===l&&i.set(null,c),i.set(y,c),this.count++,l=Po.bind(this),c.addEventListener("load",l),c.addEventListener("error",l),d?d.parentNode.insertBefore(c,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),t.state.loading|=4}}var al={$$typeof:G,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function BS(e,t,i,l,c,d,y,v){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ht(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ht(0),this.hiddenUpdates=ht(null),this.identifierPrefix=l,this.onUncaughtError=c,this.onCaughtError=d,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=v,this.incompleteTransitions=new Map}function Ug(e,t,i,l,c,d,y,v,x,q,K,Z){return e=new BS(e,t,i,y,v,x,q,Z),t=1,d===!0&&(t|=24),d=ln(3,null,null,t),e.current=d,d.stateNode=e,t=Xu(),t.refCount++,e.pooledCache=t,t.refCount++,d.memoizedState={element:l,isDehydrated:i,cache:t},Zu(d),e}function Og(e){return e?(e=xs,e):xs}function qg(e,t,i,l,c,d){c=Og(c),l.context===null?l.context=c:l.pendingContext=c,l=ai(t),l.payload={element:i},d=d===void 0?null:d,d!==null&&(l.callback=d),i=ii(e,l,t),i!==null&&(fn(i,e,t),Lr(i,e,t))}function zg(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function mf(e,t){zg(e,t),(e=e.alternate)&&zg(e,t)}function Bg(e){if(e.tag===13){var t=Ms(e,67108864);t!==null&&fn(t,e,67108864),mf(e,67108864)}}var Jo=!0;function HS(e,t,i,l){var c=T.T;T.T=null;var d=I.p;try{I.p=2,pf(e,t,i,l)}finally{I.p=d,T.T=c}}function jS(e,t,i,l){var c=T.T;T.T=null;var d=I.p;try{I.p=8,pf(e,t,i,l)}finally{I.p=d,T.T=c}}function pf(e,t,i,l){if(Jo){var c=gf(l);if(c===null)tf(e,t,l,Wo,i),jg(e,l);else if(IS(c,e,t,i,l))l.stopPropagation();else if(jg(e,l),t&4&&-1<GS.indexOf(e)){for(;c!==null;){var d=Pa(c);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var y=_n(d.pendingLanes);if(y!==0){var v=d;for(v.pendingLanes|=2,v.entangledLanes|=2;y;){var x=1<<31-ft(y);v.entanglements[1]|=x,y&=~x}Pn(d),(Oe&6)===0&&(qo=ot()+500,Pr(0))}}break;case 13:v=Ms(d,2),v!==null&&fn(v,d,2),Bo(),mf(d,2)}if(d=gf(l),d===null&&tf(e,t,l,Wo,i),d===c)break;c=d}c!==null&&l.stopPropagation()}else tf(e,t,l,null,i)}}function gf(e){return e=Su(e),yf(e)}var Wo=null;function yf(e){if(Wo=null,e=va(e),e!==null){var t=u(e);if(t===null)e=null;else{var i=t.tag;if(i===13){if(e=f(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Wo=e,null}function Hg(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(da()){case An:return 2;case mn:return 8;case $t:case Ka:return 32;case Cn:return 268435456;default:return 32}default:return 32}}var bf=!1,yi=null,bi=null,vi=null,il=new Map,sl=new Map,Si=[],GS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function jg(e,t){switch(e){case"focusin":case"focusout":yi=null;break;case"dragenter":case"dragleave":bi=null;break;case"mouseover":case"mouseout":vi=null;break;case"pointerover":case"pointerout":il.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":sl.delete(t.pointerId)}}function rl(e,t,i,l,c,d){return e===null||e.nativeEvent!==d?(e={blockedOn:t,domEventName:i,eventSystemFlags:l,nativeEvent:d,targetContainers:[c]},t!==null&&(t=Pa(t),t!==null&&Bg(t)),e):(e.eventSystemFlags|=l,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function IS(e,t,i,l,c){switch(t){case"focusin":return yi=rl(yi,e,t,i,l,c),!0;case"dragenter":return bi=rl(bi,e,t,i,l,c),!0;case"mouseover":return vi=rl(vi,e,t,i,l,c),!0;case"pointerover":var d=c.pointerId;return il.set(d,rl(il.get(d)||null,e,t,i,l,c)),!0;case"gotpointercapture":return d=c.pointerId,sl.set(d,rl(sl.get(d)||null,e,t,i,l,c)),!0}return!1}function Gg(e){var t=va(e.target);if(t!==null){var i=u(t);if(i!==null){if(t=i.tag,t===13){if(t=f(i),t!==null){e.blockedOn=t,Fl(e.priority,function(){if(i.tag===13){var l=dn();l=ga(l);var c=Ms(i,l);c!==null&&fn(c,i,l),mf(i,l)}});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ec(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=gf(e.nativeEvent);if(i===null){i=e.nativeEvent;var l=new i.constructor(i.type,i);vu=l,i.target.dispatchEvent(l),vu=null}else return t=Pa(i),t!==null&&Bg(t),e.blockedOn=i,!1;t.shift()}return!0}function Ig(e,t,i){ec(e)&&i.delete(t)}function YS(){bf=!1,yi!==null&&ec(yi)&&(yi=null),bi!==null&&ec(bi)&&(bi=null),vi!==null&&ec(vi)&&(vi=null),il.forEach(Ig),sl.forEach(Ig)}function tc(e,t){e.blockedOn===t&&(e.blockedOn=null,bf||(bf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,YS)))}var nc=null;function Yg(e){nc!==e&&(nc=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){nc===e&&(nc=null);for(var t=0;t<e.length;t+=3){var i=e[t],l=e[t+1],c=e[t+2];if(typeof l!="function"){if(yf(l||i)===null)continue;break}var d=Pa(i);d!==null&&(e.splice(t,3),t-=3,gd(d,{pending:!0,data:c,method:i.method,action:l},l,c))}}))}function ll(e){function t(x){return tc(x,e)}yi!==null&&tc(yi,e),bi!==null&&tc(bi,e),vi!==null&&tc(vi,e),il.forEach(t),sl.forEach(t);for(var i=0;i<Si.length;i++){var l=Si[i];l.blockedOn===e&&(l.blockedOn=null)}for(;0<Si.length&&(i=Si[0],i.blockedOn===null);)Gg(i),i.blockedOn===null&&Si.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(l=0;l<i.length;l+=3){var c=i[l],d=i[l+1],y=c[mt]||null;if(typeof d=="function")y||Yg(i);else if(y){var v=null;if(d&&d.hasAttribute("formAction")){if(c=d,y=d[mt]||null)v=y.formAction;else if(yf(c)!==null)continue}else v=y.action;typeof v=="function"?i[l+1]=v:(i.splice(l,3),l-=3),Yg(i)}}}function vf(e){this._internalRoot=e}ac.prototype.render=vf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(r(409));var i=t.current,l=dn();qg(i,l,e,t,null,null)},ac.prototype.unmount=vf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;qg(e.current,2,null,e,null,null),Bo(),t[ba]=null}};function ac(e){this._internalRoot=e}ac.prototype.unstable_scheduleHydration=function(e){if(e){var t=Yl();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Si.length&&t!==0&&t<Si[i].priority;i++);Si.splice(i,0,e),i===0&&Gg(e)}};var Fg=a.version;if(Fg!=="19.1.1")throw Error(r(527,Fg,"19.1.1"));I.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=m(t),e=e!==null?p(e):null,e=e===null?null:e.stateNode,e};var FS={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ic=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ic.isDisabled&&ic.supportsFiber)try{Ue=ic.inject(FS),Ze=ic}catch{}}return ml.createRoot=function(e,t){if(!o(e))throw Error(r(299));var i=!1,l="",c=rp,d=lp,y=op,v=null;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(l=t.identifierPrefix),t.onUncaughtError!==void 0&&(c=t.onUncaughtError),t.onCaughtError!==void 0&&(d=t.onCaughtError),t.onRecoverableError!==void 0&&(y=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(v=t.unstable_transitionCallbacks)),t=Ug(e,1,!1,null,null,i,l,c,d,y,v,null),e[ba]=t.current,ef(e),new vf(t)},ml.hydrateRoot=function(e,t,i){if(!o(e))throw Error(r(299));var l=!1,c="",d=rp,y=lp,v=op,x=null,q=null;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(d=i.onUncaughtError),i.onCaughtError!==void 0&&(y=i.onCaughtError),i.onRecoverableError!==void 0&&(v=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(x=i.unstable_transitionCallbacks),i.formState!==void 0&&(q=i.formState)),t=Ug(e,1,!0,t,i??null,l,c,d,y,v,x,q),t.context=Og(null),i=t.current,l=dn(),l=ga(l),c=ai(l),c.callback=null,ii(i,c,l),i=l,t.current.lanes=i,Tt(t,i),Pn(t),e[ba]=t.current,ef(e),new ac(t)},ml.version="19.1.1",ml}var I2;function IM(){if(I2)return qf.exports;I2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(a){console.error(a)}}return n(),qf.exports=GM(),qf.exports}var YM=IM(),bt=tm();const pc=10,FM=1.5,$M=1.5,Y2=1,VM=.6,F2="⚔️ +50% attack · 🛡️ Barrier · ♾️ Immortal",ns=5,as=3;let vt=null;function XM(){vt&&(vt.tickTimer&&clearInterval(vt.tickTimer),vt.timeout&&clearTimeout(vt.timeout),vt=null)}function nm(){return vt!==null}function vb(){return vt?Math.max(0,vt.endTime-performance.now())/1e3:0}function KM(n,a){if(nm()||!n.spendResource(ns,ae.SISU))return!1;const s=[];for(const o of a){if(o.faction!=="player"||o.isDead())continue;const u=`sisu-burst-${o.id}`,f={unit:o,attackDelta:0,movementDelta:0,shieldBonusApplied:Y2,shieldBonusRemaining:Y2,wasImmortal:o.isImmortal()};oE({id:u,duration:pc,data:f,onApply:()=>{const h=o.stats.attackDamage,m=Math.round(h*FM);f.attackDelta=Math.max(0,m-h),f.attackDelta!==0&&(o.stats.attackDamage=h+f.attackDelta);const p=o.stats.movementRange,g=Math.max(1,Math.round(p*$M));f.movementDelta=Math.max(0,g-p),f.movementDelta!==0&&(o.stats.movementRange=p+f.movementDelta),f.shieldBonusRemaining=f.shieldBonusApplied,o.setShield(o.getShield()+f.shieldBonusApplied),o.setImmortal(!0),o.fearless=!0},onExpire:()=>{let h=!1;if(f.attackDelta!==0){const p=o.stats.attackDamage,g=Math.max(0,p-f.attackDelta);g!==p&&(o.stats.attackDamage=g,h=!0)}if(f.movementDelta!==0){const p=o.stats.movementRange,g=Math.max(0,p-f.movementDelta);g!==p&&(o.stats.movementRange=g,h=!0)}o.setImmortal(f.wasImmortal);const m=Math.max(0,Math.min(f.shieldBonusApplied,f.shieldBonusRemaining));m>0&&o.setShield(Math.max(0,o.getShield()-m)),delete o.fearless,h&&te.emit("unit:stats:changed",{unitId:o.id,stats:{...o.stats}}),vt&&(vt.affected=vt.affected.filter(p=>p.modifierId!==u))},hooks:{"combat:onHit":h=>{const m=h;if(m.source!=="defender"||m.defender.id!==o.id||m.shieldDamage<=0||f.shieldBonusRemaining<=0)return;const p=Math.min(f.shieldBonusRemaining,m.shieldDamage);f.shieldBonusRemaining=Math.max(0,f.shieldBonusRemaining-p)}}}),s.push({unit:o,modifierId:u,state:f})}return vt={endTime:performance.now()+pc*1e3,status:F2,affected:s,tickTimer:null,timeout:null},te.emit("sisuBurstStart",{remaining:pc,status:F2}),vt.tickTimer=setInterval(()=>{if(!vt)return;const o=Math.max(0,Math.ceil(vb()));o>0&&te.emit("sisuBurstTick",{remaining:o,status:vt.status})},1e3),vt.timeout=setTimeout(()=>{QM()},pc*1e3),!0}function QM(){if(vt){for(const n of vt.affected)cE(n.modifierId);XM(),te.emit("sisuBurstEnd",{})}}function PM(n,a,s,r){const o=a.filter(u=>u.faction==="player"&&!u.isDead());if(o.length===0||!n.spendResource(as,ae.SISU))return!1;for(const u of o){const f=Wy(s,3,a)??{...s};u.setCoord(f);const h=Math.round(u.getMaxHealth()*VM);u.stats.health=Math.min(u.getMaxHealth(),Math.max(u.stats.health,h))}return r.revealAround(s,3,{autoFrame:!1}),te.emit("torilleRecalled",{count:o.length}),!0}let ls=!1;function Sb(){return ls}function Eb(n){ls!==n&&(ls=n,te.emit("game:pause-changed",{paused:ls}))}function ZM(){return Eb(!ls),ls}function JM(){ls&&Eb(!1)}const WM=["/assets/sounds/sauna-forest.ogg","/assets/sounds/sauna-forest.mp3"],Mb="audio_enabled",bh=new Set,cu=new Set;let is=null,gc=null,Ba=null,Cl=null;function ex(n){if(typeof localStorage>"u")return null;try{return localStorage.getItem(n)}catch(a){return console.warn("Unable to read ambience preference",n,a),null}}const xb=ex(Mb);let Xa=xb==="true",Tl=xb!==null;const vh=su();let Dc=Ab(vh.channels.music.volume,.65),os=!1,sa=vh.channels.master.muted||vh.channels.music.muted;const Ps=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)"):null;let wb=Ps?.matches??!1;if(Ps){const n=a=>{wb=a.matches};typeof Ps.addEventListener=="function"?Ps.addEventListener("change",n):typeof Ps.addListener=="function"&&Ps.addListener(n)}if(typeof window<"u"&&!Tl){const n=()=>{Tl||(Tl=!0,Nb(!0),uu())};window.addEventListener("pointerdown",n,{once:!0}),window.addEventListener("keydown",n,{once:!0})}jh(n=>{const a=Ab(n.channels.music.volume,Dc),s=n.channels.master.muted||n.channels.music.muted,r=Math.abs(a-Dc)>5e-4;if(Dc=a,s!==sa){sa=s,sa?Rb():Xa?uu():(Ll(!0),Dl());return}r&&Dl()});function Ab(n,a){return Number.isFinite(n)?n<0?0:n>1?1:n:a}function Dl(){const n=kb();for(const a of bh)a(n)}function tx(n){if(!(typeof localStorage>"u"))try{localStorage.setItem(Mb,n?"true":"false")}catch(a){console.warn("Unable to persist ambience preference",a)}}function Cb(n){if(Ba)return Ba;const a=n.createGain();a.gain.value=Xa&&!sa?1:0;const s=Hh("music");return s?a.connect(s):a.connect(n.destination),Ba=a,a}function Ll(n=!1){if(!Ba)return;const a=Ba.context,s=Xa&&!sa?1:0,r=a.currentTime;Ba.gain.cancelScheduledValues(r),n?Ba.gain.setValueAtTime(s,r):Ba.gain.setTargetAtTime(s,r,.25)}function nx(){return wb?.6:4.2}function Tb(){Cl!==null&&(clearTimeout(Cl),Cl=null)}function Sh(n){try{n.source.stop()}catch{}n.source.disconnect(),n.gain.disconnect(),cu.delete(n)}function ax(){for(const n of[...cu])Sh(n)}async function ix(n){return is||(gc||(gc=(async()=>{for(const a of WM)try{const s=await fetch(a);if(!s.ok)continue;const r=await s.arrayBuffer();return await n.decodeAudioData(r)}catch(s){console.warn("Failed to fetch ambience source",a,s)}throw new Error("No ambience sources available")})().then(a=>(is=a,a)).catch(a=>{throw gc=null,a})),gc)}function sx(n,a){if(!os)return;Tb();const s=Math.max(0,n-a.currentTime-.05);Cl=setTimeout(()=>{Cl=null,os&&_b(n)},s*1e3)}function _b(n){const a=Ba?.context??Db();if(!a||!is)return;const s=a.createGain(),r=a.createBufferSource();r.buffer=is,r.loop=!1,r.connect(s),s.connect(Cb(a));const o=Math.min(nx(),is.duration/2),u=Number.isFinite(o)&&o>0?o:.25,f=Math.max(a.currentTime,n);s.gain.setValueAtTime(0,f),s.gain.linearRampToValueAtTime(1,f+u);const h=n+is.duration,m=h-u;m>f&&s.gain.setValueAtTime(1,m),s.gain.linearRampToValueAtTime(.001,h+.1);const p={source:r,gain:s,stopTime:h};cu.add(p),r.addEventListener("ended",()=>{Sh(p)});try{r.start(n)}catch(g){console.warn("Failed to start ambience layer",g),Sh(p);return}sx(h-u,a)}async function uu(){if(os||!Xa||sa){Ll();return}const n=Db();if(n){Cb(n),Ll();try{const a=await ix(n);if(!Xa||sa)return;await n.resume().catch(()=>{}),os=!0;const s=Math.max(n.currentTime+.12,n.currentTime);_b(s),Dl()}catch(a){console.warn("Unable to start ambience",a)}}}function Rb(){if(!os&&cu.size===0){Ll(!0);return}os=!1,Tb(),ax(),Ll(!0),Dl()}function Nb(n){Xa===n&&Tl||(Xa=n,Tl=!0,tx(n),n?sa||uu():Rb(),Dl())}function kb(){return{enabled:Xa,playing:os,volume:Dc,globallyMuted:sa}}function rx(n){return bh.add(n),()=>{bh.delete(n)}}Xa&&!sa&&uu();function Db(){return Bh()}const lx='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',Gf={master:"Master mix",music:"Ambience soundscape",sfx:"Effects & interface"},ox={master:"Controls the overall loudness for every channel in the frontier.",music:"Shapes the ambience loops and atmospheric swells around the sauna.",sfx:"Balances unit callouts, UI clicks, and battle feedback cues."},cx="linear-gradient(90deg, rgba(59,130,246,0.85) 0%, rgba(14,165,233,0.9) VAR%, rgba(148,163,184,0.35) VAR%, rgba(71,85,105,0.2) 100%)";function Eh(n,a){n.style.backgroundImage=cx.replace(/VAR/g,`${a}%`)}function Mh(n){return`${Math.round(n)}%`}function ux(n,a,s){const r=o=>{if(o.key==="Escape"){o.preventDefault(),s();return}if(o.key!=="Tab")return;const u=a.querySelectorAll(lx);if(u.length===0){o.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;o.shiftKey?(m===f||!a.contains(m))&&(o.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(o.preventDefault(),f.focus())};return n.addEventListener("keydown",r),()=>n.removeEventListener("keydown",r)}function Lb(n,a,s){const r=a.channels[n],o=a.channels.master;if(n==="music"&&!s.enabled)return"Ambience paused";if(r.muted)return"Muted at mixer";if(n!=="master"&&o.muted)return"Master mute active";const u=Math.round(r.effectiveVolume*100);return u<=0?"Output silent":n==="master"?`Master output ${u}%`:n==="music"?`Soundscape live ${u}%`:`Effects live ${u}%`}function If(n,a,s,r,o,u,f){const h=n.createElement("section");h.className="rounded-hud-xl border border-white/12 bg-[linear-gradient(155deg,rgba(15,26,56,0.92),rgba(9,14,34,0.96))] p-5 shadow-[0_24px_45px_rgba(4,10,25,0.55)] backdrop-blur-[18px] backdrop-saturate-[140%]";const m=n.createElement("header");m.className="flex flex-wrap items-start justify-between gap-3";const p=n.createElement("div");p.className="space-y-1";const g=n.createElement("h3");g.className="text-lg font-semibold tracking-tight text-white",g.textContent=Gf[a];const b=n.createElement("p");b.className="max-w-[32ch] text-sm text-slate-300/85",b.textContent=ox[a],p.append(g,b);const S=n.createElement("span");S.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70",S.textContent=Lb(a,s,r),m.append(p,S);const E=n.createElement("div");E.className="mt-5 flex items-center gap-4";const w=n.createElement("input");w.type="range",w.min="0",w.max="100",w.step="1",w.className="h-2 flex-1 appearance-none rounded-full bg-slate-600/30 accent-accent transition-[background-image] duration-200 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",w.setAttribute("aria-label",`${Gf[a]} level`);const R=n.createElement("span");R.className="text-sm font-semibold text-slate-200",E.append(w,R);const _=n.createElement("div");_.className="mt-4 flex flex-wrap items-center gap-3";const U=n.createElement("button");if(U.type="button",U.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/60 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-white/80 transition-all duration-150 ease-out hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",U.setAttribute("aria-label",`Toggle mute for ${Gf[a]}`),U.addEventListener("click",()=>{const F=!es.channels[a].muted;o(a,F)}),_.append(U),a==="sfx"){const F=n.createElement("button");F.type="button",F.className="inline-flex items-center gap-2 rounded-full border border-accent/40 bg-accent/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-accent-200 transition-all duration-150 ease-out hover:bg-accent/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",F.textContent="Play sample",F.addEventListener("click",()=>{ia("spawn")}),_.append(F)}let B;a==="music"&&f&&(B=n.createElement("button"),B.type="button",B.className="inline-flex items-center gap-2 rounded-full border border-emerald-300/25 bg-emerald-400/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-emerald-200 transition-all duration-150 ease-out hover:bg-emerald-400/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300",B.addEventListener("click",()=>{f()}),_.append(B));const G=Math.round(s.channels[a].volume*100);return w.value=String(G),Eh(w,G),R.textContent=Mh(G),U.setAttribute("aria-pressed",s.channels[a].muted?"true":"false"),U.textContent=s.channels[a].muted?"Muted":"Active",a==="music"&&(w.title=r.enabled?"Adjust ambience loudness":"Ambience paused — set the level ahead of resuming."),w.addEventListener("input",()=>{const F=Number(w.value);Eh(w,F),R.textContent=Mh(F),u(a,F/100)}),h.append(m,E,_),{card:h,slider:w,value:R,muteButton:U,status:S,ambienceToggle:B}}let es=su();function dx(n){const{container:a,onClose:s}=n;if(!a)return{destroy(){},focus(){}};const r=a.ownerDocument??document,o=r.createElement("div");o.className="pointer-events-auto fixed inset-0 z-[1200] flex items-center justify-center bg-slate-950/75 p-4 backdrop-blur-[22px] backdrop-saturate-[140%]",o.setAttribute("role","presentation");const u=r.createElement("section");u.className="w-full max-w-[min(580px,92vw)] space-y-6 rounded-hud-xl border border-white/12 bg-[linear-gradient(145deg,rgba(12,22,45,0.95),rgba(7,13,29,0.97))] p-6 text-slate-100 shadow-[0_32px_60px_rgba(4,10,24,0.7)] backdrop-blur-[24px] backdrop-saturate-[150%]",u.setAttribute("role","dialog"),u.setAttribute("aria-modal","true");const f=`audio-mixer-title-${Date.now()}`;u.setAttribute("aria-labelledby",f),u.tabIndex=-1;const h=r.createElement("header");h.className="flex items-start justify-between gap-4";const m=r.createElement("div");m.className="space-y-1";const p=r.createElement("h2");p.id=f,p.className="text-2xl font-semibold tracking-tight text-white",p.textContent="Audio mixer";const g=r.createElement("p");g.className="max-w-[46ch] text-sm text-slate-300/85",g.textContent="Dial in the master bus, ambience beds, and tactical feedback without leaving the battlefield.",m.append(p,g);const b=r.createElement("button");b.type="button",b.className="rounded-full border border-white/20 bg-slate-800/70 px-3 py-1 text-sm font-semibold text-white/70 transition-all duration-150 hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",b.textContent="Close",h.append(m,b);const S=r.createElement("span");S.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70";const E=r.createElement("div");E.className="space-y-5";let w=kb();const R={master:If(r,"master",es,w,(Y,N)=>{L3(N)},(Y,N)=>{N3(N)},null),music:If(r,"music",es,w,(Y,N)=>{U3(N)},(Y,N)=>{k3(N)},()=>{Nb(!w.enabled)}),sfx:If(r,"sfx",es,w,(Y,N)=>{O3(N)},(Y,N)=>{D3(N)},null)};E.append(R.master.card,R.music.card,R.sfx.card),u.append(h,S,E),o.append(u),a.append(o);let _=!1;function U(){const Y=R.music.ambienceToggle;Y&&(Y.setAttribute("aria-pressed",w.enabled?"true":"false"),Y.textContent=w.enabled?"Ambience enabled":"Ambience paused",Y.title=w.enabled?"Disable ambience loops":"Enable ambience loops")}function B(Y){es=Y;const N=Y.contextState==="uninitialized"?"Context idle":Y.contextState==="running"?"Context running":"Context suspended";S.textContent=N,["master","music","sfx"].forEach(L=>{const A=R[L],$=Y.channels[L],H=Math.round($.volume*100);A.slider.value=String(H),Eh(A.slider,H),A.value.textContent=Mh(H),A.muteButton.setAttribute("aria-pressed",$.muted?"true":"false"),A.muteButton.textContent=$.muted?"Muted":"Active",A.status.textContent=Lb(L,Y,w),L==="music"&&(A.slider.title=w.enabled?"Adjust ambience loudness":"Ambience paused — set the level ahead of resuming.")}),U()}function G(){_||(_=!0,F(),o.parentElement&&o.remove(),s?.())}function F(){P.forEach(Y=>{try{Y()}catch{}}),P.length=0}const P=[],ie=Y=>{Y.target===o&&G()};o.addEventListener("click",ie),P.push(()=>o.removeEventListener("click",ie)),b.addEventListener("click",G),P.push(()=>b.removeEventListener("click",G));const se=ux(o,u,G);P.push(se);const le=jh(Y=>{B(Y)});P.push(le);const ne=rx(Y=>{w=Y,U(),B(es)});return P.push(ne),B(es),u.focus(),{destroy(){G()},focus(){u.focus()}}}function $2(...n){return n.filter(Boolean).join(" ")}function V2(n,a){return!(n.code!==a.code||(a.shift??!1)!==n.shiftKey||(a.alt??!1)!==n.altKey||(a.meta??!1)!==n.metaKey||(a.ctrl??!1)!==n.ctrlKey)}function fx(n){return!Number.isFinite(n)||n<=0?"0s":`${Math.max(0,Math.ceil(n))}s`}function hx(){const[n,a]=bt.useState(()=>{const s=nm();return{active:s,remaining:s?Math.ceil(vb()):0,status:s?"Burst active":void 0}});return bt.useEffect(()=>{const s=({remaining:u,status:f})=>{a({active:!0,remaining:Math.ceil(u),status:f})},r=({remaining:u,status:f})=>{a(h=>({active:!0,remaining:Math.ceil(u),status:f??h.status}))},o=()=>{a({active:!1,remaining:0,status:void 0})};return te.on("sisuBurstStart",s),te.on("sisuBurstTick",r),te.on("sisuBurstEnd",o),()=>{te.off("sisuBurstStart",s),te.off("sisuBurstTick",r),te.off("sisuBurstEnd",o)}},[]),n}function mx(){const[n,a]=bt.useState(()=>Sb());return bt.useEffect(()=>{const s=({paused:r})=>{a(r)};return te.on("game:pause-changed",s),()=>{te.off("game:pause-changed",s)}},[]),n}function X2(n){const a=n.target;if(!a)return!1;const s=a.tagName;return!!(s==="INPUT"||s==="TEXTAREA"||s==="SELECT"||a.isContentEditable)}function px({state:n,abilities:a}){const[s,r]=bt.useState(()=>n.getResource(ae.SISU)),[o,u]=bt.useState(()=>dh()),[f,h]=bt.useState(!1),[m,p]=bt.useState(null),g=bt.useRef({}),[b,S]=bt.useState(()=>new Set),E=hx(),w=mx(),R=bt.useRef(null),_=bt.useCallback(N=>{S(A=>{const $=new Set(A);return $.add(N),$});const L=g.current[N];L&&window.clearTimeout(L),g.current[N]=window.setTimeout(()=>{S(A=>{const $=new Set(A);return $.delete(N),$}),delete g.current[N]},650)},[]);bt.useEffect(()=>{const N=({resource:L,total:A})=>{L===ae.SISU&&r(A)};return te.on("resourceChanged",N),()=>{te.off("resourceChanged",N),Object.values(g.current).forEach(L=>{L&&window.clearTimeout(L)}),g.current={}}},[]),bt.useEffect(()=>iE(u),[]),bt.useEffect(()=>()=>{R.current?.destroy(),R.current=null},[]);const U=bt.useCallback(()=>{const N=document.getElementById("ui-overlay");if(!N)return!1;if(R.current)return R.current.destroy(),R.current=null,h(!1),!0;const L=dx({container:N,onClose:()=>{R.current=null,h(!1)}});return R.current=L,h(!0),L.focus(),!0},[]),B=a.useSisuBurst,G=a.torille,F=a.onOpenBuildPlanner,P=!B||E.active||s<ns,ie=B?E.active?"Burst already surging.":s<ns?`Requires ${ns} SISU.`:void 0:"Burst controls offline in this build.",se=!G||s<as,le=G?s<as?`Requires ${as} SISU.`:void 0:"Torille rally is unavailable right now.",ne=bt.useMemo(()=>[{id:"burst",icon:"⚡️",label:"Sisu Burst",description:"Ignite a surge of fury and resilience across your warriors.",hotkey:{code:"KeyQ",label:"Q"},accent:"primary",cost:`-${ns} SISU`,detail:E.active?`${E.status??"Burst active"} · ${fx(E.remaining)}`:void 0,blocked:P,blockedReason:ie,interactive:!!B,onActivate:()=>B?B():!1},{id:"torille",icon:"📣",label:"Torille!",description:"Call every survivor home to the sauna to regroup and heal.",hotkey:{code:"KeyW",label:"W"},accent:"primary",cost:`-${as} SISU`,blocked:se,blockedReason:le,interactive:!!G,onActivate:()=>G?G():!1},{id:"build",icon:"🛠️",label:"Build",description:"Draft new structures to reinforce your frontier.",hotkey:{code:"KeyE",label:"E"},accent:"neutral",blocked:!F,blockedReason:F?void 0:"Construction planner will unlock in a forthcoming update.",interactive:!!F,onActivate:()=>F?F()??!0:!1},{id:"sound",icon:o?"🔇":f?"🎚️":"🎛️",label:"Audio",description:"Open the in-game mixer to balance master, ambience, and effects.",hotkey:{code:"KeyR",label:"R"},accent:"neutral",toggled:f,detail:f?"Mixer open":o?"Muted":"Live mix",interactive:!0,blocked:!1,onActivate:()=>!!U()},{id:"pause",icon:w?"⏸️":"▶️",label:w?"Paused":"Pause",description:w?"Time is frozen — resume when your strategy is ready.":"Freeze the battlefield to reassess and issue commands.",hotkey:{code:"Space",label:"Space"},accent:"neutral",toggled:w,detail:w?"Combat frozen":"Time flowing",interactive:!0,blocked:!1,onActivate:()=>(ZM(),!0)}],[E.active,E.remaining,P,ie,G,f,o,F,w,se,le,B]),Y=bt.useCallback(N=>{if(!N.interactive){_(N.id);return}if(N.blocked){_(N.id);return}N.onActivate?.()===!1&&_(N.id)},[_]);return bt.useEffect(()=>{const N=A=>{if(A.repeat||X2(A))return;const $=ne.find(H=>V2(A,H.hotkey));$&&(A.preventDefault(),p($.id),Y($))},L=A=>{if(X2(A))return;const $=ne.find(H=>V2(A,H.hotkey));$&&(A.preventDefault(),p(H=>H===$.id?null:H))};return window.addEventListener("keydown",N),window.addEventListener("keyup",L),()=>{window.removeEventListener("keydown",N),window.removeEventListener("keyup",L)}},[ne,Y]),Zt.jsx("div",{className:"pointer-events-none w-full",children:Zt.jsx("div",{className:"pointer-events-auto mx-auto flex w-full max-w-4xl flex-col gap-4 rounded-[26px] border border-white/10 bg-[linear-gradient(145deg,rgba(11,17,30,0.86),rgba(6,10,18,0.92))] p-6 shadow-[0_26px_65px_rgba(6,12,24,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)] backdrop-blur-xl","aria-label":"Combat and systems action bar",children:Zt.jsx("div",{className:"flex flex-wrap items-stretch justify-center gap-4",children:ne.map(N=>{const L=m===N.id,A=b.has(N.id),H=(N.blocked??!1)||!N.interactive,T=N.detail??N.blockedReason,I=$2("group relative flex min-w-[150px] flex-1 flex-col gap-2 rounded-[20px] border border-white/10 px-5 py-4 text-left transition-all duration-200 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70 focus-visible:ring-offset-0","bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.22),rgba(14,25,45,0.6))] shadow-[0_18px_42px_rgba(8,25,53,0.55)]",N.accent==="primary"&&"border-sky-300/40 bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.32),rgba(11,22,45,0.7))]",N.accent==="danger"&&"border-rose-400/45 bg-[radial-gradient(circle_at_top,rgba(244,114,182,0.32),rgba(45,9,25,0.75))]",L&&"ring-2 ring-sky-300/80 ring-offset-0 translate-y-[-2px] shadow-[0_24px_48px_rgba(56,189,248,0.45)]",A&&'animate-hud-shake after:pointer-events-none after:absolute after:inset-0 after:rounded-[inherit] after:border after:border-rose-300/45 after:bg-[radial-gradient(circle_at_center,rgba(248,113,113,0.18),rgba(248,113,113,0))] after:content-[""] after:animate-hud-pulse',!H&&!L&&"hover:-translate-y-1 hover:shadow-[0_24px_50px_rgba(56,189,248,0.4)]",H&&"cursor-not-allowed opacity-70",N.toggled&&"border-sky-400/60 shadow-[0_0_36px_rgba(56,189,248,0.45)]");return Zt.jsxs("button",{type:"button",className:I,"aria-pressed":N.toggled?"true":void 0,"aria-disabled":H?"true":void 0,"data-hotkey":N.hotkey.label,onClick:J=>{if(H){J.preventDefault(),_(N.id);return}Y(N)},onKeyDown:J=>{(J.key==="Enter"||J.key===" ")&&(J.preventDefault(),Y(N))},title:$2(N.description,N.blockedReason),children:[Zt.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Zt.jsxs("span",{className:"flex items-center gap-3 text-base font-semibold uppercase tracking-[0.18em] text-slate-100",children:[Zt.jsx("span",{"aria-hidden":"true",className:"text-2xl",children:N.icon}),N.label]}),Zt.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-slate-300/80",children:N.hotkey.label})]}),Zt.jsx("p",{className:"text-sm leading-relaxed text-slate-200/80",children:N.description}),Zt.jsxs("div",{className:"flex items-center justify-between text-xs font-medium uppercase tracking-[0.28em] text-slate-300/70",children:[Zt.jsx("span",{children:T??"​"}),N.cost?Zt.jsx("span",{className:"text-slate-200/90",children:N.cost}):Zt.jsx("span",{className:"opacity-0",children:"cost"})]})]},N.id)})})})})}function gx(n,a,s={}){const r=mr(a),o=a.ownerDocument.createElement("div");o.dataset.component="action-bar",o.className="flex w-full justify-center";const u=r.regions.bottom,f=u.querySelector("#build-id");f?u.insertBefore(o,f):u.appendChild(o);const h=YM.createRoot(o);return h.render(Zt.jsx(px,{state:n,abilities:s})),{destroy(){h.unmount(),o.remove()}}}const yx="(max-width: 820px)",Ub="is-mobile",Ob="is-desktop";let Un=null,Yc=null,ea=!1,yc=0;const Fc=new Set,xh=new Set,$c=n=>{for(const a of xh)a.classList.toggle(Ub,n),a.classList.toggle(Ob,!n),a.dataset.viewport=n?"mobile":"desktop"},bx=n=>{if(ea!==n){ea=n,$c(ea);for(const a of Array.from(Fc))try{a(ea)}catch(s){console.error("Failed to notify mobile listener",s)}}},qb=()=>{if(Un||typeof window>"u")return;Un=window.matchMedia(yx),ea=Un.matches,$c(ea);const n=a=>{bx(a.matches)};typeof Un.addEventListener=="function"?(Un.addEventListener("change",n),Yc=()=>Un?.removeEventListener("change",n)):(Un.addListener(n),Yc=()=>Un?.removeListener(n))},vx=()=>{Un&&(Yc?.(),Yc=null,Un=null)},zb=(n,{immediate:a=!0}={})=>(qb(),Fc.add(n),a&&n(ea),()=>{Fc.delete(n)}),Sx=({root:n,onChange:a,immediate:s=!0}={})=>{qb();const r=n??(typeof document<"u"?document.documentElement:null);r&&(xh.add(r),$c(ea)),yc+=1;let o=null;return a?o=zb(a,{immediate:s}):s&&Un&&$c(ea),{matches:()=>ea,dispose:()=>{r&&(xh.delete(r),r.classList.remove(Ub,Ob),(r.dataset.viewport==="mobile"||r.dataset.viewport==="desktop")&&delete r.dataset.viewport),o&&(o(),o=null),yc=Math.max(0,yc-1),yc===0&&Fc.size===0&&vx()}}};function Ex(n){const a=[n.name];return n.description&&a.push(n.description),n.rarity&&a.push(`Rarity: ${n.rarity}`),n.quantity>1&&a.push(`Quantity: ${n.quantity}`),a.join(" — ")}function Mx(n){const a=document.createElement("span");a.classList.add("item-icon__fallback");const s=n.trim();return a.textContent=s?s[0]?.toUpperCase()??"?":"?",a.setAttribute("aria-hidden","true"),a}function xx(n,a){const s=document.createElement("img");return s.src=n,s.alt="",s.decoding="async",s.loading="lazy",s.classList.add("item-icon__image"),s.setAttribute("aria-hidden","true"),s.title=a,s}function wx(n){const a=document.createElement("li");a.classList.add("item-icon"),a.dataset.itemId=n.id;const s=Ex(n);if(a.title=s,a.setAttribute("aria-label",s),a.setAttribute("role","listitem"),n.rarity&&(a.dataset.rarity=n.rarity.toLowerCase()),n.icon&&n.icon.trim().length>0?a.appendChild(xx(n.icon,n.name)):a.appendChild(Mx(n.name)),n.quantity>1){const r=document.createElement("span");r.classList.add("item-icon__quantity"),r.textContent=`×${n.quantity}`,r.setAttribute("aria-hidden","true"),a.appendChild(r)}return a}const Ax=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function wh(n){return n===1/0?"∞":!Number.isFinite(n)||n<=0?"0s":`${Ax.format(Math.ceil(n))}s`}function Cx(n){const a=[n.name];return n.description&&a.push(n.description),n.source&&a.push(`Source: ${n.source}`),n.duration!==1/0&&a.push(`Duration: ${wh(n.duration)}`),a.push(`Remaining: ${wh(n.remaining)}`),n.stacks&&n.stacks>1&&a.push(`Stacks: ${n.stacks}`),a.join(" — ")}function Tx(n){const a=document.createElement("li");a.classList.add("mod-pill"),a.dataset.modifierId=n.id,a.title=Cx(n),a.setAttribute("aria-label",a.title),a.setAttribute("role","listitem"),a.dataset.duration=n.duration===1/0?"infinite":String(n.duration),a.dataset.remaining=n.remaining===1/0?"infinite":String(n.remaining),n.appliedAt!==void 0&&(a.dataset.appliedAt=String(n.appliedAt)),n.stacks&&n.stacks>1&&(a.dataset.stacks=String(n.stacks));const s=document.createElement("span");if(s.classList.add("mod-pill__name"),s.textContent=n.name,s.setAttribute("aria-hidden","true"),a.appendChild(s),n.stacks&&n.stacks>1){const o=document.createElement("span");o.classList.add("mod-pill__stacks"),o.textContent=`×${n.stacks}`,o.setAttribute("aria-hidden","true"),a.appendChild(o)}const r=document.createElement("span");return r.classList.add("mod-pill__timer"),r.textContent=wh(n.remaining),r.setAttribute("aria-hidden","true"),a.appendChild(r),n.remaining!==1/0&&n.remaining<=5&&(a.dataset.urgent="true"),a}const Ah={engaged:"Engaged on the field",reserve:"On reserve duty",downed:"Recovering from battle"},Xe=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),K2="panel-roster-title";function _x(n){return n.length===0?"No defining traits yet":n.join(" • ")}function Bb(n){return Number.isFinite(n)?Math.max(0,Math.min(100,Math.round(n*100))):0}function Rx(n){const a=Xe;if(n.xpForNext===null)return`${a.format(n.xp)} XP • Max level`;const s=Bb(n.progress);return`${a.format(n.xpIntoLevel)} / ${a.format(n.xpForNext)} XP • ${s}%`}function Hb(n){const a=[],s=(r,o)=>{o>0&&a.push(`+${Xe.format(o)} ${r}`)};return s("Vigor",n.vigor),s("Focus",n.focus),s("Resolve",n.resolve),a.length===0?"No level bonuses yet":a.join(" • ")}function Ks(n,a){const r=Math.round(n-(typeof a=="number"?a:0));if(r===0)return"";const o=Xe.format(Math.abs(r));return r>0?` (+${o})`:` (-${o})`}function Nx(n){if(!n)return"No stat changes";const a=[],s=(r,o)=>{if(typeof o=="number"&&o!==0){const u=o>0?"+":"−";a.push(`${r} ${u}${Xe.format(Math.abs(o))}`)}};return s("HP",n.health),s("ATK",n.attackDamage),s("RNG",n.attackRange),s("MOV",n.movementRange),s("DEF",n.defense),s("Shield",n.shield),a.length===0?"No stat changes":a.join(", ")}function kx(n){const{stats:a,baseStats:s}=n,r=[`HP ${Xe.format(a.health)}/${Xe.format(a.maxHealth)}${Ks(a.maxHealth,s.maxHealth)}`];return a.shield&&a.shield>0&&r.push(`Shield ${Xe.format(a.shield)}${Ks(a.shield,s.shield)}`),r.push(`ATK ${Xe.format(a.attackDamage)}${Ks(a.attackDamage,s.attackDamage)}`),r.push(`RNG ${Xe.format(a.attackRange)}${Ks(a.attackRange,s.attackRange)}`),a.defense&&a.defense>0&&r.push(`DEF ${Xe.format(a.defense)}${Ks(a.defense,s.defense)}`),r.push(`MOV ${Xe.format(a.movementRange)}${Ks(a.movementRange,s.movementRange)}`),r.push(`Upkeep ${Xe.format(n.upkeep)} beer`),r.join(" • ")}function Dx(n){const{stats:a}=n,s=[n.name,Ah[n.status]];s.push(`level ${n.progression.level}`),s.push(`health ${Xe.format(a.health)} of ${Xe.format(a.maxHealth)}`),a.shield&&a.shield>0&&s.push(`shield ${Xe.format(a.shield)}`),s.push(`attack ${Xe.format(a.attackDamage)}`),a.defense&&a.defense>0&&s.push(`defense ${Xe.format(a.defense)}`),a.attackRange>0&&s.push(`attack range ${Xe.format(a.attackRange)}`),s.push(`movement ${Xe.format(a.movementRange)}`),s.push(`upkeep ${Xe.format(n.upkeep)} beer`),n.progression.xpForNext===null?s.push(`${Xe.format(n.progression.xp)} total experience`):s.push(`${Xe.format(n.progression.xpIntoLevel)} of ${Xe.format(n.progression.xpForNext)} experience toward next level`);const r=Hb(n.progression.statBonuses);r&&s.push(`level bonuses ${r}`);const o=n.equipment.filter(u=>u.item).length;return o>0&&s.push(`${o} equipped item${o===1?"":"s"}`),n.modifiers.length>0&&s.push(`${n.modifiers.length} active modifier${n.modifiers.length===1?"":"s"}`),s.join(", ")}function Lx(n,a){const s=a.filter(h=>h.status==="engaged").length,r=a.filter(h=>h.status==="reserve").length,o=a.filter(h=>h.status==="downed").length,u=(h,m,p)=>{const g=document.createElement("span");return g.classList.add("panel-roster__metric"),g.dataset.status=p,g.textContent=`${Xe.format(m)} ${h}`,g.setAttribute("aria-label",g.textContent),g},f=document.createElement("div");f.classList.add("panel-roster__metrics"),f.append(u("engaged",s,"engaged"),u("reserve",r,"reserve"),u("downed",o,"downed")),n.appendChild(f)}function Ux(n,a,s){const r=document.createElement("div");r.classList.add("panel-roster__loadout");const o=document.createElement("ul");o.classList.add("panel-roster__slots"),o.setAttribute("role","list"),o.setAttribute("aria-label",`${a.name} equipment slots`);for(const u of a.equipment){const f=document.createElement("li");f.classList.add("panel-roster__slot"),f.dataset.slot=u.id;const h=document.createElement("div");h.classList.add("panel-roster__slot-header");const m=document.createElement("span");m.classList.add("panel-roster__slot-label"),m.textContent=u.label,m.title=u.description,h.appendChild(m);const p=document.createElement("span");if(p.classList.add("panel-roster__slot-summary"),p.textContent=u.item?u.item.name:"Empty",p.title=u.description,h.appendChild(p),f.appendChild(h),u.item){const w=document.createElement("ul");w.classList.add("panel-roster__slot-icons"),w.setAttribute("role","list"),w.appendChild(wx(u.item)),f.appendChild(w)}const g=document.createElement("span");g.classList.add("panel-roster__slot-modifiers"),g.textContent=Nx(u.modifiers),g.title=g.textContent,f.appendChild(g);const b=document.createElement("div");b.classList.add("panel-roster__slot-actions");const S=document.createElement("button");S.type="button",S.classList.add("panel-roster__slot-action"),S.textContent=u.item?"Replace":"Equip",S.setAttribute("aria-label",`Equip ${u.label} for ${a.name}`),S.addEventListener("click",w=>{w.stopPropagation(),s.onEquipSlot?.(a.id,u.id)}),b.appendChild(S);const E=document.createElement("button");E.type="button",E.classList.add("panel-roster__slot-action"),E.textContent="Unequip",E.disabled=u.item===null,E.setAttribute("aria-label",`Unequip ${u.label} from ${a.name}`),E.addEventListener("click",w=>{w.stopPropagation(),E.disabled||s.onUnequipSlot?.(a.id,u.id)}),b.appendChild(E),f.appendChild(b),o.appendChild(f)}if(r.appendChild(o),a.modifiers.length>0){const u=document.createElement("ul");u.classList.add("panel-roster__mods"),u.setAttribute("role","list"),u.setAttribute("aria-label",`${a.name} active modifiers`),u.title=a.modifiers.map(f=>f.name).join(", ");for(const f of a.modifiers)u.appendChild(Tx(f));r.appendChild(u)}n.appendChild(r)}function Ox(n,a={}){return{render:r=>{n.innerHTML="",n.dataset.count=String(r.length),n.classList.add("panel-roster");const o=document.createElement("div");o.classList.add("panel-roster__header");const u=document.createElement("h4");u.classList.add("panel-roster__title"),u.textContent="Battalion Roster",u.id=K2,o.appendChild(u),n.setAttribute("aria-labelledby",K2);const f=r.length===0?"No attendants mustered yet":`${Xe.format(r.length)} attendant${r.length===1?"":"s"} enlisted`,h=document.createElement("span");if(h.classList.add("panel-roster__count"),h.textContent=f,o.appendChild(h),n.appendChild(o),r.length===0){const p=document.createElement("p");p.classList.add("panel-roster__empty"),p.textContent="No attendants have rallied to the sauna yet.",n.appendChild(p);return}Lx(n,r);const m=document.createElement("ul");m.classList.add("panel-roster__list"),m.setAttribute("role","list");for(const p of r){const g=document.createElement("li");g.classList.add("panel-roster__row");const b=document.createElement("button");b.type="button",b.classList.add("panel-roster__item"),b.dataset.unitId=p.id,b.dataset.status=p.status,b.setAttribute("aria-pressed",p.selected?"true":"false"),b.setAttribute("aria-label",Dx(p)),b.title=`${p.name} • ${Ah[p.status]}`,p.selected&&b.classList.add("is-selected"),p.status==="downed"&&b.classList.add("is-downed");const S=document.createElement("div");S.classList.add("panel-roster__name-row");const E=document.createElement("div");E.classList.add("panel-roster__identity");const w=document.createElement("span");w.classList.add("panel-roster__level"),w.dataset.level=String(p.progression.level),w.style.setProperty("--level-progress","0%");const R=Bb(p.progression.progress);w.style.setProperty("--level-progress",`${R}%`),w.setAttribute("role","img");const _=p.progression.xpForNext===null?`Level ${p.progression.level}, at mastery`:`Level ${p.progression.level}, ${R}% toward next level`;w.setAttribute("aria-label",_);const U=document.createElement("span");U.classList.add("panel-roster__level-value"),U.textContent=String(p.progression.level),w.appendChild(U);const B=document.createElement("span");B.classList.add("panel-roster__name"),B.textContent=p.name,B.title=p.name,E.append(w,B),S.appendChild(E);const G=document.createElement("span");G.classList.add("panel-roster__status"),G.dataset.status=p.status,G.textContent=Ah[p.status],S.appendChild(G);const F=document.createElement("div");F.classList.add("panel-roster__meta");const P=kx(p);F.textContent=P,F.title=P;const ie=document.createElement("div");ie.classList.add("panel-roster__xp");const se=Rx(p.progression);ie.textContent=se,ie.title=se;const le=document.createElement("div");le.classList.add("panel-roster__callouts");const ne=Hb(p.progression.statBonuses);le.textContent=ne,le.title=ne;const Y=document.createElement("div");Y.classList.add("panel-roster__health");const N=document.createElement("div");N.classList.add("panel-roster__health-fill");const L=p.stats.maxHealth>0?Math.max(0,Math.min(100,Math.round(p.stats.health/p.stats.maxHealth*100))):0;N.style.width=`${L}%`,N.dataset.percent=`${L}`,Y.appendChild(N);const A=document.createElement("div");A.classList.add("panel-roster__traits");const $=_x(p.traits);A.textContent=$,A.title=$,b.append(S,ie,F,le,Y,A),Ux(b,p,a),typeof a.onSelect=="function"&&b.addEventListener("click",()=>a.onSelect?.(p.id)),g.appendChild(b),m.appendChild(g)}n.appendChild(m)}}}const qx=150,zx="autobattles:log-history:v2",jb="autobattles:log-preferences:v1",am=typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:null;let Q2=0;const P2=()=>(Q2+=1,`${Date.now().toString(36)}-${Q2.toString(36)}`),xl=n=>{if(Array.isArray(n))return n.map(a=>typeof a=="string"?a.trim():"").filter(a=>a.length>0);if(typeof n=="string"){const a=n.trim();return a?[a]:[]}return[]},Yf=n=>n?typeof n!="object"?{}:{...n}:{},Bx=n=>{if(!n)return null;if(typeof n.unitId=="string"&&n.unitId.trim().length>0)return n.unitId.trim();const a=xl(n.unitIds);return a.length>0?a[a.length-1]:null},Hx=(n,a)=>{const s=xl(n.unitIds??n.unitId),r=xl(a.unitIds??a.unitId),o=Array.from(new Set([...s,...r])),u=xl(n.unitNames??n.unitName),f=xl(a.unitNames??a.unitName),h=Array.from(new Set([...u,...f])),m=typeof a.steward=="string"?a.steward:n.steward,p={...n,...a,unitIds:o,unitNames:h};return typeof m=="string"&&(p.steward=m),h.length>0&&(p.unitName=h[h.length-1]),o.length>0&&(p.unitId=o[o.length-1]),p};class jx{history=[];listeners=new Set;storage;storageKey;maxEntries;constructor(a={}){this.storage=a.storage??am,this.storageKey=a.storageKey??zx,this.maxEntries=Math.max(1,a.maxEntries??qx),this.hydrate()}hydrate(){if(this.storage)try{const a=this.storage.getItem(this.storageKey);if(!a)return;const s=JSON.parse(a);if(!Array.isArray(s))return;const r=[];for(const o of s){if(!o||typeof o!="object")continue;const u=o;if(typeof u.type!="string"||typeof u.message!="string")continue;const f={id:typeof u.id=="string"?u.id:P2(),type:u.type,message:u.message,metadata:Yf(u.metadata),timestamp:typeof u.timestamp=="number"&&Number.isFinite(u.timestamp)?u.timestamp:Date.now(),occurrences:typeof u.occurrences=="number"&&u.occurrences>0?Math.floor(u.occurrences):1};r.push(f)}r.length>0&&(r.length>this.maxEntries?this.history=r.slice(-this.maxEntries):this.history=r)}catch{this.history=[]}}persist(){if(this.storage)try{const a=JSON.stringify(this.history.map(s=>({id:s.id,type:s.type,message:s.message,metadata:s.metadata,timestamp:s.timestamp,occurrences:s.occurrences})));this.storage.setItem(this.storageKey,a)}catch{}}getHistory(){return this.history.map(a=>({...a,metadata:Yf(a.metadata)}))}subscribe(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}clear(){if(this.history.length===0)return;const a=this.history.slice();this.history=[],this.persist(),this.emitChange({kind:"remove",entries:a})}emit(a){const s=Yf(a.metadata),r={id:P2(),type:a.type,message:a.message,metadata:s,timestamp:Date.now(),occurrences:1},o=this.tryAggregate(r);if(o)return this.history[o.index]=o.entry,this.persist(),this.emitChange({kind:"update",entry:o.entry,index:o.index}),o.entry;this.history.push(r);const u=[];for(;this.history.length>this.maxEntries;){const h=this.history.shift();h&&u.push(h)}this.persist(),u.length>0&&this.emitChange({kind:"remove",entries:u});const f=this.history.length-1;return this.emitChange({kind:"append",entry:r,index:f}),r}tryAggregate(a){if(a.type!=="spawn"||!Bx(a.metadata)||this.history.length===0)return null;const r=this.history.length-1,o=this.history[r];return o.type!=="spawn"?null:{entry:{...o,id:o.id,message:a.message,metadata:Hx(o.metadata??{},a.metadata??{}),timestamp:a.timestamp,occurrences:o.occurrences+a.occurrences},index:r}}emitChange(a){for(const s of this.listeners)try{s(a)}catch(r){console.warn("Failed to handle log change",r)}}}const im=new jx,qt=n=>im.emit(n),Gx=n=>im.subscribe(n),Ix=()=>im.getHistory(),_l={combat:{label:"Combat",accent:"var(--color-accent-red)"},spawn:{label:"Reinforcements",accent:"var(--color-accent-green)"},loot:{label:"Loot",accent:"var(--color-accent-gold)"},progression:{label:"Progression",accent:"var(--color-accent-blue)"},ability:{label:"Abilities",accent:"var(--color-accent-purple)"},resource:{label:"Economy",accent:"var(--color-accent-cyan)"},policy:{label:"Policies",accent:"var(--color-accent-orange)"},event:{label:"Events",accent:"var(--color-accent-pink)"},system:{label:"Systems",accent:"var(--color-muted)"}},Z2=["combat","spawn","loot","progression","ability","resource","policy","event","system"],bc={mutedTypes:[]},Yx=(n=am)=>{if(!n)return{...bc};try{const a=n.getItem(jb);if(!a)return{...bc};const s=JSON.parse(a);if(!s||typeof s!="object")return{...bc};const r=Array.isArray(s.mutedTypes)?s.mutedTypes.filter(o=>typeof o=="string"&&o in _l):[];return{mutedTypes:Array.from(new Set(r))}}catch{return{...bc}}},Fx=(n,a=am)=>{if(a)try{const s=Array.isArray(n.mutedTypes)?n.mutedTypes.filter(r=>r in _l):[];a.setItem(jb,JSON.stringify({mutedTypes:Array.from(new Set(s))}))}catch{}},Ff=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function $x(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{log:()=>{},addEvent:()=>{},renderRoster:()=>{},dispose:()=>{}};const{regions:r,mobileBar:o}=mr(s),u=r.top,f=r.right,h=s.querySelector("#right-panel");h&&h.remove();const m=s.querySelector(".right-panel-slide");m&&m.remove();const p=s.querySelector("#right-panel-toggle");p&&p.remove();const g=document.createElement("div");g.id="right-panel",g.classList.add("hud-card"),g.setAttribute("role","complementary"),g.setAttribute("aria-label","Sauna command console"),g.tabIndex=-1;const b=document.createElement("div");b.className="right-panel-slide",b.setAttribute("aria-hidden","true");const S=document.createElement("div");S.className="right-panel-slide__backdrop",S.setAttribute("aria-hidden","true");const E=document.createElement("div");E.className="right-panel-slide__sheet",E.appendChild(g),b.append(S,E);const w=window.matchMedia("(max-width: 1040px)"),R=[],_=document.createElement("button");_.type="button",_.id="right-panel-toggle",_.classList.add("hud-panel-toggle"),_.setAttribute("aria-controls",g.id);const U=document.createElement("span");U.classList.add("hud-panel-toggle__icon"),U.setAttribute("aria-hidden","true");const B=document.createElement("span");B.classList.add("hud-panel-toggle__icon-bars"),U.appendChild(B);const G=document.createElement("span");G.classList.add("hud-panel-toggle__text");const F=document.createElement("span");F.classList.add("hud-panel-toggle__title"),F.textContent="Command Console";const P=document.createElement("span");P.classList.add("hud-panel-toggle__state"),G.append(F,P),_.append(U,G);const ie=()=>{const k=u.querySelector("#topbar");k&&k.parentElement===u?k.insertAdjacentElement("afterend",_):u.prepend(_)};let se=!1,le=!1,ne=!1,Y=!1;const N="is-mobile-panel-open",L=()=>{ne?P.textContent=Y?"Close":"Menu":P.textContent=se?"Open":"Close"},A=()=>{if(ne){_.setAttribute("aria-expanded",Y?"true":"false");const k=Y?"Close command console panel":"Open command console panel";_.setAttribute("aria-label",k),_.title=Y?"Close the sauna command console overlay":"Open the sauna command console overlay"}else{_.setAttribute("aria-expanded",se?"false":"true");const k=se?"Open command console panel":"Close command console panel";_.setAttribute("aria-label",k),_.title=se?"Open the sauna command console overlay":"Close the sauna command console overlay"}},$=()=>{L(),A()},H=(k,X=w.matches)=>{if(ne)return;const re=se;X&&(le=k);const de=k&&X;se=de,g.classList.toggle("right-panel--collapsed",de),g.setAttribute("aria-hidden",de?"true":"false"),$(),re&&!de&&X&&g.focus({preventScroll:!0})},T=k=>{!ne||!Y||k.key==="Escape"&&(k.preventDefault(),V())};let I=!1;const J=()=>{I||(document.addEventListener("keydown",T),I=!0)},fe=()=>{I&&(document.removeEventListener("keydown",T),I=!1)},M=()=>{!ne||Y||(Y=!0,b.classList.add("right-panel-slide--open"),b.setAttribute("aria-hidden","false"),g.setAttribute("aria-hidden","false"),document.body.classList.add(N),b.style.setProperty("--panel-drag-progress","1"),$(),J(),requestAnimationFrame(()=>{g.focus({preventScroll:!0})}))},V=({skipFocus:k=!1}={})=>{!ne||!Y||(Ae(),Y=!1,b.classList.remove("right-panel-slide--open"),b.setAttribute("aria-hidden","true"),g.setAttribute("aria-hidden","true"),document.body.classList.remove(N),b.style.setProperty("--panel-drag-progress","0"),$(),fe(),k||_.focus({preventScroll:!0}))},ee=k=>{if(ne)return;const X=k.matches;_.hidden=!X,H(X?le:!1,X)};typeof w.addEventListener=="function"?(w.addEventListener("change",ee),R.push(()=>w.removeEventListener("change",ee))):(w.addListener(ee),R.push(()=>w.removeListener(ee)));const W=()=>{if(ne){Y?V():M();return}H(!se)};_.addEventListener("click",W),R.push(()=>_.removeEventListener("click",W));const oe=()=>{V()};S.addEventListener("click",oe),R.push(()=>S.removeEventListener("click",oe));let pe=null,he=0,Ie=0;const Ae=()=>{pe!==null&&(E.releasePointerCapture(pe),pe=null),E.style.transition="",E.style.transform="",b.style.setProperty("--panel-drag-progress",Y?"1":"0")},Ct=k=>{!ne||!Y||k.pointerType==="mouse"&&k.button!==0||(pe=k.pointerId,he=k.clientX,Ie=0,E.style.transition="none",E.setPointerCapture(k.pointerId))},Wt=k=>{if(!ne||k.pointerId!==pe||!Y)return;Ie=Math.max(0,k.clientX-he);const X=E.offsetWidth||1,re=Math.min(Ie,X);E.style.transform=`translateX(${re}px)`,b.style.setProperty("--panel-drag-progress",String(1-re/X))},wn=k=>{Ae(),k&&V()},en=k=>{if(k.pointerId!==pe)return;const X=E.offsetWidth||1,re=Ie>X*.35;wn(re)},Yt=()=>{wn(!1)};E.addEventListener("pointerdown",Ct),E.addEventListener("pointermove",Wt),E.addEventListener("pointerup",en),E.addEventListener("pointercancel",Yt),R.push(()=>{E.removeEventListener("pointerdown",Ct),E.removeEventListener("pointermove",Wt),E.removeEventListener("pointerup",en),E.removeEventListener("pointercancel",Yt)});const Ft=zb(k=>{ne=k,ne?(E.appendChild(g),b.isConnected||s.appendChild(b),o.appendChild(_),_.classList.add("hud-panel-toggle--mobile"),_.hidden=!1,Y||(g.setAttribute("aria-hidden","true"),b.setAttribute("aria-hidden","true"),b.style.setProperty("--panel-drag-progress","0"))):(V({skipFocus:!0}),b.style.setProperty("--panel-drag-progress","1"),b.remove(),f.appendChild(g),ie(),_.classList.remove("hud-panel-toggle--mobile"),_.hidden=!w.matches,g.setAttribute("aria-hidden","false"),H(le,w.matches)),$()});R.push(Ft);const ca=document.createElement("div");ca.classList.add("panel-tabs"),g.appendChild(ca);const ua=document.createElement("div");ua.classList.add("panel-content"),g.appendChild(ua);const ot=document.createElement("div");ot.id="right-panel-roster",ot.setAttribute("role","region"),ot.setAttribute("aria-live","polite"),ot.setAttribute("aria-label","Battalion roster");const da=document.createElement("div");da.id="right-panel-policies";const An=document.createElement("div");An.id="right-panel-events";const mn=document.createElement("div");mn.id="right-panel-log",mn.setAttribute("role","region"),mn.setAttribute("aria-label","Combat log");const $t=document.createElement("section");$t.className="panel-log";const Ka=document.createElement("header");Ka.className="panel-log__header";const Cn=document.createElement("h3");Cn.className="panel-log__title",Cn.textContent="Combat Log";const In=document.createElement("span");In.className="panel-log__total",In.textContent="0 entries",Ka.append(Cn,In);const Tn=document.createElement("div");Tn.className="panel-log__filters";const Ue=document.createElement("div");Ue.id="event-log",Ue.className="panel-log__feed",Ue.setAttribute("role","log"),Ue.setAttribute("aria-live","polite"),$t.append(Ka,Tn,Ue),mn.appendChild($t);const Ze={Roster:ot,Policies:da,Events:An,Log:mn},{onRosterSelect:tn,onRosterRendererReady:ft,onRosterEquipSlot:us,onRosterUnequipSlot:pr}=a;for(const[k,X]of Object.entries(Ze))X.classList.add("panel-section","panel-section--scroll"),X.dataset.tab=k,X.hidden=!0;mn.classList.add("panel-section--log");function ds(k){for(const[X,re]of Object.entries(Ze))re.hidden=X!==k;for(const X of Array.from(ca.children)){const re=X,de=re.textContent===k;re.disabled=de,re.setAttribute("aria-pressed",de?"true":"false")}}for(const k of Object.keys(Ze)){const X=document.createElement("button");X.type="button",X.textContent=k;const re=Ze[k];re?.id&&X.setAttribute("aria-controls",re.id),X.setAttribute("aria-pressed","false");const de=()=>ds(k);X.addEventListener("click",de),R.push(()=>X.removeEventListener("click",de)),ca.appendChild(X),ua.appendChild(Ze[k])}const Ri=Ox(ot,{onSelect:tn,onEquipSlot:us,onUnequipSlot:pr}),fa=k=>{Ri.render(k)};fa([]),typeof ft=="function"&&ft(fa);const _n={[ae.SAUNA_BEER]:"Sauna Beer Bottles",[ae.SAUNAKUNNIA]:"Saunakunnia",[ae.SISU]:"Sisu"},ce=Iy(),ve=new Map;function Se(k){const X=document.createElement("span");return X.className="policy-card__badge",X.textContent=k,X}function Re(k){const X=document.createElement("article");X.className="policy-card",X.style.setProperty("--policy-gradient",k.visuals.gradient),X.style.setProperty("--policy-accent",k.visuals.accentColor);const re=document.createElement("div");re.className="policy-card__header";const de=document.createElement("div");de.className="policy-card__icon-frame";const Ne=document.createElement("img");Ne.className="policy-card__icon",Ne.src=k.visuals.icon,Ne.alt=`${k.name} icon`,de.appendChild(Ne);const Ye=document.createElement("div");Ye.className="policy-card__heading";const _e=document.createElement("h4");if(_e.className="policy-card__title",_e.textContent=k.name,Ye.appendChild(_e),k.visuals.badges?.length){const $n=document.createElement("div");$n.className="policy-card__badges",k.visuals.badges.forEach(Zl=>$n.appendChild(Se(Zl))),Ye.appendChild($n)}const et=document.createElement("span");et.className="policy-card__state",et.textContent="Ready",re.append(de,Ye,et);const nn=document.createElement("p");nn.className="policy-card__description",nn.textContent=k.description;const Mt=k.visuals.flair?(()=>{const $n=document.createElement("p");return $n.className="policy-card__flair",$n.textContent=k.visuals.flair??"",$n})():null,an=document.createElement("div");an.className="policy-card__actions";const sn=document.createElement("span");sn.className="policy-card__cost";const Ui=document.createElement("span");Ui.className="policy-card__cost-label",Ui.textContent="Cost";const pt=document.createElement("span");pt.className="policy-card__cost-value",pt.textContent=`${Ff.format(k.cost)} ${_n[k.resource]}`,sn.append(Ui,pt);const tt=document.createElement("button");tt.type="button",tt.className="policy-card__action",tt.textContent="Enact Policy";const Ja=document.createElement("p");Ja.className="policy-card__status";const Wa=document.createElement("ul");Wa.className="policy-card__requirements",Wa.hidden=!0,an.append(sn,tt);const Ma=()=>{n.applyPolicy(k.id)&&ht(k)};return tt.addEventListener("click",Ma),R.push(()=>tt.removeEventListener("click",Ma)),X.append(re,nn),Mt&&X.appendChild(Mt),X.append(an,Ja,Wa),ve.set(k.id,{card:X,action:tt,stateBadge:et,statusCopy:Ja,requirements:Wa,costChip:sn}),X}function Et(){da.innerHTML="",ve.clear();const k=document.createElement("div");k.className="policy-grid",ce.forEach(X=>{const re=Re(X);k.appendChild(re)}),da.appendChild(k),Tt()}function ht(k){const X=ve.get(k.id);if(!X)return;const re=n.hasPolicy(k.id),de=k.prerequisites.filter(Mt=>!Mt.isSatisfied(n)),Ne=n.canAfford(k.cost,k.resource);X.action.disabled=re||de.length>0||!Ne,X.action.textContent=re?"Enacted":"Enact Policy";let Ye="ready",_e="Ready",et=k.spotlight??"All signals point to go.";X.requirements.innerHTML="",X.requirements.hidden=!0,re?(Ye="applied",_e="Enacted",et=k.visuals.flair??"Policy active."):de.length>0?(Ye="locked",_e="Locked",et="Awaiting requirements:",X.requirements.hidden=!1,de.forEach(Mt=>{const an=document.createElement("li");an.textContent=Mt.description,X.requirements.appendChild(an)})):Ne||(Ye="budget",_e="Needs Resources",et=`Earn ${Ff.format(k.cost)} ${_n[k.resource]} to enact this edict.`),X.card.dataset.status=Ye,X.stateBadge.textContent=_e,X.statusCopy.textContent=et;const nn=!re&&de.length===0&&!Ne;X.costChip.classList.toggle("policy-card__cost--warning",nn)}function Tt(){ce.forEach(k=>ht(k))}Et();const ha=k=>Tt(),ma=k=>Tt(),pa=k=>Tt();te.on("resourceChanged",ha),te.on(It.APPLIED,ma),te.on(It.REJECTED,pa),R.push(()=>{te.off("resourceChanged",ha),te.off(It.APPLIED,ma),te.off(It.REJECTED,pa)});function ga(k,X){const re=document.createElement("button");re.type="button",re.classList.add("event-card__choice"),X.accent&&re.classList.add(`event-card__choice--${X.accent}`),re.dataset.choiceId=X.id;const de=document.createElement("span");if(de.className="event-card__choice-label",de.textContent=X.label,re.appendChild(de),X.description){const Ne=document.createElement("span");Ne.className="event-card__choice-detail",Ne.textContent=X.description,re.appendChild(Ne)}return re.addEventListener("click",()=>{if(!re.isConnected)return;re.disabled=!0,Nc.resolve(k.id,X.id)||(re.disabled=!1)}),re}function ya(k){if(An.innerHTML="",k.length===0){const re=document.createElement("div");re.className="event-card event-card--empty";const de=document.createElement("p");de.className="event-card__empty",de.textContent="All clear. Command will notify you when new briefings arrive.",re.appendChild(de),An.appendChild(re);return}const X=document.createDocumentFragment();for(const re of k){const de=document.createElement("article");de.className="event-card",de.dataset.eventId=re.id,de.style.setProperty("--event-accent",re.accentColor??"var(--color-accent)");const Ne=(re.typography??"sans").toLowerCase();de.classList.add(`event-card--${["serif","mono"].includes(Ne)?Ne:"sans"}`);const Ye=(re.animation??"").toLowerCase();["aurora","pulse","tilt"].includes(Ye)&&de.classList.add(`event-card--${Ye}`);const _e=document.createElement("div");if(_e.className="event-card__frame",re.art){const tt=document.createElement("div");tt.className="event-card__media",tt.style.backgroundImage=`url(${re.art})`,_e.appendChild(tt)}const et=document.createElement("div");et.className="event-card__body";const nn=document.createElement("span");nn.className="event-card__badge",nn.textContent="Priority Dispatch",et.appendChild(nn);const Mt=document.createElement("h4");Mt.className="event-card__headline",Mt.textContent=re.headline,et.appendChild(Mt);const an=document.createElement("p");an.className="event-card__copy",an.textContent=re.body,et.appendChild(an);const sn=document.createElement("div");sn.className="event-card__choices";const Ui=re.choices&&re.choices.length>0?re.choices:[{id:"acknowledge",label:re.acknowledgeText??"Acknowledge"}];for(const tt of Ui){const Ja=ga(re,{id:tt.id,label:tt.label,description:tt.description,event:tt.event,payload:tt.payload,accent:tt.accent});sn.appendChild(Ja)}et.appendChild(sn),_e.appendChild(et);const pt=document.createElement("span");pt.className="event-card__shimmer",de.append(_e,pt),X.appendChild(de)}An.appendChild(X)}const Yl=Nc.subscribe(ya);R.push(Yl);const Fl=({event:k})=>{qt({type:"event",message:`Event • ${k.headline}`,metadata:{eventId:k?.id??k.headline,headline:k.headline}})};te.on(zc.TRIGGERED,Fl),R.push(()=>{te.off(zc.TRIGGERED,Fl)});function Yn(k){Nc.publish(k)}const Je=new Map,mt=new Map,ba=new Map,Qa=new Set(Yx().mutedTypes??[]),Rn=new Set;for(const k of Z2)Qa.has(k)||Rn.add(k),mt.set(k,0);let fs=0,Ni=!0;const ki=typeof requestAnimationFrame=="function"?requestAnimationFrame:k=>setTimeout(k,16),hs=k=>Ff.format(Math.max(0,k)),va=()=>{const k=fs===1?"entry":"entries";In.textContent=`${hs(fs)} ${k}`},Pa=k=>{const X=ba.get(k);X&&(X.textContent=hs(mt.get(k)??0))},Sa=(k,X)=>{if(X===0)return;const re=mt.get(k)??0;mt.set(k,Math.max(0,re+X)),fs=Math.max(0,fs+X),Pa(k),va()},Ea=()=>Ue.scrollHeight-(Ue.scrollTop+Ue.clientHeight)<48,We=()=>{ki(()=>{Ue.scrollTop=Ue.scrollHeight,Ni=!0})},ms=k=>{const X=Rn.has(k.type);k.element.hidden=!X,k.element.classList.toggle("panel-log-entry--muted",!X)},$l=k=>{const X=k.metadata??{};return(Array.isArray(X.unitNames)?X.unitNames:typeof X.unitName=="string"?[X.unitName]:[]).map(de=>typeof de=="string"?de.trim():"").filter(de=>de.length>0)},Fn=(k,X)=>{if(X.type!=="spawn"){k.replaceChildren(),k.hidden=!0;return}const re=$l(X),de=re.map(Ye=>{const _e=document.createElement("span");return _e.className="panel-log-entry__token",_e.textContent=Ye,_e}),Ne=X.occurrences-re.length;if(Ne>0){const Ye=document.createElement("span");Ye.className="panel-log-entry__token panel-log-entry__token--more",Ye.textContent=`+${Ne}`,de.push(Ye)}de.length===0?(k.replaceChildren(),k.hidden=!0):(k.replaceChildren(...de),k.hidden=!1)},Za=k=>{const X=document.createElement("article");X.className="panel-log-entry",X.dataset.logType=k.type,X.style.setProperty("--log-entry-accent",_l[k.type]?.accent??"var(--color-accent)");const re=document.createElement("div");re.className="panel-log-entry__header";const de=document.createElement("span");de.className="panel-log-entry__type",de.textContent=_l[k.type]?.label??k.type;const Ne=document.createElement("span");Ne.className="panel-log-entry__badge";const Ye=document.createElement("p");Ye.className="panel-log-entry__message",Ye.textContent=k.message;const _e=document.createElement("div");_e.className="panel-log-entry__tokens",_e.hidden=!0,re.append(de,Ne),X.append(re,Ye,_e);const et=Mt=>{Mt<=1?(Ne.textContent="",Ne.hidden=!0):(Ne.hidden=!1,Ne.textContent=`×${Mt}`)},nn={element:X,type:k.type,occurrences:k.occurrences,badge:Ne,message:Ye,tokens:_e,setBadge:et};return et(k.occurrences),Fn(_e,k),nn},Vl=(k,X=!1)=>{const re=X?!0:Ea()||Ni,de=Za(k);Je.set(k.id,de),Ue.appendChild(de.element),Sa(de.type,de.occurrences),ms(de),re&&We()},Xl=k=>{const X=Je.get(k.id);if(!X)return;const re=k.occurrences-X.occurrences;re!==0&&(X.occurrences=k.occurrences,Sa(X.type,re)),X.message.textContent=k.message,X.setBadge(k.occurrences),X.tokens&&Fn(X.tokens,k),ms(X),Ni&&We()},Kl=k=>{const X=Je.get(k.id);X&&(Je.delete(k.id),Sa(X.type,-X.occurrences),X.element.parentElement===Ue&&Ue.removeChild(X.element))},Ql=()=>{for(const k of Je.values())ms(k)};for(const k of Z2){const X=_l[k],re=document.createElement("button");re.type="button",re.className="log-chip",re.dataset.logFilter=k,re.style.setProperty("--log-chip-accent",X?.accent??"var(--color-accent)"),re.setAttribute("aria-pressed",Rn.has(k)?"true":"false"),re.setAttribute("aria-label",`${X?.label??k} log filter`);const de=document.createElement("span");de.className="log-chip__label",de.textContent=X?.label??k;const Ne=document.createElement("span");Ne.className="log-chip__count",Ne.textContent="0",ba.set(k,Ne),Rn.has(k)||re.classList.add("is-muted"),re.append(de,Ne),Tn.appendChild(re),re.addEventListener("click",()=>{Rn.has(k)?(Rn.delete(k),Qa.add(k)):(Rn.add(k),Qa.delete(k)),re.classList.toggle("is-muted",!Rn.has(k)),re.setAttribute("aria-pressed",Rn.has(k)?"true":"false"),Fx({mutedTypes:Array.from(Qa)}),Ql()})}va();const Di=()=>{Ni=Ea()};Ue.addEventListener("scroll",Di,{passive:!0}),R.push(()=>Ue.removeEventListener("scroll",Di));const Li=Ix();if(Li.length>0){for(const k of Li)Vl(k,!0);We()}const Nn=Gx(k=>{if(k.kind==="append")Vl(k.entry);else if(k.kind==="update")Xl(k.entry);else if(k.kind==="remove")for(const X of k.entries)Kl(X)});return R.push(Nn),Ql(),ds("Roster"),{log:k=>{qt(k)},addEvent:Yn,renderRoster:fa,dispose:()=>{for(const k of R.splice(0))try{k()}catch(X){console.warn("Failed to dispose HUD listener",X)}fe(),Ae(),document.body.classList.remove(N),b.remove(),_.remove(),g.remove()}}}const Vx=n=>`[data-tutorial-target="${n}"]`,Zn=16,vc=12,J2="is-tutorial-highlighted",Xx=[{id:"heat",target:"heat",title:"Heat the Sauna",description:"Keep the sauna fires roaring. This control shows when the next warrior emerges from the steam."},{id:"upkeep",target:"upkeep",title:"Mind Your Upkeep",description:"Every attendant draws upkeep. Track totals and see a featured roster member to balance your economy."},{id:"sisu",target:"sisu",title:"Stockpile SISU",description:"SISU fuels heroic bursts. Watch this meter to know when your grit reserves can power signature moves."},{id:"combat",target:"combat",title:"Command the Fight",description:"Trigger a Sisu Burst to supercharge allied attacks or rally everyone home with a Torille call."},{id:"victory",target:"victory",title:"Claim Victory",description:"Saunakunnia measures renown. Push it ever higher to unlock triumphs and close the campaign in glory."}];function Kx(n,a,s){return Math.max(a,Math.min(s,n))}function Qx(n={}){const a=n.steps??Xx;if(a.length===0)throw new Error("Tutorial requires at least one step.");let s=-1,r=null,o=!1;const u=document.createElement("div");u.className="tutorial-overlay";const f=document.createElement("div");f.className="tutorial-overlay__spotlight",f.setAttribute("aria-hidden","true");const h=document.createElement("section");h.className="tutorial-card",h.setAttribute("role","dialog"),h.setAttribute("aria-modal","false"),h.tabIndex=-1;const m=document.createElement("header");m.className="tutorial-card__header";const p=document.createElement("h2");p.className="tutorial-card__title";const g=document.createElement("button");g.type="button",g.className="tutorial-card__close",g.setAttribute("aria-label","Dismiss tutorial"),g.textContent="×",m.append(p,g);const b=document.createElement("p");b.className="tutorial-card__description";const S=document.createElement("p");S.className="tutorial-card__progress";const E=document.createElement("div");E.className="tutorial-card__controls";const w=document.createElement("button");w.type="button",w.className="tutorial-card__button tutorial-card__button--secondary",w.textContent="Back";const R=document.createElement("button");R.type="button",R.className="tutorial-card__button",R.textContent="Next";const _=document.createElement("button");_.type="button",_.className="tutorial-card__skip",_.textContent="Skip tutorial",E.append(w,R),h.append(m,b,S,E,_),u.append(f,h);const U=typeof ResizeObserver<"u"?new ResizeObserver(()=>{s>=0&&se()}):null,B=()=>{s>=0&&se()};function G(){o||(document.body.appendChild(u),window.addEventListener("resize",se),document.addEventListener("scroll",B,!0),U?.observe(h),o=!0)}function F(){o&&(window.removeEventListener("resize",se),document.removeEventListener("scroll",B,!0),U?.disconnect(),u.remove(),o=!1)}function P(H){if(r&&r!==H&&(r.classList.remove(J2),r.removeAttribute("data-tutorial-highlight")),r=H,!H){f.style.opacity="0";return}H.classList.add(J2),H.setAttribute("data-tutorial-highlight","true"),f.style.opacity="1"}function ie(){if(!r)return null;const H=r.getBoundingClientRect();return H.width===0&&H.height===0?null:{top:H.top,left:H.left,width:H.width,height:H.height}}function se(){const H=ie();if(!H){h.style.top=`${Zn}px`,h.style.left=`${Zn}px`,h.classList.add("tutorial-card--floating"),f.style.opacity="0";return}h.classList.remove("tutorial-card--floating"),f.style.opacity="1";const T=H.top-vc,I=H.left-vc,J=H.width+vc*2,fe=H.height+vc*2;f.style.top=`${T}px`,f.style.left=`${I}px`,f.style.width=`${J}px`,f.style.height=`${fe}px`;const M=h.getBoundingClientRect();let ee=window.innerHeight-H.top-H.height>=H.top?H.top+H.height+Zn:H.top-M.height-Zn;ee<Zn?ee=Zn:ee+M.height>window.innerHeight-Zn&&(ee=window.innerHeight-Zn-M.height);let oe=H.left+H.width/2-M.width/2;oe=Kx(oe,Zn,window.innerWidth-M.width-Zn),h.style.top=`${Math.round(ee)}px`,h.style.left=`${Math.round(oe)}px`}function le(){requestAnimationFrame(()=>{h.focus({preventScroll:!0})})}function ne(H){if(H<0||H>=a.length)return;G(),s=H;const T=a[H];p.textContent=T.title,b.textContent=T.description,S.textContent=`Step ${H+1} of ${a.length}`,w.disabled=H===0,R.textContent=H===a.length-1?"Finish":"Next";const I=document.querySelector(Vx(T.target));P(I??null),se(),le()}function Y(){if(s===-1){ne(0);return}if(s>=a.length-1){$();return}ne(s+1)}function N(){s<=0||ne(s-1)}function L(){P(null),F(),s=-1}function A(){n.onSkip?.(),L()}function $(){n.onComplete?.(),L()}return w.addEventListener("click",()=>{N()}),R.addEventListener("click",()=>{Y()}),_.addEventListener("click",()=>{A()}),g.addEventListener("click",()=>{A()}),h.addEventListener("keydown",H=>{H.defaultPrevented||(H.key==="ArrowRight"?(H.preventDefault(),Y()):H.key==="ArrowLeft"?(H.preventDefault(),N()):H.key==="Escape"&&(H.preventDefault(),A()))}),{start(){s===-1&&ne(0)},next:Y,previous:N,skip:A,finish:$,destroy(){L()}}}const Px=Math.sqrt(3),Zx=2;function Vc(n){return{width:n*Px,height:n*Zx}}const ja=16,Sc=2;function Jx(){return typeof window<"u"&&window.devicePixelRatio||1}function Wx(n,a){const s=Math.max(n.qMin,a.minQ),r=Math.min(n.qMax,a.maxQ),o=Math.max(n.rMin,a.minR),u=Math.min(n.rMax,a.maxR);return s>r||o>u?null:{qMin:s,qMax:r,rMin:o,rMax:u}}function ew(n,a){const s=Jx(),r=a.width/(s*n.zoom),o=a.height/(s*n.zoom);return{x:n.x-r/2,y:n.y-o/2,width:r,height:o}}function tw(n,a){const s=[El(n.x,n.y,a),El(n.x+n.width,n.y,a),El(n.x,n.y+n.height,a),El(n.x+n.width,n.y+n.height,a)];let r=1/0,o=-1/0,u=1/0,f=-1/0;for(const h of s)r=Math.min(r,h.q),o=Math.max(o,h.q),u=Math.min(u,h.r),f=Math.max(f,h.r);return{qMin:Math.floor(r)-Sc,qMax:Math.ceil(o)+Sc,rMin:Math.floor(u)-Sc,rMax:Math.ceil(f)+Sc}}function nw(n,a,s,r){if(!s||typeof s.width!="number"||typeof s.height!="number")return{qMin:n.minQ,qMax:n.maxQ,rMin:n.minR,rMax:n.maxR};if(s.width===0||s.height===0)return{qMin:n.minQ,qMax:n.maxQ,rMin:n.minR,rMax:n.maxR};const o=ew(a,s);return Wx(tw(o,r),n)}function Js(n){return Math.floor(n/ja)}function Gb(n){return`${n.q},${n.r}`}function aw(n,a){return Gb({q:Js(n),r:Js(a)})}function iw(n){return{qMin:Js(n.qMin),qMax:Js(n.qMax),rMin:Js(n.rMin),rMax:Js(n.rMax)}}function Ib(n){const a=[];for(let s=n.rMin;s<=n.rMax;s++)for(let r=n.qMin;r<=n.qMax;r++)a.push({q:r,r:s});return a}function sw(n,a){const s=a.q*ja,r=a.r*ja,o=s+ja-1,u=r+ja-1,f=Math.max(s,n.minQ),h=Math.min(o,n.maxQ),m=Math.max(r,n.minR),p=Math.min(u,n.maxR);if(!(f>h||m>p))for(let g=m;g<=p;g++)for(let b=f;b<=h;b++)n.ensureTile(b,g)}function rw(n,a){for(const s of Ib(a))sw(n,s)}const lw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3ePlains%20Tile%3c/title%3e%3cdesc%20id='desc'%3eRolling%20plains%20with%20sunrise%20gradients%20and%20glowing%20grasses.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='plains-bg'%20cx='50%25'%20cy='50%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='plains-field'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='0%25'%3e%3cstop%20offset='0%25'%20stop-color='%23facc15'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23eab308'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='plains-haze'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f59e0b'%20stop-opacity='0.2'%20/%3e%3c/linearGradient%3e%3cfilter%20id='plains-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='5'%20stdDeviation='6'%20flood-color='%23facc15'%20flood-opacity='0.35'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23plains-bg)'%20/%3e%3cg%20filter='url(%23plains-glow)'%3e%3cpath%20d='M16%2088c20-18%2036-22%2048-22s28%204%2048%2022'%20fill='url(%23plains-field)'%20stroke='%23fef9c3'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M24%20102c16-14%2032-18%2040-18s24%204%2040%2018'%20fill='none'%20stroke='%23fde68a'%20stroke-width='5'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M32%2070c12-10%2024-14%2032-14s20%204%2032%2014'%20fill='url(%23plains-haze)'%20opacity='0.7'%20/%3e%3cpath%20d='M52%2078l4%2012m8-12l4%2012m8-12l4%2012'%20stroke='%23fef3c7'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='36'%20r='8'%20fill='%23fef08a'%20opacity='0.7'%20/%3e%3c/svg%3e",ow="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eForest%20Tile%3c/title%3e%3cdesc%20id='desc'%3eStylised%20evergreen%20trees%20glowing%20against%20a%20deep%20night%20backdrop.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='forest-bg'%20cx='50%25'%20cy='40%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230b1120'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='forest-leaf'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%234ade80'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2315803d'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='forest-trunk'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23a855f7'%20/%3e%3cstop%20offset='100%25'%20stop-color='%237c3aed'%20/%3e%3c/linearGradient%3e%3cfilter%20id='forest-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%234ade80'%20flood-opacity='0.25'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23forest-bg)'%20/%3e%3cg%20filter='url(%23forest-glow)'%20stroke='%23bbf7d0'%20stroke-width='2'%3e%3cpath%20fill='url(%23forest-leaf)'%20d='M64%2026L32%2080h18l-12%2022h28l-10-22h16l-10%2022h28l-12-22h18z'%20/%3e%3crect%20x='58'%20y='74'%20width='12'%20height='18'%20rx='3'%20fill='url(%23forest-trunk)'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20stroke-opacity='0.5'%20d='M44%2086c6-4%2012-6%2020-6s14%202%2020%206'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='40'%20r='6'%20fill='%23fef3c7'%20opacity='0.6'%20/%3e%3ccircle%20cx='88'%20cy='32'%20r='4'%20fill='%23fef3c7'%20opacity='0.4'%20/%3e%3c/svg%3e",cw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eMountain%20Tile%3c/title%3e%3cdesc%20id='desc'%3eJagged%20alpine%20peaks%20with%20luminous%20snowcaps.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='mountain-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%23111827'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='mountain-rock'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2364748b'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23334155'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mountain-snow'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23cbd5f5'%20/%3e%3c/linearGradient%3e%3cfilter%20id='mountain-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%23f8fafc'%20flood-opacity='0.2'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23mountain-bg)'%20/%3e%3cg%20filter='url(%23mountain-glow)'%20stroke='%23cbd5f5'%20stroke-width='2'%20stroke-linejoin='round'%3e%3cpath%20fill='url(%23mountain-rock)'%20d='M24%20100l32-52%2014%2022%2012-18%2022%2048z'%20/%3e%3cpath%20fill='url(%23mountain-snow)'%20d='M56%2048l14%2022%2012-18%2010%2022H48z'%20opacity='0.85'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20opacity='0.6'%20d='M32%2094c10-6%2020-9%2032-9s22%203%2032%209'%20/%3e%3c/g%3e%3ccircle%20cx='92'%20cy='32'%20r='6'%20fill='%23f1f5f9'%20opacity='0.5'%20/%3e%3c/svg%3e",uw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eWater%20Tile%3c/title%3e%3cdesc%20id='desc'%3eGlowing%20waves%20surrounding%20a%20crystalline%20droplet.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='water-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230b1120'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='water-wave'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='water-drop'%20x1='50%25'%20y1='0%25'%20x2='50%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230284c7'%20/%3e%3c/linearGradient%3e%3cfilter%20id='water-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='8'%20flood-color='%2338bdf8'%20flood-opacity='0.3'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23water-bg)'%20/%3e%3cg%20filter='url(%23water-glow)'%3e%3cpath%20d='M32%2076c12-10%2024-15%2032-15s20%205%2032%2015'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3cpath%20d='M28%2092c14-12%2030-18%2040-18s26%206%2040%2018'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='6'%20stroke-linecap='round'%20opacity='0.7'%20/%3e%3cpath%20d='M40%2060c10-8%2018-12%2024-12s14%204%2024%2012'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M64%2030c-12%2020-18%2032-18%2042%200%2011%208%2020%2018%2020s18-9%2018-20c0-10-6-22-18-42z'%20fill='url(%23water-drop)'%20stroke='%23e0f2fe'%20stroke-width='2'%20/%3e%3c/g%3e%3ccircle%20cx='94'%20cy='34'%20r='6'%20fill='%23f8fafc'%20opacity='0.45'%20/%3e%3c/svg%3e",dw=.01;function Yb(n){return!Number.isFinite(n)||n<=dw?1:n}function fw(n,a){return n/Yb(a)}function ta(n,a){const s=Yb(a);return Math.round(n*s)/s}const W2={[xn.Plains]:{baseColor:"#d8b869",icon:lw},[xn.Forest]:{baseColor:"#237a55",icon:ow},[xn.Hills]:{baseColor:"#b57c57",icon:cw},[xn.Lake]:{baseColor:"#3185d5",icon:uw}},hw=[255,255,255],sm=[12,18,28],mw=[0,0,0],ey="rgba(56, 189, 248, 0.85)",ty="rgba(56, 189, 248, 0.45)";let pl=null,gl=null;const pw=n=>Math.min(1,Math.max(0,n));function gw(n){let a=n.trim().replace("#","");a.length===3&&(a=a.split("").map(r=>r+r).join(""));const s=Number.parseInt(a,16);return[s>>16&255,s>>8&255,s&255]}function Xc(n,a,s){const r=pw(s);return[Math.round(n[0]+(a[0]-n[0])*r),Math.round(n[1]+(a[1]-n[1])*r),Math.round(n[2]+(a[2]-n[2])*r)]}function ny(n){return`rgb(${n[0]}, ${n[1]}, ${n[2]})`}function Kc(n,a=1){return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${a})`}function Qc(n,a=1){return Kc(Xc(sm,hw,n),a)}function ir(n,a=1){return Kc(Xc(sm,mw,n),a)}const yw={terrain:.05,hover:.065,selection:.085},bw={terrain:1,hover:1.35,selection:2.1};function Pc(n,a,s="terrain"){const r=n*yw[s],o=fw(r,a);return Math.max(bw[s],o)}function vw(){if(pl&&gl)return{stroke:pl,glow:gl};if(typeof window<"u"){const n=getComputedStyle(document.documentElement),a=n.getPropertyValue("--tile-highlight-ring").trim(),s=n.getPropertyValue("--tile-highlight-glow").trim();pl=a||ey,gl=s||ty}else pl=ey,gl=ty;return{stroke:pl,glow:gl}}function Fb(n){return Math.min(1,Math.max(0,n))}function du(n){let a=n.trim();if(a.startsWith("#")&&(a=a.slice(1)),a.length===3){const s=Number.parseInt(a[0]+a[0],16),r=Number.parseInt(a[1]+a[1],16),o=Number.parseInt(a[2]+a[2],16);return[s,r,o]}if(a.length===6){const s=Number.parseInt(a,16),r=s>>16&255,o=s>>8&255,u=s&255;return[r,o,u]}return[0,0,0]}function Sw(n,a,s){const r=Fb(s),o=(u,f)=>Math.round(u+(f-u)*r);return[o(n[0],a[0]),o(n[1],a[1]),o(n[2],a[2])]}function Ew([n,a,s],r){return`rgba(${n}, ${a}, ${s}, ${Fb(r)})`}function _i(n,a,s,r){return Ew(Sw(n,a,s),r)}function Mw(n){const{ctx:a,x:s,y:r,width:o,height:u,radius:f,baseColor:h}=n,m=du(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=_i(m,[255,255,255],.35,.24);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.06);const g=3,b=6,S=s+o*.12,E=s+o*.88;for(let U=0;U<g;U++){const B=U/Math.max(1,g-1),G=r+u*.28+B*u*.32,F=f*(.18-B*.05);a.beginPath();for(let P=0;P<=b;P++){const ie=P/b,se=S+(E-S)*ie,le=Math.sin(ie*Math.PI*1.6+U*.8)*F,ne=G-Math.abs(le)*.55;P===0?a.moveTo(se,ne):a.lineTo(se,ne)}a.stroke()}const w=_i(m,[18,54,32],.4,.2);a.strokeStyle=w,a.lineWidth=Math.max(.75,f*.035);const R=5,_=f*.22;for(let U=0;U<R;U++){const B=s+o*(.2+U/Math.max(1,R-1)*.6),G=r+u*.55-Math.cos(U*.9)*f*.08;a.beginPath(),a.arc(B,G,_,Math.PI*.2,Math.PI*.85),a.stroke(),a.beginPath(),a.arc(B+_*.35,G-_*.1,_*.55,Math.PI*.15,Math.PI*.95),a.stroke()}a.restore()}function xw(n){const{ctx:a,centerX:s,centerY:r,radius:o,baseColor:u}=n,f=du(u);a.save(),a.lineCap="round";const h=_i(f,[255,235,214],.45,.22);a.strokeStyle=h,a.lineWidth=Math.max(1,o*.05);const m=4;for(let b=0;b<m;b++){const S=b/Math.max(1,m-1),E=o*(1.25-S*.45),w=o*(.72-S*.18),R=r+o*.18*(S-.5);a.beginPath(),a.ellipse(s,R,E,w,0,Math.PI*.12,Math.PI*.88),a.stroke()}const p=_i(f,[60,36,20],.35,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,o*.032),a.setLineDash([o*.22,o*.18]);const g=3;for(let b=0;b<g;b++){const S=o*(.75-b*.1),E=r+o*.28+b*o*.08;a.beginPath(),a.arc(s+o*.08,E,S,Math.PI*.28,Math.PI*.76),a.stroke()}a.setLineDash([]),a.restore()}function ww(n){const{ctx:a,x:s,y:r,width:o,height:u,radius:f,baseColor:h}=n,m=du(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=_i(m,[255,255,255],.55,.28);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.045);const g=4,b=7,S=s+o*.12,E=s+o*.88,w=f*.16;for(let U=0;U<g;U++){const B=U/Math.max(1,g-1),G=r+u*.3+B*u*.4;a.beginPath();for(let F=0;F<=b;F++){const P=F/b,ie=S+(E-S)*P,se=Math.sin(P*Math.PI*2+U*.6)*w*(.75-B*.2),le=G+se;F===0?a.moveTo(ie,le):a.lineTo(ie,le)}a.stroke()}const R=_i(m,[12,52,94],.4,.2);a.strokeStyle=R,a.lineWidth=Math.max(.8,f*.03);const _=3;for(let U=0;U<_;U++){const B=U/Math.max(1,_-1),G=r+u*.35+B*u*.35;a.beginPath();for(let F=0;F<=b;F++){const P=F/b,ie=S+(E-S)*P,se=Math.sin(P*Math.PI*2+U)*w*.35,le=G+se;F===0?a.moveTo(ie,le):a.lineTo(ie,le)}a.stroke()}a.restore()}function $b(n){const{ctx:a,x:s,y:r,width:o,height:u,radius:f,baseColor:h}=n,m=du(h);a.save(),a.lineCap="round";const p=_i(m,[255,255,255],.42,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,f*.03);const g=f*.55;for(let E=-1;E<=2;E++){const w=g*E;a.beginPath(),a.moveTo(s+w,r+u*.25),a.lineTo(s+w+o*.75,r+u*.85),a.stroke()}const b=_i(m,[112,82,32],.3,.16);a.strokeStyle=b,a.lineWidth=Math.max(.7,f*.025),a.setLineDash([f*.24,f*.34]);const S=f*.48;for(let E=0;E<3;E++){const w=S*E;a.beginPath(),a.moveTo(s+o*.18+w,r+u*.78),a.lineTo(s+o*.7+w,r+u*.38),a.stroke()}a.setLineDash([]),a.restore()}const ay=new Map;let Zi=null;function Aw(){if(Zi)return Zi;const n="/";if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(n))return Zi=n,Zi;const s=n.startsWith("/")?n:`/${n}`;return typeof window<"u"&&typeof window.location?.origin=="string"?Zi=`${window.location.origin}${s}`:Zi=`http://localhost${s}`,Zi}function Cw(n){let a=ay.get(n);if(!a){a=new Image,a.decoding="async";const s=new URL(n,Aw()).href;a.src=s,ay.set(n,a)}if(a.complete&&a.naturalWidth>0&&a.naturalHeight>0)return a}const Tw={[xn.Plains]:$b,[xn.Forest]:Mw,[xn.Hills]:xw,[xn.Lake]:ww};function Vb(n,a,s,r){n.beginPath();for(let o=0;o<6;o++){const u=Math.PI/180*(60*o-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);o===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function _w(n,a,s,r){Vb(n,a,s,r),n.save(),n.lineJoin="round",n.lineCap="round",n.lineWidth=Pc(r,1,"terrain"),n.strokeStyle=Qc(.16,.6),n.stroke(),n.restore()}function Rw(n,a,s,r,o,u,f,h){const m=W2[a.terrain]??W2[xn.Plains],p=gw(m.baseColor),g=r+u/2,b=o+f/2;n.save(),Vb(n,g,b,h),n.clip();const S=n.createRadialGradient(g,b,h*.2,g,b,h*1.05);S.addColorStop(0,ny(Xc(p,[255,255,255],.3))),S.addColorStop(.7,m.baseColor),S.addColorStop(1,ny(Xc(p,sm,.4))),n.fillStyle=S,n.shadowColor=Kc(p,.35),n.shadowBlur=h*.9,n.shadowOffsetX=0,n.shadowOffsetY=0,n.fillRect(r-h*.1,o-h*.1,u+h*.2,f+h*.2);const E={ctx:n,x:r,y:o,width:u,height:f,radius:h,centerX:g,centerY:b,baseColor:m.baseColor};(Tw[a.terrain]??$b)(E),n.globalCompositeOperation="lighter";const R=n.createRadialGradient(g,b,h*.85,g,b,h*1.18);R.addColorStop(0,"rgba(255, 255, 255, 0)"),R.addColorStop(1,Kc(p,.18)),n.fillStyle=R,n.fillRect(r-h*.1,o-h*.1,u+h*.2,f+h*.2),n.globalCompositeOperation="source-over",n.restore();const _=Cw(m.icon);if(_){const U=Math.min(u,f)*.62,B=g-U/2,G=b-U/2;n.save(),n.globalAlpha*=.92,n.drawImage(_,B,G,U,U),n.restore()}if(a.building){const U=s[`building-${a.building}`]??s.placeholder;n.drawImage(U,r,o,u,f)}}function Nw(n,a){const s=Math.max(n.q*ja,a.minQ),r=Math.min(s+ja-1,a.maxQ),o=Math.max(n.r*ja,a.minR),u=Math.min(o+ja-1,a.maxR);return{qStart:s,qEnd:r,rStart:o,rEnd:u}}class kw{constructor(a){this.map=a,this.unsubscribe=a.addTileChangeListener((s,r,o)=>{this.onTileChange(s,o)})}chunkCanvases=new Map;dirtyChunks=new Set;cachedImages;unsubscribe;dispose(){this.unsubscribe(),this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}invalidate(){this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}markChunkDirty(a){this.dirtyChunks.add(a)}markTileDirty(a,s){this.dirtyChunks.add(aw(a,s))}getRenderableChunks(a,s,r,o){this.refreshAssets(r);const u=[],{width:f,height:h}=Vc(s);for(const m of Ib(a)){const p=Gb(m),g=this.ensureChunk(p,m,s,f,h,r,o);g&&u.push(g)}return u}refreshAssets(a){if(this.cachedImages!==a){this.cachedImages=a;for(const s of this.chunkCanvases.keys())this.dirtyChunks.add(s)}}onTileChange(a,s){(s==="created"||s==="terrain"||s==="building"||s==="fog")&&this.markTileDirty(a.q,a.r)}ensureChunk(a,s,r,o,u,f,h){const m=this.chunkCanvases.get(a);if(!m||this.dirtyChunks.has(a)){const p=this.renderChunk(a,s,r,o,u,f,h,m);return this.dirtyChunks.delete(a),p?(this.chunkCanvases.set(a,p),p):(this.chunkCanvases.delete(a),null)}return m}renderChunk(a,s,r,o,u,f,h,m){if(typeof document>"u")return null;const{qStart:p,qEnd:g,rStart:b,rEnd:S}=Nw(s,this.map);if(p>g||b>S)return null;const E=o/2,w=u/2;let R=1/0,_=1/0,U=-1/0,B=-1/0;const G=[];for(let le=p;le<=g;le++)for(let ne=b;ne<=S;ne++){const Y=this.map.getTile(le,ne);if(!Y||Y.isFogged)continue;const{x:N,y:L}=aa({q:le,r:ne},r),A=N-h.x-E,$=L-h.y-w;R=Math.min(R,A),_=Math.min(_,$),U=Math.max(U,A+o),B=Math.max(B,$+u),G.push({tile:Y,x:A,y:$})}if(!Number.isFinite(R)||!Number.isFinite(_)||!Number.isFinite(U)||!Number.isFinite(B))return null;const F=Math.max(1,Math.ceil(U-R)),P=Math.max(1,Math.ceil(B-_));let ie=m?.canvas;(!ie||ie.width!==F||ie.height!==P)&&(ie=document.createElement("canvas"),ie.width=F,ie.height=P);const se=ie.getContext("2d");if(!se)throw new Error("Canvas 2D context not available for chunk rendering");se.setTransform(1,0,0,1,0,0),se.clearRect(0,0,F,P);for(const{tile:le,x:ne,y:Y}of G){const N=ne-R,L=Y-_;se.save(),Rw(se,le,f,N,L,o,u,r),_w(se,N+o/2,L+u/2,r),se.restore()}return{key:a,canvas:ie,origin:{x:R,y:_},width:F,height:P}}}const Dw=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],za=new Array(512);for(let n=0;n<512;n++)za[n]=Dw[n%256];const iy=new Map,sy=n=>n*n*n*(n*(n*6-15)+10),$f=(n,a,s)=>n+s*(a-n),Ec=(n,a,s)=>{switch(n&3){case 0:return a+s;case 1:return-a+s;case 2:return a-s;default:return-a-s}};function Lw(n,a){const s=Math.floor(n)&255,r=Math.floor(a)&255,o=n-Math.floor(n),u=a-Math.floor(a),f=za[za[s+1]+r+1],h=za[za[s]+r+1],m=za[za[s+1]+r],p=za[za[s]+r],g=sy(o),b=sy(u),S=$f(Ec(p,o,u),Ec(m,o-1,u),g),E=$f(Ec(h,o,u-1),Ec(f,o-1,u-1),g);return $f(S,E,b)}function Uw(n,a,s=4){let r=0,o=1,u=1,f=0;for(let h=0;h<s;h++)r+=Lw(n*o,a*o)*u,f+=u,u*=.5,o*=2;return f>0?r/f:0}function Ow(n){const a=Math.max(32,Math.min(512,Math.round(n))),s=a,r=iy.get(s);if(r)return r;if(typeof document>"u")return null;const o=document.createElement("canvas");o.width=a,o.height=a;const u=o.getContext("2d");if(!u)return null;const f=u.createImageData(a,a),h=a/48;let m=0;for(let p=0;p<a;p++)for(let g=0;g<a;g++){const b=Uw(g/h,p/h,5),S=Math.pow((b+1)/2,1.35),E=Math.round(S*255);f.data[m]=255,f.data[m+1]=255,f.data[m+2]=255,f.data[m+3]=E,m+=4}return u.putImageData(f,0,0),iy.set(s,o),o}function ry(n,a,s,r){n.beginPath();for(let o=0;o<6;o++){const u=Math.PI/180*(60*o-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);o===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function qw(n,a,s,r){const o=n.createRadialGradient(a,s,r*.08,a,s,r*1.12);return o.addColorStop(0,Qc(.4,.35)),o.addColorStop(.35,Qc(.2,.55)),o.addColorStop(.6,ir(.1,.78)),o.addColorStop(.82,ir(.2,.88)),o.addColorStop(1,ir(.35,.95)),o}function zw(n,a,s,r,o){if(r<=0)return;const u=Ow(r*2.2),f=r*2.5,h=a-f/2,m=s-f/2;n.save(),ry(n,a,s,r),n.clip();const p=qw(n,a,s,r);n.fillStyle=p,n.fillRect(h,m,f,f),u&&(n.save(),n.globalCompositeOperation="lighter",n.globalAlpha*=.32,n.drawImage(u,a-r,s-r,r*2,r*2),n.restore()),n.restore(),n.save(),ry(n,a,s,r*.99),n.lineJoin="round",n.lineCap="round",n.lineWidth=Pc(r,o,"hover"),n.strokeStyle=ir(.3,.88),n.shadowColor=ir(.45,.42),n.shadowBlur=Math.max(3,r*.45/Math.max(o,.1)),n.stroke(),n.restore()}class Bw{constructor(a){this.mapRef=a,this.terrainCache=new kw(a),this.cachedHexSize=a.hexSize}terrainCache;cachedHexSize;get hexSize(){return this.mapRef.hexSize}getOrigin(){return aa({q:this.mapRef.minQ,r:this.mapRef.minR},this.hexSize)}invalidateCache(){this.terrainCache.invalidate()}dispose(){this.terrainCache.dispose()}draw(a,s,r){this.ensureHexSize();const o=a.canvas??null,u=nw(this.mapRef,xe,o,this.hexSize);if(!u)return;const f=iw(u);rw(this.mapRef,f);const h=this.getOrigin(),m=this.terrainCache.getRenderableChunks(f,this.hexSize,s,h);this.drawChunks(a,m),this.drawFogLayer(a,h,u),r&&this.drawSelection(a,h,r)}drawToCanvas(a,s,r){const o=a.getContext("2d");if(!o)throw new Error("Canvas 2D context not available");this.draw(o,s,r)}ensureHexSize(){this.cachedHexSize!==this.hexSize&&(this.cachedHexSize=this.hexSize,this.terrainCache.invalidate())}drawChunks(a,s){if(s.length!==0)for(const r of s)a.drawImage(r.canvas,r.origin.x,r.origin.y)}drawSelection(a,s,r){const{width:o,height:u}=Vc(this.hexSize),{x:f,y:h}=aa(r,this.hexSize),m=f-s.x-o/2,p=h-s.y-u/2;this.strokeHex(a,m+o/2,p+u/2,this.hexSize,!0)}drawFogLayer(a,s,r){const{width:o,height:u}=Vc(this.hexSize),f=o/2,h=u/2;for(let m=r.rMin;m<=r.rMax;m++)for(let p=r.qMin;p<=r.qMax;p++){const g=this.mapRef.getTile(p,m);if(!g||!g.isFogged)continue;const{x:b,y:S}=aa({q:p,r:m},this.hexSize),E=b-s.x-f,w=S-s.y-h,R=this.hexSize,_=E+o/2,U=w+u/2;zw(a,_,U,R,xe.zoom)}}strokeHex(a,s,r,o,u=!1){const{stroke:f,glow:h}=vw();this.hexPath(a,s,r,o),a.save(),a.lineJoin="round",a.lineCap="round",u?(a.shadowColor=h,a.shadowBlur=Math.max(6,o*.65/Math.max(xe.zoom,.1)),a.lineWidth=Pc(o,xe.zoom,"selection"),a.strokeStyle=f,a.stroke()):(a.lineWidth=Pc(o,xe.zoom,"hover"),a.shadowColor=Qc(.1,.45),a.shadowBlur=Math.max(2,o*.4/Math.max(xe.zoom,.1)),a.strokeStyle=ir(.1,.72),a.stroke()),a.restore()}hexPath(a,s,r,o){a.beginPath();for(let u=0;u<6;u++){const f=Math.PI/180*(60*u-30),h=s+o*Math.cos(f),m=r+o*Math.sin(f);u===0?a.moveTo(h,m):a.lineTo(h,m)}a.closePath()}}const Mi={accent:"#38bdf8",accentSoft:"rgba(56, 189, 248, 0.2)",warm:"#fbbf24",surface:"rgba(15, 23, 42, 0.92)",border:"rgba(148, 163, 184, 0.34)",text:"#e2e8f0"};let xi=null;function Qs(n,a){const s=n.trim();return s.length>0?s:a}function Hw(){if(xi)return xi;if(typeof window>"u"||typeof document>"u")return xi=Mi,xi;try{const n=getComputedStyle(document.documentElement);return xi={accent:Qs(n.getPropertyValue("--color-accent"),Mi.accent),accentSoft:Qs(n.getPropertyValue("--color-accent-soft"),Mi.accentSoft),warm:Qs(n.getPropertyValue("--color-warning"),Mi.warm),surface:Qs(n.getPropertyValue("--color-surface-strong"),Mi.surface),border:Qs(n.getPropertyValue("--hud-border-strong"),Mi.border),text:Qs(n.getPropertyValue("--color-foreground"),Mi.text)},xi}catch(n){return console.warn("Failed to read sauna palette tokens from computed styles",n),xi=Mi,xi}}function jw(n,a){const s=Math.max(0,n.auraRadius),r=aa(n.pos,a),o=r.x+a,u=r.y+a;let f=a;if(s<=0)return a*1.6;for(const h of qy){const m=aa({q:n.pos.q+h.q*s,r:n.pos.r+h.r*s},a),p=m.x+a,g=m.y+a,b=Math.hypot(p-o,g-u);b>f&&(f=b)}return f+a*.65}function Gw(n,a,s,r,o,u){const f=Math.max(0,Math.min(u,Math.min(r,o)/2));n.moveTo(a+f,s),n.lineTo(a+r-f,s),n.quadraticCurveTo(a+r,s,a+r,s+f),n.lineTo(a+r,s+o-f),n.quadraticCurveTo(a+r,s+o,a+r-f,s+o),n.lineTo(a+f,s+o),n.quadraticCurveTo(a,s+o,a,s+o-f),n.lineTo(a,s+f),n.quadraticCurveTo(a,s,a+f,s),n.closePath()}function Iw(n,a,{origin:s,hexSize:r,timestamp:o}){if(!a)return;const u=Hw(),f=Number.isFinite(o)?o:typeof performance<"u"?performance.now():Date.now(),h=.5+.5*Math.sin(f*.0035),m=aa(a.pos,r),p=m.x-s.x+r,g=m.y-s.y+r,b=jw(a,r);n.save(),n.globalCompositeOperation="screen";const S=b+r*(.4+h*.3),E=Math.max(r*.6,b*.58),w=n.createRadialGradient(p,g,E,p,g,S);w.addColorStop(0,u.accentSoft),w.addColorStop(.55,`rgba(56, 189, 248, ${.18+h*.12})`),w.addColorStop(1,"rgba(2, 6, 23, 0)"),n.fillStyle=w,n.beginPath(),n.arc(p,g,S,0,Math.PI*2),n.fill(),n.restore(),n.save(),n.globalCompositeOperation="lighter",n.lineWidth=Math.max(r*.28,6),n.strokeStyle=`rgba(56, 189, 248, ${(.35+h*.2).toFixed(3)})`,n.shadowColor=`rgba(56, 189, 248, ${.45+h*.1})`,n.shadowBlur=r*(.9+h*.45),n.beginPath(),n.arc(p,g,b+r*.12,0,Math.PI*2),n.stroke(),n.restore();const R=r*.9;n.save(),n.beginPath(),n.arc(p,g,R,0,Math.PI*2),n.fillStyle=u.surface,n.globalAlpha*=.96,n.fill(),n.lineWidth=Math.max(1.5,r*.06),n.strokeStyle=u.border,n.shadowColor="rgba(8, 25, 53, 0.6)",n.shadowBlur=r*.45,n.stroke(),n.restore();const _=R*.78,U=Math.max(r*.22,5);n.save(),n.lineWidth=U,n.strokeStyle="rgba(148, 163, 184, 0.24)",n.beginPath(),n.arc(p,g,_,0,Math.PI*2),n.stroke(),n.restore();const B=a.playerSpawnCooldown>0?a.playerSpawnCooldown:1,F=1-Math.min(1,Math.max(0,a.playerSpawnTimer/B)),P=-Math.PI/2,ie=P+Math.PI*2*F;if(F>0){n.save(),n.lineWidth=U,n.lineCap="round";const V=n.createLinearGradient(p,g-_,p,g+_);V.addColorStop(0,u.accent),V.addColorStop(1,u.warm),n.strokeStyle=V,n.shadowColor=`rgba(56, 189, 248, ${.42+h*.18})`,n.shadowBlur=r*(.65+h*.35),n.beginPath(),n.arc(p,g,_,P,ie,!1),n.stroke(),n.restore()}const se=Math.max(0,a.playerSpawnTimer),le=Math.ceil(se);n.save(),n.font=`600 ${Math.max(12,r*.9)}px "Inter", "Manrope", "Segoe UI", sans-serif`,n.fillStyle=u.text,n.textAlign="center",n.textBaseline="middle",n.shadowColor="rgba(2, 6, 23, 0.6)",n.shadowBlur=r*.35,n.fillText(String(le),p,g),n.restore(),n.save(),n.font=`500 ${Math.max(10,r*.36)}px "Inter", "Manrope", "Segoe UI", sans-serif`,n.fillStyle="rgba(148, 163, 184, 0.78)",n.textAlign="center",n.textBaseline="top",n.fillText("sec",p,g+_*.45),n.restore();const ne="Sauna ♨️",Y=Math.max(12,r*.58);n.save(),n.font=`600 ${Y}px "Inter", "Manrope", "Segoe UI", sans-serif`;const N=n.measureText(ne),L=r*.58,A=r*.32,$=N.width+L*2,H=Y+A*2,T=p-$/2,I=g-b-H-r*.35,J=H/2;n.beginPath(),Gw(n,T,I,$,H,J);const fe=n.createLinearGradient(T,I,T,I+H);fe.addColorStop(0,"rgba(15, 23, 42, 0.94)"),fe.addColorStop(.55,"rgba(15, 23, 42, 0.86)"),fe.addColorStop(1,"rgba(30, 41, 59, 0.9)"),n.fillStyle=fe,n.shadowColor="rgba(8, 25, 53, 0.6)",n.shadowBlur=r*.4,n.fill(),n.lineWidth=Math.max(1.5,r*.06);const M=n.createLinearGradient(T,I,T+$,I);M.addColorStop(0,`${u.accent}`),M.addColorStop(1,`${u.warm}`),n.strokeStyle=M,n.stroke(),n.fillStyle=u.text,n.shadowColor="rgba(8, 25, 53, 0.65)",n.shadowBlur=r*.3,n.textAlign="center",n.textBaseline="middle",n.fillText(ne,p,I+H/2+Y*.05),n.restore()}const Xb={nativeSize:{width:64,height:64},anchor:{x:.5,y:.92},scale:{x:1,y:1},nudge:{x:0,y:-.05}},Yw={default:Xb,soldier:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.88},scale:{x:1.06,y:1.18},nudge:{x:0,y:-.1}},archer:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.86},scale:{x:1.04,y:1.16},nudge:{x:0,y:-.08}},"avanto-marauder":{nativeSize:{width:128,height:128},anchor:{x:.5,y:.86},scale:{x:1.08,y:1.12},nudge:{x:0,y:-.12}},saunoja:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.66},scale:{x:1,y:1},nudge:{x:0,y:-.02}}};function Kb(n){return Yw[n]??Xb}function Qb(n,a,s,r){const{x:o,y:u}=aa(n,a),f=r.nudge.x*a,h=r.nudge.y*a;return{x:o-s.x+f,y:u-s.y+h}}function Fw({coord:n,hexSize:a,origin:s,zoom:r,type:o}){const u=Kb(o),f=Qb(n,a,s,u);return{x:ta(f.x,r),y:ta(f.y,r)}}function $w({coord:n,hexSize:a,origin:s,zoom:r,type:o}){const u=Kb(o),f=Qb(n,a,s,u),{width:h,height:m}=Vc(a),p=h*u.scale.x,g=m*u.scale.y,b=ta(f.x-p*u.anchor.x,r),S=ta(f.y-g*u.anchor.y,r),E=ta(p,r),w=ta(g,r),R=b+E*u.anchor.x,_=S+w*u.anchor.y;return{drawX:b,drawY:S,width:E,height:w,centerX:R,centerY:_,metadata:u}}function Vw(n){if(!n||typeof n!="object")return!1;const a=n;return!!a.coord&&typeof a.coord=="object"&&typeof a.coord.q=="number"&&typeof a.coord.r=="number"&&typeof a.range=="number"}function Xw(n){if(!n)return null;if(Vw(n)){const a=Number.isFinite(n.range)?Math.max(0,n.range):0;return{coord:n.coord,range:a}}if("pos"in n&&"auraRadius"in n){const a=Number.isFinite(n.auraRadius)?Math.max(0,n.auraRadius):0;return{coord:n.pos,range:a}}return null}function Kw(n,a,s,r,o,u){const f=window.devicePixelRatio||1,h=n.canvas.width,m=n.canvas.height;n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,h,m);const p=h/f,g=m/f;n.scale(f,f),n.translate(p/2,g/2),n.scale(xe.zoom,xe.zoom);const b=a.getOrigin();n.translate(-(xe.x-b.x),-(xe.y-b.y)),a.draw(n,s,o??void 0);const S=u?.saunojas;S&&Array.isArray(S.units)&&S.units.length>0&&S.draw(n,S.units,{originX:b.x,originY:b.y,hexRadius:a.hexSize,zoom:xe.zoom}),Qw(n,a,s,r,b,u?.fx,u?.friendlyVisionSources,u?.saunaVision??u?.sauna??null),u?.sauna&&Iw(n,u.sauna,{origin:b,hexSize:a.hexSize}),n.restore()}function Qw(n,a,s,r,o,u,f,h){const p=(f??r).filter(b=>b.faction==="player"&&!b.isDead()).map(b=>({coord:b.coord,range:b.getVisionRange()})),g=Xw(h);g&&p.push(g);for(const b of r){if(b.isDead()||b.faction==="enemy"&&!p.some(({coord:P,range:ie})=>Zs(P,b.coord)<=ie))continue;const S=s[`unit-${b.type}`]??s.placeholder,E=b.getMaxHealth();n.save();const w=u?.getUnitAlpha?.(b);if(typeof w=="number"){const P=Math.min(1,Math.max(0,w));if(P<=0){n.restore();continue}n.globalAlpha*=P}b.stats.health/E<.5&&(n.filter="saturate(0)");const R=b.renderCoord??b.coord,_=$w({coord:R,hexSize:a.hexSize,origin:o,zoom:xe.zoom,type:b.type}),U=[];b.stats.health/E<.5&&U.push("saturate(0)");const B=Math.abs(R.q-b.coord.q),G=Math.abs(R.r-b.coord.r),F=Math.min(1,B+G);F>.01?(U.push("contrast(1.08)"),n.shadowColor="rgba(255, 255, 255, 0.28)",n.shadowBlur=Math.max(6,12*xe.zoom*F)):(n.shadowColor="rgba(0, 0, 0, 0)",n.shadowBlur=0),n.filter=U.length>0?U.join(" "):"none",n.drawImage(S,_.drawX,_.drawY,_.width,_.height),nm()&&b.faction==="player"&&(n.strokeStyle="rgba(255,255,255,0.5)",n.lineWidth=2,n.strokeRect(_.drawX,_.drawY,_.width,_.height)),n.restore()}}const Pw=200,ly=.001;function Vf(n){return{q:n.q,r:n.r}}function Mc(n,a){return!n||!a?!1:Math.abs(n.q-a.q)<ly&&Math.abs(n.r-a.r)<ly}class Zw{constructor(a){this.redraw=a}tracks=new Map;rafId=null;enqueue(a,s){const r=this.normalizePath(s);if(r.length<2){this.clear(a,{snap:!0});return}const o=r[0];let u=this.tracks.get(a.id);u?u.current?Mc(u.current.to,o)||(u=this.resetTrack(a,o)):Mc(a.renderCoord,o)||(u=this.resetTrack(a,o)):(u={unit:a,queue:[]},this.tracks.set(a.id,u),Mc(a.renderCoord,o)||a.setRenderCoord(o));for(let f=1;f<r.length;f++)u.queue.push(Vf(r[f]));this.ensureRunning()}clear(a,s){if(!this.tracks.delete(a.id)){s?.snap&&(a.snapRenderToCoord(),this.redraw());return}(s?.snap??!0)&&(a.snapRenderToCoord(),this.redraw()),this.tracks.size===0&&this.rafId!==null&&(typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null)}clearAll(){for(const a of this.tracks.values())a.unit.snapRenderToCoord();this.tracks.clear(),this.rafId!==null&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null,this.redraw()}resetTrack(a,s){this.clear(a,{snap:!1});const r={unit:a,queue:[]};return this.tracks.set(a.id,r),a.setRenderCoord(s),r}ensureRunning(){this.rafId!==null||this.tracks.size===0||(this.rafId=requestAnimationFrame(this.step))}normalizePath(a){const s=[];for(const r of a){const o=Vf(r);(s.length===0||!Mc(s[s.length-1],o))&&s.push(o)}return s}ease(a){return a<=0?0:a>=1?1:a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2}step=a=>{if(this.rafId=null,this.tracks.size===0)return;let s=!1;for(const[r,o]of this.tracks){if(!o.current){const S=o.queue.shift();if(!S){this.tracks.delete(r);continue}o.current={from:Vf(o.unit.renderCoord??o.unit.coord),to:S,start:a}}const u=o.current;if(!u)continue;const h=(a-u.start)/Pw,m=Math.min(1,Math.max(0,h)),p=this.ease(m),g=u.from.q+(u.to.q-u.from.q)*p,b=u.from.r+(u.to.r-u.from.r)*p;o.unit.setRenderCoord({q:g,r:b}),s=!0,m>=1&&(o.unit.setRenderCoord(u.to),o.current=void 0,o.queue.length===0&&this.tracks.delete(r))}s&&this.redraw(),this.tracks.size>0&&(this.rafId=requestAnimationFrame(this.step))}}const Jw=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,Ww=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null,eA=900,tA=650;function nA(n){switch(n){case"down":return{x:0,y:36};case"left":return{x:-26,y:-18};case"right":return{x:26,y:-18};case"up":default:return{x:0,y:-40}}}function aA(n){const a=document.createElement("div");a.className="ui-floater-layer",n.appendChild(a);const s=!!Jw?.matches,r=!!Ww?.matches;return{spawn:({text:f,x:h,y:m,color:p,direction:g="up",durationMs:b,fontSize:S})=>{const E=document.createElement("span");E.className="ui-floater",E.textContent=f,E.style.left=`${Math.round(h)}px`,E.style.top=`${Math.round(m)}px`,p&&(E.style.color=p),S&&(E.style.fontSize=`${S}px`);const w=r?12:24;for(;a.childElementCount>=w;)a.firstElementChild?.remove();a.appendChild(E);const R=b??(r?tA:eA);if(s||!E.animate){E.style.opacity="0",E.style.transition=`opacity ${Math.round(R*.8)}ms ease-out`,requestAnimationFrame(()=>{E.style.opacity="1",requestAnimationFrame(()=>{E.style.opacity="0"})}),window.setTimeout(()=>{E.remove()},R);return}const _=nA(g),U=[{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:0},{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:1,offset:.18},{transform:`translate3d(-50%, -50%, 0) translate3d(${_.x}px, ${_.y}px, 0)`,opacity:0}],B=E.animate(U,{duration:R,easing:"cubic-bezier(0.18, 0.89, 0.32, 1.28)",fill:"forwards"});B.onfinish=()=>{E.remove()}},destroy:()=>{a.remove()}}}const oy=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),iA=new Intl.NumberFormat("en-US",{maximumFractionDigits:1,minimumFractionDigits:0});function cy(n){return 1-(1-n)*(1-n)}function xc(n,a,s){return Math.min(s,Math.max(a,n))}const sA="var(--color-danger)",rA="color-mix(in srgb, #34d399 88%, white 12%)",lA=720,oA=540,cA=220,uA=180,dA=6,fA=3,hA="color-mix(in srgb, #fbbf24 82%, white 10%)",mA=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,pA=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null;function gA(n){const{canvas:a,overlay:s,mapRenderer:r,getUnitById:o,requestDraw:u}=n,f=aA(s),h=new Map,m=new Map,p=[],g={x:0,y:0},b=!!mA?.matches,S=!!pA?.matches,E=S?oA:lA,w=S?uA:cA,R=S?fA:dA,_=()=>{u&&(typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>u()):u())},U=Y=>{const N=a.getBoundingClientRect(),L=s.getBoundingClientRect();if(N.width===0||N.height===0)return null;const{x:A,y:$}=aa(Y,r.hexSize),H=(A-xe.x)*xe.zoom+N.width/2,T=($-xe.y)*xe.zoom+N.height/2,I=r.hexSize*xe.zoom*.75;return{x:H+(N.left-L.left),y:T+(N.top-L.top)-I}},B=(Y,N,L,A="up")=>{const $=o(Y);if(!$)return;const H=U($.renderCoord??$.coord);H&&f.spawn({text:N,x:H.x,y:H.y,color:L,direction:A,fontSize:S?18:void 0})},G=Y=>{if(!Y||Y.amount<=0)return;const N=oy.format(Math.max(1,Math.round(Y.amount)));if(B(Y.targetId,`-${N}`,sA,"up"),!b){const L=typeof performance<"u"?performance.now():Date.now();p.push({start:L,duration:w,intensity:R,seedX:Math.random()*500,seedY:Math.random()*500})}_()},F=Y=>{if(!Y||Y.amount<=0)return;const N=Y.amount>=1?oy.format(Math.round(Y.amount)):iA.format(xc(Y.amount,0,9.9));B(Y.unitId,`+${N}`,rA,"up"),_()},P=Y=>{if(!Y)return;const N=typeof performance<"u"?performance.now():Date.now();h.set(Y.unitId,{start:N,duration:E}),B(Y.unitId,"✖",hA,"down"),_()};return te.on("unitDamaged",G),te.on("unitHealed",F),te.on("unitDied",P),{step:Y=>{if(b)g.x=0,g.y=0;else{let N=0,L=0;for(let A=p.length-1;A>=0;A--){const $=p[A],H=Y-$.start;if(H>=$.duration){p.splice(A,1);continue}const T=xc(H/$.duration,0,1),I=$.intensity*cy(1-T);N+=Math.sin((Y+$.seedX)/16)*I,L+=Math.cos((Y+$.seedY)/18)*I}g.x=N,g.y=L}for(const[N,L]of h){const A=Y-L.start,$=xc(A/L.duration,0,1),H=1-cy($);if($>=1){m.delete(N),h.delete(N);continue}m.set(N,xc(H,0,1))}},getShakeOffset:()=>({x:g.x,y:g.y}),getUnitAlpha:Y=>m.get(Y)??1,dispose:()=>{te.off("unitDamaged",G),te.off("unitHealed",F),te.off("unitDied",P),p.length=0,h.clear(),m.clear(),f.destroy()}}}function yA(){return`${"/".endsWith("/")?"/":"//"}${"assets/units/saunoja.svg".replace(/^\/+/,"")}`}const uy=yA();let Ws=null,yl=null;function Ch(n){return!!(n&&n.complete&&n.naturalWidth>0&&n.naturalHeight>0)}function bA(n,a){if(!a)return n;try{a(n)}catch(s){console.error("Saunoja icon onLoad callback failed",s)}return n}function Pb(n){const a=r=>n?r.then(o=>bA(o,n)):r;if(Ch(Ws))return a(Promise.resolve(Ws));if(yl)return a(yl);if(typeof Image>"u")return Promise.reject(new Error("Image constructor is not available in this environment."));const s=new Image;return s.decoding="async",Ws=s,yl=new Promise((r,o)=>{const u=()=>{s.onload=null,s.onerror=null},f=()=>{u(),r(s)};s.onload=f,s.onerror=h=>{u(),Ws=null,yl=null;const m=new Error(`Failed to load saunoja icon from ${uy}`);console.warn(m.message,h),o(m)},s.src=uy,Ch(s)&&f()}),a(yl)}function vA(n,a,{originX:s=0,originY:r=0,hexRadius:o=dr,zoom:u=1}={}){if(!n||!Array.isArray(a)||a.length===0)return;const f=Ch(Ws)?Ws:null;if(!f)return;const h=Number.isFinite(o)&&o>0?o:dr,m=h*.98,p=[...a].sort((g,b)=>g.coord.r!==b.coord.r?g.coord.r-b.coord.r:g.coord.q!==b.coord.q?g.coord.q-b.coord.q:g.id.localeCompare(b.id));for(const g of p){const{x:b,y:S}=Fw({coord:g.coord,hexSize:h,origin:{x:s,y:r},zoom:u,type:"saunoja"});n.save(),Al(n,b,S,m),n.clip();const E=h*2.15/Math.max(f.naturalWidth,f.naturalHeight||1),w=ta(f.naturalWidth*E,u),R=ta(f.naturalHeight*E,u),_=ta(b-w/2,u),U=ta(S-R*.72,u);n.save(),n.filter="grayscale(100%) contrast(112%)",n.globalAlpha*=.96,n.drawImage(f,_,U,w,R),n.restore(),n.save(),n.globalCompositeOperation="multiply";const B=n.createRadialGradient(b,S+m*.38,m*.2,b,S+m*.38,m*1.05);B.addColorStop(0,"rgba(15, 23, 42, 0.55)"),B.addColorStop(1,"rgba(15, 23, 42, 0)"),n.fillStyle=B,n.fillRect(b-m,S-m,m*2,m*2),n.restore(),n.save(),n.globalCompositeOperation="soft-light";const G=n.createLinearGradient(b,S-m,b,S+m);G.addColorStop(0,"rgba(255, 232, 210, 0.18)"),G.addColorStop(.52,"rgba(255, 183, 124, 0.32)"),G.addColorStop(1,"rgba(212, 97, 54, 0.5)"),n.fillStyle=G,n.fillRect(b-m,S-m,m*2,m*2),n.restore(),n.save(),n.globalCompositeOperation="screen",n.globalAlpha=.75;const F=n.createRadialGradient(b,S-m*.68,m*.1,b,S,m*1.12);F.addColorStop(0,"rgba(255, 255, 255, 0.85)"),F.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=F,n.fillRect(b-m,S-m,m*2,m*2),n.restore();const ie=performance.now()-g.lastHitAt,se=120;if(ie<se){const Y=1-ie/se;tM(n,{centerX:b,centerY:S,radius:m,progress:Y})}n.restore(),nM(n,{centerX:b,centerY:S-h*.18,radius:h*.94,intensity:g.steam});const le=h*.42,ne=S+h*.34;eM(n,{centerX:b,centerY:ne,hp:g.hp,maxHp:g.maxHp,radius:le})}}const SA=["Resolute Sauna Guardian","Steam Scholar","Frost-Hardened","Loyal Watchbearer","Aura Whisperer","Shield Brother","Stonefooted Scout","Sisu-Forged Veteran","Brewmaster Quartermaster","Icebreaker Herald","Runic Tactician","Torchbearer"],EA=["Heat Fickle","Soot Allergic","Slow to Spark","Overconfident","Distracted Dreamer","Stubborn Stoker","Thirsty Between Battles","Clumsy Footwork","Rust-Prone Gear","Echo-Lost Listener"];function dy(n,a,s){const r=[...n],o=[],u=Math.max(0,Math.min(a,r.length));for(let f=0;f<u;f++){const h=Math.floor(s()*r.length),[m]=r.splice(h,1);m&&o.push(m)}return o}function MA(n,a){for(let s=n.length-1;s>0;s--){const r=Math.floor(a()*(s+1));[n[s],n[r]]=[n[r],n[s]]}return n}function xA(n=Math.random){typeof n!="function"&&(n=Math.random);const a=dy(SA,2,n),s=dy(EA,1,n),r=[...a,...s];return MA(r,n).map(o=>o.trim()).filter(o=>o.length>0)}const wA=1;function bl(n,a=0){return Number.isFinite(n)?n:a}function AA(n){const{heat:a,pickSpawnTile:s,spawnUnit:r,maxSpawns:o,tierHelpers:u}=n,f=Math.max(wA,ar),h=Math.max(0,bl(n.minUpkeepReserve??f,f));let m=Math.max(0,bl(n.availableUpkeep,0));const p=Math.max(0,Math.floor(bl(o??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY))),g=bl(n.rosterCap??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),b=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.POSITIVE_INFINITY,S=typeof n.getRosterCount=="function"?n.getRosterCount:()=>0;let E=0,w=0,R=0,_=0,U=0,B=0,G=0;for(;(a.hasTriggerReady()||u?.hasQueuedSpawn())&&E<p;){E+=1;const F=u?.getSnapshot()??null;if(Math.max(0,Math.floor(bl(S()??0,0)))>=b){B+=1;let ne=!1;F&&u&&(ne=u.queueBlockedSpawn(F,()=>a.consumeTrigger())),ne?w+=a.vent(.15):w+=a.vent(.35);break}let ie=!1;if(F&&u&&u.hasQueuedSpawn()&&(ie=u.takeQueuedSpawn(F)),!ie&&!a.hasTriggerReady())break;if(m<h){_+=1,ie&&F&&u?.restoreQueuedSpawn(F),w+=a.vent(.5);break}const se=s();if(!se){U+=1,ie&&F&&u?.restoreQueuedSpawn(F),w+=a.vent(.25);break}if(!r(se)){G+=1,ie&&F&&u?.restoreQueuedSpawn(F),w+=a.vent(.25);break}if(!ie&&!a.consumeTrigger()){G+=1;break}R+=1,m=Math.max(0,m-h),F&&u?.onSpawnResolved?.(F,{usedQueue:ie})}return{spawned:R,blockedByUpkeep:_,blockedByPosition:U,blockedByRoster:B,failedSpawns:G,ventedHeat:w,remainingUpkeep:m}}function Xf(n,a=0){return Number.isFinite(n)?n:a}function CA(n){const a=Math.max(0,Xf(n.dt,0)),{addedHeat:s,cooledHeat:r}=n.heat.advance(a);let o=0;for(const E of n.units){if(E.isDead()||E.faction!=="player")continue;const w=Math.max(0,Xf(n.getUnitUpkeep(E),0));w>0&&(o+=w)}const u=5;let h=Math.max(0,Xf(n.sauna.beerUpkeepAccumulator,0)),m=0;if(o>0){if(h+=a,h>=u){const E=Math.floor(h/u);m=o*E,h-=E*u}}else h=0;n.sauna.beerUpkeepAccumulator=h,m>0&&n.state.addResource(ae.SAUNA_BEER,-m);const p=n.state.getResource(ae.SAUNA_BEER),g=AA({heat:n.heat,availableUpkeep:p,pickSpawnTile:n.pickSpawnTile,spawnUnit:n.spawnBaseUnit,minUpkeepReserve:n.minUpkeepReserve,maxSpawns:n.maxSpawns,rosterCap:n.rosterCap,getRosterCount:n.getRosterCount,tierHelpers:n.tierHelpers}),b=n.heat.getCooldownSeconds(),S=n.heat.timeUntilNextTrigger();return n.sauna.heat=n.heat.getHeat(),n.sauna.playerSpawnThreshold=n.heat.getThreshold(),n.sauna.playerSpawnCooldown=Number.isFinite(b)?b:0,n.sauna.playerSpawnTimer=Number.isFinite(S)?S:0,n.sauna.heatPerTick=n.heat.getBuildRate(),{addedHeat:s,cooledHeat:r,upkeepDrain:m,spawn:g,beerRemaining:n.state.getResource(ae.SAUNA_BEER),availableUpkeep:g.remainingUpkeep}}function TA(){try{return globalThis.localStorage??null}catch(n){return console.warn("Unable to access localStorage for inventory persistence",n),null}}function _A(n,a){const s=n.getItem(a);if(s)try{return JSON.parse(s)}catch(r){console.warn(`Failed to parse persisted inventory for "${a}", clearing.`,r),n.removeItem(a);return}}function wc(n,a,s){const r=Number.isFinite(n.quantity)?n.quantity:1,o=Math.max(1,Math.round(r)),u=typeof n.rarity=="string"?n.rarity.trim():void 0,f=typeof n.icon=="string"?n.icon:void 0,h=typeof n.description=="string"?n.description:void 0;return{id:n.id,name:n.name,description:h,icon:f,rarity:u,quantity:o,acquiredAt:a,sourceTableId:s?.tableId,sourceEntryId:s?.entryId}}class RA{listeners=new Set;storageKey;now;maxStashSize;storage;autoEquip;stash=[];inventory=[];constructor(a={}){this.storageKey=a.storageKey??"autobattles:inventory",this.now=typeof a.now=="function"?a.now:()=>Date.now(),this.maxStashSize=Math.max(1,Math.floor(a.maxStashSize??24)),this.storage=TA(),this.autoEquip=a.autoEquip??!0,this.load()}load(){if(!this.storage)return;const a=_A(this.storage,this.storageKey);if(a){if(typeof a.autoEquip=="boolean"&&(this.autoEquip=a.autoEquip),Array.isArray(a.stash)){const s=[];for(const r of a.stash){if(!r||typeof r!="object")continue;const{id:o,name:u,quantity:f}=r;if(typeof o!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(wc({id:o,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.stash=s.slice(0,this.maxStashSize)}if(Array.isArray(a.inventory)){const s=[];for(const r of a.inventory){if(!r||typeof r!="object")continue;const{id:o,name:u,quantity:f}=r;if(typeof o!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(wc({id:o,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.inventory=s}}}persist(){if(!this.storage)return;const a={autoEquip:this.autoEquip,stash:this.stash.map(s=>({...s})),inventory:this.inventory.map(s=>({...s}))};try{this.storage.setItem(this.storageKey,JSON.stringify(a))}catch(s){console.warn("Failed to persist inventory state",s)}}emit(a){for(const s of this.listeners)s(a)}normalizeEquipResult(a){return typeof a=="boolean"?{success:a}:!a||typeof a!="object"?{success:!1}:{success:!!a.success,comparison:a.comparison,reason:a.reason}}on(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}isAutoEquipEnabled(){return this.autoEquip}setAutoEquip(a){this.autoEquip!==a&&(this.autoEquip=a,this.persist(),this.emit({type:"settings-updated",autoEquip:this.autoEquip}))}getStash(){return this.stash.map(a=>({...a}))}getStashSize(){return this.stash.length}getInventory(){return this.inventory.map(a=>({...a}))}getInventorySize(){return this.inventory.length}addLoot(a,s={}){return this.addItem({...a.item},{...s,sourceTableId:s.sourceTableId,sourceEntryId:s.sourceEntryId??a.entryId})}addItem(a,s={}){const r=Math.max(0,Math.round(this.now())),o=wc(a,r,{tableId:s.sourceTableId,entryId:s.sourceEntryId}),u=s.autoEquip??this.autoEquip;let f={success:!1};if(u&&s.unitId&&typeof s.equip=="function"){try{f=this.normalizeEquipResult(s.equip(s.unitId,o))}catch(h){console.warn("Failed to auto-equip inventory item",{item:o,error:h}),f={success:!1}}if(f.success)return this.persist(),this.emit({type:"item-acquired",item:o,equipped:!0,location:"equipped",unitId:s.unitId,stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:o,equipped:!0,location:"equipped"}}if(this.stash.push(o),this.stash.length>this.maxStashSize){const h=this.stash.splice(0,this.stash.length-this.maxStashSize);h.length>0&&console.warn("Inventory stash full, trimming oldest items",h)}return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-acquired",item:o,equipped:!1,unitId:s.unitId,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:o,equipped:!1,location:"stash",stashIndex:this.stash.length-1}}equipFromStash(a,s,r){if(a<0||a>=this.stash.length)return!1;const o=this.stash[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,o))}catch(h){console.warn("Failed to equip stash item",{item:o,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}equipFromInventory(a,s,r){if(a<0||a>=this.inventory.length)return!1;const o=this.inventory[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,o))}catch(h){console.warn("Failed to equip inventory item",{item:o,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}moveToInventory(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.inventory.push(s),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-moved",item:s,from:"stash",to:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}moveToStash(a){if(this.stash.length>=this.maxStashSize||a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.stash.push(s),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-moved",item:s,from:"inventory",to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}discardFromInventory(a){if(a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-discarded",item:s,location:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}unequipToStash(a,s,r){if(this.stash.length>=this.maxStashSize)return!1;let o=null;try{o=r(a,s)??null}catch(h){console.warn("Failed to unequip item",{unitId:a,slot:s,error:h}),o=null}if(!o)return!1;const u=Math.max(0,Math.round(this.now())),f=wc(o,u);return this.stash.push(f),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-unequipped",item:f,unitId:a,slot:s,to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),!0}discardFromStash(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-discarded",item:s,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}}const fy={toast:990},NA={stash:"Quartermaster Stash",inventory:"Ready Inventory"},kA={stash:"Your stash is empty. Conquer enemy elites to gather new equipment.",inventory:"No gear staged. Move items into the ready inventory for quick equipping."},DA={mythic:6,legendary:5,epic:4,rare:3,uncommon:2,common:1},LA=["health","attackDamage","attackRange","movementRange","defense","shield"],UA={"birch-sap-satchel":["healing","support"],"steamed-bandages":["restoration","shielding"],"aurora-distillate":["damage","defense"],"stolen-sauna-tokens":["mobility"],"midnight-bloodwine":["healing","damage"],"sauna-incense":["range","focus"],"glacier-brand":["damage"],"emberglass-arrow":["damage","range"],"aurora-lattice":["damage","range"],"emberglass-shard":["damage","mobility"],"windstep-totem":["mobility","defense"],"searing-chant-censer":["damage","shielding"],"cracked-ice-amulet":["defense"],"myrsky-charm":["range","defense"],"frostwyrm-signet":["shielding"],"spirit-oak-charm":["healing","defense"]};function Ga(n){return(n??"").trim().toLowerCase()}function Kf(n){const a=new Set;for(const s of n){const r=Ga(s);r&&a.add(r)}return a}function Qf(n,a){return{id:n.id,name:n.name,quantity:typeof a=="number"?a:n.quantity,rarity:n.rarity}}function Ac(n){return n?{id:n.id,name:n.name,quantity:n.quantity,rarity:n.rarity}:null}function hy(n){return UA[n]??[]}function my(n){const a=Ga(n)||"common",s=a.charAt(0).toUpperCase()+a.slice(1);return{key:a,label:s,rank:DA[a]??0}}function OA(n){const a=jl(n.id);if(!a){const o=my(n.rarity);return{slot:null,slotLabel:"Unassigned",rarity:o.key,rarityRank:o.rank,tags:hy(n.id),acquiredAt:n.acquiredAt}}const s=Hl(a.slot),r=my(n.rarity);return{slot:a.slot,slotLabel:s.label,rarity:r.key,rarityRank:r.rank,tags:hy(n.id),acquiredAt:n.acquiredAt}}function qA(n,a,s,r,o){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:o,slot:a,maxStacks:s,modifiers:r??{}}}function py(n,a){const s=n[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function zA(n,a){const s=jl(n.item.id);if(!s)return{slot:null,canEquip:!1,reason:"unknown-item",equipped:null,projected:Qf(n.item),stats:[]};const r=s.slot,o=Hl(r),u=a.loadout.find(_=>_.slot===r)??null,f=Math.max(1,Math.round(n.item.quantity)),h=Math.max(1,Math.floor(s.maxStacks??o.maxStacks)),m=(u?.quantity??0)+f,p=m>h;if(u&&u.id!==n.item.id)return{slot:r,canEquip:!1,reason:"slot-occupied",equipped:Ac(u),projected:Qf(n.item),stats:[]};if(p&&(!u||u.id!==n.item.id))return{slot:r,canEquip:!1,reason:"stack-limit",equipped:Ac(u),projected:Qf(n.item,Math.min(h,m)),stats:[]};const g=Math.min(h,m),b=[];for(const _ of a.loadout)_.slot!==r&&b.push({..._});const S=u&&u.id===n.item.id?{...u,quantity:g}:qA(n.item,r,h,s.modifiers,g);b.push(S);const E=a.currentStats??Gc(a.baseStats,a.loadout),w=Gc(a.baseStats,b),R=LA.map(_=>{const U=py(E,_),B=py(w,_);return{stat:_,current:U,projected:B,delta:B-U}});return{slot:r,canEquip:!0,equipped:Ac(u),projected:Ac(S),stats:R}}function gy(n,a){return n.map((s,r)=>({item:s,index:r,location:a,metadata:OA(s)}))}function BA(n,a){const s=new Map,r=new Map,o=new Map;for(const m of n){const{metadata:p}=m;if(p.slot){const E=p.slot,w=s.get(E);w?w.count+=1:s.set(E,{label:p.slotLabel,count:1})}const g=p.rarity,b=g.charAt(0).toUpperCase()+g.slice(1),S=r.get(g);S?S.count+=1:r.set(g,{label:b,count:1,rank:p.rarityRank});for(const E of p.tags){const w=Ga(E);if(!w)continue;const R=E.split(/[-_]/g).map(U=>U.charAt(0).toUpperCase()+U.slice(1)).join(" "),_=o.get(w);_?_.count+=1:o.set(w,{label:R,count:1})}}const u=Array.from(s.entries()).sort((m,p)=>{const g=ur.indexOf(m[0]),b=ur.indexOf(p[0]);return g-b}).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.slots.has(Ga(m))})),f=Array.from(r.entries()).sort((m,p)=>(p[1].rank??0)-(m[1].rank??0)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.rarities.has(Ga(m))})),h=Array.from(o.entries()).sort((m,p)=>m[1].label.localeCompare(p[1].label)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.tags.has(Ga(m))}));return{slots:u,rarities:f,tags:h}}function HA(n,a){if(a.slots.size>0){const s=n.metadata.slot?Ga(n.metadata.slot):"";if(!s||!a.slots.has(s))return!1}return!(a.rarities.size>0&&!a.rarities.has(n.metadata.rarity)||a.tags.size>0&&!n.metadata.tags.map(o=>Ga(o)).some(o=>a.tags.has(o)))}function jA(n,a){return a?[n.item.name,n.item.description??"",n.metadata.tags.join(" ")].join(" ").toLowerCase().includes(a):!0}function GA(n,a){switch(a){case"oldest":n.sort((s,r)=>s.metadata.acquiredAt-r.metadata.acquiredAt);break;case"rarity":n.sort((s,r)=>r.metadata.rarityRank!==s.metadata.rarityRank?r.metadata.rarityRank-s.metadata.rarityRank:r.metadata.acquiredAt-s.metadata.acquiredAt);break;case"name":n.sort((s,r)=>s.item.name.localeCompare(r.item.name));break;case"newest":default:n.sort((s,r)=>r.metadata.acquiredAt-s.metadata.acquiredAt);break}}function yy(n){const a={slots:Kf(n.filters.slots??new Set),rarities:Kf(n.filters.rarities??new Set),tags:Kf(n.filters.tags??new Set)},s=Ga(n.search),r=Math.max(1,Math.floor(n.page||1)),o=Math.max(1,Math.floor(n.pageSize||24)),u=n.collection??"stash",f=gy(n.stash,"stash"),h=gy(n.inventory,"inventory"),m=[...f,...h],p=BA(m,a),g=u==="stash"?f:h,S=[...g.filter(G=>HA(G,a)&&jA(G,s))];GA(S,n.sort??"newest");const E=Math.min(S.length,r*o),w=S.slice(0,E),R=S.length>E,_=n.comparisonContext??null,U=w.map(G=>({item:G.item,index:G.index,location:G.location,metadata:G.metadata,comparison:_?zA(G,_):null})),B=["stash","inventory"].map(G=>({id:G,label:NA[G],count:G==="stash"?n.stash.length:n.inventory.length,active:G===u}));return{collection:u,collections:B,filters:p,items:U,total:g.length,filteredTotal:S.length,search:n.search,sort:n.sort??"newest",hasMore:R,emptyMessage:kA[u]}}function IA(){return{slots:new Set,rarities:new Set,tags:new Set}}const YA="_panel_7op0d_1",FA="_header_7op0d_32",$A="_title_7op0d_42",VA="_meta_7op0d_49",XA="_close_7op0d_54",KA="_controls_7op0d_74",QA="_settings_7op0d_82",PA="_settingRow_7op0d_93",ZA="_settingCopy_7op0d_107",JA="_settingLabel_7op0d_114",WA="_settingHint_7op0d_120",e5="_settingControl_7op0d_127",t5="_settingState_7op0d_133",n5="_settingInput_7op0d_143",a5="_settingSwitch_7op0d_149",i5="_settingTrack_7op0d_169",s5="_settingThumb_7op0d_181",r5="_collections_7op0d_197",l5="_collectionButton_7op0d_205",o5="_searchRow_7op0d_234",c5="_search_7op0d_234",u5="_searchIcon_7op0d_266",d5="_sortSelect_7op0d_276",f5="_body_7op0d_286",h5="_grid_7op0d_292",m5="_empty_7op0d_301",p5="_footer_7op0d_312",g5="_loadMore_7op0d_317",ze={panel:YA,header:FA,title:$A,meta:VA,close:XA,controls:KA,settings:QA,settingRow:PA,settingCopy:ZA,settingLabel:JA,settingHint:WA,settingControl:e5,settingState:t5,settingInput:n5,settingSwitch:a5,settingTrack:i5,settingThumb:s5,collections:r5,collectionButton:l5,searchRow:o5,search:c5,searchIcon:u5,sortSelect:d5,body:f5,grid:h5,empty:m5,footer:p5,loadMore:g5},y5="_group_18afl_1",b5="_label_18afl_11",v5="_row_18afl_19",S5="_chip_18afl_25",E5="_count_18afl_55",Rl={group:y5,label:b5,row:v5,chip:S5,count:E5},M5="_card_1o0cv_1",x5="_header_1o0cv_26",w5="_icon_1o0cv_32",A5="_details_1o0cv_44",C5="_titleRow_1o0cv_51",T5="_title_1o0cv_51",_5="_rarity_1o0cv_63",R5="_slot_1o0cv_70",N5="_tags_1o0cv_75",k5="_tag_1o0cv_75",D5="_compare_1o0cv_91",L5="_tooltip_1o0cv_113",U5="_statList_1o0cv_144",O5="_stat_1o0cv_144",q5="_actions_1o0cv_169",z5="_action_1o0cv_169",B5="_primary_1o0cv_198",H5="_danger_1o0cv_209",j5="_badge_1o0cv_224",lt={card:M5,header:x5,icon:w5,details:A5,titleRow:C5,title:T5,rarity:_5,slot:R5,tags:N5,tag:k5,compare:D5,tooltip:L5,statList:U5,stat:O5,actions:q5,action:z5,primary:B5,danger:H5,badge:j5},G5={health:"HP",attackDamage:"ATK",attackRange:"Range",movementRange:"Move",defense:"Defense",shield:"Shield"},by={"slot-occupied":"Slot occupied. Unequip the current item first.","stack-limit":"Stack limit reached for this item.","unknown-item":"This item cannot be equipped yet."},Lc=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function I5(n,a){if(a.item.icon){const r=document.createElement("img");r.src=a.item.icon,r.alt="",r.loading="lazy",r.decoding="async",r.width=48,r.height=48,n.appendChild(r);return}const s=document.createElement("span");s.textContent=a.item.name.trim()[0]?.toUpperCase()??"?",n.appendChild(s)}function Zb(n){if(!(!n||n.canEquip))return n.reason&&by[n.reason]?by[n.reason]:"Unable to equip this item right now."}function Y5(n,a){const s=document.createElement("div");s.className=lt.tooltip;const r=document.createElement("h4");if(a.projected?r.textContent=a.canEquip?"Projected stats":"Current loadout":r.textContent="Stats",s.appendChild(r),!a.canEquip){const u=Zb(a);if(u){const f=document.createElement("p");f.textContent=u,f.style.margin="0 0 0.5rem",f.style.fontSize="0.78rem",s.appendChild(f)}}const o=document.createElement("ul");o.className=lt.statList;for(const u of n){const f=document.createElement("li");f.className=lt.stat,u.delta>0?f.dataset.delta="positive":u.delta<0&&(f.dataset.delta="negative");const h=document.createElement("span");h.textContent=G5[u.stat]??u.stat;const m=document.createElement("span"),p=Lc.format(u.current),g=Lc.format(u.projected),b=u.delta,S=b===0?"±0":`${b>0?"+":"−"}${Lc.format(Math.abs(b))}`;m.textContent=`${p} → ${g} (${S})`,f.append(h,m),o.appendChild(f)}return s.appendChild(o),s}function F5(n){const a=n.comparison;if(!a)return null;const s=document.createElement("div"),r=document.createElement("button");r.type="button",r.className=lt.compare,r.textContent=a.canEquip?"Compare stats":"View details";const o=`${n.item.id}-compare-${n.location}-${n.index}`;r.setAttribute("aria-controls",o),r.setAttribute("aria-expanded","false"),r.setAttribute("aria-describedby",o),r.addEventListener("focus",()=>{r.setAttribute("aria-expanded","true")}),r.addEventListener("blur",()=>{r.setAttribute("aria-expanded","false")}),s.appendChild(r);const u=Y5(a.stats,a);return u.id=o,s.appendChild(u),s}function $5(n,a){if(a&&!a.canEquip){n.disabled=!0;const s=Zb(a);s&&(n.title=s)}}function V5(n){return n.map(a=>{const s=a.trim();return s&&s.split(/[-_\s]/g).map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")})}function X5(n,a,s){const r=document.createElement("div");r.className=lt.actions;const o=document.createElement("button");o.type="button",o.className=`${lt.action} ${lt.primary}`,o.textContent="Equip",$5(o,a.comparison),o.addEventListener("click",()=>{s.onEquip?.()}),r.appendChild(o);const u=document.createElement("button");u.type="button",u.className=lt.action,u.textContent=a.location==="stash"?"Send to inventory":"Return to stash",u.addEventListener("click",()=>{s.onTransfer?.()}),r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=`${lt.action} ${lt.danger}`,f.textContent="Trash";let h=null;const m=()=>{h!==null&&(window.clearTimeout(h),h=null),f.dataset.confirm="false",f.textContent="Trash"};f.addEventListener("click",()=>{if(h!==null){m(),s.onTrash?.();return}f.dataset.confirm="true",f.textContent="Confirm trash",h=window.setTimeout(()=>{m()},2600)}),r.appendChild(f),n.appendChild(r)}function K5(n,a){const s=document.createElement("li");s.className=lt.card,s.dataset.location=n.location,s.setAttribute("role","listitem");const r=document.createElement("div");r.className=lt.header;const o=document.createElement("div");o.className=lt.icon,I5(o,n),r.appendChild(o);const u=document.createElement("div");u.className=lt.details;const f=document.createElement("div");f.className=lt.titleRow;const h=document.createElement("h4");h.className=lt.title,h.textContent=n.item.name,f.appendChild(h);const m=document.createElement("span");m.className=lt.rarity,m.textContent=n.metadata.rarity.toUpperCase(),f.appendChild(m),u.appendChild(f);const p=document.createElement("span");if(p.className=lt.slot,p.textContent=n.metadata.slot?n.metadata.slotLabel:"No slot",u.appendChild(p),n.metadata.tags.length>0){const b=document.createElement("div");b.className=lt.tags;for(const S of V5(n.metadata.tags)){const E=document.createElement("span");E.className=lt.tag,E.textContent=S,b.appendChild(E)}u.appendChild(b)}const g=F5(n);if(g&&u.appendChild(g),r.appendChild(u),s.appendChild(r),n.item.quantity>1){const b=document.createElement("span");b.className=lt.badge,b.textContent=`×${Lc.format(n.item.quantity)}`,s.appendChild(b)}return X5(s,n,a),s}const Q5={newest:"Newest",oldest:"Oldest",rarity:"Rarity",name:"Name A-Z"};function Pf(n){const a=document.createElement("div");a.className=Rl.row;const s=document.createElement("div");s.className=Rl.label,s.textContent=n;const r=document.createElement("div");return r.className=Rl.group,a.append(s,r),{row:a,group:r}}function P5(n){const a=document.createElement("section");a.className=ze.panel,a.tabIndex=-1,a.dataset.open="false",a.setAttribute("aria-label","Quartermaster stash");const s=document.createElement("header");s.className=ze.header;const r=document.createElement("div"),o=document.createElement("h2");o.className=ze.title,o.textContent="Quartermaster Stash",r.appendChild(o);const u=document.createElement("div");u.className=ze.meta,u.textContent="Loading…",r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=ze.close,f.textContent="Close",f.addEventListener("click",()=>n.onClose?.()),s.append(r,f),a.appendChild(s);const h=document.createElement("div");h.className=ze.controls;const m=document.createElement("div");m.className=ze.collections;const p={stash:document.createElement("button"),inventory:document.createElement("button")};p.stash.type="button",p.stash.className=ze.collectionButton,p.stash.textContent="Stash",p.stash.addEventListener("click",()=>n.onCollectionChange?.("stash")),p.inventory.type="button",p.inventory.className=ze.collectionButton,p.inventory.textContent="Ready",p.inventory.addEventListener("click",()=>n.onCollectionChange?.("inventory")),m.append(p.stash,p.inventory),h.appendChild(m);const g=document.createElement("div");g.className=ze.searchRow;const b=document.createElement("div");b.className=ze.search;const S=document.createElement("input");S.type="search",S.placeholder="Search stash…",S.addEventListener("input",()=>n.onSearchChange?.(S.value));const E=document.createElement("span");E.className=ze.searchIcon,E.textContent="🔍",b.append(E,S),g.appendChild(b);const w=document.createElement("select");w.className=ze.sortSelect,["newest","oldest","rarity","name"].forEach(A=>{const $=document.createElement("option");$.value=A,$.textContent=Q5[A],w.appendChild($)}),w.addEventListener("change",()=>n.onSortChange?.(w.value)),g.appendChild(w),h.appendChild(g);const R=document.createElement("div");R.className=ze.settings;const _=(A,$,H,T)=>{const I=document.createElement("div");I.className=ze.settingRow;const J=document.createElement("div");J.className=ze.settingCopy;const fe=document.createElement("span");fe.className=ze.settingLabel,fe.textContent=$,J.appendChild(fe);const M=document.createElement("p");M.className=ze.settingHint,M.textContent=H,J.appendChild(M);const V=document.createElement("div");V.className=ze.settingControl;const ee=document.createElement("span");ee.className=ze.settingState,ee.textContent="Off";const W=document.createElement("input");W.type="checkbox",W.id=A,W.className=ze.settingInput;const oe=document.createElement("label");oe.className=ze.settingSwitch,oe.htmlFor=A,oe.dataset.state="off";const pe=document.createElement("span");pe.className=ze.settingTrack;const he=document.createElement("span");he.className=ze.settingThumb,oe.append(pe,he);const Ie=Ae=>{W.checked=Ae,oe.dataset.state=Ae?"on":"off",ee.textContent=Ae?"On":"Off"};return W.addEventListener("change",()=>{Ie(W.checked),T?.(W.checked)}),V.append(ee,W,oe),I.append(J,V),{root:I,setChecked:Ie}},U=_("inventory-autoequip-toggle","Auto-equip loot","Try outfitting the selected attendant as soon as new gear arrives.",A=>n.onAutoEquipChange?.(A)),B=_("inventory-ui-variant-toggle","Experimental HUD","Swap to the React/Tailwind HUD. You can revert at any time.",A=>n.onUiV2Change?.(A));U.setChecked(n.getAutoEquipState?.()??!1),B.setChecked(n.getUiV2State?.()??!1),R.append(U.root,B.root),h.appendChild(R);const G=document.createElement("div"),F={slots:Pf("Slots"),rarities:Pf("Rarity"),tags:Pf("Tags")};G.append(F.slots.row,F.rarities.row,F.tags.row),h.appendChild(G),a.appendChild(h);const P=document.createElement("div");P.className=ze.body;const ie=document.createElement("ul");ie.className=ze.grid;const se=document.createElement("div");se.className=ze.empty,se.textContent="No items match the current filters.",se.hidden=!0,P.append(ie,se),a.appendChild(P);const le=document.createElement("div");le.className=ze.footer;const ne=document.createElement("button");ne.type="button",ne.className=ze.loadMore,ne.textContent="Show more",ne.addEventListener("click",()=>n.onLoadMore?.()),le.appendChild(ne),a.appendChild(le);function Y(A,$,H){A.group.innerHTML="",A.row.hidden=H.length===0;for(const T of H){const I=document.createElement("button");if(I.type="button",I.className=Rl.chip,I.dataset.active=T.active?"true":"false",I.textContent=T.label,T.count>0){const J=document.createElement("span");J.className=Rl.count,J.textContent=String(T.count),I.appendChild(J)}I.addEventListener("click",()=>n.onFilterToggle?.($,T.id)),A.group.appendChild(I)}}function N(A){ie.replaceChildren();const $=document.createDocumentFragment();for(const H of A.items){const T={onEquip:()=>n.onItemEquip?.(H),onTransfer:()=>n.onItemTransfer?.(H),onTrash:()=>n.onItemTrash?.(H)};$.appendChild(K5(H,T))}ie.appendChild($),se.hidden=A.filteredTotal!==0,se.hidden||(se.textContent=A.emptyMessage)}return{element:a,render(A){u.textContent=A.total===0?"No items yet":`${A.filteredTotal} of ${A.total} item${A.total===1?"":"s"}`;for(const[$,H]of Object.entries(p))H.dataset.active=$===A.collection?"true":"false";S.value!==A.search&&(S.value=A.search),w.value!==A.sort&&(w.value=A.sort),Y(F.slots,"slots",A.filters.slots),Y(F.rarities,"rarities",A.filters.rarities),Y(F.tags,"tags",A.filters.tags),N(A),ne.hidden=!A.hasMore},setOpen(A){a.dataset.open=A?"true":"false"},focus(){const A=a.focus.bind(a);try{A({preventScroll:!0})}catch($){console.warn("Stash panel focus without scroll prevention fallback",$);try{A()}catch(H){console.warn("Unable to focus stash panel element",H)}}},destroy(){a.remove()},setAutoEquip(A){U.setChecked(A)},setUiV2(A){B.setChecked(A)}}}const Zf=24,Z5=4500,J5=400,W5={health:"HP",attackDamage:"ATK",attackRange:"RNG",movementRange:"MOV",defense:"DEF",shield:"Shield"},vy="pointer-events-none ml-auto flex w-full max-w-[min(22rem,90vw)] flex-col gap-[clamp(6px,1vw,12px)]",eC="pointer-events-auto flex w-full items-center gap-[clamp(4px,0.8vw,12px)] rounded-hud-md border border-white/15 px-4 py-3 text-[0.9rem] font-semibold leading-[1.35] shadow-[0_18px_32px_rgba(15,23,42,0.22)] backdrop-blur-[14px] backdrop-saturate-[135%] transition-all duration-300 ease-out",tC={loot:"bg-[linear-gradient(135deg,rgba(255,255,255,0.95),rgba(215,229,255,0.95))] text-slate-900",info:"bg-[linear-gradient(135deg,rgba(219,245,255,0.95),rgba(197,228,255,0.95))] text-slate-900",warn:"bg-[linear-gradient(135deg,rgba(255,231,217,0.95),rgba(255,214,196,0.95))] text-amber-900"},nC=["-translate-y-2","opacity-0"];function Zc(n){n.hidden=n.childElementCount===0}function aC(n,a){const s=n.querySelector('[data-ui="loot-toast-stack"]');if(s)return s.parentElement!==a&&a.appendChild(s),s.className=vy,s.style.zIndex=String(fy.toast),Zc(s),s;const o=(n.ownerDocument??document).createElement("div");return o.dataset.ui="loot-toast-stack",o.className=vy,o.setAttribute("aria-live","polite"),o.setAttribute("role","status"),o.style.zIndex=String(fy.toast),Zc(o),a.appendChild(o),o}function Pt(n,a,s){const r=(n.ownerDocument??document).createElement("div");r.dataset.variant=s,r.className=`${eC} ${tC[s]}`,r.textContent=a,n.appendChild(r),Zc(n);const o=()=>{r.remove(),Zc(n)},u=window.setTimeout(()=>{r.classList.add(...nC),window.setTimeout(o,J5)},Z5);r.addEventListener("click",()=>{window.clearTimeout(u),o()})}function iC(n,a){n.has(a)?n.delete(a):n.add(a)}function sC(n){const a=n.comparison?.deltas??[];return a.length===0?null:a.map(r=>{const o=W5[r.stat]??r.stat;return`${r.delta>0?"+":""}${r.delta} ${o}`}).join(", ")}function Jf(n){switch(n){case"inventory":return"ready inventory";case"stash":return"stash";case"equipped":default:return"loadout"}}function rC(){const n=document.createElement("button");n.type="button",n.dataset.testid="inventory-badge",n.dataset.ui="inventory-badge",n.className="group inline-flex items-center gap-2 rounded-hud-pill border border-white/15 bg-[linear-gradient(135deg,rgba(27,36,56,0.9),rgba(39,74,110,0.9))] px-3.5 py-2 font-semibold text-sky-50 shadow-hud-sm transition-all duration-150 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent hover:-translate-y-0.5 hover:shadow-hud-md data-[autoequip=off]:bg-[linear-gradient(135deg,rgba(56,44,25,0.9),rgba(92,72,40,0.9))]",n.setAttribute("aria-expanded","false"),n.setAttribute("aria-controls","inventory-stash-panel"),n.setAttribute("aria-label","Open quartermaster stash");const a=document.createElement("span");a.className="relative flex h-[1.65rem] w-[1.65rem] flex-shrink-0 items-center justify-center rounded-full bg-[radial-gradient(circle_at_30%_30%,rgba(255,255,255,0.9),rgba(225,235,255,0.2))] text-slate-900 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.35)]",a.setAttribute("aria-hidden","true");const s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg");r.setAttribute("viewBox","0 0 24 24"),r.setAttribute("aria-hidden","true"),r.setAttribute("focusable","false"),r.setAttribute("class","h-[76%] w-[76%]");const o=document.createElementNS(s,"path");o.setAttribute("d","M8.25 7V6a3.75 3.75 0 0 1 7.5 0v1m3 0h-14.25a1.5 1.5 0 0 0-1.485 1.342l-.75 9a3 3 0 0 0 2.985 3.158h9.78a3 3 0 0 0 2.985-3.158l-.75-9A1.5 1.5 0 0 0 18.75 7Z"),o.setAttribute("fill","rgba(194, 216, 255, 0.32)"),o.setAttribute("stroke","rgba(255, 255, 255, 0.92)"),o.setAttribute("stroke-width","1.6"),o.setAttribute("stroke-linecap","round"),o.setAttribute("stroke-linejoin","round");const u=document.createElementNS(s,"path");u.setAttribute("d","M9.75 12.25h4.5"),u.setAttribute("fill","none"),u.setAttribute("stroke","rgba(255, 255, 255, 0.85)"),u.setAttribute("stroke-width","1.4"),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("opacity","0.9"),r.append(o,u),a.appendChild(r),n.appendChild(a);const f=document.createElement("span");f.className="text-[0.75rem] uppercase tracking-[0.08em]",f.textContent="Stash",n.appendChild(f);const h=document.createElement("span");return h.className="min-w-[1.5rem] rounded-full bg-white/15 px-2 py-[0.1rem] text-center text-xs font-semibold text-white/90",h.textContent="0",h.setAttribute("aria-hidden","true"),n.appendChild(h),{button:n,count:h}}function lC(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{destroy:()=>{}};const{regions:r}=mr(s),o=r.top,u=aC(s,o);s.querySelectorAll('[data-testid="inventory-badge"]').forEach(L=>L.remove());const{button:f,count:h}=rC();f.dataset.autoequip=n.isAutoEquipEnabled()?"on":"off",o.appendChild(f),s.querySelector("#inventory-stash-panel")?.remove();const p=P5({onClose:()=>_(!1),onCollectionChange:L=>{b!==L&&(b=L,R=1,B())},onFilterToggle:(L,A)=>{const $=S[L];iC($,A),R=1,B()},onSearchChange:L=>{E=L,R=1,B()},onSortChange:L=>{w=L,R=1,B()},onLoadMore:()=>{R+=1,B()},onItemEquip:L=>{F(L)},onItemTransfer:L=>{P(L)},onItemTrash:L=>{ie(L)},getAutoEquipState:()=>n.isAutoEquipEnabled(),onAutoEquipChange:L=>{n.setAutoEquip(L),f.dataset.autoequip=L?"on":"off",Pt(u,L?"Auto-equip enabled. Newly recovered gear will try to arm your selected attendant.":"Auto-equip disabled. Loot will head to the stash until you equip it manually.","info")},getUiV2State:()=>a.getUseUiV2?.()??!1,onUiV2Change:L=>{a.onUseUiV2Change?.(L),Pt(u,L?"Experimental HUD enabled. Reload to try the React/Tailwind experience.":"Classic HUD restored for your next session.","info")}});p.element.id="inventory-stash-panel",s.appendChild(p.element);let g=!1,b="stash";const S=IA();let E="",w="newest",R=1;function _(L){if(g!==L)if(g=L,p.setOpen(g),f.setAttribute("aria-expanded",g?"true":"false"),f.setAttribute("aria-label",g?"Close quartermaster stash":"Open quartermaster stash"),g){s.classList.add("inventory-panel-open");try{p.focus()}catch(A){console.warn("Unable to focus stash panel",A)}}else s.classList.remove("inventory-panel-open")}function U(){const L=a.getComparisonContext?.()??null;let A=yy({stash:n.getStash(),inventory:n.getInventory(),filters:S,search:E,sort:w,page:R,pageSize:Zf,collection:b,comparisonContext:L});if(A.filteredTotal>0){const $=Math.max(1,Math.ceil(A.filteredTotal/Zf));R>$&&(R=$,A=yy({stash:n.getStash(),inventory:n.getInventory(),filters:S,search:E,sort:w,page:R,pageSize:Zf,collection:b,comparisonContext:L}))}return A}function B(){const L=U(),$=L.collections.find(H=>H.id==="stash")?.count??0;h.textContent=String($),f.dataset.count=String($),p.render(L)}function G(){const L=a.getSelectedUnitId?.()??null;return L||(Pt(u,"Select an attendant before equipping an item.","warn"),null)}function F(L){const A=G();if(!A)return;const $=a.onEquip??(()=>({success:!1}));(L.location==="stash"?n.equipFromStash(L.index,A,(I,J)=>$(I,J,"stash")):n.equipFromInventory(L.index,A,(I,J)=>$(I,J,"inventory")))||Pt(u,"Unable to equip that item right now.","warn")}function P(L){const A=L.location==="stash"?n.moveToInventory(L.index):n.moveToStash(L.index);if(!A){Pt(u,"Unable to move that item right now.","warn");return}const $=L.location==="stash"?"ready inventory":"stash";Pt(u,`Moved ${A.name} to the ${$}.`,"info"),R=1,B()}function ie(L){const A=L.location==="stash"?n.discardFromStash(L.index):n.discardFromInventory(L.index);if(!A){Pt(u,"That item was already removed.","warn");return}const $=L.location==="stash"?"stash":"ready inventory";Pt(u,`${A.name} discarded from the ${$}.`,"warn"),B()}function se(L){switch(L.type){case"stash-updated":case"inventory-updated":B();break;case"item-acquired":if(L.equipped)Pt(u,`${L.item.name} auto-equipped successfully.`,"info");else{const A=Jf(L.location);Pt(u,`New item secured: ${L.item.name} (${A}).`,"loot")}break;case"item-equipped":{const A=sC(L),$=A?` (${A})`:"";Pt(u,`Equipped ${L.item.name}${$}.`,"info");break}case"item-unequipped":Pt(u,`${L.item.name} returned to the stash from slot ${L.slot}.`,"info");break;case"item-moved":{const A=Jf(L.to);Pt(u,`Moved ${L.item.name} to the ${A}.`,"info");break}case"item-discarded":{const A=Jf(L.location);Pt(u,`${L.item.name} discarded from the ${A}.`,"warn");break}case"settings-updated":f.dataset.autoequip=L.autoEquip?"on":"off",p.setAutoEquip(L.autoEquip);break}}const le=n.on(L=>se(L)),ne=()=>{_(!g)};f.addEventListener("click",ne);const Y=L=>{L.defaultPrevented||L.code==="KeyI"&&!L.metaKey&&!L.ctrlKey&&!L.altKey&&(L.preventDefault(),_(!g))};return window.addEventListener("keydown",Y),B(),{destroy:()=>{le(),f.removeEventListener("click",ne),window.removeEventListener("keydown",Y),f.remove(),p.destroy(),s.classList.remove("inventory-panel-open"),u.hasChildNodes()||u.remove()}}}const oC=Object.freeze({common:1,uncommon:.6,rare:.35,epic:.18,legendary:.08,mythic:.03}),cC=Object.freeze({id:"general-salvage",label:"General Salvage",entries:Object.freeze([{id:"birch-sap-satchel",name:"Birch Sap Satchel",description:"Soothing birch sap that doubles as a brisk field tonic.",rarity:"common",quantity:{min:1,max:3},weight:6},{id:"steamed-bandages",name:"Steamed Linen Bandages",description:"Freshly steamed bandages infused with pine oils.",rarity:"common",quantity:1,weight:5},{id:"emberglass-shard",name:"Emberglass Shard",description:"A radiant shard used to kindle sauna braziers.",rarity:"uncommon",quantity:1,weight:3},{id:"aurora-distillate",name:"Aurora Distillate",description:"Vials of shimmering condensation that empower sauna rituals.",rarity:"rare",quantity:1,weight:1.5},{id:"myrsky-charm",name:"Myrsky Charm",description:"Storm-forged charm rumored to call down aurora flares.",rarity:"epic",quantity:1,weight:.7}])}),uC=Object.freeze({base:Object.freeze({id:"enemy-raiders",label:"Avanto Marauder Spoils",entries:Object.freeze([{id:"cracked-ice-amulet",name:"Cracked Ice Amulet",description:"Necklace of frostbitten charms that hum when danger nears.",rarity:"common",quantity:1,weight:5},{id:"stolen-sauna-tokens",name:"Stolen Sauna Tokens",description:"Pilfered entrance tokens, gladly accepted back at any sauna hall.",rarity:"uncommon",quantity:{min:2,max:5},weight:3},{id:"glacier-brand",name:"Glacier Brand",description:"A cleaver chilled in glacial meltwater that never dulls.",rarity:"rare",quantity:1,weight:1.25}])}),elite:Object.freeze({id:"enemy-champions",label:"Avanto Champion Cache",entries:Object.freeze([{id:"frostwyrm-signet",name:"Frostwyrm Signet",description:"An icy signet ring that wreathes its bearer in frozen vapour.",rarity:"epic",quantity:1,weight:1.1},{id:"aurora-lattice",name:"Aurora Lattice",description:"Filigree latticework that channels auroral light into focused beams.",rarity:"legendary",quantity:1,weight:.4},{id:"midnight-bloodwine",name:"Midnight Bloodwine",description:"A mythical draught said to rekindle a warrior's lost resolve.",rarity:"mythic",quantity:1,weight:.12}])})}),dC=Object.freeze({base:Object.freeze({id:"deepwood-offerings",label:"Deepwood Offerings",entries:Object.freeze([{id:"spirit-oak-charm",name:"Spirit Oak Charm",description:"Carved from living oak, it whispers guidance between sauna rounds.",rarity:"uncommon",quantity:1,weight:4},{id:"sauna-incense",name:"Sauna Incense Pouches",description:"Fragrant blends that steady breathing before the next engagement.",rarity:"common",quantity:{min:1,max:4},weight:5},{id:"emberglass-arrow",name:"Emberglass Arrow Bundle",description:"Arrowheads that glow amber when a perfect shot reveals itself.",rarity:"rare",quantity:{min:1,max:2},weight:1.75}])}),elite:Object.freeze({id:"deepwood-ritual-cache",label:"Deepwood Ritual Cache",entries:Object.freeze([{id:"windstep-totem",name:"Windstep Totem",description:"Totem etched with gale sigils that lighten every cautious stride.",rarity:"epic",quantity:1,weight:.9},{id:"searing-chant-censer",name:"Searing Chant Censer",description:"An ornate censer that empowers allies with smouldering hymns.",rarity:"legendary",quantity:1,weight:.35}])})}),fC=Object.freeze({enemy:uC,deepwood:dC});function hC(n){return fC[n]??{base:cC}}function mC(n,a=!1){const s=hC(n);return a&&s.elite?s.elite:s.base}function pC(n){if(!Number.isFinite(n))return 1;const a=Math.floor(n);return a<=0?0:Math.min(10,a)}function gC(n,a){if(typeof n=="number"&&Number.isFinite(n))return Math.max(1,Math.round(n));if(!n)return 1;const s=n,r=Math.max(1,Math.round(s.min)),u=Math.max(r,Math.round(s.max))-r+1,f=Math.floor(Math.max(0,Math.min(.999999,a()))*u);return r+f}function yC(n){const a=oC[n.rarity]??1,s=typeof n.weight=="number"?n.weight:1;return Math.max(0,s)*Math.max(0,a)}function bC(n,a){const s=n.map(f=>({entry:f,weight:yC(f)})).filter(f=>f.weight>0);if(s.length===0)return null;const r=s.reduce((f,h)=>f+h.weight,0),o=Math.max(0,Math.min(.999999,a()))*r;let u=0;for(const f of s)if(u+=f.weight,o<u)return f.entry;return s[s.length-1]?.entry??null}function vC(n,a){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:a}}function SC(n){const a=typeof n.random=="function"?n.random:Math.random,s=!!n.elite,r=n.table??mC(n.factionId,s),o=pC(n.rolls),u=[];if(o<=0||r.entries.length===0)return{factionId:n.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u};for(let f=0;f<o;f+=1){const h=bC(r.entries,a);if(!h)break;const m=gC(h.quantity,a);u.push({entryId:h.id,rarity:h.rarity,quantity:m,item:vC(h,m)})}return{factionId:n.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u}}const EC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23a4d67a'%20/%3e%3cpolygon%20points='16,48%2032,16%2048,48'%20fill='%23d2691e'%20/%3e%3crect%20x='24'%20y='32'%20width='16'%20height='16'%20fill='%23f4a460'%20/%3e%3c/svg%3e",MC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23c0c0c0'%20/%3e%3crect%20x='8'%20y='24'%20width='48'%20height='24'%20fill='%23808080'%20/%3e%3crect%20x='24'%20y='16'%20width='16'%20height='8'%20fill='%23606060'%20/%3e%3c/svg%3e",xC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23e0e0e0'%20/%3e%3crect%20x='10'%20y='22'%20width='12'%20height='30'%20fill='%23a9a9a9'%20/%3e%3crect%20x='26'%20y='14'%20width='12'%20height='38'%20fill='%23808080'%20/%3e%3crect%20x='42'%20y='26'%20width='12'%20height='26'%20fill='%23a9a9a9'%20/%3e%3c/svg%3e",wC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%238b4513'%20/%3e%3cpolygon%20points='32,10%2042,22%2022,22'%20fill='%23555'%20/%3e%3crect%20x='30'%20y='22'%20width='4'%20height='32'%20fill='%23ccc'%20/%3e%3c/svg%3e",AC="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eFrostguard%20Soldier%3c/title%3e%3cdesc%20id='desc'%3eArmored%20nordic%20soldier%20with%20glacial%20blade,%20frosted%20shield,%20and%20aurora%20glow.%3c/desc%3e%3cdefs%3e%3clinearGradient%20id='soldier-bg'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%230b2a44'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2310243b'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-glow'%20cx='50%25'%20cy='28%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='rgba(191,%20219,%20254,%200.85)'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(14,%20116,%20144,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-armor'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e2e8f0'%20/%3e%3cstop%20offset='50%25'%20stop-color='%23cbd5f5'%20/%3e%3cstop%20offset='100%25'%20stop-color='%234b5563'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-trim'%20x1='0'%20y1='0'%20x2='1'%20y2='0'%3e%3cstop%20offset='0%25'%20stop-color='%23fcd34d'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f97316'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-cloak'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%231e3a8a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231d4ed8'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-steel'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%2394a3b8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231f2937'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-shield'%20cx='38%25'%20cy='38%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='70%25'%20stop-color='%2360a5fa'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231d4ed8'%20/%3e%3c/radialGradient%3e%3c/defs%3e%3crect%20width='128'%20height='128'%20rx='18'%20fill='url(%23soldier-bg)'%20/%3e%3ccircle%20cx='64'%20cy='40'%20r='44'%20fill='url(%23soldier-glow)'%20opacity='0.9'%20/%3e%3cellipse%20cx='64'%20cy='108'%20rx='36'%20ry='10'%20fill='%230f172a'%20opacity='0.4'%20/%3e%3cpath%20d='M38%2038c-10%2014-14%2032-10%2052l14%208c0-18%208-34%2022-42-8-6-18-12-26-18z'%20fill='url(%23soldier-cloak)'%20opacity='0.85'%20/%3e%3cpath%20d='M90%2038c10%2014%2014%2032%2010%2052l-14%208c0-18-8-34-22-42%208-6%2018-12%2026-18z'%20fill='url(%23soldier-cloak)'%20opacity='0.65'%20/%3e%3cpath%20d='M58%2022l-8%2010c-4%206-6%2014-6%2022v20l12%2038h16l12-38V54c0-8-2-16-6-22l-8-10h-12z'%20fill='url(%23soldier-armor)'%20stroke='%231f2937'%20stroke-width='2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M50%2054h28l4%2012c-8%208-16%2012-18%2012s-10-4-18-12l4-12z'%20fill='%23e0f2fe'%20opacity='0.85'%20/%3e%3cpath%20d='M64%2022c-6%200-12%204-16%2010l6%208c6-6%2020-6%2026%200l6-8c-4-6-10-10-16-10z'%20fill='%23f8fafc'%20stroke='%23cbd5f5'%20stroke-width='1.5'%20/%3e%3cpath%20d='M58%2018h12l4%206-10%206-10-6%204-6z'%20fill='%23e0f2fe'%20stroke='%2394a3b8'%20stroke-width='1.5'%20/%3e%3crect%20x='46'%20y='68'%20width='12'%20height='26'%20rx='5'%20fill='%230ea5e9'%20opacity='0.8'%20/%3e%3crect%20x='70'%20y='68'%20width='12'%20height='26'%20rx='5'%20fill='%2338bdf8'%20opacity='0.8'%20/%3e%3cpath%20d='M34%2066l-10%206%2012%2028%2012-6-14-28z'%20fill='url(%23soldier-shield)'%20stroke='%231e3a8a'%20stroke-width='2'%20/%3e%3ccircle%20cx='36'%20cy='78'%20r='6'%20fill='rgba(226,%20232,%20240,%200.95)'%20/%3e%3cpath%20d='M94%2064l-4-4-18%2036%206%206%2016-38z'%20fill='url(%23soldier-steel)'%20stroke='%230f172a'%20stroke-width='2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M86%2054l-16%2034%2010%204%2014-32-8-6z'%20fill='%23f8fafc'%20opacity='0.75'%20/%3e%3cpath%20d='M64%2090c-8%200-14%206-18%2014%208%204%2012%206%2018%206s10-2%2018-6c-4-8-10-14-18-14z'%20fill='%23dbeafe'%20stroke='%2393c5fd'%20stroke-width='1.5'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M54%2058l-6%2012c8%2010%2016%2014%2016%2014s8-4%2016-14l-6-12H54z'%20fill='url(%23soldier-trim)'%20opacity='0.85'%20/%3e%3cpath%20d='M60%2048h8l2%208-6%204-6-4%202-8z'%20fill='%23334155'%20/%3e%3ccircle%20cx='64'%20cy='52'%20r='6'%20fill='%23f1f5f9'%20stroke='%23cbd5f5'%20stroke-width='1'%20/%3e%3cpath%20d='M58%2038c-4%200-6%204-6%2010%204-2%208-4%2012-4s8%202%2012%204c0-6-2-10-6-10H58z'%20fill='%231f2937'%20opacity='0.85'%20/%3e%3c/svg%3e",CC="/assets/archer-DKJNMRtW.svg",TC="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eAvanto%20Marauder%3c/title%3e%3cdesc%20id='desc'%3eFrost-clad%20marauder%20icon%20with%20jagged%20pauldrons,%20icy%20beard,%20and%20polar%20glow.%3c/desc%3e%3cdefs%3e%3clinearGradient%20id='bg'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23082f49'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230f172a'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='armor'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e2e8f0'%20/%3e%3cstop%20offset='60%25'%20stop-color='%2394a3b8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231f2937'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='beard'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23bae6fd'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='glow'%20cx='50%25'%20cy='20%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='rgba(191,%20219,%20254,%200.85)'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(14,%20116,%20144,%200)'%20/%3e%3c/radialGradient%3e%3c/defs%3e%3crect%20width='128'%20height='128'%20rx='20'%20fill='url(%23bg)'%20/%3e%3ccircle%20cx='64'%20cy='46'%20r='38'%20fill='url(%23glow)'%20opacity='0.85'%20/%3e%3cpath%20d='M64%2018c-14%200-26%208-32%2020l10%204c6-8%2014-12%2022-12s16%204%2022%2012l10-4C90%2026%2078%2018%2064%2018z'%20fill='%23cffafe'%20opacity='0.4'%20/%3e%3cpath%20d='M64%2036c-14%200-28%2010-28%2028v10l-12%2016%2018%2010%2022-10%2022%2010%2018-10-12-16V64c0-18-14-28-28-28z'%20fill='url(%23armor)'%20stroke='%230f172a'%20stroke-width='2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M48%2090l-12%206-10%2020%2020-8%2018%208%2018-8%2020%208-10-20-12-6'%20fill='%230f172a'%20opacity='0.85'%20/%3e%3cpath%20d='M64%2046c-10%200-18%208-18%2018v10c12-8%2024-8%2036%200V64c0-10-8-18-18-18z'%20fill='%230f172a'%20/%3e%3cpath%20d='M64%2050c-8%200-14%206-14%2014%206-4%2012-6%2014-6s8%202%2014%206c0-8-6-14-14-14z'%20fill='%23bae6fd'%20opacity='0.85'%20/%3e%3cpath%20d='M58%2084c-4%200-8%202-10%206%204%200%208%200%2010-2s4-2%206-2%204%200%206%202%206%202%2010%202c-2-4-6-6-10-6h-12z'%20fill='%23f8fafc'%20opacity='0.75'%20/%3e%3cpath%20d='M64%2086c-6%200-12%204-14%2010%204%202%2010%204%2014%204s10-2%2014-4c-2-6-8-10-14-10z'%20fill='url(%23beard)'%20stroke='%23bae6fd'%20stroke-width='1.4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M42%2064c-4-8-6-18-6-28-6%208-10%2018-10%2030%204-2%2010-2%2016-2z'%20fill='%230ea5e9'%20opacity='0.5'%20/%3e%3cpath%20d='M86%2064c4-8%206-18%206-28%206%208%2010%2018%2010%2030-4-2-10-2-16-2z'%20fill='%230ea5e9'%20opacity='0.5'%20/%3e%3cpath%20d='M34%2098c-6%202-12%206-14%2012%206%200%2012-2%2018-4'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M94%20106c6%202%2012%204%2018%204-2-6-8-10-14-12'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/svg%3e",vl="/",wi={saunaBeer:`${vl}assets/ui/sauna-beer.svg`,saunojaRoster:`${vl}assets/ui/saunoja-roster.svg`,resource:`${vl}assets/ui/resource.svg`,sisu:`${vl}assets/ui/resource.svg`,sound:`${vl}assets/ui/sound.svg`},_C={images:{placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=","building-farm":EC,"building-barracks":MC,"building-city":xC,"building-mine":wC,"unit-soldier":AC,"unit-archer":CC,"unit-avanto-marauder":TC,"icon-sauna-beer":wi.saunaBeer,"icon-saunoja-roster":wi.saunojaRoster,"icon-resource":wi.resource,"icon-sound":wi.sound}};let Jb=null;function RC(n){Jb=n}function Wb(){return Jb}const NC=["city"],kC=1e4,DC=12e3;function LC(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Sy(n){return Object.freeze({strongholds:{...n.strongholds},roster:{...n.roster},economy:{...n.economy},sauna:{...n.sauna},startedAt:n.startedAt})}function Ey(n){const a={[ae.SAUNA_BEER]:0,[ae.SAUNAKUNNIA]:0,[ae.SISU]:0};return Object.values(ae).forEach(s=>{a[s]=n.getResource(s)}),a}class UC{timeSource;state;map;getRosterCount;sauna;strongholdTypes;rosterGraceMs;bankruptcyGraceMs;progress;startResources;strongholds=new Map;progressListeners=new Set;resolutionListeners=new Set;mapDisposer=null;rosterTimeout=null;bankruptcyTimeout=null;bankruptSince=null;wipeSince=null;saunaDestroyedAt=null;resolution=null;disposed=!1;constructor(a){this.timeSource=typeof a.timeSource=="function"?a.timeSource:LC,this.state=a.state,this.map=a.map,this.getRosterCount=a.getRosterCount,this.sauna=a.sauna??null;const s=a.strongholdTypes?.length?a.strongholdTypes:NC;this.strongholdTypes=new Set(s),this.rosterGraceMs=Math.max(0,a.rosterWipeGraceMs??kC),this.bankruptcyGraceMs=Math.max(0,a.bankruptcyGraceMs??DC),this.startResources=Ey(this.state);const r=this.state.getResource(ae.SAUNA_BEER),o=Math.max(0,Math.round(this.getRosterCount()))||0;this.progress={strongholds:{total:0,destroyed:0,remaining:0},roster:{active:o,totalDeaths:0,wipeSince:null,wipeDurationMs:0},economy:{beer:r,worstBeer:r,bankruptSince:null,bankruptDurationMs:0},sauna:this.createSaunaProgress(),startedAt:this.timeSource()},this.bootstrapStrongholds(),this.attachMapListener(),this.attachEventListeners(),this.emitProgress(),this.evaluateResolution()}onProgress(a){this.progressListeners.add(a)}offProgress(a){this.progressListeners.delete(a)}onResolution(a){if(this.resolution){a(this.resolution);return}this.resolutionListeners.add(a)}offResolution(a){this.resolutionListeners.delete(a)}getProgress(){return Sy(this.progress)}dispose(){if(!this.disposed){if(this.disposed=!0,this.clearRosterTimer(),this.clearBankruptcyTimer(),this.mapDisposer){try{this.mapDisposer()}catch(a){console.warn("Failed to detach map listener",a)}this.mapDisposer=null}te.off("unitDied",this.handleUnitDied),te.off("unitSpawned",this.handleUnitSpawned),te.off("resourceChanged",this.handleResourceChanged),te.off("saunaDamaged",this.handleSaunaDamaged),te.off("saunaDestroyed",this.handleSaunaDestroyed)}}bootstrapStrongholds(){this.map.forEachTile((a,s)=>{if(this.isStronghold(a.building)){const r=this.coordKey(s);this.strongholds.set(r,{alive:!0})}}),this.updateStrongholdTotals()}attachMapListener(){this.mapDisposer=this.map.addTileChangeListener((a,s,r)=>{if(r!=="building"&&r!=="created")return;const o=this.coordKey(a),u=this.strongholds.get(o);this.isStronghold(s.building)?u?u.alive||(u.alive=!0):this.strongholds.set(o,{alive:!0}):u?.alive&&(u.alive=!1),this.updateStrongholdTotals(),this.emitProgress(),this.evaluateResolution()})}attachEventListeners(){te.on("unitDied",this.handleUnitDied),te.on("unitSpawned",this.handleUnitSpawned),te.on("resourceChanged",this.handleResourceChanged),te.on("saunaDamaged",this.handleSaunaDamaged),te.on("saunaDestroyed",this.handleSaunaDestroyed)}handleUnitDied=({unitFaction:a})=>{a==="player"&&(this.progress.roster.totalDeaths+=1,this.refreshRosterStatus(),this.emitProgress(),this.evaluateResolution())};handleUnitSpawned=({unit:a})=>{a.faction==="player"&&(this.refreshRosterStatus(),this.emitProgress())};handleResourceChanged=({resource:a,total:s})=>{a===ae.SAUNA_BEER&&(this.progress.economy.beer=s,s<this.progress.economy.worstBeer&&(this.progress.economy.worstBeer=s),s<0?this.bankruptSince===null&&(this.bankruptSince=this.timeSource(),this.progress.economy.bankruptSince=this.bankruptSince,this.startBankruptcyTimer()):(this.updateBankruptcyDuration(),this.bankruptSince=null,this.progress.economy.bankruptSince=null,this.clearBankruptcyTimer()),this.emitProgress())};handleSaunaDamaged=({remainingHealth:a})=>{this.disposed||(this.updateSaunaSnapshot(a),this.emitProgress())};handleSaunaDestroyed=a=>{this.disposed||(this.markSaunaDestroyed(),this.emitProgress(),this.resolve("lose","saunaDestroyed"))};startBankruptcyTimer(){if(this.bankruptcyTimeout===null){if(this.bankruptcyGraceMs<=0){this.resolve("lose","bankruptcy");return}this.bankruptcyTimeout=setTimeout(()=>{this.updateBankruptcyDuration(),this.resolve("lose","bankruptcy")},this.bankruptcyGraceMs)}}clearBankruptcyTimer(){this.bankruptcyTimeout!==null&&(clearTimeout(this.bankruptcyTimeout),this.bankruptcyTimeout=null)}startRosterTimer(){if(this.rosterTimeout===null){if(this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.rosterTimeout=setTimeout(()=>{this.updateRosterDuration(),this.resolve("lose","rosterWipe")},this.rosterGraceMs)}}clearRosterTimer(){this.rosterTimeout!==null&&(clearTimeout(this.rosterTimeout),this.rosterTimeout=null)}updateStrongholdTotals(){const a=this.strongholds.size;let s=0;for(const r of this.strongholds.values())r.alive&&(s+=1);this.progress.strongholds.total=a,this.progress.strongholds.remaining=s,this.progress.strongholds.destroyed=Math.max(0,a-s)}refreshRosterStatus(){const a=Math.max(0,Math.round(this.getRosterCount()));this.progress.roster.active=a,a<=0?(this.wipeSince===null&&(this.wipeSince=this.timeSource(),this.progress.roster.wipeSince=this.wipeSince),this.startRosterTimer()):(this.updateRosterDuration(),this.wipeSince=null,this.progress.roster.wipeSince=null,this.clearRosterTimer())}updateBankruptcyDuration(){if(this.bankruptSince===null)return;const a=this.timeSource()-this.bankruptSince;a>this.progress.economy.bankruptDurationMs&&(this.progress.economy.bankruptDurationMs=a)}updateRosterDuration(){if(this.wipeSince===null)return;const a=this.timeSource()-this.wipeSince;a>this.progress.roster.wipeDurationMs&&(this.progress.roster.wipeDurationMs=a)}evaluateResolution(){if(!this.resolution){if(this.progress.sauna.destroyed){this.resolve("lose","saunaDestroyed");return}if(this.progress.strongholds.total>0&&this.progress.strongholds.remaining===0){this.resolve("win","strongholds");return}if(this.wipeSince!==null&&this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.bankruptSince!==null&&this.bankruptcyGraceMs<=0&&this.resolve("lose","bankruptcy")}}resolve(a,s){if(this.resolution)return;this.updateRosterDuration(),this.updateBankruptcyDuration();const r=this.timeSource(),o=Math.max(0,r-this.progress.startedAt),u=Sy({...this.progress,roster:{...this.progress.roster,wipeSince:this.wipeSince},economy:{...this.progress.economy,bankruptSince:this.bankruptSince},sauna:{...this.progress.sauna,destroyedAt:this.saunaDestroyedAt}}),f=this.computeRewards();this.resolution=Object.freeze({outcome:a,cause:s,timestamp:r,durationMs:o,summary:u,rewards:f}),this.emitResolution(),this.dispose()}emitProgress(){const a=this.getProgress();for(const s of this.progressListeners)try{s(a)}catch(r){console.error("Objective progress listener failed",r)}}emitResolution(){if(!this.resolution)return;const a=this.resolution;for(const s of this.resolutionListeners)try{s(a)}catch(r){console.error("Objective resolution listener failed",r)}this.resolutionListeners.clear()}computeRewards(){const a=Ey(this.state);return{resources:{[ae.SAUNA_BEER]:{final:a[ae.SAUNA_BEER],delta:a[ae.SAUNA_BEER]-this.startResources[ae.SAUNA_BEER]},[ae.SAUNAKUNNIA]:{final:a[ae.SAUNAKUNNIA],delta:a[ae.SAUNAKUNNIA]-this.startResources[ae.SAUNAKUNNIA]},[ae.SISU]:{final:a[ae.SISU],delta:a[ae.SISU]-this.startResources[ae.SISU]}}}}coordKey(a){return`${a.q},${a.r}`}isStronghold(a){return a?this.strongholdTypes.has(a):!1}createSaunaProgress(){if(!this.sauna)return{maxHealth:0,health:0,destroyed:!1,destroyedAt:null};const a=Math.max(0,Math.round(this.sauna.maxHealth??0)),s=Math.max(0,Math.round(this.sauna.health??0)),r=!!this.sauna.destroyed||s<=0;return r&&this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),{maxHealth:a,health:s,destroyed:r,destroyedAt:r?this.saunaDestroyedAt:null}}updateSaunaSnapshot(a){const s=Number.isFinite(a)?Math.max(0,Math.round(a)):0,r=this.sauna?Math.max(0,Math.round(this.sauna.maxHealth??0)):0,o=this.progress.sauna.maxHealth,u=Math.max(o,r,s);this.progress.sauna.maxHealth=u;const f=Math.max(0,Math.min(u,s));this.progress.sauna.health=f,f>0&&(this.progress.sauna.destroyed=!1,this.progress.sauna.destroyedAt=null,this.saunaDestroyedAt=null)}markSaunaDestroyed(){if(this.sauna){const a=Math.max(0,Math.round(this.sauna.maxHealth??0));a>this.progress.sauna.maxHealth&&(this.progress.sauna.maxHealth=a)}this.progress.sauna.health=0,this.progress.sauna.destroyed=!0,this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),this.progress.sauna.destroyedAt=this.saunaDestroyedAt}}function OC(n){return new UC(n)}const zn=[{level:1,xpToNext:180,cumulativeXp:0,statAwards:{vigor:0,focus:0,resolve:0}},{level:2,xpToNext:220,cumulativeXp:180,statAwards:{vigor:5,focus:2,resolve:1}},{level:3,xpToNext:260,cumulativeXp:400,statAwards:{vigor:4,focus:3,resolve:1}},{level:4,xpToNext:320,cumulativeXp:660,statAwards:{vigor:4,focus:2,resolve:2}},{level:5,xpToNext:380,cumulativeXp:980,statAwards:{vigor:6,focus:3,resolve:2}},{level:6,xpToNext:460,cumulativeXp:1360,statAwards:{vigor:7,focus:3,resolve:3}},{level:7,xpToNext:540,cumulativeXp:1820,statAwards:{vigor:6,focus:4,resolve:3}},{level:8,xpToNext:640,cumulativeXp:2360,statAwards:{vigor:7,focus:4,resolve:4}},{level:9,xpToNext:760,cumulativeXp:3e3,statAwards:{vigor:8,focus:5,resolve:4}},{level:10,xpToNext:900,cumulativeXp:3760,statAwards:{vigor:9,focus:6,resolve:5}},{level:11,xpToNext:1060,cumulativeXp:4660,statAwards:{vigor:10,focus:6,resolve:6}},{level:12,xpToNext:null,cumulativeXp:5720,statAwards:{vigor:12,focus:7,resolve:6}}];function qC(n){return Number.isNaN(n)||!Number.isFinite(n)?0:Math.max(0,Math.floor(n))}function Th(){return{vigor:0,focus:0,resolve:0}}function zC(n){return{vigor:n.vigor,focus:n.focus,resolve:n.resolve}}function Jc(n){const a=qC(n);let s=zn[0];for(const f of zn)if(a>=f.cumulativeXp)s=f;else break;const r=a-s.cumulativeXp,o=s.xpToNext,u=o?Math.min(1,r/o):1;return{level:s.level,xpIntoLevel:r,xpForNext:o,progressToNext:u,statAwards:s.statAwards}}function BC(n){const a=zn[zn.length-1].level,s=Math.max(zn[0].level,Math.min(n,a)),r=zn.find(o=>o.level===s);return r?zC(r.statAwards):Th()}function HC(n){if(n<=zn[0].level)return Th();const a=zn[zn.length-1].level,s=Math.min(n,a),r=Th();for(const o of zn){if(o.level>s)break;o.level!==zn[0].level&&(r.vigor+=o.statAwards.vigor,r.focus+=o.statAwards.focus,r.resolve+=o.statAwards.resolve)}return r}function jC(n){return Jc(n).level}function Wf(n){return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function Cc(n,a){return a<=0?"":`${n}/${a}`}function GC(n){let a=0;const s=Math.max(0,Wf(n.queueCapacity??2)),r=(f,h)=>{f&&typeof n.log=="function"&&n.log({type:"system",message:f,metadata:{context:"spawn-queue",...h}})},o=()=>{const f=n.getTier();if(!f)return null;const h=Wf(n.getRosterLimit()),m=Wf(n.getRosterCount());return{tierId:f.id,tierName:f.name,rosterLimit:h,rosterCount:m,queued:a}};return{getSnapshot:()=>o(),hasQueuedSpawn:()=>a>0,takeQueuedSpawn:f=>a<=0?!1:(a-=1,a<=0?r(`The benches of ${f.tierName} exhale — queued attendants take the field.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} deploys a queued attendant. Relief teams remaining: ${Cc(a,s)}.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0),restoreQueuedSpawn:f=>{s>0&&a>=s||(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} keeps the relief attendant on standby (${Cc(a,s)} ready).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},queueBlockedSpawn:(f,h)=>s>0&&a>=s?(r(`${f.tierName} cannot hold more relief attendants — clear a slot to vent the pressure.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!1):h()?(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} queues a ready attendant in the wings (${Cc(a,s)} poised).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0):!1,onSpawnResolved:(f,h)=>{h.usedQueue&&(a>0?r(`${f.tierName} still has relief attendants waiting (${Cc(a,s)}).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} has cleared the relief queue.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},clearQueue:f=>{if(!(a<=0)&&(a=0,f==="tier-change")){const h=n.getTier();h&&r(`${h.name} ushers its queued attendants into the new hall.`,{tierId:h.id,tierName:h.name,queue:a,capacity:s})}}}}const ev="autobattles:saunojas";function tv(){try{return globalThis.localStorage??null}catch{return null}}function IC(){const n=tv();if(!n)return[];try{const a=n.getItem(ev);if(!a)return[];const s=JSON.parse(a);if(!Array.isArray(s))return[];const r=[];for(const o of s){if(!o||typeof o!="object")continue;const u=o,f=u.id;if(typeof f!="string"||f.length===0)continue;const h=u.coord,m=h&&typeof h=="object"&&typeof h.q=="number"&&Number.isFinite(h.q)&&typeof h.r=="number"&&Number.isFinite(h.r)?{q:h.q,r:h.r}:void 0,p=u.traits,g=Array.isArray(p)?p.filter(E=>typeof E=="string"):void 0,b=typeof u.upkeep=="number"?u.upkeep:void 0,S=typeof u.xp=="number"?u.xp:void 0;r.push(Zh({id:f,name:typeof u.name=="string"?u.name:void 0,coord:m,maxHp:typeof u.maxHp=="number"?u.maxHp:void 0,hp:typeof u.hp=="number"?u.hp:void 0,steam:typeof u.steam=="number"?u.steam:void 0,traits:g,upkeep:b,xp:S,selected:!!u.selected,items:Array.isArray(u.items)?u.items:void 0,baseStats:u.baseStats,effectiveStats:u.effectiveStats,equipment:u.equipment,modifiers:Array.isArray(u.modifiers)?u.modifiers:void 0}))}return r}catch(a){return console.warn("Failed to load Saunoja units from storage",a),[]}}function YC(n){const a=tv();if(a)try{const s=n.map(r=>({id:r.id,name:r.name,coord:{q:r.coord.q,r:r.coord.r},maxHp:r.maxHp,hp:r.hp,steam:r.steam,traits:[...r.traits],upkeep:r.upkeep,xp:r.xp,selected:r.selected,baseStats:{health:r.baseStats.health,attackDamage:r.baseStats.attackDamage,attackRange:r.baseStats.attackRange,movementRange:r.baseStats.movementRange,...typeof r.baseStats.defense=="number"&&Number.isFinite(r.baseStats.defense)?{defense:r.baseStats.defense}:{},...typeof r.baseStats.shield=="number"&&Number.isFinite(r.baseStats.shield)?{shield:r.baseStats.shield}:{},...typeof r.baseStats.visionRange=="number"&&Number.isFinite(r.baseStats.visionRange)?{visionRange:r.baseStats.visionRange}:{}},effectiveStats:{health:r.effectiveStats.health,attackDamage:r.effectiveStats.attackDamage,attackRange:r.effectiveStats.attackRange,movementRange:r.effectiveStats.movementRange,...typeof r.effectiveStats.defense=="number"&&Number.isFinite(r.effectiveStats.defense)?{defense:r.effectiveStats.defense}:{},...typeof r.effectiveStats.shield=="number"&&Number.isFinite(r.effectiveStats.shield)?{shield:r.effectiveStats.shield}:{},...typeof r.effectiveStats.visionRange=="number"&&Number.isFinite(r.effectiveStats.visionRange)?{visionRange:r.effectiveStats.visionRange}:{}},equipment:ur.reduce((o,u)=>{const f=r.equipment?.[u]??null;return o[u]=f?{id:f.id,name:f.name,description:f.description,icon:f.icon,rarity:f.rarity,quantity:f.quantity,slot:f.slot}:null,o},{}),items:r.items.map(o=>({id:o.id,name:o.name,description:o.description,icon:o.icon,rarity:o.rarity,quantity:o.quantity})),modifiers:r.modifiers.map(o=>({id:o.id,name:o.name,description:o.description,remaining:o.remaining,duration:o.duration,appliedAt:o.appliedAt,stacks:o.stacks,source:o.source}))}));a.setItem(ev,JSON.stringify(s))}catch(s){console.warn("Failed to persist Saunoja units",s)}}const nv="autobattles:sauna-settings";function av(){try{return globalThis.localStorage??null}catch{return null}}function FC(n){return typeof n=="string"?la(n).id:Gl}function My(n){return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function rm(n,a){const s=My(n),r=My(a),o=1+ql;return Math.max(0,Math.min(o,s,r))}function iv(n,a,s){const r=rm(s,s),o=typeof n=="number"&&Number.isFinite(n)?n:a,u=Math.max(0,Math.floor(o));return Math.max(0,Math.min(r,u))}function sv(n){return n===!0||n==="true"}function Sl(n,a){const s=FC(n?.activeTierId),r=la(s),o=rm(r.rosterCap,a);return{activeTierId:r.id,maxRosterSize:iv(n?.maxRosterSize,o,o),useUiV2:sv(n?.useUiV2)}}function rv(n=1+ql){const a=av();if(!a)return Sl(null,n);try{const s=a.getItem(nv);if(!s)return Sl(null,n);const r=JSON.parse(s);return Sl(!r||typeof r!="object"?null:r,n)}catch(s){return console.warn("Failed to load sauna settings from storage",s),Sl(null,n)}}function lv(n){const a=av();if(!a)return;const s=la(n.activeTierId),r=rm(s.rosterCap,s.rosterCap),o={activeTierId:s.id,maxRosterSize:iv(n.maxRosterSize,r,r),useUiV2:sv(n.useUiV2)};try{a.setItem(nv,JSON.stringify(o))}catch(u){console.warn("Failed to persist sauna settings",u)}}const $C=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),VC=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function ov(n){return Number.isFinite(n)?Math.max(0,Math.min(100,Math.round(n*100))):0}function XC(n){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});if(n.xpForNext===null)return`${a.format(n.xp)} XP • Max level`;const s=ov(n.progress);return`${a.format(n.xpIntoLevel)} / ${a.format(n.xpForNext)} XP • ${s}%`}function KC(n){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),s=[];return n.vigor>0&&s.push(`+${a.format(n.vigor)} Vigor`),n.focus>0&&s.push(`+${a.format(n.focus)} Focus`),n.resolve>0&&s.push(`+${a.format(n.resolve)} Resolve`),s.length>0?s.join(" • "):"No level bonuses yet"}function QC(n,a){const{rosterIcon:s,summaryLabel:r="Saunoja Roster"}=a;n.classList.add("sauna-roster"),n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("title","Active sauna battalion on the field"),n.dataset.tutorialTarget="upkeep",n.replaceChildren();const o=document.createElement("div");o.classList.add("sauna-roster__summary");const u=document.createElement("img");u.src=s,u.alt="Saunoja roster crest",u.decoding="async",u.classList.add("sauna-roster__icon");const f=document.createElement("div");f.classList.add("sauna-roster__text");const h=document.createElement("span");h.textContent=r,h.classList.add("sauna-roster__label");const m=document.createElement("span");m.textContent="0",m.classList.add("sauna-roster__value"),f.append(h,m),o.append(u,f);const p=document.createElement("div");p.classList.add("saunoja-card"),p.setAttribute("aria-live","polite"),p.hidden=!0;const g=document.createElement("div");g.classList.add("saunoja-card__header");const b=document.createElement("div");b.classList.add("saunoja-card__level"),b.setAttribute("role","img"),b.style.setProperty("--level-progress","0%");const S=document.createElement("span");S.classList.add("saunoja-card__level-value"),S.textContent="1",b.appendChild(S);const E=document.createElement("div");E.classList.add("saunoja-card__identity");const w=document.createElement("h3");w.classList.add("saunoja-card__name"),w.textContent="Saunoja";const R=document.createElement("div");R.classList.add("saunoja-card__xp"),R.textContent="0 / 0 XP • 0%",E.append(w,R),g.append(b,E);const _=document.createElement("p");_.classList.add("saunoja-card__traits");const U=document.createElement("div");U.classList.add("saunoja-card__callouts"),U.textContent="No level bonuses yet";const B=document.createElement("p");B.classList.add("saunoja-card__upkeep"),p.append(g,_,U,B),n.append(o,p);let G=null,F=null;function P(N){if(!N){p.hidden=!0;return}p.hidden=!1,p.dataset.unitId=N.id,w.textContent=N.name||"Saunoja";const L=N.traits.filter(M=>M.length>0),A=L.length>0?L.join(", "):"No notable traits yet";_.textContent=A,_.title=A;const $=XC(N.progression);R.textContent=$,R.title=$;const H=ov(N.progression.progress);b.style.setProperty("--level-progress",`${H}%`),S.textContent=String(N.progression.level);const T=N.progression.xpForNext===null?`Level ${N.progression.level}, at mastery`:`Level ${N.progression.level}, ${H}% toward next level`;b.setAttribute("aria-label",T);const I=KC(N.progression.statBonuses);U.textContent=I,U.title=I;const J=Math.max(0,Math.round(N.upkeep)),fe=`Upkeep: ${VC.format(J)} Beer`;B.textContent=fe,B.title=fe}function ie(N){return N===1/0?"inf":!Number.isFinite(N)||N<=0?"0":String(Math.ceil(N))}function se(N){return[N.id,N.name,N.icon??"",N.rarity??"",N.description??"",N.quantity].join("^")}function le(N){return[N.id,N.name,N.description??"",ie(N.duration),ie(N.remaining),N.appliedAt??"",N.stacks??1,N.source??""].join("^")}function ne(N){const{stats:L}=N,A=N.traits.join("|"),$=N.items.map(se).join("|"),H=N.modifiers.map(le).join("|");return[N.id,N.name,N.upkeep,N.status,N.selected?1:0,N.progression.level,N.progression.xp,N.progression.xpIntoLevel,N.progression.xpForNext??"max",L.health,L.maxHealth,L.attackDamage,L.attackRange,L.movementRange,L.defense??0,L.shield??0,A,$,H].join("~")}function Y(N){return`${N.length}:${N.map(ne).join("||")}`}return{updateSummary(N){const L=Math.max(0,Math.floor(N.count)),A=$C.format(L);m.textContent=A,n.setAttribute("aria-label",`Saunoja roster: ${A} active attendants`),n.setAttribute("title",`Saunoja roster • ${A} active attendants`),P(N.card)},installRenderer(N){F=null,G=N},renderRoster(N){if(!G)return;const L=Y(N);L!==F&&(F=L,G(N))},destroy(){G=null,F=null,n.replaceChildren()}}}const PC={[ae.SAUNA_BEER]:"Sauna Beer",[ae.SAUNAKUNNIA]:"Saunakunnia",[ae.SISU]:"Sisu"},ZC='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function JC(n){if(!Number.isFinite(n)||n<=0)return"0:00";const a=Math.round(n/1e3),s=Math.max(0,a%60).toString().padStart(2,"0"),r=Math.floor(a/60),o=(r%60).toString().padStart(2,"0"),u=Math.floor(r/60);return u>0?`${u}:${o}:${s}`:`${r}:${s}`}function WC(n){switch(n.cause){case"strongholds":return"All rival strongholds have fallen.";case"rosterWipe":return"Every attendant is down—no one remains to hold the line.";case"bankruptcy":return"Upkeep debts have exhausted the steam reserves.";case"saunaDestroyed":return"The sauna collapsed under relentless assault—the sacred steamline has fallen silent.";default:return""}}function eT(n){if(!Number.isFinite(n)||n===0)return"±0";const a=Math.round(n*100)/100;return`${a>0?"+":""}${a}`}function tT(n,a){const s=document.createElement("ul");s.className="end-screen__rewards-list";for(const r of Object.values(ae)){const o=n.rewards.resources[r];if(!o)continue;const u=document.createElement("li");u.className="end-screen__reward-item";const f=document.createElement("span");f.className="end-screen__reward-label",f.textContent=a[r]??r;const h=document.createElement("span");h.className="end-screen__reward-value",h.textContent=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(o.final));const m=document.createElement("span");m.className="end-screen__reward-delta",m.textContent=eT(o.delta),m.dataset.polarity=o.delta>=0?"positive":"negative",u.append(f,h,m),s.append(u)}return s}function nT(n,a,s){const r=o=>{if(o.key==="Escape"){o.preventDefault(),s?.();return}if(o.key!=="Tab")return;const u=a.querySelectorAll(ZC);if(u.length===0){o.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;o.shiftKey?(m===f||!a.contains(m))&&(o.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(o.preventDefault(),f.focus())};return n.addEventListener("keydown",r),()=>n.removeEventListener("keydown",r)}function aT(n){const{container:a,resolution:s,onNewRun:r,onDismiss:o,currentNgPlusLevel:u}=n;if(!a)return{destroy(){},focusPrimary(){}};const f={...PC,...n.resourceLabels??{}},h=document.createElement("div");h.className="end-screen",h.setAttribute("role","presentation");const m=document.createElement("section");m.className="end-screen__panel",m.setAttribute("role","dialog"),m.setAttribute("aria-modal","true");const p=`end-screen-title-${Date.now()}`;m.setAttribute("aria-labelledby",p),m.tabIndex=-1,m.dataset.outcome=s.outcome;const g=document.createElement("h2");g.className="end-screen__title",g.id=p,g.textContent=s.outcome==="win"?"Steamforged Victory":"Sauna Lost";const b=document.createElement("p");b.className="end-screen__subtitle",b.textContent=WC(s);const S=document.createElement("dl");S.className="end-screen__metrics";const E=(le,ne)=>{const Y=document.createElement("dt");Y.textContent=le,Y.className="end-screen__metric-label";const N=document.createElement("dd");N.textContent=ne,N.className="end-screen__metric-value",S.append(Y,N)};E("Run time",JC(s.durationMs)),E("Strongholds",`${s.summary.strongholds.destroyed}/${s.summary.strongholds.total}`),E("Roster losses",`${s.summary.roster.totalDeaths}`),E("Deepest beer reserve",`${Math.round(s.summary.economy.worstBeer)}`);const w=document.createElement("div");w.className="end-screen__badges";const R=document.createElement("span");R.className="end-screen__badge",R.textContent=`NG+ ${Math.max(0,u)}`,w.append(R);const _=document.createElement("h3");_.className="end-screen__section-title",_.textContent="Rewards";const U=tT(s,f),B=document.createElement("div");B.className="end-screen__actions";const G=document.createElement("button");G.type="button",G.className="end-screen__button end-screen__button--primary",G.textContent="New run (NG+)",G.addEventListener("click",()=>{r()});const F=document.createElement("button");F.type="button",F.className="end-screen__button",F.textContent="Review battlefield",F.addEventListener("click",()=>{o?.()}),B.append(G,F),m.append(g,b,w,S,_,U,B),h.append(m),a.append(h);const P=nT(h,m,o),ie=()=>{P(),h.remove()},se=()=>{requestAnimationFrame(()=>{G.focus({preventScroll:!0})})};return se(),{destroy:ie,focusPrimary:se}}const cv="autobattles4x.flags";function uv(){if(typeof window>"u")return null;try{if("localStorage"in window&&window.localStorage)return window.localStorage}catch(n){console.warn("Unable to access localStorage for local flags",n)}return null}function dv(){const n=uv();if(!n)return{};try{const a=n.getItem(cv);if(!a)return{};const s=JSON.parse(a);if(s&&typeof s=="object")return s}catch(a){console.warn("Failed to parse local flags, resetting.",a)}return{}}function iT(n){const a=uv();if(a)try{const s={};n.tutorial_done&&(s.tutorial_done=!0),a.setItem(cv,JSON.stringify(s))}catch(s){console.warn("Failed to persist local flags",s)}}function sT(){return dv().tutorial_done===!0}function xy(n){const a={...dv()};a.tutorial_done=!0,iT(a)}const eh=200,th=3,rT=2,wy=6,lT=40,oT=250,cT=200,uT=jC(Number.MAX_SAFE_INTEGER),_h={[ae.SAUNA_BEER]:"Sauna Beer",[ae.SAUNAKUNNIA]:"Saunakunnia",[ae.SISU]:"Sisu"};function fv(n,a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;if(!Number.isFinite(n))return s;const r=Math.max(0,Math.floor(n));return Math.max(0,Math.min(s,r))}let Ot=Ha(e3()),hv=1,lm=0,fu=1,Uc={aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1},mv=1,pv=Math.random,gv=Math.random,om=null;function Wc(n){Ot=Ha(n),hv=n3(Ot),lm=a3(Ot),fu=s3(Ot),Uc=r3(Ot),mv=i3(Ot),pv=Vg(Ot.runSeed,1),gv=Vg(Ot.runSeed,2),om?.({persist:!0})}Wc(Ot);let eu=null,Ge=[];const ra=new Map,Ai=new Map,cs=new Map;let Ay=0,tu=null,na=null,$a=null,sr=null,Hn=null,rr=null,kt=null,ss=null,Nl=null,Ia=null,Ci=null,rs=!1,Mn=null,Ti=null,Wn=null,kl=null,ts=0;function yv(n){const a=Ai.get(n.id);return a?cs.get(a)??null:null}function bv(n,a){n.effectiveStats={...a},n.maxHp=Math.max(1,Math.round(a.health)),n.hp=Math.min(n.maxHp,Math.max(0,Math.round(n.hp))),n.defense=typeof a.defense=="number"?Math.max(0,a.defense):void 0,n.shield=typeof a.shield=="number"?Math.max(0,a.shield):0;const s=yv(n);if(s){const r={health:n.effectiveStats.health,attackDamage:n.effectiveStats.attackDamage,attackRange:n.effectiveStats.attackRange,movementRange:n.effectiveStats.movementRange};typeof n.effectiveStats.defense=="number"&&(r.defense=n.effectiveStats.defense),typeof n.effectiveStats.visionRange=="number"&&(r.visionRange=n.effectiveStats.visionRange),s.updateStats(r),typeof n.effectiveStats.shield=="number"?s.setShield(n.effectiveStats.shield):n.shield<=0&&s.setShield(0)}}function hu(n,a){const s=a??Bn(n.equipment),r=Gc(n.baseStats,s);return bv(n,r),r}function vv(n){const a=Jc(n.xp);return{level:a.level,xp:Math.max(0,Math.floor(n.xp)),xpIntoLevel:a.xpIntoLevel,xpForNext:a.xpForNext,progress:a.progressToNext,statBonuses:HC(a.level)}}function dT(n){const a=[];return n.vigor>0&&a.push(`+${n.vigor} Vigor`),n.focus>0&&a.push(`+${n.focus} Focus`),n.resolve>0&&a.push(`+${n.resolve} Resolve`),a.length>0?a.join(", "):"+0 Vigor, +0 Focus, +0 Resolve"}function Sv(n,a,s){if(!Number.isFinite(a)||a<=0)return null;const r=Jc(n.xp),o=Math.max(0,Math.floor(n.xp+a));if(o===n.xp)return null;n.xp=o;const u=Jc(n.xp),f=Math.max(0,u.level-r.level),h={vigor:0,focus:0,resolve:0};let m=0;if(f>0){for(let g=r.level+1;g<=u.level&&g<=uT;g++){const b=BC(g);h.vigor+=b.vigor,h.focus+=b.focus,h.resolve+=b.resolve;const S=Number.isFinite(n.baseStats.health)?n.baseStats.health:n.effectiveStats.health;n.baseStats.health=Math.max(1,Math.round(S+b.vigor));const E=Number.isFinite(n.baseStats.attackDamage)?n.baseStats.attackDamage:n.effectiveStats.attackDamage;n.baseStats.attackDamage=Math.max(0,Math.round(E+b.focus));const R=(Number.isFinite(n.baseStats.defense)?n.baseStats.defense??0:n.effectiveStats.defense??0)+b.resolve;n.baseStats.defense=R>0?R:void 0}m=h.vigor}m>0&&(n.hp+=m),hu(n);const p=yv(n);if(p&&p.setExperience(n.xp),s.source==="kill"){const g=n.name?.trim()||"Our champion",b=s.label?.trim()||"their foe",S=s.boss?" Boss toppled!":s.elite?" Elite threat routed!":"";qt({type:"combat",message:`${g} earns ${a} XP for defeating ${b}.${S}`,metadata:{slayer:g,foe:b,xpAward:a,boss:!!s.boss,elite:!!s.elite}})}if(f>0){const g=dT(h),b=n.name?.trim()||"Our champion";qt({type:"progression",message:`${b} reaches Level ${u.level}! ${g}.`,metadata:{unit:b,level:u.level,levelsGained:f,bonuses:h}})}return{xpAwarded:a,totalXp:n.xp,level:u.level,levelsGained:f,statBonuses:h}}function fT(n,a,s){if(!n)return null;const r=ra.get(n.id);return r?Sv(r,a,s):null}function hT(n,a){if(!Number.isFinite(n)||n<=0)return!1;let s=!1;for(const r of Ge)Sv(r,n,a)&&(s=!0);return s}function mT(n){return n?(n.type?.toLowerCase?.()??"").includes("boss")?{xp:oT,elite:!0,boss:!0}:Uv(n)?{xp:lT,elite:!0,boss:!1}:{xp:wy,elite:!1,boss:!1}:{xp:wy,elite:!1,boss:!1}}const Ev=n=>{if(!n)return;const a=Math.max(0,Math.floor(n.strongholds.destroyed));if(a>ts){const s=a-ts,r=cT*s;hT(r,{source:"objective",label:"stronghold"})&&(oa(),Gn(),qt({type:"progression",message:`Strategists toast the captured stronghold — roster gains ${r} XP.`,metadata:{source:"stronghold",xpAward:r}}))}if(a<ts){ts=a;return}ts=a},pT=Object.freeze(["health","attackDamage","attackRange","movementRange","defense","shield"]);function Cy(n){return n?{id:n.id,name:n.name,quantity:n.quantity,rarity:n.rarity}:null}function Ty(n,a){const s=n[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function gT(n,a){const s=[];for(const r of pT){const o=Ty(a,r),u=Ty(n,r),f=o-u;f!==0&&s.push({stat:r,delta:f})}return s}function yT(n,a){if(!a||Bn(n.equipment).length>0)return;const r={health:Math.max(1,Math.round(a.getMaxHealth())),attackDamage:Math.max(0,Math.round(a.stats.attackDamage)),attackRange:Math.max(0,Math.round(a.stats.attackRange)),movementRange:Math.max(0,Math.round(a.stats.movementRange)),defense:typeof a.stats.defense=="number"&&Number.isFinite(a.stats.defense)?Math.max(0,a.stats.defense):n.baseStats.defense,shield:n.baseStats.shield??0,visionRange:typeof a.stats.visionRange=="number"&&Number.isFinite(a.stats.visionRange)?Math.max(0,a.stats.visionRange):n.baseStats.visionRange};n.baseStats=r,hu(n)}function wl(){kl&&(kl.destroy(),kl=null)}function bT(){if(sT()){wl();return}wl(),kl=Qx({onComplete:()=>{xy(),wl()},onSkip:()=>{xy(),wl()}}),kl.start()}function _y(n){Nl=n,kt&&(kt.installRenderer(n),Ia&&(kt.renderRoster(Ia),Ia=null))}function vT(){return IC()}function oa(){YC(Ge)}function ST(n=Math.random){typeof n!="function"&&(n=Math.random);const a=Math.max(0,Math.floor(ar)),s=Math.max(a,Math.floor(kc));if(s===a)return Math.max(ar,Math.min(kc,a));const r=s-a+1,o=Math.floor(n()*r)+a;return Math.max(ar,Math.min(kc,o))}function ET(n){const s=(Array.isArray(n.traits)?n.traits:[]).length>=3,r=Number.isFinite(n.upkeep),o=Number.isFinite(n.xp);return!s||!r||!o}function Mv(n){n.traits=xA(),n.upkeep=ST(),n.xp=0}function MT(n,a,s,r={}){const o=r.hudVariant??"classic",u=o==="classic";s.dataset.hudVariant=o,eu=n,Mn&&(Mn.dispose(),Mn=null),Mn=gA({canvas:n,overlay:s,mapRenderer:cm,getUnitById:h=>cs.get(h),requestDraw:()=>{zt()}}),kt&&(kt.destroy(),kt=null),u?(kt=QC(a,{rosterIcon:wi.saunojaRoster}),Nl&&kt.installRenderer(Nl),Ia&&(kt.renderRoster(Ia),Ia=null),ss&&(kt.updateSummary(ss),ss=null)):(Nl=null,Ia=null,ss=null),Hn?.dispose(),Hn=null,u&&(Hn=DM(it,{getRosterCapLimit:()=>pu(),updateMaxRosterSize:(h,m)=>Ol(h,{persist:m?.persist}),getActiveTierId:()=>dt,setActiveTierId:(h,m)=>(kT(h,{persist:m?.persist})&&Hn?.update(),dt),getTierContext:()=>pm()})),$a?.dispose(),$a=null,sr?.destroy(),sr=null;const f={useSisuBurst:()=>{const h=KM($e,St);return h?(ia("sisu"),qt({type:"ability",message:`Sisu bursts forth, spending ${ns} grit to steel our attendants.`,metadata:{ability:"sisu-burst",cost:ns}})):ia("error"),h},torille:()=>{const h=PM($e,St,it.pos,Jt);return h?qt({type:"ability",message:`Torille! Our warriors regroup at the sauna to rally their spirits for ${as} SISU.`,metadata:{ability:"torille",cost:as}}):ia("error"),h}};u&&($a=LM($e,{saunakunnia:wi.resource,sisu:wi.sisu,saunaBeer:wi.saunaBeer})),sr=gx($e,s,f),rr?.destroy(),rr=null,u&&(rr=lC(Ul,{getSelectedUnitId:()=>Ge.find(h=>h.selected)?.id??null,getComparisonContext:()=>OT(),onEquip:(h,m,p)=>ym(h,m),getUseUiV2:RT,onUseUiV2Change:NT})),u?(qT(),um(),Gn(),bT()):na&&(na(),na=null)}const Jt=new h3(10,10,32),xv=new Zw(()=>zt()),xT=new DE(Jt,xv),cm=new Bw(Jt),nu=()=>{cm.invalidateCache(),zt()};te.on("buildingPlaced",nu);te.on("buildingRemoved",nu);Jt.forEachTile(n=>n.setFogged(!0));JS();const St=[];function Ry(n){return`${n.q},${n.r}`}function wT(){const n=new Set;for(const m of St)m.isDead()||n.add(Ry(m.coord));const a=[],{minQ:s,maxQ:r,minR:o,maxR:u}=Jt,f=m=>{const p=Ry(m);n.has(p)||(Jt.ensureTile(m.q,m.r),a.push(m))};for(let m=s;m<=r;m++)f({q:m,r:o}),u!==o&&f({q:m,r:u});for(let m=o+1;m<=u-1;m++)f({q:s,r:m}),r!==s&&f({q:r,r:m});if(a.length===0)return;const h=Math.floor(Math.random()*a.length);return a[h]}function AT(n){const a=ra.get(n);a&&(ra.delete(n),Ai.get(a.id)===n&&Ai.delete(a.id))}function CT(n){const a=ra.get(n.id);if(a)return{saunoja:a,created:!1,attached:!1};let s=Ge.find(f=>f.id===n.id);s||(s=Ge.find(f=>!Ai.has(f.id)));let r=!1;s||(s=Zh({id:`saunoja-${Ge.length+1}`,coord:{q:n.coord.q,r:n.coord.r}}),Ge.push(s),r=!0);const o=Ai.get(s.id);o&&o!==n.id&&ra.delete(o),ra.set(n.id,s),Ai.set(s.id,n.id),yT(s,n),bv(s,s.effectiveStats),n.setExperience(s.xp);const u=ET(s);return(r||u)&&Mv(s),{saunoja:s,created:r,attached:!0}}function um(){let n=!1;for(const a of St){if(a.faction!=="player"||a.isDead())continue;const{saunoja:s,created:r,attached:o}=CT(a);(r||o)&&(n=!0);const u=Number.isFinite(a.stats.health)?Math.max(0,a.stats.health):0;s.hp!==u&&(s.hp=u,n=!0);const f=Number.isFinite(a.getMaxHealth())?Math.max(1,a.getMaxHealth()):1;s.maxHp!==f&&(s.maxHp=f,n=!0);const h=a.getShield(),m=Number.isFinite(h)?Math.max(0,h):0;s.shield!==m&&(s.shield=m,n=!0);const g=a?.lastHitAt;Number.isFinite(g)&&s.lastHitAt!==g&&(s.lastHitAt=g,n=!0);const{q:b,r:S}=a.coord;(s.coord.q!==b||s.coord.r!==S)&&(s.coord={q:b,r:S},n=!0,s.selected&&gm(s.coord))}return n&&oa(),n}function wv(n,a){if(n.faction==="player"){const u=(a??ra.get(n.id)??null)?.name?.trim();if(u)return u}return`${(n.constructor?.name??"Unit").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase()} ${n.id}`.trim()}function mu(n){if(cs.has(n.id))return;St.push(n),cs.set(n.id,n);let a=null;if(n.faction==="player"&&(um()||Il(),a=ra.get(n.id)??null),eu&&zt(),n.faction==="player"){const r=wv(n,a);qt({type:"spawn",message:`Our ${r} emerges from the steam.`,metadata:{unitId:n.id,unitName:r,steward:"Our"}}),Gn()}}const Av=({unit:n})=>{mu(n)};te.on("unitSpawned",Av);const Cv=()=>{Il()},lr=()=>{Il()};te.on("inventoryChanged",Cv);te.on("modifierAdded",lr);te.on("modifierRemoved",lr);te.on("modifierExpired",lr);const Tv=n=>{Hn?.handleDamage?.(n)},_v=n=>{Hn?.handleDestroyed?.(n)};te.on("saunaDamaged",Tv);te.on("saunaDestroyed",_v);const Rv=()=>{Gn()};te.on("unit:stats:changed",Rv);function TT(n){const a=ra.get(n.id);if(!a)return 0;const s=Number.isFinite(a.upkeep)?a.upkeep:0;return s>0?s*hv:0}const $e=new o3(1e3),Ul=new RA,dm=$e.load(Jt);if(dm){const n=$e.getNgPlusState();Wc(n),lh(n)}else{const n=$e.setNgPlusState(Ot);Wc(n),lh(n)}$e.setEnemyScalingBase({aggression:Uc.aggressionMultiplier,cadence:Uc.cadenceMultiplier,strength:Uc.strengthMultiplier});if(!dm&&Ot.ngPlusLevel>0){const n=Math.round(75*Ot.ngPlusLevel);n>0&&$e.addResource(ae.SAUNA_BEER,n)}const or=rv(fu),Nv=()=>({ngPlusLevel:Ot.ngPlusLevel,unlockSlots:Ot.unlockSlots});let dt=or.activeTierId,hr=or.useUiV2;const _T=fr(la(dt),Nv());_T.unlocked||(dt=Gl);const pu=()=>{const n=la(dt),a=Math.max(0,Math.floor(n.rosterCap));return Math.min(a,fu)},au=fv(or.maxRosterSize,pu());(au!==or.maxRosterSize||or.activeTierId!==dt||or.useUiV2!==hr)&&lv({maxRosterSize:au,activeTierId:dt,useUiV2:hr});const it=RE({q:Math.floor(Jt.width/2),r:Math.floor(Jt.height/2)},void 0,{maxRosterSize:au}),RT=()=>hr,NT=n=>{const a=!!n;hr!==a&&mm(it.maxRosterSize,{useUiV2:a})},fm=GC({getTier:()=>la(dt),getRosterLimit:()=>pu(),getRosterCount:()=>gu(),log:n=>qt(n),queueCapacity:3});let kv=au,hm=dt;const mm=(n,a)=>{typeof a?.useUiV2=="boolean"&&(hr=a.useUiV2),lv({maxRosterSize:n,activeTierId:dt,useUiV2:hr}),kv=n,hm=dt},pm=()=>Nv(),Ol=(n,a={})=>{const s=pu(),r=fv(n,s);return r!==it.maxRosterSize&&(it.maxRosterSize=r),a.persist&&(dt!==hm||r!==kv)&&mm(r),r};om=(n={})=>{const a=pm(),s=bb();let r=Gl;for(const f of s)if(fr(f,a).unlocked)r=f.id;else break;if(!fr(la(dt),a).unlocked||dt!==r){const f=dt;dt=r,fm.clearQueue?.("tier-change"),Ol(it.maxRosterSize,{persist:n.persist}),f!==dt&&Hn?.update?.();return}n.persist&&Ol(it.maxRosterSize,{persist:!0})};om({persist:!0});const kT=(n,a={})=>{const s=la(n);return fr(s,pm()).unlocked?s.id===dt?(a.persist&&dt!==hm&&mm(it.maxRosterSize),!0):(dt=s.id,fm.clearQueue?.("tier-change"),Ol(it.maxRosterSize,{persist:a.persist}),!0):!1},DT=n=>{Ay+=1;const a=`p${Date.now()}-${Ay}`,s=Qh($e,"soldier",a,n,"player");return s&&mu(s),s??null},Ny=new MM({difficulty:mv,random:pv,eliteOdds:lm}),Dv=new c3(1e3,n=>{const a=n/1e3;$e.tick(),Nc.tick(a,{state:$e});const s=$e.getEnemyScalingSnapshot(),r=Ol(it.maxRosterSize);CA({dt:a,state:$e,sauna:it,heat:it.heatTracker,units:St,getUnitUpkeep:TT,pickSpawnTile:()=>Wy(it.pos,St),spawnBaseUnit:DT,minUpkeepReserve:Math.max(1,ar),maxSpawns:fu,rosterCap:r,getRosterCount:gu,tierHelpers:fm});const o={aggressionMultiplier:s.aggression,cadenceMultiplier:s.cadence,strengthMultiplier:s.strength,calmSecondsRemaining:s.calmSecondsRemaining};Ny.update(a,St,mu,wT,o),$e.advanceEnemyCalm(a);const u=Ny.getSnapshot(),f=Math.max(s.calmSecondsRemaining,u.calmSecondsRemaining);if($a){const m={stage:u.rampStageLabel,stageIndex:u.rampStageIndex,bundleTier:u.bundleTier,multiplier:u.difficultyMultiplier,cadenceSeconds:u.cadence,effectiveDifficulty:u.effectiveDifficulty,aggressionMultiplier:u.aggressionMultiplier,cadenceMultiplier:u.cadenceMultiplier,strengthMultiplier:u.strengthMultiplier,calmSecondsRemaining:f,spawnCycles:u.spawnCycles};$a.setEnemyRampSummary(m)}const h=Ti?.getProgress().roster;TM(u,{wipeSince:h?.wipeSince??null,wipeDurationMs:h?.wipeDurationMs??0}),xT.tick(St,a,it),uE(a),um()&&Gn(),$e.save();for(const m of St)m.isDead()||m.faction!=="player"||Jt.revealAround(m.coord,m.getVisionRange(),{autoFrame:!1});zt()}),LT=n=>{rs&&(rs=!1),Dv.stop(),Ci!==null&&(cancelAnimationFrame(Ci),Ci=null),zt();const a=document.getElementById("ui-overlay");if(!a)return;Wn&&(Wn.destroy(),Wn=null);const s=Ot.ngPlusLevel,r=t3(Ot,{outcome:n.outcome});lh(r),$e.setNgPlusState(r),Wc(r),Wn=aT({container:a,resolution:n,currentNgPlusLevel:s,resourceLabels:_h,onNewRun:()=>{try{typeof window<"u"&&window.localStorage?.removeItem?.("gameState")}catch(u){console.warn("Failed to reset saved game state for NG+",u)}typeof window<"u"&&typeof window.location?.reload=="function"&&window.setTimeout(()=>window.location.reload(),75)},onDismiss:()=>{Wn&&(Wn.destroy(),Wn=null)}})};Ge=vT();if(Ge.length===0){const n=Zh({id:"saunoja-1",coord:it.pos,selected:!0,upkeep:0});Mv(n),n.upkeep=0,Ge.push(n),oa()}else{let n=!1,a=!1;for(const s of Ge)s.selected&&(n?(s.selected=!1,a=!0):n=!0);a&&oa()}const UT=St.some(n=>n.faction==="player"&&!n.isDead());if(!UT){$e.canAfford(y2,ae.SAUNA_BEER)||$e.addResource(ae.SAUNA_BEER,y2);const n=`u${St.length+1}`,a=Qh($e,"soldier",n,it.pos,"player");a&&mu(a)}Jt.revealAround(it.pos,3);Ti=OC({state:$e,map:Jt,getRosterCount:gu,sauna:it,rosterWipeGraceMs:8e3,bankruptcyGraceMs:12e3});ts=Ti.getProgress().strongholds.destroyed;Ti.onProgress(Ev);Ti.onResolution(LT);function OT(){const n=Ge.find(a=>a.selected)??null;return n?{baseStats:{...n.baseStats},loadout:Bn(n.equipment),currentStats:{...n.effectiveStats}}:null}function qT(){na&&(na(),na=null);const n=$x($e,{onRosterSelect:jT,onRosterRendererReady:_y,onRosterEquipSlot:IT,onRosterUnequipSlot:YT});n.addEvent,_y(n.renderRoster),na=n.dispose}function zT(){Hn?.update()}function ky(n){$a?.update(n)}dm||($e.addResource(ae.SAUNA_BEER,eh),qt({type:"resource",message:`Quartermaster stocks ${eh} bottles of ${_h[ae.SAUNA_BEER]} to launch your campaign.`,metadata:{resource:ae.SAUNA_BEER,amount:eh,context:"initial"}}),$e.addResource(ae.SAUNAKUNNIA,th),qt({type:"resource",message:`Sauna elders honor your leadership with ${th} ${_h[ae.SAUNAKUNNIA]} to celebrate your arrival.`,metadata:{resource:ae.SAUNAKUNNIA,amount:th,context:"initial"}}));const nh=Ge.find(n=>n.selected);nh&&(tu={q:nh.coord.q,r:nh.coord.r});function BT(n,a){return!n||!a?n===a:n.q===a.q&&n.r===a.r}function gm(n){return BT(tu,n)?!1:(tu=n?{q:n.q,r:n.r}:null,!0)}function Lv(n){let a=!1;for(const s of Ge)n&&s===n||s.selected&&(s.selected=!1,a=!0);return a}function HT(){let n=!1;return Lv()&&(n=!0),gm(null)&&(n=!0),n}function Uv(n){if(!n)return!1;const a=Kh(n.type);if(!a)return!1;const s=Bl(a,1),r=n.stats;return r.health>s.health||r.attackDamage>s.attackDamage||r.attackRange>s.attackRange||r.movementRange>s.movementRange}function Ov(n){let a=!1;return n.selected||(n.selected=!0,a=!0),Lv(n)&&(a=!0),gm(n.coord)&&(a=!0),a}function jT(n){const a=Ge.find(s=>s.id===n);a&&Ov(a)&&(oa(),Gn(),zt())}function qv(n){const a=XS(n.x,n.y,Jt.hexSize),s=Ge.find(o=>o.coord.q===a.q&&o.coord.r===a.r);(s?Ov(s):HT())&&(oa(),Gn(),zt())}function ym(n,a){const s=Ge.find(p=>p.id===n);if(!s)return{success:!1,reason:"unit-missing"};const r=Bn(s.equipment),o=Gc(s.baseStats,r),u=FE(s,a);if(!u.success)return{success:!1,reason:u.reason};const f=hu(s,u.loadout);te.emit("unit:stats:changed",{unitId:s.id,stats:f}),te.emit("inventoryChanged",{}),oa(),Gn();const h=r.find(p=>p.slot===u.slot)??null;return{success:!0,comparison:{slot:u.slot,previous:Cy(h),next:Cy(u.item??null),deltas:gT(o,f)}}}function GT(n,a){const s=Ge.find(b=>b.id===n);if(!s)return null;const r=$E(s,a);if(!r.success||!r.removed)return null;const o=hu(s,r.loadout);te.emit("unit:stats:changed",{unitId:s.id,stats:o}),te.emit("inventoryChanged",{}),oa(),Gn();const{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}=r.removed;return{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}}function IT(n,a){const r=Ul.getStash().findIndex(o=>VE(o.id,a));return r===-1?!1:Ul.equipFromStash(r,n,ym)}function YT(n,a){return Ul.unequipToStash(n,a,GT)}function zt(){if(!eu)return;const n=eu.getContext("2d"),a=Wb();if(!n||!a)return;if(Mn){const m=typeof performance<"u"?performance.now():Date.now();Mn.step(m)}const s=Mn?.getShakeOffset()??{x:0,y:0},r=Mn?{getUnitAlpha:m=>Mn.getUnitAlpha(m.id)}:void 0,o=Array.isArray(Ge)&&Ge.length>0,u=St.filter(m=>m.faction==="player"&&!m.isDead()),f=it?{coord:it.pos,range:it.auraRadius}:null,h=o?St.filter(m=>m.faction!=="player"):St;n.save(),(s.x!==0||s.y!==0)&&n.translate(s.x,s.y),Kw(n,cm,a.images,h,tu,{saunojas:{units:Ge,draw:vA},sauna:it,saunaVision:f,fx:r,friendlyVisionSources:u}),n.restore()}const zv=({policy:n})=>{qt({type:"policy",message:`Sauna council toasts a fresh keg for policy: ${n.name}.`,metadata:{policy:n.id,name:n.name}})};te.on(It.APPLIED,zv);const Bv=({unitId:n,attackerId:a,attackerFaction:s,unitFaction:r})=>{const o=St.findIndex(S=>S.id===n),u=o!==-1?St[o]:null,f=u?{q:u.coord.q,r:u.coord.r}:null,h=r==="player"?ra.get(n)??null:null;let m=!1;if(r==="player"){const S=h??Ge.find(E=>Ai.get(E.id)===n||E.id===n)??null;S&&(S.hp!==0&&(S.hp=0,m=!0),S.shield!==0&&(S.shield=0,m=!0))}const p=u?wv(u,h):`unit ${n}`;let g=!1;if(s==="player"&&r&&r!=="player"){const S=a?cs.get(a)??null:null,{xp:E,elite:w,boss:R}=mT(u);E>0&&fT(S,E,{source:"kill",label:p,elite:w,boss:R})&&(g=!0)}if(o!==-1&&(u&&xv.clear(u,{snap:!0}),St.splice(o,1),cs.delete(n),AT(n),zt()),(m||g)&&oa(),(r==="player"||g)&&Gn(),s==="player"&&r&&r!=="player"){const S=Uv(u??null)||gv()<lm,E=SC({factionId:r,elite:S});if(E.rolls.length>0){const w=Ge.find(R=>R.selected)??null;for(const R of E.rolls)if(Ul.addLoot(R,{unitId:w?.id,sourceTableId:E.tableId,equip:ym}).equipped){const U=w?.name??"our champion";qt({type:"loot",message:`Quartermaster fastens ${R.item.name} to ${U}.`,metadata:{item:R.item.name,equipped:!0,owner:U,source:p}})}else qt({type:"loot",message:`Quartermaster stores ${R.item.name} recovered from ${p}.`,metadata:{item:R.item.name,equipped:!1,source:p}})}}s==="player"&&r&&r!=="player"&&($e.addResource(ae.SAUNAKUNNIA,rT),$e.addResource(ae.SISU,1),qt({type:"resource",message:"Our grit surges — +1 SISU earned for the vanquished foe.",metadata:{resource:ae.SISU,amount:1,context:"victory"}})),f&&Jt.revealAround(f,1,{autoFrame:!1});const b=r==="player"?"our":"a rival";qt({type:"combat",message:`The steam hushes as ${b} ${p} grows still.`,metadata:{side:b,unit:p}})};te.on("unitDied",Bv);function Rh(){rs=!1,Ti?.offProgress(Ev),Ti?.dispose(),Ti=null,ts=0,JM(),Wn&&(Wn.destroy(),Wn=null),Ci!==null&&(cancelAnimationFrame(Ci),Ci=null);try{$e.save()}catch(n){console.warn("Failed to persist game state during cleanup",n)}try{oa()}catch(n){console.warn("Failed to persist Saunoja roster during cleanup",n)}Mn&&(Mn.dispose(),Mn=null),te.off(It.APPLIED,zv),te.off("unitDied",Bv),te.off("unitSpawned",Av),te.off("inventoryChanged",Cv),te.off("modifierAdded",lr),te.off("modifierRemoved",lr),te.off("modifierExpired",lr),te.off("unit:stats:changed",Rv),te.off("saunaDamaged",Tv),te.off("saunaDestroyed",_v),te.off("buildingPlaced",nu),te.off("buildingRemoved",nu),na&&(na(),na=null),rr&&(rr.destroy(),rr=null),Hn&&(Hn.dispose(),Hn=null),$a&&($a.dispose(),$a=null),sr&&(sr.destroy(),sr=null),kt&&(kt.destroy(),kt=null),Ia=null,ss=null,Nl=null,wl()}async function FT(){if(rs)return;if(!Wb()){console.error("Cannot start game without loaded assets.");return}rs=!0,Gn(),zt();try{await Pb(()=>{zt()}).then(()=>{zt()})}catch(r){console.warn("Failed to preload Saunoja icon before starting the game",r)}let a=performance.now();function s(r){if(!rs)return;const o=r-a;a=r,Sb()?ky(0):(Dv.tick(o),zT(),ky(o),Il()),zt(),rs&&(Ci=requestAnimationFrame(s))}Ci=requestAnimationFrame(s)}function gu(){let n=0;for(const a of St)a.faction==="player"&&!a.isDead()&&(n+=1);return n}function $T(){const n={engaged:0,reserve:1,downed:2},a=Ge.map(s=>{const r=Ai.get(s.id),o=r?cs.get(r):void 0,u=o?!o.isDead()&&o.stats.health>0:!1,f=s.effectiveStats,h=s.baseStats,m=Math.round(o?Math.max(0,o.stats.health):Math.max(0,s.hp)),p=Math.round(o?Math.max(1,o.getMaxHealth()):Math.max(1,f.health)),g=Math.round(o?Math.max(0,o.stats.attackDamage):Math.max(0,f.attackDamage)),b=Math.round(o?Math.max(0,o.stats.attackRange):Math.max(0,f.attackRange)),S=Math.round(o?Math.max(0,o.stats.movementRange):Math.max(0,f.movementRange)),E=o?.stats.defense??f.defense??0,w=Math.round(Math.max(0,E)),R=o?o.getShield():f.shield??s.shield,_=Math.round(Math.max(0,R)),U=Math.max(0,Math.round(s.upkeep)),B=m<=0?"downed":u?"engaged":"reserve",G=vv(s),F=s.items.map(le=>({...le})),P=s.modifiers.map(le=>({...le})),ie=ur.map(le=>{const ne=Hl(le),Y=s.equipment[le],N=Y?{id:Y.id,name:Y.name,description:Y.description,icon:Y.icon,rarity:Y.rarity,quantity:Y.quantity,slot:le}:null,L=Y?XT(Y.modifiers,Y.quantity):null;return{id:le,label:ne.label,description:ne.description,maxStacks:ne.maxStacks,item:N,modifiers:L}}),se={health:Math.round(Math.max(0,h.health)),maxHealth:Math.round(Math.max(1,h.health)),attackDamage:Math.round(Math.max(0,h.attackDamage)),attackRange:Math.round(Math.max(0,h.attackRange)),movementRange:Math.round(Math.max(0,h.movementRange)),defense:typeof h.defense=="number"&&h.defense>0?Math.round(h.defense):void 0,shield:typeof h.shield=="number"&&h.shield>0?Math.round(h.shield):void 0};return{id:s.id,name:s.name,upkeep:U,status:B,selected:!!s.selected,traits:[...s.traits],stats:{health:m,maxHealth:p,attackDamage:g,attackRange:b,movementRange:S,defense:w>0?w:void 0,shield:_>0?_:void 0},baseStats:se,progression:G,equipment:ie,items:F,modifiers:P}});return a.sort((s,r)=>{const o=n[s.status]-n[r.status];return o!==0?o:s.name.localeCompare(r.name,"en")}),a}function VT(){return Ge.length===0?null:Ge.find(n=>n.selected)??Ge.find(n=>n.hp>0)??Ge[0]}function XT(n,a){const s=Math.max(1,Math.round(a)),r={};return typeof n.health=="number"&&(r.health=n.health*s),typeof n.attackDamage=="number"&&(r.attackDamage=n.attackDamage*s),typeof n.attackRange=="number"&&(r.attackRange=n.attackRange*s),typeof n.movementRange=="number"&&(r.movementRange=n.movementRange*s),typeof n.defense=="number"&&(r.defense=n.defense*s),typeof n.shield=="number"&&(r.shield=n.shield*s),r}function KT(){const n=gu(),a=VT();let s=null;return a&&(s={id:a.id,name:a.name||"Saunoja",traits:[...a.traits],upkeep:Math.max(0,Math.round(a.upkeep)),progression:vv(a)}),{count:n,card:s}}function Il(n){const a=$T();Ia=a,kt&&kt.renderRoster(a)}function Gn(){const n=KT();kt?(kt.updateSummary(n),ss=null):ss=n,Il()}function QT(n){const{overlay:a,resourceBar:s}=n,r=mr(a),{regions:o}=r,u=document.createElement("div");u.className="pointer-events-none absolute inset-0 grid place-items-center bg-[radial-gradient(circle_at_top,rgba(18,28,45,0.92),rgba(6,10,18,0.94))] p-[clamp(1.5rem,4vw,3.25rem)] z-overlay";const f=document.createElement("section");f.className="pointer-events-auto relative grid w-full max-w-[min(640px,90vw)] gap-4 overflow-hidden rounded-[28px] border border-[rgba(128,168,236,0.28)] bg-[linear-gradient(145deg,rgba(31,46,74,0.95),rgba(14,20,33,0.95))] p-[clamp(1.75rem,4vw,2.5rem)] text-slate-100 shadow-[0_40px_90px_rgba(10,14,28,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)]",f.setAttribute("aria-live","polite"),f.setAttribute("role","status");const h=document.createElement("h1");h.className="m-0 text-[clamp(1.6rem,3vw,2.1rem)] font-semibold uppercase tracking-[0.04em]",h.textContent="Experimental HUD Enabled",f.appendChild(h);const m=document.createElement("p");m.className="m-0 text-base leading-relaxed text-slate-100/90",m.textContent="The React/Tailwind interface is bootstrapped for this session. Gameplay systems continue to run, and classic HUD elements are paused while the new shell is under construction.",f.appendChild(m);const p=document.createElement("p");p.className="m-0 text-sm leading-relaxed text-slate-200/75",p.textContent="Toggle the experimental HUD off from the quartermaster settings to return to the classic layout.",f.appendChild(p);const g=document.createElement("div");g.className="pointer-events-none absolute -left-[30%] -top-[40%] h-[420px] w-[420px] bg-[radial-gradient(circle,rgba(90,164,255,0.35),rgba(90,164,255,0))] blur-[0.5px]",f.appendChild(g);const b=document.createElement("div");return b.className="mt-2 rounded-[18px] border border-[rgba(128,168,236,0.2)] bg-[rgba(10,16,26,0.55)] p-4 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]",b.appendChild(s),f.appendChild(b),u.appendChild(f),o.content.appendChild(u),{destroy(){b.contains(s)&&a.prepend(s),u.remove()}}}function Hv(n){if(!n)return{showLoader:()=>({update:()=>{},clear:()=>{},dispose:()=>{}}),showBanner:()=>null,removeTransientUI:()=>{}};const a=()=>{let f=n.querySelector(".hud-banner-stack");return f||(f=document.createElement("div"),f.className="hud-banner-stack",n.append(f)),f},s=(f,h,m)=>{let p=!1;const g=()=>{p||(p=!0,f.removeEventListener("transitionend",g),m())};f.addEventListener("transitionend",g),requestAnimationFrame(()=>{f.classList.add(h)}),window.setTimeout(g,400)};return{showLoader:(f="Heating the sauna stones…")=>{const h=document.createElement("div");h.className="hud-loader",h.setAttribute("role","status"),h.setAttribute("aria-live","polite");const m=document.createElement("div");m.className="hud-loader__card";const p=document.createElement("div");p.className="hud-loader__spinner",p.setAttribute("aria-hidden","true");const g=document.createElement("p");g.className="hud-loader__message",g.textContent=f,m.append(p,g),h.append(m),n.append(h);let b=!1;return{update(S){g.textContent=S},clear(){b||s(h,"hud-loader--hidden",()=>{b=!0,h.remove()})},dispose(){b||(b=!0,h.remove())}}},showBanner:(f,h)=>{const m=a(),p=document.createElement("section");p.className=`hud-banner hud-banner--${f}`,p.setAttribute("role",f==="error"?"alert":"status"),p.setAttribute("aria-live",f==="error"?"assertive":"polite");const g=document.createElement("header");g.className="hud-banner__header";const b=document.createElement("p");b.className="hud-banner__title",b.textContent=h.title??(f==="error"?"Attention required":f==="warning"?"Heads up":"Status update"),g.append(b);const S=document.createElement("ul");S.className="hud-banner__list";for(const _ of h.messages){const U=document.createElement("li");U.textContent=_,S.append(U)}if(p.append(g),h.messages.length&&p.append(S),h.actions?.length){const _=document.createElement("div");_.className="hud-banner__actions";for(const U of h.actions){const B=document.createElement("button");B.type="button",B.className=U.variant==="secondary"?"hud-banner__button hud-banner__button--secondary":"hud-banner__button",B.textContent=U.label,B.addEventListener("click",()=>{U.onClick()}),_.append(B)}p.append(_)}let E,w=!1;const R=()=>{w||(w=!0,E&&window.clearTimeout(E),s(p,"hud-banner--hide",()=>{p.remove(),m.hasChildNodes()||m.remove()}))};if(h.dismissible!==!1){const _=document.createElement("button");_.type="button",_.className="hud-banner__close",_.setAttribute("aria-label","Dismiss notification"),_.textContent="×",_.addEventListener("click",()=>{R()}),g.append(_)}return m.append(p),h.autoCloseMs&&h.autoCloseMs>0&&(E=window.setTimeout(()=>R(),h.autoCloseMs)),{element:p,dismiss:R}},removeTransientUI:()=>{n.querySelectorAll(".hud-loader").forEach(f=>{f.remove()}),n.querySelectorAll(".hud-banner-stack").forEach(f=>{f.remove()})}}}async function PT(n){const a=Object.entries(n),s=await Promise.allSettled(a.map(([f,h])=>h.load().then(m=>({key:f,descriptor:h,value:m})))),r={},o=[],u=[];return s.forEach((f,h)=>{const[m,p]=a[h],g=p.label??String(m);if(f.status==="fulfilled"){const{value:S}=f.value;if(r[m]=S.value,S.warnings?.length)for(const E of S.warnings)o.push(g?`${g}: ${E}`:E);if(S.errors?.length)for(const E of S.errors)u.push(g?`${g}: ${E}`:E);return}const b=ZT(f.reason);u.push(g?`${g}: ${b}`:b)}),{resources:r,warnings:o,errors:u}}function ZT(n){if(n instanceof Error)return n.message;if(typeof n=="string")return n;try{return JSON.stringify(n)}catch{return String(n)}}const JT="Heating the sauna stones…",WT="Polishing sauna ambience…";function e_(n){if(n instanceof Error&&n.message)return n.message;if(typeof n=="string"&&n.trim().length>0)return n;try{return JSON.stringify(n)}catch{return String(n)}}function t_(n){const a=new Set,s=f=>{a.forEach(h=>h(f))},r=n.formatError??e_;return{run:async f=>{s({type:"status",phase:"start",message:JT});try{const{resources:h,warnings:m,errors:p}=await PT({assets:{label:"Core assets",load:async()=>{const b=await n.loadAssets(n.assetPaths);return{value:b.assets,errors:b.failures}}},saunojaIcon:{label:"Saunoja icon",load:async()=>{try{return await n.preloadSaunojaIcon(),{value:!0}}catch(b){return{value:!1,warnings:[`Unable to preload Saunoja icon (${r(b)})`]}}}}});if(n.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"status",phase:"progress",message:WT});const g=h.assets;if(!g){const b=p.length?[...p]:["Critical assets were unavailable. Please refresh to try again."];s({type:"fatal",messages:b});return}if(p.length&&s({type:"errors",errors:p}),m.length&&s({type:"warnings",warnings:m}),n.setAssets(g),n.shouldAbort?.(f)){s({type:"cancelled"});return}n.startGame(),s({type:"ready",assets:g,warnings:m,errors:p})}catch(h){if(n.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"failure",error:h,message:r(h)})}},subscribe:f=>(a.add(f),()=>{a.delete(f)})}}const n_="grabbing";function a_(n,a){const s=a.dragCursor??n_;let r=!1,o=null,u=0,f=0,h=null;const m=E=>{E.pointerType!=="mouse"||E.button!==0||(r=!0,o=E.pointerId,u=E.clientX,f=E.clientY,h=n.style.cursor??"",n.setPointerCapture?.(E.pointerId),n.style.cursor=s,a.onPanStart?.(E))},p=E=>{if(!r||o!==E.pointerId)return;const w=E.clientX-u,R=E.clientY-f;u=E.clientX,f=E.clientY,a.onPan(w,R,E)},g=E=>{!r||o!==E.pointerId||(r=!1,o=null,n.releasePointerCapture?.(E.pointerId),n.style.cursor=h??"",a.onPanEnd?.(E))},b=E=>{g(E)},S=E=>{g(E)};return n.addEventListener("pointerdown",m),n.addEventListener("pointermove",p),n.addEventListener("pointerup",b),n.addEventListener("pointercancel",S),n.addEventListener("pointerleave",S),()=>{n.removeEventListener("pointerdown",m),n.removeEventListener("pointermove",p),n.removeEventListener("pointerup",b),n.removeEventListener("pointercancel",S),n.removeEventListener("pointerleave",S),r&&o!==null&&n.releasePointerCapture?.(o),n.style.cursor=h??""}}const i_=10,s_=250;function Ji(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function r_(n,a){const s=a.tapMaxMovement??i_,r=a.tapMaxDuration??s_;let o=null;const u=b=>{if(b.touches.length===1){const S=b.touches[0];o={mode:"pan",lastX:S.clientX,lastY:S.clientY,startX:S.clientX,startY:S.clientY,startTime:Ji(),moved:!1};return}if(b.touches.length>=2){const[S,E]=[b.touches[0],b.touches[1]];o={mode:"pinch",lastCenterX:(S.clientX+E.clientX)/2,lastCenterY:(S.clientY+E.clientY)/2,lastDistance:Math.hypot(S.clientX-E.clientX,S.clientY-E.clientY),startTime:Ji(),moved:!1}}},f=(b,S)=>{if(!o||o.mode!=="pan")return;const E=b.clientX-o.lastX,w=b.clientY-o.lastY;!o.moved&&Math.hypot(E,w)>1&&(o.moved=!0),o.lastX=b.clientX,o.lastY=b.clientY,a.onPan(E,w,S)},h=(b,S,E)=>{const w=(b.clientX+S.clientX)/2,R=(b.clientY+S.clientY)/2,_=Math.hypot(b.clientX-S.clientX,b.clientY-S.clientY);let U=1,B=0,G=0;o&&o.mode==="pinch"?(U=_/o.lastDistance,B=w-o.lastCenterX,G=R-o.lastCenterY):o={mode:"pinch",lastCenterX:w,lastCenterY:R,lastDistance:_,startTime:Ji(),moved:!1},!(!o||o.mode!=="pinch")&&(o.lastCenterX=w,o.lastCenterY=R,o.lastDistance=_,o.moved=!0,a.onPinch({centerX:w,centerY:R,scale:U,deltaCenterX:B,deltaCenterY:G},E))},m=b=>{if(!o||b.touches.length===0)return;if(b.preventDefault(),b.touches.length===1){const w=b.touches[0];o.mode!=="pan"&&(o={mode:"pan",lastX:w.clientX,lastY:w.clientY,startX:w.clientX,startY:w.clientY,startTime:Ji(),moved:!0}),f(w,b);return}const[S,E]=[b.touches[0],b.touches[1]];h(S,E,b)},p=()=>!o||o.mode!=="pan"||Math.hypot(o.lastX-o.startX,o.lastY-o.startY)>s?!1:Ji()-o.startTime<=r,g=b=>{if(o){if(b.touches.length===0){o.mode==="pan"&&a.onTap&&p()&&a.onTap({x:o.startX,y:o.startY},b),o=null;return}if(b.touches.length===1){const S=b.touches[0];o={mode:"pan",lastX:S.clientX,lastY:S.clientY,startX:S.clientX,startY:S.clientY,startTime:Ji(),moved:!0};return}if(b.touches.length>=2){const[S,E]=[b.touches[0],b.touches[1]];o={mode:"pinch",lastCenterX:(S.clientX+E.clientX)/2,lastCenterY:(S.clientY+E.clientY)/2,lastDistance:Math.hypot(S.clientX-E.clientX,S.clientY-E.clientY),startTime:Ji(),moved:!0}}}};return n.addEventListener("touchstart",u,{passive:!1}),n.addEventListener("touchmove",m,{passive:!1}),n.addEventListener("touchend",g),n.addEventListener("touchcancel",g),()=>{n.removeEventListener("touchstart",u),n.removeEventListener("touchmove",m),n.removeEventListener("touchend",g),n.removeEventListener("touchcancel",g),o=null}}const l_=.5,o_=3.5;function Nh(n,a,s,r,o){const u=n.getBoundingClientRect(),f=a-u.left,h=s-u.top,m=u.width/2,p=u.height/2;return{x:o.x+(f-m)/r,y:o.y+(h-p)/r}}function c_(n){return Math.min(o_,Math.max(l_,n))}function jv(n,a,s,r=xe.zoom,o=xe){return Nh(n,a,s,r,o)}function Gv(n,a,s,r){const o=c_(r);if(o===xe.zoom)return;const u={x:xe.x,y:xe.y},f=Nh(n,a,s,xe.zoom,u),h=Nh(n,a,s,o,u);xe.x+=f.x-h.x,xe.y+=f.y-h.y,xe.zoom=o,zt()}function ah(n,a){n===0&&a===0||(xe.x-=n/xe.zoom,xe.y-=a/xe.zoom,zt())}function u_(n){const a=window.devicePixelRatio||1,s=Math.max(window.innerWidth,1),r=Math.max(window.innerHeight,1);n.style.width=`${s}px`,n.style.height=`${r}px`,n.width=Math.round(s*a),n.height=Math.round(r*a);const o=n.getContext("2d");o&&o.setTransform(1,0,0,1,0,0),zt()}const d_=.0015,kh=[];let bm=0,Va=null,yu=Hv(null),Ut=null,ih="classic",Dh=null;function f_(){if(typeof document>"u")return;const n=document.querySelector("[data-build-commit]");if(!n)return;const a="53d5728".trim(),s=a.length>0&&a!=="unknown",r=s?`#${a}`:"DEV BUILD";n.textContent=r,n.dataset.state=s?"commit":"dev";const o=n.closest("#build-id");if(o){const u=s?`Build commit ${a}`:"Development build";o.setAttribute("aria-label",u),o.title=s?`Autobattles build ${a}`:"Unversioned development build",o.dataset.buildState=s?"release":"development"}}f_();function Ya(n){kh.push(n)}function h_(){for(;kh.length;){const n=kh.pop();try{n?.()}catch(a){console.error("Error during cleanup",a)}}}function m_(n){Ya(()=>n.dispose())}function Tc(n,a){const s=yu.showBanner(n,a);s&&Ya(()=>s.dismiss())}function p_(n){switch(n.type){case"status":if(n.phase==="start"){Ut?.dispose();const a=yu.showLoader(n.message);Ut=a,m_(a)}else Ut&&(Ut.update(n.message),Ut.clear(),Ut=null);break;case"ready":Ut?.clear(),Ut=null;break;case"warnings":n.warnings.length&&(console.warn("Resource loader warnings",n.warnings),Tc("warning",{title:"Heads up",messages:n.warnings,autoCloseMs:12e3}));break;case"errors":n.errors.length&&(console.error("Resource loader errors",n.errors),Tc("error",{title:"Some resources failed to load",messages:n.errors,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]}));break;case"fatal":console.error("Critical assets failed to load",n.messages),Ut?.clear(),Ut=null,Tc("error",{title:"Unable to start the sauna battle",messages:n.messages,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}],dismissible:!1});break;case"failure":console.error("Failed to initialize resources",n.error),Ut?.clear(),Ut=null,Tc("error",{title:"Failed to initialize",messages:[n.message],actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]});break;case"cancelled":Ut?.dispose(),Ut=null;break}}const Iv=t_({assetPaths:_C,loadAssets:WS,preloadSaunojaIcon:Pb,setAssets:RC,startGame:FT,shouldAbort:n=>n!==bm});Iv.subscribe(p_);function Dy(n){if(!Va)return;n.preventDefault();const a=Math.exp(-n.deltaY*d_),s=xe.zoom*a;Gv(Va,n.clientX,n.clientY,s)}function Ly(n){if(!Va)return;const a=jv(Va,n.clientX,n.clientY);qv(a)}function g_(n){n.addEventListener("click",Ly),Ya(()=>n.removeEventListener("click",Ly)),n.addEventListener("wheel",Dy,{passive:!1}),Ya(()=>n.removeEventListener("wheel",Dy));const a=a_(n,{onPan:(r,o)=>{ah(r,o)},dragCursor:"grabbing"});Ya(a);const s=r_(n,{onPan:(r,o)=>{ah(r,o)},onPinch:({centerX:r,centerY:o,scale:u,deltaCenterX:f,deltaCenterY:h})=>{Gv(n,r,o,xe.zoom*u),ah(f,h)},onTap:r=>{const o=jv(n,r.x,r.y);qv(o)}});Ya(s)}function y_(){bm+=1,h_(),Dh?.destroy(),Dh=null,Ut?.dispose(),Ut=null,Va&&(Va.style.cursor=""),Va=null,yu.removeTransientUI(),Rh()}function b_(){const n=document.getElementById("game-canvas"),a=document.getElementById("resource-bar"),s=document.getElementById("ui-overlay");if(!n||!a||!s){console.error("Autobattles4xFinsauna shell is missing the required canvas, overlay, or resource bar elements.",{hasCanvas:!!n,hasResourceBar:!!a,hasOverlay:!!s});return}Va&&y_();const r=++bm;ih=rv().useUiV2?"v2":"classic",Va=n,yu=Hv(s);const u=Sx();Ya(()=>u.dispose()),MT(n,a,s,{hudVariant:ih}),ih==="v2"&&(Dh=QT({overlay:s,resourceBar:a})),g_(n);const f=()=>u_(n);window.addEventListener("resize",f),Ya(()=>window.removeEventListener("resize",f)),window.addEventListener("beforeunload",Rh),Ya(()=>window.removeEventListener("beforeunload",Rh)),f(),import.meta.vitest||Iv.run(r)}function v_(){if(typeof document>"u")return;const n=()=>{document.removeEventListener("DOMContentLoaded",n),b_()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",n);return}n()}import.meta.vitest||v_();
