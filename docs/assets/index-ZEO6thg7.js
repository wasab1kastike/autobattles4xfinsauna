(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function s(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(l){if(l.ep)return;l.ep=!0;const u=s(l);fetch(l.href,u)}})();class SM{listeners=new Map;on(a,s){const r=this.listeners.get(a)??[];r.push(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);if(!r)return;const l=r.indexOf(s);l!==-1&&(r.splice(l,1),r.length===0?this.listeners.delete(a):this.listeners.set(a,r))}emit(a,s){const r=this.listeners.get(a);if(r)for(const l of r)l(s)}}const re=new SM;class Wh{type="farm";cost=50;beerPerTick=1}class i2{type="barracks";cost=100;trainingCapacity=1}const s2=Math.sqrt(3),r2=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function ta(t,a){return{x:a*s2*(t.q+t.r/2),y:a*(3/2)*t.r}}function So(t,a,s){const r=(s2/3*t-.3333333333333333*a)/s,l=2/3*a/s;return{q:r,r:l}}function MM(t,a,s){return EM(So(t,a,s))}function Oc(t){return r2.map(a=>({q:t.q+a.q,r:t.r+a.r}))}function Zs(t,a){const s=-t.q-t.r,r=-a.q-a.r;return Math.max(Math.abs(t.q-a.q),Math.abs(t.r-a.r),Math.abs(s-r))}function EM(t){let a=t.q,s=t.r,r=-a-s,l=Math.round(a),u=Math.round(r),f=Math.round(s);const h=Math.abs(l-a),m=Math.abs(u-r),p=Math.abs(f-s);return h>m&&h>p?l=-u-f:m>p?u=-l-f:f=-l-u,{q:l,r:f}}const zc=new Set;let Rc=32;function xM(t){return`${t.q},${t.r}`}function yh(t,a){Rc=a,zc.add(xM(t))}function AM(t){if(zc.size===0)return{center:{x:0,y:0},zoom:1};const a=Rc*Math.sqrt(3),s=Rc*2,r=a/2,l=s/2;let u=1/0,f=1/0,h=-1/0,m=-1/0;for(const j of zc){const[V,X]=j.split(",").map(Number),{x:$,y:ee}=ta({q:V,r:X},Rc),te=$-r,Y=ee-l;u=Math.min(u,te),f=Math.min(f,Y),h=Math.max(h,te+a),m=Math.max(m,Y+s)}const p=h-u,g=m-f,b=96,v={x:u+p/2,y:f+g/2},M=Math.max(0,Math.min(t.safeRight??0,t.width)),T=Math.max(t.width-M,1)/(p+b*2),_=t.height/(g+b*2),R=Math.min(T,_);return{center:{x:R>0?v.x-M/(2*R):v.x,y:v.y},zoom:R}}const xe={x:0,y:0,zoom:1};function wM(t,a=300){const s=xe.x,r=xe.y,l=xe.zoom,u=typeof performance<"u"?performance.now():Date.now(),f=h=>{const m=Math.min((h-u)/a,1);xe.x=s+(t.center.x-s)*m,xe.y=r+(t.center.y-r)*m,xe.zoom=l+(t.zoom-l)*m,m<1&&(typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),16))};typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),0)}function CM(){zc.clear()}async function TM(t){const a={},s={},r=[],l=Object.entries(t.images??{}).map(([f,h])=>new Promise(m=>{const p=new Image;p.onload=()=>{a[f]=p,m()},p.onerror=()=>{const g=`Failed to load image: ${h}`;console.error(g),r.push(g),m()},p.src=h})),u=Object.entries(t.sounds??{}).map(([f,h])=>new Promise(m=>{const p=new Audio;p.oncanplaythrough=()=>{s[f]=p,m()},p.onerror=()=>{const g=`Failed to load sound: ${h}`;console.error(g),r.push(g),m()},p.src=h,p.load()}));return await Promise.all([...l,...u]),{assets:{images:a,sounds:s},failures:r}}function em(t){if(typeof globalThis.localStorage>"u")return;const a=globalThis.localStorage.getItem(t);if(a)try{return JSON.parse(a)}catch(s){console.warn(`Failed to parse data for "${t}", clearing`,s),globalThis.localStorage.removeItem(t);return}}var oe=(t=>(t.SAUNA_BEER="sauna-beer",t.SAUNAKUNNIA="saunakunnia",t.SISU="sisu",t))(oe||{});const lc={"sauna-beer":1,saunakunnia:0,sisu:0},o2="/assets/sauna-beer-CgafwOhX.svg",l2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eResource%20Icon%3c/title%3e%3cdesc%20id='desc'%3eA%20luminous%20crest%20symbolising%20generic%20resources.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='resource-bg'%20cx='50%25'%20cy='50%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='resource-core'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2338bdf8'%20/%3e%3c/linearGradient%3e%3cfilter%20id='resource-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='6'%20flood-color='%2338bdf8'%20flood-opacity='0.45'%20/%3e%3c/filter%3e%3c/defs%3e%3cg%20filter='url(%23resource-glow)'%3e%3ccircle%20cx='32'%20cy='32'%20r='22'%20fill='%230f172a'%20stroke='url(%23resource-bg)'%20stroke-width='4'%20/%3e%3cpath%20d='M32%2016l-12%2014%2012%2022%2012-22z'%20fill='url(%23resource-core)'%20stroke='%23f8fafc'%20stroke-width='2'%20/%3e%3cpath%20d='M20%2030l-4%208%2016%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M44%2030l4%208-16%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/g%3e%3c/svg%3e",c2="/assets/saunoja-roster-Bfn4ZKxh.svg",jt={APPLIED:"policy:applied",REJECTED:"policy:rejected"},u2=[{id:"eco",name:"Evergreen Eco Mandate",description:"Increase passive sauna beer brewing by one bottle each production tick.",cost:15,resource:oe.SAUNAKUNNIA,prerequisites:[],visuals:{icon:l2,gradient:"linear-gradient(135deg, rgba(66, 240, 155, 0.9), rgba(13, 114, 234, 0.85))",accentColor:"#34d399",badges:["Economy","Sustainability"],flair:"Green-lit by the council of whisked sauna masters."},effects:[{event:jt.APPLIED,once:!0,invoke:({state:t})=>{t.modifyPassiveGeneration(oe.SAUNA_BEER,1)}}],spotlight:"Sustainably expand your brewing line with solar-heated mash tuns."},{id:"temperance",name:"Aurora Temperance Treaty",description:"Boost night shift work speed by 5% once the eco initiative is live.",cost:25,resource:oe.SAUNAKUNNIA,prerequisites:[{description:"Enact the Evergreen Eco Mandate.",isSatisfied:t=>t.hasPolicy("eco")},{description:"Stockpile at least 30 Sauna Beer bottles to brief the midnight crews.",isSatisfied:t=>t.getResource(oe.SAUNA_BEER)>=30}],visuals:{icon:c2,gradient:"linear-gradient(140deg, rgba(46, 51, 227, 0.9), rgba(118, 75, 162, 0.85))",accentColor:"#6366f1",badges:["Discipline","Night Ops"],flair:"Whispers of aurora spirits keep the crew laser-focused after dusk."},effects:[{event:jt.APPLIED,once:!0,invoke:({state:t})=>{t.nightWorkSpeedMultiplier=Number((t.nightWorkSpeedMultiplier*1.05).toFixed(4))}}],spotlight:"Glow-lit helmets and synchronized chants keep the late shift on tempo."},{id:"steam-diplomats",name:"Steam Diplomats Accord",description:"Import two additional sauna beer bottles per tick via gilded trade routes.",cost:35,resource:oe.SAUNAKUNNIA,prerequisites:[{description:"Secure the Aurora Temperance Treaty for your envoys.",isSatisfied:t=>t.hasPolicy("temperance")},{description:"Hold a reserve of 50 Sauna Beer bottles to fund the embassy festivities.",isSatisfied:t=>t.getResource(oe.SAUNA_BEER)>=50}],visuals:{icon:o2,gradient:"linear-gradient(150deg, rgba(255, 173, 94, 0.92), rgba(255, 99, 71, 0.85))",accentColor:"#fb923c",badges:["Diplomacy","Logistics"],flair:"Silver samovars arrive with diplomatic steam-born delights."},effects:[{event:jt.APPLIED,once:!0,invoke:({state:t})=>{t.modifyPassiveGeneration(oe.SAUNA_BEER,2)}}],spotlight:"Trade envoys pipe artisanal steam through every new supply line."}],d2=new Map;for(const t of u2)d2.set(t.id,t);function f2(){return u2}function gy(t){return d2.get(t)}const Bc="progression:ngPlusState",tm=5,h2=1831565813,kc=Object.freeze({aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1}),Lc=Object.freeze({runSeed:0,ngPlusLevel:0,unlockSlots:0,enemyTuning:kc});function Rf(t,a,s,r){const l=Number(t);return Number.isFinite(l)?Math.min(s,Math.max(a,l)):r}function _M(t){return{aggressionMultiplier:Rf(t?.aggressionMultiplier,.25,6,kc.aggressionMultiplier),cadenceMultiplier:Rf(t?.cadenceMultiplier,.25,4,kc.cadenceMultiplier),strengthMultiplier:Rf(t?.strengthMultiplier,.25,6,kc.strengthMultiplier)}}function m2(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(t){return console.warn("Local storage unavailable for NG+ state",t),null}}function yy(t,a,s){const r=Number.isFinite(t)?t:Number(t);if(!Number.isFinite(r))return a;const l=Math.trunc(r);return Math.min(s,Math.max(a,l))}function p2(t){const a=Number.isFinite(t)?t:Number(t);return!Number.isFinite(a)||a===0?0:Math.trunc(Math.abs(a))}function g2(t=Math.random){let a=t();(!Number.isFinite(a)||a<=0||a>=1)&&(a=Math.random());const s=Math.floor(a*4294967295);return s===0?h2:s}function Ua(t={}){const a=Lc,s=p2(t.runSeed??a.runSeed),r=yy(t.ngPlusLevel??a.ngPlusLevel,0,Number.MAX_SAFE_INTEGER),l=yy(t.unlockSlots??a.unlockSlots,0,tm),u=_M(t.enemyTuning??a.enemyTuning);return{runSeed:s,ngPlusLevel:r,unlockSlots:l,enemyTuning:u}}function Ra(t,a=Math.random){const s=Ua(t);return s.runSeed!==0?s:Ua({...s,runSeed:g2(a)})}function NM(t=Math.random){const a=m2();if(!a)return Ra(Lc,t);const s=a.getItem(Bc);if(!s)return Ra(Lc,t);try{const r=JSON.parse(s);return Ra(Ua(r),t)}catch(r){return console.warn("Failed to parse NG+ state",r),Ra(Lc,t)}}function bh(t){const a=m2();if(!a)return;const s=Ua(t);a.setItem(Bc,JSON.stringify(s))}function RM(t,a){const s=Ua(t),r=typeof a.random=="function"?a.random:Math.random,l=g2(r);return Ra(Ua({...s,runSeed:l}),r)}function qc(t,a=0){let s=p2(t)^(a|0);return s===0&&(s=h2^(a|0)),()=>{s=s+1831565813|0;let r=Math.imul(s^s>>>15,1|s);return r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296}}function kf(t){return`${t.q},${t.r}`}const y2={farm:()=>new Wh,barracks:()=>new i2};function kM(t){return y2[t]?.()}const by=Object.freeze({aggression:1,cadence:1,strength:1});function er(t,a,s,r){const l=Number(t);return Number.isFinite(l)?Math.min(s,Math.max(a,l)):r}function vy(t,a){return{aggression:er(a.aggression??t.aggression,.1,8,t.aggression),cadence:er(a.cadence??t.cadence,.25,6,t.cadence),strength:er(a.strength??t.strength,.25,12,t.strength)}}class LM{constructor(a,s="gameState"){this.tickInterval=a,this.storageKey=s}resources={[oe.SAUNA_BEER]:0,[oe.SAUNAKUNNIA]:0,[oe.SISU]:0};passiveGeneration={...lc};lastSaved=Date.now();buildings={};buildingPlacements=new Map;policies=new Set;nightWorkSpeedMultiplier=1;enemyScaling={...by};enemyCalmSecondsRemaining=0;ngPlus=Ua();tick(){Object.keys(this.passiveGeneration).forEach(a=>{this.addResource(a,this.passiveGeneration[a])})}save(){this.lastSaved=Date.now();const a={};this.buildingPlacements.forEach((l,u)=>{a[u]=l.type});const s={resources:this.resources,lastSaved:this.lastSaved,buildings:this.buildings,buildingPlacements:a,policies:Array.from(this.policies),passiveGeneration:{...this.passiveGeneration},nightWorkSpeedMultiplier:this.nightWorkSpeedMultiplier,enemyScaling:{...this.enemyScaling},ngPlus:this.ngPlus},r=typeof localStorage<"u"&&localStorage?localStorage:void 0;if(!r){console.warn("GameState.save: localStorage is unavailable, skipping persistence.");return}try{r.setItem(this.storageKey,JSON.stringify(s))}catch(l){console.warn("GameState.save: Failed to persist state to localStorage.",l)}}load(a){const s=em(this.storageKey);if(!s)return this.lastSaved=Date.now(),!1;this.resources={...this.resources,...s.resources??{}},Object.keys(this.resources).forEach(m=>{Number.isFinite(this.resources[m])||(this.resources[m]=0)}),this.enemyScaling=vy(by,s.enemyScaling??{}),this.enemyCalmSecondsRemaining=0;const r={};Object.entries(s.buildings??{}).forEach(([m,p])=>{y2[m]&&(r[m]=p)}),this.buildings=r,this.buildingPlacements.clear(),s.buildingPlacements&&Object.entries(s.buildingPlacements).forEach(([m,p])=>{const g=kM(p);if(!g)return;this.buildingPlacements.set(m,g);const[b,v]=m.split(",").map(Number);if(a){const M=a.ensureTile(b,v);M.placeBuilding(g.type),M.reveal(),yh({q:b,r:v},a.hexSize)}re.emit("buildingPlaced",{building:g,coord:{q:b,r:v},state:this})}),this.lastSaved=s.lastSaved??Date.now();const l=s.ngPlus?Ua(s.ngPlus):this.ngPlus;if(this.ngPlus=Ra(l),this.policies=new Set,this.passiveGeneration={...lc},this.nightWorkSpeedMultiplier=1,(Array.isArray(s.policies)?s.policies.filter(m=>typeof m=="string"):[]).forEach(m=>{const p=gy(m);p&&(this.policies.add(p.id),re.emit(jt.APPLIED,{policy:p,state:this}))}),s.passiveGeneration){const m={...lc};Object.keys(lc).forEach(p=>{const g=s.passiveGeneration?.[p];typeof g=="number"&&Number.isFinite(g)&&(m[p]=g)}),this.passiveGeneration=m}typeof s.nightWorkSpeedMultiplier=="number"&&Number.isFinite(s.nightWorkSpeedMultiplier)&&(this.nightWorkSpeedMultiplier=s.nightWorkSpeedMultiplier);const f=Date.now()-this.lastSaved,h=Math.floor(f/this.tickInterval);return Object.keys(this.passiveGeneration).forEach(m=>{this.resources[m]+=h*this.passiveGeneration[m]}),!0}getResource(a){return this.resources[a]}canAfford(a,s=oe.SAUNA_BEER){return this.resources[s]>=a}spendResource(a,s=oe.SAUNA_BEER){return this.spend(a,s)}spend(a,s=oe.SAUNA_BEER){return this.canAfford(a,s)?(this.resources[s]-=a,re.emit("resourceChanged",{resource:s,amount:-a,total:this.resources[s]}),!0):!1}addResource(a,s){this.resources[a]+=s,re.emit("resourceChanged",{resource:a,amount:s,total:this.resources[a]})}modifyPassiveGeneration(a,s){this.passiveGeneration[a]=(this.passiveGeneration[a]??0)+s}setEnemyScalingBase(a){return this.enemyScaling=vy(this.enemyScaling,a),{...this.enemyScaling}}applyEnemyScalingModifiers(a){const s={aggression:er(this.enemyScaling.aggression*(a.aggression??1),.1,8,this.enemyScaling.aggression),cadence:er(this.enemyScaling.cadence*(a.cadence??1),.25,6,this.enemyScaling.cadence),strength:er(this.enemyScaling.strength*(a.strength??1),.25,12,this.enemyScaling.strength)};return this.enemyScaling=s,{...this.enemyScaling}}getEnemyScalingSnapshot(){return{...this.enemyScaling,calmSecondsRemaining:Math.max(0,this.enemyCalmSecondsRemaining)}}requestEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(this.enemyCalmSecondsRemaining,s),this.enemyCalmSecondsRemaining)}advanceEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(0,this.enemyCalmSecondsRemaining-s),this.enemyCalmSecondsRemaining)}clearEnemyCalm(){this.enemyCalmSecondsRemaining=0}construct(a,s,r=oe.SAUNA_BEER){return this.spend(s,r)?(this.buildings[a]=(this.buildings[a]??0)+1,!0):!1}placeBuilding(a,s,r,l=oe.SAUNA_BEER){const u=r.getTile(s.q,s.r);return!u||u.building||!this.construct(a.type,a.cost,l)?!1:(this.buildingPlacements.set(kf(s),a),u.placeBuilding(a.type),re.emit("buildingPlaced",{building:a,coord:s,state:this}),!0)}getBuildingAt(a){return this.buildingPlacements.get(kf(a))}removeBuilding(a,s){const r=kf(a),l=this.buildingPlacements.get(r);return l?(this.buildingPlacements.delete(r),s.getTile(a.q,a.r)?.placeBuilding(null),this.buildings[l.type]!==void 0&&(this.buildings[l.type]-=1,this.buildings[l.type]<=0&&delete this.buildings[l.type]),re.emit("buildingRemoved",{building:l,coord:a,state:this}),!0):!1}upgrade(a,s,r=oe.SAUNA_BEER){return this.construct(`upgrade:${a}`,s,r)}applyPolicy(a){const s=gy(a);if(!s){const u={policyId:a,state:this,reason:"unknown-policy"};return re.emit(jt.REJECTED,u),!1}if(this.hasPolicy(s.id)){const u={policyId:s.id,policy:s,state:this,reason:"already-applied"};return re.emit(jt.REJECTED,u),!1}const r=s.prerequisites.filter(u=>!u.isSatisfied(this));if(r.length>0){const u={policyId:s.id,policy:s,state:this,reason:"prerequisites-not-met",missingPrerequisites:r};return re.emit(jt.REJECTED,u),!1}if(!this.spend(s.cost,s.resource)){const u={policyId:s.id,policy:s,state:this,reason:"insufficient-resources"};return re.emit(jt.REJECTED,u),!1}this.policies.add(s.id);const l={policy:s,state:this};return re.emit(jt.APPLIED,l),!0}hasPolicy(a){return this.policies.has(a)}getNgPlusState(){return{...this.ngPlus}}setNgPlusState(a){const s=Ua({...this.ngPlus,...a});return this.ngPlus=Ra(s),this.ngPlus}}class DM{constructor(a,s){this.baseInterval=a,this.onTick=s}timer=null;speed=1;lastTick=0;accumulator=0;start(){this.stop(),this.lastTick=Date.now();const a=this.baseInterval/this.speed;this.timer=setInterval(()=>{const s=Date.now(),r=s-this.lastTick;this.lastTick=s,this.onTick(r)},a)}stop(){this.timer!==null&&(clearInterval(this.timer),this.timer=null)}setSpeed(a){if(a<=0)throw new Error("Speed multiplier must be positive");this.speed=a,this.timer!==null&&this.start()}getSpeed(){return this.speed}getBaseInterval(){return this.baseInterval}tick(a){for(this.accumulator+=a*this.speed;this.accumulator>=this.baseInterval;)this.accumulator-=this.baseInterval,this.onTick(this.baseInterval)}}var En=(t=>(t[t.Plains=0]="Plains",t[t.Forest=1]="Forest",t[t.Hills=2]="Hills",t[t.Lake=3]="Lake",t))(En||{});function IM(t,a,s){let r=t*374761393+a*668265263+s*0x14057b7ef7678100;return r=(r^r>>13)*1274126177,r^=r>>16,(r>>>0)/4294967295}function UM(t,a,s=0){const r=IM(t,a,s);return r<.1?3:r<.3?1:r<.5?2:0}class OM{_terrain;_building;_isFogged;listeners=new Set;constructor(a=En.Plains,s=null,r=!0){this._terrain=a,this._building=s,this._isFogged=r}get terrain(){return this._terrain}set terrain(a){this._terrain!==a&&(this._terrain=a,this.notify("terrain"))}get building(){return this._building}set building(a){this._building!==a&&(this._building=a,this.notify("building"))}get isFogged(){return this._isFogged}set isFogged(a){this._isFogged!==a&&(this._isFogged=a,this.notify("fog"))}reveal(){this.isFogged=!1}placeBuilding(a){this.building=a}setFogged(a){this.isFogged=a}addMutationListener(a){return this.listeners.add(a),()=>this.listeners.delete(a)}notify(a){for(const s of this.listeners)s(a)}}class zM{constructor(a=10,s=10,r=32,l=0){this.hexSize=r,this.seed=l,this.minQ=0,this.minR=0,this.maxQ=a-1,this.maxR=s-1}tiles=new Map;tileSubscriptions=new Map;changeListeners=new Set;minQ;maxQ;minR;maxR;get width(){return this.maxQ-this.minQ+1}get height(){return this.maxR-this.minR+1}key(a,s){return`${a},${s}`}addTileChangeListener(a){return this.changeListeners.add(a),()=>this.changeListeners.delete(a)}notifyTileChange(a,s,r){for(const l of this.changeListeners)l(a,s,r)}attachTileListener(a,s,r){const l=s.addMutationListener(u=>{this.notifyTileChange(r,s,u)});this.tileSubscriptions.set(a,l)}ensureTile(a,s){const r=this.key(a,s);let l=this.tiles.get(r);return l||(l=new OM(UM(a,s,this.seed)),this.tiles.set(r,l),this.minQ=Math.min(this.minQ,a),this.maxQ=Math.max(this.maxQ,a),this.minR=Math.min(this.minR,s),this.maxR=Math.max(this.maxR,s),this.attachTileListener(r,l,{q:a,r:s}),this.notifyTileChange({q:a,r:s},l,"created"),l.isFogged||yh({q:a,r:s},this.hexSize)),l}getTile(a,s){return this.tiles.get(this.key(a,s))}forEachTile(a){for(const[s,r]of this.tiles){const[l,u]=s.split(",").map(Number);a(r,{q:l,r:u})}}getNeighbors(a,s){return Oc({q:a,r:s}).map(r=>this.ensureTile(r.q,r.r))}revealAround(a,s,r={}){const{autoFrame:l=!0}=r;for(let h=-s;h<=s;h++){const m=Math.max(-s,-h-s),p=Math.min(s,-h+s);for(let g=m;g<=p;g++){const b={q:a.q+h,r:a.r+g};this.ensureTile(b.q,b.r).reveal(),yh(b,this.hexSize)}}if(!l)return;const u=typeof window<"u"?(()=>{const h=Math.max(window.innerWidth,0),m=Math.max(window.innerHeight,0);let p=0;if(typeof document<"u"){const b=document.getElementById("right-panel");if(b){const v=b.getBoundingClientRect();if(v.width>0){const M=b.closest("#ui-overlay");if(M){const x=M.getBoundingClientRect(),T=window.getComputedStyle(M),_=Number.parseFloat(T.paddingRight||"0"),R=x.right-v.left,I=v.width+(Number.isFinite(_)?_:0);p=Math.max(0,Math.max(R,I))}else p=Math.max(0,v.width)}}}const g=Math.min(Math.max(p,0),h);return{width:h,height:m,safeRight:g}})():{width:0,height:0,safeRight:0},f=AM(u);wM(f,300)}}const Hc={TRIGGERED:"scheduler:eventTriggered",RESOLVED:"scheduler:eventResolved"},BM=new Map;function qM(){return globalThis.localStorage??null}function lo(t){return typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}function b2(t){const a=globalThis.crypto;return a?.randomUUID?a.randomUUID():`${t}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function HM(t){const a={id:String(t.id??""),label:String(t.label??""),description:t.description?String(t.description):void 0,event:t.event?String(t.event):void 0,payload:t.payload,accent:t.accent??void 0};return a.id||(a.id=b2("choice")),a.label||(a.label="Choose"),a}function jc(t){const a={id:String(t.id??""),headline:String(t.headline??""),body:String(t.body??""),art:t.art?String(t.art):void 0,typography:t.typography,animation:t.animation,accentColor:t.accentColor?String(t.accentColor):void 0,acknowledgeText:t.acknowledgeText?String(t.acknowledgeText):void 0,choices:Array.isArray(t.choices)?t.choices.map(s=>HM(s)):void 0};return a.id||(a.id=b2("event")),a}function jM(t){return{content:jc(t.content),trigger:t.trigger.type==="time"?{type:"time",at:Number.isFinite(t.trigger.at)?t.trigger.at:0}:{type:"condition",conditionId:String(t.trigger.conditionId),params:t.trigger.params}}}function Sy(t){return{content:jc(t.content),triggeredAt:Number.isFinite(t.triggeredAt)?t.triggeredAt:0}}const Lf=Object.freeze({clock:0,queue:[],active:[]});class GM{storageKey;eventBus;getStorage;state=lo(Lf);subscribers=new Set;constructor(a={}){this.storageKey=a.storageKey??"autobattles:event-scheduler",this.eventBus=a.eventBus??re,this.getStorage=a.storageProvider??qM,this.load()}subscribe(a){return this.subscribers.add(a),a(this.getActiveEvents()),()=>{this.subscribers.delete(a)}}getActiveEvents(){return this.state.active.map(a=>({...lo(a.content),triggeredAt:a.triggeredAt}))}schedule(a){const s=jc(a.content);if(!s.headline||!s.body||this.containsEvent(s.id))return!1;const r=a.trigger.type==="condition"?{type:"condition",conditionId:String(a.trigger.conditionId),params:a.trigger.params}:{type:"time",at:this.resolveTriggerTime(a.trigger)};return this.state.queue.push({content:s,trigger:r}),this.sortQueue(),this.save(),!0}publish(a){const s=jc(a);this.containsEvent(s.id)||(this.state.queue=this.state.queue.filter(r=>r.content.id!==s.id),this.activateEvent({content:s,triggeredAt:this.state.clock}))}tick(a,s={}){if(!Number.isFinite(a)||a<=0)return;this.state.clock+=a;const r=[],l=[];for(const u of this.state.queue)this.shouldTrigger(u.trigger,s)?r.push(u):l.push(u);this.state.queue=l;for(const u of r)this.activateEvent({content:u.content,triggeredAt:this.state.clock});this.save()}resolve(a,s){const r=this.state.active.findIndex(h=>h.content.id===a);if(r===-1)return!1;const l=this.state.active[r],u=this.pickChoice(l.content,s),f=u?u.id:null;return this.state.active.splice(r,1),this.save(),this.notify(),this.eventBus.emit(Hc.RESOLVED,{eventId:a,choiceId:f,event:l.content}),u?.event&&this.eventBus.emit(u.event,{eventId:a,choiceId:f,payload:u.payload,event:l.content}),!0}reset(){this.state=lo(Lf),this.save(),this.notify()}activateEvent(a){const s=Sy(a);this.state.active.push(s),this.save(),this.notify(),this.eventBus.emit(Hc.TRIGGERED,{event:{...lo(s.content),triggeredAt:s.triggeredAt}})}pickChoice(a,s){const r=a.choices??[];if(r.length!==0){if(s){const l=r.find(u=>u.id===s);if(l)return l}return r[0]}}shouldTrigger(a,s){if(a.type==="time")return this.state.clock>=a.at;const r=BM.get(a.conditionId);if(!r)return!1;try{return!!r(a.params,s)}catch(l){return console.warn("Scheduler condition evaluation failed",a.conditionId,l),!1}}resolveTriggerTime(a){if(Number.isFinite(a.at))return Number(a.at);const s=Number.isFinite(a.in)?Number(a.in):0;return Math.max(0,this.state.clock+s)}sortQueue(){this.state.queue.sort((a,s)=>{const r=a.trigger.type==="time"?a.trigger.at:Number.POSITIVE_INFINITY,l=s.trigger.type==="time"?s.trigger.at:Number.POSITIVE_INFINITY;return r-l})}containsEvent(a){return this.state.active.some(s=>s.content.id===a)||this.state.queue.some(s=>s.content.id===a)}notify(){const a=this.getActiveEvents();for(const s of this.subscribers)try{s(a)}catch(r){console.warn("Scheduler subscriber failed",r)}}load(){const a=em(this.storageKey);if(!a){this.state=lo(Lf);return}const s=Number(a.clock);this.state={clock:Number.isFinite(s)?s:0,queue:Array.isArray(a.queue)?a.queue.map(r=>jM(r)):[],active:Array.isArray(a.active)?a.active.map(r=>Sy(r)):[]}}save(){const a=this.getStorage();if(a)try{a.setItem(this.storageKey,JSON.stringify({clock:this.state.clock,queue:this.state.queue,active:this.state.active}))}catch(s){console.warn("Scheduler persistence failed",s)}}}const Ao=new GM;function YM(t,a){const s=new WeakSet,r=l=>{l.policy.id===t.id&&(a.once!==!1&&s.has(l.state)||(a.invoke(l),a.once!==!1&&s.add(l.state)))};re.on(a.event,r)}for(const t of f2())for(const a of t.effects)YM(t,a);const FM="modulepreload",VM=function(t){return"/"+t},My={},$M=function(a,s,r){let l=Promise.resolve();if(s&&s.length>0){let m=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),h=f?.nonce||f?.getAttribute("nonce");l=m(s.map(p=>{if(p=VM(p),p in My)return;My[p]=!0;const g=p.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const v=document.createElement("link");if(v.rel=g?"stylesheet":FM,g||(v.as="script"),v.crossOrigin="",v.href=p,h&&v.setAttribute("nonce",h),document.head.appendChild(v),g)return new Promise((M,x)=>{v.addEventListener("load",M),v.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${p}`)))})}))}function u(f){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=f,window.dispatchEvent(h),!h.defaultPrevented)throw f}return l.then(f=>{for(const h of f||[])h.status==="rejected"&&u(h.reason);return a().catch(u)})},XM=({building:t,coord:a,state:s})=>{t instanceof Wh?s.modifyPassiveGeneration(oe.SAUNA_BEER,t.beerPerTick):t instanceof i2&&$M(async()=>{const{spawnUnit:r}=await Promise.resolve().then(()=>ux);return{spawnUnit:r}},void 0).then(({spawnUnit:r})=>{r(s,"soldier",`barracks-${a.q}-${a.r}`,a,"player")})},QM=({building:t,state:a})=>{t instanceof Wh&&a.modifyPassiveGeneration(oe.SAUNA_BEER,-t.beerPerTick)};re.on("buildingPlaced",XM);re.on("buildingRemoved",QM);const Un={master:{defaultVolume:.9,volumeKey:"audio.mixer.master.volume",muteKey:"audio.mixer.master.muted"},music:{defaultVolume:.65,volumeKey:"audio.mixer.music.volume",muteKey:"audio.mixer.music.muted"},sfx:{defaultVolume:1,volumeKey:"audio.mixer.sfx.volume",muteKey:"audio.mixer.sfx.muted"}},Je={master:{volume:Un.master.defaultVolume,muted:!1},music:{volume:Un.music.defaultVolume,muted:!1},sfx:{volume:Un.sfx.defaultVolume,muted:!1}},Kn={};let kn=null,vh=!1;const Sh=new Set;function nm(t,a){return Number.isFinite(t)?t<=0?0:t>=1?1:t:a}function uu(){if(typeof localStorage>"u")return null;try{return localStorage}catch(t){return console.warn("Audio mixer storage unavailable",t),null}}function KM(t){const a=uu();if(!a)return null;try{const s=a.getItem(Un[t].volumeKey);if(s===null)return null;const r=Number.parseFloat(s);return Number.isFinite(r)?nm(r,Un[t].defaultVolume):null}catch(s){return console.warn("Failed to restore volume setting",t,s),null}}function PM(t){const a=uu();if(!a)return null;try{const s=a.getItem(Un[t].muteKey);return s===null?null:s==="true"}catch(s){return console.warn("Failed to restore mute setting",t,s),null}}for(const t of Object.keys(Un)){const a=KM(t),s=PM(t);a!==null&&(Je[t].volume=nm(a,Un[t].defaultVolume)),s!==null&&(Je[t].muted=s)}function ZM(t){const a=uu();if(a)try{a.setItem(Un[t].volumeKey,Je[t].volume.toFixed(3))}catch(s){console.warn("Failed to persist volume setting",t,s)}}function JM(t){const a=uu();if(a)try{a.setItem(Un[t].muteKey,Je[t].muted?"true":"false")}catch(s){console.warn("Failed to persist mute setting",t,s)}}function Ey(){if(typeof window>"u"||!kn||vh)return;const t=()=>{kn?.resume().catch(()=>{})};window.addEventListener("pointerdown",t,{once:!0}),window.addEventListener("keydown",t,{once:!0}),vh=!0}function am(t){const a=Kn[t];if(!a)return;const{volume:s,muted:r}=Je[t],l=r?0:s;a.gain.value=l}function v2(t){if(!Kn.master){const a=t.createGain();a.gain.value=Je.master.muted?0:Je.master.volume,a.connect(t.destination),Kn.master=a}if(!Kn.music){const a=t.createGain();a.gain.value=Je.music.muted?0:Je.music.volume,a.connect(Kn.master),Kn.music=a}if(!Kn.sfx){const a=t.createGain();a.gain.value=Je.sfx.muted?0:Je.sfx.volume,a.connect(Kn.master),Kn.sfx=a}}function im(){if(kn||typeof window>"u")return kn;const t=window.AudioContext||window.webkitAudioContext;if(!t)return console.warn("Web Audio API not supported"),null;try{kn=new t,v2(kn),Ey()}catch(a){return console.warn("Unable to create AudioContext",a),kn=null,null}return kn.state==="suspended"&&(vh=!1,Ey()),kn}function WM(){return kn??im()}function Df(t){const a=Je.master;if(t==="master")return a.muted?0:a.volume;const s=Je[t];return s.muted||a.muted?0:s.volume*a.volume}function sm(t){const a=WM();if(!a)return null;v2(a);const s=Kn[t];return s?(am(t),s):null}function du(){return{channels:{master:{volume:Je.master.volume,muted:Je.master.muted,effectiveVolume:Df("master")},music:{volume:Je.music.volume,muted:Je.music.muted,effectiveVolume:Df("music")},sfx:{volume:Je.sfx.volume,muted:Je.sfx.muted,effectiveVolume:Df("sfx")}},contextState:kn?.state??"uninitialized"}}function S2(){const t=du();for(const a of Sh)a(t)}function rm(t){return Sh.add(t),()=>{Sh.delete(t)}}function om(t,a){const s=nm(a,Un[t].defaultVolume);Je[t].volume!==s&&(Je[t].volume=s,ZM(t),am(t),S2())}function lm(t,a){Je[t].muted!==a&&(Je[t].muted=a,JM(t),am(t),S2())}function eE(t){om("master",t)}function tE(t){om("music",t)}function nE(t){om("sfx",t)}function aE(t){lm("master",t)}function iE(t){lm("music",t)}function sE(t){lm("sfx",t)}function Gc(t){return du().channels[t]}const rE=48e3;function oE(t){let a=t>>>0;return()=>{a+=1831565813;let s=a;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}}function lE(t,a,s){const{attack:r,decay:l,sustain:u,release:f,sustainLevel:h}=t;if(r>0&&s<r)return s/r;if(l>0&&s<r+l){const m=(s-r)/l;return 1-(1-h)*m}if(s<a-f)return h;if(f>0&&s<a){const m=(s-(a-f))/f;return h*(1-m)}return 0}function cE(t,a,s){const r=t.phase??0,l=t.vibrato,u=t.tremolo,f=l?1+l.depth*Math.sin(2*Math.PI*l.speed*s):1,h=u?t.gain*(1-u.depth+u.depth*Math.sin(2*Math.PI*u.speed*s)):t.gain,m=a*t.ratio*f;return h*Math.sin(2*Math.PI*m*s+r)}function uE(t,a){return t.gain*(a()*2-1)}function dE(t,a=rE){const s=Math.max(1,Math.floor(t.duration*a)),r=new Float32Array(s),l=oE(t.seed);for(let u=0;u<s;u++){const f=u/a;let h=0;for(const p of t.layers)p.type==="sine"?h+=cE(p,t.baseFrequency,f):h+=uE(p,l);const m=lE(t.envelope,t.duration,f);r[u]=h*m}return r}const If={attack:{variants:[{id:"attack-a",label:"Gentle Birch Strike",description:"Soft mallet transient with subtle shimmer.",duration:.9,baseFrequency:220,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:421,loudness:{lufs:-14.775,peakDb:-2.134,gain:.8684}},{id:"attack-b",label:"Rounded Pluck Echo",description:"A slightly brighter chime tuned above the root.",duration:.9,baseFrequency:232,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:947,loudness:{lufs:-14.758,peakDb:-2.101,gain:.8667}},{id:"attack-c",label:"High Drift Pluck",description:"Upper register tap with airy decay.",duration:.9,baseFrequency:244,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:1337,loudness:{lufs:-14.731,peakDb:-2.076,gain:.8641}}]},death:{variants:[{id:"death-a",label:"Hollow Exhale",description:"Low cedar drum pulse with airy noise tail.",duration:1.15,baseFrequency:150,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:615,loudness:{lufs:-14.365,peakDb:-.218,gain:.8284}},{id:"death-b",label:"Soft Ember Fall",description:"Mid register thump with drifting undertone.",duration:1.15,baseFrequency:168,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:274,loudness:{lufs:-14.204,peakDb:-.185,gain:.8132}},{id:"death-c",label:"Warm Resolve",description:"Higher pitch breathy release with gentle rumble.",duration:1.15,baseFrequency:184,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:978,loudness:{lufs:-14.079,peakDb:-.16,gain:.8015}}]},sisu:{variants:[{id:"sisu-a",label:"Rising Steam",description:"Slow bloom of airy sine pads with hushed texture.",duration:1.9,baseFrequency:176,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1204,loudness:{lufs:-12.754,peakDb:-.501,gain:.6882}},{id:"sisu-b",label:"Glowing Drift",description:"Warmer harmonic swell with chorus shimmer.",duration:1.9,baseFrequency:188,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1642,loudness:{lufs:-12.943,peakDb:-.271,gain:.7033}},{id:"sisu-c",label:"Morning Brilliance",description:"Bright tonic swell with shimmering overtones.",duration:1.9,baseFrequency:200,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:2019,loudness:{lufs:-12.888,peakDb:-.235,gain:.6989}}]}};function Uf(t){return{id:t.id,label:t.label,envelope:t.envelope,gain:t.loudness.gain,loader:a=>{const s=dE(t,a.sampleRate),r=a.createBuffer(1,s.length,a.sampleRate);return r.getChannelData(0).set(s),r}}}const fE={click:{variants:[{id:"ui-click-soft",label:"UI soft tap",envelope:{attack:0,decay:.05,sustain:0,release:.03,sustainLevel:0},loader:t=>mE(t)}],debounce:{windowMs:35,weight:.5,maxWeight:1.5},polyphony:6},spawn:{variants:[{id:"ui-spawn-chime",label:"Roster invite tone",envelope:{attack:0,decay:.2,sustain:.5,release:.2,sustainLevel:.5},loader:t=>pE(t)}],debounce:{windowMs:150,weight:.7,maxWeight:1.4},polyphony:3},error:{variants:[{id:"ui-error-tone",label:"Gentle warning tap",envelope:{attack:.01,decay:.2,sustain:.2,release:.2,sustainLevel:.2},loader:t=>gE(t)}],debounce:{windowMs:220,weight:1,maxWeight:1},polyphony:2},attack:{variants:If.attack.variants.map(Uf),debounce:{windowMs:120,weight:.6,maxWeight:1.2},polyphony:3},death:{variants:If.death.variants.map(Uf),debounce:{windowMs:360,weight:1,maxWeight:1.5},polyphony:3},sisu:{variants:If.sisu.variants.map(Uf),debounce:{windowMs:900,weight:1,maxWeight:1},polyphony:1}};let cc=null;const xy=new Map,uc=new Map,Yc=new Map,tr=new Map,Mo=new Map,Ay=new Map,Ht={node:null,destination:null,envelope:0,lastUpdate:0},co={attackSeconds:.04,releaseSeconds:.6,depth:.55,floor:.25},Mh=new Set;function cm(){const t=Gc("master"),a=Gc("sfx");return t.muted||a.muted}function hE(){const t=cm();for(const a of Mh)a(t)}function um(t,a,s){const r=Math.floor(t.sampleRate*a),l=t.createBuffer(1,r,t.sampleRate),u=l.getChannelData(0);for(let f=0;f<r;f++){const h=f/t.sampleRate;u[f]=s(h)}return l}function mE(t){return um(t,.05,a=>Math.sin(2*Math.PI*1e3*a)*Math.exp(-40*a))}function pE(t){return um(t,.2,a=>(Math.sin(2*Math.PI*440*a)+Math.sin(2*Math.PI*660*a))*.5*Math.exp(-6*a))}function gE(t){return um(t,.3,a=>Math.sin(2*Math.PI*110*a)*Math.exp(-8*a))}function wy(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function yE(t,a){return`${t}:${a}`}function bE(t,a,s){const r=yE(t,a),l=xy.get(r);if(l)return Promise.resolve(l);const u=uc.get(r);if(u)return u;const f=dm();if(!f)return Promise.reject(new Error("Audio context unavailable"));const h=Promise.resolve(s.loader(f)).then(m=>(xy.set(r,m),uc.delete(r),m)).catch(m=>{throw uc.delete(r),m});return uc.set(r,h),h}function Cy(t){const a=t.polyphony;return!Number.isFinite(a)||!a||a<=0?Number.POSITIVE_INFINITY:a}function vE(t,a){const s=Yc.get(t);if(!s||s.length===0)return[];const r=[];for(const l of s)l.time>=a&&r.push(l);return Yc.set(t,r),r}function SE(t,a,s){const r=a.debounce;if(!r)return{blocked:!1,weight:0};const l=r.weight??1,u=r.windowMs,f=s-u,h=vE(t,f);let m=0;for(const p of h)m+=p.weight;return m+l>r.maxWeight?{blocked:!0}:{blocked:!1,weight:l}}function ME(t,a,s){if(s<=0)return;const r=Yc.get(t)??[];r.push({time:a,weight:s}),Yc.set(t,r)}function EE(t){const a=(tr.get(t)??0)+1;tr.set(t,a)}function xE(t){const a=tr.get(t)??0;if(a<=1){tr.delete(t);return}tr.set(t,a-1)}function Ty(t,a){if(!Number.isFinite(a))return!1;const s=Mo.get(t)?.size??0,r=tr.get(t)??0;return s+r>=a}function AE(t,a){let s=Mo.get(t);s||(s=new Set,Mo.set(t,s)),s.add(a);let r=!1;const l=()=>{if(r)return;r=!0;const u=Mo.get(t);u?.delete(a),u&&u.size===0&&Mo.delete(t)};if(typeof a.addEventListener=="function")a.addEventListener("ended",()=>{l()},{once:!0});else{const u=a.onended;a.onended=()=>{try{u?.call(a)}finally{l()}}}return l}function wE(t,a){const s=Ht.node;if(!s||s.context!==t){Ht.node?.disconnect();const r=t.createGain();return r.gain.value=1,r.connect(a),Ht.node=r,Ht.destination=a,Ht.envelope=0,Ht.lastUpdate=t.currentTime,r}return Ht.destination!==a&&(s.disconnect(),s.connect(a),Ht.destination=a),s}function CE(t){const a=Ht.node;if(!a)return;const s=t.currentTime,r=.6,l=.55,u=Math.max(0,s-Ht.lastUpdate),f=Math.exp(-u/r);Ht.envelope*=f,Ht.envelope=Math.min(1,Ht.envelope+l),Ht.lastUpdate=s;const p=Math.max(.35,1-Ht.envelope*.5),g=.02;a.gain.cancelScheduledValues(s),a.gain.setValueAtTime(a.gain.value,s),a.gain.linearRampToValueAtTime(p,s+g),a.gain.setTargetAtTime(1,s+g,r)}function TE(t){const a=sm("music");if(!a)return;const s=Gc("master"),r=Gc("music");if(s.muted||r.muted)return;const l=r.volume;if(l<=0)return;const u=t.currentTime,f=a.gain.value,h=l*(1-co.depth),m=l*co.floor,p=Math.min(f,Math.max(h,m));a.gain.cancelScheduledValues(u),a.gain.setValueAtTime(f,u),a.gain.linearRampToValueAtTime(p,u+co.attackSeconds),a.gain.setTargetAtTime(l,u+co.attackSeconds,co.releaseSeconds)}function na(t){if(Eh())return;const a=fE[t];if(!a)return;const s=a.variants;if(!s||s.length===0)return;let r=0,l=s[0];s.length>1&&(r=((Ay.get(t)??Math.floor(Math.random()*s.length)-1)+1)%s.length,l=s[r],Ay.set(t,r));const u=wy(),f=SE(t,a,u);if(f.blocked)return;const h=Cy(a);if(Ty(t,h))return;EE(t);let m=!1;const p=()=>{m||(xE(t),m=!0)};bE(t,r,l).then(g=>{if(p(),Eh())return;const b=dm();if(!b)return;const v=sm("sfx");if(!v)return;const M=Cy(a);if(Ty(t,M))return;const x=b.createBufferSource();x.buffer=g;const T=l.gain;let _=x;if(typeof T=="number"&&T>0&&T!==1){const j=b.createGain();j.gain.value=T,x.connect(j),_=j}const R=t==="attack"?wE(b,v):v;_.connect(R);const I=AE(t,x);try{x.start(),t==="attack"&&CE(b),t==="sisu"&&TE(b);const j=wy();!f.blocked&&f.weight>0&&ME(t,j,f.weight)}catch(j){console.warn("Unable to start sound",j),I()}}).catch(g=>{p(),!(g instanceof Error&&g.message==="Audio context unavailable")&&console.warn("Failed to play sound",t,g)}).finally(()=>{p()})}function Eh(){return cm()}function _E(t){return Mh.add(t),()=>{Mh.delete(t)}}typeof document<"u"&&document.addEventListener("click",t=>{t.target instanceof HTMLButtonElement&&na("click")});let _y=cm();rm(t=>{const a=t.channels.master.muted||t.channels.sfx.muted;a!==_y&&(_y=a,hE())});function dm(){return cc||(cc=im(),cc)}dm();const Ny="__autobattlesAudioEvents__",Ry=globalThis;Ry[Ny]||(re.on("unitDamaged",t=>{!t||t.amount<=0||na("attack")}),re.on("unitDied",()=>{na("death")}),re.on("sisuBurstStart",()=>{na("sisu")}),Ry[Ny]=!0);const NE=[{content:{id:"command-briefing",headline:"Command Briefing: Ember Shift",body:"Sauna Command uplinks a focused playbook for your opening salvo. Keep the roster nimble, channel the ember currents, and set the tone for this run.",art:"/assets/ui/saunoja-roster.svg",typography:"serif",animation:"aurora",accentColor:"#7bdff2",acknowledgeText:"Deploy the roster"},trigger:{type:"time",in:2}},{content:{id:"recon-telemetry",headline:"Recon Telemetry Uploaded",body:"Forward drones stitched together a glacial panorama of enemy routes. Prioritize rapid response teams while the snowpack is still undisturbed.",art:"/assets/ui/resource.svg",typography:"sans",animation:"pulse",accentColor:"#fbcfe8",acknowledgeText:"Queue countermeasures"},trigger:{type:"time",in:12}},{content:{id:"supply-courier",headline:"Sauna Courier Docked",body:"A lacquered supply skiff glides into the bay with artisan tonics and reinforced stave kits. Decide how to allocate the haul before the next assault.",art:"/assets/ui/sauna-beer.svg",typography:"serif",animation:"tilt",accentColor:"#fde68a",choices:[{id:"frontline",label:"Stage for the frontline",description:"Prep the vanguard with the premium kit as morale surges.",accent:"primary"},{id:"reserve",label:"Stock the reserves",description:"Archive the crate for a later wave when pressure spikes.",accent:"ghost"}]},trigger:{type:"time",in:24}}];function RE(t=Ao){for(const a of NE)t.schedule(a)}RE();function kE(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function LE(t){const a={};if(!t)return a;for(const[s,r]of Object.entries(t))typeof r=="function"&&(a[s]=r);return a}class DE{constructor(a=re){this.emitter=a}modifiers=new Map;hookIndex=new Map;listeners=new Map;add(a){if(typeof a.id!="string"||a.id.length===0)throw new Error("Modifier id must be a non-empty string");if((typeof a.duration!="number"||!Number.isFinite(a.duration))&&a.duration!==1/0)throw new Error("Modifier duration must be a positive number or Infinity");if(Number.isFinite(a.duration)&&a.duration<=0)throw new Error("Modifier duration must be greater than zero");const s=LE(a.hooks),r=kE();this.modifiers.has(a.id)&&this.remove(a.id,"replaced");const l={...a,hooks:s,remaining:a.duration,appliedAt:r};this.modifiers.set(l.id,l),this.indexHooks(l);const u={runtime:this,modifier:l};return a.onApply?.(u),this.emit("modifierAdded",{modifier:l}),this.emitter?.emit("modifierAdded",{modifier:l}),Number.isFinite(l.remaining)&&l.remaining<=0&&this.remove(l.id,"expired"),l}has(a){return this.modifiers.has(a)}list(){return Array.from(this.modifiers.values()).map(a=>({...a,hooks:{...a.hooks}}))}remove(a,s="manual"){const r=this.modifiers.get(a);if(!r)return!1;this.modifiers.delete(a),this.unindexHooks(r);const l={runtime:this,modifier:r,reason:s};return r.onExpire?.(l),s==="expired"&&(this.emit("modifierExpired",{modifier:r}),this.emitter?.emit("modifierExpired",{modifier:r})),this.emit("modifierRemoved",{modifier:r,reason:s}),this.emitter?.emit("modifierRemoved",{modifier:r,reason:s}),!0}advance(a){if(typeof a!="number"||a<=0)return;const s=[];for(const r of this.modifiers.values())Number.isFinite(r.remaining)&&(r.remaining=Math.max(0,r.remaining-a),r.remaining<=0&&s.push(r.id));for(const r of s)this.remove(r,"expired")}trigger(a,s){const r=this.hookIndex.get(a);if(!r||r.size===0)return;const l=Array.from(r);for(const u of l){const f=this.modifiers.get(u);if(!f){r.delete(u);continue}const h=f.hooks[a];if(!h){r.delete(u);continue}h(s,{runtime:this,modifier:f})}}clear(){const a=Array.from(this.modifiers.keys());for(const s of a)this.remove(s,"manual")}on(a,s){const r=this.listeners.get(a)??new Set;r.add(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);r&&(r.delete(s),r.size===0&&this.listeners.delete(a))}emit(a,s){const r=this.listeners.get(a);if(!(!r||r.size===0))for(const l of Array.from(r))l(s)}indexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s)??new Set;r.add(a.id),this.hookIndex.set(s,r)}}unindexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s);r&&(r.delete(a.id),r.size===0&&this.hookIndex.delete(s))}}}const fu=new DE,IE=t=>fu.add(t),UE=(t,a="manual")=>fu.remove(t,a),OE=t=>{fu.advance(t)},dc=(t,a)=>{fu.trigger(t,a)};class zE{constructor(a,s,r){this.owner=a,this.entries=s,this.log=r}runTick(a,s){for(const{definition:r,state:l}of this.entries){if(!r.onTick)continue;const u=r.onTick({owner:this.owner,state:l,self:a,opponent:s}),f=$i(u?.shieldDamage??0);if(f>0){const m=Math.min(a.shield,f);m>0&&(a.shield-=m,this.log.tickShieldDamage+=m)}const h=$i(u?.hpDamage??0);if(h>0){const m=Math.min(a.health,h);m>0&&(a.health-=m,this.log.tickHpDamage+=m)}}}grantShield(a,s){let r=0;for(const{definition:l,state:u}of this.entries){if(!l.onGrantShield)continue;const f=$i(l.onGrantShield({owner:this.owner,state:u,self:a,opponent:s})??0);f>0&&(r+=f)}return r>0&&(a.shield+=r,this.log.shieldGranted+=r),r}consumeShield(a,s,r){let l=$i(a);if(l<=0)return 0;let u=0;for(const{definition:f,state:h}of this.entries){if(!f.onConsumeShield||l<=0)continue;const m=$i(f.onConsumeShield({owner:this.owner,state:h,self:s,opponent:r,amount:l})??0);if(m<=0)continue;const p=Math.min(l,m);u+=p,l-=p}return u>0&&(this.log.shieldConsumed+=u),u}applyHit(a,s,r){if(a<=0)return 0;let l=0;for(const{definition:h,state:m}of this.entries){if(!h.onHit)continue;const p=$i(h.onHit({owner:this.owner,state:m,self:s,opponent:r,hpDamage:a})??0);p>0&&(l+=p)}if(l<=0)return 0;const u=Math.max(0,s.maxHealth-s.health);if(u<=0)return 0;const f=Math.min(u,l);return f>0&&(s.health+=f,this.log.lifesteal+=f),f}getShieldValue(){let a=0;for(const{definition:s,state:r}of this.entries){if(!s.onGrantShield||r.keyword!=="Shield")continue;const l=xh(r);if(l<=0)continue;const u=Math.max(0,Number.isFinite(r.stacks)?r.stacks:0);u<=0||(a+=u*l)}return a}}function BE(){return{attacker:Ly(),defender:Ly()}}function ky(t,a,s){const r=qE(t);if(r.length===0)return null;const l=[];for(const u of r){const f=M2.get(u.keyword);f&&l.push({state:u,definition:f})}return l.length===0?null:new zE(a,l,s)}const M2=new Map;function hu(t,a){M2.set(t,a)}function Ly(){return{tickHpDamage:0,tickShieldDamage:0,shieldGranted:0,shieldConsumed:0,lifesteal:0,keywordShieldRemaining:0}}function $i(t){return typeof t!="number"||!Number.isFinite(t)?0:t>0?t:0}function rr(t){return typeof t!="number"||!Number.isFinite(t)?0:t>0?t:0}function Bo(t){return typeof t!="number"||!Number.isFinite(t)?0:t>0?t:0}function qE(t){if(!t)return[];const a=[],s=t;if(typeof s[Symbol.iterator]=="function"){for(const r of s){const l=Dy(r);l&&a.push(l)}return a}if(typeof t=="object")for(const r of Object.values(t)){const l=Dy(r);l&&a.push(l)}return a}function Dy(t){if(!t||typeof t!="object")return null;const a=t;if(!Object.prototype.hasOwnProperty.call(a,"stacks"))return null;const s=HE(a.keyword);if(!s)return null;const r=a;return r.keyword=s,r.stacks=rr(r.stacks),Object.prototype.hasOwnProperty.call(a,"potency")&&r.potency!==void 0&&(r.potency=Bo(r.potency)),r}function HE(t){if(typeof t!="string")return null;switch(t.trim().toLowerCase()){case"bleed":return"Bleed";case"burn":return"Burn";case"lifesteal":case"life-steal":return"Lifesteal";case"shield":return"Shield";default:return null}}function xh(t){const a=t.potency!==void 0?Bo(t.potency):1;return a>0?a:0}function jE(t){if(t.potency!==void 0){const r=Bo(t.potency);return r>0?r:0}const a=rr(t.stacks);if(a<=0)return 0;const s=a*.2;return s>0?s:0}hu("Bleed",{onTick({state:t,self:a}){const s=rr(t.stacks);if(s<=0||a.health<=0){t.stacks=s;return}const r=t.potency!==void 0?Bo(t.potency):1,l=s*r;if(l<=0)return;const u=Math.min(a.health,l);return t.stacks=Math.max(0,s-1),{hpDamage:u}}});hu("Burn",{onTick({state:t,self:a}){const s=rr(t.stacks);if(s<=0){t.stacks=s;return}const r=t.potency!==void 0?Bo(t.potency):1,l=s*r;if(l<=0)return;const u=Math.min(a.shield,l),f=l-u,h=Math.min(a.health,f);return t.stacks=Math.max(0,s-1),{shieldDamage:u,hpDamage:h}}});hu("Shield",{onGrantShield({state:t}){const a=rr(t.stacks);if(a<=0)return t.stacks=a,0;const s=a*xh(t);return s>0?s:0},onConsumeShield({state:t,amount:a}){const s=rr(t.stacks);if(s<=0)return t.stacks=0,0;const r=xh(t);if(r<=0)return t.stacks=0,0;const l=s*r;if(l<=0)return t.stacks=0,0;const u=Math.min(l,$i(a)),f=u/r;return t.stacks=Math.max(0,s-f),u>0?u:0}});hu("Lifesteal",{onHit({state:t,hpDamage:a}){if(a<=0)return 0;const s=jE(t);if(s<=0)return 0;const r=a*s;return r>0?r:0}});function Ln(t){return Number.isFinite(t)?Math.max(0,t):0}function Iy(t,a){const s=Ln(a?.health??t?.health??0),r=Ln(a?.shield??t?.shield??0);return{id:t?.id??"unknown",faction:t?.faction,health:s,maxHealth:t?.maxHealth,shield:r}}function Uy(t){if(!t)return!1;const a=t;return typeof a.onHit=="function"||typeof a.onKill=="function"||Array.isArray(a.onHit)||Array.isArray(a.onKill)}function Oy(t){return t?Array.isArray(t)?t.filter(a=>typeof a=="function"):typeof t=="function"?[t]:[]:[]}function GE(t){if(!t)return[];if(typeof t[Symbol.iterator]=="function"){const s=[];for(const r of t)Uy(r)&&s.push(r);return s}return Object.values(t).filter(s=>Uy(s))}function fc(t,a,s){if(!t)return;const r=Oy(t.hooks?.[a]);for(const u of r)u(s);const l=GE(t.keywords);for(const u of l)for(const f of Oy(u[a]))f(s)}function zy(t){const a=Ln(t?.health??0),s=Ln(t?.maxHealth??a);return{health:a,maxHealth:Math.max(s,a),shield:Ln(t?.shield??0)}}function YE(){return{health:0,maxHealth:0,shield:0}}function FE(t){const a=t.attacker??null,s=t.defender,r=t.baseDamage,l=Ln(t.minimumDamage??1),u=Number.isFinite(r)?Ln(r):Ln(a?.attack??0),f=Ln(s.defense??0),h=BE(),m=zy(s),p=a?zy(a):null,g=ky(s.keywords??null,"defender",h.defender),b=a?ky(a.keywords??null,"attacker",h.attacker):null,v=p??YE();g&&g.runTick(m,v),b&&p&&b.runTick(p,m);const M=m.health>0,x=Ln(m.shield);g&&g.grantShield(m,v);const T=Ln(m.shield),_=M?Math.max(l,u-f):0,R=M?Math.min(T,_):0,I=M?Math.max(0,_-R):0;m.shield=Math.max(0,T-R);const j=Math.min(x,R),V=Math.max(0,R-j);g&&V>0&&g.consumeShield(V,m,v);const X=g?g.getShieldValue():0;h.defender.keywordShieldRemaining=X;const $=Math.max(0,x-j);m.shield=$+X;const ee=m.health;m.health=Math.max(0,ee-I);const te=m.health,Y=te<=0;let B=0;b&&p?(B=b.applyHit(I,p,m),h.attacker.keywordShieldRemaining=b.getShieldValue()):h.attacker.keywordShieldRemaining=0;const C=Iy(a,p??void 0),J=Iy(s,{health:te,shield:$+X}),q={attacker:C,defender:J,damage:_,shieldDamage:R,hpDamage:I,lethal:Y},ae={...q,source:"defender"};if(fc(s,"onHit",ae),dc("combat:onHit",ae),a){const F={...q,source:"attacker"};fc(a,"onHit",F),dc("combat:onHit",F),Y&&(fc(a,"onKill",F),dc("combat:onKill",F))}return Y&&(fc(s,"onKill",ae),dc("combat:onKill",ae)),{damage:_,shieldDamage:R,hpDamage:I,lethal:Y,remainingHealth:te,remainingShield:$+X,attackerHealing:B,attackerRemainingHealth:p?.health,attackerRemainingShield:p?.shield,keywordEffects:h}}const By=5;function cn(t){return`${t.q},${t.r}`}function qy(t){const[a,s]=t.split(",").map(Number);return{q:a,r:s}}function Vs(t){return{q:t.q,r:t.r}}class VE{constructor(a,s,r,l,u,f=[]){this.id=a,this.type=s,this.faction=l,this.stats=u,this.priorityFactions=f,this.coord=Vs(r),this.renderCoord=Vs(r),this.maxHealth=u.health}alive=!0;listeners={};maxHealth;healMarkerElapsed=0;healAmountBuffer=0;cachedTargetKey;cachedStartKey;cachedPath;movementCooldownSeconds=0;shield=0;immortal=!1;experience=0;combatHooks=null;combatKeywords=null;coord;renderCoord;setCoord(a,s){this.coord=Vs(a),(s?.snapRender??!0)&&(this.renderCoord=Vs(a))}setRenderCoord(a){this.renderCoord=Vs(a)}snapRenderToCoord(a=this.coord){this.renderCoord=Vs(a)}onDeath(a){(this.listeners.death??=[]).push(a)}emitDeath(){for(const a of this.listeners.death??[])a()}isDead(){return!this.alive}getMaxHealth(){return this.maxHealth}distanceTo(a){return Zs(this.coord,a)}getVisionRange(){const{visionRange:a}=this.stats;return Number.isFinite(a)?a:3}attack(a){return this.distanceTo(a.coord)>this.stats.attackRange?null:a.takeDamage(this.stats.attackDamage,this)}update(a,s){if(!(this.isDead()||!s))if(Zs(this.coord,s.pos)<=s.auraRadius){const r=this.stats.health;if(this.stats.health=Math.min(this.stats.health+s.regenPerSec*a,this.maxHealth),this.stats.health>r){const l=this.stats.health-r;this.healMarkerElapsed+=a,this.healAmountBuffer+=l,(this.healMarkerElapsed>=.9||this.healAmountBuffer>=2)&&this.flushHealEvent()}}else this.healAmountBuffer>0&&this.flushHealEvent(),this.healMarkerElapsed=0,this.healAmountBuffer=0}flushHealEvent(){if(this.healAmountBuffer<=0){this.healMarkerElapsed=0;return}const a=Math.round(this.healAmountBuffer*10)/10;a>0&&re.emit("unitHealed",{unitId:this.id,amount:a,remainingHealth:this.stats.health}),this.healAmountBuffer=0,this.healMarkerElapsed=0}takeDamage(a,s){const r=Number.isFinite(a);if(r&&a<=0||!r&&!s)return null;const l=s?s.toCombatParticipant():null,u=this.toCombatParticipant(),f=FE({attacker:l,defender:u,baseDamage:r?a:void 0});this.stats.health=f.remainingHealth,this.shield=f.remainingShield;let h=f;if(f.lethal&&this.alive&&this.immortal&&(this.stats.health=Math.max(1,this.stats.health),h={...f,lethal:!1,remainingHealth:this.stats.health,remainingShield:this.shield}),s&&f.attackerRemainingHealth!==void 0){const m=Math.min(s.getMaxHealth(),Math.max(0,f.attackerRemainingHealth));s.stats.health=m}return s&&f.attackerRemainingShield!==void 0&&s.setShield(f.attackerRemainingShield),h.damage>0&&re.emit("unitDamaged",{attackerId:s?.id,targetId:this.id,amount:h.damage,remainingHealth:this.stats.health}),h.lethal&&this.alive&&(this.stats.health=0,this.alive=!1,this.snapRenderToCoord(),re.emit("unitDied",{unitId:this.id,attackerId:s?.id,unitFaction:this.faction,attackerFaction:s?.faction}),this.emitDeath()),h}getShield(){return this.shield}setShield(a){if(!Number.isFinite(a)||a<=0){this.shield=0;return}this.shield=a}updateStats(a){this.stats.attackDamage=a.attackDamage,this.stats.attackRange=a.attackRange,this.stats.movementRange=a.movementRange,typeof a.defense=="number"&&Number.isFinite(a.defense)?this.stats.defense=a.defense:delete this.stats.defense,typeof a.visionRange=="number"&&Number.isFinite(a.visionRange)&&(this.stats.visionRange=a.visionRange);const s=Math.max(1,Math.round(a.health));this.maxHealth=s,this.stats.health=Math.min(s,Math.max(0,this.stats.health))}isImmortal(){return this.immortal}setImmortal(a){this.immortal=!!a}getExperience(){return this.experience}setExperience(a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;s!==this.experience&&(this.experience=s,re.emit("unit:xpChanged",{unitId:this.id,xp:this.experience}))}addExperience(a){if(!Number.isFinite(a)||a===0)return this.experience;const s=Math.max(0,Math.floor(this.experience+a));return this.setExperience(s),this.experience}toCombatParticipant(){return{id:this.id,faction:this.faction,attack:this.stats.attackDamage,defense:this.stats.defense,health:this.stats.health,maxHealth:this.maxHealth,shield:this.shield,hooks:this.combatHooks,keywords:this.combatKeywords}}addMovementTime(a){!Number.isFinite(a)||a<=0||(this.movementCooldownSeconds+=a)}canStep(a=By){return this.movementCooldownSeconds>=a}consumeMovementCooldown(a=By){return this.canStep(a)?(this.movementCooldownSeconds-=a,!0):!1}moveTowards(a,s,r){const l=this.getPathTo(a,s,r);if(l.length<2)return[];let u=0;const f=cn(a);for(let m=1;m<l.length;m++){const p=cn(l[m]);if(r.has(p)){p!==f&&this.clearPathCache();break}u=m}if(u===0)return[];const h=Math.min(this.stats.movementRange,u);return l.slice(0,h+1)}getPathTo(a,s,r){const l=cn(this.coord),u=cn(a);return(!this.cachedPath||this.cachedTargetKey!==u||this.cachedStartKey!==l)&&(this.cachedPath=this.findPath(a,s,r),this.cachedTargetKey=u,this.cachedStartKey=l),this.cachedPath}advancePathCache(a){!this.cachedPath||a<=0||(this.cachedPath=this.cachedPath.slice(a),this.cachedPath.length>0?this.cachedStartKey=cn(this.cachedPath[0]):(this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0))}clearPathCache(){this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0}findPath(a,s,r){const l=this.coord,u=cn(l),f=cn(a),h=new Set([u]),m=new Map([[u,null]]),p=new Map([[u,0]]),g=new Map([[u,Zs(l,a)]]);for(;h.size>0;){let M=null,x=1/0;for(const R of h){const I=g.get(R)??1/0;I<x&&(x=I,M=R)}if(M===null||M===f)break;h.delete(M);const T=qy(M),_=p.get(M)??1/0;for(const R of Oc(T)){const I=cn(R);if(I!==f&&!this.isPassable(R,s,r))continue;const j=_+1;j<(p.get(I)??1/0)&&(m.set(I,M),p.set(I,j),g.set(I,j+Zs(R,a)),h.add(I))}}if(!m.has(f))return[l];const b=[];let v=f;for(;v;)b.push(qy(v)),v=m.get(v)??null;return b.reverse()}seekNearestEnemy(a,s,r){const l=new Map;for(const h of a)l.set(cn(h.coord),h);const u=[this.coord],f=new Set([cn(this.coord)]);for(;u.length>0;){const h=u.shift(),m=cn(h),p=l.get(m);if(p)return p;for(const g of Oc(h)){const b=cn(g),v=l.get(b);if(v)return v;this.isPassable(g,s,r)&&(f.has(b)||(f.add(b),u.push(g)))}}return null}canTraverse(a,s,r){return this.isPassable(a,s,r)}isPassable(a,s,r){const l=s.getTile(a.q,a.r);return!l||r&&r.has(cn(a))?!1:l.terrain!==En.Lake}}class $E{static selectTarget(a,s){let r=s.filter(u=>u.faction!==a.faction&&!u.isDead());if(r.length===0)return null;if(a.priorityFactions.length>0){const u=r.filter(f=>a.priorityFactions.includes(f.faction));u.length>0&&(r=u)}const l=r.filter(u=>a.distanceTo(u.coord)<=a.stats.attackRange);return l.length>0?(l.sort((u,f)=>u.stats.health-f.stats.health),l[0]):(r.sort((u,f)=>a.distanceTo(u.coord)-a.distanceTo(f.coord)),r[0]??null)}}const XE=4,QE=8;class KE{buckets=[];bucketCount=0;currentBucket=0;minBuckets;maxBuckets;constructor(a={}){this.minBuckets=a.minBuckets??XE,this.maxBuckets=a.maxBuckets??QE}reset(){this.buckets=[],this.bucketCount=0,this.currentBucket=0}next(a){const s=a.length;if(s===0)return this.reset(),[];const r=this.computeBucketCount(s);r!==this.bucketCount&&(this.bucketCount=r,this.currentBucket=this.currentBucket%Math.max(1,r)),this.rebuildBuckets(a);const l=this.buckets[this.currentBucket]??[];return this.bucketCount>0&&(this.currentBucket=(this.currentBucket+1)%this.bucketCount),l}rebuildBuckets(a){const s=this.bucketCount;this.buckets=Array.from({length:s},()=>[]);const r=[...a].sort((l,u)=>l.id.localeCompare(u.id));for(let l=0;l<r.length;l++){const u=l%s;this.buckets[u].push(r[l])}}computeBucketCount(a){if(a<=0)return 0;const s=Math.ceil(a/12);let r=Math.max(this.minBuckets,s);return r=Math.min(this.maxBuckets,r),r=Math.min(r,a),r=Math.max(1,r),r}}function Of(t){return`${t.q},${t.r}`}const PE=500;class ZE{cache=new Map;targetIndex=new Map;targetPositions=new Map;ttlMs;constructor(a=PE){this.ttlMs=a}clearExpired(a=Date.now()){for(const[s,r]of this.cache.entries())if(r.expiresAt<=a&&(this.cache.delete(s),r.targetId)){const l=this.targetIndex.get(r.targetId);l?.delete(s),l&&l.size===0&&this.targetIndex.delete(r.targetId)}}trackUnit(a){this.invalidateIfTargetMoved(a.id,Of(a.coord))}invalidateForUnit(a){const s=this.targetIndex.get(a);if(s){for(const r of s)this.cache.delete(r);this.targetIndex.delete(a)}this.targetPositions.delete(a)}getPath(a,s,r,l,u={}){const f=u.now??Date.now(),h=u.targetId,m=Of(s);h&&this.invalidateIfTargetMoved(h,m);const p=this.hashObstacles(l),g=this.createCacheKey(Of(a.coord),m,p),b=this.cache.get(g);if(b&&b.expiresAt>f)return b.path;a.clearPathCache();const v=a.getPathTo(s,r,l);if(this.cache.set(g,{path:v,expiresAt:f+this.ttlMs,targetId:h}),h){let M=this.targetIndex.get(h);M||(M=new Set,this.targetIndex.set(h,M)),M.add(g),this.targetPositions.set(h,m)}return v}invalidateIfTargetMoved(a,s){const r=this.targetPositions.get(a);if(!r){this.targetPositions.set(a,s);return}if(r===s)return;const l=this.targetIndex.get(a);if(l){for(const u of l)this.cache.delete(u);l.clear()}this.targetPositions.set(a,s)}hashObstacles(a){return a.size===0?"empty":Array.from(a).sort().join("|")}createCacheKey(a,s,r){return`${a}->${s}|${r}`}}const JE={baseThreshold:50,heatPerSecond:50/30,thresholdGrowth:.05,coolingPerSecond:0};function zt(t,a=0){return Number.isFinite(t)?t:a}class WE{heat;threshold;baseThreshold;thresholdGrowthFactor;heatPerSecond;coolingPerSecond;maxStoredHeat;constructor(a={}){const s={...JE,...a},r=Math.max(1,zt(s.baseThreshold,50)),l=Math.max(1,zt(a.initialThreshold??r,r));this.baseThreshold=r,this.threshold=l,this.thresholdGrowthFactor=1+Math.max(0,zt(s.thresholdGrowth,0)),this.heatPerSecond=Math.max(0,zt(s.heatPerSecond,0)),this.coolingPerSecond=Math.max(0,zt(s.coolingPerSecond,0));const u=zt(s.maxStoredHeat??Number.NaN,Number.NaN);this.maxStoredHeat=Number.isFinite(u)&&u>=0?u:null;const f=Math.max(0,zt(a.initialHeat??0,0));this.heat=this.setHeatInternal(f)}getHeat(){return this.heat}getThreshold(){return this.threshold}getBuildRate(){return this.heatPerSecond}getCoolingRate(){return this.coolingPerSecond}reset(){this.heat=0,this.threshold=this.baseThreshold}setHeat(a){const s=Math.max(0,zt(a,0));return this.heat=this.setHeatInternal(s),this.heat}setHeatInternal(a){const s=Math.max(0,zt(a,0));return this.maxStoredHeat===null?(this.heat=s,this.heat):(this.heat=Math.min(s,this.maxStoredHeat),this.heat)}addHeat(a){const s=Math.max(0,zt(a,0));if(s<=0)return 0;const r=this.heat,l=r+s;return this.heat=this.maxStoredHeat===null?l:Math.min(l,this.maxStoredHeat),this.heat-r}cool(a){const s=Math.max(0,zt(a,0));if(s<=0||this.heat<=0)return 0;const r=this.heat;return this.heat=Math.max(0,this.heat-s),r-this.heat}vent(a=1){const s=Math.max(0,Math.min(1,zt(a,1)));return s<=0?0:this.cool(this.threshold*s)}advance(a,s){const r=Math.max(0,zt(a,0)),l=this.heatPerSecond,u=r>0?l*r:0,f=Math.max(0,zt(s?.bonusHeat??0,0)),h=u+f,m=this.addHeat(h),p=Math.max(0,zt(s?.coolingMultiplier??1,1)),g=r>0?this.coolingPerSecond*r*p:0,b=this.cool(g);return{addedHeat:m,cooledHeat:b,heat:this.heat}}hasTriggerReady(){return this.heat>=this.threshold-1e-6}consumeTrigger(){return this.hasTriggerReady()?(this.cool(this.threshold),this.threshold=Math.max(this.baseThreshold,this.threshold*this.thresholdGrowthFactor),!0):!1}timeUntilNextTrigger(){return this.hasTriggerReady()?0:this.heatPerSecond<=0?Number.POSITIVE_INFINITY:Math.max(0,this.threshold-this.heat)/this.heatPerSecond}getCooldownSeconds(){return this.heatPerSecond<=0?Number.POSITIVE_INFINITY:this.threshold/this.heatPerSecond}}function ex(t){return new WE(t)}const Hy=500,tx=4;function E2(t,a,s){const r=typeof a=="number"?a:2,l=(typeof a=="number"?s:a)??[],u=[];for(let h=-r;h<=r;h++){const m=Math.max(-r,-h-r),p=Math.min(r,-h+r);for(let g=m;g<=p;g++){const b=Math.max(Math.abs(h),Math.abs(g),Math.abs(-h-g));if(b===0||b>r)continue;const v={q:t.q+h,r:t.r+g};l.some(x=>!x.isDead()&&x.coord.q===v.q&&x.coord.r===v.r)||u.push(v)}}if(u.length===0)return null;const f=Math.floor(Math.random()*u.length);return u[f]}function nx(t,a,s={}){const r=ex(a),l=r.getBuildRate(),u=r.getCooldownSeconds(),f=r.timeUntilNextTrigger(),h=Number.isFinite(s.maxRosterSize)?Math.max(0,Math.floor(s.maxRosterSize??0)):0,m=Number.isFinite(s.maxHealth)?Math.max(1,Math.floor(s.maxHealth??Hy)):Hy,p=Number.isFinite(s.health)?Math.max(0,Math.min(m,Math.floor(s.health??m))):m,g=Number.isFinite(s.visionRange)?Math.max(0,Math.floor(s.visionRange??0)):Math.max(0,Math.floor(s.tier?.visionRange??tx));return{id:"sauna",pos:t,auraRadius:2,visionRange:g,regenPerSec:1,rallyToFront:!1,maxRosterSize:h,maxHealth:m,health:p,destroyed:p<=0,heat:r.getHeat(),heatPerTick:l,playerSpawnThreshold:r.getThreshold(),playerSpawnCooldown:Number.isFinite(u)?u:0,playerSpawnTimer:Number.isFinite(f)?f:0,beerUpkeepAccumulator:0,heatTracker:r}}function ax(t,a){if(!Number.isFinite(a)||a<=0||t.destroyed)return{amount:0,remainingHealth:Math.max(0,t.health),destroyed:t.destroyed};const s=Math.max(0,t.health),r=Math.min(s,Math.max(0,Math.floor(a))),l=Math.max(0,s-r);return t.health=l,l<=0&&(t.health=0,t.destroyed=!0),{amount:r,remainingHealth:t.health,destroyed:t.destroyed}}const ix=30;function Bt(t){return`${t.q},${t.r}`}class sx{constructor(a,s){this.map=a,this.animator=s}scheduler=new KE;pathCache=new ZE;lastKnownCoords=new Map;findExplorationGoal(a,s){const r=a.coord;if(this.map.ensureTile(r.q,r.r).isFogged&&a.canTraverse(r,this.map,s))return r;const u=new Set([Bt(r)]),f=[r];for(;f.length>0;){const h=f.shift(),m=Oc(h),p=this.map.getNeighbors(h.q,h.r);for(let g=0;g<m.length;g++){const b=m[g],v=p[g],M=Bt(b);if(!u.has(M)&&(u.add(M),!!a.canTraverse(b,this.map,s))){if(v.isFogged)return b;f.push(b)}}}return null}tick(a,s,r){const l=a.length,u=Date.now();if(this.pathCache.clearExpired(u),l===0){this.scheduler.reset();return}const f=new Set,h=[],m=new Set;for(const g of a){if(g.addMovementTime(s),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g),this.lastKnownCoords.delete(g.id);continue}const b=this.lastKnownCoords.get(g.id);b&&Zs(b,g.coord)>1&&this.animator?.clear(g,{snap:!0}),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r}),this.pathCache.trackUnit(g),h.push(g),f.add(Bt(g.coord)),m.add(g.id)}for(const g of[...this.lastKnownCoords.keys()])m.has(g)||this.lastKnownCoords.delete(g);if(h.length===0){this.scheduler.reset();return}const p=this.scheduler.next(h);if(p.length!==0)for(const g of p){const b=Bt(g.coord);if(f.delete(b),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g);continue}const v=$E.selectTarget(g,a);if(!v&&r&&!r.destroyed&&this.tryAttackSauna(g,r)){const I=Bt(g.coord);f.add(I);continue}if(!v){let R=null;if(r&&!r.destroyed&&(R=r.pos),R||(R=this.findExplorationGoal(g,f)),R){const j=this.computeMovementPath(g,R,f,u);if(j.length>1&&g.stats.movementRange>0){const V=j[1],X=Bt(V);if(f.has(X))g.clearPathCache();else{if(!g.canStep()){f.add(b);continue}if(g.consumeMovementCooldown()){const $={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(V,{snapRender:!1}),this.animator.enqueue(g,[$,V])):g.setCoord(V),g.advancePathCache(1);const ee=Bt(g.coord);ee===Bt(R)&&g.clearPathCache(),f.add(ee),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});continue}}}else g.clearPathCache()}else g.clearPathCache();const I=Bt(g.coord);f.add(I),r&&!r.destroyed&&this.tryAttackSauna(g,r);continue}if(v.isDead()){g.clearPathCache(),f.add(b);continue}const M=Bt(v.coord),x=this.pathCache.getPath(g,v.coord,this.map,f,{now:u,targetId:v.id});if(x.length>1&&g.stats.movementRange>0){const R=x[1],I=Bt(R),j=I===M;if(!f.has(I)||j){if(g.canStep()&&g.consumeMovementCooldown()){const V={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(R,{snapRender:!1}),this.animator.enqueue(g,[V,R])):g.setCoord(R),g.advancePathCache(1)}}else g.clearPathCache()}const T=Bt(g.coord);f.add(T),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});const _=Bt(v.coord);_!==M&&g.clearPathCache(),g.distanceTo(v.coord)<=g.stats.attackRange&&!v.isDead()&&((g.attack(v)?.lethal??!1)||v.isDead())&&(f.delete(_),g.clearPathCache(),this.pathCache.invalidateForUnit(v.id),this.animator?.clear(v))}}tryAttackSauna(a,s){if(a.faction==="player")return!1;const r=a.stats.attackRange;if(r<=0||a.distanceTo(s.pos)>r)return!1;const l=ax(s,a.stats.attackDamage);if(l.amount<=0)return!1;const u={attackerId:a.id,attackerFaction:a.faction,amount:l.amount,remainingHealth:l.remainingHealth};if(re.emit("saunaDamaged",u),l.destroyed){const f={attackerId:a.id,attackerFaction:a.faction};re.emit("saunaDestroyed",f)}return!0}computeMovementPath(a,s,r,l){const u=this.pathCache.getPath(a,s,this.map,r,{now:l});if(u.length<2)return[];let f=0;const h=Bt(s);for(let p=1;p<u.length;p++){const g=Bt(u[p]);if(r.has(g)){g!==h&&a.clearPathCache();break}f=p}if(f===0)return[];const m=Math.min(a.stats.movementRange,f);return u.slice(0,m+1)}}function mu(t){if(!Number.isFinite(t??NaN))return 1;const a=Math.floor(t);return Math.max(1,a)}function rx(t){return Math.max(0,mu(t)-1)}function ox(t,a="linear"){const s=rx(t);switch(a){case"accelerating":return s*(s+1)/2;case"diminishing":return s===0?0:Math.log2(s+1);case"linear":default:return s}}function lx(t,a="round"){switch(a){case"floor":return Math.floor(t);case"ceil":return Math.ceil(t);case"none":return t;case"round":default:return Math.round(t)}}function cx(t,a,s){let r=t;return Number.isFinite(a)&&(r=Math.max(r,a)),Number.isFinite(s)&&(r=Math.min(r,s)),r}function uo(t,a){const s=mu(a),r=t.curve??"linear",l=ox(s,r),u=t.base+t.growth*l,f=cx(u,t.min,t.max);return lx(f,t.round??"round")}function qo(t,a){const s=mu(a),r=t.stats,l={health:uo(r.health,s),attackDamage:uo(r.attackDamage,s),attackRange:uo(r.attackRange,s),movementRange:uo(r.movementRange,s)};return r.visionRange&&(l.visionRange=uo(r.visionRange,s)),l}function jy(t){if(typeof t=="number"&&Number.isFinite(t))return t}function Fc(t,a){let s=t.health,r=t.attackDamage,l=t.attackRange,u=t.movementRange,f=jy(t.defense),h=jy(t.shield);for(const p of a){const g=Math.max(1,Math.round(p.quantity)),b=p.modifiers;typeof b.health=="number"&&(s+=b.health*g),typeof b.attackDamage=="number"&&(r+=b.attackDamage*g),typeof b.attackRange=="number"&&(l+=b.attackRange*g),typeof b.movementRange=="number"&&(u+=b.movementRange*g),typeof b.defense=="number"&&(f=(f??0)+b.defense*g),typeof b.shield=="number"&&(h=(h??0)+b.shield*g)}const m={health:Math.max(1,Math.round(s)),attackDamage:Math.max(0,Math.round(r)),attackRange:Math.max(0,Math.round(l)),movementRange:Math.max(0,Math.round(u))};return f!==void 0&&(m.defense=Math.max(0,Math.round(f))),h!==void 0&&(m.shield=Math.max(0,Math.round(h))),typeof t.visionRange=="number"&&Number.isFinite(t.visionRange)&&(m.visionRange=Math.max(0,Math.round(t.visionRange))),m}const fm=Object.freeze({id:"soldier",displayName:"Sauna Soldier",cost:50,tags:["infantry","melee"],stats:{health:{base:20,growth:6,curve:"linear",round:"round"},attackDamage:{base:5,growth:1,curve:"linear",round:"round"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:0,round:"round"}}}),hm=Object.freeze({id:"archer",displayName:"Sauna Archer",cost:75,tags:["ranged"],stats:{health:{base:15,growth:4,curve:"linear",round:"round"},attackDamage:{base:3,growth:.4,curve:"accelerating",round:"ceil"},attackRange:{base:3,growth:.5,curve:"diminishing",round:"ceil",max:5},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:.25,curve:"linear",round:"round",max:5}}}),x2=Object.freeze({id:"avanto-marauder",displayName:"Avanto Marauder",cost:0,tags:["enemy","melee"],stats:{health:{base:12,growth:5,curve:"linear",round:"round"},attackDamage:{base:4,growth:.6,curve:"accelerating",round:"ceil"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:.25,curve:"linear",round:"round",max:2},visionRange:{base:3,growth:0,round:"round"}}}),A2=Object.freeze({soldier:fm,archer:hm,"avanto-marauder":x2});function mm(t){return A2[t]??null}Object.freeze(Object.keys(A2));const Gy=fm.cost;Object.freeze(qo(fm,1));hm.cost;Object.freeze(qo(hm,1));Object.freeze(qo(x2,1));function w2(t,a,s,r,l){const u=mu(l?.level),f=qo(t,u);return new VE(a,t.id,s,r,f,t.priorityFactions)}function C2(t,a,s,r,l){const u=mm(t);return u?w2(u,a,s,r,l):null}function pm(t,a,s,r,l,u){const f=mm(a);if(!f)return null;const h=f.cost;if(!t.canAfford(h,oe.SAUNA_BEER))return na("error"),null;t.addResource(oe.SAUNA_BEER,-h);const m=w2(f,s,r,l,u);return na("spawn"),re.emit("unitSpawned",{unit:m}),m}const ux=Object.freeze(Object.defineProperty({__proto__:null,createUnit:C2,spawnUnit:pm},Symbol.toStringTag,{value:"Module"})),dx=["Aino","Eero","Ilona","Kalevi","Lumi","Mika","Noora","Oskari","Saana","Tapio","Veera","Yrjö"],fx=["Emberguard","Frostwalker","Steamcaller","Dawnwatch","Gritforged","Stormchant","Snowborn","Torchbearer","Chillwarden","Sisuheart"],hx=["Aalto","Halla","Karhu","Korhonen","Laine","Metsä","Niemi","Salmi","Tuomi","Virta"];function zf(t,a){if(t.length===0)throw new Error("Cannot select a name from an empty collection.");const s=Math.floor(a()*t.length);return t[Math.min(s,t.length-1)]}function mx(t=Math.random){const a=zf(dx,t),s=zf(fx,t),r=zf(hx,t);return`${a} "${s}" ${r}`}const or=Object.freeze(["supply","weapon","focus","relic"]);function T2(){return{supply:null,weapon:null,focus:null,relic:null}}const px=Object.freeze({supply:Object.freeze({id:"supply",label:"Supply Satchel",description:"Consumables and restorative provisions carried into battle.",maxStacks:5}),weapon:Object.freeze({id:"weapon",label:"Primary Armament",description:"The attendant's main weapon or ranged kit.",maxStacks:1}),focus:Object.freeze({id:"focus",label:"Battle Focus",description:"Tools that sharpen aim, steps, or battlefield intuition.",maxStacks:1}),relic:Object.freeze({id:"relic",label:"Sauna Relic",description:"Charms and relics that empower the attendant's resolve.",maxStacks:1})}),gx=Object.freeze({"birch-sap-satchel":Object.freeze({id:"birch-sap-satchel",slot:"supply",modifiers:{health:3},maxStacks:3}),"steamed-bandages":Object.freeze({id:"steamed-bandages",slot:"supply",modifiers:{shield:4},maxStacks:2}),"aurora-distillate":Object.freeze({id:"aurora-distillate",slot:"supply",modifiers:{attackDamage:2,defense:1},maxStacks:1}),"stolen-sauna-tokens":Object.freeze({id:"stolen-sauna-tokens",slot:"supply",modifiers:{movementRange:.5},maxStacks:5}),"midnight-bloodwine":Object.freeze({id:"midnight-bloodwine",slot:"supply",modifiers:{health:6,attackDamage:1},maxStacks:1}),"sauna-incense":Object.freeze({id:"sauna-incense",slot:"supply",modifiers:{attackRange:1},maxStacks:2}),"glacier-brand":Object.freeze({id:"glacier-brand",slot:"weapon",modifiers:{attackDamage:3},maxStacks:1}),"emberglass-arrow":Object.freeze({id:"emberglass-arrow",slot:"weapon",modifiers:{attackDamage:1,attackRange:2},maxStacks:1}),"aurora-lattice":Object.freeze({id:"aurora-lattice",slot:"focus",modifiers:{attackDamage:2,attackRange:1},maxStacks:1}),"emberglass-shard":Object.freeze({id:"emberglass-shard",slot:"focus",modifiers:{attackDamage:1,movementRange:1},maxStacks:1}),"windstep-totem":Object.freeze({id:"windstep-totem",slot:"focus",modifiers:{movementRange:1,defense:1},maxStacks:1}),"searing-chant-censer":Object.freeze({id:"searing-chant-censer",slot:"focus",modifiers:{attackDamage:2,shield:2},maxStacks:1}),"cracked-ice-amulet":Object.freeze({id:"cracked-ice-amulet",slot:"relic",modifiers:{defense:2},maxStacks:1}),"myrsky-charm":Object.freeze({id:"myrsky-charm",slot:"relic",modifiers:{attackRange:1,defense:1},maxStacks:1}),"frostwyrm-signet":Object.freeze({id:"frostwyrm-signet",slot:"relic",modifiers:{shield:5},maxStacks:1}),"spirit-oak-charm":Object.freeze({id:"spirit-oak-charm",slot:"relic",modifiers:{defense:1,health:2},maxStacks:1})});function Ho(t){const a=px[t];if(!a)throw new Error(`Unknown equipment slot: ${t}`);return a}function jo(t){return gx[t]}function _2(t){return Number.isFinite(t)?Math.max(1,Math.round(t)):1}function N2(t,a){return{id:t.id,name:t.name,description:t.description,icon:t.icon,rarity:t.rarity,quantity:a}}function R2(t,a,s,r){const l=Ho(a),u=Math.max(1,Math.floor(s.maxStacks??l.maxStacks)),f=Math.min(u,r),h=s.modifiers??{};return{...N2(t,f),slot:a,maxStacks:u,modifiers:h}}function Ah(t){t.equipment||(t.equipment=T2());for(const a of or)t.equipment[a]??=null;return t.equipment}function In(t){const a=[];for(const s of or){const r=t[s];r&&a.push({...r})}return a}function gm(t){return In(t).map(a=>N2(a,a.quantity))}function Bf(t){const a=T2();for(const s of t){const r=jo(s.id);if(!r)continue;const l=_2(s.quantity),u=a[r.slot];if(u&&u.id!==s.id)continue;const f=(u?.quantity??0)+l,h=R2(s,r.slot,r,f);a[r.slot]=h}return a}function yx(t,a){const s=jo(a.id);if(!s)return{success:!1,slot:"supply",loadout:In(Ah(t)),item:null,reason:"unknown-item"};const r=Ah(t),l=s.slot,u=Ho(l),f=_2(a.quantity),h=Math.max(1,Math.floor(s.maxStacks??u.maxStacks)),m=r[l];if(m&&m.id!==a.id)return{success:!1,slot:l,loadout:In(r),item:m,reason:"slot-occupied"};const p=Math.min(h,(m?.quantity??0)+f);if((m?.quantity??0)+f>h)return{success:!1,slot:l,loadout:In(r),item:m,reason:"stack-limit"};const g=R2(a,l,s,p);return r[l]=g,t.items=gm(r),{success:!0,slot:l,loadout:In(r),item:g}}function bx(t,a){const s=Ah(t),r=s[a];return r?(s[a]=null,t.items=gm(s),{success:!0,slot:a,loadout:In(s),removed:r}):{success:!1,slot:a,loadout:In(s),removed:null,reason:"empty-slot"}}function vx(t,a){return jo(t)?.slot===a}const Sx={q:0,r:0},Mx="Saunoja",wh=18,Yy=0,Do=1,Ch=4,Vc=1,hc={health:wh,attackDamage:4,attackRange:1,movementRange:1,defense:0,shield:0};function mc(t,a,s){return Math.min(Math.max(t,a),s)}function pc(t,a,s){const r=typeof t=="number"&&Number.isFinite(t)?t:a;return Math.max(s,r)}function qf(t,a,s=0){if(typeof t=="number"&&Number.isFinite(t))return Math.max(s,t);if(typeof a=="number"&&Number.isFinite(a))return Math.max(s,a)}function Fy(t,a){if(!t||typeof t!="object")return{...a};const s=t,r=pc(s.health,a.health,1),l=pc(s.attackDamage,a.attackDamage,0),u=pc(s.attackRange,a.attackRange,0),f=pc(s.movementRange,a.movementRange,0),h=qf(s.defense,a.defense,0),m=qf(s.shield,a.shield,0),p=qf(s.visionRange,a.visionRange,0);return{health:r,attackDamage:l,attackRange:u,movementRange:f,defense:h,shield:m,visionRange:p}}function Ex(t,a){if(!t||typeof t!="object")return Bf(a);const s=t,r=[];for(const l of Object.values(s)){const u=k2(l);u&&r.push(u)}return r.length===0?Bf(a):Bf(r)}function k2(t){if(!t||typeof t!="object")return null;const a=t,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const l=typeof a.description=="string"?a.description.trim():void 0,u=typeof a.icon=="string"?a.icon.trim():void 0,f=typeof a.rarity=="string"?a.rarity.trim():void 0,h=typeof a.quantity=="number"?a.quantity:Number(a.quantity),m=Number.isFinite(h)?Math.max(1,Math.round(h)):1;return{id:s,name:r,description:l,icon:u,rarity:f,quantity:m}}function xx(t){if(!t||t.length===0)return[];const a=[];for(const s of t){const r=k2(s);r&&a.push(r)}return a}function Ax(t){if(!t||typeof t!="object")return null;const a=t,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const l=a.duration;let u=1/0;typeof l=="number"&&Number.isFinite(l)?u=Math.max(0,l):l!==1/0&&(u=1/0);const f=a.remaining;let h=u;typeof f=="number"&&Number.isFinite(f)?h=Math.max(0,f):f===1/0&&(h=1/0),u!==1/0&&h===1/0&&(h=u);const m=a.appliedAt,p=typeof m=="number"&&Number.isFinite(m)?Math.max(0,m):void 0,g=a.stacks,b=typeof g=="number"&&Number.isFinite(g)?Math.max(1,Math.round(g)):void 0,v=typeof a.description=="string"?a.description.trim():void 0,M=typeof a.source=="string"?a.source.trim():void 0;return{id:s,name:r,description:v,duration:u,remaining:h,appliedAt:p,stacks:b,source:M}}function wx(t){if(!t||t.length===0)return[];const a=[];for(const s of t){const r=Ax(s);r&&a.push(r)}return a}function Cx(t){if(typeof t=="string"){const a=t.trim();if(a.length>0)return a}try{return mx()}catch(a){return console.warn("Falling back to default Saunoja name",a),Mx}}function ym(t){const{id:a,name:s,coord:r=Sx,maxHp:l=wh,hp:u=l,steam:f=0,defense:h,shield:m=0,traits:p=[],upkeep:g=Vc,xp:b=0,lastHitAt:v=Yy,selected:M=!1,items:x,modifiers:T,combatKeywords:_=null,combatHooks:R=null}=t,I=Number.isFinite(l)?Math.max(1,l):wh,j=Number.isFinite(u)?u:I,V=mc(j,0,I),X=Number.isFinite(f)?f:0,$=mc(X,0,1),te=(Array.isArray(p)?p:[]).filter(dn=>typeof dn=="string").map(dn=>dn.trim()).filter(dn=>dn.length>0),Y=Number.isFinite(g)?g:Vc,B=mc(Y,Do,Ch),C=Number.isFinite(b)?b:0,J=Math.max(0,C),q=Number.isFinite(v)?v:Yy,ae=Math.max(0,q),F=Number.isFinite(m)?m:0,D=Math.max(0,F),P=Number.isFinite(h)?h:void 0,le=P!==void 0?Math.max(0,P):void 0,ne=xx(x),E=wx(T),A=Ex(t.equipment,ne),z=gm(A),Q={...hc,health:I,defense:le??hc.defense,shield:hc.shield},se=Fy(t.baseStats,Q),de={...se,health:I,defense:le??se.defense,shield:D},ue=Fy(t.effectiveStats,de),ge=Math.max(1,ue.health),Se=mc(V,0,ge),rt=typeof ue.defense=="number"?Math.max(0,ue.defense):le??void 0,_t=typeof ue.shield=="number"?Math.max(0,ue.shield):D,Ft={...se,health:Math.max(1,se.health),defense:typeof se.defense=="number"?Math.max(0,se.defense):le??void 0,shield:typeof se.shield=="number"?Math.max(0,se.shield):hc.shield},On={...ue,health:ge,defense:rt,shield:_t},zn=Cx(s);return{id:a,name:zn,coord:{q:r.q,r:r.r},maxHp:ge,hp:Se,defense:rt,shield:_t,steam:$,traits:[...te],upkeep:B,xp:J,lastHitAt:ae,selected:M,items:z,baseStats:Ft,effectiveStats:On,equipment:A,modifiers:E,combatKeywords:_,combatHooks:R}}const lr=32;function wo(t,a,s,r){t.beginPath();for(let l=0;l<6;l++){const u=Math.PI/3*l,f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?t.moveTo(f,h):t.lineTo(f,h)}t.closePath()}function bm(t,a,s){return Math.min(Math.max(t,a),s)}function Tx(t,{centerX:a,centerY:s,hp:r,maxHp:l,radius:u=lr*.55}){const f=Number.isFinite(l)?Math.max(1,l):1,h=Number.isFinite(r)?r:f,m=bm(h/f,0,1);if(t.save(),wo(t,a,s,u),t.fillStyle="rgba(7, 11, 18, 0.72)",t.fill(),t.restore(),m>0){t.save(),wo(t,a,s,u),t.clip();const p=t.createLinearGradient(a,s+u,a,s-u);p.addColorStop(0,"rgba(46, 160, 98, 0.35)"),p.addColorStop(1,"rgba(218, 255, 239, 0.95)"),t.fillStyle=p;const g=u*2*m,b=s+u-g;t.fillRect(a-u,b,u*2,g),t.restore()}t.save(),wo(t,a,s,u),t.lineWidth=Math.max(1,u*.12),t.strokeStyle="rgba(255, 255, 255, 0.28)",t.stroke(),t.restore()}function _x(t,{centerX:a,centerY:s,radius:r=lr,progress:l=0}){const u=bm(l,0,1);if(u<=0)return;const f=Number.isFinite(r)&&r>0?r:lr;t.save(),t.globalCompositeOperation="lighter",t.globalAlpha=u;const h=t.createRadialGradient(a,s,Math.max(1,f*.1),a,s,f);h.addColorStop(0,"rgba(255, 255, 255, 0.92)"),h.addColorStop(.45,"rgba(255, 255, 255, 0.68)"),h.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=h,t.beginPath(),t.arc(a,s,f,0,Math.PI*2),t.fill(),t.restore()}function Nx(t,{centerX:a,centerY:s,radius:r=lr*.85,intensity:l=1}){const u=bm(l,0,1);if(u<=0)return;t.save(),wo(t,a,s,r),t.clip();const f=t.createLinearGradient(a,s+r,a,s-r);f.addColorStop(0,"rgba(255, 255, 255, 0)"),f.addColorStop(.55,`rgba(255, 255, 255, ${.12*u})`),f.addColorStop(1,`rgba(255, 255, 255, ${.35*u})`),t.globalCompositeOperation="lighter",t.fillStyle=f,t.fillRect(a-r,s-r,r*2,r*2),t.restore(),t.save(),t.globalCompositeOperation="lighter",t.lineCap="round",t.strokeStyle=`rgba(255, 255, 255, ${.25*u})`,t.lineWidth=Math.max(1,r*.08);const h=r*.75,m=r*.35;for(let p=0;p<3;p++){const g=s-r*.5+p*m;t.beginPath(),t.moveTo(a-h,g),t.bezierCurveTo(a-h*.4,g-r*.4,a+h*.4,g+r*.2,a+h,g-r*.45),t.stroke()}t.restore()}function Th(t,a,s){return t<a?a:t>s?s:t}const Hf=Object.freeze([{id:"skirmish",label:"Skirmish Patrols",minRunSeconds:0,minClears:0,cadence:26,multiplier:1,bundleTier:0},{id:"raids",label:"Raid Pressure",minRunSeconds:90,minClears:2,cadence:19,multiplier:1.35,bundleTier:1},{id:"siege",label:"Siege Lines",minRunSeconds:210,minClears:5,cadence:13,multiplier:1.8,bundleTier:2},{id:"onslaught",label:"Winter Onslaught",minRunSeconds:360,minClears:9,cadence:8.5,multiplier:2.45,bundleTier:3},{id:"maelstrom",label:"Glacier Maelstrom",minRunSeconds:540,minClears:14,cadence:6.2,multiplier:3.25,bundleTier:4}]);function Rx(t){return t>=1?1/(1+(t-1)*.45):1+(1-t)*.35}function kx(t){if(t>=1)return 1+(t-1)*.85;const a=1-t;return Th(1-a*.4,.45,1)}function Lx(t){return{runSeconds:Math.max(0,Number.isFinite(t.runSeconds)?t.runSeconds:0),clears:Math.max(0,Number.isFinite(t.clears)?t.clears:0),spawnCycles:Math.max(0,Number.isFinite(t.spawnCycles)?t.spawnCycles:0)}}function Vy(t,a){const s=Lx(a);let r=0;for(let p=0;p<Hf.length;p+=1){const g=Hf[p];if(s.runSeconds<g.minRunSeconds||s.clears<g.minClears)break;r=p}const l=Hf[r],u=Rx(t),f=kx(t),h=Math.max(.75,l.cadence*u),m=l.multiplier*f;return{stage:l,stageIndex:r,cadenceTarget:h,multiplierBase:m}}function $y(t){if(t>=1){const s=Math.min(3,t-1);return Th(.93-s*.035,.82,.93)}const a=Math.min(1,1-t);return Th(.93+a*.03,.9,.97)}function Xy(t){if(t>=1)return .024+Math.min(3,t-1)*.012;const a=Math.min(1,1-t);return Math.max(.012,.024-a*.01)}const L2="deepwood",D2="Deepwood Wardens",I2="Reclusive guardians attuned to sauna spirits.",U2=[{id:"warding-circle",label:"Warding Circle",weight:2,units:[{unit:"soldier",level:1,quantity:2},{unit:"archer",level:1,quantity:1}],items:["spirit-oak-charm","sauna-incense"],modifiers:["barkskin-ritual"]},{id:"spirit-strike",label:"Spirit Strike",weight:1,units:[{unit:"archer",level:2,quantity:2}],items:["emberglass-arrow"],modifiers:["searing-chant","windstep"]}],Dx={id:L2,name:D2,description:I2,bundles:U2},Ix=Object.freeze(Object.defineProperty({__proto__:null,bundles:U2,default:Dx,description:I2,id:L2,name:D2},Symbol.toStringTag,{value:"Module"})),O2="enemy",z2="Avanto Marauders",B2="Frostbitten raiders who harry the sauna frontier.",q2=[{id:"iceblade-scouts",label:"Iceblade Scouts",weight:3,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:1}],items:["cracked-ice-amulet"],modifiers:["frost-resilience"]},{id:"raiding-party",label:"Raiding Party",weight:2,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:2}],items:["stolen-sauna-tokens"],modifiers:["berserker-drift"]},{id:"frost-champion",label:"Frost Champion",weight:1,minRampTier:0,units:[{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand"],modifiers:["glacial-ward"]},{id:"icebreaker-vanguard",label:"Icebreaker Vanguard",weight:2.5,minRampTier:1,units:[{unit:"avanto-marauder",level:2,quantity:2},{unit:"avanto-marauder",level:1,quantity:1}],items:["stormglass-pendant"],modifiers:["frost-resilience","berserker-drift"]},{id:"glacial-phalanx",label:"Glacial Phalanx",weight:2,minRampTier:2,units:[{unit:"avanto-marauder",level:3,quantity:3},{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand","frostshard-relic"],modifiers:["glacial-ward","polar-endurance"]},{id:"avalanche-warhost",label:"Avalanche Warhost",weight:1.25,minRampTier:3,units:[{unit:"avanto-marauder",level:4,quantity:3},{unit:"avanto-marauder",level:3,quantity:2}],items:["avalanche-totem"],modifiers:["glacial-ward","polar-endurance","berserker-drift"]}],Ux={id:O2,name:z2,description:B2,bundles:q2},Ox=Object.freeze(Object.defineProperty({__proto__:null,bundles:q2,default:Ux,description:B2,id:O2,name:z2},Symbol.toStringTag,{value:"Module"})),zx=Object.assign({"../content/factions/deepwood.json":Ix,"../content/factions/enemy.json":Ox}),$c=new Map;for(const[t,a]of Object.entries(zx)){const s=Bx(a),r=Gx(s,t);if($c.has(r.id))throw new Error(`Duplicate faction bundle id: ${r.id}`);$c.set(r.id,r)}function Bx(t){return typeof t=="object"&&t!==null&&"default"in t?t.default:t}function vm(t){return typeof t=="object"&&t!==null}function _h(t,a){if(typeof t!="string")throw new Error(`Expected string at ${a}`);const s=t.trim();if(!s)throw new Error(`Expected non-empty string at ${a}`);return s}function Nh(t){if(typeof t!="string")return;const a=t.trim();return a||void 0}function Qy(t,a){if(t===void 0)return Object.freeze([]);if(!Array.isArray(t))throw new Error(`Expected array at ${a}`);const s=t.map((r,l)=>{if(typeof r!="string")throw new Error(`Expected string at ${a}[${l}]`);const u=r.trim();if(!u)throw new Error(`Expected non-empty string at ${a}[${l}]`);return u});return Object.freeze(s)}function H2(t,a){const s=typeof t=="number"?t:Number(t);return!Number.isFinite(s)||s<=0?a:s}function Ky(t,a){const s=Math.floor(H2(t,a));return s>0?s:a}function qx(t,a){if(!vm(t))throw new Error(`Expected object at ${a}`);const s=_h(t.unit,`${a}.unit`),r=Ky(t.level,1),l=Ky(t.quantity,1);return Object.freeze({unit:s,level:r,quantity:l})}function Hx(t){if(t===void 0)return;const a=Number(t);if(!Number.isFinite(a))return;const s=Math.floor(a);return s>=0?s:void 0}function jx(t,a,s){if(!vm(t))throw new Error(`Expected object at ${a}`);const r=Nh(t.id)??`${s}-bundle`,l=Nh(t.label)??r,u=H2(t.weight,1),f=t.units;if(!Array.isArray(f)||f.length===0)throw new Error(`Expected non-empty units array at ${a}.units`);const h=f.map((b,v)=>qx(b,`${a}.units[${v}]`)),m=Qy(t.items,`${a}.items`),p=Qy(t.modifiers,`${a}.modifiers`),g=Hx(t.minRampTier);return Object.freeze({id:r,label:l,weight:u,units:Object.freeze(h),items:m,modifiers:p,minRampTier:g})}function Gx(t,a){if(!vm(t))throw new Error(`Expected object at ${a}`);const s=_h(t.id,`${a}.id`),r=_h(t.name,`${a}.name`),l=Nh(t.description);if(!Array.isArray(t.bundles)||t.bundles.length===0)throw new Error(`Expected non-empty bundles array at ${a}.bundles`);const u=t.bundles.map((f,h)=>jx(f,`${a}.bundles[${h}]`,`${s}-${h}`));return Object.freeze({id:s,name:r,description:l,bundles:Object.freeze(u)})}Object.freeze(Array.from($c.keys()));function Yx(t){return $c.get(t)??null}function Fx(t){return Yx(t)?.bundles??Object.freeze([])}function Vx(){return`e${Date.now()}-${Math.floor(Math.random()*1e6)}`}function $x(t){return{level:t}}function Xx(t,a,s){const r=Fx(t);if(r.length===0)throw new Error(`No bundles registered for faction: ${t}`);const l=Math.max(0,Math.floor(Number.isFinite(a)?a:0)),u=r.filter(b=>(typeof b.minRampTier=="number"?b.minRampTier:0)<=l),f=u.length>0?u:r,h=typeof s=="function"?s:Math.random,m=f.reduce((b,v)=>b+v.weight,0);if(!Number.isFinite(m)||m<=0)throw new Error(`Invalid bundle weights for faction: ${t}`);const p=h()*m;let g=0;for(const b of f)if(g+=b.weight,p<g)return b;return f[f.length-1]}function Qx(t){let a=Math.max(0,Math.floor(t.availableSlots));const s=[];if(a<=0)return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers};const r=t.makeId??Vx,l=typeof t.random=="function"?t.random:Math.random,u=Math.max(0,Math.min(.95,typeof t.eliteOdds=="number"?t.eliteOdds:0)),f=Math.max(1,Number.isFinite(t.difficultyMultiplier)?t.difficultyMultiplier:1),h=Math.max(0,Math.floor(Number.isFinite(t.rampTier)?t.rampTier:0)),m=1+h*.25,p=Math.floor(h/2);for(const g of t.bundle.units){const b=Math.max(1,Math.round(g.quantity*f*m)),v=Math.min(b,a),M=g.unit,x=Math.max(1,Math.round((g.level+p)*f));for(let T=0;T<v;T+=1){const _=l()<u?1:0,R=Math.max(1,x+_),I=$x(R),j=t.pickEdge();if(!j)return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers};const V=C2(M,r(),j,t.factionId,I);if(V&&(t.addUnit(V),s.push(V),a-=1,a<=0))return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers}}}return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers}}function gc(t,a,s,r=1){const l=Number(t);return Number.isFinite(l)?Math.max(a,Math.min(s,l)):r}const Py=6;class Kx{timer;interval;spawnCycles;factionId;random;makeId;difficulty;eliteOdds;cadenceDecay;multiplierGrowth;runSeconds=0;clearCount=0;boardEmpty=!0;lastClearAt=null;lastSpawnAt=null;lastCadence;lastMultiplier;rampEvaluation;rampStageIndex;currentDifficulty;cadenceScale=1;multiplierScale=1;pressureScale=1;calmUntil=null;calmSecondsRemaining=0;cadenceFloor=.3;constructor(a={}){this.factionId=a.factionId??"enemy",this.random=typeof a.random=="function"?a.random:Math.random;const s=Number.isFinite(a.difficulty)?Number(a.difficulty):1;this.difficulty=Math.max(.5,s);const r=typeof a.eliteOdds=="number"?a.eliteOdds:0;this.eliteOdds=Math.max(0,Math.min(.95,r)),this.currentDifficulty=this.difficulty,this.cadenceDecay=$y(this.currentDifficulty),this.multiplierGrowth=Xy(this.currentDifficulty),this.spawnCycles=0,this.rampEvaluation=Vy(this.currentDifficulty,{runSeconds:0,clears:0,spawnCycles:0}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.interval=this.rampEvaluation.cadenceTarget,this.timer=this.interval,this.lastCadence=this.interval,this.lastMultiplier=this.rampEvaluation.multiplierBase;const l=(()=>{let u=0;return()=>`e${Date.now()}-${u+=1}`})();this.makeId=typeof a.idFactory=="function"?a.idFactory:l}update(a,s,r,l,u={}){if(!Number.isFinite(a)||a<=0)return;this.runSeconds+=a,this.applyRuntimeModifiers(u),this.resolveRampState();const f=this.countActiveEnemies(s);if(this.trackClears(f),this.calmUntil!==null&&this.runSeconds<this.calmUntil){const m=this.calmUntil-this.runSeconds;this.calmSecondsRemaining=m,this.timer=Math.max(this.timer,m);return}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0),this.timer-=a;let h=0;for(;this.timer<=0&&h<Py;){const m=this.getAvailableSlots(s);if(m<=0){this.timer=Math.max(this.timer,.5);break}const p=this.resolveRampState(),g=Xx(this.factionId,p.stage.bundleTier,this.random),b=this.computeMultiplier(p);if(Qx({bundle:g,factionId:this.factionId,pickEdge:l,addUnit:r,makeId:this.makeId,availableSlots:m,eliteOdds:this.eliteOdds,random:this.random,difficultyMultiplier:b,rampTier:p.stage.bundleTier}).spawned.length===0){this.timer=Math.max(this.timer,.5);break}const M=this.runSeconds+this.timer;this.lastCadence=this.lastSpawnAt===null?this.interval:Math.max(.01,M-this.lastSpawnAt),this.lastSpawnAt=M,this.lastMultiplier=b,this.spawnCycles+=1,h+=1;const x=this.resolveRampState();this.interval=this.computeNextInterval(x),this.timer+=this.interval}h===Py&&this.timer<=0&&(this.timer=this.interval)}getSnapshot(){const a=this.rampEvaluation.stage;return{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles,rampStageIndex:this.rampStageIndex,rampStageId:a.id,rampStageLabel:a.label,bundleTier:a.bundleTier,cadence:this.interval,lastCadence:this.lastCadence,lastSpawnAt:this.lastSpawnAt,lastClearAt:this.lastClearAt,difficultyMultiplier:this.lastMultiplier,effectiveDifficulty:this.currentDifficulty,aggressionMultiplier:this.currentDifficulty/this.difficulty,cadenceMultiplier:this.cadenceScale,strengthMultiplier:this.multiplierScale,pressureMultiplier:this.pressureScale,calmSecondsRemaining:this.calmSecondsRemaining}}resolveRampState(){return this.rampEvaluation=Vy(this.currentDifficulty,{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.rampEvaluation}applyRuntimeModifiers(a){const s=gc(a.aggressionMultiplier,.25,6,1),r=gc(a.cadenceMultiplier,.1,10,1),l=gc(a.strengthMultiplier,.1,12,1),u=gc(a.pressureMultiplier,.1,10,1),f=Number.isFinite(a.cadenceFloor)?Math.max(.1,a.cadenceFloor):this.cadenceFloor,h=Math.max(.25,this.difficulty*s);if(h!==this.currentDifficulty&&(this.currentDifficulty=h,this.cadenceDecay=$y(this.currentDifficulty),this.multiplierGrowth=Xy(this.currentDifficulty),this.resolveRampState()),this.cadenceScale=r,this.multiplierScale=l,this.pressureScale=u,this.cadenceFloor=f,Object.prototype.hasOwnProperty.call(a,"calmSecondsRemaining")){const m=a.calmSecondsRemaining;m===null?this.calmUntil=null:typeof m=="number"&&Number.isFinite(m)&&m>0?this.calmUntil=this.runSeconds+m:typeof m=="number"&&m<=0&&(this.calmUntil=null)}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0)}computeNextInterval(a){const s=a.cadenceTarget*this.cadenceScale,r=Math.pow(this.spawnCycles+1,.6)*.018*this.pressureScale,l=1+Math.min(4,r),u=s/l,f=this.interval*this.cadenceDecay,h=Math.min(f,u);return Math.max(this.cadenceFloor,h)}computeMultiplier(a){const s=1+this.spawnCycles*this.multiplierGrowth*this.pressureScale,r=1+a.stageIndex*.15,l=a.multiplierBase*s*r*this.multiplierScale;return Math.min(16,Math.max(1,l))}countActiveEnemies(a){return a.filter(s=>s.faction===this.factionId&&!s.isDead()).length}getAvailableSlots(a){return ix-this.countActiveEnemies(a)}trackClears(a){if(a<=0){this.boardEmpty||(this.clearCount+=1,this.lastClearAt=this.runSeconds),this.boardEmpty=!0;return}this.boardEmpty=!1}}function Px(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(t){return console.warn("Structured telemetry storage unavailable",t),null}}function Zx(t,a){const s={event:t,timestamp:Date.now(),payload:{...a}};return console.info(t,s),s}function Jx(t,a,s={}){const r=Px();if(!r)return;const l=Number.isFinite(s.limit)?Math.max(1,Math.trunc(s.limit??16)):16,f=[...em(t)??[],a].slice(-l);try{r.setItem(t,JSON.stringify(f))}catch(h){console.warn("Failed to persist structured telemetry",{storageKey:t,error:h})}}let Zy=-1,Jy=-1,jf=null,Gf=0,Yf=0;const Wx="telemetry:enemy-scaling:summaries";function e3(t,a={}){const s=t.rampStageIndex!==Zy,r=t.spawnCycles>=Jy+10,l=t.lastClearAt!==null&&t.lastClearAt!==jf;if(!s&&!r&&!l)return;Zy=t.rampStageIndex,Jy=t.spawnCycles,jf=t.lastClearAt??jf,Gf=Math.max(Gf,t.difficultyMultiplier);const u=Math.max(0,Math.round(t.calmSecondsRemaining*1e3));u>Yf&&(Yf=u);const f={stage:t.rampStageLabel,stageIndex:t.rampStageIndex,bundleTier:t.bundleTier,cadenceSeconds:Number(t.cadence.toFixed(2)),lastCadenceSeconds:Number(t.lastCadence.toFixed(2)),multiplier:Number(t.difficultyMultiplier.toFixed(2)),effectiveDifficulty:Number(t.effectiveDifficulty.toFixed(2)),aggressionMultiplier:Number(t.aggressionMultiplier.toFixed(2)),cadenceMultiplier:Number(t.cadenceMultiplier.toFixed(2)),strengthMultiplier:Number(t.strengthMultiplier.toFixed(2)),pressureMultiplier:Number(t.pressureMultiplier.toFixed(2)),calmSecondsRemaining:Number(t.calmSecondsRemaining.toFixed(2)),runSeconds:Math.round(t.runSeconds),spawnCycles:t.spawnCycles,clears:t.clears,wipeSince:a.wipeSince??null,longestWipeMs:a.wipeDurationMs??0,peakMultiplier:Number(Gf.toFixed(2)),longestCalmMs:Yf},h=Zx("enemy-scaling",f);Jx(Wx,h,{limit:24})}const Rh=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),t3=Object.freeze({artocoinBalance:0,ownedTierIds:Object.freeze(new Set)}),n3={default:"Included with the sauna key",artocoin:"Invest artocoins"},Sm=Object.freeze([{id:"ember-circuit",name:"Primitive Smoke Sauna",rosterCap:3,description:"Smoke-cured log benches define the Primitive Smoke Sauna with a loyal trio of attendants.",art:{badge:c2,glow:"linear-gradient(145deg, rgba(255,161,76,0.65), rgba(255,226,173,0.18))"},visionRange:4,unlock:{type:"default",label:"Included with the Primitive Smoke Sauna key"}},{id:"aurora-ward",name:"Modern Wooden Sauna",rosterCap:4,description:"Polished timber benches power the Modern Wooden Sauna with a quartet ready to repel sieges.",art:{badge:o2,glow:"linear-gradient(140deg, rgba(128,208,255,0.7), rgba(61,184,255,0.2))"},visionRange:10,unlock:{type:"artocoin",cost:150,label:"Commission the Modern Wooden Sauna for 150 artocoins"}},{id:"mythic-conclave",name:"Futuristic Fission Sauna",rosterCap:6,description:"Radiant coils encircle the Futuristic Fission Sauna where six legends guard the löyly.",art:{badge:l2,glow:"linear-gradient(135deg, rgba(176,106,255,0.72), rgba(245,199,255,0.2))"},visionRange:20,unlock:{type:"artocoin",cost:275,label:"Fund the Futuristic Fission Sauna for 275 artocoins"}}]),ur=Sm[0].id,Ff=new Map(Sm.map(t=>[t.id,t]));function Mm(){return Sm}function xn(t){return t&&Ff.has(t)?Ff.get(t):Ff.get(ur)}function a3(t,a,s){if(!Number.isFinite(t))return a;const r=Math.max(a,Math.min(s,t));return Number.isNaN(r)?a:r}function Wy(t){if(t.label)return t.label;const a=n3[t.type];if(!a)return"";if(t.type==="artocoin"){const s=Math.max(0,Math.floor(Number.isFinite(t.cost)?t.cost:0));if(s>0)return`${a} ${Rh.format(s)}`}return a}function ns(t,a){const s=a??t3,r=s.ownedTierIds,l=r instanceof Set?r:new Set(Array.isArray(r)?r:[]);if(t.unlock.type==="default")return{tier:t,unlocked:!0,owned:!0,affordable:!0,cost:null,progress:1,requirementLabel:Wy(t.unlock)};if(t.unlock.type==="artocoin"){const u=Math.max(0,Math.floor(Number.isFinite(t.unlock.cost)?t.unlock.cost:0)),f=Math.max(0,Math.floor(Number.isFinite(s.artocoinBalance)?s.artocoinBalance:0)),h=l.has(t.id),m=f>=u,p=h,g=h||u===0?1:a3(f/u,0,1),b=Math.max(0,u-f),v=Rh.format(u),M=b>0?Rh.format(b):null;let x;if(h)x=`Roster cap ${t.rosterCap}`;else{const T=t.unlock.label??`Invest ${v} artocoins`;M?x=`${T} — Need ${M} more`:u>0?x=`${T} — Ready to unlock`:x=T}return{tier:t,unlocked:p,owned:h,affordable:m,cost:u,progress:g,requirementLabel:x}}return{tier:t,unlocked:!1,owned:!1,affordable:!1,cost:null,progress:0,requirementLabel:Wy(t.unlock)}}const eb=["hud-grid","grid","grid-rows-[64px_1fr_80px]","grid-cols-[280px_1fr_clamp(260px,32vw,420px)]","gap-[clamp(16px,3vw,28px)]"],tb={top:["col-span-3","row-span-1","row-start-1"],left:["col-start-1","row-start-2","row-span-1"],content:["col-start-2","row-start-2","row-span-1"],right:["col-start-3","row-start-2","row-span-1"],bottom:["col-span-3","row-start-3","row-span-1"]};function i3(t,a){let s=t.querySelector("[data-hud-root]");return s||(s=a.createElement("div"),s.dataset.hudRoot="true",s.className="hud-layout-root",t.prepend(s)),s}function fo(t,a,s,r){let l=t.querySelector(`[data-hud-region="${s}"]`);return l||(l=a.createElement("div"),l.dataset.hudRegion=s,t.appendChild(l)),l.classList.add("hud-region",...r),l.parentElement!==t&&t.appendChild(l),l}function s3(t,a,s){if(s){t.classList.add(...eb);for(const[r,l]of Object.entries(tb))a[r].classList.add(...l)}else{t.classList.remove(...eb);for(const[r,l]of Object.entries(tb))a[r].classList.remove(...l)}}function dr(t){const a=t.ownerDocument??document,s=i3(t,a),r={top:fo(s,a,"top",["hud-top-row"]),left:fo(s,a,"left",["hud-actions"]),content:fo(s,a,"content",["hud-content"]),right:fo(s,a,"right",["hud-right-column"]),bottom:fo(s,a,"bottom",["hud-bottom-row"])};s.append(r.top,r.left,r.content,r.right,r.bottom);const l=t.dataset.hudVariant==="v2";if(s3(t,r,l),!l){const p=t.querySelector("#resource-bar");p&&p.parentElement!==r.right&&r.right.prepend(p)}const u=t.querySelector("#build-menu");u&&u.parentElement!==r.left&&r.left.appendChild(u);const f=t.querySelector("#build-id");f&&f.parentElement!==r.bottom&&r.bottom.appendChild(f);let h=t.querySelector(".hud-mobile-bar__tray"),m=h?.closest(".hud-mobile-bar")??null;return(!h||!m)&&(m=a.createElement("div"),m.className="hud-mobile-bar",h=a.createElement("div"),h.className="hud-mobile-bar__tray",m.appendChild(h)),m.parentElement!==r.bottom&&r.bottom.appendChild(m),{root:s,regions:r,actions:r.left,side:r.right,mobileBar:h}}const nb=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function r3(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const r=document.createElement("div");r.classList.add("sauna-control"),r.dataset.tutorialTarget="heat";const l=()=>{const fe=a.getActiveTierId?.();return xn(fe??ur).id},u=()=>a.getTierContext?.()??null,f=document.createElement("button");f.type="button",f.textContent="Sauna ♨️",f.classList.add("topbar-button","sauna-toggle"),f.setAttribute("aria-expanded","false"),r.appendChild(f);const h=document.createElement("div");h.classList.add("sauna-card","hud-card"),h.hidden=!0;const m=document.createElement("section");m.classList.add("sauna-health"),m.dataset.tutorialTarget="sauna-integrity";const p=`sauna-health-label-${Math.floor(Math.random()*1e5)}`,g=document.createElement("div");g.classList.add("sauna-health__header");const b=document.createElement("span");b.id=p,b.classList.add("sauna-health__title"),b.textContent="Sauna Integrity",g.appendChild(b);const v=document.createElement("span");v.classList.add("sauna-health__value"),v.setAttribute("aria-live","polite"),g.appendChild(v),m.appendChild(g);const M=document.createElement("div");M.classList.add("sauna-health__bar"),M.setAttribute("role","meter"),M.setAttribute("aria-valuemin","0"),M.setAttribute("aria-labelledby",p);const x=document.createElement("div");x.classList.add("sauna-health__fill"),M.appendChild(x),m.appendChild(M);const T=document.createElement("div");T.classList.add("sauna-health__destruction"),T.hidden=!0,M.appendChild(T);const _=document.createElement("div");_.classList.add("sauna-progress");const R=document.createElement("div");R.classList.add("sauna-progress__fill"),_.appendChild(R),h.appendChild(m),h.appendChild(_);const I=Mm(),j=new Map,V=document.createElement("section");V.classList.add("sauna-tier");const X=document.createElement("div");X.classList.add("sauna-tier__header");const $=document.createElement("span");$.classList.add("sauna-tier__title"),$.textContent="Premium Tiers",X.appendChild($);const ee=document.createElement("p");ee.classList.add("sauna-tier__subtitle"),ee.textContent="Align the löyly with your prestige to unlock lavish benches and roster headroom.",X.appendChild(ee),V.appendChild(X);const te=document.createElement("div");te.classList.add("sauna-tier__grid"),V.appendChild(te);for(const fe of I){const _e=document.createElement("button");_e.type="button",_e.classList.add("sauna-tier__option"),_e.dataset.tierId=fe.id,_e.setAttribute("aria-pressed","false");const Ge=document.createElement("div");Ge.classList.add("sauna-tier__badge"),Ge.style.setProperty("--sauna-tier-badge-image",`url(${fe.art.badge})`),fe.art.glow&&Ge.style.setProperty("--sauna-tier-glow",fe.art.glow),_e.appendChild(Ge);const ze=document.createElement("div");ze.classList.add("sauna-tier__copy"),_e.appendChild(ze);const vt=document.createElement("span");vt.classList.add("sauna-tier__name"),vt.textContent=fe.name,ze.appendChild(vt);const fn=document.createElement("span");fn.classList.add("sauna-tier__cap"),fn.textContent=`Cap ${fe.rosterCap}`,ze.appendChild(fn);const Zt=document.createElement("p");Zt.classList.add("sauna-tier__description"),Zt.textContent=fe.description,ze.appendChild(Zt);const An=document.createElement("div");An.classList.add("sauna-tier__progress");const oa=document.createElement("div");oa.classList.add("sauna-tier__progress-fill"),An.appendChild(oa);const Qe=document.createElement("span");Qe.classList.add("sauna-tier__progress-label"),An.appendChild(Qe),ze.appendChild(An);const Pe=document.createElement("span");Pe.classList.add("sauna-tier__requirement"),ze.appendChild(Pe);const Vt={tier:fe,button:_e,fill:oa,progressLabel:Qe,requirement:Pe,handleClick:()=>{E(fe,Vt)}};_e.addEventListener("click",Vt.handleClick),j.set(fe.id,Vt),te.appendChild(_e)}h.appendChild(V),ne();const Y=document.createElement("label");Y.classList.add("sauna-option");const B=document.createElement("input");B.type="checkbox",B.classList.add("sauna-option__input"),B.checked=t.rallyToFront,B.addEventListener("change",()=>{t.rallyToFront=B.checked}),Y.appendChild(B);const C=document.createElement("span");C.textContent="Rally to Front",C.classList.add("sauna-option__label"),Y.appendChild(C),h.appendChild(Y),r.appendChild(h);const{regions:J}=dr(s),q=J.top,ae=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null;let F=!!ae?.matches;const D=(fe,_e)=>{typeof fe.addEventListener=="function"?fe.addEventListener("change",_e):typeof fe.addListener=="function"&&fe.addListener(_e)},P=(fe,_e)=>{typeof fe.removeEventListener=="function"?fe.removeEventListener("change",_e):typeof fe.removeListener=="function"&&fe.removeListener(_e)},le=fe=>{F=!!fe.matches,m.dataset.motion=F?"reduced":"full"};m.dataset.motion=F?"reduced":"full",ae&&D(ae,le);function ne(){const fe=l(),_e=u();for(const Ge of j.values()){const ze=ns(Ge.tier,_e),vt=Math.round(Math.max(0,Math.min(ze.progress,1))*100);Ge.fill.style.width=`${vt}%`,Ge.progressLabel.textContent=ze.unlocked?"Unlocked":`${vt}% ready`,Ge.requirement.textContent=ze.unlocked?`Roster cap ${Ge.tier.rosterCap}`:ze.requirementLabel,Ge.button.dataset.state=ze.unlocked?Ge.tier.id===fe?"active":"available":"locked",Ge.button.setAttribute("aria-pressed",Ge.tier.id===fe?"true":"false"),Ge.button.setAttribute("aria-disabled",ze.unlocked?"false":"true")}}function E(fe,_e){if(!ns(fe,u()).unlocked){_e.button.classList.remove("sauna-tier__option--denied"),_e.button.offsetWidth,_e.button.classList.add("sauna-tier__option--denied");return}a.setActiveTierId?.(fe.id,{persist:!0}),ne()}const A=()=>{r.parentElement!==q&&q.appendChild(r);const fe=q.querySelector("#topbar");return fe&&fe.parentElement===q?(fe.nextSibling!==r&&q.insertBefore(r,fe.nextSibling),!0):!1};let z=null;A()||(z=new MutationObserver(()=>{A()&&z?.disconnect()}),z.observe(q,{childList:!0}));const Q=()=>{const fe=!h.hidden;h.hidden=fe,f.setAttribute("aria-expanded",String(!fe))};f.addEventListener("click",Q);const se=()=>{const fe=Math.max(1,Math.floor(t.maxHealth)),_e=Math.max(0,Math.min(fe,Math.floor(Number.isFinite(t.health)?t.health:0))),Ge=fe>0?_e/fe:0,ze=Math.max(0,Math.min(Ge,1));x.style.width=`${ze*100}%`;const vt=nb.format(_e),fn=nb.format(fe);v.textContent=`${vt} / ${fn}`,M.setAttribute("aria-valuenow",String(_e)),M.setAttribute("aria-valuemax",String(fe)),M.setAttribute("aria-valuetext",`${vt} of ${fn} health`);const Zt=t.destroyed?"offline":ze<=.2?"critical":ze<=.55?"warning":"stable";M.dataset.level=Zt,v.dataset.state=Zt,m.dataset.state=t.destroyed?"destroyed":"active"},de=()=>{T.classList.remove("sauna-health__destruction--active"),T.hidden=!0};let ue=null,ge=null;const Se=()=>{ue!==null&&(window.clearTimeout(ue),ue=null),M.classList.remove("sauna-health__bar--impact")},rt=()=>{x.classList.remove("sauna-health__fill--damage")};x.addEventListener("animationend",rt);const _t=()=>{de()};T.addEventListener("animationend",_t);const Ft=()=>{Se(),M.classList.add("sauna-health__bar--impact"),F||(x.classList.remove("sauna-health__fill--damage"),x.offsetWidth,x.classList.add("sauna-health__fill--damage")),ue=window.setTimeout(()=>{M.classList.remove("sauna-health__bar--impact"),ue=null},F?360:560)},On=()=>{ge!==null&&(window.clearTimeout(ge),ge=null),T.hidden=!1,T.classList.remove("sauna-health__destruction--active"),T.offsetWidth,T.classList.add("sauna-health__destruction--active"),ge=window.setTimeout(()=>{de(),ge=null},F?720:1100)},zn=()=>{se();const fe=t.playerSpawnCooldown>0?t.playerSpawnCooldown:1,_e=1-t.playerSpawnTimer/fe;R.style.width=`${Math.max(0,Math.min(_e,1))*100}%`,B.checked=t.rallyToFront,ne()};return se(),{update:zn,handleDamage:fe=>{se(),Ft()},handleDestroyed:fe=>{h.hidden=!1,f.setAttribute("aria-expanded","true"),se(),Ft(),On()},dispose:()=>{z?.disconnect(),z=null,f.removeEventListener("click",Q),ae&&P(ae,le),x.removeEventListener("animationend",rt),T.removeEventListener("animationend",_t),Se(),ge!==null&&(window.clearTimeout(ge),ge=null),de();for(const fe of j.values())fe.button.removeEventListener("click",fe.handleClick);j.clear(),r.remove()}}}const kh="progression:artocoinBalance",Sn=0,Lh=new Set,ab=Object.freeze({"ember-circuit":{tierId:"ember-circuit",nextUnlockLabel:"Modern Wooden Sauna blueprint engraving",unlockCost:150,baselinePayout:60,baselineDurationMinutes:12.5,baselineKills:150,baselineTiles:85},"aurora-ward":{tierId:"aurora-ward",nextUnlockLabel:"Futuristic Fission Sauna ignition rite",unlockCost:210,baselinePayout:84,baselineDurationMinutes:12,baselineKills:190,baselineTiles:100},"mythic-conclave":{tierId:"mythic-conclave",nextUnlockLabel:"Futuristic Fission Sauna prestige rotation",unlockCost:275,baselinePayout:110,baselineDurationMinutes:11.5,baselineKills:230,baselineTiles:115}}),Vf=Object.freeze([{minScalar:0,maxScalar:.95,multiplier:.85},{minScalar:.95,maxScalar:1.1,multiplier:1},{minScalar:1.1,maxScalar:1.3,multiplier:1.18},{minScalar:1.3,maxScalar:1.5,multiplier:1.32},{minScalar:1.5,multiplier:1.42,bonusPerStage:.03,maxMultiplier:1.58}]);function j2(){try{const t=globalThis;return t.localStorage?t.localStorage:t.window?.localStorage?t.window.localStorage:null}catch(t){return console.warn("Local storage unavailable for artocoin progression",t),null}}function o3(t){for(const a of Lh)try{a(t)}catch(s){console.warn("Artocoin listener failure",s)}}function G2(t){return Lh.add(t),()=>{Lh.delete(t)}}function Co(t){const a=Number(t);return!Number.isFinite(a)||a<0?Sn:Math.min(Number.MAX_SAFE_INTEGER,Math.floor(a))}function l3(t){if(!t)return Sn;const a=t.artocoins??t.artocoinBalance,s=Co(a);return"artocoins"in t&&delete t.artocoins,"artocoinBalance"in t&&delete t.artocoinBalance,s}function c3(t){const a=t.getItem(Bc);if(!a)return Sn;try{const s=JSON.parse(a);if(!s||typeof s!="object")return Sn;const r=s,l=l3(r);try{t.setItem(Bc,JSON.stringify(r))}catch(u){console.warn("Failed to persist migrated NG+ state without artocoins",u)}return l}catch(s){return console.warn("Failed to parse legacy NG+ state during artocoin migration",s),Sn}}function as(){const t=j2();if(!t)return Sn;const a=t.getItem(kh);if(a!==null){const r=Co(a);return r!==Sn?r:Sn}const s=c3(t);return s!==Sn?(Em(s,{reason:"migration",previousBalance:Sn}),s):Sn}function Em(t,a={}){const s=j2(),r=Co(t);let l=typeof a.previousBalance=="number"?Co(a.previousBalance):Sn;if(s){if(typeof a.previousBalance!="number")try{const u=s.getItem(kh);u!==null&&(l=Co(u))}catch(u){console.warn("Failed to read previous artocoin balance",u)}try{s.setItem(kh,r.toString())}catch(u){console.warn("Failed to persist artocoin balance",u)}}if(!a.silent){const u=r-l;o3({balance:r,delta:u,reason:a.reason??"set",metadata:a.metadata})}}function u3(t,a={}){const s=Math.max(0,Math.floor(Number.isFinite(t)?t:0));if(s===0)return as();const r=as(),l=Math.min(Number.MAX_SAFE_INTEGER,r+s);return Em(l,{...a,previousBalance:r,reason:a.reason??"payout"}),l}function d3(t,a={}){const s=Math.max(0,Math.floor(Number.isFinite(t)?t:0)),r=as();if(s===0)return{success:!0,balance:r};if(r<s)return{success:!1,balance:r,shortfall:s-r};const l=r-s;return Em(l,{...a,previousBalance:r,reason:a.reason??"purchase"}),{success:!0,balance:l}}function Dc(t,a,s){if(!Number.isFinite(s)||t===a||t>a)return t;const r=Math.max(t,Math.min(a,s));return Number.isNaN(r)?t:r}function f3(t){return Dc(0,1,t)}function Y2(t,a){const s=Number.isFinite(t)?t:1,r=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;for(const l of Vf){const u=typeof l.maxScalar=="number"?s<l.maxScalar:!0;if(s>=l.minScalar&&u){if(l.bonusPerStage&&l.maxMultiplier){const h=Math.max(0,r-4)*l.bonusPerStage,m=l.multiplier+h;return Math.min(l.maxMultiplier,m)}return l.multiplier}}return Vf[Vf.length-1]?.multiplier??1}function F2(t){return ab[t]??ab["ember-circuit"]}function h3(t){const a=F2(t.tierId),s=a.baselinePayout,r=Number.isFinite(t.runSeconds)?t.runSeconds/60:0,l=a.baselineDurationMinutes,u=Dc(.75,1.2,1+(l-r)/l*.35),f=Dc(.6,1.45,t.enemyKills/a.baselineKills),h=Dc(.7,1.25,t.tilesExplored/a.baselineTiles),m=u*.3+f*.45+h*.25,p=Math.max(.4,1-Math.max(0,t.rosterLosses)*.22),g=Y2(t.difficultyScalar,t.rampStageIndex);return{artocoins:Math.round(s*m*p*g),breakdown:{baseline:s,performanceMultiplier:m,lossPenalty:p,difficultyMultiplier:g}}}function m3(t){const a=F2(t.tierId),s=a.baselinePayout,r=Y2(t.difficultyScalar,t.rampStageIndex),l=s*.2*r,u=t.runSeconds/(a.baselineDurationMinutes*60),f=t.enemyKills/a.baselineKills,h=f3(.5*u+.5*f),m=s*.45*h*r,p=Math.max(.35,1-Math.max(0,t.rosterLosses)*.12);return{artocoins:Math.round(Math.max(l,m)*p),breakdown:{baseline:s,performanceMultiplier:m/s,lossPenalty:p,difficultyMultiplier:r}}}function p3(t,a){return t==="win"?h3(a):m3(a)}function $s(t,a={}){const{iconSrc:s,description:r,srLabel:l}=a,u=document.createElement("div");if(u.classList.add("topbar-badge"),u.setAttribute("role","status"),u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),s){const b=document.createElement("img");b.src=s,b.alt=t,b.decoding="async",b.classList.add("topbar-badge-icon"),u.appendChild(b)}const f=document.createElement("div");f.classList.add("badge-text");const h=document.createElement("span");h.textContent=t,h.classList.add("badge-label"),f.appendChild(h);const m=document.createElement("span");m.textContent="0",m.classList.add("badge-value"),m.setAttribute("aria-hidden","true"),f.appendChild(m);const p=document.createElement("span");p.classList.add("badge-delta"),p.style.opacity="0",p.style.transform="translateY(-6px)",p.style.transition="opacity 0.5s ease, transform 0.5s ease",p.setAttribute("aria-hidden","true"),u.append(f,p),r&&(u.title=r);const g=l??t;return u.dataset.label=g,u.setAttribute("aria-label",`${g}: 0`),{container:u,value:m,delta:p,label:g}}function g3(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const{regions:r}=dr(s),l=r.top,u=document.createElement("div");u.id="topbar",l.prepend(u);const f=document.createElement("div");f.className="topbar-badge-row",u.appendChild(f);const h={[oe.SAUNA_BEER]:"Sauna beer bottles chilled for construction crews and eager recruits.",[oe.SAUNAKUNNIA]:"Saunakunnia—prestige earned from sauna rituals and triumphant battles.",[oe.SISU]:"Sisu—the relentless grit forged when your warriors triumph on the snow."},m=$s("Sauna Beer",{iconSrc:a.saunaBeer,description:h[oe.SAUNA_BEER],srLabel:"Sauna beer reserves"});m.container.classList.add("badge-sauna-beer");const p=$s("Sisu",{iconSrc:a.sisu,description:h[oe.SISU],srLabel:"Sisu reserves"});p.container.classList.add("badge-sisu"),p.container.dataset.tutorialTarget="sisu";const g=$s("Saunakunnia",{iconSrc:a.saunakunnia,description:h[oe.SAUNAKUNNIA],srLabel:"Saunakunnia"});g.container.classList.add("badge-sauna"),g.container.dataset.tutorialTarget="victory";const b=$s("Artocoins",{iconSrc:a.artocoin,description:"Artocoin treasury minted from triumphant campaigns.",srLabel:"Artocoin balance"});b.container.classList.add("badge-artocoin");const v=$s("Time");v.container.classList.add("badge-time"),v.delta.style.display="none";const M=$s("Enemy Ramp",{srLabel:"Enemy ramp intensity"});M.container.classList.add("badge-ramp"),M.delta.style.display="none",M.container.dataset.tutorialTarget="enemy-ramp",M.container.title="Enemy ramp intensity and cadence.",f.appendChild(m.container),f.appendChild(p.container),f.appendChild(g.container),f.appendChild(b.container),f.appendChild(M.container),f.appendChild(v.container);const x=new Intl.NumberFormat("en-US"),T=new Intl.NumberFormat("en-US",{signDisplay:"exceptZero"}),_={[oe.SAUNA_BEER]:"Sauna Beer",[oe.SAUNAKUNNIA]:"Saunakunnia",[oe.SISU]:"Sisu"},R={[oe.SAUNA_BEER]:{singular:"bottle",plural:"bottles"},[oe.SAUNAKUNNIA]:{singular:"Saunakunnia",plural:"Saunakunnia"},[oe.SISU]:{singular:"Sisu",plural:"Sisu"}},I={[oe.SAUNA_BEER]:"🍺",[oe.SAUNAKUNNIA]:"⚜️",[oe.SISU]:"🔥"},j={[oe.SAUNA_BEER]:m,[oe.SAUNAKUNNIA]:g,[oe.SISU]:p},V={};let X=as(),$=null,ee=null;function te(ne){if(ee=ne,!ne){M.value.textContent="Stage 1 · ×1.00",M.delta.textContent="",M.delta.style.display="none",M.container.dataset.state="idle",M.container.title="Enemy ramp idle",M.container.setAttribute("aria-label","Enemy ramp idle.");return}const E=ne.stage||`Stage ${ne.stageIndex+1}`,A=`×${ne.multiplier.toFixed(2)}`,z=`${ne.cadenceSeconds.toFixed(2)}s cadence`,Q=`×${ne.effectiveDifficulty.toFixed(2)}`,se=ne.calmSecondsRemaining>.05,de=se?`Calm remaining: ${Math.ceil(ne.calmSecondsRemaining)}s`:"Calm inactive";M.value.textContent=`${E} · ${A}`,M.delta.style.display=se?"":"none",M.delta.textContent=se?`Calm ${Math.ceil(ne.calmSecondsRemaining)}s`:"",M.container.dataset.state=se?"calm":"active",M.container.title=[`Stage: ${E} (Tier ${ne.bundleTier})`,`Cadence: ${z}`,`Multiplier: ${A}`,`Difficulty: ${Q}`,`Aggression ×${ne.aggressionMultiplier.toFixed(2)} · Cadence ×${ne.cadenceMultiplier.toFixed(2)} · Strength ×${ne.strengthMultiplier.toFixed(2)}`,de,`Spawn cycles: ${ne.spawnCycles}`].join(`
`),M.container.setAttribute("aria-label",[`Enemy ramp ${E}`,`Multiplier ${A}`,`Cadence ${ne.cadenceSeconds.toFixed(2)} seconds`,`Difficulty ${Q}`,se?`Calm remaining ${Math.ceil(ne.calmSecondsRemaining)} seconds`:"Calm inactive"].join(" — "))}function Y(ne,E){const A=Number.isFinite(E)?E:0;return ne===oe.SAUNA_BEER?Math.trunc(A):Math.max(0,Math.round(A))}function B(ne,E){return x.format(Y(ne,E))}function C(ne,E){return E===0?"":`${T.format(E)} ${I[ne]}`}function J(ne,E){if(E===0)return"";const A=E>0?"gained":"spent",z=x.format(Math.abs(E)),Q=R[ne];if(Q){const de=Math.abs(E)===1?Q.singular:Q.plural,ue=_[ne],ge=[ue];de&&de!==ue&&ge.push(de);const Se=ge.filter(Boolean).join(" ");return`${A} ${z}${Se?` ${Se}`:""}`}const se=_[ne];return`${A} ${z}${se?` ${se}`:""}`}function q(ne,E,A=0){const z=j[ne];if(!z)return;const Q=Y(ne,E),se=B(ne,E);z.value.textContent=se;const de=ne===oe.SAUNA_BEER&&Q<0;if(z.container.classList.toggle("topbar-badge--debt",de),A!==0){z.delta.textContent=C(ne,A),z.delta.style.opacity="1",z.delta.style.transform="translateY(0)";const Se=V[ne];Se&&clearTimeout(Se),V[ne]=setTimeout(()=>{z.delta.style.opacity="0",z.delta.style.transform="translateY(-6px)",delete V[ne]},1e3)}else z.delta.textContent="",z.delta.style.opacity="0",z.delta.style.transform="translateY(-6px)";const ue=J(ne,A),ge=[`${z.label} ${se}`];if(de){const Se=x.format(Math.abs(Q)),rt=R[ne];if(rt){const _t=Math.abs(Q)===1?rt.singular:rt.plural,Ft=_t&&_t!==_[ne];ge.push(Ft?`Debt of ${Se} ${_t}`:`Debt of ${Se}`)}else ge.push(`Debt of ${Se}`)}ue&&ge.push(ue),z.container.setAttribute("aria-label",ge.join(" — "))}function ae(ne,E=0){X=Math.max(0,Math.floor(Number.isFinite(ne)?ne:0));const A=x.format(X);b.value.textContent=A,E!==0?(b.delta.textContent=`${T.format(E)} Ⓐ`,b.delta.style.opacity="1",b.delta.style.transform="translateY(0)",$&&clearTimeout($),$=setTimeout(()=>{b.delta.style.opacity="0",b.delta.style.transform="translateY(-6px)",$=null},1e3)):(b.delta.textContent="",b.delta.style.opacity="0",b.delta.style.transform="translateY(-6px)");const z=E===0?"":E>0?`Gained ${x.format(E)} artocoins`:`Spent ${x.format(Math.abs(E))} artocoins`,Q=[`${b.label} ${A}`];z&&Q.push(z),b.container.setAttribute("aria-label",Q.join(" — "))}q(oe.SAUNA_BEER,t.getResource(oe.SAUNA_BEER)),q(oe.SAUNAKUNNIA,t.getResource(oe.SAUNAKUNNIA)),q(oe.SISU,t.getResource(oe.SISU)),ae(X),te(ee);const F=({resource:ne,amount:E,total:A})=>{j[ne]&&q(ne,A,E)};re.on("resourceChanged",F);const P=G2(ne=>{ae(ne.balance,ne.delta)});let le=0;return{update(ne){le+=ne;const E=Math.floor(le/1e3),A=Math.floor(E/60),z=E%60;v.value.textContent=`${A}:${z.toString().padStart(2,"0")}`},setEnemyRampSummary(ne){te(ne)},dispose(){re.off("resourceChanged",F),Object.values(V).forEach(ne=>{ne&&clearTimeout(ne)}),$&&clearTimeout($),P(),u.remove()}}}var $f={exports:{}},ho={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ib;function y3(){if(ib)return ho;ib=1;var t=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function s(r,l,u){var f=null;if(u!==void 0&&(f=""+u),l.key!==void 0&&(f=""+l.key),"key"in l){u={};for(var h in l)h!=="key"&&(u[h]=l[h])}else u=l;return l=u.ref,{$$typeof:t,type:r,key:f,ref:l!==void 0?l:null,props:u}}return ho.Fragment=a,ho.jsx=s,ho.jsxs=s,ho}var sb;function b3(){return sb||(sb=1,$f.exports=y3()),$f.exports}var Pt=b3(),Xf={exports:{}},mo={},Qf={exports:{}},Kf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rb;function v3(){return rb||(rb=1,(function(t){function a(D,P){var le=D.length;D.push(P);e:for(;0<le;){var ne=le-1>>>1,E=D[ne];if(0<l(E,P))D[ne]=P,D[le]=E,le=ne;else break e}}function s(D){return D.length===0?null:D[0]}function r(D){if(D.length===0)return null;var P=D[0],le=D.pop();if(le!==P){D[0]=le;e:for(var ne=0,E=D.length,A=E>>>1;ne<A;){var z=2*(ne+1)-1,Q=D[z],se=z+1,de=D[se];if(0>l(Q,le))se<E&&0>l(de,Q)?(D[ne]=de,D[se]=le,ne=se):(D[ne]=Q,D[z]=le,ne=z);else if(se<E&&0>l(de,le))D[ne]=de,D[se]=le,ne=se;else break e}}return P}function l(D,P){var le=D.sortIndex-P.sortIndex;return le!==0?le:D.id-P.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var f=Date,h=f.now();t.unstable_now=function(){return f.now()-h}}var m=[],p=[],g=1,b=null,v=3,M=!1,x=!1,T=!1,_=!1,R=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function V(D){for(var P=s(p);P!==null;){if(P.callback===null)r(p);else if(P.startTime<=D)r(p),P.sortIndex=P.expirationTime,a(m,P);else break;P=s(p)}}function X(D){if(T=!1,V(D),!x)if(s(m)!==null)x=!0,$||($=!0,J());else{var P=s(p);P!==null&&F(X,P.startTime-D)}}var $=!1,ee=-1,te=5,Y=-1;function B(){return _?!0:!(t.unstable_now()-Y<te)}function C(){if(_=!1,$){var D=t.unstable_now();Y=D;var P=!0;try{e:{x=!1,T&&(T=!1,I(ee),ee=-1),M=!0;var le=v;try{t:{for(V(D),b=s(m);b!==null&&!(b.expirationTime>D&&B());){var ne=b.callback;if(typeof ne=="function"){b.callback=null,v=b.priorityLevel;var E=ne(b.expirationTime<=D);if(D=t.unstable_now(),typeof E=="function"){b.callback=E,V(D),P=!0;break t}b===s(m)&&r(m),V(D)}else r(m);b=s(m)}if(b!==null)P=!0;else{var A=s(p);A!==null&&F(X,A.startTime-D),P=!1}}break e}finally{b=null,v=le,M=!1}P=void 0}}finally{P?J():$=!1}}}var J;if(typeof j=="function")J=function(){j(C)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,ae=q.port2;q.port1.onmessage=C,J=function(){ae.postMessage(null)}}else J=function(){R(C,0)};function F(D,P){ee=R(function(){D(t.unstable_now())},P)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(D){D.callback=null},t.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<D?Math.floor(1e3/D):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(D){switch(v){case 1:case 2:case 3:var P=3;break;default:P=v}var le=v;v=P;try{return D()}finally{v=le}},t.unstable_requestPaint=function(){_=!0},t.unstable_runWithPriority=function(D,P){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var le=v;v=D;try{return P()}finally{v=le}},t.unstable_scheduleCallback=function(D,P,le){var ne=t.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?ne+le:ne):le=ne,D){case 1:var E=-1;break;case 2:E=250;break;case 5:E=1073741823;break;case 4:E=1e4;break;default:E=5e3}return E=le+E,D={id:g++,callback:P,priorityLevel:D,startTime:le,expirationTime:E,sortIndex:-1},le>ne?(D.sortIndex=le,a(p,D),s(m)===null&&D===s(p)&&(T?(I(ee),ee=-1):T=!0,F(X,le-ne))):(D.sortIndex=E,a(m,D),x||M||(x=!0,$||($=!0,J()))),D},t.unstable_shouldYield=B,t.unstable_wrapCallback=function(D){var P=v;return function(){var le=v;v=P;try{return D.apply(this,arguments)}finally{v=le}}}})(Kf)),Kf}var ob;function S3(){return ob||(ob=1,Qf.exports=v3()),Qf.exports}var Pf={exports:{}},Me={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lb;function M3(){if(lb)return Me;lb=1;var t=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),b=Symbol.iterator;function v(E){return E===null||typeof E!="object"?null:(E=b&&E[b]||E["@@iterator"],typeof E=="function"?E:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,T={};function _(E,A,z){this.props=E,this.context=A,this.refs=T,this.updater=z||M}_.prototype.isReactComponent={},_.prototype.setState=function(E,A){if(typeof E!="object"&&typeof E!="function"&&E!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,E,A,"setState")},_.prototype.forceUpdate=function(E){this.updater.enqueueForceUpdate(this,E,"forceUpdate")};function R(){}R.prototype=_.prototype;function I(E,A,z){this.props=E,this.context=A,this.refs=T,this.updater=z||M}var j=I.prototype=new R;j.constructor=I,x(j,_.prototype),j.isPureReactComponent=!0;var V=Array.isArray,X={H:null,A:null,T:null,S:null,V:null},$=Object.prototype.hasOwnProperty;function ee(E,A,z,Q,se,de){return z=de.ref,{$$typeof:t,type:E,key:A,ref:z!==void 0?z:null,props:de}}function te(E,A){return ee(E.type,A,void 0,void 0,void 0,E.props)}function Y(E){return typeof E=="object"&&E!==null&&E.$$typeof===t}function B(E){var A={"=":"=0",":":"=2"};return"$"+E.replace(/[=:]/g,function(z){return A[z]})}var C=/\/+/g;function J(E,A){return typeof E=="object"&&E!==null&&E.key!=null?B(""+E.key):A.toString(36)}function q(){}function ae(E){switch(E.status){case"fulfilled":return E.value;case"rejected":throw E.reason;default:switch(typeof E.status=="string"?E.then(q,q):(E.status="pending",E.then(function(A){E.status==="pending"&&(E.status="fulfilled",E.value=A)},function(A){E.status==="pending"&&(E.status="rejected",E.reason=A)})),E.status){case"fulfilled":return E.value;case"rejected":throw E.reason}}throw E}function F(E,A,z,Q,se){var de=typeof E;(de==="undefined"||de==="boolean")&&(E=null);var ue=!1;if(E===null)ue=!0;else switch(de){case"bigint":case"string":case"number":ue=!0;break;case"object":switch(E.$$typeof){case t:case a:ue=!0;break;case g:return ue=E._init,F(ue(E._payload),A,z,Q,se)}}if(ue)return se=se(E),ue=Q===""?"."+J(E,0):Q,V(se)?(z="",ue!=null&&(z=ue.replace(C,"$&/")+"/"),F(se,A,z,"",function(rt){return rt})):se!=null&&(Y(se)&&(se=te(se,z+(se.key==null||E&&E.key===se.key?"":(""+se.key).replace(C,"$&/")+"/")+ue)),A.push(se)),1;ue=0;var ge=Q===""?".":Q+":";if(V(E))for(var Se=0;Se<E.length;Se++)Q=E[Se],de=ge+J(Q,Se),ue+=F(Q,A,z,de,se);else if(Se=v(E),typeof Se=="function")for(E=Se.call(E),Se=0;!(Q=E.next()).done;)Q=Q.value,de=ge+J(Q,Se++),ue+=F(Q,A,z,de,se);else if(de==="object"){if(typeof E.then=="function")return F(ae(E),A,z,Q,se);throw A=String(E),Error("Objects are not valid as a React child (found: "+(A==="[object Object]"?"object with keys {"+Object.keys(E).join(", ")+"}":A)+"). If you meant to render a collection of children, use an array instead.")}return ue}function D(E,A,z){if(E==null)return E;var Q=[],se=0;return F(E,Q,"","",function(de){return A.call(z,de,se++)}),Q}function P(E){if(E._status===-1){var A=E._result;A=A(),A.then(function(z){(E._status===0||E._status===-1)&&(E._status=1,E._result=z)},function(z){(E._status===0||E._status===-1)&&(E._status=2,E._result=z)}),E._status===-1&&(E._status=0,E._result=A)}if(E._status===1)return E._result.default;throw E._result}var le=typeof reportError=="function"?reportError:function(E){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var A=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof E=="object"&&E!==null&&typeof E.message=="string"?String(E.message):String(E),error:E});if(!window.dispatchEvent(A))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",E);return}console.error(E)};function ne(){}return Me.Children={map:D,forEach:function(E,A,z){D(E,function(){A.apply(this,arguments)},z)},count:function(E){var A=0;return D(E,function(){A++}),A},toArray:function(E){return D(E,function(A){return A})||[]},only:function(E){if(!Y(E))throw Error("React.Children.only expected to receive a single React element child.");return E}},Me.Component=_,Me.Fragment=s,Me.Profiler=l,Me.PureComponent=I,Me.StrictMode=r,Me.Suspense=m,Me.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=X,Me.__COMPILER_RUNTIME={__proto__:null,c:function(E){return X.H.useMemoCache(E)}},Me.cache=function(E){return function(){return E.apply(null,arguments)}},Me.cloneElement=function(E,A,z){if(E==null)throw Error("The argument must be a React element, but you passed "+E+".");var Q=x({},E.props),se=E.key,de=void 0;if(A!=null)for(ue in A.ref!==void 0&&(de=void 0),A.key!==void 0&&(se=""+A.key),A)!$.call(A,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&A.ref===void 0||(Q[ue]=A[ue]);var ue=arguments.length-2;if(ue===1)Q.children=z;else if(1<ue){for(var ge=Array(ue),Se=0;Se<ue;Se++)ge[Se]=arguments[Se+2];Q.children=ge}return ee(E.type,se,void 0,void 0,de,Q)},Me.createContext=function(E){return E={$$typeof:f,_currentValue:E,_currentValue2:E,_threadCount:0,Provider:null,Consumer:null},E.Provider=E,E.Consumer={$$typeof:u,_context:E},E},Me.createElement=function(E,A,z){var Q,se={},de=null;if(A!=null)for(Q in A.key!==void 0&&(de=""+A.key),A)$.call(A,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(se[Q]=A[Q]);var ue=arguments.length-2;if(ue===1)se.children=z;else if(1<ue){for(var ge=Array(ue),Se=0;Se<ue;Se++)ge[Se]=arguments[Se+2];se.children=ge}if(E&&E.defaultProps)for(Q in ue=E.defaultProps,ue)se[Q]===void 0&&(se[Q]=ue[Q]);return ee(E,de,void 0,void 0,null,se)},Me.createRef=function(){return{current:null}},Me.forwardRef=function(E){return{$$typeof:h,render:E}},Me.isValidElement=Y,Me.lazy=function(E){return{$$typeof:g,_payload:{_status:-1,_result:E},_init:P}},Me.memo=function(E,A){return{$$typeof:p,type:E,compare:A===void 0?null:A}},Me.startTransition=function(E){var A=X.T,z={};X.T=z;try{var Q=E(),se=X.S;se!==null&&se(z,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(ne,le)}catch(de){le(de)}finally{X.T=A}},Me.unstable_useCacheRefresh=function(){return X.H.useCacheRefresh()},Me.use=function(E){return X.H.use(E)},Me.useActionState=function(E,A,z){return X.H.useActionState(E,A,z)},Me.useCallback=function(E,A){return X.H.useCallback(E,A)},Me.useContext=function(E){return X.H.useContext(E)},Me.useDebugValue=function(){},Me.useDeferredValue=function(E,A){return X.H.useDeferredValue(E,A)},Me.useEffect=function(E,A,z){var Q=X.H;if(typeof z=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Q.useEffect(E,A)},Me.useId=function(){return X.H.useId()},Me.useImperativeHandle=function(E,A,z){return X.H.useImperativeHandle(E,A,z)},Me.useInsertionEffect=function(E,A){return X.H.useInsertionEffect(E,A)},Me.useLayoutEffect=function(E,A){return X.H.useLayoutEffect(E,A)},Me.useMemo=function(E,A){return X.H.useMemo(E,A)},Me.useOptimistic=function(E,A){return X.H.useOptimistic(E,A)},Me.useReducer=function(E,A,z){return X.H.useReducer(E,A,z)},Me.useRef=function(E){return X.H.useRef(E)},Me.useState=function(E){return X.H.useState(E)},Me.useSyncExternalStore=function(E,A,z){return X.H.useSyncExternalStore(E,A,z)},Me.useTransition=function(){return X.H.useTransition()},Me.version="19.1.1",Me}var cb;function xm(){return cb||(cb=1,Pf.exports=M3()),Pf.exports}var Zf={exports:{}},kt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ub;function E3(){if(ub)return kt;ub=1;var t=xm();function a(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var r={d:{f:s,r:function(){throw Error(a(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},l=Symbol.for("react.portal");function u(m,p,g){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:b==null?null:""+b,children:m,containerInfo:p,implementation:g}}var f=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return kt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,kt.createPortal=function(m,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(a(299));return u(m,p,null,g)},kt.flushSync=function(m){var p=f.T,g=r.p;try{if(f.T=null,r.p=2,m)return m()}finally{f.T=p,r.p=g,r.d.f()}},kt.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,r.d.C(m,p))},kt.prefetchDNS=function(m){typeof m=="string"&&r.d.D(m)},kt.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var g=p.as,b=h(g,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,M=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;g==="style"?r.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:b,integrity:v,fetchPriority:M}):g==="script"&&r.d.X(m,{crossOrigin:b,integrity:v,fetchPriority:M,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},kt.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var g=h(p.as,p.crossOrigin);r.d.M(m,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&r.d.M(m)},kt.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var g=p.as,b=h(g,p.crossOrigin);r.d.L(m,g,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},kt.preloadModule=function(m,p){if(typeof m=="string")if(p){var g=h(p.as,p.crossOrigin);r.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else r.d.m(m)},kt.requestFormReset=function(m){r.d.r(m)},kt.unstable_batchedUpdates=function(m,p){return m(p)},kt.useFormState=function(m,p,g){return f.H.useFormState(m,p,g)},kt.useFormStatus=function(){return f.H.useHostTransitionStatus()},kt.version="19.1.1",kt}var db;function x3(){if(db)return Zf.exports;db=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(a){console.error(a)}}return t(),Zf.exports=E3(),Zf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fb;function A3(){if(fb)return mo;fb=1;var t=S3(),a=xm(),s=x3();function r(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)n+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var n=e,i=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(i=n.return),e=n.return;while(e)}return n.tag===3?i:null}function f(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(r(188))}function m(e){var n=e.alternate;if(!n){if(n=u(e),n===null)throw Error(r(188));return n!==e?null:e}for(var i=e,o=n;;){var c=i.return;if(c===null)break;var d=c.alternate;if(d===null){if(o=c.return,o!==null){i=o;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===i)return h(c),e;if(d===o)return h(c),n;d=d.sibling}throw Error(r(188))}if(i.return!==o.return)i=c,o=d;else{for(var y=!1,S=c.child;S;){if(S===i){y=!0,i=c,o=d;break}if(S===o){y=!0,o=c,i=d;break}S=S.sibling}if(!y){for(S=d.child;S;){if(S===i){y=!0,i=d,o=c;break}if(S===o){y=!0,o=d,i=c;break}S=S.sibling}if(!y)throw Error(r(189))}}if(i.alternate!==o)throw Error(r(190))}if(i.tag!==3)throw Error(r(188));return i.stateNode.current===i?e:n}function p(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=p(e),n!==null)return n;e=e.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),M=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),I=Symbol.for("react.consumer"),j=Symbol.for("react.context"),V=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),ee=Symbol.for("react.memo"),te=Symbol.for("react.lazy"),Y=Symbol.for("react.activity"),B=Symbol.for("react.memo_cache_sentinel"),C=Symbol.iterator;function J(e){return e===null||typeof e!="object"?null:(e=C&&e[C]||e["@@iterator"],typeof e=="function"?e:null)}var q=Symbol.for("react.client.reference");function ae(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===q?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case x:return"Fragment";case _:return"Profiler";case T:return"StrictMode";case X:return"Suspense";case $:return"SuspenseList";case Y:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case M:return"Portal";case j:return(e.displayName||"Context")+".Provider";case I:return(e._context.displayName||"Context")+".Consumer";case V:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ee:return n=e.displayName||null,n!==null?n:ae(e.type)||"Memo";case te:n=e._payload,e=e._init;try{return ae(e(n))}catch{}}return null}var F=Array.isArray,D=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le={pending:!1,data:null,method:null,action:null},ne=[],E=-1;function A(e){return{current:e}}function z(e){0>E||(e.current=ne[E],ne[E]=null,E--)}function Q(e,n){E++,ne[E]=e.current,e.current=n}var se=A(null),de=A(null),ue=A(null),ge=A(null);function Se(e,n){switch(Q(ue,n),Q(de,e),Q(se,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?Fg(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=Fg(n),e=Vg(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}z(se),Q(se,e)}function rt(){z(se),z(de),z(ue)}function _t(e){e.memoizedState!==null&&Q(ge,e);var n=se.current,i=Vg(n,e.type);n!==i&&(Q(de,e),Q(se,i))}function Ft(e){de.current===e&&(z(se),z(de)),ge.current===e&&(z(ge),ao._currentValue=le)}var On=Object.prototype.hasOwnProperty,zn=t.unstable_scheduleCallback,dn=t.unstable_cancelCallback,Mi=t.unstable_shouldYield,os=t.unstable_requestPaint,fe=t.unstable_now,_e=t.unstable_getCurrentPriorityLevel,Ge=t.unstable_ImmediatePriority,ze=t.unstable_UserBlockingPriority,vt=t.unstable_NormalPriority,fn=t.unstable_LowPriority,Zt=t.unstable_IdlePriority,An=t.log,oa=t.unstable_setDisableYieldValue,Qe=null,Pe=null;function Vt(e){if(typeof An=="function"&&oa(e),Pe&&typeof Pe.setStrictMode=="function")try{Pe.setStrictMode(Qe,e)}catch{}}var Nt=Math.clz32?Math.clz32:Yo,wu=Math.log,Cu=Math.LN2;function Yo(e){return e>>>=0,e===0?32:31-(wu(e)/Cu|0)|0}var ls=256,Ha=4194304;function Bn(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ei(e,n,i){var o=e.pendingLanes;if(o===0)return 0;var c=0,d=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var S=o&134217727;return S!==0?(o=S&~d,o!==0?c=Bn(o):(y&=S,y!==0?c=Bn(y):i||(i=S&~e,i!==0&&(c=Bn(i))))):(S=o&~d,S!==0?c=Bn(S):y!==0?c=Bn(y):i||(i=o&~e,i!==0&&(c=Bn(i)))),c===0?0:n!==0&&n!==c&&(n&d)===0&&(d=c&-c,i=n&-n,d>=i||d===32&&(i&4194048)!==0)?n:c}function la(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function Tu(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Fo(){var e=ls;return ls<<=1,(ls&4194048)===0&&(ls=256),e}function Vo(){var e=Ha;return Ha<<=1,(Ha&62914560)===0&&(Ha=4194304),e}function cs(e){for(var n=[],i=0;31>i;i++)n.push(e);return n}function qn(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function $o(e,n,i,o,c,d){var y=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var S=e.entanglements,w=e.expirationTimes,O=e.hiddenUpdates;for(i=y&~i;0<i;){var Z=31-Nt(i),ie=1<<Z;S[Z]=0,w[Z]=-1;var H=O[Z];if(H!==null)for(O[Z]=null,Z=0;Z<H.length;Z++){var G=H[Z];G!==null&&(G.lane&=-536870913)}i&=~ie}o!==0&&fr(e,o,0),d!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=d&~(y&~n))}function fr(e,n,i){e.pendingLanes|=n,e.suspendedLanes&=~n;var o=31-Nt(n);e.entangledLanes|=n,e.entanglements[o]=e.entanglements[o]|1073741824|i&4194090}function hr(e,n){var i=e.entangledLanes|=n;for(e=e.entanglements;i;){var o=31-Nt(i),c=1<<o;c&n|e[o]&n&&(e[o]|=n),i&=~c}}function mr(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function pr(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Xo(){var e=P.p;return e!==0?e:(e=window.event,e===void 0?32:uy(e.type))}function Qo(e,n){var i=P.p;try{return P.p=e,n()}finally{P.p=i}}var Hn=Math.random().toString(36).slice(2),et="__reactFiber$"+Hn,ft="__reactProps$"+Hn,ca="__reactContainer$"+Hn,ja="__reactEvents$"+Hn,wn="__reactListeners$"+Hn,us="__reactHandles$"+Hn,xi="__reactResources$"+Hn,Ai="__reactMarker$"+Hn;function ds(e){delete e[et],delete e[ft],delete e[ja],delete e[wn],delete e[us]}function ua(e){var n=e[et];if(n)return n;for(var i=e.parentNode;i;){if(n=i[ca]||i[et]){if(i=n.alternate,n.child!==null||i!==null&&i.child!==null)for(e=Kg(e);e!==null;){if(i=e[et])return i;e=Kg(e)}return n}e=i,i=e.parentNode}return null}function Ga(e){if(e=e[et]||e[ca]){var n=e.tag;if(n===5||n===6||n===13||n===26||n===27||n===3)return e}return null}function da(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(r(33))}function fa(e){var n=e[xi];return n||(n=e[xi]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function tt(e){e[Ai]=!0}var fs=new Set,Ko={};function jn(e,n){Ya(e,n),Ya(e+"Capture",n)}function Ya(e,n){for(Ko[e]=n,e=0;e<n.length;e++)fs.add(n[e])}var Po=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Zo={},Jo={};function Wo(e){return On.call(Jo,e)?!0:On.call(Zo,e)?!1:Po.test(e)?Jo[e]=!0:(Zo[e]=!0,!1)}function wi(e,n,i){if(Wo(n))if(i===null)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var o=n.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+i)}}function Ci(e,n,i){if(i===null)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+i)}}function Cn(e,n,i,o){if(o===null)e.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(n,i,""+o)}}var el,k;function K(e){if(el===void 0)try{throw Error()}catch(i){var n=i.stack.trim().match(/\n( *(at )?)/);el=n&&n[1]||"",k=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+el+e+k}var ce=!1;function me(e,n){if(!e||ce)return"";ce=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(n){var ie=function(){throw Error()};if(Object.defineProperty(ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ie,[])}catch(G){var H=G}Reflect.construct(e,[],ie)}else{try{ie.call()}catch(G){H=G}e.call(ie.prototype)}}else{try{throw Error()}catch(G){H=G}(ie=e())&&typeof ie.catch=="function"&&ie.catch(function(){})}}catch(G){if(G&&H&&typeof G.stack=="string")return[G.stack,H.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=o.DetermineComponentFrameRoot(),y=d[0],S=d[1];if(y&&S){var w=y.split(`
`),O=S.split(`
`);for(c=o=0;o<w.length&&!w[o].includes("DetermineComponentFrameRoot");)o++;for(;c<O.length&&!O[c].includes("DetermineComponentFrameRoot");)c++;if(o===w.length||c===O.length)for(o=w.length-1,c=O.length-1;1<=o&&0<=c&&w[o]!==O[c];)c--;for(;1<=o&&0<=c;o--,c--)if(w[o]!==O[c]){if(o!==1||c!==1)do if(o--,c--,0>c||w[o]!==O[c]){var Z=`
`+w[o].replace(" at new "," at ");return e.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",e.displayName)),Z}while(1<=o&&0<=c);break}}}finally{ce=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?K(i):""}function Ne(e){switch(e.tag){case 26:case 27:case 5:return K(e.type);case 16:return K("Lazy");case 13:return K("Suspense");case 19:return K("SuspenseList");case 0:case 15:return me(e.type,!1);case 11:return me(e.type.render,!1);case 1:return me(e.type,!0);case 31:return K("Activity");default:return""}}function Ye(e){try{var n="";do n+=Ne(e),e=e.return;while(e);return n}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function Te(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function nt(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Jt(e){var n=nt(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),o=""+e[n];if(!e.hasOwnProperty(n)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var c=i.get,d=i.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return c.call(this)},set:function(y){o=""+y,d.call(this,y)}}),Object.defineProperty(e,n,{enumerable:i.enumerable}),{getValue:function(){return o},setValue:function(y){o=""+y},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function St(e){e._valueTracker||(e._valueTracker=Jt(e))}function Wt(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var i=n.getValue(),o="";return e&&(o=nt(e)?e.checked?"true":"false":e.value),e=o,e!==i?(n.setValue(e),!0):!1}function en(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Ti=/[\n"\\]/g;function ht(e){return e.replace(Ti,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function at(e,n,i,o,c,d,y,S){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),n!=null?y==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+Te(n)):e.value!==""+Te(n)&&(e.value=""+Te(n)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),n!=null?Va(e,y,Te(n)):i!=null?Va(e,y,Te(i)):o!=null&&e.removeAttribute("value"),c==null&&d!=null&&(e.defaultChecked=!!d),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?e.name=""+Te(S):e.removeAttribute("name")}function Fa(e,n,i,o,c,d,y,S){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),n!=null||i!=null){if(!(d!=="submit"&&d!=="reset"||n!=null))return;i=i!=null?""+Te(i):"",n=n!=null?""+Te(n):i,S||n===e.value||(e.value=n),e.defaultValue=n}o=o??c,o=typeof o!="function"&&typeof o!="symbol"&&!!o,e.checked=S?e.checked:!!o,e.defaultChecked=!!o,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y)}function Va(e,n,i){n==="number"&&en(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function ha(e,n,i,o){if(e=e.options,n){n={};for(var c=0;c<i.length;c++)n["$"+i[c]]=!0;for(i=0;i<e.length;i++)c=n.hasOwnProperty("$"+e[i].value),e[i].selected!==c&&(e[i].selected=c),c&&o&&(e[i].defaultSelected=!0)}else{for(i=""+Te(i),n=null,c=0;c<e.length;c++){if(e[c].value===i){e[c].selected=!0,o&&(e[c].defaultSelected=!0);return}n!==null||e[c].disabled||(n=e[c])}n!==null&&(n.selected=!0)}}function Gn(e,n,i){if(n!=null&&(n=""+Te(n),n!==e.value&&(e.value=n),i==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=i!=null?""+Te(i):""}function tl(e,n,i,o){if(n==null){if(o!=null){if(i!=null)throw Error(r(92));if(F(o)){if(1<o.length)throw Error(r(93));o=o[0]}i=o}i==null&&(i=""),n=i}i=Te(n),e.defaultValue=i,o=e.textContent,o===i&&o!==""&&o!==null&&(e.value=o)}function hs(e,n){if(n){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=n;return}}e.textContent=n}var y1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Fm(e,n,i){var o=n.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?o?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":o?e.setProperty(n,i):typeof i!="number"||i===0||y1.has(n)?n==="float"?e.cssFloat=i:e[n]=(""+i).trim():e[n]=i+"px"}function Vm(e,n,i){if(n!=null&&typeof n!="object")throw Error(r(62));if(e=e.style,i!=null){for(var o in i)!i.hasOwnProperty(o)||n!=null&&n.hasOwnProperty(o)||(o.indexOf("--")===0?e.setProperty(o,""):o==="float"?e.cssFloat="":e[o]="");for(var c in n)o=n[c],n.hasOwnProperty(c)&&i[c]!==o&&Fm(e,c,o)}else for(var d in n)n.hasOwnProperty(d)&&Fm(e,d,n[d])}function _u(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var b1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),v1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function nl(e){return v1.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Nu=null;function Ru(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ms=null,ps=null;function $m(e){var n=Ga(e);if(n&&(e=n.stateNode)){var i=e[ft]||null;e:switch(e=n.stateNode,n.type){case"input":if(at(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),n=i.name,i.type==="radio"&&n!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+ht(""+n)+'"][type="radio"]'),n=0;n<i.length;n++){var o=i[n];if(o!==e&&o.form===e.form){var c=o[ft]||null;if(!c)throw Error(r(90));at(o,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(n=0;n<i.length;n++)o=i[n],o.form===e.form&&Wt(o)}break e;case"textarea":Gn(e,i.value,i.defaultValue);break e;case"select":n=i.value,n!=null&&ha(e,!!i.multiple,n,!1)}}}var ku=!1;function Xm(e,n,i){if(ku)return e(n,i);ku=!0;try{var o=e(n);return o}finally{if(ku=!1,(ms!==null||ps!==null)&&(jl(),ms&&(n=ms,e=ps,ps=ms=null,$m(n),e)))for(n=0;n<e.length;n++)$m(e[n])}}function gr(e,n){var i=e.stateNode;if(i===null)return null;var o=i[ft]||null;if(o===null)return null;i=o[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(r(231,n,typeof i));return i}var ma=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Lu=!1;if(ma)try{var yr={};Object.defineProperty(yr,"passive",{get:function(){Lu=!0}}),window.addEventListener("test",yr,yr),window.removeEventListener("test",yr,yr)}catch{Lu=!1}var $a=null,Du=null,al=null;function Qm(){if(al)return al;var e,n=Du,i=n.length,o,c="value"in $a?$a.value:$a.textContent,d=c.length;for(e=0;e<i&&n[e]===c[e];e++);var y=i-e;for(o=1;o<=y&&n[i-o]===c[d-o];o++);return al=c.slice(e,1<o?1-o:void 0)}function il(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function sl(){return!0}function Km(){return!1}function $t(e){function n(i,o,c,d,y){this._reactName=i,this._targetInst=c,this.type=o,this.nativeEvent=d,this.target=y,this.currentTarget=null;for(var S in e)e.hasOwnProperty(S)&&(i=e[S],this[S]=i?i(d):d[S]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?sl:Km,this.isPropagationStopped=Km,this}return g(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=sl)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=sl)},persist:function(){},isPersistent:sl}),n}var _i={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rl=$t(_i),br=g({},_i,{view:0,detail:0}),S1=$t(br),Iu,Uu,vr,ol=g({},br,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==vr&&(vr&&e.type==="mousemove"?(Iu=e.screenX-vr.screenX,Uu=e.screenY-vr.screenY):Uu=Iu=0,vr=e),Iu)},movementY:function(e){return"movementY"in e?e.movementY:Uu}}),Pm=$t(ol),M1=g({},ol,{dataTransfer:0}),E1=$t(M1),x1=g({},br,{relatedTarget:0}),Ou=$t(x1),A1=g({},_i,{animationName:0,elapsedTime:0,pseudoElement:0}),w1=$t(A1),C1=g({},_i,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),T1=$t(C1),_1=g({},_i,{data:0}),Zm=$t(_1),N1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},R1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},k1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function L1(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=k1[e])?!!n[e]:!1}function zu(){return L1}var D1=g({},br,{key:function(e){if(e.key){var n=N1[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=il(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?R1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zu,charCode:function(e){return e.type==="keypress"?il(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?il(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),I1=$t(D1),U1=g({},ol,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Jm=$t(U1),O1=g({},br,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zu}),z1=$t(O1),B1=g({},_i,{propertyName:0,elapsedTime:0,pseudoElement:0}),q1=$t(B1),H1=g({},ol,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),j1=$t(H1),G1=g({},_i,{newState:0,oldState:0}),Y1=$t(G1),F1=[9,13,27,32],Bu=ma&&"CompositionEvent"in window,Sr=null;ma&&"documentMode"in document&&(Sr=document.documentMode);var V1=ma&&"TextEvent"in window&&!Sr,Wm=ma&&(!Bu||Sr&&8<Sr&&11>=Sr),ep=" ",tp=!1;function np(e,n){switch(e){case"keyup":return F1.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ap(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var gs=!1;function $1(e,n){switch(e){case"compositionend":return ap(n);case"keypress":return n.which!==32?null:(tp=!0,ep);case"textInput":return e=n.data,e===ep&&tp?null:e;default:return null}}function X1(e,n){if(gs)return e==="compositionend"||!Bu&&np(e,n)?(e=Qm(),al=Du=$a=null,gs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Wm&&n.locale!=="ko"?null:n.data;default:return null}}var Q1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ip(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!Q1[e.type]:n==="textarea"}function sp(e,n,i,o){ms?ps?ps.push(o):ps=[o]:ms=o,n=Xl(n,"onChange"),0<n.length&&(i=new rl("onChange","change",null,i,o),e.push({event:i,listeners:n}))}var Mr=null,Er=null;function K1(e){qg(e,0)}function ll(e){var n=da(e);if(Wt(n))return e}function rp(e,n){if(e==="change")return n}var op=!1;if(ma){var qu;if(ma){var Hu="oninput"in document;if(!Hu){var lp=document.createElement("div");lp.setAttribute("oninput","return;"),Hu=typeof lp.oninput=="function"}qu=Hu}else qu=!1;op=qu&&(!document.documentMode||9<document.documentMode)}function cp(){Mr&&(Mr.detachEvent("onpropertychange",up),Er=Mr=null)}function up(e){if(e.propertyName==="value"&&ll(Er)){var n=[];sp(n,Er,e,Ru(e)),Xm(K1,n)}}function P1(e,n,i){e==="focusin"?(cp(),Mr=n,Er=i,Mr.attachEvent("onpropertychange",up)):e==="focusout"&&cp()}function Z1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ll(Er)}function J1(e,n){if(e==="click")return ll(n)}function W1(e,n){if(e==="input"||e==="change")return ll(n)}function eS(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var tn=typeof Object.is=="function"?Object.is:eS;function xr(e,n){if(tn(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var i=Object.keys(e),o=Object.keys(n);if(i.length!==o.length)return!1;for(o=0;o<i.length;o++){var c=i[o];if(!On.call(n,c)||!tn(e[c],n[c]))return!1}return!0}function dp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function fp(e,n){var i=dp(e);e=0;for(var o;i;){if(i.nodeType===3){if(o=e+i.textContent.length,e<=n&&o>=n)return{node:i,offset:n-e};e=o}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=dp(i)}}function hp(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?hp(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function mp(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=en(e.document);n instanceof e.HTMLIFrameElement;){try{var i=typeof n.contentWindow.location.href=="string"}catch{i=!1}if(i)e=n.contentWindow;else break;n=en(e.document)}return n}function ju(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var tS=ma&&"documentMode"in document&&11>=document.documentMode,ys=null,Gu=null,Ar=null,Yu=!1;function pp(e,n,i){var o=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Yu||ys==null||ys!==en(o)||(o=ys,"selectionStart"in o&&ju(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Ar&&xr(Ar,o)||(Ar=o,o=Xl(Gu,"onSelect"),0<o.length&&(n=new rl("onSelect","select",null,n,i),e.push({event:n,listeners:o}),n.target=ys)))}function Ni(e,n){var i={};return i[e.toLowerCase()]=n.toLowerCase(),i["Webkit"+e]="webkit"+n,i["Moz"+e]="moz"+n,i}var bs={animationend:Ni("Animation","AnimationEnd"),animationiteration:Ni("Animation","AnimationIteration"),animationstart:Ni("Animation","AnimationStart"),transitionrun:Ni("Transition","TransitionRun"),transitionstart:Ni("Transition","TransitionStart"),transitioncancel:Ni("Transition","TransitionCancel"),transitionend:Ni("Transition","TransitionEnd")},Fu={},gp={};ma&&(gp=document.createElement("div").style,"AnimationEvent"in window||(delete bs.animationend.animation,delete bs.animationiteration.animation,delete bs.animationstart.animation),"TransitionEvent"in window||delete bs.transitionend.transition);function Ri(e){if(Fu[e])return Fu[e];if(!bs[e])return e;var n=bs[e],i;for(i in n)if(n.hasOwnProperty(i)&&i in gp)return Fu[e]=n[i];return e}var yp=Ri("animationend"),bp=Ri("animationiteration"),vp=Ri("animationstart"),nS=Ri("transitionrun"),aS=Ri("transitionstart"),iS=Ri("transitioncancel"),Sp=Ri("transitionend"),Mp=new Map,Vu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Vu.push("scrollEnd");function Tn(e,n){Mp.set(e,n),jn(n,[e])}var Ep=new WeakMap;function hn(e,n){if(typeof e=="object"&&e!==null){var i=Ep.get(e);return i!==void 0?i:(n={value:e,source:n,stack:Ye(n)},Ep.set(e,n),n)}return{value:e,source:n,stack:Ye(n)}}var mn=[],vs=0,$u=0;function cl(){for(var e=vs,n=$u=vs=0;n<e;){var i=mn[n];mn[n++]=null;var o=mn[n];mn[n++]=null;var c=mn[n];mn[n++]=null;var d=mn[n];if(mn[n++]=null,o!==null&&c!==null){var y=o.pending;y===null?c.next=c:(c.next=y.next,y.next=c),o.pending=c}d!==0&&xp(i,c,d)}}function ul(e,n,i,o){mn[vs++]=e,mn[vs++]=n,mn[vs++]=i,mn[vs++]=o,$u|=o,e.lanes|=o,e=e.alternate,e!==null&&(e.lanes|=o)}function Xu(e,n,i,o){return ul(e,n,i,o),dl(e)}function Ss(e,n){return ul(e,null,null,n),dl(e)}function xp(e,n,i){e.lanes|=i;var o=e.alternate;o!==null&&(o.lanes|=i);for(var c=!1,d=e.return;d!==null;)d.childLanes|=i,o=d.alternate,o!==null&&(o.childLanes|=i),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(c=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,c&&n!==null&&(c=31-Nt(i),e=d.hiddenUpdates,o=e[c],o===null?e[c]=[n]:o.push(n),n.lane=i|536870912),d):null}function dl(e){if(50<Kr)throw Kr=0,Wd=null,Error(r(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Ms={};function sS(e,n,i,o){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nn(e,n,i,o){return new sS(e,n,i,o)}function Qu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function pa(e,n){var i=e.alternate;return i===null?(i=nn(e.tag,n,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=n,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,n=e.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function Ap(e,n){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,n=i.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function fl(e,n,i,o,c,d){var y=0;if(o=e,typeof e=="function")Qu(e)&&(y=1);else if(typeof e=="string")y=oM(e,i,se.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case Y:return e=nn(31,i,n,c),e.elementType=Y,e.lanes=d,e;case x:return ki(i.children,c,d,n);case T:y=8,c|=24;break;case _:return e=nn(12,i,n,c|2),e.elementType=_,e.lanes=d,e;case X:return e=nn(13,i,n,c),e.elementType=X,e.lanes=d,e;case $:return e=nn(19,i,n,c),e.elementType=$,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case R:case j:y=10;break e;case I:y=9;break e;case V:y=11;break e;case ee:y=14;break e;case te:y=16,o=null;break e}y=29,i=Error(r(130,e===null?"null":typeof e,"")),o=null}return n=nn(y,i,n,c),n.elementType=e,n.type=o,n.lanes=d,n}function ki(e,n,i,o){return e=nn(7,e,o,n),e.lanes=i,e}function Ku(e,n,i){return e=nn(6,e,null,n),e.lanes=i,e}function Pu(e,n,i){return n=nn(4,e.children!==null?e.children:[],e.key,n),n.lanes=i,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var Es=[],xs=0,hl=null,ml=0,pn=[],gn=0,Li=null,ga=1,ya="";function Di(e,n){Es[xs++]=ml,Es[xs++]=hl,hl=e,ml=n}function wp(e,n,i){pn[gn++]=ga,pn[gn++]=ya,pn[gn++]=Li,Li=e;var o=ga;e=ya;var c=32-Nt(o)-1;o&=~(1<<c),i+=1;var d=32-Nt(n)+c;if(30<d){var y=c-c%5;d=(o&(1<<y)-1).toString(32),o>>=y,c-=y,ga=1<<32-Nt(n)+c|i<<c|o,ya=d+e}else ga=1<<d|i<<c|o,ya=e}function Zu(e){e.return!==null&&(Di(e,1),wp(e,1,0))}function Ju(e){for(;e===hl;)hl=Es[--xs],Es[xs]=null,ml=Es[--xs],Es[xs]=null;for(;e===Li;)Li=pn[--gn],pn[gn]=null,ya=pn[--gn],pn[gn]=null,ga=pn[--gn],pn[gn]=null}var Ot=null,it=null,Le=!1,Ii=null,Yn=!1,Wu=Error(r(519));function Ui(e){var n=Error(r(418,""));throw Tr(hn(n,e)),Wu}function Cp(e){var n=e.stateNode,i=e.type,o=e.memoizedProps;switch(n[et]=e,n[ft]=o,i){case"dialog":Ce("cancel",n),Ce("close",n);break;case"iframe":case"object":case"embed":Ce("load",n);break;case"video":case"audio":for(i=0;i<Zr.length;i++)Ce(Zr[i],n);break;case"source":Ce("error",n);break;case"img":case"image":case"link":Ce("error",n),Ce("load",n);break;case"details":Ce("toggle",n);break;case"input":Ce("invalid",n),Fa(n,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0),St(n);break;case"select":Ce("invalid",n);break;case"textarea":Ce("invalid",n),tl(n,o.value,o.defaultValue,o.children),St(n)}i=o.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||n.textContent===""+i||o.suppressHydrationWarning===!0||Yg(n.textContent,i)?(o.popover!=null&&(Ce("beforetoggle",n),Ce("toggle",n)),o.onScroll!=null&&Ce("scroll",n),o.onScrollEnd!=null&&Ce("scrollend",n),o.onClick!=null&&(n.onclick=Ql),n=!0):n=!1,n||Ui(e)}function Tp(e){for(Ot=e.return;Ot;)switch(Ot.tag){case 5:case 13:Yn=!1;return;case 27:case 3:Yn=!0;return;default:Ot=Ot.return}}function wr(e){if(e!==Ot)return!1;if(!Le)return Tp(e),Le=!0,!1;var n=e.tag,i;if((i=n!==3&&n!==27)&&((i=n===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||gf(e.type,e.memoizedProps)),i=!i),i&&it&&Ui(e),Tp(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8)if(i=e.data,i==="/$"){if(n===0){it=Nn(e.nextSibling);break e}n--}else i!=="$"&&i!=="$!"&&i!=="$?"||n++;e=e.nextSibling}it=null}}else n===27?(n=it,li(e.type)?(e=Sf,Sf=null,it=e):it=n):it=Ot?Nn(e.stateNode.nextSibling):null;return!0}function Cr(){it=Ot=null,Le=!1}function _p(){var e=Ii;return e!==null&&(Kt===null?Kt=e:Kt.push.apply(Kt,e),Ii=null),e}function Tr(e){Ii===null?Ii=[e]:Ii.push(e)}var ed=A(null),Oi=null,ba=null;function Xa(e,n,i){Q(ed,n._currentValue),n._currentValue=i}function va(e){e._currentValue=ed.current,z(ed)}function td(e,n,i){for(;e!==null;){var o=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,o!==null&&(o.childLanes|=n)):o!==null&&(o.childLanes&n)!==n&&(o.childLanes|=n),e===i)break;e=e.return}}function nd(e,n,i,o){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var d=c.dependencies;if(d!==null){var y=c.child;d=d.firstContext;e:for(;d!==null;){var S=d;d=c;for(var w=0;w<n.length;w++)if(S.context===n[w]){d.lanes|=i,S=d.alternate,S!==null&&(S.lanes|=i),td(d.return,i,e),o||(y=null);break e}d=S.next}}else if(c.tag===18){if(y=c.return,y===null)throw Error(r(341));y.lanes|=i,d=y.alternate,d!==null&&(d.lanes|=i),td(y,i,e),y=null}else y=c.child;if(y!==null)y.return=c;else for(y=c;y!==null;){if(y===e){y=null;break}if(c=y.sibling,c!==null){c.return=y.return,y=c;break}y=y.return}c=y}}function _r(e,n,i,o){e=null;for(var c=n,d=!1;c!==null;){if(!d){if((c.flags&524288)!==0)d=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var y=c.alternate;if(y===null)throw Error(r(387));if(y=y.memoizedProps,y!==null){var S=c.type;tn(c.pendingProps.value,y.value)||(e!==null?e.push(S):e=[S])}}else if(c===ge.current){if(y=c.alternate,y===null)throw Error(r(387));y.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(ao):e=[ao])}c=c.return}e!==null&&nd(n,e,i,o),n.flags|=262144}function pl(e){for(e=e.firstContext;e!==null;){if(!tn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function zi(e){Oi=e,ba=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Rt(e){return Np(Oi,e)}function gl(e,n){return Oi===null&&zi(e),Np(e,n)}function Np(e,n){var i=n._currentValue;if(n={context:n,memoizedValue:i,next:null},ba===null){if(e===null)throw Error(r(308));ba=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else ba=ba.next=n;return i}var rS=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(i,o){e.push(o)}};this.abort=function(){n.aborted=!0,e.forEach(function(i){return i()})}},oS=t.unstable_scheduleCallback,lS=t.unstable_NormalPriority,mt={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ad(){return{controller:new rS,data:new Map,refCount:0}}function Nr(e){e.refCount--,e.refCount===0&&oS(lS,function(){e.controller.abort()})}var Rr=null,id=0,As=0,ws=null;function cS(e,n){if(Rr===null){var i=Rr=[];id=0,As=of(),ws={status:"pending",value:void 0,then:function(o){i.push(o)}}}return id++,n.then(Rp,Rp),n}function Rp(){if(--id===0&&Rr!==null){ws!==null&&(ws.status="fulfilled");var e=Rr;Rr=null,As=0,ws=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function uS(e,n){var i=[],o={status:"pending",value:null,reason:null,then:function(c){i.push(c)}};return e.then(function(){o.status="fulfilled",o.value=n;for(var c=0;c<i.length;c++)(0,i[c])(n)},function(c){for(o.status="rejected",o.reason=c,c=0;c<i.length;c++)(0,i[c])(void 0)}),o}var kp=D.S;D.S=function(e,n){typeof n=="object"&&n!==null&&typeof n.then=="function"&&cS(e,n),kp!==null&&kp(e,n)};var Bi=A(null);function sd(){var e=Bi.current;return e!==null?e:Ve.pooledCache}function yl(e,n){n===null?Q(Bi,Bi.current):Q(Bi,n.pool)}function Lp(){var e=sd();return e===null?null:{parent:mt._currentValue,pool:e}}var kr=Error(r(460)),Dp=Error(r(474)),bl=Error(r(542)),rd={then:function(){}};function Ip(e){return e=e.status,e==="fulfilled"||e==="rejected"}function vl(){}function Up(e,n,i){switch(i=e[i],i===void 0?e.push(n):i!==n&&(n.then(vl,vl),n=i),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,zp(e),e;default:if(typeof n.status=="string")n.then(vl,vl);else{if(e=Ve,e!==null&&100<e.shellSuspendCounter)throw Error(r(482));e=n,e.status="pending",e.then(function(o){if(n.status==="pending"){var c=n;c.status="fulfilled",c.value=o}},function(o){if(n.status==="pending"){var c=n;c.status="rejected",c.reason=o}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,zp(e),e}throw Lr=n,kr}}var Lr=null;function Op(){if(Lr===null)throw Error(r(459));var e=Lr;return Lr=null,e}function zp(e){if(e===kr||e===bl)throw Error(r(483))}var Qa=!1;function od(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ld(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ka(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Pa(e,n,i){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,(De&2)!==0){var c=o.pending;return c===null?n.next=n:(n.next=c.next,c.next=n),o.pending=n,n=dl(e),xp(e,null,i),n}return ul(e,o,n,i),dl(e)}function Dr(e,n,i){if(n=n.updateQueue,n!==null&&(n=n.shared,(i&4194048)!==0)){var o=n.lanes;o&=e.pendingLanes,i|=o,n.lanes=i,hr(e,i)}}function cd(e,n){var i=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,i===o)){var c=null,d=null;if(i=i.firstBaseUpdate,i!==null){do{var y={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};d===null?c=d=y:d=d.next=y,i=i.next}while(i!==null);d===null?c=d=n:d=d.next=n}else c=d=n;i={baseState:o.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:o.shared,callbacks:o.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=n:e.next=n,i.lastBaseUpdate=n}var ud=!1;function Ir(){if(ud){var e=ws;if(e!==null)throw e}}function Ur(e,n,i,o){ud=!1;var c=e.updateQueue;Qa=!1;var d=c.firstBaseUpdate,y=c.lastBaseUpdate,S=c.shared.pending;if(S!==null){c.shared.pending=null;var w=S,O=w.next;w.next=null,y===null?d=O:y.next=O,y=w;var Z=e.alternate;Z!==null&&(Z=Z.updateQueue,S=Z.lastBaseUpdate,S!==y&&(S===null?Z.firstBaseUpdate=O:S.next=O,Z.lastBaseUpdate=w))}if(d!==null){var ie=c.baseState;y=0,Z=O=w=null,S=d;do{var H=S.lane&-536870913,G=H!==S.lane;if(G?(Re&H)===H:(o&H)===H){H!==0&&H===As&&(ud=!0),Z!==null&&(Z=Z.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var ve=e,ye=S;H=n;var He=i;switch(ye.tag){case 1:if(ve=ye.payload,typeof ve=="function"){ie=ve.call(He,ie,H);break e}ie=ve;break e;case 3:ve.flags=ve.flags&-65537|128;case 0:if(ve=ye.payload,H=typeof ve=="function"?ve.call(He,ie,H):ve,H==null)break e;ie=g({},ie,H);break e;case 2:Qa=!0}}H=S.callback,H!==null&&(e.flags|=64,G&&(e.flags|=8192),G=c.callbacks,G===null?c.callbacks=[H]:G.push(H))}else G={lane:H,tag:S.tag,payload:S.payload,callback:S.callback,next:null},Z===null?(O=Z=G,w=ie):Z=Z.next=G,y|=H;if(S=S.next,S===null){if(S=c.shared.pending,S===null)break;G=S,S=G.next,G.next=null,c.lastBaseUpdate=G,c.shared.pending=null}}while(!0);Z===null&&(w=ie),c.baseState=w,c.firstBaseUpdate=O,c.lastBaseUpdate=Z,d===null&&(c.shared.lanes=0),ii|=y,e.lanes=y,e.memoizedState=ie}}function Bp(e,n){if(typeof e!="function")throw Error(r(191,e));e.call(n)}function qp(e,n){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)Bp(i[e],n)}var Cs=A(null),Sl=A(0);function Hp(e,n){e=Ca,Q(Sl,e),Q(Cs,n),Ca=e|n.baseLanes}function dd(){Q(Sl,Ca),Q(Cs,Cs.current)}function fd(){Ca=Sl.current,z(Cs),z(Sl)}var Za=0,Ee=null,Be=null,ut=null,Ml=!1,Ts=!1,qi=!1,El=0,Or=0,_s=null,dS=0;function ot(){throw Error(r(321))}function hd(e,n){if(n===null)return!1;for(var i=0;i<n.length&&i<e.length;i++)if(!tn(e[i],n[i]))return!1;return!0}function md(e,n,i,o,c,d){return Za=d,Ee=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,D.H=e===null||e.memoizedState===null?x0:A0,qi=!1,d=i(o,c),qi=!1,Ts&&(d=Gp(n,i,o,c)),jp(e),d}function jp(e){D.H=_l;var n=Be!==null&&Be.next!==null;if(Za=0,ut=Be=Ee=null,Ml=!1,Or=0,_s=null,n)throw Error(r(300));e===null||Mt||(e=e.dependencies,e!==null&&pl(e)&&(Mt=!0))}function Gp(e,n,i,o){Ee=e;var c=0;do{if(Ts&&(_s=null),Or=0,Ts=!1,25<=c)throw Error(r(301));if(c+=1,ut=Be=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}D.H=bS,d=n(i,o)}while(Ts);return d}function fS(){var e=D.H,n=e.useState()[0];return n=typeof n.then=="function"?zr(n):n,e=e.useState()[0],(Be!==null?Be.memoizedState:null)!==e&&(Ee.flags|=1024),n}function pd(){var e=El!==0;return El=0,e}function gd(e,n,i){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~i}function yd(e){if(Ml){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}Ml=!1}Za=0,ut=Be=Ee=null,Ts=!1,Or=El=0,_s=null}function Xt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ut===null?Ee.memoizedState=ut=e:ut=ut.next=e,ut}function dt(){if(Be===null){var e=Ee.alternate;e=e!==null?e.memoizedState:null}else e=Be.next;var n=ut===null?Ee.memoizedState:ut.next;if(n!==null)ut=n,Be=e;else{if(e===null)throw Ee.alternate===null?Error(r(467)):Error(r(310));Be=e,e={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},ut===null?Ee.memoizedState=ut=e:ut=ut.next=e}return ut}function bd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function zr(e){var n=Or;return Or+=1,_s===null&&(_s=[]),e=Up(_s,e,n),n=Ee,(ut===null?n.memoizedState:ut.next)===null&&(n=n.alternate,D.H=n===null||n.memoizedState===null?x0:A0),e}function xl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return zr(e);if(e.$$typeof===j)return Rt(e)}throw Error(r(438,String(e)))}function vd(e){var n=null,i=Ee.updateQueue;if(i!==null&&(n=i.memoCache),n==null){var o=Ee.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(n={data:o.data.map(function(c){return c.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),i===null&&(i=bd(),Ee.updateQueue=i),i.memoCache=n,i=n.data[n.index],i===void 0)for(i=n.data[n.index]=Array(e),o=0;o<e;o++)i[o]=B;return n.index++,i}function Sa(e,n){return typeof n=="function"?n(e):n}function Al(e){var n=dt();return Sd(n,Be,e)}function Sd(e,n,i){var o=e.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=i;var c=e.baseQueue,d=o.pending;if(d!==null){if(c!==null){var y=c.next;c.next=d.next,d.next=y}n.baseQueue=c=d,o.pending=null}if(d=e.baseState,c===null)e.memoizedState=d;else{n=c.next;var S=y=null,w=null,O=n,Z=!1;do{var ie=O.lane&-536870913;if(ie!==O.lane?(Re&ie)===ie:(Za&ie)===ie){var H=O.revertLane;if(H===0)w!==null&&(w=w.next={lane:0,revertLane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),ie===As&&(Z=!0);else if((Za&H)===H){O=O.next,H===As&&(Z=!0);continue}else ie={lane:0,revertLane:O.revertLane,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null},w===null?(S=w=ie,y=d):w=w.next=ie,Ee.lanes|=H,ii|=H;ie=O.action,qi&&i(d,ie),d=O.hasEagerState?O.eagerState:i(d,ie)}else H={lane:ie,revertLane:O.revertLane,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null},w===null?(S=w=H,y=d):w=w.next=H,Ee.lanes|=ie,ii|=ie;O=O.next}while(O!==null&&O!==n);if(w===null?y=d:w.next=S,!tn(d,e.memoizedState)&&(Mt=!0,Z&&(i=ws,i!==null)))throw i;e.memoizedState=d,e.baseState=y,e.baseQueue=w,o.lastRenderedState=d}return c===null&&(o.lanes=0),[e.memoizedState,o.dispatch]}function Md(e){var n=dt(),i=n.queue;if(i===null)throw Error(r(311));i.lastRenderedReducer=e;var o=i.dispatch,c=i.pending,d=n.memoizedState;if(c!==null){i.pending=null;var y=c=c.next;do d=e(d,y.action),y=y.next;while(y!==c);tn(d,n.memoizedState)||(Mt=!0),n.memoizedState=d,n.baseQueue===null&&(n.baseState=d),i.lastRenderedState=d}return[d,o]}function Yp(e,n,i){var o=Ee,c=dt(),d=Le;if(d){if(i===void 0)throw Error(r(407));i=i()}else i=n();var y=!tn((Be||c).memoizedState,i);y&&(c.memoizedState=i,Mt=!0),c=c.queue;var S=$p.bind(null,o,c,e);if(Br(2048,8,S,[e]),c.getSnapshot!==n||y||ut!==null&&ut.memoizedState.tag&1){if(o.flags|=2048,Ns(9,wl(),Vp.bind(null,o,c,i,n),null),Ve===null)throw Error(r(349));d||(Za&124)!==0||Fp(o,n,i)}return i}function Fp(e,n,i){e.flags|=16384,e={getSnapshot:n,value:i},n=Ee.updateQueue,n===null?(n=bd(),Ee.updateQueue=n,n.stores=[e]):(i=n.stores,i===null?n.stores=[e]:i.push(e))}function Vp(e,n,i,o){n.value=i,n.getSnapshot=o,Xp(n)&&Qp(e)}function $p(e,n,i){return i(function(){Xp(n)&&Qp(e)})}function Xp(e){var n=e.getSnapshot;e=e.value;try{var i=n();return!tn(e,i)}catch{return!0}}function Qp(e){var n=Ss(e,2);n!==null&&ln(n,e,2)}function Ed(e){var n=Xt();if(typeof e=="function"){var i=e;if(e=i(),qi){Vt(!0);try{i()}finally{Vt(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sa,lastRenderedState:e},n}function Kp(e,n,i,o){return e.baseState=i,Sd(e,Be,typeof o=="function"?o:Sa)}function hS(e,n,i,o,c){if(Tl(e))throw Error(r(485));if(e=n.action,e!==null){var d={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){d.listeners.push(y)}};D.T!==null?i(!0):d.isTransition=!1,o(d),i=n.pending,i===null?(d.next=n.pending=d,Pp(n,d)):(d.next=i.next,n.pending=i.next=d)}}function Pp(e,n){var i=n.action,o=n.payload,c=e.state;if(n.isTransition){var d=D.T,y={};D.T=y;try{var S=i(c,o),w=D.S;w!==null&&w(y,S),Zp(e,n,S)}catch(O){xd(e,n,O)}finally{D.T=d}}else try{d=i(c,o),Zp(e,n,d)}catch(O){xd(e,n,O)}}function Zp(e,n,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(o){Jp(e,n,o)},function(o){return xd(e,n,o)}):Jp(e,n,i)}function Jp(e,n,i){n.status="fulfilled",n.value=i,Wp(n),e.state=i,n=e.pending,n!==null&&(i=n.next,i===n?e.pending=null:(i=i.next,n.next=i,Pp(e,i)))}function xd(e,n,i){var o=e.pending;if(e.pending=null,o!==null){o=o.next;do n.status="rejected",n.reason=i,Wp(n),n=n.next;while(n!==o)}e.action=null}function Wp(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function e0(e,n){return n}function t0(e,n){if(Le){var i=Ve.formState;if(i!==null){e:{var o=Ee;if(Le){if(it){t:{for(var c=it,d=Yn;c.nodeType!==8;){if(!d){c=null;break t}if(c=Nn(c.nextSibling),c===null){c=null;break t}}d=c.data,c=d==="F!"||d==="F"?c:null}if(c){it=Nn(c.nextSibling),o=c.data==="F!";break e}}Ui(o)}o=!1}o&&(n=i[0])}}return i=Xt(),i.memoizedState=i.baseState=n,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e0,lastRenderedState:n},i.queue=o,i=S0.bind(null,Ee,o),o.dispatch=i,o=Ed(!1),d=_d.bind(null,Ee,!1,o.queue),o=Xt(),c={state:n,dispatch:null,action:e,pending:null},o.queue=c,i=hS.bind(null,Ee,c,d,i),c.dispatch=i,o.memoizedState=e,[n,i,!1]}function n0(e){var n=dt();return a0(n,Be,e)}function a0(e,n,i){if(n=Sd(e,n,e0)[0],e=Al(Sa)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var o=zr(n)}catch(y){throw y===kr?bl:y}else o=n;n=dt();var c=n.queue,d=c.dispatch;return i!==n.memoizedState&&(Ee.flags|=2048,Ns(9,wl(),mS.bind(null,c,i),null)),[o,d,e]}function mS(e,n){e.action=n}function i0(e){var n=dt(),i=Be;if(i!==null)return a0(n,i,e);dt(),n=n.memoizedState,i=dt();var o=i.queue.dispatch;return i.memoizedState=e,[n,o,!1]}function Ns(e,n,i,o){return e={tag:e,create:i,deps:o,inst:n,next:null},n=Ee.updateQueue,n===null&&(n=bd(),Ee.updateQueue=n),i=n.lastEffect,i===null?n.lastEffect=e.next=e:(o=i.next,i.next=e,e.next=o,n.lastEffect=e),e}function wl(){return{destroy:void 0,resource:void 0}}function s0(){return dt().memoizedState}function Cl(e,n,i,o){var c=Xt();o=o===void 0?null:o,Ee.flags|=e,c.memoizedState=Ns(1|n,wl(),i,o)}function Br(e,n,i,o){var c=dt();o=o===void 0?null:o;var d=c.memoizedState.inst;Be!==null&&o!==null&&hd(o,Be.memoizedState.deps)?c.memoizedState=Ns(n,d,i,o):(Ee.flags|=e,c.memoizedState=Ns(1|n,d,i,o))}function r0(e,n){Cl(8390656,8,e,n)}function o0(e,n){Br(2048,8,e,n)}function l0(e,n){return Br(4,2,e,n)}function c0(e,n){return Br(4,4,e,n)}function u0(e,n){if(typeof n=="function"){e=e();var i=n(e);return function(){typeof i=="function"?i():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function d0(e,n,i){i=i!=null?i.concat([e]):null,Br(4,4,u0.bind(null,n,e),i)}function Ad(){}function f0(e,n){var i=dt();n=n===void 0?null:n;var o=i.memoizedState;return n!==null&&hd(n,o[1])?o[0]:(i.memoizedState=[e,n],e)}function h0(e,n){var i=dt();n=n===void 0?null:n;var o=i.memoizedState;if(n!==null&&hd(n,o[1]))return o[0];if(o=e(),qi){Vt(!0);try{e()}finally{Vt(!1)}}return i.memoizedState=[o,n],o}function wd(e,n,i){return i===void 0||(Za&1073741824)!==0?e.memoizedState=n:(e.memoizedState=i,e=gg(),Ee.lanes|=e,ii|=e,i)}function m0(e,n,i,o){return tn(i,n)?i:Cs.current!==null?(e=wd(e,i,o),tn(e,n)||(Mt=!0),e):(Za&42)===0?(Mt=!0,e.memoizedState=i):(e=gg(),Ee.lanes|=e,ii|=e,n)}function p0(e,n,i,o,c){var d=P.p;P.p=d!==0&&8>d?d:8;var y=D.T,S={};D.T=S,_d(e,!1,n,i);try{var w=c(),O=D.S;if(O!==null&&O(S,w),w!==null&&typeof w=="object"&&typeof w.then=="function"){var Z=uS(w,o);qr(e,n,Z,on(e))}else qr(e,n,o,on(e))}catch(ie){qr(e,n,{then:function(){},status:"rejected",reason:ie},on())}finally{P.p=d,D.T=y}}function pS(){}function Cd(e,n,i,o){if(e.tag!==5)throw Error(r(476));var c=g0(e).queue;p0(e,c,n,le,i===null?pS:function(){return y0(e),i(o)})}function g0(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:le,baseState:le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sa,lastRenderedState:le},next:null};var i={};return n.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sa,lastRenderedState:i},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function y0(e){var n=g0(e).next.queue;qr(e,n,{},on())}function Td(){return Rt(ao)}function b0(){return dt().memoizedState}function v0(){return dt().memoizedState}function gS(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var i=on();e=Ka(i);var o=Pa(n,e,i);o!==null&&(ln(o,n,i),Dr(o,n,i)),n={cache:ad()},e.payload=n;return}n=n.return}}function yS(e,n,i){var o=on();i={lane:o,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},Tl(e)?M0(n,i):(i=Xu(e,n,i,o),i!==null&&(ln(i,e,o),E0(i,n,o)))}function S0(e,n,i){var o=on();qr(e,n,i,o)}function qr(e,n,i,o){var c={lane:o,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(Tl(e))M0(n,c);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=n.lastRenderedReducer,d!==null))try{var y=n.lastRenderedState,S=d(y,i);if(c.hasEagerState=!0,c.eagerState=S,tn(S,y))return ul(e,n,c,0),Ve===null&&cl(),!1}catch{}finally{}if(i=Xu(e,n,c,o),i!==null)return ln(i,e,o),E0(i,n,o),!0}return!1}function _d(e,n,i,o){if(o={lane:2,revertLane:of(),action:o,hasEagerState:!1,eagerState:null,next:null},Tl(e)){if(n)throw Error(r(479))}else n=Xu(e,i,o,2),n!==null&&ln(n,e,2)}function Tl(e){var n=e.alternate;return e===Ee||n!==null&&n===Ee}function M0(e,n){Ts=Ml=!0;var i=e.pending;i===null?n.next=n:(n.next=i.next,i.next=n),e.pending=n}function E0(e,n,i){if((i&4194048)!==0){var o=n.lanes;o&=e.pendingLanes,i|=o,n.lanes=i,hr(e,i)}}var _l={readContext:Rt,use:xl,useCallback:ot,useContext:ot,useEffect:ot,useImperativeHandle:ot,useLayoutEffect:ot,useInsertionEffect:ot,useMemo:ot,useReducer:ot,useRef:ot,useState:ot,useDebugValue:ot,useDeferredValue:ot,useTransition:ot,useSyncExternalStore:ot,useId:ot,useHostTransitionStatus:ot,useFormState:ot,useActionState:ot,useOptimistic:ot,useMemoCache:ot,useCacheRefresh:ot},x0={readContext:Rt,use:xl,useCallback:function(e,n){return Xt().memoizedState=[e,n===void 0?null:n],e},useContext:Rt,useEffect:r0,useImperativeHandle:function(e,n,i){i=i!=null?i.concat([e]):null,Cl(4194308,4,u0.bind(null,n,e),i)},useLayoutEffect:function(e,n){return Cl(4194308,4,e,n)},useInsertionEffect:function(e,n){Cl(4,2,e,n)},useMemo:function(e,n){var i=Xt();n=n===void 0?null:n;var o=e();if(qi){Vt(!0);try{e()}finally{Vt(!1)}}return i.memoizedState=[o,n],o},useReducer:function(e,n,i){var o=Xt();if(i!==void 0){var c=i(n);if(qi){Vt(!0);try{i(n)}finally{Vt(!1)}}}else c=n;return o.memoizedState=o.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},o.queue=e,e=e.dispatch=yS.bind(null,Ee,e),[o.memoizedState,e]},useRef:function(e){var n=Xt();return e={current:e},n.memoizedState=e},useState:function(e){e=Ed(e);var n=e.queue,i=S0.bind(null,Ee,n);return n.dispatch=i,[e.memoizedState,i]},useDebugValue:Ad,useDeferredValue:function(e,n){var i=Xt();return wd(i,e,n)},useTransition:function(){var e=Ed(!1);return e=p0.bind(null,Ee,e.queue,!0,!1),Xt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,i){var o=Ee,c=Xt();if(Le){if(i===void 0)throw Error(r(407));i=i()}else{if(i=n(),Ve===null)throw Error(r(349));(Re&124)!==0||Fp(o,n,i)}c.memoizedState=i;var d={value:i,getSnapshot:n};return c.queue=d,r0($p.bind(null,o,d,e),[e]),o.flags|=2048,Ns(9,wl(),Vp.bind(null,o,d,i,n),null),i},useId:function(){var e=Xt(),n=Ve.identifierPrefix;if(Le){var i=ya,o=ga;i=(o&~(1<<32-Nt(o)-1)).toString(32)+i,n="«"+n+"R"+i,i=El++,0<i&&(n+="H"+i.toString(32)),n+="»"}else i=dS++,n="«"+n+"r"+i.toString(32)+"»";return e.memoizedState=n},useHostTransitionStatus:Td,useFormState:t0,useActionState:t0,useOptimistic:function(e){var n=Xt();n.memoizedState=n.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=i,n=_d.bind(null,Ee,!0,i),i.dispatch=n,[e,n]},useMemoCache:vd,useCacheRefresh:function(){return Xt().memoizedState=gS.bind(null,Ee)}},A0={readContext:Rt,use:xl,useCallback:f0,useContext:Rt,useEffect:o0,useImperativeHandle:d0,useInsertionEffect:l0,useLayoutEffect:c0,useMemo:h0,useReducer:Al,useRef:s0,useState:function(){return Al(Sa)},useDebugValue:Ad,useDeferredValue:function(e,n){var i=dt();return m0(i,Be.memoizedState,e,n)},useTransition:function(){var e=Al(Sa)[0],n=dt().memoizedState;return[typeof e=="boolean"?e:zr(e),n]},useSyncExternalStore:Yp,useId:b0,useHostTransitionStatus:Td,useFormState:n0,useActionState:n0,useOptimistic:function(e,n){var i=dt();return Kp(i,Be,e,n)},useMemoCache:vd,useCacheRefresh:v0},bS={readContext:Rt,use:xl,useCallback:f0,useContext:Rt,useEffect:o0,useImperativeHandle:d0,useInsertionEffect:l0,useLayoutEffect:c0,useMemo:h0,useReducer:Md,useRef:s0,useState:function(){return Md(Sa)},useDebugValue:Ad,useDeferredValue:function(e,n){var i=dt();return Be===null?wd(i,e,n):m0(i,Be.memoizedState,e,n)},useTransition:function(){var e=Md(Sa)[0],n=dt().memoizedState;return[typeof e=="boolean"?e:zr(e),n]},useSyncExternalStore:Yp,useId:b0,useHostTransitionStatus:Td,useFormState:i0,useActionState:i0,useOptimistic:function(e,n){var i=dt();return Be!==null?Kp(i,Be,e,n):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:vd,useCacheRefresh:v0},Rs=null,Hr=0;function Nl(e){var n=Hr;return Hr+=1,Rs===null&&(Rs=[]),Up(Rs,e,n)}function jr(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function Rl(e,n){throw n.$$typeof===b?Error(r(525)):(e=Object.prototype.toString.call(n),Error(r(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function w0(e){var n=e._init;return n(e._payload)}function C0(e){function n(L,N){if(e){var U=L.deletions;U===null?(L.deletions=[N],L.flags|=16):U.push(N)}}function i(L,N){if(!e)return null;for(;N!==null;)n(L,N),N=N.sibling;return null}function o(L){for(var N=new Map;L!==null;)L.key!==null?N.set(L.key,L):N.set(L.index,L),L=L.sibling;return N}function c(L,N){return L=pa(L,N),L.index=0,L.sibling=null,L}function d(L,N,U){return L.index=U,e?(U=L.alternate,U!==null?(U=U.index,U<N?(L.flags|=67108866,N):U):(L.flags|=67108866,N)):(L.flags|=1048576,N)}function y(L){return e&&L.alternate===null&&(L.flags|=67108866),L}function S(L,N,U,W){return N===null||N.tag!==6?(N=Ku(U,L.mode,W),N.return=L,N):(N=c(N,U),N.return=L,N)}function w(L,N,U,W){var he=U.type;return he===x?Z(L,N,U.props.children,W,U.key):N!==null&&(N.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===te&&w0(he)===N.type)?(N=c(N,U.props),jr(N,U),N.return=L,N):(N=fl(U.type,U.key,U.props,null,L.mode,W),jr(N,U),N.return=L,N)}function O(L,N,U,W){return N===null||N.tag!==4||N.stateNode.containerInfo!==U.containerInfo||N.stateNode.implementation!==U.implementation?(N=Pu(U,L.mode,W),N.return=L,N):(N=c(N,U.children||[]),N.return=L,N)}function Z(L,N,U,W,he){return N===null||N.tag!==7?(N=ki(U,L.mode,W,he),N.return=L,N):(N=c(N,U),N.return=L,N)}function ie(L,N,U){if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return N=Ku(""+N,L.mode,U),N.return=L,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case v:return U=fl(N.type,N.key,N.props,null,L.mode,U),jr(U,N),U.return=L,U;case M:return N=Pu(N,L.mode,U),N.return=L,N;case te:var W=N._init;return N=W(N._payload),ie(L,N,U)}if(F(N)||J(N))return N=ki(N,L.mode,U,null),N.return=L,N;if(typeof N.then=="function")return ie(L,Nl(N),U);if(N.$$typeof===j)return ie(L,gl(L,N),U);Rl(L,N)}return null}function H(L,N,U,W){var he=N!==null?N.key:null;if(typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint")return he!==null?null:S(L,N,""+U,W);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case v:return U.key===he?w(L,N,U,W):null;case M:return U.key===he?O(L,N,U,W):null;case te:return he=U._init,U=he(U._payload),H(L,N,U,W)}if(F(U)||J(U))return he!==null?null:Z(L,N,U,W,null);if(typeof U.then=="function")return H(L,N,Nl(U),W);if(U.$$typeof===j)return H(L,N,gl(L,U),W);Rl(L,U)}return null}function G(L,N,U,W,he){if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return L=L.get(U)||null,S(N,L,""+W,he);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case v:return L=L.get(W.key===null?U:W.key)||null,w(N,L,W,he);case M:return L=L.get(W.key===null?U:W.key)||null,O(N,L,W,he);case te:var Ae=W._init;return W=Ae(W._payload),G(L,N,U,W,he)}if(F(W)||J(W))return L=L.get(U)||null,Z(N,L,W,he,null);if(typeof W.then=="function")return G(L,N,U,Nl(W),he);if(W.$$typeof===j)return G(L,N,U,gl(N,W),he);Rl(N,W)}return null}function ve(L,N,U,W){for(var he=null,Ae=null,pe=N,be=N=0,xt=null;pe!==null&&be<U.length;be++){pe.index>be?(xt=pe,pe=null):xt=pe.sibling;var ke=H(L,pe,U[be],W);if(ke===null){pe===null&&(pe=xt);break}e&&pe&&ke.alternate===null&&n(L,pe),N=d(ke,N,be),Ae===null?he=ke:Ae.sibling=ke,Ae=ke,pe=xt}if(be===U.length)return i(L,pe),Le&&Di(L,be),he;if(pe===null){for(;be<U.length;be++)pe=ie(L,U[be],W),pe!==null&&(N=d(pe,N,be),Ae===null?he=pe:Ae.sibling=pe,Ae=pe);return Le&&Di(L,be),he}for(pe=o(pe);be<U.length;be++)xt=G(pe,L,be,U[be],W),xt!==null&&(e&&xt.alternate!==null&&pe.delete(xt.key===null?be:xt.key),N=d(xt,N,be),Ae===null?he=xt:Ae.sibling=xt,Ae=xt);return e&&pe.forEach(function(hi){return n(L,hi)}),Le&&Di(L,be),he}function ye(L,N,U,W){if(U==null)throw Error(r(151));for(var he=null,Ae=null,pe=N,be=N=0,xt=null,ke=U.next();pe!==null&&!ke.done;be++,ke=U.next()){pe.index>be?(xt=pe,pe=null):xt=pe.sibling;var hi=H(L,pe,ke.value,W);if(hi===null){pe===null&&(pe=xt);break}e&&pe&&hi.alternate===null&&n(L,pe),N=d(hi,N,be),Ae===null?he=hi:Ae.sibling=hi,Ae=hi,pe=xt}if(ke.done)return i(L,pe),Le&&Di(L,be),he;if(pe===null){for(;!ke.done;be++,ke=U.next())ke=ie(L,ke.value,W),ke!==null&&(N=d(ke,N,be),Ae===null?he=ke:Ae.sibling=ke,Ae=ke);return Le&&Di(L,be),he}for(pe=o(pe);!ke.done;be++,ke=U.next())ke=G(pe,L,be,ke.value,W),ke!==null&&(e&&ke.alternate!==null&&pe.delete(ke.key===null?be:ke.key),N=d(ke,N,be),Ae===null?he=ke:Ae.sibling=ke,Ae=ke);return e&&pe.forEach(function(vM){return n(L,vM)}),Le&&Di(L,be),he}function He(L,N,U,W){if(typeof U=="object"&&U!==null&&U.type===x&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case v:e:{for(var he=U.key;N!==null;){if(N.key===he){if(he=U.type,he===x){if(N.tag===7){i(L,N.sibling),W=c(N,U.props.children),W.return=L,L=W;break e}}else if(N.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===te&&w0(he)===N.type){i(L,N.sibling),W=c(N,U.props),jr(W,U),W.return=L,L=W;break e}i(L,N);break}else n(L,N);N=N.sibling}U.type===x?(W=ki(U.props.children,L.mode,W,U.key),W.return=L,L=W):(W=fl(U.type,U.key,U.props,null,L.mode,W),jr(W,U),W.return=L,L=W)}return y(L);case M:e:{for(he=U.key;N!==null;){if(N.key===he)if(N.tag===4&&N.stateNode.containerInfo===U.containerInfo&&N.stateNode.implementation===U.implementation){i(L,N.sibling),W=c(N,U.children||[]),W.return=L,L=W;break e}else{i(L,N);break}else n(L,N);N=N.sibling}W=Pu(U,L.mode,W),W.return=L,L=W}return y(L);case te:return he=U._init,U=he(U._payload),He(L,N,U,W)}if(F(U))return ve(L,N,U,W);if(J(U)){if(he=J(U),typeof he!="function")throw Error(r(150));return U=he.call(U),ye(L,N,U,W)}if(typeof U.then=="function")return He(L,N,Nl(U),W);if(U.$$typeof===j)return He(L,N,gl(L,U),W);Rl(L,U)}return typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint"?(U=""+U,N!==null&&N.tag===6?(i(L,N.sibling),W=c(N,U),W.return=L,L=W):(i(L,N),W=Ku(U,L.mode,W),W.return=L,L=W),y(L)):i(L,N)}return function(L,N,U,W){try{Hr=0;var he=He(L,N,U,W);return Rs=null,he}catch(pe){if(pe===kr||pe===bl)throw pe;var Ae=nn(29,pe,null,L.mode);return Ae.lanes=W,Ae.return=L,Ae}finally{}}}var ks=C0(!0),T0=C0(!1),yn=A(null),Fn=null;function Ja(e){var n=e.alternate;Q(pt,pt.current&1),Q(yn,e),Fn===null&&(n===null||Cs.current!==null||n.memoizedState!==null)&&(Fn=e)}function _0(e){if(e.tag===22){if(Q(pt,pt.current),Q(yn,e),Fn===null){var n=e.alternate;n!==null&&n.memoizedState!==null&&(Fn=e)}}else Wa()}function Wa(){Q(pt,pt.current),Q(yn,yn.current)}function Ma(e){z(yn),Fn===e&&(Fn=null),z(pt)}var pt=A(0);function kl(e){for(var n=e;n!==null;){if(n.tag===13){var i=n.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||vf(i)))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}function Nd(e,n,i,o){n=e.memoizedState,i=i(o,n),i=i==null?n:g({},n,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Rd={enqueueSetState:function(e,n,i){e=e._reactInternals;var o=on(),c=Ka(o);c.payload=n,i!=null&&(c.callback=i),n=Pa(e,c,o),n!==null&&(ln(n,e,o),Dr(n,e,o))},enqueueReplaceState:function(e,n,i){e=e._reactInternals;var o=on(),c=Ka(o);c.tag=1,c.payload=n,i!=null&&(c.callback=i),n=Pa(e,c,o),n!==null&&(ln(n,e,o),Dr(n,e,o))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var i=on(),o=Ka(i);o.tag=2,n!=null&&(o.callback=n),n=Pa(e,o,i),n!==null&&(ln(n,e,i),Dr(n,e,i))}};function N0(e,n,i,o,c,d,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,d,y):n.prototype&&n.prototype.isPureReactComponent?!xr(i,o)||!xr(c,d):!0}function R0(e,n,i,o){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(i,o),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(i,o),n.state!==e&&Rd.enqueueReplaceState(n,n.state,null)}function Hi(e,n){var i=n;if("ref"in n){i={};for(var o in n)o!=="ref"&&(i[o]=n[o])}if(e=e.defaultProps){i===n&&(i=g({},i));for(var c in e)i[c]===void 0&&(i[c]=e[c])}return i}var Ll=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function k0(e){Ll(e)}function L0(e){console.error(e)}function D0(e){Ll(e)}function Dl(e,n){try{var i=e.onUncaughtError;i(n.value,{componentStack:n.stack})}catch(o){setTimeout(function(){throw o})}}function I0(e,n,i){try{var o=e.onCaughtError;o(i.value,{componentStack:i.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function kd(e,n,i){return i=Ka(i),i.tag=3,i.payload={element:null},i.callback=function(){Dl(e,n)},i}function U0(e){return e=Ka(e),e.tag=3,e}function O0(e,n,i,o){var c=i.type.getDerivedStateFromError;if(typeof c=="function"){var d=o.value;e.payload=function(){return c(d)},e.callback=function(){I0(n,i,o)}}var y=i.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){I0(n,i,o),typeof c!="function"&&(si===null?si=new Set([this]):si.add(this));var S=o.stack;this.componentDidCatch(o.value,{componentStack:S!==null?S:""})})}function vS(e,n,i,o,c){if(i.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(n=i.alternate,n!==null&&_r(n,i,c,!0),i=yn.current,i!==null){switch(i.tag){case 13:return Fn===null?tf():i.alternate===null&&st===0&&(st=3),i.flags&=-257,i.flags|=65536,i.lanes=c,o===rd?i.flags|=16384:(n=i.updateQueue,n===null?i.updateQueue=new Set([o]):n.add(o),af(e,o,c)),!1;case 22:return i.flags|=65536,o===rd?i.flags|=16384:(n=i.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([o])},i.updateQueue=n):(i=n.retryQueue,i===null?n.retryQueue=new Set([o]):i.add(o)),af(e,o,c)),!1}throw Error(r(435,i.tag))}return af(e,o,c),tf(),!1}if(Le)return n=yn.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=c,o!==Wu&&(e=Error(r(422),{cause:o}),Tr(hn(e,i)))):(o!==Wu&&(n=Error(r(423),{cause:o}),Tr(hn(n,i))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,o=hn(o,i),c=kd(e.stateNode,o,c),cd(e,c),st!==4&&(st=2)),!1;var d=Error(r(520),{cause:o});if(d=hn(d,i),Qr===null?Qr=[d]:Qr.push(d),st!==4&&(st=2),n===null)return!0;o=hn(o,i),i=n;do{switch(i.tag){case 3:return i.flags|=65536,e=c&-c,i.lanes|=e,e=kd(i.stateNode,o,e),cd(i,e),!1;case 1:if(n=i.type,d=i.stateNode,(i.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(si===null||!si.has(d))))return i.flags|=65536,c&=-c,i.lanes|=c,c=U0(c),O0(c,e,i,o),cd(i,c),!1}i=i.return}while(i!==null);return!1}var z0=Error(r(461)),Mt=!1;function At(e,n,i,o){n.child=e===null?T0(n,null,i,o):ks(n,e.child,i,o)}function B0(e,n,i,o,c){i=i.render;var d=n.ref;if("ref"in o){var y={};for(var S in o)S!=="ref"&&(y[S]=o[S])}else y=o;return zi(n),o=md(e,n,i,y,d,c),S=pd(),e!==null&&!Mt?(gd(e,n,c),Ea(e,n,c)):(Le&&S&&Zu(n),n.flags|=1,At(e,n,o,c),n.child)}function q0(e,n,i,o,c){if(e===null){var d=i.type;return typeof d=="function"&&!Qu(d)&&d.defaultProps===void 0&&i.compare===null?(n.tag=15,n.type=d,H0(e,n,d,o,c)):(e=fl(i.type,null,o,n,n.mode,c),e.ref=n.ref,e.return=n,n.child=e)}if(d=e.child,!qd(e,c)){var y=d.memoizedProps;if(i=i.compare,i=i!==null?i:xr,i(y,o)&&e.ref===n.ref)return Ea(e,n,c)}return n.flags|=1,e=pa(d,o),e.ref=n.ref,e.return=n,n.child=e}function H0(e,n,i,o,c){if(e!==null){var d=e.memoizedProps;if(xr(d,o)&&e.ref===n.ref)if(Mt=!1,n.pendingProps=o=d,qd(e,c))(e.flags&131072)!==0&&(Mt=!0);else return n.lanes=e.lanes,Ea(e,n,c)}return Ld(e,n,i,o,c)}function j0(e,n,i){var o=n.pendingProps,c=o.children,d=e!==null?e.memoizedState:null;if(o.mode==="hidden"){if((n.flags&128)!==0){if(o=d!==null?d.baseLanes|i:i,e!==null){for(c=n.child=e.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;n.childLanes=d&~o}else n.childLanes=0,n.child=null;return G0(e,n,o,i)}if((i&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&yl(n,d!==null?d.cachePool:null),d!==null?Hp(n,d):dd(),_0(n);else return n.lanes=n.childLanes=536870912,G0(e,n,d!==null?d.baseLanes|i:i,i)}else d!==null?(yl(n,d.cachePool),Hp(n,d),Wa(),n.memoizedState=null):(e!==null&&yl(n,null),dd(),Wa());return At(e,n,c,i),n.child}function G0(e,n,i,o){var c=sd();return c=c===null?null:{parent:mt._currentValue,pool:c},n.memoizedState={baseLanes:i,cachePool:c},e!==null&&yl(n,null),dd(),_0(n),e!==null&&_r(e,n,o,!0),null}function Il(e,n){var i=n.ref;if(i===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(r(284));(e===null||e.ref!==i)&&(n.flags|=4194816)}}function Ld(e,n,i,o,c){return zi(n),i=md(e,n,i,o,void 0,c),o=pd(),e!==null&&!Mt?(gd(e,n,c),Ea(e,n,c)):(Le&&o&&Zu(n),n.flags|=1,At(e,n,i,c),n.child)}function Y0(e,n,i,o,c,d){return zi(n),n.updateQueue=null,i=Gp(n,o,i,c),jp(e),o=pd(),e!==null&&!Mt?(gd(e,n,d),Ea(e,n,d)):(Le&&o&&Zu(n),n.flags|=1,At(e,n,i,d),n.child)}function F0(e,n,i,o,c){if(zi(n),n.stateNode===null){var d=Ms,y=i.contextType;typeof y=="object"&&y!==null&&(d=Rt(y)),d=new i(o,d),n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Rd,n.stateNode=d,d._reactInternals=n,d=n.stateNode,d.props=o,d.state=n.memoizedState,d.refs={},od(n),y=i.contextType,d.context=typeof y=="object"&&y!==null?Rt(y):Ms,d.state=n.memoizedState,y=i.getDerivedStateFromProps,typeof y=="function"&&(Nd(n,i,y,o),d.state=n.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(y=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),y!==d.state&&Rd.enqueueReplaceState(d,d.state,null),Ur(n,o,d,c),Ir(),d.state=n.memoizedState),typeof d.componentDidMount=="function"&&(n.flags|=4194308),o=!0}else if(e===null){d=n.stateNode;var S=n.memoizedProps,w=Hi(i,S);d.props=w;var O=d.context,Z=i.contextType;y=Ms,typeof Z=="object"&&Z!==null&&(y=Rt(Z));var ie=i.getDerivedStateFromProps;Z=typeof ie=="function"||typeof d.getSnapshotBeforeUpdate=="function",S=n.pendingProps!==S,Z||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(S||O!==y)&&R0(n,d,o,y),Qa=!1;var H=n.memoizedState;d.state=H,Ur(n,o,d,c),Ir(),O=n.memoizedState,S||H!==O||Qa?(typeof ie=="function"&&(Nd(n,i,ie,o),O=n.memoizedState),(w=Qa||N0(n,i,w,o,H,O,y))?(Z||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(n.flags|=4194308)):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=o,n.memoizedState=O),d.props=o,d.state=O,d.context=y,o=w):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),o=!1)}else{d=n.stateNode,ld(e,n),y=n.memoizedProps,Z=Hi(i,y),d.props=Z,ie=n.pendingProps,H=d.context,O=i.contextType,w=Ms,typeof O=="object"&&O!==null&&(w=Rt(O)),S=i.getDerivedStateFromProps,(O=typeof S=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(y!==ie||H!==w)&&R0(n,d,o,w),Qa=!1,H=n.memoizedState,d.state=H,Ur(n,o,d,c),Ir();var G=n.memoizedState;y!==ie||H!==G||Qa||e!==null&&e.dependencies!==null&&pl(e.dependencies)?(typeof S=="function"&&(Nd(n,i,S,o),G=n.memoizedState),(Z=Qa||N0(n,i,Z,o,H,G,w)||e!==null&&e.dependencies!==null&&pl(e.dependencies))?(O||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(o,G,w),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(o,G,w)),typeof d.componentDidUpdate=="function"&&(n.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(n.flags|=1024),n.memoizedProps=o,n.memoizedState=G),d.props=o,d.state=G,d.context=w,o=Z):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(n.flags|=1024),o=!1)}return d=o,Il(e,n),o=(n.flags&128)!==0,d||o?(d=n.stateNode,i=o&&typeof i.getDerivedStateFromError!="function"?null:d.render(),n.flags|=1,e!==null&&o?(n.child=ks(n,e.child,null,c),n.child=ks(n,null,i,c)):At(e,n,i,c),n.memoizedState=d.state,e=n.child):e=Ea(e,n,c),e}function V0(e,n,i,o){return Cr(),n.flags|=256,At(e,n,i,o),n.child}var Dd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Id(e){return{baseLanes:e,cachePool:Lp()}}function Ud(e,n,i){return e=e!==null?e.childLanes&~i:0,n&&(e|=bn),e}function $0(e,n,i){var o=n.pendingProps,c=!1,d=(n.flags&128)!==0,y;if((y=d)||(y=e!==null&&e.memoizedState===null?!1:(pt.current&2)!==0),y&&(c=!0,n.flags&=-129),y=(n.flags&32)!==0,n.flags&=-33,e===null){if(Le){if(c?Ja(n):Wa(),Le){var S=it,w;if(w=S){e:{for(w=S,S=Yn;w.nodeType!==8;){if(!S){S=null;break e}if(w=Nn(w.nextSibling),w===null){S=null;break e}}S=w}S!==null?(n.memoizedState={dehydrated:S,treeContext:Li!==null?{id:ga,overflow:ya}:null,retryLane:536870912,hydrationErrors:null},w=nn(18,null,null,0),w.stateNode=S,w.return=n,n.child=w,Ot=n,it=null,w=!0):w=!1}w||Ui(n)}if(S=n.memoizedState,S!==null&&(S=S.dehydrated,S!==null))return vf(S)?n.lanes=32:n.lanes=536870912,null;Ma(n)}return S=o.children,o=o.fallback,c?(Wa(),c=n.mode,S=Ul({mode:"hidden",children:S},c),o=ki(o,c,i,null),S.return=n,o.return=n,S.sibling=o,n.child=S,c=n.child,c.memoizedState=Id(i),c.childLanes=Ud(e,y,i),n.memoizedState=Dd,o):(Ja(n),Od(n,S))}if(w=e.memoizedState,w!==null&&(S=w.dehydrated,S!==null)){if(d)n.flags&256?(Ja(n),n.flags&=-257,n=zd(e,n,i)):n.memoizedState!==null?(Wa(),n.child=e.child,n.flags|=128,n=null):(Wa(),c=o.fallback,S=n.mode,o=Ul({mode:"visible",children:o.children},S),c=ki(c,S,i,null),c.flags|=2,o.return=n,c.return=n,o.sibling=c,n.child=o,ks(n,e.child,null,i),o=n.child,o.memoizedState=Id(i),o.childLanes=Ud(e,y,i),n.memoizedState=Dd,n=c);else if(Ja(n),vf(S)){if(y=S.nextSibling&&S.nextSibling.dataset,y)var O=y.dgst;y=O,o=Error(r(419)),o.stack="",o.digest=y,Tr({value:o,source:null,stack:null}),n=zd(e,n,i)}else if(Mt||_r(e,n,i,!1),y=(i&e.childLanes)!==0,Mt||y){if(y=Ve,y!==null&&(o=i&-i,o=(o&42)!==0?1:mr(o),o=(o&(y.suspendedLanes|i))!==0?0:o,o!==0&&o!==w.retryLane))throw w.retryLane=o,Ss(e,o),ln(y,e,o),z0;S.data==="$?"||tf(),n=zd(e,n,i)}else S.data==="$?"?(n.flags|=192,n.child=e.child,n=null):(e=w.treeContext,it=Nn(S.nextSibling),Ot=n,Le=!0,Ii=null,Yn=!1,e!==null&&(pn[gn++]=ga,pn[gn++]=ya,pn[gn++]=Li,ga=e.id,ya=e.overflow,Li=n),n=Od(n,o.children),n.flags|=4096);return n}return c?(Wa(),c=o.fallback,S=n.mode,w=e.child,O=w.sibling,o=pa(w,{mode:"hidden",children:o.children}),o.subtreeFlags=w.subtreeFlags&65011712,O!==null?c=pa(O,c):(c=ki(c,S,i,null),c.flags|=2),c.return=n,o.return=n,o.sibling=c,n.child=o,o=c,c=n.child,S=e.child.memoizedState,S===null?S=Id(i):(w=S.cachePool,w!==null?(O=mt._currentValue,w=w.parent!==O?{parent:O,pool:O}:w):w=Lp(),S={baseLanes:S.baseLanes|i,cachePool:w}),c.memoizedState=S,c.childLanes=Ud(e,y,i),n.memoizedState=Dd,o):(Ja(n),i=e.child,e=i.sibling,i=pa(i,{mode:"visible",children:o.children}),i.return=n,i.sibling=null,e!==null&&(y=n.deletions,y===null?(n.deletions=[e],n.flags|=16):y.push(e)),n.child=i,n.memoizedState=null,i)}function Od(e,n){return n=Ul({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function Ul(e,n){return e=nn(22,e,null,n),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function zd(e,n,i){return ks(n,e.child,null,i),e=Od(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function X0(e,n,i){e.lanes|=n;var o=e.alternate;o!==null&&(o.lanes|=n),td(e.return,n,i)}function Bd(e,n,i,o,c){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:o,tail:i,tailMode:c}:(d.isBackwards=n,d.rendering=null,d.renderingStartTime=0,d.last=o,d.tail=i,d.tailMode=c)}function Q0(e,n,i){var o=n.pendingProps,c=o.revealOrder,d=o.tail;if(At(e,n,o.children,i),o=pt.current,(o&2)!==0)o=o&1|2,n.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&X0(e,i,n);else if(e.tag===19)X0(e,i,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}switch(Q(pt,o),c){case"forwards":for(i=n.child,c=null;i!==null;)e=i.alternate,e!==null&&kl(e)===null&&(c=i),i=i.sibling;i=c,i===null?(c=n.child,n.child=null):(c=i.sibling,i.sibling=null),Bd(n,!1,c,i,d);break;case"backwards":for(i=null,c=n.child,n.child=null;c!==null;){if(e=c.alternate,e!==null&&kl(e)===null){n.child=c;break}e=c.sibling,c.sibling=i,i=c,c=e}Bd(n,!0,i,null,d);break;case"together":Bd(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Ea(e,n,i){if(e!==null&&(n.dependencies=e.dependencies),ii|=n.lanes,(i&n.childLanes)===0)if(e!==null){if(_r(e,n,i,!1),(i&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(r(153));if(n.child!==null){for(e=n.child,i=pa(e,e.pendingProps),n.child=i,i.return=n;e.sibling!==null;)e=e.sibling,i=i.sibling=pa(e,e.pendingProps),i.return=n;i.sibling=null}return n.child}function qd(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&pl(e)))}function SS(e,n,i){switch(n.tag){case 3:Se(n,n.stateNode.containerInfo),Xa(n,mt,e.memoizedState.cache),Cr();break;case 27:case 5:_t(n);break;case 4:Se(n,n.stateNode.containerInfo);break;case 10:Xa(n,n.type,n.memoizedProps.value);break;case 13:var o=n.memoizedState;if(o!==null)return o.dehydrated!==null?(Ja(n),n.flags|=128,null):(i&n.child.childLanes)!==0?$0(e,n,i):(Ja(n),e=Ea(e,n,i),e!==null?e.sibling:null);Ja(n);break;case 19:var c=(e.flags&128)!==0;if(o=(i&n.childLanes)!==0,o||(_r(e,n,i,!1),o=(i&n.childLanes)!==0),c){if(o)return Q0(e,n,i);n.flags|=128}if(c=n.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),Q(pt,pt.current),o)break;return null;case 22:case 23:return n.lanes=0,j0(e,n,i);case 24:Xa(n,mt,e.memoizedState.cache)}return Ea(e,n,i)}function K0(e,n,i){if(e!==null)if(e.memoizedProps!==n.pendingProps)Mt=!0;else{if(!qd(e,i)&&(n.flags&128)===0)return Mt=!1,SS(e,n,i);Mt=(e.flags&131072)!==0}else Mt=!1,Le&&(n.flags&1048576)!==0&&wp(n,ml,n.index);switch(n.lanes=0,n.tag){case 16:e:{e=n.pendingProps;var o=n.elementType,c=o._init;if(o=c(o._payload),n.type=o,typeof o=="function")Qu(o)?(e=Hi(o,e),n.tag=1,n=F0(null,n,o,e,i)):(n.tag=0,n=Ld(null,n,o,e,i));else{if(o!=null){if(c=o.$$typeof,c===V){n.tag=11,n=B0(null,n,o,e,i);break e}else if(c===ee){n.tag=14,n=q0(null,n,o,e,i);break e}}throw n=ae(o)||o,Error(r(306,n,""))}}return n;case 0:return Ld(e,n,n.type,n.pendingProps,i);case 1:return o=n.type,c=Hi(o,n.pendingProps),F0(e,n,o,c,i);case 3:e:{if(Se(n,n.stateNode.containerInfo),e===null)throw Error(r(387));o=n.pendingProps;var d=n.memoizedState;c=d.element,ld(e,n),Ur(n,o,null,i);var y=n.memoizedState;if(o=y.cache,Xa(n,mt,o),o!==d.cache&&nd(n,[mt],i,!0),Ir(),o=y.element,d.isDehydrated)if(d={element:o,isDehydrated:!1,cache:y.cache},n.updateQueue.baseState=d,n.memoizedState=d,n.flags&256){n=V0(e,n,o,i);break e}else if(o!==c){c=hn(Error(r(424)),n),Tr(c),n=V0(e,n,o,i);break e}else{switch(e=n.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(it=Nn(e.firstChild),Ot=n,Le=!0,Ii=null,Yn=!0,i=T0(n,null,o,i),n.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(Cr(),o===c){n=Ea(e,n,i);break e}At(e,n,o,i)}n=n.child}return n;case 26:return Il(e,n),e===null?(i=Wg(n.type,null,n.pendingProps,null))?n.memoizedState=i:Le||(i=n.type,e=n.pendingProps,o=Kl(ue.current).createElement(i),o[et]=n,o[ft]=e,Ct(o,i,e),tt(o),n.stateNode=o):n.memoizedState=Wg(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return _t(n),e===null&&Le&&(o=n.stateNode=Pg(n.type,n.pendingProps,ue.current),Ot=n,Yn=!0,c=it,li(n.type)?(Sf=c,it=Nn(o.firstChild)):it=c),At(e,n,n.pendingProps.children,i),Il(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&Le&&((c=o=it)&&(o=QS(o,n.type,n.pendingProps,Yn),o!==null?(n.stateNode=o,Ot=n,it=Nn(o.firstChild),Yn=!1,c=!0):c=!1),c||Ui(n)),_t(n),c=n.type,d=n.pendingProps,y=e!==null?e.memoizedProps:null,o=d.children,gf(c,d)?o=null:y!==null&&gf(c,y)&&(n.flags|=32),n.memoizedState!==null&&(c=md(e,n,fS,null,null,i),ao._currentValue=c),Il(e,n),At(e,n,o,i),n.child;case 6:return e===null&&Le&&((e=i=it)&&(i=KS(i,n.pendingProps,Yn),i!==null?(n.stateNode=i,Ot=n,it=null,e=!0):e=!1),e||Ui(n)),null;case 13:return $0(e,n,i);case 4:return Se(n,n.stateNode.containerInfo),o=n.pendingProps,e===null?n.child=ks(n,null,o,i):At(e,n,o,i),n.child;case 11:return B0(e,n,n.type,n.pendingProps,i);case 7:return At(e,n,n.pendingProps,i),n.child;case 8:return At(e,n,n.pendingProps.children,i),n.child;case 12:return At(e,n,n.pendingProps.children,i),n.child;case 10:return o=n.pendingProps,Xa(n,n.type,o.value),At(e,n,o.children,i),n.child;case 9:return c=n.type._context,o=n.pendingProps.children,zi(n),c=Rt(c),o=o(c),n.flags|=1,At(e,n,o,i),n.child;case 14:return q0(e,n,n.type,n.pendingProps,i);case 15:return H0(e,n,n.type,n.pendingProps,i);case 19:return Q0(e,n,i);case 31:return o=n.pendingProps,i=n.mode,o={mode:o.mode,children:o.children},e===null?(i=Ul(o,i),i.ref=n.ref,n.child=i,i.return=n,n=i):(i=pa(e.child,o),i.ref=n.ref,n.child=i,i.return=n,n=i),n;case 22:return j0(e,n,i);case 24:return zi(n),o=Rt(mt),e===null?(c=sd(),c===null&&(c=Ve,d=ad(),c.pooledCache=d,d.refCount++,d!==null&&(c.pooledCacheLanes|=i),c=d),n.memoizedState={parent:o,cache:c},od(n),Xa(n,mt,c)):((e.lanes&i)!==0&&(ld(e,n),Ur(n,null,null,i),Ir()),c=e.memoizedState,d=n.memoizedState,c.parent!==o?(c={parent:o,cache:o},n.memoizedState=c,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=c),Xa(n,mt,o)):(o=d.cache,Xa(n,mt,o),o!==c.cache&&nd(n,[mt],i,!0))),At(e,n,n.pendingProps.children,i),n.child;case 29:throw n.pendingProps}throw Error(r(156,n.tag))}function xa(e){e.flags|=4}function P0(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!iy(n)){if(n=yn.current,n!==null&&((Re&4194048)===Re?Fn!==null:(Re&62914560)!==Re&&(Re&536870912)===0||n!==Fn))throw Lr=rd,Dp;e.flags|=8192}}function Ol(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?Vo():536870912,e.lanes|=n,Us|=n)}function Gr(e,n){if(!Le)switch(e.tailMode){case"hidden":n=e.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function Ze(e){var n=e.alternate!==null&&e.alternate.child===e.child,i=0,o=0;if(n)for(var c=e.child;c!==null;)i|=c.lanes|c.childLanes,o|=c.subtreeFlags&65011712,o|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)i|=c.lanes|c.childLanes,o|=c.subtreeFlags,o|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=o,e.childLanes=i,n}function MS(e,n,i){var o=n.pendingProps;switch(Ju(n),n.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ze(n),null;case 1:return Ze(n),null;case 3:return i=n.stateNode,o=null,e!==null&&(o=e.memoizedState.cache),n.memoizedState.cache!==o&&(n.flags|=2048),va(mt),rt(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(wr(n)?xa(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,_p())),Ze(n),null;case 26:return i=n.memoizedState,e===null?(xa(n),i!==null?(Ze(n),P0(n,i)):(Ze(n),n.flags&=-16777217)):i?i!==e.memoizedState?(xa(n),Ze(n),P0(n,i)):(Ze(n),n.flags&=-16777217):(e.memoizedProps!==o&&xa(n),Ze(n),n.flags&=-16777217),null;case 27:Ft(n),i=ue.current;var c=n.type;if(e!==null&&n.stateNode!=null)e.memoizedProps!==o&&xa(n);else{if(!o){if(n.stateNode===null)throw Error(r(166));return Ze(n),null}e=se.current,wr(n)?Cp(n):(e=Pg(c,o,i),n.stateNode=e,xa(n))}return Ze(n),null;case 5:if(Ft(n),i=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==o&&xa(n);else{if(!o){if(n.stateNode===null)throw Error(r(166));return Ze(n),null}if(e=se.current,wr(n))Cp(n);else{switch(c=Kl(ue.current),e){case 1:e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof o.is=="string"?c.createElement("select",{is:o.is}):c.createElement("select"),o.multiple?e.multiple=!0:o.size&&(e.size=o.size);break;default:e=typeof o.is=="string"?c.createElement(i,{is:o.is}):c.createElement(i)}}e[et]=n,e[ft]=o;e:for(c=n.child;c!==null;){if(c.tag===5||c.tag===6)e.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===n)break e;for(;c.sibling===null;){if(c.return===null||c.return===n)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}n.stateNode=e;e:switch(Ct(e,i,o),i){case"button":case"input":case"select":case"textarea":e=!!o.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&xa(n)}}return Ze(n),n.flags&=-16777217,null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==o&&xa(n);else{if(typeof o!="string"&&n.stateNode===null)throw Error(r(166));if(e=ue.current,wr(n)){if(e=n.stateNode,i=n.memoizedProps,o=null,c=Ot,c!==null)switch(c.tag){case 27:case 5:o=c.memoizedProps}e[et]=n,e=!!(e.nodeValue===i||o!==null&&o.suppressHydrationWarning===!0||Yg(e.nodeValue,i)),e||Ui(n)}else e=Kl(e).createTextNode(o),e[et]=n,n.stateNode=e}return Ze(n),null;case 13:if(o=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=wr(n),o!==null&&o.dehydrated!==null){if(e===null){if(!c)throw Error(r(318));if(c=n.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));c[et]=n}else Cr(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Ze(n),c=!1}else c=_p(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return n.flags&256?(Ma(n),n):(Ma(n),null)}if(Ma(n),(n.flags&128)!==0)return n.lanes=i,n;if(i=o!==null,e=e!==null&&e.memoizedState!==null,i){o=n.child,c=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(c=o.alternate.memoizedState.cachePool.pool);var d=null;o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),d!==c&&(o.flags|=2048)}return i!==e&&i&&(n.child.flags|=8192),Ol(n,n.updateQueue),Ze(n),null;case 4:return rt(),e===null&&df(n.stateNode.containerInfo),Ze(n),null;case 10:return va(n.type),Ze(n),null;case 19:if(z(pt),c=n.memoizedState,c===null)return Ze(n),null;if(o=(n.flags&128)!==0,d=c.rendering,d===null)if(o)Gr(c,!1);else{if(st!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(d=kl(e),d!==null){for(n.flags|=128,Gr(c,!1),e=d.updateQueue,n.updateQueue=e,Ol(n,e),n.subtreeFlags=0,e=i,i=n.child;i!==null;)Ap(i,e),i=i.sibling;return Q(pt,pt.current&1|2),n.child}e=e.sibling}c.tail!==null&&fe()>ql&&(n.flags|=128,o=!0,Gr(c,!1),n.lanes=4194304)}else{if(!o)if(e=kl(d),e!==null){if(n.flags|=128,o=!0,e=e.updateQueue,n.updateQueue=e,Ol(n,e),Gr(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!Le)return Ze(n),null}else 2*fe()-c.renderingStartTime>ql&&i!==536870912&&(n.flags|=128,o=!0,Gr(c,!1),n.lanes=4194304);c.isBackwards?(d.sibling=n.child,n.child=d):(e=c.last,e!==null?e.sibling=d:n.child=d,c.last=d)}return c.tail!==null?(n=c.tail,c.rendering=n,c.tail=n.sibling,c.renderingStartTime=fe(),n.sibling=null,e=pt.current,Q(pt,o?e&1|2:e&1),n):(Ze(n),null);case 22:case 23:return Ma(n),fd(),o=n.memoizedState!==null,e!==null?e.memoizedState!==null!==o&&(n.flags|=8192):o&&(n.flags|=8192),o?(i&536870912)!==0&&(n.flags&128)===0&&(Ze(n),n.subtreeFlags&6&&(n.flags|=8192)):Ze(n),i=n.updateQueue,i!==null&&Ol(n,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),o=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),o!==i&&(n.flags|=2048),e!==null&&z(Bi),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),n.memoizedState.cache!==i&&(n.flags|=2048),va(mt),Ze(n),null;case 25:return null;case 30:return null}throw Error(r(156,n.tag))}function ES(e,n){switch(Ju(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return va(mt),rt(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return Ft(n),null;case 13:if(Ma(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(r(340));Cr()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return z(pt),null;case 4:return rt(),null;case 10:return va(n.type),null;case 22:case 23:return Ma(n),fd(),e!==null&&z(Bi),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return va(mt),null;case 25:return null;default:return null}}function Z0(e,n){switch(Ju(n),n.tag){case 3:va(mt),rt();break;case 26:case 27:case 5:Ft(n);break;case 4:rt();break;case 13:Ma(n);break;case 19:z(pt);break;case 10:va(n.type);break;case 22:case 23:Ma(n),fd(),e!==null&&z(Bi);break;case 24:va(mt)}}function Yr(e,n){try{var i=n.updateQueue,o=i!==null?i.lastEffect:null;if(o!==null){var c=o.next;i=c;do{if((i.tag&e)===e){o=void 0;var d=i.create,y=i.inst;o=d(),y.destroy=o}i=i.next}while(i!==c)}}catch(S){Fe(n,n.return,S)}}function ei(e,n,i){try{var o=n.updateQueue,c=o!==null?o.lastEffect:null;if(c!==null){var d=c.next;o=d;do{if((o.tag&e)===e){var y=o.inst,S=y.destroy;if(S!==void 0){y.destroy=void 0,c=n;var w=i,O=S;try{O()}catch(Z){Fe(c,w,Z)}}}o=o.next}while(o!==d)}}catch(Z){Fe(n,n.return,Z)}}function J0(e){var n=e.updateQueue;if(n!==null){var i=e.stateNode;try{qp(n,i)}catch(o){Fe(e,e.return,o)}}}function W0(e,n,i){i.props=Hi(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(o){Fe(e,n,o)}}function Fr(e,n){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var o=e.stateNode;break;case 30:o=e.stateNode;break;default:o=e.stateNode}typeof i=="function"?e.refCleanup=i(o):i.current=o}}catch(c){Fe(e,n,c)}}function Vn(e,n){var i=e.ref,o=e.refCleanup;if(i!==null)if(typeof o=="function")try{o()}catch(c){Fe(e,n,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(c){Fe(e,n,c)}else i.current=null}function eg(e){var n=e.type,i=e.memoizedProps,o=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":i.autoFocus&&o.focus();break e;case"img":i.src?o.src=i.src:i.srcSet&&(o.srcset=i.srcSet)}}catch(c){Fe(e,e.return,c)}}function Hd(e,n,i){try{var o=e.stateNode;YS(o,e.type,i,n),o[ft]=n}catch(c){Fe(e,e.return,c)}}function tg(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&li(e.type)||e.tag===4}function jd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||tg(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&li(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Gd(e,n,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,n):(n=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,n.appendChild(e),i=i._reactRootContainer,i!=null||n.onclick!==null||(n.onclick=Ql));else if(o!==4&&(o===27&&li(e.type)&&(i=e.stateNode,n=null),e=e.child,e!==null))for(Gd(e,n,i),e=e.sibling;e!==null;)Gd(e,n,i),e=e.sibling}function zl(e,n,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?i.insertBefore(e,n):i.appendChild(e);else if(o!==4&&(o===27&&li(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(zl(e,n,i),e=e.sibling;e!==null;)zl(e,n,i),e=e.sibling}function ng(e){var n=e.stateNode,i=e.memoizedProps;try{for(var o=e.type,c=n.attributes;c.length;)n.removeAttributeNode(c[0]);Ct(n,o,i),n[et]=e,n[ft]=i}catch(d){Fe(e,e.return,d)}}var Aa=!1,lt=!1,Yd=!1,ag=typeof WeakSet=="function"?WeakSet:Set,Et=null;function xS(e,n){if(e=e.containerInfo,mf=tc,e=mp(e),ju(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var o=i.getSelection&&i.getSelection();if(o&&o.rangeCount!==0){i=o.anchorNode;var c=o.anchorOffset,d=o.focusNode;o=o.focusOffset;try{i.nodeType,d.nodeType}catch{i=null;break e}var y=0,S=-1,w=-1,O=0,Z=0,ie=e,H=null;t:for(;;){for(var G;ie!==i||c!==0&&ie.nodeType!==3||(S=y+c),ie!==d||o!==0&&ie.nodeType!==3||(w=y+o),ie.nodeType===3&&(y+=ie.nodeValue.length),(G=ie.firstChild)!==null;)H=ie,ie=G;for(;;){if(ie===e)break t;if(H===i&&++O===c&&(S=y),H===d&&++Z===o&&(w=y),(G=ie.nextSibling)!==null)break;ie=H,H=ie.parentNode}ie=G}i=S===-1||w===-1?null:{start:S,end:w}}else i=null}i=i||{start:0,end:0}}else i=null;for(pf={focusedElem:e,selectionRange:i},tc=!1,Et=n;Et!==null;)if(n=Et,e=n.child,(n.subtreeFlags&1024)!==0&&e!==null)e.return=n,Et=e;else for(;Et!==null;){switch(n=Et,d=n.alternate,e=n.flags,n.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,i=n,c=d.memoizedProps,d=d.memoizedState,o=i.stateNode;try{var ve=Hi(i.type,c,i.elementType===i.type);e=o.getSnapshotBeforeUpdate(ve,d),o.__reactInternalSnapshotBeforeUpdate=e}catch(ye){Fe(i,i.return,ye)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,i=e.nodeType,i===9)bf(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":bf(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(r(163))}if(e=n.sibling,e!==null){e.return=n.return,Et=e;break}Et=n.return}}function ig(e,n,i){var o=i.flags;switch(i.tag){case 0:case 11:case 15:ti(e,i),o&4&&Yr(5,i);break;case 1:if(ti(e,i),o&4)if(e=i.stateNode,n===null)try{e.componentDidMount()}catch(y){Fe(i,i.return,y)}else{var c=Hi(i.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(c,n,e.__reactInternalSnapshotBeforeUpdate)}catch(y){Fe(i,i.return,y)}}o&64&&J0(i),o&512&&Fr(i,i.return);break;case 3:if(ti(e,i),o&64&&(e=i.updateQueue,e!==null)){if(n=null,i.child!==null)switch(i.child.tag){case 27:case 5:n=i.child.stateNode;break;case 1:n=i.child.stateNode}try{qp(e,n)}catch(y){Fe(i,i.return,y)}}break;case 27:n===null&&o&4&&ng(i);case 26:case 5:ti(e,i),n===null&&o&4&&eg(i),o&512&&Fr(i,i.return);break;case 12:ti(e,i);break;case 13:ti(e,i),o&4&&og(e,i),o&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=LS.bind(null,i),PS(e,i))));break;case 22:if(o=i.memoizedState!==null||Aa,!o){n=n!==null&&n.memoizedState!==null||lt,c=Aa;var d=lt;Aa=o,(lt=n)&&!d?ni(e,i,(i.subtreeFlags&8772)!==0):ti(e,i),Aa=c,lt=d}break;case 30:break;default:ti(e,i)}}function sg(e){var n=e.alternate;n!==null&&(e.alternate=null,sg(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&ds(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ke=null,Qt=!1;function wa(e,n,i){for(i=i.child;i!==null;)rg(e,n,i),i=i.sibling}function rg(e,n,i){if(Pe&&typeof Pe.onCommitFiberUnmount=="function")try{Pe.onCommitFiberUnmount(Qe,i)}catch{}switch(i.tag){case 26:lt||Vn(i,n),wa(e,n,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:lt||Vn(i,n);var o=Ke,c=Qt;li(i.type)&&(Ke=i.stateNode,Qt=!1),wa(e,n,i),Wr(i.stateNode),Ke=o,Qt=c;break;case 5:lt||Vn(i,n);case 6:if(o=Ke,c=Qt,Ke=null,wa(e,n,i),Ke=o,Qt=c,Ke!==null)if(Qt)try{(Ke.nodeType===9?Ke.body:Ke.nodeName==="HTML"?Ke.ownerDocument.body:Ke).removeChild(i.stateNode)}catch(d){Fe(i,n,d)}else try{Ke.removeChild(i.stateNode)}catch(d){Fe(i,n,d)}break;case 18:Ke!==null&&(Qt?(e=Ke,Qg(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),oo(e)):Qg(Ke,i.stateNode));break;case 4:o=Ke,c=Qt,Ke=i.stateNode.containerInfo,Qt=!0,wa(e,n,i),Ke=o,Qt=c;break;case 0:case 11:case 14:case 15:lt||ei(2,i,n),lt||ei(4,i,n),wa(e,n,i);break;case 1:lt||(Vn(i,n),o=i.stateNode,typeof o.componentWillUnmount=="function"&&W0(i,n,o)),wa(e,n,i);break;case 21:wa(e,n,i);break;case 22:lt=(o=lt)||i.memoizedState!==null,wa(e,n,i),lt=o;break;default:wa(e,n,i)}}function og(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{oo(e)}catch(i){Fe(n,n.return,i)}}function AS(e){switch(e.tag){case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new ag),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new ag),n;default:throw Error(r(435,e.tag))}}function Fd(e,n){var i=AS(e);n.forEach(function(o){var c=DS.bind(null,e,o);i.has(o)||(i.add(o),o.then(c,c))})}function an(e,n){var i=n.deletions;if(i!==null)for(var o=0;o<i.length;o++){var c=i[o],d=e,y=n,S=y;e:for(;S!==null;){switch(S.tag){case 27:if(li(S.type)){Ke=S.stateNode,Qt=!1;break e}break;case 5:Ke=S.stateNode,Qt=!1;break e;case 3:case 4:Ke=S.stateNode.containerInfo,Qt=!0;break e}S=S.return}if(Ke===null)throw Error(r(160));rg(d,y,c),Ke=null,Qt=!1,d=c.alternate,d!==null&&(d.return=null),c.return=null}if(n.subtreeFlags&13878)for(n=n.child;n!==null;)lg(n,e),n=n.sibling}var _n=null;function lg(e,n){var i=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:an(n,e),sn(e),o&4&&(ei(3,e,e.return),Yr(3,e),ei(5,e,e.return));break;case 1:an(n,e),sn(e),o&512&&(lt||i===null||Vn(i,i.return)),o&64&&Aa&&(e=e.updateQueue,e!==null&&(o=e.callbacks,o!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?o:i.concat(o))));break;case 26:var c=_n;if(an(n,e),sn(e),o&512&&(lt||i===null||Vn(i,i.return)),o&4){var d=i!==null?i.memoizedState:null;if(o=e.memoizedState,i===null)if(o===null)if(e.stateNode===null){e:{o=e.type,i=e.memoizedProps,c=c.ownerDocument||c;t:switch(o){case"title":d=c.getElementsByTagName("title")[0],(!d||d[Ai]||d[et]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=c.createElement(o),c.head.insertBefore(d,c.querySelector("head > title"))),Ct(d,o,i),d[et]=e,tt(d),o=d;break e;case"link":var y=ny("link","href",c).get(o+(i.href||""));if(y){for(var S=0;S<y.length;S++)if(d=y[S],d.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&d.getAttribute("rel")===(i.rel==null?null:i.rel)&&d.getAttribute("title")===(i.title==null?null:i.title)&&d.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){y.splice(S,1);break t}}d=c.createElement(o),Ct(d,o,i),c.head.appendChild(d);break;case"meta":if(y=ny("meta","content",c).get(o+(i.content||""))){for(S=0;S<y.length;S++)if(d=y[S],d.getAttribute("content")===(i.content==null?null:""+i.content)&&d.getAttribute("name")===(i.name==null?null:i.name)&&d.getAttribute("property")===(i.property==null?null:i.property)&&d.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&d.getAttribute("charset")===(i.charSet==null?null:i.charSet)){y.splice(S,1);break t}}d=c.createElement(o),Ct(d,o,i),c.head.appendChild(d);break;default:throw Error(r(468,o))}d[et]=e,tt(d),o=d}e.stateNode=o}else ay(c,e.type,e.stateNode);else e.stateNode=ty(c,o,e.memoizedProps);else d!==o?(d===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):d.count--,o===null?ay(c,e.type,e.stateNode):ty(c,o,e.memoizedProps)):o===null&&e.stateNode!==null&&Hd(e,e.memoizedProps,i.memoizedProps)}break;case 27:an(n,e),sn(e),o&512&&(lt||i===null||Vn(i,i.return)),i!==null&&o&4&&Hd(e,e.memoizedProps,i.memoizedProps);break;case 5:if(an(n,e),sn(e),o&512&&(lt||i===null||Vn(i,i.return)),e.flags&32){c=e.stateNode;try{hs(c,"")}catch(G){Fe(e,e.return,G)}}o&4&&e.stateNode!=null&&(c=e.memoizedProps,Hd(e,c,i!==null?i.memoizedProps:c)),o&1024&&(Yd=!0);break;case 6:if(an(n,e),sn(e),o&4){if(e.stateNode===null)throw Error(r(162));o=e.memoizedProps,i=e.stateNode;try{i.nodeValue=o}catch(G){Fe(e,e.return,G)}}break;case 3:if(Jl=null,c=_n,_n=Pl(n.containerInfo),an(n,e),_n=c,sn(e),o&4&&i!==null&&i.memoizedState.isDehydrated)try{oo(n.containerInfo)}catch(G){Fe(e,e.return,G)}Yd&&(Yd=!1,cg(e));break;case 4:o=_n,_n=Pl(e.stateNode.containerInfo),an(n,e),sn(e),_n=o;break;case 12:an(n,e),sn(e);break;case 13:an(n,e),sn(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(Pd=fe()),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Fd(e,o)));break;case 22:c=e.memoizedState!==null;var w=i!==null&&i.memoizedState!==null,O=Aa,Z=lt;if(Aa=O||c,lt=Z||w,an(n,e),lt=Z,Aa=O,sn(e),o&8192)e:for(n=e.stateNode,n._visibility=c?n._visibility&-2:n._visibility|1,c&&(i===null||w||Aa||lt||ji(e)),i=null,n=e;;){if(n.tag===5||n.tag===26){if(i===null){w=i=n;try{if(d=w.stateNode,c)y=d.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{S=w.stateNode;var ie=w.memoizedProps.style,H=ie!=null&&ie.hasOwnProperty("display")?ie.display:null;S.style.display=H==null||typeof H=="boolean"?"":(""+H).trim()}}catch(G){Fe(w,w.return,G)}}}else if(n.tag===6){if(i===null){w=n;try{w.stateNode.nodeValue=c?"":w.memoizedProps}catch(G){Fe(w,w.return,G)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;i===n&&(i=null),n=n.return}i===n&&(i=null),n.sibling.return=n.return,n=n.sibling}o&4&&(o=e.updateQueue,o!==null&&(i=o.retryQueue,i!==null&&(o.retryQueue=null,Fd(e,i))));break;case 19:an(n,e),sn(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Fd(e,o)));break;case 30:break;case 21:break;default:an(n,e),sn(e)}}function sn(e){var n=e.flags;if(n&2){try{for(var i,o=e.return;o!==null;){if(tg(o)){i=o;break}o=o.return}if(i==null)throw Error(r(160));switch(i.tag){case 27:var c=i.stateNode,d=jd(e);zl(e,d,c);break;case 5:var y=i.stateNode;i.flags&32&&(hs(y,""),i.flags&=-33);var S=jd(e);zl(e,S,y);break;case 3:case 4:var w=i.stateNode.containerInfo,O=jd(e);Gd(e,O,w);break;default:throw Error(r(161))}}catch(Z){Fe(e,e.return,Z)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function cg(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;cg(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function ti(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)ig(e,n.alternate,n),n=n.sibling}function ji(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:ei(4,n,n.return),ji(n);break;case 1:Vn(n,n.return);var i=n.stateNode;typeof i.componentWillUnmount=="function"&&W0(n,n.return,i),ji(n);break;case 27:Wr(n.stateNode);case 26:case 5:Vn(n,n.return),ji(n);break;case 22:n.memoizedState===null&&ji(n);break;case 30:ji(n);break;default:ji(n)}e=e.sibling}}function ni(e,n,i){for(i=i&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var o=n.alternate,c=e,d=n,y=d.flags;switch(d.tag){case 0:case 11:case 15:ni(c,d,i),Yr(4,d);break;case 1:if(ni(c,d,i),o=d,c=o.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(O){Fe(o,o.return,O)}if(o=d,c=o.updateQueue,c!==null){var S=o.stateNode;try{var w=c.shared.hiddenCallbacks;if(w!==null)for(c.shared.hiddenCallbacks=null,c=0;c<w.length;c++)Bp(w[c],S)}catch(O){Fe(o,o.return,O)}}i&&y&64&&J0(d),Fr(d,d.return);break;case 27:ng(d);case 26:case 5:ni(c,d,i),i&&o===null&&y&4&&eg(d),Fr(d,d.return);break;case 12:ni(c,d,i);break;case 13:ni(c,d,i),i&&y&4&&og(c,d);break;case 22:d.memoizedState===null&&ni(c,d,i),Fr(d,d.return);break;case 30:break;default:ni(c,d,i)}n=n.sibling}}function Vd(e,n){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Nr(i))}function $d(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Nr(e))}function $n(e,n,i,o){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)ug(e,n,i,o),n=n.sibling}function ug(e,n,i,o){var c=n.flags;switch(n.tag){case 0:case 11:case 15:$n(e,n,i,o),c&2048&&Yr(9,n);break;case 1:$n(e,n,i,o);break;case 3:$n(e,n,i,o),c&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Nr(e)));break;case 12:if(c&2048){$n(e,n,i,o),e=n.stateNode;try{var d=n.memoizedProps,y=d.id,S=d.onPostCommit;typeof S=="function"&&S(y,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(w){Fe(n,n.return,w)}}else $n(e,n,i,o);break;case 13:$n(e,n,i,o);break;case 23:break;case 22:d=n.stateNode,y=n.alternate,n.memoizedState!==null?d._visibility&2?$n(e,n,i,o):Vr(e,n):d._visibility&2?$n(e,n,i,o):(d._visibility|=2,Ls(e,n,i,o,(n.subtreeFlags&10256)!==0)),c&2048&&Vd(y,n);break;case 24:$n(e,n,i,o),c&2048&&$d(n.alternate,n);break;default:$n(e,n,i,o)}}function Ls(e,n,i,o,c){for(c=c&&(n.subtreeFlags&10256)!==0,n=n.child;n!==null;){var d=e,y=n,S=i,w=o,O=y.flags;switch(y.tag){case 0:case 11:case 15:Ls(d,y,S,w,c),Yr(8,y);break;case 23:break;case 22:var Z=y.stateNode;y.memoizedState!==null?Z._visibility&2?Ls(d,y,S,w,c):Vr(d,y):(Z._visibility|=2,Ls(d,y,S,w,c)),c&&O&2048&&Vd(y.alternate,y);break;case 24:Ls(d,y,S,w,c),c&&O&2048&&$d(y.alternate,y);break;default:Ls(d,y,S,w,c)}n=n.sibling}}function Vr(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var i=e,o=n,c=o.flags;switch(o.tag){case 22:Vr(i,o),c&2048&&Vd(o.alternate,o);break;case 24:Vr(i,o),c&2048&&$d(o.alternate,o);break;default:Vr(i,o)}n=n.sibling}}var $r=8192;function Ds(e){if(e.subtreeFlags&$r)for(e=e.child;e!==null;)dg(e),e=e.sibling}function dg(e){switch(e.tag){case 26:Ds(e),e.flags&$r&&e.memoizedState!==null&&cM(_n,e.memoizedState,e.memoizedProps);break;case 5:Ds(e);break;case 3:case 4:var n=_n;_n=Pl(e.stateNode.containerInfo),Ds(e),_n=n;break;case 22:e.memoizedState===null&&(n=e.alternate,n!==null&&n.memoizedState!==null?(n=$r,$r=16777216,Ds(e),$r=n):Ds(e));break;default:Ds(e)}}function fg(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Xr(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];Et=o,mg(o,e)}fg(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)hg(e),e=e.sibling}function hg(e){switch(e.tag){case 0:case 11:case 15:Xr(e),e.flags&2048&&ei(9,e,e.return);break;case 3:Xr(e);break;case 12:Xr(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,Bl(e)):Xr(e);break;default:Xr(e)}}function Bl(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];Et=o,mg(o,e)}fg(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:ei(8,n,n.return),Bl(n);break;case 22:i=n.stateNode,i._visibility&2&&(i._visibility&=-3,Bl(n));break;default:Bl(n)}e=e.sibling}}function mg(e,n){for(;Et!==null;){var i=Et;switch(i.tag){case 0:case 11:case 15:ei(8,i,n);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var o=i.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:Nr(i.memoizedState.cache)}if(o=i.child,o!==null)o.return=i,Et=o;else e:for(i=e;Et!==null;){o=Et;var c=o.sibling,d=o.return;if(sg(o),o===i){Et=null;break e}if(c!==null){c.return=d,Et=c;break e}Et=d}}}var wS={getCacheForType:function(e){var n=Rt(mt),i=n.data.get(e);return i===void 0&&(i=e(),n.data.set(e,i)),i}},CS=typeof WeakMap=="function"?WeakMap:Map,De=0,Ve=null,we=null,Re=0,Ie=0,rn=null,ai=!1,Is=!1,Xd=!1,Ca=0,st=0,ii=0,Gi=0,Qd=0,bn=0,Us=0,Qr=null,Kt=null,Kd=!1,Pd=0,ql=1/0,Hl=null,si=null,wt=0,ri=null,Os=null,zs=0,Zd=0,Jd=null,pg=null,Kr=0,Wd=null;function on(){if((De&2)!==0&&Re!==0)return Re&-Re;if(D.T!==null){var e=As;return e!==0?e:of()}return Xo()}function gg(){bn===0&&(bn=(Re&536870912)===0||Le?Fo():536870912);var e=yn.current;return e!==null&&(e.flags|=32),bn}function ln(e,n,i){(e===Ve&&(Ie===2||Ie===9)||e.cancelPendingCommit!==null)&&(Bs(e,0),oi(e,Re,bn,!1)),qn(e,i),((De&2)===0||e!==Ve)&&(e===Ve&&((De&2)===0&&(Gi|=i),st===4&&oi(e,Re,bn,!1)),Xn(e))}function yg(e,n,i){if((De&6)!==0)throw Error(r(327));var o=!i&&(n&124)===0&&(n&e.expiredLanes)===0||la(e,n),c=o?NS(e,n):nf(e,n,!0),d=o;do{if(c===0){Is&&!o&&oi(e,n,0,!1);break}else{if(i=e.current.alternate,d&&!TS(i)){c=nf(e,n,!1),d=!1;continue}if(c===2){if(d=n,e.errorRecoveryDisabledLanes&d)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){n=y;e:{var S=e;c=Qr;var w=S.current.memoizedState.isDehydrated;if(w&&(Bs(S,y).flags|=256),y=nf(S,y,!1),y!==2){if(Xd&&!w){S.errorRecoveryDisabledLanes|=d,Gi|=d,c=4;break e}d=Kt,Kt=c,d!==null&&(Kt===null?Kt=d:Kt.push.apply(Kt,d))}c=y}if(d=!1,c!==2)continue}}if(c===1){Bs(e,0),oi(e,n,0,!0);break}e:{switch(o=e,d=c,d){case 0:case 1:throw Error(r(345));case 4:if((n&4194048)!==n)break;case 6:oi(o,n,bn,!ai);break e;case 2:Kt=null;break;case 3:case 5:break;default:throw Error(r(329))}if((n&62914560)===n&&(c=Pd+300-fe(),10<c)){if(oi(o,n,bn,!ai),Ei(o,0,!0)!==0)break e;o.timeoutHandle=$g(bg.bind(null,o,i,Kt,Hl,Kd,n,bn,Gi,Us,ai,d,2,-0,0),c);break e}bg(o,i,Kt,Hl,Kd,n,bn,Gi,Us,ai,d,0,-0,0)}}break}while(!0);Xn(e)}function bg(e,n,i,o,c,d,y,S,w,O,Z,ie,H,G){if(e.timeoutHandle=-1,ie=n.subtreeFlags,(ie&8192||(ie&16785408)===16785408)&&(no={stylesheets:null,count:0,unsuspend:lM},dg(n),ie=uM(),ie!==null)){e.cancelPendingCommit=ie(wg.bind(null,e,n,d,i,o,c,y,S,w,Z,1,H,G)),oi(e,d,y,!O);return}wg(e,n,d,i,o,c,y,S,w)}function TS(e){for(var n=e;;){var i=n.tag;if((i===0||i===11||i===15)&&n.flags&16384&&(i=n.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var o=0;o<i.length;o++){var c=i[o],d=c.getSnapshot;c=c.value;try{if(!tn(d(),c))return!1}catch{return!1}}if(i=n.child,n.subtreeFlags&16384&&i!==null)i.return=n,n=i;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function oi(e,n,i,o){n&=~Qd,n&=~Gi,e.suspendedLanes|=n,e.pingedLanes&=~n,o&&(e.warmLanes|=n),o=e.expirationTimes;for(var c=n;0<c;){var d=31-Nt(c),y=1<<d;o[d]=-1,c&=~y}i!==0&&fr(e,i,n)}function jl(){return(De&6)===0?(Pr(0),!1):!0}function ef(){if(we!==null){if(Ie===0)var e=we.return;else e=we,ba=Oi=null,yd(e),Rs=null,Hr=0,e=we;for(;e!==null;)Z0(e.alternate,e),e=e.return;we=null}}function Bs(e,n){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,VS(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),ef(),Ve=e,we=i=pa(e.current,null),Re=n,Ie=0,rn=null,ai=!1,Is=la(e,n),Xd=!1,Us=bn=Qd=Gi=ii=st=0,Kt=Qr=null,Kd=!1,(n&8)!==0&&(n|=n&32);var o=e.entangledLanes;if(o!==0)for(e=e.entanglements,o&=n;0<o;){var c=31-Nt(o),d=1<<c;n|=e[c],o&=~d}return Ca=n,cl(),i}function vg(e,n){Ee=null,D.H=_l,n===kr||n===bl?(n=Op(),Ie=3):n===Dp?(n=Op(),Ie=4):Ie=n===z0?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,rn=n,we===null&&(st=1,Dl(e,hn(n,e.current)))}function Sg(){var e=D.H;return D.H=_l,e===null?_l:e}function Mg(){var e=D.A;return D.A=wS,e}function tf(){st=4,ai||(Re&4194048)!==Re&&yn.current!==null||(Is=!0),(ii&134217727)===0&&(Gi&134217727)===0||Ve===null||oi(Ve,Re,bn,!1)}function nf(e,n,i){var o=De;De|=2;var c=Sg(),d=Mg();(Ve!==e||Re!==n)&&(Hl=null,Bs(e,n)),n=!1;var y=st;e:do try{if(Ie!==0&&we!==null){var S=we,w=rn;switch(Ie){case 8:ef(),y=6;break e;case 3:case 2:case 9:case 6:yn.current===null&&(n=!0);var O=Ie;if(Ie=0,rn=null,qs(e,S,w,O),i&&Is){y=0;break e}break;default:O=Ie,Ie=0,rn=null,qs(e,S,w,O)}}_S(),y=st;break}catch(Z){vg(e,Z)}while(!0);return n&&e.shellSuspendCounter++,ba=Oi=null,De=o,D.H=c,D.A=d,we===null&&(Ve=null,Re=0,cl()),y}function _S(){for(;we!==null;)Eg(we)}function NS(e,n){var i=De;De|=2;var o=Sg(),c=Mg();Ve!==e||Re!==n?(Hl=null,ql=fe()+500,Bs(e,n)):Is=la(e,n);e:do try{if(Ie!==0&&we!==null){n=we;var d=rn;t:switch(Ie){case 1:Ie=0,rn=null,qs(e,n,d,1);break;case 2:case 9:if(Ip(d)){Ie=0,rn=null,xg(n);break}n=function(){Ie!==2&&Ie!==9||Ve!==e||(Ie=7),Xn(e)},d.then(n,n);break e;case 3:Ie=7;break e;case 4:Ie=5;break e;case 7:Ip(d)?(Ie=0,rn=null,xg(n)):(Ie=0,rn=null,qs(e,n,d,7));break;case 5:var y=null;switch(we.tag){case 26:y=we.memoizedState;case 5:case 27:var S=we;if(!y||iy(y)){Ie=0,rn=null;var w=S.sibling;if(w!==null)we=w;else{var O=S.return;O!==null?(we=O,Gl(O)):we=null}break t}}Ie=0,rn=null,qs(e,n,d,5);break;case 6:Ie=0,rn=null,qs(e,n,d,6);break;case 8:ef(),st=6;break e;default:throw Error(r(462))}}RS();break}catch(Z){vg(e,Z)}while(!0);return ba=Oi=null,D.H=o,D.A=c,De=i,we!==null?0:(Ve=null,Re=0,cl(),st)}function RS(){for(;we!==null&&!Mi();)Eg(we)}function Eg(e){var n=K0(e.alternate,e,Ca);e.memoizedProps=e.pendingProps,n===null?Gl(e):we=n}function xg(e){var n=e,i=n.alternate;switch(n.tag){case 15:case 0:n=Y0(i,n,n.pendingProps,n.type,void 0,Re);break;case 11:n=Y0(i,n,n.pendingProps,n.type.render,n.ref,Re);break;case 5:yd(n);default:Z0(i,n),n=we=Ap(n,Ca),n=K0(i,n,Ca)}e.memoizedProps=e.pendingProps,n===null?Gl(e):we=n}function qs(e,n,i,o){ba=Oi=null,yd(n),Rs=null,Hr=0;var c=n.return;try{if(vS(e,c,n,i,Re)){st=1,Dl(e,hn(i,e.current)),we=null;return}}catch(d){if(c!==null)throw we=c,d;st=1,Dl(e,hn(i,e.current)),we=null;return}n.flags&32768?(Le||o===1?e=!0:Is||(Re&536870912)!==0?e=!1:(ai=e=!0,(o===2||o===9||o===3||o===6)&&(o=yn.current,o!==null&&o.tag===13&&(o.flags|=16384))),Ag(n,e)):Gl(n)}function Gl(e){var n=e;do{if((n.flags&32768)!==0){Ag(n,ai);return}e=n.return;var i=MS(n.alternate,n,Ca);if(i!==null){we=i;return}if(n=n.sibling,n!==null){we=n;return}we=n=e}while(n!==null);st===0&&(st=5)}function Ag(e,n){do{var i=ES(e.alternate,e);if(i!==null){i.flags&=32767,we=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!n&&(e=e.sibling,e!==null)){we=e;return}we=e=i}while(e!==null);st=6,we=null}function wg(e,n,i,o,c,d,y,S,w){e.cancelPendingCommit=null;do Yl();while(wt!==0);if((De&6)!==0)throw Error(r(327));if(n!==null){if(n===e.current)throw Error(r(177));if(d=n.lanes|n.childLanes,d|=$u,$o(e,i,d,y,S,w),e===Ve&&(we=Ve=null,Re=0),Os=n,ri=e,zs=i,Zd=d,Jd=c,pg=o,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,IS(vt,function(){return Rg(),null})):(e.callbackNode=null,e.callbackPriority=0),o=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||o){o=D.T,D.T=null,c=P.p,P.p=2,y=De,De|=4;try{xS(e,n,i)}finally{De=y,P.p=c,D.T=o}}wt=1,Cg(),Tg(),_g()}}function Cg(){if(wt===1){wt=0;var e=ri,n=Os,i=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||i){i=D.T,D.T=null;var o=P.p;P.p=2;var c=De;De|=4;try{lg(n,e);var d=pf,y=mp(e.containerInfo),S=d.focusedElem,w=d.selectionRange;if(y!==S&&S&&S.ownerDocument&&hp(S.ownerDocument.documentElement,S)){if(w!==null&&ju(S)){var O=w.start,Z=w.end;if(Z===void 0&&(Z=O),"selectionStart"in S)S.selectionStart=O,S.selectionEnd=Math.min(Z,S.value.length);else{var ie=S.ownerDocument||document,H=ie&&ie.defaultView||window;if(H.getSelection){var G=H.getSelection(),ve=S.textContent.length,ye=Math.min(w.start,ve),He=w.end===void 0?ye:Math.min(w.end,ve);!G.extend&&ye>He&&(y=He,He=ye,ye=y);var L=fp(S,ye),N=fp(S,He);if(L&&N&&(G.rangeCount!==1||G.anchorNode!==L.node||G.anchorOffset!==L.offset||G.focusNode!==N.node||G.focusOffset!==N.offset)){var U=ie.createRange();U.setStart(L.node,L.offset),G.removeAllRanges(),ye>He?(G.addRange(U),G.extend(N.node,N.offset)):(U.setEnd(N.node,N.offset),G.addRange(U))}}}}for(ie=[],G=S;G=G.parentNode;)G.nodeType===1&&ie.push({element:G,left:G.scrollLeft,top:G.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<ie.length;S++){var W=ie[S];W.element.scrollLeft=W.left,W.element.scrollTop=W.top}}tc=!!mf,pf=mf=null}finally{De=c,P.p=o,D.T=i}}e.current=n,wt=2}}function Tg(){if(wt===2){wt=0;var e=ri,n=Os,i=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||i){i=D.T,D.T=null;var o=P.p;P.p=2;var c=De;De|=4;try{ig(e,n.alternate,n)}finally{De=c,P.p=o,D.T=i}}wt=3}}function _g(){if(wt===4||wt===3){wt=0,os();var e=ri,n=Os,i=zs,o=pg;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?wt=5:(wt=0,Os=ri=null,Ng(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(si=null),pr(i),n=n.stateNode,Pe&&typeof Pe.onCommitFiberRoot=="function")try{Pe.onCommitFiberRoot(Qe,n,void 0,(n.current.flags&128)===128)}catch{}if(o!==null){n=D.T,c=P.p,P.p=2,D.T=null;try{for(var d=e.onRecoverableError,y=0;y<o.length;y++){var S=o[y];d(S.value,{componentStack:S.stack})}}finally{D.T=n,P.p=c}}(zs&3)!==0&&Yl(),Xn(e),c=e.pendingLanes,(i&4194090)!==0&&(c&42)!==0?e===Wd?Kr++:(Kr=0,Wd=e):Kr=0,Pr(0)}}function Ng(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,Nr(n)))}function Yl(e){return Cg(),Tg(),_g(),Rg()}function Rg(){if(wt!==5)return!1;var e=ri,n=Zd;Zd=0;var i=pr(zs),o=D.T,c=P.p;try{P.p=32>i?32:i,D.T=null,i=Jd,Jd=null;var d=ri,y=zs;if(wt=0,Os=ri=null,zs=0,(De&6)!==0)throw Error(r(331));var S=De;if(De|=4,hg(d.current),ug(d,d.current,y,i),De=S,Pr(0,!1),Pe&&typeof Pe.onPostCommitFiberRoot=="function")try{Pe.onPostCommitFiberRoot(Qe,d)}catch{}return!0}finally{P.p=c,D.T=o,Ng(e,n)}}function kg(e,n,i){n=hn(i,n),n=kd(e.stateNode,n,2),e=Pa(e,n,2),e!==null&&(qn(e,2),Xn(e))}function Fe(e,n,i){if(e.tag===3)kg(e,e,i);else for(;n!==null;){if(n.tag===3){kg(n,e,i);break}else if(n.tag===1){var o=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(si===null||!si.has(o))){e=hn(i,e),i=U0(2),o=Pa(n,i,2),o!==null&&(O0(i,o,n,e),qn(o,2),Xn(o));break}}n=n.return}}function af(e,n,i){var o=e.pingCache;if(o===null){o=e.pingCache=new CS;var c=new Set;o.set(n,c)}else c=o.get(n),c===void 0&&(c=new Set,o.set(n,c));c.has(i)||(Xd=!0,c.add(i),e=kS.bind(null,e,n,i),n.then(e,e))}function kS(e,n,i){var o=e.pingCache;o!==null&&o.delete(n),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Ve===e&&(Re&i)===i&&(st===4||st===3&&(Re&62914560)===Re&&300>fe()-Pd?(De&2)===0&&Bs(e,0):Qd|=i,Us===Re&&(Us=0)),Xn(e)}function Lg(e,n){n===0&&(n=Vo()),e=Ss(e,n),e!==null&&(qn(e,n),Xn(e))}function LS(e){var n=e.memoizedState,i=0;n!==null&&(i=n.retryLane),Lg(e,i)}function DS(e,n){var i=0;switch(e.tag){case 13:var o=e.stateNode,c=e.memoizedState;c!==null&&(i=c.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(r(314))}o!==null&&o.delete(n),Lg(e,i)}function IS(e,n){return zn(e,n)}var Fl=null,Hs=null,sf=!1,Vl=!1,rf=!1,Yi=0;function Xn(e){e!==Hs&&e.next===null&&(Hs===null?Fl=Hs=e:Hs=Hs.next=e),Vl=!0,sf||(sf=!0,OS())}function Pr(e,n){if(!rf&&Vl){rf=!0;do for(var i=!1,o=Fl;o!==null;){if(e!==0){var c=o.pendingLanes;if(c===0)var d=0;else{var y=o.suspendedLanes,S=o.pingedLanes;d=(1<<31-Nt(42|e)+1)-1,d&=c&~(y&~S),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(i=!0,Og(o,d))}else d=Re,d=Ei(o,o===Ve?d:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),(d&3)===0||la(o,d)||(i=!0,Og(o,d));o=o.next}while(i);rf=!1}}function US(){Dg()}function Dg(){Vl=sf=!1;var e=0;Yi!==0&&(FS()&&(e=Yi),Yi=0);for(var n=fe(),i=null,o=Fl;o!==null;){var c=o.next,d=Ig(o,n);d===0?(o.next=null,i===null?Fl=c:i.next=c,c===null&&(Hs=i)):(i=o,(e!==0||(d&3)!==0)&&(Vl=!0)),o=c}Pr(e)}function Ig(e,n){for(var i=e.suspendedLanes,o=e.pingedLanes,c=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var y=31-Nt(d),S=1<<y,w=c[y];w===-1?((S&i)===0||(S&o)!==0)&&(c[y]=Tu(S,n)):w<=n&&(e.expiredLanes|=S),d&=~S}if(n=Ve,i=Re,i=Ei(e,e===n?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o=e.callbackNode,i===0||e===n&&(Ie===2||Ie===9)||e.cancelPendingCommit!==null)return o!==null&&o!==null&&dn(o),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||la(e,i)){if(n=i&-i,n===e.callbackPriority)return n;switch(o!==null&&dn(o),pr(i)){case 2:case 8:i=ze;break;case 32:i=vt;break;case 268435456:i=Zt;break;default:i=vt}return o=Ug.bind(null,e),i=zn(i,o),e.callbackPriority=n,e.callbackNode=i,n}return o!==null&&o!==null&&dn(o),e.callbackPriority=2,e.callbackNode=null,2}function Ug(e,n){if(wt!==0&&wt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(Yl()&&e.callbackNode!==i)return null;var o=Re;return o=Ei(e,e===Ve?o:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o===0?null:(yg(e,o,n),Ig(e,fe()),e.callbackNode!=null&&e.callbackNode===i?Ug.bind(null,e):null)}function Og(e,n){if(Yl())return null;yg(e,n,!0)}function OS(){$S(function(){(De&6)!==0?zn(Ge,US):Dg()})}function of(){return Yi===0&&(Yi=Fo()),Yi}function zg(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:nl(""+e)}function Bg(e,n){var i=n.ownerDocument.createElement("input");return i.name=n.name,i.value=n.value,e.id&&i.setAttribute("form",e.id),n.parentNode.insertBefore(i,n),e=new FormData(e),i.parentNode.removeChild(i),e}function zS(e,n,i,o,c){if(n==="submit"&&i&&i.stateNode===c){var d=zg((c[ft]||null).action),y=o.submitter;y&&(n=(n=y[ft]||null)?zg(n.formAction):y.getAttribute("formAction"),n!==null&&(d=n,y=null));var S=new rl("action","action",null,o,c);e.push({event:S,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(Yi!==0){var w=y?Bg(c,y):new FormData(c);Cd(i,{pending:!0,data:w,method:c.method,action:d},null,w)}}else typeof d=="function"&&(S.preventDefault(),w=y?Bg(c,y):new FormData(c),Cd(i,{pending:!0,data:w,method:c.method,action:d},d,w))},currentTarget:c}]})}}for(var lf=0;lf<Vu.length;lf++){var cf=Vu[lf],BS=cf.toLowerCase(),qS=cf[0].toUpperCase()+cf.slice(1);Tn(BS,"on"+qS)}Tn(yp,"onAnimationEnd"),Tn(bp,"onAnimationIteration"),Tn(vp,"onAnimationStart"),Tn("dblclick","onDoubleClick"),Tn("focusin","onFocus"),Tn("focusout","onBlur"),Tn(nS,"onTransitionRun"),Tn(aS,"onTransitionStart"),Tn(iS,"onTransitionCancel"),Tn(Sp,"onTransitionEnd"),Ya("onMouseEnter",["mouseout","mouseover"]),Ya("onMouseLeave",["mouseout","mouseover"]),Ya("onPointerEnter",["pointerout","pointerover"]),Ya("onPointerLeave",["pointerout","pointerover"]),jn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),jn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),jn("onBeforeInput",["compositionend","keypress","textInput","paste"]),jn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),jn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),jn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zr));function qg(e,n){n=(n&4)!==0;for(var i=0;i<e.length;i++){var o=e[i],c=o.event;o=o.listeners;e:{var d=void 0;if(n)for(var y=o.length-1;0<=y;y--){var S=o[y],w=S.instance,O=S.currentTarget;if(S=S.listener,w!==d&&c.isPropagationStopped())break e;d=S,c.currentTarget=O;try{d(c)}catch(Z){Ll(Z)}c.currentTarget=null,d=w}else for(y=0;y<o.length;y++){if(S=o[y],w=S.instance,O=S.currentTarget,S=S.listener,w!==d&&c.isPropagationStopped())break e;d=S,c.currentTarget=O;try{d(c)}catch(Z){Ll(Z)}c.currentTarget=null,d=w}}}}function Ce(e,n){var i=n[ja];i===void 0&&(i=n[ja]=new Set);var o=e+"__bubble";i.has(o)||(Hg(n,e,2,!1),i.add(o))}function uf(e,n,i){var o=0;n&&(o|=4),Hg(i,e,o,n)}var $l="_reactListening"+Math.random().toString(36).slice(2);function df(e){if(!e[$l]){e[$l]=!0,fs.forEach(function(i){i!=="selectionchange"&&(HS.has(i)||uf(i,!1,e),uf(i,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[$l]||(n[$l]=!0,uf("selectionchange",!1,n))}}function Hg(e,n,i,o){switch(uy(n)){case 2:var c=hM;break;case 8:c=mM;break;default:c=wf}i=c.bind(null,n,i,e),c=void 0,!Lu||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(c=!0),o?c!==void 0?e.addEventListener(n,i,{capture:!0,passive:c}):e.addEventListener(n,i,!0):c!==void 0?e.addEventListener(n,i,{passive:c}):e.addEventListener(n,i,!1)}function ff(e,n,i,o,c){var d=o;if((n&1)===0&&(n&2)===0&&o!==null)e:for(;;){if(o===null)return;var y=o.tag;if(y===3||y===4){var S=o.stateNode.containerInfo;if(S===c)break;if(y===4)for(y=o.return;y!==null;){var w=y.tag;if((w===3||w===4)&&y.stateNode.containerInfo===c)return;y=y.return}for(;S!==null;){if(y=ua(S),y===null)return;if(w=y.tag,w===5||w===6||w===26||w===27){o=d=y;continue e}S=S.parentNode}}o=o.return}Xm(function(){var O=d,Z=Ru(i),ie=[];e:{var H=Mp.get(e);if(H!==void 0){var G=rl,ve=e;switch(e){case"keypress":if(il(i)===0)break e;case"keydown":case"keyup":G=I1;break;case"focusin":ve="focus",G=Ou;break;case"focusout":ve="blur",G=Ou;break;case"beforeblur":case"afterblur":G=Ou;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=Pm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=E1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=z1;break;case yp:case bp:case vp:G=w1;break;case Sp:G=q1;break;case"scroll":case"scrollend":G=S1;break;case"wheel":G=j1;break;case"copy":case"cut":case"paste":G=T1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=Jm;break;case"toggle":case"beforetoggle":G=Y1}var ye=(n&4)!==0,He=!ye&&(e==="scroll"||e==="scrollend"),L=ye?H!==null?H+"Capture":null:H;ye=[];for(var N=O,U;N!==null;){var W=N;if(U=W.stateNode,W=W.tag,W!==5&&W!==26&&W!==27||U===null||L===null||(W=gr(N,L),W!=null&&ye.push(Jr(N,W,U))),He)break;N=N.return}0<ye.length&&(H=new G(H,ve,null,i,Z),ie.push({event:H,listeners:ye}))}}if((n&7)===0){e:{if(H=e==="mouseover"||e==="pointerover",G=e==="mouseout"||e==="pointerout",H&&i!==Nu&&(ve=i.relatedTarget||i.fromElement)&&(ua(ve)||ve[ca]))break e;if((G||H)&&(H=Z.window===Z?Z:(H=Z.ownerDocument)?H.defaultView||H.parentWindow:window,G?(ve=i.relatedTarget||i.toElement,G=O,ve=ve?ua(ve):null,ve!==null&&(He=u(ve),ye=ve.tag,ve!==He||ye!==5&&ye!==27&&ye!==6)&&(ve=null)):(G=null,ve=O),G!==ve)){if(ye=Pm,W="onMouseLeave",L="onMouseEnter",N="mouse",(e==="pointerout"||e==="pointerover")&&(ye=Jm,W="onPointerLeave",L="onPointerEnter",N="pointer"),He=G==null?H:da(G),U=ve==null?H:da(ve),H=new ye(W,N+"leave",G,i,Z),H.target=He,H.relatedTarget=U,W=null,ua(Z)===O&&(ye=new ye(L,N+"enter",ve,i,Z),ye.target=U,ye.relatedTarget=He,W=ye),He=W,G&&ve)t:{for(ye=G,L=ve,N=0,U=ye;U;U=js(U))N++;for(U=0,W=L;W;W=js(W))U++;for(;0<N-U;)ye=js(ye),N--;for(;0<U-N;)L=js(L),U--;for(;N--;){if(ye===L||L!==null&&ye===L.alternate)break t;ye=js(ye),L=js(L)}ye=null}else ye=null;G!==null&&jg(ie,H,G,ye,!1),ve!==null&&He!==null&&jg(ie,He,ve,ye,!0)}}e:{if(H=O?da(O):window,G=H.nodeName&&H.nodeName.toLowerCase(),G==="select"||G==="input"&&H.type==="file")var he=rp;else if(ip(H))if(op)he=W1;else{he=Z1;var Ae=P1}else G=H.nodeName,!G||G.toLowerCase()!=="input"||H.type!=="checkbox"&&H.type!=="radio"?O&&_u(O.elementType)&&(he=rp):he=J1;if(he&&(he=he(e,O))){sp(ie,he,i,Z);break e}Ae&&Ae(e,H,O),e==="focusout"&&O&&H.type==="number"&&O.memoizedProps.value!=null&&Va(H,"number",H.value)}switch(Ae=O?da(O):window,e){case"focusin":(ip(Ae)||Ae.contentEditable==="true")&&(ys=Ae,Gu=O,Ar=null);break;case"focusout":Ar=Gu=ys=null;break;case"mousedown":Yu=!0;break;case"contextmenu":case"mouseup":case"dragend":Yu=!1,pp(ie,i,Z);break;case"selectionchange":if(tS)break;case"keydown":case"keyup":pp(ie,i,Z)}var pe;if(Bu)e:{switch(e){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else gs?np(e,i)&&(be="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(be="onCompositionStart");be&&(Wm&&i.locale!=="ko"&&(gs||be!=="onCompositionStart"?be==="onCompositionEnd"&&gs&&(pe=Qm()):($a=Z,Du="value"in $a?$a.value:$a.textContent,gs=!0)),Ae=Xl(O,be),0<Ae.length&&(be=new Zm(be,e,null,i,Z),ie.push({event:be,listeners:Ae}),pe?be.data=pe:(pe=ap(i),pe!==null&&(be.data=pe)))),(pe=V1?$1(e,i):X1(e,i))&&(be=Xl(O,"onBeforeInput"),0<be.length&&(Ae=new Zm("onBeforeInput","beforeinput",null,i,Z),ie.push({event:Ae,listeners:be}),Ae.data=pe)),zS(ie,e,O,i,Z)}qg(ie,n)})}function Jr(e,n,i){return{instance:e,listener:n,currentTarget:i}}function Xl(e,n){for(var i=n+"Capture",o=[];e!==null;){var c=e,d=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||d===null||(c=gr(e,i),c!=null&&o.unshift(Jr(e,c,d)),c=gr(e,n),c!=null&&o.push(Jr(e,c,d))),e.tag===3)return o;e=e.return}return[]}function js(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function jg(e,n,i,o,c){for(var d=n._reactName,y=[];i!==null&&i!==o;){var S=i,w=S.alternate,O=S.stateNode;if(S=S.tag,w!==null&&w===o)break;S!==5&&S!==26&&S!==27||O===null||(w=O,c?(O=gr(i,d),O!=null&&y.unshift(Jr(i,O,w))):c||(O=gr(i,d),O!=null&&y.push(Jr(i,O,w)))),i=i.return}y.length!==0&&e.push({event:n,listeners:y})}var jS=/\r\n?/g,GS=/\u0000|\uFFFD/g;function Gg(e){return(typeof e=="string"?e:""+e).replace(jS,`
`).replace(GS,"")}function Yg(e,n){return n=Gg(n),Gg(e)===n}function Ql(){}function qe(e,n,i,o,c,d){switch(i){case"children":typeof o=="string"?n==="body"||n==="textarea"&&o===""||hs(e,o):(typeof o=="number"||typeof o=="bigint")&&n!=="body"&&hs(e,""+o);break;case"className":Ci(e,"class",o);break;case"tabIndex":Ci(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":Ci(e,i,o);break;case"style":Vm(e,o,d);break;case"data":if(n!=="object"){Ci(e,"data",o);break}case"src":case"href":if(o===""&&(n!=="a"||i!=="href")){e.removeAttribute(i);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(i);break}o=nl(""+o),e.setAttribute(i,o);break;case"action":case"formAction":if(typeof o=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(i==="formAction"?(n!=="input"&&qe(e,n,"name",c.name,c,null),qe(e,n,"formEncType",c.formEncType,c,null),qe(e,n,"formMethod",c.formMethod,c,null),qe(e,n,"formTarget",c.formTarget,c,null)):(qe(e,n,"encType",c.encType,c,null),qe(e,n,"method",c.method,c,null),qe(e,n,"target",c.target,c,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(i);break}o=nl(""+o),e.setAttribute(i,o);break;case"onClick":o!=null&&(e.onclick=Ql);break;case"onScroll":o!=null&&Ce("scroll",e);break;case"onScrollEnd":o!=null&&Ce("scrollend",e);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(i=o.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"multiple":e.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":e.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){e.removeAttribute("xlink:href");break}i=nl(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,""+o):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":o===!0?e.setAttribute(i,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,o):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?e.setAttribute(i,o):e.removeAttribute(i);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?e.removeAttribute(i):e.setAttribute(i,o);break;case"popover":Ce("beforetoggle",e),Ce("toggle",e),wi(e,"popover",o);break;case"xlinkActuate":Cn(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":Cn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":Cn(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":Cn(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":Cn(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":Cn(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":Cn(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":Cn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":Cn(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":wi(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=b1.get(i)||i,wi(e,i,o))}}function hf(e,n,i,o,c,d){switch(i){case"style":Vm(e,o,d);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(i=o.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"children":typeof o=="string"?hs(e,o):(typeof o=="number"||typeof o=="bigint")&&hs(e,""+o);break;case"onScroll":o!=null&&Ce("scroll",e);break;case"onScrollEnd":o!=null&&Ce("scrollend",e);break;case"onClick":o!=null&&(e.onclick=Ql);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ko.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(c=i.endsWith("Capture"),n=i.slice(2,c?i.length-7:void 0),d=e[ft]||null,d=d!=null?d[i]:null,typeof d=="function"&&e.removeEventListener(n,d,c),typeof o=="function")){typeof d!="function"&&d!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(n,o,c);break e}i in e?e[i]=o:o===!0?e.setAttribute(i,""):wi(e,i,o)}}}function Ct(e,n,i){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ce("error",e),Ce("load",e);var o=!1,c=!1,d;for(d in i)if(i.hasOwnProperty(d)){var y=i[d];if(y!=null)switch(d){case"src":o=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,n));default:qe(e,n,d,y,i,null)}}c&&qe(e,n,"srcSet",i.srcSet,i,null),o&&qe(e,n,"src",i.src,i,null);return;case"input":Ce("invalid",e);var S=d=y=c=null,w=null,O=null;for(o in i)if(i.hasOwnProperty(o)){var Z=i[o];if(Z!=null)switch(o){case"name":c=Z;break;case"type":y=Z;break;case"checked":w=Z;break;case"defaultChecked":O=Z;break;case"value":d=Z;break;case"defaultValue":S=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(r(137,n));break;default:qe(e,n,o,Z,i,null)}}Fa(e,d,S,w,O,y,c,!1),St(e);return;case"select":Ce("invalid",e),o=y=d=null;for(c in i)if(i.hasOwnProperty(c)&&(S=i[c],S!=null))switch(c){case"value":d=S;break;case"defaultValue":y=S;break;case"multiple":o=S;default:qe(e,n,c,S,i,null)}n=d,i=y,e.multiple=!!o,n!=null?ha(e,!!o,n,!1):i!=null&&ha(e,!!o,i,!0);return;case"textarea":Ce("invalid",e),d=c=o=null;for(y in i)if(i.hasOwnProperty(y)&&(S=i[y],S!=null))switch(y){case"value":o=S;break;case"defaultValue":c=S;break;case"children":d=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(r(91));break;default:qe(e,n,y,S,i,null)}tl(e,o,c,d),St(e);return;case"option":for(w in i)if(i.hasOwnProperty(w)&&(o=i[w],o!=null))switch(w){case"selected":e.selected=o&&typeof o!="function"&&typeof o!="symbol";break;default:qe(e,n,w,o,i,null)}return;case"dialog":Ce("beforetoggle",e),Ce("toggle",e),Ce("cancel",e),Ce("close",e);break;case"iframe":case"object":Ce("load",e);break;case"video":case"audio":for(o=0;o<Zr.length;o++)Ce(Zr[o],e);break;case"image":Ce("error",e),Ce("load",e);break;case"details":Ce("toggle",e);break;case"embed":case"source":case"link":Ce("error",e),Ce("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(O in i)if(i.hasOwnProperty(O)&&(o=i[O],o!=null))switch(O){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,n));default:qe(e,n,O,o,i,null)}return;default:if(_u(n)){for(Z in i)i.hasOwnProperty(Z)&&(o=i[Z],o!==void 0&&hf(e,n,Z,o,i,void 0));return}}for(S in i)i.hasOwnProperty(S)&&(o=i[S],o!=null&&qe(e,n,S,o,i,null))}function YS(e,n,i,o){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,d=null,y=null,S=null,w=null,O=null,Z=null;for(G in i){var ie=i[G];if(i.hasOwnProperty(G)&&ie!=null)switch(G){case"checked":break;case"value":break;case"defaultValue":w=ie;default:o.hasOwnProperty(G)||qe(e,n,G,null,o,ie)}}for(var H in o){var G=o[H];if(ie=i[H],o.hasOwnProperty(H)&&(G!=null||ie!=null))switch(H){case"type":d=G;break;case"name":c=G;break;case"checked":O=G;break;case"defaultChecked":Z=G;break;case"value":y=G;break;case"defaultValue":S=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(r(137,n));break;default:G!==ie&&qe(e,n,H,G,o,ie)}}at(e,y,S,w,O,Z,d,c);return;case"select":G=y=S=H=null;for(d in i)if(w=i[d],i.hasOwnProperty(d)&&w!=null)switch(d){case"value":break;case"multiple":G=w;default:o.hasOwnProperty(d)||qe(e,n,d,null,o,w)}for(c in o)if(d=o[c],w=i[c],o.hasOwnProperty(c)&&(d!=null||w!=null))switch(c){case"value":H=d;break;case"defaultValue":S=d;break;case"multiple":y=d;default:d!==w&&qe(e,n,c,d,o,w)}n=S,i=y,o=G,H!=null?ha(e,!!i,H,!1):!!o!=!!i&&(n!=null?ha(e,!!i,n,!0):ha(e,!!i,i?[]:"",!1));return;case"textarea":G=H=null;for(S in i)if(c=i[S],i.hasOwnProperty(S)&&c!=null&&!o.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:qe(e,n,S,null,o,c)}for(y in o)if(c=o[y],d=i[y],o.hasOwnProperty(y)&&(c!=null||d!=null))switch(y){case"value":H=c;break;case"defaultValue":G=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(r(91));break;default:c!==d&&qe(e,n,y,c,o,d)}Gn(e,H,G);return;case"option":for(var ve in i)if(H=i[ve],i.hasOwnProperty(ve)&&H!=null&&!o.hasOwnProperty(ve))switch(ve){case"selected":e.selected=!1;break;default:qe(e,n,ve,null,o,H)}for(w in o)if(H=o[w],G=i[w],o.hasOwnProperty(w)&&H!==G&&(H!=null||G!=null))switch(w){case"selected":e.selected=H&&typeof H!="function"&&typeof H!="symbol";break;default:qe(e,n,w,H,o,G)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ye in i)H=i[ye],i.hasOwnProperty(ye)&&H!=null&&!o.hasOwnProperty(ye)&&qe(e,n,ye,null,o,H);for(O in o)if(H=o[O],G=i[O],o.hasOwnProperty(O)&&H!==G&&(H!=null||G!=null))switch(O){case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(r(137,n));break;default:qe(e,n,O,H,o,G)}return;default:if(_u(n)){for(var He in i)H=i[He],i.hasOwnProperty(He)&&H!==void 0&&!o.hasOwnProperty(He)&&hf(e,n,He,void 0,o,H);for(Z in o)H=o[Z],G=i[Z],!o.hasOwnProperty(Z)||H===G||H===void 0&&G===void 0||hf(e,n,Z,H,o,G);return}}for(var L in i)H=i[L],i.hasOwnProperty(L)&&H!=null&&!o.hasOwnProperty(L)&&qe(e,n,L,null,o,H);for(ie in o)H=o[ie],G=i[ie],!o.hasOwnProperty(ie)||H===G||H==null&&G==null||qe(e,n,ie,H,o,G)}var mf=null,pf=null;function Kl(e){return e.nodeType===9?e:e.ownerDocument}function Fg(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Vg(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function gf(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var yf=null;function FS(){var e=window.event;return e&&e.type==="popstate"?e===yf?!1:(yf=e,!0):(yf=null,!1)}var $g=typeof setTimeout=="function"?setTimeout:void 0,VS=typeof clearTimeout=="function"?clearTimeout:void 0,Xg=typeof Promise=="function"?Promise:void 0,$S=typeof queueMicrotask=="function"?queueMicrotask:typeof Xg<"u"?function(e){return Xg.resolve(null).then(e).catch(XS)}:$g;function XS(e){setTimeout(function(){throw e})}function li(e){return e==="head"}function Qg(e,n){var i=n,o=0,c=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(0<o&&8>o){i=o;var y=e.ownerDocument;if(i&1&&Wr(y.documentElement),i&2&&Wr(y.body),i&4)for(i=y.head,Wr(i),y=i.firstChild;y;){var S=y.nextSibling,w=y.nodeName;y[Ai]||w==="SCRIPT"||w==="STYLE"||w==="LINK"&&y.rel.toLowerCase()==="stylesheet"||i.removeChild(y),y=S}}if(c===0){e.removeChild(d),oo(n);return}c--}else i==="$"||i==="$?"||i==="$!"?c++:o=i.charCodeAt(0)-48;else o=0;i=d}while(i);oo(n)}function bf(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var i=n;switch(n=n.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":bf(i),ds(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function QS(e,n,i,o){for(;e.nodeType===1;){var c=i;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!o&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(o){if(!e[Ai])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var d=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=Nn(e.nextSibling),e===null)break}return null}function KS(e,n,i){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=Nn(e.nextSibling),e===null))return null;return e}function vf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function PS(e,n){var i=e.ownerDocument;if(e.data!=="$?"||i.readyState==="complete")n();else{var o=function(){n(),i.removeEventListener("DOMContentLoaded",o)};i.addEventListener("DOMContentLoaded",o),e._reactRetry=o}}function Nn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="F!"||n==="F")break;if(n==="/$")return null}}return e}var Sf=null;function Kg(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(n===0)return e;n--}else i==="/$"&&n++}e=e.previousSibling}return null}function Pg(e,n,i){switch(n=Kl(i),e){case"html":if(e=n.documentElement,!e)throw Error(r(452));return e;case"head":if(e=n.head,!e)throw Error(r(453));return e;case"body":if(e=n.body,!e)throw Error(r(454));return e;default:throw Error(r(451))}}function Wr(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);ds(e)}var vn=new Map,Zg=new Set;function Pl(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ta=P.d;P.d={f:ZS,r:JS,D:WS,C:eM,L:tM,m:nM,X:iM,S:aM,M:sM};function ZS(){var e=Ta.f(),n=jl();return e||n}function JS(e){var n=Ga(e);n!==null&&n.tag===5&&n.type==="form"?y0(n):Ta.r(e)}var Gs=typeof document>"u"?null:document;function Jg(e,n,i){var o=Gs;if(o&&typeof n=="string"&&n){var c=ht(n);c='link[rel="'+e+'"][href="'+c+'"]',typeof i=="string"&&(c+='[crossorigin="'+i+'"]'),Zg.has(c)||(Zg.add(c),e={rel:e,crossOrigin:i,href:n},o.querySelector(c)===null&&(n=o.createElement("link"),Ct(n,"link",e),tt(n),o.head.appendChild(n)))}}function WS(e){Ta.D(e),Jg("dns-prefetch",e,null)}function eM(e,n){Ta.C(e,n),Jg("preconnect",e,n)}function tM(e,n,i){Ta.L(e,n,i);var o=Gs;if(o&&e&&n){var c='link[rel="preload"][as="'+ht(n)+'"]';n==="image"&&i&&i.imageSrcSet?(c+='[imagesrcset="'+ht(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(c+='[imagesizes="'+ht(i.imageSizes)+'"]')):c+='[href="'+ht(e)+'"]';var d=c;switch(n){case"style":d=Ys(e);break;case"script":d=Fs(e)}vn.has(d)||(e=g({rel:"preload",href:n==="image"&&i&&i.imageSrcSet?void 0:e,as:n},i),vn.set(d,e),o.querySelector(c)!==null||n==="style"&&o.querySelector(eo(d))||n==="script"&&o.querySelector(to(d))||(n=o.createElement("link"),Ct(n,"link",e),tt(n),o.head.appendChild(n)))}}function nM(e,n){Ta.m(e,n);var i=Gs;if(i&&e){var o=n&&typeof n.as=="string"?n.as:"script",c='link[rel="modulepreload"][as="'+ht(o)+'"][href="'+ht(e)+'"]',d=c;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=Fs(e)}if(!vn.has(d)&&(e=g({rel:"modulepreload",href:e},n),vn.set(d,e),i.querySelector(c)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(to(d)))return}o=i.createElement("link"),Ct(o,"link",e),tt(o),i.head.appendChild(o)}}}function aM(e,n,i){Ta.S(e,n,i);var o=Gs;if(o&&e){var c=fa(o).hoistableStyles,d=Ys(e);n=n||"default";var y=c.get(d);if(!y){var S={loading:0,preload:null};if(y=o.querySelector(eo(d)))S.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":n},i),(i=vn.get(d))&&Mf(e,i);var w=y=o.createElement("link");tt(w),Ct(w,"link",e),w._p=new Promise(function(O,Z){w.onload=O,w.onerror=Z}),w.addEventListener("load",function(){S.loading|=1}),w.addEventListener("error",function(){S.loading|=2}),S.loading|=4,Zl(y,n,o)}y={type:"stylesheet",instance:y,count:1,state:S},c.set(d,y)}}}function iM(e,n){Ta.X(e,n);var i=Gs;if(i&&e){var o=fa(i).hoistableScripts,c=Fs(e),d=o.get(c);d||(d=i.querySelector(to(c)),d||(e=g({src:e,async:!0},n),(n=vn.get(c))&&Ef(e,n),d=i.createElement("script"),tt(d),Ct(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},o.set(c,d))}}function sM(e,n){Ta.M(e,n);var i=Gs;if(i&&e){var o=fa(i).hoistableScripts,c=Fs(e),d=o.get(c);d||(d=i.querySelector(to(c)),d||(e=g({src:e,async:!0,type:"module"},n),(n=vn.get(c))&&Ef(e,n),d=i.createElement("script"),tt(d),Ct(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},o.set(c,d))}}function Wg(e,n,i,o){var c=(c=ue.current)?Pl(c):null;if(!c)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(n=Ys(i.href),i=fa(c).hoistableStyles,o=i.get(n),o||(o={type:"style",instance:null,count:0,state:null},i.set(n,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=Ys(i.href);var d=fa(c).hoistableStyles,y=d.get(e);if(y||(c=c.ownerDocument||c,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,y),(d=c.querySelector(eo(e)))&&!d._p&&(y.instance=d,y.state.loading=5),vn.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},vn.set(e,i),d||rM(c,e,i,y.state))),n&&o===null)throw Error(r(528,""));return y}if(n&&o!==null)throw Error(r(529,""));return null;case"script":return n=i.async,i=i.src,typeof i=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Fs(i),i=fa(c).hoistableScripts,o=i.get(n),o||(o={type:"script",instance:null,count:0,state:null},i.set(n,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function Ys(e){return'href="'+ht(e)+'"'}function eo(e){return'link[rel="stylesheet"]['+e+"]"}function ey(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function rM(e,n,i,o){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?o.loading=1:(n=e.createElement("link"),o.preload=n,n.addEventListener("load",function(){return o.loading|=1}),n.addEventListener("error",function(){return o.loading|=2}),Ct(n,"link",i),tt(n),e.head.appendChild(n))}function Fs(e){return'[src="'+ht(e)+'"]'}function to(e){return"script[async]"+e}function ty(e,n,i){if(n.count++,n.instance===null)switch(n.type){case"style":var o=e.querySelector('style[data-href~="'+ht(i.href)+'"]');if(o)return n.instance=o,tt(o),o;var c=g({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return o=(e.ownerDocument||e).createElement("style"),tt(o),Ct(o,"style",c),Zl(o,i.precedence,e),n.instance=o;case"stylesheet":c=Ys(i.href);var d=e.querySelector(eo(c));if(d)return n.state.loading|=4,n.instance=d,tt(d),d;o=ey(i),(c=vn.get(c))&&Mf(o,c),d=(e.ownerDocument||e).createElement("link"),tt(d);var y=d;return y._p=new Promise(function(S,w){y.onload=S,y.onerror=w}),Ct(d,"link",o),n.state.loading|=4,Zl(d,i.precedence,e),n.instance=d;case"script":return d=Fs(i.src),(c=e.querySelector(to(d)))?(n.instance=c,tt(c),c):(o=i,(c=vn.get(d))&&(o=g({},i),Ef(o,c)),e=e.ownerDocument||e,c=e.createElement("script"),tt(c),Ct(c,"link",o),e.head.appendChild(c),n.instance=c);case"void":return null;default:throw Error(r(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(o=n.instance,n.state.loading|=4,Zl(o,i.precedence,e));return n.instance}function Zl(e,n,i){for(var o=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=o.length?o[o.length-1]:null,d=c,y=0;y<o.length;y++){var S=o[y];if(S.dataset.precedence===n)d=S;else if(d!==c)break}d?d.parentNode.insertBefore(e,d.nextSibling):(n=i.nodeType===9?i.head:i,n.insertBefore(e,n.firstChild))}function Mf(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function Ef(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var Jl=null;function ny(e,n,i){if(Jl===null){var o=new Map,c=Jl=new Map;c.set(i,o)}else c=Jl,o=c.get(i),o||(o=new Map,c.set(i,o));if(o.has(e))return o;for(o.set(e,null),i=i.getElementsByTagName(e),c=0;c<i.length;c++){var d=i[c];if(!(d[Ai]||d[et]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var y=d.getAttribute(n)||"";y=e+y;var S=o.get(y);S?S.push(d):o.set(y,[d])}}return o}function ay(e,n,i){e=e.ownerDocument||e,e.head.insertBefore(i,n==="title"?e.querySelector("head > title"):null)}function oM(e,n,i){if(i===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function iy(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var no=null;function lM(){}function cM(e,n,i){if(no===null)throw Error(r(475));var o=no;if(n.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(n.state.loading&4)===0){if(n.instance===null){var c=Ys(i.href),d=e.querySelector(eo(c));if(d){e=d._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(o.count++,o=Wl.bind(o),e.then(o,o)),n.state.loading|=4,n.instance=d,tt(d);return}d=e.ownerDocument||e,i=ey(i),(c=vn.get(c))&&Mf(i,c),d=d.createElement("link"),tt(d);var y=d;y._p=new Promise(function(S,w){y.onload=S,y.onerror=w}),Ct(d,"link",i),n.instance=d}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(n,e),(e=n.state.preload)&&(n.state.loading&3)===0&&(o.count++,n=Wl.bind(o),e.addEventListener("load",n),e.addEventListener("error",n))}}function uM(){if(no===null)throw Error(r(475));var e=no;return e.stylesheets&&e.count===0&&xf(e,e.stylesheets),0<e.count?function(n){var i=setTimeout(function(){if(e.stylesheets&&xf(e,e.stylesheets),e.unsuspend){var o=e.unsuspend;e.unsuspend=null,o()}},6e4);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(i)}}:null}function Wl(){if(this.count--,this.count===0){if(this.stylesheets)xf(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var ec=null;function xf(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,ec=new Map,n.forEach(dM,e),ec=null,Wl.call(e))}function dM(e,n){if(!(n.state.loading&4)){var i=ec.get(e);if(i)var o=i.get(null);else{i=new Map,ec.set(e,i);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<c.length;d++){var y=c[d];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(i.set(y.dataset.precedence,y),o=y)}o&&i.set(null,o)}c=n.instance,y=c.getAttribute("data-precedence"),d=i.get(y)||o,d===o&&i.set(null,c),i.set(y,c),this.count++,o=Wl.bind(this),c.addEventListener("load",o),c.addEventListener("error",o),d?d.parentNode.insertBefore(c,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),n.state.loading|=4}}var ao={$$typeof:j,Provider:null,Consumer:null,_currentValue:le,_currentValue2:le,_threadCount:0};function fM(e,n,i,o,c,d,y,S){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=cs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cs(0),this.hiddenUpdates=cs(null),this.identifierPrefix=o,this.onUncaughtError=c,this.onCaughtError=d,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=S,this.incompleteTransitions=new Map}function sy(e,n,i,o,c,d,y,S,w,O,Z,ie){return e=new fM(e,n,i,y,S,w,O,ie),n=1,d===!0&&(n|=24),d=nn(3,null,null,n),e.current=d,d.stateNode=e,n=ad(),n.refCount++,e.pooledCache=n,n.refCount++,d.memoizedState={element:o,isDehydrated:i,cache:n},od(d),e}function ry(e){return e?(e=Ms,e):Ms}function oy(e,n,i,o,c,d){c=ry(c),o.context===null?o.context=c:o.pendingContext=c,o=Ka(n),o.payload={element:i},d=d===void 0?null:d,d!==null&&(o.callback=d),i=Pa(e,o,n),i!==null&&(ln(i,e,n),Dr(i,e,n))}function ly(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<n?i:n}}function Af(e,n){ly(e,n),(e=e.alternate)&&ly(e,n)}function cy(e){if(e.tag===13){var n=Ss(e,67108864);n!==null&&ln(n,e,67108864),Af(e,67108864)}}var tc=!0;function hM(e,n,i,o){var c=D.T;D.T=null;var d=P.p;try{P.p=2,wf(e,n,i,o)}finally{P.p=d,D.T=c}}function mM(e,n,i,o){var c=D.T;D.T=null;var d=P.p;try{P.p=8,wf(e,n,i,o)}finally{P.p=d,D.T=c}}function wf(e,n,i,o){if(tc){var c=Cf(o);if(c===null)ff(e,n,o,nc,i),dy(e,o);else if(gM(c,e,n,i,o))o.stopPropagation();else if(dy(e,o),n&4&&-1<pM.indexOf(e)){for(;c!==null;){var d=Ga(c);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var y=Bn(d.pendingLanes);if(y!==0){var S=d;for(S.pendingLanes|=2,S.entangledLanes|=2;y;){var w=1<<31-Nt(y);S.entanglements[1]|=w,y&=~w}Xn(d),(De&6)===0&&(ql=fe()+500,Pr(0))}}break;case 13:S=Ss(d,2),S!==null&&ln(S,d,2),jl(),Af(d,2)}if(d=Cf(o),d===null&&ff(e,n,o,nc,i),d===c)break;c=d}c!==null&&o.stopPropagation()}else ff(e,n,o,null,i)}}function Cf(e){return e=Ru(e),Tf(e)}var nc=null;function Tf(e){if(nc=null,e=ua(e),e!==null){var n=u(e);if(n===null)e=null;else{var i=n.tag;if(i===13){if(e=f(n),e!==null)return e;e=null}else if(i===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return nc=e,null}function uy(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_e()){case Ge:return 2;case ze:return 8;case vt:case fn:return 32;case Zt:return 268435456;default:return 32}default:return 32}}var _f=!1,ci=null,ui=null,di=null,io=new Map,so=new Map,fi=[],pM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function dy(e,n){switch(e){case"focusin":case"focusout":ci=null;break;case"dragenter":case"dragleave":ui=null;break;case"mouseover":case"mouseout":di=null;break;case"pointerover":case"pointerout":io.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":so.delete(n.pointerId)}}function ro(e,n,i,o,c,d){return e===null||e.nativeEvent!==d?(e={blockedOn:n,domEventName:i,eventSystemFlags:o,nativeEvent:d,targetContainers:[c]},n!==null&&(n=Ga(n),n!==null&&cy(n)),e):(e.eventSystemFlags|=o,n=e.targetContainers,c!==null&&n.indexOf(c)===-1&&n.push(c),e)}function gM(e,n,i,o,c){switch(n){case"focusin":return ci=ro(ci,e,n,i,o,c),!0;case"dragenter":return ui=ro(ui,e,n,i,o,c),!0;case"mouseover":return di=ro(di,e,n,i,o,c),!0;case"pointerover":var d=c.pointerId;return io.set(d,ro(io.get(d)||null,e,n,i,o,c)),!0;case"gotpointercapture":return d=c.pointerId,so.set(d,ro(so.get(d)||null,e,n,i,o,c)),!0}return!1}function fy(e){var n=ua(e.target);if(n!==null){var i=u(n);if(i!==null){if(n=i.tag,n===13){if(n=f(i),n!==null){e.blockedOn=n,Qo(e.priority,function(){if(i.tag===13){var o=on();o=mr(o);var c=Ss(i,o);c!==null&&ln(c,i,o),Af(i,o)}});return}}else if(n===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ac(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var i=Cf(e.nativeEvent);if(i===null){i=e.nativeEvent;var o=new i.constructor(i.type,i);Nu=o,i.target.dispatchEvent(o),Nu=null}else return n=Ga(i),n!==null&&cy(n),e.blockedOn=i,!1;n.shift()}return!0}function hy(e,n,i){ac(e)&&i.delete(n)}function yM(){_f=!1,ci!==null&&ac(ci)&&(ci=null),ui!==null&&ac(ui)&&(ui=null),di!==null&&ac(di)&&(di=null),io.forEach(hy),so.forEach(hy)}function ic(e,n){e.blockedOn===n&&(e.blockedOn=null,_f||(_f=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,yM)))}var sc=null;function my(e){sc!==e&&(sc=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){sc===e&&(sc=null);for(var n=0;n<e.length;n+=3){var i=e[n],o=e[n+1],c=e[n+2];if(typeof o!="function"){if(Tf(o||i)===null)continue;break}var d=Ga(i);d!==null&&(e.splice(n,3),n-=3,Cd(d,{pending:!0,data:c,method:i.method,action:o},o,c))}}))}function oo(e){function n(w){return ic(w,e)}ci!==null&&ic(ci,e),ui!==null&&ic(ui,e),di!==null&&ic(di,e),io.forEach(n),so.forEach(n);for(var i=0;i<fi.length;i++){var o=fi[i];o.blockedOn===e&&(o.blockedOn=null)}for(;0<fi.length&&(i=fi[0],i.blockedOn===null);)fy(i),i.blockedOn===null&&fi.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(o=0;o<i.length;o+=3){var c=i[o],d=i[o+1],y=c[ft]||null;if(typeof d=="function")y||my(i);else if(y){var S=null;if(d&&d.hasAttribute("formAction")){if(c=d,y=d[ft]||null)S=y.formAction;else if(Tf(c)!==null)continue}else S=y.action;typeof S=="function"?i[o+1]=S:(i.splice(o,3),o-=3),my(i)}}}function Nf(e){this._internalRoot=e}rc.prototype.render=Nf.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(r(409));var i=n.current,o=on();oy(i,o,e,n,null,null)},rc.prototype.unmount=Nf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;oy(e.current,2,null,e,null,null),jl(),n[ca]=null}};function rc(e){this._internalRoot=e}rc.prototype.unstable_scheduleHydration=function(e){if(e){var n=Xo();e={blockedOn:null,target:e,priority:n};for(var i=0;i<fi.length&&n!==0&&n<fi[i].priority;i++);fi.splice(i,0,e),i===0&&fy(e)}};var py=a.version;if(py!=="19.1.1")throw Error(r(527,py,"19.1.1"));P.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=m(n),e=e!==null?p(e):null,e=e===null?null:e.stateNode,e};var bM={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var oc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!oc.isDisabled&&oc.supportsFiber)try{Qe=oc.inject(bM),Pe=oc}catch{}}return mo.createRoot=function(e,n){if(!l(e))throw Error(r(299));var i=!1,o="",c=k0,d=L0,y=D0,S=null;return n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onUncaughtError!==void 0&&(c=n.onUncaughtError),n.onCaughtError!==void 0&&(d=n.onCaughtError),n.onRecoverableError!==void 0&&(y=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(S=n.unstable_transitionCallbacks)),n=sy(e,1,!1,null,null,i,o,c,d,y,S,null),e[ca]=n.current,df(e),new Nf(n)},mo.hydrateRoot=function(e,n,i){if(!l(e))throw Error(r(299));var o=!1,c="",d=k0,y=L0,S=D0,w=null,O=null;return i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(d=i.onUncaughtError),i.onCaughtError!==void 0&&(y=i.onCaughtError),i.onRecoverableError!==void 0&&(S=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(w=i.unstable_transitionCallbacks),i.formState!==void 0&&(O=i.formState)),n=sy(e,1,!0,n,i??null,o,c,d,y,S,w,O),n.context=ry(null),i=n.current,o=on(),o=mr(o),c=Ka(o),c.callback=null,Pa(i,c,o),i=o,n.current.lanes=i,qn(n,i),Xn(n),e[ca]=n.current,df(e),new rc(n)},mo.version="19.1.1",mo}var hb;function w3(){if(hb)return Xf.exports;hb=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(a){console.error(a)}}return t(),Xf.exports=A3(),Xf.exports}var C3=w3(),gt=xm();const yc=10,T3=1.5,_3=1.5,mb=1,N3=.6,pb="⚔️ +50% attack · 🛡️ Barrier · ♾️ Immortal",Ki=5,Pi=3;let yt=null;function R3(){yt&&(yt.tickTimer&&clearInterval(yt.tickTimer),yt.timeout&&clearTimeout(yt.timeout),yt=null)}function Am(){return yt!==null}function V2(){return yt?Math.max(0,yt.endTime-performance.now())/1e3:0}function k3(t,a){if(Am()||!t.spendResource(Ki,oe.SISU))return!1;const s=[];for(const l of a){if(l.faction!=="player"||l.isDead())continue;const u=`sisu-burst-${l.id}`,f={unit:l,attackDelta:0,movementDelta:0,shieldBonusApplied:mb,shieldBonusRemaining:mb,wasImmortal:l.isImmortal()};IE({id:u,duration:yc,data:f,onApply:()=>{const h=l.stats.attackDamage,m=Math.round(h*T3);f.attackDelta=Math.max(0,m-h),f.attackDelta!==0&&(l.stats.attackDamage=h+f.attackDelta);const p=l.stats.movementRange,g=Math.max(1,Math.round(p*_3));f.movementDelta=Math.max(0,g-p),f.movementDelta!==0&&(l.stats.movementRange=p+f.movementDelta),f.shieldBonusRemaining=f.shieldBonusApplied,l.setShield(l.getShield()+f.shieldBonusApplied),l.setImmortal(!0),l.fearless=!0},onExpire:()=>{let h=!1;if(f.attackDelta!==0){const p=l.stats.attackDamage,g=Math.max(0,p-f.attackDelta);g!==p&&(l.stats.attackDamage=g,h=!0)}if(f.movementDelta!==0){const p=l.stats.movementRange,g=Math.max(0,p-f.movementDelta);g!==p&&(l.stats.movementRange=g,h=!0)}l.setImmortal(f.wasImmortal);const m=Math.max(0,Math.min(f.shieldBonusApplied,f.shieldBonusRemaining));m>0&&l.setShield(Math.max(0,l.getShield()-m)),delete l.fearless,h&&re.emit("unit:stats:changed",{unitId:l.id,stats:{...l.stats}}),yt&&(yt.affected=yt.affected.filter(p=>p.modifierId!==u))},hooks:{"combat:onHit":h=>{const m=h;if(m.source!=="defender"||m.defender.id!==l.id||m.shieldDamage<=0||f.shieldBonusRemaining<=0)return;const p=Math.min(f.shieldBonusRemaining,m.shieldDamage);f.shieldBonusRemaining=Math.max(0,f.shieldBonusRemaining-p)}}}),s.push({unit:l,modifierId:u,state:f})}return yt={endTime:performance.now()+yc*1e3,status:pb,affected:s,tickTimer:null,timeout:null},re.emit("sisuBurstStart",{remaining:yc,status:pb}),yt.tickTimer=setInterval(()=>{if(!yt)return;const l=Math.max(0,Math.ceil(V2()));l>0&&re.emit("sisuBurstTick",{remaining:l,status:yt.status})},1e3),yt.timeout=setTimeout(()=>{L3()},yc*1e3),!0}function L3(){if(yt){for(const t of yt.affected)UE(t.modifierId);R3(),re.emit("sisuBurstEnd",{})}}function D3(t,a,s,r){const l=a.filter(u=>u.faction==="player"&&!u.isDead());if(l.length===0||!t.spendResource(Pi,oe.SISU))return!1;for(const u of l){const f=E2(s,3,a)??{...s};u.setCoord(f);const h=Math.round(u.getMaxHealth()*N3);u.stats.health=Math.min(u.getMaxHealth(),Math.max(u.stats.health,h))}return r.revealAround(s,3,{autoFrame:!1}),re.emit("torilleRecalled",{count:l.length}),!0}let es=!1;function wm(){return es}function pu(t){es!==t&&(es=t,re.emit("game:pause-changed",{paused:es}))}function I3(){return pu(!es),es}function U3(){es&&pu(!1)}const O3=["/assets/sounds/sauna-forest.ogg","/assets/sounds/sauna-forest.mp3"],$2="audio_enabled",Dh=new Set,gu=new Set;let Zi=null,bc=null,Na=null,To=null;function z3(t){if(typeof localStorage>"u")return null;try{return localStorage.getItem(t)}catch(a){return console.warn("Unable to read ambience preference",t,a),null}}const X2=z3($2);let qa=X2==="true",_o=X2!==null;const Ih=du();let Ic=K2(Ih.channels.music.volume,.65),is=!1,aa=Ih.channels.master.muted||Ih.channels.music.muted;const Ps=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)"):null;let Q2=Ps?.matches??!1;if(Ps){const t=a=>{Q2=a.matches};typeof Ps.addEventListener=="function"?Ps.addEventListener("change",t):typeof Ps.addListener=="function"&&Ps.addListener(t)}if(typeof window<"u"&&!_o){const t=()=>{_o||(_o=!0,ev(!0),yu())};window.addEventListener("pointerdown",t,{once:!0}),window.addEventListener("keydown",t,{once:!0})}rm(t=>{const a=K2(t.channels.music.volume,Ic),s=t.channels.master.muted||t.channels.music.muted,r=Math.abs(a-Ic)>5e-4;if(Ic=a,s!==aa){aa=s,aa?W2():qa?yu():(Uo(!0),Io());return}r&&Io()});function K2(t,a){return Number.isFinite(t)?t<0?0:t>1?1:t:a}function Io(){const t=tv();for(const a of Dh)a(t)}function B3(t){if(!(typeof localStorage>"u"))try{localStorage.setItem($2,t?"true":"false")}catch(a){console.warn("Unable to persist ambience preference",a)}}function P2(t){if(Na)return Na;const a=t.createGain();a.gain.value=qa&&!aa?1:0;const s=sm("music");return s?a.connect(s):a.connect(t.destination),Na=a,a}function Uo(t=!1){if(!Na)return;const a=Na.context,s=qa&&!aa?1:0,r=a.currentTime;Na.gain.cancelScheduledValues(r),t?Na.gain.setValueAtTime(s,r):Na.gain.setTargetAtTime(s,r,.25)}function q3(){return Q2?.6:4.2}function Z2(){To!==null&&(clearTimeout(To),To=null)}function Uh(t){try{t.source.stop()}catch{}t.source.disconnect(),t.gain.disconnect(),gu.delete(t)}function H3(){for(const t of[...gu])Uh(t)}async function j3(t){return Zi||(bc||(bc=(async()=>{for(const a of O3)try{const s=await fetch(a);if(!s.ok)continue;const r=await s.arrayBuffer();return await t.decodeAudioData(r)}catch(s){console.warn("Failed to fetch ambience source",a,s)}throw new Error("No ambience sources available")})().then(a=>(Zi=a,a)).catch(a=>{throw bc=null,a})),bc)}function G3(t,a){if(!is)return;Z2();const s=Math.max(0,t-a.currentTime-.05);To=setTimeout(()=>{To=null,is&&J2(t)},s*1e3)}function J2(t){const a=Na?.context??nv();if(!a||!Zi)return;const s=a.createGain(),r=a.createBufferSource();r.buffer=Zi,r.loop=!1,r.connect(s),s.connect(P2(a));const l=Math.min(q3(),Zi.duration/2),u=Number.isFinite(l)&&l>0?l:.25,f=Math.max(a.currentTime,t);s.gain.setValueAtTime(0,f),s.gain.linearRampToValueAtTime(1,f+u);const h=t+Zi.duration,m=h-u;m>f&&s.gain.setValueAtTime(1,m),s.gain.linearRampToValueAtTime(.001,h+.1);const p={source:r,gain:s,stopTime:h};gu.add(p),r.addEventListener("ended",()=>{Uh(p)});try{r.start(t)}catch(g){console.warn("Failed to start ambience layer",g),Uh(p);return}G3(h-u,a)}async function yu(){if(is||!qa||aa){Uo();return}const t=nv();if(t){P2(t),Uo();try{const a=await j3(t);if(!qa||aa)return;await t.resume().catch(()=>{}),is=!0;const s=Math.max(t.currentTime+.12,t.currentTime);J2(s),Io()}catch(a){console.warn("Unable to start ambience",a)}}}function W2(){if(!is&&gu.size===0){Uo(!0);return}is=!1,Z2(),H3(),Uo(!0),Io()}function ev(t){qa===t&&_o||(qa=t,_o=!0,B3(t),t?aa||yu():W2(),Io())}function tv(){return{enabled:qa,playing:is,volume:Ic,globallyMuted:aa}}function Y3(t){return Dh.add(t),()=>{Dh.delete(t)}}qa&&!aa&&yu();function nv(){return im()}const F3='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',Jf={master:"Master mix",music:"Ambience soundscape",sfx:"Effects & interface"},V3={master:"Controls the overall loudness for every channel in the frontier.",music:"Shapes the ambience loops and atmospheric swells around the sauna.",sfx:"Balances unit callouts, UI clicks, and battle feedback cues."},$3="linear-gradient(90deg, rgba(59,130,246,0.85) 0%, rgba(14,165,233,0.9) VAR%, rgba(148,163,184,0.35) VAR%, rgba(71,85,105,0.2) 100%)";function Oh(t,a){t.style.backgroundImage=$3.replace(/VAR/g,`${a}%`)}function zh(t){return`${Math.round(t)}%`}function X3(t,a,s){const r=l=>{if(l.key==="Escape"){l.preventDefault(),s();return}if(l.key!=="Tab")return;const u=a.querySelectorAll(F3);if(u.length===0){l.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;l.shiftKey?(m===f||!a.contains(m))&&(l.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(l.preventDefault(),f.focus())};return t.addEventListener("keydown",r),()=>t.removeEventListener("keydown",r)}function av(t,a,s){const r=a.channels[t],l=a.channels.master;if(t==="music"&&!s.enabled)return"Ambience paused";if(r.muted)return"Muted at mixer";if(t!=="master"&&l.muted)return"Master mute active";const u=Math.round(r.effectiveVolume*100);return u<=0?"Output silent":t==="master"?`Master output ${u}%`:t==="music"?`Soundscape live ${u}%`:`Effects live ${u}%`}function Wf(t,a,s,r,l,u,f){const h=t.createElement("section");h.className="rounded-hud-xl border border-white/12 bg-[linear-gradient(155deg,rgba(15,26,56,0.92),rgba(9,14,34,0.96))] p-5 shadow-[0_24px_45px_rgba(4,10,25,0.55)] backdrop-blur-[18px] backdrop-saturate-[140%]";const m=t.createElement("header");m.className="flex flex-wrap items-start justify-between gap-3";const p=t.createElement("div");p.className="space-y-1";const g=t.createElement("h3");g.className="text-lg font-semibold tracking-tight text-white",g.textContent=Jf[a];const b=t.createElement("p");b.className="max-w-[32ch] text-sm text-slate-300/85",b.textContent=V3[a],p.append(g,b);const v=t.createElement("span");v.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70",v.textContent=av(a,s,r),m.append(p,v);const M=t.createElement("div");M.className="mt-5 flex items-center gap-4";const x=t.createElement("input");x.type="range",x.min="0",x.max="100",x.step="1",x.className="h-2 flex-1 appearance-none rounded-full bg-slate-600/30 accent-accent transition-[background-image] duration-200 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",x.setAttribute("aria-label",`${Jf[a]} level`);const T=t.createElement("span");T.className="text-sm font-semibold text-slate-200",M.append(x,T);const _=t.createElement("div");_.className="mt-4 flex flex-wrap items-center gap-3";const R=t.createElement("button");if(R.type="button",R.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/60 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-white/80 transition-all duration-150 ease-out hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",R.setAttribute("aria-label",`Toggle mute for ${Jf[a]}`),R.addEventListener("click",()=>{const V=!Xi.channels[a].muted;l(a,V)}),_.append(R),a==="sfx"){const V=t.createElement("button");V.type="button",V.className="inline-flex items-center gap-2 rounded-full border border-accent/40 bg-accent/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-accent-200 transition-all duration-150 ease-out hover:bg-accent/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",V.textContent="Play sample",V.addEventListener("click",()=>{na("spawn")}),_.append(V)}let I;a==="music"&&f&&(I=t.createElement("button"),I.type="button",I.className="inline-flex items-center gap-2 rounded-full border border-emerald-300/25 bg-emerald-400/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-emerald-200 transition-all duration-150 ease-out hover:bg-emerald-400/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300",I.addEventListener("click",()=>{f()}),_.append(I));const j=Math.round(s.channels[a].volume*100);return x.value=String(j),Oh(x,j),T.textContent=zh(j),R.setAttribute("aria-pressed",s.channels[a].muted?"true":"false"),R.textContent=s.channels[a].muted?"Muted":"Active",a==="music"&&(x.title=r.enabled?"Adjust ambience loudness":"Ambience paused — set the level ahead of resuming."),x.addEventListener("input",()=>{const V=Number(x.value);Oh(x,V),T.textContent=zh(V),u(a,V/100)}),h.append(m,M,_),{card:h,slider:x,value:T,muteButton:R,status:v,ambienceToggle:I}}let Xi=du();function Q3(t){const{container:a,onClose:s}=t;if(!a)return{destroy(){},focus(){}};const r=a.ownerDocument??document,l=r.createElement("div");l.className="pointer-events-auto fixed inset-0 z-[1200] flex items-center justify-center bg-slate-950/75 p-4 backdrop-blur-[22px] backdrop-saturate-[140%]",l.setAttribute("role","presentation");const u=r.createElement("section");u.className="w-full max-w-[min(580px,92vw)] space-y-6 rounded-hud-xl border border-white/12 bg-[linear-gradient(145deg,rgba(12,22,45,0.95),rgba(7,13,29,0.97))] p-6 text-slate-100 shadow-[0_32px_60px_rgba(4,10,24,0.7)] backdrop-blur-[24px] backdrop-saturate-[150%]",u.setAttribute("role","dialog"),u.setAttribute("aria-modal","true");const f=`audio-mixer-title-${Date.now()}`;u.setAttribute("aria-labelledby",f),u.tabIndex=-1;const h=r.createElement("header");h.className="flex items-start justify-between gap-4";const m=r.createElement("div");m.className="space-y-1";const p=r.createElement("h2");p.id=f,p.className="text-2xl font-semibold tracking-tight text-white",p.textContent="Audio mixer";const g=r.createElement("p");g.className="max-w-[46ch] text-sm text-slate-300/85",g.textContent="Dial in the master bus, ambience beds, and tactical feedback without leaving the battlefield.",m.append(p,g);const b=r.createElement("button");b.type="button",b.className="rounded-full border border-white/20 bg-slate-800/70 px-3 py-1 text-sm font-semibold text-white/70 transition-all duration-150 hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",b.textContent="Close",h.append(m,b);const v=r.createElement("span");v.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70";const M=r.createElement("div");M.className="space-y-5";let x=tv();const T={master:Wf(r,"master",Xi,x,(B,C)=>{aE(C)},(B,C)=>{eE(C)},null),music:Wf(r,"music",Xi,x,(B,C)=>{iE(C)},(B,C)=>{tE(C)},()=>{ev(!x.enabled)}),sfx:Wf(r,"sfx",Xi,x,(B,C)=>{sE(C)},(B,C)=>{nE(C)},null)};M.append(T.master.card,T.music.card,T.sfx.card),u.append(h,v,M),l.append(u),a.append(l);let _=!1;function R(){const B=T.music.ambienceToggle;B&&(B.setAttribute("aria-pressed",x.enabled?"true":"false"),B.textContent=x.enabled?"Ambience enabled":"Ambience paused",B.title=x.enabled?"Disable ambience loops":"Enable ambience loops")}function I(B){Xi=B;const C=B.contextState==="uninitialized"?"Context idle":B.contextState==="running"?"Context running":"Context suspended";v.textContent=C,["master","music","sfx"].forEach(J=>{const q=T[J],ae=B.channels[J],F=Math.round(ae.volume*100);q.slider.value=String(F),Oh(q.slider,F),q.value.textContent=zh(F),q.muteButton.setAttribute("aria-pressed",ae.muted?"true":"false"),q.muteButton.textContent=ae.muted?"Muted":"Active",q.status.textContent=av(J,B,x),J==="music"&&(q.slider.title=x.enabled?"Adjust ambience loudness":"Ambience paused — set the level ahead of resuming.")}),R()}function j(){_||(_=!0,V(),l.parentElement&&l.remove(),s?.())}function V(){X.forEach(B=>{try{B()}catch{}}),X.length=0}const X=[],$=B=>{B.target===l&&j()};l.addEventListener("click",$),X.push(()=>l.removeEventListener("click",$)),b.addEventListener("click",j),X.push(()=>b.removeEventListener("click",j));const ee=X3(l,u,j);X.push(ee);const te=rm(B=>{I(B)});X.push(te);const Y=Y3(B=>{x=B,R(),I(Xi)});return X.push(Y),I(Xi),u.focus(),{destroy(){j()},focus(){u.focus()}}}function gb(...t){return t.filter(Boolean).join(" ")}function yb(t,a){return!(t.code!==a.code||(a.shift??!1)!==t.shiftKey||(a.alt??!1)!==t.altKey||(a.meta??!1)!==t.metaKey||(a.ctrl??!1)!==t.ctrlKey)}function K3(t){return!Number.isFinite(t)||t<=0?"0s":`${Math.max(0,Math.ceil(t))}s`}function P3(){const[t,a]=gt.useState(()=>{const s=Am();return{active:s,remaining:s?Math.ceil(V2()):0,status:s?"Burst active":void 0}});return gt.useEffect(()=>{const s=({remaining:u,status:f})=>{a({active:!0,remaining:Math.ceil(u),status:f})},r=({remaining:u,status:f})=>{a(h=>({active:!0,remaining:Math.ceil(u),status:f??h.status}))},l=()=>{a({active:!1,remaining:0,status:void 0})};return re.on("sisuBurstStart",s),re.on("sisuBurstTick",r),re.on("sisuBurstEnd",l),()=>{re.off("sisuBurstStart",s),re.off("sisuBurstTick",r),re.off("sisuBurstEnd",l)}},[]),t}function Z3(){const[t,a]=gt.useState(()=>wm());return gt.useEffect(()=>{const s=({paused:r})=>{a(r)};return re.on("game:pause-changed",s),()=>{re.off("game:pause-changed",s)}},[]),t}function bb(t){const a=t.target;if(!a)return!1;const s=a.tagName;return!!(s==="INPUT"||s==="TEXTAREA"||s==="SELECT"||a.isContentEditable)}function J3({state:t,abilities:a}){const[s,r]=gt.useState(()=>t.getResource(oe.SISU)),[l,u]=gt.useState(()=>Eh()),[f,h]=gt.useState(!1),[m,p]=gt.useState(null),g=gt.useRef({}),[b,v]=gt.useState(()=>new Set),M=P3(),x=Z3(),T=gt.useRef(null),_=gt.useCallback(C=>{v(q=>{const ae=new Set(q);return ae.add(C),ae});const J=g.current[C];J&&window.clearTimeout(J),g.current[C]=window.setTimeout(()=>{v(q=>{const ae=new Set(q);return ae.delete(C),ae}),delete g.current[C]},650)},[]);gt.useEffect(()=>{const C=({resource:J,total:q})=>{J===oe.SISU&&r(q)};return re.on("resourceChanged",C),()=>{re.off("resourceChanged",C),Object.values(g.current).forEach(J=>{J&&window.clearTimeout(J)}),g.current={}}},[]),gt.useEffect(()=>_E(u),[]),gt.useEffect(()=>()=>{T.current?.destroy(),T.current=null},[]);const R=gt.useCallback(()=>{const C=document.getElementById("ui-overlay");if(!C)return!1;if(T.current)return T.current.destroy(),T.current=null,h(!1),!0;const J=Q3({container:C,onClose:()=>{T.current=null,h(!1)}});return T.current=J,h(!0),J.focus(),!0},[]),I=a.useSisuBurst,j=a.torille,V=a.onOpenBuildPlanner,X=!I||M.active||s<Ki,$=I?M.active?"Burst already surging.":s<Ki?`Requires ${Ki} SISU.`:void 0:"Burst controls offline in this build.",ee=!j||s<Pi,te=j?s<Pi?`Requires ${Pi} SISU.`:void 0:"Torille rally is unavailable right now.",Y=gt.useMemo(()=>[{id:"burst",icon:"⚡️",label:"Sisu Burst",description:"Ignite a surge of fury and resilience across your warriors.",hotkey:{code:"KeyQ",label:"Q"},accent:"primary",cost:`-${Ki} SISU`,detail:M.active?`${M.status??"Burst active"} · ${K3(M.remaining)}`:void 0,blocked:X,blockedReason:$,interactive:!!I,onActivate:()=>I?I():!1},{id:"torille",icon:"📣",label:"Torille!",description:"Call every survivor home to the sauna to regroup and heal.",hotkey:{code:"KeyW",label:"W"},accent:"primary",cost:`-${Pi} SISU`,blocked:ee,blockedReason:te,interactive:!!j,onActivate:()=>j?j():!1},{id:"build",icon:"🛠️",label:"Build",description:"Draft new structures to reinforce your frontier.",hotkey:{code:"KeyE",label:"E"},accent:"neutral",blocked:!V,blockedReason:V?void 0:"Construction planner will unlock in a forthcoming update.",interactive:!!V,onActivate:()=>V?V()??!0:!1},{id:"sound",icon:l?"🔇":f?"🎚️":"🎛️",label:"Audio",description:"Open the in-game mixer to balance master, ambience, and effects.",hotkey:{code:"KeyR",label:"R"},accent:"neutral",toggled:f,detail:f?"Mixer open":l?"Muted":"Live mix",interactive:!0,blocked:!1,onActivate:()=>!!R()},{id:"pause",icon:x?"⏸️":"▶️",label:x?"Paused":"Pause",description:x?"Time is frozen — resume when your strategy is ready.":"Freeze the battlefield to reassess and issue commands.",hotkey:{code:"Space",label:"Space"},accent:"neutral",toggled:x,detail:x?"Combat frozen":"Time flowing",interactive:!0,blocked:!1,onActivate:()=>(I3(),!0)}],[M.active,M.remaining,X,$,j,f,l,V,x,ee,te,I]),B=gt.useCallback(C=>{if(!C.interactive){_(C.id);return}if(C.blocked){_(C.id);return}C.onActivate?.()===!1&&_(C.id)},[_]);return gt.useEffect(()=>{const C=q=>{if(q.repeat||bb(q))return;const ae=Y.find(F=>yb(q,F.hotkey));ae&&(q.preventDefault(),p(ae.id),B(ae))},J=q=>{if(bb(q))return;const ae=Y.find(F=>yb(q,F.hotkey));ae&&(q.preventDefault(),p(F=>F===ae.id?null:F))};return window.addEventListener("keydown",C),window.addEventListener("keyup",J),()=>{window.removeEventListener("keydown",C),window.removeEventListener("keyup",J)}},[Y,B]),Pt.jsx("div",{className:"pointer-events-none w-full",children:Pt.jsx("div",{className:"pointer-events-auto mx-auto flex w-full max-w-4xl flex-col gap-4 rounded-[26px] border border-white/10 bg-[linear-gradient(145deg,rgba(11,17,30,0.86),rgba(6,10,18,0.92))] p-6 shadow-[0_26px_65px_rgba(6,12,24,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)] backdrop-blur-xl","aria-label":"Combat and systems action bar",children:Pt.jsx("div",{className:"flex flex-wrap items-stretch justify-center gap-4",children:Y.map(C=>{const J=m===C.id,q=b.has(C.id),F=(C.blocked??!1)||!C.interactive,D=C.detail??C.blockedReason,P=gb("group relative flex min-w-[150px] flex-1 flex-col gap-2 rounded-[20px] border border-white/10 px-5 py-4 text-left transition-all duration-200 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70 focus-visible:ring-offset-0","bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.22),rgba(14,25,45,0.6))] shadow-[0_18px_42px_rgba(8,25,53,0.55)]",C.accent==="primary"&&"border-sky-300/40 bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.32),rgba(11,22,45,0.7))]",C.accent==="danger"&&"border-rose-400/45 bg-[radial-gradient(circle_at_top,rgba(244,114,182,0.32),rgba(45,9,25,0.75))]",J&&"ring-2 ring-sky-300/80 ring-offset-0 translate-y-[-2px] shadow-[0_24px_48px_rgba(56,189,248,0.45)]",q&&'animate-hud-shake after:pointer-events-none after:absolute after:inset-0 after:rounded-[inherit] after:border after:border-rose-300/45 after:bg-[radial-gradient(circle_at_center,rgba(248,113,113,0.18),rgba(248,113,113,0))] after:content-[""] after:animate-hud-pulse',!F&&!J&&"hover:-translate-y-1 hover:shadow-[0_24px_50px_rgba(56,189,248,0.4)]",F&&"cursor-not-allowed opacity-70",C.toggled&&"border-sky-400/60 shadow-[0_0_36px_rgba(56,189,248,0.45)]");return Pt.jsxs("button",{type:"button",className:P,"aria-pressed":C.toggled?"true":void 0,"aria-disabled":F?"true":void 0,"data-hotkey":C.hotkey.label,onClick:le=>{if(F){le.preventDefault(),_(C.id);return}B(C)},onKeyDown:le=>{(le.key==="Enter"||le.key===" ")&&(le.preventDefault(),B(C))},title:gb(C.description,C.blockedReason),children:[Pt.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Pt.jsxs("span",{className:"flex items-center gap-3 text-base font-semibold uppercase tracking-[0.18em] text-slate-100",children:[Pt.jsx("span",{"aria-hidden":"true",className:"text-2xl",children:C.icon}),C.label]}),Pt.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-slate-300/80",children:C.hotkey.label})]}),Pt.jsx("p",{className:"text-sm leading-relaxed text-slate-200/80",children:C.description}),Pt.jsxs("div",{className:"flex items-center justify-between text-xs font-medium uppercase tracking-[0.28em] text-slate-300/70",children:[Pt.jsx("span",{children:D??"​"}),C.cost?Pt.jsx("span",{className:"text-slate-200/90",children:C.cost}):Pt.jsx("span",{className:"opacity-0",children:"cost"})]})]},C.id)})})})})}function W3(t,a,s={}){const r=dr(a),l=a.ownerDocument.createElement("div");l.dataset.component="action-bar",l.dataset.tutorialTarget="combat",l.className="flex w-full justify-center";const u=r.regions.bottom,f=u.querySelector("#build-id");f?u.insertBefore(l,f):u.appendChild(l);const h=C3.createRoot(l);return h.render(Pt.jsx(J3,{state:t,abilities:s})),{destroy(){h.unmount(),l.remove()}}}const eA="(max-width: 820px)",iv="is-mobile",sv="is-desktop";let Rn=null,Xc=null,Jn=!1,vc=0;const Qc=new Set,Bh=new Set,Kc=t=>{for(const a of Bh)a.classList.toggle(iv,t),a.classList.toggle(sv,!t),a.dataset.viewport=t?"mobile":"desktop"},tA=t=>{if(Jn!==t){Jn=t,Kc(Jn);for(const a of Array.from(Qc))try{a(Jn)}catch(s){console.error("Failed to notify mobile listener",s)}}},rv=()=>{if(Rn||typeof window>"u")return;Rn=window.matchMedia(eA),Jn=Rn.matches,Kc(Jn);const t=a=>{tA(a.matches)};typeof Rn.addEventListener=="function"?(Rn.addEventListener("change",t),Xc=()=>Rn?.removeEventListener("change",t)):(Rn.addListener(t),Xc=()=>Rn?.removeListener(t))},nA=()=>{Rn&&(Xc?.(),Xc=null,Rn=null)},ov=(t,{immediate:a=!0}={})=>(rv(),Qc.add(t),a&&t(Jn),()=>{Qc.delete(t)}),aA=({root:t,onChange:a,immediate:s=!0}={})=>{rv();const r=t??(typeof document<"u"?document.documentElement:null);r&&(Bh.add(r),Kc(Jn)),vc+=1;let l=null;return a?l=ov(a,{immediate:s}):s&&Rn&&Kc(Jn),{matches:()=>Jn,dispose:()=>{r&&(Bh.delete(r),r.classList.remove(iv,sv),(r.dataset.viewport==="mobile"||r.dataset.viewport==="desktop")&&delete r.dataset.viewport),l&&(l(),l=null),vc=Math.max(0,vc-1),vc===0&&Qc.size===0&&nA()}}};function iA(t){const a=[t.name];return t.description&&a.push(t.description),t.rarity&&a.push(`Rarity: ${t.rarity}`),t.quantity>1&&a.push(`Quantity: ${t.quantity}`),a.join(" — ")}function sA(t){const a=document.createElement("span");a.classList.add("item-icon__fallback");const s=t.trim();return a.textContent=s?s[0]?.toUpperCase()??"?":"?",a.setAttribute("aria-hidden","true"),a}function rA(t,a){const s=document.createElement("img");return s.src=t,s.alt="",s.decoding="async",s.loading="lazy",s.classList.add("item-icon__image"),s.setAttribute("aria-hidden","true"),s.title=a,s}function oA(t){const a=document.createElement("li");a.classList.add("item-icon"),a.dataset.itemId=t.id;const s=iA(t);if(a.title=s,a.setAttribute("aria-label",s),a.setAttribute("role","listitem"),t.rarity&&(a.dataset.rarity=t.rarity.toLowerCase()),t.icon&&t.icon.trim().length>0?a.appendChild(rA(t.icon,t.name)):a.appendChild(sA(t.name)),t.quantity>1){const r=document.createElement("span");r.classList.add("item-icon__quantity"),r.textContent=`×${t.quantity}`,r.setAttribute("aria-hidden","true"),a.appendChild(r)}return a}const lA=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function qh(t){return t===1/0?"∞":!Number.isFinite(t)||t<=0?"0s":`${lA.format(Math.ceil(t))}s`}function cA(t){const a=[t.name];return t.description&&a.push(t.description),t.source&&a.push(`Source: ${t.source}`),t.duration!==1/0&&a.push(`Duration: ${qh(t.duration)}`),a.push(`Remaining: ${qh(t.remaining)}`),t.stacks&&t.stacks>1&&a.push(`Stacks: ${t.stacks}`),a.join(" — ")}function uA(t){const a=document.createElement("li");a.classList.add("mod-pill"),a.dataset.modifierId=t.id,a.title=cA(t),a.setAttribute("aria-label",a.title),a.setAttribute("role","listitem"),a.dataset.duration=t.duration===1/0?"infinite":String(t.duration),a.dataset.remaining=t.remaining===1/0?"infinite":String(t.remaining),t.appliedAt!==void 0&&(a.dataset.appliedAt=String(t.appliedAt)),t.stacks&&t.stacks>1&&(a.dataset.stacks=String(t.stacks));const s=document.createElement("span");if(s.classList.add("mod-pill__name"),s.textContent=t.name,s.setAttribute("aria-hidden","true"),a.appendChild(s),t.stacks&&t.stacks>1){const l=document.createElement("span");l.classList.add("mod-pill__stacks"),l.textContent=`×${t.stacks}`,l.setAttribute("aria-hidden","true"),a.appendChild(l)}const r=document.createElement("span");return r.classList.add("mod-pill__timer"),r.textContent=qh(t.remaining),r.setAttribute("aria-hidden","true"),a.appendChild(r),t.remaining!==1/0&&t.remaining<=5&&(a.dataset.urgent="true"),a}const Hh={engaged:"Engaged on the field",reserve:"On reserve duty",downed:"Recovering from battle"},$e=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),vb="panel-roster-title";function dA(t){return t.length===0?"No defining traits yet":t.join(" • ")}function lv(t){return Number.isFinite(t)?Math.max(0,Math.min(100,Math.round(t*100))):0}function fA(t){const a=$e;if(t.xpForNext===null)return`${a.format(t.xp)} XP • Max level`;const s=lv(t.progress);return`${a.format(t.xpIntoLevel)} / ${a.format(t.xpForNext)} XP • ${s}%`}function cv(t){const a=[],s=(r,l)=>{l>0&&a.push(`+${$e.format(l)} ${r}`)};return s("Vigor",t.vigor),s("Focus",t.focus),s("Resolve",t.resolve),a.length===0?"No level bonuses yet":a.join(" • ")}function Xs(t,a){const r=Math.round(t-(typeof a=="number"?a:0));if(r===0)return"";const l=$e.format(Math.abs(r));return r>0?` (+${l})`:` (-${l})`}function hA(t){if(!t)return"No stat changes";const a=[],s=(r,l)=>{if(typeof l=="number"&&l!==0){const u=l>0?"+":"−";a.push(`${r} ${u}${$e.format(Math.abs(l))}`)}};return s("HP",t.health),s("ATK",t.attackDamage),s("RNG",t.attackRange),s("MOV",t.movementRange),s("DEF",t.defense),s("Shield",t.shield),a.length===0?"No stat changes":a.join(", ")}function mA(t){const{stats:a,baseStats:s}=t,r=[`HP ${$e.format(a.health)}/${$e.format(a.maxHealth)}${Xs(a.maxHealth,s.maxHealth)}`];return a.shield&&a.shield>0&&r.push(`Shield ${$e.format(a.shield)}${Xs(a.shield,s.shield)}`),r.push(`ATK ${$e.format(a.attackDamage)}${Xs(a.attackDamage,s.attackDamage)}`),r.push(`RNG ${$e.format(a.attackRange)}${Xs(a.attackRange,s.attackRange)}`),a.defense&&a.defense>0&&r.push(`DEF ${$e.format(a.defense)}${Xs(a.defense,s.defense)}`),r.push(`MOV ${$e.format(a.movementRange)}${Xs(a.movementRange,s.movementRange)}`),r.push(`Upkeep ${$e.format(t.upkeep)} beer`),r.join(" • ")}function pA(t){const{stats:a}=t,s=[t.name,Hh[t.status]];s.push(`level ${t.progression.level}`),s.push(`health ${$e.format(a.health)} of ${$e.format(a.maxHealth)}`),a.shield&&a.shield>0&&s.push(`shield ${$e.format(a.shield)}`),s.push(`attack ${$e.format(a.attackDamage)}`),a.defense&&a.defense>0&&s.push(`defense ${$e.format(a.defense)}`),a.attackRange>0&&s.push(`attack range ${$e.format(a.attackRange)}`),s.push(`movement ${$e.format(a.movementRange)}`),s.push(`upkeep ${$e.format(t.upkeep)} beer`),t.progression.xpForNext===null?s.push(`${$e.format(t.progression.xp)} total experience`):s.push(`${$e.format(t.progression.xpIntoLevel)} of ${$e.format(t.progression.xpForNext)} experience toward next level`);const r=cv(t.progression.statBonuses);r&&s.push(`level bonuses ${r}`);const l=t.equipment.filter(u=>u.item).length;return l>0&&s.push(`${l} equipped item${l===1?"":"s"}`),t.modifiers.length>0&&s.push(`${t.modifiers.length} active modifier${t.modifiers.length===1?"":"s"}`),s.join(", ")}function gA(t,a){const s=a.filter(h=>h.status==="engaged").length,r=a.filter(h=>h.status==="reserve").length,l=a.filter(h=>h.status==="downed").length,u=(h,m,p)=>{const g=document.createElement("span");return g.classList.add("panel-roster__metric"),g.dataset.status=p,g.textContent=`${$e.format(m)} ${h}`,g.setAttribute("aria-label",g.textContent),g},f=document.createElement("div");f.classList.add("panel-roster__metrics"),f.append(u("engaged",s,"engaged"),u("reserve",r,"reserve"),u("downed",l,"downed")),t.appendChild(f)}function yA(t,a,s){const r=document.createElement("div");r.classList.add("panel-roster__loadout");const l=document.createElement("ul");l.classList.add("panel-roster__slots"),l.setAttribute("role","list"),l.setAttribute("aria-label",`${a.name} equipment slots`);for(const u of a.equipment){const f=document.createElement("li");f.classList.add("panel-roster__slot"),f.dataset.slot=u.id;const h=document.createElement("div");h.classList.add("panel-roster__slot-header");const m=document.createElement("span");m.classList.add("panel-roster__slot-label"),m.textContent=u.label,m.title=u.description,h.appendChild(m);const p=document.createElement("span");if(p.classList.add("panel-roster__slot-summary"),p.textContent=u.item?u.item.name:"Empty",p.title=u.description,h.appendChild(p),f.appendChild(h),u.item){const x=document.createElement("ul");x.classList.add("panel-roster__slot-icons"),x.setAttribute("role","list"),x.appendChild(oA(u.item)),f.appendChild(x)}const g=document.createElement("span");g.classList.add("panel-roster__slot-modifiers"),g.textContent=hA(u.modifiers),g.title=g.textContent,f.appendChild(g);const b=document.createElement("div");b.classList.add("panel-roster__slot-actions");const v=document.createElement("button");v.type="button",v.classList.add("panel-roster__slot-action"),v.textContent=u.item?"Replace":"Equip",v.setAttribute("aria-label",`Equip ${u.label} for ${a.name}`),v.addEventListener("click",x=>{x.stopPropagation(),s.onEquipSlot?.(a.id,u.id)}),b.appendChild(v);const M=document.createElement("button");M.type="button",M.classList.add("panel-roster__slot-action"),M.textContent="Unequip",M.disabled=u.item===null,M.setAttribute("aria-label",`Unequip ${u.label} from ${a.name}`),M.addEventListener("click",x=>{x.stopPropagation(),M.disabled||s.onUnequipSlot?.(a.id,u.id)}),b.appendChild(M),f.appendChild(b),l.appendChild(f)}if(r.appendChild(l),a.modifiers.length>0){const u=document.createElement("ul");u.classList.add("panel-roster__mods"),u.setAttribute("role","list"),u.setAttribute("aria-label",`${a.name} active modifiers`),u.title=a.modifiers.map(f=>f.name).join(", ");for(const f of a.modifiers)u.appendChild(uA(f));r.appendChild(u)}t.appendChild(r)}function bA(t,a={}){return{render:r=>{t.innerHTML="",t.dataset.count=String(r.length),t.classList.add("panel-roster");const l=document.createElement("div");l.classList.add("panel-roster__header");const u=document.createElement("h4");u.classList.add("panel-roster__title"),u.textContent="Battalion Roster",u.id=vb,l.appendChild(u),t.setAttribute("aria-labelledby",vb);const f=r.length===0?"No attendants mustered yet":`${$e.format(r.length)} attendant${r.length===1?"":"s"} enlisted`,h=document.createElement("span");if(h.classList.add("panel-roster__count"),h.textContent=f,l.appendChild(h),t.appendChild(l),(()=>{if(typeof a.getRosterCapLimit!="function"||typeof a.getRosterCap!="function")return;const g=document.createElement("section");g.classList.add("panel-roster__cap");const b=document.createElement("div");b.classList.add("panel-roster__cap-header");const v=document.createElement("span");v.classList.add("panel-roster__cap-title"),v.textContent="Roster Cap",b.appendChild(v);const M=document.createElement("span");M.classList.add("panel-roster__cap-value"),M.setAttribute("aria-live","polite"),b.appendChild(M),g.appendChild(b);const x=document.createElement("p");x.classList.add("panel-roster__cap-description"),x.textContent="Tune how many attendants rally before new recruits await the steam.",g.appendChild(x);const T=`panel-roster-cap-${Math.floor(Math.random()*1e5)}`,_=document.createElement("label");_.classList.add("panel-roster__cap-label"),_.htmlFor=T,_.textContent="Active attendants";const R=document.createElement("input");R.type="range",R.id=T,R.min="0",R.step="1",R.classList.add("panel-roster__cap-slider"),R.setAttribute("aria-label","Roster cap");const I=document.createElement("input");I.type="number",I.min="0",I.step="1",I.inputMode="numeric",I.classList.add("panel-roster__cap-number");const j=document.createElement("div");j.classList.add("panel-roster__cap-controls"),j.append(_,R,I),g.appendChild(j);const V=()=>{const Y=a.getRosterCapLimit?.();return typeof Y!="number"||!Number.isFinite(Y)?0:Math.max(0,Math.floor(Y))},X=()=>{const Y=a.getRosterCap?.();return typeof Y!="number"||!Number.isFinite(Y)?0:Math.max(0,Math.floor(Y))},$=(Y,B)=>{const C=Math.max(0,Math.min(Y,Math.floor(B))),J=$e.format(C);R.max=String(Y),R.value=String(C),R.setAttribute("aria-valuemin","0"),R.setAttribute("aria-valuemax",R.max),R.setAttribute("aria-valuenow",R.value),I.max=String(Y),I.value=String(C),I.setAttribute("aria-label",`Roster cap set to ${J}`);const q=C===0?"Paused":J;M.textContent=q,M.dataset.state=C===0?"paused":"active"},ee=typeof a.updateMaxRosterSize=="function";R.disabled=!ee,I.disabled=!ee;const te=(Y,B)=>{const C=V(),J=Math.max(0,Math.min(C,Number.isFinite(Y)?Math.floor(Y):0));let q=J;ee&&(q=a.updateMaxRosterSize(J,{persist:B})),$(C,q)};if($(V(),X()),ee){R.addEventListener("input",()=>{te(Number(R.value),!1)}),R.addEventListener("change",()=>{te(Number(R.value),!0)});const Y=B=>{te(Number(I.value),B)};I.addEventListener("input",()=>Y(!1)),I.addEventListener("change",()=>Y(!0)),I.addEventListener("blur",()=>Y(!0))}t.appendChild(g)})(),r.length===0){const g=document.createElement("p");g.classList.add("panel-roster__empty"),g.textContent="No attendants have rallied to the sauna yet.",t.appendChild(g);return}gA(t,r);const p=document.createElement("ul");p.classList.add("panel-roster__list"),p.setAttribute("role","list");for(const g of r){const b=document.createElement("li");b.classList.add("panel-roster__row");const v=document.createElement("button");v.type="button",v.classList.add("panel-roster__item"),v.dataset.unitId=g.id,v.dataset.status=g.status,v.setAttribute("aria-pressed",g.selected?"true":"false"),v.setAttribute("aria-label",pA(g)),v.title=`${g.name} • ${Hh[g.status]}`,g.selected&&v.classList.add("is-selected"),g.status==="downed"&&v.classList.add("is-downed");const M=document.createElement("div");M.classList.add("panel-roster__name-row");const x=document.createElement("div");x.classList.add("panel-roster__identity");const T=document.createElement("span");T.classList.add("panel-roster__level"),T.dataset.level=String(g.progression.level),T.style.setProperty("--level-progress","0%");const _=lv(g.progression.progress);T.style.setProperty("--level-progress",`${_}%`),T.setAttribute("role","img");const R=g.progression.xpForNext===null?`Level ${g.progression.level}, at mastery`:`Level ${g.progression.level}, ${_}% toward next level`;T.setAttribute("aria-label",R);const I=document.createElement("span");I.classList.add("panel-roster__level-value"),I.textContent=String(g.progression.level),T.appendChild(I);const j=document.createElement("span");j.classList.add("panel-roster__name"),j.textContent=g.name,j.title=g.name,x.append(T,j),M.appendChild(x);const V=document.createElement("span");V.classList.add("panel-roster__status"),V.dataset.status=g.status,V.textContent=Hh[g.status],M.appendChild(V);const X=document.createElement("div");X.classList.add("panel-roster__meta");const $=mA(g);X.textContent=$,X.title=$;const ee=document.createElement("div");ee.classList.add("panel-roster__xp");const te=fA(g.progression);ee.textContent=te,ee.title=te;const Y=document.createElement("div");Y.classList.add("panel-roster__callouts");const B=cv(g.progression.statBonuses);Y.textContent=B,Y.title=B;const C=document.createElement("div");C.classList.add("panel-roster__health");const J=document.createElement("div");J.classList.add("panel-roster__health-fill");const q=g.stats.maxHealth>0?Math.max(0,Math.min(100,Math.round(g.stats.health/g.stats.maxHealth*100))):0;J.style.width=`${q}%`,J.dataset.percent=`${q}`,C.appendChild(J);const ae=document.createElement("div");ae.classList.add("panel-roster__traits");const F=dA(g.traits);ae.textContent=F,ae.title=F,v.append(M,ee,X,Y,C,ae),yA(v,g,a),typeof a.onSelect=="function"&&v.addEventListener("click",()=>a.onSelect?.(g.id)),b.appendChild(v),p.appendChild(b)}t.appendChild(p)}}}const vA=150,SA="autobattles:log-history:v2",uv="autobattles:log-preferences:v1",Cm=typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:null;let Sb=0;const Mb=()=>(Sb+=1,`${Date.now().toString(36)}-${Sb.toString(36)}`),Eo=t=>{if(Array.isArray(t))return t.map(a=>typeof a=="string"?a.trim():"").filter(a=>a.length>0);if(typeof t=="string"){const a=t.trim();return a?[a]:[]}return[]},eh=t=>t?typeof t!="object"?{}:{...t}:{},MA=t=>{if(!t)return null;if(typeof t.unitId=="string"&&t.unitId.trim().length>0)return t.unitId.trim();const a=Eo(t.unitIds);return a.length>0?a[a.length-1]:null},EA=(t,a)=>{const s=Eo(t.unitIds??t.unitId),r=Eo(a.unitIds??a.unitId),l=Array.from(new Set([...s,...r])),u=Eo(t.unitNames??t.unitName),f=Eo(a.unitNames??a.unitName),h=Array.from(new Set([...u,...f])),m=typeof a.steward=="string"?a.steward:t.steward,p={...t,...a,unitIds:l,unitNames:h};return typeof m=="string"&&(p.steward=m),h.length>0&&(p.unitName=h[h.length-1]),l.length>0&&(p.unitId=l[l.length-1]),p};class xA{history=[];listeners=new Set;storage;storageKey;maxEntries;constructor(a={}){this.storage=a.storage??Cm,this.storageKey=a.storageKey??SA,this.maxEntries=Math.max(1,a.maxEntries??vA),this.hydrate()}hydrate(){if(this.storage)try{const a=this.storage.getItem(this.storageKey);if(!a)return;const s=JSON.parse(a);if(!Array.isArray(s))return;const r=[];for(const l of s){if(!l||typeof l!="object")continue;const u=l;if(typeof u.type!="string"||typeof u.message!="string")continue;const f={id:typeof u.id=="string"?u.id:Mb(),type:u.type,message:u.message,metadata:eh(u.metadata),timestamp:typeof u.timestamp=="number"&&Number.isFinite(u.timestamp)?u.timestamp:Date.now(),occurrences:typeof u.occurrences=="number"&&u.occurrences>0?Math.floor(u.occurrences):1};r.push(f)}r.length>0&&(r.length>this.maxEntries?this.history=r.slice(-this.maxEntries):this.history=r)}catch{this.history=[]}}persist(){if(this.storage)try{const a=JSON.stringify(this.history.map(s=>({id:s.id,type:s.type,message:s.message,metadata:s.metadata,timestamp:s.timestamp,occurrences:s.occurrences})));this.storage.setItem(this.storageKey,a)}catch{}}getHistory(){return this.history.map(a=>({...a,metadata:eh(a.metadata)}))}subscribe(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}clear(){if(this.history.length===0)return;const a=this.history.slice();this.history=[],this.persist(),this.emitChange({kind:"remove",entries:a})}emit(a){const s=eh(a.metadata),r={id:Mb(),type:a.type,message:a.message,metadata:s,timestamp:Date.now(),occurrences:1},l=this.tryAggregate(r);if(l)return this.history[l.index]=l.entry,this.persist(),this.emitChange({kind:"update",entry:l.entry,index:l.index}),l.entry;this.history.push(r);const u=[];for(;this.history.length>this.maxEntries;){const h=this.history.shift();h&&u.push(h)}this.persist(),u.length>0&&this.emitChange({kind:"remove",entries:u});const f=this.history.length-1;return this.emitChange({kind:"append",entry:r,index:f}),r}tryAggregate(a){if(a.type!=="spawn"||!MA(a.metadata)||this.history.length===0)return null;const r=this.history.length-1,l=this.history[r];return l.type!=="spawn"?null:{entry:{...l,id:l.id,message:a.message,metadata:EA(l.metadata??{},a.metadata??{}),timestamp:a.timestamp,occurrences:l.occurrences+a.occurrences},index:r}}emitChange(a){for(const s of this.listeners)try{s(a)}catch(r){console.warn("Failed to handle log change",r)}}}const Tm=new xA,It=t=>Tm.emit(t),AA=t=>Tm.subscribe(t),wA=()=>Tm.getHistory(),No={combat:{label:"Combat",accent:"var(--color-accent-red)"},spawn:{label:"Reinforcements",accent:"var(--color-accent-green)"},loot:{label:"Loot",accent:"var(--color-accent-gold)"},progression:{label:"Progression",accent:"var(--color-accent-blue)"},ability:{label:"Abilities",accent:"var(--color-accent-purple)"},resource:{label:"Economy",accent:"var(--color-accent-cyan)"},policy:{label:"Policies",accent:"var(--color-accent-orange)"},event:{label:"Events",accent:"var(--color-accent-pink)"},system:{label:"Systems",accent:"var(--color-muted)"}},Eb=["combat","spawn","loot","progression","ability","resource","policy","event","system"],Sc={mutedTypes:[]},CA=(t=Cm)=>{if(!t)return{...Sc};try{const a=t.getItem(uv);if(!a)return{...Sc};const s=JSON.parse(a);if(!s||typeof s!="object")return{...Sc};const r=Array.isArray(s.mutedTypes)?s.mutedTypes.filter(l=>typeof l=="string"&&l in No):[];return{mutedTypes:Array.from(new Set(r))}}catch{return{...Sc}}},TA=(t,a=Cm)=>{if(a)try{const s=Array.isArray(t.mutedTypes)?t.mutedTypes.filter(r=>r in No):[];a.setItem(uv,JSON.stringify({mutedTypes:Array.from(new Set(s))}))}catch{}},th=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function _A(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{log:()=>{},addEvent:()=>{},renderRoster:()=>{},dispose:()=>{}};const{regions:r,mobileBar:l}=dr(s),u=r.top,f=r.right,h=s.querySelector("#right-panel");h&&h.remove();const m=s.querySelector(".right-panel-slide");m&&m.remove();const p=s.querySelector("#right-panel-toggle");p&&p.remove();const g=document.createElement("div");g.id="right-panel",g.classList.add("hud-card"),g.setAttribute("role","complementary"),g.setAttribute("aria-label","Sauna command console"),g.tabIndex=-1;const b=document.createElement("div");b.className="right-panel-slide",b.setAttribute("aria-hidden","true");const v=document.createElement("div");v.className="right-panel-slide__backdrop",v.setAttribute("aria-hidden","true");const M=document.createElement("div");M.className="right-panel-slide__sheet",M.appendChild(g),b.append(v,M);const x=window.matchMedia("(max-width: 1040px)"),T=[],_=document.createElement("button");_.type="button",_.id="right-panel-toggle",_.classList.add("hud-panel-toggle"),_.setAttribute("aria-controls",g.id);const R=document.createElement("span");R.classList.add("hud-panel-toggle__icon"),R.setAttribute("aria-hidden","true");const I=document.createElement("span");I.classList.add("hud-panel-toggle__icon-bars"),R.appendChild(I);const j=document.createElement("span");j.classList.add("hud-panel-toggle__text");const V=document.createElement("span");V.classList.add("hud-panel-toggle__title"),V.textContent="Command Console";const X=document.createElement("span");X.classList.add("hud-panel-toggle__state"),j.append(V,X),_.append(R,j);const $=()=>{const k=u.querySelector("#topbar");k&&k.parentElement===u?k.insertAdjacentElement("afterend",_):u.prepend(_)};let ee=!1,te=!1,Y=!1,B=!1;const C="is-mobile-panel-open",J=()=>{Y?X.textContent=B?"Close":"Menu":X.textContent=ee?"Open":"Close"},q=()=>{if(Y){_.setAttribute("aria-expanded",B?"true":"false");const k=B?"Close command console panel":"Open command console panel";_.setAttribute("aria-label",k),_.title=B?"Close the sauna command console overlay":"Open the sauna command console overlay"}else{_.setAttribute("aria-expanded",ee?"false":"true");const k=ee?"Open command console panel":"Close command console panel";_.setAttribute("aria-label",k),_.title=ee?"Open the sauna command console overlay":"Close the sauna command console overlay"}},ae=()=>{J(),q()},F=(k,K=x.matches)=>{if(Y)return;const ce=ee;K&&(te=k);const me=k&&K;ee=me,g.classList.toggle("right-panel--collapsed",me),g.setAttribute("aria-hidden",me?"true":"false"),ae(),ce&&!me&&K&&g.focus({preventScroll:!0})},D=k=>{!Y||!B||k.key==="Escape"&&(k.preventDefault(),A())};let P=!1;const le=()=>{P||(document.addEventListener("keydown",D),P=!0)},ne=()=>{P&&(document.removeEventListener("keydown",D),P=!1)},E=()=>{!Y||B||(B=!0,b.classList.add("right-panel-slide--open"),b.setAttribute("aria-hidden","false"),g.setAttribute("aria-hidden","false"),document.body.classList.add(C),b.style.setProperty("--panel-drag-progress","1"),ae(),le(),requestAnimationFrame(()=>{g.focus({preventScroll:!0})}))},A=({skipFocus:k=!1}={})=>{!Y||!B||(Se(),B=!1,b.classList.remove("right-panel-slide--open"),b.setAttribute("aria-hidden","true"),g.setAttribute("aria-hidden","true"),document.body.classList.remove(C),b.style.setProperty("--panel-drag-progress","0"),ae(),ne(),k||_.focus({preventScroll:!0}))},z=k=>{if(Y)return;const K=k.matches;_.hidden=!K,F(K?te:!1,K)};typeof x.addEventListener=="function"?(x.addEventListener("change",z),T.push(()=>x.removeEventListener("change",z))):(x.addListener(z),T.push(()=>x.removeListener(z)));const Q=()=>{if(Y){B?A():E();return}F(!ee)};_.addEventListener("click",Q),T.push(()=>_.removeEventListener("click",Q));const se=()=>{A()};v.addEventListener("click",se),T.push(()=>v.removeEventListener("click",se));let de=null,ue=0,ge=0;const Se=()=>{de!==null&&(M.releasePointerCapture(de),de=null),M.style.transition="",M.style.transform="",b.style.setProperty("--panel-drag-progress",B?"1":"0")},rt=k=>{!Y||!B||k.pointerType==="mouse"&&k.button!==0||(de=k.pointerId,ue=k.clientX,ge=0,M.style.transition="none",M.setPointerCapture(k.pointerId))},_t=k=>{if(!Y||k.pointerId!==de||!B)return;ge=Math.max(0,k.clientX-ue);const K=M.offsetWidth||1,ce=Math.min(ge,K);M.style.transform=`translateX(${ce}px)`,b.style.setProperty("--panel-drag-progress",String(1-ce/K))},Ft=k=>{Se(),k&&A()},On=k=>{if(k.pointerId!==de)return;const K=M.offsetWidth||1,ce=ge>K*.35;Ft(ce)},zn=()=>{Ft(!1)};M.addEventListener("pointerdown",rt),M.addEventListener("pointermove",_t),M.addEventListener("pointerup",On),M.addEventListener("pointercancel",zn),T.push(()=>{M.removeEventListener("pointerdown",rt),M.removeEventListener("pointermove",_t),M.removeEventListener("pointerup",On),M.removeEventListener("pointercancel",zn)});const dn=ov(k=>{Y=k,Y?(M.appendChild(g),b.isConnected||s.appendChild(b),l.appendChild(_),_.classList.add("hud-panel-toggle--mobile"),_.hidden=!1,B||(g.setAttribute("aria-hidden","true"),b.setAttribute("aria-hidden","true"),b.style.setProperty("--panel-drag-progress","0"))):(A({skipFocus:!0}),b.style.setProperty("--panel-drag-progress","1"),b.remove(),f.appendChild(g),$(),_.classList.remove("hud-panel-toggle--mobile"),_.hidden=!x.matches,g.setAttribute("aria-hidden","false"),F(te,x.matches)),ae()});T.push(dn);const Mi=document.createElement("div");Mi.classList.add("panel-tabs"),g.appendChild(Mi);const os=document.createElement("div");os.classList.add("panel-content"),g.appendChild(os);const fe=document.createElement("div");fe.id="right-panel-roster",fe.setAttribute("role","region"),fe.setAttribute("aria-live","polite"),fe.setAttribute("aria-label","Battalion roster");const _e=document.createElement("div");_e.id="right-panel-policies";const Ge=document.createElement("div");Ge.id="right-panel-events";const ze=document.createElement("div");ze.id="right-panel-log",ze.setAttribute("role","region"),ze.setAttribute("aria-label","Combat log");const vt=document.createElement("section");vt.className="panel-log";const fn=document.createElement("header");fn.className="panel-log__header";const Zt=document.createElement("h3");Zt.className="panel-log__title",Zt.textContent="Combat Log";const An=document.createElement("span");An.className="panel-log__total",An.textContent="0 entries",fn.append(Zt,An);const oa=document.createElement("div");oa.className="panel-log__filters";const Qe=document.createElement("div");Qe.id="event-log",Qe.className="panel-log__feed",Qe.setAttribute("role","log"),Qe.setAttribute("aria-live","polite"),vt.append(fn,oa,Qe),ze.appendChild(vt);const Pe={Roster:fe,Policies:_e,Events:Ge,Log:ze},{onRosterSelect:Vt,onRosterRendererReady:Nt,onRosterEquipSlot:wu,onRosterUnequipSlot:Cu}=a;for(const[k,K]of Object.entries(Pe))K.classList.add("panel-section","panel-section--scroll"),K.dataset.tab=k,K.hidden=!0;ze.classList.add("panel-section--log");function Yo(k){for(const[K,ce]of Object.entries(Pe))ce.hidden=K!==k;for(const K of Array.from(Mi.children)){const ce=K,me=ce.textContent===k;ce.disabled=me,ce.setAttribute("aria-pressed",me?"true":"false")}}for(const k of Object.keys(Pe)){const K=document.createElement("button");K.type="button",K.textContent=k;const ce=Pe[k];ce?.id&&K.setAttribute("aria-controls",ce.id),K.setAttribute("aria-pressed","false");const me=()=>Yo(k);K.addEventListener("click",me),T.push(()=>K.removeEventListener("click",me)),Mi.appendChild(K),os.appendChild(Pe[k])}const ls=bA(fe,{onSelect:Vt,onEquipSlot:wu,onUnequipSlot:Cu,getRosterCap:a.getRosterCap,getRosterCapLimit:a.getRosterCapLimit,updateMaxRosterSize:a.updateMaxRosterSize}),Ha=k=>{ls.render(k)};Ha([]),typeof Nt=="function"&&Nt(Ha);const Bn={[oe.SAUNA_BEER]:"Sauna Beer Bottles",[oe.SAUNAKUNNIA]:"Saunakunnia",[oe.SISU]:"Sisu"},Ei=f2(),la=new Map;function Tu(k){const K=document.createElement("span");return K.className="policy-card__badge",K.textContent=k,K}function Fo(k){const K=document.createElement("article");K.className="policy-card",K.style.setProperty("--policy-gradient",k.visuals.gradient),K.style.setProperty("--policy-accent",k.visuals.accentColor);const ce=document.createElement("div");ce.className="policy-card__header";const me=document.createElement("div");me.className="policy-card__icon-frame";const Ne=document.createElement("img");Ne.className="policy-card__icon",Ne.src=k.visuals.icon,Ne.alt=`${k.name} icon`,me.appendChild(Ne);const Ye=document.createElement("div");Ye.className="policy-card__heading";const Te=document.createElement("h4");if(Te.className="policy-card__title",Te.textContent=k.name,Ye.appendChild(Te),k.visuals.badges?.length){const Gn=document.createElement("div");Gn.className="policy-card__badges",k.visuals.badges.forEach(tl=>Gn.appendChild(Tu(tl))),Ye.appendChild(Gn)}const nt=document.createElement("span");nt.className="policy-card__state",nt.textContent="Ready",ce.append(me,Ye,nt);const Jt=document.createElement("p");Jt.className="policy-card__description",Jt.textContent=k.description;const St=k.visuals.flair?(()=>{const Gn=document.createElement("p");return Gn.className="policy-card__flair",Gn.textContent=k.visuals.flair??"",Gn})():null,Wt=document.createElement("div");Wt.className="policy-card__actions";const en=document.createElement("span");en.className="policy-card__cost";const Ti=document.createElement("span");Ti.className="policy-card__cost-label",Ti.textContent="Cost";const ht=document.createElement("span");ht.className="policy-card__cost-value",ht.textContent=`${th.format(k.cost)} ${Bn[k.resource]}`,en.append(Ti,ht);const at=document.createElement("button");at.type="button",at.className="policy-card__action",at.textContent="Enact Policy";const Fa=document.createElement("p");Fa.className="policy-card__status";const Va=document.createElement("ul");Va.className="policy-card__requirements",Va.hidden=!0,Wt.append(en,at);const ha=()=>{t.applyPolicy(k.id)&&cs(k)};return at.addEventListener("click",ha),T.push(()=>at.removeEventListener("click",ha)),K.append(ce,Jt),St&&K.appendChild(St),K.append(Wt,Fa,Va),la.set(k.id,{card:K,action:at,stateBadge:nt,statusCopy:Fa,requirements:Va,costChip:en}),K}function Vo(){_e.innerHTML="",la.clear();const k=document.createElement("div");k.className="policy-grid",Ei.forEach(K=>{const ce=Fo(K);k.appendChild(ce)}),_e.appendChild(k),qn()}function cs(k){const K=la.get(k.id);if(!K)return;const ce=t.hasPolicy(k.id),me=k.prerequisites.filter(St=>!St.isSatisfied(t)),Ne=t.canAfford(k.cost,k.resource);K.action.disabled=ce||me.length>0||!Ne,K.action.textContent=ce?"Enacted":"Enact Policy";let Ye="ready",Te="Ready",nt=k.spotlight??"All signals point to go.";K.requirements.innerHTML="",K.requirements.hidden=!0,ce?(Ye="applied",Te="Enacted",nt=k.visuals.flair??"Policy active."):me.length>0?(Ye="locked",Te="Locked",nt="Awaiting requirements:",K.requirements.hidden=!1,me.forEach(St=>{const Wt=document.createElement("li");Wt.textContent=St.description,K.requirements.appendChild(Wt)})):Ne||(Ye="budget",Te="Needs Resources",nt=`Earn ${th.format(k.cost)} ${Bn[k.resource]} to enact this edict.`),K.card.dataset.status=Ye,K.stateBadge.textContent=Te,K.statusCopy.textContent=nt;const Jt=!ce&&me.length===0&&!Ne;K.costChip.classList.toggle("policy-card__cost--warning",Jt)}function qn(){Ei.forEach(k=>cs(k))}Vo();const $o=k=>qn(),fr=k=>qn(),hr=k=>qn();re.on("resourceChanged",$o),re.on(jt.APPLIED,fr),re.on(jt.REJECTED,hr),T.push(()=>{re.off("resourceChanged",$o),re.off(jt.APPLIED,fr),re.off(jt.REJECTED,hr)});function mr(k,K){const ce=document.createElement("button");ce.type="button",ce.classList.add("event-card__choice"),K.accent&&ce.classList.add(`event-card__choice--${K.accent}`),ce.dataset.choiceId=K.id;const me=document.createElement("span");if(me.className="event-card__choice-label",me.textContent=K.label,ce.appendChild(me),K.description){const Ne=document.createElement("span");Ne.className="event-card__choice-detail",Ne.textContent=K.description,ce.appendChild(Ne)}return ce.addEventListener("click",()=>{if(!ce.isConnected)return;ce.disabled=!0,Ao.resolve(k.id,K.id)||(ce.disabled=!1)}),ce}function pr(k){if(Ge.innerHTML="",k.length===0){const ce=document.createElement("div");ce.className="event-card event-card--empty";const me=document.createElement("p");me.className="event-card__empty",me.textContent="All clear. Command will notify you when new briefings arrive.",ce.appendChild(me),Ge.appendChild(ce);return}const K=document.createDocumentFragment();for(const ce of k){const me=document.createElement("article");me.className="event-card",me.dataset.eventId=ce.id,me.style.setProperty("--event-accent",ce.accentColor??"var(--color-accent)");const Ne=(ce.typography??"sans").toLowerCase();me.classList.add(`event-card--${["serif","mono"].includes(Ne)?Ne:"sans"}`);const Ye=(ce.animation??"").toLowerCase();["aurora","pulse","tilt"].includes(Ye)&&me.classList.add(`event-card--${Ye}`);const Te=document.createElement("div");if(Te.className="event-card__frame",ce.art){const at=document.createElement("div");at.className="event-card__media",at.style.backgroundImage=`url(${ce.art})`,Te.appendChild(at)}const nt=document.createElement("div");nt.className="event-card__body";const Jt=document.createElement("span");Jt.className="event-card__badge",Jt.textContent="Priority Dispatch",nt.appendChild(Jt);const St=document.createElement("h4");St.className="event-card__headline",St.textContent=ce.headline,nt.appendChild(St);const Wt=document.createElement("p");Wt.className="event-card__copy",Wt.textContent=ce.body,nt.appendChild(Wt);const en=document.createElement("div");en.className="event-card__choices";const Ti=ce.choices&&ce.choices.length>0?ce.choices:[{id:"acknowledge",label:ce.acknowledgeText??"Acknowledge"}];for(const at of Ti){const Fa=mr(ce,{id:at.id,label:at.label,description:at.description,event:at.event,payload:at.payload,accent:at.accent});en.appendChild(Fa)}nt.appendChild(en),Te.appendChild(nt);const ht=document.createElement("span");ht.className="event-card__shimmer",me.append(Te,ht),K.appendChild(me)}Ge.appendChild(K)}const Xo=Ao.subscribe(pr);T.push(Xo);const Qo=({event:k})=>{It({type:"event",message:`Event • ${k.headline}`,metadata:{eventId:k?.id??k.headline,headline:k.headline}})};re.on(Hc.TRIGGERED,Qo),T.push(()=>{re.off(Hc.TRIGGERED,Qo)});function Hn(k){Ao.publish(k)}const et=new Map,ft=new Map,ca=new Map,ja=new Set(CA().mutedTypes??[]),wn=new Set;for(const k of Eb)ja.has(k)||wn.add(k),ft.set(k,0);let us=0,xi=!0;const Ai=typeof requestAnimationFrame=="function"?requestAnimationFrame:k=>setTimeout(k,16),ds=k=>th.format(Math.max(0,k)),ua=()=>{const k=us===1?"entry":"entries";An.textContent=`${ds(us)} ${k}`},Ga=k=>{const K=ca.get(k);K&&(K.textContent=ds(ft.get(k)??0))},da=(k,K)=>{if(K===0)return;const ce=ft.get(k)??0;ft.set(k,Math.max(0,ce+K)),us=Math.max(0,us+K),Ga(k),ua()},fa=()=>Qe.scrollHeight-(Qe.scrollTop+Qe.clientHeight)<48,tt=()=>{Ai(()=>{Qe.scrollTop=Qe.scrollHeight,xi=!0})},fs=k=>{const K=wn.has(k.type);k.element.hidden=!K,k.element.classList.toggle("panel-log-entry--muted",!K)},Ko=k=>{const K=k.metadata??{};return(Array.isArray(K.unitNames)?K.unitNames:typeof K.unitName=="string"?[K.unitName]:[]).map(me=>typeof me=="string"?me.trim():"").filter(me=>me.length>0)},jn=(k,K)=>{if(K.type!=="spawn"){k.replaceChildren(),k.hidden=!0;return}const ce=Ko(K),me=ce.map(Ye=>{const Te=document.createElement("span");return Te.className="panel-log-entry__token",Te.textContent=Ye,Te}),Ne=K.occurrences-ce.length;if(Ne>0){const Ye=document.createElement("span");Ye.className="panel-log-entry__token panel-log-entry__token--more",Ye.textContent=`+${Ne}`,me.push(Ye)}me.length===0?(k.replaceChildren(),k.hidden=!0):(k.replaceChildren(...me),k.hidden=!1)},Ya=k=>{const K=document.createElement("article");K.className="panel-log-entry",K.dataset.logType=k.type,K.style.setProperty("--log-entry-accent",No[k.type]?.accent??"var(--color-accent)");const ce=document.createElement("div");ce.className="panel-log-entry__header";const me=document.createElement("span");me.className="panel-log-entry__type",me.textContent=No[k.type]?.label??k.type;const Ne=document.createElement("span");Ne.className="panel-log-entry__badge";const Ye=document.createElement("p");Ye.className="panel-log-entry__message",Ye.textContent=k.message;const Te=document.createElement("div");Te.className="panel-log-entry__tokens",Te.hidden=!0,ce.append(me,Ne),K.append(ce,Ye,Te);const nt=St=>{St<=1?(Ne.textContent="",Ne.hidden=!0):(Ne.hidden=!1,Ne.textContent=`×${St}`)},Jt={element:K,type:k.type,occurrences:k.occurrences,badge:Ne,message:Ye,tokens:Te,setBadge:nt};return nt(k.occurrences),jn(Te,k),Jt},Po=(k,K=!1)=>{const ce=K?!0:fa()||xi,me=Ya(k);et.set(k.id,me),Qe.appendChild(me.element),da(me.type,me.occurrences),fs(me),ce&&tt()},Zo=k=>{const K=et.get(k.id);if(!K)return;const ce=k.occurrences-K.occurrences;ce!==0&&(K.occurrences=k.occurrences,da(K.type,ce)),K.message.textContent=k.message,K.setBadge(k.occurrences),K.tokens&&jn(K.tokens,k),fs(K),xi&&tt()},Jo=k=>{const K=et.get(k.id);K&&(et.delete(k.id),da(K.type,-K.occurrences),K.element.parentElement===Qe&&Qe.removeChild(K.element))},Wo=()=>{for(const k of et.values())fs(k)};for(const k of Eb){const K=No[k],ce=document.createElement("button");ce.type="button",ce.className="log-chip",ce.dataset.logFilter=k,ce.style.setProperty("--log-chip-accent",K?.accent??"var(--color-accent)"),ce.setAttribute("aria-pressed",wn.has(k)?"true":"false"),ce.setAttribute("aria-label",`${K?.label??k} log filter`);const me=document.createElement("span");me.className="log-chip__label",me.textContent=K?.label??k;const Ne=document.createElement("span");Ne.className="log-chip__count",Ne.textContent="0",ca.set(k,Ne),wn.has(k)||ce.classList.add("is-muted"),ce.append(me,Ne),oa.appendChild(ce),ce.addEventListener("click",()=>{wn.has(k)?(wn.delete(k),ja.add(k)):(wn.add(k),ja.delete(k)),ce.classList.toggle("is-muted",!wn.has(k)),ce.setAttribute("aria-pressed",wn.has(k)?"true":"false"),TA({mutedTypes:Array.from(ja)}),Wo()})}ua();const wi=()=>{xi=fa()};Qe.addEventListener("scroll",wi,{passive:!0}),T.push(()=>Qe.removeEventListener("scroll",wi));const Ci=wA();if(Ci.length>0){for(const k of Ci)Po(k,!0);tt()}const Cn=AA(k=>{if(k.kind==="append")Po(k.entry);else if(k.kind==="update")Zo(k.entry);else if(k.kind==="remove")for(const K of k.entries)Jo(K)});return T.push(Cn),Wo(),Yo("Roster"),{log:k=>{It(k)},addEvent:Hn,renderRoster:Ha,dispose:()=>{for(const k of T.splice(0))try{k()}catch(K){console.warn("Failed to dispose HUD listener",K)}ne(),Se(),document.body.classList.remove(C),b.remove(),_.remove(),g.remove()}}}const NA=t=>`[data-tutorial-target="${t}"]`,Qn=16,Mc=12,xb="is-tutorial-highlighted",RA=[{id:"heat",target:"heat",title:"Heat the Sauna",description:"Keep the sauna fires roaring. This control shows when the next warrior emerges from the steam."},{id:"upkeep",target:"upkeep",title:"Mind Your Upkeep",description:"Every attendant draws upkeep. Track totals and see a featured roster member to balance your economy."},{id:"sisu",target:"sisu",title:"Stockpile SISU",description:"SISU fuels heroic bursts. Watch this meter to know when your grit reserves can power signature moves."},{id:"enemy-ramp",target:"enemy-ramp",title:"Read the Enemy Ramp",description:"The badge shows the current stage, upcoming multiplier surges, and calm lulls before the next pressure wave."},{id:"combat",target:"combat",title:"Command the Fight",description:"Trigger a Sisu Burst to supercharge allied attacks or rally everyone home with a Torille call."},{id:"victory",target:"victory",title:"Claim Victory",description:"Destroy every enemy stronghold to win the campaign. The Saunakunnia badge tracks your march toward total conquest."},{id:"defeat",target:"sauna-integrity",title:"Avert Defeat",description:"Defeat strikes if the sauna is razed, every attendant is downed for 8 seconds, or upkeep bankruptcy lingers for 12 seconds. Guard the integrity meter and keep your roster on its feet."}];function kA(t,a,s){return Math.max(a,Math.min(s,t))}function LA(t={}){const a=t.steps??RA;if(a.length===0)throw new Error("Tutorial requires at least one step.");let s=-1,r=null,l=!1;const u=document.createElement("div");u.className="tutorial-overlay";const f=document.createElement("div");f.className="tutorial-overlay__spotlight",f.setAttribute("aria-hidden","true");const h=document.createElement("section");h.className="tutorial-card",h.setAttribute("role","dialog"),h.setAttribute("aria-modal","false"),h.tabIndex=-1;const m=document.createElement("header");m.className="tutorial-card__header";const p=document.createElement("h2");p.className="tutorial-card__title";const g=document.createElement("button");g.type="button",g.className="tutorial-card__close",g.setAttribute("aria-label","Dismiss tutorial"),g.textContent="×",m.append(p,g);const b=document.createElement("p");b.className="tutorial-card__description";const v=document.createElement("p");v.className="tutorial-card__progress";const M=document.createElement("div");M.className="tutorial-card__controls";const x=document.createElement("button");x.type="button",x.className="tutorial-card__button tutorial-card__button--secondary",x.textContent="Back";const T=document.createElement("button");T.type="button",T.className="tutorial-card__button",T.textContent="Next";const _=document.createElement("button");_.type="button",_.className="tutorial-card__skip",_.textContent="Skip tutorial",M.append(x,T),h.append(m,b,v,M,_),u.append(f,h);const R=typeof ResizeObserver<"u"?new ResizeObserver(()=>{s>=0&&ee()}):null,I=()=>{s>=0&&ee()};function j(){l||(document.body.appendChild(u),window.addEventListener("resize",ee),document.addEventListener("scroll",I,!0),R?.observe(h),l=!0)}function V(){l&&(window.removeEventListener("resize",ee),document.removeEventListener("scroll",I,!0),R?.disconnect(),u.remove(),l=!1)}function X(F){if(r&&r!==F&&(r.classList.remove(xb),r.removeAttribute("data-tutorial-highlight")),r=F,!F){f.style.opacity="0";return}F.classList.add(xb),F.setAttribute("data-tutorial-highlight","true"),f.style.opacity="1"}function $(){if(!r)return null;const F=r.getBoundingClientRect();return F.width===0&&F.height===0?null:{top:F.top,left:F.left,width:F.width,height:F.height}}function ee(){const F=$();if(!F){h.style.top=`${Qn}px`,h.style.left=`${Qn}px`,h.classList.add("tutorial-card--floating"),f.style.opacity="0";return}h.classList.remove("tutorial-card--floating"),f.style.opacity="1";const D=F.top-Mc,P=F.left-Mc,le=F.width+Mc*2,ne=F.height+Mc*2;f.style.top=`${D}px`,f.style.left=`${P}px`,f.style.width=`${le}px`,f.style.height=`${ne}px`;const E=h.getBoundingClientRect();let z=window.innerHeight-F.top-F.height>=F.top?F.top+F.height+Qn:F.top-E.height-Qn;z<Qn?z=Qn:z+E.height>window.innerHeight-Qn&&(z=window.innerHeight-Qn-E.height);let se=F.left+F.width/2-E.width/2;se=kA(se,Qn,window.innerWidth-E.width-Qn),h.style.top=`${Math.round(z)}px`,h.style.left=`${Math.round(se)}px`}function te(){requestAnimationFrame(()=>{h.focus({preventScroll:!0})})}function Y(F){if(F<0||F>=a.length)return;j(),s=F;const D=a[F];p.textContent=D.title,b.textContent=D.description,v.textContent=`Step ${F+1} of ${a.length}`,x.disabled=F===0,T.textContent=F===a.length-1?"Finish":"Next";const P=document.querySelector(NA(D.target));X(P??null),ee(),te()}function B(){if(s===-1){Y(0);return}if(s>=a.length-1){ae();return}Y(s+1)}function C(){s<=0||Y(s-1)}function J(){X(null),V(),s=-1}function q(){t.onSkip?.(),J()}function ae(){t.onComplete?.(),J()}return x.addEventListener("click",()=>{C()}),T.addEventListener("click",()=>{B()}),_.addEventListener("click",()=>{q()}),g.addEventListener("click",()=>{q()}),h.addEventListener("keydown",F=>{F.defaultPrevented||(F.key==="ArrowRight"?(F.preventDefault(),B()):F.key==="ArrowLeft"?(F.preventDefault(),C()):F.key==="Escape"&&(F.preventDefault(),q()))}),{start(){s===-1&&Y(0)},next:B,previous:C,skip:q,finish:ae,destroy(){J()}}}const DA=Math.sqrt(3),IA=2;function Pc(t){return{width:t*DA,height:t*IA}}const ka=16,Ec=2;function UA(){return typeof window<"u"&&window.devicePixelRatio||1}function OA(t,a){const s=Math.max(t.qMin,a.minQ),r=Math.min(t.qMax,a.maxQ),l=Math.max(t.rMin,a.minR),u=Math.min(t.rMax,a.maxR);return s>r||l>u?null:{qMin:s,qMax:r,rMin:l,rMax:u}}function zA(t,a){const s=UA(),r=a.width/(s*t.zoom),l=a.height/(s*t.zoom);return{x:t.x-r/2,y:t.y-l/2,width:r,height:l}}function BA(t,a){const s=[So(t.x,t.y,a),So(t.x+t.width,t.y,a),So(t.x,t.y+t.height,a),So(t.x+t.width,t.y+t.height,a)];let r=1/0,l=-1/0,u=1/0,f=-1/0;for(const h of s)r=Math.min(r,h.q),l=Math.max(l,h.q),u=Math.min(u,h.r),f=Math.max(f,h.r);return{qMin:Math.floor(r)-Ec,qMax:Math.ceil(l)+Ec,rMin:Math.floor(u)-Ec,rMax:Math.ceil(f)+Ec}}function qA(t,a,s,r){if(!s||typeof s.width!="number"||typeof s.height!="number")return{qMin:t.minQ,qMax:t.maxQ,rMin:t.minR,rMax:t.maxR};if(s.width===0||s.height===0)return{qMin:t.minQ,qMax:t.maxQ,rMin:t.minR,rMax:t.maxR};const l=zA(a,s);return OA(BA(l,r),t)}function Js(t){return Math.floor(t/ka)}function dv(t){return`${t.q},${t.r}`}function HA(t,a){return dv({q:Js(t),r:Js(a)})}function jA(t){return{qMin:Js(t.qMin),qMax:Js(t.qMax),rMin:Js(t.rMin),rMax:Js(t.rMax)}}function fv(t){const a=[];for(let s=t.rMin;s<=t.rMax;s++)for(let r=t.qMin;r<=t.qMax;r++)a.push({q:r,r:s});return a}function GA(t,a){const s=a.q*ka,r=a.r*ka,l=s+ka-1,u=r+ka-1,f=Math.max(s,t.minQ),h=Math.min(l,t.maxQ),m=Math.max(r,t.minR),p=Math.min(u,t.maxR);if(!(f>h||m>p))for(let g=m;g<=p;g++)for(let b=f;b<=h;b++)t.ensureTile(b,g)}function YA(t,a){for(const s of fv(a))GA(t,s)}const FA="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3ePlains%20Tile%3c/title%3e%3cdesc%20id='desc'%3eRolling%20plains%20with%20sunrise%20gradients%20and%20glowing%20grasses.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='plains-bg'%20cx='50%25'%20cy='50%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='plains-field'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='0%25'%3e%3cstop%20offset='0%25'%20stop-color='%23facc15'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23eab308'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='plains-haze'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f59e0b'%20stop-opacity='0.2'%20/%3e%3c/linearGradient%3e%3cfilter%20id='plains-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='5'%20stdDeviation='6'%20flood-color='%23facc15'%20flood-opacity='0.35'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23plains-bg)'%20/%3e%3cg%20filter='url(%23plains-glow)'%3e%3cpath%20d='M16%2088c20-18%2036-22%2048-22s28%204%2048%2022'%20fill='url(%23plains-field)'%20stroke='%23fef9c3'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M24%20102c16-14%2032-18%2040-18s24%204%2040%2018'%20fill='none'%20stroke='%23fde68a'%20stroke-width='5'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M32%2070c12-10%2024-14%2032-14s20%204%2032%2014'%20fill='url(%23plains-haze)'%20opacity='0.7'%20/%3e%3cpath%20d='M52%2078l4%2012m8-12l4%2012m8-12l4%2012'%20stroke='%23fef3c7'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='36'%20r='8'%20fill='%23fef08a'%20opacity='0.7'%20/%3e%3c/svg%3e",VA="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eForest%20Tile%3c/title%3e%3cdesc%20id='desc'%3eStylised%20evergreen%20trees%20glowing%20against%20a%20deep%20night%20backdrop.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='forest-bg'%20cx='50%25'%20cy='40%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230b1120'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='forest-leaf'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%234ade80'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2315803d'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='forest-trunk'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23a855f7'%20/%3e%3cstop%20offset='100%25'%20stop-color='%237c3aed'%20/%3e%3c/linearGradient%3e%3cfilter%20id='forest-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%234ade80'%20flood-opacity='0.25'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23forest-bg)'%20/%3e%3cg%20filter='url(%23forest-glow)'%20stroke='%23bbf7d0'%20stroke-width='2'%3e%3cpath%20fill='url(%23forest-leaf)'%20d='M64%2026L32%2080h18l-12%2022h28l-10-22h16l-10%2022h28l-12-22h18z'%20/%3e%3crect%20x='58'%20y='74'%20width='12'%20height='18'%20rx='3'%20fill='url(%23forest-trunk)'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20stroke-opacity='0.5'%20d='M44%2086c6-4%2012-6%2020-6s14%202%2020%206'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='40'%20r='6'%20fill='%23fef3c7'%20opacity='0.6'%20/%3e%3ccircle%20cx='88'%20cy='32'%20r='4'%20fill='%23fef3c7'%20opacity='0.4'%20/%3e%3c/svg%3e",$A="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eMountain%20Tile%3c/title%3e%3cdesc%20id='desc'%3eJagged%20alpine%20peaks%20with%20luminous%20snowcaps.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='mountain-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%23111827'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='mountain-rock'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2364748b'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23334155'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mountain-snow'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23cbd5f5'%20/%3e%3c/linearGradient%3e%3cfilter%20id='mountain-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%23f8fafc'%20flood-opacity='0.2'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23mountain-bg)'%20/%3e%3cg%20filter='url(%23mountain-glow)'%20stroke='%23cbd5f5'%20stroke-width='2'%20stroke-linejoin='round'%3e%3cpath%20fill='url(%23mountain-rock)'%20d='M24%20100l32-52%2014%2022%2012-18%2022%2048z'%20/%3e%3cpath%20fill='url(%23mountain-snow)'%20d='M56%2048l14%2022%2012-18%2010%2022H48z'%20opacity='0.85'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20opacity='0.6'%20d='M32%2094c10-6%2020-9%2032-9s22%203%2032%209'%20/%3e%3c/g%3e%3ccircle%20cx='92'%20cy='32'%20r='6'%20fill='%23f1f5f9'%20opacity='0.5'%20/%3e%3c/svg%3e",XA="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eWater%20Tile%3c/title%3e%3cdesc%20id='desc'%3eGlowing%20waves%20surrounding%20a%20crystalline%20droplet.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='water-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230b1120'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='water-wave'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='water-drop'%20x1='50%25'%20y1='0%25'%20x2='50%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230284c7'%20/%3e%3c/linearGradient%3e%3cfilter%20id='water-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='8'%20flood-color='%2338bdf8'%20flood-opacity='0.3'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23water-bg)'%20/%3e%3cg%20filter='url(%23water-glow)'%3e%3cpath%20d='M32%2076c12-10%2024-15%2032-15s20%205%2032%2015'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3cpath%20d='M28%2092c14-12%2030-18%2040-18s26%206%2040%2018'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='6'%20stroke-linecap='round'%20opacity='0.7'%20/%3e%3cpath%20d='M40%2060c10-8%2018-12%2024-12s14%204%2024%2012'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M64%2030c-12%2020-18%2032-18%2042%200%2011%208%2020%2018%2020s18-9%2018-20c0-10-6-22-18-42z'%20fill='url(%23water-drop)'%20stroke='%23e0f2fe'%20stroke-width='2'%20/%3e%3c/g%3e%3ccircle%20cx='94'%20cy='34'%20r='6'%20fill='%23f8fafc'%20opacity='0.45'%20/%3e%3c/svg%3e",QA=.01;function hv(t){return!Number.isFinite(t)||t<=QA?1:t}function KA(t,a){return t/hv(a)}function Wn(t,a){const s=hv(a);return Math.round(t*s)/s}const Ab={[En.Plains]:{baseColor:"#d8b869",icon:FA},[En.Forest]:{baseColor:"#237a55",icon:VA},[En.Hills]:{baseColor:"#b57c57",icon:$A},[En.Lake]:{baseColor:"#3185d5",icon:XA}},PA=[255,255,255],_m=[12,18,28],ZA=[0,0,0],wb="rgba(56, 189, 248, 0.85)",Cb="rgba(56, 189, 248, 0.45)";let po=null,go=null;const JA=t=>Math.min(1,Math.max(0,t));function WA(t){let a=t.trim().replace("#","");a.length===3&&(a=a.split("").map(r=>r+r).join(""));const s=Number.parseInt(a,16);return[s>>16&255,s>>8&255,s&255]}function Zc(t,a,s){const r=JA(s);return[Math.round(t[0]+(a[0]-t[0])*r),Math.round(t[1]+(a[1]-t[1])*r),Math.round(t[2]+(a[2]-t[2])*r)]}function Tb(t){return`rgb(${t[0]}, ${t[1]}, ${t[2]})`}function Jc(t,a=1){return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${a})`}function Wc(t,a=1){return Jc(Zc(_m,PA,t),a)}function nr(t,a=1){return Jc(Zc(_m,ZA,t),a)}const ew={terrain:.05,hover:.065,selection:.085},tw={terrain:1,hover:1.35,selection:2.1};function eu(t,a,s="terrain"){const r=t*ew[s],l=KA(r,a);return Math.max(tw[s],l)}function nw(){if(po&&go)return{stroke:po,glow:go};if(typeof window<"u"){const t=getComputedStyle(document.documentElement),a=t.getPropertyValue("--tile-highlight-ring").trim(),s=t.getPropertyValue("--tile-highlight-glow").trim();po=a||wb,go=s||Cb}else po=wb,go=Cb;return{stroke:po,glow:go}}function mv(t){return Math.min(1,Math.max(0,t))}function bu(t){let a=t.trim();if(a.startsWith("#")&&(a=a.slice(1)),a.length===3){const s=Number.parseInt(a[0]+a[0],16),r=Number.parseInt(a[1]+a[1],16),l=Number.parseInt(a[2]+a[2],16);return[s,r,l]}if(a.length===6){const s=Number.parseInt(a,16),r=s>>16&255,l=s>>8&255,u=s&255;return[r,l,u]}return[0,0,0]}function aw(t,a,s){const r=mv(s),l=(u,f)=>Math.round(u+(f-u)*r);return[l(t[0],a[0]),l(t[1],a[1]),l(t[2],a[2])]}function iw([t,a,s],r){return`rgba(${t}, ${a}, ${s}, ${mv(r)})`}function Si(t,a,s,r){return iw(aw(t,a,s),r)}function sw(t){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=t,m=bu(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=Si(m,[255,255,255],.35,.24);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.06);const g=3,b=6,v=s+l*.12,M=s+l*.88;for(let R=0;R<g;R++){const I=R/Math.max(1,g-1),j=r+u*.28+I*u*.32,V=f*(.18-I*.05);a.beginPath();for(let X=0;X<=b;X++){const $=X/b,ee=v+(M-v)*$,te=Math.sin($*Math.PI*1.6+R*.8)*V,Y=j-Math.abs(te)*.55;X===0?a.moveTo(ee,Y):a.lineTo(ee,Y)}a.stroke()}const x=Si(m,[18,54,32],.4,.2);a.strokeStyle=x,a.lineWidth=Math.max(.75,f*.035);const T=5,_=f*.22;for(let R=0;R<T;R++){const I=s+l*(.2+R/Math.max(1,T-1)*.6),j=r+u*.55-Math.cos(R*.9)*f*.08;a.beginPath(),a.arc(I,j,_,Math.PI*.2,Math.PI*.85),a.stroke(),a.beginPath(),a.arc(I+_*.35,j-_*.1,_*.55,Math.PI*.15,Math.PI*.95),a.stroke()}a.restore()}function rw(t){const{ctx:a,centerX:s,centerY:r,radius:l,baseColor:u}=t,f=bu(u);a.save(),a.lineCap="round";const h=Si(f,[255,235,214],.45,.22);a.strokeStyle=h,a.lineWidth=Math.max(1,l*.05);const m=4;for(let b=0;b<m;b++){const v=b/Math.max(1,m-1),M=l*(1.25-v*.45),x=l*(.72-v*.18),T=r+l*.18*(v-.5);a.beginPath(),a.ellipse(s,T,M,x,0,Math.PI*.12,Math.PI*.88),a.stroke()}const p=Si(f,[60,36,20],.35,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,l*.032),a.setLineDash([l*.22,l*.18]);const g=3;for(let b=0;b<g;b++){const v=l*(.75-b*.1),M=r+l*.28+b*l*.08;a.beginPath(),a.arc(s+l*.08,M,v,Math.PI*.28,Math.PI*.76),a.stroke()}a.setLineDash([]),a.restore()}function ow(t){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=t,m=bu(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=Si(m,[255,255,255],.55,.28);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.045);const g=4,b=7,v=s+l*.12,M=s+l*.88,x=f*.16;for(let R=0;R<g;R++){const I=R/Math.max(1,g-1),j=r+u*.3+I*u*.4;a.beginPath();for(let V=0;V<=b;V++){const X=V/b,$=v+(M-v)*X,ee=Math.sin(X*Math.PI*2+R*.6)*x*(.75-I*.2),te=j+ee;V===0?a.moveTo($,te):a.lineTo($,te)}a.stroke()}const T=Si(m,[12,52,94],.4,.2);a.strokeStyle=T,a.lineWidth=Math.max(.8,f*.03);const _=3;for(let R=0;R<_;R++){const I=R/Math.max(1,_-1),j=r+u*.35+I*u*.35;a.beginPath();for(let V=0;V<=b;V++){const X=V/b,$=v+(M-v)*X,ee=Math.sin(X*Math.PI*2+R)*x*.35,te=j+ee;V===0?a.moveTo($,te):a.lineTo($,te)}a.stroke()}a.restore()}function pv(t){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=t,m=bu(h);a.save(),a.lineCap="round";const p=Si(m,[255,255,255],.42,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,f*.03);const g=f*.55;for(let M=-1;M<=2;M++){const x=g*M;a.beginPath(),a.moveTo(s+x,r+u*.25),a.lineTo(s+x+l*.75,r+u*.85),a.stroke()}const b=Si(m,[112,82,32],.3,.16);a.strokeStyle=b,a.lineWidth=Math.max(.7,f*.025),a.setLineDash([f*.24,f*.34]);const v=f*.48;for(let M=0;M<3;M++){const x=v*M;a.beginPath(),a.moveTo(s+l*.18+x,r+u*.78),a.lineTo(s+l*.7+x,r+u*.38),a.stroke()}a.setLineDash([]),a.restore()}const _b=new Map;let Fi=null;function lw(){if(Fi)return Fi;const t="/";if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(t))return Fi=t,Fi;const s=t.startsWith("/")?t:`/${t}`;return typeof window<"u"&&typeof window.location?.origin=="string"?Fi=`${window.location.origin}${s}`:Fi=`http://localhost${s}`,Fi}function cw(t){let a=_b.get(t);if(!a){a=new Image,a.decoding="async";const s=new URL(t,lw()).href;a.src=s,_b.set(t,a)}if(a.complete&&a.naturalWidth>0&&a.naturalHeight>0)return a}const uw={[En.Plains]:pv,[En.Forest]:sw,[En.Hills]:rw,[En.Lake]:ow};function gv(t,a,s,r){t.beginPath();for(let l=0;l<6;l++){const u=Math.PI/180*(60*l-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?t.moveTo(f,h):t.lineTo(f,h)}t.closePath()}function dw(t,a,s,r){gv(t,a,s,r),t.save(),t.lineJoin="round",t.lineCap="round",t.lineWidth=eu(r,1,"terrain"),t.strokeStyle=Wc(.16,.6),t.stroke(),t.restore()}function fw(t,a,s,r,l,u,f,h){const m=Ab[a.terrain]??Ab[En.Plains],p=WA(m.baseColor),g=r+u/2,b=l+f/2;t.save(),gv(t,g,b,h),t.clip();const v=t.createRadialGradient(g,b,h*.2,g,b,h*1.05);v.addColorStop(0,Tb(Zc(p,[255,255,255],.3))),v.addColorStop(.7,m.baseColor),v.addColorStop(1,Tb(Zc(p,_m,.4))),t.fillStyle=v,t.shadowColor=Jc(p,.35),t.shadowBlur=h*.9,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillRect(r-h*.1,l-h*.1,u+h*.2,f+h*.2);const M={ctx:t,x:r,y:l,width:u,height:f,radius:h,centerX:g,centerY:b,baseColor:m.baseColor};(uw[a.terrain]??pv)(M),t.globalCompositeOperation="lighter";const T=t.createRadialGradient(g,b,h*.85,g,b,h*1.18);T.addColorStop(0,"rgba(255, 255, 255, 0)"),T.addColorStop(1,Jc(p,.18)),t.fillStyle=T,t.fillRect(r-h*.1,l-h*.1,u+h*.2,f+h*.2),t.globalCompositeOperation="source-over",t.restore();const _=cw(m.icon);if(_){const R=Math.min(u,f)*.62,I=g-R/2,j=b-R/2;t.save(),t.globalAlpha*=.92,t.drawImage(_,I,j,R,R),t.restore()}if(a.building){const R=s[`building-${a.building}`]??s.placeholder;t.drawImage(R,r,l,u,f)}}function hw(t,a){const s=Math.max(t.q*ka,a.minQ),r=Math.min(s+ka-1,a.maxQ),l=Math.max(t.r*ka,a.minR),u=Math.min(l+ka-1,a.maxR);return{qStart:s,qEnd:r,rStart:l,rEnd:u}}class mw{constructor(a){this.map=a,this.unsubscribe=a.addTileChangeListener((s,r,l)=>{this.onTileChange(s,l)})}chunkCanvases=new Map;dirtyChunks=new Set;cachedImages;unsubscribe;dispose(){this.unsubscribe(),this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}invalidate(){this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}markChunkDirty(a){this.dirtyChunks.add(a)}markTileDirty(a,s){this.dirtyChunks.add(HA(a,s))}getRenderableChunks(a,s,r,l){this.refreshAssets(r);const u=[],{width:f,height:h}=Pc(s);for(const m of fv(a)){const p=dv(m),g=this.ensureChunk(p,m,s,f,h,r,l);g&&u.push(g)}return u}refreshAssets(a){if(this.cachedImages!==a){this.cachedImages=a;for(const s of this.chunkCanvases.keys())this.dirtyChunks.add(s)}}onTileChange(a,s){(s==="created"||s==="terrain"||s==="building"||s==="fog")&&this.markTileDirty(a.q,a.r)}ensureChunk(a,s,r,l,u,f,h){const m=this.chunkCanvases.get(a);if(!m||this.dirtyChunks.has(a)){const p=this.renderChunk(a,s,r,l,u,f,h,m);return this.dirtyChunks.delete(a),p?(this.chunkCanvases.set(a,p),p):(this.chunkCanvases.delete(a),null)}return m}renderChunk(a,s,r,l,u,f,h,m){if(typeof document>"u")return null;const{qStart:p,qEnd:g,rStart:b,rEnd:v}=hw(s,this.map);if(p>g||b>v)return null;const M=l/2,x=u/2;let T=1/0,_=1/0,R=-1/0,I=-1/0;const j=[];for(let te=p;te<=g;te++)for(let Y=b;Y<=v;Y++){const B=this.map.getTile(te,Y);if(!B||B.isFogged)continue;const{x:C,y:J}=ta({q:te,r:Y},r),q=C-h.x-M,ae=J-h.y-x;T=Math.min(T,q),_=Math.min(_,ae),R=Math.max(R,q+l),I=Math.max(I,ae+u),j.push({tile:B,x:q,y:ae})}if(!Number.isFinite(T)||!Number.isFinite(_)||!Number.isFinite(R)||!Number.isFinite(I))return null;const V=Math.max(1,Math.ceil(R-T)),X=Math.max(1,Math.ceil(I-_));let $=m?.canvas;(!$||$.width!==V||$.height!==X)&&($=document.createElement("canvas"),$.width=V,$.height=X);const ee=$.getContext("2d");if(!ee)throw new Error("Canvas 2D context not available for chunk rendering");ee.setTransform(1,0,0,1,0,0),ee.clearRect(0,0,V,X);for(const{tile:te,x:Y,y:B}of j){const C=Y-T,J=B-_;ee.save(),fw(ee,te,f,C,J,l,u,r),dw(ee,C+l/2,J+u/2,r),ee.restore()}return{key:a,canvas:$,origin:{x:T,y:_},width:V,height:X}}}const pw=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],_a=new Array(512);for(let t=0;t<512;t++)_a[t]=pw[t%256];const Nb=new Map,Rb=t=>t*t*t*(t*(t*6-15)+10),nh=(t,a,s)=>t+s*(a-t),xc=(t,a,s)=>{switch(t&3){case 0:return a+s;case 1:return-a+s;case 2:return a-s;default:return-a-s}};function gw(t,a){const s=Math.floor(t)&255,r=Math.floor(a)&255,l=t-Math.floor(t),u=a-Math.floor(a),f=_a[_a[s+1]+r+1],h=_a[_a[s]+r+1],m=_a[_a[s+1]+r],p=_a[_a[s]+r],g=Rb(l),b=Rb(u),v=nh(xc(p,l,u),xc(m,l-1,u),g),M=nh(xc(h,l,u-1),xc(f,l-1,u-1),g);return nh(v,M,b)}function yw(t,a,s=4){let r=0,l=1,u=1,f=0;for(let h=0;h<s;h++)r+=gw(t*l,a*l)*u,f+=u,u*=.5,l*=2;return f>0?r/f:0}function bw(t){const a=Math.max(32,Math.min(512,Math.round(t))),s=a,r=Nb.get(s);if(r)return r;if(typeof document>"u")return null;const l=document.createElement("canvas");l.width=a,l.height=a;const u=l.getContext("2d");if(!u)return null;const f=u.createImageData(a,a),h=a/48;let m=0;for(let p=0;p<a;p++)for(let g=0;g<a;g++){const b=yw(g/h,p/h,5),v=Math.pow((b+1)/2,1.35),M=Math.round(v*255);f.data[m]=255,f.data[m+1]=255,f.data[m+2]=255,f.data[m+3]=M,m+=4}return u.putImageData(f,0,0),Nb.set(s,l),l}function kb(t,a,s,r){t.beginPath();for(let l=0;l<6;l++){const u=Math.PI/180*(60*l-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?t.moveTo(f,h):t.lineTo(f,h)}t.closePath()}function vw(t,a,s,r){const l=t.createRadialGradient(a,s,r*.08,a,s,r*1.12);return l.addColorStop(0,Wc(.4,.35)),l.addColorStop(.35,Wc(.2,.55)),l.addColorStop(.6,nr(.1,.78)),l.addColorStop(.82,nr(.2,.88)),l.addColorStop(1,nr(.35,.95)),l}function Sw(t,a,s,r,l){if(r<=0)return;const u=bw(r*2.2),f=r*2.5,h=a-f/2,m=s-f/2;t.save(),kb(t,a,s,r),t.clip();const p=vw(t,a,s,r);t.fillStyle=p,t.fillRect(h,m,f,f),u&&(t.save(),t.globalCompositeOperation="lighter",t.globalAlpha*=.32,t.drawImage(u,a-r,s-r,r*2,r*2),t.restore()),t.restore(),t.save(),kb(t,a,s,r*.99),t.lineJoin="round",t.lineCap="round",t.lineWidth=eu(r,l,"hover"),t.strokeStyle=nr(.3,.88),t.shadowColor=nr(.45,.42),t.shadowBlur=Math.max(3,r*.45/Math.max(l,.1)),t.stroke(),t.restore()}class Mw{constructor(a){this.mapRef=a,this.terrainCache=new mw(a),this.cachedHexSize=a.hexSize}terrainCache;cachedHexSize;get hexSize(){return this.mapRef.hexSize}getOrigin(){return ta({q:this.mapRef.minQ,r:this.mapRef.minR},this.hexSize)}invalidateCache(){this.terrainCache.invalidate()}dispose(){this.terrainCache.dispose()}draw(a,s,r){this.ensureHexSize();const l=a.canvas??null,u=qA(this.mapRef,xe,l,this.hexSize);if(!u)return;const f=jA(u);YA(this.mapRef,f);const h=this.getOrigin(),m=this.terrainCache.getRenderableChunks(f,this.hexSize,s,h);this.drawChunks(a,m),this.drawFogLayer(a,h,u),r&&this.drawSelection(a,h,r)}drawToCanvas(a,s,r){const l=a.getContext("2d");if(!l)throw new Error("Canvas 2D context not available");this.draw(l,s,r)}ensureHexSize(){this.cachedHexSize!==this.hexSize&&(this.cachedHexSize=this.hexSize,this.terrainCache.invalidate())}drawChunks(a,s){if(s.length!==0)for(const r of s)a.drawImage(r.canvas,r.origin.x,r.origin.y)}drawSelection(a,s,r){const{width:l,height:u}=Pc(this.hexSize),{x:f,y:h}=ta(r,this.hexSize),m=f-s.x-l/2,p=h-s.y-u/2;this.strokeHex(a,m+l/2,p+u/2,this.hexSize,!0)}drawFogLayer(a,s,r){const{width:l,height:u}=Pc(this.hexSize),f=l/2,h=u/2;for(let m=r.rMin;m<=r.rMax;m++)for(let p=r.qMin;p<=r.qMax;p++){const g=this.mapRef.getTile(p,m);if(!g||!g.isFogged)continue;const{x:b,y:v}=ta({q:p,r:m},this.hexSize),M=b-s.x-f,x=v-s.y-h,T=this.hexSize,_=M+l/2,R=x+u/2;Sw(a,_,R,T,xe.zoom)}}strokeHex(a,s,r,l,u=!1){const{stroke:f,glow:h}=nw();this.hexPath(a,s,r,l),a.save(),a.lineJoin="round",a.lineCap="round",u?(a.shadowColor=h,a.shadowBlur=Math.max(6,l*.65/Math.max(xe.zoom,.1)),a.lineWidth=eu(l,xe.zoom,"selection"),a.strokeStyle=f,a.stroke()):(a.lineWidth=eu(l,xe.zoom,"hover"),a.shadowColor=Wc(.1,.45),a.shadowBlur=Math.max(2,l*.4/Math.max(xe.zoom,.1)),a.strokeStyle=nr(.1,.72),a.stroke()),a.restore()}hexPath(a,s,r,l){a.beginPath();for(let u=0;u<6;u++){const f=Math.PI/180*(60*u-30),h=s+l*Math.cos(f),m=r+l*Math.sin(f);u===0?a.moveTo(h,m):a.lineTo(h,m)}a.closePath()}}const mi={accent:"#38bdf8",accentSoft:"rgba(56, 189, 248, 0.2)",warm:"#fbbf24",surface:"rgba(15, 23, 42, 0.92)",border:"rgba(148, 163, 184, 0.34)",text:"#e2e8f0"};let pi=null;function Qs(t,a){const s=t.trim();return s.length>0?s:a}function Ew(){if(pi)return pi;if(typeof window>"u"||typeof document>"u")return pi=mi,pi;try{const t=getComputedStyle(document.documentElement);return pi={accent:Qs(t.getPropertyValue("--color-accent"),mi.accent),accentSoft:Qs(t.getPropertyValue("--color-accent-soft"),mi.accentSoft),warm:Qs(t.getPropertyValue("--color-warning"),mi.warm),surface:Qs(t.getPropertyValue("--color-surface-strong"),mi.surface),border:Qs(t.getPropertyValue("--hud-border-strong"),mi.border),text:Qs(t.getPropertyValue("--color-foreground"),mi.text)},pi}catch(t){return console.warn("Failed to read sauna palette tokens from computed styles",t),pi=mi,pi}}function xw(t,a){const s=Math.max(0,t.auraRadius),r=ta(t.pos,a),l=r.x+a,u=r.y+a;let f=a;if(s<=0)return a*1.6;for(const h of r2){const m=ta({q:t.pos.q+h.q*s,r:t.pos.r+h.r*s},a),p=m.x+a,g=m.y+a,b=Math.hypot(p-l,g-u);b>f&&(f=b)}return f+a*.65}function Aw(t,a,s,r,l,u){const f=Math.max(0,Math.min(u,Math.min(r,l)/2));t.moveTo(a+f,s),t.lineTo(a+r-f,s),t.quadraticCurveTo(a+r,s,a+r,s+f),t.lineTo(a+r,s+l-f),t.quadraticCurveTo(a+r,s+l,a+r-f,s+l),t.lineTo(a+f,s+l),t.quadraticCurveTo(a,s+l,a,s+l-f),t.lineTo(a,s+f),t.quadraticCurveTo(a,s,a+f,s),t.closePath()}function ww(t,a,{origin:s,hexSize:r,timestamp:l}){if(!a)return;const u=Ew(),f=Number.isFinite(l)?l:typeof performance<"u"?performance.now():Date.now(),h=.5+.5*Math.sin(f*.0035),m=ta(a.pos,r),p=m.x-s.x+r,g=m.y-s.y+r,b=xw(a,r);t.save(),t.globalCompositeOperation="screen";const v=b+r*(.4+h*.3),M=Math.max(r*.6,b*.58),x=t.createRadialGradient(p,g,M,p,g,v);x.addColorStop(0,u.accentSoft),x.addColorStop(.55,`rgba(56, 189, 248, ${.18+h*.12})`),x.addColorStop(1,"rgba(2, 6, 23, 0)"),t.fillStyle=x,t.beginPath(),t.arc(p,g,v,0,Math.PI*2),t.fill(),t.restore(),t.save(),t.globalCompositeOperation="lighter",t.lineWidth=Math.max(r*.28,6),t.strokeStyle=`rgba(56, 189, 248, ${(.35+h*.2).toFixed(3)})`,t.shadowColor=`rgba(56, 189, 248, ${.45+h*.1})`,t.shadowBlur=r*(.9+h*.45),t.beginPath(),t.arc(p,g,b+r*.12,0,Math.PI*2),t.stroke(),t.restore();const T=r*.9;t.save(),t.beginPath(),t.arc(p,g,T,0,Math.PI*2),t.fillStyle=u.surface,t.globalAlpha*=.96,t.fill(),t.lineWidth=Math.max(1.5,r*.06),t.strokeStyle=u.border,t.shadowColor="rgba(8, 25, 53, 0.6)",t.shadowBlur=r*.45,t.stroke(),t.restore();const _=T*.78,R=Math.max(r*.22,5);t.save(),t.lineWidth=R,t.strokeStyle="rgba(148, 163, 184, 0.24)",t.beginPath(),t.arc(p,g,_,0,Math.PI*2),t.stroke(),t.restore();const I=a.playerSpawnCooldown>0?a.playerSpawnCooldown:1,V=1-Math.min(1,Math.max(0,a.playerSpawnTimer/I)),X=-Math.PI/2,$=X+Math.PI*2*V;if(V>0){t.save(),t.lineWidth=R,t.lineCap="round";const A=t.createLinearGradient(p,g-_,p,g+_);A.addColorStop(0,u.accent),A.addColorStop(1,u.warm),t.strokeStyle=A,t.shadowColor=`rgba(56, 189, 248, ${.42+h*.18})`,t.shadowBlur=r*(.65+h*.35),t.beginPath(),t.arc(p,g,_,X,$,!1),t.stroke(),t.restore()}const ee=Math.max(0,a.playerSpawnTimer),te=Math.ceil(ee);t.save(),t.font=`600 ${Math.max(12,r*.9)}px "Inter", "Manrope", "Segoe UI", sans-serif`,t.fillStyle=u.text,t.textAlign="center",t.textBaseline="middle",t.shadowColor="rgba(2, 6, 23, 0.6)",t.shadowBlur=r*.35,t.fillText(String(te),p,g),t.restore(),t.save(),t.font=`500 ${Math.max(10,r*.36)}px "Inter", "Manrope", "Segoe UI", sans-serif`,t.fillStyle="rgba(148, 163, 184, 0.78)",t.textAlign="center",t.textBaseline="top",t.fillText("sec",p,g+_*.45),t.restore();const Y="Sauna ♨️",B=Math.max(12,r*.58);t.save(),t.font=`600 ${B}px "Inter", "Manrope", "Segoe UI", sans-serif`;const C=t.measureText(Y),J=r*.58,q=r*.32,ae=C.width+J*2,F=B+q*2,D=p-ae/2,P=g-b-F-r*.35,le=F/2;t.beginPath(),Aw(t,D,P,ae,F,le);const ne=t.createLinearGradient(D,P,D,P+F);ne.addColorStop(0,"rgba(15, 23, 42, 0.94)"),ne.addColorStop(.55,"rgba(15, 23, 42, 0.86)"),ne.addColorStop(1,"rgba(30, 41, 59, 0.9)"),t.fillStyle=ne,t.shadowColor="rgba(8, 25, 53, 0.6)",t.shadowBlur=r*.4,t.fill(),t.lineWidth=Math.max(1.5,r*.06);const E=t.createLinearGradient(D,P,D+ae,P);E.addColorStop(0,`${u.accent}`),E.addColorStop(1,`${u.warm}`),t.strokeStyle=E,t.stroke(),t.fillStyle=u.text,t.shadowColor="rgba(8, 25, 53, 0.65)",t.shadowBlur=r*.3,t.textAlign="center",t.textBaseline="middle",t.fillText(Y,p,P+F/2+B*.05),t.restore()}const yv={nativeSize:{width:64,height:64},anchor:{x:.5,y:.92},scale:{x:1,y:1},nudge:{x:0,y:-.05}},Cw={default:yv,soldier:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.9},scale:{x:1.12,y:1.24},nudge:{x:0,y:-.14}},archer:{nativeSize:{width:128,height:128},anchor:{x:.46,y:.88},scale:{x:1.1,y:1.22},nudge:{x:-.04,y:-.12}},"avanto-marauder":{nativeSize:{width:128,height:128},anchor:{x:.5,y:.92},scale:{x:1.18,y:1.3},nudge:{x:0,y:-.18}},saunoja:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.66},scale:{x:1,y:1},nudge:{x:0,y:-.02}}};function bv(t){return Cw[t]??yv}function vv(t,a,s,r){const{x:l,y:u}=ta(t,a),f=r.nudge.x*a,h=r.nudge.y*a;return{x:l-s.x+f,y:u-s.y+h}}function Tw({coord:t,hexSize:a,origin:s,zoom:r,type:l}){const u=bv(l),f=vv(t,a,s,u);return{x:Wn(f.x,r),y:Wn(f.y,r)}}function _w({coord:t,hexSize:a,origin:s,zoom:r,type:l}){const u=bv(l),f=vv(t,a,s,u),{width:h,height:m}=Pc(a),p=h*u.scale.x,g=m*u.scale.y,b=Wn(f.x-p*u.anchor.x,r),v=Wn(f.y-g*u.anchor.y,r),M=Wn(p,r),x=Wn(g,r),T=b+M*u.anchor.x,_=v+x*u.anchor.y;return{drawX:b,drawY:v,width:M,height:x,centerX:T,centerY:_,metadata:u}}function Nw(t){if(!t||typeof t!="object")return!1;const a=t;return!!a.coord&&typeof a.coord=="object"&&typeof a.coord.q=="number"&&typeof a.coord.r=="number"&&typeof a.range=="number"}function Rw(t){if(!t)return null;if(Nw(t)){const a=Number.isFinite(t.range)?Math.max(0,t.range):0;return{coord:t.coord,range:a}}if("pos"in t){const a="visionRange"in t&&Number.isFinite(t.visionRange)?t.visionRange:"auraRadius"in t&&Number.isFinite(t.auraRadius)?t.auraRadius:0,s=Math.max(0,Number.isFinite(a)?a:0);return{coord:t.pos,range:s}}return null}function kw(t,a,s,r,l,u){const f=window.devicePixelRatio||1,h=t.canvas.width,m=t.canvas.height;t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,h,m);const p=h/f,g=m/f;t.scale(f,f),t.translate(p/2,g/2),t.scale(xe.zoom,xe.zoom);const b=a.getOrigin();t.translate(-(xe.x-b.x),-(xe.y-b.y)),a.draw(t,s,l??void 0);const v=u?.saunojas;v&&Array.isArray(v.units)&&v.units.length>0&&v.draw(t,v.units,{originX:b.x,originY:b.y,hexRadius:a.hexSize,zoom:xe.zoom,resolveRenderCoord:v.resolveRenderCoord}),Lw(t,a,s,r,b,u?.fx,u?.friendlyVisionSources,u?.saunaVision??u?.sauna??null),u?.sauna&&ww(t,u.sauna,{origin:b,hexSize:a.hexSize}),t.restore()}function Lw(t,a,s,r,l,u,f,h){const p=(f??r).filter(b=>b.faction==="player"&&!b.isDead()).map(b=>({coord:b.coord,range:b.getVisionRange()})),g=Rw(h);g&&p.push(g);for(const b of r){if(b.isDead()||b.faction==="enemy"&&!p.some(({coord:X,range:$})=>Zs(X,b.coord)<=$))continue;const v=s[`unit-${b.type}`]??s.placeholder,M=b.getMaxHealth();t.save();const x=u?.getUnitAlpha?.(b);if(typeof x=="number"){const X=Math.min(1,Math.max(0,x));if(X<=0){t.restore();continue}t.globalAlpha*=X}b.stats.health/M<.5&&(t.filter="saturate(0)");const T=b.renderCoord??b.coord,_=_w({coord:T,hexSize:a.hexSize,origin:l,zoom:xe.zoom,type:b.type}),R=[];b.stats.health/M<.5&&R.push("saturate(0)");const I=Math.abs(T.q-b.coord.q),j=Math.abs(T.r-b.coord.r),V=Math.min(1,I+j);V>.01?(R.push("contrast(1.08)"),t.shadowColor="rgba(255, 255, 255, 0.28)",t.shadowBlur=Math.max(6,12*xe.zoom*V)):(t.shadowColor="rgba(0, 0, 0, 0)",t.shadowBlur=0),t.filter=R.length>0?R.join(" "):"none",t.drawImage(v,_.drawX,_.drawY,_.width,_.height),Am()&&b.faction==="player"&&(t.strokeStyle="rgba(255,255,255,0.5)",t.lineWidth=2,t.strokeRect(_.drawX,_.drawY,_.width,_.height)),t.restore()}}const Dw=200,Lb=.001;function ah(t){return{q:t.q,r:t.r}}function Ac(t,a){return!t||!a?!1:Math.abs(t.q-a.q)<Lb&&Math.abs(t.r-a.r)<Lb}class Iw{constructor(a){this.redraw=a}tracks=new Map;rafId=null;enqueue(a,s){const r=this.normalizePath(s);if(r.length<2){this.clear(a,{snap:!0});return}const l=r[0];let u=this.tracks.get(a.id);u?u.current?Ac(u.current.to,l)||(u=this.resetTrack(a,l)):Ac(a.renderCoord,l)||(u=this.resetTrack(a,l)):(u={unit:a,queue:[]},this.tracks.set(a.id,u),Ac(a.renderCoord,l)||a.setRenderCoord(l));for(let f=1;f<r.length;f++)u.queue.push(ah(r[f]));this.ensureRunning()}clear(a,s){if(!this.tracks.delete(a.id)){s?.snap&&(a.snapRenderToCoord(),this.redraw());return}(s?.snap??!0)&&(a.snapRenderToCoord(),this.redraw()),this.tracks.size===0&&this.rafId!==null&&(typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null)}clearAll(){for(const a of this.tracks.values())a.unit.snapRenderToCoord();this.tracks.clear(),this.rafId!==null&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null,this.redraw()}resetTrack(a,s){this.clear(a,{snap:!1});const r={unit:a,queue:[]};return this.tracks.set(a.id,r),a.setRenderCoord(s),r}ensureRunning(){this.rafId!==null||this.tracks.size===0||(this.rafId=requestAnimationFrame(this.step))}normalizePath(a){const s=[];for(const r of a){const l=ah(r);(s.length===0||!Ac(s[s.length-1],l))&&s.push(l)}return s}ease(a){return a<=0?0:a>=1?1:a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2}step=a=>{if(this.rafId=null,this.tracks.size===0)return;let s=!1;for(const[r,l]of this.tracks){if(!l.current){const v=l.queue.shift();if(!v){this.tracks.delete(r);continue}l.current={from:ah(l.unit.renderCoord??l.unit.coord),to:v,start:a}}const u=l.current;if(!u)continue;const h=(a-u.start)/Dw,m=Math.min(1,Math.max(0,h)),p=this.ease(m),g=u.from.q+(u.to.q-u.from.q)*p,b=u.from.r+(u.to.r-u.from.r)*p;l.unit.setRenderCoord({q:g,r:b}),s=!0,m>=1&&(l.unit.setRenderCoord(u.to),l.current=void 0,l.queue.length===0&&this.tracks.delete(r))}s&&this.redraw(),this.tracks.size>0&&(this.rafId=requestAnimationFrame(this.step))}}const Uw=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,Ow=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null,zw=900,Bw=650;function qw(t){switch(t){case"down":return{x:0,y:36};case"left":return{x:-26,y:-18};case"right":return{x:26,y:-18};case"up":default:return{x:0,y:-40}}}function Hw(t){const a=document.createElement("div");a.className="ui-floater-layer",t.appendChild(a);const s=!!Uw?.matches,r=!!Ow?.matches;return{spawn:({text:f,x:h,y:m,color:p,direction:g="up",durationMs:b,fontSize:v})=>{const M=document.createElement("span");M.className="ui-floater",M.textContent=f,M.style.left=`${Math.round(h)}px`,M.style.top=`${Math.round(m)}px`,p&&(M.style.color=p),v&&(M.style.fontSize=`${v}px`);const x=r?12:24;for(;a.childElementCount>=x;)a.firstElementChild?.remove();a.appendChild(M);const T=b??(r?Bw:zw);if(s||!M.animate){M.style.opacity="0",M.style.transition=`opacity ${Math.round(T*.8)}ms ease-out`,requestAnimationFrame(()=>{M.style.opacity="1",requestAnimationFrame(()=>{M.style.opacity="0"})}),window.setTimeout(()=>{M.remove()},T);return}const _=qw(g),R=[{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:0},{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:1,offset:.18},{transform:`translate3d(-50%, -50%, 0) translate3d(${_.x}px, ${_.y}px, 0)`,opacity:0}],I=M.animate(R,{duration:T,easing:"cubic-bezier(0.18, 0.89, 0.32, 1.28)",fill:"forwards"});I.onfinish=()=>{M.remove()}},destroy:()=>{a.remove()}}}const Db=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),jw=new Intl.NumberFormat("en-US",{maximumFractionDigits:1,minimumFractionDigits:0});function Ib(t){return 1-(1-t)*(1-t)}function wc(t,a,s){return Math.min(s,Math.max(a,t))}const Gw="var(--color-danger)",Yw="color-mix(in srgb, #34d399 88%, white 12%)",Fw=720,Vw=540,$w=220,Xw=180,Qw=6,Kw=3,Pw="color-mix(in srgb, #fbbf24 82%, white 10%)",Zw=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,Jw=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null;function Ww(t){const{canvas:a,overlay:s,mapRenderer:r,getUnitById:l,requestDraw:u}=t,f=Hw(s),h=new Map,m=new Map,p=[],g={x:0,y:0},b=!!Zw?.matches,v=!!Jw?.matches,M=v?Vw:Fw,x=v?Xw:$w,T=v?Kw:Qw,_=()=>{u&&(typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>u()):u())},R=B=>{const C=a.getBoundingClientRect(),J=s.getBoundingClientRect();if(C.width===0||C.height===0)return null;const{x:q,y:ae}=ta(B,r.hexSize),F=(q-xe.x)*xe.zoom+C.width/2,D=(ae-xe.y)*xe.zoom+C.height/2,P=r.hexSize*xe.zoom*.75;return{x:F+(C.left-J.left),y:D+(C.top-J.top)-P}},I=(B,C,J,q="up")=>{const ae=l(B);if(!ae)return;const F=R(ae.renderCoord??ae.coord);F&&f.spawn({text:C,x:F.x,y:F.y,color:J,direction:q,fontSize:v?18:void 0})},j=B=>{if(!B||B.amount<=0)return;const C=Db.format(Math.max(1,Math.round(B.amount)));if(I(B.targetId,`-${C}`,Gw,"up"),!b){const J=typeof performance<"u"?performance.now():Date.now();p.push({start:J,duration:x,intensity:T,seedX:Math.random()*500,seedY:Math.random()*500})}_()},V=B=>{if(!B||B.amount<=0)return;const C=B.amount>=1?Db.format(Math.round(B.amount)):jw.format(wc(B.amount,0,9.9));I(B.unitId,`+${C}`,Yw,"up"),_()},X=B=>{if(!B)return;const C=typeof performance<"u"?performance.now():Date.now();h.set(B.unitId,{start:C,duration:M}),I(B.unitId,"✖",Pw,"down"),_()};return re.on("unitDamaged",j),re.on("unitHealed",V),re.on("unitDied",X),{step:B=>{if(b)g.x=0,g.y=0;else{let C=0,J=0;for(let q=p.length-1;q>=0;q--){const ae=p[q],F=B-ae.start;if(F>=ae.duration){p.splice(q,1);continue}const D=wc(F/ae.duration,0,1),P=ae.intensity*Ib(1-D);C+=Math.sin((B+ae.seedX)/16)*P,J+=Math.cos((B+ae.seedY)/18)*P}g.x=C,g.y=J}for(const[C,J]of h){const q=B-J.start,ae=wc(q/J.duration,0,1),F=1-Ib(ae);if(ae>=1){m.delete(C),h.delete(C);continue}m.set(C,wc(F,0,1))}},getShakeOffset:()=>({x:g.x,y:g.y}),getUnitAlpha:B=>m.get(B)??1,dispose:()=>{re.off("unitDamaged",j),re.off("unitHealed",V),re.off("unitDied",X),p.length=0,h.clear(),m.clear(),f.destroy()}}}function eC(){return`${"/".endsWith("/")?"/":"//"}${"assets/units/saunoja.svg".replace(/^\/+/,"")}`}const Ub=eC();let Ws=null,yo=null;function jh(t){return!!(t&&t.complete&&t.naturalWidth>0&&t.naturalHeight>0)}function tC(t,a){if(!a)return t;try{a(t)}catch(s){console.error("Saunoja icon onLoad callback failed",s)}return t}function Sv(t){const a=r=>t?r.then(l=>tC(l,t)):r;if(jh(Ws))return a(Promise.resolve(Ws));if(yo)return a(yo);if(typeof Image>"u")return Promise.reject(new Error("Image constructor is not available in this environment."));const s=new Image;return s.decoding="async",Ws=s,yo=new Promise((r,l)=>{const u=()=>{s.onload=null,s.onerror=null},f=()=>{u(),r(s)};s.onload=f,s.onerror=h=>{u(),Ws=null,yo=null;const m=new Error(`Failed to load saunoja icon from ${Ub}`);console.warn(m.message,h),l(m)},s.src=Ub,jh(s)&&f()}),a(yo)}function nC(t,a,{originX:s=0,originY:r=0,hexRadius:l=lr,zoom:u=1,resolveRenderCoord:f}={}){if(!t||!Array.isArray(a)||a.length===0)return;const h=jh(Ws)?Ws:null;if(!h)return;const m=Number.isFinite(l)&&l>0?l:lr,p=m*.965,g=a.map(b=>{const v=f?.(b),x=v&&typeof v=="object"&&Number.isFinite(v.q)&&Number.isFinite(v.r)?{q:v.q,r:v.r}:b.coord;return{unit:b,coord:x}}).sort((b,v)=>b.coord.r!==v.coord.r?b.coord.r-v.coord.r:b.coord.q!==v.coord.q?b.coord.q-v.coord.q:b.unit.id.localeCompare(v.unit.id));for(const{unit:b,coord:v}of g){const{x:M,y:x}=Tw({coord:v,hexSize:m,origin:{x:s,y:r},zoom:u,type:"saunoja"});t.save(),wo(t,M,x,p),t.clip();const T=h.naturalWidth||1,_=h.naturalHeight||1,R=p*1.85,I=p*2.4,j=Math.min(R/T,I/_),V=Wn(T*j,u),X=Wn(_*j,u),$=Wn(M-V/2,u),ee=Wn(x-X*.78,u);t.save(),t.filter="saturate(112%) contrast(108%) brightness(1.04)",t.drawImage(h,$,ee,V,X),t.restore(),t.save(),t.globalCompositeOperation="multiply";const te=t.createRadialGradient(M,x+p*.38,p*.2,M,x+p*.38,p*1.05);te.addColorStop(0,"rgba(22, 30, 50, 0.58)"),te.addColorStop(1,"rgba(22, 30, 50, 0)"),t.fillStyle=te,t.fillRect(M-p,x-p,p*2,p*2),t.restore(),t.save(),t.globalCompositeOperation="soft-light";const Y=t.createLinearGradient(M,x-p,M,x+p);Y.addColorStop(0,"rgba(233, 224, 255, 0.28)"),Y.addColorStop(.52,"rgba(196, 148, 255, 0.26)"),Y.addColorStop(1,"rgba(94, 75, 168, 0.35)"),t.fillStyle=Y,t.fillRect(M-p,x-p,p*2,p*2),t.restore(),t.save(),t.globalCompositeOperation="screen",t.globalAlpha=.68;const B=t.createRadialGradient(M,x-p*.68,p*.1,M,x,p*1.12);B.addColorStop(0,"rgba(255, 255, 255, 0.85)"),B.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=B,t.fillRect(M-p,x-p,p*2,p*2),t.restore();const J=performance.now()-b.lastHitAt,q=120;if(J<q){const D=1-J/q;_x(t,{centerX:M,centerY:x,radius:p,progress:D})}t.restore(),Nx(t,{centerX:M,centerY:x-m*.18,radius:m*.94,intensity:b.steam});const ae=m*.42,F=x+m*.34;Tx(t,{centerX:M,centerY:F,hp:b.hp,maxHp:b.maxHp,radius:ae})}}const aC=["Resolute Sauna Guardian","Steam Scholar","Frost-Hardened","Loyal Watchbearer","Aura Whisperer","Shield Brother","Stonefooted Scout","Sisu-Forged Veteran","Brewmaster Quartermaster","Icebreaker Herald","Runic Tactician","Torchbearer"],iC=["Heat Fickle","Soot Allergic","Slow to Spark","Overconfident","Distracted Dreamer","Stubborn Stoker","Thirsty Between Battles","Clumsy Footwork","Rust-Prone Gear","Echo-Lost Listener"];function Ob(t,a,s){const r=[...t],l=[],u=Math.max(0,Math.min(a,r.length));for(let f=0;f<u;f++){const h=Math.floor(s()*r.length),[m]=r.splice(h,1);m&&l.push(m)}return l}function sC(t,a){for(let s=t.length-1;s>0;s--){const r=Math.floor(a()*(s+1));[t[s],t[r]]=[t[r],t[s]]}return t}function rC(t=Math.random){typeof t!="function"&&(t=Math.random);const a=Ob(aC,2,t),s=Ob(iC,1,t),r=[...a,...s];return sC(r,t).map(l=>l.trim()).filter(l=>l.length>0)}const oC=1;function bo(t,a=0){return Number.isFinite(t)?t:a}function lC(t){const{heat:a,pickSpawnTile:s,spawnUnit:r,maxSpawns:l,tierHelpers:u}=t,f=Math.max(oC,Do),h=Math.max(0,bo(t.minUpkeepReserve??f,f));let m=Math.max(0,bo(t.availableUpkeep,0));const p=Math.max(0,Math.floor(bo(l??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY))),g=bo(t.rosterCap??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),b=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.POSITIVE_INFINITY,v=typeof t.getRosterCount=="function"?t.getRosterCount:()=>0;let M=0,x=0,T=0,_=0,R=0,I=0,j=0;for(;(a.hasTriggerReady()||u?.hasQueuedSpawn())&&M<p;){M+=1;const V=u?.getSnapshot()??null;if(Math.max(0,Math.floor(bo(v()??0,0)))>=b){I+=1;let Y=!1;V&&u&&(Y=u.queueBlockedSpawn(V,()=>a.consumeTrigger())),Y?x+=a.vent(.15):x+=a.vent(.35);break}let $=!1;if(V&&u&&u.hasQueuedSpawn()&&($=u.takeQueuedSpawn(V)),!$&&!a.hasTriggerReady())break;if(m<h){_+=1,$&&V&&u?.restoreQueuedSpawn(V),x+=a.vent(.5);break}const ee=s();if(!ee){R+=1,$&&V&&u?.restoreQueuedSpawn(V),x+=a.vent(.25);break}if(!r(ee)){j+=1,$&&V&&u?.restoreQueuedSpawn(V),x+=a.vent(.25);break}if(!$&&!a.consumeTrigger()){j+=1;break}T+=1,m=Math.max(0,m-h),V&&u?.onSpawnResolved?.(V,{usedQueue:$})}return{spawned:T,blockedByUpkeep:_,blockedByPosition:R,blockedByRoster:I,failedSpawns:j,ventedHeat:x,remainingUpkeep:m}}function ih(t,a=0){return Number.isFinite(t)?t:a}function cC(t){const a=Math.max(0,ih(t.dt,0)),{addedHeat:s,cooledHeat:r}=t.heat.advance(a);let l=0;for(const M of t.units){if(M.isDead()||M.faction!=="player")continue;const x=Math.max(0,ih(t.getUnitUpkeep(M),0));x>0&&(l+=x)}const u=5;let h=Math.max(0,ih(t.sauna.beerUpkeepAccumulator,0)),m=0;if(l>0){if(h+=a,h>=u){const M=Math.floor(h/u);m=l*M,h-=M*u}}else h=0;t.sauna.beerUpkeepAccumulator=h,m>0&&t.state.addResource(oe.SAUNA_BEER,-m);const p=t.state.getResource(oe.SAUNA_BEER),g=lC({heat:t.heat,availableUpkeep:p,pickSpawnTile:t.pickSpawnTile,spawnUnit:t.spawnBaseUnit,minUpkeepReserve:t.minUpkeepReserve,maxSpawns:t.maxSpawns,rosterCap:t.rosterCap,getRosterCount:t.getRosterCount,tierHelpers:t.tierHelpers}),b=t.heat.getCooldownSeconds(),v=t.heat.timeUntilNextTrigger();return t.sauna.heat=t.heat.getHeat(),t.sauna.playerSpawnThreshold=t.heat.getThreshold(),t.sauna.playerSpawnCooldown=Number.isFinite(b)?b:0,t.sauna.playerSpawnTimer=Number.isFinite(v)?v:0,t.sauna.heatPerTick=t.heat.getBuildRate(),{addedHeat:s,cooledHeat:r,upkeepDrain:m,spawn:g,beerRemaining:t.state.getResource(oe.SAUNA_BEER),availableUpkeep:g.remainingUpkeep}}function uC(){try{return globalThis.localStorage??null}catch(t){return console.warn("Unable to access localStorage for inventory persistence",t),null}}function dC(t,a){const s=t.getItem(a);if(s)try{return JSON.parse(s)}catch(r){console.warn(`Failed to parse persisted inventory for "${a}", clearing.`,r),t.removeItem(a);return}}function Cc(t,a,s){const r=Number.isFinite(t.quantity)?t.quantity:1,l=Math.max(1,Math.round(r)),u=typeof t.rarity=="string"?t.rarity.trim():void 0,f=typeof t.icon=="string"?t.icon:void 0,h=typeof t.description=="string"?t.description:void 0;return{id:t.id,name:t.name,description:h,icon:f,rarity:u,quantity:l,acquiredAt:a,sourceTableId:s?.tableId,sourceEntryId:s?.entryId}}class fC{listeners=new Set;storageKey;now;maxStashSize;storage;autoEquip;stash=[];inventory=[];constructor(a={}){this.storageKey=a.storageKey??"autobattles:inventory",this.now=typeof a.now=="function"?a.now:()=>Date.now(),this.maxStashSize=Math.max(1,Math.floor(a.maxStashSize??24)),this.storage=uC(),this.autoEquip=a.autoEquip??!0,this.load()}load(){if(!this.storage)return;const a=dC(this.storage,this.storageKey);if(a){if(typeof a.autoEquip=="boolean"&&(this.autoEquip=a.autoEquip),Array.isArray(a.stash)){const s=[];for(const r of a.stash){if(!r||typeof r!="object")continue;const{id:l,name:u,quantity:f}=r;if(typeof l!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(Cc({id:l,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.stash=s.slice(0,this.maxStashSize)}if(Array.isArray(a.inventory)){const s=[];for(const r of a.inventory){if(!r||typeof r!="object")continue;const{id:l,name:u,quantity:f}=r;if(typeof l!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(Cc({id:l,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.inventory=s}}}persist(){if(!this.storage)return;const a={autoEquip:this.autoEquip,stash:this.stash.map(s=>({...s})),inventory:this.inventory.map(s=>({...s}))};try{this.storage.setItem(this.storageKey,JSON.stringify(a))}catch(s){console.warn("Failed to persist inventory state",s)}}emit(a){for(const s of this.listeners)s(a)}normalizeEquipResult(a){return typeof a=="boolean"?{success:a}:!a||typeof a!="object"?{success:!1}:{success:!!a.success,comparison:a.comparison,reason:a.reason}}on(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}isAutoEquipEnabled(){return this.autoEquip}setAutoEquip(a){this.autoEquip!==a&&(this.autoEquip=a,this.persist(),this.emit({type:"settings-updated",autoEquip:this.autoEquip}))}getStash(){return this.stash.map(a=>({...a}))}getStashSize(){return this.stash.length}getInventory(){return this.inventory.map(a=>({...a}))}getInventorySize(){return this.inventory.length}addLoot(a,s={}){return this.addItem({...a.item},{...s,sourceTableId:s.sourceTableId,sourceEntryId:s.sourceEntryId??a.entryId})}addItem(a,s={}){const r=Math.max(0,Math.round(this.now())),l=Cc(a,r,{tableId:s.sourceTableId,entryId:s.sourceEntryId}),u=s.autoEquip??this.autoEquip;let f={success:!1};if(u&&s.unitId&&typeof s.equip=="function"){try{f=this.normalizeEquipResult(s.equip(s.unitId,l))}catch(h){console.warn("Failed to auto-equip inventory item",{item:l,error:h}),f={success:!1}}if(f.success)return this.persist(),this.emit({type:"item-acquired",item:l,equipped:!0,location:"equipped",unitId:s.unitId,stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:l,equipped:!0,location:"equipped"}}if(this.stash.push(l),this.stash.length>this.maxStashSize){const h=this.stash.splice(0,this.stash.length-this.maxStashSize);h.length>0&&console.warn("Inventory stash full, trimming oldest items",h)}return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-acquired",item:l,equipped:!1,unitId:s.unitId,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:l,equipped:!1,location:"stash",stashIndex:this.stash.length-1}}equipFromStash(a,s,r){if(a<0||a>=this.stash.length)return!1;const l=this.stash[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,l))}catch(h){console.warn("Failed to equip stash item",{item:l,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}equipFromInventory(a,s,r){if(a<0||a>=this.inventory.length)return!1;const l=this.inventory[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,l))}catch(h){console.warn("Failed to equip inventory item",{item:l,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}moveToInventory(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.inventory.push(s),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-moved",item:s,from:"stash",to:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}moveToStash(a){if(this.stash.length>=this.maxStashSize||a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.stash.push(s),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-moved",item:s,from:"inventory",to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}discardFromInventory(a){if(a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-discarded",item:s,location:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}unequipToStash(a,s,r){if(this.stash.length>=this.maxStashSize)return!1;let l=null;try{l=r(a,s)??null}catch(h){console.warn("Failed to unequip item",{unitId:a,slot:s,error:h}),l=null}if(!l)return!1;const u=Math.max(0,Math.round(this.now())),f=Cc(l,u);return this.stash.push(f),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-unequipped",item:f,unitId:a,slot:s,to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),!0}discardFromStash(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-discarded",item:s,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}}const zb={toast:990},hC={stash:"Quartermaster Stash",inventory:"Ready Inventory"},mC={stash:"Your stash is empty. Conquer enemy elites to gather new equipment.",inventory:"No gear staged. Move items into the ready inventory for quick equipping."},pC={mythic:6,legendary:5,epic:4,rare:3,uncommon:2,common:1},gC=["health","attackDamage","attackRange","movementRange","defense","shield"],yC={"birch-sap-satchel":["healing","support"],"steamed-bandages":["restoration","shielding"],"aurora-distillate":["damage","defense"],"stolen-sauna-tokens":["mobility"],"midnight-bloodwine":["healing","damage"],"sauna-incense":["range","focus"],"glacier-brand":["damage"],"emberglass-arrow":["damage","range"],"aurora-lattice":["damage","range"],"emberglass-shard":["damage","mobility"],"windstep-totem":["mobility","defense"],"searing-chant-censer":["damage","shielding"],"cracked-ice-amulet":["defense"],"myrsky-charm":["range","defense"],"frostwyrm-signet":["shielding"],"spirit-oak-charm":["healing","defense"]};function La(t){return(t??"").trim().toLowerCase()}function sh(t){const a=new Set;for(const s of t){const r=La(s);r&&a.add(r)}return a}function rh(t,a){return{id:t.id,name:t.name,quantity:typeof a=="number"?a:t.quantity,rarity:t.rarity}}function Tc(t){return t?{id:t.id,name:t.name,quantity:t.quantity,rarity:t.rarity}:null}function Bb(t){return yC[t]??[]}function qb(t){const a=La(t)||"common",s=a.charAt(0).toUpperCase()+a.slice(1);return{key:a,label:s,rank:pC[a]??0}}function bC(t){const a=jo(t.id);if(!a){const l=qb(t.rarity);return{slot:null,slotLabel:"Unassigned",rarity:l.key,rarityRank:l.rank,tags:Bb(t.id),acquiredAt:t.acquiredAt}}const s=Ho(a.slot),r=qb(t.rarity);return{slot:a.slot,slotLabel:s.label,rarity:r.key,rarityRank:r.rank,tags:Bb(t.id),acquiredAt:t.acquiredAt}}function vC(t,a,s,r,l){return{id:t.id,name:t.name,description:t.description,icon:t.icon,rarity:t.rarity,quantity:l,slot:a,maxStacks:s,modifiers:r??{}}}function Hb(t,a){const s=t[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function SC(t,a){const s=jo(t.item.id);if(!s)return{slot:null,canEquip:!1,reason:"unknown-item",equipped:null,projected:rh(t.item),stats:[]};const r=s.slot,l=Ho(r),u=a.loadout.find(_=>_.slot===r)??null,f=Math.max(1,Math.round(t.item.quantity)),h=Math.max(1,Math.floor(s.maxStacks??l.maxStacks)),m=(u?.quantity??0)+f,p=m>h;if(u&&u.id!==t.item.id)return{slot:r,canEquip:!1,reason:"slot-occupied",equipped:Tc(u),projected:rh(t.item),stats:[]};if(p&&(!u||u.id!==t.item.id))return{slot:r,canEquip:!1,reason:"stack-limit",equipped:Tc(u),projected:rh(t.item,Math.min(h,m)),stats:[]};const g=Math.min(h,m),b=[];for(const _ of a.loadout)_.slot!==r&&b.push({..._});const v=u&&u.id===t.item.id?{...u,quantity:g}:vC(t.item,r,h,s.modifiers,g);b.push(v);const M=a.currentStats??Fc(a.baseStats,a.loadout),x=Fc(a.baseStats,b),T=gC.map(_=>{const R=Hb(M,_),I=Hb(x,_);return{stat:_,current:R,projected:I,delta:I-R}});return{slot:r,canEquip:!0,equipped:Tc(u),projected:Tc(v),stats:T}}function jb(t,a){return t.map((s,r)=>({item:s,index:r,location:a,metadata:bC(s)}))}function MC(t,a){const s=new Map,r=new Map,l=new Map;for(const m of t){const{metadata:p}=m;if(p.slot){const M=p.slot,x=s.get(M);x?x.count+=1:s.set(M,{label:p.slotLabel,count:1})}const g=p.rarity,b=g.charAt(0).toUpperCase()+g.slice(1),v=r.get(g);v?v.count+=1:r.set(g,{label:b,count:1,rank:p.rarityRank});for(const M of p.tags){const x=La(M);if(!x)continue;const T=M.split(/[-_]/g).map(R=>R.charAt(0).toUpperCase()+R.slice(1)).join(" "),_=l.get(x);_?_.count+=1:l.set(x,{label:T,count:1})}}const u=Array.from(s.entries()).sort((m,p)=>{const g=or.indexOf(m[0]),b=or.indexOf(p[0]);return g-b}).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.slots.has(La(m))})),f=Array.from(r.entries()).sort((m,p)=>(p[1].rank??0)-(m[1].rank??0)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.rarities.has(La(m))})),h=Array.from(l.entries()).sort((m,p)=>m[1].label.localeCompare(p[1].label)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.tags.has(La(m))}));return{slots:u,rarities:f,tags:h}}function EC(t,a){if(a.slots.size>0){const s=t.metadata.slot?La(t.metadata.slot):"";if(!s||!a.slots.has(s))return!1}return!(a.rarities.size>0&&!a.rarities.has(t.metadata.rarity)||a.tags.size>0&&!t.metadata.tags.map(l=>La(l)).some(l=>a.tags.has(l)))}function xC(t,a){return a?[t.item.name,t.item.description??"",t.metadata.tags.join(" ")].join(" ").toLowerCase().includes(a):!0}function AC(t,a){switch(a){case"oldest":t.sort((s,r)=>s.metadata.acquiredAt-r.metadata.acquiredAt);break;case"rarity":t.sort((s,r)=>r.metadata.rarityRank!==s.metadata.rarityRank?r.metadata.rarityRank-s.metadata.rarityRank:r.metadata.acquiredAt-s.metadata.acquiredAt);break;case"name":t.sort((s,r)=>s.item.name.localeCompare(r.item.name));break;case"newest":default:t.sort((s,r)=>r.metadata.acquiredAt-s.metadata.acquiredAt);break}}function Gb(t){const a={slots:sh(t.filters.slots??new Set),rarities:sh(t.filters.rarities??new Set),tags:sh(t.filters.tags??new Set)},s=La(t.search),r=Math.max(1,Math.floor(t.page||1)),l=Math.max(1,Math.floor(t.pageSize||24)),u=t.collection??"stash",f=jb(t.stash,"stash"),h=jb(t.inventory,"inventory"),m=[...f,...h],p=MC(m,a),g=u==="stash"?f:h,v=[...g.filter(j=>EC(j,a)&&xC(j,s))];AC(v,t.sort??"newest");const M=Math.min(v.length,r*l),x=v.slice(0,M),T=v.length>M,_=t.comparisonContext??null,R=x.map(j=>({item:j.item,index:j.index,location:j.location,metadata:j.metadata,comparison:_?SC(j,_):null})),I=["stash","inventory"].map(j=>({id:j,label:hC[j],count:j==="stash"?t.stash.length:t.inventory.length,active:j===u}));return{collection:u,collections:I,filters:p,items:R,total:g.length,filteredTotal:v.length,search:t.search,sort:t.sort??"newest",hasMore:T,emptyMessage:mC[u]}}function wC(){return{slots:new Set,rarities:new Set,tags:new Set}}const CC="_panel_7op0d_1",TC="_header_7op0d_32",_C="_title_7op0d_42",NC="_meta_7op0d_49",RC="_close_7op0d_54",kC="_controls_7op0d_74",LC="_settings_7op0d_82",DC="_settingRow_7op0d_93",IC="_settingCopy_7op0d_107",UC="_settingLabel_7op0d_114",OC="_settingHint_7op0d_120",zC="_settingControl_7op0d_127",BC="_settingState_7op0d_133",qC="_settingInput_7op0d_143",HC="_settingSwitch_7op0d_149",jC="_settingTrack_7op0d_169",GC="_settingThumb_7op0d_181",YC="_collections_7op0d_197",FC="_collectionButton_7op0d_205",VC="_searchRow_7op0d_234",$C="_search_7op0d_234",XC="_searchIcon_7op0d_266",QC="_sortSelect_7op0d_276",KC="_body_7op0d_286",PC="_grid_7op0d_292",ZC="_empty_7op0d_301",JC="_footer_7op0d_312",WC="_loadMore_7op0d_317",Ue={panel:CC,header:TC,title:_C,meta:NC,close:RC,controls:kC,settings:LC,settingRow:DC,settingCopy:IC,settingLabel:UC,settingHint:OC,settingControl:zC,settingState:BC,settingInput:qC,settingSwitch:HC,settingTrack:jC,settingThumb:GC,collections:YC,collectionButton:FC,searchRow:VC,search:$C,searchIcon:XC,sortSelect:QC,body:KC,grid:PC,empty:ZC,footer:JC,loadMore:WC},eT="_group_18afl_1",tT="_label_18afl_11",nT="_row_18afl_19",aT="_chip_18afl_25",iT="_count_18afl_55",Ro={group:eT,label:tT,row:nT,chip:aT,count:iT},sT="_card_1o0cv_1",rT="_header_1o0cv_26",oT="_icon_1o0cv_32",lT="_details_1o0cv_44",cT="_titleRow_1o0cv_51",uT="_title_1o0cv_51",dT="_rarity_1o0cv_63",fT="_slot_1o0cv_70",hT="_tags_1o0cv_75",mT="_tag_1o0cv_75",pT="_compare_1o0cv_91",gT="_tooltip_1o0cv_113",yT="_statList_1o0cv_144",bT="_stat_1o0cv_144",vT="_actions_1o0cv_169",ST="_action_1o0cv_169",MT="_primary_1o0cv_198",ET="_danger_1o0cv_209",xT="_badge_1o0cv_224",ct={card:sT,header:rT,icon:oT,details:lT,titleRow:cT,title:uT,rarity:dT,slot:fT,tags:hT,tag:mT,compare:pT,tooltip:gT,statList:yT,stat:bT,actions:vT,action:ST,primary:MT,danger:ET,badge:xT},AT={health:"HP",attackDamage:"ATK",attackRange:"Range",movementRange:"Move",defense:"Defense",shield:"Shield"},Yb={"slot-occupied":"Slot occupied. Unequip the current item first.","stack-limit":"Stack limit reached for this item.","unknown-item":"This item cannot be equipped yet."},Uc=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function wT(t,a){if(a.item.icon){const r=document.createElement("img");r.src=a.item.icon,r.alt="",r.loading="lazy",r.decoding="async",r.width=48,r.height=48,t.appendChild(r);return}const s=document.createElement("span");s.textContent=a.item.name.trim()[0]?.toUpperCase()??"?",t.appendChild(s)}function Mv(t){if(!(!t||t.canEquip))return t.reason&&Yb[t.reason]?Yb[t.reason]:"Unable to equip this item right now."}function CT(t,a){const s=document.createElement("div");s.className=ct.tooltip;const r=document.createElement("h4");if(a.projected?r.textContent=a.canEquip?"Projected stats":"Current loadout":r.textContent="Stats",s.appendChild(r),!a.canEquip){const u=Mv(a);if(u){const f=document.createElement("p");f.textContent=u,f.style.margin="0 0 0.5rem",f.style.fontSize="0.78rem",s.appendChild(f)}}const l=document.createElement("ul");l.className=ct.statList;for(const u of t){const f=document.createElement("li");f.className=ct.stat,u.delta>0?f.dataset.delta="positive":u.delta<0&&(f.dataset.delta="negative");const h=document.createElement("span");h.textContent=AT[u.stat]??u.stat;const m=document.createElement("span"),p=Uc.format(u.current),g=Uc.format(u.projected),b=u.delta,v=b===0?"±0":`${b>0?"+":"−"}${Uc.format(Math.abs(b))}`;m.textContent=`${p} → ${g} (${v})`,f.append(h,m),l.appendChild(f)}return s.appendChild(l),s}function TT(t){const a=t.comparison;if(!a)return null;const s=document.createElement("div"),r=document.createElement("button");r.type="button",r.className=ct.compare,r.textContent=a.canEquip?"Compare stats":"View details";const l=`${t.item.id}-compare-${t.location}-${t.index}`;r.setAttribute("aria-controls",l),r.setAttribute("aria-expanded","false"),r.setAttribute("aria-describedby",l),r.addEventListener("focus",()=>{r.setAttribute("aria-expanded","true")}),r.addEventListener("blur",()=>{r.setAttribute("aria-expanded","false")}),s.appendChild(r);const u=CT(a.stats,a);return u.id=l,s.appendChild(u),s}function _T(t,a){if(a&&!a.canEquip){t.disabled=!0;const s=Mv(a);s&&(t.title=s)}}function NT(t){return t.map(a=>{const s=a.trim();return s&&s.split(/[-_\s]/g).map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")})}function RT(t,a,s){const r=document.createElement("div");r.className=ct.actions;const l=document.createElement("button");l.type="button",l.className=`${ct.action} ${ct.primary}`,l.textContent="Equip",_T(l,a.comparison),l.addEventListener("click",()=>{s.onEquip?.()}),r.appendChild(l);const u=document.createElement("button");u.type="button",u.className=ct.action,u.textContent=a.location==="stash"?"Send to inventory":"Return to stash",u.addEventListener("click",()=>{s.onTransfer?.()}),r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=`${ct.action} ${ct.danger}`,f.textContent="Trash";let h=null;const m=()=>{h!==null&&(window.clearTimeout(h),h=null),f.dataset.confirm="false",f.textContent="Trash"};f.addEventListener("click",()=>{if(h!==null){m(),s.onTrash?.();return}f.dataset.confirm="true",f.textContent="Confirm trash",h=window.setTimeout(()=>{m()},2600)}),r.appendChild(f),t.appendChild(r)}function kT(t,a){const s=document.createElement("li");s.className=ct.card,s.dataset.location=t.location,s.setAttribute("role","listitem");const r=document.createElement("div");r.className=ct.header;const l=document.createElement("div");l.className=ct.icon,wT(l,t),r.appendChild(l);const u=document.createElement("div");u.className=ct.details;const f=document.createElement("div");f.className=ct.titleRow;const h=document.createElement("h4");h.className=ct.title,h.textContent=t.item.name,f.appendChild(h);const m=document.createElement("span");m.className=ct.rarity,m.textContent=t.metadata.rarity.toUpperCase(),f.appendChild(m),u.appendChild(f);const p=document.createElement("span");if(p.className=ct.slot,p.textContent=t.metadata.slot?t.metadata.slotLabel:"No slot",u.appendChild(p),t.metadata.tags.length>0){const b=document.createElement("div");b.className=ct.tags;for(const v of NT(t.metadata.tags)){const M=document.createElement("span");M.className=ct.tag,M.textContent=v,b.appendChild(M)}u.appendChild(b)}const g=TT(t);if(g&&u.appendChild(g),r.appendChild(u),s.appendChild(r),t.item.quantity>1){const b=document.createElement("span");b.className=ct.badge,b.textContent=`×${Uc.format(t.item.quantity)}`,s.appendChild(b)}return RT(s,t,a),s}const LT={newest:"Newest",oldest:"Oldest",rarity:"Rarity",name:"Name A-Z"};function oh(t){const a=document.createElement("div");a.className=Ro.row;const s=document.createElement("div");s.className=Ro.label,s.textContent=t;const r=document.createElement("div");return r.className=Ro.group,a.append(s,r),{row:a,group:r}}function DT(t){const a=document.createElement("section");a.className=Ue.panel,a.tabIndex=-1,a.dataset.open="false",a.setAttribute("aria-label","Quartermaster stash");const s=document.createElement("header");s.className=Ue.header;const r=document.createElement("div"),l=document.createElement("h2");l.className=Ue.title,l.textContent="Quartermaster Stash",r.appendChild(l);const u=document.createElement("div");u.className=Ue.meta,u.textContent="Loading…",r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=Ue.close,f.textContent="Close",f.addEventListener("click",()=>t.onClose?.()),s.append(r,f),a.appendChild(s);const h=document.createElement("div");h.className=Ue.controls;const m=document.createElement("div");m.className=Ue.collections;const p={stash:document.createElement("button"),inventory:document.createElement("button")};p.stash.type="button",p.stash.className=Ue.collectionButton,p.stash.textContent="Stash",p.stash.addEventListener("click",()=>t.onCollectionChange?.("stash")),p.inventory.type="button",p.inventory.className=Ue.collectionButton,p.inventory.textContent="Ready",p.inventory.addEventListener("click",()=>t.onCollectionChange?.("inventory")),m.append(p.stash,p.inventory),h.appendChild(m);const g=document.createElement("div");g.className=Ue.searchRow;const b=document.createElement("div");b.className=Ue.search;const v=document.createElement("input");v.type="search",v.placeholder="Search stash…",v.addEventListener("input",()=>t.onSearchChange?.(v.value));const M=document.createElement("span");M.className=Ue.searchIcon,M.textContent="🔍",b.append(M,v),g.appendChild(b);const x=document.createElement("select");x.className=Ue.sortSelect,["newest","oldest","rarity","name"].forEach(q=>{const ae=document.createElement("option");ae.value=q,ae.textContent=LT[q],x.appendChild(ae)}),x.addEventListener("change",()=>t.onSortChange?.(x.value)),g.appendChild(x),h.appendChild(g);const T=document.createElement("div");T.className=Ue.settings;const _=(q,ae,F,D)=>{const P=document.createElement("div");P.className=Ue.settingRow;const le=document.createElement("div");le.className=Ue.settingCopy;const ne=document.createElement("span");ne.className=Ue.settingLabel,ne.textContent=ae,le.appendChild(ne);const E=document.createElement("p");E.className=Ue.settingHint,E.textContent=F,le.appendChild(E);const A=document.createElement("div");A.className=Ue.settingControl;const z=document.createElement("span");z.className=Ue.settingState,z.textContent="Off";const Q=document.createElement("input");Q.type="checkbox",Q.id=q,Q.className=Ue.settingInput;const se=document.createElement("label");se.className=Ue.settingSwitch,se.htmlFor=q,se.dataset.state="off";const de=document.createElement("span");de.className=Ue.settingTrack;const ue=document.createElement("span");ue.className=Ue.settingThumb,se.append(de,ue);const ge=Se=>{Q.checked=Se,se.dataset.state=Se?"on":"off",z.textContent=Se?"On":"Off"};return Q.addEventListener("change",()=>{ge(Q.checked),D?.(Q.checked)}),A.append(z,Q,se),P.append(le,A),{root:P,setChecked:ge}},R=_("inventory-autoequip-toggle","Auto-equip loot","Try outfitting the selected attendant as soon as new gear arrives.",q=>t.onAutoEquipChange?.(q)),I=_("inventory-ui-variant-toggle","Experimental HUD","Swap to the React/Tailwind HUD. You can revert at any time.",q=>t.onUiV2Change?.(q));R.setChecked(t.getAutoEquipState?.()??!1),I.setChecked(t.getUiV2State?.()??!1),T.append(R.root,I.root),h.appendChild(T);const j=document.createElement("div"),V={slots:oh("Slots"),rarities:oh("Rarity"),tags:oh("Tags")};j.append(V.slots.row,V.rarities.row,V.tags.row),h.appendChild(j),a.appendChild(h);const X=document.createElement("div");X.className=Ue.body;const $=document.createElement("ul");$.className=Ue.grid;const ee=document.createElement("div");ee.className=Ue.empty,ee.textContent="No items match the current filters.",ee.hidden=!0,X.append($,ee),a.appendChild(X);const te=document.createElement("div");te.className=Ue.footer;const Y=document.createElement("button");Y.type="button",Y.className=Ue.loadMore,Y.textContent="Show more",Y.addEventListener("click",()=>t.onLoadMore?.()),te.appendChild(Y),a.appendChild(te);function B(q,ae,F){q.group.innerHTML="",q.row.hidden=F.length===0;for(const D of F){const P=document.createElement("button");if(P.type="button",P.className=Ro.chip,P.dataset.active=D.active?"true":"false",P.textContent=D.label,D.count>0){const le=document.createElement("span");le.className=Ro.count,le.textContent=String(D.count),P.appendChild(le)}P.addEventListener("click",()=>t.onFilterToggle?.(ae,D.id)),q.group.appendChild(P)}}function C(q){$.replaceChildren();const ae=document.createDocumentFragment();for(const F of q.items){const D={onEquip:()=>t.onItemEquip?.(F),onTransfer:()=>t.onItemTransfer?.(F),onTrash:()=>t.onItemTrash?.(F)};ae.appendChild(kT(F,D))}$.appendChild(ae),ee.hidden=q.filteredTotal!==0,ee.hidden||(ee.textContent=q.emptyMessage)}return{element:a,render(q){u.textContent=q.total===0?"No items yet":`${q.filteredTotal} of ${q.total} item${q.total===1?"":"s"}`;for(const[ae,F]of Object.entries(p))F.dataset.active=ae===q.collection?"true":"false";v.value!==q.search&&(v.value=q.search),x.value!==q.sort&&(x.value=q.sort),B(V.slots,"slots",q.filters.slots),B(V.rarities,"rarities",q.filters.rarities),B(V.tags,"tags",q.filters.tags),C(q),Y.hidden=!q.hasMore},setOpen(q){a.dataset.open=q?"true":"false"},focus(){const q=a.focus.bind(a);try{q({preventScroll:!0})}catch(ae){console.warn("Stash panel focus without scroll prevention fallback",ae);try{q()}catch(F){console.warn("Unable to focus stash panel element",F)}}},destroy(){a.remove()},setAutoEquip(q){R.setChecked(q)},setUiV2(q){I.setChecked(q)}}}const Ev="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcm9sZT0iaW1nIiBhcmlhLWxhYmVsbGVkYnk9InRpdGxlIiBmb2N1c2FibGU9ImZhbHNlIj4KICA8dGl0bGU+QXJ0b2NvaW4gaWNvbjwvdGl0bGU+CiAgPGRlZnM+CiAgICA8cmFkaWFsR3JhZGllbnQgaWQ9ImNvaW5Db3JlIiBjeD0iNTAlIiBjeT0iNDAlIiByPSI3MCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjZmZkZTlhIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjQ1JSIgc3RvcC1jb2xvcj0iI2Y4Yjg1OCIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjZDg3YTFkIiAvPgogICAgPC9yYWRpYWxHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iY29pblJpbSIgeDE9IjE1JSIgeTE9IjAlIiB4Mj0iODUlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmZGYxY2QiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iNDUlIiBzdG9wLWNvbG9yPSIjZjNjNDYzIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNiMTY0MTQiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJyaW1IaWdobGlnaHQiIHgxPSIzMCUiIHkxPSIxMCUiIHgyPSI3MCUiIHkyPSI5MCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjZmZmNGRjIiBzdG9wLW9wYWNpdHk9IjAuODUiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iNDAlIiBzdG9wLWNvbG9yPSIjZmZkZjliIiBzdG9wLW9wYWNpdHk9IjAuNTUiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iI2Y0YTg0OCIgc3RvcC1vcGFjaXR5PSIwLjMiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPHJhZGlhbEdyYWRpZW50IGlkPSJmYWNlVG9uZSIgY3g9IjU1JSIgY3k9IjM1JSIgcj0iNzAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZGNhOCIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI3MCUiIHN0b3AtY29sb3I9IiNmM2E5NWQiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iI2VhOGM0NCIgLz4KICAgIDwvcmFkaWFsR3JhZGllbnQ+CiAgICA8cGF0aCBpZD0ibGFiZWxQYXRoIiBkPSJNMjcgNTVhMzcgMzcgMCAwIDEgNzQgMCIgLz4KICA8L2RlZnM+CiAgPGcgZmlsbD0ibm9uZSI+CiAgICA8Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSI2MCIgZmlsbD0idXJsKCNjb2luUmltKSIgc3Ryb2tlPSIjNWUyYzAyIiBzdHJva2Utd2lkdGg9IjIiIC8+CiAgICA8Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSI2MCIgZmlsbD0idXJsKCNyaW1IaWdobGlnaHQpIiBvcGFjaXR5PSIwLjM1IiAvPgogICAgPGNpcmNsZSBjeD0iNjQiIGN5PSI2NCIgcj0iNDgiIGZpbGw9InVybCgjY29pbkNvcmUpIiBzdHJva2U9IiM1ZTJjMDIiIHN0cm9rZS13aWR0aD0iMS42IiAvPgogICAgPGNpcmNsZSBjeD0iNjQiIGN5PSI2NCIgcj0iNDIiIGZpbGw9InVybCgjY29pbkNvcmUpIiBvcGFjaXR5PSIwLjY1IiAvPgogICAgPGcgZmlsbD0iIzRiMjIwMCIgZm9udC1mYW1pbHk9IidNb250c2VycmF0JywnSW50ZXInLCdHaWxsIFNhbnMnLHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSI3MDAiIGxldHRlci1zcGFjaW5nPSIwLjQiPgogICAgICA8dGV4dD4KICAgICAgICA8dGV4dFBhdGggaHJlZj0iI2xhYmVsUGF0aCIgc3RhcnRPZmZzZXQ9IjUwJSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QVJUT0NPSU48L3RleHRQYXRoPgogICAgICA8L3RleHQ+CiAgICA8L2c+CiAgICA8Y2lyY2xlIGN4PSI0MCIgY3k9Ijc0IiByPSIzLjIiIGZpbGw9IiNjOTdhMjMiIC8+CiAgICA8Y2lyY2xlIGN4PSI4OCIgY3k9Ijc0IiByPSIzLjIiIGZpbGw9IiNjOTdhMjMiIC8+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2NCA3NCkiPgogICAgICA8ZWxsaXBzZSBjeD0iMCIgY3k9Ii0yIiByeD0iMjIiIHJ5PSIyNiIgZmlsbD0idXJsKCNmYWNlVG9uZSkiIHN0cm9rZT0iIzQ4MWUwNiIgc3Ryb2tlLXdpZHRoPSIxLjYiIC8+CiAgICAgIDxwYXRoIGQ9Ik0gLTIyIC02IEMgLTE2IC0xNSAtNyAtMjIgMCAtMjIgQyA3IC0yMiAxNiAtMTUgMjIgLTYgQyAyMCAtMjQgOSAtMzIgMCAtMzIgQyAtOSAtMzIgLTIwIC0yNCAtMjIgLTYgWiIgZmlsbD0iIzZjM2YyMyIgLz4KICAgICAgPHBhdGggZD0iTSAtMTMgLTI0IEMgLTcgLTMwIDEgLTMyIDggLTI4IEMgNiAtMzMgMSAtMzYgLTUgLTM2IEMgLTExIC0zNiAtMTYgLTMyIC0xNyAtMjcgQyAtMTYgLTI1IC0xNC41IC0yNC4yIC0xMyAtMjQgWiIgZmlsbD0iIzUzMmExMyIgLz4KICAgICAgPHJlY3QgeD0iLTE4IiB5PSItOSIgd2lkdGg9IjE0IiBoZWlnaHQ9IjkuNSIgcng9IjMuOCIgZmlsbD0iIzFjMWExOCIgLz4KICAgICAgPHJlY3QgeD0iNCIgeT0iLTkiIHdpZHRoPSIxNCIgaGVpZ2h0PSI5LjUiIHJ4PSIzLjgiIGZpbGw9IiMxYzFhMTgiIC8+CiAgICAgIDxyZWN0IHg9Ii00IiB5PSItNi40IiB3aWR0aD0iOCIgaGVpZ2h0PSIyLjYiIHJ4PSIxLjMiIGZpbGw9IiMxYzFhMTgiIC8+CiAgICAgIDxwYXRoIGQ9Ik0gLTguOCAtNiBWIC03LjQgQyAtOC44IC04LjYgLTcuOSAtOS40IC02LjYgLTkuNCBIIDEuNCBDIDIuNyAtOS40IDMuNiAtOC42IDMuNiAtNy40IFYgLTYgQyAzLjYgLTMuMSAxLjUgLTEuMiAtMS42IC0xLjIgQyAtNC43IC0xLjIgLTYuOCAtMy4xIC02LjggLTYgWiIgZmlsbD0iIzJiMjcyNCIgLz4KICAgICAgPHBhdGggZD0iTSAtMTEuMiAtMS4yIEMgLTguOCAxLjEgLTQuOCAyLjQgMCAyLjQgQyA0LjggMi40IDguOCAxLjEgMTEuMiAtMS4yIEMgMTAuOCAtMy4yIDkuNCAtNC44IDcgLTUuNiBDIDQuNyAtNC43IDIuNCAtNC4yIDAgLTQuMiBDIC0yLjQgLTQuMiAtNC43IC00LjcgLTcgLTUuNiBDIC05LjQgLTQuOCAtMTAuOCAtMy4yIC0xMS4yIC0xLjIgWiIgZmlsbD0iI2U0ODM0YSIgLz4KICAgICAgPHBhdGggZD0iTSAtMTAgMS42IEMgLTYgNi42IC0yIDguMiAwIDguMiBDIDIgOC4yIDYgNi42IDEwIDEuNiBWIC0xLjYgQyA2IC0wLjYgMiAwLjIgMCAwLjIgQyAtMiAwLjIgLTYgLTAuNiAtMTAgLTEuNiBWIDEuNiBaIiBmaWxsPSIjNmYyYjE5IiAvPgogICAgICA8cGF0aCBkPSJNIDAgMTIuMiBDIC00LjYgMTIuMiAtOC42IDEwLjggLTExLjggOC4yIEMgLTEwLjYgMTMuMSAtNi4xIDE2LjIgMCAxNi4yIEMgNi4xIDE2LjIgMTAuNiAxMy4xIDExLjggOC4yIEMgOC42IDEwLjggNC42IDEyLjIgMCAxMi4yIFoiIGZpbGw9IiNmNmIxNjciIC8+CiAgICA8L2c+CiAgICA8cGF0aCBkPSJNNjQgMjhjLTkuNiAwLTE4LjQgMi44LTI1LjggNy44LTEuNCAxLTEgMy4zIDAuNyAzLjggMTYuNCA0LjcgMzMuOCA0LjcgNTAuMiAwIDEuNy0wLjUgMi4xLTIuOCAwLjctMy44QzgyLjQgMzAuOCA3My42IDI4IDY0IDI4WiIgZmlsbD0iI2ZmZjdlNiIgb3BhY2l0eT0iMC40IiAvPgogICAgPHBhdGggZD0iTTY0IDEwNmMtMTIuNCAwLTIzLjUtMy43LTMyLjYtOS45LTEuNi0xLjEtMy44IDAuNS0zIDIuNCA1LjIgMTEuOCAxOCAyMC41IDM1LjYgMjAuNXMzMC40LTguNyAzNS42LTIwLjVjMC44LTEuOS0xLjQtMy41LTMtMi40LTkuMSA2LjItMjAuMiA5LjktMzIuNiA5LjlaIiBmaWxsPSIjOGQ0YjE0IiBvcGFjaXR5PSIwLjI1IiAvPgogIDwvZz4KPC9zdmc+Cg==",xv=new Intl.NumberFormat("en-US");function IT(t){return xv.format(Math.max(0,Math.floor(Number.isFinite(t)?t:0)))}function lh(t){return xv.format(Math.max(0,Math.floor(Number.isFinite(t)?t:0)))}function UT(t){const a=t.callbacks??{},s=document.createElement("section");s.className="sauna-shop-panel pointer-events-auto flex w-[min(26rem,92vw)] flex-col gap-5 rounded-hud-xl border border-white/10 bg-[linear-gradient(145deg,rgba(20,27,41,0.95),rgba(33,44,66,0.9))] p-5 text-slate-100 shadow-[0_32px_68px_rgba(10,16,32,0.55)] backdrop-blur-[16px] backdrop-saturate-[140%] transition-transform duration-200 ease-out",s.tabIndex=-1,s.dataset.open="false",s.setAttribute("role","dialog"),s.setAttribute("aria-modal","true"),s.setAttribute("aria-label","Steamforge atelier"),s.setAttribute("aria-hidden","true"),s.setAttribute("inert","");const r=document.createElement("header");r.className="flex items-start justify-between gap-3";const l=document.createElement("div");l.className="flex flex-col gap-1";const u=document.createElement("h2");u.className="text-lg font-semibold tracking-wide text-sky-50",u.textContent="Steamforge Atelier",l.appendChild(u);const f=document.createElement("p");f.className="text-sm text-slate-300/85",f.textContent="Commission tier upgrades with artocoins earned in the field.",l.appendChild(f);const h=document.createElement("button");h.type="button",h.className="group inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/5 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.12em] text-slate-200 transition-colors duration-150 hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",h.textContent="Close",h.addEventListener("click",()=>a.onClose?.()),r.append(l,h),s.appendChild(r);const m=document.createElement("div");m.className="flex items-center justify-between rounded-hud-lg border border-white/12 bg-[linear-gradient(135deg,rgba(255,245,224,0.18),rgba(255,192,120,0.12))] px-4 py-3 text-sm text-slate-100 shadow-[inset_0_0_18px_rgba(255,180,90,0.08)]";const p=document.createElement("div");p.className="flex flex-col gap-0.5";const g=document.createElement("span");g.className="text-xs font-semibold uppercase tracking-[0.14em] text-slate-200/80",g.textContent="Artocoin balance",p.appendChild(g);const b=document.createElement("span");b.className="text-xl font-bold text-amber-200 drop-shadow-[0_0_12px_rgba(255,190,100,0.25)]",b.textContent="0",p.appendChild(b);const v=document.createElement("div");v.className="relative h-12 w-12 flex-shrink-0",v.setAttribute("aria-hidden","true");const M=document.createElement("img");M.src=Ev,M.alt="",M.className="h-full w-full drop-shadow-[0_12px_18px_rgba(255,186,92,0.35)]",M.decoding="async",v.appendChild(M),m.append(p,v),s.appendChild(m);const x=document.createElement("div");x.className="flex flex-col gap-4",s.appendChild(x);const T=new Map;function _($){const{tier:ee}=$,te=document.createElement("article");te.className="relative overflow-hidden rounded-hud-lg border border-white/10 bg-[linear-gradient(135deg,rgba(24,30,46,0.86),rgba(42,56,78,0.9))] p-4 shadow-[0_16px_36px_rgba(10,16,32,0.4)] transition-transform duration-200 ease-out hover:-translate-y-1",te.dataset.tierId=ee.id;const Y=document.createElement("div");Y.className="pointer-events-none absolute inset-0 opacity-40",Y.style.background=ee.art.glow??"radial-gradient(circle at 20% 20%, rgba(255,255,255,0.18), transparent 70%)",te.appendChild(Y);const B=document.createElement("div");B.className="relative flex flex-col gap-3",te.appendChild(B);const C=document.createElement("div");C.className="flex items-start justify-between gap-3",B.appendChild(C);const J=document.createElement("div");J.className="flex items-center gap-3",C.appendChild(J);const q=document.createElement("div");q.className="h-12 w-12 flex-shrink-0 overflow-hidden rounded-full border border-white/40 bg-slate-900/40 shadow-[0_8px_16px_rgba(0,0,0,0.35)]",q.style.backgroundImage=`url(${ee.art.badge})`,q.style.backgroundSize="cover",q.style.backgroundPosition="center",q.setAttribute("aria-hidden","true"),J.appendChild(q);const ae=document.createElement("div");ae.className="flex flex-col gap-1",J.appendChild(ae);const F=document.createElement("h3");F.className="text-base font-semibold text-slate-50",F.textContent=ee.name,ae.appendChild(F);const D=document.createElement("span");D.className="text-xs font-medium uppercase tracking-[0.16em] text-slate-300/85",D.textContent=`Cap ${ee.rosterCap}`,ae.appendChild(D);const P=document.createElement("span");P.className="rounded-full border border-white/20 bg-white/10 px-3 py-1 text-[0.7rem] font-semibold uppercase tracking-[0.2em] text-slate-200 shadow-[0_4px_10px_rgba(12,17,32,0.45)]",P.textContent="Locked",C.appendChild(P);const le=document.createElement("p");le.className="text-sm leading-relaxed text-slate-200/85",le.textContent=ee.description,B.appendChild(le);const ne=document.createElement("div");ne.className="flex items-center justify-between gap-3",B.appendChild(ne);const E=document.createElement("span");E.className="text-sm font-semibold text-amber-200/90",E.textContent="—",ne.appendChild(E);const A=document.createElement("button");return A.type="button",A.className="group relative inline-flex items-center justify-center gap-2 rounded-full border border-amber-200/50 bg-[linear-gradient(135deg,rgba(255,200,120,0.9),rgba(255,157,66,0.92))] px-4 py-2 text-sm font-semibold uppercase tracking-[0.12em] text-slate-900 shadow-[0_12px_20px_rgba(255,168,74,0.35)] transition-all duration-150 ease-out hover:-translate-y-0.5 hover:shadow-[0_16px_28px_rgba(255,168,74,0.4)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-200",A.textContent="Unlock",ne.appendChild(A),A.addEventListener("click",()=>{if(!a.onPurchaseTier)return;const z=a.onPurchaseTier(ee.id);if(z){if(z.success){const Q=typeof $.status.cost=="number"?$.status.cost:ee.unlock.type==="artocoin"?ee.unlock.cost:0;a.emitToast?.(`${ee.name} unlocked for ${lh(Q)} artocoins.`,"success")}else z.reason==="insufficient-funds"?a.emitToast?.(`Need ${lh(z.shortfall??0)} more artocoins to commission ${ee.name}.`,"warn"):z.reason==="already-owned"&&a.emitToast?.(`${ee.name} is already unlocked.`,"info");I()}}),x.appendChild(te),{root:te,statusChip:P,description:le,rosterCap:D,actionButton:A,costLabel:E,status:$.status}}function R($,ee){const{tier:te,status:Y}=ee;$.rosterCap.textContent=`Cap ${te.rosterCap}`,$.description.textContent=te.description,$.status=Y,$.root.setAttribute("aria-label",`${te.name} — ${Y.requirementLabel}`),$.actionButton.title=Y.requirementLabel,$.actionButton.setAttribute("aria-label",Y.owned?`${te.name} unlocked`:Y.requirementLabel),$.root.dataset.state=Y.owned?"owned":Y.affordable?"ready":"locked",Y.owned?($.statusChip.textContent="Unlocked",$.statusChip.classList.add("bg-emerald-300/15","text-emerald-200"),$.statusChip.classList.remove("text-slate-200"),$.actionButton.disabled=!0,$.actionButton.textContent="Unlocked",$.actionButton.classList.add("cursor-not-allowed","opacity-60"),$.costLabel.textContent="Owned",$.costLabel.dataset.state="owned"):($.statusChip.textContent=Y.affordable?"Ready":"Locked",$.statusChip.classList.remove("bg-emerald-300/15","text-emerald-200"),$.statusChip.classList.add("text-slate-200"),$.actionButton.disabled=!Y.affordable,$.actionButton.textContent=Y.affordable?"Unlock now":"Insufficient",$.actionButton.classList.toggle("opacity-60",!Y.affordable),$.actionButton.classList.toggle("cursor-not-allowed",!Y.affordable),$.costLabel.textContent=Y.cost?`${lh(Y.cost)} artocoins`:"Included",$.costLabel.dataset.state=Y.affordable?"ready":"locked")}function I($){const ee=$??t.getViewModel();b.textContent=IT(ee.balance),ee.tiers.forEach(te=>{const Y=T.get(te.tier.id);if(Y){R(Y,te);return}const B=_(te);T.set(te.tier.id,B),R(B,te)})}function j($){s.dataset.open=$?"true":"false",s.setAttribute("aria-hidden",$?"false":"true"),$?s.removeAttribute("inert"):s.setAttribute("inert","")}function V(){requestAnimationFrame(()=>{s.focus({preventScroll:!0})})}function X(){s.remove(),T.clear()}return I(),{element:s,setOpen:j,update:I,focus:V,destroy:X}}const ch=24,OT=4500,zT=400,BT={health:"HP",attackDamage:"ATK",attackRange:"RNG",movementRange:"MOV",defense:"DEF",shield:"Shield"},Fb="pointer-events-none ml-auto flex w-full max-w-[min(22rem,90vw)] flex-col gap-[clamp(6px,1vw,12px)]",qT="pointer-events-auto flex w-full items-center gap-[clamp(4px,0.8vw,12px)] rounded-hud-md border border-[color:var(--hud-border)] px-4 py-3 text-[0.9rem] font-semibold leading-[1.35] shadow-hud-lg backdrop-blur-[14px] backdrop-saturate-[135%] transition-all duration-300 ease-out",HT={loot:"bg-[linear-gradient(140deg,color-mix(in_srgb,var(--color-surface-strong)_82%,rgba(15,23,42,0.18))_0%,color-mix(in_srgb,var(--color-accent-gold)_46%,var(--color-surface))_100%)] text-[color:color-mix(in_srgb,var(--color-foreground)_95%,rgba(255,250,235,0.12))]",info:"bg-[linear-gradient(140deg,color-mix(in_srgb,var(--color-surface-strong)_84%,rgba(12,22,38,0.2))_0%,color-mix(in_srgb,var(--color-accent-blue)_48%,var(--color-surface))_100%)] text-[color:color-mix(in_srgb,var(--color-foreground)_95%,rgba(224,247,255,0.1))]",warn:"bg-[linear-gradient(140deg,color-mix(in_srgb,var(--color-surface-strong)_82%,rgba(40,18,12,0.35))_0%,color-mix(in_srgb,var(--color-accent-red)_52%,var(--color-surface))_100%)] text-[color:color-mix(in_srgb,var(--color-foreground)_92%,rgba(255,234,221,0.22))]"},jT=["-translate-y-2","opacity-0"];function tu(t){t.hidden=t.childElementCount===0}function GT(t,a){const s=t.querySelector('[data-ui="loot-toast-stack"]');if(s)return s.parentElement!==a&&a.appendChild(s),s.className=Fb,s.style.zIndex=String(zb.toast),tu(s),s;const l=(t.ownerDocument??document).createElement("div");return l.dataset.ui="loot-toast-stack",l.className=Fb,l.setAttribute("aria-live","polite"),l.setAttribute("role","status"),l.style.zIndex=String(zb.toast),tu(l),a.appendChild(l),l}function qt(t,a,s){const r=(t.ownerDocument??document).createElement("div");r.dataset.variant=s,r.className=`${qT} ${HT[s]}`,r.textContent=a,t.appendChild(r),tu(t);const l=()=>{r.remove(),tu(t)},u=window.setTimeout(()=>{r.classList.add(...jT),window.setTimeout(l,zT)},OT);r.addEventListener("click",()=>{window.clearTimeout(u),l()})}function YT(t,a){t.has(a)?t.delete(a):t.add(a)}function FT(t){const a=t.comparison?.deltas??[];return a.length===0?null:a.map(r=>{const l=BT[r.stat]??r.stat;return`${r.delta>0?"+":""}${r.delta} ${l}`}).join(", ")}function uh(t){switch(t){case"inventory":return"ready inventory";case"stash":return"stash";case"equipped":default:return"loadout"}}function VT(){const t=document.createElement("button");t.type="button",t.dataset.testid="inventory-badge",t.dataset.ui="inventory-badge",t.className="group inline-flex items-center gap-2 rounded-hud-pill border border-white/15 bg-[linear-gradient(135deg,rgba(27,36,56,0.9),rgba(39,74,110,0.9))] px-3.5 py-2 font-semibold text-sky-50 shadow-hud-sm transition-all duration-150 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent hover:-translate-y-0.5 hover:shadow-hud-md data-[autoequip=off]:bg-[linear-gradient(135deg,rgba(56,44,25,0.9),rgba(92,72,40,0.9))]",t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","inventory-stash-panel"),t.setAttribute("aria-label","Open quartermaster stash");const a=document.createElement("span");a.className="relative flex h-[1.65rem] w-[1.65rem] flex-shrink-0 items-center justify-center rounded-full bg-[radial-gradient(circle_at_30%_30%,rgba(255,255,255,0.9),rgba(225,235,255,0.2))] text-slate-900 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.35)]",a.setAttribute("aria-hidden","true");const s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg");r.setAttribute("viewBox","0 0 24 24"),r.setAttribute("aria-hidden","true"),r.setAttribute("focusable","false"),r.setAttribute("class","h-[76%] w-[76%]");const l=document.createElementNS(s,"path");l.setAttribute("d","M8.25 7V6a3.75 3.75 0 0 1 7.5 0v1m3 0h-14.25a1.5 1.5 0 0 0-1.485 1.342l-.75 9a3 3 0 0 0 2.985 3.158h9.78a3 3 0 0 0 2.985-3.158l-.75-9A1.5 1.5 0 0 0 18.75 7Z"),l.setAttribute("fill","rgba(194, 216, 255, 0.32)"),l.setAttribute("stroke","rgba(255, 255, 255, 0.92)"),l.setAttribute("stroke-width","1.6"),l.setAttribute("stroke-linecap","round"),l.setAttribute("stroke-linejoin","round");const u=document.createElementNS(s,"path");u.setAttribute("d","M9.75 12.25h4.5"),u.setAttribute("fill","none"),u.setAttribute("stroke","rgba(255, 255, 255, 0.85)"),u.setAttribute("stroke-width","1.4"),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("opacity","0.9"),r.append(l,u),a.appendChild(r),t.appendChild(a);const f=document.createElement("span");f.className="text-[0.75rem] uppercase tracking-[0.08em]",f.textContent="Stash",t.appendChild(f);const h=document.createElement("span");return h.className="min-w-[1.5rem] rounded-full bg-white/15 px-2 py-[0.1rem] text-center text-xs font-semibold text-white/90",h.textContent="0",h.setAttribute("aria-hidden","true"),t.appendChild(h),{button:t,count:h}}function $T(){const t=document.createElement("button");t.type="button",t.className="group inline-flex items-center gap-2 rounded-hud-pill border border-white/12 bg-[linear-gradient(135deg,rgba(44,32,18,0.92),rgba(68,48,24,0.95))] px-3.5 py-2 font-semibold text-amber-200 shadow-[0_14px_24px_rgba(17,12,6,0.55)] transition-all duration-150 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-300 hover:-translate-y-0.5 hover:shadow-[0_18px_28px_rgba(17,12,6,0.65)]",t.setAttribute("aria-expanded","false"),t.setAttribute("aria-label","Open artocoin shop");const a=document.createElement("span");a.className="relative flex h-[1.65rem] w-[1.65rem] flex-shrink-0 items-center justify-center rounded-full bg-[radial-gradient(circle_at_35%_30%,rgba(255,210,128,0.95),rgba(114,68,17,0.85))] shadow-[inset_0_0_0_1px_rgba(255,236,196,0.55)]",a.setAttribute("aria-hidden","true");const s=document.createElement("img");s.src=Ev,s.alt="",s.decoding="async",s.className="h-[78%] w-[78%] drop-shadow-[0_10px_18px_rgba(255,186,92,0.4)]",a.appendChild(s);const r=document.createElement("span");return r.className="text-[0.75rem] uppercase tracking-[0.08em]",r.textContent="Shop",t.append(a,r),t}function XT(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{destroy:()=>{}};const{regions:r}=dr(s),l=r.top,u=GT(s,l);s.querySelector("#inventory-stash-panel")?.remove(),s.querySelector("#inventory-shop-panel")?.remove(),s.querySelectorAll('[data-testid="inventory-badge"]').forEach(A=>A.remove());const{button:f,count:h}=VT();f.dataset.autoequip=t.isAutoEquipEnabled()?"on":"off",l.appendChild(f);const m=new Intl.NumberFormat("en-US");let p=null,g=null,b=!1,v=null,M=null,x=()=>{};const T=A=>{if(!g||!A)return;const z=m.format(Math.max(0,Math.floor(Number.isFinite(A.balance)?A.balance:0)));g.dataset.balance=z,g.title=`Artocoins ${z}`;const Q=A.tiers.some(de=>!de.status.owned&&de.status.affordable),se=A.tiers.some(de=>!de.status.owned&&!de.status.affordable);g.dataset.state=Q?"ready":se?"locked":"complete"},_={success:"loot",info:"info",warn:"warn"};if(typeof a.getSaunaShopViewModel=="function"){const A=()=>a.getSaunaShopViewModel?.()??{balance:0,tiers:[]};g=$T(),g.dataset.state="locked",l.appendChild(g),p=UT({getViewModel:A,callbacks:{onClose:()=>x(!1),onPurchaseTier:de=>{const ue=a.onPurchaseSaunaTier;return ue?ue(de):{success:!1,balance:A().balance,purchased:new Set,reason:"unsupported"}},emitToast:(de,ue)=>{const ge=_[ue]??"info";qt(u,de,ge)}}}),p.element.id="inventory-shop-panel",g.setAttribute("aria-controls","inventory-shop-panel"),s.appendChild(p.element);const se=A();p.update(se),T(se),x=de=>{if(b!==de)if(b=de,p?.setOpen(de),g?.setAttribute("aria-expanded",de?"true":"false"),g?.setAttribute("aria-label",de?"Close artocoin shop":"Open artocoin shop"),de){Y(!1),s.classList.add("inventory-shop-open");const ue=A();p?.update(ue),T(ue);try{p?.focus()}catch(ge){console.warn("Unable to focus artocoin shop",ge)}}else{s.classList.remove("inventory-shop-open");try{g?.focus({preventScroll:!0})}catch(ue){console.warn("Unable to restore focus to artocoin shop button",ue)}}},M=()=>x(!b),g.addEventListener("click",M),v=a.subscribeToSaunaShop?.(()=>{const de=A();p?.update(de),T(de)})}const I=DT({onClose:()=>Y(!1),onCollectionChange:A=>{V!==A&&(V=A,te=1,C())},onFilterToggle:(A,z)=>{const Q=X[A];YT(Q,z),te=1,C()},onSearchChange:A=>{$=A,te=1,C()},onSortChange:A=>{ee=A,te=1,C()},onLoadMore:()=>{te+=1,C()},onItemEquip:A=>{q(A)},onItemTransfer:A=>{ae(A)},onItemTrash:A=>{F(A)},getAutoEquipState:()=>t.isAutoEquipEnabled(),onAutoEquipChange:A=>{t.setAutoEquip(A),f.dataset.autoequip=A?"on":"off",qt(u,A?"Auto-equip enabled. Newly recovered gear will try to arm your selected attendant.":"Auto-equip disabled. Loot will head to the stash until you equip it manually.","info")},getUiV2State:()=>a.getUseUiV2?.()??!1,onUiV2Change:A=>{a.onUseUiV2Change?.(A),qt(u,A?"Experimental HUD enabled. Reload to try the React/Tailwind experience.":"Classic HUD restored for your next session.","info")}});I.element.id="inventory-stash-panel",s.appendChild(I.element);let j=!1,V="stash";const X=wC();let $="",ee="newest",te=1;function Y(A){if(j!==A)if(j=A,I.setOpen(j),f.setAttribute("aria-expanded",j?"true":"false"),f.setAttribute("aria-label",j?"Close quartermaster stash":"Open quartermaster stash"),j){x(!1),s.classList.add("inventory-panel-open");try{I.focus()}catch(z){console.warn("Unable to focus stash panel",z)}}else s.classList.remove("inventory-panel-open")}function B(){const A=a.getComparisonContext?.()??null;let z=Gb({stash:t.getStash(),inventory:t.getInventory(),filters:X,search:$,sort:ee,page:te,pageSize:ch,collection:V,comparisonContext:A});if(z.filteredTotal>0){const Q=Math.max(1,Math.ceil(z.filteredTotal/ch));te>Q&&(te=Q,z=Gb({stash:t.getStash(),inventory:t.getInventory(),filters:X,search:$,sort:ee,page:te,pageSize:ch,collection:V,comparisonContext:A}))}return z}function C(){const A=B(),Q=A.collections.find(se=>se.id==="stash")?.count??0;h.textContent=String(Q),f.dataset.count=String(Q),I.render(A)}function J(){const A=a.getSelectedUnitId?.()??null;return A||(qt(u,"Select an attendant before equipping an item.","warn"),null)}function q(A){const z=J();if(!z)return;const Q=a.onEquip??(()=>({success:!1}));(A.location==="stash"?t.equipFromStash(A.index,z,(ue,ge)=>Q(ue,ge,"stash")):t.equipFromInventory(A.index,z,(ue,ge)=>Q(ue,ge,"inventory")))||qt(u,"Unable to equip that item right now.","warn")}function ae(A){const z=A.location==="stash"?t.moveToInventory(A.index):t.moveToStash(A.index);if(!z){qt(u,"Unable to move that item right now.","warn");return}const Q=A.location==="stash"?"ready inventory":"stash";qt(u,`Moved ${z.name} to the ${Q}.`,"info"),te=1,C()}function F(A){const z=A.location==="stash"?t.discardFromStash(A.index):t.discardFromInventory(A.index);if(!z){qt(u,"That item was already removed.","warn");return}const Q=A.location==="stash"?"stash":"ready inventory";qt(u,`${z.name} discarded from the ${Q}.`,"warn"),C()}function D(A){switch(A.type){case"stash-updated":case"inventory-updated":C();break;case"item-acquired":if(A.equipped)qt(u,`${A.item.name} auto-equipped successfully.`,"info");else{const z=uh(A.location);qt(u,`New item secured: ${A.item.name} (${z}).`,"loot")}break;case"item-equipped":{const z=FT(A),Q=z?` (${z})`:"";qt(u,`Equipped ${A.item.name}${Q}.`,"info");break}case"item-unequipped":qt(u,`${A.item.name} returned to the stash from slot ${A.slot}.`,"info");break;case"item-moved":{const z=uh(A.to);qt(u,`Moved ${A.item.name} to the ${z}.`,"info");break}case"item-discarded":{const z=uh(A.location);qt(u,`${A.item.name} discarded from the ${z}.`,"warn");break}case"settings-updated":f.dataset.autoequip=A.autoEquip?"on":"off",I.setAutoEquip(A.autoEquip);break}}const P=t.on(A=>D(A)),le=()=>{Y(!j)};f.addEventListener("click",le);const ne=A=>{A.defaultPrevented||A.code==="KeyI"&&!A.metaKey&&!A.ctrlKey&&!A.altKey&&(A.preventDefault(),Y(!j))};return window.addEventListener("keydown",ne),C(),{destroy:()=>{P(),f.removeEventListener("click",le),window.removeEventListener("keydown",ne),f.remove(),I.destroy(),s.classList.remove("inventory-panel-open"),g&&M&&g.removeEventListener("click",M),p?.destroy(),g?.remove(),v?.(),s.classList.remove("inventory-shop-open"),u.hasChildNodes()||u.remove()}}}const QT=Object.freeze({common:1,uncommon:.6,rare:.35,epic:.18,legendary:.08,mythic:.03}),KT=Object.freeze({id:"general-salvage",label:"General Salvage",entries:Object.freeze([{id:"birch-sap-satchel",name:"Birch Sap Satchel",description:"Soothing birch sap that doubles as a brisk field tonic.",rarity:"common",quantity:{min:1,max:3},weight:6},{id:"steamed-bandages",name:"Steamed Linen Bandages",description:"Freshly steamed bandages infused with pine oils.",rarity:"common",quantity:1,weight:5},{id:"emberglass-shard",name:"Emberglass Shard",description:"A radiant shard used to kindle sauna braziers.",rarity:"uncommon",quantity:1,weight:3},{id:"aurora-distillate",name:"Aurora Distillate",description:"Vials of shimmering condensation that empower sauna rituals.",rarity:"rare",quantity:1,weight:1.5},{id:"myrsky-charm",name:"Myrsky Charm",description:"Storm-forged charm rumored to call down aurora flares.",rarity:"epic",quantity:1,weight:.7}])}),PT=Object.freeze({base:Object.freeze({id:"enemy-raiders",label:"Avanto Marauder Spoils",entries:Object.freeze([{id:"cracked-ice-amulet",name:"Cracked Ice Amulet",description:"Necklace of frostbitten charms that hum when danger nears.",rarity:"common",quantity:1,weight:5},{id:"stolen-sauna-tokens",name:"Stolen Sauna Tokens",description:"Pilfered entrance tokens, gladly accepted back at any sauna hall.",rarity:"uncommon",quantity:{min:2,max:5},weight:3},{id:"glacier-brand",name:"Glacier Brand",description:"A cleaver chilled in glacial meltwater that never dulls.",rarity:"rare",quantity:1,weight:1.25}])}),elite:Object.freeze({id:"enemy-champions",label:"Avanto Champion Cache",entries:Object.freeze([{id:"frostwyrm-signet",name:"Frostwyrm Signet",description:"An icy signet ring that wreathes its bearer in frozen vapour.",rarity:"epic",quantity:1,weight:1.1},{id:"aurora-lattice",name:"Aurora Lattice",description:"Filigree latticework that channels auroral light into focused beams.",rarity:"legendary",quantity:1,weight:.4},{id:"midnight-bloodwine",name:"Midnight Bloodwine",description:"A mythical draught said to rekindle a warrior's lost resolve.",rarity:"mythic",quantity:1,weight:.12}])})}),ZT=Object.freeze({base:Object.freeze({id:"deepwood-offerings",label:"Deepwood Offerings",entries:Object.freeze([{id:"spirit-oak-charm",name:"Spirit Oak Charm",description:"Carved from living oak, it whispers guidance between sauna rounds.",rarity:"uncommon",quantity:1,weight:4},{id:"sauna-incense",name:"Sauna Incense Pouches",description:"Fragrant blends that steady breathing before the next engagement.",rarity:"common",quantity:{min:1,max:4},weight:5},{id:"emberglass-arrow",name:"Emberglass Arrow Bundle",description:"Arrowheads that glow amber when a perfect shot reveals itself.",rarity:"rare",quantity:{min:1,max:2},weight:1.75}])}),elite:Object.freeze({id:"deepwood-ritual-cache",label:"Deepwood Ritual Cache",entries:Object.freeze([{id:"windstep-totem",name:"Windstep Totem",description:"Totem etched with gale sigils that lighten every cautious stride.",rarity:"epic",quantity:1,weight:.9},{id:"searing-chant-censer",name:"Searing Chant Censer",description:"An ornate censer that empowers allies with smouldering hymns.",rarity:"legendary",quantity:1,weight:.35}])})}),JT=Object.freeze({enemy:PT,deepwood:ZT});function WT(t){return JT[t]??{base:KT}}function e5(t,a=!1){const s=WT(t);return a&&s.elite?s.elite:s.base}function t5(t){if(!Number.isFinite(t))return 1;const a=Math.floor(t);return a<=0?0:Math.min(10,a)}function n5(t,a){if(typeof t=="number"&&Number.isFinite(t))return Math.max(1,Math.round(t));if(!t)return 1;const s=t,r=Math.max(1,Math.round(s.min)),u=Math.max(r,Math.round(s.max))-r+1,f=Math.floor(Math.max(0,Math.min(.999999,a()))*u);return r+f}function a5(t){const a=QT[t.rarity]??1,s=typeof t.weight=="number"?t.weight:1;return Math.max(0,s)*Math.max(0,a)}function i5(t,a){const s=t.map(f=>({entry:f,weight:a5(f)})).filter(f=>f.weight>0);if(s.length===0)return null;const r=s.reduce((f,h)=>f+h.weight,0),l=Math.max(0,Math.min(.999999,a()))*r;let u=0;for(const f of s)if(u+=f.weight,l<u)return f.entry;return s[s.length-1]?.entry??null}function s5(t,a){return{id:t.id,name:t.name,description:t.description,icon:t.icon,rarity:t.rarity,quantity:a}}function r5(t){const a=typeof t.random=="function"?t.random:Math.random,s=!!t.elite,r=t.table??e5(t.factionId,s),l=t5(t.rolls),u=[];if(l<=0||r.entries.length===0)return{factionId:t.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u};for(let f=0;f<l;f+=1){const h=i5(r.entries,a);if(!h)break;const m=n5(h.quantity,a);u.push({entryId:h.id,rarity:h.rarity,quantity:m,item:s5(h,m)})}return{factionId:t.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u}}const o5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23a4d67a'%20/%3e%3cpolygon%20points='16,48%2032,16%2048,48'%20fill='%23d2691e'%20/%3e%3crect%20x='24'%20y='32'%20width='16'%20height='16'%20fill='%23f4a460'%20/%3e%3c/svg%3e",l5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23c0c0c0'%20/%3e%3crect%20x='8'%20y='24'%20width='48'%20height='24'%20fill='%23808080'%20/%3e%3crect%20x='24'%20y='16'%20width='16'%20height='8'%20fill='%23606060'%20/%3e%3c/svg%3e",c5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23e0e0e0'%20/%3e%3crect%20x='10'%20y='22'%20width='12'%20height='30'%20fill='%23a9a9a9'%20/%3e%3crect%20x='26'%20y='14'%20width='12'%20height='38'%20fill='%23808080'%20/%3e%3crect%20x='42'%20y='26'%20width='12'%20height='26'%20fill='%23a9a9a9'%20/%3e%3c/svg%3e",u5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%238b4513'%20/%3e%3cpolygon%20points='32,10%2042,22%2022,22'%20fill='%23555'%20/%3e%3crect%20x='30'%20y='22'%20width='4'%20height='32'%20fill='%23ccc'%20/%3e%3c/svg%3e",d5="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eAuric%20Warder%3c/title%3e%3cdesc%20id='desc'%3eRunic%20soldier%20with%20aurora-lit%20shield,%20sculpted%20armor,%20and%20crystalline%20broadsword.%3c/desc%3e%3cdefs%3e%3clinearGradient%20id='soldier-panel'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23091522'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23102a46'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-halo'%20cx='52%25'%20cy='18%25'%20r='68%25'%3e%3cstop%20offset='0%25'%20stop-color='rgba(186,%20230,%20253,%200.92)'%20/%3e%3cstop%20offset='45%25'%20stop-color='rgba(59,%20130,%20246,%200.42)'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(15,%2023,%2042,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-armor'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='55%25'%20stop-color='%23cbd5f5'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23475569'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-gold'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20/%3e%3cstop%20offset='45%25'%20stop-color='%23fbbf24'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f97316'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-cloak'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%231d4ed8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-shield'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23bfdbfe'%20/%3e%3cstop%20offset='65%25'%20stop-color='%2360a5fa'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231d4ed8'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-shield-core'%20cx='40%25'%20cy='40%25'%20r='45%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fef3c7'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(248,%20250,%20252,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-sword'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231f2937'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='128'%20height='128'%20rx='18'%20fill='url(%23soldier-panel)'%20/%3e%3ccircle%20cx='64'%20cy='40'%20r='46'%20fill='url(%23soldier-halo)'%20/%3e%3cellipse%20cx='64'%20cy='110'%20rx='34'%20ry='11'%20fill='%230f172a'%20opacity='0.45'%20/%3e%3cpath%20d='M34%2038c-8%2015-11%2034-6%2052l18%2010c-2-22%206-40%2020-50-12-4-22-8-32-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.88'%20/%3e%3cpath%20d='M94%2038c8%2015%2011%2034%206%2052l-18%2010c2-22-6-40-20-50%2012-4%2022-8%2032-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.68'%20/%3e%3cpath%20d='M58%2018l-12%2014c-5%207-8%2017-8%2028v20l14%2042h24l14-42V60c0-11-3-21-8-28L70%2018H58z'%20fill='url(%23soldier-armor)'%20stroke='%231f2937'%20stroke-width='2.4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M46%2060h36l6%2016c-10%2010-20%2016-24%2016s-14-6-24-16l6-16z'%20fill='%23e0f2fe'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2024c-7%200-14%205-20%2012l8%2010c8-6%2024-6%2032%200l8-10c-6-7-13-12-20-12z'%20fill='%23f8fafc'%20stroke='%23cbd5f5'%20stroke-width='2'%20/%3e%3cpath%20d='M56%2016h16l6%208-14%208-14-8%206-8z'%20fill='%23e2e8f0'%20stroke='%2394a3b8'%20stroke-width='1.8'%20/%3e%3cpath%20d='M52%2074h12l2%2020-10%2012-10-12%206-20z'%20fill='url(%23soldier-gold)'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2096l10%2010%2010-12-6-20H66l-2%2022z'%20fill='%23fef3c7'%20opacity='0.72'%20/%3e%3cpath%20d='M32%2068l-12%206%2014%2032%2016-8-18-30z'%20fill='url(%23soldier-shield)'%20stroke='%231e3a8a'%20stroke-width='2.2'%20/%3e%3ccircle%20cx='36'%20cy='82'%20r='8'%20fill='url(%23soldier-shield-core)'%20/%3e%3cpath%20d='M96%2060l-6-6-22%2044%208%2010%2020-48z'%20fill='url(%23soldier-sword)'%20stroke='%230f172a'%20stroke-width='2.2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M86%2050l-18%2040%2012%206%2016-36-10-10z'%20fill='%23f8fafc'%20opacity='0.7'%20/%3e%3cpath%20d='M64%20102c-9%200-18%207-22%2016%208%206%2014%208%2022%208s14-2%2022-8c-4-9-13-16-22-16z'%20fill='%23dbeafe'%20stroke='%2393c5fd'%20stroke-width='1.6'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M58%2056h12l3%2010-9%206-9-6%203-10z'%20fill='%231f2937'%20opacity='0.85'%20/%3e%3ccircle%20cx='64'%20cy='58'%20r='7'%20fill='%23f1f5f9'%20stroke='%23cbd5f5'%20stroke-width='1.4'%20/%3e%3cpath%20d='M54%2044c-5%200-8%205-8%2012%206-3%2012-6%2018-6s12%203%2018%206c0-7-3-12-8-12H54z'%20fill='%230f172a'%20opacity='0.82'%20/%3e%3c/svg%3e",f5="/assets/archer-DIBoEfQj.svg",h5="/assets/avanto-marauder-B6bFdUJV.svg",Ks="/",Zn={saunaBeer:`${Ks}assets/ui/sauna-beer.svg`,saunojaRoster:`${Ks}assets/ui/saunoja-roster.svg`,resource:`${Ks}assets/ui/resource.svg`,sisu:`${Ks}assets/ui/resource.svg`,sound:`${Ks}assets/ui/sound.svg`,artocoin:`${Ks}assets/ui/artocoin.svg`},m5={images:{placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=","building-farm":o5,"building-barracks":l5,"building-city":c5,"building-mine":u5,"unit-soldier":d5,"unit-archer":f5,"unit-avanto-marauder":h5,"icon-sauna-beer":Zn.saunaBeer,"icon-saunoja-roster":Zn.saunojaRoster,"icon-resource":Zn.resource,"icon-sound":Zn.sound,"icon-artocoin":Zn.artocoin}};let Av=null;function p5(t){Av=t}function wv(){return Av}const g5=["city"],y5=1e4,b5=12e3;function v5(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Vb(t){return Object.freeze({strongholds:{...t.strongholds},roster:{...t.roster},economy:{...t.economy},sauna:{...t.sauna},enemyKills:t.enemyKills,exploration:{...t.exploration},startedAt:t.startedAt})}function $b(t){const a={[oe.SAUNA_BEER]:0,[oe.SAUNAKUNNIA]:0,[oe.SISU]:0};return Object.values(oe).forEach(s=>{a[s]=t.getResource(s)}),a}class S5{timeSource;state;map;getRosterCount;sauna;strongholdTypes;rosterGraceMs;bankruptcyGraceMs;progress;startResources;strongholds=new Map;revealedTiles=new Set;progressListeners=new Set;resolutionListeners=new Set;mapDisposer=null;rosterTimeout=null;bankruptcyTimeout=null;bankruptSince=null;wipeSince=null;saunaDestroyedAt=null;resolution=null;disposed=!1;constructor(a){this.timeSource=typeof a.timeSource=="function"?a.timeSource:v5,this.state=a.state,this.map=a.map,this.getRosterCount=a.getRosterCount,this.sauna=a.sauna??null;const s=a.strongholdTypes?.length?a.strongholdTypes:g5;this.strongholdTypes=new Set(s),this.rosterGraceMs=Math.max(0,a.rosterWipeGraceMs??y5),this.bankruptcyGraceMs=Math.max(0,a.bankruptcyGraceMs??b5),this.startResources=$b(this.state);const r=this.state.getResource(oe.SAUNA_BEER),l=Math.max(0,Math.round(this.getRosterCount()))||0;this.progress={strongholds:{total:0,destroyed:0,remaining:0},roster:{active:l,totalDeaths:0,wipeSince:null,wipeDurationMs:0},economy:{beer:r,worstBeer:r,bankruptSince:null,bankruptDurationMs:0},sauna:this.createSaunaProgress(),enemyKills:0,exploration:{revealedHexes:0},startedAt:this.timeSource()},this.bootstrapStrongholds(),this.attachMapListener(),this.attachEventListeners(),this.emitProgress(),this.evaluateResolution()}onProgress(a){this.progressListeners.add(a)}offProgress(a){this.progressListeners.delete(a)}onResolution(a){if(this.resolution){a(this.resolution);return}this.resolutionListeners.add(a)}offResolution(a){this.resolutionListeners.delete(a)}getProgress(){return Vb(this.progress)}dispose(){if(!this.disposed){if(this.disposed=!0,this.clearRosterTimer(),this.clearBankruptcyTimer(),this.mapDisposer){try{this.mapDisposer()}catch(a){console.warn("Failed to detach map listener",a)}this.mapDisposer=null}re.off("unitDied",this.handleUnitDied),re.off("unitSpawned",this.handleUnitSpawned),re.off("resourceChanged",this.handleResourceChanged),re.off("saunaDamaged",this.handleSaunaDamaged),re.off("saunaDestroyed",this.handleSaunaDestroyed)}}bootstrapStrongholds(){this.map.forEachTile((a,s)=>{if(this.captureExploration(s,a),this.isStronghold(a.building)){const r=this.coordKey(s);this.strongholds.set(r,{alive:!0})}}),this.updateStrongholdTotals()}attachMapListener(){this.mapDisposer=this.map.addTileChangeListener((a,s,r)=>{let l=!1;if((r==="fog"||r==="created")&&this.captureExploration(a,s)&&(l=!0),r==="building"||r==="created"){const u=this.coordKey(a),f=this.strongholds.get(u);this.isStronghold(s.building)?f?f.alive||(f.alive=!0):this.strongholds.set(u,{alive:!0}):f?.alive&&(f.alive=!1),this.updateStrongholdTotals(),l=!0}l&&(this.emitProgress(),this.evaluateResolution())})}captureExploration(a,s){if(s.isFogged)return!1;const r=this.coordKey(a),l=this.revealedTiles.size;return this.revealedTiles.has(r)||(this.revealedTiles.add(r),this.progress.exploration.revealedHexes=this.revealedTiles.size),this.revealedTiles.size!==l}attachEventListeners(){re.on("unitDied",this.handleUnitDied),re.on("unitSpawned",this.handleUnitSpawned),re.on("resourceChanged",this.handleResourceChanged),re.on("saunaDamaged",this.handleSaunaDamaged),re.on("saunaDestroyed",this.handleSaunaDestroyed)}handleUnitDied=({unitFaction:a})=>{if(a==="player"){this.progress.roster.totalDeaths+=1,this.refreshRosterStatus(),this.emitProgress(),this.evaluateResolution();return}this.progress.enemyKills+=1,this.emitProgress()};handleUnitSpawned=({unit:a})=>{a.faction==="player"&&(this.refreshRosterStatus(),this.emitProgress())};handleResourceChanged=({resource:a,total:s})=>{a===oe.SAUNA_BEER&&(this.progress.economy.beer=s,s<this.progress.economy.worstBeer&&(this.progress.economy.worstBeer=s),s<0?this.bankruptSince===null&&(this.bankruptSince=this.timeSource(),this.progress.economy.bankruptSince=this.bankruptSince,this.startBankruptcyTimer()):(this.updateBankruptcyDuration(),this.bankruptSince=null,this.progress.economy.bankruptSince=null,this.clearBankruptcyTimer()),this.emitProgress())};handleSaunaDamaged=({remainingHealth:a})=>{this.disposed||(this.updateSaunaSnapshot(a),this.emitProgress())};handleSaunaDestroyed=a=>{this.disposed||(this.markSaunaDestroyed(),this.emitProgress(),this.resolve("lose","saunaDestroyed"))};startBankruptcyTimer(){if(this.bankruptcyTimeout===null){if(this.bankruptcyGraceMs<=0){this.resolve("lose","bankruptcy");return}this.bankruptcyTimeout=setTimeout(()=>{this.updateBankruptcyDuration(),this.resolve("lose","bankruptcy")},this.bankruptcyGraceMs)}}clearBankruptcyTimer(){this.bankruptcyTimeout!==null&&(clearTimeout(this.bankruptcyTimeout),this.bankruptcyTimeout=null)}startRosterTimer(){if(this.rosterTimeout===null){if(this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.rosterTimeout=setTimeout(()=>{this.updateRosterDuration(),this.resolve("lose","rosterWipe")},this.rosterGraceMs)}}clearRosterTimer(){this.rosterTimeout!==null&&(clearTimeout(this.rosterTimeout),this.rosterTimeout=null)}updateStrongholdTotals(){const a=this.strongholds.size;let s=0;for(const r of this.strongholds.values())r.alive&&(s+=1);this.progress.strongholds.total=a,this.progress.strongholds.remaining=s,this.progress.strongholds.destroyed=Math.max(0,a-s)}refreshRosterStatus(){const a=Math.max(0,Math.round(this.getRosterCount()));this.progress.roster.active=a,a<=0?(this.wipeSince===null&&(this.wipeSince=this.timeSource(),this.progress.roster.wipeSince=this.wipeSince),this.startRosterTimer()):(this.updateRosterDuration(),this.wipeSince=null,this.progress.roster.wipeSince=null,this.clearRosterTimer())}updateBankruptcyDuration(){if(this.bankruptSince===null)return;const a=this.timeSource()-this.bankruptSince;a>this.progress.economy.bankruptDurationMs&&(this.progress.economy.bankruptDurationMs=a)}updateRosterDuration(){if(this.wipeSince===null)return;const a=this.timeSource()-this.wipeSince;a>this.progress.roster.wipeDurationMs&&(this.progress.roster.wipeDurationMs=a)}evaluateResolution(){if(!this.resolution){if(this.progress.sauna.destroyed){this.resolve("lose","saunaDestroyed");return}if(this.progress.strongholds.total>0&&this.progress.strongholds.remaining===0){this.resolve("win","strongholds");return}if(this.wipeSince!==null&&this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.bankruptSince!==null&&this.bankruptcyGraceMs<=0&&this.resolve("lose","bankruptcy")}}resolve(a,s){if(this.resolution)return;this.updateRosterDuration(),this.updateBankruptcyDuration();const r=this.timeSource(),l=Math.max(0,r-this.progress.startedAt),u=Vb({...this.progress,roster:{...this.progress.roster,wipeSince:this.wipeSince},economy:{...this.progress.economy,bankruptSince:this.bankruptSince},sauna:{...this.progress.sauna,destroyedAt:this.saunaDestroyedAt}}),f=this.computeRewards();this.resolution=Object.freeze({outcome:a,cause:s,timestamp:r,durationMs:l,summary:u,rewards:f}),this.emitResolution(),this.dispose()}emitProgress(){const a=this.getProgress();for(const s of this.progressListeners)try{s(a)}catch(r){console.error("Objective progress listener failed",r)}}emitResolution(){if(!this.resolution)return;const a=this.resolution;for(const s of this.resolutionListeners)try{s(a)}catch(r){console.error("Objective resolution listener failed",r)}this.resolutionListeners.clear()}computeRewards(){const a=$b(this.state);return{resources:{[oe.SAUNA_BEER]:{final:a[oe.SAUNA_BEER],delta:a[oe.SAUNA_BEER]-this.startResources[oe.SAUNA_BEER]},[oe.SAUNAKUNNIA]:{final:a[oe.SAUNAKUNNIA],delta:a[oe.SAUNAKUNNIA]-this.startResources[oe.SAUNAKUNNIA]},[oe.SISU]:{final:a[oe.SISU],delta:a[oe.SISU]-this.startResources[oe.SISU]}}}}coordKey(a){return`${a.q},${a.r}`}isStronghold(a){return a?this.strongholdTypes.has(a):!1}createSaunaProgress(){if(!this.sauna)return{maxHealth:0,health:0,destroyed:!1,destroyedAt:null};const a=Math.max(0,Math.round(this.sauna.maxHealth??0)),s=Math.max(0,Math.round(this.sauna.health??0)),r=!!this.sauna.destroyed||s<=0;return r&&this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),{maxHealth:a,health:s,destroyed:r,destroyedAt:r?this.saunaDestroyedAt:null}}updateSaunaSnapshot(a){const s=Number.isFinite(a)?Math.max(0,Math.round(a)):0,r=this.sauna?Math.max(0,Math.round(this.sauna.maxHealth??0)):0,l=this.progress.sauna.maxHealth,u=Math.max(l,r,s);this.progress.sauna.maxHealth=u;const f=Math.max(0,Math.min(u,s));this.progress.sauna.health=f,f>0&&(this.progress.sauna.destroyed=!1,this.progress.sauna.destroyedAt=null,this.saunaDestroyedAt=null)}markSaunaDestroyed(){if(this.sauna){const a=Math.max(0,Math.round(this.sauna.maxHealth??0));a>this.progress.sauna.maxHealth&&(this.progress.sauna.maxHealth=a)}this.progress.sauna.health=0,this.progress.sauna.destroyed=!0,this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),this.progress.sauna.destroyedAt=this.saunaDestroyedAt}}function M5(t){return new S5(t)}const Dn=[{level:1,xpToNext:180,cumulativeXp:0,statAwards:{vigor:0,focus:0,resolve:0}},{level:2,xpToNext:220,cumulativeXp:180,statAwards:{vigor:5,focus:2,resolve:1}},{level:3,xpToNext:260,cumulativeXp:400,statAwards:{vigor:4,focus:3,resolve:1}},{level:4,xpToNext:320,cumulativeXp:660,statAwards:{vigor:4,focus:2,resolve:2}},{level:5,xpToNext:380,cumulativeXp:980,statAwards:{vigor:6,focus:3,resolve:2}},{level:6,xpToNext:460,cumulativeXp:1360,statAwards:{vigor:7,focus:3,resolve:3}},{level:7,xpToNext:540,cumulativeXp:1820,statAwards:{vigor:6,focus:4,resolve:3}},{level:8,xpToNext:640,cumulativeXp:2360,statAwards:{vigor:7,focus:4,resolve:4}},{level:9,xpToNext:760,cumulativeXp:3e3,statAwards:{vigor:8,focus:5,resolve:4}},{level:10,xpToNext:900,cumulativeXp:3760,statAwards:{vigor:9,focus:6,resolve:5}},{level:11,xpToNext:1060,cumulativeXp:4660,statAwards:{vigor:10,focus:6,resolve:6}},{level:12,xpToNext:null,cumulativeXp:5720,statAwards:{vigor:12,focus:7,resolve:6}}];function E5(t){return Number.isNaN(t)||!Number.isFinite(t)?0:Math.max(0,Math.floor(t))}function Gh(){return{vigor:0,focus:0,resolve:0}}function x5(t){return{vigor:t.vigor,focus:t.focus,resolve:t.resolve}}function nu(t){const a=E5(t);let s=Dn[0];for(const f of Dn)if(a>=f.cumulativeXp)s=f;else break;const r=a-s.cumulativeXp,l=s.xpToNext,u=l?Math.min(1,r/l):1;return{level:s.level,xpIntoLevel:r,xpForNext:l,progressToNext:u,statAwards:s.statAwards}}function A5(t){const a=Dn[Dn.length-1].level,s=Math.max(Dn[0].level,Math.min(t,a)),r=Dn.find(l=>l.level===s);return r?x5(r.statAwards):Gh()}function w5(t){if(t<=Dn[0].level)return Gh();const a=Dn[Dn.length-1].level,s=Math.min(t,a),r=Gh();for(const l of Dn){if(l.level>s)break;l.level!==Dn[0].level&&(r.vigor+=l.statAwards.vigor,r.focus+=l.statAwards.focus,r.resolve+=l.statAwards.resolve)}return r}function C5(t){return nu(t).level}const Cv="progression:sauna-shop";function Tv(){try{return globalThis.localStorage??null}catch{return null}}function T5(t){if(!t||typeof t!="object")return{version:1,tiers:[]};const a=Array.isArray(t.tiers)?t.tiers.filter(Boolean):[];return{version:1,tiers:Array.from(new Set(a))}}function _5(){const t=Tv();if(!t)return{version:1,tiers:[]};try{const a=t.getItem(Cv);if(!a)return{version:1,tiers:[]};const s=JSON.parse(a);return T5(s)}catch(a){return console.warn("Failed to parse sauna shop state",a),{version:1,tiers:[]}}}function N5(t){const a=Tv();if(a)try{a.setItem(Cv,JSON.stringify(t))}catch(s){console.warn("Failed to persist sauna shop state",s)}}let Dt=new Set(_5().tiers);const Yh=new Set;function Fh(t){const a=new Set(Dt);for(const s of Yh)try{s({...t,purchased:a})}catch(r){console.warn("Sauna shop listener failure",r)}}function R5(t){return Yh.add(t),()=>Yh.delete(t)}function gi(){return new Set(Dt)}function Vh(t){Dt=new Set(t),N5({version:1,tiers:Array.from(Dt)})}function k5(t){const a=as();if(!t||typeof t!="object")return{success:!1,balance:a,purchased:gi(),reason:"unsupported"};if(t.unlock.type!=="artocoin")return Dt.has(t.id)||(Dt.add(t.id),Vh(Dt),Fh({type:"grant",tierId:t.id,purchased:Dt,cost:0})),{success:!0,balance:a,purchased:gi()};if(Dt.has(t.id))return{success:!1,balance:a,purchased:gi(),reason:"already-owned"};const s=Math.max(0,Math.floor(t.unlock.cost)),r=d3(s,{reason:"purchase",metadata:{tierId:t.id,type:"sauna-tier"}});return r.success?(Dt.add(t.id),Vh(Dt),Fh({type:"purchase",tierId:t.id,purchased:Dt,spendResult:r,cost:s}),{success:!0,balance:r.balance,purchased:gi()}):{success:!1,balance:r.balance,purchased:gi(),shortfall:r.shortfall,reason:"insufficient-funds"}}function Nm(t){return Dt.has(t)||(Dt.add(t),Vh(Dt),Fh({type:"grant",tierId:t,purchased:Dt,cost:0})),gi()}function dh(t){return Number.isFinite(t)?Math.max(0,Math.floor(t)):0}function _c(t,a){return a<=0?"":`${t}/${a}`}function L5(t){let a=0;const s=Math.max(0,dh(t.queueCapacity??2)),r=(f,h)=>{f&&typeof t.log=="function"&&t.log({type:"system",message:f,metadata:{context:"spawn-queue",...h}})},l=()=>{const f=t.getTier();if(!f)return null;const h=dh(t.getRosterLimit()),m=dh(t.getRosterCount());return{tierId:f.id,tierName:f.name,rosterLimit:h,rosterCount:m,queued:a}};return{getSnapshot:()=>l(),hasQueuedSpawn:()=>a>0,takeQueuedSpawn:f=>a<=0?!1:(a-=1,a<=0?r(`The benches of ${f.tierName} exhale — queued attendants take the field.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} deploys a queued attendant. Relief teams remaining: ${_c(a,s)}.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0),restoreQueuedSpawn:f=>{s>0&&a>=s||(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} keeps the relief attendant on standby (${_c(a,s)} ready).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},queueBlockedSpawn:(f,h)=>s>0&&a>=s?(r(`${f.tierName} cannot hold more relief attendants — clear a slot to vent the pressure.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!1):h()?(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} queues a ready attendant in the wings (${_c(a,s)} poised).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0):!1,onSpawnResolved:(f,h)=>{h.usedQueue&&(a>0?r(`${f.tierName} still has relief attendants waiting (${_c(a,s)}).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} has cleared the relief queue.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},clearQueue:f=>{if(!(a<=0)&&(a=0,f==="tier-change")){const h=t.getTier();h&&r(`${h.name} ushers its queued attendants into the new hall.`,{tierId:h.id,tierName:h.name,queue:a,capacity:s})}}}}const _v="autobattles:saunojas";function Nv(){try{return globalThis.localStorage??null}catch{return null}}function D5(){const t=Nv();if(!t)return[];try{const a=t.getItem(_v);if(!a)return[];const s=JSON.parse(a);if(!Array.isArray(s))return[];const r=[];for(const l of s){if(!l||typeof l!="object")continue;const u=l,f=u.id;if(typeof f!="string"||f.length===0)continue;const h=u.coord,m=h&&typeof h=="object"&&typeof h.q=="number"&&Number.isFinite(h.q)&&typeof h.r=="number"&&Number.isFinite(h.r)?{q:h.q,r:h.r}:void 0,p=u.traits,g=Array.isArray(p)?p.filter(M=>typeof M=="string"):void 0,b=typeof u.upkeep=="number"?u.upkeep:void 0,v=typeof u.xp=="number"?u.xp:void 0;r.push(ym({id:f,name:typeof u.name=="string"?u.name:void 0,coord:m,maxHp:typeof u.maxHp=="number"?u.maxHp:void 0,hp:typeof u.hp=="number"?u.hp:void 0,steam:typeof u.steam=="number"?u.steam:void 0,traits:g,upkeep:b,xp:v,selected:!!u.selected,items:Array.isArray(u.items)?u.items:void 0,baseStats:u.baseStats,effectiveStats:u.effectiveStats,equipment:u.equipment,modifiers:Array.isArray(u.modifiers)?u.modifiers:void 0}))}return r}catch(a){return console.warn("Failed to load Saunoja units from storage",a),[]}}function I5(t){const a=Nv();if(a)try{const s=t.map(r=>({id:r.id,name:r.name,coord:{q:r.coord.q,r:r.coord.r},maxHp:r.maxHp,hp:r.hp,steam:r.steam,traits:[...r.traits],upkeep:r.upkeep,xp:r.xp,selected:r.selected,baseStats:{health:r.baseStats.health,attackDamage:r.baseStats.attackDamage,attackRange:r.baseStats.attackRange,movementRange:r.baseStats.movementRange,...typeof r.baseStats.defense=="number"&&Number.isFinite(r.baseStats.defense)?{defense:r.baseStats.defense}:{},...typeof r.baseStats.shield=="number"&&Number.isFinite(r.baseStats.shield)?{shield:r.baseStats.shield}:{},...typeof r.baseStats.visionRange=="number"&&Number.isFinite(r.baseStats.visionRange)?{visionRange:r.baseStats.visionRange}:{}},effectiveStats:{health:r.effectiveStats.health,attackDamage:r.effectiveStats.attackDamage,attackRange:r.effectiveStats.attackRange,movementRange:r.effectiveStats.movementRange,...typeof r.effectiveStats.defense=="number"&&Number.isFinite(r.effectiveStats.defense)?{defense:r.effectiveStats.defense}:{},...typeof r.effectiveStats.shield=="number"&&Number.isFinite(r.effectiveStats.shield)?{shield:r.effectiveStats.shield}:{},...typeof r.effectiveStats.visionRange=="number"&&Number.isFinite(r.effectiveStats.visionRange)?{visionRange:r.effectiveStats.visionRange}:{}},equipment:or.reduce((l,u)=>{const f=r.equipment?.[u]??null;return l[u]=f?{id:f.id,name:f.name,description:f.description,icon:f.icon,rarity:f.rarity,quantity:f.quantity,slot:f.slot}:null,l},{}),items:r.items.map(l=>({id:l.id,name:l.name,description:l.description,icon:l.icon,rarity:l.rarity,quantity:l.quantity})),modifiers:r.modifiers.map(l=>({id:l.id,name:l.name,description:l.description,remaining:l.remaining,duration:l.duration,appliedAt:l.appliedAt,stacks:l.stacks,source:l.source}))}));a.setItem(_v,JSON.stringify(s))}catch(s){console.warn("Failed to persist Saunoja units",s)}}const Rv="autobattles:sauna-settings";function kv(){try{return globalThis.localStorage??null}catch{return null}}function U5(t){return typeof t=="string"?xn(t).id:ur}function Xb(t){return Number.isFinite(t)?Math.max(0,Math.floor(t)):0}function Rm(t,a){const s=Xb(t),r=Xb(a),l=1+tm;return Math.max(0,Math.min(l,s,r))}function Lv(t,a,s){const r=Rm(s,s),l=typeof t=="number"&&Number.isFinite(t)?t:a,u=Math.max(0,Math.floor(l));return Math.max(0,Math.min(r,u))}function Dv(t){return t===!0||t==="true"}function vo(t,a){const s=U5(t?.activeTierId),r=xn(s),l=Rm(r.rosterCap,a);return{activeTierId:r.id,maxRosterSize:Lv(t?.maxRosterSize,l,l),useUiV2:Dv(t?.useUiV2)}}function Iv(t=1+tm){const a=kv();if(!a)return vo(null,t);try{const s=a.getItem(Rv);if(!s)return vo(null,t);const r=JSON.parse(s);return vo(!r||typeof r!="object"?null:r,t)}catch(s){return console.warn("Failed to load sauna settings from storage",s),vo(null,t)}}function Uv(t){const a=kv();if(!a)return;const s=xn(t.activeTierId),r=Rm(s.rosterCap,s.rosterCap),l={activeTierId:s.id,maxRosterSize:Lv(t.maxRosterSize,r,r),useUiV2:Dv(t.useUiV2)};try{a.setItem(Rv,JSON.stringify(l))}catch(u){console.warn("Failed to persist sauna settings",u)}}const O5=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),z5=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Ov(t){return Number.isFinite(t)?Math.max(0,Math.min(100,Math.round(t*100))):0}function B5(t){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});if(t.xpForNext===null)return`${a.format(t.xp)} XP • Max level`;const s=Ov(t.progress);return`${a.format(t.xpIntoLevel)} / ${a.format(t.xpForNext)} XP • ${s}%`}function q5(t){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),s=[];return t.vigor>0&&s.push(`+${a.format(t.vigor)} Vigor`),t.focus>0&&s.push(`+${a.format(t.focus)} Focus`),t.resolve>0&&s.push(`+${a.format(t.resolve)} Resolve`),s.length>0?s.join(" • "):"No level bonuses yet"}function H5(t,a){const{rosterIcon:s,summaryLabel:r="Saunoja Roster"}=a;t.classList.add("sauna-roster"),t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("title","Active sauna battalion on the field"),t.dataset.tutorialTarget="upkeep",t.replaceChildren();const l=document.createElement("div");l.classList.add("sauna-roster__summary");const u=document.createElement("img");u.src=s,u.alt="Saunoja roster crest",u.decoding="async",u.classList.add("sauna-roster__icon");const f=document.createElement("div");f.classList.add("sauna-roster__text");const h=document.createElement("span");h.textContent=r,h.classList.add("sauna-roster__label");const m=document.createElement("span");m.textContent="0",m.classList.add("sauna-roster__value"),f.append(h,m),l.append(u,f);const p=document.createElement("div");p.classList.add("saunoja-card"),p.setAttribute("aria-live","polite"),p.hidden=!0;const g=document.createElement("div");g.classList.add("saunoja-card__header");const b=document.createElement("div");b.classList.add("saunoja-card__level"),b.setAttribute("role","img"),b.style.setProperty("--level-progress","0%");const v=document.createElement("span");v.classList.add("saunoja-card__level-value"),v.textContent="1",b.appendChild(v);const M=document.createElement("div");M.classList.add("saunoja-card__identity");const x=document.createElement("h3");x.classList.add("saunoja-card__name"),x.textContent="Saunoja";const T=document.createElement("div");T.classList.add("saunoja-card__xp"),T.textContent="0 / 0 XP • 0%",M.append(x,T),g.append(b,M);const _=document.createElement("p");_.classList.add("saunoja-card__traits");const R=document.createElement("div");R.classList.add("saunoja-card__callouts"),R.textContent="No level bonuses yet";const I=document.createElement("p");I.classList.add("saunoja-card__upkeep"),p.append(g,_,R,I),t.append(l,p);let j=null,V=null;function X(C){if(!C){p.hidden=!0;return}p.hidden=!1,p.dataset.unitId=C.id,x.textContent=C.name||"Saunoja";const J=C.traits.filter(E=>E.length>0),q=J.length>0?J.join(", "):"No notable traits yet";_.textContent=q,_.title=q;const ae=B5(C.progression);T.textContent=ae,T.title=ae;const F=Ov(C.progression.progress);b.style.setProperty("--level-progress",`${F}%`),v.textContent=String(C.progression.level);const D=C.progression.xpForNext===null?`Level ${C.progression.level}, at mastery`:`Level ${C.progression.level}, ${F}% toward next level`;b.setAttribute("aria-label",D);const P=q5(C.progression.statBonuses);R.textContent=P,R.title=P;const le=Math.max(0,Math.round(C.upkeep)),ne=`Upkeep: ${z5.format(le)} Beer`;I.textContent=ne,I.title=ne}function $(C){return C===1/0?"inf":!Number.isFinite(C)||C<=0?"0":String(Math.ceil(C))}function ee(C){return[C.id,C.name,C.icon??"",C.rarity??"",C.description??"",C.quantity].join("^")}function te(C){return[C.id,C.name,C.description??"",$(C.duration),$(C.remaining),C.appliedAt??"",C.stacks??1,C.source??""].join("^")}function Y(C){const{stats:J}=C,q=C.traits.join("|"),ae=C.items.map(ee).join("|"),F=C.modifiers.map(te).join("|");return[C.id,C.name,C.upkeep,C.status,C.selected?1:0,C.progression.level,C.progression.xp,C.progression.xpIntoLevel,C.progression.xpForNext??"max",J.health,J.maxHealth,J.attackDamage,J.attackRange,J.movementRange,J.defense??0,J.shield??0,q,ae,F].join("~")}function B(C){return`${C.length}:${C.map(Y).join("||")}`}return{updateSummary(C){const J=Math.max(0,Math.floor(C.count)),q=O5.format(J);m.textContent=q,t.setAttribute("aria-label",`Saunoja roster: ${q} active attendants`),t.setAttribute("title",`Saunoja roster • ${q} active attendants`),X(C.card)},installRenderer(C){V=null,j=C},renderRoster(C){if(!j)return;const J=B(C);J!==V&&(V=J,j(C))},destroy(){j=null,V=null,t.replaceChildren()}}}const j5={[oe.SAUNA_BEER]:"Sauna Beer",[oe.SAUNAKUNNIA]:"Saunakunnia",[oe.SISU]:"Sisu"},G5=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Y5='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function F5(t){if(!Number.isFinite(t)||t<=0)return"0:00";const a=Math.round(t/1e3),s=Math.max(0,a%60).toString().padStart(2,"0"),r=Math.floor(a/60),l=(r%60).toString().padStart(2,"0"),u=Math.floor(r/60);return u>0?`${u}:${l}:${s}`:`${r}:${s}`}function V5(t){switch(t.cause){case"strongholds":return"All rival strongholds have fallen.";case"rosterWipe":return"Every attendant is down—no one remains to hold the line.";case"bankruptcy":return"Upkeep debts have exhausted the steam reserves.";case"saunaDestroyed":return"The sauna collapsed under relentless assault—the sacred steamline has fallen silent.";default:return""}}function $5(t){if(!Number.isFinite(t)||t===0)return"±0";const a=Math.round(t*100)/100;return`${a>0?"+":""}${a}`}function X5(t,a){const s=document.createElement("ul");s.className="end-screen__rewards-list";for(const r of Object.values(oe)){const l=t.rewards.resources[r];if(!l)continue;const u=document.createElement("li");u.className="end-screen__reward-item";const f=document.createElement("span");f.className="end-screen__reward-label",f.textContent=a[r]??r;const h=document.createElement("span");h.className="end-screen__reward-value",h.textContent=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(l.final));const m=document.createElement("span");m.className="end-screen__reward-delta",m.textContent=$5(l.delta),m.dataset.polarity=l.delta>=0?"positive":"negative",u.append(f,h,m),s.append(u)}return s}function Q5(t,a,s){const r=l=>{if(l.key==="Escape"){l.preventDefault(),s?.();return}if(l.key!=="Tab")return;const u=a.querySelectorAll(Y5);if(u.length===0){l.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;l.shiftKey?(m===f||!a.contains(m))&&(l.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(l.preventDefault(),f.focus())};return t.addEventListener("keydown",r),()=>t.removeEventListener("keydown",r)}function K5(t){const{container:a,resolution:s,onNewRun:r,onDismiss:l}=t;if(!a)return{destroy(){},focusPrimary(){}};const u={...j5,...t.resourceLabels??{}},f=document.createElement("div");f.className="end-screen",f.setAttribute("role","presentation");const h=document.createElement("section");h.className="end-screen__panel",h.setAttribute("role","dialog"),h.setAttribute("aria-modal","true");const m=`end-screen-title-${Date.now()}`;h.setAttribute("aria-labelledby",m),h.tabIndex=-1,h.dataset.outcome=s.outcome;const p=document.createElement("h2");p.className="end-screen__title",p.id=m,p.textContent=s.outcome==="win"?"Steamforged Victory":"Sauna Lost";const g=document.createElement("p");g.className="end-screen__subtitle",g.textContent=V5(s);const b=document.createElement("dl");b.className="end-screen__metrics";const v=(B,C)=>{const J=document.createElement("dt");J.textContent=B,J.className="end-screen__metric-label";const q=document.createElement("dd");q.textContent=C,q.className="end-screen__metric-value",b.append(J,q)};v("Run time",F5(s.durationMs)),v("Strongholds",`${s.summary.strongholds.destroyed}/${s.summary.strongholds.total}`),v("Roster losses",`${s.summary.roster.totalDeaths}`),v("Deepest beer reserve",`${Math.round(s.summary.economy.worstBeer)}`);const M=t.artocoinSummary??{balance:0,earned:0,spent:0},x=document.createElement("section");x.className="end-screen__artocoin";const T=document.createElement("h3");T.className="end-screen__section-title",T.textContent="Artocoin ledger";const _=document.createElement("dl");_.className="end-screen__artocoin-ledger";const R=(B,C,J)=>{const q=document.createElement("dt");q.className="end-screen__artocoin-label",q.textContent=B;const ae=document.createElement("dd");ae.className="end-screen__artocoin-value",ae.dataset.polarity=J,ae.textContent=G5.format(Math.max(0,Math.floor(Number.isFinite(C)?C:0))),_.append(q,ae)};R("Earned",M.earned,M.earned>0?"positive":"neutral"),R("Spent",M.spent,M.spent>0?"negative":"neutral"),R("Balance",M.balance,"neutral"),x.append(T,_);const I=document.createElement("h3");I.className="end-screen__section-title",I.textContent="Rewards";const j=X5(s,u),V=document.createElement("div");V.className="end-screen__actions";const X=document.createElement("button");X.type="button",X.className="end-screen__button end-screen__button--primary",X.textContent="New run",X.addEventListener("click",()=>{r()});const $=document.createElement("button");$.type="button",$.className="end-screen__button",$.textContent="Review battlefield",$.addEventListener("click",()=>{l?.()}),V.append(X,$),h.append(p,g,b,x,I,j,V),f.append(h),a.append(f);const ee=Q5(f,h,l),te=()=>{ee(),f.remove()},Y=()=>{requestAnimationFrame(()=>{X.focus({preventScroll:!0})})};return Y(),{destroy:te,focusPrimary:Y}}const zv="autobattles4x.flags";function Bv(){if(typeof window>"u")return null;try{if("localStorage"in window&&window.localStorage)return window.localStorage}catch(t){console.warn("Unable to access localStorage for local flags",t)}return null}function qv(){const t=Bv();if(!t)return{};try{const a=t.getItem(zv);if(!a)return{};const s=JSON.parse(a);if(s&&typeof s=="object")return s}catch(a){console.warn("Failed to parse local flags, resetting.",a)}return{}}function P5(t){const a=Bv();if(a)try{const s={};t.tutorial_done&&(s.tutorial_done=!0),a.setItem(zv,JSON.stringify(s))}catch(s){console.warn("Failed to persist local flags",s)}}function Z5(){return qv().tutorial_done===!0}function Qb(t){const a={...qv()};a.tutorial_done=!0,P5(a)}const fh=200,hh=3,J5=2,Kb=6,W5=40,e_=250,t_=200,n_=C5(Number.MAX_SAFE_INTEGER),$h={[oe.SAUNA_BEER]:"Sauna Beer",[oe.SAUNAKUNNIA]:"Saunakunnia",[oe.SISU]:"Sisu"};let ts=as(),ss=new Set(gi()),km=0;const Xh=new Set;function Hv(){Xh.forEach(t=>{try{t()}catch(a){console.warn("Sauna shop listener failure",a)}})}function jv(t,a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;if(!Number.isFinite(t))return s;const r=Math.max(0,Math.floor(t));return Math.max(0,Math.min(s,r))}const Gv=.1,a_=3,i_=1;let ia=Ra(NM()),Yv=qc(ia.runSeed,1),Fv=qc(ia.runSeed,2),vu=null;function au(t){ia=Ra(t),Yv=qc(ia.runSeed,1),Fv=qc(ia.runSeed,2),vu?.({persist:!0})}au(ia);let iu=null,je=[];const sa=new Map,yi=new Map,rs=new Map;let Pb=0,su=null,ea=null,Oa=null,ar=null,un=null,ir=null,Tt=null,Ji=null,ko=null,Da=null,bi=null,Wi=!1,Mn=null,vi=null,Pn=null,Lo=null,ru=!1,Qi=0;function Lm(t){const a=yi.get(t.id);return a?rs.get(a)??null:null}function Vv(t,a){t.effectiveStats={...a},t.maxHp=Math.max(1,Math.round(a.health)),t.hp=Math.min(t.maxHp,Math.max(0,Math.round(t.hp))),t.defense=typeof a.defense=="number"?Math.max(0,a.defense):void 0,t.shield=typeof a.shield=="number"?Math.max(0,a.shield):0;const s=Lm(t);if(s){const r={health:t.effectiveStats.health,attackDamage:t.effectiveStats.attackDamage,attackRange:t.effectiveStats.attackRange,movementRange:t.effectiveStats.movementRange};typeof t.effectiveStats.defense=="number"&&(r.defense=t.effectiveStats.defense),typeof t.effectiveStats.visionRange=="number"&&(r.visionRange=t.effectiveStats.visionRange),s.updateStats(r),typeof t.effectiveStats.shield=="number"?s.setShield(t.effectiveStats.shield):t.shield<=0&&s.setShield(0)}}function Su(t,a){const s=a??In(t.equipment),r=Fc(t.baseStats,s);return Vv(t,r),r}function $v(t){const a=nu(t.xp);return{level:a.level,xp:Math.max(0,Math.floor(t.xp)),xpIntoLevel:a.xpIntoLevel,xpForNext:a.xpForNext,progress:a.progressToNext,statBonuses:w5(a.level)}}function s_(t){const a=[];return t.vigor>0&&a.push(`+${t.vigor} Vigor`),t.focus>0&&a.push(`+${t.focus} Focus`),t.resolve>0&&a.push(`+${t.resolve} Resolve`),a.length>0?a.join(", "):"+0 Vigor, +0 Focus, +0 Resolve"}function Xv(t,a,s){if(!Number.isFinite(a)||a<=0)return null;const r=nu(t.xp),l=Math.max(0,Math.floor(t.xp+a));if(l===t.xp)return null;t.xp=l;const u=nu(t.xp),f=Math.max(0,u.level-r.level),h={vigor:0,focus:0,resolve:0};let m=0;if(f>0){for(let g=r.level+1;g<=u.level&&g<=n_;g++){const b=A5(g);h.vigor+=b.vigor,h.focus+=b.focus,h.resolve+=b.resolve;const v=Number.isFinite(t.baseStats.health)?t.baseStats.health:t.effectiveStats.health;t.baseStats.health=Math.max(1,Math.round(v+b.vigor));const M=Number.isFinite(t.baseStats.attackDamage)?t.baseStats.attackDamage:t.effectiveStats.attackDamage;t.baseStats.attackDamage=Math.max(0,Math.round(M+b.focus));const T=(Number.isFinite(t.baseStats.defense)?t.baseStats.defense??0:t.effectiveStats.defense??0)+b.resolve;t.baseStats.defense=T>0?T:void 0}m=h.vigor}m>0&&(t.hp+=m),Su(t);const p=Lm(t);if(p&&p.setExperience(t.xp),s.source==="kill"){const g=t.name?.trim()||"Our champion",b=s.label?.trim()||"their foe",v=s.boss?" Boss toppled!":s.elite?" Elite threat routed!":"";It({type:"combat",message:`${g} earns ${a} XP for defeating ${b}.${v}`,metadata:{slayer:g,foe:b,xpAward:a,boss:!!s.boss,elite:!!s.elite}})}if(f>0){const g=s_(h),b=t.name?.trim()||"Our champion";It({type:"progression",message:`${b} reaches Level ${u.level}! ${g}.`,metadata:{unit:b,level:u.level,levelsGained:f,bonuses:h}})}return{xpAwarded:a,totalXp:t.xp,level:u.level,levelsGained:f,statBonuses:h}}function r_(t,a,s){if(!t)return null;const r=sa.get(t.id);return r?Xv(r,a,s):null}function o_(t,a){if(!Number.isFinite(t)||t<=0)return!1;let s=!1;for(const r of je)Xv(r,t,a)&&(s=!0);return s}function l_(t){return t?(t.type?.toLowerCase?.()??"").includes("boss")?{xp:e_,elite:!0,boss:!0}:l1(t)?{xp:W5,elite:!0,boss:!1}:{xp:Kb,elite:!1,boss:!1}:{xp:Kb,elite:!1,boss:!1}}const Qv=t=>{if(!t)return;const a=Math.max(0,Math.floor(t.strongholds.destroyed));if(a>Qi){const s=a-Qi,r=t_*s;o_(r,{source:"objective",label:"stronghold"})&&(ra(),Yt(),It({type:"progression",message:`Strategists toast the captured stronghold — roster gains ${r} XP.`,metadata:{source:"stronghold",xpAward:r}}))}if(a<Qi){Qi=a;return}Qi=a},c_=Object.freeze(["health","attackDamage","attackRange","movementRange","defense","shield"]);function Zb(t){return t?{id:t.id,name:t.name,quantity:t.quantity,rarity:t.rarity}:null}function Jb(t,a){const s=t[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function u_(t,a){const s=[];for(const r of c_){const l=Jb(a,r),u=Jb(t,r),f=l-u;f!==0&&s.push({stat:r,delta:f})}return s}function d_(t,a){if(!a||In(t.equipment).length>0)return;const r={health:Math.max(1,Math.round(a.getMaxHealth())),attackDamage:Math.max(0,Math.round(a.stats.attackDamage)),attackRange:Math.max(0,Math.round(a.stats.attackRange)),movementRange:Math.max(0,Math.round(a.stats.movementRange)),defense:typeof a.stats.defense=="number"&&Number.isFinite(a.stats.defense)?Math.max(0,a.stats.defense):t.baseStats.defense,shield:t.baseStats.shield??0,visionRange:typeof a.stats.visionRange=="number"&&Number.isFinite(a.stats.visionRange)?Math.max(0,a.stats.visionRange):t.baseStats.visionRange};t.baseStats=r,Su(t)}function ou(){ru&&(pu(!1),ru=!1)}function xo(){if(!Lo){ou();return}Lo.destroy(),Lo=null,ou()}function f_(){if(Z5()){xo();return}xo(),wm()?ru=!1:(pu(!0),ru=!0),Lo=LA({onComplete:()=>{Qb(),ou(),xo()},onSkip:()=>{Qb(),ou(),xo()}}),Lo.start()}function Wb(t){ko=t,Tt&&(Tt.installRenderer(t),Da&&(Tt.renderRoster(Da),Da=null))}function h_(){return D5()}function ra(){I5(je)}function m_(t=Math.random){const a=typeof t=="function"?t:Math.random,s=Math.ceil(Math.min(Do,Ch)),r=Math.floor(Math.max(Do,Ch)),l=Math.max(1,r-s+1),u=Number(a()),f=Number.isFinite(u)?u:Math.random(),h=Math.min(Math.max(f,0),1),m=Math.min(Math.floor(h*l),l-1);return s+m}function p_(t){const s=(Array.isArray(t.traits)?t.traits:[]).length>=3,r=Number.isFinite(t.upkeep),l=Number.isFinite(t.xp);return!s||!r||!l}function Kv(t){t.traits=rC(),t.upkeep=m_(),t.xp=0}function g_(t,a,s,r={}){const l=r.hudVariant??"classic",u=l==="classic";s.dataset.hudVariant=l,iu=t,Mn&&(Mn.dispose(),Mn=null),Mn=Ww({canvas:t,overlay:s,mapRenderer:Dm,getUnitById:m=>rs.get(m),requestDraw:()=>{Ut()}}),Tt&&(Tt.destroy(),Tt=null),u?(Tt=H5(a,{rosterIcon:Zn.saunojaRoster}),ko&&Tt.installRenderer(ko),Da&&(Tt.renderRoster(Da),Da=null),Ji&&(Tt.updateSummary(Ji),Ji=null)):(ko=null,Da=null,Ji=null),un?.dispose(),un=null,u&&(un=r3(Oe,{getActiveTierId:()=>We,setActiveTierId:(m,p)=>{const g=T_(m,{persist:p?.persist});return g&&(un?.update(),Yt()),g},getTierContext:()=>Hm()})),Oa?.dispose(),Oa=null,ar?.destroy(),ar=null;const f={useSisuBurst:()=>{const m=k3(Xe,bt);return m?(na("sisu"),It({type:"ability",message:`Sisu bursts forth, spending ${Ki} grit to steel our attendants.`,metadata:{ability:"sisu-burst",cost:Ki}})):na("error"),m},torille:()=>{const m=D3(Xe,bt,Oe.pos,Gt);return m?It({type:"ability",message:`Torille! Our warriors regroup at the sauna to rally their spirits for ${Pi} SISU.`,metadata:{ability:"torille",cost:Pi}}):na("error"),m}};u&&(Oa=g3(Xe,{saunakunnia:Zn.resource,sisu:Zn.sisu,saunaBeer:Zn.saunaBeer,artocoin:Zn.artocoin})),ar=W3(Xe,s,f),ir?.destroy(),ir=null;const h=()=>({balance:ts,tiers:Mm().map(m=>({tier:m,status:ns(m,Um())}))});u&&(ir=XT(Oo,{getSelectedUnitId:()=>je.find(m=>m.selected)?.id??null,getComparisonContext:()=>k_(),onEquip:(m,p,g)=>Gm(m,p),getUseUiV2:w_,onUseUiV2Change:C_,getSaunaShopViewModel:()=>h(),onPurchaseSaunaTier:m=>k5(xn(m)),subscribeToSaunaShop:m=>(Xh.add(m),()=>Xh.delete(m))})),u?(L_(),Im(),Yt(),f_()):ea&&(ea(),ea=null)}const Gt=new zM(10,10,32),Pv=new Iw(()=>Ut()),y_=new sx(Gt,Pv),Dm=new Mw(Gt),lu=()=>{Dm.invalidateCache(),Ut()};re.on("buildingPlaced",lu);re.on("buildingRemoved",lu);Gt.forEachTile(t=>t.setFogged(!0));CM();const bt=[];function e2(t){return`${t.q},${t.r}`}function b_(){const t=new Set;for(const m of bt)m.isDead()||t.add(e2(m.coord));const a=[],{minQ:s,maxQ:r,minR:l,maxR:u}=Gt,f=m=>{const p=e2(m);t.has(p)||(Gt.ensureTile(m.q,m.r),a.push(m))};for(let m=s;m<=r;m++)f({q:m,r:l}),u!==l&&f({q:m,r:u});for(let m=l+1;m<=u-1;m++)f({q:s,r:m}),r!==s&&f({q:r,r:m});if(a.length===0)return;const h=Math.floor(Math.random()*a.length);return a[h]}function v_(t){const a=sa.get(t);a&&(sa.delete(t),yi.get(a.id)===t&&yi.delete(a.id))}function S_(t){const a=sa.get(t.id);if(a)return{saunoja:a,created:!1,attached:!1};let s=je.find(f=>f.id===t.id);s||(s=je.find(f=>!yi.has(f.id)));let r=!1;s||(s=ym({id:`saunoja-${je.length+1}`,coord:{q:t.coord.q,r:t.coord.r}}),je.push(s),r=!0);const l=yi.get(s.id);l&&l!==t.id&&sa.delete(l),sa.set(t.id,s),yi.set(s.id,t.id),d_(s,t),Vv(s,s.effectiveStats),t.setExperience(s.xp);const u=p_(s);return(r||u)&&Kv(s),{saunoja:s,created:r,attached:!0}}function Im(){let t=!1;for(const a of bt){if(a.faction!=="player"||a.isDead())continue;const{saunoja:s,created:r,attached:l}=S_(a);(r||l)&&(t=!0);const u=Number.isFinite(a.stats.health)?Math.max(0,a.stats.health):0;s.hp!==u&&(s.hp=u,t=!0);const f=Number.isFinite(a.getMaxHealth())?Math.max(1,a.getMaxHealth()):1;s.maxHp!==f&&(s.maxHp=f,t=!0);const h=a.getShield(),m=Number.isFinite(h)?Math.max(0,h):0;s.shield!==m&&(s.shield=m,t=!0);const g=a?.lastHitAt;Number.isFinite(g)&&s.lastHitAt!==g&&(s.lastHitAt=g,t=!0);const{q:b,r:v}=a.coord;(s.coord.q!==b||s.coord.r!==v)&&(s.coord={q:b,r:v},t=!0,s.selected&&jm(s.coord))}return t&&ra(),t}function Zv(t,a){if(t.faction==="player"){const u=(a??sa.get(t.id)??null)?.name?.trim();if(u)return u}return`${(t.constructor?.name??"Unit").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase()} ${t.id}`.trim()}function Mu(t){if(rs.has(t.id))return;bt.push(t),rs.set(t.id,t);let a=null;if(t.faction==="player"&&(Im()||Go(),a=sa.get(t.id)??null),iu&&Ut(),t.faction==="player"){const r=Zv(t,a);It({type:"spawn",message:`Our ${r} emerges from the steam.`,metadata:{unitId:t.id,unitName:r,steward:"Our"}}),Yt()}}const Jv=({unit:t})=>{Mu(t)};re.on("unitSpawned",Jv);const Wv=()=>{Go()},sr=()=>{Go()};re.on("inventoryChanged",Wv);re.on("modifierAdded",sr);re.on("modifierRemoved",sr);re.on("modifierExpired",sr);const e1=t=>{un?.handleDamage?.(t)},t1=t=>{un?.handleDestroyed?.(t)};re.on("saunaDamaged",e1);re.on("saunaDestroyed",t1);const n1=()=>{Yt()};re.on("unit:stats:changed",n1);function M_(t){const a=sa.get(t.id);if(!a)return 0;const s=Number.isFinite(a.upkeep)?a.upkeep:0;return s>0?s:0}const Xe=new LM(1e3),Oo=new fC;ts=as();ss=new Set(gi());km=0;const a1=Xe.load(Gt);if(a1){const t=Xe.getNgPlusState();au(t),bh(t)}else{const t=Xe.setNgPlusState(ia);au(t),bh(t)}Xe.setEnemyScalingBase({aggression:1,cadence:1,strength:1});const za=Iv();ia.unlockSlots>=2&&(ss=new Set(Nm("aurora-ward")));ia.ngPlusLevel>=3&&(ss=new Set(Nm("mythic-conclave")));za.activeTierId!==ur&&!ss.has(za.activeTierId)&&(ss=new Set(Nm(za.activeTierId)));const Um=()=>({artocoinBalance:ts,ownedTierIds:ss});let We=za.activeTierId,cr=za.useUiV2;const E_=ns(xn(We),Um());E_.unlocked||(We=ur);const i1=xn(We),Eu=()=>{const t=xn(We);return Math.max(0,Math.floor(t.rosterCap))},cu=jv(za.maxRosterSize,Eu());(cu!==za.maxRosterSize||za.activeTierId!==We||za.useUiV2!==cr)&&Uv({maxRosterSize:cu,activeTierId:We,useUiV2:cr});const Oe=nx({q:Math.floor(Gt.width/2),r:Math.floor(Gt.height/2)},void 0,{maxRosterSize:cu,tier:i1}),x_=t=>Math.max(0,Math.floor(Number.isFinite(t)?t:0)),Om=(t,a={})=>{const s=x_(t.visionRange);s!==Oe.visionRange&&(Oe.visionRange=s),a.reveal&&Gt.revealAround(Oe.pos,Oe.visionRange)};Om(i1);const A_=()=>Math.max(a_,Oe.maxRosterSize),w_=()=>cr,C_=t=>{const a=!!t;cr!==a&&qm(Oe.maxRosterSize,{useUiV2:a})},zm=L5({getTier:()=>xn(We),getRosterLimit:()=>Eu(),getRosterCount:()=>xu(),log:t=>It(t),queueCapacity:3});let s1=cu,Bm=We;const qm=(t,a)=>{typeof a?.useUiV2=="boolean"&&(cr=a.useUiV2),Uv({maxRosterSize:t,activeTierId:We,useUiV2:cr}),s1=t,Bm=We},Hm=()=>Um(),zo=(t,a={})=>{const s=Eu(),r=jv(t,s);return r!==Oe.maxRosterSize&&(Oe.maxRosterSize=r),a.persist&&(We!==Bm||r!==s1)&&qm(r),r};vu=(t={})=>{const a=Hm(),s=Mm();let r=ur;for(const f of s)if(ns(f,a).unlocked)r=f.id;else break;if(!ns(xn(We),a).unlocked||We!==r){const f=We;We=r;const h=xn(We);Om(h,{reveal:!0}),zm.clearQueue?.("tier-change"),zo(Oe.maxRosterSize,{persist:t.persist}),f!==We&&un?.update?.(),Yt();return}t.persist&&(zo(Oe.maxRosterSize,{persist:!0}),Yt())};vu({persist:!0});R5(t=>{ss=new Set(t.purchased),t.type==="purchase"&&t.cost&&t.spendResult?.success&&(km+=Math.max(0,Math.floor(t.cost))),Hv(),vu({persist:!0}),un?.update?.()});G2(t=>{ts=t.balance,Hv(),un?.update?.()});const T_=(t,a={})=>{const s=xn(t);return ns(s,Hm()).unlocked?s.id===We?(a.persist&&We!==Bm&&qm(Oe.maxRosterSize),!0):(We=s.id,Om(s,{reveal:!0}),zm.clearQueue?.("tier-change"),zo(Oe.maxRosterSize,{persist:a.persist}),!0):!1},__=t=>{Pb+=1;const a=`p${Date.now()}-${Pb}`,s=pm(Xe,"soldier",a,t,"player");return s&&Mu(s),s??null},Qh=new Kx({difficulty:i_,random:Yv,eliteOdds:Gv}),r1=new DM(1e3,t=>{const a=t/1e3;Xe.tick(),Ao.tick(a,{state:Xe});const s=Xe.getEnemyScalingSnapshot(),r=zo(Oe.maxRosterSize);cC({dt:a,state:Xe,sauna:Oe,heat:Oe.heatTracker,units:bt,getUnitUpkeep:M_,pickSpawnTile:()=>E2(Oe.pos,bt),spawnBaseUnit:__,minUpkeepReserve:Math.max(1,Do),maxSpawns:A_(),rosterCap:r,getRosterCount:xu,tierHelpers:zm});const l={aggressionMultiplier:s.aggression,cadenceMultiplier:s.cadence,strengthMultiplier:s.strength,calmSecondsRemaining:s.calmSecondsRemaining};Qh.update(a,bt,Mu,b_,l),Xe.advanceEnemyCalm(a);const u=Qh.getSnapshot(),f=Math.max(s.calmSecondsRemaining,u.calmSecondsRemaining);if(Oa){const m={stage:u.rampStageLabel,stageIndex:u.rampStageIndex,bundleTier:u.bundleTier,multiplier:u.difficultyMultiplier,cadenceSeconds:u.cadence,effectiveDifficulty:u.effectiveDifficulty,aggressionMultiplier:u.aggressionMultiplier,cadenceMultiplier:u.cadenceMultiplier,strengthMultiplier:u.strengthMultiplier,calmSecondsRemaining:f,spawnCycles:u.spawnCycles};Oa.setEnemyRampSummary(m)}const h=vi?.getProgress().roster;e3(u,{wipeSince:h?.wipeSince??null,wipeDurationMs:h?.wipeDurationMs??0}),y_.tick(bt,a,Oe),OE(a),Im()&&Yt(),Xe.save();for(const m of bt)m.isDead()||m.faction!=="player"||Gt.revealAround(m.coord,m.getVisionRange(),{autoFrame:!1});Ut()}),N_=t=>{Wi&&(Wi=!1),r1.stop(),bi!==null&&(cancelAnimationFrame(bi),bi=null),Ut();const a=document.getElementById("ui-overlay");if(!a)return;Pn&&(Pn.destroy(),Pn=null);const s=Qh.getSnapshot(),r=p3(t.outcome,{tierId:We,runSeconds:Math.max(0,t.durationMs/1e3),enemyKills:Math.max(0,t.summary.enemyKills),tilesExplored:Math.max(0,t.summary.exploration.revealedHexes),rosterLosses:Math.max(0,t.summary.roster.totalDeaths),difficultyScalar:s.effectiveDifficulty,rampStageIndex:s.rampStageIndex});r.artocoins>0&&(ts=u3(r.artocoins,{reason:"payout",metadata:{outcome:t.outcome,tier:We},previousBalance:ts}));const l=RM(ia,{outcome:t.outcome});bh(l),Xe.setNgPlusState(l),au(l),Pn=K5({container:a,resolution:t,artocoinSummary:{balance:ts,earned:r.artocoins,spent:km},resourceLabels:$h,onNewRun:()=>{try{typeof window<"u"&&window.localStorage?.removeItem?.("gameState")}catch(f){console.warn("Failed to reset saved game state for NG+",f)}typeof window<"u"&&typeof window.location?.reload=="function"&&window.setTimeout(()=>window.location.reload(),75)},onDismiss:()=>{Pn&&(Pn.destroy(),Pn=null)}})};je=h_();if(je.length===0){const t=ym({id:"saunoja-1",coord:Oe.pos,selected:!0,upkeep:Vc});Kv(t),t.upkeep=Vc,je.push(t),ra()}else{let t=!1,a=!1;for(const s of je)s.selected&&(t?(s.selected=!1,a=!0):t=!0);a&&ra()}const R_=bt.some(t=>t.faction==="player"&&!t.isDead());if(!R_){Xe.canAfford(Gy,oe.SAUNA_BEER)||Xe.addResource(oe.SAUNA_BEER,Gy);const t=`u${bt.length+1}`,a=pm(Xe,"soldier",t,Oe.pos,"player");a&&Mu(a)}Gt.revealAround(Oe.pos,Oe.visionRange);vi=M5({state:Xe,map:Gt,getRosterCount:xu,sauna:Oe,rosterWipeGraceMs:8e3,bankruptcyGraceMs:12e3});Qi=vi.getProgress().strongholds.destroyed;vi.onProgress(Qv);vi.onResolution(N_);function k_(){const t=je.find(a=>a.selected)??null;return t?{baseStats:{...t.baseStats},loadout:In(t.equipment),currentStats:{...t.effectiveStats}}:null}function L_(){ea&&(ea(),ea=null);const t=_A(Xe,{onRosterSelect:O_,onRosterRendererReady:Wb,onRosterEquipSlot:B_,onRosterUnequipSlot:q_,getRosterCap:()=>Math.max(0,Math.floor(Oe.maxRosterSize)),getRosterCapLimit:()=>Eu(),updateMaxRosterSize:(a,s)=>{const r=zo(a,{persist:s?.persist});return s?.persist&&Yt(),r}});t.addEvent,Wb(t.renderRoster),ea=t.dispose}function D_(){un?.update()}function t2(t){Oa?.update(t)}a1||(Xe.addResource(oe.SAUNA_BEER,fh),It({type:"resource",message:`Quartermaster stocks ${fh} bottles of ${$h[oe.SAUNA_BEER]} to launch your campaign.`,metadata:{resource:oe.SAUNA_BEER,amount:fh,context:"initial"}}),Xe.addResource(oe.SAUNAKUNNIA,hh),It({type:"resource",message:`Sauna elders honor your leadership with ${hh} ${$h[oe.SAUNAKUNNIA]} to celebrate your arrival.`,metadata:{resource:oe.SAUNAKUNNIA,amount:hh,context:"initial"}}));const mh=je.find(t=>t.selected);mh&&(su={q:mh.coord.q,r:mh.coord.r});function I_(t,a){return!t||!a?t===a:t.q===a.q&&t.r===a.r}function jm(t){return I_(su,t)?!1:(su=t?{q:t.q,r:t.r}:null,!0)}function o1(t){let a=!1;for(const s of je)t&&s===t||s.selected&&(s.selected=!1,a=!0);return a}function U_(){let t=!1;return o1()&&(t=!0),jm(null)&&(t=!0),t}function l1(t){if(!t)return!1;const a=mm(t.type);if(!a)return!1;const s=qo(a,1),r=t.stats;return r.health>s.health||r.attackDamage>s.attackDamage||r.attackRange>s.attackRange||r.movementRange>s.movementRange}function c1(t){let a=!1;return t.selected||(t.selected=!0,a=!0),o1(t)&&(a=!0),jm(t.coord)&&(a=!0),a}function O_(t){const a=je.find(s=>s.id===t);a&&c1(a)&&(ra(),Yt(),Ut())}function u1(t){const a=MM(t.x,t.y,Gt.hexSize),s=je.find(l=>l.coord.q===a.q&&l.coord.r===a.r);(s?c1(s):U_())&&(ra(),Yt(),Ut())}function Gm(t,a){const s=je.find(p=>p.id===t);if(!s)return{success:!1,reason:"unit-missing"};const r=In(s.equipment),l=Fc(s.baseStats,r),u=yx(s,a);if(!u.success)return{success:!1,reason:u.reason};const f=Su(s,u.loadout);re.emit("unit:stats:changed",{unitId:s.id,stats:f}),re.emit("inventoryChanged",{}),ra(),Yt();const h=r.find(p=>p.slot===u.slot)??null;return{success:!0,comparison:{slot:u.slot,previous:Zb(h),next:Zb(u.item??null),deltas:u_(l,f)}}}function z_(t,a){const s=je.find(b=>b.id===t);if(!s)return null;const r=bx(s,a);if(!r.success||!r.removed)return null;const l=Su(s,r.loadout);re.emit("unit:stats:changed",{unitId:s.id,stats:l}),re.emit("inventoryChanged",{}),ra(),Yt();const{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}=r.removed;return{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}}function B_(t,a){const r=Oo.getStash().findIndex(l=>vx(l.id,a));return r===-1?!1:Oo.equipFromStash(r,t,Gm)}function q_(t,a){return Oo.unequipToStash(t,a,z_)}function Ut(){if(!iu)return;const t=iu.getContext("2d"),a=wv();if(!t||!a)return;if(Mn){const m=typeof performance<"u"?performance.now():Date.now();Mn.step(m)}const s=Mn?.getShakeOffset()??{x:0,y:0},r=Mn?{getUnitAlpha:m=>Mn.getUnitAlpha(m.id)}:void 0,l=Array.isArray(je)&&je.length>0,u=bt.filter(m=>m.faction==="player"&&!m.isDead()),f=Oe?{coord:Oe.pos,range:Oe.visionRange}:null,h=l?bt.filter(m=>m.faction!=="player"):bt;t.save(),(s.x!==0||s.y!==0)&&t.translate(s.x,s.y),kw(t,Dm,a.images,h,su,{saunojas:{units:je,draw:nC,resolveRenderCoord:m=>{const p=Lm(m);return p?p.renderCoord??p.coord:null}},sauna:Oe,saunaVision:f,fx:r,friendlyVisionSources:u}),t.restore()}const d1=({policy:t})=>{It({type:"policy",message:`Sauna council toasts a fresh keg for policy: ${t.name}.`,metadata:{policy:t.id,name:t.name}})};re.on(jt.APPLIED,d1);const f1=({unitId:t,attackerId:a,attackerFaction:s,unitFaction:r})=>{const l=bt.findIndex(v=>v.id===t),u=l!==-1?bt[l]:null,f=u?{q:u.coord.q,r:u.coord.r}:null,h=r==="player"?sa.get(t)??null:null;let m=!1;if(r==="player"){const v=h??je.find(M=>yi.get(M.id)===t||M.id===t)??null;v&&(v.hp!==0&&(v.hp=0,m=!0),v.shield!==0&&(v.shield=0,m=!0))}const p=u?Zv(u,h):`unit ${t}`;let g=!1;if(s==="player"&&r&&r!=="player"){const v=a?rs.get(a)??null:null,{xp:M,elite:x,boss:T}=l_(u);M>0&&r_(v,M,{source:"kill",label:p,elite:x,boss:T})&&(g=!0)}if(l!==-1&&(u&&Pv.clear(u,{snap:!0}),bt.splice(l,1),rs.delete(t),v_(t),Ut()),(m||g)&&ra(),(r==="player"||g)&&Yt(),s==="player"&&r&&r!=="player"){const v=l1(u??null)||Fv()<Gv,M=r5({factionId:r,elite:v});if(M.rolls.length>0){const x=je.find(T=>T.selected)??null;for(const T of M.rolls)if(Oo.addLoot(T,{unitId:x?.id,sourceTableId:M.tableId,equip:Gm}).equipped){const R=x?.name??"our champion";It({type:"loot",message:`Quartermaster fastens ${T.item.name} to ${R}.`,metadata:{item:T.item.name,equipped:!0,owner:R,source:p}})}else It({type:"loot",message:`Quartermaster stores ${T.item.name} recovered from ${p}.`,metadata:{item:T.item.name,equipped:!1,source:p}})}}s==="player"&&r&&r!=="player"&&(Xe.addResource(oe.SAUNAKUNNIA,J5),Xe.addResource(oe.SISU,1),It({type:"resource",message:"Our grit surges — +1 SISU earned for the vanquished foe.",metadata:{resource:oe.SISU,amount:1,context:"victory"}})),f&&Gt.revealAround(f,1,{autoFrame:!1});const b=r==="player"?"our":"a rival";It({type:"combat",message:`The steam hushes as ${b} ${p} grows still.`,metadata:{side:b,unit:p}})};re.on("unitDied",f1);function Kh(){Wi=!1,vi?.offProgress(Qv),vi?.dispose(),vi=null,Qi=0,U3(),Pn&&(Pn.destroy(),Pn=null),bi!==null&&(cancelAnimationFrame(bi),bi=null);try{Xe.save()}catch(t){console.warn("Failed to persist game state during cleanup",t)}try{ra()}catch(t){console.warn("Failed to persist Saunoja roster during cleanup",t)}Mn&&(Mn.dispose(),Mn=null),re.off(jt.APPLIED,d1),re.off("unitDied",f1),re.off("unitSpawned",Jv),re.off("inventoryChanged",Wv),re.off("modifierAdded",sr),re.off("modifierRemoved",sr),re.off("modifierExpired",sr),re.off("unit:stats:changed",n1),re.off("saunaDamaged",e1),re.off("saunaDestroyed",t1),re.off("buildingPlaced",lu),re.off("buildingRemoved",lu),ea&&(ea(),ea=null),ir&&(ir.destroy(),ir=null),un&&(un.dispose(),un=null),Oa&&(Oa.dispose(),Oa=null),ar&&(ar.destroy(),ar=null),Tt&&(Tt.destroy(),Tt=null),Da=null,Ji=null,ko=null,xo()}async function H_(){if(Wi)return;if(!wv()){console.error("Cannot start game without loaded assets.");return}Wi=!0,Yt(),Ut();try{await Sv(()=>{Ut()}).then(()=>{Ut()})}catch(r){console.warn("Failed to preload Saunoja icon before starting the game",r)}let a=performance.now();function s(r){if(!Wi)return;const l=r-a;a=r;const u=wm();r1.tick(u?0:l),u?t2(0):(D_(),t2(l),Go()),Ut(),Wi&&(bi=requestAnimationFrame(s))}bi=requestAnimationFrame(s)}function xu(){let t=0;for(const a of bt)a.faction==="player"&&!a.isDead()&&(t+=1);return t}function j_(){const t={engaged:0,reserve:1,downed:2},a=je.map(s=>{const r=yi.get(s.id),l=r?rs.get(r):void 0,u=l?!l.isDead()&&l.stats.health>0:!1,f=s.effectiveStats,h=s.baseStats,m=Math.round(l?Math.max(0,l.stats.health):Math.max(0,s.hp)),p=Math.round(l?Math.max(1,l.getMaxHealth()):Math.max(1,f.health)),g=Math.round(l?Math.max(0,l.stats.attackDamage):Math.max(0,f.attackDamage)),b=Math.round(l?Math.max(0,l.stats.attackRange):Math.max(0,f.attackRange)),v=Math.round(l?Math.max(0,l.stats.movementRange):Math.max(0,f.movementRange)),M=l?.stats.defense??f.defense??0,x=Math.round(Math.max(0,M)),T=l?l.getShield():f.shield??s.shield,_=Math.round(Math.max(0,T)),R=Math.max(0,Math.round(s.upkeep)),I=m<=0?"downed":u?"engaged":"reserve",j=$v(s),V=s.items.map(te=>({...te})),X=s.modifiers.map(te=>({...te})),$=or.map(te=>{const Y=Ho(te),B=s.equipment[te],C=B?{id:B.id,name:B.name,description:B.description,icon:B.icon,rarity:B.rarity,quantity:B.quantity,slot:te}:null,J=B?Y_(B.modifiers,B.quantity):null;return{id:te,label:Y.label,description:Y.description,maxStacks:Y.maxStacks,item:C,modifiers:J}}),ee={health:Math.round(Math.max(0,h.health)),maxHealth:Math.round(Math.max(1,h.health)),attackDamage:Math.round(Math.max(0,h.attackDamage)),attackRange:Math.round(Math.max(0,h.attackRange)),movementRange:Math.round(Math.max(0,h.movementRange)),defense:typeof h.defense=="number"&&h.defense>0?Math.round(h.defense):void 0,shield:typeof h.shield=="number"&&h.shield>0?Math.round(h.shield):void 0};return{id:s.id,name:s.name,upkeep:R,status:I,selected:!!s.selected,traits:[...s.traits],stats:{health:m,maxHealth:p,attackDamage:g,attackRange:b,movementRange:v,defense:x>0?x:void 0,shield:_>0?_:void 0},baseStats:ee,progression:j,equipment:$,items:V,modifiers:X}});return a.sort((s,r)=>{const l=t[s.status]-t[r.status];return l!==0?l:s.name.localeCompare(r.name,"en")}),a}function G_(){return je.length===0?null:je.find(t=>t.selected)??je.find(t=>t.hp>0)??je[0]}function Y_(t,a){const s=Math.max(1,Math.round(a)),r={};return typeof t.health=="number"&&(r.health=t.health*s),typeof t.attackDamage=="number"&&(r.attackDamage=t.attackDamage*s),typeof t.attackRange=="number"&&(r.attackRange=t.attackRange*s),typeof t.movementRange=="number"&&(r.movementRange=t.movementRange*s),typeof t.defense=="number"&&(r.defense=t.defense*s),typeof t.shield=="number"&&(r.shield=t.shield*s),r}function F_(){const t=xu(),a=G_();let s=null;return a&&(s={id:a.id,name:a.name||"Saunoja",traits:[...a.traits],upkeep:Math.max(0,Math.round(a.upkeep)),progression:$v(a)}),{count:t,card:s}}function Go(t){const a=j_();Da=a,Tt&&Tt.renderRoster(a)}function Yt(){const t=F_();Tt?(Tt.updateSummary(t),Ji=null):Ji=t,Go()}function V_(t){const{overlay:a,resourceBar:s}=t,r=dr(a),{regions:l}=r,u=document.createElement("div");u.className="pointer-events-none absolute inset-0 grid place-items-center bg-[radial-gradient(circle_at_top,rgba(18,28,45,0.92),rgba(6,10,18,0.94))] p-[clamp(1.5rem,4vw,3.25rem)] z-overlay";const f=document.createElement("section");f.className="pointer-events-auto relative grid w-full max-w-[min(640px,90vw)] gap-4 overflow-hidden rounded-[28px] border border-[rgba(128,168,236,0.28)] bg-[linear-gradient(145deg,rgba(31,46,74,0.95),rgba(14,20,33,0.95))] p-[clamp(1.75rem,4vw,2.5rem)] text-slate-100 shadow-[0_40px_90px_rgba(10,14,28,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)]",f.setAttribute("aria-live","polite"),f.setAttribute("role","status");const h=document.createElement("h1");h.className="m-0 text-[clamp(1.6rem,3vw,2.1rem)] font-semibold uppercase tracking-[0.04em]",h.textContent="Experimental HUD Enabled",f.appendChild(h);const m=document.createElement("p");m.className="m-0 text-base leading-relaxed text-slate-100/90",m.textContent="The React/Tailwind interface is bootstrapped for this session. Gameplay systems continue to run, and classic HUD elements are paused while the new shell is under construction.",f.appendChild(m);const p=document.createElement("p");p.className="m-0 text-sm leading-relaxed text-slate-200/75",p.textContent="Toggle the experimental HUD off from the quartermaster settings to return to the classic layout.",f.appendChild(p);const g=document.createElement("div");g.className="pointer-events-none absolute -left-[30%] -top-[40%] h-[420px] w-[420px] bg-[radial-gradient(circle,rgba(90,164,255,0.35),rgba(90,164,255,0))] blur-[0.5px]",f.appendChild(g);const b=document.createElement("div");return b.className="mt-2 rounded-[18px] border border-[rgba(128,168,236,0.2)] bg-[rgba(10,16,26,0.55)] p-4 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]",b.appendChild(s),f.appendChild(b),u.appendChild(f),l.content.appendChild(u),{destroy(){b.contains(s)&&a.prepend(s),u.remove()}}}function h1(t){if(!t)return{showLoader:()=>({update:()=>{},clear:()=>{},dispose:()=>{}}),showBanner:()=>null,removeTransientUI:()=>{}};const a=()=>{let f=t.querySelector(".hud-banner-stack");return f||(f=document.createElement("div"),f.className="hud-banner-stack",t.append(f)),f},s=(f,h,m)=>{let p=!1;const g=()=>{p||(p=!0,f.removeEventListener("transitionend",g),m())};f.addEventListener("transitionend",g),requestAnimationFrame(()=>{f.classList.add(h)}),window.setTimeout(g,400)};return{showLoader:(f="Heating the sauna stones…")=>{const h=document.createElement("div");h.className="hud-loader",h.setAttribute("role","status"),h.setAttribute("aria-live","polite");const m=document.createElement("div");m.className="hud-loader__card";const p=document.createElement("div");p.className="hud-loader__spinner",p.setAttribute("aria-hidden","true");const g=document.createElement("p");g.className="hud-loader__message",g.textContent=f,m.append(p,g),h.append(m),t.append(h);let b=!1;return{update(v){g.textContent=v},clear(){b||s(h,"hud-loader--hidden",()=>{b=!0,h.remove()})},dispose(){b||(b=!0,h.remove())}}},showBanner:(f,h)=>{const m=a(),p=document.createElement("section");p.className=`hud-banner hud-banner--${f}`,p.setAttribute("role",f==="error"?"alert":"status"),p.setAttribute("aria-live",f==="error"?"assertive":"polite");const g=document.createElement("header");g.className="hud-banner__header";const b=document.createElement("p");b.className="hud-banner__title",b.textContent=h.title??(f==="error"?"Attention required":f==="warning"?"Heads up":"Status update"),g.append(b);const v=document.createElement("ul");v.className="hud-banner__list";for(const _ of h.messages){const R=document.createElement("li");R.textContent=_,v.append(R)}if(p.append(g),h.messages.length&&p.append(v),h.actions?.length){const _=document.createElement("div");_.className="hud-banner__actions";for(const R of h.actions){const I=document.createElement("button");I.type="button",I.className=R.variant==="secondary"?"hud-banner__button hud-banner__button--secondary":"hud-banner__button",I.textContent=R.label,I.addEventListener("click",()=>{R.onClick()}),_.append(I)}p.append(_)}let M,x=!1;const T=()=>{x||(x=!0,M&&window.clearTimeout(M),s(p,"hud-banner--hide",()=>{p.remove(),m.hasChildNodes()||m.remove()}))};if(h.dismissible!==!1){const _=document.createElement("button");_.type="button",_.className="hud-banner__close",_.setAttribute("aria-label","Dismiss notification"),_.textContent="×",_.addEventListener("click",()=>{T()}),g.append(_)}return m.append(p),h.autoCloseMs&&h.autoCloseMs>0&&(M=window.setTimeout(()=>T(),h.autoCloseMs)),{element:p,dismiss:T}},removeTransientUI:()=>{t.querySelectorAll(".hud-loader").forEach(f=>{f.remove()}),t.querySelectorAll(".hud-banner-stack").forEach(f=>{f.remove()})}}}async function $_(t){const a=Object.entries(t),s=await Promise.allSettled(a.map(([f,h])=>h.load().then(m=>({key:f,descriptor:h,value:m})))),r={},l=[],u=[];return s.forEach((f,h)=>{const[m,p]=a[h],g=p.label??String(m);if(f.status==="fulfilled"){const{value:v}=f.value;if(r[m]=v.value,v.warnings?.length)for(const M of v.warnings)l.push(g?`${g}: ${M}`:M);if(v.errors?.length)for(const M of v.errors)u.push(g?`${g}: ${M}`:M);return}const b=X_(f.reason);u.push(g?`${g}: ${b}`:b)}),{resources:r,warnings:l,errors:u}}function X_(t){if(t instanceof Error)return t.message;if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return String(t)}}const Q_="Heating the sauna stones…",K_="Polishing sauna ambience…";function P_(t){if(t instanceof Error&&t.message)return t.message;if(typeof t=="string"&&t.trim().length>0)return t;try{return JSON.stringify(t)}catch{return String(t)}}function Z_(t){const a=new Set,s=f=>{a.forEach(h=>h(f))},r=t.formatError??P_;return{run:async f=>{s({type:"status",phase:"start",message:Q_});try{const{resources:h,warnings:m,errors:p}=await $_({assets:{label:"Core assets",load:async()=>{const b=await t.loadAssets(t.assetPaths);return{value:b.assets,errors:b.failures}}},saunojaIcon:{label:"Saunoja icon",load:async()=>{try{return await t.preloadSaunojaIcon(),{value:!0}}catch(b){return{value:!1,warnings:[`Unable to preload Saunoja icon (${r(b)})`]}}}}});if(t.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"status",phase:"progress",message:K_});const g=h.assets;if(!g){const b=p.length?[...p]:["Critical assets were unavailable. Please refresh to try again."];s({type:"fatal",messages:b});return}if(p.length&&s({type:"errors",errors:p}),m.length&&s({type:"warnings",warnings:m}),t.setAssets(g),t.shouldAbort?.(f)){s({type:"cancelled"});return}t.startGame(),s({type:"ready",assets:g,warnings:m,errors:p})}catch(h){if(t.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"failure",error:h,message:r(h)})}},subscribe:f=>(a.add(f),()=>{a.delete(f)})}}const J_="grabbing";function W_(t,a){const s=a.dragCursor??J_;let r=!1,l=null,u=0,f=0,h=null;const m=M=>{M.pointerType!=="mouse"||M.button!==0||(r=!0,l=M.pointerId,u=M.clientX,f=M.clientY,h=t.style.cursor??"",t.setPointerCapture?.(M.pointerId),t.style.cursor=s,a.onPanStart?.(M))},p=M=>{if(!r||l!==M.pointerId)return;const x=M.clientX-u,T=M.clientY-f;u=M.clientX,f=M.clientY,a.onPan(x,T,M)},g=M=>{!r||l!==M.pointerId||(r=!1,l=null,t.releasePointerCapture?.(M.pointerId),t.style.cursor=h??"",a.onPanEnd?.(M))},b=M=>{g(M)},v=M=>{g(M)};return t.addEventListener("pointerdown",m),t.addEventListener("pointermove",p),t.addEventListener("pointerup",b),t.addEventListener("pointercancel",v),t.addEventListener("pointerleave",v),()=>{t.removeEventListener("pointerdown",m),t.removeEventListener("pointermove",p),t.removeEventListener("pointerup",b),t.removeEventListener("pointercancel",v),t.removeEventListener("pointerleave",v),r&&l!==null&&t.releasePointerCapture?.(l),t.style.cursor=h??""}}const eN=10,tN=250;function Vi(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function nN(t,a){const s=a.tapMaxMovement??eN,r=a.tapMaxDuration??tN;let l=null;const u=b=>{if(b.touches.length===1){const v=b.touches[0];l={mode:"pan",lastX:v.clientX,lastY:v.clientY,startX:v.clientX,startY:v.clientY,startTime:Vi(),moved:!1};return}if(b.touches.length>=2){const[v,M]=[b.touches[0],b.touches[1]];l={mode:"pinch",lastCenterX:(v.clientX+M.clientX)/2,lastCenterY:(v.clientY+M.clientY)/2,lastDistance:Math.hypot(v.clientX-M.clientX,v.clientY-M.clientY),startTime:Vi(),moved:!1}}},f=(b,v)=>{if(!l||l.mode!=="pan")return;const M=b.clientX-l.lastX,x=b.clientY-l.lastY;!l.moved&&Math.hypot(M,x)>1&&(l.moved=!0),l.lastX=b.clientX,l.lastY=b.clientY,a.onPan(M,x,v)},h=(b,v,M)=>{const x=(b.clientX+v.clientX)/2,T=(b.clientY+v.clientY)/2,_=Math.hypot(b.clientX-v.clientX,b.clientY-v.clientY);let R=1,I=0,j=0;l&&l.mode==="pinch"?(R=_/l.lastDistance,I=x-l.lastCenterX,j=T-l.lastCenterY):l={mode:"pinch",lastCenterX:x,lastCenterY:T,lastDistance:_,startTime:Vi(),moved:!1},!(!l||l.mode!=="pinch")&&(l.lastCenterX=x,l.lastCenterY=T,l.lastDistance=_,l.moved=!0,a.onPinch({centerX:x,centerY:T,scale:R,deltaCenterX:I,deltaCenterY:j},M))},m=b=>{if(!l||b.touches.length===0)return;if(b.preventDefault(),b.touches.length===1){const x=b.touches[0];l.mode!=="pan"&&(l={mode:"pan",lastX:x.clientX,lastY:x.clientY,startX:x.clientX,startY:x.clientY,startTime:Vi(),moved:!0}),f(x,b);return}const[v,M]=[b.touches[0],b.touches[1]];h(v,M,b)},p=()=>!l||l.mode!=="pan"||Math.hypot(l.lastX-l.startX,l.lastY-l.startY)>s?!1:Vi()-l.startTime<=r,g=b=>{if(l){if(b.touches.length===0){l.mode==="pan"&&a.onTap&&p()&&a.onTap({x:l.startX,y:l.startY},b),l=null;return}if(b.touches.length===1){const v=b.touches[0];l={mode:"pan",lastX:v.clientX,lastY:v.clientY,startX:v.clientX,startY:v.clientY,startTime:Vi(),moved:!0};return}if(b.touches.length>=2){const[v,M]=[b.touches[0],b.touches[1]];l={mode:"pinch",lastCenterX:(v.clientX+M.clientX)/2,lastCenterY:(v.clientY+M.clientY)/2,lastDistance:Math.hypot(v.clientX-M.clientX,v.clientY-M.clientY),startTime:Vi(),moved:!0}}}};return t.addEventListener("touchstart",u,{passive:!1}),t.addEventListener("touchmove",m,{passive:!1}),t.addEventListener("touchend",g),t.addEventListener("touchcancel",g),()=>{t.removeEventListener("touchstart",u),t.removeEventListener("touchmove",m),t.removeEventListener("touchend",g),t.removeEventListener("touchcancel",g),l=null}}const aN=.5,iN=3.5;function Ph(t,a,s,r,l){const u=t.getBoundingClientRect(),f=a-u.left,h=s-u.top,m=u.width/2,p=u.height/2;return{x:l.x+(f-m)/r,y:l.y+(h-p)/r}}function sN(t){return Math.min(iN,Math.max(aN,t))}function m1(t,a,s,r=xe.zoom,l=xe){return Ph(t,a,s,r,l)}function p1(t,a,s,r){const l=sN(r);if(l===xe.zoom)return;const u={x:xe.x,y:xe.y},f=Ph(t,a,s,xe.zoom,u),h=Ph(t,a,s,l,u);xe.x+=f.x-h.x,xe.y+=f.y-h.y,xe.zoom=l,Ut()}function ph(t,a){t===0&&a===0||(xe.x-=t/xe.zoom,xe.y-=a/xe.zoom,Ut())}function rN(t){const a=window.devicePixelRatio||1,s=Math.max(window.innerWidth,1),r=Math.max(window.innerHeight,1);t.style.width=`${s}px`,t.style.height=`${r}px`,t.width=Math.round(s*a),t.height=Math.round(r*a);const l=t.getContext("2d");l&&l.setTransform(1,0,0,1,0,0),Ut()}const oN=.0015,Zh=[];let Ym=0,Ba=null,Au=h1(null),Lt=null,gh="classic",Jh=null;function lN(){if(typeof document>"u")return;const t=document.querySelector("[data-build-commit]");if(!t)return;const a="61c541b".trim(),s=a.length>0&&a!=="unknown",r=s?`#${a}`:"DEV BUILD";t.textContent=r,t.dataset.state=s?"commit":"dev";const l=t.closest("#build-id");if(l){const u=s?`Build commit ${a}`:"Development build";l.setAttribute("aria-label",u),l.title=s?`Autobattles build ${a}`:"Unversioned development build",l.dataset.buildState=s?"release":"development"}}lN();function Ia(t){Zh.push(t)}function cN(){for(;Zh.length;){const t=Zh.pop();try{t?.()}catch(a){console.error("Error during cleanup",a)}}}function uN(t){Ia(()=>t.dispose())}function Nc(t,a){const s=Au.showBanner(t,a);s&&Ia(()=>s.dismiss())}function dN(t){switch(t.type){case"status":if(t.phase==="start"){Lt?.dispose();const a=Au.showLoader(t.message);Lt=a,uN(a)}else Lt&&(Lt.update(t.message),Lt.clear(),Lt=null);break;case"ready":Lt?.clear(),Lt=null;break;case"warnings":t.warnings.length&&(console.warn("Resource loader warnings",t.warnings),Nc("warning",{title:"Heads up",messages:t.warnings,autoCloseMs:12e3}));break;case"errors":t.errors.length&&(console.error("Resource loader errors",t.errors),Nc("error",{title:"Some resources failed to load",messages:t.errors,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]}));break;case"fatal":console.error("Critical assets failed to load",t.messages),Lt?.clear(),Lt=null,Nc("error",{title:"Unable to start the sauna battle",messages:t.messages,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}],dismissible:!1});break;case"failure":console.error("Failed to initialize resources",t.error),Lt?.clear(),Lt=null,Nc("error",{title:"Failed to initialize",messages:[t.message],actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]});break;case"cancelled":Lt?.dispose(),Lt=null;break}}const g1=Z_({assetPaths:m5,loadAssets:TM,preloadSaunojaIcon:Sv,setAssets:p5,startGame:H_,shouldAbort:t=>t!==Ym});g1.subscribe(dN);function n2(t){if(!Ba)return;t.preventDefault();const a=Math.exp(-t.deltaY*oN),s=xe.zoom*a;p1(Ba,t.clientX,t.clientY,s)}function a2(t){if(!Ba)return;const a=m1(Ba,t.clientX,t.clientY);u1(a)}function fN(t){t.addEventListener("click",a2),Ia(()=>t.removeEventListener("click",a2)),t.addEventListener("wheel",n2,{passive:!1}),Ia(()=>t.removeEventListener("wheel",n2));const a=W_(t,{onPan:(r,l)=>{ph(r,l)},dragCursor:"grabbing"});Ia(a);const s=nN(t,{onPan:(r,l)=>{ph(r,l)},onPinch:({centerX:r,centerY:l,scale:u,deltaCenterX:f,deltaCenterY:h})=>{p1(t,r,l,xe.zoom*u),ph(f,h)},onTap:r=>{const l=m1(t,r.x,r.y);u1(l)}});Ia(s)}function hN(){Ym+=1,cN(),Jh?.destroy(),Jh=null,Lt?.dispose(),Lt=null,Ba&&(Ba.style.cursor=""),Ba=null,Au.removeTransientUI(),Kh()}function mN(){const t=document.getElementById("game-canvas"),a=document.getElementById("resource-bar"),s=document.getElementById("ui-overlay");if(!t||!a||!s){console.error("Autobattles4xFinsauna shell is missing the required canvas, overlay, or resource bar elements.",{hasCanvas:!!t,hasResourceBar:!!a,hasOverlay:!!s});return}Ba&&hN();const r=++Ym;gh=Iv().useUiV2?"v2":"classic",Ba=t,Au=h1(s);const u=aA();Ia(()=>u.dispose()),g_(t,a,s,{hudVariant:gh}),gh==="v2"&&(Jh=V_({overlay:s,resourceBar:a})),fN(t);const f=()=>rN(t);window.addEventListener("resize",f),Ia(()=>window.removeEventListener("resize",f)),window.addEventListener("beforeunload",Kh),Ia(()=>window.removeEventListener("beforeunload",Kh)),f(),import.meta.vitest||g1.run(r)}function pN(){if(typeof document>"u")return;const t=()=>{document.removeEventListener("DOMContentLoaded",t),mN()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",t);return}t()}import.meta.vitest||pN();
