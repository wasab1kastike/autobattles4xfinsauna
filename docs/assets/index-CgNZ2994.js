(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function s(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(l){if(l.ep)return;l.ep=!0;const u=s(l);fetch(l.href,u)}})();class AE{listeners=new Map;on(a,s){const r=this.listeners.get(a)??[];r.push(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);if(!r)return;const l=r.indexOf(s);l!==-1&&(r.splice(l,1),r.length===0?this.listeners.delete(a):this.listeners.set(a,r))}emit(a,s){const r=this.listeners.get(a);if(r)for(const l of r)l(s)}}const se=new AE;class tm{type="farm";cost=50;beerPerTick=1}class o2{type="barracks";cost=100;trainingCapacity=1}const l2=Math.sqrt(3),c2=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function ta(t,a){return{x:a*l2*(t.q+t.r/2),y:a*(3/2)*t.r}}function Mo(t,a,s){const r=(l2/3*t-.3333333333333333*a)/s,l=2/3*a/s;return{q:r,r:l}}function CE(t,a,s){return _E(Mo(t,a,s))}function Hc(t){return c2.map(a=>({q:t.q+a.q,r:t.r+a.r}))}function Js(t,a){const s=-t.q-t.r,r=-a.q-a.r;return Math.max(Math.abs(t.q-a.q),Math.abs(t.r-a.r),Math.abs(s-r))}function _E(t){let a=t.q,s=t.r,r=-a-s,l=Math.round(a),u=Math.round(r),f=Math.round(s);const h=Math.abs(l-a),m=Math.abs(u-r),p=Math.abs(f-s);return h>m&&h>p?l=-u-f:m>p?u=-l-f:f=-l-u,{q:l,r:f}}const Ic=new Set;let Lc=32;function TE(t){return`${t.q},${t.r}`}function Sh(t,a){Lc=a,Ic.add(TE(t))}function RE(t){if(Ic.size===0)return{center:{x:0,y:0},zoom:1};const a=Lc*Math.sqrt(3),s=Lc*2,r=a/2,l=s/2;let u=1/0,f=1/0,h=-1/0,m=-1/0;for(const B of Ic){const[Y,X]=B.split(",").map(Number),{x:V,y:W}=ta({q:Y,r:X},Lc),ne=V-r,F=W-l;u=Math.min(u,ne),f=Math.min(f,F),h=Math.max(h,ne+a),m=Math.max(m,F+s)}const p=h-u,g=m-f,y=96,v={x:u+p/2,y:f+g/2},S=Math.max(0,Math.min(t.safeRight??0,t.width)),_=Math.max(t.width-S,1)/(p+y*2),T=t.height/(g+y*2),N=Math.min(_,T);return{center:{x:N>0?v.x-S/(2*N):v.x,y:v.y},zoom:N}}const xe={x:0,y:0,zoom:1};function NE(t,a=300){const s=xe.x,r=xe.y,l=xe.zoom,u=typeof performance<"u"?performance.now():Date.now(),f=h=>{const m=Math.min((h-u)/a,1);xe.x=s+(t.center.x-s)*m,xe.y=r+(t.center.y-r)*m,xe.zoom=l+(t.zoom-l)*m,m<1&&(typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),16))};typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),0)}function kE(){Ic.clear()}async function DE(t){const a={},s={},r=[],l=Object.entries(t.images??{}).map(([f,h])=>new Promise(m=>{const p=new Image;p.onload=()=>{a[f]=p,m()},p.onerror=()=>{const g=`Failed to load image: ${h}`;console.error(g),r.push(g),m()},p.src=h})),u=Object.entries(t.sounds??{}).map(([f,h])=>new Promise(m=>{const p=new Audio;p.oncanplaythrough=()=>{s[f]=p,m()},p.onerror=()=>{const g=`Failed to load sound: ${h}`;console.error(g),r.push(g),m()},p.src=h,p.load()}));return await Promise.all([...l,...u]),{assets:{images:a,sounds:s},failures:r}}function nm(t){if(typeof globalThis.localStorage>"u")return;const a=globalThis.localStorage.getItem(t);if(a)try{return JSON.parse(a)}catch(s){console.warn(`Failed to parse data for "${t}", clearing`,s),globalThis.localStorage.removeItem(t);return}}var re=(t=>(t.SAUNA_BEER="sauna-beer",t.SAUNAKUNNIA="saunakunnia",t.SISU="sisu",t))(re||{});const uc={"sauna-beer":1,saunakunnia:0,sisu:0},u2="/assets/sauna-beer-CgafwOhX.svg",d2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eResource%20Icon%3c/title%3e%3cdesc%20id='desc'%3eA%20luminous%20crest%20symbolising%20generic%20resources.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='resource-bg'%20cx='50%25'%20cy='50%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='resource-core'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2338bdf8'%20/%3e%3c/linearGradient%3e%3cfilter%20id='resource-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='6'%20flood-color='%2338bdf8'%20flood-opacity='0.45'%20/%3e%3c/filter%3e%3c/defs%3e%3cg%20filter='url(%23resource-glow)'%3e%3ccircle%20cx='32'%20cy='32'%20r='22'%20fill='%230f172a'%20stroke='url(%23resource-bg)'%20stroke-width='4'%20/%3e%3cpath%20d='M32%2016l-12%2014%2012%2022%2012-22z'%20fill='url(%23resource-core)'%20stroke='%23f8fafc'%20stroke-width='2'%20/%3e%3cpath%20d='M20%2030l-4%208%2016%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M44%2030l4%208-16%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/g%3e%3c/svg%3e",f2="/assets/saunoja-roster-Bfn4ZKxh.svg",Gt={APPLIED:"policy:applied",REJECTED:"policy:rejected"},h2=[{id:"eco",name:"Evergreen Eco Mandate",description:"Increase passive sauna beer brewing by one bottle each production tick.",cost:15,resource:re.SAUNAKUNNIA,prerequisites:[],visuals:{icon:d2,gradient:"linear-gradient(135deg, rgba(66, 240, 155, 0.9), rgba(13, 114, 234, 0.85))",accentColor:"#34d399",badges:["Economy","Sustainability"],flair:"Green-lit by the council of whisked sauna masters."},effects:[{event:Gt.APPLIED,once:!0,invoke:({state:t})=>{t.modifyPassiveGeneration(re.SAUNA_BEER,1)}}],spotlight:"Sustainably expand your brewing line with solar-heated mash tuns."},{id:"temperance",name:"Aurora Temperance Treaty",description:"Boost night shift work speed by 5% once the eco initiative is live.",cost:25,resource:re.SAUNAKUNNIA,prerequisites:[{description:"Enact the Evergreen Eco Mandate.",isSatisfied:t=>t.hasPolicy("eco")},{description:"Stockpile at least 30 Sauna Beer bottles to brief the midnight crews.",isSatisfied:t=>t.getResource(re.SAUNA_BEER)>=30}],visuals:{icon:f2,gradient:"linear-gradient(140deg, rgba(46, 51, 227, 0.9), rgba(118, 75, 162, 0.85))",accentColor:"#6366f1",badges:["Discipline","Night Ops"],flair:"Whispers of aurora spirits keep the crew laser-focused after dusk."},effects:[{event:Gt.APPLIED,once:!0,invoke:({state:t})=>{t.nightWorkSpeedMultiplier=Number((t.nightWorkSpeedMultiplier*1.05).toFixed(4))}}],spotlight:"Glow-lit helmets and synchronized chants keep the late shift on tempo."},{id:"steam-diplomats",name:"Steam Diplomats Accord",description:"Import two additional sauna beer bottles per tick via gilded trade routes.",cost:35,resource:re.SAUNAKUNNIA,prerequisites:[{description:"Secure the Aurora Temperance Treaty for your envoys.",isSatisfied:t=>t.hasPolicy("temperance")},{description:"Hold a reserve of 50 Sauna Beer bottles to fund the embassy festivities.",isSatisfied:t=>t.getResource(re.SAUNA_BEER)>=50}],visuals:{icon:u2,gradient:"linear-gradient(150deg, rgba(255, 173, 94, 0.92), rgba(255, 99, 71, 0.85))",accentColor:"#fb923c",badges:["Diplomacy","Logistics"],flair:"Silver samovars arrive with diplomatic steam-born delights."},effects:[{event:Gt.APPLIED,once:!0,invoke:({state:t})=>{t.modifyPassiveGeneration(re.SAUNA_BEER,2)}}],spotlight:"Trade envoys pipe artisanal steam through every new supply line."}],m2=new Map;for(const t of h2)m2.set(t.id,t);function p2(){return h2}function vy(t){return m2.get(t)}const jc="progression:ngPlusState",am=5,g2=1831565813,Uc=Object.freeze({aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1}),Oc=Object.freeze({runSeed:0,ngPlusLevel:0,unlockSlots:0,enemyTuning:Uc});function Uf(t,a,s,r){const l=Number(t);return Number.isFinite(l)?Math.min(s,Math.max(a,l)):r}function LE(t){return{aggressionMultiplier:Uf(t?.aggressionMultiplier,.25,6,Uc.aggressionMultiplier),cadenceMultiplier:Uf(t?.cadenceMultiplier,.25,4,Uc.cadenceMultiplier),strengthMultiplier:Uf(t?.strengthMultiplier,.25,6,Uc.strengthMultiplier)}}function y2(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(t){return console.warn("Local storage unavailable for NG+ state",t),null}}function Sy(t,a,s){const r=Number.isFinite(t)?t:Number(t);if(!Number.isFinite(r))return a;const l=Math.trunc(r);return Math.min(s,Math.max(a,l))}function b2(t){const a=Number.isFinite(t)?t:Number(t);return!Number.isFinite(a)||a===0?0:Math.trunc(Math.abs(a))}function v2(t=Math.random){let a=t();(!Number.isFinite(a)||a<=0||a>=1)&&(a=Math.random());const s=Math.floor(a*4294967295);return s===0?g2:s}function za(t={}){const a=Oc,s=b2(t.runSeed??a.runSeed),r=Sy(t.ngPlusLevel??a.ngPlusLevel,0,Number.MAX_SAFE_INTEGER),l=Sy(t.unlockSlots??a.unlockSlots,0,am),u=LE(t.enemyTuning??a.enemyTuning);return{runSeed:s,ngPlusLevel:r,unlockSlots:l,enemyTuning:u}}function Da(t,a=Math.random){const s=za(t);return s.runSeed!==0?s:za({...s,runSeed:v2(a)})}function UE(t=Math.random){const a=y2();if(!a)return Da(Oc,t);const s=a.getItem(jc);if(!s)return Da(Oc,t);try{const r=JSON.parse(s);return Da(za(r),t)}catch(r){return console.warn("Failed to parse NG+ state",r),Da(Oc,t)}}function Eh(t){const a=y2();if(!a)return;const s=za(t);a.setItem(jc,JSON.stringify(s))}function OE(t,a){const s=za(t),r=typeof a.random=="function"?a.random:Math.random,l=v2(r);return Da(za({...s,runSeed:l}),r)}function Gc(t,a=0){let s=b2(t)^(a|0);return s===0&&(s=g2^(a|0)),()=>{s=s+1831565813|0;let r=Math.imul(s^s>>>15,1|s);return r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296}}function Of(t){return`${t.q},${t.r}`}const S2={farm:()=>new tm,barracks:()=>new o2};function qE(t){return S2[t]?.()}const Ey=Object.freeze({aggression:1,cadence:1,strength:1});function tr(t,a,s,r){const l=Number(t);return Number.isFinite(l)?Math.min(s,Math.max(a,l)):r}function My(t,a){return{aggression:tr(a.aggression??t.aggression,.1,8,t.aggression),cadence:tr(a.cadence??t.cadence,.25,6,t.cadence),strength:tr(a.strength??t.strength,.25,12,t.strength)}}class zE{constructor(a,s="gameState"){this.tickInterval=a,this.storageKey=s}resources={[re.SAUNA_BEER]:0,[re.SAUNAKUNNIA]:0,[re.SISU]:0};passiveGeneration={...uc};lastSaved=Date.now();buildings={};buildingPlacements=new Map;policies=new Set;nightWorkSpeedMultiplier=1;enemyScaling={...Ey};enemyCalmSecondsRemaining=0;ngPlus=za();tick(){Object.keys(this.passiveGeneration).forEach(a=>{this.addResource(a,this.passiveGeneration[a])})}save(){this.lastSaved=Date.now();const a={};this.buildingPlacements.forEach((l,u)=>{a[u]=l.type});const s={resources:this.resources,lastSaved:this.lastSaved,buildings:this.buildings,buildingPlacements:a,policies:Array.from(this.policies),passiveGeneration:{...this.passiveGeneration},nightWorkSpeedMultiplier:this.nightWorkSpeedMultiplier,enemyScaling:{...this.enemyScaling},ngPlus:this.ngPlus},r=typeof localStorage<"u"&&localStorage?localStorage:void 0;if(!r){console.warn("GameState.save: localStorage is unavailable, skipping persistence.");return}try{r.setItem(this.storageKey,JSON.stringify(s))}catch(l){console.warn("GameState.save: Failed to persist state to localStorage.",l)}}load(a){const s=nm(this.storageKey);if(!s)return this.lastSaved=Date.now(),!1;this.resources={...this.resources,...s.resources??{}},Object.keys(this.resources).forEach(m=>{Number.isFinite(this.resources[m])||(this.resources[m]=0)}),this.enemyScaling=My(Ey,s.enemyScaling??{}),this.enemyCalmSecondsRemaining=0;const r={};Object.entries(s.buildings??{}).forEach(([m,p])=>{S2[m]&&(r[m]=p)}),this.buildings=r,this.buildingPlacements.clear(),s.buildingPlacements&&Object.entries(s.buildingPlacements).forEach(([m,p])=>{const g=qE(p);if(!g)return;this.buildingPlacements.set(m,g);const[y,v]=m.split(",").map(Number);if(a){const S=a.ensureTile(y,v);S.placeBuilding(g.type),S.reveal(),Sh({q:y,r:v},a.hexSize)}se.emit("buildingPlaced",{building:g,coord:{q:y,r:v},state:this})}),this.lastSaved=s.lastSaved??Date.now();const l=s.ngPlus?za(s.ngPlus):this.ngPlus;if(this.ngPlus=Da(l),this.policies=new Set,this.passiveGeneration={...uc},this.nightWorkSpeedMultiplier=1,(Array.isArray(s.policies)?s.policies.filter(m=>typeof m=="string"):[]).forEach(m=>{const p=vy(m);p&&(this.policies.add(p.id),se.emit(Gt.APPLIED,{policy:p,state:this}))}),s.passiveGeneration){const m={...uc};Object.keys(uc).forEach(p=>{const g=s.passiveGeneration?.[p];typeof g=="number"&&Number.isFinite(g)&&(m[p]=g)}),this.passiveGeneration=m}typeof s.nightWorkSpeedMultiplier=="number"&&Number.isFinite(s.nightWorkSpeedMultiplier)&&(this.nightWorkSpeedMultiplier=s.nightWorkSpeedMultiplier);const f=Date.now()-this.lastSaved,h=Math.floor(f/this.tickInterval);return Object.keys(this.passiveGeneration).forEach(m=>{this.resources[m]+=h*this.passiveGeneration[m]}),!0}getResource(a){return this.resources[a]}canAfford(a,s=re.SAUNA_BEER){return this.resources[s]>=a}spendResource(a,s=re.SAUNA_BEER){return this.spend(a,s)}spend(a,s=re.SAUNA_BEER){return this.canAfford(a,s)?(this.resources[s]-=a,se.emit("resourceChanged",{resource:s,amount:-a,total:this.resources[s]}),!0):!1}addResource(a,s){this.resources[a]+=s,se.emit("resourceChanged",{resource:a,amount:s,total:this.resources[a]})}modifyPassiveGeneration(a,s){this.passiveGeneration[a]=(this.passiveGeneration[a]??0)+s}setEnemyScalingBase(a){return this.enemyScaling=My(this.enemyScaling,a),{...this.enemyScaling}}applyEnemyScalingModifiers(a){const s={aggression:tr(this.enemyScaling.aggression*(a.aggression??1),.1,8,this.enemyScaling.aggression),cadence:tr(this.enemyScaling.cadence*(a.cadence??1),.25,6,this.enemyScaling.cadence),strength:tr(this.enemyScaling.strength*(a.strength??1),.25,12,this.enemyScaling.strength)};return this.enemyScaling=s,{...this.enemyScaling}}getEnemyScalingSnapshot(){return{...this.enemyScaling,calmSecondsRemaining:Math.max(0,this.enemyCalmSecondsRemaining)}}requestEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(this.enemyCalmSecondsRemaining,s),this.enemyCalmSecondsRemaining)}advanceEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(0,this.enemyCalmSecondsRemaining-s),this.enemyCalmSecondsRemaining)}clearEnemyCalm(){this.enemyCalmSecondsRemaining=0}construct(a,s,r=re.SAUNA_BEER){return this.spend(s,r)?(this.buildings[a]=(this.buildings[a]??0)+1,!0):!1}placeBuilding(a,s,r,l=re.SAUNA_BEER){const u=r.getTile(s.q,s.r);return!u||u.building||!this.construct(a.type,a.cost,l)?!1:(this.buildingPlacements.set(Of(s),a),u.placeBuilding(a.type),se.emit("buildingPlaced",{building:a,coord:s,state:this}),!0)}getBuildingAt(a){return this.buildingPlacements.get(Of(a))}removeBuilding(a,s){const r=Of(a),l=this.buildingPlacements.get(r);return l?(this.buildingPlacements.delete(r),s.getTile(a.q,a.r)?.placeBuilding(null),this.buildings[l.type]!==void 0&&(this.buildings[l.type]-=1,this.buildings[l.type]<=0&&delete this.buildings[l.type]),se.emit("buildingRemoved",{building:l,coord:a,state:this}),!0):!1}upgrade(a,s,r=re.SAUNA_BEER){return this.construct(`upgrade:${a}`,s,r)}applyPolicy(a){const s=vy(a);if(!s){const u={policyId:a,state:this,reason:"unknown-policy"};return se.emit(Gt.REJECTED,u),!1}if(this.hasPolicy(s.id)){const u={policyId:s.id,policy:s,state:this,reason:"already-applied"};return se.emit(Gt.REJECTED,u),!1}const r=s.prerequisites.filter(u=>!u.isSatisfied(this));if(r.length>0){const u={policyId:s.id,policy:s,state:this,reason:"prerequisites-not-met",missingPrerequisites:r};return se.emit(Gt.REJECTED,u),!1}if(!this.spend(s.cost,s.resource)){const u={policyId:s.id,policy:s,state:this,reason:"insufficient-resources"};return se.emit(Gt.REJECTED,u),!1}this.policies.add(s.id);const l={policy:s,state:this};return se.emit(Gt.APPLIED,l),!0}hasPolicy(a){return this.policies.has(a)}getNgPlusState(){return{...this.ngPlus}}setNgPlusState(a){const s=za({...this.ngPlus,...a});return this.ngPlus=Da(s),this.ngPlus}}class BE{constructor(a,s){this.baseInterval=a,this.onTick=s}timer=null;speed=1;lastTick=0;accumulator=0;start(){this.stop(),this.lastTick=Date.now();const a=this.baseInterval/this.speed;this.timer=setInterval(()=>{const s=Date.now(),r=s-this.lastTick;this.lastTick=s,this.onTick(r)},a)}stop(){this.timer!==null&&(clearInterval(this.timer),this.timer=null)}setSpeed(a){if(a<=0)throw new Error("Speed multiplier must be positive");this.speed=a,this.timer!==null&&this.start()}getSpeed(){return this.speed}getBaseInterval(){return this.baseInterval}tick(a){for(this.accumulator+=a*this.speed;this.accumulator>=this.baseInterval;)this.accumulator-=this.baseInterval,this.onTick(this.baseInterval)}}var xn=(t=>(t[t.Plains=0]="Plains",t[t.Forest=1]="Forest",t[t.Hills=2]="Hills",t[t.Lake=3]="Lake",t))(xn||{});function HE(t,a,s){let r=t*374761393+a*668265263+s*0x14057b7ef7678100;return r=(r^r>>13)*1274126177,r^=r>>16,(r>>>0)/4294967295}function IE(t,a,s=0){const r=HE(t,a,s);return r<.1?3:r<.3?1:r<.5?2:0}class jE{_terrain;_building;_isFogged;listeners=new Set;constructor(a=xn.Plains,s=null,r=!0){this._terrain=a,this._building=s,this._isFogged=r}get terrain(){return this._terrain}set terrain(a){this._terrain!==a&&(this._terrain=a,this.notify("terrain"))}get building(){return this._building}set building(a){this._building!==a&&(this._building=a,this.notify("building"))}get isFogged(){return this._isFogged}set isFogged(a){this._isFogged!==a&&(this._isFogged=a,this.notify("fog"))}reveal(){this.isFogged=!1}placeBuilding(a){this.building=a}setFogged(a){this.isFogged=a}addMutationListener(a){return this.listeners.add(a),()=>this.listeners.delete(a)}notify(a){for(const s of this.listeners)s(a)}}class GE{constructor(a=10,s=10,r=32,l=0){this.hexSize=r,this.seed=l,this.minQ=0,this.minR=0,this.maxQ=a-1,this.maxR=s-1}tiles=new Map;tileSubscriptions=new Map;changeListeners=new Set;minQ;maxQ;minR;maxR;get width(){return this.maxQ-this.minQ+1}get height(){return this.maxR-this.minR+1}key(a,s){return`${a},${s}`}addTileChangeListener(a){return this.changeListeners.add(a),()=>this.changeListeners.delete(a)}notifyTileChange(a,s,r){for(const l of this.changeListeners)l(a,s,r)}attachTileListener(a,s,r){const l=s.addMutationListener(u=>{this.notifyTileChange(r,s,u)});this.tileSubscriptions.set(a,l)}ensureTile(a,s){const r=this.key(a,s);let l=this.tiles.get(r);return l||(l=new jE(IE(a,s,this.seed)),this.tiles.set(r,l),this.minQ=Math.min(this.minQ,a),this.maxQ=Math.max(this.maxQ,a),this.minR=Math.min(this.minR,s),this.maxR=Math.max(this.maxR,s),this.attachTileListener(r,l,{q:a,r:s}),this.notifyTileChange({q:a,r:s},l,"created"),l.isFogged||Sh({q:a,r:s},this.hexSize)),l}getTile(a,s){return this.tiles.get(this.key(a,s))}forEachTile(a){for(const[s,r]of this.tiles){const[l,u]=s.split(",").map(Number);a(r,{q:l,r:u})}}getNeighbors(a,s){return Hc({q:a,r:s}).map(r=>this.ensureTile(r.q,r.r))}revealAround(a,s,r={}){const{autoFrame:l=!0}=r;for(let h=-s;h<=s;h++){const m=Math.max(-s,-h-s),p=Math.min(s,-h+s);for(let g=m;g<=p;g++){const y={q:a.q+h,r:a.r+g};this.ensureTile(y.q,y.r).reveal(),Sh(y,this.hexSize)}}if(!l)return;const u=typeof window<"u"?(()=>{const h=Math.max(window.innerWidth,0),m=Math.max(window.innerHeight,0);let p=0;if(typeof document<"u"){const y=document.getElementById("right-panel");if(y){const v=y.getBoundingClientRect();if(v.width>0){const S=y.closest("#ui-overlay");if(S){const M=S.getBoundingClientRect(),_=window.getComputedStyle(S),T=Number.parseFloat(_.paddingRight||"0"),N=M.right-v.left,O=v.width+(Number.isFinite(T)?T:0);p=Math.max(0,Math.max(N,O))}else p=Math.max(0,v.width)}}}const g=Math.min(Math.max(p,0),h);return{width:h,height:m,safeRight:g}})():{width:0,height:0,safeRight:0},f=RE(u);NE(f,300)}}const Fc={TRIGGERED:"scheduler:eventTriggered",RESOLVED:"scheduler:eventResolved"},FE=new Map;function $E(){return globalThis.localStorage??null}function uo(t){return typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}function E2(t){const a=globalThis.crypto;return a?.randomUUID?a.randomUUID():`${t}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function YE(t){const a={id:String(t.id??""),label:String(t.label??""),description:t.description?String(t.description):void 0,event:t.event?String(t.event):void 0,payload:t.payload,accent:t.accent??void 0};return a.id||(a.id=E2("choice")),a.label||(a.label="Choose"),a}function $c(t){const a={id:String(t.id??""),headline:String(t.headline??""),body:String(t.body??""),art:t.art?String(t.art):void 0,typography:t.typography,animation:t.animation,accentColor:t.accentColor?String(t.accentColor):void 0,acknowledgeText:t.acknowledgeText?String(t.acknowledgeText):void 0,choices:Array.isArray(t.choices)?t.choices.map(s=>YE(s)):void 0};return a.id||(a.id=E2("event")),a}function VE(t){return{content:$c(t.content),trigger:t.trigger.type==="time"?{type:"time",at:Number.isFinite(t.trigger.at)?t.trigger.at:0}:{type:"condition",conditionId:String(t.trigger.conditionId),params:t.trigger.params}}}function xy(t){return{content:$c(t.content),triggeredAt:Number.isFinite(t.triggeredAt)?t.triggeredAt:0}}const qf=Object.freeze({clock:0,queue:[],active:[]});class XE{storageKey;eventBus;getStorage;state=uo(qf);subscribers=new Set;constructor(a={}){this.storageKey=a.storageKey??"autobattles:event-scheduler",this.eventBus=a.eventBus??se,this.getStorage=a.storageProvider??$E,this.load()}subscribe(a){return this.subscribers.add(a),a(this.getActiveEvents()),()=>{this.subscribers.delete(a)}}getActiveEvents(){return this.state.active.map(a=>({...uo(a.content),triggeredAt:a.triggeredAt}))}schedule(a){const s=$c(a.content);if(!s.headline||!s.body||this.containsEvent(s.id))return!1;const r=a.trigger.type==="condition"?{type:"condition",conditionId:String(a.trigger.conditionId),params:a.trigger.params}:{type:"time",at:this.resolveTriggerTime(a.trigger)};return this.state.queue.push({content:s,trigger:r}),this.sortQueue(),this.save(),!0}publish(a){const s=$c(a);this.containsEvent(s.id)||(this.state.queue=this.state.queue.filter(r=>r.content.id!==s.id),this.activateEvent({content:s,triggeredAt:this.state.clock}))}tick(a,s={}){if(!Number.isFinite(a)||a<=0)return;this.state.clock+=a;const r=[],l=[];for(const u of this.state.queue)this.shouldTrigger(u.trigger,s)?r.push(u):l.push(u);this.state.queue=l;for(const u of r)this.activateEvent({content:u.content,triggeredAt:this.state.clock});this.save()}resolve(a,s){const r=this.state.active.findIndex(h=>h.content.id===a);if(r===-1)return!1;const l=this.state.active[r],u=this.pickChoice(l.content,s),f=u?u.id:null;return this.state.active.splice(r,1),this.save(),this.notify(),this.eventBus.emit(Fc.RESOLVED,{eventId:a,choiceId:f,event:l.content}),u?.event&&this.eventBus.emit(u.event,{eventId:a,choiceId:f,payload:u.payload,event:l.content}),!0}reset(){this.state=uo(qf),this.save(),this.notify()}activateEvent(a){const s=xy(a);this.state.active.push(s),this.save(),this.notify(),this.eventBus.emit(Fc.TRIGGERED,{event:{...uo(s.content),triggeredAt:s.triggeredAt}})}pickChoice(a,s){const r=a.choices??[];if(r.length!==0){if(s){const l=r.find(u=>u.id===s);if(l)return l}return r[0]}}shouldTrigger(a,s){if(a.type==="time")return this.state.clock>=a.at;const r=FE.get(a.conditionId);if(!r)return!1;try{return!!r(a.params,s)}catch(l){return console.warn("Scheduler condition evaluation failed",a.conditionId,l),!1}}resolveTriggerTime(a){if(Number.isFinite(a.at))return Number(a.at);const s=Number.isFinite(a.in)?Number(a.in):0;return Math.max(0,this.state.clock+s)}sortQueue(){this.state.queue.sort((a,s)=>{const r=a.trigger.type==="time"?a.trigger.at:Number.POSITIVE_INFINITY,l=s.trigger.type==="time"?s.trigger.at:Number.POSITIVE_INFINITY;return r-l})}containsEvent(a){return this.state.active.some(s=>s.content.id===a)||this.state.queue.some(s=>s.content.id===a)}notify(){const a=this.getActiveEvents();for(const s of this.subscribers)try{s(a)}catch(r){console.warn("Scheduler subscriber failed",r)}}load(){const a=nm(this.storageKey);if(!a){this.state=uo(qf);return}const s=Number(a.clock);this.state={clock:Number.isFinite(s)?s:0,queue:Array.isArray(a.queue)?a.queue.map(r=>VE(r)):[],active:Array.isArray(a.active)?a.active.map(r=>xy(r)):[]}}save(){const a=this.getStorage();if(a)try{a.setItem(this.storageKey,JSON.stringify({clock:this.state.clock,queue:this.state.queue,active:this.state.active}))}catch(s){console.warn("Scheduler persistence failed",s)}}}const Co=new XE;function KE(t,a){const s=new WeakSet,r=l=>{l.policy.id===t.id&&(a.once!==!1&&s.has(l.state)||(a.invoke(l),a.once!==!1&&s.add(l.state)))};se.on(a.event,r)}for(const t of p2())for(const a of t.effects)KE(t,a);const QE="modulepreload",PE=function(t){return"/"+t},wy={},ZE=function(a,s,r){let l=Promise.resolve();if(s&&s.length>0){let m=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),h=f?.nonce||f?.getAttribute("nonce");l=m(s.map(p=>{if(p=PE(p),p in wy)return;wy[p]=!0;const g=p.endsWith(".css"),y=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${y}`))return;const v=document.createElement("link");if(v.rel=g?"stylesheet":QE,g||(v.as="script"),v.crossOrigin="",v.href=p,h&&v.setAttribute("nonce",h),document.head.appendChild(v),g)return new Promise((S,M)=>{v.addEventListener("load",S),v.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${p}`)))})}))}function u(f){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=f,window.dispatchEvent(h),!h.defaultPrevented)throw f}return l.then(f=>{for(const h of f||[])h.status==="rejected"&&u(h.reason);return a().catch(u)})},JE=({building:t,coord:a,state:s})=>{t instanceof tm?s.modifyPassiveGeneration(re.SAUNA_BEER,t.beerPerTick):t instanceof o2&&ZE(async()=>{const{spawnUnit:r}=await Promise.resolve().then(()=>px);return{spawnUnit:r}},void 0).then(({spawnUnit:r})=>{r(s,"soldier",`barracks-${a.q}-${a.r}`,a,"player")})},WE=({building:t,state:a})=>{t instanceof tm&&a.modifyPassiveGeneration(re.SAUNA_BEER,-t.beerPerTick)};se.on("buildingPlaced",JE);se.on("buildingRemoved",WE);const zn={master:{defaultVolume:.9,volumeKey:"audio.mixer.master.volume",muteKey:"audio.mixer.master.muted"},music:{defaultVolume:.65,volumeKey:"audio.mixer.music.volume",muteKey:"audio.mixer.music.muted"},sfx:{defaultVolume:1,volumeKey:"audio.mixer.sfx.volume",muteKey:"audio.mixer.sfx.muted"}},Je={master:{volume:zn.master.defaultVolume,muted:!1},music:{volume:zn.music.defaultVolume,muted:!1},sfx:{volume:zn.sfx.defaultVolume,muted:!1}},Pn={};let Ln=null,Mh=!1;const xh=new Set;function im(t,a){return Number.isFinite(t)?t<=0?0:t>=1?1:t:a}function hu(){if(typeof localStorage>"u")return null;try{return localStorage}catch(t){return console.warn("Audio mixer storage unavailable",t),null}}function eM(t){const a=hu();if(!a)return null;try{const s=a.getItem(zn[t].volumeKey);if(s===null)return null;const r=Number.parseFloat(s);return Number.isFinite(r)?im(r,zn[t].defaultVolume):null}catch(s){return console.warn("Failed to restore volume setting",t,s),null}}function tM(t){const a=hu();if(!a)return null;try{const s=a.getItem(zn[t].muteKey);return s===null?null:s==="true"}catch(s){return console.warn("Failed to restore mute setting",t,s),null}}for(const t of Object.keys(zn)){const a=eM(t),s=tM(t);a!==null&&(Je[t].volume=im(a,zn[t].defaultVolume)),s!==null&&(Je[t].muted=s)}function nM(t){const a=hu();if(a)try{a.setItem(zn[t].volumeKey,Je[t].volume.toFixed(3))}catch(s){console.warn("Failed to persist volume setting",t,s)}}function aM(t){const a=hu();if(a)try{a.setItem(zn[t].muteKey,Je[t].muted?"true":"false")}catch(s){console.warn("Failed to persist mute setting",t,s)}}function Ay(){if(typeof window>"u"||!Ln||Mh)return;const t=()=>{Ln?.resume().catch(()=>{})};window.addEventListener("pointerdown",t,{once:!0}),window.addEventListener("keydown",t,{once:!0}),Mh=!0}function sm(t){const a=Pn[t];if(!a)return;const{volume:s,muted:r}=Je[t],l=r?0:s;a.gain.value=l}function M2(t){if(!Pn.master){const a=t.createGain();a.gain.value=Je.master.muted?0:Je.master.volume,a.connect(t.destination),Pn.master=a}if(!Pn.music){const a=t.createGain();a.gain.value=Je.music.muted?0:Je.music.volume,a.connect(Pn.master),Pn.music=a}if(!Pn.sfx){const a=t.createGain();a.gain.value=Je.sfx.muted?0:Je.sfx.volume,a.connect(Pn.master),Pn.sfx=a}}function rm(){if(Ln||typeof window>"u")return Ln;const t=window.AudioContext||window.webkitAudioContext;if(!t)return console.warn("Web Audio API not supported"),null;try{Ln=new t,M2(Ln),Ay()}catch(a){return console.warn("Unable to create AudioContext",a),Ln=null,null}return Ln.state==="suspended"&&(Mh=!1,Ay()),Ln}function iM(){return Ln??rm()}function zf(t){const a=Je.master;if(t==="master")return a.muted?0:a.volume;const s=Je[t];return s.muted||a.muted?0:s.volume*a.volume}function om(t){const a=iM();if(!a)return null;M2(a);const s=Pn[t];return s?(sm(t),s):null}function mu(){return{channels:{master:{volume:Je.master.volume,muted:Je.master.muted,effectiveVolume:zf("master")},music:{volume:Je.music.volume,muted:Je.music.muted,effectiveVolume:zf("music")},sfx:{volume:Je.sfx.volume,muted:Je.sfx.muted,effectiveVolume:zf("sfx")}},contextState:Ln?.state??"uninitialized"}}function x2(){const t=mu();for(const a of xh)a(t)}function lm(t){return xh.add(t),()=>{xh.delete(t)}}function cm(t,a){const s=im(a,zn[t].defaultVolume);Je[t].volume!==s&&(Je[t].volume=s,nM(t),sm(t),x2())}function um(t,a){Je[t].muted!==a&&(Je[t].muted=a,aM(t),sm(t),x2())}function sM(t){cm("master",t)}function rM(t){cm("music",t)}function oM(t){cm("sfx",t)}function lM(t){um("master",t)}function cM(t){um("music",t)}function uM(t){um("sfx",t)}function Yc(t){return mu().channels[t]}const dM=48e3;function fM(t){let a=t>>>0;return()=>{a+=1831565813;let s=a;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}}function hM(t,a,s){const{attack:r,decay:l,sustain:u,release:f,sustainLevel:h}=t;if(r>0&&s<r)return s/r;if(l>0&&s<r+l){const m=(s-r)/l;return 1-(1-h)*m}if(s<a-f)return h;if(f>0&&s<a){const m=(s-(a-f))/f;return h*(1-m)}return 0}function mM(t,a,s){const r=t.phase??0,l=t.vibrato,u=t.tremolo,f=l?1+l.depth*Math.sin(2*Math.PI*l.speed*s):1,h=u?t.gain*(1-u.depth+u.depth*Math.sin(2*Math.PI*u.speed*s)):t.gain,m=a*t.ratio*f;return h*Math.sin(2*Math.PI*m*s+r)}function pM(t,a){return t.gain*(a()*2-1)}function gM(t,a=dM){const s=Math.max(1,Math.floor(t.duration*a)),r=new Float32Array(s),l=fM(t.seed);for(let u=0;u<s;u++){const f=u/a;let h=0;for(const p of t.layers)p.type==="sine"?h+=mM(p,t.baseFrequency,f):h+=pM(p,l);const m=hM(t.envelope,t.duration,f);r[u]=h*m}return r}const Bf={attack:{variants:[{id:"attack-a",label:"Gentle Birch Strike",description:"Soft mallet transient with subtle shimmer.",duration:.9,baseFrequency:220,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:421,loudness:{lufs:-14.775,peakDb:-2.134,gain:.8684}},{id:"attack-b",label:"Rounded Pluck Echo",description:"A slightly brighter chime tuned above the root.",duration:.9,baseFrequency:232,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:947,loudness:{lufs:-14.758,peakDb:-2.101,gain:.8667}},{id:"attack-c",label:"High Drift Pluck",description:"Upper register tap with airy decay.",duration:.9,baseFrequency:244,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:1337,loudness:{lufs:-14.731,peakDb:-2.076,gain:.8641}}]},death:{variants:[{id:"death-a",label:"Hollow Exhale",description:"Low cedar drum pulse with airy noise tail.",duration:1.15,baseFrequency:150,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:615,loudness:{lufs:-14.365,peakDb:-.218,gain:.8284}},{id:"death-b",label:"Soft Ember Fall",description:"Mid register thump with drifting undertone.",duration:1.15,baseFrequency:168,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:274,loudness:{lufs:-14.204,peakDb:-.185,gain:.8132}},{id:"death-c",label:"Warm Resolve",description:"Higher pitch breathy release with gentle rumble.",duration:1.15,baseFrequency:184,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:978,loudness:{lufs:-14.079,peakDb:-.16,gain:.8015}}]},sisu:{variants:[{id:"sisu-a",label:"Rising Steam",description:"Slow bloom of airy sine pads with hushed texture.",duration:1.9,baseFrequency:176,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1204,loudness:{lufs:-12.754,peakDb:-.501,gain:.6882}},{id:"sisu-b",label:"Glowing Drift",description:"Warmer harmonic swell with chorus shimmer.",duration:1.9,baseFrequency:188,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1642,loudness:{lufs:-12.943,peakDb:-.271,gain:.7033}},{id:"sisu-c",label:"Morning Brilliance",description:"Bright tonic swell with shimmering overtones.",duration:1.9,baseFrequency:200,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:2019,loudness:{lufs:-12.888,peakDb:-.235,gain:.6989}}]}};function Hf(t){return{id:t.id,label:t.label,envelope:t.envelope,gain:t.loudness.gain,loader:a=>{const s=gM(t,a.sampleRate),r=a.createBuffer(1,s.length,a.sampleRate);return r.getChannelData(0).set(s),r}}}const yM={click:{variants:[{id:"ui-click-soft",label:"UI soft tap",envelope:{attack:0,decay:.05,sustain:0,release:.03,sustainLevel:0},loader:t=>vM(t)}],debounce:{windowMs:35,weight:.5,maxWeight:1.5},polyphony:6},spawn:{variants:[{id:"ui-spawn-chime",label:"Roster invite tone",envelope:{attack:0,decay:.2,sustain:.5,release:.2,sustainLevel:.5},loader:t=>SM(t)}],debounce:{windowMs:150,weight:.7,maxWeight:1.4},polyphony:3},error:{variants:[{id:"ui-error-tone",label:"Gentle warning tap",envelope:{attack:.01,decay:.2,sustain:.2,release:.2,sustainLevel:.2},loader:t=>EM(t)}],debounce:{windowMs:220,weight:1,maxWeight:1},polyphony:2},attack:{variants:Bf.attack.variants.map(Hf),debounce:{windowMs:120,weight:.6,maxWeight:1.2},polyphony:3},death:{variants:Bf.death.variants.map(Hf),debounce:{windowMs:360,weight:1,maxWeight:1.5},polyphony:3},sisu:{variants:Bf.sisu.variants.map(Hf),debounce:{windowMs:900,weight:1,maxWeight:1},polyphony:1}};let dc=null;const Cy=new Map,fc=new Map,Vc=new Map,nr=new Map,xo=new Map,_y=new Map,jt={node:null,destination:null,envelope:0,lastUpdate:0},fo={attackSeconds:.04,releaseSeconds:.6,depth:.55,floor:.25},wh=new Set;function dm(){const t=Yc("master"),a=Yc("sfx");return t.muted||a.muted}function bM(){const t=dm();for(const a of wh)a(t)}function fm(t,a,s){const r=Math.floor(t.sampleRate*a),l=t.createBuffer(1,r,t.sampleRate),u=l.getChannelData(0);for(let f=0;f<r;f++){const h=f/t.sampleRate;u[f]=s(h)}return l}function vM(t){return fm(t,.05,a=>Math.sin(2*Math.PI*1e3*a)*Math.exp(-40*a))}function SM(t){return fm(t,.2,a=>(Math.sin(2*Math.PI*440*a)+Math.sin(2*Math.PI*660*a))*.5*Math.exp(-6*a))}function EM(t){return fm(t,.3,a=>Math.sin(2*Math.PI*110*a)*Math.exp(-8*a))}function Ty(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function MM(t,a){return`${t}:${a}`}function xM(t,a,s){const r=MM(t,a),l=Cy.get(r);if(l)return Promise.resolve(l);const u=fc.get(r);if(u)return u;const f=hm();if(!f)return Promise.reject(new Error("Audio context unavailable"));const h=Promise.resolve(s.loader(f)).then(m=>(Cy.set(r,m),fc.delete(r),m)).catch(m=>{throw fc.delete(r),m});return fc.set(r,h),h}function Ry(t){const a=t.polyphony;return!Number.isFinite(a)||!a||a<=0?Number.POSITIVE_INFINITY:a}function wM(t,a){const s=Vc.get(t);if(!s||s.length===0)return[];const r=[];for(const l of s)l.time>=a&&r.push(l);return Vc.set(t,r),r}function AM(t,a,s){const r=a.debounce;if(!r)return{blocked:!1,weight:0};const l=r.weight??1,u=r.windowMs,f=s-u,h=wM(t,f);let m=0;for(const p of h)m+=p.weight;return m+l>r.maxWeight?{blocked:!0}:{blocked:!1,weight:l}}function CM(t,a,s){if(s<=0)return;const r=Vc.get(t)??[];r.push({time:a,weight:s}),Vc.set(t,r)}function _M(t){const a=(nr.get(t)??0)+1;nr.set(t,a)}function TM(t){const a=nr.get(t)??0;if(a<=1){nr.delete(t);return}nr.set(t,a-1)}function Ny(t,a){if(!Number.isFinite(a))return!1;const s=xo.get(t)?.size??0,r=nr.get(t)??0;return s+r>=a}function RM(t,a){let s=xo.get(t);s||(s=new Set,xo.set(t,s)),s.add(a);let r=!1;const l=()=>{if(r)return;r=!0;const u=xo.get(t);u?.delete(a),u&&u.size===0&&xo.delete(t)};if(typeof a.addEventListener=="function")a.addEventListener("ended",()=>{l()},{once:!0});else{const u=a.onended;a.onended=()=>{try{u?.call(a)}finally{l()}}}return l}function NM(t,a){const s=jt.node;if(!s||s.context!==t){jt.node?.disconnect();const r=t.createGain();return r.gain.value=1,r.connect(a),jt.node=r,jt.destination=a,jt.envelope=0,jt.lastUpdate=t.currentTime,r}return jt.destination!==a&&(s.disconnect(),s.connect(a),jt.destination=a),s}function kM(t){const a=jt.node;if(!a)return;const s=t.currentTime,r=.6,l=.55,u=Math.max(0,s-jt.lastUpdate),f=Math.exp(-u/r);jt.envelope*=f,jt.envelope=Math.min(1,jt.envelope+l),jt.lastUpdate=s;const p=Math.max(.35,1-jt.envelope*.5),g=.02;a.gain.cancelScheduledValues(s),a.gain.setValueAtTime(a.gain.value,s),a.gain.linearRampToValueAtTime(p,s+g),a.gain.setTargetAtTime(1,s+g,r)}function DM(t){const a=om("music");if(!a)return;const s=Yc("master"),r=Yc("music");if(s.muted||r.muted)return;const l=r.volume;if(l<=0)return;const u=t.currentTime,f=a.gain.value,h=l*(1-fo.depth),m=l*fo.floor,p=Math.min(f,Math.max(h,m));a.gain.cancelScheduledValues(u),a.gain.setValueAtTime(f,u),a.gain.linearRampToValueAtTime(p,u+fo.attackSeconds),a.gain.setTargetAtTime(l,u+fo.attackSeconds,fo.releaseSeconds)}function na(t){if(Ah())return;const a=yM[t];if(!a)return;const s=a.variants;if(!s||s.length===0)return;let r=0,l=s[0];s.length>1&&(r=((_y.get(t)??Math.floor(Math.random()*s.length)-1)+1)%s.length,l=s[r],_y.set(t,r));const u=Ty(),f=AM(t,a,u);if(f.blocked)return;const h=Ry(a);if(Ny(t,h))return;_M(t);let m=!1;const p=()=>{m||(TM(t),m=!0)};xM(t,r,l).then(g=>{if(p(),Ah())return;const y=hm();if(!y)return;const v=om("sfx");if(!v)return;const S=Ry(a);if(Ny(t,S))return;const M=y.createBufferSource();M.buffer=g;const _=l.gain;let T=M;if(typeof _=="number"&&_>0&&_!==1){const B=y.createGain();B.gain.value=_,M.connect(B),T=B}const N=t==="attack"?NM(y,v):v;T.connect(N);const O=RM(t,M);try{M.start(),t==="attack"&&kM(y),t==="sisu"&&DM(y);const B=Ty();!f.blocked&&f.weight>0&&CM(t,B,f.weight)}catch(B){console.warn("Unable to start sound",B),O()}}).catch(g=>{p(),!(g instanceof Error&&g.message==="Audio context unavailable")&&console.warn("Failed to play sound",t,g)}).finally(()=>{p()})}function Ah(){return dm()}function LM(t){return wh.add(t),()=>{wh.delete(t)}}typeof document<"u"&&document.addEventListener("click",t=>{t.target instanceof HTMLButtonElement&&na("click")});let ky=dm();lm(t=>{const a=t.channels.master.muted||t.channels.sfx.muted;a!==ky&&(ky=a,bM())});function hm(){return dc||(dc=rm(),dc)}hm();const Dy="__autobattlesAudioEvents__",Ly=globalThis;Ly[Dy]||(se.on("unitDamaged",t=>{!t||t.amount<=0||na("attack")}),se.on("unitDied",()=>{na("death")}),se.on("sisuBurstStart",()=>{na("sisu")}),Ly[Dy]=!0);const UM=[{content:{id:"command-briefing",headline:"Command Briefing: Ember Shift",body:"Sauna Command uplinks a focused playbook for your opening salvo. Keep the roster nimble, channel the ember currents, and set the tone for this run.",art:"/assets/ui/saunoja-roster.svg",typography:"serif",animation:"aurora",accentColor:"#7bdff2",acknowledgeText:"Deploy the roster"},trigger:{type:"time",in:2}},{content:{id:"recon-telemetry",headline:"Recon Telemetry Uploaded",body:"Forward drones stitched together a glacial panorama of enemy routes. Prioritize rapid response teams while the snowpack is still undisturbed.",art:"/assets/ui/resource.svg",typography:"sans",animation:"pulse",accentColor:"#fbcfe8",acknowledgeText:"Queue countermeasures"},trigger:{type:"time",in:12}},{content:{id:"supply-courier",headline:"Sauna Courier Docked",body:"A lacquered supply skiff glides into the bay with artisan tonics and reinforced stave kits. Decide how to allocate the haul before the next assault.",art:"/assets/ui/sauna-beer.svg",typography:"serif",animation:"tilt",accentColor:"#fde68a",choices:[{id:"frontline",label:"Stage for the frontline",description:"Prep the vanguard with the premium kit as morale surges.",accent:"primary"},{id:"reserve",label:"Stock the reserves",description:"Archive the crate for a later wave when pressure spikes.",accent:"ghost"}]},trigger:{type:"time",in:24}}];function OM(t=Co){for(const a of UM)t.schedule(a)}OM();function qM(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function zM(t){const a={};if(!t)return a;for(const[s,r]of Object.entries(t))typeof r=="function"&&(a[s]=r);return a}class BM{constructor(a=se){this.emitter=a}modifiers=new Map;hookIndex=new Map;listeners=new Map;add(a){if(typeof a.id!="string"||a.id.length===0)throw new Error("Modifier id must be a non-empty string");if((typeof a.duration!="number"||!Number.isFinite(a.duration))&&a.duration!==1/0)throw new Error("Modifier duration must be a positive number or Infinity");if(Number.isFinite(a.duration)&&a.duration<=0)throw new Error("Modifier duration must be greater than zero");const s=zM(a.hooks),r=qM();this.modifiers.has(a.id)&&this.remove(a.id,"replaced");const l={...a,hooks:s,remaining:a.duration,appliedAt:r};this.modifiers.set(l.id,l),this.indexHooks(l);const u={runtime:this,modifier:l};return a.onApply?.(u),this.emit("modifierAdded",{modifier:l}),this.emitter?.emit("modifierAdded",{modifier:l}),Number.isFinite(l.remaining)&&l.remaining<=0&&this.remove(l.id,"expired"),l}has(a){return this.modifiers.has(a)}list(){return Array.from(this.modifiers.values()).map(a=>({...a,hooks:{...a.hooks}}))}remove(a,s="manual"){const r=this.modifiers.get(a);if(!r)return!1;this.modifiers.delete(a),this.unindexHooks(r);const l={runtime:this,modifier:r,reason:s};return r.onExpire?.(l),s==="expired"&&(this.emit("modifierExpired",{modifier:r}),this.emitter?.emit("modifierExpired",{modifier:r})),this.emit("modifierRemoved",{modifier:r,reason:s}),this.emitter?.emit("modifierRemoved",{modifier:r,reason:s}),!0}advance(a){if(typeof a!="number"||a<=0)return;const s=[];for(const r of this.modifiers.values())Number.isFinite(r.remaining)&&(r.remaining=Math.max(0,r.remaining-a),r.remaining<=0&&s.push(r.id));for(const r of s)this.remove(r,"expired")}trigger(a,s){const r=this.hookIndex.get(a);if(!r||r.size===0)return;const l=Array.from(r);for(const u of l){const f=this.modifiers.get(u);if(!f){r.delete(u);continue}const h=f.hooks[a];if(!h){r.delete(u);continue}h(s,{runtime:this,modifier:f})}}clear(){const a=Array.from(this.modifiers.keys());for(const s of a)this.remove(s,"manual")}on(a,s){const r=this.listeners.get(a)??new Set;r.add(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);r&&(r.delete(s),r.size===0&&this.listeners.delete(a))}emit(a,s){const r=this.listeners.get(a);if(!(!r||r.size===0))for(const l of Array.from(r))l(s)}indexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s)??new Set;r.add(a.id),this.hookIndex.set(s,r)}}unindexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s);r&&(r.delete(a.id),r.size===0&&this.hookIndex.delete(s))}}}const pu=new BM,HM=t=>pu.add(t),IM=(t,a="manual")=>pu.remove(t,a),jM=t=>{pu.advance(t)},hc=(t,a)=>{pu.trigger(t,a)};class GM{constructor(a,s,r){this.owner=a,this.entries=s,this.log=r}runTick(a,s){for(const{definition:r,state:l}of this.entries){if(!r.onTick)continue;const u=r.onTick({owner:this.owner,state:l,self:a,opponent:s}),f=Xi(u?.shieldDamage??0);if(f>0){const m=Math.min(a.shield,f);m>0&&(a.shield-=m,this.log.tickShieldDamage+=m)}const h=Xi(u?.hpDamage??0);if(h>0){const m=Math.min(a.health,h);m>0&&(a.health-=m,this.log.tickHpDamage+=m)}}}grantShield(a,s){let r=0;for(const{definition:l,state:u}of this.entries){if(!l.onGrantShield)continue;const f=Xi(l.onGrantShield({owner:this.owner,state:u,self:a,opponent:s})??0);f>0&&(r+=f)}return r>0&&(a.shield+=r,this.log.shieldGranted+=r),r}consumeShield(a,s,r){let l=Xi(a);if(l<=0)return 0;let u=0;for(const{definition:f,state:h}of this.entries){if(!f.onConsumeShield||l<=0)continue;const m=Xi(f.onConsumeShield({owner:this.owner,state:h,self:s,opponent:r,amount:l})??0);if(m<=0)continue;const p=Math.min(l,m);u+=p,l-=p}return u>0&&(this.log.shieldConsumed+=u),u}applyHit(a,s,r){if(a<=0)return 0;let l=0;for(const{definition:h,state:m}of this.entries){if(!h.onHit)continue;const p=Xi(h.onHit({owner:this.owner,state:m,self:s,opponent:r,hpDamage:a})??0);p>0&&(l+=p)}if(l<=0)return 0;const u=Math.max(0,s.maxHealth-s.health);if(u<=0)return 0;const f=Math.min(u,l);return f>0&&(s.health+=f,this.log.lifesteal+=f),f}getShieldValue(){let a=0;for(const{definition:s,state:r}of this.entries){if(!s.onGrantShield||r.keyword!=="Shield")continue;const l=Ch(r);if(l<=0)continue;const u=Math.max(0,Number.isFinite(r.stacks)?r.stacks:0);u<=0||(a+=u*l)}return a}}function FM(){return{attacker:Oy(),defender:Oy()}}function Uy(t,a,s){const r=$M(t);if(r.length===0)return null;const l=[];for(const u of r){const f=w2.get(u.keyword);f&&l.push({state:u,definition:f})}return l.length===0?null:new GM(a,l,s)}const w2=new Map;function gu(t,a){w2.set(t,a)}function Oy(){return{tickHpDamage:0,tickShieldDamage:0,shieldGranted:0,shieldConsumed:0,lifesteal:0,keywordShieldRemaining:0}}function Xi(t){return typeof t!="number"||!Number.isFinite(t)?0:t>0?t:0}function lr(t){return typeof t!="number"||!Number.isFinite(t)?0:t>0?t:0}function Io(t){return typeof t!="number"||!Number.isFinite(t)?0:t>0?t:0}function $M(t){if(!t)return[];const a=[],s=t;if(typeof s[Symbol.iterator]=="function"){for(const r of s){const l=qy(r);l&&a.push(l)}return a}if(typeof t=="object")for(const r of Object.values(t)){const l=qy(r);l&&a.push(l)}return a}function qy(t){if(!t||typeof t!="object")return null;const a=t;if(!Object.prototype.hasOwnProperty.call(a,"stacks"))return null;const s=YM(a.keyword);if(!s)return null;const r=a;return r.keyword=s,r.stacks=lr(r.stacks),Object.prototype.hasOwnProperty.call(a,"potency")&&r.potency!==void 0&&(r.potency=Io(r.potency)),r}function YM(t){if(typeof t!="string")return null;switch(t.trim().toLowerCase()){case"bleed":return"Bleed";case"burn":return"Burn";case"lifesteal":case"life-steal":return"Lifesteal";case"shield":return"Shield";default:return null}}function Ch(t){const a=t.potency!==void 0?Io(t.potency):1;return a>0?a:0}function VM(t){if(t.potency!==void 0){const r=Io(t.potency);return r>0?r:0}const a=lr(t.stacks);if(a<=0)return 0;const s=a*.2;return s>0?s:0}gu("Bleed",{onTick({state:t,self:a}){const s=lr(t.stacks);if(s<=0||a.health<=0){t.stacks=s;return}const r=t.potency!==void 0?Io(t.potency):1,l=s*r;if(l<=0)return;const u=Math.min(a.health,l);return t.stacks=Math.max(0,s-1),{hpDamage:u}}});gu("Burn",{onTick({state:t,self:a}){const s=lr(t.stacks);if(s<=0){t.stacks=s;return}const r=t.potency!==void 0?Io(t.potency):1,l=s*r;if(l<=0)return;const u=Math.min(a.shield,l),f=l-u,h=Math.min(a.health,f);return t.stacks=Math.max(0,s-1),{shieldDamage:u,hpDamage:h}}});gu("Shield",{onGrantShield({state:t}){const a=lr(t.stacks);if(a<=0)return t.stacks=a,0;const s=a*Ch(t);return s>0?s:0},onConsumeShield({state:t,amount:a}){const s=lr(t.stacks);if(s<=0)return t.stacks=0,0;const r=Ch(t);if(r<=0)return t.stacks=0,0;const l=s*r;if(l<=0)return t.stacks=0,0;const u=Math.min(l,Xi(a)),f=u/r;return t.stacks=Math.max(0,s-f),u>0?u:0}});gu("Lifesteal",{onHit({state:t,hpDamage:a}){if(a<=0)return 0;const s=VM(t);if(s<=0)return 0;const r=a*s;return r>0?r:0}});function Un(t){return Number.isFinite(t)?Math.max(0,t):0}function zy(t,a){const s=Un(a?.health??t?.health??0),r=Un(a?.shield??t?.shield??0);return{id:t?.id??"unknown",faction:t?.faction,health:s,maxHealth:t?.maxHealth,shield:r}}function By(t){if(!t)return!1;const a=t;return typeof a.onHit=="function"||typeof a.onKill=="function"||Array.isArray(a.onHit)||Array.isArray(a.onKill)}function Hy(t){return t?Array.isArray(t)?t.filter(a=>typeof a=="function"):typeof t=="function"?[t]:[]:[]}function XM(t){if(!t)return[];if(typeof t[Symbol.iterator]=="function"){const s=[];for(const r of t)By(r)&&s.push(r);return s}return Object.values(t).filter(s=>By(s))}function mc(t,a,s){if(!t)return;const r=Hy(t.hooks?.[a]);for(const u of r)u(s);const l=XM(t.keywords);for(const u of l)for(const f of Hy(u[a]))f(s)}function Iy(t){const a=Un(t?.health??0),s=Un(t?.maxHealth??a);return{health:a,maxHealth:Math.max(s,a),shield:Un(t?.shield??0)}}function KM(){return{health:0,maxHealth:0,shield:0}}function QM(t){const a=t.attacker??null,s=t.defender,r=t.baseDamage,l=Un(t.minimumDamage??1),u=Number.isFinite(r)?Un(r):Un(a?.attack??0),f=Un(s.defense??0),h=FM(),m=Iy(s),p=a?Iy(a):null,g=Uy(s.keywords??null,"defender",h.defender),y=a?Uy(a.keywords??null,"attacker",h.attacker):null,v=p??KM();g&&g.runTick(m,v),y&&p&&y.runTick(p,m);const S=m.health>0,M=Un(m.shield);g&&g.grantShield(m,v);const _=Un(m.shield),T=S?Math.max(l,u-f):0,N=S?Math.min(_,T):0,O=S?Math.max(0,T-N):0;m.shield=Math.max(0,_-N);const B=Math.min(M,N),Y=Math.max(0,N-B);g&&Y>0&&g.consumeShield(Y,m,v);const X=g?g.getShieldValue():0;h.defender.keywordShieldRemaining=X;const V=Math.max(0,M-B);m.shield=V+X;const W=m.health;m.health=Math.max(0,W-O);const ne=m.health,F=ne<=0;let H=0;y&&p?(H=y.applyHit(O,p,m),h.attacker.keywordShieldRemaining=y.getShieldValue()):h.attacker.keywordShieldRemaining=0;const C=zy(a,p??void 0),J=zy(s,{health:ne,shield:V+X}),I={attacker:C,defender:J,damage:T,shieldDamage:N,hpDamage:O,lethal:F},ae={...I,source:"defender"};if(mc(s,"onHit",ae),hc("combat:onHit",ae),a){const $={...I,source:"attacker"};mc(a,"onHit",$),hc("combat:onHit",$),F&&(mc(a,"onKill",$),hc("combat:onKill",$))}return F&&(mc(s,"onKill",ae),hc("combat:onKill",ae)),{damage:T,shieldDamage:N,hpDamage:O,lethal:F,remainingHealth:ne,remainingShield:V+X,attackerHealing:H,attackerRemainingHealth:p?.health,attackerRemainingShield:p?.shield,keywordEffects:h}}const jy=5;function cn(t){return`${t.q},${t.r}`}function Gy(t){const[a,s]=t.split(",").map(Number);return{q:a,r:s}}function Vs(t){return{q:t.q,r:t.r}}class PM{constructor(a,s,r,l,u,f=[],h){this.id=a,this.type=s,this.faction=l,this.stats=u,this.priorityFactions=f,this.coord=Vs(r),this.renderCoord=Vs(r),this.maxHealth=u.health,this.behavior=h??(l==="player"?"defend":"attack")}alive=!0;listeners={};maxHealth;healMarkerElapsed=0;healAmountBuffer=0;cachedTargetKey;cachedStartKey;cachedPath;movementCooldownSeconds=0;shield=0;immortal=!1;experience=0;behavior;combatHooks=null;combatKeywords=null;coord;renderCoord;setCoord(a,s){this.coord=Vs(a),(s?.snapRender??!0)&&(this.renderCoord=Vs(a))}setRenderCoord(a){this.renderCoord=Vs(a)}snapRenderToCoord(a=this.coord){this.renderCoord=Vs(a)}onDeath(a){(this.listeners.death??=[]).push(a)}emitDeath(){for(const a of this.listeners.death??[])a()}isDead(){return!this.alive}getMaxHealth(){return this.maxHealth}distanceTo(a){return Js(this.coord,a)}getVisionRange(){const{visionRange:a}=this.stats;return Number.isFinite(a)?a:3}getBehavior(){return this.behavior}setBehavior(a){this.behavior=a}attack(a){return this.distanceTo(a.coord)>this.stats.attackRange?null:a.takeDamage(this.stats.attackDamage,this)}update(a,s){if(!(this.isDead()||!s))if(Js(this.coord,s.pos)<=s.auraRadius){const r=this.stats.health;if(this.stats.health=Math.min(this.stats.health+s.regenPerSec*a,this.maxHealth),this.stats.health>r){const l=this.stats.health-r;this.healMarkerElapsed+=a,this.healAmountBuffer+=l,(this.healMarkerElapsed>=.9||this.healAmountBuffer>=2)&&this.flushHealEvent()}}else this.healAmountBuffer>0&&this.flushHealEvent(),this.healMarkerElapsed=0,this.healAmountBuffer=0}flushHealEvent(){if(this.healAmountBuffer<=0){this.healMarkerElapsed=0;return}const a=Math.round(this.healAmountBuffer*10)/10;a>0&&se.emit("unitHealed",{unitId:this.id,amount:a,remainingHealth:this.stats.health}),this.healAmountBuffer=0,this.healMarkerElapsed=0}takeDamage(a,s){const r=Number.isFinite(a);if(r&&a<=0||!r&&!s)return null;const l=s?s.toCombatParticipant():null,u=this.toCombatParticipant(),f=QM({attacker:l,defender:u,baseDamage:r?a:void 0});this.stats.health=f.remainingHealth,this.shield=f.remainingShield;let h=f;if(f.lethal&&this.alive&&this.immortal&&(this.stats.health=Math.max(1,this.stats.health),h={...f,lethal:!1,remainingHealth:this.stats.health,remainingShield:this.shield}),s&&f.attackerRemainingHealth!==void 0){const m=Math.min(s.getMaxHealth(),Math.max(0,f.attackerRemainingHealth));s.stats.health=m}return s&&f.attackerRemainingShield!==void 0&&s.setShield(f.attackerRemainingShield),h.damage>0&&se.emit("unitDamaged",{attackerId:s?.id,targetId:this.id,amount:h.damage,remainingHealth:this.stats.health}),h.lethal&&this.alive&&(this.stats.health=0,this.alive=!1,this.snapRenderToCoord(),se.emit("unitDied",{unitId:this.id,attackerId:s?.id,unitFaction:this.faction,attackerFaction:s?.faction}),this.emitDeath()),h}getShield(){return this.shield}setShield(a){if(!Number.isFinite(a)||a<=0){this.shield=0;return}this.shield=a}updateStats(a){this.stats.attackDamage=a.attackDamage,this.stats.attackRange=a.attackRange,this.stats.movementRange=a.movementRange,typeof a.defense=="number"&&Number.isFinite(a.defense)?this.stats.defense=a.defense:delete this.stats.defense,typeof a.visionRange=="number"&&Number.isFinite(a.visionRange)&&(this.stats.visionRange=a.visionRange);const s=Math.max(1,Math.round(a.health));this.maxHealth=s,this.stats.health=Math.min(s,Math.max(0,this.stats.health))}isImmortal(){return this.immortal}setImmortal(a){this.immortal=!!a}getExperience(){return this.experience}setExperience(a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;s!==this.experience&&(this.experience=s,se.emit("unit:xpChanged",{unitId:this.id,xp:this.experience}))}addExperience(a){if(!Number.isFinite(a)||a===0)return this.experience;const s=Math.max(0,Math.floor(this.experience+a));return this.setExperience(s),this.experience}toCombatParticipant(){return{id:this.id,faction:this.faction,attack:this.stats.attackDamage,defense:this.stats.defense,health:this.stats.health,maxHealth:this.maxHealth,shield:this.shield,hooks:this.combatHooks,keywords:this.combatKeywords}}addMovementTime(a){!Number.isFinite(a)||a<=0||(this.movementCooldownSeconds+=a)}canStep(a=jy){return this.movementCooldownSeconds>=a}consumeMovementCooldown(a=jy){return this.canStep(a)?(this.movementCooldownSeconds-=a,!0):!1}moveTowards(a,s,r){const l=this.getPathTo(a,s,r);if(l.length<2)return[];let u=0;const f=cn(a);for(let m=1;m<l.length;m++){const p=cn(l[m]);if(r.has(p)){p!==f&&this.clearPathCache();break}u=m}if(u===0)return[];const h=Math.min(this.stats.movementRange,u);return l.slice(0,h+1)}getPathTo(a,s,r){const l=cn(this.coord),u=cn(a);return(!this.cachedPath||this.cachedTargetKey!==u||this.cachedStartKey!==l)&&(this.cachedPath=this.findPath(a,s,r),this.cachedTargetKey=u,this.cachedStartKey=l),this.cachedPath}advancePathCache(a){!this.cachedPath||a<=0||(this.cachedPath=this.cachedPath.slice(a),this.cachedPath.length>0?this.cachedStartKey=cn(this.cachedPath[0]):(this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0))}clearPathCache(){this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0}findPath(a,s,r){const l=this.coord,u=cn(l),f=cn(a),h=new Set([u]),m=new Map([[u,null]]),p=new Map([[u,0]]),g=new Map([[u,Js(l,a)]]);for(;h.size>0;){let S=null,M=1/0;for(const N of h){const O=g.get(N)??1/0;O<M&&(M=O,S=N)}if(S===null||S===f)break;h.delete(S);const _=Gy(S),T=p.get(S)??1/0;for(const N of Hc(_)){const O=cn(N);if(O!==f&&!this.isPassable(N,s,r))continue;const B=T+1;B<(p.get(O)??1/0)&&(m.set(O,S),p.set(O,B),g.set(O,B+Js(N,a)),h.add(O))}}if(!m.has(f))return[l];const y=[];let v=f;for(;v;)y.push(Gy(v)),v=m.get(v)??null;return y.reverse()}seekNearestEnemy(a,s,r){const l=new Map;for(const h of a)l.set(cn(h.coord),h);const u=[this.coord],f=new Set([cn(this.coord)]);for(;u.length>0;){const h=u.shift(),m=cn(h),p=l.get(m);if(p)return p;for(const g of Hc(h)){const y=cn(g),v=l.get(y);if(v)return v;this.isPassable(g,s,r)&&(f.has(y)||(f.add(y),u.push(g)))}}return null}canTraverse(a,s,r){return this.isPassable(a,s,r)}isPassable(a,s,r){const l=s.getTile(a.q,a.r);return!l||r&&r.has(cn(a))?!1:l.terrain!==xn.Lake}}class ZM{static selectTarget(a,s){let r=s.filter(u=>u.faction!==a.faction&&!u.isDead());if(r.length===0)return null;if(a.priorityFactions.length>0){const u=r.filter(f=>a.priorityFactions.includes(f.faction));u.length>0&&(r=u)}const l=r.filter(u=>a.distanceTo(u.coord)<=a.stats.attackRange);return l.length>0?(l.sort((u,f)=>u.stats.health-f.stats.health),l[0]):(r.sort((u,f)=>a.distanceTo(u.coord)-a.distanceTo(f.coord)),r[0]??null)}}const JM=4,WM=8;class ex{buckets=[];bucketCount=0;currentBucket=0;minBuckets;maxBuckets;constructor(a={}){this.minBuckets=a.minBuckets??JM,this.maxBuckets=a.maxBuckets??WM}reset(){this.buckets=[],this.bucketCount=0,this.currentBucket=0}next(a){const s=a.length;if(s===0)return this.reset(),[];const r=this.computeBucketCount(s);r!==this.bucketCount&&(this.bucketCount=r,this.currentBucket=this.currentBucket%Math.max(1,r)),this.rebuildBuckets(a);const l=this.buckets[this.currentBucket]??[];return this.bucketCount>0&&(this.currentBucket=(this.currentBucket+1)%this.bucketCount),l}rebuildBuckets(a){const s=this.bucketCount;this.buckets=Array.from({length:s},()=>[]);const r=[...a].sort((l,u)=>l.id.localeCompare(u.id));for(let l=0;l<r.length;l++){const u=l%s;this.buckets[u].push(r[l])}}computeBucketCount(a){if(a<=0)return 0;const s=Math.ceil(a/12);let r=Math.max(this.minBuckets,s);return r=Math.min(this.maxBuckets,r),r=Math.min(r,a),r=Math.max(1,r),r}}function If(t){return`${t.q},${t.r}`}const tx=500;class nx{cache=new Map;targetIndex=new Map;targetPositions=new Map;ttlMs;constructor(a=tx){this.ttlMs=a}clearExpired(a=Date.now()){for(const[s,r]of this.cache.entries())if(r.expiresAt<=a&&(this.cache.delete(s),r.targetId)){const l=this.targetIndex.get(r.targetId);l?.delete(s),l&&l.size===0&&this.targetIndex.delete(r.targetId)}}trackUnit(a){this.invalidateIfTargetMoved(a.id,If(a.coord))}invalidateForUnit(a){const s=this.targetIndex.get(a);if(s){for(const r of s)this.cache.delete(r);this.targetIndex.delete(a)}this.targetPositions.delete(a)}getPath(a,s,r,l,u={}){const f=u.now??Date.now(),h=u.targetId,m=If(s);h&&this.invalidateIfTargetMoved(h,m);const p=this.hashObstacles(l),g=this.createCacheKey(If(a.coord),m,p),y=this.cache.get(g);if(y&&y.expiresAt>f)return y.path;a.clearPathCache();const v=a.getPathTo(s,r,l);if(this.cache.set(g,{path:v,expiresAt:f+this.ttlMs,targetId:h}),h){let S=this.targetIndex.get(h);S||(S=new Set,this.targetIndex.set(h,S)),S.add(g),this.targetPositions.set(h,m)}return v}invalidateIfTargetMoved(a,s){const r=this.targetPositions.get(a);if(!r){this.targetPositions.set(a,s);return}if(r===s)return;const l=this.targetIndex.get(a);if(l){for(const u of l)this.cache.delete(u);l.clear()}this.targetPositions.set(a,s)}hashObstacles(a){return a.size===0?"empty":Array.from(a).sort().join("|")}createCacheKey(a,s,r){return`${a}->${s}|${r}`}}const ax={baseThreshold:50,heatPerSecond:50/30,thresholdGrowth:.05,coolingPerSecond:0};function Bt(t,a=0){return Number.isFinite(t)?t:a}class ix{heat;threshold;baseThreshold;thresholdGrowthFactor;heatPerSecond;coolingPerSecond;maxStoredHeat;constructor(a={}){const s={...ax,...a},r=Math.max(1,Bt(s.baseThreshold,50)),l=Math.max(1,Bt(a.initialThreshold??r,r));this.baseThreshold=r,this.threshold=l,this.thresholdGrowthFactor=1+Math.max(0,Bt(s.thresholdGrowth,0)),this.heatPerSecond=Math.max(0,Bt(s.heatPerSecond,0)),this.coolingPerSecond=Math.max(0,Bt(s.coolingPerSecond,0));const u=Bt(s.maxStoredHeat??Number.NaN,Number.NaN);this.maxStoredHeat=Number.isFinite(u)&&u>=0?u:null;const f=Math.max(0,Bt(a.initialHeat??0,0));this.heat=this.setHeatInternal(f)}getHeat(){return this.heat}getThreshold(){return this.threshold}getBuildRate(){return this.heatPerSecond}getCoolingRate(){return this.coolingPerSecond}reset(){this.heat=0,this.threshold=this.baseThreshold}setHeat(a){const s=Math.max(0,Bt(a,0));return this.heat=this.setHeatInternal(s),this.heat}setHeatInternal(a){const s=Math.max(0,Bt(a,0));return this.maxStoredHeat===null?(this.heat=s,this.heat):(this.heat=Math.min(s,this.maxStoredHeat),this.heat)}addHeat(a){const s=Math.max(0,Bt(a,0));if(s<=0)return 0;const r=this.heat,l=r+s;return this.heat=this.maxStoredHeat===null?l:Math.min(l,this.maxStoredHeat),this.heat-r}cool(a){const s=Math.max(0,Bt(a,0));if(s<=0||this.heat<=0)return 0;const r=this.heat;return this.heat=Math.max(0,this.heat-s),r-this.heat}vent(a=1){const s=Math.max(0,Math.min(1,Bt(a,1)));return s<=0?0:this.cool(this.threshold*s)}advance(a,s){const r=Math.max(0,Bt(a,0)),l=this.heatPerSecond,u=r>0?l*r:0,f=Math.max(0,Bt(s?.bonusHeat??0,0)),h=u+f,m=this.addHeat(h),p=Math.max(0,Bt(s?.coolingMultiplier??1,1)),g=r>0?this.coolingPerSecond*r*p:0,y=this.cool(g);return{addedHeat:m,cooledHeat:y,heat:this.heat}}hasTriggerReady(){return this.heat>=this.threshold-1e-6}consumeTrigger(){return this.hasTriggerReady()?(this.cool(this.threshold),this.threshold=Math.max(this.baseThreshold,this.threshold*this.thresholdGrowthFactor),!0):!1}timeUntilNextTrigger(){return this.hasTriggerReady()?0:this.heatPerSecond<=0?Number.POSITIVE_INFINITY:Math.max(0,this.threshold-this.heat)/this.heatPerSecond}getCooldownSeconds(){return this.heatPerSecond<=0?Number.POSITIVE_INFINITY:this.threshold/this.heatPerSecond}}function sx(t){return new ix(t)}const Fy=500,rx=4;function A2(t,a,s){const r=typeof a=="number"?a:2,l=(typeof a=="number"?s:a)??[],u=[];for(let h=-r;h<=r;h++){const m=Math.max(-r,-h-r),p=Math.min(r,-h+r);for(let g=m;g<=p;g++){const y=Math.max(Math.abs(h),Math.abs(g),Math.abs(-h-g));if(y===0||y>r)continue;const v={q:t.q+h,r:t.r+g};l.some(M=>!M.isDead()&&M.coord.q===v.q&&M.coord.r===v.r)||u.push(v)}}if(u.length===0)return null;const f=Math.floor(Math.random()*u.length);return u[f]}function ox(t,a,s={}){const r=sx(a),l=r.getBuildRate(),u=r.getCooldownSeconds(),f=r.timeUntilNextTrigger(),h=Number.isFinite(s.maxRosterSize)?Math.max(0,Math.floor(s.maxRosterSize??0)):0,m=Number.isFinite(s.maxHealth)?Math.max(1,Math.floor(s.maxHealth??Fy)):Fy,p=Number.isFinite(s.health)?Math.max(0,Math.min(m,Math.floor(s.health??m))):m,g=Number.isFinite(s.visionRange)?Math.max(0,Math.floor(s.visionRange??0)):Math.max(0,Math.floor(s.tier?.visionRange??rx));return{id:"sauna",pos:t,auraRadius:2,visionRange:g,regenPerSec:1,rallyToFront:!1,maxRosterSize:h,maxHealth:m,health:p,destroyed:p<=0,heat:r.getHeat(),heatPerTick:l,playerSpawnThreshold:r.getThreshold(),playerSpawnCooldown:Number.isFinite(u)?u:0,playerSpawnTimer:Number.isFinite(f)?f:0,beerUpkeepAccumulator:0,heatTracker:r}}function lx(t,a){if(!Number.isFinite(a)||a<=0||t.destroyed)return{amount:0,remainingHealth:Math.max(0,t.health),destroyed:t.destroyed};const s=Math.max(0,t.health),r=Math.min(s,Math.max(0,Math.floor(a))),l=Math.max(0,s-r);return t.health=l,l<=0&&(t.health=0,t.destroyed=!0),{amount:r,remainingHealth:t.health,destroyed:t.destroyed}}const cx=30;function Ht(t){return`${t.q},${t.r}`}class ux{constructor(a,s){this.map=a,this.animator=s}scheduler=new ex;pathCache=new nx;lastKnownCoords=new Map;findExplorationGoal(a,s){const r=a.coord;if(this.map.ensureTile(r.q,r.r).isFogged&&a.canTraverse(r,this.map,s))return r;const u=new Set([Ht(r)]),f=[r];for(;f.length>0;){const h=f.shift(),m=Hc(h),p=this.map.getNeighbors(h.q,h.r);for(let g=0;g<m.length;g++){const y=m[g],v=p[g],S=Ht(y);if(!u.has(S)&&(u.add(S),!!a.canTraverse(y,this.map,s))){if(v.isFogged)return y;f.push(y)}}}return null}tick(a,s,r){const l=a.length,u=Date.now();if(this.pathCache.clearExpired(u),l===0){this.scheduler.reset();return}const f=new Set,h=[],m=new Set;for(const g of a){if(g.addMovementTime(s),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g),this.lastKnownCoords.delete(g.id);continue}const y=this.lastKnownCoords.get(g.id);y&&Js(y,g.coord)>1&&this.animator?.clear(g,{snap:!0}),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r}),this.pathCache.trackUnit(g),h.push(g),f.add(Ht(g.coord)),m.add(g.id)}for(const g of[...this.lastKnownCoords.keys()])m.has(g)||this.lastKnownCoords.delete(g);if(h.length===0){this.scheduler.reset();return}const p=this.scheduler.next(h);if(p.length!==0)for(const g of p){const y=Ht(g.coord);if(f.delete(y),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g);continue}const v=ZM.selectTarget(g,a);if(!v&&r&&!r.destroyed&&this.tryAttackSauna(g,r)){const O=Ht(g.coord);f.add(O);continue}if(!v){let N=null;if(r&&!r.destroyed&&(N=r.pos),N||(N=this.findExplorationGoal(g,f)),N){const B=this.computeMovementPath(g,N,f,u);if(B.length>1&&g.stats.movementRange>0){const Y=B[1],X=Ht(Y);if(f.has(X))g.clearPathCache();else{if(!g.canStep()){f.add(y);continue}if(g.consumeMovementCooldown()){const V={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(Y,{snapRender:!1}),this.animator.enqueue(g,[V,Y])):g.setCoord(Y),g.advancePathCache(1);const W=Ht(g.coord);W===Ht(N)&&g.clearPathCache(),f.add(W),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});continue}}}else g.clearPathCache()}else g.clearPathCache();const O=Ht(g.coord);f.add(O),r&&!r.destroyed&&this.tryAttackSauna(g,r);continue}if(v.isDead()){g.clearPathCache(),f.add(y);continue}const S=Ht(v.coord),M=this.pathCache.getPath(g,v.coord,this.map,f,{now:u,targetId:v.id});if(M.length>1&&g.stats.movementRange>0){const N=M[1],O=Ht(N),B=O===S;if(!f.has(O)||B){if(g.canStep()&&g.consumeMovementCooldown()){const Y={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(N,{snapRender:!1}),this.animator.enqueue(g,[Y,N])):g.setCoord(N),g.advancePathCache(1)}}else g.clearPathCache()}const _=Ht(g.coord);f.add(_),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});const T=Ht(v.coord);T!==S&&g.clearPathCache(),g.distanceTo(v.coord)<=g.stats.attackRange&&!v.isDead()&&((g.attack(v)?.lethal??!1)||v.isDead())&&(f.delete(T),g.clearPathCache(),this.pathCache.invalidateForUnit(v.id),this.animator?.clear(v))}}tryAttackSauna(a,s){if(a.faction==="player")return!1;const r=a.stats.attackRange;if(r<=0||a.distanceTo(s.pos)>r)return!1;const l=lx(s,a.stats.attackDamage);if(l.amount<=0)return!1;const u={attackerId:a.id,attackerFaction:a.faction,amount:l.amount,remainingHealth:l.remainingHealth};if(se.emit("saunaDamaged",u),l.destroyed){const f={attackerId:a.id,attackerFaction:a.faction};se.emit("saunaDestroyed",f)}return!0}computeMovementPath(a,s,r,l){const u=this.pathCache.getPath(a,s,this.map,r,{now:l});if(u.length<2)return[];let f=0;const h=Ht(s);for(let p=1;p<u.length;p++){const g=Ht(u[p]);if(r.has(g)){g!==h&&a.clearPathCache();break}f=p}if(f===0)return[];const m=Math.min(a.stats.movementRange,f);return u.slice(0,m+1)}}function yu(t){if(!Number.isFinite(t??NaN))return 1;const a=Math.floor(t);return Math.max(1,a)}function dx(t){return Math.max(0,yu(t)-1)}function fx(t,a="linear"){const s=dx(t);switch(a){case"accelerating":return s*(s+1)/2;case"diminishing":return s===0?0:Math.log2(s+1);case"linear":default:return s}}function hx(t,a="round"){switch(a){case"floor":return Math.floor(t);case"ceil":return Math.ceil(t);case"none":return t;case"round":default:return Math.round(t)}}function mx(t,a,s){let r=t;return Number.isFinite(a)&&(r=Math.max(r,a)),Number.isFinite(s)&&(r=Math.min(r,s)),r}function ho(t,a){const s=yu(a),r=t.curve??"linear",l=fx(s,r),u=t.base+t.growth*l,f=mx(u,t.min,t.max);return hx(f,t.round??"round")}function jo(t,a){const s=yu(a),r=t.stats,l={health:ho(r.health,s),attackDamage:ho(r.attackDamage,s),attackRange:ho(r.attackRange,s),movementRange:ho(r.movementRange,s)};return r.visionRange&&(l.visionRange=ho(r.visionRange,s)),l}function $y(t){if(typeof t=="number"&&Number.isFinite(t))return t}function Xc(t,a){let s=t.health,r=t.attackDamage,l=t.attackRange,u=t.movementRange,f=$y(t.defense),h=$y(t.shield);for(const p of a){const g=Math.max(1,Math.round(p.quantity)),y=p.modifiers;typeof y.health=="number"&&(s+=y.health*g),typeof y.attackDamage=="number"&&(r+=y.attackDamage*g),typeof y.attackRange=="number"&&(l+=y.attackRange*g),typeof y.movementRange=="number"&&(u+=y.movementRange*g),typeof y.defense=="number"&&(f=(f??0)+y.defense*g),typeof y.shield=="number"&&(h=(h??0)+y.shield*g)}const m={health:Math.max(1,Math.round(s)),attackDamage:Math.max(0,Math.round(r)),attackRange:Math.max(0,Math.round(l)),movementRange:Math.max(0,Math.round(u))};return f!==void 0&&(m.defense=Math.max(0,Math.round(f))),h!==void 0&&(m.shield=Math.max(0,Math.round(h))),typeof t.visionRange=="number"&&Number.isFinite(t.visionRange)&&(m.visionRange=Math.max(0,Math.round(t.visionRange))),m}const mm=Object.freeze({id:"soldier",displayName:"Sauna Soldier",cost:50,tags:["infantry","melee"],stats:{health:{base:20,growth:6,curve:"linear",round:"round"},attackDamage:{base:5,growth:1,curve:"linear",round:"round"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:0,round:"round"}}}),pm=Object.freeze({id:"archer",displayName:"Sauna Archer",cost:75,tags:["ranged"],stats:{health:{base:15,growth:4,curve:"linear",round:"round"},attackDamage:{base:3,growth:.4,curve:"accelerating",round:"ceil"},attackRange:{base:3,growth:.5,curve:"diminishing",round:"ceil",max:5},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:.25,curve:"linear",round:"round",max:5}}}),C2=Object.freeze({id:"avanto-marauder",displayName:"Avanto Marauder",cost:0,tags:["enemy","melee"],stats:{health:{base:12,growth:5,curve:"linear",round:"round"},attackDamage:{base:4,growth:.6,curve:"accelerating",round:"ceil"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:.25,curve:"linear",round:"round",max:2},visionRange:{base:3,growth:0,round:"round"}}}),_2=Object.freeze({soldier:mm,archer:pm,"avanto-marauder":C2});function gm(t){return _2[t]??null}Object.freeze(Object.keys(_2));const Yy=mm.cost;Object.freeze(jo(mm,1));pm.cost;Object.freeze(jo(pm,1));Object.freeze(jo(C2,1));function T2(t,a,s,r,l){const u=yu(l?.level),f=jo(t,u);return new PM(a,t.id,s,r,f,t.priorityFactions,l?.behavior)}function R2(t,a,s,r,l){const u=gm(t);return u?T2(u,a,s,r,l):null}function ym(t,a,s,r,l,u){const f=gm(a);if(!f)return null;const h=f.cost;if(!t.canAfford(h,re.SAUNA_BEER))return na("error"),null;t.addResource(re.SAUNA_BEER,-h);const m=T2(f,s,r,l,u);return na("spawn"),se.emit("unitSpawned",{unit:m}),m}const px=Object.freeze(Object.defineProperty({__proto__:null,createUnit:R2,spawnUnit:ym},Symbol.toStringTag,{value:"Module"})),gx=["Aino","Eero","Ilona","Kalevi","Lumi","Mika","Noora","Oskari","Saana","Tapio","Veera","Yrjö"],yx=["Emberguard","Frostwalker","Steamcaller","Dawnwatch","Gritforged","Stormchant","Snowborn","Torchbearer","Chillwarden","Sisuheart"],bx=["Aalto","Halla","Karhu","Korhonen","Laine","Metsä","Niemi","Salmi","Tuomi","Virta"];function jf(t,a){if(t.length===0)throw new Error("Cannot select a name from an empty collection.");const s=Math.floor(a()*t.length);return t[Math.min(s,t.length-1)]}function vx(t=Math.random){const a=jf(gx,t),s=jf(yx,t),r=jf(bx,t);return`${a} "${s}" ${r}`}const cr=Object.freeze(["supply","weapon","focus","relic"]);function N2(){return{supply:null,weapon:null,focus:null,relic:null}}const Sx=Object.freeze({supply:Object.freeze({id:"supply",label:"Supply Satchel",description:"Consumables and restorative provisions carried into battle.",maxStacks:5}),weapon:Object.freeze({id:"weapon",label:"Primary Armament",description:"The attendant's main weapon or ranged kit.",maxStacks:1}),focus:Object.freeze({id:"focus",label:"Battle Focus",description:"Tools that sharpen aim, steps, or battlefield intuition.",maxStacks:1}),relic:Object.freeze({id:"relic",label:"Sauna Relic",description:"Charms and relics that empower the attendant's resolve.",maxStacks:1})}),Ex=Object.freeze({"birch-sap-satchel":Object.freeze({id:"birch-sap-satchel",slot:"supply",modifiers:{health:3},maxStacks:3}),"steamed-bandages":Object.freeze({id:"steamed-bandages",slot:"supply",modifiers:{shield:4},maxStacks:2}),"aurora-distillate":Object.freeze({id:"aurora-distillate",slot:"supply",modifiers:{attackDamage:2,defense:1},maxStacks:1}),"stolen-sauna-tokens":Object.freeze({id:"stolen-sauna-tokens",slot:"supply",modifiers:{movementRange:.5},maxStacks:5}),"midnight-bloodwine":Object.freeze({id:"midnight-bloodwine",slot:"supply",modifiers:{health:6,attackDamage:1},maxStacks:1}),"sauna-incense":Object.freeze({id:"sauna-incense",slot:"supply",modifiers:{attackRange:1},maxStacks:2}),"glacier-brand":Object.freeze({id:"glacier-brand",slot:"weapon",modifiers:{attackDamage:3},maxStacks:1}),"emberglass-arrow":Object.freeze({id:"emberglass-arrow",slot:"weapon",modifiers:{attackDamage:1,attackRange:2},maxStacks:1}),"aurora-lattice":Object.freeze({id:"aurora-lattice",slot:"focus",modifiers:{attackDamage:2,attackRange:1},maxStacks:1}),"emberglass-shard":Object.freeze({id:"emberglass-shard",slot:"focus",modifiers:{attackDamage:1,movementRange:1},maxStacks:1}),"windstep-totem":Object.freeze({id:"windstep-totem",slot:"focus",modifiers:{movementRange:1,defense:1},maxStacks:1}),"searing-chant-censer":Object.freeze({id:"searing-chant-censer",slot:"focus",modifiers:{attackDamage:2,shield:2},maxStacks:1}),"cracked-ice-amulet":Object.freeze({id:"cracked-ice-amulet",slot:"relic",modifiers:{defense:2},maxStacks:1}),"myrsky-charm":Object.freeze({id:"myrsky-charm",slot:"relic",modifiers:{attackRange:1,defense:1},maxStacks:1}),"frostwyrm-signet":Object.freeze({id:"frostwyrm-signet",slot:"relic",modifiers:{shield:5},maxStacks:1}),"spirit-oak-charm":Object.freeze({id:"spirit-oak-charm",slot:"relic",modifiers:{defense:1,health:2},maxStacks:1})});function Go(t){const a=Sx[t];if(!a)throw new Error(`Unknown equipment slot: ${t}`);return a}function Fo(t){return Ex[t]}function k2(t){return Number.isFinite(t)?Math.max(1,Math.round(t)):1}function D2(t,a){return{id:t.id,name:t.name,description:t.description,icon:t.icon,rarity:t.rarity,quantity:a}}function L2(t,a,s,r){const l=Go(a),u=Math.max(1,Math.floor(s.maxStacks??l.maxStacks)),f=Math.min(u,r),h=s.modifiers??{};return{...D2(t,f),slot:a,maxStacks:u,modifiers:h}}function _h(t){t.equipment||(t.equipment=N2());for(const a of cr)t.equipment[a]??=null;return t.equipment}function qn(t){const a=[];for(const s of cr){const r=t[s];r&&a.push({...r})}return a}function bm(t){return qn(t).map(a=>D2(a,a.quantity))}function Gf(t){const a=N2();for(const s of t){const r=Fo(s.id);if(!r)continue;const l=k2(s.quantity),u=a[r.slot];if(u&&u.id!==s.id)continue;const f=(u?.quantity??0)+l,h=L2(s,r.slot,r,f);a[r.slot]=h}return a}function Mx(t,a){const s=Fo(a.id);if(!s)return{success:!1,slot:"supply",loadout:qn(_h(t)),item:null,reason:"unknown-item"};const r=_h(t),l=s.slot,u=Go(l),f=k2(a.quantity),h=Math.max(1,Math.floor(s.maxStacks??u.maxStacks)),m=r[l];if(m&&m.id!==a.id)return{success:!1,slot:l,loadout:qn(r),item:m,reason:"slot-occupied"};const p=Math.min(h,(m?.quantity??0)+f);if((m?.quantity??0)+f>h)return{success:!1,slot:l,loadout:qn(r),item:m,reason:"stack-limit"};const g=L2(a,l,s,p);return r[l]=g,t.items=bm(r),{success:!0,slot:l,loadout:qn(r),item:g}}function xx(t,a){const s=_h(t),r=s[a];return r?(s[a]=null,t.items=bm(s),{success:!0,slot:a,loadout:qn(s),removed:r}):{success:!1,slot:a,loadout:qn(s),removed:null,reason:"empty-slot"}}function wx(t,a){return Fo(t)?.slot===a}const Ax={q:0,r:0},Cx="Saunoja",Th=18,Vy=0,Oo=1,Rh=4,Kc=1,_x="defend",pc={health:Th,attackDamage:4,attackRange:1,movementRange:1,defense:0,shield:0},Tx=["defend","attack","explore"];function gc(t,a,s){return Math.min(Math.max(t,a),s)}function yc(t,a,s){const r=typeof t=="number"&&Number.isFinite(t)?t:a;return Math.max(s,r)}function Ff(t,a,s=0){if(typeof t=="number"&&Number.isFinite(t))return Math.max(s,t);if(typeof a=="number"&&Number.isFinite(a))return Math.max(s,a)}function Xy(t,a){if(!t||typeof t!="object")return{...a};const s=t,r=yc(s.health,a.health,1),l=yc(s.attackDamage,a.attackDamage,0),u=yc(s.attackRange,a.attackRange,0),f=yc(s.movementRange,a.movementRange,0),h=Ff(s.defense,a.defense,0),m=Ff(s.shield,a.shield,0),p=Ff(s.visionRange,a.visionRange,0);return{health:r,attackDamage:l,attackRange:u,movementRange:f,defense:h,shield:m,visionRange:p}}function Rx(t,a){if(!t||typeof t!="object")return Gf(a);const s=t,r=[];for(const l of Object.values(s)){const u=U2(l);u&&r.push(u)}return r.length===0?Gf(a):Gf(r)}function Nx(t,a=_x){if(typeof t=="string"){const s=t.trim().toLowerCase();if(Tx.includes(s))return s}return a}function U2(t){if(!t||typeof t!="object")return null;const a=t,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const l=typeof a.description=="string"?a.description.trim():void 0,u=typeof a.icon=="string"?a.icon.trim():void 0,f=typeof a.rarity=="string"?a.rarity.trim():void 0,h=typeof a.quantity=="number"?a.quantity:Number(a.quantity),m=Number.isFinite(h)?Math.max(1,Math.round(h)):1;return{id:s,name:r,description:l,icon:u,rarity:f,quantity:m}}function kx(t){if(!t||t.length===0)return[];const a=[];for(const s of t){const r=U2(s);r&&a.push(r)}return a}function Dx(t){if(!t||typeof t!="object")return null;const a=t,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const l=a.duration;let u=1/0;typeof l=="number"&&Number.isFinite(l)?u=Math.max(0,l):l!==1/0&&(u=1/0);const f=a.remaining;let h=u;typeof f=="number"&&Number.isFinite(f)?h=Math.max(0,f):f===1/0&&(h=1/0),u!==1/0&&h===1/0&&(h=u);const m=a.appliedAt,p=typeof m=="number"&&Number.isFinite(m)?Math.max(0,m):void 0,g=a.stacks,y=typeof g=="number"&&Number.isFinite(g)?Math.max(1,Math.round(g)):void 0,v=typeof a.description=="string"?a.description.trim():void 0,S=typeof a.source=="string"?a.source.trim():void 0;return{id:s,name:r,description:v,duration:u,remaining:h,appliedAt:p,stacks:y,source:S}}function Lx(t){if(!t||t.length===0)return[];const a=[];for(const s of t){const r=Dx(s);r&&a.push(r)}return a}function Ux(t){if(typeof t=="string"){const a=t.trim();if(a.length>0)return a}try{return vx()}catch(a){return console.warn("Falling back to default Saunoja name",a),Cx}}function vm(t){const{id:a,name:s,coord:r=Ax,maxHp:l=Th,hp:u=l,steam:f=0,defense:h,shield:m=0,behavior:p,traits:g=[],upkeep:y=Kc,xp:v=0,lastHitAt:S=Vy,selected:M=!1,items:_,modifiers:T,combatKeywords:N=null,combatHooks:O=null}=t,B=Number.isFinite(l)?Math.max(1,l):Th,Y=Number.isFinite(u)?u:B,X=gc(Y,0,B),V=Number.isFinite(f)?f:0,W=gc(V,0,1),F=(Array.isArray(g)?g:[]).filter(dn=>typeof dn=="string").map(dn=>dn.trim()).filter(dn=>dn.length>0),H=Number.isFinite(y)?y:Kc,C=gc(H,Oo,Rh),J=Number.isFinite(v)?v:0,I=Math.max(0,J),ae=Number.isFinite(S)?S:Vy,$=Math.max(0,ae),L=Number.isFinite(m)?m:0,P=Math.max(0,L),le=Number.isFinite(h)?h:void 0,ee=le!==void 0?Math.max(0,le):void 0,x=kx(_),w=Lx(T),z=Nx(p),K=Rx(t.equipment,x),oe=bm(K),de={...pc,health:B,defense:ee??pc.defense,shield:pc.shield},ue=Xy(t.baseStats,de),ve={...ue,health:B,defense:ee??ue.defense,shield:P},ge=Xy(t.effectiveStats,ve),et=Math.max(1,ge.health),Ot=gc(X,0,et),qt=typeof ge.defense=="number"?Math.max(0,ge.defense):ee??void 0,An=typeof ge.shield=="number"?Math.max(0,ge.shield):P,Bn={...ue,health:Math.max(1,ue.health),defense:typeof ue.defense=="number"?Math.max(0,ue.defense):ee??void 0,shield:typeof ue.shield=="number"?Math.max(0,ue.shield):pc.shield},ja={...ge,health:et,defense:qt,shield:An},la=Ux(s);return{id:a,name:la,coord:{q:r.q,r:r.r},maxHp:et,hp:Ot,defense:qt,shield:An,steam:W,behavior:z,traits:[...F],upkeep:C,xp:I,lastHitAt:$,selected:M,items:oe,baseStats:Bn,effectiveStats:ja,equipment:K,modifiers:w,combatKeywords:N,combatHooks:O}}const ur=32;function _o(t,a,s,r){t.beginPath();for(let l=0;l<6;l++){const u=Math.PI/3*l,f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?t.moveTo(f,h):t.lineTo(f,h)}t.closePath()}function Sm(t,a,s){return Math.min(Math.max(t,a),s)}function Ox(t,{centerX:a,centerY:s,hp:r,maxHp:l,radius:u=ur*.55}){const f=Number.isFinite(l)?Math.max(1,l):1,h=Number.isFinite(r)?r:f,m=Sm(h/f,0,1);if(t.save(),_o(t,a,s,u),t.fillStyle="rgba(7, 11, 18, 0.72)",t.fill(),t.restore(),m>0){t.save(),_o(t,a,s,u),t.clip();const p=t.createLinearGradient(a,s+u,a,s-u);p.addColorStop(0,"rgba(46, 160, 98, 0.35)"),p.addColorStop(1,"rgba(218, 255, 239, 0.95)"),t.fillStyle=p;const g=u*2*m,y=s+u-g;t.fillRect(a-u,y,u*2,g),t.restore()}t.save(),_o(t,a,s,u),t.lineWidth=Math.max(1,u*.12),t.strokeStyle="rgba(255, 255, 255, 0.28)",t.stroke(),t.restore()}function qx(t,{centerX:a,centerY:s,radius:r=ur,progress:l=0}){const u=Sm(l,0,1);if(u<=0)return;const f=Number.isFinite(r)&&r>0?r:ur;t.save(),t.globalCompositeOperation="lighter",t.globalAlpha=u;const h=t.createRadialGradient(a,s,Math.max(1,f*.1),a,s,f);h.addColorStop(0,"rgba(255, 255, 255, 0.92)"),h.addColorStop(.45,"rgba(255, 255, 255, 0.68)"),h.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=h,t.beginPath(),t.arc(a,s,f,0,Math.PI*2),t.fill(),t.restore()}function zx(t,{centerX:a,centerY:s,radius:r=ur*.85,intensity:l=1}){const u=Sm(l,0,1);if(u<=0)return;t.save(),_o(t,a,s,r),t.clip();const f=t.createLinearGradient(a,s+r,a,s-r);f.addColorStop(0,"rgba(255, 255, 255, 0)"),f.addColorStop(.55,`rgba(255, 255, 255, ${.12*u})`),f.addColorStop(1,`rgba(255, 255, 255, ${.35*u})`),t.globalCompositeOperation="lighter",t.fillStyle=f,t.fillRect(a-r,s-r,r*2,r*2),t.restore(),t.save(),t.globalCompositeOperation="lighter",t.lineCap="round",t.strokeStyle=`rgba(255, 255, 255, ${.25*u})`,t.lineWidth=Math.max(1,r*.08);const h=r*.75,m=r*.35;for(let p=0;p<3;p++){const g=s-r*.5+p*m;t.beginPath(),t.moveTo(a-h,g),t.bezierCurveTo(a-h*.4,g-r*.4,a+h*.4,g+r*.2,a+h,g-r*.45),t.stroke()}t.restore()}function Nh(t,a,s){return t<a?a:t>s?s:t}const $f=Object.freeze([{id:"skirmish",label:"Skirmish Patrols",minRunSeconds:0,minClears:0,cadence:26,multiplier:1,bundleTier:0},{id:"raids",label:"Raid Pressure",minRunSeconds:90,minClears:2,cadence:19,multiplier:1.35,bundleTier:1},{id:"siege",label:"Siege Lines",minRunSeconds:210,minClears:5,cadence:13,multiplier:1.8,bundleTier:2},{id:"onslaught",label:"Winter Onslaught",minRunSeconds:360,minClears:9,cadence:8.5,multiplier:2.45,bundleTier:3},{id:"maelstrom",label:"Glacier Maelstrom",minRunSeconds:540,minClears:14,cadence:6.2,multiplier:3.25,bundleTier:4}]);function Bx(t){return t>=1?1/(1+(t-1)*.45):1+(1-t)*.35}function Hx(t){if(t>=1)return 1+(t-1)*.85;const a=1-t;return Nh(1-a*.4,.45,1)}function Ix(t){return{runSeconds:Math.max(0,Number.isFinite(t.runSeconds)?t.runSeconds:0),clears:Math.max(0,Number.isFinite(t.clears)?t.clears:0),spawnCycles:Math.max(0,Number.isFinite(t.spawnCycles)?t.spawnCycles:0)}}function Ky(t,a){const s=Ix(a);let r=0;for(let p=0;p<$f.length;p+=1){const g=$f[p];if(s.runSeconds<g.minRunSeconds||s.clears<g.minClears)break;r=p}const l=$f[r],u=Bx(t),f=Hx(t),h=Math.max(.75,l.cadence*u),m=l.multiplier*f;return{stage:l,stageIndex:r,cadenceTarget:h,multiplierBase:m}}function Qy(t){if(t>=1){const s=Math.min(3,t-1);return Nh(.93-s*.035,.82,.93)}const a=Math.min(1,1-t);return Nh(.93+a*.03,.9,.97)}function Py(t){if(t>=1)return .024+Math.min(3,t-1)*.012;const a=Math.min(1,1-t);return Math.max(.012,.024-a*.01)}const O2="deepwood",q2="Deepwood Wardens",z2="Reclusive guardians attuned to sauna spirits.",B2=[{id:"warding-circle",label:"Warding Circle",weight:2,units:[{unit:"soldier",level:1,quantity:2},{unit:"archer",level:1,quantity:1}],items:["spirit-oak-charm","sauna-incense"],modifiers:["barkskin-ritual"]},{id:"spirit-strike",label:"Spirit Strike",weight:1,units:[{unit:"archer",level:2,quantity:2}],items:["emberglass-arrow"],modifiers:["searing-chant","windstep"]}],jx={id:O2,name:q2,description:z2,bundles:B2},Gx=Object.freeze(Object.defineProperty({__proto__:null,bundles:B2,default:jx,description:z2,id:O2,name:q2},Symbol.toStringTag,{value:"Module"})),H2="enemy",I2="Avanto Marauders",j2="Frostbitten raiders who harry the sauna frontier.",G2=[{id:"iceblade-scouts",label:"Iceblade Scouts",weight:3,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:1}],items:["cracked-ice-amulet"],modifiers:["frost-resilience"]},{id:"raiding-party",label:"Raiding Party",weight:2,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:2}],items:["stolen-sauna-tokens"],modifiers:["berserker-drift"]},{id:"frost-champion",label:"Frost Champion",weight:1,minRampTier:0,units:[{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand"],modifiers:["glacial-ward"]},{id:"icebreaker-vanguard",label:"Icebreaker Vanguard",weight:2.5,minRampTier:1,units:[{unit:"avanto-marauder",level:2,quantity:2},{unit:"avanto-marauder",level:1,quantity:1}],items:["stormglass-pendant"],modifiers:["frost-resilience","berserker-drift"]},{id:"glacial-phalanx",label:"Glacial Phalanx",weight:2,minRampTier:2,units:[{unit:"avanto-marauder",level:3,quantity:3},{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand","frostshard-relic"],modifiers:["glacial-ward","polar-endurance"]},{id:"avalanche-warhost",label:"Avalanche Warhost",weight:1.25,minRampTier:3,units:[{unit:"avanto-marauder",level:4,quantity:3},{unit:"avanto-marauder",level:3,quantity:2}],items:["avalanche-totem"],modifiers:["glacial-ward","polar-endurance","berserker-drift"]}],Fx={id:H2,name:I2,description:j2,bundles:G2},$x=Object.freeze(Object.defineProperty({__proto__:null,bundles:G2,default:Fx,description:j2,id:H2,name:I2},Symbol.toStringTag,{value:"Module"})),Yx=Object.assign({"../content/factions/deepwood.json":Gx,"../content/factions/enemy.json":$x}),Qc=new Map;for(const[t,a]of Object.entries(Yx)){const s=Vx(a),r=Px(s,t);if(Qc.has(r.id))throw new Error(`Duplicate faction bundle id: ${r.id}`);Qc.set(r.id,r)}function Vx(t){return typeof t=="object"&&t!==null&&"default"in t?t.default:t}function Em(t){return typeof t=="object"&&t!==null}function kh(t,a){if(typeof t!="string")throw new Error(`Expected string at ${a}`);const s=t.trim();if(!s)throw new Error(`Expected non-empty string at ${a}`);return s}function Dh(t){if(typeof t!="string")return;const a=t.trim();return a||void 0}function Zy(t,a){if(t===void 0)return Object.freeze([]);if(!Array.isArray(t))throw new Error(`Expected array at ${a}`);const s=t.map((r,l)=>{if(typeof r!="string")throw new Error(`Expected string at ${a}[${l}]`);const u=r.trim();if(!u)throw new Error(`Expected non-empty string at ${a}[${l}]`);return u});return Object.freeze(s)}function F2(t,a){const s=typeof t=="number"?t:Number(t);return!Number.isFinite(s)||s<=0?a:s}function Jy(t,a){const s=Math.floor(F2(t,a));return s>0?s:a}function Xx(t,a){if(!Em(t))throw new Error(`Expected object at ${a}`);const s=kh(t.unit,`${a}.unit`),r=Jy(t.level,1),l=Jy(t.quantity,1);return Object.freeze({unit:s,level:r,quantity:l})}function Kx(t){if(t===void 0)return;const a=Number(t);if(!Number.isFinite(a))return;const s=Math.floor(a);return s>=0?s:void 0}function Qx(t,a,s){if(!Em(t))throw new Error(`Expected object at ${a}`);const r=Dh(t.id)??`${s}-bundle`,l=Dh(t.label)??r,u=F2(t.weight,1),f=t.units;if(!Array.isArray(f)||f.length===0)throw new Error(`Expected non-empty units array at ${a}.units`);const h=f.map((y,v)=>Xx(y,`${a}.units[${v}]`)),m=Zy(t.items,`${a}.items`),p=Zy(t.modifiers,`${a}.modifiers`),g=Kx(t.minRampTier);return Object.freeze({id:r,label:l,weight:u,units:Object.freeze(h),items:m,modifiers:p,minRampTier:g})}function Px(t,a){if(!Em(t))throw new Error(`Expected object at ${a}`);const s=kh(t.id,`${a}.id`),r=kh(t.name,`${a}.name`),l=Dh(t.description);if(!Array.isArray(t.bundles)||t.bundles.length===0)throw new Error(`Expected non-empty bundles array at ${a}.bundles`);const u=t.bundles.map((f,h)=>Qx(f,`${a}.bundles[${h}]`,`${s}-${h}`));return Object.freeze({id:s,name:r,description:l,bundles:Object.freeze(u)})}Object.freeze(Array.from(Qc.keys()));function Zx(t){return Qc.get(t)??null}function Jx(t){return Zx(t)?.bundles??Object.freeze([])}function Wx(){return`e${Date.now()}-${Math.floor(Math.random()*1e6)}`}function e3(t){return{level:t}}function t3(t,a,s){const r=Jx(t);if(r.length===0)throw new Error(`No bundles registered for faction: ${t}`);const l=Math.max(0,Math.floor(Number.isFinite(a)?a:0)),u=r.filter(y=>(typeof y.minRampTier=="number"?y.minRampTier:0)<=l),f=u.length>0?u:r,h=typeof s=="function"?s:Math.random,m=f.reduce((y,v)=>y+v.weight,0);if(!Number.isFinite(m)||m<=0)throw new Error(`Invalid bundle weights for faction: ${t}`);const p=h()*m;let g=0;for(const y of f)if(g+=y.weight,p<g)return y;return f[f.length-1]}function n3(t){let a=Math.max(0,Math.floor(t.availableSlots));const s=[];if(a<=0)return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers};const r=t.makeId??Wx,l=typeof t.random=="function"?t.random:Math.random,u=Math.max(0,Math.min(.95,typeof t.eliteOdds=="number"?t.eliteOdds:0)),f=Math.max(1,Number.isFinite(t.difficultyMultiplier)?t.difficultyMultiplier:1),h=Math.max(0,Math.floor(Number.isFinite(t.rampTier)?t.rampTier:0)),m=1+h*.25,p=Math.floor(h/2);for(const g of t.bundle.units){const y=Math.max(1,Math.round(g.quantity*f*m)),v=Math.min(y,a),S=g.unit,M=Math.max(1,Math.round((g.level+p)*f));for(let _=0;_<v;_+=1){const T=l()<u?1:0,N=Math.max(1,M+T),O=e3(N),B=t.pickEdge();if(!B)return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers};const Y=R2(S,r(),B,t.factionId,O);if(Y&&(t.addUnit(Y),s.push(Y),a-=1,a<=0))return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers}}}return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers}}function bc(t,a,s,r=1){const l=Number(t);return Number.isFinite(l)?Math.max(a,Math.min(s,l)):r}const Wy=6;class a3{timer;interval;spawnCycles;factionId;random;makeId;difficulty;eliteOdds;cadenceDecay;multiplierGrowth;runSeconds=0;clearCount=0;boardEmpty=!0;lastClearAt=null;lastSpawnAt=null;lastCadence;lastMultiplier;rampEvaluation;rampStageIndex;currentDifficulty;cadenceScale=1;multiplierScale=1;pressureScale=1;calmUntil=null;calmSecondsRemaining=0;cadenceFloor=.3;constructor(a={}){this.factionId=a.factionId??"enemy",this.random=typeof a.random=="function"?a.random:Math.random;const s=Number.isFinite(a.difficulty)?Number(a.difficulty):1;this.difficulty=Math.max(.5,s);const r=typeof a.eliteOdds=="number"?a.eliteOdds:0;this.eliteOdds=Math.max(0,Math.min(.95,r)),this.currentDifficulty=this.difficulty,this.cadenceDecay=Qy(this.currentDifficulty),this.multiplierGrowth=Py(this.currentDifficulty),this.spawnCycles=0,this.rampEvaluation=Ky(this.currentDifficulty,{runSeconds:0,clears:0,spawnCycles:0}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.interval=this.rampEvaluation.cadenceTarget,this.timer=this.interval,this.lastCadence=this.interval,this.lastMultiplier=this.rampEvaluation.multiplierBase;const l=(()=>{let u=0;return()=>`e${Date.now()}-${u+=1}`})();this.makeId=typeof a.idFactory=="function"?a.idFactory:l}update(a,s,r,l,u={}){if(!Number.isFinite(a)||a<=0)return;this.runSeconds+=a,this.applyRuntimeModifiers(u),this.resolveRampState();const f=this.countActiveEnemies(s);if(this.trackClears(f),this.calmUntil!==null&&this.runSeconds<this.calmUntil){const m=this.calmUntil-this.runSeconds;this.calmSecondsRemaining=m,this.timer=Math.max(this.timer,m);return}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0),this.timer-=a;let h=0;for(;this.timer<=0&&h<Wy;){const m=this.getAvailableSlots(s);if(m<=0){this.timer=Math.max(this.timer,.5);break}const p=this.resolveRampState(),g=t3(this.factionId,p.stage.bundleTier,this.random),y=this.computeMultiplier(p);if(n3({bundle:g,factionId:this.factionId,pickEdge:l,addUnit:r,makeId:this.makeId,availableSlots:m,eliteOdds:this.eliteOdds,random:this.random,difficultyMultiplier:y,rampTier:p.stage.bundleTier}).spawned.length===0){this.timer=Math.max(this.timer,.5);break}const S=this.runSeconds+this.timer;this.lastCadence=this.lastSpawnAt===null?this.interval:Math.max(.01,S-this.lastSpawnAt),this.lastSpawnAt=S,this.lastMultiplier=y,this.spawnCycles+=1,h+=1;const M=this.resolveRampState();this.interval=this.computeNextInterval(M),this.timer+=this.interval}h===Wy&&this.timer<=0&&(this.timer=this.interval)}getSnapshot(){const a=this.rampEvaluation.stage;return{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles,rampStageIndex:this.rampStageIndex,rampStageId:a.id,rampStageLabel:a.label,bundleTier:a.bundleTier,cadence:this.interval,lastCadence:this.lastCadence,lastSpawnAt:this.lastSpawnAt,lastClearAt:this.lastClearAt,difficultyMultiplier:this.lastMultiplier,effectiveDifficulty:this.currentDifficulty,aggressionMultiplier:this.currentDifficulty/this.difficulty,cadenceMultiplier:this.cadenceScale,strengthMultiplier:this.multiplierScale,pressureMultiplier:this.pressureScale,calmSecondsRemaining:this.calmSecondsRemaining}}resolveRampState(){return this.rampEvaluation=Ky(this.currentDifficulty,{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.rampEvaluation}applyRuntimeModifiers(a){const s=bc(a.aggressionMultiplier,.25,6,1),r=bc(a.cadenceMultiplier,.1,10,1),l=bc(a.strengthMultiplier,.1,12,1),u=bc(a.pressureMultiplier,.1,10,1),f=Number.isFinite(a.cadenceFloor)?Math.max(.1,a.cadenceFloor):this.cadenceFloor,h=Math.max(.25,this.difficulty*s);if(h!==this.currentDifficulty&&(this.currentDifficulty=h,this.cadenceDecay=Qy(this.currentDifficulty),this.multiplierGrowth=Py(this.currentDifficulty),this.resolveRampState()),this.cadenceScale=r,this.multiplierScale=l,this.pressureScale=u,this.cadenceFloor=f,Object.prototype.hasOwnProperty.call(a,"calmSecondsRemaining")){const m=a.calmSecondsRemaining;m===null?this.calmUntil=null:typeof m=="number"&&Number.isFinite(m)&&m>0?this.calmUntil=this.runSeconds+m:typeof m=="number"&&m<=0&&(this.calmUntil=null)}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0)}computeNextInterval(a){const s=a.cadenceTarget*this.cadenceScale,r=Math.pow(this.spawnCycles+1,.6)*.018*this.pressureScale,l=1+Math.min(4,r),u=s/l,f=this.interval*this.cadenceDecay,h=Math.min(f,u);return Math.max(this.cadenceFloor,h)}computeMultiplier(a){const s=1+this.spawnCycles*this.multiplierGrowth*this.pressureScale,r=1+a.stageIndex*.15,l=a.multiplierBase*s*r*this.multiplierScale;return Math.min(16,Math.max(1,l))}countActiveEnemies(a){return a.filter(s=>s.faction===this.factionId&&!s.isDead()).length}getAvailableSlots(a){return cx-this.countActiveEnemies(a)}trackClears(a){if(a<=0){this.boardEmpty||(this.clearCount+=1,this.lastClearAt=this.runSeconds),this.boardEmpty=!0;return}this.boardEmpty=!1}}function i3(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(t){return console.warn("Structured telemetry storage unavailable",t),null}}function s3(t,a){const s={event:t,timestamp:Date.now(),payload:{...a}};return console.info(t,s),s}function r3(t,a,s={}){const r=i3();if(!r)return;const l=Number.isFinite(s.limit)?Math.max(1,Math.trunc(s.limit??16)):16,f=[...nm(t)??[],a].slice(-l);try{r.setItem(t,JSON.stringify(f))}catch(h){console.warn("Failed to persist structured telemetry",{storageKey:t,error:h})}}let eb=-1,tb=-1,Yf=null,Vf=0,Xf=0;const o3="telemetry:enemy-scaling:summaries";function l3(t,a={}){const s=t.rampStageIndex!==eb,r=t.spawnCycles>=tb+10,l=t.lastClearAt!==null&&t.lastClearAt!==Yf;if(!s&&!r&&!l)return;eb=t.rampStageIndex,tb=t.spawnCycles,Yf=t.lastClearAt??Yf,Vf=Math.max(Vf,t.difficultyMultiplier);const u=Math.max(0,Math.round(t.calmSecondsRemaining*1e3));u>Xf&&(Xf=u);const f={stage:t.rampStageLabel,stageIndex:t.rampStageIndex,bundleTier:t.bundleTier,cadenceSeconds:Number(t.cadence.toFixed(2)),lastCadenceSeconds:Number(t.lastCadence.toFixed(2)),multiplier:Number(t.difficultyMultiplier.toFixed(2)),effectiveDifficulty:Number(t.effectiveDifficulty.toFixed(2)),aggressionMultiplier:Number(t.aggressionMultiplier.toFixed(2)),cadenceMultiplier:Number(t.cadenceMultiplier.toFixed(2)),strengthMultiplier:Number(t.strengthMultiplier.toFixed(2)),pressureMultiplier:Number(t.pressureMultiplier.toFixed(2)),calmSecondsRemaining:Number(t.calmSecondsRemaining.toFixed(2)),runSeconds:Math.round(t.runSeconds),spawnCycles:t.spawnCycles,clears:t.clears,wipeSince:a.wipeSince??null,longestWipeMs:a.wipeDurationMs??0,peakMultiplier:Number(Vf.toFixed(2)),longestCalmMs:Xf},h=s3("enemy-scaling",f);r3(o3,h,{limit:24})}const Lh=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),c3=Object.freeze({artocoinBalance:0,ownedTierIds:Object.freeze(new Set)}),u3={default:"Included with the sauna key",artocoin:"Invest artocoins"},Mm=Object.freeze([{id:"ember-circuit",name:"Primitive Smoke Sauna",rosterCap:3,description:"Soot-softened benches inside the Primitive Smoke Sauna shelter a loyal trio of attendants.",art:{badge:f2,glow:"linear-gradient(145deg, rgba(255,161,76,0.65), rgba(255,226,173,0.18))"},visionRange:4,unlock:{type:"default",label:"Included with the Primitive Smoke Sauna key"}},{id:"aurora-ward",name:"Modern Wooden Sauna",rosterCap:4,description:"Polished timber and copper buckets in the Modern Wooden Sauna rally a quartet ready for sieges.",art:{badge:u2,glow:"linear-gradient(140deg, rgba(128,208,255,0.7), rgba(61,184,255,0.2))"},visionRange:10,unlock:{type:"artocoin",cost:150,label:"Commission the Modern Wooden Sauna for 150 artocoins"}},{id:"mythic-conclave",name:"Futuristic Fission Sauna",rosterCap:6,description:"Iridescent shielding and fission-driven löyly crown the Futuristic Fission Sauna with six guardians.",art:{badge:d2,glow:"linear-gradient(135deg, rgba(176,106,255,0.72), rgba(245,199,255,0.2))"},visionRange:20,unlock:{type:"artocoin",cost:275,label:"Fund the Futuristic Fission Sauna with 275 artocoins"}}]),fr=Mm[0].id,Kf=new Map(Mm.map(t=>[t.id,t]));function xm(){return Mm}function wn(t){return t&&Kf.has(t)?Kf.get(t):Kf.get(fr)}function d3(t,a,s){if(!Number.isFinite(t))return a;const r=Math.max(a,Math.min(s,t));return Number.isNaN(r)?a:r}function nb(t){if(t.label)return t.label;const a=u3[t.type];if(!a)return"";if(t.type==="artocoin"){const s=Math.max(0,Math.floor(Number.isFinite(t.cost)?t.cost:0));if(s>0)return`${a} ${Lh.format(s)}`}return a}function is(t,a){const s=a??c3,r=s.ownedTierIds,l=r instanceof Set?r:new Set(Array.isArray(r)?r:[]);if(t.unlock.type==="default")return{tier:t,unlocked:!0,owned:!0,affordable:!0,cost:null,progress:1,requirementLabel:nb(t.unlock)};if(t.unlock.type==="artocoin"){const u=Math.max(0,Math.floor(Number.isFinite(t.unlock.cost)?t.unlock.cost:0)),f=Math.max(0,Math.floor(Number.isFinite(s.artocoinBalance)?s.artocoinBalance:0)),h=l.has(t.id),m=f>=u,p=h,g=h||u===0?1:d3(f/u,0,1),y=Math.max(0,u-f),v=Lh.format(u),S=y>0?Lh.format(y):null;let M;if(h)M=`Roster cap ${t.rosterCap}`;else{const _=t.unlock.label??`Invest ${v} artocoins`;S?M=`${_} — Need ${S} more`:u>0?M=`${_} — Ready to unlock`:M=_}return{tier:t,unlocked:p,owned:h,affordable:m,cost:u,progress:g,requirementLabel:M}}return{tier:t,unlocked:!1,owned:!1,affordable:!1,cost:null,progress:0,requirementLabel:nb(t.unlock)}}const ab=["hud-grid","grid","grid-rows-[64px_1fr_80px]","grid-cols-[280px_1fr_clamp(260px,32vw,420px)]","gap-[clamp(16px,3vw,28px)]"],ib={top:["col-span-3","row-span-1","row-start-1"],left:["col-start-1","row-start-2","row-span-1"],content:["col-start-2","row-start-2","row-span-1"],right:["col-start-3","row-start-2","row-span-1"],bottom:["col-span-3","row-start-3","row-span-1"]};function f3(t,a){let s=t.querySelector("[data-hud-root]");return s||(s=a.createElement("div"),s.dataset.hudRoot="true",s.className="hud-layout-root",t.prepend(s)),s}function mo(t,a,s,r){let l=t.querySelector(`[data-hud-region="${s}"]`);return l||(l=a.createElement("div"),l.dataset.hudRegion=s,t.appendChild(l)),l.classList.add("hud-region",...r),l.parentElement!==t&&t.appendChild(l),l}function h3(t,a,s){if(s){t.classList.add(...ab);for(const[r,l]of Object.entries(ib))a[r].classList.add(...l)}else{t.classList.remove(...ab);for(const[r,l]of Object.entries(ib))a[r].classList.remove(...l)}}function hr(t){const a=t.ownerDocument??document,s=f3(t,a),r={top:mo(s,a,"top",["hud-top-row"]),left:mo(s,a,"left",["hud-actions"]),content:mo(s,a,"content",["hud-content"]),right:mo(s,a,"right",["hud-right-column"]),bottom:mo(s,a,"bottom",["hud-bottom-row"])};s.append(r.top,r.left,r.content,r.right,r.bottom);const l=t.dataset.hudVariant==="v2";if(h3(t,r,l),!l){const p=t.querySelector("#resource-bar");p&&p.parentElement!==r.right&&r.right.prepend(p)}const u=t.querySelector("#build-menu");u&&u.parentElement!==r.left&&r.left.appendChild(u);const f=t.querySelector("#build-id");f&&f.parentElement!==r.bottom&&r.bottom.appendChild(f);let h=t.querySelector(".hud-mobile-bar__tray"),m=h?.closest(".hud-mobile-bar")??null;return(!h||!m)&&(m=a.createElement("div"),m.className="hud-mobile-bar",h=a.createElement("div"),h.className="hud-mobile-bar__tray",m.appendChild(h)),m.parentElement!==r.bottom&&r.bottom.appendChild(m),{root:s,regions:r,actions:r.left,side:r.right,mobileBar:h}}const sb=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function m3(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const r=document.createElement("div");r.classList.add("sauna-control"),r.dataset.tutorialTarget="heat";const l=()=>{const fe=a.getActiveTierId?.();return wn(fe??fr).id},u=()=>a.getTierContext?.()??null,f=document.createElement("button");f.type="button",f.textContent="Sauna ♨️",f.classList.add("topbar-button","sauna-toggle"),f.setAttribute("aria-expanded","false"),r.appendChild(f);const h=document.createElement("div");h.classList.add("sauna-card","hud-card"),h.hidden=!0;const m=document.createElement("section");m.classList.add("sauna-health"),m.dataset.tutorialTarget="sauna-integrity";const p=`sauna-health-label-${Math.floor(Math.random()*1e5)}`,g=document.createElement("div");g.classList.add("sauna-health__header");const y=document.createElement("span");y.id=p,y.classList.add("sauna-health__title"),y.textContent="Sauna Integrity",g.appendChild(y);const v=document.createElement("span");v.classList.add("sauna-health__value"),v.setAttribute("aria-live","polite"),g.appendChild(v),m.appendChild(g);const S=document.createElement("div");S.classList.add("sauna-health__bar"),S.setAttribute("role","meter"),S.setAttribute("aria-valuemin","0"),S.setAttribute("aria-labelledby",p);const M=document.createElement("div");M.classList.add("sauna-health__fill"),S.appendChild(M),m.appendChild(S);const _=document.createElement("div");_.classList.add("sauna-health__destruction"),_.hidden=!0,S.appendChild(_);const T=document.createElement("div");T.classList.add("sauna-progress");const N=document.createElement("div");N.classList.add("sauna-progress__fill"),T.appendChild(N),h.appendChild(m),h.appendChild(T);const O=xm(),B=new Map,Y=document.createElement("section");Y.classList.add("sauna-tier");const X=document.createElement("div");X.classList.add("sauna-tier__header");const V=document.createElement("span");V.classList.add("sauna-tier__title"),V.textContent="Premium Tiers",X.appendChild(V);const W=document.createElement("p");W.classList.add("sauna-tier__subtitle"),W.textContent="Align the löyly with your prestige to unlock lavish benches and roster headroom.",X.appendChild(W),Y.appendChild(X);const ne=document.createElement("div");ne.classList.add("sauna-tier__grid"),Y.appendChild(ne);for(const fe of O){const Te=document.createElement("button");Te.type="button",Te.classList.add("sauna-tier__option"),Te.dataset.tierId=fe.id,Te.setAttribute("aria-pressed","false");const Ge=document.createElement("div");Ge.classList.add("sauna-tier__badge"),Ge.style.setProperty("--sauna-tier-badge-image",`url(${fe.art.badge})`),fe.art.glow&&Ge.style.setProperty("--sauna-tier-glow",fe.art.glow),Te.appendChild(Ge);const ze=document.createElement("div");ze.classList.add("sauna-tier__copy"),Te.appendChild(ze);const vt=document.createElement("span");vt.classList.add("sauna-tier__name"),vt.textContent=fe.name,ze.appendChild(vt);const fn=document.createElement("span");fn.classList.add("sauna-tier__cap"),fn.textContent=`Cap ${fe.rosterCap}`,ze.appendChild(fn);const Zt=document.createElement("p");Zt.classList.add("sauna-tier__description"),Zt.textContent=fe.description,ze.appendChild(Zt);const Cn=document.createElement("div");Cn.classList.add("sauna-tier__progress");const ca=document.createElement("div");ca.classList.add("sauna-tier__progress-fill"),Cn.appendChild(ca);const Ke=document.createElement("span");Ke.classList.add("sauna-tier__progress-label"),Cn.appendChild(Ke),ze.appendChild(Cn);const Pe=document.createElement("span");Pe.classList.add("sauna-tier__requirement"),ze.appendChild(Pe);const Yt={tier:fe,button:Te,fill:ca,progressLabel:Ke,requirement:Pe,handleClick:()=>{x(fe,Yt)}};Te.addEventListener("click",Yt.handleClick),B.set(fe.id,Yt),ne.appendChild(Te)}h.appendChild(Y),ee();const F=document.createElement("label");F.classList.add("sauna-option");const H=document.createElement("input");H.type="checkbox",H.classList.add("sauna-option__input"),H.checked=t.rallyToFront,H.addEventListener("change",()=>{t.rallyToFront=H.checked}),F.appendChild(H);const C=document.createElement("span");C.textContent="Rally to Front",C.classList.add("sauna-option__label"),F.appendChild(C),h.appendChild(F),r.appendChild(h);const{regions:J}=hr(s),I=J.top,ae=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null;let $=!!ae?.matches;const L=(fe,Te)=>{typeof fe.addEventListener=="function"?fe.addEventListener("change",Te):typeof fe.addListener=="function"&&fe.addListener(Te)},P=(fe,Te)=>{typeof fe.removeEventListener=="function"?fe.removeEventListener("change",Te):typeof fe.removeListener=="function"&&fe.removeListener(Te)},le=fe=>{$=!!fe.matches,m.dataset.motion=$?"reduced":"full"};m.dataset.motion=$?"reduced":"full",ae&&L(ae,le);function ee(){const fe=l(),Te=u();for(const Ge of B.values()){const ze=is(Ge.tier,Te),vt=Math.round(Math.max(0,Math.min(ze.progress,1))*100);Ge.fill.style.width=`${vt}%`,Ge.progressLabel.textContent=ze.unlocked?"Unlocked":`${vt}% ready`,Ge.requirement.textContent=ze.unlocked?`Roster cap ${Ge.tier.rosterCap}`:ze.requirementLabel,Ge.button.dataset.state=ze.unlocked?Ge.tier.id===fe?"active":"available":"locked",Ge.button.setAttribute("aria-pressed",Ge.tier.id===fe?"true":"false"),Ge.button.setAttribute("aria-disabled",ze.unlocked?"false":"true")}}function x(fe,Te){if(!is(fe,u()).unlocked){Te.button.classList.remove("sauna-tier__option--denied"),Te.button.offsetWidth,Te.button.classList.add("sauna-tier__option--denied");return}a.setActiveTierId?.(fe.id,{persist:!0}),ee()}const w=()=>{r.parentElement!==I&&I.appendChild(r);const fe=I.querySelector("#topbar");return fe&&fe.parentElement===I?(fe.nextSibling!==r&&I.insertBefore(r,fe.nextSibling),!0):!1};let z=null;w()||(z=new MutationObserver(()=>{w()&&z?.disconnect()}),z.observe(I,{childList:!0}));const K=()=>{const fe=!h.hidden;h.hidden=fe,f.setAttribute("aria-expanded",String(!fe))};f.addEventListener("click",K);const oe=()=>{const fe=Math.max(1,Math.floor(t.maxHealth)),Te=Math.max(0,Math.min(fe,Math.floor(Number.isFinite(t.health)?t.health:0))),Ge=fe>0?Te/fe:0,ze=Math.max(0,Math.min(Ge,1));M.style.width=`${ze*100}%`;const vt=sb.format(Te),fn=sb.format(fe);v.textContent=`${vt} / ${fn}`,S.setAttribute("aria-valuenow",String(Te)),S.setAttribute("aria-valuemax",String(fe)),S.setAttribute("aria-valuetext",`${vt} of ${fn} health`);const Zt=t.destroyed?"offline":ze<=.2?"critical":ze<=.55?"warning":"stable";S.dataset.level=Zt,v.dataset.state=Zt,m.dataset.state=t.destroyed?"destroyed":"active"},de=()=>{_.classList.remove("sauna-health__destruction--active"),_.hidden=!0};let ue=null,ve=null;const ge=()=>{ue!==null&&(window.clearTimeout(ue),ue=null),S.classList.remove("sauna-health__bar--impact")},et=()=>{M.classList.remove("sauna-health__fill--damage")};M.addEventListener("animationend",et);const Ot=()=>{de()};_.addEventListener("animationend",Ot);const qt=()=>{ge(),S.classList.add("sauna-health__bar--impact"),$||(M.classList.remove("sauna-health__fill--damage"),M.offsetWidth,M.classList.add("sauna-health__fill--damage")),ue=window.setTimeout(()=>{S.classList.remove("sauna-health__bar--impact"),ue=null},$?360:560)},An=()=>{ve!==null&&(window.clearTimeout(ve),ve=null),_.hidden=!1,_.classList.remove("sauna-health__destruction--active"),_.offsetWidth,_.classList.add("sauna-health__destruction--active"),ve=window.setTimeout(()=>{de(),ve=null},$?720:1100)},Bn=()=>{oe();const fe=t.playerSpawnCooldown>0?t.playerSpawnCooldown:1,Te=1-t.playerSpawnTimer/fe;N.style.width=`${Math.max(0,Math.min(Te,1))*100}%`,H.checked=t.rallyToFront,ee()};return oe(),{update:Bn,handleDamage:fe=>{oe(),qt()},handleDestroyed:fe=>{h.hidden=!1,f.setAttribute("aria-expanded","true"),oe(),qt(),An()},dispose:()=>{z?.disconnect(),z=null,f.removeEventListener("click",K),ae&&P(ae,le),M.removeEventListener("animationend",et),_.removeEventListener("animationend",Ot),ge(),ve!==null&&(window.clearTimeout(ve),ve=null),de();for(const fe of B.values())fe.button.removeEventListener("click",fe.handleClick);B.clear(),r.remove()}}}const Uh="progression:artocoinBalance",Sn=0,Oh=new Set,rb=Object.freeze({"ember-circuit":{tierId:"ember-circuit",nextUnlockLabel:"Modern Wooden Sauna commission",unlockCost:150,baselinePayout:60,baselineDurationMinutes:12.5,baselineKills:150,baselineTiles:85},"aurora-ward":{tierId:"aurora-ward",nextUnlockLabel:"Futuristic Fission Sauna ignition",unlockCost:210,baselinePayout:84,baselineDurationMinutes:12,baselineKills:190,baselineTiles:100},"mythic-conclave":{tierId:"mythic-conclave",nextUnlockLabel:"Futuristic Fission Sauna prestige rotation",unlockCost:275,baselinePayout:110,baselineDurationMinutes:11.5,baselineKills:230,baselineTiles:115}}),Qf=Object.freeze([{minScalar:0,maxScalar:.95,multiplier:.85},{minScalar:.95,maxScalar:1.1,multiplier:1},{minScalar:1.1,maxScalar:1.3,multiplier:1.18},{minScalar:1.3,maxScalar:1.5,multiplier:1.32},{minScalar:1.5,multiplier:1.42,bonusPerStage:.03,maxMultiplier:1.58}]);function $2(){try{const t=globalThis;return t.localStorage?t.localStorage:t.window?.localStorage?t.window.localStorage:null}catch(t){return console.warn("Local storage unavailable for artocoin progression",t),null}}function p3(t){for(const a of Oh)try{a(t)}catch(s){console.warn("Artocoin listener failure",s)}}function Y2(t){return Oh.add(t),()=>{Oh.delete(t)}}function To(t){const a=Number(t);return!Number.isFinite(a)||a<0?Sn:Math.min(Number.MAX_SAFE_INTEGER,Math.floor(a))}function g3(t){if(!t)return Sn;const a=t.artocoins??t.artocoinBalance,s=To(a);return"artocoins"in t&&delete t.artocoins,"artocoinBalance"in t&&delete t.artocoinBalance,s}function y3(t){const a=t.getItem(jc);if(!a)return Sn;try{const s=JSON.parse(a);if(!s||typeof s!="object")return Sn;const r=s,l=g3(r);try{t.setItem(jc,JSON.stringify(r))}catch(u){console.warn("Failed to persist migrated NG+ state without artocoins",u)}return l}catch(s){return console.warn("Failed to parse legacy NG+ state during artocoin migration",s),Sn}}function ss(){const t=$2();if(!t)return Sn;const a=t.getItem(Uh);if(a!==null){const r=To(a);return r!==Sn?r:Sn}const s=y3(t);return s!==Sn?(wm(s,{reason:"migration",previousBalance:Sn}),s):Sn}function wm(t,a={}){const s=$2(),r=To(t);let l=typeof a.previousBalance=="number"?To(a.previousBalance):Sn;if(s){if(typeof a.previousBalance!="number")try{const u=s.getItem(Uh);u!==null&&(l=To(u))}catch(u){console.warn("Failed to read previous artocoin balance",u)}try{s.setItem(Uh,r.toString())}catch(u){console.warn("Failed to persist artocoin balance",u)}}if(!a.silent){const u=r-l;p3({balance:r,delta:u,reason:a.reason??"set",metadata:a.metadata})}}function b3(t,a={}){const s=Math.max(0,Math.floor(Number.isFinite(t)?t:0));if(s===0)return ss();const r=ss(),l=Math.min(Number.MAX_SAFE_INTEGER,r+s);return wm(l,{...a,previousBalance:r,reason:a.reason??"payout"}),l}function v3(t,a={}){const s=Math.max(0,Math.floor(Number.isFinite(t)?t:0)),r=ss();if(s===0)return{success:!0,balance:r};if(r<s)return{success:!1,balance:r,shortfall:s-r};const l=r-s;return wm(l,{...a,previousBalance:r,reason:a.reason??"purchase"}),{success:!0,balance:l}}function qc(t,a,s){if(!Number.isFinite(s)||t===a||t>a)return t;const r=Math.max(t,Math.min(a,s));return Number.isNaN(r)?t:r}function S3(t){return qc(0,1,t)}function V2(t,a){const s=Number.isFinite(t)?t:1,r=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;for(const l of Qf){const u=typeof l.maxScalar=="number"?s<l.maxScalar:!0;if(s>=l.minScalar&&u){if(l.bonusPerStage&&l.maxMultiplier){const h=Math.max(0,r-4)*l.bonusPerStage,m=l.multiplier+h;return Math.min(l.maxMultiplier,m)}return l.multiplier}}return Qf[Qf.length-1]?.multiplier??1}function X2(t){return rb[t]??rb["ember-circuit"]}function E3(t){const a=X2(t.tierId),s=a.baselinePayout,r=Number.isFinite(t.runSeconds)?t.runSeconds/60:0,l=a.baselineDurationMinutes,u=qc(.75,1.2,1+(l-r)/l*.35),f=qc(.6,1.45,t.enemyKills/a.baselineKills),h=qc(.7,1.25,t.tilesExplored/a.baselineTiles),m=u*.3+f*.45+h*.25,p=1,g=V2(t.difficultyScalar,t.rampStageIndex);return{artocoins:Math.round(s*m*g),breakdown:{baseline:s,performanceMultiplier:m,lossPenalty:p,difficultyMultiplier:g}}}function M3(t){const a=X2(t.tierId),s=a.baselinePayout,r=V2(t.difficultyScalar,t.rampStageIndex),l=s*.2*r,u=t.runSeconds/(a.baselineDurationMinutes*60),f=t.enemyKills/a.baselineKills,h=S3(.5*u+.5*f),m=s*.45*h*r;return{artocoins:Math.round(Math.max(l,m)),breakdown:{baseline:s,performanceMultiplier:m/s,lossPenalty:1,difficultyMultiplier:r}}}function x3(t,a){return t==="win"?E3(a):M3(a)}function Xs(t,a={}){const{iconSrc:s,description:r,srLabel:l}=a,u=document.createElement("div");if(u.classList.add("topbar-badge"),u.setAttribute("role","status"),u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),s){const y=document.createElement("img");y.src=s,y.alt=t,y.decoding="async",y.classList.add("topbar-badge-icon"),u.appendChild(y)}const f=document.createElement("div");f.classList.add("badge-text");const h=document.createElement("span");h.textContent=t,h.classList.add("badge-label"),f.appendChild(h);const m=document.createElement("span");m.textContent="0",m.classList.add("badge-value"),m.setAttribute("aria-hidden","true"),f.appendChild(m);const p=document.createElement("span");p.classList.add("badge-delta"),p.style.opacity="0",p.style.transform="translateY(-6px)",p.style.transition="opacity 0.5s ease, transform 0.5s ease",p.setAttribute("aria-hidden","true"),u.append(f,p),r&&(u.title=r);const g=l??t;return u.dataset.label=g,u.setAttribute("aria-label",`${g}: 0`),{container:u,value:m,delta:p,label:g}}function w3(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const{regions:r}=hr(s),l=r.top,u=document.createElement("div");u.id="topbar",l.prepend(u);const f=document.createElement("div");f.className="topbar-badge-row",u.appendChild(f);const h={[re.SAUNA_BEER]:"Sauna beer bottles chilled for construction crews and eager recruits.",[re.SAUNAKUNNIA]:"Saunakunnia—prestige earned from sauna rituals and triumphant battles.",[re.SISU]:"Sisu—the relentless grit forged when your warriors triumph on the snow."},m=Xs("Sauna Beer",{iconSrc:a.saunaBeer,description:h[re.SAUNA_BEER],srLabel:"Sauna beer reserves"});m.container.classList.add("badge-sauna-beer");const p=Xs("Sisu",{iconSrc:a.sisu,description:h[re.SISU],srLabel:"Sisu reserves"});p.container.classList.add("badge-sisu"),p.container.dataset.tutorialTarget="sisu";const g=Xs("Saunakunnia",{iconSrc:a.saunakunnia,description:h[re.SAUNAKUNNIA],srLabel:"Saunakunnia"});g.container.classList.add("badge-sauna"),g.container.dataset.tutorialTarget="victory";const y=Xs("Artocoins",{iconSrc:a.artocoin,description:"Artocoin treasury minted from triumphant campaigns.",srLabel:"Artocoin balance"});y.container.classList.add("badge-artocoin");const v=Xs("Time");v.container.classList.add("badge-time"),v.delta.style.display="none";const S=Xs("Enemy Ramp",{srLabel:"Enemy ramp intensity"});S.container.classList.add("badge-ramp"),S.delta.style.display="none",S.container.dataset.tutorialTarget="enemy-ramp",S.container.title="Enemy ramp intensity and cadence.",f.appendChild(m.container),f.appendChild(p.container),f.appendChild(g.container),f.appendChild(y.container),f.appendChild(S.container),f.appendChild(v.container);const M=new Intl.NumberFormat("en-US"),_=new Intl.NumberFormat("en-US",{signDisplay:"exceptZero"}),T={[re.SAUNA_BEER]:"Sauna Beer",[re.SAUNAKUNNIA]:"Saunakunnia",[re.SISU]:"Sisu"},N={[re.SAUNA_BEER]:{singular:"bottle",plural:"bottles"},[re.SAUNAKUNNIA]:{singular:"Saunakunnia",plural:"Saunakunnia"},[re.SISU]:{singular:"Sisu",plural:"Sisu"}},O={[re.SAUNA_BEER]:"🍺",[re.SAUNAKUNNIA]:"⚜️",[re.SISU]:"🔥"},B={[re.SAUNA_BEER]:m,[re.SAUNAKUNNIA]:g,[re.SISU]:p},Y={};let X=ss(),V=null,W=null;function ne(ee){if(W=ee,!ee){S.value.textContent="Stage 1 · ×1.00",S.delta.textContent="",S.delta.style.display="none",S.container.dataset.state="idle",S.container.title="Enemy ramp idle",S.container.setAttribute("aria-label","Enemy ramp idle.");return}const x=ee.stage||`Stage ${ee.stageIndex+1}`,w=`×${ee.multiplier.toFixed(2)}`,z=`${ee.cadenceSeconds.toFixed(2)}s cadence`,K=`×${ee.effectiveDifficulty.toFixed(2)}`,oe=ee.calmSecondsRemaining>.05,de=oe?`Calm remaining: ${Math.ceil(ee.calmSecondsRemaining)}s`:"Calm inactive";S.value.textContent=`${x} · ${w}`,S.delta.style.display=oe?"":"none",S.delta.textContent=oe?`Calm ${Math.ceil(ee.calmSecondsRemaining)}s`:"",S.container.dataset.state=oe?"calm":"active",S.container.title=[`Stage: ${x} (Tier ${ee.bundleTier})`,`Cadence: ${z}`,`Multiplier: ${w}`,`Difficulty: ${K}`,`Aggression ×${ee.aggressionMultiplier.toFixed(2)} · Cadence ×${ee.cadenceMultiplier.toFixed(2)} · Strength ×${ee.strengthMultiplier.toFixed(2)}`,de,`Spawn cycles: ${ee.spawnCycles}`].join(`
`),S.container.setAttribute("aria-label",[`Enemy ramp ${x}`,`Multiplier ${w}`,`Cadence ${ee.cadenceSeconds.toFixed(2)} seconds`,`Difficulty ${K}`,oe?`Calm remaining ${Math.ceil(ee.calmSecondsRemaining)} seconds`:"Calm inactive"].join(" — "))}function F(ee,x){const w=Number.isFinite(x)?x:0;return ee===re.SAUNA_BEER?Math.trunc(w):Math.max(0,Math.round(w))}function H(ee,x){return M.format(F(ee,x))}function C(ee,x){return x===0?"":`${_.format(x)} ${O[ee]}`}function J(ee,x){if(x===0)return"";const w=x>0?"gained":"spent",z=M.format(Math.abs(x)),K=N[ee];if(K){const de=Math.abs(x)===1?K.singular:K.plural,ue=T[ee],ve=[ue];de&&de!==ue&&ve.push(de);const ge=ve.filter(Boolean).join(" ");return`${w} ${z}${ge?` ${ge}`:""}`}const oe=T[ee];return`${w} ${z}${oe?` ${oe}`:""}`}function I(ee,x,w=0){const z=B[ee];if(!z)return;const K=F(ee,x),oe=H(ee,x);z.value.textContent=oe;const de=ee===re.SAUNA_BEER&&K<0;if(z.container.classList.toggle("topbar-badge--debt",de),w!==0){z.delta.textContent=C(ee,w),z.delta.style.opacity="1",z.delta.style.transform="translateY(0)";const ge=Y[ee];ge&&clearTimeout(ge),Y[ee]=setTimeout(()=>{z.delta.style.opacity="0",z.delta.style.transform="translateY(-6px)",delete Y[ee]},1e3)}else z.delta.textContent="",z.delta.style.opacity="0",z.delta.style.transform="translateY(-6px)";const ue=J(ee,w),ve=[`${z.label} ${oe}`];if(de){const ge=M.format(Math.abs(K)),et=N[ee];if(et){const Ot=Math.abs(K)===1?et.singular:et.plural,qt=Ot&&Ot!==T[ee];ve.push(qt?`Debt of ${ge} ${Ot}`:`Debt of ${ge}`)}else ve.push(`Debt of ${ge}`)}ue&&ve.push(ue),z.container.setAttribute("aria-label",ve.join(" — "))}function ae(ee,x=0){X=Math.max(0,Math.floor(Number.isFinite(ee)?ee:0));const w=M.format(X);y.value.textContent=w,x!==0?(y.delta.textContent=`${_.format(x)} Ⓐ`,y.delta.style.opacity="1",y.delta.style.transform="translateY(0)",V&&clearTimeout(V),V=setTimeout(()=>{y.delta.style.opacity="0",y.delta.style.transform="translateY(-6px)",V=null},1e3)):(y.delta.textContent="",y.delta.style.opacity="0",y.delta.style.transform="translateY(-6px)");const z=x===0?"":x>0?`Gained ${M.format(x)} artocoins`:`Spent ${M.format(Math.abs(x))} artocoins`,K=[`${y.label} ${w}`];z&&K.push(z),y.container.setAttribute("aria-label",K.join(" — "))}I(re.SAUNA_BEER,t.getResource(re.SAUNA_BEER)),I(re.SAUNAKUNNIA,t.getResource(re.SAUNAKUNNIA)),I(re.SISU,t.getResource(re.SISU)),ae(X),ne(W);const $=({resource:ee,amount:x,total:w})=>{B[ee]&&I(ee,w,x)};se.on("resourceChanged",$);const P=Y2(ee=>{ae(ee.balance,ee.delta)});let le=0;return{update(ee){le+=ee;const x=Math.floor(le/1e3),w=Math.floor(x/60),z=x%60;v.value.textContent=`${w}:${z.toString().padStart(2,"0")}`},setEnemyRampSummary(ee){ne(ee)},dispose(){se.off("resourceChanged",$),Object.values(Y).forEach(ee=>{ee&&clearTimeout(ee)}),V&&clearTimeout(V),P(),u.remove()}}}var Pf={exports:{}},po={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ob;function A3(){if(ob)return po;ob=1;var t=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function s(r,l,u){var f=null;if(u!==void 0&&(f=""+u),l.key!==void 0&&(f=""+l.key),"key"in l){u={};for(var h in l)h!=="key"&&(u[h]=l[h])}else u=l;return l=u.ref,{$$typeof:t,type:r,key:f,ref:l!==void 0?l:null,props:u}}return po.Fragment=a,po.jsx=s,po.jsxs=s,po}var lb;function C3(){return lb||(lb=1,Pf.exports=A3()),Pf.exports}var Pt=C3(),Zf={exports:{}},go={},Jf={exports:{}},Wf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cb;function _3(){return cb||(cb=1,(function(t){function a(L,P){var le=L.length;L.push(P);e:for(;0<le;){var ee=le-1>>>1,x=L[ee];if(0<l(x,P))L[ee]=P,L[le]=x,le=ee;else break e}}function s(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var P=L[0],le=L.pop();if(le!==P){L[0]=le;e:for(var ee=0,x=L.length,w=x>>>1;ee<w;){var z=2*(ee+1)-1,K=L[z],oe=z+1,de=L[oe];if(0>l(K,le))oe<x&&0>l(de,K)?(L[ee]=de,L[oe]=le,ee=oe):(L[ee]=K,L[z]=le,ee=z);else if(oe<x&&0>l(de,le))L[ee]=de,L[oe]=le,ee=oe;else break e}}return P}function l(L,P){var le=L.sortIndex-P.sortIndex;return le!==0?le:L.id-P.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var f=Date,h=f.now();t.unstable_now=function(){return f.now()-h}}var m=[],p=[],g=1,y=null,v=3,S=!1,M=!1,_=!1,T=!1,N=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function Y(L){for(var P=s(p);P!==null;){if(P.callback===null)r(p);else if(P.startTime<=L)r(p),P.sortIndex=P.expirationTime,a(m,P);else break;P=s(p)}}function X(L){if(_=!1,Y(L),!M)if(s(m)!==null)M=!0,V||(V=!0,J());else{var P=s(p);P!==null&&$(X,P.startTime-L)}}var V=!1,W=-1,ne=5,F=-1;function H(){return T?!0:!(t.unstable_now()-F<ne)}function C(){if(T=!1,V){var L=t.unstable_now();F=L;var P=!0;try{e:{M=!1,_&&(_=!1,O(W),W=-1),S=!0;var le=v;try{t:{for(Y(L),y=s(m);y!==null&&!(y.expirationTime>L&&H());){var ee=y.callback;if(typeof ee=="function"){y.callback=null,v=y.priorityLevel;var x=ee(y.expirationTime<=L);if(L=t.unstable_now(),typeof x=="function"){y.callback=x,Y(L),P=!0;break t}y===s(m)&&r(m),Y(L)}else r(m);y=s(m)}if(y!==null)P=!0;else{var w=s(p);w!==null&&$(X,w.startTime-L),P=!1}}break e}finally{y=null,v=le,S=!1}P=void 0}}finally{P?J():V=!1}}}var J;if(typeof B=="function")J=function(){B(C)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,ae=I.port2;I.port1.onmessage=C,J=function(){ae.postMessage(null)}}else J=function(){N(C,0)};function $(L,P){W=N(function(){L(t.unstable_now())},P)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(L){L.callback=null},t.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<L?Math.floor(1e3/L):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(L){switch(v){case 1:case 2:case 3:var P=3;break;default:P=v}var le=v;v=P;try{return L()}finally{v=le}},t.unstable_requestPaint=function(){T=!0},t.unstable_runWithPriority=function(L,P){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var le=v;v=L;try{return P()}finally{v=le}},t.unstable_scheduleCallback=function(L,P,le){var ee=t.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?ee+le:ee):le=ee,L){case 1:var x=-1;break;case 2:x=250;break;case 5:x=1073741823;break;case 4:x=1e4;break;default:x=5e3}return x=le+x,L={id:g++,callback:P,priorityLevel:L,startTime:le,expirationTime:x,sortIndex:-1},le>ee?(L.sortIndex=le,a(p,L),s(m)===null&&L===s(p)&&(_?(O(W),W=-1):_=!0,$(X,le-ee))):(L.sortIndex=x,a(m,L),M||S||(M=!0,V||(V=!0,J()))),L},t.unstable_shouldYield=H,t.unstable_wrapCallback=function(L){var P=v;return function(){var le=v;v=P;try{return L.apply(this,arguments)}finally{v=le}}}})(Wf)),Wf}var ub;function T3(){return ub||(ub=1,Jf.exports=_3()),Jf.exports}var eh={exports:{}},Ee={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var db;function R3(){if(db)return Ee;db=1;var t=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.iterator;function v(x){return x===null||typeof x!="object"?null:(x=y&&x[y]||x["@@iterator"],typeof x=="function"?x:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,_={};function T(x,w,z){this.props=x,this.context=w,this.refs=_,this.updater=z||S}T.prototype.isReactComponent={},T.prototype.setState=function(x,w){if(typeof x!="object"&&typeof x!="function"&&x!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,x,w,"setState")},T.prototype.forceUpdate=function(x){this.updater.enqueueForceUpdate(this,x,"forceUpdate")};function N(){}N.prototype=T.prototype;function O(x,w,z){this.props=x,this.context=w,this.refs=_,this.updater=z||S}var B=O.prototype=new N;B.constructor=O,M(B,T.prototype),B.isPureReactComponent=!0;var Y=Array.isArray,X={H:null,A:null,T:null,S:null,V:null},V=Object.prototype.hasOwnProperty;function W(x,w,z,K,oe,de){return z=de.ref,{$$typeof:t,type:x,key:w,ref:z!==void 0?z:null,props:de}}function ne(x,w){return W(x.type,w,void 0,void 0,void 0,x.props)}function F(x){return typeof x=="object"&&x!==null&&x.$$typeof===t}function H(x){var w={"=":"=0",":":"=2"};return"$"+x.replace(/[=:]/g,function(z){return w[z]})}var C=/\/+/g;function J(x,w){return typeof x=="object"&&x!==null&&x.key!=null?H(""+x.key):w.toString(36)}function I(){}function ae(x){switch(x.status){case"fulfilled":return x.value;case"rejected":throw x.reason;default:switch(typeof x.status=="string"?x.then(I,I):(x.status="pending",x.then(function(w){x.status==="pending"&&(x.status="fulfilled",x.value=w)},function(w){x.status==="pending"&&(x.status="rejected",x.reason=w)})),x.status){case"fulfilled":return x.value;case"rejected":throw x.reason}}throw x}function $(x,w,z,K,oe){var de=typeof x;(de==="undefined"||de==="boolean")&&(x=null);var ue=!1;if(x===null)ue=!0;else switch(de){case"bigint":case"string":case"number":ue=!0;break;case"object":switch(x.$$typeof){case t:case a:ue=!0;break;case g:return ue=x._init,$(ue(x._payload),w,z,K,oe)}}if(ue)return oe=oe(x),ue=K===""?"."+J(x,0):K,Y(oe)?(z="",ue!=null&&(z=ue.replace(C,"$&/")+"/"),$(oe,w,z,"",function(et){return et})):oe!=null&&(F(oe)&&(oe=ne(oe,z+(oe.key==null||x&&x.key===oe.key?"":(""+oe.key).replace(C,"$&/")+"/")+ue)),w.push(oe)),1;ue=0;var ve=K===""?".":K+":";if(Y(x))for(var ge=0;ge<x.length;ge++)K=x[ge],de=ve+J(K,ge),ue+=$(K,w,z,de,oe);else if(ge=v(x),typeof ge=="function")for(x=ge.call(x),ge=0;!(K=x.next()).done;)K=K.value,de=ve+J(K,ge++),ue+=$(K,w,z,de,oe);else if(de==="object"){if(typeof x.then=="function")return $(ae(x),w,z,K,oe);throw w=String(x),Error("Objects are not valid as a React child (found: "+(w==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":w)+"). If you meant to render a collection of children, use an array instead.")}return ue}function L(x,w,z){if(x==null)return x;var K=[],oe=0;return $(x,K,"","",function(de){return w.call(z,de,oe++)}),K}function P(x){if(x._status===-1){var w=x._result;w=w(),w.then(function(z){(x._status===0||x._status===-1)&&(x._status=1,x._result=z)},function(z){(x._status===0||x._status===-1)&&(x._status=2,x._result=z)}),x._status===-1&&(x._status=0,x._result=w)}if(x._status===1)return x._result.default;throw x._result}var le=typeof reportError=="function"?reportError:function(x){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var w=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof x=="object"&&x!==null&&typeof x.message=="string"?String(x.message):String(x),error:x});if(!window.dispatchEvent(w))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",x);return}console.error(x)};function ee(){}return Ee.Children={map:L,forEach:function(x,w,z){L(x,function(){w.apply(this,arguments)},z)},count:function(x){var w=0;return L(x,function(){w++}),w},toArray:function(x){return L(x,function(w){return w})||[]},only:function(x){if(!F(x))throw Error("React.Children.only expected to receive a single React element child.");return x}},Ee.Component=T,Ee.Fragment=s,Ee.Profiler=l,Ee.PureComponent=O,Ee.StrictMode=r,Ee.Suspense=m,Ee.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=X,Ee.__COMPILER_RUNTIME={__proto__:null,c:function(x){return X.H.useMemoCache(x)}},Ee.cache=function(x){return function(){return x.apply(null,arguments)}},Ee.cloneElement=function(x,w,z){if(x==null)throw Error("The argument must be a React element, but you passed "+x+".");var K=M({},x.props),oe=x.key,de=void 0;if(w!=null)for(ue in w.ref!==void 0&&(de=void 0),w.key!==void 0&&(oe=""+w.key),w)!V.call(w,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&w.ref===void 0||(K[ue]=w[ue]);var ue=arguments.length-2;if(ue===1)K.children=z;else if(1<ue){for(var ve=Array(ue),ge=0;ge<ue;ge++)ve[ge]=arguments[ge+2];K.children=ve}return W(x.type,oe,void 0,void 0,de,K)},Ee.createContext=function(x){return x={$$typeof:f,_currentValue:x,_currentValue2:x,_threadCount:0,Provider:null,Consumer:null},x.Provider=x,x.Consumer={$$typeof:u,_context:x},x},Ee.createElement=function(x,w,z){var K,oe={},de=null;if(w!=null)for(K in w.key!==void 0&&(de=""+w.key),w)V.call(w,K)&&K!=="key"&&K!=="__self"&&K!=="__source"&&(oe[K]=w[K]);var ue=arguments.length-2;if(ue===1)oe.children=z;else if(1<ue){for(var ve=Array(ue),ge=0;ge<ue;ge++)ve[ge]=arguments[ge+2];oe.children=ve}if(x&&x.defaultProps)for(K in ue=x.defaultProps,ue)oe[K]===void 0&&(oe[K]=ue[K]);return W(x,de,void 0,void 0,null,oe)},Ee.createRef=function(){return{current:null}},Ee.forwardRef=function(x){return{$$typeof:h,render:x}},Ee.isValidElement=F,Ee.lazy=function(x){return{$$typeof:g,_payload:{_status:-1,_result:x},_init:P}},Ee.memo=function(x,w){return{$$typeof:p,type:x,compare:w===void 0?null:w}},Ee.startTransition=function(x){var w=X.T,z={};X.T=z;try{var K=x(),oe=X.S;oe!==null&&oe(z,K),typeof K=="object"&&K!==null&&typeof K.then=="function"&&K.then(ee,le)}catch(de){le(de)}finally{X.T=w}},Ee.unstable_useCacheRefresh=function(){return X.H.useCacheRefresh()},Ee.use=function(x){return X.H.use(x)},Ee.useActionState=function(x,w,z){return X.H.useActionState(x,w,z)},Ee.useCallback=function(x,w){return X.H.useCallback(x,w)},Ee.useContext=function(x){return X.H.useContext(x)},Ee.useDebugValue=function(){},Ee.useDeferredValue=function(x,w){return X.H.useDeferredValue(x,w)},Ee.useEffect=function(x,w,z){var K=X.H;if(typeof z=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return K.useEffect(x,w)},Ee.useId=function(){return X.H.useId()},Ee.useImperativeHandle=function(x,w,z){return X.H.useImperativeHandle(x,w,z)},Ee.useInsertionEffect=function(x,w){return X.H.useInsertionEffect(x,w)},Ee.useLayoutEffect=function(x,w){return X.H.useLayoutEffect(x,w)},Ee.useMemo=function(x,w){return X.H.useMemo(x,w)},Ee.useOptimistic=function(x,w){return X.H.useOptimistic(x,w)},Ee.useReducer=function(x,w,z){return X.H.useReducer(x,w,z)},Ee.useRef=function(x){return X.H.useRef(x)},Ee.useState=function(x){return X.H.useState(x)},Ee.useSyncExternalStore=function(x,w,z){return X.H.useSyncExternalStore(x,w,z)},Ee.useTransition=function(){return X.H.useTransition()},Ee.version="19.1.1",Ee}var fb;function Am(){return fb||(fb=1,eh.exports=R3()),eh.exports}var th={exports:{}},Nt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hb;function N3(){if(hb)return Nt;hb=1;var t=Am();function a(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var r={d:{f:s,r:function(){throw Error(a(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},l=Symbol.for("react.portal");function u(m,p,g){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:y==null?null:""+y,children:m,containerInfo:p,implementation:g}}var f=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Nt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Nt.createPortal=function(m,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(a(299));return u(m,p,null,g)},Nt.flushSync=function(m){var p=f.T,g=r.p;try{if(f.T=null,r.p=2,m)return m()}finally{f.T=p,r.p=g,r.d.f()}},Nt.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,r.d.C(m,p))},Nt.prefetchDNS=function(m){typeof m=="string"&&r.d.D(m)},Nt.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var g=p.as,y=h(g,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,S=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;g==="style"?r.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:y,integrity:v,fetchPriority:S}):g==="script"&&r.d.X(m,{crossOrigin:y,integrity:v,fetchPriority:S,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Nt.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var g=h(p.as,p.crossOrigin);r.d.M(m,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&r.d.M(m)},Nt.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var g=p.as,y=h(g,p.crossOrigin);r.d.L(m,g,{crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Nt.preloadModule=function(m,p){if(typeof m=="string")if(p){var g=h(p.as,p.crossOrigin);r.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else r.d.m(m)},Nt.requestFormReset=function(m){r.d.r(m)},Nt.unstable_batchedUpdates=function(m,p){return m(p)},Nt.useFormState=function(m,p,g){return f.H.useFormState(m,p,g)},Nt.useFormStatus=function(){return f.H.useHostTransitionStatus()},Nt.version="19.1.1",Nt}var mb;function k3(){if(mb)return th.exports;mb=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(a){console.error(a)}}return t(),th.exports=N3(),th.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pb;function D3(){if(pb)return go;pb=1;var t=T3(),a=Am(),s=k3();function r(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)n+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var n=e,i=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(i=n.return),e=n.return;while(e)}return n.tag===3?i:null}function f(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(r(188))}function m(e){var n=e.alternate;if(!n){if(n=u(e),n===null)throw Error(r(188));return n!==e?null:e}for(var i=e,o=n;;){var c=i.return;if(c===null)break;var d=c.alternate;if(d===null){if(o=c.return,o!==null){i=o;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===i)return h(c),e;if(d===o)return h(c),n;d=d.sibling}throw Error(r(188))}if(i.return!==o.return)i=c,o=d;else{for(var b=!1,E=c.child;E;){if(E===i){b=!0,i=c,o=d;break}if(E===o){b=!0,o=c,i=d;break}E=E.sibling}if(!b){for(E=d.child;E;){if(E===i){b=!0,i=d,o=c;break}if(E===o){b=!0,o=d,i=c;break}E=E.sibling}if(!b)throw Error(r(189))}}if(i.alternate!==o)throw Error(r(190))}if(i.tag!==3)throw Error(r(188));return i.stateNode.current===i?e:n}function p(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=p(e),n!==null)return n;e=e.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),O=Symbol.for("react.consumer"),B=Symbol.for("react.context"),Y=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),W=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),H=Symbol.for("react.memo_cache_sentinel"),C=Symbol.iterator;function J(e){return e===null||typeof e!="object"?null:(e=C&&e[C]||e["@@iterator"],typeof e=="function"?e:null)}var I=Symbol.for("react.client.reference");function ae(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===I?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case M:return"Fragment";case T:return"Profiler";case _:return"StrictMode";case X:return"Suspense";case V:return"SuspenseList";case F:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case S:return"Portal";case B:return(e.displayName||"Context")+".Provider";case O:return(e._context.displayName||"Context")+".Consumer";case Y:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case W:return n=e.displayName||null,n!==null?n:ae(e.type)||"Memo";case ne:n=e._payload,e=e._init;try{return ae(e(n))}catch{}}return null}var $=Array.isArray,L=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le={pending:!1,data:null,method:null,action:null},ee=[],x=-1;function w(e){return{current:e}}function z(e){0>x||(e.current=ee[x],ee[x]=null,x--)}function K(e,n){x++,ee[x]=e.current,e.current=n}var oe=w(null),de=w(null),ue=w(null),ve=w(null);function ge(e,n){switch(K(ue,n),K(de,e),K(oe,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?Xg(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=Xg(n),e=Kg(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}z(oe),K(oe,e)}function et(){z(oe),z(de),z(ue)}function Ot(e){e.memoizedState!==null&&K(ve,e);var n=oe.current,i=Kg(n,e.type);n!==i&&(K(de,e),K(oe,i))}function qt(e){de.current===e&&(z(oe),z(de)),ve.current===e&&(z(ve),so._currentValue=le)}var An=Object.prototype.hasOwnProperty,Bn=t.unstable_scheduleCallback,ja=t.unstable_cancelCallback,la=t.unstable_shouldYield,dn=t.unstable_requestPaint,fe=t.unstable_now,Te=t.unstable_getCurrentPriorityLevel,Ge=t.unstable_ImmediatePriority,ze=t.unstable_UserBlockingPriority,vt=t.unstable_NormalPriority,fn=t.unstable_LowPriority,Zt=t.unstable_IdlePriority,Cn=t.log,ca=t.unstable_setDisableYieldValue,Ke=null,Pe=null;function Yt(e){if(typeof Cn=="function"&&ca(e),Pe&&typeof Pe.setStrictMode=="function")try{Pe.setStrictMode(Ke,e)}catch{}}var Tt=Math.clz32?Math.clz32:Yo,Ru=Math.log,Nu=Math.LN2;function Yo(e){return e>>>=0,e===0?32:31-(Ru(e)/Nu|0)|0}var cs=256,Ga=4194304;function Hn(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function xi(e,n,i){var o=e.pendingLanes;if(o===0)return 0;var c=0,d=e.suspendedLanes,b=e.pingedLanes;e=e.warmLanes;var E=o&134217727;return E!==0?(o=E&~d,o!==0?c=Hn(o):(b&=E,b!==0?c=Hn(b):i||(i=E&~e,i!==0&&(c=Hn(i))))):(E=o&~d,E!==0?c=Hn(E):b!==0?c=Hn(b):i||(i=o&~e,i!==0&&(c=Hn(i)))),c===0?0:n!==0&&n!==c&&(n&d)===0&&(d=c&-c,i=n&-n,d>=i||d===32&&(i&4194048)!==0)?n:c}function ua(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function ku(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vo(){var e=cs;return cs<<=1,(cs&4194048)===0&&(cs=256),e}function Xo(){var e=Ga;return Ga<<=1,(Ga&62914560)===0&&(Ga=4194304),e}function us(e){for(var n=[],i=0;31>i;i++)n.push(e);return n}function In(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ko(e,n,i,o,c,d){var b=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var E=e.entanglements,A=e.expirationTimes,q=e.hiddenUpdates;for(i=b&~i;0<i;){var Z=31-Tt(i),ie=1<<Z;E[Z]=0,A[Z]=-1;var j=q[Z];if(j!==null)for(q[Z]=null,Z=0;Z<j.length;Z++){var G=j[Z];G!==null&&(G.lane&=-536870913)}i&=~ie}o!==0&&mr(e,o,0),d!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=d&~(b&~n))}function mr(e,n,i){e.pendingLanes|=n,e.suspendedLanes&=~n;var o=31-Tt(n);e.entangledLanes|=n,e.entanglements[o]=e.entanglements[o]|1073741824|i&4194090}function pr(e,n){var i=e.entangledLanes|=n;for(e=e.entanglements;i;){var o=31-Tt(i),c=1<<o;c&n|e[o]&n&&(e[o]|=n),i&=~c}}function gr(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function yr(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Qo(){var e=P.p;return e!==0?e:(e=window.event,e===void 0?32:hy(e.type))}function Po(e,n){var i=P.p;try{return P.p=e,n()}finally{P.p=i}}var jn=Math.random().toString(36).slice(2),tt="__reactFiber$"+jn,ft="__reactProps$"+jn,da="__reactContainer$"+jn,Fa="__reactEvents$"+jn,_n="__reactListeners$"+jn,ds="__reactHandles$"+jn,wi="__reactResources$"+jn,Ai="__reactMarker$"+jn;function fs(e){delete e[tt],delete e[ft],delete e[Fa],delete e[_n],delete e[ds]}function fa(e){var n=e[tt];if(n)return n;for(var i=e.parentNode;i;){if(n=i[da]||i[tt]){if(i=n.alternate,n.child!==null||i!==null&&i.child!==null)for(e=Jg(e);e!==null;){if(i=e[tt])return i;e=Jg(e)}return n}e=i,i=e.parentNode}return null}function $a(e){if(e=e[tt]||e[da]){var n=e.tag;if(n===5||n===6||n===13||n===26||n===27||n===3)return e}return null}function ha(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(r(33))}function ma(e){var n=e[wi];return n||(n=e[wi]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function nt(e){e[Ai]=!0}var hs=new Set,Zo={};function Gn(e,n){Ya(e,n),Ya(e+"Capture",n)}function Ya(e,n){for(Zo[e]=n,e=0;e<n.length;e++)hs.add(n[e])}var Jo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wo={},el={};function tl(e){return An.call(el,e)?!0:An.call(Wo,e)?!1:Jo.test(e)?el[e]=!0:(Wo[e]=!0,!1)}function Ci(e,n,i){if(tl(n))if(i===null)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var o=n.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+i)}}function _i(e,n,i){if(i===null)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+i)}}function Tn(e,n,i,o){if(o===null)e.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(n,i,""+o)}}var nl,k;function Q(e){if(nl===void 0)try{throw Error()}catch(i){var n=i.stack.trim().match(/\n( *(at )?)/);nl=n&&n[1]||"",k=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+nl+e+k}var ce=!1;function me(e,n){if(!e||ce)return"";ce=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(n){var ie=function(){throw Error()};if(Object.defineProperty(ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ie,[])}catch(G){var j=G}Reflect.construct(e,[],ie)}else{try{ie.call()}catch(G){j=G}e.call(ie.prototype)}}else{try{throw Error()}catch(G){j=G}(ie=e())&&typeof ie.catch=="function"&&ie.catch(function(){})}}catch(G){if(G&&j&&typeof G.stack=="string")return[G.stack,j.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=o.DetermineComponentFrameRoot(),b=d[0],E=d[1];if(b&&E){var A=b.split(`
`),q=E.split(`
`);for(c=o=0;o<A.length&&!A[o].includes("DetermineComponentFrameRoot");)o++;for(;c<q.length&&!q[c].includes("DetermineComponentFrameRoot");)c++;if(o===A.length||c===q.length)for(o=A.length-1,c=q.length-1;1<=o&&0<=c&&A[o]!==q[c];)c--;for(;1<=o&&0<=c;o--,c--)if(A[o]!==q[c]){if(o!==1||c!==1)do if(o--,c--,0>c||A[o]!==q[c]){var Z=`
`+A[o].replace(" at new "," at ");return e.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",e.displayName)),Z}while(1<=o&&0<=c);break}}}finally{ce=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?Q(i):""}function Re(e){switch(e.tag){case 26:case 27:case 5:return Q(e.type);case 16:return Q("Lazy");case 13:return Q("Suspense");case 19:return Q("SuspenseList");case 0:case 15:return me(e.type,!1);case 11:return me(e.type.render,!1);case 1:return me(e.type,!0);case 31:return Q("Activity");default:return""}}function Fe(e){try{var n="";do n+=Re(e),e=e.return;while(e);return n}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function _e(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function at(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Jt(e){var n=at(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),o=""+e[n];if(!e.hasOwnProperty(n)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var c=i.get,d=i.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return c.call(this)},set:function(b){o=""+b,d.call(this,b)}}),Object.defineProperty(e,n,{enumerable:i.enumerable}),{getValue:function(){return o},setValue:function(b){o=""+b},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function St(e){e._valueTracker||(e._valueTracker=Jt(e))}function Wt(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var i=n.getValue(),o="";return e&&(o=at(e)?e.checked?"true":"false":e.value),e=o,e!==i?(n.setValue(e),!0):!1}function en(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Ti=/[\n"\\]/g;function ht(e){return e.replace(Ti,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function it(e,n,i,o,c,d,b,E){e.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?e.type=b:e.removeAttribute("type"),n!=null?b==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+_e(n)):e.value!==""+_e(n)&&(e.value=""+_e(n)):b!=="submit"&&b!=="reset"||e.removeAttribute("value"),n!=null?Xa(e,b,_e(n)):i!=null?Xa(e,b,_e(i)):o!=null&&e.removeAttribute("value"),c==null&&d!=null&&(e.defaultChecked=!!d),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?e.name=""+_e(E):e.removeAttribute("name")}function Va(e,n,i,o,c,d,b,E){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),n!=null||i!=null){if(!(d!=="submit"&&d!=="reset"||n!=null))return;i=i!=null?""+_e(i):"",n=n!=null?""+_e(n):i,E||n===e.value||(e.value=n),e.defaultValue=n}o=o??c,o=typeof o!="function"&&typeof o!="symbol"&&!!o,e.checked=E?e.checked:!!o,e.defaultChecked=!!o,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(e.name=b)}function Xa(e,n,i){n==="number"&&en(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function pa(e,n,i,o){if(e=e.options,n){n={};for(var c=0;c<i.length;c++)n["$"+i[c]]=!0;for(i=0;i<e.length;i++)c=n.hasOwnProperty("$"+e[i].value),e[i].selected!==c&&(e[i].selected=c),c&&o&&(e[i].defaultSelected=!0)}else{for(i=""+_e(i),n=null,c=0;c<e.length;c++){if(e[c].value===i){e[c].selected=!0,o&&(e[c].defaultSelected=!0);return}n!==null||e[c].disabled||(n=e[c])}n!==null&&(n.selected=!0)}}function Fn(e,n,i){if(n!=null&&(n=""+_e(n),n!==e.value&&(e.value=n),i==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=i!=null?""+_e(i):""}function al(e,n,i,o){if(n==null){if(o!=null){if(i!=null)throw Error(r(92));if($(o)){if(1<o.length)throw Error(r(93));o=o[0]}i=o}i==null&&(i=""),n=i}i=_e(n),e.defaultValue=i,o=e.textContent,o===i&&o!==""&&o!==null&&(e.value=o)}function ms(e,n){if(n){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=n;return}}e.textContent=n}var M1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Xm(e,n,i){var o=n.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?o?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":o?e.setProperty(n,i):typeof i!="number"||i===0||M1.has(n)?n==="float"?e.cssFloat=i:e[n]=(""+i).trim():e[n]=i+"px"}function Km(e,n,i){if(n!=null&&typeof n!="object")throw Error(r(62));if(e=e.style,i!=null){for(var o in i)!i.hasOwnProperty(o)||n!=null&&n.hasOwnProperty(o)||(o.indexOf("--")===0?e.setProperty(o,""):o==="float"?e.cssFloat="":e[o]="");for(var c in n)o=n[c],n.hasOwnProperty(c)&&i[c]!==o&&Xm(e,c,o)}else for(var d in n)n.hasOwnProperty(d)&&Xm(e,d,n[d])}function Du(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var x1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),w1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function il(e){return w1.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Lu=null;function Uu(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ps=null,gs=null;function Qm(e){var n=$a(e);if(n&&(e=n.stateNode)){var i=e[ft]||null;e:switch(e=n.stateNode,n.type){case"input":if(it(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),n=i.name,i.type==="radio"&&n!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+ht(""+n)+'"][type="radio"]'),n=0;n<i.length;n++){var o=i[n];if(o!==e&&o.form===e.form){var c=o[ft]||null;if(!c)throw Error(r(90));it(o,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(n=0;n<i.length;n++)o=i[n],o.form===e.form&&Wt(o)}break e;case"textarea":Fn(e,i.value,i.defaultValue);break e;case"select":n=i.value,n!=null&&pa(e,!!i.multiple,n,!1)}}}var Ou=!1;function Pm(e,n,i){if(Ou)return e(n,i);Ou=!0;try{var o=e(n);return o}finally{if(Ou=!1,(ps!==null||gs!==null)&&(Fl(),ps&&(n=ps,e=gs,gs=ps=null,Qm(n),e)))for(n=0;n<e.length;n++)Qm(e[n])}}function br(e,n){var i=e.stateNode;if(i===null)return null;var o=i[ft]||null;if(o===null)return null;i=o[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(r(231,n,typeof i));return i}var ga=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qu=!1;if(ga)try{var vr={};Object.defineProperty(vr,"passive",{get:function(){qu=!0}}),window.addEventListener("test",vr,vr),window.removeEventListener("test",vr,vr)}catch{qu=!1}var Ka=null,zu=null,sl=null;function Zm(){if(sl)return sl;var e,n=zu,i=n.length,o,c="value"in Ka?Ka.value:Ka.textContent,d=c.length;for(e=0;e<i&&n[e]===c[e];e++);var b=i-e;for(o=1;o<=b&&n[i-o]===c[d-o];o++);return sl=c.slice(e,1<o?1-o:void 0)}function rl(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function ol(){return!0}function Jm(){return!1}function Vt(e){function n(i,o,c,d,b){this._reactName=i,this._targetInst=c,this.type=o,this.nativeEvent=d,this.target=b,this.currentTarget=null;for(var E in e)e.hasOwnProperty(E)&&(i=e[E],this[E]=i?i(d):d[E]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?ol:Jm,this.isPropagationStopped=Jm,this}return g(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=ol)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=ol)},persist:function(){},isPersistent:ol}),n}var Ri={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ll=Vt(Ri),Sr=g({},Ri,{view:0,detail:0}),A1=Vt(Sr),Bu,Hu,Er,cl=g({},Sr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ju,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Er&&(Er&&e.type==="mousemove"?(Bu=e.screenX-Er.screenX,Hu=e.screenY-Er.screenY):Hu=Bu=0,Er=e),Bu)},movementY:function(e){return"movementY"in e?e.movementY:Hu}}),Wm=Vt(cl),C1=g({},cl,{dataTransfer:0}),_1=Vt(C1),T1=g({},Sr,{relatedTarget:0}),Iu=Vt(T1),R1=g({},Ri,{animationName:0,elapsedTime:0,pseudoElement:0}),N1=Vt(R1),k1=g({},Ri,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),D1=Vt(k1),L1=g({},Ri,{data:0}),ep=Vt(L1),U1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},O1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},q1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function z1(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=q1[e])?!!n[e]:!1}function ju(){return z1}var B1=g({},Sr,{key:function(e){if(e.key){var n=U1[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=rl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?O1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ju,charCode:function(e){return e.type==="keypress"?rl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?rl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),H1=Vt(B1),I1=g({},cl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),tp=Vt(I1),j1=g({},Sr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ju}),G1=Vt(j1),F1=g({},Ri,{propertyName:0,elapsedTime:0,pseudoElement:0}),$1=Vt(F1),Y1=g({},cl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),V1=Vt(Y1),X1=g({},Ri,{newState:0,oldState:0}),K1=Vt(X1),Q1=[9,13,27,32],Gu=ga&&"CompositionEvent"in window,Mr=null;ga&&"documentMode"in document&&(Mr=document.documentMode);var P1=ga&&"TextEvent"in window&&!Mr,np=ga&&(!Gu||Mr&&8<Mr&&11>=Mr),ap=" ",ip=!1;function sp(e,n){switch(e){case"keyup":return Q1.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rp(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ys=!1;function Z1(e,n){switch(e){case"compositionend":return rp(n);case"keypress":return n.which!==32?null:(ip=!0,ap);case"textInput":return e=n.data,e===ap&&ip?null:e;default:return null}}function J1(e,n){if(ys)return e==="compositionend"||!Gu&&sp(e,n)?(e=Zm(),sl=zu=Ka=null,ys=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return np&&n.locale!=="ko"?null:n.data;default:return null}}var W1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function op(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!W1[e.type]:n==="textarea"}function lp(e,n,i,o){ps?gs?gs.push(o):gs=[o]:ps=o,n=Ql(n,"onChange"),0<n.length&&(i=new ll("onChange","change",null,i,o),e.push({event:i,listeners:n}))}var xr=null,wr=null;function eS(e){Gg(e,0)}function ul(e){var n=ha(e);if(Wt(n))return e}function cp(e,n){if(e==="change")return n}var up=!1;if(ga){var Fu;if(ga){var $u="oninput"in document;if(!$u){var dp=document.createElement("div");dp.setAttribute("oninput","return;"),$u=typeof dp.oninput=="function"}Fu=$u}else Fu=!1;up=Fu&&(!document.documentMode||9<document.documentMode)}function fp(){xr&&(xr.detachEvent("onpropertychange",hp),wr=xr=null)}function hp(e){if(e.propertyName==="value"&&ul(wr)){var n=[];lp(n,wr,e,Uu(e)),Pm(eS,n)}}function tS(e,n,i){e==="focusin"?(fp(),xr=n,wr=i,xr.attachEvent("onpropertychange",hp)):e==="focusout"&&fp()}function nS(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ul(wr)}function aS(e,n){if(e==="click")return ul(n)}function iS(e,n){if(e==="input"||e==="change")return ul(n)}function sS(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var tn=typeof Object.is=="function"?Object.is:sS;function Ar(e,n){if(tn(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var i=Object.keys(e),o=Object.keys(n);if(i.length!==o.length)return!1;for(o=0;o<i.length;o++){var c=i[o];if(!An.call(n,c)||!tn(e[c],n[c]))return!1}return!0}function mp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function pp(e,n){var i=mp(e);e=0;for(var o;i;){if(i.nodeType===3){if(o=e+i.textContent.length,e<=n&&o>=n)return{node:i,offset:n-e};e=o}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=mp(i)}}function gp(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?gp(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function yp(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=en(e.document);n instanceof e.HTMLIFrameElement;){try{var i=typeof n.contentWindow.location.href=="string"}catch{i=!1}if(i)e=n.contentWindow;else break;n=en(e.document)}return n}function Yu(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var rS=ga&&"documentMode"in document&&11>=document.documentMode,bs=null,Vu=null,Cr=null,Xu=!1;function bp(e,n,i){var o=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Xu||bs==null||bs!==en(o)||(o=bs,"selectionStart"in o&&Yu(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Cr&&Ar(Cr,o)||(Cr=o,o=Ql(Vu,"onSelect"),0<o.length&&(n=new ll("onSelect","select",null,n,i),e.push({event:n,listeners:o}),n.target=bs)))}function Ni(e,n){var i={};return i[e.toLowerCase()]=n.toLowerCase(),i["Webkit"+e]="webkit"+n,i["Moz"+e]="moz"+n,i}var vs={animationend:Ni("Animation","AnimationEnd"),animationiteration:Ni("Animation","AnimationIteration"),animationstart:Ni("Animation","AnimationStart"),transitionrun:Ni("Transition","TransitionRun"),transitionstart:Ni("Transition","TransitionStart"),transitioncancel:Ni("Transition","TransitionCancel"),transitionend:Ni("Transition","TransitionEnd")},Ku={},vp={};ga&&(vp=document.createElement("div").style,"AnimationEvent"in window||(delete vs.animationend.animation,delete vs.animationiteration.animation,delete vs.animationstart.animation),"TransitionEvent"in window||delete vs.transitionend.transition);function ki(e){if(Ku[e])return Ku[e];if(!vs[e])return e;var n=vs[e],i;for(i in n)if(n.hasOwnProperty(i)&&i in vp)return Ku[e]=n[i];return e}var Sp=ki("animationend"),Ep=ki("animationiteration"),Mp=ki("animationstart"),oS=ki("transitionrun"),lS=ki("transitionstart"),cS=ki("transitioncancel"),xp=ki("transitionend"),wp=new Map,Qu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Qu.push("scrollEnd");function Rn(e,n){wp.set(e,n),Gn(n,[e])}var Ap=new WeakMap;function hn(e,n){if(typeof e=="object"&&e!==null){var i=Ap.get(e);return i!==void 0?i:(n={value:e,source:n,stack:Fe(n)},Ap.set(e,n),n)}return{value:e,source:n,stack:Fe(n)}}var mn=[],Ss=0,Pu=0;function dl(){for(var e=Ss,n=Pu=Ss=0;n<e;){var i=mn[n];mn[n++]=null;var o=mn[n];mn[n++]=null;var c=mn[n];mn[n++]=null;var d=mn[n];if(mn[n++]=null,o!==null&&c!==null){var b=o.pending;b===null?c.next=c:(c.next=b.next,b.next=c),o.pending=c}d!==0&&Cp(i,c,d)}}function fl(e,n,i,o){mn[Ss++]=e,mn[Ss++]=n,mn[Ss++]=i,mn[Ss++]=o,Pu|=o,e.lanes|=o,e=e.alternate,e!==null&&(e.lanes|=o)}function Zu(e,n,i,o){return fl(e,n,i,o),hl(e)}function Es(e,n){return fl(e,null,null,n),hl(e)}function Cp(e,n,i){e.lanes|=i;var o=e.alternate;o!==null&&(o.lanes|=i);for(var c=!1,d=e.return;d!==null;)d.childLanes|=i,o=d.alternate,o!==null&&(o.childLanes|=i),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(c=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,c&&n!==null&&(c=31-Tt(i),e=d.hiddenUpdates,o=e[c],o===null?e[c]=[n]:o.push(n),n.lane=i|536870912),d):null}function hl(e){if(50<Zr)throw Zr=0,af=null,Error(r(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Ms={};function uS(e,n,i,o){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nn(e,n,i,o){return new uS(e,n,i,o)}function Ju(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ya(e,n){var i=e.alternate;return i===null?(i=nn(e.tag,n,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=n,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,n=e.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function _p(e,n){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,n=i.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function ml(e,n,i,o,c,d){var b=0;if(o=e,typeof e=="function")Ju(e)&&(b=1);else if(typeof e=="string")b=fE(e,i,oe.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case F:return e=nn(31,i,n,c),e.elementType=F,e.lanes=d,e;case M:return Di(i.children,c,d,n);case _:b=8,c|=24;break;case T:return e=nn(12,i,n,c|2),e.elementType=T,e.lanes=d,e;case X:return e=nn(13,i,n,c),e.elementType=X,e.lanes=d,e;case V:return e=nn(19,i,n,c),e.elementType=V,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case N:case B:b=10;break e;case O:b=9;break e;case Y:b=11;break e;case W:b=14;break e;case ne:b=16,o=null;break e}b=29,i=Error(r(130,e===null?"null":typeof e,"")),o=null}return n=nn(b,i,n,c),n.elementType=e,n.type=o,n.lanes=d,n}function Di(e,n,i,o){return e=nn(7,e,o,n),e.lanes=i,e}function Wu(e,n,i){return e=nn(6,e,null,n),e.lanes=i,e}function ed(e,n,i){return n=nn(4,e.children!==null?e.children:[],e.key,n),n.lanes=i,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var xs=[],ws=0,pl=null,gl=0,pn=[],gn=0,Li=null,ba=1,va="";function Ui(e,n){xs[ws++]=gl,xs[ws++]=pl,pl=e,gl=n}function Tp(e,n,i){pn[gn++]=ba,pn[gn++]=va,pn[gn++]=Li,Li=e;var o=ba;e=va;var c=32-Tt(o)-1;o&=~(1<<c),i+=1;var d=32-Tt(n)+c;if(30<d){var b=c-c%5;d=(o&(1<<b)-1).toString(32),o>>=b,c-=b,ba=1<<32-Tt(n)+c|i<<c|o,va=d+e}else ba=1<<d|i<<c|o,va=e}function td(e){e.return!==null&&(Ui(e,1),Tp(e,1,0))}function nd(e){for(;e===pl;)pl=xs[--ws],xs[ws]=null,gl=xs[--ws],xs[ws]=null;for(;e===Li;)Li=pn[--gn],pn[gn]=null,va=pn[--gn],pn[gn]=null,ba=pn[--gn],pn[gn]=null}var zt=null,st=null,De=!1,Oi=null,$n=!1,ad=Error(r(519));function qi(e){var n=Error(r(418,""));throw Rr(hn(n,e)),ad}function Rp(e){var n=e.stateNode,i=e.type,o=e.memoizedProps;switch(n[tt]=e,n[ft]=o,i){case"dialog":Ce("cancel",n),Ce("close",n);break;case"iframe":case"object":case"embed":Ce("load",n);break;case"video":case"audio":for(i=0;i<Wr.length;i++)Ce(Wr[i],n);break;case"source":Ce("error",n);break;case"img":case"image":case"link":Ce("error",n),Ce("load",n);break;case"details":Ce("toggle",n);break;case"input":Ce("invalid",n),Va(n,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0),St(n);break;case"select":Ce("invalid",n);break;case"textarea":Ce("invalid",n),al(n,o.value,o.defaultValue,o.children),St(n)}i=o.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||n.textContent===""+i||o.suppressHydrationWarning===!0||Vg(n.textContent,i)?(o.popover!=null&&(Ce("beforetoggle",n),Ce("toggle",n)),o.onScroll!=null&&Ce("scroll",n),o.onScrollEnd!=null&&Ce("scrollend",n),o.onClick!=null&&(n.onclick=Pl),n=!0):n=!1,n||qi(e)}function Np(e){for(zt=e.return;zt;)switch(zt.tag){case 5:case 13:$n=!1;return;case 27:case 3:$n=!0;return;default:zt=zt.return}}function _r(e){if(e!==zt)return!1;if(!De)return Np(e),De=!0,!1;var n=e.tag,i;if((i=n!==3&&n!==27)&&((i=n===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||Sf(e.type,e.memoizedProps)),i=!i),i&&st&&qi(e),Np(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8)if(i=e.data,i==="/$"){if(n===0){st=kn(e.nextSibling);break e}n--}else i!=="$"&&i!=="$!"&&i!=="$?"||n++;e=e.nextSibling}st=null}}else n===27?(n=st,ui(e.type)?(e=wf,wf=null,st=e):st=n):st=zt?kn(e.stateNode.nextSibling):null;return!0}function Tr(){st=zt=null,De=!1}function kp(){var e=Oi;return e!==null&&(Qt===null?Qt=e:Qt.push.apply(Qt,e),Oi=null),e}function Rr(e){Oi===null?Oi=[e]:Oi.push(e)}var id=w(null),zi=null,Sa=null;function Qa(e,n,i){K(id,n._currentValue),n._currentValue=i}function Ea(e){e._currentValue=id.current,z(id)}function sd(e,n,i){for(;e!==null;){var o=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,o!==null&&(o.childLanes|=n)):o!==null&&(o.childLanes&n)!==n&&(o.childLanes|=n),e===i)break;e=e.return}}function rd(e,n,i,o){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var d=c.dependencies;if(d!==null){var b=c.child;d=d.firstContext;e:for(;d!==null;){var E=d;d=c;for(var A=0;A<n.length;A++)if(E.context===n[A]){d.lanes|=i,E=d.alternate,E!==null&&(E.lanes|=i),sd(d.return,i,e),o||(b=null);break e}d=E.next}}else if(c.tag===18){if(b=c.return,b===null)throw Error(r(341));b.lanes|=i,d=b.alternate,d!==null&&(d.lanes|=i),sd(b,i,e),b=null}else b=c.child;if(b!==null)b.return=c;else for(b=c;b!==null;){if(b===e){b=null;break}if(c=b.sibling,c!==null){c.return=b.return,b=c;break}b=b.return}c=b}}function Nr(e,n,i,o){e=null;for(var c=n,d=!1;c!==null;){if(!d){if((c.flags&524288)!==0)d=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var b=c.alternate;if(b===null)throw Error(r(387));if(b=b.memoizedProps,b!==null){var E=c.type;tn(c.pendingProps.value,b.value)||(e!==null?e.push(E):e=[E])}}else if(c===ve.current){if(b=c.alternate,b===null)throw Error(r(387));b.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(so):e=[so])}c=c.return}e!==null&&rd(n,e,i,o),n.flags|=262144}function yl(e){for(e=e.firstContext;e!==null;){if(!tn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Bi(e){zi=e,Sa=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Rt(e){return Dp(zi,e)}function bl(e,n){return zi===null&&Bi(e),Dp(e,n)}function Dp(e,n){var i=n._currentValue;if(n={context:n,memoizedValue:i,next:null},Sa===null){if(e===null)throw Error(r(308));Sa=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else Sa=Sa.next=n;return i}var dS=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(i,o){e.push(o)}};this.abort=function(){n.aborted=!0,e.forEach(function(i){return i()})}},fS=t.unstable_scheduleCallback,hS=t.unstable_NormalPriority,mt={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function od(){return{controller:new dS,data:new Map,refCount:0}}function kr(e){e.refCount--,e.refCount===0&&fS(hS,function(){e.controller.abort()})}var Dr=null,ld=0,As=0,Cs=null;function mS(e,n){if(Dr===null){var i=Dr=[];ld=0,As=df(),Cs={status:"pending",value:void 0,then:function(o){i.push(o)}}}return ld++,n.then(Lp,Lp),n}function Lp(){if(--ld===0&&Dr!==null){Cs!==null&&(Cs.status="fulfilled");var e=Dr;Dr=null,As=0,Cs=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function pS(e,n){var i=[],o={status:"pending",value:null,reason:null,then:function(c){i.push(c)}};return e.then(function(){o.status="fulfilled",o.value=n;for(var c=0;c<i.length;c++)(0,i[c])(n)},function(c){for(o.status="rejected",o.reason=c,c=0;c<i.length;c++)(0,i[c])(void 0)}),o}var Up=L.S;L.S=function(e,n){typeof n=="object"&&n!==null&&typeof n.then=="function"&&mS(e,n),Up!==null&&Up(e,n)};var Hi=w(null);function cd(){var e=Hi.current;return e!==null?e:Ye.pooledCache}function vl(e,n){n===null?K(Hi,Hi.current):K(Hi,n.pool)}function Op(){var e=cd();return e===null?null:{parent:mt._currentValue,pool:e}}var Lr=Error(r(460)),qp=Error(r(474)),Sl=Error(r(542)),ud={then:function(){}};function zp(e){return e=e.status,e==="fulfilled"||e==="rejected"}function El(){}function Bp(e,n,i){switch(i=e[i],i===void 0?e.push(n):i!==n&&(n.then(El,El),n=i),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Ip(e),e;default:if(typeof n.status=="string")n.then(El,El);else{if(e=Ye,e!==null&&100<e.shellSuspendCounter)throw Error(r(482));e=n,e.status="pending",e.then(function(o){if(n.status==="pending"){var c=n;c.status="fulfilled",c.value=o}},function(o){if(n.status==="pending"){var c=n;c.status="rejected",c.reason=o}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Ip(e),e}throw Ur=n,Lr}}var Ur=null;function Hp(){if(Ur===null)throw Error(r(459));var e=Ur;return Ur=null,e}function Ip(e){if(e===Lr||e===Sl)throw Error(r(483))}var Pa=!1;function dd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fd(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Za(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ja(e,n,i){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,(Le&2)!==0){var c=o.pending;return c===null?n.next=n:(n.next=c.next,c.next=n),o.pending=n,n=hl(e),Cp(e,null,i),n}return fl(e,o,n,i),hl(e)}function Or(e,n,i){if(n=n.updateQueue,n!==null&&(n=n.shared,(i&4194048)!==0)){var o=n.lanes;o&=e.pendingLanes,i|=o,n.lanes=i,pr(e,i)}}function hd(e,n){var i=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,i===o)){var c=null,d=null;if(i=i.firstBaseUpdate,i!==null){do{var b={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};d===null?c=d=b:d=d.next=b,i=i.next}while(i!==null);d===null?c=d=n:d=d.next=n}else c=d=n;i={baseState:o.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:o.shared,callbacks:o.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=n:e.next=n,i.lastBaseUpdate=n}var md=!1;function qr(){if(md){var e=Cs;if(e!==null)throw e}}function zr(e,n,i,o){md=!1;var c=e.updateQueue;Pa=!1;var d=c.firstBaseUpdate,b=c.lastBaseUpdate,E=c.shared.pending;if(E!==null){c.shared.pending=null;var A=E,q=A.next;A.next=null,b===null?d=q:b.next=q,b=A;var Z=e.alternate;Z!==null&&(Z=Z.updateQueue,E=Z.lastBaseUpdate,E!==b&&(E===null?Z.firstBaseUpdate=q:E.next=q,Z.lastBaseUpdate=A))}if(d!==null){var ie=c.baseState;b=0,Z=q=A=null,E=d;do{var j=E.lane&-536870913,G=j!==E.lane;if(G?(Ne&j)===j:(o&j)===j){j!==0&&j===As&&(md=!0),Z!==null&&(Z=Z.next={lane:0,tag:E.tag,payload:E.payload,callback:null,next:null});e:{var Se=e,ye=E;j=n;var Ie=i;switch(ye.tag){case 1:if(Se=ye.payload,typeof Se=="function"){ie=Se.call(Ie,ie,j);break e}ie=Se;break e;case 3:Se.flags=Se.flags&-65537|128;case 0:if(Se=ye.payload,j=typeof Se=="function"?Se.call(Ie,ie,j):Se,j==null)break e;ie=g({},ie,j);break e;case 2:Pa=!0}}j=E.callback,j!==null&&(e.flags|=64,G&&(e.flags|=8192),G=c.callbacks,G===null?c.callbacks=[j]:G.push(j))}else G={lane:j,tag:E.tag,payload:E.payload,callback:E.callback,next:null},Z===null?(q=Z=G,A=ie):Z=Z.next=G,b|=j;if(E=E.next,E===null){if(E=c.shared.pending,E===null)break;G=E,E=G.next,G.next=null,c.lastBaseUpdate=G,c.shared.pending=null}}while(!0);Z===null&&(A=ie),c.baseState=A,c.firstBaseUpdate=q,c.lastBaseUpdate=Z,d===null&&(c.shared.lanes=0),ri|=b,e.lanes=b,e.memoizedState=ie}}function jp(e,n){if(typeof e!="function")throw Error(r(191,e));e.call(n)}function Gp(e,n){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)jp(i[e],n)}var _s=w(null),Ml=w(0);function Fp(e,n){e=Ta,K(Ml,e),K(_s,n),Ta=e|n.baseLanes}function pd(){K(Ml,Ta),K(_s,_s.current)}function gd(){Ta=Ml.current,z(_s),z(Ml)}var Wa=0,Me=null,Be=null,ut=null,xl=!1,Ts=!1,Ii=!1,wl=0,Br=0,Rs=null,gS=0;function ot(){throw Error(r(321))}function yd(e,n){if(n===null)return!1;for(var i=0;i<n.length&&i<e.length;i++)if(!tn(e[i],n[i]))return!1;return!0}function bd(e,n,i,o,c,d){return Wa=d,Me=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,L.H=e===null||e.memoizedState===null?C0:_0,Ii=!1,d=i(o,c),Ii=!1,Ts&&(d=Yp(n,i,o,c)),$p(e),d}function $p(e){L.H=Nl;var n=Be!==null&&Be.next!==null;if(Wa=0,ut=Be=Me=null,xl=!1,Br=0,Rs=null,n)throw Error(r(300));e===null||Et||(e=e.dependencies,e!==null&&yl(e)&&(Et=!0))}function Yp(e,n,i,o){Me=e;var c=0;do{if(Ts&&(Rs=null),Br=0,Ts=!1,25<=c)throw Error(r(301));if(c+=1,ut=Be=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}L.H=xS,d=n(i,o)}while(Ts);return d}function yS(){var e=L.H,n=e.useState()[0];return n=typeof n.then=="function"?Hr(n):n,e=e.useState()[0],(Be!==null?Be.memoizedState:null)!==e&&(Me.flags|=1024),n}function vd(){var e=wl!==0;return wl=0,e}function Sd(e,n,i){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~i}function Ed(e){if(xl){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}xl=!1}Wa=0,ut=Be=Me=null,Ts=!1,Br=wl=0,Rs=null}function Xt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ut===null?Me.memoizedState=ut=e:ut=ut.next=e,ut}function dt(){if(Be===null){var e=Me.alternate;e=e!==null?e.memoizedState:null}else e=Be.next;var n=ut===null?Me.memoizedState:ut.next;if(n!==null)ut=n,Be=e;else{if(e===null)throw Me.alternate===null?Error(r(467)):Error(r(310));Be=e,e={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},ut===null?Me.memoizedState=ut=e:ut=ut.next=e}return ut}function Md(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Hr(e){var n=Br;return Br+=1,Rs===null&&(Rs=[]),e=Bp(Rs,e,n),n=Me,(ut===null?n.memoizedState:ut.next)===null&&(n=n.alternate,L.H=n===null||n.memoizedState===null?C0:_0),e}function Al(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Hr(e);if(e.$$typeof===B)return Rt(e)}throw Error(r(438,String(e)))}function xd(e){var n=null,i=Me.updateQueue;if(i!==null&&(n=i.memoCache),n==null){var o=Me.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(n={data:o.data.map(function(c){return c.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),i===null&&(i=Md(),Me.updateQueue=i),i.memoCache=n,i=n.data[n.index],i===void 0)for(i=n.data[n.index]=Array(e),o=0;o<e;o++)i[o]=H;return n.index++,i}function Ma(e,n){return typeof n=="function"?n(e):n}function Cl(e){var n=dt();return wd(n,Be,e)}function wd(e,n,i){var o=e.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=i;var c=e.baseQueue,d=o.pending;if(d!==null){if(c!==null){var b=c.next;c.next=d.next,d.next=b}n.baseQueue=c=d,o.pending=null}if(d=e.baseState,c===null)e.memoizedState=d;else{n=c.next;var E=b=null,A=null,q=n,Z=!1;do{var ie=q.lane&-536870913;if(ie!==q.lane?(Ne&ie)===ie:(Wa&ie)===ie){var j=q.revertLane;if(j===0)A!==null&&(A=A.next={lane:0,revertLane:0,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),ie===As&&(Z=!0);else if((Wa&j)===j){q=q.next,j===As&&(Z=!0);continue}else ie={lane:0,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},A===null?(E=A=ie,b=d):A=A.next=ie,Me.lanes|=j,ri|=j;ie=q.action,Ii&&i(d,ie),d=q.hasEagerState?q.eagerState:i(d,ie)}else j={lane:ie,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},A===null?(E=A=j,b=d):A=A.next=j,Me.lanes|=ie,ri|=ie;q=q.next}while(q!==null&&q!==n);if(A===null?b=d:A.next=E,!tn(d,e.memoizedState)&&(Et=!0,Z&&(i=Cs,i!==null)))throw i;e.memoizedState=d,e.baseState=b,e.baseQueue=A,o.lastRenderedState=d}return c===null&&(o.lanes=0),[e.memoizedState,o.dispatch]}function Ad(e){var n=dt(),i=n.queue;if(i===null)throw Error(r(311));i.lastRenderedReducer=e;var o=i.dispatch,c=i.pending,d=n.memoizedState;if(c!==null){i.pending=null;var b=c=c.next;do d=e(d,b.action),b=b.next;while(b!==c);tn(d,n.memoizedState)||(Et=!0),n.memoizedState=d,n.baseQueue===null&&(n.baseState=d),i.lastRenderedState=d}return[d,o]}function Vp(e,n,i){var o=Me,c=dt(),d=De;if(d){if(i===void 0)throw Error(r(407));i=i()}else i=n();var b=!tn((Be||c).memoizedState,i);b&&(c.memoizedState=i,Et=!0),c=c.queue;var E=Qp.bind(null,o,c,e);if(Ir(2048,8,E,[e]),c.getSnapshot!==n||b||ut!==null&&ut.memoizedState.tag&1){if(o.flags|=2048,Ns(9,_l(),Kp.bind(null,o,c,i,n),null),Ye===null)throw Error(r(349));d||(Wa&124)!==0||Xp(o,n,i)}return i}function Xp(e,n,i){e.flags|=16384,e={getSnapshot:n,value:i},n=Me.updateQueue,n===null?(n=Md(),Me.updateQueue=n,n.stores=[e]):(i=n.stores,i===null?n.stores=[e]:i.push(e))}function Kp(e,n,i,o){n.value=i,n.getSnapshot=o,Pp(n)&&Zp(e)}function Qp(e,n,i){return i(function(){Pp(n)&&Zp(e)})}function Pp(e){var n=e.getSnapshot;e=e.value;try{var i=n();return!tn(e,i)}catch{return!0}}function Zp(e){var n=Es(e,2);n!==null&&ln(n,e,2)}function Cd(e){var n=Xt();if(typeof e=="function"){var i=e;if(e=i(),Ii){Yt(!0);try{i()}finally{Yt(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:e},n}function Jp(e,n,i,o){return e.baseState=i,wd(e,Be,typeof o=="function"?o:Ma)}function bS(e,n,i,o,c){if(Rl(e))throw Error(r(485));if(e=n.action,e!==null){var d={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){d.listeners.push(b)}};L.T!==null?i(!0):d.isTransition=!1,o(d),i=n.pending,i===null?(d.next=n.pending=d,Wp(n,d)):(d.next=i.next,n.pending=i.next=d)}}function Wp(e,n){var i=n.action,o=n.payload,c=e.state;if(n.isTransition){var d=L.T,b={};L.T=b;try{var E=i(c,o),A=L.S;A!==null&&A(b,E),e0(e,n,E)}catch(q){_d(e,n,q)}finally{L.T=d}}else try{d=i(c,o),e0(e,n,d)}catch(q){_d(e,n,q)}}function e0(e,n,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(o){t0(e,n,o)},function(o){return _d(e,n,o)}):t0(e,n,i)}function t0(e,n,i){n.status="fulfilled",n.value=i,n0(n),e.state=i,n=e.pending,n!==null&&(i=n.next,i===n?e.pending=null:(i=i.next,n.next=i,Wp(e,i)))}function _d(e,n,i){var o=e.pending;if(e.pending=null,o!==null){o=o.next;do n.status="rejected",n.reason=i,n0(n),n=n.next;while(n!==o)}e.action=null}function n0(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function a0(e,n){return n}function i0(e,n){if(De){var i=Ye.formState;if(i!==null){e:{var o=Me;if(De){if(st){t:{for(var c=st,d=$n;c.nodeType!==8;){if(!d){c=null;break t}if(c=kn(c.nextSibling),c===null){c=null;break t}}d=c.data,c=d==="F!"||d==="F"?c:null}if(c){st=kn(c.nextSibling),o=c.data==="F!";break e}}qi(o)}o=!1}o&&(n=i[0])}}return i=Xt(),i.memoizedState=i.baseState=n,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a0,lastRenderedState:n},i.queue=o,i=x0.bind(null,Me,o),o.dispatch=i,o=Cd(!1),d=Dd.bind(null,Me,!1,o.queue),o=Xt(),c={state:n,dispatch:null,action:e,pending:null},o.queue=c,i=bS.bind(null,Me,c,d,i),c.dispatch=i,o.memoizedState=e,[n,i,!1]}function s0(e){var n=dt();return r0(n,Be,e)}function r0(e,n,i){if(n=wd(e,n,a0)[0],e=Cl(Ma)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var o=Hr(n)}catch(b){throw b===Lr?Sl:b}else o=n;n=dt();var c=n.queue,d=c.dispatch;return i!==n.memoizedState&&(Me.flags|=2048,Ns(9,_l(),vS.bind(null,c,i),null)),[o,d,e]}function vS(e,n){e.action=n}function o0(e){var n=dt(),i=Be;if(i!==null)return r0(n,i,e);dt(),n=n.memoizedState,i=dt();var o=i.queue.dispatch;return i.memoizedState=e,[n,o,!1]}function Ns(e,n,i,o){return e={tag:e,create:i,deps:o,inst:n,next:null},n=Me.updateQueue,n===null&&(n=Md(),Me.updateQueue=n),i=n.lastEffect,i===null?n.lastEffect=e.next=e:(o=i.next,i.next=e,e.next=o,n.lastEffect=e),e}function _l(){return{destroy:void 0,resource:void 0}}function l0(){return dt().memoizedState}function Tl(e,n,i,o){var c=Xt();o=o===void 0?null:o,Me.flags|=e,c.memoizedState=Ns(1|n,_l(),i,o)}function Ir(e,n,i,o){var c=dt();o=o===void 0?null:o;var d=c.memoizedState.inst;Be!==null&&o!==null&&yd(o,Be.memoizedState.deps)?c.memoizedState=Ns(n,d,i,o):(Me.flags|=e,c.memoizedState=Ns(1|n,d,i,o))}function c0(e,n){Tl(8390656,8,e,n)}function u0(e,n){Ir(2048,8,e,n)}function d0(e,n){return Ir(4,2,e,n)}function f0(e,n){return Ir(4,4,e,n)}function h0(e,n){if(typeof n=="function"){e=e();var i=n(e);return function(){typeof i=="function"?i():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function m0(e,n,i){i=i!=null?i.concat([e]):null,Ir(4,4,h0.bind(null,n,e),i)}function Td(){}function p0(e,n){var i=dt();n=n===void 0?null:n;var o=i.memoizedState;return n!==null&&yd(n,o[1])?o[0]:(i.memoizedState=[e,n],e)}function g0(e,n){var i=dt();n=n===void 0?null:n;var o=i.memoizedState;if(n!==null&&yd(n,o[1]))return o[0];if(o=e(),Ii){Yt(!0);try{e()}finally{Yt(!1)}}return i.memoizedState=[o,n],o}function Rd(e,n,i){return i===void 0||(Wa&1073741824)!==0?e.memoizedState=n:(e.memoizedState=i,e=vg(),Me.lanes|=e,ri|=e,i)}function y0(e,n,i,o){return tn(i,n)?i:_s.current!==null?(e=Rd(e,i,o),tn(e,n)||(Et=!0),e):(Wa&42)===0?(Et=!0,e.memoizedState=i):(e=vg(),Me.lanes|=e,ri|=e,n)}function b0(e,n,i,o,c){var d=P.p;P.p=d!==0&&8>d?d:8;var b=L.T,E={};L.T=E,Dd(e,!1,n,i);try{var A=c(),q=L.S;if(q!==null&&q(E,A),A!==null&&typeof A=="object"&&typeof A.then=="function"){var Z=pS(A,o);jr(e,n,Z,on(e))}else jr(e,n,o,on(e))}catch(ie){jr(e,n,{then:function(){},status:"rejected",reason:ie},on())}finally{P.p=d,L.T=b}}function SS(){}function Nd(e,n,i,o){if(e.tag!==5)throw Error(r(476));var c=v0(e).queue;b0(e,c,n,le,i===null?SS:function(){return S0(e),i(o)})}function v0(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:le,baseState:le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:le},next:null};var i={};return n.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:i},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function S0(e){var n=v0(e).next.queue;jr(e,n,{},on())}function kd(){return Rt(so)}function E0(){return dt().memoizedState}function M0(){return dt().memoizedState}function ES(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var i=on();e=Za(i);var o=Ja(n,e,i);o!==null&&(ln(o,n,i),Or(o,n,i)),n={cache:od()},e.payload=n;return}n=n.return}}function MS(e,n,i){var o=on();i={lane:o,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},Rl(e)?w0(n,i):(i=Zu(e,n,i,o),i!==null&&(ln(i,e,o),A0(i,n,o)))}function x0(e,n,i){var o=on();jr(e,n,i,o)}function jr(e,n,i,o){var c={lane:o,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(Rl(e))w0(n,c);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=n.lastRenderedReducer,d!==null))try{var b=n.lastRenderedState,E=d(b,i);if(c.hasEagerState=!0,c.eagerState=E,tn(E,b))return fl(e,n,c,0),Ye===null&&dl(),!1}catch{}finally{}if(i=Zu(e,n,c,o),i!==null)return ln(i,e,o),A0(i,n,o),!0}return!1}function Dd(e,n,i,o){if(o={lane:2,revertLane:df(),action:o,hasEagerState:!1,eagerState:null,next:null},Rl(e)){if(n)throw Error(r(479))}else n=Zu(e,i,o,2),n!==null&&ln(n,e,2)}function Rl(e){var n=e.alternate;return e===Me||n!==null&&n===Me}function w0(e,n){Ts=xl=!0;var i=e.pending;i===null?n.next=n:(n.next=i.next,i.next=n),e.pending=n}function A0(e,n,i){if((i&4194048)!==0){var o=n.lanes;o&=e.pendingLanes,i|=o,n.lanes=i,pr(e,i)}}var Nl={readContext:Rt,use:Al,useCallback:ot,useContext:ot,useEffect:ot,useImperativeHandle:ot,useLayoutEffect:ot,useInsertionEffect:ot,useMemo:ot,useReducer:ot,useRef:ot,useState:ot,useDebugValue:ot,useDeferredValue:ot,useTransition:ot,useSyncExternalStore:ot,useId:ot,useHostTransitionStatus:ot,useFormState:ot,useActionState:ot,useOptimistic:ot,useMemoCache:ot,useCacheRefresh:ot},C0={readContext:Rt,use:Al,useCallback:function(e,n){return Xt().memoizedState=[e,n===void 0?null:n],e},useContext:Rt,useEffect:c0,useImperativeHandle:function(e,n,i){i=i!=null?i.concat([e]):null,Tl(4194308,4,h0.bind(null,n,e),i)},useLayoutEffect:function(e,n){return Tl(4194308,4,e,n)},useInsertionEffect:function(e,n){Tl(4,2,e,n)},useMemo:function(e,n){var i=Xt();n=n===void 0?null:n;var o=e();if(Ii){Yt(!0);try{e()}finally{Yt(!1)}}return i.memoizedState=[o,n],o},useReducer:function(e,n,i){var o=Xt();if(i!==void 0){var c=i(n);if(Ii){Yt(!0);try{i(n)}finally{Yt(!1)}}}else c=n;return o.memoizedState=o.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},o.queue=e,e=e.dispatch=MS.bind(null,Me,e),[o.memoizedState,e]},useRef:function(e){var n=Xt();return e={current:e},n.memoizedState=e},useState:function(e){e=Cd(e);var n=e.queue,i=x0.bind(null,Me,n);return n.dispatch=i,[e.memoizedState,i]},useDebugValue:Td,useDeferredValue:function(e,n){var i=Xt();return Rd(i,e,n)},useTransition:function(){var e=Cd(!1);return e=b0.bind(null,Me,e.queue,!0,!1),Xt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,i){var o=Me,c=Xt();if(De){if(i===void 0)throw Error(r(407));i=i()}else{if(i=n(),Ye===null)throw Error(r(349));(Ne&124)!==0||Xp(o,n,i)}c.memoizedState=i;var d={value:i,getSnapshot:n};return c.queue=d,c0(Qp.bind(null,o,d,e),[e]),o.flags|=2048,Ns(9,_l(),Kp.bind(null,o,d,i,n),null),i},useId:function(){var e=Xt(),n=Ye.identifierPrefix;if(De){var i=va,o=ba;i=(o&~(1<<32-Tt(o)-1)).toString(32)+i,n="«"+n+"R"+i,i=wl++,0<i&&(n+="H"+i.toString(32)),n+="»"}else i=gS++,n="«"+n+"r"+i.toString(32)+"»";return e.memoizedState=n},useHostTransitionStatus:kd,useFormState:i0,useActionState:i0,useOptimistic:function(e){var n=Xt();n.memoizedState=n.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=i,n=Dd.bind(null,Me,!0,i),i.dispatch=n,[e,n]},useMemoCache:xd,useCacheRefresh:function(){return Xt().memoizedState=ES.bind(null,Me)}},_0={readContext:Rt,use:Al,useCallback:p0,useContext:Rt,useEffect:u0,useImperativeHandle:m0,useInsertionEffect:d0,useLayoutEffect:f0,useMemo:g0,useReducer:Cl,useRef:l0,useState:function(){return Cl(Ma)},useDebugValue:Td,useDeferredValue:function(e,n){var i=dt();return y0(i,Be.memoizedState,e,n)},useTransition:function(){var e=Cl(Ma)[0],n=dt().memoizedState;return[typeof e=="boolean"?e:Hr(e),n]},useSyncExternalStore:Vp,useId:E0,useHostTransitionStatus:kd,useFormState:s0,useActionState:s0,useOptimistic:function(e,n){var i=dt();return Jp(i,Be,e,n)},useMemoCache:xd,useCacheRefresh:M0},xS={readContext:Rt,use:Al,useCallback:p0,useContext:Rt,useEffect:u0,useImperativeHandle:m0,useInsertionEffect:d0,useLayoutEffect:f0,useMemo:g0,useReducer:Ad,useRef:l0,useState:function(){return Ad(Ma)},useDebugValue:Td,useDeferredValue:function(e,n){var i=dt();return Be===null?Rd(i,e,n):y0(i,Be.memoizedState,e,n)},useTransition:function(){var e=Ad(Ma)[0],n=dt().memoizedState;return[typeof e=="boolean"?e:Hr(e),n]},useSyncExternalStore:Vp,useId:E0,useHostTransitionStatus:kd,useFormState:o0,useActionState:o0,useOptimistic:function(e,n){var i=dt();return Be!==null?Jp(i,Be,e,n):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:xd,useCacheRefresh:M0},ks=null,Gr=0;function kl(e){var n=Gr;return Gr+=1,ks===null&&(ks=[]),Bp(ks,e,n)}function Fr(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function Dl(e,n){throw n.$$typeof===y?Error(r(525)):(e=Object.prototype.toString.call(n),Error(r(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function T0(e){var n=e._init;return n(e._payload)}function R0(e){function n(D,R){if(e){var U=D.deletions;U===null?(D.deletions=[R],D.flags|=16):U.push(R)}}function i(D,R){if(!e)return null;for(;R!==null;)n(D,R),R=R.sibling;return null}function o(D){for(var R=new Map;D!==null;)D.key!==null?R.set(D.key,D):R.set(D.index,D),D=D.sibling;return R}function c(D,R){return D=ya(D,R),D.index=0,D.sibling=null,D}function d(D,R,U){return D.index=U,e?(U=D.alternate,U!==null?(U=U.index,U<R?(D.flags|=67108866,R):U):(D.flags|=67108866,R)):(D.flags|=1048576,R)}function b(D){return e&&D.alternate===null&&(D.flags|=67108866),D}function E(D,R,U,te){return R===null||R.tag!==6?(R=Wu(U,D.mode,te),R.return=D,R):(R=c(R,U),R.return=D,R)}function A(D,R,U,te){var he=U.type;return he===M?Z(D,R,U.props.children,te,U.key):R!==null&&(R.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===ne&&T0(he)===R.type)?(R=c(R,U.props),Fr(R,U),R.return=D,R):(R=ml(U.type,U.key,U.props,null,D.mode,te),Fr(R,U),R.return=D,R)}function q(D,R,U,te){return R===null||R.tag!==4||R.stateNode.containerInfo!==U.containerInfo||R.stateNode.implementation!==U.implementation?(R=ed(U,D.mode,te),R.return=D,R):(R=c(R,U.children||[]),R.return=D,R)}function Z(D,R,U,te,he){return R===null||R.tag!==7?(R=Di(U,D.mode,te,he),R.return=D,R):(R=c(R,U),R.return=D,R)}function ie(D,R,U){if(typeof R=="string"&&R!==""||typeof R=="number"||typeof R=="bigint")return R=Wu(""+R,D.mode,U),R.return=D,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case v:return U=ml(R.type,R.key,R.props,null,D.mode,U),Fr(U,R),U.return=D,U;case S:return R=ed(R,D.mode,U),R.return=D,R;case ne:var te=R._init;return R=te(R._payload),ie(D,R,U)}if($(R)||J(R))return R=Di(R,D.mode,U,null),R.return=D,R;if(typeof R.then=="function")return ie(D,kl(R),U);if(R.$$typeof===B)return ie(D,bl(D,R),U);Dl(D,R)}return null}function j(D,R,U,te){var he=R!==null?R.key:null;if(typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint")return he!==null?null:E(D,R,""+U,te);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case v:return U.key===he?A(D,R,U,te):null;case S:return U.key===he?q(D,R,U,te):null;case ne:return he=U._init,U=he(U._payload),j(D,R,U,te)}if($(U)||J(U))return he!==null?null:Z(D,R,U,te,null);if(typeof U.then=="function")return j(D,R,kl(U),te);if(U.$$typeof===B)return j(D,R,bl(D,U),te);Dl(D,U)}return null}function G(D,R,U,te,he){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return D=D.get(U)||null,E(R,D,""+te,he);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case v:return D=D.get(te.key===null?U:te.key)||null,A(R,D,te,he);case S:return D=D.get(te.key===null?U:te.key)||null,q(R,D,te,he);case ne:var we=te._init;return te=we(te._payload),G(D,R,U,te,he)}if($(te)||J(te))return D=D.get(U)||null,Z(R,D,te,he,null);if(typeof te.then=="function")return G(D,R,U,kl(te),he);if(te.$$typeof===B)return G(D,R,U,bl(R,te),he);Dl(R,te)}return null}function Se(D,R,U,te){for(var he=null,we=null,pe=R,be=R=0,xt=null;pe!==null&&be<U.length;be++){pe.index>be?(xt=pe,pe=null):xt=pe.sibling;var ke=j(D,pe,U[be],te);if(ke===null){pe===null&&(pe=xt);break}e&&pe&&ke.alternate===null&&n(D,pe),R=d(ke,R,be),we===null?he=ke:we.sibling=ke,we=ke,pe=xt}if(be===U.length)return i(D,pe),De&&Ui(D,be),he;if(pe===null){for(;be<U.length;be++)pe=ie(D,U[be],te),pe!==null&&(R=d(pe,R,be),we===null?he=pe:we.sibling=pe,we=pe);return De&&Ui(D,be),he}for(pe=o(pe);be<U.length;be++)xt=G(pe,D,be,U[be],te),xt!==null&&(e&&xt.alternate!==null&&pe.delete(xt.key===null?be:xt.key),R=d(xt,R,be),we===null?he=xt:we.sibling=xt,we=xt);return e&&pe.forEach(function(pi){return n(D,pi)}),De&&Ui(D,be),he}function ye(D,R,U,te){if(U==null)throw Error(r(151));for(var he=null,we=null,pe=R,be=R=0,xt=null,ke=U.next();pe!==null&&!ke.done;be++,ke=U.next()){pe.index>be?(xt=pe,pe=null):xt=pe.sibling;var pi=j(D,pe,ke.value,te);if(pi===null){pe===null&&(pe=xt);break}e&&pe&&pi.alternate===null&&n(D,pe),R=d(pi,R,be),we===null?he=pi:we.sibling=pi,we=pi,pe=xt}if(ke.done)return i(D,pe),De&&Ui(D,be),he;if(pe===null){for(;!ke.done;be++,ke=U.next())ke=ie(D,ke.value,te),ke!==null&&(R=d(ke,R,be),we===null?he=ke:we.sibling=ke,we=ke);return De&&Ui(D,be),he}for(pe=o(pe);!ke.done;be++,ke=U.next())ke=G(pe,D,be,ke.value,te),ke!==null&&(e&&ke.alternate!==null&&pe.delete(ke.key===null?be:ke.key),R=d(ke,R,be),we===null?he=ke:we.sibling=ke,we=ke);return e&&pe.forEach(function(wE){return n(D,wE)}),De&&Ui(D,be),he}function Ie(D,R,U,te){if(typeof U=="object"&&U!==null&&U.type===M&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case v:e:{for(var he=U.key;R!==null;){if(R.key===he){if(he=U.type,he===M){if(R.tag===7){i(D,R.sibling),te=c(R,U.props.children),te.return=D,D=te;break e}}else if(R.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===ne&&T0(he)===R.type){i(D,R.sibling),te=c(R,U.props),Fr(te,U),te.return=D,D=te;break e}i(D,R);break}else n(D,R);R=R.sibling}U.type===M?(te=Di(U.props.children,D.mode,te,U.key),te.return=D,D=te):(te=ml(U.type,U.key,U.props,null,D.mode,te),Fr(te,U),te.return=D,D=te)}return b(D);case S:e:{for(he=U.key;R!==null;){if(R.key===he)if(R.tag===4&&R.stateNode.containerInfo===U.containerInfo&&R.stateNode.implementation===U.implementation){i(D,R.sibling),te=c(R,U.children||[]),te.return=D,D=te;break e}else{i(D,R);break}else n(D,R);R=R.sibling}te=ed(U,D.mode,te),te.return=D,D=te}return b(D);case ne:return he=U._init,U=he(U._payload),Ie(D,R,U,te)}if($(U))return Se(D,R,U,te);if(J(U)){if(he=J(U),typeof he!="function")throw Error(r(150));return U=he.call(U),ye(D,R,U,te)}if(typeof U.then=="function")return Ie(D,R,kl(U),te);if(U.$$typeof===B)return Ie(D,R,bl(D,U),te);Dl(D,U)}return typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint"?(U=""+U,R!==null&&R.tag===6?(i(D,R.sibling),te=c(R,U),te.return=D,D=te):(i(D,R),te=Wu(U,D.mode,te),te.return=D,D=te),b(D)):i(D,R)}return function(D,R,U,te){try{Gr=0;var he=Ie(D,R,U,te);return ks=null,he}catch(pe){if(pe===Lr||pe===Sl)throw pe;var we=nn(29,pe,null,D.mode);return we.lanes=te,we.return=D,we}finally{}}}var Ds=R0(!0),N0=R0(!1),yn=w(null),Yn=null;function ei(e){var n=e.alternate;K(pt,pt.current&1),K(yn,e),Yn===null&&(n===null||_s.current!==null||n.memoizedState!==null)&&(Yn=e)}function k0(e){if(e.tag===22){if(K(pt,pt.current),K(yn,e),Yn===null){var n=e.alternate;n!==null&&n.memoizedState!==null&&(Yn=e)}}else ti()}function ti(){K(pt,pt.current),K(yn,yn.current)}function xa(e){z(yn),Yn===e&&(Yn=null),z(pt)}var pt=w(0);function Ll(e){for(var n=e;n!==null;){if(n.tag===13){var i=n.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||xf(i)))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}function Ld(e,n,i,o){n=e.memoizedState,i=i(o,n),i=i==null?n:g({},n,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Ud={enqueueSetState:function(e,n,i){e=e._reactInternals;var o=on(),c=Za(o);c.payload=n,i!=null&&(c.callback=i),n=Ja(e,c,o),n!==null&&(ln(n,e,o),Or(n,e,o))},enqueueReplaceState:function(e,n,i){e=e._reactInternals;var o=on(),c=Za(o);c.tag=1,c.payload=n,i!=null&&(c.callback=i),n=Ja(e,c,o),n!==null&&(ln(n,e,o),Or(n,e,o))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var i=on(),o=Za(i);o.tag=2,n!=null&&(o.callback=n),n=Ja(e,o,i),n!==null&&(ln(n,e,i),Or(n,e,i))}};function D0(e,n,i,o,c,d,b){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,d,b):n.prototype&&n.prototype.isPureReactComponent?!Ar(i,o)||!Ar(c,d):!0}function L0(e,n,i,o){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(i,o),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(i,o),n.state!==e&&Ud.enqueueReplaceState(n,n.state,null)}function ji(e,n){var i=n;if("ref"in n){i={};for(var o in n)o!=="ref"&&(i[o]=n[o])}if(e=e.defaultProps){i===n&&(i=g({},i));for(var c in e)i[c]===void 0&&(i[c]=e[c])}return i}var Ul=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function U0(e){Ul(e)}function O0(e){console.error(e)}function q0(e){Ul(e)}function Ol(e,n){try{var i=e.onUncaughtError;i(n.value,{componentStack:n.stack})}catch(o){setTimeout(function(){throw o})}}function z0(e,n,i){try{var o=e.onCaughtError;o(i.value,{componentStack:i.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Od(e,n,i){return i=Za(i),i.tag=3,i.payload={element:null},i.callback=function(){Ol(e,n)},i}function B0(e){return e=Za(e),e.tag=3,e}function H0(e,n,i,o){var c=i.type.getDerivedStateFromError;if(typeof c=="function"){var d=o.value;e.payload=function(){return c(d)},e.callback=function(){z0(n,i,o)}}var b=i.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(e.callback=function(){z0(n,i,o),typeof c!="function"&&(oi===null?oi=new Set([this]):oi.add(this));var E=o.stack;this.componentDidCatch(o.value,{componentStack:E!==null?E:""})})}function wS(e,n,i,o,c){if(i.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(n=i.alternate,n!==null&&Nr(n,i,c,!0),i=yn.current,i!==null){switch(i.tag){case 13:return Yn===null?rf():i.alternate===null&&rt===0&&(rt=3),i.flags&=-257,i.flags|=65536,i.lanes=c,o===ud?i.flags|=16384:(n=i.updateQueue,n===null?i.updateQueue=new Set([o]):n.add(o),lf(e,o,c)),!1;case 22:return i.flags|=65536,o===ud?i.flags|=16384:(n=i.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([o])},i.updateQueue=n):(i=n.retryQueue,i===null?n.retryQueue=new Set([o]):i.add(o)),lf(e,o,c)),!1}throw Error(r(435,i.tag))}return lf(e,o,c),rf(),!1}if(De)return n=yn.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=c,o!==ad&&(e=Error(r(422),{cause:o}),Rr(hn(e,i)))):(o!==ad&&(n=Error(r(423),{cause:o}),Rr(hn(n,i))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,o=hn(o,i),c=Od(e.stateNode,o,c),hd(e,c),rt!==4&&(rt=2)),!1;var d=Error(r(520),{cause:o});if(d=hn(d,i),Pr===null?Pr=[d]:Pr.push(d),rt!==4&&(rt=2),n===null)return!0;o=hn(o,i),i=n;do{switch(i.tag){case 3:return i.flags|=65536,e=c&-c,i.lanes|=e,e=Od(i.stateNode,o,e),hd(i,e),!1;case 1:if(n=i.type,d=i.stateNode,(i.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(oi===null||!oi.has(d))))return i.flags|=65536,c&=-c,i.lanes|=c,c=B0(c),H0(c,e,i,o),hd(i,c),!1}i=i.return}while(i!==null);return!1}var I0=Error(r(461)),Et=!1;function wt(e,n,i,o){n.child=e===null?N0(n,null,i,o):Ds(n,e.child,i,o)}function j0(e,n,i,o,c){i=i.render;var d=n.ref;if("ref"in o){var b={};for(var E in o)E!=="ref"&&(b[E]=o[E])}else b=o;return Bi(n),o=bd(e,n,i,b,d,c),E=vd(),e!==null&&!Et?(Sd(e,n,c),wa(e,n,c)):(De&&E&&td(n),n.flags|=1,wt(e,n,o,c),n.child)}function G0(e,n,i,o,c){if(e===null){var d=i.type;return typeof d=="function"&&!Ju(d)&&d.defaultProps===void 0&&i.compare===null?(n.tag=15,n.type=d,F0(e,n,d,o,c)):(e=ml(i.type,null,o,n,n.mode,c),e.ref=n.ref,e.return=n,n.child=e)}if(d=e.child,!Fd(e,c)){var b=d.memoizedProps;if(i=i.compare,i=i!==null?i:Ar,i(b,o)&&e.ref===n.ref)return wa(e,n,c)}return n.flags|=1,e=ya(d,o),e.ref=n.ref,e.return=n,n.child=e}function F0(e,n,i,o,c){if(e!==null){var d=e.memoizedProps;if(Ar(d,o)&&e.ref===n.ref)if(Et=!1,n.pendingProps=o=d,Fd(e,c))(e.flags&131072)!==0&&(Et=!0);else return n.lanes=e.lanes,wa(e,n,c)}return qd(e,n,i,o,c)}function $0(e,n,i){var o=n.pendingProps,c=o.children,d=e!==null?e.memoizedState:null;if(o.mode==="hidden"){if((n.flags&128)!==0){if(o=d!==null?d.baseLanes|i:i,e!==null){for(c=n.child=e.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;n.childLanes=d&~o}else n.childLanes=0,n.child=null;return Y0(e,n,o,i)}if((i&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&vl(n,d!==null?d.cachePool:null),d!==null?Fp(n,d):pd(),k0(n);else return n.lanes=n.childLanes=536870912,Y0(e,n,d!==null?d.baseLanes|i:i,i)}else d!==null?(vl(n,d.cachePool),Fp(n,d),ti(),n.memoizedState=null):(e!==null&&vl(n,null),pd(),ti());return wt(e,n,c,i),n.child}function Y0(e,n,i,o){var c=cd();return c=c===null?null:{parent:mt._currentValue,pool:c},n.memoizedState={baseLanes:i,cachePool:c},e!==null&&vl(n,null),pd(),k0(n),e!==null&&Nr(e,n,o,!0),null}function ql(e,n){var i=n.ref;if(i===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(r(284));(e===null||e.ref!==i)&&(n.flags|=4194816)}}function qd(e,n,i,o,c){return Bi(n),i=bd(e,n,i,o,void 0,c),o=vd(),e!==null&&!Et?(Sd(e,n,c),wa(e,n,c)):(De&&o&&td(n),n.flags|=1,wt(e,n,i,c),n.child)}function V0(e,n,i,o,c,d){return Bi(n),n.updateQueue=null,i=Yp(n,o,i,c),$p(e),o=vd(),e!==null&&!Et?(Sd(e,n,d),wa(e,n,d)):(De&&o&&td(n),n.flags|=1,wt(e,n,i,d),n.child)}function X0(e,n,i,o,c){if(Bi(n),n.stateNode===null){var d=Ms,b=i.contextType;typeof b=="object"&&b!==null&&(d=Rt(b)),d=new i(o,d),n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Ud,n.stateNode=d,d._reactInternals=n,d=n.stateNode,d.props=o,d.state=n.memoizedState,d.refs={},dd(n),b=i.contextType,d.context=typeof b=="object"&&b!==null?Rt(b):Ms,d.state=n.memoizedState,b=i.getDerivedStateFromProps,typeof b=="function"&&(Ld(n,i,b,o),d.state=n.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(b=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),b!==d.state&&Ud.enqueueReplaceState(d,d.state,null),zr(n,o,d,c),qr(),d.state=n.memoizedState),typeof d.componentDidMount=="function"&&(n.flags|=4194308),o=!0}else if(e===null){d=n.stateNode;var E=n.memoizedProps,A=ji(i,E);d.props=A;var q=d.context,Z=i.contextType;b=Ms,typeof Z=="object"&&Z!==null&&(b=Rt(Z));var ie=i.getDerivedStateFromProps;Z=typeof ie=="function"||typeof d.getSnapshotBeforeUpdate=="function",E=n.pendingProps!==E,Z||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(E||q!==b)&&L0(n,d,o,b),Pa=!1;var j=n.memoizedState;d.state=j,zr(n,o,d,c),qr(),q=n.memoizedState,E||j!==q||Pa?(typeof ie=="function"&&(Ld(n,i,ie,o),q=n.memoizedState),(A=Pa||D0(n,i,A,o,j,q,b))?(Z||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(n.flags|=4194308)):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=o,n.memoizedState=q),d.props=o,d.state=q,d.context=b,o=A):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),o=!1)}else{d=n.stateNode,fd(e,n),b=n.memoizedProps,Z=ji(i,b),d.props=Z,ie=n.pendingProps,j=d.context,q=i.contextType,A=Ms,typeof q=="object"&&q!==null&&(A=Rt(q)),E=i.getDerivedStateFromProps,(q=typeof E=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(b!==ie||j!==A)&&L0(n,d,o,A),Pa=!1,j=n.memoizedState,d.state=j,zr(n,o,d,c),qr();var G=n.memoizedState;b!==ie||j!==G||Pa||e!==null&&e.dependencies!==null&&yl(e.dependencies)?(typeof E=="function"&&(Ld(n,i,E,o),G=n.memoizedState),(Z=Pa||D0(n,i,Z,o,j,G,A)||e!==null&&e.dependencies!==null&&yl(e.dependencies))?(q||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(o,G,A),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(o,G,A)),typeof d.componentDidUpdate=="function"&&(n.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof d.componentDidUpdate!="function"||b===e.memoizedProps&&j===e.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||b===e.memoizedProps&&j===e.memoizedState||(n.flags|=1024),n.memoizedProps=o,n.memoizedState=G),d.props=o,d.state=G,d.context=A,o=Z):(typeof d.componentDidUpdate!="function"||b===e.memoizedProps&&j===e.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||b===e.memoizedProps&&j===e.memoizedState||(n.flags|=1024),o=!1)}return d=o,ql(e,n),o=(n.flags&128)!==0,d||o?(d=n.stateNode,i=o&&typeof i.getDerivedStateFromError!="function"?null:d.render(),n.flags|=1,e!==null&&o?(n.child=Ds(n,e.child,null,c),n.child=Ds(n,null,i,c)):wt(e,n,i,c),n.memoizedState=d.state,e=n.child):e=wa(e,n,c),e}function K0(e,n,i,o){return Tr(),n.flags|=256,wt(e,n,i,o),n.child}var zd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Bd(e){return{baseLanes:e,cachePool:Op()}}function Hd(e,n,i){return e=e!==null?e.childLanes&~i:0,n&&(e|=bn),e}function Q0(e,n,i){var o=n.pendingProps,c=!1,d=(n.flags&128)!==0,b;if((b=d)||(b=e!==null&&e.memoizedState===null?!1:(pt.current&2)!==0),b&&(c=!0,n.flags&=-129),b=(n.flags&32)!==0,n.flags&=-33,e===null){if(De){if(c?ei(n):ti(),De){var E=st,A;if(A=E){e:{for(A=E,E=$n;A.nodeType!==8;){if(!E){E=null;break e}if(A=kn(A.nextSibling),A===null){E=null;break e}}E=A}E!==null?(n.memoizedState={dehydrated:E,treeContext:Li!==null?{id:ba,overflow:va}:null,retryLane:536870912,hydrationErrors:null},A=nn(18,null,null,0),A.stateNode=E,A.return=n,n.child=A,zt=n,st=null,A=!0):A=!1}A||qi(n)}if(E=n.memoizedState,E!==null&&(E=E.dehydrated,E!==null))return xf(E)?n.lanes=32:n.lanes=536870912,null;xa(n)}return E=o.children,o=o.fallback,c?(ti(),c=n.mode,E=zl({mode:"hidden",children:E},c),o=Di(o,c,i,null),E.return=n,o.return=n,E.sibling=o,n.child=E,c=n.child,c.memoizedState=Bd(i),c.childLanes=Hd(e,b,i),n.memoizedState=zd,o):(ei(n),Id(n,E))}if(A=e.memoizedState,A!==null&&(E=A.dehydrated,E!==null)){if(d)n.flags&256?(ei(n),n.flags&=-257,n=jd(e,n,i)):n.memoizedState!==null?(ti(),n.child=e.child,n.flags|=128,n=null):(ti(),c=o.fallback,E=n.mode,o=zl({mode:"visible",children:o.children},E),c=Di(c,E,i,null),c.flags|=2,o.return=n,c.return=n,o.sibling=c,n.child=o,Ds(n,e.child,null,i),o=n.child,o.memoizedState=Bd(i),o.childLanes=Hd(e,b,i),n.memoizedState=zd,n=c);else if(ei(n),xf(E)){if(b=E.nextSibling&&E.nextSibling.dataset,b)var q=b.dgst;b=q,o=Error(r(419)),o.stack="",o.digest=b,Rr({value:o,source:null,stack:null}),n=jd(e,n,i)}else if(Et||Nr(e,n,i,!1),b=(i&e.childLanes)!==0,Et||b){if(b=Ye,b!==null&&(o=i&-i,o=(o&42)!==0?1:gr(o),o=(o&(b.suspendedLanes|i))!==0?0:o,o!==0&&o!==A.retryLane))throw A.retryLane=o,Es(e,o),ln(b,e,o),I0;E.data==="$?"||rf(),n=jd(e,n,i)}else E.data==="$?"?(n.flags|=192,n.child=e.child,n=null):(e=A.treeContext,st=kn(E.nextSibling),zt=n,De=!0,Oi=null,$n=!1,e!==null&&(pn[gn++]=ba,pn[gn++]=va,pn[gn++]=Li,ba=e.id,va=e.overflow,Li=n),n=Id(n,o.children),n.flags|=4096);return n}return c?(ti(),c=o.fallback,E=n.mode,A=e.child,q=A.sibling,o=ya(A,{mode:"hidden",children:o.children}),o.subtreeFlags=A.subtreeFlags&65011712,q!==null?c=ya(q,c):(c=Di(c,E,i,null),c.flags|=2),c.return=n,o.return=n,o.sibling=c,n.child=o,o=c,c=n.child,E=e.child.memoizedState,E===null?E=Bd(i):(A=E.cachePool,A!==null?(q=mt._currentValue,A=A.parent!==q?{parent:q,pool:q}:A):A=Op(),E={baseLanes:E.baseLanes|i,cachePool:A}),c.memoizedState=E,c.childLanes=Hd(e,b,i),n.memoizedState=zd,o):(ei(n),i=e.child,e=i.sibling,i=ya(i,{mode:"visible",children:o.children}),i.return=n,i.sibling=null,e!==null&&(b=n.deletions,b===null?(n.deletions=[e],n.flags|=16):b.push(e)),n.child=i,n.memoizedState=null,i)}function Id(e,n){return n=zl({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function zl(e,n){return e=nn(22,e,null,n),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function jd(e,n,i){return Ds(n,e.child,null,i),e=Id(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function P0(e,n,i){e.lanes|=n;var o=e.alternate;o!==null&&(o.lanes|=n),sd(e.return,n,i)}function Gd(e,n,i,o,c){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:o,tail:i,tailMode:c}:(d.isBackwards=n,d.rendering=null,d.renderingStartTime=0,d.last=o,d.tail=i,d.tailMode=c)}function Z0(e,n,i){var o=n.pendingProps,c=o.revealOrder,d=o.tail;if(wt(e,n,o.children,i),o=pt.current,(o&2)!==0)o=o&1|2,n.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&P0(e,i,n);else if(e.tag===19)P0(e,i,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}switch(K(pt,o),c){case"forwards":for(i=n.child,c=null;i!==null;)e=i.alternate,e!==null&&Ll(e)===null&&(c=i),i=i.sibling;i=c,i===null?(c=n.child,n.child=null):(c=i.sibling,i.sibling=null),Gd(n,!1,c,i,d);break;case"backwards":for(i=null,c=n.child,n.child=null;c!==null;){if(e=c.alternate,e!==null&&Ll(e)===null){n.child=c;break}e=c.sibling,c.sibling=i,i=c,c=e}Gd(n,!0,i,null,d);break;case"together":Gd(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function wa(e,n,i){if(e!==null&&(n.dependencies=e.dependencies),ri|=n.lanes,(i&n.childLanes)===0)if(e!==null){if(Nr(e,n,i,!1),(i&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(r(153));if(n.child!==null){for(e=n.child,i=ya(e,e.pendingProps),n.child=i,i.return=n;e.sibling!==null;)e=e.sibling,i=i.sibling=ya(e,e.pendingProps),i.return=n;i.sibling=null}return n.child}function Fd(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&yl(e)))}function AS(e,n,i){switch(n.tag){case 3:ge(n,n.stateNode.containerInfo),Qa(n,mt,e.memoizedState.cache),Tr();break;case 27:case 5:Ot(n);break;case 4:ge(n,n.stateNode.containerInfo);break;case 10:Qa(n,n.type,n.memoizedProps.value);break;case 13:var o=n.memoizedState;if(o!==null)return o.dehydrated!==null?(ei(n),n.flags|=128,null):(i&n.child.childLanes)!==0?Q0(e,n,i):(ei(n),e=wa(e,n,i),e!==null?e.sibling:null);ei(n);break;case 19:var c=(e.flags&128)!==0;if(o=(i&n.childLanes)!==0,o||(Nr(e,n,i,!1),o=(i&n.childLanes)!==0),c){if(o)return Z0(e,n,i);n.flags|=128}if(c=n.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),K(pt,pt.current),o)break;return null;case 22:case 23:return n.lanes=0,$0(e,n,i);case 24:Qa(n,mt,e.memoizedState.cache)}return wa(e,n,i)}function J0(e,n,i){if(e!==null)if(e.memoizedProps!==n.pendingProps)Et=!0;else{if(!Fd(e,i)&&(n.flags&128)===0)return Et=!1,AS(e,n,i);Et=(e.flags&131072)!==0}else Et=!1,De&&(n.flags&1048576)!==0&&Tp(n,gl,n.index);switch(n.lanes=0,n.tag){case 16:e:{e=n.pendingProps;var o=n.elementType,c=o._init;if(o=c(o._payload),n.type=o,typeof o=="function")Ju(o)?(e=ji(o,e),n.tag=1,n=X0(null,n,o,e,i)):(n.tag=0,n=qd(null,n,o,e,i));else{if(o!=null){if(c=o.$$typeof,c===Y){n.tag=11,n=j0(null,n,o,e,i);break e}else if(c===W){n.tag=14,n=G0(null,n,o,e,i);break e}}throw n=ae(o)||o,Error(r(306,n,""))}}return n;case 0:return qd(e,n,n.type,n.pendingProps,i);case 1:return o=n.type,c=ji(o,n.pendingProps),X0(e,n,o,c,i);case 3:e:{if(ge(n,n.stateNode.containerInfo),e===null)throw Error(r(387));o=n.pendingProps;var d=n.memoizedState;c=d.element,fd(e,n),zr(n,o,null,i);var b=n.memoizedState;if(o=b.cache,Qa(n,mt,o),o!==d.cache&&rd(n,[mt],i,!0),qr(),o=b.element,d.isDehydrated)if(d={element:o,isDehydrated:!1,cache:b.cache},n.updateQueue.baseState=d,n.memoizedState=d,n.flags&256){n=K0(e,n,o,i);break e}else if(o!==c){c=hn(Error(r(424)),n),Rr(c),n=K0(e,n,o,i);break e}else{switch(e=n.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(st=kn(e.firstChild),zt=n,De=!0,Oi=null,$n=!0,i=N0(n,null,o,i),n.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(Tr(),o===c){n=wa(e,n,i);break e}wt(e,n,o,i)}n=n.child}return n;case 26:return ql(e,n),e===null?(i=ny(n.type,null,n.pendingProps,null))?n.memoizedState=i:De||(i=n.type,e=n.pendingProps,o=Zl(ue.current).createElement(i),o[tt]=n,o[ft]=e,Ct(o,i,e),nt(o),n.stateNode=o):n.memoizedState=ny(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return Ot(n),e===null&&De&&(o=n.stateNode=Wg(n.type,n.pendingProps,ue.current),zt=n,$n=!0,c=st,ui(n.type)?(wf=c,st=kn(o.firstChild)):st=c),wt(e,n,n.pendingProps.children,i),ql(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&De&&((c=o=st)&&(o=WS(o,n.type,n.pendingProps,$n),o!==null?(n.stateNode=o,zt=n,st=kn(o.firstChild),$n=!1,c=!0):c=!1),c||qi(n)),Ot(n),c=n.type,d=n.pendingProps,b=e!==null?e.memoizedProps:null,o=d.children,Sf(c,d)?o=null:b!==null&&Sf(c,b)&&(n.flags|=32),n.memoizedState!==null&&(c=bd(e,n,yS,null,null,i),so._currentValue=c),ql(e,n),wt(e,n,o,i),n.child;case 6:return e===null&&De&&((e=i=st)&&(i=eE(i,n.pendingProps,$n),i!==null?(n.stateNode=i,zt=n,st=null,e=!0):e=!1),e||qi(n)),null;case 13:return Q0(e,n,i);case 4:return ge(n,n.stateNode.containerInfo),o=n.pendingProps,e===null?n.child=Ds(n,null,o,i):wt(e,n,o,i),n.child;case 11:return j0(e,n,n.type,n.pendingProps,i);case 7:return wt(e,n,n.pendingProps,i),n.child;case 8:return wt(e,n,n.pendingProps.children,i),n.child;case 12:return wt(e,n,n.pendingProps.children,i),n.child;case 10:return o=n.pendingProps,Qa(n,n.type,o.value),wt(e,n,o.children,i),n.child;case 9:return c=n.type._context,o=n.pendingProps.children,Bi(n),c=Rt(c),o=o(c),n.flags|=1,wt(e,n,o,i),n.child;case 14:return G0(e,n,n.type,n.pendingProps,i);case 15:return F0(e,n,n.type,n.pendingProps,i);case 19:return Z0(e,n,i);case 31:return o=n.pendingProps,i=n.mode,o={mode:o.mode,children:o.children},e===null?(i=zl(o,i),i.ref=n.ref,n.child=i,i.return=n,n=i):(i=ya(e.child,o),i.ref=n.ref,n.child=i,i.return=n,n=i),n;case 22:return $0(e,n,i);case 24:return Bi(n),o=Rt(mt),e===null?(c=cd(),c===null&&(c=Ye,d=od(),c.pooledCache=d,d.refCount++,d!==null&&(c.pooledCacheLanes|=i),c=d),n.memoizedState={parent:o,cache:c},dd(n),Qa(n,mt,c)):((e.lanes&i)!==0&&(fd(e,n),zr(n,null,null,i),qr()),c=e.memoizedState,d=n.memoizedState,c.parent!==o?(c={parent:o,cache:o},n.memoizedState=c,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=c),Qa(n,mt,o)):(o=d.cache,Qa(n,mt,o),o!==c.cache&&rd(n,[mt],i,!0))),wt(e,n,n.pendingProps.children,i),n.child;case 29:throw n.pendingProps}throw Error(r(156,n.tag))}function Aa(e){e.flags|=4}function W0(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!oy(n)){if(n=yn.current,n!==null&&((Ne&4194048)===Ne?Yn!==null:(Ne&62914560)!==Ne&&(Ne&536870912)===0||n!==Yn))throw Ur=ud,qp;e.flags|=8192}}function Bl(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?Xo():536870912,e.lanes|=n,qs|=n)}function $r(e,n){if(!De)switch(e.tailMode){case"hidden":n=e.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function Ze(e){var n=e.alternate!==null&&e.alternate.child===e.child,i=0,o=0;if(n)for(var c=e.child;c!==null;)i|=c.lanes|c.childLanes,o|=c.subtreeFlags&65011712,o|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)i|=c.lanes|c.childLanes,o|=c.subtreeFlags,o|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=o,e.childLanes=i,n}function CS(e,n,i){var o=n.pendingProps;switch(nd(n),n.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ze(n),null;case 1:return Ze(n),null;case 3:return i=n.stateNode,o=null,e!==null&&(o=e.memoizedState.cache),n.memoizedState.cache!==o&&(n.flags|=2048),Ea(mt),et(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(_r(n)?Aa(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,kp())),Ze(n),null;case 26:return i=n.memoizedState,e===null?(Aa(n),i!==null?(Ze(n),W0(n,i)):(Ze(n),n.flags&=-16777217)):i?i!==e.memoizedState?(Aa(n),Ze(n),W0(n,i)):(Ze(n),n.flags&=-16777217):(e.memoizedProps!==o&&Aa(n),Ze(n),n.flags&=-16777217),null;case 27:qt(n),i=ue.current;var c=n.type;if(e!==null&&n.stateNode!=null)e.memoizedProps!==o&&Aa(n);else{if(!o){if(n.stateNode===null)throw Error(r(166));return Ze(n),null}e=oe.current,_r(n)?Rp(n):(e=Wg(c,o,i),n.stateNode=e,Aa(n))}return Ze(n),null;case 5:if(qt(n),i=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==o&&Aa(n);else{if(!o){if(n.stateNode===null)throw Error(r(166));return Ze(n),null}if(e=oe.current,_r(n))Rp(n);else{switch(c=Zl(ue.current),e){case 1:e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof o.is=="string"?c.createElement("select",{is:o.is}):c.createElement("select"),o.multiple?e.multiple=!0:o.size&&(e.size=o.size);break;default:e=typeof o.is=="string"?c.createElement(i,{is:o.is}):c.createElement(i)}}e[tt]=n,e[ft]=o;e:for(c=n.child;c!==null;){if(c.tag===5||c.tag===6)e.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===n)break e;for(;c.sibling===null;){if(c.return===null||c.return===n)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}n.stateNode=e;e:switch(Ct(e,i,o),i){case"button":case"input":case"select":case"textarea":e=!!o.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Aa(n)}}return Ze(n),n.flags&=-16777217,null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==o&&Aa(n);else{if(typeof o!="string"&&n.stateNode===null)throw Error(r(166));if(e=ue.current,_r(n)){if(e=n.stateNode,i=n.memoizedProps,o=null,c=zt,c!==null)switch(c.tag){case 27:case 5:o=c.memoizedProps}e[tt]=n,e=!!(e.nodeValue===i||o!==null&&o.suppressHydrationWarning===!0||Vg(e.nodeValue,i)),e||qi(n)}else e=Zl(e).createTextNode(o),e[tt]=n,n.stateNode=e}return Ze(n),null;case 13:if(o=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=_r(n),o!==null&&o.dehydrated!==null){if(e===null){if(!c)throw Error(r(318));if(c=n.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));c[tt]=n}else Tr(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Ze(n),c=!1}else c=kp(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return n.flags&256?(xa(n),n):(xa(n),null)}if(xa(n),(n.flags&128)!==0)return n.lanes=i,n;if(i=o!==null,e=e!==null&&e.memoizedState!==null,i){o=n.child,c=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(c=o.alternate.memoizedState.cachePool.pool);var d=null;o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),d!==c&&(o.flags|=2048)}return i!==e&&i&&(n.child.flags|=8192),Bl(n,n.updateQueue),Ze(n),null;case 4:return et(),e===null&&pf(n.stateNode.containerInfo),Ze(n),null;case 10:return Ea(n.type),Ze(n),null;case 19:if(z(pt),c=n.memoizedState,c===null)return Ze(n),null;if(o=(n.flags&128)!==0,d=c.rendering,d===null)if(o)$r(c,!1);else{if(rt!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(d=Ll(e),d!==null){for(n.flags|=128,$r(c,!1),e=d.updateQueue,n.updateQueue=e,Bl(n,e),n.subtreeFlags=0,e=i,i=n.child;i!==null;)_p(i,e),i=i.sibling;return K(pt,pt.current&1|2),n.child}e=e.sibling}c.tail!==null&&fe()>jl&&(n.flags|=128,o=!0,$r(c,!1),n.lanes=4194304)}else{if(!o)if(e=Ll(d),e!==null){if(n.flags|=128,o=!0,e=e.updateQueue,n.updateQueue=e,Bl(n,e),$r(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!De)return Ze(n),null}else 2*fe()-c.renderingStartTime>jl&&i!==536870912&&(n.flags|=128,o=!0,$r(c,!1),n.lanes=4194304);c.isBackwards?(d.sibling=n.child,n.child=d):(e=c.last,e!==null?e.sibling=d:n.child=d,c.last=d)}return c.tail!==null?(n=c.tail,c.rendering=n,c.tail=n.sibling,c.renderingStartTime=fe(),n.sibling=null,e=pt.current,K(pt,o?e&1|2:e&1),n):(Ze(n),null);case 22:case 23:return xa(n),gd(),o=n.memoizedState!==null,e!==null?e.memoizedState!==null!==o&&(n.flags|=8192):o&&(n.flags|=8192),o?(i&536870912)!==0&&(n.flags&128)===0&&(Ze(n),n.subtreeFlags&6&&(n.flags|=8192)):Ze(n),i=n.updateQueue,i!==null&&Bl(n,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),o=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),o!==i&&(n.flags|=2048),e!==null&&z(Hi),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),n.memoizedState.cache!==i&&(n.flags|=2048),Ea(mt),Ze(n),null;case 25:return null;case 30:return null}throw Error(r(156,n.tag))}function _S(e,n){switch(nd(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Ea(mt),et(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return qt(n),null;case 13:if(xa(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(r(340));Tr()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return z(pt),null;case 4:return et(),null;case 10:return Ea(n.type),null;case 22:case 23:return xa(n),gd(),e!==null&&z(Hi),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return Ea(mt),null;case 25:return null;default:return null}}function eg(e,n){switch(nd(n),n.tag){case 3:Ea(mt),et();break;case 26:case 27:case 5:qt(n);break;case 4:et();break;case 13:xa(n);break;case 19:z(pt);break;case 10:Ea(n.type);break;case 22:case 23:xa(n),gd(),e!==null&&z(Hi);break;case 24:Ea(mt)}}function Yr(e,n){try{var i=n.updateQueue,o=i!==null?i.lastEffect:null;if(o!==null){var c=o.next;i=c;do{if((i.tag&e)===e){o=void 0;var d=i.create,b=i.inst;o=d(),b.destroy=o}i=i.next}while(i!==c)}}catch(E){$e(n,n.return,E)}}function ni(e,n,i){try{var o=n.updateQueue,c=o!==null?o.lastEffect:null;if(c!==null){var d=c.next;o=d;do{if((o.tag&e)===e){var b=o.inst,E=b.destroy;if(E!==void 0){b.destroy=void 0,c=n;var A=i,q=E;try{q()}catch(Z){$e(c,A,Z)}}}o=o.next}while(o!==d)}}catch(Z){$e(n,n.return,Z)}}function tg(e){var n=e.updateQueue;if(n!==null){var i=e.stateNode;try{Gp(n,i)}catch(o){$e(e,e.return,o)}}}function ng(e,n,i){i.props=ji(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(o){$e(e,n,o)}}function Vr(e,n){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var o=e.stateNode;break;case 30:o=e.stateNode;break;default:o=e.stateNode}typeof i=="function"?e.refCleanup=i(o):i.current=o}}catch(c){$e(e,n,c)}}function Vn(e,n){var i=e.ref,o=e.refCleanup;if(i!==null)if(typeof o=="function")try{o()}catch(c){$e(e,n,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(c){$e(e,n,c)}else i.current=null}function ag(e){var n=e.type,i=e.memoizedProps,o=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":i.autoFocus&&o.focus();break e;case"img":i.src?o.src=i.src:i.srcSet&&(o.srcset=i.srcSet)}}catch(c){$e(e,e.return,c)}}function $d(e,n,i){try{var o=e.stateNode;KS(o,e.type,i,n),o[ft]=n}catch(c){$e(e,e.return,c)}}function ig(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&ui(e.type)||e.tag===4}function Yd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ig(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&ui(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Vd(e,n,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,n):(n=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,n.appendChild(e),i=i._reactRootContainer,i!=null||n.onclick!==null||(n.onclick=Pl));else if(o!==4&&(o===27&&ui(e.type)&&(i=e.stateNode,n=null),e=e.child,e!==null))for(Vd(e,n,i),e=e.sibling;e!==null;)Vd(e,n,i),e=e.sibling}function Hl(e,n,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?i.insertBefore(e,n):i.appendChild(e);else if(o!==4&&(o===27&&ui(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(Hl(e,n,i),e=e.sibling;e!==null;)Hl(e,n,i),e=e.sibling}function sg(e){var n=e.stateNode,i=e.memoizedProps;try{for(var o=e.type,c=n.attributes;c.length;)n.removeAttributeNode(c[0]);Ct(n,o,i),n[tt]=e,n[ft]=i}catch(d){$e(e,e.return,d)}}var Ca=!1,lt=!1,Xd=!1,rg=typeof WeakSet=="function"?WeakSet:Set,Mt=null;function TS(e,n){if(e=e.containerInfo,bf=ac,e=yp(e),Yu(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var o=i.getSelection&&i.getSelection();if(o&&o.rangeCount!==0){i=o.anchorNode;var c=o.anchorOffset,d=o.focusNode;o=o.focusOffset;try{i.nodeType,d.nodeType}catch{i=null;break e}var b=0,E=-1,A=-1,q=0,Z=0,ie=e,j=null;t:for(;;){for(var G;ie!==i||c!==0&&ie.nodeType!==3||(E=b+c),ie!==d||o!==0&&ie.nodeType!==3||(A=b+o),ie.nodeType===3&&(b+=ie.nodeValue.length),(G=ie.firstChild)!==null;)j=ie,ie=G;for(;;){if(ie===e)break t;if(j===i&&++q===c&&(E=b),j===d&&++Z===o&&(A=b),(G=ie.nextSibling)!==null)break;ie=j,j=ie.parentNode}ie=G}i=E===-1||A===-1?null:{start:E,end:A}}else i=null}i=i||{start:0,end:0}}else i=null;for(vf={focusedElem:e,selectionRange:i},ac=!1,Mt=n;Mt!==null;)if(n=Mt,e=n.child,(n.subtreeFlags&1024)!==0&&e!==null)e.return=n,Mt=e;else for(;Mt!==null;){switch(n=Mt,d=n.alternate,e=n.flags,n.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,i=n,c=d.memoizedProps,d=d.memoizedState,o=i.stateNode;try{var Se=ji(i.type,c,i.elementType===i.type);e=o.getSnapshotBeforeUpdate(Se,d),o.__reactInternalSnapshotBeforeUpdate=e}catch(ye){$e(i,i.return,ye)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,i=e.nodeType,i===9)Mf(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Mf(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(r(163))}if(e=n.sibling,e!==null){e.return=n.return,Mt=e;break}Mt=n.return}}function og(e,n,i){var o=i.flags;switch(i.tag){case 0:case 11:case 15:ai(e,i),o&4&&Yr(5,i);break;case 1:if(ai(e,i),o&4)if(e=i.stateNode,n===null)try{e.componentDidMount()}catch(b){$e(i,i.return,b)}else{var c=ji(i.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(c,n,e.__reactInternalSnapshotBeforeUpdate)}catch(b){$e(i,i.return,b)}}o&64&&tg(i),o&512&&Vr(i,i.return);break;case 3:if(ai(e,i),o&64&&(e=i.updateQueue,e!==null)){if(n=null,i.child!==null)switch(i.child.tag){case 27:case 5:n=i.child.stateNode;break;case 1:n=i.child.stateNode}try{Gp(e,n)}catch(b){$e(i,i.return,b)}}break;case 27:n===null&&o&4&&sg(i);case 26:case 5:ai(e,i),n===null&&o&4&&ag(i),o&512&&Vr(i,i.return);break;case 12:ai(e,i);break;case 13:ai(e,i),o&4&&ug(e,i),o&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=zS.bind(null,i),tE(e,i))));break;case 22:if(o=i.memoizedState!==null||Ca,!o){n=n!==null&&n.memoizedState!==null||lt,c=Ca;var d=lt;Ca=o,(lt=n)&&!d?ii(e,i,(i.subtreeFlags&8772)!==0):ai(e,i),Ca=c,lt=d}break;case 30:break;default:ai(e,i)}}function lg(e){var n=e.alternate;n!==null&&(e.alternate=null,lg(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&fs(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Qe=null,Kt=!1;function _a(e,n,i){for(i=i.child;i!==null;)cg(e,n,i),i=i.sibling}function cg(e,n,i){if(Pe&&typeof Pe.onCommitFiberUnmount=="function")try{Pe.onCommitFiberUnmount(Ke,i)}catch{}switch(i.tag){case 26:lt||Vn(i,n),_a(e,n,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:lt||Vn(i,n);var o=Qe,c=Kt;ui(i.type)&&(Qe=i.stateNode,Kt=!1),_a(e,n,i),to(i.stateNode),Qe=o,Kt=c;break;case 5:lt||Vn(i,n);case 6:if(o=Qe,c=Kt,Qe=null,_a(e,n,i),Qe=o,Kt=c,Qe!==null)if(Kt)try{(Qe.nodeType===9?Qe.body:Qe.nodeName==="HTML"?Qe.ownerDocument.body:Qe).removeChild(i.stateNode)}catch(d){$e(i,n,d)}else try{Qe.removeChild(i.stateNode)}catch(d){$e(i,n,d)}break;case 18:Qe!==null&&(Kt?(e=Qe,Zg(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),co(e)):Zg(Qe,i.stateNode));break;case 4:o=Qe,c=Kt,Qe=i.stateNode.containerInfo,Kt=!0,_a(e,n,i),Qe=o,Kt=c;break;case 0:case 11:case 14:case 15:lt||ni(2,i,n),lt||ni(4,i,n),_a(e,n,i);break;case 1:lt||(Vn(i,n),o=i.stateNode,typeof o.componentWillUnmount=="function"&&ng(i,n,o)),_a(e,n,i);break;case 21:_a(e,n,i);break;case 22:lt=(o=lt)||i.memoizedState!==null,_a(e,n,i),lt=o;break;default:_a(e,n,i)}}function ug(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{co(e)}catch(i){$e(n,n.return,i)}}function RS(e){switch(e.tag){case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new rg),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new rg),n;default:throw Error(r(435,e.tag))}}function Kd(e,n){var i=RS(e);n.forEach(function(o){var c=BS.bind(null,e,o);i.has(o)||(i.add(o),o.then(c,c))})}function an(e,n){var i=n.deletions;if(i!==null)for(var o=0;o<i.length;o++){var c=i[o],d=e,b=n,E=b;e:for(;E!==null;){switch(E.tag){case 27:if(ui(E.type)){Qe=E.stateNode,Kt=!1;break e}break;case 5:Qe=E.stateNode,Kt=!1;break e;case 3:case 4:Qe=E.stateNode.containerInfo,Kt=!0;break e}E=E.return}if(Qe===null)throw Error(r(160));cg(d,b,c),Qe=null,Kt=!1,d=c.alternate,d!==null&&(d.return=null),c.return=null}if(n.subtreeFlags&13878)for(n=n.child;n!==null;)dg(n,e),n=n.sibling}var Nn=null;function dg(e,n){var i=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:an(n,e),sn(e),o&4&&(ni(3,e,e.return),Yr(3,e),ni(5,e,e.return));break;case 1:an(n,e),sn(e),o&512&&(lt||i===null||Vn(i,i.return)),o&64&&Ca&&(e=e.updateQueue,e!==null&&(o=e.callbacks,o!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?o:i.concat(o))));break;case 26:var c=Nn;if(an(n,e),sn(e),o&512&&(lt||i===null||Vn(i,i.return)),o&4){var d=i!==null?i.memoizedState:null;if(o=e.memoizedState,i===null)if(o===null)if(e.stateNode===null){e:{o=e.type,i=e.memoizedProps,c=c.ownerDocument||c;t:switch(o){case"title":d=c.getElementsByTagName("title")[0],(!d||d[Ai]||d[tt]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=c.createElement(o),c.head.insertBefore(d,c.querySelector("head > title"))),Ct(d,o,i),d[tt]=e,nt(d),o=d;break e;case"link":var b=sy("link","href",c).get(o+(i.href||""));if(b){for(var E=0;E<b.length;E++)if(d=b[E],d.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&d.getAttribute("rel")===(i.rel==null?null:i.rel)&&d.getAttribute("title")===(i.title==null?null:i.title)&&d.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){b.splice(E,1);break t}}d=c.createElement(o),Ct(d,o,i),c.head.appendChild(d);break;case"meta":if(b=sy("meta","content",c).get(o+(i.content||""))){for(E=0;E<b.length;E++)if(d=b[E],d.getAttribute("content")===(i.content==null?null:""+i.content)&&d.getAttribute("name")===(i.name==null?null:i.name)&&d.getAttribute("property")===(i.property==null?null:i.property)&&d.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&d.getAttribute("charset")===(i.charSet==null?null:i.charSet)){b.splice(E,1);break t}}d=c.createElement(o),Ct(d,o,i),c.head.appendChild(d);break;default:throw Error(r(468,o))}d[tt]=e,nt(d),o=d}e.stateNode=o}else ry(c,e.type,e.stateNode);else e.stateNode=iy(c,o,e.memoizedProps);else d!==o?(d===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):d.count--,o===null?ry(c,e.type,e.stateNode):iy(c,o,e.memoizedProps)):o===null&&e.stateNode!==null&&$d(e,e.memoizedProps,i.memoizedProps)}break;case 27:an(n,e),sn(e),o&512&&(lt||i===null||Vn(i,i.return)),i!==null&&o&4&&$d(e,e.memoizedProps,i.memoizedProps);break;case 5:if(an(n,e),sn(e),o&512&&(lt||i===null||Vn(i,i.return)),e.flags&32){c=e.stateNode;try{ms(c,"")}catch(G){$e(e,e.return,G)}}o&4&&e.stateNode!=null&&(c=e.memoizedProps,$d(e,c,i!==null?i.memoizedProps:c)),o&1024&&(Xd=!0);break;case 6:if(an(n,e),sn(e),o&4){if(e.stateNode===null)throw Error(r(162));o=e.memoizedProps,i=e.stateNode;try{i.nodeValue=o}catch(G){$e(e,e.return,G)}}break;case 3:if(ec=null,c=Nn,Nn=Jl(n.containerInfo),an(n,e),Nn=c,sn(e),o&4&&i!==null&&i.memoizedState.isDehydrated)try{co(n.containerInfo)}catch(G){$e(e,e.return,G)}Xd&&(Xd=!1,fg(e));break;case 4:o=Nn,Nn=Jl(e.stateNode.containerInfo),an(n,e),sn(e),Nn=o;break;case 12:an(n,e),sn(e);break;case 13:an(n,e),sn(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(ef=fe()),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Kd(e,o)));break;case 22:c=e.memoizedState!==null;var A=i!==null&&i.memoizedState!==null,q=Ca,Z=lt;if(Ca=q||c,lt=Z||A,an(n,e),lt=Z,Ca=q,sn(e),o&8192)e:for(n=e.stateNode,n._visibility=c?n._visibility&-2:n._visibility|1,c&&(i===null||A||Ca||lt||Gi(e)),i=null,n=e;;){if(n.tag===5||n.tag===26){if(i===null){A=i=n;try{if(d=A.stateNode,c)b=d.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{E=A.stateNode;var ie=A.memoizedProps.style,j=ie!=null&&ie.hasOwnProperty("display")?ie.display:null;E.style.display=j==null||typeof j=="boolean"?"":(""+j).trim()}}catch(G){$e(A,A.return,G)}}}else if(n.tag===6){if(i===null){A=n;try{A.stateNode.nodeValue=c?"":A.memoizedProps}catch(G){$e(A,A.return,G)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;i===n&&(i=null),n=n.return}i===n&&(i=null),n.sibling.return=n.return,n=n.sibling}o&4&&(o=e.updateQueue,o!==null&&(i=o.retryQueue,i!==null&&(o.retryQueue=null,Kd(e,i))));break;case 19:an(n,e),sn(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Kd(e,o)));break;case 30:break;case 21:break;default:an(n,e),sn(e)}}function sn(e){var n=e.flags;if(n&2){try{for(var i,o=e.return;o!==null;){if(ig(o)){i=o;break}o=o.return}if(i==null)throw Error(r(160));switch(i.tag){case 27:var c=i.stateNode,d=Yd(e);Hl(e,d,c);break;case 5:var b=i.stateNode;i.flags&32&&(ms(b,""),i.flags&=-33);var E=Yd(e);Hl(e,E,b);break;case 3:case 4:var A=i.stateNode.containerInfo,q=Yd(e);Vd(e,q,A);break;default:throw Error(r(161))}}catch(Z){$e(e,e.return,Z)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function fg(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;fg(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function ai(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)og(e,n.alternate,n),n=n.sibling}function Gi(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:ni(4,n,n.return),Gi(n);break;case 1:Vn(n,n.return);var i=n.stateNode;typeof i.componentWillUnmount=="function"&&ng(n,n.return,i),Gi(n);break;case 27:to(n.stateNode);case 26:case 5:Vn(n,n.return),Gi(n);break;case 22:n.memoizedState===null&&Gi(n);break;case 30:Gi(n);break;default:Gi(n)}e=e.sibling}}function ii(e,n,i){for(i=i&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var o=n.alternate,c=e,d=n,b=d.flags;switch(d.tag){case 0:case 11:case 15:ii(c,d,i),Yr(4,d);break;case 1:if(ii(c,d,i),o=d,c=o.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(q){$e(o,o.return,q)}if(o=d,c=o.updateQueue,c!==null){var E=o.stateNode;try{var A=c.shared.hiddenCallbacks;if(A!==null)for(c.shared.hiddenCallbacks=null,c=0;c<A.length;c++)jp(A[c],E)}catch(q){$e(o,o.return,q)}}i&&b&64&&tg(d),Vr(d,d.return);break;case 27:sg(d);case 26:case 5:ii(c,d,i),i&&o===null&&b&4&&ag(d),Vr(d,d.return);break;case 12:ii(c,d,i);break;case 13:ii(c,d,i),i&&b&4&&ug(c,d);break;case 22:d.memoizedState===null&&ii(c,d,i),Vr(d,d.return);break;case 30:break;default:ii(c,d,i)}n=n.sibling}}function Qd(e,n){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&kr(i))}function Pd(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&kr(e))}function Xn(e,n,i,o){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)hg(e,n,i,o),n=n.sibling}function hg(e,n,i,o){var c=n.flags;switch(n.tag){case 0:case 11:case 15:Xn(e,n,i,o),c&2048&&Yr(9,n);break;case 1:Xn(e,n,i,o);break;case 3:Xn(e,n,i,o),c&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&kr(e)));break;case 12:if(c&2048){Xn(e,n,i,o),e=n.stateNode;try{var d=n.memoizedProps,b=d.id,E=d.onPostCommit;typeof E=="function"&&E(b,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(A){$e(n,n.return,A)}}else Xn(e,n,i,o);break;case 13:Xn(e,n,i,o);break;case 23:break;case 22:d=n.stateNode,b=n.alternate,n.memoizedState!==null?d._visibility&2?Xn(e,n,i,o):Xr(e,n):d._visibility&2?Xn(e,n,i,o):(d._visibility|=2,Ls(e,n,i,o,(n.subtreeFlags&10256)!==0)),c&2048&&Qd(b,n);break;case 24:Xn(e,n,i,o),c&2048&&Pd(n.alternate,n);break;default:Xn(e,n,i,o)}}function Ls(e,n,i,o,c){for(c=c&&(n.subtreeFlags&10256)!==0,n=n.child;n!==null;){var d=e,b=n,E=i,A=o,q=b.flags;switch(b.tag){case 0:case 11:case 15:Ls(d,b,E,A,c),Yr(8,b);break;case 23:break;case 22:var Z=b.stateNode;b.memoizedState!==null?Z._visibility&2?Ls(d,b,E,A,c):Xr(d,b):(Z._visibility|=2,Ls(d,b,E,A,c)),c&&q&2048&&Qd(b.alternate,b);break;case 24:Ls(d,b,E,A,c),c&&q&2048&&Pd(b.alternate,b);break;default:Ls(d,b,E,A,c)}n=n.sibling}}function Xr(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var i=e,o=n,c=o.flags;switch(o.tag){case 22:Xr(i,o),c&2048&&Qd(o.alternate,o);break;case 24:Xr(i,o),c&2048&&Pd(o.alternate,o);break;default:Xr(i,o)}n=n.sibling}}var Kr=8192;function Us(e){if(e.subtreeFlags&Kr)for(e=e.child;e!==null;)mg(e),e=e.sibling}function mg(e){switch(e.tag){case 26:Us(e),e.flags&Kr&&e.memoizedState!==null&&mE(Nn,e.memoizedState,e.memoizedProps);break;case 5:Us(e);break;case 3:case 4:var n=Nn;Nn=Jl(e.stateNode.containerInfo),Us(e),Nn=n;break;case 22:e.memoizedState===null&&(n=e.alternate,n!==null&&n.memoizedState!==null?(n=Kr,Kr=16777216,Us(e),Kr=n):Us(e));break;default:Us(e)}}function pg(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Qr(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];Mt=o,yg(o,e)}pg(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)gg(e),e=e.sibling}function gg(e){switch(e.tag){case 0:case 11:case 15:Qr(e),e.flags&2048&&ni(9,e,e.return);break;case 3:Qr(e);break;case 12:Qr(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,Il(e)):Qr(e);break;default:Qr(e)}}function Il(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];Mt=o,yg(o,e)}pg(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:ni(8,n,n.return),Il(n);break;case 22:i=n.stateNode,i._visibility&2&&(i._visibility&=-3,Il(n));break;default:Il(n)}e=e.sibling}}function yg(e,n){for(;Mt!==null;){var i=Mt;switch(i.tag){case 0:case 11:case 15:ni(8,i,n);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var o=i.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:kr(i.memoizedState.cache)}if(o=i.child,o!==null)o.return=i,Mt=o;else e:for(i=e;Mt!==null;){o=Mt;var c=o.sibling,d=o.return;if(lg(o),o===i){Mt=null;break e}if(c!==null){c.return=d,Mt=c;break e}Mt=d}}}var NS={getCacheForType:function(e){var n=Rt(mt),i=n.data.get(e);return i===void 0&&(i=e(),n.data.set(e,i)),i}},kS=typeof WeakMap=="function"?WeakMap:Map,Le=0,Ye=null,Ae=null,Ne=0,Ue=0,rn=null,si=!1,Os=!1,Zd=!1,Ta=0,rt=0,ri=0,Fi=0,Jd=0,bn=0,qs=0,Pr=null,Qt=null,Wd=!1,ef=0,jl=1/0,Gl=null,oi=null,At=0,li=null,zs=null,Bs=0,tf=0,nf=null,bg=null,Zr=0,af=null;function on(){if((Le&2)!==0&&Ne!==0)return Ne&-Ne;if(L.T!==null){var e=As;return e!==0?e:df()}return Qo()}function vg(){bn===0&&(bn=(Ne&536870912)===0||De?Vo():536870912);var e=yn.current;return e!==null&&(e.flags|=32),bn}function ln(e,n,i){(e===Ye&&(Ue===2||Ue===9)||e.cancelPendingCommit!==null)&&(Hs(e,0),ci(e,Ne,bn,!1)),In(e,i),((Le&2)===0||e!==Ye)&&(e===Ye&&((Le&2)===0&&(Fi|=i),rt===4&&ci(e,Ne,bn,!1)),Kn(e))}function Sg(e,n,i){if((Le&6)!==0)throw Error(r(327));var o=!i&&(n&124)===0&&(n&e.expiredLanes)===0||ua(e,n),c=o?US(e,n):of(e,n,!0),d=o;do{if(c===0){Os&&!o&&ci(e,n,0,!1);break}else{if(i=e.current.alternate,d&&!DS(i)){c=of(e,n,!1),d=!1;continue}if(c===2){if(d=n,e.errorRecoveryDisabledLanes&d)var b=0;else b=e.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){n=b;e:{var E=e;c=Pr;var A=E.current.memoizedState.isDehydrated;if(A&&(Hs(E,b).flags|=256),b=of(E,b,!1),b!==2){if(Zd&&!A){E.errorRecoveryDisabledLanes|=d,Fi|=d,c=4;break e}d=Qt,Qt=c,d!==null&&(Qt===null?Qt=d:Qt.push.apply(Qt,d))}c=b}if(d=!1,c!==2)continue}}if(c===1){Hs(e,0),ci(e,n,0,!0);break}e:{switch(o=e,d=c,d){case 0:case 1:throw Error(r(345));case 4:if((n&4194048)!==n)break;case 6:ci(o,n,bn,!si);break e;case 2:Qt=null;break;case 3:case 5:break;default:throw Error(r(329))}if((n&62914560)===n&&(c=ef+300-fe(),10<c)){if(ci(o,n,bn,!si),xi(o,0,!0)!==0)break e;o.timeoutHandle=Qg(Eg.bind(null,o,i,Qt,Gl,Wd,n,bn,Fi,qs,si,d,2,-0,0),c);break e}Eg(o,i,Qt,Gl,Wd,n,bn,Fi,qs,si,d,0,-0,0)}}break}while(!0);Kn(e)}function Eg(e,n,i,o,c,d,b,E,A,q,Z,ie,j,G){if(e.timeoutHandle=-1,ie=n.subtreeFlags,(ie&8192||(ie&16785408)===16785408)&&(io={stylesheets:null,count:0,unsuspend:hE},mg(n),ie=pE(),ie!==null)){e.cancelPendingCommit=ie(Tg.bind(null,e,n,d,i,o,c,b,E,A,Z,1,j,G)),ci(e,d,b,!q);return}Tg(e,n,d,i,o,c,b,E,A)}function DS(e){for(var n=e;;){var i=n.tag;if((i===0||i===11||i===15)&&n.flags&16384&&(i=n.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var o=0;o<i.length;o++){var c=i[o],d=c.getSnapshot;c=c.value;try{if(!tn(d(),c))return!1}catch{return!1}}if(i=n.child,n.subtreeFlags&16384&&i!==null)i.return=n,n=i;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function ci(e,n,i,o){n&=~Jd,n&=~Fi,e.suspendedLanes|=n,e.pingedLanes&=~n,o&&(e.warmLanes|=n),o=e.expirationTimes;for(var c=n;0<c;){var d=31-Tt(c),b=1<<d;o[d]=-1,c&=~b}i!==0&&mr(e,i,n)}function Fl(){return(Le&6)===0?(Jr(0),!1):!0}function sf(){if(Ae!==null){if(Ue===0)var e=Ae.return;else e=Ae,Sa=zi=null,Ed(e),ks=null,Gr=0,e=Ae;for(;e!==null;)eg(e.alternate,e),e=e.return;Ae=null}}function Hs(e,n){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,PS(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),sf(),Ye=e,Ae=i=ya(e.current,null),Ne=n,Ue=0,rn=null,si=!1,Os=ua(e,n),Zd=!1,qs=bn=Jd=Fi=ri=rt=0,Qt=Pr=null,Wd=!1,(n&8)!==0&&(n|=n&32);var o=e.entangledLanes;if(o!==0)for(e=e.entanglements,o&=n;0<o;){var c=31-Tt(o),d=1<<c;n|=e[c],o&=~d}return Ta=n,dl(),i}function Mg(e,n){Me=null,L.H=Nl,n===Lr||n===Sl?(n=Hp(),Ue=3):n===qp?(n=Hp(),Ue=4):Ue=n===I0?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,rn=n,Ae===null&&(rt=1,Ol(e,hn(n,e.current)))}function xg(){var e=L.H;return L.H=Nl,e===null?Nl:e}function wg(){var e=L.A;return L.A=NS,e}function rf(){rt=4,si||(Ne&4194048)!==Ne&&yn.current!==null||(Os=!0),(ri&134217727)===0&&(Fi&134217727)===0||Ye===null||ci(Ye,Ne,bn,!1)}function of(e,n,i){var o=Le;Le|=2;var c=xg(),d=wg();(Ye!==e||Ne!==n)&&(Gl=null,Hs(e,n)),n=!1;var b=rt;e:do try{if(Ue!==0&&Ae!==null){var E=Ae,A=rn;switch(Ue){case 8:sf(),b=6;break e;case 3:case 2:case 9:case 6:yn.current===null&&(n=!0);var q=Ue;if(Ue=0,rn=null,Is(e,E,A,q),i&&Os){b=0;break e}break;default:q=Ue,Ue=0,rn=null,Is(e,E,A,q)}}LS(),b=rt;break}catch(Z){Mg(e,Z)}while(!0);return n&&e.shellSuspendCounter++,Sa=zi=null,Le=o,L.H=c,L.A=d,Ae===null&&(Ye=null,Ne=0,dl()),b}function LS(){for(;Ae!==null;)Ag(Ae)}function US(e,n){var i=Le;Le|=2;var o=xg(),c=wg();Ye!==e||Ne!==n?(Gl=null,jl=fe()+500,Hs(e,n)):Os=ua(e,n);e:do try{if(Ue!==0&&Ae!==null){n=Ae;var d=rn;t:switch(Ue){case 1:Ue=0,rn=null,Is(e,n,d,1);break;case 2:case 9:if(zp(d)){Ue=0,rn=null,Cg(n);break}n=function(){Ue!==2&&Ue!==9||Ye!==e||(Ue=7),Kn(e)},d.then(n,n);break e;case 3:Ue=7;break e;case 4:Ue=5;break e;case 7:zp(d)?(Ue=0,rn=null,Cg(n)):(Ue=0,rn=null,Is(e,n,d,7));break;case 5:var b=null;switch(Ae.tag){case 26:b=Ae.memoizedState;case 5:case 27:var E=Ae;if(!b||oy(b)){Ue=0,rn=null;var A=E.sibling;if(A!==null)Ae=A;else{var q=E.return;q!==null?(Ae=q,$l(q)):Ae=null}break t}}Ue=0,rn=null,Is(e,n,d,5);break;case 6:Ue=0,rn=null,Is(e,n,d,6);break;case 8:sf(),rt=6;break e;default:throw Error(r(462))}}OS();break}catch(Z){Mg(e,Z)}while(!0);return Sa=zi=null,L.H=o,L.A=c,Le=i,Ae!==null?0:(Ye=null,Ne=0,dl(),rt)}function OS(){for(;Ae!==null&&!la();)Ag(Ae)}function Ag(e){var n=J0(e.alternate,e,Ta);e.memoizedProps=e.pendingProps,n===null?$l(e):Ae=n}function Cg(e){var n=e,i=n.alternate;switch(n.tag){case 15:case 0:n=V0(i,n,n.pendingProps,n.type,void 0,Ne);break;case 11:n=V0(i,n,n.pendingProps,n.type.render,n.ref,Ne);break;case 5:Ed(n);default:eg(i,n),n=Ae=_p(n,Ta),n=J0(i,n,Ta)}e.memoizedProps=e.pendingProps,n===null?$l(e):Ae=n}function Is(e,n,i,o){Sa=zi=null,Ed(n),ks=null,Gr=0;var c=n.return;try{if(wS(e,c,n,i,Ne)){rt=1,Ol(e,hn(i,e.current)),Ae=null;return}}catch(d){if(c!==null)throw Ae=c,d;rt=1,Ol(e,hn(i,e.current)),Ae=null;return}n.flags&32768?(De||o===1?e=!0:Os||(Ne&536870912)!==0?e=!1:(si=e=!0,(o===2||o===9||o===3||o===6)&&(o=yn.current,o!==null&&o.tag===13&&(o.flags|=16384))),_g(n,e)):$l(n)}function $l(e){var n=e;do{if((n.flags&32768)!==0){_g(n,si);return}e=n.return;var i=CS(n.alternate,n,Ta);if(i!==null){Ae=i;return}if(n=n.sibling,n!==null){Ae=n;return}Ae=n=e}while(n!==null);rt===0&&(rt=5)}function _g(e,n){do{var i=_S(e.alternate,e);if(i!==null){i.flags&=32767,Ae=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!n&&(e=e.sibling,e!==null)){Ae=e;return}Ae=e=i}while(e!==null);rt=6,Ae=null}function Tg(e,n,i,o,c,d,b,E,A){e.cancelPendingCommit=null;do Yl();while(At!==0);if((Le&6)!==0)throw Error(r(327));if(n!==null){if(n===e.current)throw Error(r(177));if(d=n.lanes|n.childLanes,d|=Pu,Ko(e,i,d,b,E,A),e===Ye&&(Ae=Ye=null,Ne=0),zs=n,li=e,Bs=i,tf=d,nf=c,bg=o,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,HS(vt,function(){return Lg(),null})):(e.callbackNode=null,e.callbackPriority=0),o=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||o){o=L.T,L.T=null,c=P.p,P.p=2,b=Le,Le|=4;try{TS(e,n,i)}finally{Le=b,P.p=c,L.T=o}}At=1,Rg(),Ng(),kg()}}function Rg(){if(At===1){At=0;var e=li,n=zs,i=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||i){i=L.T,L.T=null;var o=P.p;P.p=2;var c=Le;Le|=4;try{dg(n,e);var d=vf,b=yp(e.containerInfo),E=d.focusedElem,A=d.selectionRange;if(b!==E&&E&&E.ownerDocument&&gp(E.ownerDocument.documentElement,E)){if(A!==null&&Yu(E)){var q=A.start,Z=A.end;if(Z===void 0&&(Z=q),"selectionStart"in E)E.selectionStart=q,E.selectionEnd=Math.min(Z,E.value.length);else{var ie=E.ownerDocument||document,j=ie&&ie.defaultView||window;if(j.getSelection){var G=j.getSelection(),Se=E.textContent.length,ye=Math.min(A.start,Se),Ie=A.end===void 0?ye:Math.min(A.end,Se);!G.extend&&ye>Ie&&(b=Ie,Ie=ye,ye=b);var D=pp(E,ye),R=pp(E,Ie);if(D&&R&&(G.rangeCount!==1||G.anchorNode!==D.node||G.anchorOffset!==D.offset||G.focusNode!==R.node||G.focusOffset!==R.offset)){var U=ie.createRange();U.setStart(D.node,D.offset),G.removeAllRanges(),ye>Ie?(G.addRange(U),G.extend(R.node,R.offset)):(U.setEnd(R.node,R.offset),G.addRange(U))}}}}for(ie=[],G=E;G=G.parentNode;)G.nodeType===1&&ie.push({element:G,left:G.scrollLeft,top:G.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<ie.length;E++){var te=ie[E];te.element.scrollLeft=te.left,te.element.scrollTop=te.top}}ac=!!bf,vf=bf=null}finally{Le=c,P.p=o,L.T=i}}e.current=n,At=2}}function Ng(){if(At===2){At=0;var e=li,n=zs,i=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||i){i=L.T,L.T=null;var o=P.p;P.p=2;var c=Le;Le|=4;try{og(e,n.alternate,n)}finally{Le=c,P.p=o,L.T=i}}At=3}}function kg(){if(At===4||At===3){At=0,dn();var e=li,n=zs,i=Bs,o=bg;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?At=5:(At=0,zs=li=null,Dg(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(oi=null),yr(i),n=n.stateNode,Pe&&typeof Pe.onCommitFiberRoot=="function")try{Pe.onCommitFiberRoot(Ke,n,void 0,(n.current.flags&128)===128)}catch{}if(o!==null){n=L.T,c=P.p,P.p=2,L.T=null;try{for(var d=e.onRecoverableError,b=0;b<o.length;b++){var E=o[b];d(E.value,{componentStack:E.stack})}}finally{L.T=n,P.p=c}}(Bs&3)!==0&&Yl(),Kn(e),c=e.pendingLanes,(i&4194090)!==0&&(c&42)!==0?e===af?Zr++:(Zr=0,af=e):Zr=0,Jr(0)}}function Dg(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,kr(n)))}function Yl(e){return Rg(),Ng(),kg(),Lg()}function Lg(){if(At!==5)return!1;var e=li,n=tf;tf=0;var i=yr(Bs),o=L.T,c=P.p;try{P.p=32>i?32:i,L.T=null,i=nf,nf=null;var d=li,b=Bs;if(At=0,zs=li=null,Bs=0,(Le&6)!==0)throw Error(r(331));var E=Le;if(Le|=4,gg(d.current),hg(d,d.current,b,i),Le=E,Jr(0,!1),Pe&&typeof Pe.onPostCommitFiberRoot=="function")try{Pe.onPostCommitFiberRoot(Ke,d)}catch{}return!0}finally{P.p=c,L.T=o,Dg(e,n)}}function Ug(e,n,i){n=hn(i,n),n=Od(e.stateNode,n,2),e=Ja(e,n,2),e!==null&&(In(e,2),Kn(e))}function $e(e,n,i){if(e.tag===3)Ug(e,e,i);else for(;n!==null;){if(n.tag===3){Ug(n,e,i);break}else if(n.tag===1){var o=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(oi===null||!oi.has(o))){e=hn(i,e),i=B0(2),o=Ja(n,i,2),o!==null&&(H0(i,o,n,e),In(o,2),Kn(o));break}}n=n.return}}function lf(e,n,i){var o=e.pingCache;if(o===null){o=e.pingCache=new kS;var c=new Set;o.set(n,c)}else c=o.get(n),c===void 0&&(c=new Set,o.set(n,c));c.has(i)||(Zd=!0,c.add(i),e=qS.bind(null,e,n,i),n.then(e,e))}function qS(e,n,i){var o=e.pingCache;o!==null&&o.delete(n),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Ye===e&&(Ne&i)===i&&(rt===4||rt===3&&(Ne&62914560)===Ne&&300>fe()-ef?(Le&2)===0&&Hs(e,0):Jd|=i,qs===Ne&&(qs=0)),Kn(e)}function Og(e,n){n===0&&(n=Xo()),e=Es(e,n),e!==null&&(In(e,n),Kn(e))}function zS(e){var n=e.memoizedState,i=0;n!==null&&(i=n.retryLane),Og(e,i)}function BS(e,n){var i=0;switch(e.tag){case 13:var o=e.stateNode,c=e.memoizedState;c!==null&&(i=c.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(r(314))}o!==null&&o.delete(n),Og(e,i)}function HS(e,n){return Bn(e,n)}var Vl=null,js=null,cf=!1,Xl=!1,uf=!1,$i=0;function Kn(e){e!==js&&e.next===null&&(js===null?Vl=js=e:js=js.next=e),Xl=!0,cf||(cf=!0,jS())}function Jr(e,n){if(!uf&&Xl){uf=!0;do for(var i=!1,o=Vl;o!==null;){if(e!==0){var c=o.pendingLanes;if(c===0)var d=0;else{var b=o.suspendedLanes,E=o.pingedLanes;d=(1<<31-Tt(42|e)+1)-1,d&=c&~(b&~E),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(i=!0,Hg(o,d))}else d=Ne,d=xi(o,o===Ye?d:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),(d&3)===0||ua(o,d)||(i=!0,Hg(o,d));o=o.next}while(i);uf=!1}}function IS(){qg()}function qg(){Xl=cf=!1;var e=0;$i!==0&&(QS()&&(e=$i),$i=0);for(var n=fe(),i=null,o=Vl;o!==null;){var c=o.next,d=zg(o,n);d===0?(o.next=null,i===null?Vl=c:i.next=c,c===null&&(js=i)):(i=o,(e!==0||(d&3)!==0)&&(Xl=!0)),o=c}Jr(e)}function zg(e,n){for(var i=e.suspendedLanes,o=e.pingedLanes,c=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var b=31-Tt(d),E=1<<b,A=c[b];A===-1?((E&i)===0||(E&o)!==0)&&(c[b]=ku(E,n)):A<=n&&(e.expiredLanes|=E),d&=~E}if(n=Ye,i=Ne,i=xi(e,e===n?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o=e.callbackNode,i===0||e===n&&(Ue===2||Ue===9)||e.cancelPendingCommit!==null)return o!==null&&o!==null&&ja(o),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||ua(e,i)){if(n=i&-i,n===e.callbackPriority)return n;switch(o!==null&&ja(o),yr(i)){case 2:case 8:i=ze;break;case 32:i=vt;break;case 268435456:i=Zt;break;default:i=vt}return o=Bg.bind(null,e),i=Bn(i,o),e.callbackPriority=n,e.callbackNode=i,n}return o!==null&&o!==null&&ja(o),e.callbackPriority=2,e.callbackNode=null,2}function Bg(e,n){if(At!==0&&At!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(Yl()&&e.callbackNode!==i)return null;var o=Ne;return o=xi(e,e===Ye?o:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o===0?null:(Sg(e,o,n),zg(e,fe()),e.callbackNode!=null&&e.callbackNode===i?Bg.bind(null,e):null)}function Hg(e,n){if(Yl())return null;Sg(e,n,!0)}function jS(){ZS(function(){(Le&6)!==0?Bn(Ge,IS):qg()})}function df(){return $i===0&&($i=Vo()),$i}function Ig(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:il(""+e)}function jg(e,n){var i=n.ownerDocument.createElement("input");return i.name=n.name,i.value=n.value,e.id&&i.setAttribute("form",e.id),n.parentNode.insertBefore(i,n),e=new FormData(e),i.parentNode.removeChild(i),e}function GS(e,n,i,o,c){if(n==="submit"&&i&&i.stateNode===c){var d=Ig((c[ft]||null).action),b=o.submitter;b&&(n=(n=b[ft]||null)?Ig(n.formAction):b.getAttribute("formAction"),n!==null&&(d=n,b=null));var E=new ll("action","action",null,o,c);e.push({event:E,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if($i!==0){var A=b?jg(c,b):new FormData(c);Nd(i,{pending:!0,data:A,method:c.method,action:d},null,A)}}else typeof d=="function"&&(E.preventDefault(),A=b?jg(c,b):new FormData(c),Nd(i,{pending:!0,data:A,method:c.method,action:d},d,A))},currentTarget:c}]})}}for(var ff=0;ff<Qu.length;ff++){var hf=Qu[ff],FS=hf.toLowerCase(),$S=hf[0].toUpperCase()+hf.slice(1);Rn(FS,"on"+$S)}Rn(Sp,"onAnimationEnd"),Rn(Ep,"onAnimationIteration"),Rn(Mp,"onAnimationStart"),Rn("dblclick","onDoubleClick"),Rn("focusin","onFocus"),Rn("focusout","onBlur"),Rn(oS,"onTransitionRun"),Rn(lS,"onTransitionStart"),Rn(cS,"onTransitionCancel"),Rn(xp,"onTransitionEnd"),Ya("onMouseEnter",["mouseout","mouseover"]),Ya("onMouseLeave",["mouseout","mouseover"]),Ya("onPointerEnter",["pointerout","pointerover"]),Ya("onPointerLeave",["pointerout","pointerover"]),Gn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),YS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Wr));function Gg(e,n){n=(n&4)!==0;for(var i=0;i<e.length;i++){var o=e[i],c=o.event;o=o.listeners;e:{var d=void 0;if(n)for(var b=o.length-1;0<=b;b--){var E=o[b],A=E.instance,q=E.currentTarget;if(E=E.listener,A!==d&&c.isPropagationStopped())break e;d=E,c.currentTarget=q;try{d(c)}catch(Z){Ul(Z)}c.currentTarget=null,d=A}else for(b=0;b<o.length;b++){if(E=o[b],A=E.instance,q=E.currentTarget,E=E.listener,A!==d&&c.isPropagationStopped())break e;d=E,c.currentTarget=q;try{d(c)}catch(Z){Ul(Z)}c.currentTarget=null,d=A}}}}function Ce(e,n){var i=n[Fa];i===void 0&&(i=n[Fa]=new Set);var o=e+"__bubble";i.has(o)||(Fg(n,e,2,!1),i.add(o))}function mf(e,n,i){var o=0;n&&(o|=4),Fg(i,e,o,n)}var Kl="_reactListening"+Math.random().toString(36).slice(2);function pf(e){if(!e[Kl]){e[Kl]=!0,hs.forEach(function(i){i!=="selectionchange"&&(YS.has(i)||mf(i,!1,e),mf(i,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[Kl]||(n[Kl]=!0,mf("selectionchange",!1,n))}}function Fg(e,n,i,o){switch(hy(n)){case 2:var c=bE;break;case 8:c=vE;break;default:c=Rf}i=c.bind(null,n,i,e),c=void 0,!qu||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(c=!0),o?c!==void 0?e.addEventListener(n,i,{capture:!0,passive:c}):e.addEventListener(n,i,!0):c!==void 0?e.addEventListener(n,i,{passive:c}):e.addEventListener(n,i,!1)}function gf(e,n,i,o,c){var d=o;if((n&1)===0&&(n&2)===0&&o!==null)e:for(;;){if(o===null)return;var b=o.tag;if(b===3||b===4){var E=o.stateNode.containerInfo;if(E===c)break;if(b===4)for(b=o.return;b!==null;){var A=b.tag;if((A===3||A===4)&&b.stateNode.containerInfo===c)return;b=b.return}for(;E!==null;){if(b=fa(E),b===null)return;if(A=b.tag,A===5||A===6||A===26||A===27){o=d=b;continue e}E=E.parentNode}}o=o.return}Pm(function(){var q=d,Z=Uu(i),ie=[];e:{var j=wp.get(e);if(j!==void 0){var G=ll,Se=e;switch(e){case"keypress":if(rl(i)===0)break e;case"keydown":case"keyup":G=H1;break;case"focusin":Se="focus",G=Iu;break;case"focusout":Se="blur",G=Iu;break;case"beforeblur":case"afterblur":G=Iu;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=Wm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=_1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=G1;break;case Sp:case Ep:case Mp:G=N1;break;case xp:G=$1;break;case"scroll":case"scrollend":G=A1;break;case"wheel":G=V1;break;case"copy":case"cut":case"paste":G=D1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=tp;break;case"toggle":case"beforetoggle":G=K1}var ye=(n&4)!==0,Ie=!ye&&(e==="scroll"||e==="scrollend"),D=ye?j!==null?j+"Capture":null:j;ye=[];for(var R=q,U;R!==null;){var te=R;if(U=te.stateNode,te=te.tag,te!==5&&te!==26&&te!==27||U===null||D===null||(te=br(R,D),te!=null&&ye.push(eo(R,te,U))),Ie)break;R=R.return}0<ye.length&&(j=new G(j,Se,null,i,Z),ie.push({event:j,listeners:ye}))}}if((n&7)===0){e:{if(j=e==="mouseover"||e==="pointerover",G=e==="mouseout"||e==="pointerout",j&&i!==Lu&&(Se=i.relatedTarget||i.fromElement)&&(fa(Se)||Se[da]))break e;if((G||j)&&(j=Z.window===Z?Z:(j=Z.ownerDocument)?j.defaultView||j.parentWindow:window,G?(Se=i.relatedTarget||i.toElement,G=q,Se=Se?fa(Se):null,Se!==null&&(Ie=u(Se),ye=Se.tag,Se!==Ie||ye!==5&&ye!==27&&ye!==6)&&(Se=null)):(G=null,Se=q),G!==Se)){if(ye=Wm,te="onMouseLeave",D="onMouseEnter",R="mouse",(e==="pointerout"||e==="pointerover")&&(ye=tp,te="onPointerLeave",D="onPointerEnter",R="pointer"),Ie=G==null?j:ha(G),U=Se==null?j:ha(Se),j=new ye(te,R+"leave",G,i,Z),j.target=Ie,j.relatedTarget=U,te=null,fa(Z)===q&&(ye=new ye(D,R+"enter",Se,i,Z),ye.target=U,ye.relatedTarget=Ie,te=ye),Ie=te,G&&Se)t:{for(ye=G,D=Se,R=0,U=ye;U;U=Gs(U))R++;for(U=0,te=D;te;te=Gs(te))U++;for(;0<R-U;)ye=Gs(ye),R--;for(;0<U-R;)D=Gs(D),U--;for(;R--;){if(ye===D||D!==null&&ye===D.alternate)break t;ye=Gs(ye),D=Gs(D)}ye=null}else ye=null;G!==null&&$g(ie,j,G,ye,!1),Se!==null&&Ie!==null&&$g(ie,Ie,Se,ye,!0)}}e:{if(j=q?ha(q):window,G=j.nodeName&&j.nodeName.toLowerCase(),G==="select"||G==="input"&&j.type==="file")var he=cp;else if(op(j))if(up)he=iS;else{he=nS;var we=tS}else G=j.nodeName,!G||G.toLowerCase()!=="input"||j.type!=="checkbox"&&j.type!=="radio"?q&&Du(q.elementType)&&(he=cp):he=aS;if(he&&(he=he(e,q))){lp(ie,he,i,Z);break e}we&&we(e,j,q),e==="focusout"&&q&&j.type==="number"&&q.memoizedProps.value!=null&&Xa(j,"number",j.value)}switch(we=q?ha(q):window,e){case"focusin":(op(we)||we.contentEditable==="true")&&(bs=we,Vu=q,Cr=null);break;case"focusout":Cr=Vu=bs=null;break;case"mousedown":Xu=!0;break;case"contextmenu":case"mouseup":case"dragend":Xu=!1,bp(ie,i,Z);break;case"selectionchange":if(rS)break;case"keydown":case"keyup":bp(ie,i,Z)}var pe;if(Gu)e:{switch(e){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else ys?sp(e,i)&&(be="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(be="onCompositionStart");be&&(np&&i.locale!=="ko"&&(ys||be!=="onCompositionStart"?be==="onCompositionEnd"&&ys&&(pe=Zm()):(Ka=Z,zu="value"in Ka?Ka.value:Ka.textContent,ys=!0)),we=Ql(q,be),0<we.length&&(be=new ep(be,e,null,i,Z),ie.push({event:be,listeners:we}),pe?be.data=pe:(pe=rp(i),pe!==null&&(be.data=pe)))),(pe=P1?Z1(e,i):J1(e,i))&&(be=Ql(q,"onBeforeInput"),0<be.length&&(we=new ep("onBeforeInput","beforeinput",null,i,Z),ie.push({event:we,listeners:be}),we.data=pe)),GS(ie,e,q,i,Z)}Gg(ie,n)})}function eo(e,n,i){return{instance:e,listener:n,currentTarget:i}}function Ql(e,n){for(var i=n+"Capture",o=[];e!==null;){var c=e,d=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||d===null||(c=br(e,i),c!=null&&o.unshift(eo(e,c,d)),c=br(e,n),c!=null&&o.push(eo(e,c,d))),e.tag===3)return o;e=e.return}return[]}function Gs(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function $g(e,n,i,o,c){for(var d=n._reactName,b=[];i!==null&&i!==o;){var E=i,A=E.alternate,q=E.stateNode;if(E=E.tag,A!==null&&A===o)break;E!==5&&E!==26&&E!==27||q===null||(A=q,c?(q=br(i,d),q!=null&&b.unshift(eo(i,q,A))):c||(q=br(i,d),q!=null&&b.push(eo(i,q,A)))),i=i.return}b.length!==0&&e.push({event:n,listeners:b})}var VS=/\r\n?/g,XS=/\u0000|\uFFFD/g;function Yg(e){return(typeof e=="string"?e:""+e).replace(VS,`
`).replace(XS,"")}function Vg(e,n){return n=Yg(n),Yg(e)===n}function Pl(){}function He(e,n,i,o,c,d){switch(i){case"children":typeof o=="string"?n==="body"||n==="textarea"&&o===""||ms(e,o):(typeof o=="number"||typeof o=="bigint")&&n!=="body"&&ms(e,""+o);break;case"className":_i(e,"class",o);break;case"tabIndex":_i(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":_i(e,i,o);break;case"style":Km(e,o,d);break;case"data":if(n!=="object"){_i(e,"data",o);break}case"src":case"href":if(o===""&&(n!=="a"||i!=="href")){e.removeAttribute(i);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(i);break}o=il(""+o),e.setAttribute(i,o);break;case"action":case"formAction":if(typeof o=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(i==="formAction"?(n!=="input"&&He(e,n,"name",c.name,c,null),He(e,n,"formEncType",c.formEncType,c,null),He(e,n,"formMethod",c.formMethod,c,null),He(e,n,"formTarget",c.formTarget,c,null)):(He(e,n,"encType",c.encType,c,null),He(e,n,"method",c.method,c,null),He(e,n,"target",c.target,c,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(i);break}o=il(""+o),e.setAttribute(i,o);break;case"onClick":o!=null&&(e.onclick=Pl);break;case"onScroll":o!=null&&Ce("scroll",e);break;case"onScrollEnd":o!=null&&Ce("scrollend",e);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(i=o.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"multiple":e.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":e.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){e.removeAttribute("xlink:href");break}i=il(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,""+o):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":o===!0?e.setAttribute(i,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,o):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?e.setAttribute(i,o):e.removeAttribute(i);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?e.removeAttribute(i):e.setAttribute(i,o);break;case"popover":Ce("beforetoggle",e),Ce("toggle",e),Ci(e,"popover",o);break;case"xlinkActuate":Tn(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":Tn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":Tn(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":Tn(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":Tn(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":Tn(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":Tn(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":Tn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":Tn(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":Ci(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=x1.get(i)||i,Ci(e,i,o))}}function yf(e,n,i,o,c,d){switch(i){case"style":Km(e,o,d);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(i=o.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"children":typeof o=="string"?ms(e,o):(typeof o=="number"||typeof o=="bigint")&&ms(e,""+o);break;case"onScroll":o!=null&&Ce("scroll",e);break;case"onScrollEnd":o!=null&&Ce("scrollend",e);break;case"onClick":o!=null&&(e.onclick=Pl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Zo.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(c=i.endsWith("Capture"),n=i.slice(2,c?i.length-7:void 0),d=e[ft]||null,d=d!=null?d[i]:null,typeof d=="function"&&e.removeEventListener(n,d,c),typeof o=="function")){typeof d!="function"&&d!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(n,o,c);break e}i in e?e[i]=o:o===!0?e.setAttribute(i,""):Ci(e,i,o)}}}function Ct(e,n,i){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ce("error",e),Ce("load",e);var o=!1,c=!1,d;for(d in i)if(i.hasOwnProperty(d)){var b=i[d];if(b!=null)switch(d){case"src":o=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,n));default:He(e,n,d,b,i,null)}}c&&He(e,n,"srcSet",i.srcSet,i,null),o&&He(e,n,"src",i.src,i,null);return;case"input":Ce("invalid",e);var E=d=b=c=null,A=null,q=null;for(o in i)if(i.hasOwnProperty(o)){var Z=i[o];if(Z!=null)switch(o){case"name":c=Z;break;case"type":b=Z;break;case"checked":A=Z;break;case"defaultChecked":q=Z;break;case"value":d=Z;break;case"defaultValue":E=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(r(137,n));break;default:He(e,n,o,Z,i,null)}}Va(e,d,E,A,q,b,c,!1),St(e);return;case"select":Ce("invalid",e),o=b=d=null;for(c in i)if(i.hasOwnProperty(c)&&(E=i[c],E!=null))switch(c){case"value":d=E;break;case"defaultValue":b=E;break;case"multiple":o=E;default:He(e,n,c,E,i,null)}n=d,i=b,e.multiple=!!o,n!=null?pa(e,!!o,n,!1):i!=null&&pa(e,!!o,i,!0);return;case"textarea":Ce("invalid",e),d=c=o=null;for(b in i)if(i.hasOwnProperty(b)&&(E=i[b],E!=null))switch(b){case"value":o=E;break;case"defaultValue":c=E;break;case"children":d=E;break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(r(91));break;default:He(e,n,b,E,i,null)}al(e,o,c,d),St(e);return;case"option":for(A in i)if(i.hasOwnProperty(A)&&(o=i[A],o!=null))switch(A){case"selected":e.selected=o&&typeof o!="function"&&typeof o!="symbol";break;default:He(e,n,A,o,i,null)}return;case"dialog":Ce("beforetoggle",e),Ce("toggle",e),Ce("cancel",e),Ce("close",e);break;case"iframe":case"object":Ce("load",e);break;case"video":case"audio":for(o=0;o<Wr.length;o++)Ce(Wr[o],e);break;case"image":Ce("error",e),Ce("load",e);break;case"details":Ce("toggle",e);break;case"embed":case"source":case"link":Ce("error",e),Ce("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(q in i)if(i.hasOwnProperty(q)&&(o=i[q],o!=null))switch(q){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,n));default:He(e,n,q,o,i,null)}return;default:if(Du(n)){for(Z in i)i.hasOwnProperty(Z)&&(o=i[Z],o!==void 0&&yf(e,n,Z,o,i,void 0));return}}for(E in i)i.hasOwnProperty(E)&&(o=i[E],o!=null&&He(e,n,E,o,i,null))}function KS(e,n,i,o){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,d=null,b=null,E=null,A=null,q=null,Z=null;for(G in i){var ie=i[G];if(i.hasOwnProperty(G)&&ie!=null)switch(G){case"checked":break;case"value":break;case"defaultValue":A=ie;default:o.hasOwnProperty(G)||He(e,n,G,null,o,ie)}}for(var j in o){var G=o[j];if(ie=i[j],o.hasOwnProperty(j)&&(G!=null||ie!=null))switch(j){case"type":d=G;break;case"name":c=G;break;case"checked":q=G;break;case"defaultChecked":Z=G;break;case"value":b=G;break;case"defaultValue":E=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(r(137,n));break;default:G!==ie&&He(e,n,j,G,o,ie)}}it(e,b,E,A,q,Z,d,c);return;case"select":G=b=E=j=null;for(d in i)if(A=i[d],i.hasOwnProperty(d)&&A!=null)switch(d){case"value":break;case"multiple":G=A;default:o.hasOwnProperty(d)||He(e,n,d,null,o,A)}for(c in o)if(d=o[c],A=i[c],o.hasOwnProperty(c)&&(d!=null||A!=null))switch(c){case"value":j=d;break;case"defaultValue":E=d;break;case"multiple":b=d;default:d!==A&&He(e,n,c,d,o,A)}n=E,i=b,o=G,j!=null?pa(e,!!i,j,!1):!!o!=!!i&&(n!=null?pa(e,!!i,n,!0):pa(e,!!i,i?[]:"",!1));return;case"textarea":G=j=null;for(E in i)if(c=i[E],i.hasOwnProperty(E)&&c!=null&&!o.hasOwnProperty(E))switch(E){case"value":break;case"children":break;default:He(e,n,E,null,o,c)}for(b in o)if(c=o[b],d=i[b],o.hasOwnProperty(b)&&(c!=null||d!=null))switch(b){case"value":j=c;break;case"defaultValue":G=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(r(91));break;default:c!==d&&He(e,n,b,c,o,d)}Fn(e,j,G);return;case"option":for(var Se in i)if(j=i[Se],i.hasOwnProperty(Se)&&j!=null&&!o.hasOwnProperty(Se))switch(Se){case"selected":e.selected=!1;break;default:He(e,n,Se,null,o,j)}for(A in o)if(j=o[A],G=i[A],o.hasOwnProperty(A)&&j!==G&&(j!=null||G!=null))switch(A){case"selected":e.selected=j&&typeof j!="function"&&typeof j!="symbol";break;default:He(e,n,A,j,o,G)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ye in i)j=i[ye],i.hasOwnProperty(ye)&&j!=null&&!o.hasOwnProperty(ye)&&He(e,n,ye,null,o,j);for(q in o)if(j=o[q],G=i[q],o.hasOwnProperty(q)&&j!==G&&(j!=null||G!=null))switch(q){case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(r(137,n));break;default:He(e,n,q,j,o,G)}return;default:if(Du(n)){for(var Ie in i)j=i[Ie],i.hasOwnProperty(Ie)&&j!==void 0&&!o.hasOwnProperty(Ie)&&yf(e,n,Ie,void 0,o,j);for(Z in o)j=o[Z],G=i[Z],!o.hasOwnProperty(Z)||j===G||j===void 0&&G===void 0||yf(e,n,Z,j,o,G);return}}for(var D in i)j=i[D],i.hasOwnProperty(D)&&j!=null&&!o.hasOwnProperty(D)&&He(e,n,D,null,o,j);for(ie in o)j=o[ie],G=i[ie],!o.hasOwnProperty(ie)||j===G||j==null&&G==null||He(e,n,ie,j,o,G)}var bf=null,vf=null;function Zl(e){return e.nodeType===9?e:e.ownerDocument}function Xg(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Kg(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function Sf(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Ef=null;function QS(){var e=window.event;return e&&e.type==="popstate"?e===Ef?!1:(Ef=e,!0):(Ef=null,!1)}var Qg=typeof setTimeout=="function"?setTimeout:void 0,PS=typeof clearTimeout=="function"?clearTimeout:void 0,Pg=typeof Promise=="function"?Promise:void 0,ZS=typeof queueMicrotask=="function"?queueMicrotask:typeof Pg<"u"?function(e){return Pg.resolve(null).then(e).catch(JS)}:Qg;function JS(e){setTimeout(function(){throw e})}function ui(e){return e==="head"}function Zg(e,n){var i=n,o=0,c=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(0<o&&8>o){i=o;var b=e.ownerDocument;if(i&1&&to(b.documentElement),i&2&&to(b.body),i&4)for(i=b.head,to(i),b=i.firstChild;b;){var E=b.nextSibling,A=b.nodeName;b[Ai]||A==="SCRIPT"||A==="STYLE"||A==="LINK"&&b.rel.toLowerCase()==="stylesheet"||i.removeChild(b),b=E}}if(c===0){e.removeChild(d),co(n);return}c--}else i==="$"||i==="$?"||i==="$!"?c++:o=i.charCodeAt(0)-48;else o=0;i=d}while(i);co(n)}function Mf(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var i=n;switch(n=n.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":Mf(i),fs(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function WS(e,n,i,o){for(;e.nodeType===1;){var c=i;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!o&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(o){if(!e[Ai])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var d=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=kn(e.nextSibling),e===null)break}return null}function eE(e,n,i){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=kn(e.nextSibling),e===null))return null;return e}function xf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function tE(e,n){var i=e.ownerDocument;if(e.data!=="$?"||i.readyState==="complete")n();else{var o=function(){n(),i.removeEventListener("DOMContentLoaded",o)};i.addEventListener("DOMContentLoaded",o),e._reactRetry=o}}function kn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="F!"||n==="F")break;if(n==="/$")return null}}return e}var wf=null;function Jg(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(n===0)return e;n--}else i==="/$"&&n++}e=e.previousSibling}return null}function Wg(e,n,i){switch(n=Zl(i),e){case"html":if(e=n.documentElement,!e)throw Error(r(452));return e;case"head":if(e=n.head,!e)throw Error(r(453));return e;case"body":if(e=n.body,!e)throw Error(r(454));return e;default:throw Error(r(451))}}function to(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);fs(e)}var vn=new Map,ey=new Set;function Jl(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ra=P.d;P.d={f:nE,r:aE,D:iE,C:sE,L:rE,m:oE,X:cE,S:lE,M:uE};function nE(){var e=Ra.f(),n=Fl();return e||n}function aE(e){var n=$a(e);n!==null&&n.tag===5&&n.type==="form"?S0(n):Ra.r(e)}var Fs=typeof document>"u"?null:document;function ty(e,n,i){var o=Fs;if(o&&typeof n=="string"&&n){var c=ht(n);c='link[rel="'+e+'"][href="'+c+'"]',typeof i=="string"&&(c+='[crossorigin="'+i+'"]'),ey.has(c)||(ey.add(c),e={rel:e,crossOrigin:i,href:n},o.querySelector(c)===null&&(n=o.createElement("link"),Ct(n,"link",e),nt(n),o.head.appendChild(n)))}}function iE(e){Ra.D(e),ty("dns-prefetch",e,null)}function sE(e,n){Ra.C(e,n),ty("preconnect",e,n)}function rE(e,n,i){Ra.L(e,n,i);var o=Fs;if(o&&e&&n){var c='link[rel="preload"][as="'+ht(n)+'"]';n==="image"&&i&&i.imageSrcSet?(c+='[imagesrcset="'+ht(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(c+='[imagesizes="'+ht(i.imageSizes)+'"]')):c+='[href="'+ht(e)+'"]';var d=c;switch(n){case"style":d=$s(e);break;case"script":d=Ys(e)}vn.has(d)||(e=g({rel:"preload",href:n==="image"&&i&&i.imageSrcSet?void 0:e,as:n},i),vn.set(d,e),o.querySelector(c)!==null||n==="style"&&o.querySelector(no(d))||n==="script"&&o.querySelector(ao(d))||(n=o.createElement("link"),Ct(n,"link",e),nt(n),o.head.appendChild(n)))}}function oE(e,n){Ra.m(e,n);var i=Fs;if(i&&e){var o=n&&typeof n.as=="string"?n.as:"script",c='link[rel="modulepreload"][as="'+ht(o)+'"][href="'+ht(e)+'"]',d=c;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=Ys(e)}if(!vn.has(d)&&(e=g({rel:"modulepreload",href:e},n),vn.set(d,e),i.querySelector(c)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(ao(d)))return}o=i.createElement("link"),Ct(o,"link",e),nt(o),i.head.appendChild(o)}}}function lE(e,n,i){Ra.S(e,n,i);var o=Fs;if(o&&e){var c=ma(o).hoistableStyles,d=$s(e);n=n||"default";var b=c.get(d);if(!b){var E={loading:0,preload:null};if(b=o.querySelector(no(d)))E.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":n},i),(i=vn.get(d))&&Af(e,i);var A=b=o.createElement("link");nt(A),Ct(A,"link",e),A._p=new Promise(function(q,Z){A.onload=q,A.onerror=Z}),A.addEventListener("load",function(){E.loading|=1}),A.addEventListener("error",function(){E.loading|=2}),E.loading|=4,Wl(b,n,o)}b={type:"stylesheet",instance:b,count:1,state:E},c.set(d,b)}}}function cE(e,n){Ra.X(e,n);var i=Fs;if(i&&e){var o=ma(i).hoistableScripts,c=Ys(e),d=o.get(c);d||(d=i.querySelector(ao(c)),d||(e=g({src:e,async:!0},n),(n=vn.get(c))&&Cf(e,n),d=i.createElement("script"),nt(d),Ct(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},o.set(c,d))}}function uE(e,n){Ra.M(e,n);var i=Fs;if(i&&e){var o=ma(i).hoistableScripts,c=Ys(e),d=o.get(c);d||(d=i.querySelector(ao(c)),d||(e=g({src:e,async:!0,type:"module"},n),(n=vn.get(c))&&Cf(e,n),d=i.createElement("script"),nt(d),Ct(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},o.set(c,d))}}function ny(e,n,i,o){var c=(c=ue.current)?Jl(c):null;if(!c)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(n=$s(i.href),i=ma(c).hoistableStyles,o=i.get(n),o||(o={type:"style",instance:null,count:0,state:null},i.set(n,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=$s(i.href);var d=ma(c).hoistableStyles,b=d.get(e);if(b||(c=c.ownerDocument||c,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,b),(d=c.querySelector(no(e)))&&!d._p&&(b.instance=d,b.state.loading=5),vn.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},vn.set(e,i),d||dE(c,e,i,b.state))),n&&o===null)throw Error(r(528,""));return b}if(n&&o!==null)throw Error(r(529,""));return null;case"script":return n=i.async,i=i.src,typeof i=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Ys(i),i=ma(c).hoistableScripts,o=i.get(n),o||(o={type:"script",instance:null,count:0,state:null},i.set(n,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function $s(e){return'href="'+ht(e)+'"'}function no(e){return'link[rel="stylesheet"]['+e+"]"}function ay(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function dE(e,n,i,o){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?o.loading=1:(n=e.createElement("link"),o.preload=n,n.addEventListener("load",function(){return o.loading|=1}),n.addEventListener("error",function(){return o.loading|=2}),Ct(n,"link",i),nt(n),e.head.appendChild(n))}function Ys(e){return'[src="'+ht(e)+'"]'}function ao(e){return"script[async]"+e}function iy(e,n,i){if(n.count++,n.instance===null)switch(n.type){case"style":var o=e.querySelector('style[data-href~="'+ht(i.href)+'"]');if(o)return n.instance=o,nt(o),o;var c=g({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return o=(e.ownerDocument||e).createElement("style"),nt(o),Ct(o,"style",c),Wl(o,i.precedence,e),n.instance=o;case"stylesheet":c=$s(i.href);var d=e.querySelector(no(c));if(d)return n.state.loading|=4,n.instance=d,nt(d),d;o=ay(i),(c=vn.get(c))&&Af(o,c),d=(e.ownerDocument||e).createElement("link"),nt(d);var b=d;return b._p=new Promise(function(E,A){b.onload=E,b.onerror=A}),Ct(d,"link",o),n.state.loading|=4,Wl(d,i.precedence,e),n.instance=d;case"script":return d=Ys(i.src),(c=e.querySelector(ao(d)))?(n.instance=c,nt(c),c):(o=i,(c=vn.get(d))&&(o=g({},i),Cf(o,c)),e=e.ownerDocument||e,c=e.createElement("script"),nt(c),Ct(c,"link",o),e.head.appendChild(c),n.instance=c);case"void":return null;default:throw Error(r(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(o=n.instance,n.state.loading|=4,Wl(o,i.precedence,e));return n.instance}function Wl(e,n,i){for(var o=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=o.length?o[o.length-1]:null,d=c,b=0;b<o.length;b++){var E=o[b];if(E.dataset.precedence===n)d=E;else if(d!==c)break}d?d.parentNode.insertBefore(e,d.nextSibling):(n=i.nodeType===9?i.head:i,n.insertBefore(e,n.firstChild))}function Af(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function Cf(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var ec=null;function sy(e,n,i){if(ec===null){var o=new Map,c=ec=new Map;c.set(i,o)}else c=ec,o=c.get(i),o||(o=new Map,c.set(i,o));if(o.has(e))return o;for(o.set(e,null),i=i.getElementsByTagName(e),c=0;c<i.length;c++){var d=i[c];if(!(d[Ai]||d[tt]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var b=d.getAttribute(n)||"";b=e+b;var E=o.get(b);E?E.push(d):o.set(b,[d])}}return o}function ry(e,n,i){e=e.ownerDocument||e,e.head.insertBefore(i,n==="title"?e.querySelector("head > title"):null)}function fE(e,n,i){if(i===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function oy(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var io=null;function hE(){}function mE(e,n,i){if(io===null)throw Error(r(475));var o=io;if(n.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(n.state.loading&4)===0){if(n.instance===null){var c=$s(i.href),d=e.querySelector(no(c));if(d){e=d._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(o.count++,o=tc.bind(o),e.then(o,o)),n.state.loading|=4,n.instance=d,nt(d);return}d=e.ownerDocument||e,i=ay(i),(c=vn.get(c))&&Af(i,c),d=d.createElement("link"),nt(d);var b=d;b._p=new Promise(function(E,A){b.onload=E,b.onerror=A}),Ct(d,"link",i),n.instance=d}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(n,e),(e=n.state.preload)&&(n.state.loading&3)===0&&(o.count++,n=tc.bind(o),e.addEventListener("load",n),e.addEventListener("error",n))}}function pE(){if(io===null)throw Error(r(475));var e=io;return e.stylesheets&&e.count===0&&_f(e,e.stylesheets),0<e.count?function(n){var i=setTimeout(function(){if(e.stylesheets&&_f(e,e.stylesheets),e.unsuspend){var o=e.unsuspend;e.unsuspend=null,o()}},6e4);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(i)}}:null}function tc(){if(this.count--,this.count===0){if(this.stylesheets)_f(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var nc=null;function _f(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,nc=new Map,n.forEach(gE,e),nc=null,tc.call(e))}function gE(e,n){if(!(n.state.loading&4)){var i=nc.get(e);if(i)var o=i.get(null);else{i=new Map,nc.set(e,i);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<c.length;d++){var b=c[d];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(i.set(b.dataset.precedence,b),o=b)}o&&i.set(null,o)}c=n.instance,b=c.getAttribute("data-precedence"),d=i.get(b)||o,d===o&&i.set(null,c),i.set(b,c),this.count++,o=tc.bind(this),c.addEventListener("load",o),c.addEventListener("error",o),d?d.parentNode.insertBefore(c,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),n.state.loading|=4}}var so={$$typeof:B,Provider:null,Consumer:null,_currentValue:le,_currentValue2:le,_threadCount:0};function yE(e,n,i,o,c,d,b,E){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=us(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=us(0),this.hiddenUpdates=us(null),this.identifierPrefix=o,this.onUncaughtError=c,this.onCaughtError=d,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=E,this.incompleteTransitions=new Map}function ly(e,n,i,o,c,d,b,E,A,q,Z,ie){return e=new yE(e,n,i,b,E,A,q,ie),n=1,d===!0&&(n|=24),d=nn(3,null,null,n),e.current=d,d.stateNode=e,n=od(),n.refCount++,e.pooledCache=n,n.refCount++,d.memoizedState={element:o,isDehydrated:i,cache:n},dd(d),e}function cy(e){return e?(e=Ms,e):Ms}function uy(e,n,i,o,c,d){c=cy(c),o.context===null?o.context=c:o.pendingContext=c,o=Za(n),o.payload={element:i},d=d===void 0?null:d,d!==null&&(o.callback=d),i=Ja(e,o,n),i!==null&&(ln(i,e,n),Or(i,e,n))}function dy(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<n?i:n}}function Tf(e,n){dy(e,n),(e=e.alternate)&&dy(e,n)}function fy(e){if(e.tag===13){var n=Es(e,67108864);n!==null&&ln(n,e,67108864),Tf(e,67108864)}}var ac=!0;function bE(e,n,i,o){var c=L.T;L.T=null;var d=P.p;try{P.p=2,Rf(e,n,i,o)}finally{P.p=d,L.T=c}}function vE(e,n,i,o){var c=L.T;L.T=null;var d=P.p;try{P.p=8,Rf(e,n,i,o)}finally{P.p=d,L.T=c}}function Rf(e,n,i,o){if(ac){var c=Nf(o);if(c===null)gf(e,n,o,ic,i),my(e,o);else if(EE(c,e,n,i,o))o.stopPropagation();else if(my(e,o),n&4&&-1<SE.indexOf(e)){for(;c!==null;){var d=$a(c);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var b=Hn(d.pendingLanes);if(b!==0){var E=d;for(E.pendingLanes|=2,E.entangledLanes|=2;b;){var A=1<<31-Tt(b);E.entanglements[1]|=A,b&=~A}Kn(d),(Le&6)===0&&(jl=fe()+500,Jr(0))}}break;case 13:E=Es(d,2),E!==null&&ln(E,d,2),Fl(),Tf(d,2)}if(d=Nf(o),d===null&&gf(e,n,o,ic,i),d===c)break;c=d}c!==null&&o.stopPropagation()}else gf(e,n,o,null,i)}}function Nf(e){return e=Uu(e),kf(e)}var ic=null;function kf(e){if(ic=null,e=fa(e),e!==null){var n=u(e);if(n===null)e=null;else{var i=n.tag;if(i===13){if(e=f(n),e!==null)return e;e=null}else if(i===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return ic=e,null}function hy(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Te()){case Ge:return 2;case ze:return 8;case vt:case fn:return 32;case Zt:return 268435456;default:return 32}default:return 32}}var Df=!1,di=null,fi=null,hi=null,ro=new Map,oo=new Map,mi=[],SE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function my(e,n){switch(e){case"focusin":case"focusout":di=null;break;case"dragenter":case"dragleave":fi=null;break;case"mouseover":case"mouseout":hi=null;break;case"pointerover":case"pointerout":ro.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":oo.delete(n.pointerId)}}function lo(e,n,i,o,c,d){return e===null||e.nativeEvent!==d?(e={blockedOn:n,domEventName:i,eventSystemFlags:o,nativeEvent:d,targetContainers:[c]},n!==null&&(n=$a(n),n!==null&&fy(n)),e):(e.eventSystemFlags|=o,n=e.targetContainers,c!==null&&n.indexOf(c)===-1&&n.push(c),e)}function EE(e,n,i,o,c){switch(n){case"focusin":return di=lo(di,e,n,i,o,c),!0;case"dragenter":return fi=lo(fi,e,n,i,o,c),!0;case"mouseover":return hi=lo(hi,e,n,i,o,c),!0;case"pointerover":var d=c.pointerId;return ro.set(d,lo(ro.get(d)||null,e,n,i,o,c)),!0;case"gotpointercapture":return d=c.pointerId,oo.set(d,lo(oo.get(d)||null,e,n,i,o,c)),!0}return!1}function py(e){var n=fa(e.target);if(n!==null){var i=u(n);if(i!==null){if(n=i.tag,n===13){if(n=f(i),n!==null){e.blockedOn=n,Po(e.priority,function(){if(i.tag===13){var o=on();o=gr(o);var c=Es(i,o);c!==null&&ln(c,i,o),Tf(i,o)}});return}}else if(n===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function sc(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var i=Nf(e.nativeEvent);if(i===null){i=e.nativeEvent;var o=new i.constructor(i.type,i);Lu=o,i.target.dispatchEvent(o),Lu=null}else return n=$a(i),n!==null&&fy(n),e.blockedOn=i,!1;n.shift()}return!0}function gy(e,n,i){sc(e)&&i.delete(n)}function ME(){Df=!1,di!==null&&sc(di)&&(di=null),fi!==null&&sc(fi)&&(fi=null),hi!==null&&sc(hi)&&(hi=null),ro.forEach(gy),oo.forEach(gy)}function rc(e,n){e.blockedOn===n&&(e.blockedOn=null,Df||(Df=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,ME)))}var oc=null;function yy(e){oc!==e&&(oc=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){oc===e&&(oc=null);for(var n=0;n<e.length;n+=3){var i=e[n],o=e[n+1],c=e[n+2];if(typeof o!="function"){if(kf(o||i)===null)continue;break}var d=$a(i);d!==null&&(e.splice(n,3),n-=3,Nd(d,{pending:!0,data:c,method:i.method,action:o},o,c))}}))}function co(e){function n(A){return rc(A,e)}di!==null&&rc(di,e),fi!==null&&rc(fi,e),hi!==null&&rc(hi,e),ro.forEach(n),oo.forEach(n);for(var i=0;i<mi.length;i++){var o=mi[i];o.blockedOn===e&&(o.blockedOn=null)}for(;0<mi.length&&(i=mi[0],i.blockedOn===null);)py(i),i.blockedOn===null&&mi.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(o=0;o<i.length;o+=3){var c=i[o],d=i[o+1],b=c[ft]||null;if(typeof d=="function")b||yy(i);else if(b){var E=null;if(d&&d.hasAttribute("formAction")){if(c=d,b=d[ft]||null)E=b.formAction;else if(kf(c)!==null)continue}else E=b.action;typeof E=="function"?i[o+1]=E:(i.splice(o,3),o-=3),yy(i)}}}function Lf(e){this._internalRoot=e}lc.prototype.render=Lf.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(r(409));var i=n.current,o=on();uy(i,o,e,n,null,null)},lc.prototype.unmount=Lf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;uy(e.current,2,null,e,null,null),Fl(),n[da]=null}};function lc(e){this._internalRoot=e}lc.prototype.unstable_scheduleHydration=function(e){if(e){var n=Qo();e={blockedOn:null,target:e,priority:n};for(var i=0;i<mi.length&&n!==0&&n<mi[i].priority;i++);mi.splice(i,0,e),i===0&&py(e)}};var by=a.version;if(by!=="19.1.1")throw Error(r(527,by,"19.1.1"));P.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=m(n),e=e!==null?p(e):null,e=e===null?null:e.stateNode,e};var xE={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cc.isDisabled&&cc.supportsFiber)try{Ke=cc.inject(xE),Pe=cc}catch{}}return go.createRoot=function(e,n){if(!l(e))throw Error(r(299));var i=!1,o="",c=U0,d=O0,b=q0,E=null;return n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onUncaughtError!==void 0&&(c=n.onUncaughtError),n.onCaughtError!==void 0&&(d=n.onCaughtError),n.onRecoverableError!==void 0&&(b=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(E=n.unstable_transitionCallbacks)),n=ly(e,1,!1,null,null,i,o,c,d,b,E,null),e[da]=n.current,pf(e),new Lf(n)},go.hydrateRoot=function(e,n,i){if(!l(e))throw Error(r(299));var o=!1,c="",d=U0,b=O0,E=q0,A=null,q=null;return i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(d=i.onUncaughtError),i.onCaughtError!==void 0&&(b=i.onCaughtError),i.onRecoverableError!==void 0&&(E=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(A=i.unstable_transitionCallbacks),i.formState!==void 0&&(q=i.formState)),n=ly(e,1,!0,n,i??null,o,c,d,b,E,A,q),n.context=cy(null),i=n.current,o=on(),o=gr(o),c=Za(o),c.callback=null,Ja(i,c,o),i=o,n.current.lanes=i,In(n,i),Kn(n),e[da]=n.current,pf(e),new lc(n)},go.version="19.1.1",go}var gb;function L3(){if(gb)return Zf.exports;gb=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(a){console.error(a)}}return t(),Zf.exports=D3(),Zf.exports}var U3=L3(),gt=Am();const vc=10,O3=1.5,q3=1.5,yb=1,z3=.6,bb="⚔️ +50% attack · 🛡️ Barrier · ♾️ Immortal",Pi=5,Zi=3;let yt=null;function B3(){yt&&(yt.tickTimer&&clearInterval(yt.tickTimer),yt.timeout&&clearTimeout(yt.timeout),yt=null)}function Cm(){return yt!==null}function K2(){return yt?Math.max(0,yt.endTime-performance.now())/1e3:0}function H3(t,a){if(Cm()||!t.spendResource(Pi,re.SISU))return!1;const s=[];for(const l of a){if(l.faction!=="player"||l.isDead())continue;const u=`sisu-burst-${l.id}`,f={unit:l,attackDelta:0,movementDelta:0,shieldBonusApplied:yb,shieldBonusRemaining:yb,wasImmortal:l.isImmortal()};HM({id:u,duration:vc,data:f,onApply:()=>{const h=l.stats.attackDamage,m=Math.round(h*O3);f.attackDelta=Math.max(0,m-h),f.attackDelta!==0&&(l.stats.attackDamage=h+f.attackDelta);const p=l.stats.movementRange,g=Math.max(1,Math.round(p*q3));f.movementDelta=Math.max(0,g-p),f.movementDelta!==0&&(l.stats.movementRange=p+f.movementDelta),f.shieldBonusRemaining=f.shieldBonusApplied,l.setShield(l.getShield()+f.shieldBonusApplied),l.setImmortal(!0),l.fearless=!0},onExpire:()=>{let h=!1;if(f.attackDelta!==0){const p=l.stats.attackDamage,g=Math.max(0,p-f.attackDelta);g!==p&&(l.stats.attackDamage=g,h=!0)}if(f.movementDelta!==0){const p=l.stats.movementRange,g=Math.max(0,p-f.movementDelta);g!==p&&(l.stats.movementRange=g,h=!0)}l.setImmortal(f.wasImmortal);const m=Math.max(0,Math.min(f.shieldBonusApplied,f.shieldBonusRemaining));m>0&&l.setShield(Math.max(0,l.getShield()-m)),delete l.fearless,h&&se.emit("unit:stats:changed",{unitId:l.id,stats:{...l.stats}}),yt&&(yt.affected=yt.affected.filter(p=>p.modifierId!==u))},hooks:{"combat:onHit":h=>{const m=h;if(m.source!=="defender"||m.defender.id!==l.id||m.shieldDamage<=0||f.shieldBonusRemaining<=0)return;const p=Math.min(f.shieldBonusRemaining,m.shieldDamage);f.shieldBonusRemaining=Math.max(0,f.shieldBonusRemaining-p)}}}),s.push({unit:l,modifierId:u,state:f})}return yt={endTime:performance.now()+vc*1e3,status:bb,affected:s,tickTimer:null,timeout:null},se.emit("sisuBurstStart",{remaining:vc,status:bb}),yt.tickTimer=setInterval(()=>{if(!yt)return;const l=Math.max(0,Math.ceil(K2()));l>0&&se.emit("sisuBurstTick",{remaining:l,status:yt.status})},1e3),yt.timeout=setTimeout(()=>{I3()},vc*1e3),!0}function I3(){if(yt){for(const t of yt.affected)IM(t.modifierId);B3(),se.emit("sisuBurstEnd",{})}}function j3(t,a,s,r){const l=a.filter(u=>u.faction==="player"&&!u.isDead());if(l.length===0||!t.spendResource(Zi,re.SISU))return!1;for(const u of l){const f=A2(s,3,a)??{...s};u.setCoord(f);const h=Math.round(u.getMaxHealth()*z3);u.stats.health=Math.min(u.getMaxHealth(),Math.max(u.stats.health,h))}return r.revealAround(s,3,{autoFrame:!1}),se.emit("torilleRecalled",{count:l.length}),!0}let ns=!1;function _m(){return ns}function bu(t){ns!==t&&(ns=t,se.emit("game:pause-changed",{paused:ns}))}function G3(){return bu(!ns),ns}function F3(){ns&&bu(!1)}const $3=["/assets/sounds/sauna-forest.ogg","/assets/sounds/sauna-forest.mp3"],Q2="audio_enabled",qh=new Set,vu=new Set;let Ji=null,Sc=null,ka=null,Ro=null;function Y3(t){if(typeof localStorage>"u")return null;try{return localStorage.getItem(t)}catch(a){return console.warn("Unable to read ambience preference",t,a),null}}const P2=Y3(Q2);let Ia=P2==="true",No=P2!==null;const zh=mu();let zc=J2(zh.channels.music.volume,.65),rs=!1,aa=zh.channels.master.muted||zh.channels.music.muted;const Zs=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)"):null;let Z2=Zs?.matches??!1;if(Zs){const t=a=>{Z2=a.matches};typeof Zs.addEventListener=="function"?Zs.addEventListener("change",t):typeof Zs.addListener=="function"&&Zs.addListener(t)}if(typeof window<"u"&&!No){const t=()=>{No||(No=!0,av(!0),Su())};window.addEventListener("pointerdown",t,{once:!0}),window.addEventListener("keydown",t,{once:!0})}lm(t=>{const a=J2(t.channels.music.volume,zc),s=t.channels.master.muted||t.channels.music.muted,r=Math.abs(a-zc)>5e-4;if(zc=a,s!==aa){aa=s,aa?nv():Ia?Su():(zo(!0),qo());return}r&&qo()});function J2(t,a){return Number.isFinite(t)?t<0?0:t>1?1:t:a}function qo(){const t=iv();for(const a of qh)a(t)}function V3(t){if(!(typeof localStorage>"u"))try{localStorage.setItem(Q2,t?"true":"false")}catch(a){console.warn("Unable to persist ambience preference",a)}}function W2(t){if(ka)return ka;const a=t.createGain();a.gain.value=Ia&&!aa?1:0;const s=om("music");return s?a.connect(s):a.connect(t.destination),ka=a,a}function zo(t=!1){if(!ka)return;const a=ka.context,s=Ia&&!aa?1:0,r=a.currentTime;ka.gain.cancelScheduledValues(r),t?ka.gain.setValueAtTime(s,r):ka.gain.setTargetAtTime(s,r,.25)}function X3(){return Z2?.6:4.2}function ev(){Ro!==null&&(clearTimeout(Ro),Ro=null)}function Bh(t){try{t.source.stop()}catch{}t.source.disconnect(),t.gain.disconnect(),vu.delete(t)}function K3(){for(const t of[...vu])Bh(t)}async function Q3(t){return Ji||(Sc||(Sc=(async()=>{for(const a of $3)try{const s=await fetch(a);if(!s.ok)continue;const r=await s.arrayBuffer();return await t.decodeAudioData(r)}catch(s){console.warn("Failed to fetch ambience source",a,s)}throw new Error("No ambience sources available")})().then(a=>(Ji=a,a)).catch(a=>{throw Sc=null,a})),Sc)}function P3(t,a){if(!rs)return;ev();const s=Math.max(0,t-a.currentTime-.05);Ro=setTimeout(()=>{Ro=null,rs&&tv(t)},s*1e3)}function tv(t){const a=ka?.context??sv();if(!a||!Ji)return;const s=a.createGain(),r=a.createBufferSource();r.buffer=Ji,r.loop=!1,r.connect(s),s.connect(W2(a));const l=Math.min(X3(),Ji.duration/2),u=Number.isFinite(l)&&l>0?l:.25,f=Math.max(a.currentTime,t);s.gain.setValueAtTime(0,f),s.gain.linearRampToValueAtTime(1,f+u);const h=t+Ji.duration,m=h-u;m>f&&s.gain.setValueAtTime(1,m),s.gain.linearRampToValueAtTime(.001,h+.1);const p={source:r,gain:s,stopTime:h};vu.add(p),r.addEventListener("ended",()=>{Bh(p)});try{r.start(t)}catch(g){console.warn("Failed to start ambience layer",g),Bh(p);return}P3(h-u,a)}async function Su(){if(rs||!Ia||aa){zo();return}const t=sv();if(t){W2(t),zo();try{const a=await Q3(t);if(!Ia||aa)return;await t.resume().catch(()=>{}),rs=!0;const s=Math.max(t.currentTime+.12,t.currentTime);tv(s),qo()}catch(a){console.warn("Unable to start ambience",a)}}}function nv(){if(!rs&&vu.size===0){zo(!0);return}rs=!1,ev(),K3(),zo(!0),qo()}function av(t){Ia===t&&No||(Ia=t,No=!0,V3(t),t?aa||Su():nv(),qo())}function iv(){return{enabled:Ia,playing:rs,volume:zc,globallyMuted:aa}}function Z3(t){return qh.add(t),()=>{qh.delete(t)}}Ia&&!aa&&Su();function sv(){return rm()}const J3='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',nh={master:"Master mix",music:"Ambience soundscape",sfx:"Effects & interface"},W3={master:"Controls the overall loudness for every channel in the frontier.",music:"Shapes the ambience loops and atmospheric swells around the sauna.",sfx:"Balances unit callouts, UI clicks, and battle feedback cues."},ew="linear-gradient(90deg, rgba(59,130,246,0.85) 0%, rgba(14,165,233,0.9) VAR%, rgba(148,163,184,0.35) VAR%, rgba(71,85,105,0.2) 100%)";function Hh(t,a){t.style.backgroundImage=ew.replace(/VAR/g,`${a}%`)}function Ih(t){return`${Math.round(t)}%`}function tw(t,a,s){const r=l=>{if(l.key==="Escape"){l.preventDefault(),s();return}if(l.key!=="Tab")return;const u=a.querySelectorAll(J3);if(u.length===0){l.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;l.shiftKey?(m===f||!a.contains(m))&&(l.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(l.preventDefault(),f.focus())};return t.addEventListener("keydown",r),()=>t.removeEventListener("keydown",r)}function rv(t,a,s){const r=a.channels[t],l=a.channels.master;if(t==="music"&&!s.enabled)return"Ambience paused";if(r.muted)return"Muted at mixer";if(t!=="master"&&l.muted)return"Master mute active";const u=Math.round(r.effectiveVolume*100);return u<=0?"Output silent":t==="master"?`Master output ${u}%`:t==="music"?`Soundscape live ${u}%`:`Effects live ${u}%`}function ah(t,a,s,r,l,u,f){const h=t.createElement("section");h.className="rounded-hud-xl border border-white/12 bg-[linear-gradient(155deg,rgba(15,26,56,0.92),rgba(9,14,34,0.96))] p-5 shadow-[0_24px_45px_rgba(4,10,25,0.55)] backdrop-blur-[18px] backdrop-saturate-[140%]";const m=t.createElement("header");m.className="flex flex-wrap items-start justify-between gap-3";const p=t.createElement("div");p.className="space-y-1";const g=t.createElement("h3");g.className="text-lg font-semibold tracking-tight text-white",g.textContent=nh[a];const y=t.createElement("p");y.className="max-w-[32ch] text-sm text-slate-300/85",y.textContent=W3[a],p.append(g,y);const v=t.createElement("span");v.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70",v.textContent=rv(a,s,r),m.append(p,v);const S=t.createElement("div");S.className="mt-5 flex items-center gap-4";const M=t.createElement("input");M.type="range",M.min="0",M.max="100",M.step="1",M.className="h-2 flex-1 appearance-none rounded-full bg-slate-600/30 accent-accent transition-[background-image] duration-200 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",M.setAttribute("aria-label",`${nh[a]} level`);const _=t.createElement("span");_.className="text-sm font-semibold text-slate-200",S.append(M,_);const T=t.createElement("div");T.className="mt-4 flex flex-wrap items-center gap-3";const N=t.createElement("button");if(N.type="button",N.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/60 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-white/80 transition-all duration-150 ease-out hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",N.setAttribute("aria-label",`Toggle mute for ${nh[a]}`),N.addEventListener("click",()=>{const Y=!Ki.channels[a].muted;l(a,Y)}),T.append(N),a==="sfx"){const Y=t.createElement("button");Y.type="button",Y.className="inline-flex items-center gap-2 rounded-full border border-accent/40 bg-accent/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-accent-200 transition-all duration-150 ease-out hover:bg-accent/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",Y.textContent="Play sample",Y.addEventListener("click",()=>{na("spawn")}),T.append(Y)}let O;a==="music"&&f&&(O=t.createElement("button"),O.type="button",O.className="inline-flex items-center gap-2 rounded-full border border-emerald-300/25 bg-emerald-400/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-emerald-200 transition-all duration-150 ease-out hover:bg-emerald-400/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300",O.addEventListener("click",()=>{f()}),T.append(O));const B=Math.round(s.channels[a].volume*100);return M.value=String(B),Hh(M,B),_.textContent=Ih(B),N.setAttribute("aria-pressed",s.channels[a].muted?"true":"false"),N.textContent=s.channels[a].muted?"Muted":"Active",a==="music"&&(M.title=r.enabled?"Adjust ambience loudness":"Ambience paused — set the level ahead of resuming."),M.addEventListener("input",()=>{const Y=Number(M.value);Hh(M,Y),_.textContent=Ih(Y),u(a,Y/100)}),h.append(m,S,T),{card:h,slider:M,value:_,muteButton:N,status:v,ambienceToggle:O}}let Ki=mu();function nw(t){const{container:a,onClose:s}=t;if(!a)return{destroy(){},focus(){}};const r=a.ownerDocument??document,l=r.createElement("div");l.className="pointer-events-auto fixed inset-0 z-[1200] flex items-center justify-center bg-slate-950/75 p-4 backdrop-blur-[22px] backdrop-saturate-[140%]",l.setAttribute("role","presentation");const u=r.createElement("section");u.className="w-full max-w-[min(580px,92vw)] space-y-6 rounded-hud-xl border border-white/12 bg-[linear-gradient(145deg,rgba(12,22,45,0.95),rgba(7,13,29,0.97))] p-6 text-slate-100 shadow-[0_32px_60px_rgba(4,10,24,0.7)] backdrop-blur-[24px] backdrop-saturate-[150%]",u.setAttribute("role","dialog"),u.setAttribute("aria-modal","true");const f=`audio-mixer-title-${Date.now()}`;u.setAttribute("aria-labelledby",f),u.tabIndex=-1;const h=r.createElement("header");h.className="flex items-start justify-between gap-4";const m=r.createElement("div");m.className="space-y-1";const p=r.createElement("h2");p.id=f,p.className="text-2xl font-semibold tracking-tight text-white",p.textContent="Audio mixer";const g=r.createElement("p");g.className="max-w-[46ch] text-sm text-slate-300/85",g.textContent="Dial in the master bus, ambience beds, and tactical feedback without leaving the battlefield.",m.append(p,g);const y=r.createElement("button");y.type="button",y.className="rounded-full border border-white/20 bg-slate-800/70 px-3 py-1 text-sm font-semibold text-white/70 transition-all duration-150 hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",y.textContent="Close",h.append(m,y);const v=r.createElement("span");v.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70";const S=r.createElement("div");S.className="space-y-5";let M=iv();const _={master:ah(r,"master",Ki,M,(H,C)=>{lM(C)},(H,C)=>{sM(C)},null),music:ah(r,"music",Ki,M,(H,C)=>{cM(C)},(H,C)=>{rM(C)},()=>{av(!M.enabled)}),sfx:ah(r,"sfx",Ki,M,(H,C)=>{uM(C)},(H,C)=>{oM(C)},null)};S.append(_.master.card,_.music.card,_.sfx.card),u.append(h,v,S),l.append(u),a.append(l);let T=!1;function N(){const H=_.music.ambienceToggle;H&&(H.setAttribute("aria-pressed",M.enabled?"true":"false"),H.textContent=M.enabled?"Ambience enabled":"Ambience paused",H.title=M.enabled?"Disable ambience loops":"Enable ambience loops")}function O(H){Ki=H;const C=H.contextState==="uninitialized"?"Context idle":H.contextState==="running"?"Context running":"Context suspended";v.textContent=C,["master","music","sfx"].forEach(J=>{const I=_[J],ae=H.channels[J],$=Math.round(ae.volume*100);I.slider.value=String($),Hh(I.slider,$),I.value.textContent=Ih($),I.muteButton.setAttribute("aria-pressed",ae.muted?"true":"false"),I.muteButton.textContent=ae.muted?"Muted":"Active",I.status.textContent=rv(J,H,M),J==="music"&&(I.slider.title=M.enabled?"Adjust ambience loudness":"Ambience paused — set the level ahead of resuming.")}),N()}function B(){T||(T=!0,Y(),l.parentElement&&l.remove(),s?.())}function Y(){X.forEach(H=>{try{H()}catch{}}),X.length=0}const X=[],V=H=>{H.target===l&&B()};l.addEventListener("click",V),X.push(()=>l.removeEventListener("click",V)),y.addEventListener("click",B),X.push(()=>y.removeEventListener("click",B));const W=tw(l,u,B);X.push(W);const ne=lm(H=>{O(H)});X.push(ne);const F=Z3(H=>{M=H,N(),O(Ki)});return X.push(F),O(Ki),u.focus(),{destroy(){B()},focus(){u.focus()}}}function vb(...t){return t.filter(Boolean).join(" ")}function Sb(t,a){return!(t.code!==a.code||(a.shift??!1)!==t.shiftKey||(a.alt??!1)!==t.altKey||(a.meta??!1)!==t.metaKey||(a.ctrl??!1)!==t.ctrlKey)}function aw(t){return!Number.isFinite(t)||t<=0?"0s":`${Math.max(0,Math.ceil(t))}s`}function iw(){const[t,a]=gt.useState(()=>{const s=Cm();return{active:s,remaining:s?Math.ceil(K2()):0,status:s?"Burst active":void 0}});return gt.useEffect(()=>{const s=({remaining:u,status:f})=>{a({active:!0,remaining:Math.ceil(u),status:f})},r=({remaining:u,status:f})=>{a(h=>({active:!0,remaining:Math.ceil(u),status:f??h.status}))},l=()=>{a({active:!1,remaining:0,status:void 0})};return se.on("sisuBurstStart",s),se.on("sisuBurstTick",r),se.on("sisuBurstEnd",l),()=>{se.off("sisuBurstStart",s),se.off("sisuBurstTick",r),se.off("sisuBurstEnd",l)}},[]),t}function sw(){const[t,a]=gt.useState(()=>_m());return gt.useEffect(()=>{const s=({paused:r})=>{a(r)};return se.on("game:pause-changed",s),()=>{se.off("game:pause-changed",s)}},[]),t}function Eb(t){const a=t.target;if(!a)return!1;const s=a.tagName;return!!(s==="INPUT"||s==="TEXTAREA"||s==="SELECT"||a.isContentEditable)}function rw({state:t,abilities:a}){const[s,r]=gt.useState(()=>t.getResource(re.SISU)),[l,u]=gt.useState(()=>Ah()),[f,h]=gt.useState(!1),[m,p]=gt.useState(null),g=gt.useRef({}),[y,v]=gt.useState(()=>new Set),S=iw(),M=sw(),_=gt.useRef(null),T=gt.useCallback(C=>{v(I=>{const ae=new Set(I);return ae.add(C),ae});const J=g.current[C];J&&window.clearTimeout(J),g.current[C]=window.setTimeout(()=>{v(I=>{const ae=new Set(I);return ae.delete(C),ae}),delete g.current[C]},650)},[]);gt.useEffect(()=>{const C=({resource:J,total:I})=>{J===re.SISU&&r(I)};return se.on("resourceChanged",C),()=>{se.off("resourceChanged",C),Object.values(g.current).forEach(J=>{J&&window.clearTimeout(J)}),g.current={}}},[]),gt.useEffect(()=>LM(u),[]),gt.useEffect(()=>()=>{_.current?.destroy(),_.current=null},[]);const N=gt.useCallback(()=>{const C=document.getElementById("ui-overlay");if(!C)return!1;if(_.current)return _.current.destroy(),_.current=null,h(!1),!0;const J=nw({container:C,onClose:()=>{_.current=null,h(!1)}});return _.current=J,h(!0),J.focus(),!0},[]),O=a.useSisuBurst,B=a.torille,Y=a.onOpenBuildPlanner,X=!O||S.active||s<Pi,V=O?S.active?"Burst already surging.":s<Pi?`Requires ${Pi} SISU.`:void 0:"Burst controls offline in this build.",W=!B||s<Zi,ne=B?s<Zi?`Requires ${Zi} SISU.`:void 0:"Torille rally is unavailable right now.",F=gt.useMemo(()=>[{id:"burst",icon:"⚡️",label:"Sisu Burst",description:"Ignite a surge of fury and resilience across your warriors.",hotkey:{code:"KeyQ",label:"Q"},accent:"primary",cost:`-${Pi} SISU`,detail:S.active?`${S.status??"Burst active"} · ${aw(S.remaining)}`:void 0,blocked:X,blockedReason:V,interactive:!!O,onActivate:()=>O?O():!1},{id:"torille",icon:"📣",label:"Torille!",description:"Call every survivor home to the sauna to regroup and heal.",hotkey:{code:"KeyW",label:"W"},accent:"primary",cost:`-${Zi} SISU`,blocked:W,blockedReason:ne,interactive:!!B,onActivate:()=>B?B():!1},{id:"build",icon:"🛠️",label:"Build",description:"Draft new structures to reinforce your frontier.",hotkey:{code:"KeyE",label:"E"},accent:"neutral",blocked:!Y,blockedReason:Y?void 0:"Construction planner will unlock in a forthcoming update.",interactive:!!Y,onActivate:()=>Y?Y()??!0:!1},{id:"sound",icon:l?"🔇":f?"🎚️":"🎛️",label:"Audio",description:"Open the in-game mixer to balance master, ambience, and effects.",hotkey:{code:"KeyR",label:"R"},accent:"neutral",toggled:f,detail:f?"Mixer open":l?"Muted":"Live mix",interactive:!0,blocked:!1,onActivate:()=>!!N()},{id:"pause",icon:M?"⏸️":"▶️",label:M?"Paused":"Pause",description:M?"Time is frozen — resume when your strategy is ready.":"Freeze the battlefield to reassess and issue commands.",hotkey:{code:"Space",label:"Space"},accent:"neutral",toggled:M,detail:M?"Combat frozen":"Time flowing",interactive:!0,blocked:!1,onActivate:()=>(G3(),!0)}],[S.active,S.remaining,X,V,B,f,l,Y,M,W,ne,O]),H=gt.useCallback(C=>{if(!C.interactive){T(C.id);return}if(C.blocked){T(C.id);return}C.onActivate?.()===!1&&T(C.id)},[T]);return gt.useEffect(()=>{const C=I=>{if(I.repeat||Eb(I))return;const ae=F.find($=>Sb(I,$.hotkey));ae&&(I.preventDefault(),p(ae.id),H(ae))},J=I=>{if(Eb(I))return;const ae=F.find($=>Sb(I,$.hotkey));ae&&(I.preventDefault(),p($=>$===ae.id?null:$))};return window.addEventListener("keydown",C),window.addEventListener("keyup",J),()=>{window.removeEventListener("keydown",C),window.removeEventListener("keyup",J)}},[F,H]),Pt.jsx("div",{className:"pointer-events-none w-full",children:Pt.jsx("div",{className:"pointer-events-auto mx-auto flex w-full max-w-4xl flex-col gap-4 rounded-[26px] border border-white/10 bg-[linear-gradient(145deg,rgba(11,17,30,0.86),rgba(6,10,18,0.92))] p-6 shadow-[0_26px_65px_rgba(6,12,24,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)] backdrop-blur-xl","aria-label":"Combat and systems action bar",children:Pt.jsx("div",{className:"flex flex-wrap items-stretch justify-center gap-4",children:F.map(C=>{const J=m===C.id,I=y.has(C.id),$=(C.blocked??!1)||!C.interactive,L=C.detail??C.blockedReason,P=vb("group relative flex min-w-[150px] flex-1 flex-col gap-2 rounded-[20px] border border-white/10 px-5 py-4 text-left transition-all duration-200 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70 focus-visible:ring-offset-0","bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.22),rgba(14,25,45,0.6))] shadow-[0_18px_42px_rgba(8,25,53,0.55)]",C.accent==="primary"&&"border-sky-300/40 bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.32),rgba(11,22,45,0.7))]",C.accent==="danger"&&"border-rose-400/45 bg-[radial-gradient(circle_at_top,rgba(244,114,182,0.32),rgba(45,9,25,0.75))]",J&&"ring-2 ring-sky-300/80 ring-offset-0 translate-y-[-2px] shadow-[0_24px_48px_rgba(56,189,248,0.45)]",I&&'animate-hud-shake after:pointer-events-none after:absolute after:inset-0 after:rounded-[inherit] after:border after:border-rose-300/45 after:bg-[radial-gradient(circle_at_center,rgba(248,113,113,0.18),rgba(248,113,113,0))] after:content-[""] after:animate-hud-pulse',!$&&!J&&"hover:-translate-y-1 hover:shadow-[0_24px_50px_rgba(56,189,248,0.4)]",$&&"cursor-not-allowed opacity-70",C.toggled&&"border-sky-400/60 shadow-[0_0_36px_rgba(56,189,248,0.45)]");return Pt.jsxs("button",{type:"button",className:P,"aria-pressed":C.toggled?"true":void 0,"aria-disabled":$?"true":void 0,"data-hotkey":C.hotkey.label,onClick:le=>{if($){le.preventDefault(),T(C.id);return}H(C)},onKeyDown:le=>{(le.key==="Enter"||le.key===" ")&&(le.preventDefault(),H(C))},title:vb(C.description,C.blockedReason),children:[Pt.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Pt.jsxs("span",{className:"flex items-center gap-3 text-base font-semibold uppercase tracking-[0.18em] text-slate-100",children:[Pt.jsx("span",{"aria-hidden":"true",className:"text-2xl",children:C.icon}),C.label]}),Pt.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-slate-300/80",children:C.hotkey.label})]}),Pt.jsx("p",{className:"text-sm leading-relaxed text-slate-200/80",children:C.description}),Pt.jsxs("div",{className:"flex items-center justify-between text-xs font-medium uppercase tracking-[0.28em] text-slate-300/70",children:[Pt.jsx("span",{children:L??"​"}),C.cost?Pt.jsx("span",{className:"text-slate-200/90",children:C.cost}):Pt.jsx("span",{className:"opacity-0",children:"cost"})]})]},C.id)})})})})}function ow(t,a,s={}){const r=hr(a),l=a.ownerDocument.createElement("div");l.dataset.component="action-bar",l.dataset.tutorialTarget="combat",l.className="flex w-full justify-center";const u=r.regions.bottom,f=u.querySelector("#build-id");f?u.insertBefore(l,f):u.appendChild(l);const h=U3.createRoot(l);return h.render(Pt.jsx(rw,{state:t,abilities:s})),{destroy(){h.unmount(),l.remove()}}}const lw="(max-width: 820px)",ov="is-mobile",lv="is-desktop";let Dn=null,Pc=null,Jn=!1,Ec=0;const Zc=new Set,jh=new Set,Jc=t=>{for(const a of jh)a.classList.toggle(ov,t),a.classList.toggle(lv,!t),a.dataset.viewport=t?"mobile":"desktop"},cw=t=>{if(Jn!==t){Jn=t,Jc(Jn);for(const a of Array.from(Zc))try{a(Jn)}catch(s){console.error("Failed to notify mobile listener",s)}}},cv=()=>{if(Dn||typeof window>"u")return;Dn=window.matchMedia(lw),Jn=Dn.matches,Jc(Jn);const t=a=>{cw(a.matches)};typeof Dn.addEventListener=="function"?(Dn.addEventListener("change",t),Pc=()=>Dn?.removeEventListener("change",t)):(Dn.addListener(t),Pc=()=>Dn?.removeListener(t))},uw=()=>{Dn&&(Pc?.(),Pc=null,Dn=null)},uv=(t,{immediate:a=!0}={})=>(cv(),Zc.add(t),a&&t(Jn),()=>{Zc.delete(t)}),dw=({root:t,onChange:a,immediate:s=!0}={})=>{cv();const r=t??(typeof document<"u"?document.documentElement:null);r&&(jh.add(r),Jc(Jn)),Ec+=1;let l=null;return a?l=uv(a,{immediate:s}):s&&Dn&&Jc(Jn),{matches:()=>Jn,dispose:()=>{r&&(jh.delete(r),r.classList.remove(ov,lv),(r.dataset.viewport==="mobile"||r.dataset.viewport==="desktop")&&delete r.dataset.viewport),l&&(l(),l=null),Ec=Math.max(0,Ec-1),Ec===0&&Zc.size===0&&uw()}}};function fw(t){const a=[t.name];return t.description&&a.push(t.description),t.rarity&&a.push(`Rarity: ${t.rarity}`),t.quantity>1&&a.push(`Quantity: ${t.quantity}`),a.join(" — ")}function hw(t){const a=document.createElement("span");a.classList.add("item-icon__fallback");const s=t.trim();return a.textContent=s?s[0]?.toUpperCase()??"?":"?",a.setAttribute("aria-hidden","true"),a}function mw(t,a){const s=document.createElement("img");return s.src=t,s.alt="",s.decoding="async",s.loading="lazy",s.classList.add("item-icon__image"),s.setAttribute("aria-hidden","true"),s.title=a,s}function pw(t){const a=document.createElement("li");a.classList.add("item-icon"),a.dataset.itemId=t.id;const s=fw(t);if(a.title=s,a.setAttribute("aria-label",s),a.setAttribute("role","listitem"),t.rarity&&(a.dataset.rarity=t.rarity.toLowerCase()),t.icon&&t.icon.trim().length>0?a.appendChild(mw(t.icon,t.name)):a.appendChild(hw(t.name)),t.quantity>1){const r=document.createElement("span");r.classList.add("item-icon__quantity"),r.textContent=`×${t.quantity}`,r.setAttribute("aria-hidden","true"),a.appendChild(r)}return a}const gw=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Gh(t){return t===1/0?"∞":!Number.isFinite(t)||t<=0?"0s":`${gw.format(Math.ceil(t))}s`}function yw(t){const a=[t.name];return t.description&&a.push(t.description),t.source&&a.push(`Source: ${t.source}`),t.duration!==1/0&&a.push(`Duration: ${Gh(t.duration)}`),a.push(`Remaining: ${Gh(t.remaining)}`),t.stacks&&t.stacks>1&&a.push(`Stacks: ${t.stacks}`),a.join(" — ")}function bw(t){const a=document.createElement("li");a.classList.add("mod-pill"),a.dataset.modifierId=t.id,a.title=yw(t),a.setAttribute("aria-label",a.title),a.setAttribute("role","listitem"),a.dataset.duration=t.duration===1/0?"infinite":String(t.duration),a.dataset.remaining=t.remaining===1/0?"infinite":String(t.remaining),t.appliedAt!==void 0&&(a.dataset.appliedAt=String(t.appliedAt)),t.stacks&&t.stacks>1&&(a.dataset.stacks=String(t.stacks));const s=document.createElement("span");if(s.classList.add("mod-pill__name"),s.textContent=t.name,s.setAttribute("aria-hidden","true"),a.appendChild(s),t.stacks&&t.stacks>1){const l=document.createElement("span");l.classList.add("mod-pill__stacks"),l.textContent=`×${t.stacks}`,l.setAttribute("aria-hidden","true"),a.appendChild(l)}const r=document.createElement("span");return r.classList.add("mod-pill__timer"),r.textContent=Gh(t.remaining),r.setAttribute("aria-hidden","true"),a.appendChild(r),t.remaining!==1/0&&t.remaining<=5&&(a.dataset.urgent="true"),a}const Fh={engaged:"Engaged on the field",reserve:"On reserve duty",downed:"Recovering from battle"},Ve=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Mb="panel-roster-title";function vw(t){return t.length===0?"No defining traits yet":t.join(" • ")}function dv(t){return Number.isFinite(t)?Math.max(0,Math.min(100,Math.round(t*100))):0}function Sw(t){const a=Ve;if(t.xpForNext===null)return`${a.format(t.xp)} XP • Max level`;const s=dv(t.progress);return`${a.format(t.xpIntoLevel)} / ${a.format(t.xpForNext)} XP • ${s}%`}function fv(t){const a=[],s=(r,l)=>{l>0&&a.push(`+${Ve.format(l)} ${r}`)};return s("Vigor",t.vigor),s("Focus",t.focus),s("Resolve",t.resolve),a.length===0?"No level bonuses yet":a.join(" • ")}function Ks(t,a){const r=Math.round(t-(typeof a=="number"?a:0));if(r===0)return"";const l=Ve.format(Math.abs(r));return r>0?` (+${l})`:` (-${l})`}function Ew(t){if(!t)return"No stat changes";const a=[],s=(r,l)=>{if(typeof l=="number"&&l!==0){const u=l>0?"+":"−";a.push(`${r} ${u}${Ve.format(Math.abs(l))}`)}};return s("HP",t.health),s("ATK",t.attackDamage),s("RNG",t.attackRange),s("MOV",t.movementRange),s("DEF",t.defense),s("Shield",t.shield),a.length===0?"No stat changes":a.join(", ")}function Mw(t){const{stats:a,baseStats:s}=t,r=[`HP ${Ve.format(a.health)}/${Ve.format(a.maxHealth)}${Ks(a.maxHealth,s.maxHealth)}`];return a.shield&&a.shield>0&&r.push(`Shield ${Ve.format(a.shield)}${Ks(a.shield,s.shield)}`),r.push(`ATK ${Ve.format(a.attackDamage)}${Ks(a.attackDamage,s.attackDamage)}`),r.push(`RNG ${Ve.format(a.attackRange)}${Ks(a.attackRange,s.attackRange)}`),a.defense&&a.defense>0&&r.push(`DEF ${Ve.format(a.defense)}${Ks(a.defense,s.defense)}`),r.push(`MOV ${Ve.format(a.movementRange)}${Ks(a.movementRange,s.movementRange)}`),r.push(`Upkeep ${Ve.format(t.upkeep)} beer`),r.join(" • ")}function xw(t){const{stats:a}=t,s=[t.name,Fh[t.status]];s.push(`level ${t.progression.level}`),s.push(`health ${Ve.format(a.health)} of ${Ve.format(a.maxHealth)}`),a.shield&&a.shield>0&&s.push(`shield ${Ve.format(a.shield)}`),s.push(`attack ${Ve.format(a.attackDamage)}`),a.defense&&a.defense>0&&s.push(`defense ${Ve.format(a.defense)}`),a.attackRange>0&&s.push(`attack range ${Ve.format(a.attackRange)}`),s.push(`movement ${Ve.format(a.movementRange)}`),s.push(`upkeep ${Ve.format(t.upkeep)} beer`),t.progression.xpForNext===null?s.push(`${Ve.format(t.progression.xp)} total experience`):s.push(`${Ve.format(t.progression.xpIntoLevel)} of ${Ve.format(t.progression.xpForNext)} experience toward next level`);const r=fv(t.progression.statBonuses);r&&s.push(`level bonuses ${r}`);const l=t.equipment.filter(u=>u.item).length;return l>0&&s.push(`${l} equipped item${l===1?"":"s"}`),t.modifiers.length>0&&s.push(`${t.modifiers.length} active modifier${t.modifiers.length===1?"":"s"}`),s.join(", ")}function ww(t,a){const s=a.filter(h=>h.status==="engaged").length,r=a.filter(h=>h.status==="reserve").length,l=a.filter(h=>h.status==="downed").length,u=(h,m,p)=>{const g=document.createElement("span");return g.classList.add("panel-roster__metric"),g.dataset.status=p,g.textContent=`${Ve.format(m)} ${h}`,g.setAttribute("aria-label",g.textContent),g},f=document.createElement("div");f.classList.add("panel-roster__metrics"),f.append(u("engaged",s,"engaged"),u("reserve",r,"reserve"),u("downed",l,"downed")),t.appendChild(f)}function Aw(t,a,s){const r=document.createElement("div");r.classList.add("panel-roster__loadout");const l=document.createElement("ul");l.classList.add("panel-roster__slots"),l.setAttribute("role","list"),l.setAttribute("aria-label",`${a.name} equipment slots`);for(const u of a.equipment){const f=document.createElement("li");f.classList.add("panel-roster__slot"),f.dataset.slot=u.id;const h=document.createElement("div");h.classList.add("panel-roster__slot-header");const m=document.createElement("span");m.classList.add("panel-roster__slot-label"),m.textContent=u.label,m.title=u.description,h.appendChild(m);const p=document.createElement("span");if(p.classList.add("panel-roster__slot-summary"),p.textContent=u.item?u.item.name:"Empty",p.title=u.description,h.appendChild(p),f.appendChild(h),u.item){const M=document.createElement("ul");M.classList.add("panel-roster__slot-icons"),M.setAttribute("role","list"),M.appendChild(pw(u.item)),f.appendChild(M)}const g=document.createElement("span");g.classList.add("panel-roster__slot-modifiers"),g.textContent=Ew(u.modifiers),g.title=g.textContent,f.appendChild(g);const y=document.createElement("div");y.classList.add("panel-roster__slot-actions");const v=document.createElement("button");v.type="button",v.classList.add("panel-roster__slot-action"),v.textContent=u.item?"Replace":"Equip",v.setAttribute("aria-label",`Equip ${u.label} for ${a.name}`),v.addEventListener("click",M=>{M.stopPropagation(),s.onEquipSlot?.(a.id,u.id)}),y.appendChild(v);const S=document.createElement("button");S.type="button",S.classList.add("panel-roster__slot-action"),S.textContent="Unequip",S.disabled=u.item===null,S.setAttribute("aria-label",`Unequip ${u.label} from ${a.name}`),S.addEventListener("click",M=>{M.stopPropagation(),S.disabled||s.onUnequipSlot?.(a.id,u.id)}),y.appendChild(S),f.appendChild(y),l.appendChild(f)}if(r.appendChild(l),a.modifiers.length>0){const u=document.createElement("ul");u.classList.add("panel-roster__mods"),u.setAttribute("role","list"),u.setAttribute("aria-label",`${a.name} active modifiers`),u.title=a.modifiers.map(f=>f.name).join(", ");for(const f of a.modifiers)u.appendChild(bw(f));r.appendChild(u)}t.appendChild(r)}function Cw(t,a={}){return{render:r=>{t.innerHTML="",t.dataset.count=String(r.length),t.classList.add("panel-roster");const l=document.createElement("div");l.classList.add("panel-roster__header");const u=document.createElement("h4");u.classList.add("panel-roster__title"),u.textContent="Battalion Roster",u.id=Mb,l.appendChild(u),t.setAttribute("aria-labelledby",Mb);const f=r.length===0?"No attendants mustered yet":`${Ve.format(r.length)} attendant${r.length===1?"":"s"} enlisted`,h=document.createElement("span");if(h.classList.add("panel-roster__count"),h.textContent=f,l.appendChild(h),t.appendChild(l),(()=>{if(typeof a.getRosterCapLimit!="function"||typeof a.getRosterCap!="function")return;const g=document.createElement("section");g.classList.add("panel-roster__cap");const y=document.createElement("div");y.classList.add("panel-roster__cap-header");const v=document.createElement("span");v.classList.add("panel-roster__cap-title"),v.textContent="Roster Cap",y.appendChild(v);const S=document.createElement("span");S.classList.add("panel-roster__cap-value"),S.setAttribute("aria-live","polite"),y.appendChild(S),g.appendChild(y);const M=document.createElement("p");M.classList.add("panel-roster__cap-description"),M.textContent="Tune how many attendants rally before new recruits await the steam.",g.appendChild(M);const _=`panel-roster-cap-${Math.floor(Math.random()*1e5)}`,T=document.createElement("label");T.classList.add("panel-roster__cap-label"),T.htmlFor=_,T.textContent="Active attendants";const N=document.createElement("input");N.type="range",N.id=_,N.min="0",N.step="1",N.classList.add("panel-roster__cap-slider"),N.setAttribute("aria-label","Roster cap");const O=document.createElement("input");O.type="number",O.min="0",O.step="1",O.inputMode="numeric",O.classList.add("panel-roster__cap-number");const B=document.createElement("div");B.classList.add("panel-roster__cap-controls"),B.append(T,N,O),g.appendChild(B);const Y=()=>{const F=a.getRosterCapLimit?.();return typeof F!="number"||!Number.isFinite(F)?0:Math.max(0,Math.floor(F))},X=()=>{const F=a.getRosterCap?.();return typeof F!="number"||!Number.isFinite(F)?0:Math.max(0,Math.floor(F))},V=(F,H)=>{const C=Math.max(0,Math.min(F,Math.floor(H))),J=Ve.format(C);N.max=String(F),N.value=String(C),N.setAttribute("aria-valuemin","0"),N.setAttribute("aria-valuemax",N.max),N.setAttribute("aria-valuenow",N.value),O.max=String(F),O.value=String(C),O.setAttribute("aria-label",`Roster cap set to ${J}`);const I=C===0?"Paused":J;S.textContent=I,S.dataset.state=C===0?"paused":"active"},W=typeof a.updateMaxRosterSize=="function";N.disabled=!W,O.disabled=!W;const ne=(F,H)=>{const C=Y(),J=Math.max(0,Math.min(C,Number.isFinite(F)?Math.floor(F):0));let I=J;W&&(I=a.updateMaxRosterSize(J,{persist:H})),V(C,I)};if(V(Y(),X()),W){N.addEventListener("input",()=>{ne(Number(N.value),!1)}),N.addEventListener("change",()=>{ne(Number(N.value),!0)});const F=H=>{ne(Number(O.value),H)};O.addEventListener("input",()=>F(!1)),O.addEventListener("change",()=>F(!0)),O.addEventListener("blur",()=>F(!0))}t.appendChild(g)})(),r.length===0){const g=document.createElement("p");g.classList.add("panel-roster__empty"),g.textContent="No attendants have rallied to the sauna yet.",t.appendChild(g);return}ww(t,r);const p=document.createElement("ul");p.classList.add("panel-roster__list"),p.setAttribute("role","list");for(const g of r){const y=document.createElement("li");y.classList.add("panel-roster__row");const v=document.createElement("button");v.type="button",v.classList.add("panel-roster__item"),v.dataset.unitId=g.id,v.dataset.status=g.status,v.setAttribute("aria-pressed",g.selected?"true":"false"),v.setAttribute("aria-label",xw(g)),v.title=`${g.name} • ${Fh[g.status]}`,g.selected&&v.classList.add("is-selected"),g.status==="downed"&&v.classList.add("is-downed");const S=document.createElement("div");S.classList.add("panel-roster__name-row");const M=document.createElement("div");M.classList.add("panel-roster__identity");const _=document.createElement("span");_.classList.add("panel-roster__level"),_.dataset.level=String(g.progression.level),_.style.setProperty("--level-progress","0%");const T=dv(g.progression.progress);_.style.setProperty("--level-progress",`${T}%`),_.setAttribute("role","img");const N=g.progression.xpForNext===null?`Level ${g.progression.level}, at mastery`:`Level ${g.progression.level}, ${T}% toward next level`;_.setAttribute("aria-label",N);const O=document.createElement("span");O.classList.add("panel-roster__level-value"),O.textContent=String(g.progression.level),_.appendChild(O);const B=document.createElement("span");B.classList.add("panel-roster__name"),B.textContent=g.name,B.title=g.name,M.append(_,B),S.appendChild(M);const Y=document.createElement("span");Y.classList.add("panel-roster__status"),Y.dataset.status=g.status,Y.textContent=Fh[g.status],S.appendChild(Y);const X=document.createElement("div");X.classList.add("panel-roster__meta");const V=Mw(g);X.textContent=V,X.title=V;const W=document.createElement("div");W.classList.add("panel-roster__xp");const ne=Sw(g.progression);W.textContent=ne,W.title=ne;const F=document.createElement("div");F.classList.add("panel-roster__callouts");const H=fv(g.progression.statBonuses);F.textContent=H,F.title=H;const C=document.createElement("div");C.classList.add("panel-roster__health");const J=document.createElement("div");J.classList.add("panel-roster__health-fill");const I=g.stats.maxHealth>0?Math.max(0,Math.min(100,Math.round(g.stats.health/g.stats.maxHealth*100))):0;J.style.width=`${I}%`,J.dataset.percent=`${I}`,C.appendChild(J);const ae=document.createElement("div");ae.classList.add("panel-roster__traits");const $=vw(g.traits);ae.textContent=$,ae.title=$,v.append(S,W,X,F,C,ae),Aw(v,g,a),typeof a.onSelect=="function"&&v.addEventListener("click",()=>a.onSelect?.(g.id)),y.appendChild(v),p.appendChild(y)}t.appendChild(p)}}}const _w=150,Tw="autobattles:log-history:v2",hv="autobattles:log-preferences:v1",Tm=typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:null;let xb=0;const wb=()=>(xb+=1,`${Date.now().toString(36)}-${xb.toString(36)}`),wo=t=>{if(Array.isArray(t))return t.map(a=>typeof a=="string"?a.trim():"").filter(a=>a.length>0);if(typeof t=="string"){const a=t.trim();return a?[a]:[]}return[]},ih=t=>t?typeof t!="object"?{}:{...t}:{},Rw=t=>{if(!t)return null;if(typeof t.unitId=="string"&&t.unitId.trim().length>0)return t.unitId.trim();const a=wo(t.unitIds);return a.length>0?a[a.length-1]:null},Nw=(t,a)=>{const s=wo(t.unitIds??t.unitId),r=wo(a.unitIds??a.unitId),l=Array.from(new Set([...s,...r])),u=wo(t.unitNames??t.unitName),f=wo(a.unitNames??a.unitName),h=Array.from(new Set([...u,...f])),m=typeof a.steward=="string"?a.steward:t.steward,p={...t,...a,unitIds:l,unitNames:h};return typeof m=="string"&&(p.steward=m),h.length>0&&(p.unitName=h[h.length-1]),l.length>0&&(p.unitId=l[l.length-1]),p};class kw{history=[];listeners=new Set;storage;storageKey;maxEntries;constructor(a={}){this.storage=a.storage??Tm,this.storageKey=a.storageKey??Tw,this.maxEntries=Math.max(1,a.maxEntries??_w),this.hydrate()}hydrate(){if(this.storage)try{const a=this.storage.getItem(this.storageKey);if(!a)return;const s=JSON.parse(a);if(!Array.isArray(s))return;const r=[];for(const l of s){if(!l||typeof l!="object")continue;const u=l;if(typeof u.type!="string"||typeof u.message!="string")continue;const f={id:typeof u.id=="string"?u.id:wb(),type:u.type,message:u.message,metadata:ih(u.metadata),timestamp:typeof u.timestamp=="number"&&Number.isFinite(u.timestamp)?u.timestamp:Date.now(),occurrences:typeof u.occurrences=="number"&&u.occurrences>0?Math.floor(u.occurrences):1};r.push(f)}r.length>0&&(r.length>this.maxEntries?this.history=r.slice(-this.maxEntries):this.history=r)}catch{this.history=[]}}persist(){if(this.storage)try{const a=JSON.stringify(this.history.map(s=>({id:s.id,type:s.type,message:s.message,metadata:s.metadata,timestamp:s.timestamp,occurrences:s.occurrences})));this.storage.setItem(this.storageKey,a)}catch{}}getHistory(){return this.history.map(a=>({...a,metadata:ih(a.metadata)}))}subscribe(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}clear(){if(this.history.length===0)return;const a=this.history.slice();this.history=[],this.persist(),this.emitChange({kind:"remove",entries:a})}emit(a){const s=ih(a.metadata),r={id:wb(),type:a.type,message:a.message,metadata:s,timestamp:Date.now(),occurrences:1},l=this.tryAggregate(r);if(l)return this.history[l.index]=l.entry,this.persist(),this.emitChange({kind:"update",entry:l.entry,index:l.index}),l.entry;this.history.push(r);const u=[];for(;this.history.length>this.maxEntries;){const h=this.history.shift();h&&u.push(h)}this.persist(),u.length>0&&this.emitChange({kind:"remove",entries:u});const f=this.history.length-1;return this.emitChange({kind:"append",entry:r,index:f}),r}tryAggregate(a){if(a.type!=="spawn"||!Rw(a.metadata)||this.history.length===0)return null;const r=this.history.length-1,l=this.history[r];return l.type!=="spawn"?null:{entry:{...l,id:l.id,message:a.message,metadata:Nw(l.metadata??{},a.metadata??{}),timestamp:a.timestamp,occurrences:l.occurrences+a.occurrences},index:r}}emitChange(a){for(const s of this.listeners)try{s(a)}catch(r){console.warn("Failed to handle log change",r)}}}const Rm=new kw,Lt=t=>Rm.emit(t),Dw=t=>Rm.subscribe(t),Lw=()=>Rm.getHistory(),ko={combat:{label:"Combat",accent:"var(--color-accent-red)"},spawn:{label:"Reinforcements",accent:"var(--color-accent-green)"},loot:{label:"Loot",accent:"var(--color-accent-gold)"},progression:{label:"Progression",accent:"var(--color-accent-blue)"},ability:{label:"Abilities",accent:"var(--color-accent-purple)"},resource:{label:"Economy",accent:"var(--color-accent-cyan)"},policy:{label:"Policies",accent:"var(--color-accent-orange)"},event:{label:"Events",accent:"var(--color-accent-pink)"},system:{label:"Systems",accent:"var(--color-muted)"}},Ab=["combat","spawn","loot","progression","ability","resource","policy","event","system"],Mc={mutedTypes:[]},Uw=(t=Tm)=>{if(!t)return{...Mc};try{const a=t.getItem(hv);if(!a)return{...Mc};const s=JSON.parse(a);if(!s||typeof s!="object")return{...Mc};const r=Array.isArray(s.mutedTypes)?s.mutedTypes.filter(l=>typeof l=="string"&&l in ko):[];return{mutedTypes:Array.from(new Set(r))}}catch{return{...Mc}}},Ow=(t,a=Tm)=>{if(a)try{const s=Array.isArray(t.mutedTypes)?t.mutedTypes.filter(r=>r in ko):[];a.setItem(hv,JSON.stringify({mutedTypes:Array.from(new Set(s))}))}catch{}},sh=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function qw(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{log:()=>{},addEvent:()=>{},renderRoster:()=>{},dispose:()=>{}};const{regions:r,mobileBar:l}=hr(s),u=r.top,f=r.right,h=s.querySelector("#right-panel");h&&h.remove();const m=s.querySelector(".right-panel-slide");m&&m.remove();const p=s.querySelector("#right-panel-toggle");p&&p.remove();const g=document.createElement("div");g.id="right-panel",g.classList.add("hud-card"),g.setAttribute("role","complementary"),g.setAttribute("aria-label","Sauna command console"),g.tabIndex=-1;const y=document.createElement("div");y.className="right-panel-slide",y.setAttribute("aria-hidden","true");const v=document.createElement("div");v.className="right-panel-slide__backdrop",v.setAttribute("aria-hidden","true");const S=document.createElement("div");S.className="right-panel-slide__sheet",S.appendChild(g),y.append(v,S);const M=window.matchMedia("(max-width: 1040px)"),_=[],T=document.createElement("button");T.type="button",T.id="right-panel-toggle",T.classList.add("hud-panel-toggle"),T.setAttribute("aria-controls",g.id);const N=document.createElement("span");N.classList.add("hud-panel-toggle__icon"),N.setAttribute("aria-hidden","true");const O=document.createElement("span");O.classList.add("hud-panel-toggle__icon-bars"),N.appendChild(O);const B=document.createElement("span");B.classList.add("hud-panel-toggle__text");const Y=document.createElement("span");Y.classList.add("hud-panel-toggle__title"),Y.textContent="Command Console";const X=document.createElement("span");X.classList.add("hud-panel-toggle__state"),B.append(Y,X),T.append(N,B);const V=()=>{const k=u.querySelector("#topbar");k&&k.parentElement===u?k.insertAdjacentElement("afterend",T):u.prepend(T)};let W=!1,ne=!1,F=!1,H=!1;const C="is-mobile-panel-open",J=()=>{F?X.textContent=H?"Close":"Menu":X.textContent=W?"Open":"Close"},I=()=>{if(F){T.setAttribute("aria-expanded",H?"true":"false");const k=H?"Close command console panel":"Open command console panel";T.setAttribute("aria-label",k),T.title=H?"Close the sauna command console overlay":"Open the sauna command console overlay"}else{T.setAttribute("aria-expanded",W?"false":"true");const k=W?"Open command console panel":"Close command console panel";T.setAttribute("aria-label",k),T.title=W?"Open the sauna command console overlay":"Close the sauna command console overlay"}},ae=()=>{J(),I()},$=(k,Q=M.matches)=>{if(F)return;const ce=W;Q&&(ne=k);const me=k&&Q;W=me,g.classList.toggle("right-panel--collapsed",me),g.setAttribute("aria-hidden",me?"true":"false"),ae(),ce&&!me&&Q&&g.focus({preventScroll:!0})},L=k=>{!F||!H||k.key==="Escape"&&(k.preventDefault(),w())};let P=!1;const le=()=>{P||(document.addEventListener("keydown",L),P=!0)},ee=()=>{P&&(document.removeEventListener("keydown",L),P=!1)},x=()=>{!F||H||(H=!0,y.classList.add("right-panel-slide--open"),y.setAttribute("aria-hidden","false"),g.setAttribute("aria-hidden","false"),document.body.classList.add(C),y.style.setProperty("--panel-drag-progress","1"),ae(),le(),requestAnimationFrame(()=>{g.focus({preventScroll:!0})}))},w=({skipFocus:k=!1}={})=>{!F||!H||(ge(),H=!1,y.classList.remove("right-panel-slide--open"),y.setAttribute("aria-hidden","true"),g.setAttribute("aria-hidden","true"),document.body.classList.remove(C),y.style.setProperty("--panel-drag-progress","0"),ae(),ee(),k||T.focus({preventScroll:!0}))},z=k=>{if(F)return;const Q=k.matches;T.hidden=!Q,$(Q?ne:!1,Q)};typeof M.addEventListener=="function"?(M.addEventListener("change",z),_.push(()=>M.removeEventListener("change",z))):(M.addListener(z),_.push(()=>M.removeListener(z)));const K=()=>{if(F){H?w():x();return}$(!W)};T.addEventListener("click",K),_.push(()=>T.removeEventListener("click",K));const oe=()=>{w()};v.addEventListener("click",oe),_.push(()=>v.removeEventListener("click",oe));let de=null,ue=0,ve=0;const ge=()=>{de!==null&&(S.releasePointerCapture(de),de=null),S.style.transition="",S.style.transform="",y.style.setProperty("--panel-drag-progress",H?"1":"0")},et=k=>{!F||!H||k.pointerType==="mouse"&&k.button!==0||(de=k.pointerId,ue=k.clientX,ve=0,S.style.transition="none",S.setPointerCapture(k.pointerId))},Ot=k=>{if(!F||k.pointerId!==de||!H)return;ve=Math.max(0,k.clientX-ue);const Q=S.offsetWidth||1,ce=Math.min(ve,Q);S.style.transform=`translateX(${ce}px)`,y.style.setProperty("--panel-drag-progress",String(1-ce/Q))},qt=k=>{ge(),k&&w()},An=k=>{if(k.pointerId!==de)return;const Q=S.offsetWidth||1,ce=ve>Q*.35;qt(ce)},Bn=()=>{qt(!1)};S.addEventListener("pointerdown",et),S.addEventListener("pointermove",Ot),S.addEventListener("pointerup",An),S.addEventListener("pointercancel",Bn),_.push(()=>{S.removeEventListener("pointerdown",et),S.removeEventListener("pointermove",Ot),S.removeEventListener("pointerup",An),S.removeEventListener("pointercancel",Bn)});const ja=uv(k=>{F=k,F?(S.appendChild(g),y.isConnected||s.appendChild(y),l.appendChild(T),T.classList.add("hud-panel-toggle--mobile"),T.hidden=!1,H||(g.setAttribute("aria-hidden","true"),y.setAttribute("aria-hidden","true"),y.style.setProperty("--panel-drag-progress","0"))):(w({skipFocus:!0}),y.style.setProperty("--panel-drag-progress","1"),y.remove(),f.appendChild(g),V(),T.classList.remove("hud-panel-toggle--mobile"),T.hidden=!M.matches,g.setAttribute("aria-hidden","false"),$(ne,M.matches)),ae()});_.push(ja);const la=document.createElement("div");la.classList.add("panel-tabs"),g.appendChild(la);const dn=document.createElement("div");dn.classList.add("panel-content"),g.appendChild(dn);const fe=document.createElement("div");fe.id="right-panel-roster",fe.setAttribute("role","region"),fe.setAttribute("aria-live","polite"),fe.setAttribute("aria-label","Battalion roster");const Te=document.createElement("div");Te.id="right-panel-policies";const Ge=document.createElement("div");Ge.id="right-panel-events";const ze=document.createElement("div");ze.id="right-panel-log",ze.setAttribute("role","region"),ze.setAttribute("aria-label","Combat log");const vt=document.createElement("section");vt.className="panel-log";const fn=document.createElement("header");fn.className="panel-log__header";const Zt=document.createElement("h3");Zt.className="panel-log__title",Zt.textContent="Combat Log";const Cn=document.createElement("span");Cn.className="panel-log__total",Cn.textContent="0 entries",fn.append(Zt,Cn);const ca=document.createElement("div");ca.className="panel-log__filters";const Ke=document.createElement("div");Ke.id="event-log",Ke.className="panel-log__feed",Ke.setAttribute("role","log"),Ke.setAttribute("aria-live","polite"),vt.append(fn,ca,Ke),ze.appendChild(vt);const Pe={Roster:fe,Policies:Te,Events:Ge,Log:ze},{onRosterSelect:Yt,onRosterRendererReady:Tt,onRosterEquipSlot:Ru,onRosterUnequipSlot:Nu}=a;for(const[k,Q]of Object.entries(Pe))Q.classList.add("panel-section","panel-section--scroll"),Q.dataset.tab=k,Q.hidden=!0;ze.classList.add("panel-section--log");function Yo(k){for(const[Q,ce]of Object.entries(Pe))ce.hidden=Q!==k;for(const Q of Array.from(la.children)){const ce=Q,me=ce.textContent===k;ce.disabled=me,ce.setAttribute("aria-pressed",me?"true":"false")}}for(const k of Object.keys(Pe)){const Q=document.createElement("button");Q.type="button",Q.textContent=k;const ce=Pe[k];ce?.id&&Q.setAttribute("aria-controls",ce.id),Q.setAttribute("aria-pressed","false");const me=()=>Yo(k);Q.addEventListener("click",me),_.push(()=>Q.removeEventListener("click",me)),la.appendChild(Q),dn.appendChild(Pe[k])}const cs=Cw(fe,{onSelect:Yt,onEquipSlot:Ru,onUnequipSlot:Nu,getRosterCap:a.getRosterCap,getRosterCapLimit:a.getRosterCapLimit,updateMaxRosterSize:a.updateMaxRosterSize}),Ga=k=>{cs.render(k)};Ga([]),typeof Tt=="function"&&Tt(Ga);const Hn={[re.SAUNA_BEER]:"Sauna Beer Bottles",[re.SAUNAKUNNIA]:"Saunakunnia",[re.SISU]:"Sisu"},xi=p2(),ua=new Map;function ku(k){const Q=document.createElement("span");return Q.className="policy-card__badge",Q.textContent=k,Q}function Vo(k){const Q=document.createElement("article");Q.className="policy-card",Q.style.setProperty("--policy-gradient",k.visuals.gradient),Q.style.setProperty("--policy-accent",k.visuals.accentColor);const ce=document.createElement("div");ce.className="policy-card__header";const me=document.createElement("div");me.className="policy-card__icon-frame";const Re=document.createElement("img");Re.className="policy-card__icon",Re.src=k.visuals.icon,Re.alt=`${k.name} icon`,me.appendChild(Re);const Fe=document.createElement("div");Fe.className="policy-card__heading";const _e=document.createElement("h4");if(_e.className="policy-card__title",_e.textContent=k.name,Fe.appendChild(_e),k.visuals.badges?.length){const Fn=document.createElement("div");Fn.className="policy-card__badges",k.visuals.badges.forEach(al=>Fn.appendChild(ku(al))),Fe.appendChild(Fn)}const at=document.createElement("span");at.className="policy-card__state",at.textContent="Ready",ce.append(me,Fe,at);const Jt=document.createElement("p");Jt.className="policy-card__description",Jt.textContent=k.description;const St=k.visuals.flair?(()=>{const Fn=document.createElement("p");return Fn.className="policy-card__flair",Fn.textContent=k.visuals.flair??"",Fn})():null,Wt=document.createElement("div");Wt.className="policy-card__actions";const en=document.createElement("span");en.className="policy-card__cost";const Ti=document.createElement("span");Ti.className="policy-card__cost-label",Ti.textContent="Cost";const ht=document.createElement("span");ht.className="policy-card__cost-value",ht.textContent=`${sh.format(k.cost)} ${Hn[k.resource]}`,en.append(Ti,ht);const it=document.createElement("button");it.type="button",it.className="policy-card__action",it.textContent="Enact Policy";const Va=document.createElement("p");Va.className="policy-card__status";const Xa=document.createElement("ul");Xa.className="policy-card__requirements",Xa.hidden=!0,Wt.append(en,it);const pa=()=>{t.applyPolicy(k.id)&&us(k)};return it.addEventListener("click",pa),_.push(()=>it.removeEventListener("click",pa)),Q.append(ce,Jt),St&&Q.appendChild(St),Q.append(Wt,Va,Xa),ua.set(k.id,{card:Q,action:it,stateBadge:at,statusCopy:Va,requirements:Xa,costChip:en}),Q}function Xo(){Te.innerHTML="",ua.clear();const k=document.createElement("div");k.className="policy-grid",xi.forEach(Q=>{const ce=Vo(Q);k.appendChild(ce)}),Te.appendChild(k),In()}function us(k){const Q=ua.get(k.id);if(!Q)return;const ce=t.hasPolicy(k.id),me=k.prerequisites.filter(St=>!St.isSatisfied(t)),Re=t.canAfford(k.cost,k.resource);Q.action.disabled=ce||me.length>0||!Re,Q.action.textContent=ce?"Enacted":"Enact Policy";let Fe="ready",_e="Ready",at=k.spotlight??"All signals point to go.";Q.requirements.innerHTML="",Q.requirements.hidden=!0,ce?(Fe="applied",_e="Enacted",at=k.visuals.flair??"Policy active."):me.length>0?(Fe="locked",_e="Locked",at="Awaiting requirements:",Q.requirements.hidden=!1,me.forEach(St=>{const Wt=document.createElement("li");Wt.textContent=St.description,Q.requirements.appendChild(Wt)})):Re||(Fe="budget",_e="Needs Resources",at=`Earn ${sh.format(k.cost)} ${Hn[k.resource]} to enact this edict.`),Q.card.dataset.status=Fe,Q.stateBadge.textContent=_e,Q.statusCopy.textContent=at;const Jt=!ce&&me.length===0&&!Re;Q.costChip.classList.toggle("policy-card__cost--warning",Jt)}function In(){xi.forEach(k=>us(k))}Xo();const Ko=k=>In(),mr=k=>In(),pr=k=>In();se.on("resourceChanged",Ko),se.on(Gt.APPLIED,mr),se.on(Gt.REJECTED,pr),_.push(()=>{se.off("resourceChanged",Ko),se.off(Gt.APPLIED,mr),se.off(Gt.REJECTED,pr)});function gr(k,Q){const ce=document.createElement("button");ce.type="button",ce.classList.add("event-card__choice"),Q.accent&&ce.classList.add(`event-card__choice--${Q.accent}`),ce.dataset.choiceId=Q.id;const me=document.createElement("span");if(me.className="event-card__choice-label",me.textContent=Q.label,ce.appendChild(me),Q.description){const Re=document.createElement("span");Re.className="event-card__choice-detail",Re.textContent=Q.description,ce.appendChild(Re)}return ce.addEventListener("click",()=>{if(!ce.isConnected)return;ce.disabled=!0,Co.resolve(k.id,Q.id)||(ce.disabled=!1)}),ce}function yr(k){if(Ge.innerHTML="",k.length===0){const ce=document.createElement("div");ce.className="event-card event-card--empty";const me=document.createElement("p");me.className="event-card__empty",me.textContent="All clear. Command will notify you when new briefings arrive.",ce.appendChild(me),Ge.appendChild(ce);return}const Q=document.createDocumentFragment();for(const ce of k){const me=document.createElement("article");me.className="event-card",me.dataset.eventId=ce.id,me.style.setProperty("--event-accent",ce.accentColor??"var(--color-accent)");const Re=(ce.typography??"sans").toLowerCase();me.classList.add(`event-card--${["serif","mono"].includes(Re)?Re:"sans"}`);const Fe=(ce.animation??"").toLowerCase();["aurora","pulse","tilt"].includes(Fe)&&me.classList.add(`event-card--${Fe}`);const _e=document.createElement("div");if(_e.className="event-card__frame",ce.art){const it=document.createElement("div");it.className="event-card__media",it.style.backgroundImage=`url(${ce.art})`,_e.appendChild(it)}const at=document.createElement("div");at.className="event-card__body";const Jt=document.createElement("span");Jt.className="event-card__badge",Jt.textContent="Priority Dispatch",at.appendChild(Jt);const St=document.createElement("h4");St.className="event-card__headline",St.textContent=ce.headline,at.appendChild(St);const Wt=document.createElement("p");Wt.className="event-card__copy",Wt.textContent=ce.body,at.appendChild(Wt);const en=document.createElement("div");en.className="event-card__choices";const Ti=ce.choices&&ce.choices.length>0?ce.choices:[{id:"acknowledge",label:ce.acknowledgeText??"Acknowledge"}];for(const it of Ti){const Va=gr(ce,{id:it.id,label:it.label,description:it.description,event:it.event,payload:it.payload,accent:it.accent});en.appendChild(Va)}at.appendChild(en),_e.appendChild(at);const ht=document.createElement("span");ht.className="event-card__shimmer",me.append(_e,ht),Q.appendChild(me)}Ge.appendChild(Q)}const Qo=Co.subscribe(yr);_.push(Qo);const Po=({event:k})=>{Lt({type:"event",message:`Event • ${k.headline}`,metadata:{eventId:k?.id??k.headline,headline:k.headline}})};se.on(Fc.TRIGGERED,Po),_.push(()=>{se.off(Fc.TRIGGERED,Po)});function jn(k){Co.publish(k)}const tt=new Map,ft=new Map,da=new Map,Fa=new Set(Uw().mutedTypes??[]),_n=new Set;for(const k of Ab)Fa.has(k)||_n.add(k),ft.set(k,0);let ds=0,wi=!0;const Ai=typeof requestAnimationFrame=="function"?requestAnimationFrame:k=>setTimeout(k,16),fs=k=>sh.format(Math.max(0,k)),fa=()=>{const k=ds===1?"entry":"entries";Cn.textContent=`${fs(ds)} ${k}`},$a=k=>{const Q=da.get(k);Q&&(Q.textContent=fs(ft.get(k)??0))},ha=(k,Q)=>{if(Q===0)return;const ce=ft.get(k)??0;ft.set(k,Math.max(0,ce+Q)),ds=Math.max(0,ds+Q),$a(k),fa()},ma=()=>Ke.scrollHeight-(Ke.scrollTop+Ke.clientHeight)<48,nt=()=>{Ai(()=>{Ke.scrollTop=Ke.scrollHeight,wi=!0})},hs=k=>{const Q=_n.has(k.type);k.element.hidden=!Q,k.element.classList.toggle("panel-log-entry--muted",!Q)},Zo=k=>{const Q=k.metadata??{};return(Array.isArray(Q.unitNames)?Q.unitNames:typeof Q.unitName=="string"?[Q.unitName]:[]).map(me=>typeof me=="string"?me.trim():"").filter(me=>me.length>0)},Gn=(k,Q)=>{if(Q.type!=="spawn"){k.replaceChildren(),k.hidden=!0;return}const ce=Zo(Q),me=ce.map(Fe=>{const _e=document.createElement("span");return _e.className="panel-log-entry__token",_e.textContent=Fe,_e}),Re=Q.occurrences-ce.length;if(Re>0){const Fe=document.createElement("span");Fe.className="panel-log-entry__token panel-log-entry__token--more",Fe.textContent=`+${Re}`,me.push(Fe)}me.length===0?(k.replaceChildren(),k.hidden=!0):(k.replaceChildren(...me),k.hidden=!1)},Ya=k=>{const Q=document.createElement("article");Q.className="panel-log-entry",Q.dataset.logType=k.type,Q.style.setProperty("--log-entry-accent",ko[k.type]?.accent??"var(--color-accent)");const ce=document.createElement("div");ce.className="panel-log-entry__header";const me=document.createElement("span");me.className="panel-log-entry__type",me.textContent=ko[k.type]?.label??k.type;const Re=document.createElement("span");Re.className="panel-log-entry__badge";const Fe=document.createElement("p");Fe.className="panel-log-entry__message",Fe.textContent=k.message;const _e=document.createElement("div");_e.className="panel-log-entry__tokens",_e.hidden=!0,ce.append(me,Re),Q.append(ce,Fe,_e);const at=St=>{St<=1?(Re.textContent="",Re.hidden=!0):(Re.hidden=!1,Re.textContent=`×${St}`)},Jt={element:Q,type:k.type,occurrences:k.occurrences,badge:Re,message:Fe,tokens:_e,setBadge:at};return at(k.occurrences),Gn(_e,k),Jt},Jo=(k,Q=!1)=>{const ce=Q?!0:ma()||wi,me=Ya(k);tt.set(k.id,me),Ke.appendChild(me.element),ha(me.type,me.occurrences),hs(me),ce&&nt()},Wo=k=>{const Q=tt.get(k.id);if(!Q)return;const ce=k.occurrences-Q.occurrences;ce!==0&&(Q.occurrences=k.occurrences,ha(Q.type,ce)),Q.message.textContent=k.message,Q.setBadge(k.occurrences),Q.tokens&&Gn(Q.tokens,k),hs(Q),wi&&nt()},el=k=>{const Q=tt.get(k.id);Q&&(tt.delete(k.id),ha(Q.type,-Q.occurrences),Q.element.parentElement===Ke&&Ke.removeChild(Q.element))},tl=()=>{for(const k of tt.values())hs(k)};for(const k of Ab){const Q=ko[k],ce=document.createElement("button");ce.type="button",ce.className="log-chip",ce.dataset.logFilter=k,ce.style.setProperty("--log-chip-accent",Q?.accent??"var(--color-accent)"),ce.setAttribute("aria-pressed",_n.has(k)?"true":"false"),ce.setAttribute("aria-label",`${Q?.label??k} log filter`);const me=document.createElement("span");me.className="log-chip__label",me.textContent=Q?.label??k;const Re=document.createElement("span");Re.className="log-chip__count",Re.textContent="0",da.set(k,Re),_n.has(k)||ce.classList.add("is-muted"),ce.append(me,Re),ca.appendChild(ce),ce.addEventListener("click",()=>{_n.has(k)?(_n.delete(k),Fa.add(k)):(_n.add(k),Fa.delete(k)),ce.classList.toggle("is-muted",!_n.has(k)),ce.setAttribute("aria-pressed",_n.has(k)?"true":"false"),Ow({mutedTypes:Array.from(Fa)}),tl()})}fa();const Ci=()=>{wi=ma()};Ke.addEventListener("scroll",Ci,{passive:!0}),_.push(()=>Ke.removeEventListener("scroll",Ci));const _i=Lw();if(_i.length>0){for(const k of _i)Jo(k,!0);nt()}const Tn=Dw(k=>{if(k.kind==="append")Jo(k.entry);else if(k.kind==="update")Wo(k.entry);else if(k.kind==="remove")for(const Q of k.entries)el(Q)});return _.push(Tn),tl(),Yo("Roster"),{log:k=>{Lt(k)},addEvent:jn,renderRoster:Ga,dispose:()=>{for(const k of _.splice(0))try{k()}catch(Q){console.warn("Failed to dispose HUD listener",Q)}ee(),ge(),document.body.classList.remove(C),y.remove(),T.remove(),g.remove()}}}const zw=t=>`[data-tutorial-target="${t}"]`,Qn=16,xc=12,Cb="is-tutorial-highlighted",Bw=[{id:"heat",target:"heat",title:"Heat the Sauna",description:"Keep the sauna fires roaring. This control shows when the next warrior emerges from the steam."},{id:"upkeep",target:"upkeep",title:"Mind Your Upkeep",description:"Every attendant draws upkeep. Track totals and see a featured roster member to balance your economy."},{id:"sisu",target:"sisu",title:"Stockpile SISU",description:"SISU fuels heroic bursts. Watch this meter to know when your grit reserves can power signature moves."},{id:"enemy-ramp",target:"enemy-ramp",title:"Read the Enemy Ramp",description:"The badge shows the current stage, upcoming multiplier surges, and calm lulls before the next pressure wave."},{id:"combat",target:"combat",title:"Command the Fight",description:"Trigger a Sisu Burst to supercharge allied attacks or rally everyone home with a Torille call."},{id:"victory",target:"victory",title:"Claim Victory",description:"Destroy every enemy stronghold to win the campaign. The Saunakunnia badge tracks your march toward total conquest."},{id:"defeat",target:"sauna-integrity",title:"Avert Defeat",description:"Defeat strikes if the sauna is razed, every attendant is downed for 8 seconds, or upkeep bankruptcy lingers for 12 seconds. Guard the integrity meter and keep your roster on its feet."}];function Hw(t,a,s){return Math.max(a,Math.min(s,t))}function Iw(t={}){const a=t.steps??Bw;if(a.length===0)throw new Error("Tutorial requires at least one step.");let s=-1,r=null,l=!1;const u=document.createElement("div");u.className="tutorial-overlay";const f=document.createElement("div");f.className="tutorial-overlay__spotlight",f.setAttribute("aria-hidden","true");const h=document.createElement("section");h.className="tutorial-card",h.setAttribute("role","dialog"),h.setAttribute("aria-modal","false"),h.tabIndex=-1;const m=document.createElement("header");m.className="tutorial-card__header";const p=document.createElement("h2");p.className="tutorial-card__title";const g=document.createElement("button");g.type="button",g.className="tutorial-card__close",g.setAttribute("aria-label","Dismiss tutorial"),g.textContent="×",m.append(p,g);const y=document.createElement("p");y.className="tutorial-card__description";const v=document.createElement("p");v.className="tutorial-card__progress";const S=document.createElement("div");S.className="tutorial-card__controls";const M=document.createElement("button");M.type="button",M.className="tutorial-card__button tutorial-card__button--secondary",M.textContent="Back";const _=document.createElement("button");_.type="button",_.className="tutorial-card__button",_.textContent="Next";const T=document.createElement("button");T.type="button",T.className="tutorial-card__skip",T.textContent="Skip tutorial",S.append(M,_),h.append(m,y,v,S,T),u.append(f,h);const N=typeof ResizeObserver<"u"?new ResizeObserver(()=>{s>=0&&W()}):null,O=()=>{s>=0&&W()};function B(){l||(document.body.appendChild(u),window.addEventListener("resize",W),document.addEventListener("scroll",O,!0),N?.observe(h),l=!0)}function Y(){l&&(window.removeEventListener("resize",W),document.removeEventListener("scroll",O,!0),N?.disconnect(),u.remove(),l=!1)}function X($){if(r&&r!==$&&(r.classList.remove(Cb),r.removeAttribute("data-tutorial-highlight")),r=$,!$){f.style.opacity="0";return}$.classList.add(Cb),$.setAttribute("data-tutorial-highlight","true"),f.style.opacity="1"}function V(){if(!r)return null;const $=r.getBoundingClientRect();return $.width===0&&$.height===0?null:{top:$.top,left:$.left,width:$.width,height:$.height}}function W(){const $=V();if(!$){h.style.top=`${Qn}px`,h.style.left=`${Qn}px`,h.classList.add("tutorial-card--floating"),f.style.opacity="0";return}h.classList.remove("tutorial-card--floating"),f.style.opacity="1";const L=$.top-xc,P=$.left-xc,le=$.width+xc*2,ee=$.height+xc*2;f.style.top=`${L}px`,f.style.left=`${P}px`,f.style.width=`${le}px`,f.style.height=`${ee}px`;const x=h.getBoundingClientRect();let z=window.innerHeight-$.top-$.height>=$.top?$.top+$.height+Qn:$.top-x.height-Qn;z<Qn?z=Qn:z+x.height>window.innerHeight-Qn&&(z=window.innerHeight-Qn-x.height);let oe=$.left+$.width/2-x.width/2;oe=Hw(oe,Qn,window.innerWidth-x.width-Qn),h.style.top=`${Math.round(z)}px`,h.style.left=`${Math.round(oe)}px`}function ne(){requestAnimationFrame(()=>{h.focus({preventScroll:!0})})}function F($){if($<0||$>=a.length)return;B(),s=$;const L=a[$];p.textContent=L.title,y.textContent=L.description,v.textContent=`Step ${$+1} of ${a.length}`,M.disabled=$===0,_.textContent=$===a.length-1?"Finish":"Next";const P=document.querySelector(zw(L.target));X(P??null),W(),ne()}function H(){if(s===-1){F(0);return}if(s>=a.length-1){ae();return}F(s+1)}function C(){s<=0||F(s-1)}function J(){X(null),Y(),s=-1}function I(){t.onSkip?.(),J()}function ae(){t.onComplete?.(),J()}return M.addEventListener("click",()=>{C()}),_.addEventListener("click",()=>{H()}),T.addEventListener("click",()=>{I()}),g.addEventListener("click",()=>{I()}),h.addEventListener("keydown",$=>{$.defaultPrevented||($.key==="ArrowRight"?($.preventDefault(),H()):$.key==="ArrowLeft"?($.preventDefault(),C()):$.key==="Escape"&&($.preventDefault(),I()))}),{start(){s===-1&&F(0)},next:H,previous:C,skip:I,finish:ae,destroy(){J()}}}const jw=Math.sqrt(3),Gw=2;function Wc(t){return{width:t*jw,height:t*Gw}}const La=16,wc=2;function Fw(){return typeof window<"u"&&window.devicePixelRatio||1}function $w(t,a){const s=Math.max(t.qMin,a.minQ),r=Math.min(t.qMax,a.maxQ),l=Math.max(t.rMin,a.minR),u=Math.min(t.rMax,a.maxR);return s>r||l>u?null:{qMin:s,qMax:r,rMin:l,rMax:u}}function Yw(t,a){const s=Fw(),r=a.width/(s*t.zoom),l=a.height/(s*t.zoom);return{x:t.x-r/2,y:t.y-l/2,width:r,height:l}}function Vw(t,a){const s=[Mo(t.x,t.y,a),Mo(t.x+t.width,t.y,a),Mo(t.x,t.y+t.height,a),Mo(t.x+t.width,t.y+t.height,a)];let r=1/0,l=-1/0,u=1/0,f=-1/0;for(const h of s)r=Math.min(r,h.q),l=Math.max(l,h.q),u=Math.min(u,h.r),f=Math.max(f,h.r);return{qMin:Math.floor(r)-wc,qMax:Math.ceil(l)+wc,rMin:Math.floor(u)-wc,rMax:Math.ceil(f)+wc}}function Xw(t,a,s,r){if(!s||typeof s.width!="number"||typeof s.height!="number")return{qMin:t.minQ,qMax:t.maxQ,rMin:t.minR,rMax:t.maxR};if(s.width===0||s.height===0)return{qMin:t.minQ,qMax:t.maxQ,rMin:t.minR,rMax:t.maxR};const l=Yw(a,s);return $w(Vw(l,r),t)}function Ws(t){return Math.floor(t/La)}function mv(t){return`${t.q},${t.r}`}function Kw(t,a){return mv({q:Ws(t),r:Ws(a)})}function Qw(t){return{qMin:Ws(t.qMin),qMax:Ws(t.qMax),rMin:Ws(t.rMin),rMax:Ws(t.rMax)}}function pv(t){const a=[];for(let s=t.rMin;s<=t.rMax;s++)for(let r=t.qMin;r<=t.qMax;r++)a.push({q:r,r:s});return a}function Pw(t,a){const s=a.q*La,r=a.r*La,l=s+La-1,u=r+La-1,f=Math.max(s,t.minQ),h=Math.min(l,t.maxQ),m=Math.max(r,t.minR),p=Math.min(u,t.maxR);if(!(f>h||m>p))for(let g=m;g<=p;g++)for(let y=f;y<=h;y++)t.ensureTile(y,g)}function Zw(t,a){for(const s of pv(a))Pw(t,s)}const Jw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3ePlains%20Tile%3c/title%3e%3cdesc%20id='desc'%3eRolling%20plains%20with%20sunrise%20gradients%20and%20glowing%20grasses.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='plains-bg'%20cx='50%25'%20cy='50%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='plains-field'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='0%25'%3e%3cstop%20offset='0%25'%20stop-color='%23facc15'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23eab308'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='plains-haze'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f59e0b'%20stop-opacity='0.2'%20/%3e%3c/linearGradient%3e%3cfilter%20id='plains-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='5'%20stdDeviation='6'%20flood-color='%23facc15'%20flood-opacity='0.35'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23plains-bg)'%20/%3e%3cg%20filter='url(%23plains-glow)'%3e%3cpath%20d='M16%2088c20-18%2036-22%2048-22s28%204%2048%2022'%20fill='url(%23plains-field)'%20stroke='%23fef9c3'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M24%20102c16-14%2032-18%2040-18s24%204%2040%2018'%20fill='none'%20stroke='%23fde68a'%20stroke-width='5'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M32%2070c12-10%2024-14%2032-14s20%204%2032%2014'%20fill='url(%23plains-haze)'%20opacity='0.7'%20/%3e%3cpath%20d='M52%2078l4%2012m8-12l4%2012m8-12l4%2012'%20stroke='%23fef3c7'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='36'%20r='8'%20fill='%23fef08a'%20opacity='0.7'%20/%3e%3c/svg%3e",Ww="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eForest%20Tile%3c/title%3e%3cdesc%20id='desc'%3eStylised%20evergreen%20trees%20glowing%20against%20a%20deep%20night%20backdrop.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='forest-bg'%20cx='50%25'%20cy='40%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230b1120'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='forest-leaf'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%234ade80'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2315803d'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='forest-trunk'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23a855f7'%20/%3e%3cstop%20offset='100%25'%20stop-color='%237c3aed'%20/%3e%3c/linearGradient%3e%3cfilter%20id='forest-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%234ade80'%20flood-opacity='0.25'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23forest-bg)'%20/%3e%3cg%20filter='url(%23forest-glow)'%20stroke='%23bbf7d0'%20stroke-width='2'%3e%3cpath%20fill='url(%23forest-leaf)'%20d='M64%2026L32%2080h18l-12%2022h28l-10-22h16l-10%2022h28l-12-22h18z'%20/%3e%3crect%20x='58'%20y='74'%20width='12'%20height='18'%20rx='3'%20fill='url(%23forest-trunk)'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20stroke-opacity='0.5'%20d='M44%2086c6-4%2012-6%2020-6s14%202%2020%206'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='40'%20r='6'%20fill='%23fef3c7'%20opacity='0.6'%20/%3e%3ccircle%20cx='88'%20cy='32'%20r='4'%20fill='%23fef3c7'%20opacity='0.4'%20/%3e%3c/svg%3e",eA="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eMountain%20Tile%3c/title%3e%3cdesc%20id='desc'%3eJagged%20alpine%20peaks%20with%20luminous%20snowcaps.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='mountain-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%23111827'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='mountain-rock'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2364748b'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23334155'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mountain-snow'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23cbd5f5'%20/%3e%3c/linearGradient%3e%3cfilter%20id='mountain-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%23f8fafc'%20flood-opacity='0.2'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23mountain-bg)'%20/%3e%3cg%20filter='url(%23mountain-glow)'%20stroke='%23cbd5f5'%20stroke-width='2'%20stroke-linejoin='round'%3e%3cpath%20fill='url(%23mountain-rock)'%20d='M24%20100l32-52%2014%2022%2012-18%2022%2048z'%20/%3e%3cpath%20fill='url(%23mountain-snow)'%20d='M56%2048l14%2022%2012-18%2010%2022H48z'%20opacity='0.85'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20opacity='0.6'%20d='M32%2094c10-6%2020-9%2032-9s22%203%2032%209'%20/%3e%3c/g%3e%3ccircle%20cx='92'%20cy='32'%20r='6'%20fill='%23f1f5f9'%20opacity='0.5'%20/%3e%3c/svg%3e",tA="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eWater%20Tile%3c/title%3e%3cdesc%20id='desc'%3eGlowing%20waves%20surrounding%20a%20crystalline%20droplet.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='water-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230b1120'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='water-wave'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='water-drop'%20x1='50%25'%20y1='0%25'%20x2='50%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230284c7'%20/%3e%3c/linearGradient%3e%3cfilter%20id='water-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='8'%20flood-color='%2338bdf8'%20flood-opacity='0.3'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23water-bg)'%20/%3e%3cg%20filter='url(%23water-glow)'%3e%3cpath%20d='M32%2076c12-10%2024-15%2032-15s20%205%2032%2015'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3cpath%20d='M28%2092c14-12%2030-18%2040-18s26%206%2040%2018'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='6'%20stroke-linecap='round'%20opacity='0.7'%20/%3e%3cpath%20d='M40%2060c10-8%2018-12%2024-12s14%204%2024%2012'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M64%2030c-12%2020-18%2032-18%2042%200%2011%208%2020%2018%2020s18-9%2018-20c0-10-6-22-18-42z'%20fill='url(%23water-drop)'%20stroke='%23e0f2fe'%20stroke-width='2'%20/%3e%3c/g%3e%3ccircle%20cx='94'%20cy='34'%20r='6'%20fill='%23f8fafc'%20opacity='0.45'%20/%3e%3c/svg%3e",nA=.01;function gv(t){return!Number.isFinite(t)||t<=nA?1:t}function aA(t,a){return t/gv(a)}function Wn(t,a){const s=gv(a);return Math.round(t*s)/s}const _b={[xn.Plains]:{baseColor:"#d8b869",icon:Jw},[xn.Forest]:{baseColor:"#237a55",icon:Ww},[xn.Hills]:{baseColor:"#b57c57",icon:eA},[xn.Lake]:{baseColor:"#3185d5",icon:tA}},iA=[255,255,255],Nm=[12,18,28],sA=[0,0,0],Tb="rgba(56, 189, 248, 0.85)",Rb="rgba(56, 189, 248, 0.45)";let yo=null,bo=null;const rA=t=>Math.min(1,Math.max(0,t));function oA(t){let a=t.trim().replace("#","");a.length===3&&(a=a.split("").map(r=>r+r).join(""));const s=Number.parseInt(a,16);return[s>>16&255,s>>8&255,s&255]}function eu(t,a,s){const r=rA(s);return[Math.round(t[0]+(a[0]-t[0])*r),Math.round(t[1]+(a[1]-t[1])*r),Math.round(t[2]+(a[2]-t[2])*r)]}function Nb(t){return`rgb(${t[0]}, ${t[1]}, ${t[2]})`}function tu(t,a=1){return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${a})`}function nu(t,a=1){return tu(eu(Nm,iA,t),a)}function ar(t,a=1){return tu(eu(Nm,sA,t),a)}const lA={terrain:.05,hover:.065,selection:.085},cA={terrain:1,hover:1.35,selection:2.1};function au(t,a,s="terrain"){const r=t*lA[s],l=aA(r,a);return Math.max(cA[s],l)}function uA(){if(yo&&bo)return{stroke:yo,glow:bo};if(typeof window<"u"){const t=getComputedStyle(document.documentElement),a=t.getPropertyValue("--tile-highlight-ring").trim(),s=t.getPropertyValue("--tile-highlight-glow").trim();yo=a||Tb,bo=s||Rb}else yo=Tb,bo=Rb;return{stroke:yo,glow:bo}}function yv(t){return Math.min(1,Math.max(0,t))}function Eu(t){let a=t.trim();if(a.startsWith("#")&&(a=a.slice(1)),a.length===3){const s=Number.parseInt(a[0]+a[0],16),r=Number.parseInt(a[1]+a[1],16),l=Number.parseInt(a[2]+a[2],16);return[s,r,l]}if(a.length===6){const s=Number.parseInt(a,16),r=s>>16&255,l=s>>8&255,u=s&255;return[r,l,u]}return[0,0,0]}function dA(t,a,s){const r=yv(s),l=(u,f)=>Math.round(u+(f-u)*r);return[l(t[0],a[0]),l(t[1],a[1]),l(t[2],a[2])]}function fA([t,a,s],r){return`rgba(${t}, ${a}, ${s}, ${yv(r)})`}function Mi(t,a,s,r){return fA(dA(t,a,s),r)}function hA(t){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=t,m=Eu(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=Mi(m,[255,255,255],.35,.24);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.06);const g=3,y=6,v=s+l*.12,S=s+l*.88;for(let N=0;N<g;N++){const O=N/Math.max(1,g-1),B=r+u*.28+O*u*.32,Y=f*(.18-O*.05);a.beginPath();for(let X=0;X<=y;X++){const V=X/y,W=v+(S-v)*V,ne=Math.sin(V*Math.PI*1.6+N*.8)*Y,F=B-Math.abs(ne)*.55;X===0?a.moveTo(W,F):a.lineTo(W,F)}a.stroke()}const M=Mi(m,[18,54,32],.4,.2);a.strokeStyle=M,a.lineWidth=Math.max(.75,f*.035);const _=5,T=f*.22;for(let N=0;N<_;N++){const O=s+l*(.2+N/Math.max(1,_-1)*.6),B=r+u*.55-Math.cos(N*.9)*f*.08;a.beginPath(),a.arc(O,B,T,Math.PI*.2,Math.PI*.85),a.stroke(),a.beginPath(),a.arc(O+T*.35,B-T*.1,T*.55,Math.PI*.15,Math.PI*.95),a.stroke()}a.restore()}function mA(t){const{ctx:a,centerX:s,centerY:r,radius:l,baseColor:u}=t,f=Eu(u);a.save(),a.lineCap="round";const h=Mi(f,[255,235,214],.45,.22);a.strokeStyle=h,a.lineWidth=Math.max(1,l*.05);const m=4;for(let y=0;y<m;y++){const v=y/Math.max(1,m-1),S=l*(1.25-v*.45),M=l*(.72-v*.18),_=r+l*.18*(v-.5);a.beginPath(),a.ellipse(s,_,S,M,0,Math.PI*.12,Math.PI*.88),a.stroke()}const p=Mi(f,[60,36,20],.35,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,l*.032),a.setLineDash([l*.22,l*.18]);const g=3;for(let y=0;y<g;y++){const v=l*(.75-y*.1),S=r+l*.28+y*l*.08;a.beginPath(),a.arc(s+l*.08,S,v,Math.PI*.28,Math.PI*.76),a.stroke()}a.setLineDash([]),a.restore()}function pA(t){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=t,m=Eu(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=Mi(m,[255,255,255],.55,.28);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.045);const g=4,y=7,v=s+l*.12,S=s+l*.88,M=f*.16;for(let N=0;N<g;N++){const O=N/Math.max(1,g-1),B=r+u*.3+O*u*.4;a.beginPath();for(let Y=0;Y<=y;Y++){const X=Y/y,V=v+(S-v)*X,W=Math.sin(X*Math.PI*2+N*.6)*M*(.75-O*.2),ne=B+W;Y===0?a.moveTo(V,ne):a.lineTo(V,ne)}a.stroke()}const _=Mi(m,[12,52,94],.4,.2);a.strokeStyle=_,a.lineWidth=Math.max(.8,f*.03);const T=3;for(let N=0;N<T;N++){const O=N/Math.max(1,T-1),B=r+u*.35+O*u*.35;a.beginPath();for(let Y=0;Y<=y;Y++){const X=Y/y,V=v+(S-v)*X,W=Math.sin(X*Math.PI*2+N)*M*.35,ne=B+W;Y===0?a.moveTo(V,ne):a.lineTo(V,ne)}a.stroke()}a.restore()}function bv(t){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=t,m=Eu(h);a.save(),a.lineCap="round";const p=Mi(m,[255,255,255],.42,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,f*.03);const g=f*.55;for(let S=-1;S<=2;S++){const M=g*S;a.beginPath(),a.moveTo(s+M,r+u*.25),a.lineTo(s+M+l*.75,r+u*.85),a.stroke()}const y=Mi(m,[112,82,32],.3,.16);a.strokeStyle=y,a.lineWidth=Math.max(.7,f*.025),a.setLineDash([f*.24,f*.34]);const v=f*.48;for(let S=0;S<3;S++){const M=v*S;a.beginPath(),a.moveTo(s+l*.18+M,r+u*.78),a.lineTo(s+l*.7+M,r+u*.38),a.stroke()}a.setLineDash([]),a.restore()}const kb=new Map;let Yi=null;function gA(){if(Yi)return Yi;const t="/";if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(t))return Yi=t,Yi;const s=t.startsWith("/")?t:`/${t}`;return typeof window<"u"&&typeof window.location?.origin=="string"?Yi=`${window.location.origin}${s}`:Yi=`http://localhost${s}`,Yi}function yA(t){let a=kb.get(t);if(!a){a=new Image,a.decoding="async";const s=new URL(t,gA()).href;a.src=s,kb.set(t,a)}if(a.complete&&a.naturalWidth>0&&a.naturalHeight>0)return a}const bA={[xn.Plains]:bv,[xn.Forest]:hA,[xn.Hills]:mA,[xn.Lake]:pA};function vv(t,a,s,r){t.beginPath();for(let l=0;l<6;l++){const u=Math.PI/180*(60*l-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?t.moveTo(f,h):t.lineTo(f,h)}t.closePath()}function vA(t,a,s,r){vv(t,a,s,r),t.save(),t.lineJoin="round",t.lineCap="round",t.lineWidth=au(r,1,"terrain"),t.strokeStyle=nu(.16,.6),t.stroke(),t.restore()}function SA(t,a,s,r,l,u,f,h){const m=_b[a.terrain]??_b[xn.Plains],p=oA(m.baseColor),g=r+u/2,y=l+f/2;t.save(),vv(t,g,y,h),t.clip();const v=t.createRadialGradient(g,y,h*.2,g,y,h*1.05);v.addColorStop(0,Nb(eu(p,[255,255,255],.3))),v.addColorStop(.7,m.baseColor),v.addColorStop(1,Nb(eu(p,Nm,.4))),t.fillStyle=v,t.shadowColor=tu(p,.35),t.shadowBlur=h*.9,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillRect(r-h*.1,l-h*.1,u+h*.2,f+h*.2);const S={ctx:t,x:r,y:l,width:u,height:f,radius:h,centerX:g,centerY:y,baseColor:m.baseColor};(bA[a.terrain]??bv)(S),t.globalCompositeOperation="lighter";const _=t.createRadialGradient(g,y,h*.85,g,y,h*1.18);_.addColorStop(0,"rgba(255, 255, 255, 0)"),_.addColorStop(1,tu(p,.18)),t.fillStyle=_,t.fillRect(r-h*.1,l-h*.1,u+h*.2,f+h*.2),t.globalCompositeOperation="source-over",t.restore();const T=yA(m.icon);if(T){const N=Math.min(u,f)*.62,O=g-N/2,B=y-N/2;t.save(),t.globalAlpha*=.92,t.drawImage(T,O,B,N,N),t.restore()}if(a.building){const N=s[`building-${a.building}`]??s.placeholder;t.drawImage(N,r,l,u,f)}}function EA(t,a){const s=Math.max(t.q*La,a.minQ),r=Math.min(s+La-1,a.maxQ),l=Math.max(t.r*La,a.minR),u=Math.min(l+La-1,a.maxR);return{qStart:s,qEnd:r,rStart:l,rEnd:u}}class MA{constructor(a){this.map=a,this.unsubscribe=a.addTileChangeListener((s,r,l)=>{this.onTileChange(s,l)})}chunkCanvases=new Map;dirtyChunks=new Set;cachedImages;unsubscribe;dispose(){this.unsubscribe(),this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}invalidate(){this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}markChunkDirty(a){this.dirtyChunks.add(a)}markTileDirty(a,s){this.dirtyChunks.add(Kw(a,s))}getRenderableChunks(a,s,r,l){this.refreshAssets(r);const u=[],{width:f,height:h}=Wc(s);for(const m of pv(a)){const p=mv(m),g=this.ensureChunk(p,m,s,f,h,r,l);g&&u.push(g)}return u}refreshAssets(a){if(this.cachedImages!==a){this.cachedImages=a;for(const s of this.chunkCanvases.keys())this.dirtyChunks.add(s)}}onTileChange(a,s){(s==="created"||s==="terrain"||s==="building"||s==="fog")&&this.markTileDirty(a.q,a.r)}ensureChunk(a,s,r,l,u,f,h){const m=this.chunkCanvases.get(a);if(!m||this.dirtyChunks.has(a)){const p=this.renderChunk(a,s,r,l,u,f,h,m);return this.dirtyChunks.delete(a),p?(this.chunkCanvases.set(a,p),p):(this.chunkCanvases.delete(a),null)}return m}renderChunk(a,s,r,l,u,f,h,m){if(typeof document>"u")return null;const{qStart:p,qEnd:g,rStart:y,rEnd:v}=EA(s,this.map);if(p>g||y>v)return null;const S=l/2,M=u/2;let _=1/0,T=1/0,N=-1/0,O=-1/0;const B=[];for(let ne=p;ne<=g;ne++)for(let F=y;F<=v;F++){const H=this.map.getTile(ne,F);if(!H||H.isFogged)continue;const{x:C,y:J}=ta({q:ne,r:F},r),I=C-h.x-S,ae=J-h.y-M;_=Math.min(_,I),T=Math.min(T,ae),N=Math.max(N,I+l),O=Math.max(O,ae+u),B.push({tile:H,x:I,y:ae})}if(!Number.isFinite(_)||!Number.isFinite(T)||!Number.isFinite(N)||!Number.isFinite(O))return null;const Y=Math.max(1,Math.ceil(N-_)),X=Math.max(1,Math.ceil(O-T));let V=m?.canvas;(!V||V.width!==Y||V.height!==X)&&(V=document.createElement("canvas"),V.width=Y,V.height=X);const W=V.getContext("2d");if(!W)throw new Error("Canvas 2D context not available for chunk rendering");W.setTransform(1,0,0,1,0,0),W.clearRect(0,0,Y,X);for(const{tile:ne,x:F,y:H}of B){const C=F-_,J=H-T;W.save(),SA(W,ne,f,C,J,l,u,r),vA(W,C+l/2,J+u/2,r),W.restore()}return{key:a,canvas:V,origin:{x:_,y:T},width:Y,height:X}}}const xA=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Na=new Array(512);for(let t=0;t<512;t++)Na[t]=xA[t%256];const Db=new Map,Lb=t=>t*t*t*(t*(t*6-15)+10),rh=(t,a,s)=>t+s*(a-t),Ac=(t,a,s)=>{switch(t&3){case 0:return a+s;case 1:return-a+s;case 2:return a-s;default:return-a-s}};function wA(t,a){const s=Math.floor(t)&255,r=Math.floor(a)&255,l=t-Math.floor(t),u=a-Math.floor(a),f=Na[Na[s+1]+r+1],h=Na[Na[s]+r+1],m=Na[Na[s+1]+r],p=Na[Na[s]+r],g=Lb(l),y=Lb(u),v=rh(Ac(p,l,u),Ac(m,l-1,u),g),S=rh(Ac(h,l,u-1),Ac(f,l-1,u-1),g);return rh(v,S,y)}function AA(t,a,s=4){let r=0,l=1,u=1,f=0;for(let h=0;h<s;h++)r+=wA(t*l,a*l)*u,f+=u,u*=.5,l*=2;return f>0?r/f:0}function CA(t){const a=Math.max(32,Math.min(512,Math.round(t))),s=a,r=Db.get(s);if(r)return r;if(typeof document>"u")return null;const l=document.createElement("canvas");l.width=a,l.height=a;const u=l.getContext("2d");if(!u)return null;const f=u.createImageData(a,a),h=a/48;let m=0;for(let p=0;p<a;p++)for(let g=0;g<a;g++){const y=AA(g/h,p/h,5),v=Math.pow((y+1)/2,1.35),S=Math.round(v*255);f.data[m]=255,f.data[m+1]=255,f.data[m+2]=255,f.data[m+3]=S,m+=4}return u.putImageData(f,0,0),Db.set(s,l),l}function Ub(t,a,s,r){t.beginPath();for(let l=0;l<6;l++){const u=Math.PI/180*(60*l-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?t.moveTo(f,h):t.lineTo(f,h)}t.closePath()}function _A(t,a,s,r){const l=t.createRadialGradient(a,s,r*.08,a,s,r*1.12);return l.addColorStop(0,nu(.4,.35)),l.addColorStop(.35,nu(.2,.55)),l.addColorStop(.6,ar(.1,.78)),l.addColorStop(.82,ar(.2,.88)),l.addColorStop(1,ar(.35,.95)),l}function TA(t,a,s,r,l){if(r<=0)return;const u=CA(r*2.2),f=r*2.5,h=a-f/2,m=s-f/2;t.save(),Ub(t,a,s,r),t.clip();const p=_A(t,a,s,r);t.fillStyle=p,t.fillRect(h,m,f,f),u&&(t.save(),t.globalCompositeOperation="lighter",t.globalAlpha*=.32,t.drawImage(u,a-r,s-r,r*2,r*2),t.restore()),t.restore(),t.save(),Ub(t,a,s,r*.99),t.lineJoin="round",t.lineCap="round",t.lineWidth=au(r,l,"hover"),t.strokeStyle=ar(.3,.88),t.shadowColor=ar(.45,.42),t.shadowBlur=Math.max(3,r*.45/Math.max(l,.1)),t.stroke(),t.restore()}class RA{constructor(a){this.mapRef=a,this.terrainCache=new MA(a),this.cachedHexSize=a.hexSize}terrainCache;cachedHexSize;get hexSize(){return this.mapRef.hexSize}getOrigin(){return ta({q:this.mapRef.minQ,r:this.mapRef.minR},this.hexSize)}invalidateCache(){this.terrainCache.invalidate()}dispose(){this.terrainCache.dispose()}draw(a,s,r){this.ensureHexSize();const l=a.canvas??null,u=Xw(this.mapRef,xe,l,this.hexSize);if(!u)return;const f=Qw(u);Zw(this.mapRef,f);const h=this.getOrigin(),m=this.terrainCache.getRenderableChunks(f,this.hexSize,s,h);this.drawChunks(a,m),this.drawFogLayer(a,h,u),r&&this.drawSelection(a,h,r)}drawToCanvas(a,s,r){const l=a.getContext("2d");if(!l)throw new Error("Canvas 2D context not available");this.draw(l,s,r)}ensureHexSize(){this.cachedHexSize!==this.hexSize&&(this.cachedHexSize=this.hexSize,this.terrainCache.invalidate())}drawChunks(a,s){if(s.length!==0)for(const r of s)a.drawImage(r.canvas,r.origin.x,r.origin.y)}drawSelection(a,s,r){const{width:l,height:u}=Wc(this.hexSize),{x:f,y:h}=ta(r,this.hexSize),m=f-s.x-l/2,p=h-s.y-u/2;this.strokeHex(a,m+l/2,p+u/2,this.hexSize,!0)}drawFogLayer(a,s,r){const{width:l,height:u}=Wc(this.hexSize),f=l/2,h=u/2;for(let m=r.rMin;m<=r.rMax;m++)for(let p=r.qMin;p<=r.qMax;p++){const g=this.mapRef.getTile(p,m);if(!g||!g.isFogged)continue;const{x:y,y:v}=ta({q:p,r:m},this.hexSize),S=y-s.x-f,M=v-s.y-h,_=this.hexSize,T=S+l/2,N=M+u/2;TA(a,T,N,_,xe.zoom)}}strokeHex(a,s,r,l,u=!1){const{stroke:f,glow:h}=uA();this.hexPath(a,s,r,l),a.save(),a.lineJoin="round",a.lineCap="round",u?(a.shadowColor=h,a.shadowBlur=Math.max(6,l*.65/Math.max(xe.zoom,.1)),a.lineWidth=au(l,xe.zoom,"selection"),a.strokeStyle=f,a.stroke()):(a.lineWidth=au(l,xe.zoom,"hover"),a.shadowColor=nu(.1,.45),a.shadowBlur=Math.max(2,l*.4/Math.max(xe.zoom,.1)),a.strokeStyle=ar(.1,.72),a.stroke()),a.restore()}hexPath(a,s,r,l){a.beginPath();for(let u=0;u<6;u++){const f=Math.PI/180*(60*u-30),h=s+l*Math.cos(f),m=r+l*Math.sin(f);u===0?a.moveTo(h,m):a.lineTo(h,m)}a.closePath()}}const gi={accent:"#38bdf8",accentSoft:"rgba(56, 189, 248, 0.2)",warm:"#fbbf24",surface:"rgba(15, 23, 42, 0.92)",border:"rgba(148, 163, 184, 0.34)",text:"#e2e8f0"};let yi=null;function Qs(t,a){const s=t.trim();return s.length>0?s:a}function NA(){if(yi)return yi;if(typeof window>"u"||typeof document>"u")return yi=gi,yi;try{const t=getComputedStyle(document.documentElement);return yi={accent:Qs(t.getPropertyValue("--color-accent"),gi.accent),accentSoft:Qs(t.getPropertyValue("--color-accent-soft"),gi.accentSoft),warm:Qs(t.getPropertyValue("--color-warning"),gi.warm),surface:Qs(t.getPropertyValue("--color-surface-strong"),gi.surface),border:Qs(t.getPropertyValue("--hud-border-strong"),gi.border),text:Qs(t.getPropertyValue("--color-foreground"),gi.text)},yi}catch(t){return console.warn("Failed to read sauna palette tokens from computed styles",t),yi=gi,yi}}function kA(t,a){const s=Math.max(0,t.auraRadius),r=ta(t.pos,a),l=r.x+a,u=r.y+a;let f=a;if(s<=0)return a*1.6;for(const h of c2){const m=ta({q:t.pos.q+h.q*s,r:t.pos.r+h.r*s},a),p=m.x+a,g=m.y+a,y=Math.hypot(p-l,g-u);y>f&&(f=y)}return f+a*.65}function DA(t,a,s,r,l,u){const f=Math.max(0,Math.min(u,Math.min(r,l)/2));t.moveTo(a+f,s),t.lineTo(a+r-f,s),t.quadraticCurveTo(a+r,s,a+r,s+f),t.lineTo(a+r,s+l-f),t.quadraticCurveTo(a+r,s+l,a+r-f,s+l),t.lineTo(a+f,s+l),t.quadraticCurveTo(a,s+l,a,s+l-f),t.lineTo(a,s+f),t.quadraticCurveTo(a,s,a+f,s),t.closePath()}function LA(t,a,{origin:s,hexSize:r,timestamp:l}){if(!a)return;const u=NA(),f=Number.isFinite(l)?l:typeof performance<"u"?performance.now():Date.now(),h=.5+.5*Math.sin(f*.0035),m=ta(a.pos,r),p=m.x-s.x+r,g=m.y-s.y+r,y=kA(a,r);t.save(),t.globalCompositeOperation="screen";const v=y+r*(.4+h*.3),S=Math.max(r*.6,y*.58),M=t.createRadialGradient(p,g,S,p,g,v);M.addColorStop(0,u.accentSoft),M.addColorStop(.55,`rgba(56, 189, 248, ${.18+h*.12})`),M.addColorStop(1,"rgba(2, 6, 23, 0)"),t.fillStyle=M,t.beginPath(),t.arc(p,g,v,0,Math.PI*2),t.fill(),t.restore(),t.save(),t.globalCompositeOperation="lighter",t.lineWidth=Math.max(r*.28,6),t.strokeStyle=`rgba(56, 189, 248, ${(.35+h*.2).toFixed(3)})`,t.shadowColor=`rgba(56, 189, 248, ${.45+h*.1})`,t.shadowBlur=r*(.9+h*.45),t.beginPath(),t.arc(p,g,y+r*.12,0,Math.PI*2),t.stroke(),t.restore();const _=r*.9;t.save(),t.beginPath(),t.arc(p,g,_,0,Math.PI*2),t.fillStyle=u.surface,t.globalAlpha*=.96,t.fill(),t.lineWidth=Math.max(1.5,r*.06),t.strokeStyle=u.border,t.shadowColor="rgba(8, 25, 53, 0.6)",t.shadowBlur=r*.45,t.stroke(),t.restore();const T=_*.78,N=Math.max(r*.22,5);t.save(),t.lineWidth=N,t.strokeStyle="rgba(148, 163, 184, 0.24)",t.beginPath(),t.arc(p,g,T,0,Math.PI*2),t.stroke(),t.restore();const O=a.playerSpawnCooldown>0?a.playerSpawnCooldown:1,Y=1-Math.min(1,Math.max(0,a.playerSpawnTimer/O)),X=-Math.PI/2,V=X+Math.PI*2*Y;if(Y>0){t.save(),t.lineWidth=N,t.lineCap="round";const w=t.createLinearGradient(p,g-T,p,g+T);w.addColorStop(0,u.accent),w.addColorStop(1,u.warm),t.strokeStyle=w,t.shadowColor=`rgba(56, 189, 248, ${.42+h*.18})`,t.shadowBlur=r*(.65+h*.35),t.beginPath(),t.arc(p,g,T,X,V,!1),t.stroke(),t.restore()}const W=Math.max(0,a.playerSpawnTimer),ne=Math.ceil(W);t.save(),t.font=`600 ${Math.max(12,r*.9)}px "Inter", "Manrope", "Segoe UI", sans-serif`,t.fillStyle=u.text,t.textAlign="center",t.textBaseline="middle",t.shadowColor="rgba(2, 6, 23, 0.6)",t.shadowBlur=r*.35,t.fillText(String(ne),p,g),t.restore(),t.save(),t.font=`500 ${Math.max(10,r*.36)}px "Inter", "Manrope", "Segoe UI", sans-serif`,t.fillStyle="rgba(148, 163, 184, 0.78)",t.textAlign="center",t.textBaseline="top",t.fillText("sec",p,g+T*.45),t.restore();const F="Sauna ♨️",H=Math.max(12,r*.58);t.save(),t.font=`600 ${H}px "Inter", "Manrope", "Segoe UI", sans-serif`;const C=t.measureText(F),J=r*.58,I=r*.32,ae=C.width+J*2,$=H+I*2,L=p-ae/2,P=g-y-$-r*.35,le=$/2;t.beginPath(),DA(t,L,P,ae,$,le);const ee=t.createLinearGradient(L,P,L,P+$);ee.addColorStop(0,"rgba(15, 23, 42, 0.94)"),ee.addColorStop(.55,"rgba(15, 23, 42, 0.86)"),ee.addColorStop(1,"rgba(30, 41, 59, 0.9)"),t.fillStyle=ee,t.shadowColor="rgba(8, 25, 53, 0.6)",t.shadowBlur=r*.4,t.fill(),t.lineWidth=Math.max(1.5,r*.06);const x=t.createLinearGradient(L,P,L+ae,P);x.addColorStop(0,`${u.accent}`),x.addColorStop(1,`${u.warm}`),t.strokeStyle=x,t.stroke(),t.fillStyle=u.text,t.shadowColor="rgba(8, 25, 53, 0.65)",t.shadowBlur=r*.3,t.textAlign="center",t.textBaseline="middle",t.fillText(F,p,P+$/2+H*.05),t.restore()}const Sv={nativeSize:{width:64,height:64},anchor:{x:.5,y:.92},scale:{x:1,y:1},nudge:{x:0,y:-.05}},UA={default:Sv,soldier:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.9},scale:{x:1.12,y:1.24},nudge:{x:0,y:-.14}},archer:{nativeSize:{width:128,height:128},anchor:{x:.46,y:.88},scale:{x:1.1,y:1.22},nudge:{x:-.04,y:-.12}},"avanto-marauder":{nativeSize:{width:128,height:128},anchor:{x:.5,y:.92},scale:{x:1.18,y:1.3},nudge:{x:0,y:-.18}},saunoja:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.66},scale:{x:1,y:1},nudge:{x:0,y:-.02}}};function Ev(t){return UA[t]??Sv}function Mv(t,a,s,r){const{x:l,y:u}=ta(t,a),f=r.nudge.x*a,h=r.nudge.y*a;return{x:l-s.x+f,y:u-s.y+h}}function OA({coord:t,hexSize:a,origin:s,zoom:r,type:l}){const u=Ev(l),f=Mv(t,a,s,u);return{x:Wn(f.x,r),y:Wn(f.y,r)}}function qA({coord:t,hexSize:a,origin:s,zoom:r,type:l}){const u=Ev(l),f=Mv(t,a,s,u),{width:h,height:m}=Wc(a),p=h*u.scale.x,g=m*u.scale.y,y=Wn(f.x-p*u.anchor.x,r),v=Wn(f.y-g*u.anchor.y,r),S=Wn(p,r),M=Wn(g,r),_=y+S*u.anchor.x,T=v+M*u.anchor.y;return{drawX:y,drawY:v,width:S,height:M,centerX:_,centerY:T,metadata:u}}function zA(t){if(!t||typeof t!="object")return!1;const a=t;return!!a.coord&&typeof a.coord=="object"&&typeof a.coord.q=="number"&&typeof a.coord.r=="number"&&typeof a.range=="number"}function BA(t){if(!t)return null;if(zA(t)){const a=Number.isFinite(t.range)?Math.max(0,t.range):0;return{coord:t.coord,range:a}}if("pos"in t){const a="visionRange"in t&&Number.isFinite(t.visionRange)?t.visionRange:"auraRadius"in t&&Number.isFinite(t.auraRadius)?t.auraRadius:0,s=Math.max(0,Number.isFinite(a)?a:0);return{coord:t.pos,range:s}}return null}function HA(t,a,s,r,l,u){const f=window.devicePixelRatio||1,h=t.canvas.width,m=t.canvas.height;t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,h,m);const p=h/f,g=m/f;t.scale(f,f),t.translate(p/2,g/2),t.scale(xe.zoom,xe.zoom);const y=a.getOrigin();t.translate(-(xe.x-y.x),-(xe.y-y.y)),a.draw(t,s,l??void 0);const v=u?.saunojas;v&&Array.isArray(v.units)&&v.units.length>0&&v.draw(t,v.units,{originX:y.x,originY:y.y,hexRadius:a.hexSize,zoom:xe.zoom,resolveRenderCoord:v.resolveRenderCoord}),IA(t,a,s,r,y,u?.fx,u?.friendlyVisionSources,u?.saunaVision??u?.sauna??null),u?.sauna&&LA(t,u.sauna,{origin:y,hexSize:a.hexSize}),t.restore()}function IA(t,a,s,r,l,u,f,h){const p=(f??r).filter(y=>y.faction==="player"&&!y.isDead()).map(y=>({coord:y.coord,range:y.getVisionRange()})),g=BA(h);g&&p.push(g);for(const y of r){if(y.isDead()||y.faction==="enemy"&&!p.some(({coord:X,range:V})=>Js(X,y.coord)<=V))continue;const v=s[`unit-${y.type}`]??s.placeholder,S=y.getMaxHealth();t.save();const M=u?.getUnitAlpha?.(y);if(typeof M=="number"){const X=Math.min(1,Math.max(0,M));if(X<=0){t.restore();continue}t.globalAlpha*=X}y.stats.health/S<.5&&(t.filter="saturate(0)");const _=y.renderCoord??y.coord,T=qA({coord:_,hexSize:a.hexSize,origin:l,zoom:xe.zoom,type:y.type}),N=[];y.stats.health/S<.5&&N.push("saturate(0)");const O=Math.abs(_.q-y.coord.q),B=Math.abs(_.r-y.coord.r),Y=Math.min(1,O+B);Y>.01?(N.push("contrast(1.08)"),t.shadowColor="rgba(255, 255, 255, 0.28)",t.shadowBlur=Math.max(6,12*xe.zoom*Y)):(t.shadowColor="rgba(0, 0, 0, 0)",t.shadowBlur=0),t.filter=N.length>0?N.join(" "):"none",t.drawImage(v,T.drawX,T.drawY,T.width,T.height),Cm()&&y.faction==="player"&&(t.strokeStyle="rgba(255,255,255,0.5)",t.lineWidth=2,t.strokeRect(T.drawX,T.drawY,T.width,T.height)),t.restore()}}const jA=200,Ob=.001;function oh(t){return{q:t.q,r:t.r}}function Cc(t,a){return!t||!a?!1:Math.abs(t.q-a.q)<Ob&&Math.abs(t.r-a.r)<Ob}class GA{constructor(a){this.redraw=a}tracks=new Map;rafId=null;enqueue(a,s){const r=this.normalizePath(s);if(r.length<2){this.clear(a,{snap:!0});return}const l=r[0];let u=this.tracks.get(a.id);u?u.current?Cc(u.current.to,l)||(u=this.resetTrack(a,l)):Cc(a.renderCoord,l)||(u=this.resetTrack(a,l)):(u={unit:a,queue:[]},this.tracks.set(a.id,u),Cc(a.renderCoord,l)||a.setRenderCoord(l));for(let f=1;f<r.length;f++)u.queue.push(oh(r[f]));this.ensureRunning()}clear(a,s){if(!this.tracks.delete(a.id)){s?.snap&&(a.snapRenderToCoord(),this.redraw());return}(s?.snap??!0)&&(a.snapRenderToCoord(),this.redraw()),this.tracks.size===0&&this.rafId!==null&&(typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null)}clearAll(){for(const a of this.tracks.values())a.unit.snapRenderToCoord();this.tracks.clear(),this.rafId!==null&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null,this.redraw()}resetTrack(a,s){this.clear(a,{snap:!1});const r={unit:a,queue:[]};return this.tracks.set(a.id,r),a.setRenderCoord(s),r}ensureRunning(){this.rafId!==null||this.tracks.size===0||(this.rafId=requestAnimationFrame(this.step))}normalizePath(a){const s=[];for(const r of a){const l=oh(r);(s.length===0||!Cc(s[s.length-1],l))&&s.push(l)}return s}ease(a){return a<=0?0:a>=1?1:a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2}step=a=>{if(this.rafId=null,this.tracks.size===0)return;let s=!1;for(const[r,l]of this.tracks){if(!l.current){const v=l.queue.shift();if(!v){this.tracks.delete(r);continue}l.current={from:oh(l.unit.renderCoord??l.unit.coord),to:v,start:a}}const u=l.current;if(!u)continue;const h=(a-u.start)/jA,m=Math.min(1,Math.max(0,h)),p=this.ease(m),g=u.from.q+(u.to.q-u.from.q)*p,y=u.from.r+(u.to.r-u.from.r)*p;l.unit.setRenderCoord({q:g,r:y}),s=!0,m>=1&&(l.unit.setRenderCoord(u.to),l.current=void 0,l.queue.length===0&&this.tracks.delete(r))}s&&this.redraw(),this.tracks.size>0&&(this.rafId=requestAnimationFrame(this.step))}}const FA=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,$A=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null,YA=900,VA=650;function XA(t){switch(t){case"down":return{x:0,y:36};case"left":return{x:-26,y:-18};case"right":return{x:26,y:-18};case"up":default:return{x:0,y:-40}}}function KA(t){const a=document.createElement("div");a.className="ui-floater-layer",t.appendChild(a);const s=!!FA?.matches,r=!!$A?.matches;return{spawn:({text:f,x:h,y:m,color:p,direction:g="up",durationMs:y,fontSize:v})=>{const S=document.createElement("span");S.className="ui-floater",S.textContent=f,S.style.left=`${Math.round(h)}px`,S.style.top=`${Math.round(m)}px`,p&&(S.style.color=p),v&&(S.style.fontSize=`${v}px`);const M=r?12:24;for(;a.childElementCount>=M;)a.firstElementChild?.remove();a.appendChild(S);const _=y??(r?VA:YA);if(s||!S.animate){S.style.opacity="0",S.style.transition=`opacity ${Math.round(_*.8)}ms ease-out`,requestAnimationFrame(()=>{S.style.opacity="1",requestAnimationFrame(()=>{S.style.opacity="0"})}),window.setTimeout(()=>{S.remove()},_);return}const T=XA(g),N=[{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:0},{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:1,offset:.18},{transform:`translate3d(-50%, -50%, 0) translate3d(${T.x}px, ${T.y}px, 0)`,opacity:0}],O=S.animate(N,{duration:_,easing:"cubic-bezier(0.18, 0.89, 0.32, 1.28)",fill:"forwards"});O.onfinish=()=>{S.remove()}},destroy:()=>{a.remove()}}}const qb=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),QA=new Intl.NumberFormat("en-US",{maximumFractionDigits:1,minimumFractionDigits:0});function zb(t){return 1-(1-t)*(1-t)}function _c(t,a,s){return Math.min(s,Math.max(a,t))}const PA="var(--color-danger)",ZA="color-mix(in srgb, #34d399 88%, white 12%)",JA=720,WA=540,eC=220,tC=180,nC=6,aC=3,iC="color-mix(in srgb, #fbbf24 82%, white 10%)",sC=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,rC=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null;function oC(t){const{canvas:a,overlay:s,mapRenderer:r,getUnitById:l,requestDraw:u}=t,f=KA(s),h=new Map,m=new Map,p=[],g={x:0,y:0},y=!!sC?.matches,v=!!rC?.matches,S=v?WA:JA,M=v?tC:eC,_=v?aC:nC,T=()=>{u&&(typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>u()):u())},N=H=>{const C=a.getBoundingClientRect(),J=s.getBoundingClientRect();if(C.width===0||C.height===0)return null;const{x:I,y:ae}=ta(H,r.hexSize),$=(I-xe.x)*xe.zoom+C.width/2,L=(ae-xe.y)*xe.zoom+C.height/2,P=r.hexSize*xe.zoom*.75;return{x:$+(C.left-J.left),y:L+(C.top-J.top)-P}},O=(H,C,J,I="up")=>{const ae=l(H);if(!ae)return;const $=N(ae.renderCoord??ae.coord);$&&f.spawn({text:C,x:$.x,y:$.y,color:J,direction:I,fontSize:v?18:void 0})},B=H=>{if(!H||H.amount<=0)return;const C=qb.format(Math.max(1,Math.round(H.amount)));if(O(H.targetId,`-${C}`,PA,"up"),!y){const J=typeof performance<"u"?performance.now():Date.now();p.push({start:J,duration:M,intensity:_,seedX:Math.random()*500,seedY:Math.random()*500})}T()},Y=H=>{if(!H||H.amount<=0)return;const C=H.amount>=1?qb.format(Math.round(H.amount)):QA.format(_c(H.amount,0,9.9));O(H.unitId,`+${C}`,ZA,"up"),T()},X=H=>{if(!H)return;const C=typeof performance<"u"?performance.now():Date.now();h.set(H.unitId,{start:C,duration:S}),O(H.unitId,"✖",iC,"down"),T()};return se.on("unitDamaged",B),se.on("unitHealed",Y),se.on("unitDied",X),{step:H=>{if(y)g.x=0,g.y=0;else{let C=0,J=0;for(let I=p.length-1;I>=0;I--){const ae=p[I],$=H-ae.start;if($>=ae.duration){p.splice(I,1);continue}const L=_c($/ae.duration,0,1),P=ae.intensity*zb(1-L);C+=Math.sin((H+ae.seedX)/16)*P,J+=Math.cos((H+ae.seedY)/18)*P}g.x=C,g.y=J}for(const[C,J]of h){const I=H-J.start,ae=_c(I/J.duration,0,1),$=1-zb(ae);if(ae>=1){m.delete(C),h.delete(C);continue}m.set(C,_c($,0,1))}},getShakeOffset:()=>({x:g.x,y:g.y}),getUnitAlpha:H=>m.get(H)??1,dispose:()=>{se.off("unitDamaged",B),se.off("unitHealed",Y),se.off("unitDied",X),p.length=0,h.clear(),m.clear(),f.destroy()}}}function lC(){return`${"/".endsWith("/")?"/":"//"}${"assets/units/saunoja.svg".replace(/^\/+/,"")}`}const Bb=lC();let er=null,vo=null;function $h(t){return!!(t&&t.complete&&t.naturalWidth>0&&t.naturalHeight>0)}function cC(t,a){if(!a)return t;try{a(t)}catch(s){console.error("Saunoja icon onLoad callback failed",s)}return t}function xv(t){const a=r=>t?r.then(l=>cC(l,t)):r;if($h(er))return a(Promise.resolve(er));if(vo)return a(vo);if(typeof Image>"u")return Promise.reject(new Error("Image constructor is not available in this environment."));const s=new Image;return s.decoding="async",er=s,vo=new Promise((r,l)=>{const u=()=>{s.onload=null,s.onerror=null},f=()=>{u(),r(s)};s.onload=f,s.onerror=h=>{u(),er=null,vo=null;const m=new Error(`Failed to load saunoja icon from ${Bb}`);console.warn(m.message,h),l(m)},s.src=Bb,$h(s)&&f()}),a(vo)}function uC(t,a,{originX:s=0,originY:r=0,hexRadius:l=ur,zoom:u=1,resolveRenderCoord:f}={}){if(!t||!Array.isArray(a)||a.length===0)return;const h=$h(er)?er:null;if(!h)return;const m=Number.isFinite(l)&&l>0?l:ur,p=m*.965,g=a.map(y=>{const v=f?.(y),M=v&&typeof v=="object"&&Number.isFinite(v.q)&&Number.isFinite(v.r)?{q:v.q,r:v.r}:y.coord;return{unit:y,coord:M}}).sort((y,v)=>y.coord.r!==v.coord.r?y.coord.r-v.coord.r:y.coord.q!==v.coord.q?y.coord.q-v.coord.q:y.unit.id.localeCompare(v.unit.id));for(const{unit:y,coord:v}of g){const{x:S,y:M}=OA({coord:v,hexSize:m,origin:{x:s,y:r},zoom:u,type:"saunoja"});t.save(),_o(t,S,M,p),t.clip();const _=h.naturalWidth||1,T=h.naturalHeight||1,N=p*1.85,O=p*2.4,B=Math.min(N/_,O/T),Y=Wn(_*B,u),X=Wn(T*B,u),V=Wn(S-Y/2,u),W=Wn(M-X*.78,u);t.save(),t.filter="saturate(112%) contrast(108%) brightness(1.04)",t.drawImage(h,V,W,Y,X),t.restore(),t.save(),t.globalCompositeOperation="multiply";const ne=t.createRadialGradient(S,M+p*.38,p*.2,S,M+p*.38,p*1.05);ne.addColorStop(0,"rgba(22, 30, 50, 0.58)"),ne.addColorStop(1,"rgba(22, 30, 50, 0)"),t.fillStyle=ne,t.fillRect(S-p,M-p,p*2,p*2),t.restore(),t.save(),t.globalCompositeOperation="soft-light";const F=t.createLinearGradient(S,M-p,S,M+p);F.addColorStop(0,"rgba(233, 224, 255, 0.28)"),F.addColorStop(.52,"rgba(196, 148, 255, 0.26)"),F.addColorStop(1,"rgba(94, 75, 168, 0.35)"),t.fillStyle=F,t.fillRect(S-p,M-p,p*2,p*2),t.restore(),t.save(),t.globalCompositeOperation="screen",t.globalAlpha=.68;const H=t.createRadialGradient(S,M-p*.68,p*.1,S,M,p*1.12);H.addColorStop(0,"rgba(255, 255, 255, 0.85)"),H.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=H,t.fillRect(S-p,M-p,p*2,p*2),t.restore();const J=performance.now()-y.lastHitAt,I=120;if(J<I){const L=1-J/I;qx(t,{centerX:S,centerY:M,radius:p,progress:L})}t.restore(),zx(t,{centerX:S,centerY:M-m*.18,radius:m*.94,intensity:y.steam});const ae=m*.42,$=M+m*.34;Ox(t,{centerX:S,centerY:$,hp:y.hp,maxHp:y.maxHp,radius:ae})}}const dC=["Resolute Sauna Guardian","Steam Scholar","Frost-Hardened","Loyal Watchbearer","Aura Whisperer","Shield Brother","Stonefooted Scout","Sisu-Forged Veteran","Brewmaster Quartermaster","Icebreaker Herald","Runic Tactician","Torchbearer"],fC=["Heat Fickle","Soot Allergic","Slow to Spark","Overconfident","Distracted Dreamer","Stubborn Stoker","Thirsty Between Battles","Clumsy Footwork","Rust-Prone Gear","Echo-Lost Listener"];function Hb(t,a,s){const r=[...t],l=[],u=Math.max(0,Math.min(a,r.length));for(let f=0;f<u;f++){const h=Math.floor(s()*r.length),[m]=r.splice(h,1);m&&l.push(m)}return l}function hC(t,a){for(let s=t.length-1;s>0;s--){const r=Math.floor(a()*(s+1));[t[s],t[r]]=[t[r],t[s]]}return t}function mC(t=Math.random){typeof t!="function"&&(t=Math.random);const a=Hb(dC,2,t),s=Hb(fC,1,t),r=[...a,...s];return hC(r,t).map(l=>l.trim()).filter(l=>l.length>0)}const pC=1;function So(t,a=0){return Number.isFinite(t)?t:a}function gC(t){const{heat:a,pickSpawnTile:s,spawnUnit:r,maxSpawns:l,tierHelpers:u}=t,f=Math.max(pC,Oo),h=Math.max(0,So(t.minUpkeepReserve??f,f));let m=Math.max(0,So(t.availableUpkeep,0));const p=Math.max(0,Math.floor(So(l??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY))),g=So(t.rosterCap??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),y=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.POSITIVE_INFINITY,v=typeof t.getRosterCount=="function"?t.getRosterCount:()=>0;let S=0,M=0,_=0,T=0,N=0,O=0,B=0;for(;(a.hasTriggerReady()||u?.hasQueuedSpawn())&&S<p;){S+=1;const Y=u?.getSnapshot()??null;if(Math.max(0,Math.floor(So(v()??0,0)))>=y){O+=1;let F=!1;Y&&u&&(F=u.queueBlockedSpawn(Y,()=>a.consumeTrigger())),F?M+=a.vent(.15):M+=a.vent(.35);break}let V=!1;if(Y&&u&&u.hasQueuedSpawn()&&(V=u.takeQueuedSpawn(Y)),!V&&!a.hasTriggerReady())break;if(m<h){T+=1,V&&Y&&u?.restoreQueuedSpawn(Y),M+=a.vent(.5);break}const W=s();if(!W){N+=1,V&&Y&&u?.restoreQueuedSpawn(Y),M+=a.vent(.25);break}if(!r(W)){B+=1,V&&Y&&u?.restoreQueuedSpawn(Y),M+=a.vent(.25);break}if(!V&&!a.consumeTrigger()){B+=1;break}_+=1,m=Math.max(0,m-h),Y&&u?.onSpawnResolved?.(Y,{usedQueue:V})}return{spawned:_,blockedByUpkeep:T,blockedByPosition:N,blockedByRoster:O,failedSpawns:B,ventedHeat:M,remainingUpkeep:m}}function lh(t,a=0){return Number.isFinite(t)?t:a}function yC(t){const a=Math.max(0,lh(t.dt,0)),{addedHeat:s,cooledHeat:r}=t.heat.advance(a);let l=0;for(const S of t.units){if(S.isDead()||S.faction!=="player")continue;const M=Math.max(0,lh(t.getUnitUpkeep(S),0));M>0&&(l+=M)}const u=5;let h=Math.max(0,lh(t.sauna.beerUpkeepAccumulator,0)),m=0;if(l>0){if(h+=a,h>=u){const S=Math.floor(h/u);m=l*S,h-=S*u}}else h=0;t.sauna.beerUpkeepAccumulator=h,m>0&&t.state.addResource(re.SAUNA_BEER,-m);const p=t.state.getResource(re.SAUNA_BEER),g=gC({heat:t.heat,availableUpkeep:p,pickSpawnTile:t.pickSpawnTile,spawnUnit:t.spawnBaseUnit,minUpkeepReserve:t.minUpkeepReserve,maxSpawns:t.maxSpawns,rosterCap:t.rosterCap,getRosterCount:t.getRosterCount,tierHelpers:t.tierHelpers}),y=t.heat.getCooldownSeconds(),v=t.heat.timeUntilNextTrigger();return t.sauna.heat=t.heat.getHeat(),t.sauna.playerSpawnThreshold=t.heat.getThreshold(),t.sauna.playerSpawnCooldown=Number.isFinite(y)?y:0,t.sauna.playerSpawnTimer=Number.isFinite(v)?v:0,t.sauna.heatPerTick=t.heat.getBuildRate(),{addedHeat:s,cooledHeat:r,upkeepDrain:m,spawn:g,beerRemaining:t.state.getResource(re.SAUNA_BEER),availableUpkeep:g.remainingUpkeep}}function bC(){try{return globalThis.localStorage??null}catch(t){return console.warn("Unable to access localStorage for inventory persistence",t),null}}function vC(t,a){const s=t.getItem(a);if(s)try{return JSON.parse(s)}catch(r){console.warn(`Failed to parse persisted inventory for "${a}", clearing.`,r),t.removeItem(a);return}}function Tc(t,a,s){const r=Number.isFinite(t.quantity)?t.quantity:1,l=Math.max(1,Math.round(r)),u=typeof t.rarity=="string"?t.rarity.trim():void 0,f=typeof t.icon=="string"?t.icon:void 0,h=typeof t.description=="string"?t.description:void 0;return{id:t.id,name:t.name,description:h,icon:f,rarity:u,quantity:l,acquiredAt:a,sourceTableId:s?.tableId,sourceEntryId:s?.entryId}}class SC{listeners=new Set;storageKey;now;maxStashSize;storage;autoEquip;stash=[];inventory=[];constructor(a={}){this.storageKey=a.storageKey??"autobattles:inventory",this.now=typeof a.now=="function"?a.now:()=>Date.now(),this.maxStashSize=Math.max(1,Math.floor(a.maxStashSize??24)),this.storage=bC(),this.autoEquip=a.autoEquip??!0,this.load()}load(){if(!this.storage)return;const a=vC(this.storage,this.storageKey);if(a){if(typeof a.autoEquip=="boolean"&&(this.autoEquip=a.autoEquip),Array.isArray(a.stash)){const s=[];for(const r of a.stash){if(!r||typeof r!="object")continue;const{id:l,name:u,quantity:f}=r;if(typeof l!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(Tc({id:l,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.stash=s.slice(0,this.maxStashSize)}if(Array.isArray(a.inventory)){const s=[];for(const r of a.inventory){if(!r||typeof r!="object")continue;const{id:l,name:u,quantity:f}=r;if(typeof l!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(Tc({id:l,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.inventory=s}}}persist(){if(!this.storage)return;const a={autoEquip:this.autoEquip,stash:this.stash.map(s=>({...s})),inventory:this.inventory.map(s=>({...s}))};try{this.storage.setItem(this.storageKey,JSON.stringify(a))}catch(s){console.warn("Failed to persist inventory state",s)}}emit(a){for(const s of this.listeners)s(a)}normalizeEquipResult(a){return typeof a=="boolean"?{success:a}:!a||typeof a!="object"?{success:!1}:{success:!!a.success,comparison:a.comparison,reason:a.reason}}on(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}isAutoEquipEnabled(){return this.autoEquip}setAutoEquip(a){this.autoEquip!==a&&(this.autoEquip=a,this.persist(),this.emit({type:"settings-updated",autoEquip:this.autoEquip}))}getStash(){return this.stash.map(a=>({...a}))}getStashSize(){return this.stash.length}getInventory(){return this.inventory.map(a=>({...a}))}getInventorySize(){return this.inventory.length}addLoot(a,s={}){return this.addItem({...a.item},{...s,sourceTableId:s.sourceTableId,sourceEntryId:s.sourceEntryId??a.entryId})}addItem(a,s={}){const r=Math.max(0,Math.round(this.now())),l=Tc(a,r,{tableId:s.sourceTableId,entryId:s.sourceEntryId}),u=s.autoEquip??this.autoEquip;let f={success:!1};if(u&&s.unitId&&typeof s.equip=="function"){try{f=this.normalizeEquipResult(s.equip(s.unitId,l))}catch(h){console.warn("Failed to auto-equip inventory item",{item:l,error:h}),f={success:!1}}if(f.success)return this.persist(),this.emit({type:"item-acquired",item:l,equipped:!0,location:"equipped",unitId:s.unitId,stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:l,equipped:!0,location:"equipped"}}if(this.stash.push(l),this.stash.length>this.maxStashSize){const h=this.stash.splice(0,this.stash.length-this.maxStashSize);h.length>0&&console.warn("Inventory stash full, trimming oldest items",h)}return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-acquired",item:l,equipped:!1,unitId:s.unitId,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:l,equipped:!1,location:"stash",stashIndex:this.stash.length-1}}equipFromStash(a,s,r){if(a<0||a>=this.stash.length)return!1;const l=this.stash[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,l))}catch(h){console.warn("Failed to equip stash item",{item:l,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}equipFromInventory(a,s,r){if(a<0||a>=this.inventory.length)return!1;const l=this.inventory[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,l))}catch(h){console.warn("Failed to equip inventory item",{item:l,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}moveToInventory(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.inventory.push(s),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-moved",item:s,from:"stash",to:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}moveToStash(a){if(this.stash.length>=this.maxStashSize||a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.stash.push(s),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-moved",item:s,from:"inventory",to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}discardFromInventory(a){if(a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-discarded",item:s,location:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}unequipToStash(a,s,r){if(this.stash.length>=this.maxStashSize)return!1;let l=null;try{l=r(a,s)??null}catch(h){console.warn("Failed to unequip item",{unitId:a,slot:s,error:h}),l=null}if(!l)return!1;const u=Math.max(0,Math.round(this.now())),f=Tc(l,u);return this.stash.push(f),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-unequipped",item:f,unitId:a,slot:s,to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),!0}discardFromStash(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-discarded",item:s,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}}const Ib={toast:990},EC={stash:"Quartermaster Stash",inventory:"Ready Inventory"},MC={stash:"Your stash is empty. Conquer enemy elites to gather new equipment.",inventory:"No gear staged. Move items into the ready inventory for quick equipping."},xC={mythic:6,legendary:5,epic:4,rare:3,uncommon:2,common:1},wC=["health","attackDamage","attackRange","movementRange","defense","shield"],AC={"birch-sap-satchel":["healing","support"],"steamed-bandages":["restoration","shielding"],"aurora-distillate":["damage","defense"],"stolen-sauna-tokens":["mobility"],"midnight-bloodwine":["healing","damage"],"sauna-incense":["range","focus"],"glacier-brand":["damage"],"emberglass-arrow":["damage","range"],"aurora-lattice":["damage","range"],"emberglass-shard":["damage","mobility"],"windstep-totem":["mobility","defense"],"searing-chant-censer":["damage","shielding"],"cracked-ice-amulet":["defense"],"myrsky-charm":["range","defense"],"frostwyrm-signet":["shielding"],"spirit-oak-charm":["healing","defense"]};function Ua(t){return(t??"").trim().toLowerCase()}function ch(t){const a=new Set;for(const s of t){const r=Ua(s);r&&a.add(r)}return a}function uh(t,a){return{id:t.id,name:t.name,quantity:typeof a=="number"?a:t.quantity,rarity:t.rarity}}function Rc(t){return t?{id:t.id,name:t.name,quantity:t.quantity,rarity:t.rarity}:null}function jb(t){return AC[t]??[]}function Gb(t){const a=Ua(t)||"common",s=a.charAt(0).toUpperCase()+a.slice(1);return{key:a,label:s,rank:xC[a]??0}}function CC(t){const a=Fo(t.id);if(!a){const l=Gb(t.rarity);return{slot:null,slotLabel:"Unassigned",rarity:l.key,rarityRank:l.rank,tags:jb(t.id),acquiredAt:t.acquiredAt}}const s=Go(a.slot),r=Gb(t.rarity);return{slot:a.slot,slotLabel:s.label,rarity:r.key,rarityRank:r.rank,tags:jb(t.id),acquiredAt:t.acquiredAt}}function _C(t,a,s,r,l){return{id:t.id,name:t.name,description:t.description,icon:t.icon,rarity:t.rarity,quantity:l,slot:a,maxStacks:s,modifiers:r??{}}}function Fb(t,a){const s=t[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function TC(t,a){const s=Fo(t.item.id);if(!s)return{slot:null,canEquip:!1,reason:"unknown-item",equipped:null,projected:uh(t.item),stats:[]};const r=s.slot,l=Go(r),u=a.loadout.find(T=>T.slot===r)??null,f=Math.max(1,Math.round(t.item.quantity)),h=Math.max(1,Math.floor(s.maxStacks??l.maxStacks)),m=(u?.quantity??0)+f,p=m>h;if(u&&u.id!==t.item.id)return{slot:r,canEquip:!1,reason:"slot-occupied",equipped:Rc(u),projected:uh(t.item),stats:[]};if(p&&(!u||u.id!==t.item.id))return{slot:r,canEquip:!1,reason:"stack-limit",equipped:Rc(u),projected:uh(t.item,Math.min(h,m)),stats:[]};const g=Math.min(h,m),y=[];for(const T of a.loadout)T.slot!==r&&y.push({...T});const v=u&&u.id===t.item.id?{...u,quantity:g}:_C(t.item,r,h,s.modifiers,g);y.push(v);const S=a.currentStats??Xc(a.baseStats,a.loadout),M=Xc(a.baseStats,y),_=wC.map(T=>{const N=Fb(S,T),O=Fb(M,T);return{stat:T,current:N,projected:O,delta:O-N}});return{slot:r,canEquip:!0,equipped:Rc(u),projected:Rc(v),stats:_}}function $b(t,a){return t.map((s,r)=>({item:s,index:r,location:a,metadata:CC(s)}))}function RC(t,a){const s=new Map,r=new Map,l=new Map;for(const m of t){const{metadata:p}=m;if(p.slot){const S=p.slot,M=s.get(S);M?M.count+=1:s.set(S,{label:p.slotLabel,count:1})}const g=p.rarity,y=g.charAt(0).toUpperCase()+g.slice(1),v=r.get(g);v?v.count+=1:r.set(g,{label:y,count:1,rank:p.rarityRank});for(const S of p.tags){const M=Ua(S);if(!M)continue;const _=S.split(/[-_]/g).map(N=>N.charAt(0).toUpperCase()+N.slice(1)).join(" "),T=l.get(M);T?T.count+=1:l.set(M,{label:_,count:1})}}const u=Array.from(s.entries()).sort((m,p)=>{const g=cr.indexOf(m[0]),y=cr.indexOf(p[0]);return g-y}).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.slots.has(Ua(m))})),f=Array.from(r.entries()).sort((m,p)=>(p[1].rank??0)-(m[1].rank??0)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.rarities.has(Ua(m))})),h=Array.from(l.entries()).sort((m,p)=>m[1].label.localeCompare(p[1].label)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.tags.has(Ua(m))}));return{slots:u,rarities:f,tags:h}}function NC(t,a){if(a.slots.size>0){const s=t.metadata.slot?Ua(t.metadata.slot):"";if(!s||!a.slots.has(s))return!1}return!(a.rarities.size>0&&!a.rarities.has(t.metadata.rarity)||a.tags.size>0&&!t.metadata.tags.map(l=>Ua(l)).some(l=>a.tags.has(l)))}function kC(t,a){return a?[t.item.name,t.item.description??"",t.metadata.tags.join(" ")].join(" ").toLowerCase().includes(a):!0}function DC(t,a){switch(a){case"oldest":t.sort((s,r)=>s.metadata.acquiredAt-r.metadata.acquiredAt);break;case"rarity":t.sort((s,r)=>r.metadata.rarityRank!==s.metadata.rarityRank?r.metadata.rarityRank-s.metadata.rarityRank:r.metadata.acquiredAt-s.metadata.acquiredAt);break;case"name":t.sort((s,r)=>s.item.name.localeCompare(r.item.name));break;case"newest":default:t.sort((s,r)=>r.metadata.acquiredAt-s.metadata.acquiredAt);break}}function Yb(t){const a={slots:ch(t.filters.slots??new Set),rarities:ch(t.filters.rarities??new Set),tags:ch(t.filters.tags??new Set)},s=Ua(t.search),r=Math.max(1,Math.floor(t.page||1)),l=Math.max(1,Math.floor(t.pageSize||24)),u=t.collection??"stash",f=$b(t.stash,"stash"),h=$b(t.inventory,"inventory"),m=[...f,...h],p=RC(m,a),g=u==="stash"?f:h,v=[...g.filter(B=>NC(B,a)&&kC(B,s))];DC(v,t.sort??"newest");const S=Math.min(v.length,r*l),M=v.slice(0,S),_=v.length>S,T=t.comparisonContext??null,N=M.map(B=>({item:B.item,index:B.index,location:B.location,metadata:B.metadata,comparison:T?TC(B,T):null})),O=["stash","inventory"].map(B=>({id:B,label:EC[B],count:B==="stash"?t.stash.length:t.inventory.length,active:B===u}));return{collection:u,collections:O,filters:p,items:N,total:g.length,filteredTotal:v.length,search:t.search,sort:t.sort??"newest",hasMore:_,emptyMessage:MC[u]}}function LC(){return{slots:new Set,rarities:new Set,tags:new Set}}const UC="_panel_7op0d_1",OC="_header_7op0d_32",qC="_title_7op0d_42",zC="_meta_7op0d_49",BC="_close_7op0d_54",HC="_controls_7op0d_74",IC="_settings_7op0d_82",jC="_settingRow_7op0d_93",GC="_settingCopy_7op0d_107",FC="_settingLabel_7op0d_114",$C="_settingHint_7op0d_120",YC="_settingControl_7op0d_127",VC="_settingState_7op0d_133",XC="_settingInput_7op0d_143",KC="_settingSwitch_7op0d_149",QC="_settingTrack_7op0d_169",PC="_settingThumb_7op0d_181",ZC="_collections_7op0d_197",JC="_collectionButton_7op0d_205",WC="_searchRow_7op0d_234",e5="_search_7op0d_234",t5="_searchIcon_7op0d_266",n5="_sortSelect_7op0d_276",a5="_body_7op0d_286",i5="_grid_7op0d_292",s5="_empty_7op0d_301",r5="_footer_7op0d_312",o5="_loadMore_7op0d_317",Oe={panel:UC,header:OC,title:qC,meta:zC,close:BC,controls:HC,settings:IC,settingRow:jC,settingCopy:GC,settingLabel:FC,settingHint:$C,settingControl:YC,settingState:VC,settingInput:XC,settingSwitch:KC,settingTrack:QC,settingThumb:PC,collections:ZC,collectionButton:JC,searchRow:WC,search:e5,searchIcon:t5,sortSelect:n5,body:a5,grid:i5,empty:s5,footer:r5,loadMore:o5},l5="_group_18afl_1",c5="_label_18afl_11",u5="_row_18afl_19",d5="_chip_18afl_25",f5="_count_18afl_55",Do={group:l5,label:c5,row:u5,chip:d5,count:f5},h5="_card_1o0cv_1",m5="_header_1o0cv_26",p5="_icon_1o0cv_32",g5="_details_1o0cv_44",y5="_titleRow_1o0cv_51",b5="_title_1o0cv_51",v5="_rarity_1o0cv_63",S5="_slot_1o0cv_70",E5="_tags_1o0cv_75",M5="_tag_1o0cv_75",x5="_compare_1o0cv_91",w5="_tooltip_1o0cv_113",A5="_statList_1o0cv_144",C5="_stat_1o0cv_144",_5="_actions_1o0cv_169",T5="_action_1o0cv_169",R5="_primary_1o0cv_198",N5="_danger_1o0cv_209",k5="_badge_1o0cv_224",ct={card:h5,header:m5,icon:p5,details:g5,titleRow:y5,title:b5,rarity:v5,slot:S5,tags:E5,tag:M5,compare:x5,tooltip:w5,statList:A5,stat:C5,actions:_5,action:T5,primary:R5,danger:N5,badge:k5},D5={health:"HP",attackDamage:"ATK",attackRange:"Range",movementRange:"Move",defense:"Defense",shield:"Shield"},Vb={"slot-occupied":"Slot occupied. Unequip the current item first.","stack-limit":"Stack limit reached for this item.","unknown-item":"This item cannot be equipped yet."},Bc=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function L5(t,a){if(a.item.icon){const r=document.createElement("img");r.src=a.item.icon,r.alt="",r.loading="lazy",r.decoding="async",r.width=48,r.height=48,t.appendChild(r);return}const s=document.createElement("span");s.textContent=a.item.name.trim()[0]?.toUpperCase()??"?",t.appendChild(s)}function wv(t){if(!(!t||t.canEquip))return t.reason&&Vb[t.reason]?Vb[t.reason]:"Unable to equip this item right now."}function U5(t,a){const s=document.createElement("div");s.className=ct.tooltip;const r=document.createElement("h4");if(a.projected?r.textContent=a.canEquip?"Projected stats":"Current loadout":r.textContent="Stats",s.appendChild(r),!a.canEquip){const u=wv(a);if(u){const f=document.createElement("p");f.textContent=u,f.style.margin="0 0 0.5rem",f.style.fontSize="0.78rem",s.appendChild(f)}}const l=document.createElement("ul");l.className=ct.statList;for(const u of t){const f=document.createElement("li");f.className=ct.stat,u.delta>0?f.dataset.delta="positive":u.delta<0&&(f.dataset.delta="negative");const h=document.createElement("span");h.textContent=D5[u.stat]??u.stat;const m=document.createElement("span"),p=Bc.format(u.current),g=Bc.format(u.projected),y=u.delta,v=y===0?"±0":`${y>0?"+":"−"}${Bc.format(Math.abs(y))}`;m.textContent=`${p} → ${g} (${v})`,f.append(h,m),l.appendChild(f)}return s.appendChild(l),s}function O5(t){const a=t.comparison;if(!a)return null;const s=document.createElement("div"),r=document.createElement("button");r.type="button",r.className=ct.compare,r.textContent=a.canEquip?"Compare stats":"View details";const l=`${t.item.id}-compare-${t.location}-${t.index}`;r.setAttribute("aria-controls",l),r.setAttribute("aria-expanded","false"),r.setAttribute("aria-describedby",l),r.addEventListener("focus",()=>{r.setAttribute("aria-expanded","true")}),r.addEventListener("blur",()=>{r.setAttribute("aria-expanded","false")}),s.appendChild(r);const u=U5(a.stats,a);return u.id=l,s.appendChild(u),s}function q5(t,a){if(a&&!a.canEquip){t.disabled=!0;const s=wv(a);s&&(t.title=s)}}function z5(t){return t.map(a=>{const s=a.trim();return s&&s.split(/[-_\s]/g).map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")})}function B5(t,a,s){const r=document.createElement("div");r.className=ct.actions;const l=document.createElement("button");l.type="button",l.className=`${ct.action} ${ct.primary}`,l.textContent="Equip",q5(l,a.comparison),l.addEventListener("click",()=>{s.onEquip?.()}),r.appendChild(l);const u=document.createElement("button");u.type="button",u.className=ct.action,u.textContent=a.location==="stash"?"Send to inventory":"Return to stash",u.addEventListener("click",()=>{s.onTransfer?.()}),r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=`${ct.action} ${ct.danger}`,f.textContent="Trash";let h=null;const m=()=>{h!==null&&(window.clearTimeout(h),h=null),f.dataset.confirm="false",f.textContent="Trash"};f.addEventListener("click",()=>{if(h!==null){m(),s.onTrash?.();return}f.dataset.confirm="true",f.textContent="Confirm trash",h=window.setTimeout(()=>{m()},2600)}),r.appendChild(f),t.appendChild(r)}function H5(t,a){const s=document.createElement("li");s.className=ct.card,s.dataset.location=t.location,s.setAttribute("role","listitem");const r=document.createElement("div");r.className=ct.header;const l=document.createElement("div");l.className=ct.icon,L5(l,t),r.appendChild(l);const u=document.createElement("div");u.className=ct.details;const f=document.createElement("div");f.className=ct.titleRow;const h=document.createElement("h4");h.className=ct.title,h.textContent=t.item.name,f.appendChild(h);const m=document.createElement("span");m.className=ct.rarity,m.textContent=t.metadata.rarity.toUpperCase(),f.appendChild(m),u.appendChild(f);const p=document.createElement("span");if(p.className=ct.slot,p.textContent=t.metadata.slot?t.metadata.slotLabel:"No slot",u.appendChild(p),t.metadata.tags.length>0){const y=document.createElement("div");y.className=ct.tags;for(const v of z5(t.metadata.tags)){const S=document.createElement("span");S.className=ct.tag,S.textContent=v,y.appendChild(S)}u.appendChild(y)}const g=O5(t);if(g&&u.appendChild(g),r.appendChild(u),s.appendChild(r),t.item.quantity>1){const y=document.createElement("span");y.className=ct.badge,y.textContent=`×${Bc.format(t.item.quantity)}`,s.appendChild(y)}return B5(s,t,a),s}const I5={newest:"Newest",oldest:"Oldest",rarity:"Rarity",name:"Name A-Z"};function dh(t){const a=document.createElement("div");a.className=Do.row;const s=document.createElement("div");s.className=Do.label,s.textContent=t;const r=document.createElement("div");return r.className=Do.group,a.append(s,r),{row:a,group:r}}function j5(t){const a=document.createElement("section");a.className=Oe.panel,a.tabIndex=-1,a.dataset.open="false",a.setAttribute("aria-label","Quartermaster stash");const s=document.createElement("header");s.className=Oe.header;const r=document.createElement("div"),l=document.createElement("h2");l.className=Oe.title,l.textContent="Quartermaster Stash",r.appendChild(l);const u=document.createElement("div");u.className=Oe.meta,u.textContent="Loading…",r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=Oe.close,f.textContent="Close",f.addEventListener("click",()=>t.onClose?.()),s.append(r,f),a.appendChild(s);const h=document.createElement("div");h.className=Oe.controls;const m=document.createElement("div");m.className=Oe.collections;const p={stash:document.createElement("button"),inventory:document.createElement("button")};p.stash.type="button",p.stash.className=Oe.collectionButton,p.stash.textContent="Stash",p.stash.addEventListener("click",()=>t.onCollectionChange?.("stash")),p.inventory.type="button",p.inventory.className=Oe.collectionButton,p.inventory.textContent="Ready",p.inventory.addEventListener("click",()=>t.onCollectionChange?.("inventory")),m.append(p.stash,p.inventory),h.appendChild(m);const g=document.createElement("div");g.className=Oe.searchRow;const y=document.createElement("div");y.className=Oe.search;const v=document.createElement("input");v.type="search",v.placeholder="Search stash…",v.addEventListener("input",()=>t.onSearchChange?.(v.value));const S=document.createElement("span");S.className=Oe.searchIcon,S.textContent="🔍",y.append(S,v),g.appendChild(y);const M=document.createElement("select");M.className=Oe.sortSelect,["newest","oldest","rarity","name"].forEach(I=>{const ae=document.createElement("option");ae.value=I,ae.textContent=I5[I],M.appendChild(ae)}),M.addEventListener("change",()=>t.onSortChange?.(M.value)),g.appendChild(M),h.appendChild(g);const _=document.createElement("div");_.className=Oe.settings;const T=(I,ae,$,L)=>{const P=document.createElement("div");P.className=Oe.settingRow;const le=document.createElement("div");le.className=Oe.settingCopy;const ee=document.createElement("span");ee.className=Oe.settingLabel,ee.textContent=ae,le.appendChild(ee);const x=document.createElement("p");x.className=Oe.settingHint,x.textContent=$,le.appendChild(x);const w=document.createElement("div");w.className=Oe.settingControl;const z=document.createElement("span");z.className=Oe.settingState,z.textContent="Off";const K=document.createElement("input");K.type="checkbox",K.id=I,K.className=Oe.settingInput;const oe=document.createElement("label");oe.className=Oe.settingSwitch,oe.htmlFor=I,oe.dataset.state="off";const de=document.createElement("span");de.className=Oe.settingTrack;const ue=document.createElement("span");ue.className=Oe.settingThumb,oe.append(de,ue);const ve=ge=>{K.checked=ge,oe.dataset.state=ge?"on":"off",z.textContent=ge?"On":"Off"};return K.addEventListener("change",()=>{ve(K.checked),L?.(K.checked)}),w.append(z,K,oe),P.append(le,w),{root:P,setChecked:ve}},N=T("inventory-autoequip-toggle","Auto-equip loot","Try outfitting the selected attendant as soon as new gear arrives.",I=>t.onAutoEquipChange?.(I)),O=T("inventory-ui-variant-toggle","Experimental HUD","Swap to the React/Tailwind HUD. You can revert at any time.",I=>t.onUiV2Change?.(I));N.setChecked(t.getAutoEquipState?.()??!1),O.setChecked(t.getUiV2State?.()??!1),_.append(N.root,O.root),h.appendChild(_);const B=document.createElement("div"),Y={slots:dh("Slots"),rarities:dh("Rarity"),tags:dh("Tags")};B.append(Y.slots.row,Y.rarities.row,Y.tags.row),h.appendChild(B),a.appendChild(h);const X=document.createElement("div");X.className=Oe.body;const V=document.createElement("ul");V.className=Oe.grid;const W=document.createElement("div");W.className=Oe.empty,W.textContent="No items match the current filters.",W.hidden=!0,X.append(V,W),a.appendChild(X);const ne=document.createElement("div");ne.className=Oe.footer;const F=document.createElement("button");F.type="button",F.className=Oe.loadMore,F.textContent="Show more",F.addEventListener("click",()=>t.onLoadMore?.()),ne.appendChild(F),a.appendChild(ne);function H(I,ae,$){I.group.innerHTML="",I.row.hidden=$.length===0;for(const L of $){const P=document.createElement("button");if(P.type="button",P.className=Do.chip,P.dataset.active=L.active?"true":"false",P.textContent=L.label,L.count>0){const le=document.createElement("span");le.className=Do.count,le.textContent=String(L.count),P.appendChild(le)}P.addEventListener("click",()=>t.onFilterToggle?.(ae,L.id)),I.group.appendChild(P)}}function C(I){V.replaceChildren();const ae=document.createDocumentFragment();for(const $ of I.items){const L={onEquip:()=>t.onItemEquip?.($),onTransfer:()=>t.onItemTransfer?.($),onTrash:()=>t.onItemTrash?.($)};ae.appendChild(H5($,L))}V.appendChild(ae),W.hidden=I.filteredTotal!==0,W.hidden||(W.textContent=I.emptyMessage)}return{element:a,render(I){u.textContent=I.total===0?"No items yet":`${I.filteredTotal} of ${I.total} item${I.total===1?"":"s"}`;for(const[ae,$]of Object.entries(p))$.dataset.active=ae===I.collection?"true":"false";v.value!==I.search&&(v.value=I.search),M.value!==I.sort&&(M.value=I.sort),H(Y.slots,"slots",I.filters.slots),H(Y.rarities,"rarities",I.filters.rarities),H(Y.tags,"tags",I.filters.tags),C(I),F.hidden=!I.hasMore},setOpen(I){a.dataset.open=I?"true":"false"},focus(){const I=a.focus.bind(a);try{I({preventScroll:!0})}catch(ae){console.warn("Stash panel focus without scroll prevention fallback",ae);try{I()}catch($){console.warn("Unable to focus stash panel element",$)}}},destroy(){a.remove()},setAutoEquip(I){N.setChecked(I)},setUiV2(I){O.setChecked(I)}}}const G5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23a4d67a'%20/%3e%3cpolygon%20points='16,48%2032,16%2048,48'%20fill='%23d2691e'%20/%3e%3crect%20x='24'%20y='32'%20width='16'%20height='16'%20fill='%23f4a460'%20/%3e%3c/svg%3e",F5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23c0c0c0'%20/%3e%3crect%20x='8'%20y='24'%20width='48'%20height='24'%20fill='%23808080'%20/%3e%3crect%20x='24'%20y='16'%20width='16'%20height='8'%20fill='%23606060'%20/%3e%3c/svg%3e",$5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23e0e0e0'%20/%3e%3crect%20x='10'%20y='22'%20width='12'%20height='30'%20fill='%23a9a9a9'%20/%3e%3crect%20x='26'%20y='14'%20width='12'%20height='38'%20fill='%23808080'%20/%3e%3crect%20x='42'%20y='26'%20width='12'%20height='26'%20fill='%23a9a9a9'%20/%3e%3c/svg%3e",Y5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%238b4513'%20/%3e%3cpolygon%20points='32,10%2042,22%2022,22'%20fill='%23555'%20/%3e%3crect%20x='30'%20y='22'%20width='4'%20height='32'%20fill='%23ccc'%20/%3e%3c/svg%3e",V5="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eAuric%20Warder%3c/title%3e%3cdesc%20id='desc'%3eRunic%20soldier%20with%20aurora-lit%20shield,%20sculpted%20armor,%20and%20crystalline%20broadsword.%3c/desc%3e%3cdefs%3e%3clinearGradient%20id='soldier-panel'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23091522'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23102a46'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-halo'%20cx='52%25'%20cy='18%25'%20r='68%25'%3e%3cstop%20offset='0%25'%20stop-color='rgba(186,%20230,%20253,%200.92)'%20/%3e%3cstop%20offset='45%25'%20stop-color='rgba(59,%20130,%20246,%200.42)'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(15,%2023,%2042,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-armor'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='55%25'%20stop-color='%23cbd5f5'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23475569'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-gold'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20/%3e%3cstop%20offset='45%25'%20stop-color='%23fbbf24'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f97316'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-cloak'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%231d4ed8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-shield'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23bfdbfe'%20/%3e%3cstop%20offset='65%25'%20stop-color='%2360a5fa'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231d4ed8'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-shield-core'%20cx='40%25'%20cy='40%25'%20r='45%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fef3c7'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(248,%20250,%20252,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-sword'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231f2937'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='128'%20height='128'%20rx='18'%20fill='url(%23soldier-panel)'%20/%3e%3ccircle%20cx='64'%20cy='40'%20r='46'%20fill='url(%23soldier-halo)'%20/%3e%3cellipse%20cx='64'%20cy='110'%20rx='34'%20ry='11'%20fill='%230f172a'%20opacity='0.45'%20/%3e%3cpath%20d='M34%2038c-8%2015-11%2034-6%2052l18%2010c-2-22%206-40%2020-50-12-4-22-8-32-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.88'%20/%3e%3cpath%20d='M94%2038c8%2015%2011%2034%206%2052l-18%2010c2-22-6-40-20-50%2012-4%2022-8%2032-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.68'%20/%3e%3cpath%20d='M58%2018l-12%2014c-5%207-8%2017-8%2028v20l14%2042h24l14-42V60c0-11-3-21-8-28L70%2018H58z'%20fill='url(%23soldier-armor)'%20stroke='%231f2937'%20stroke-width='2.4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M46%2060h36l6%2016c-10%2010-20%2016-24%2016s-14-6-24-16l6-16z'%20fill='%23e0f2fe'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2024c-7%200-14%205-20%2012l8%2010c8-6%2024-6%2032%200l8-10c-6-7-13-12-20-12z'%20fill='%23f8fafc'%20stroke='%23cbd5f5'%20stroke-width='2'%20/%3e%3cpath%20d='M56%2016h16l6%208-14%208-14-8%206-8z'%20fill='%23e2e8f0'%20stroke='%2394a3b8'%20stroke-width='1.8'%20/%3e%3cpath%20d='M52%2074h12l2%2020-10%2012-10-12%206-20z'%20fill='url(%23soldier-gold)'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2096l10%2010%2010-12-6-20H66l-2%2022z'%20fill='%23fef3c7'%20opacity='0.72'%20/%3e%3cpath%20d='M32%2068l-12%206%2014%2032%2016-8-18-30z'%20fill='url(%23soldier-shield)'%20stroke='%231e3a8a'%20stroke-width='2.2'%20/%3e%3ccircle%20cx='36'%20cy='82'%20r='8'%20fill='url(%23soldier-shield-core)'%20/%3e%3cpath%20d='M96%2060l-6-6-22%2044%208%2010%2020-48z'%20fill='url(%23soldier-sword)'%20stroke='%230f172a'%20stroke-width='2.2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M86%2050l-18%2040%2012%206%2016-36-10-10z'%20fill='%23f8fafc'%20opacity='0.7'%20/%3e%3cpath%20d='M64%20102c-9%200-18%207-22%2016%208%206%2014%208%2022%208s14-2%2022-8c-4-9-13-16-22-16z'%20fill='%23dbeafe'%20stroke='%2393c5fd'%20stroke-width='1.6'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M58%2056h12l3%2010-9%206-9-6%203-10z'%20fill='%231f2937'%20opacity='0.85'%20/%3e%3ccircle%20cx='64'%20cy='58'%20r='7'%20fill='%23f1f5f9'%20stroke='%23cbd5f5'%20stroke-width='1.4'%20/%3e%3cpath%20d='M54%2044c-5%200-8%205-8%2012%206-3%2012-6%2018-6s12%203%2018%206c0-7-3-12-8-12H54z'%20fill='%230f172a'%20opacity='0.82'%20/%3e%3c/svg%3e",X5="/assets/archer-DIBoEfQj.svg",K5="/assets/avanto-marauder-B6bFdUJV.svg",Ps="/",En={saunaBeer:`${Ps}assets/ui/sauna-beer.svg`,saunojaRoster:`${Ps}assets/ui/saunoja-roster.svg`,resource:`${Ps}assets/ui/resource.svg`,sisu:`${Ps}assets/ui/resource.svg`,sound:`${Ps}assets/ui/sound.svg`,artocoin:`${Ps}assets/ui/artocoin.svg`},Q5={images:{placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=","building-farm":G5,"building-barracks":F5,"building-city":$5,"building-mine":Y5,"unit-soldier":V5,"unit-archer":X5,"unit-avanto-marauder":K5,"icon-sauna-beer":En.saunaBeer,"icon-saunoja-roster":En.saunojaRoster,"icon-resource":En.resource,"icon-sound":En.sound,"icon-artocoin":En.artocoin}};let Av=null;function P5(t){Av=t}function Cv(){return Av}const _v=new Intl.NumberFormat("en-US");function Z5(t){return _v.format(Math.max(0,Math.floor(Number.isFinite(t)?t:0)))}function fh(t){return _v.format(Math.max(0,Math.floor(Number.isFinite(t)?t:0)))}function J5(t){const a=t.callbacks??{},s=document.createElement("section");s.className="sauna-shop-panel pointer-events-auto flex w-[min(26rem,92vw)] flex-col gap-5 rounded-hud-xl border border-white/10 bg-[linear-gradient(145deg,rgba(20,27,41,0.95),rgba(33,44,66,0.9))] p-5 text-slate-100 shadow-[0_32px_68px_rgba(10,16,32,0.55)] backdrop-blur-[16px] backdrop-saturate-[140%] transition-transform duration-200 ease-out",s.tabIndex=-1,s.dataset.open="false",s.setAttribute("role","dialog"),s.setAttribute("aria-modal","true"),s.setAttribute("aria-label","Steamforge atelier"),s.setAttribute("aria-hidden","true"),s.setAttribute("inert","");const r=document.createElement("header");r.className="flex items-start justify-between gap-3";const l=document.createElement("div");l.className="flex flex-col gap-1";const u=document.createElement("h2");u.className="text-lg font-semibold tracking-wide text-sky-50",u.textContent="Steamforge Atelier",l.appendChild(u);const f=document.createElement("p");f.className="text-sm text-slate-300/85",f.textContent="Commission tier upgrades with artocoins earned in the field.",l.appendChild(f);const h=document.createElement("button");h.type="button",h.className="group inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/5 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.12em] text-slate-200 transition-colors duration-150 hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",h.textContent="Close",h.addEventListener("click",()=>a.onClose?.()),r.append(l,h),s.appendChild(r);const m=document.createElement("div");m.className="flex items-center justify-between rounded-hud-lg border border-white/12 bg-[linear-gradient(135deg,rgba(255,245,224,0.18),rgba(255,192,120,0.12))] px-4 py-3 text-sm text-slate-100 shadow-[inset_0_0_18px_rgba(255,180,90,0.08)]";const p=document.createElement("div");p.className="flex flex-col gap-0.5";const g=document.createElement("span");g.className="text-xs font-semibold uppercase tracking-[0.14em] text-slate-200/80",g.textContent="Artocoin balance",p.appendChild(g);const y=document.createElement("span");y.className="text-xl font-bold text-amber-200 drop-shadow-[0_0_12px_rgba(255,190,100,0.25)]",y.textContent="0",p.appendChild(y);const v=document.createElement("div");v.className="relative h-12 w-12 flex-shrink-0",v.setAttribute("aria-hidden","true");const S=document.createElement("img");S.src=En.artocoin,S.alt="",S.className="h-full w-full drop-shadow-[0_12px_18px_rgba(255,186,92,0.35)]",S.decoding="async",v.appendChild(S),m.append(p,v),s.appendChild(m);const M=document.createElement("div");M.className="flex flex-col gap-4",s.appendChild(M);const _=new Map;function T(V){const{tier:W}=V,ne=document.createElement("article");ne.className="relative overflow-hidden rounded-hud-lg border border-white/10 bg-[linear-gradient(135deg,rgba(24,30,46,0.86),rgba(42,56,78,0.9))] p-4 shadow-[0_16px_36px_rgba(10,16,32,0.4)] transition-transform duration-200 ease-out hover:-translate-y-1",ne.dataset.tierId=W.id;const F=document.createElement("div");F.className="pointer-events-none absolute inset-0 opacity-40",F.style.background=W.art.glow??"radial-gradient(circle at 20% 20%, rgba(255,255,255,0.18), transparent 70%)",ne.appendChild(F);const H=document.createElement("div");H.className="relative flex flex-col gap-3",ne.appendChild(H);const C=document.createElement("div");C.className="flex items-start justify-between gap-3",H.appendChild(C);const J=document.createElement("div");J.className="flex items-center gap-3",C.appendChild(J);const I=document.createElement("div");I.className="h-12 w-12 flex-shrink-0 overflow-hidden rounded-full border border-white/40 bg-slate-900/40 shadow-[0_8px_16px_rgba(0,0,0,0.35)]",I.style.backgroundImage=`url(${W.art.badge})`,I.style.backgroundSize="cover",I.style.backgroundPosition="center",I.setAttribute("aria-hidden","true"),J.appendChild(I);const ae=document.createElement("div");ae.className="flex flex-col gap-1",J.appendChild(ae);const $=document.createElement("h3");$.className="text-base font-semibold text-slate-50",$.textContent=W.name,ae.appendChild($);const L=document.createElement("span");L.className="text-xs font-medium uppercase tracking-[0.16em] text-slate-300/85",L.textContent=`Cap ${W.rosterCap}`,ae.appendChild(L);const P=document.createElement("span");P.className="rounded-full border border-white/20 bg-white/10 px-3 py-1 text-[0.7rem] font-semibold uppercase tracking-[0.2em] text-slate-200 shadow-[0_4px_10px_rgba(12,17,32,0.45)]",P.textContent="Locked",C.appendChild(P);const le=document.createElement("p");le.className="text-sm leading-relaxed text-slate-200/85",le.textContent=W.description,H.appendChild(le);const ee=document.createElement("div");ee.className="flex items-center justify-between gap-3",H.appendChild(ee);const x=document.createElement("span");x.className="text-sm font-semibold text-amber-200/90",x.textContent="—",ee.appendChild(x);const w=document.createElement("button");return w.type="button",w.className="group relative inline-flex items-center justify-center gap-2 rounded-full border border-amber-200/50 bg-[linear-gradient(135deg,rgba(255,200,120,0.9),rgba(255,157,66,0.92))] px-4 py-2 text-sm font-semibold uppercase tracking-[0.12em] text-slate-900 shadow-[0_12px_20px_rgba(255,168,74,0.35)] transition-all duration-150 ease-out hover:-translate-y-0.5 hover:shadow-[0_16px_28px_rgba(255,168,74,0.4)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-200",w.textContent="Unlock",ee.appendChild(w),w.addEventListener("click",()=>{if(!a.onPurchaseTier)return;const z=a.onPurchaseTier(W.id);if(z){if(z.success){const K=typeof V.status.cost=="number"?V.status.cost:W.unlock.type==="artocoin"?W.unlock.cost:0;a.emitToast?.(`${W.name} unlocked for ${fh(K)} artocoins.`,"success")}else z.reason==="insufficient-funds"?a.emitToast?.(`Need ${fh(z.shortfall??0)} more artocoins to commission ${W.name}.`,"warn"):z.reason==="already-owned"&&a.emitToast?.(`${W.name} is already unlocked.`,"info");O()}}),M.appendChild(ne),{root:ne,statusChip:P,description:le,rosterCap:L,actionButton:w,costLabel:x,status:V.status}}function N(V,W){const{tier:ne,status:F}=W;V.rosterCap.textContent=`Cap ${ne.rosterCap}`,V.description.textContent=ne.description,V.status=F,V.root.setAttribute("aria-label",`${ne.name} — ${F.requirementLabel}`),V.actionButton.title=F.requirementLabel,V.actionButton.setAttribute("aria-label",F.owned?`${ne.name} unlocked`:F.requirementLabel),V.root.dataset.state=F.owned?"owned":F.affordable?"ready":"locked",F.owned?(V.statusChip.textContent="Unlocked",V.statusChip.classList.add("bg-emerald-300/15","text-emerald-200"),V.statusChip.classList.remove("text-slate-200"),V.actionButton.disabled=!0,V.actionButton.textContent="Unlocked",V.actionButton.classList.add("cursor-not-allowed","opacity-60"),V.costLabel.textContent="Owned",V.costLabel.dataset.state="owned"):(V.statusChip.textContent=F.affordable?"Ready":"Locked",V.statusChip.classList.remove("bg-emerald-300/15","text-emerald-200"),V.statusChip.classList.add("text-slate-200"),V.actionButton.disabled=!F.affordable,V.actionButton.textContent=F.affordable?"Unlock now":"Insufficient",V.actionButton.classList.toggle("opacity-60",!F.affordable),V.actionButton.classList.toggle("cursor-not-allowed",!F.affordable),V.costLabel.textContent=F.cost?`${fh(F.cost)} artocoins`:"Included",V.costLabel.dataset.state=F.affordable?"ready":"locked")}function O(V){const W=V??t.getViewModel();y.textContent=Z5(W.balance),W.tiers.forEach(ne=>{const F=_.get(ne.tier.id);if(F){N(F,ne);return}const H=T(ne);_.set(ne.tier.id,H),N(H,ne)})}function B(V){s.dataset.open=V?"true":"false",s.setAttribute("aria-hidden",V?"false":"true"),V?s.removeAttribute("inert"):s.setAttribute("inert","")}function Y(){requestAnimationFrame(()=>{s.focus({preventScroll:!0})})}function X(){s.remove(),_.clear()}return O(),{element:s,setOpen:B,update:O,focus:Y,destroy:X}}const hh=24,W5=4500,e_=400,t_={health:"HP",attackDamage:"ATK",attackRange:"RNG",movementRange:"MOV",defense:"DEF",shield:"Shield"},Xb="pointer-events-none ml-auto flex w-full max-w-[min(22rem,90vw)] flex-col gap-[clamp(6px,1vw,12px)]",n_="pointer-events-auto flex w-full items-center gap-[clamp(4px,0.8vw,12px)] rounded-hud-md border border-[color:var(--hud-border)] px-4 py-3 text-[0.9rem] font-semibold leading-[1.35] shadow-hud-lg backdrop-blur-[14px] backdrop-saturate-[135%] transition-all duration-300 ease-out",a_={loot:"bg-[linear-gradient(140deg,color-mix(in_srgb,var(--color-surface-strong)_82%,rgba(15,23,42,0.18))_0%,color-mix(in_srgb,var(--color-accent-gold)_46%,var(--color-surface))_100%)] text-[color:color-mix(in_srgb,var(--color-foreground)_95%,rgba(255,250,235,0.12))]",info:"bg-[linear-gradient(140deg,color-mix(in_srgb,var(--color-surface-strong)_84%,rgba(12,22,38,0.2))_0%,color-mix(in_srgb,var(--color-accent-blue)_48%,var(--color-surface))_100%)] text-[color:color-mix(in_srgb,var(--color-foreground)_95%,rgba(224,247,255,0.1))]",warn:"bg-[linear-gradient(140deg,color-mix(in_srgb,var(--color-surface-strong)_82%,rgba(40,18,12,0.35))_0%,color-mix(in_srgb,var(--color-accent-red)_52%,var(--color-surface))_100%)] text-[color:color-mix(in_srgb,var(--color-foreground)_92%,rgba(255,234,221,0.22))]"},i_=["-translate-y-2","opacity-0"];function iu(t){t.hidden=t.childElementCount===0}function s_(t,a){const s=t.querySelector('[data-ui="loot-toast-stack"]');if(s)return s.parentElement!==a&&a.appendChild(s),s.className=Xb,s.style.zIndex=String(Ib.toast),iu(s),s;const l=(t.ownerDocument??document).createElement("div");return l.dataset.ui="loot-toast-stack",l.className=Xb,l.setAttribute("aria-live","polite"),l.setAttribute("role","status"),l.style.zIndex=String(Ib.toast),iu(l),a.appendChild(l),l}function It(t,a,s){const r=(t.ownerDocument??document).createElement("div");r.dataset.variant=s,r.className=`${n_} ${a_[s]}`,r.textContent=a,t.appendChild(r),iu(t);const l=()=>{r.remove(),iu(t)},u=window.setTimeout(()=>{r.classList.add(...i_),window.setTimeout(l,e_)},W5);r.addEventListener("click",()=>{window.clearTimeout(u),l()})}function r_(t,a){t.has(a)?t.delete(a):t.add(a)}function o_(t){const a=t.comparison?.deltas??[];return a.length===0?null:a.map(r=>{const l=t_[r.stat]??r.stat;return`${r.delta>0?"+":""}${r.delta} ${l}`}).join(", ")}function mh(t){switch(t){case"inventory":return"ready inventory";case"stash":return"stash";case"equipped":default:return"loadout"}}function l_(){const t=document.createElement("button");t.type="button",t.dataset.testid="inventory-badge",t.dataset.ui="inventory-badge",t.className="group inline-flex items-center gap-2 rounded-hud-pill border border-white/15 bg-[linear-gradient(135deg,rgba(27,36,56,0.9),rgba(39,74,110,0.9))] px-3.5 py-2 font-semibold text-sky-50 shadow-hud-sm transition-all duration-150 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent hover:-translate-y-0.5 hover:shadow-hud-md data-[autoequip=off]:bg-[linear-gradient(135deg,rgba(56,44,25,0.9),rgba(92,72,40,0.9))]",t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","inventory-stash-panel"),t.setAttribute("aria-label","Open quartermaster stash");const a=document.createElement("span");a.className="relative flex h-[1.65rem] w-[1.65rem] flex-shrink-0 items-center justify-center rounded-full bg-[radial-gradient(circle_at_30%_30%,rgba(255,255,255,0.9),rgba(225,235,255,0.2))] text-slate-900 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.35)]",a.setAttribute("aria-hidden","true");const s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg");r.setAttribute("viewBox","0 0 24 24"),r.setAttribute("aria-hidden","true"),r.setAttribute("focusable","false"),r.setAttribute("class","h-[76%] w-[76%]");const l=document.createElementNS(s,"path");l.setAttribute("d","M8.25 7V6a3.75 3.75 0 0 1 7.5 0v1m3 0h-14.25a1.5 1.5 0 0 0-1.485 1.342l-.75 9a3 3 0 0 0 2.985 3.158h9.78a3 3 0 0 0 2.985-3.158l-.75-9A1.5 1.5 0 0 0 18.75 7Z"),l.setAttribute("fill","rgba(194, 216, 255, 0.32)"),l.setAttribute("stroke","rgba(255, 255, 255, 0.92)"),l.setAttribute("stroke-width","1.6"),l.setAttribute("stroke-linecap","round"),l.setAttribute("stroke-linejoin","round");const u=document.createElementNS(s,"path");u.setAttribute("d","M9.75 12.25h4.5"),u.setAttribute("fill","none"),u.setAttribute("stroke","rgba(255, 255, 255, 0.85)"),u.setAttribute("stroke-width","1.4"),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("opacity","0.9"),r.append(l,u),a.appendChild(r),t.appendChild(a);const f=document.createElement("span");f.className="text-[0.75rem] uppercase tracking-[0.08em]",f.textContent="Stash",t.appendChild(f);const h=document.createElement("span");return h.className="min-w-[1.5rem] rounded-full bg-white/15 px-2 py-[0.1rem] text-center text-xs font-semibold text-white/90",h.textContent="0",h.setAttribute("aria-hidden","true"),t.appendChild(h),{button:t,count:h}}function c_(){const t=document.createElement("button");t.type="button",t.className="group inline-flex items-center gap-2 rounded-hud-pill border border-white/12 bg-[linear-gradient(135deg,rgba(44,32,18,0.92),rgba(68,48,24,0.95))] px-3.5 py-2 font-semibold text-amber-200 shadow-[0_14px_24px_rgba(17,12,6,0.55)] transition-all duration-150 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-300 hover:-translate-y-0.5 hover:shadow-[0_18px_28px_rgba(17,12,6,0.65)]",t.setAttribute("aria-expanded","false"),t.setAttribute("aria-label","Open artocoin shop");const a=document.createElement("span");a.className="relative flex h-[1.65rem] w-[1.65rem] flex-shrink-0 items-center justify-center rounded-full bg-[radial-gradient(circle_at_35%_30%,rgba(255,210,128,0.95),rgba(114,68,17,0.85))] shadow-[inset_0_0_0_1px_rgba(255,236,196,0.55)]",a.setAttribute("aria-hidden","true");const s=document.createElement("img");s.src=En.artocoin,s.alt="",s.decoding="async",s.className="h-[78%] w-[78%] drop-shadow-[0_10px_18px_rgba(255,186,92,0.4)]",a.appendChild(s);const r=document.createElement("span");return r.className="text-[0.75rem] uppercase tracking-[0.08em]",r.textContent="Shop",t.append(a,r),t}function u_(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{destroy:()=>{}};const{regions:r}=hr(s),l=r.top,u=s_(s,l);s.querySelector("#inventory-stash-panel")?.remove(),s.querySelector("#inventory-shop-panel")?.remove(),s.querySelectorAll('[data-testid="inventory-badge"]').forEach(w=>w.remove());const{button:f,count:h}=l_();f.dataset.autoequip=t.isAutoEquipEnabled()?"on":"off",l.appendChild(f);const m=new Intl.NumberFormat("en-US");let p=null,g=null,y=!1,v=null,S=null,M=()=>{};const _=w=>{if(!g||!w)return;const z=m.format(Math.max(0,Math.floor(Number.isFinite(w.balance)?w.balance:0)));g.dataset.balance=z,g.title=`Artocoins ${z}`;const K=w.tiers.some(de=>!de.status.owned&&de.status.affordable),oe=w.tiers.some(de=>!de.status.owned&&!de.status.affordable);g.dataset.state=K?"ready":oe?"locked":"complete"},T={success:"loot",info:"info",warn:"warn"};if(typeof a.getSaunaShopViewModel=="function"){const w=()=>a.getSaunaShopViewModel?.()??{balance:0,tiers:[]};g=c_(),g.dataset.state="locked",l.appendChild(g),p=J5({getViewModel:w,callbacks:{onClose:()=>M(!1),onPurchaseTier:de=>{const ue=a.onPurchaseSaunaTier;return ue?ue(de):{success:!1,balance:w().balance,purchased:new Set,reason:"unsupported"}},emitToast:(de,ue)=>{const ve=T[ue]??"info";It(u,de,ve)}}}),p.element.id="inventory-shop-panel",g.setAttribute("aria-controls","inventory-shop-panel"),s.appendChild(p.element);const oe=w();p.update(oe),_(oe),M=de=>{if(y!==de)if(y=de,p?.setOpen(de),g?.setAttribute("aria-expanded",de?"true":"false"),g?.setAttribute("aria-label",de?"Close artocoin shop":"Open artocoin shop"),de){F(!1),s.classList.add("inventory-shop-open");const ue=w();p?.update(ue),_(ue);try{p?.focus()}catch(ve){console.warn("Unable to focus artocoin shop",ve)}}else{s.classList.remove("inventory-shop-open");try{g?.focus({preventScroll:!0})}catch(ue){console.warn("Unable to restore focus to artocoin shop button",ue)}}},S=()=>M(!y),g.addEventListener("click",S),v=a.subscribeToSaunaShop?.(()=>{const de=w();p?.update(de),_(de)})}const O=j5({onClose:()=>F(!1),onCollectionChange:w=>{Y!==w&&(Y=w,ne=1,C())},onFilterToggle:(w,z)=>{const K=X[w];r_(K,z),ne=1,C()},onSearchChange:w=>{V=w,ne=1,C()},onSortChange:w=>{W=w,ne=1,C()},onLoadMore:()=>{ne+=1,C()},onItemEquip:w=>{I(w)},onItemTransfer:w=>{ae(w)},onItemTrash:w=>{$(w)},getAutoEquipState:()=>t.isAutoEquipEnabled(),onAutoEquipChange:w=>{t.setAutoEquip(w),f.dataset.autoequip=w?"on":"off",It(u,w?"Auto-equip enabled. Newly recovered gear will try to arm your selected attendant.":"Auto-equip disabled. Loot will head to the stash until you equip it manually.","info")},getUiV2State:()=>a.getUseUiV2?.()??!1,onUiV2Change:w=>{a.onUseUiV2Change?.(w),It(u,w?"Experimental HUD enabled. Reload to try the React/Tailwind experience.":"Classic HUD restored for your next session.","info")}});O.element.id="inventory-stash-panel",s.appendChild(O.element);let B=!1,Y="stash";const X=LC();let V="",W="newest",ne=1;function F(w){if(B!==w)if(B=w,O.setOpen(B),f.setAttribute("aria-expanded",B?"true":"false"),f.setAttribute("aria-label",B?"Close quartermaster stash":"Open quartermaster stash"),B){M(!1),s.classList.add("inventory-panel-open");try{O.focus()}catch(z){console.warn("Unable to focus stash panel",z)}}else s.classList.remove("inventory-panel-open")}function H(){const w=a.getComparisonContext?.()??null;let z=Yb({stash:t.getStash(),inventory:t.getInventory(),filters:X,search:V,sort:W,page:ne,pageSize:hh,collection:Y,comparisonContext:w});if(z.filteredTotal>0){const K=Math.max(1,Math.ceil(z.filteredTotal/hh));ne>K&&(ne=K,z=Yb({stash:t.getStash(),inventory:t.getInventory(),filters:X,search:V,sort:W,page:ne,pageSize:hh,collection:Y,comparisonContext:w}))}return z}function C(){const w=H(),K=w.collections.find(oe=>oe.id==="stash")?.count??0;h.textContent=String(K),f.dataset.count=String(K),O.render(w)}function J(){const w=a.getSelectedUnitId?.()??null;return w||(It(u,"Select an attendant before equipping an item.","warn"),null)}function I(w){const z=J();if(!z)return;const K=a.onEquip??(()=>({success:!1}));(w.location==="stash"?t.equipFromStash(w.index,z,(ue,ve)=>K(ue,ve,"stash")):t.equipFromInventory(w.index,z,(ue,ve)=>K(ue,ve,"inventory")))||It(u,"Unable to equip that item right now.","warn")}function ae(w){const z=w.location==="stash"?t.moveToInventory(w.index):t.moveToStash(w.index);if(!z){It(u,"Unable to move that item right now.","warn");return}const K=w.location==="stash"?"ready inventory":"stash";It(u,`Moved ${z.name} to the ${K}.`,"info"),ne=1,C()}function $(w){const z=w.location==="stash"?t.discardFromStash(w.index):t.discardFromInventory(w.index);if(!z){It(u,"That item was already removed.","warn");return}const K=w.location==="stash"?"stash":"ready inventory";It(u,`${z.name} discarded from the ${K}.`,"warn"),C()}function L(w){switch(w.type){case"stash-updated":case"inventory-updated":C();break;case"item-acquired":if(w.equipped)It(u,`${w.item.name} auto-equipped successfully.`,"info");else{const z=mh(w.location);It(u,`New item secured: ${w.item.name} (${z}).`,"loot")}break;case"item-equipped":{const z=o_(w),K=z?` (${z})`:"";It(u,`Equipped ${w.item.name}${K}.`,"info");break}case"item-unequipped":It(u,`${w.item.name} returned to the stash from slot ${w.slot}.`,"info");break;case"item-moved":{const z=mh(w.to);It(u,`Moved ${w.item.name} to the ${z}.`,"info");break}case"item-discarded":{const z=mh(w.location);It(u,`${w.item.name} discarded from the ${z}.`,"warn");break}case"settings-updated":f.dataset.autoequip=w.autoEquip?"on":"off",O.setAutoEquip(w.autoEquip);break}}const P=t.on(w=>L(w)),le=()=>{F(!B)};f.addEventListener("click",le);const ee=w=>{w.defaultPrevented||w.code==="KeyI"&&!w.metaKey&&!w.ctrlKey&&!w.altKey&&(w.preventDefault(),F(!B))};return window.addEventListener("keydown",ee),C(),{destroy:()=>{P(),f.removeEventListener("click",le),window.removeEventListener("keydown",ee),f.remove(),O.destroy(),s.classList.remove("inventory-panel-open"),g&&S&&g.removeEventListener("click",S),p?.destroy(),g?.remove(),v?.(),s.classList.remove("inventory-shop-open"),u.hasChildNodes()||u.remove()}}}const d_=Object.freeze({common:1,uncommon:.6,rare:.35,epic:.18,legendary:.08,mythic:.03}),f_=Object.freeze({id:"general-salvage",label:"General Salvage",entries:Object.freeze([{id:"birch-sap-satchel",name:"Birch Sap Satchel",description:"Soothing birch sap that doubles as a brisk field tonic.",rarity:"common",quantity:{min:1,max:3},weight:6},{id:"steamed-bandages",name:"Steamed Linen Bandages",description:"Freshly steamed bandages infused with pine oils.",rarity:"common",quantity:1,weight:5},{id:"emberglass-shard",name:"Emberglass Shard",description:"A radiant shard used to kindle sauna braziers.",rarity:"uncommon",quantity:1,weight:3},{id:"aurora-distillate",name:"Aurora Distillate",description:"Vials of shimmering condensation that empower sauna rituals.",rarity:"rare",quantity:1,weight:1.5},{id:"myrsky-charm",name:"Myrsky Charm",description:"Storm-forged charm rumored to call down aurora flares.",rarity:"epic",quantity:1,weight:.7}])}),h_=Object.freeze({base:Object.freeze({id:"enemy-raiders",label:"Avanto Marauder Spoils",entries:Object.freeze([{id:"cracked-ice-amulet",name:"Cracked Ice Amulet",description:"Necklace of frostbitten charms that hum when danger nears.",rarity:"common",quantity:1,weight:5},{id:"stolen-sauna-tokens",name:"Stolen Sauna Tokens",description:"Pilfered entrance tokens, gladly accepted back at any sauna hall.",rarity:"uncommon",quantity:{min:2,max:5},weight:3},{id:"glacier-brand",name:"Glacier Brand",description:"A cleaver chilled in glacial meltwater that never dulls.",rarity:"rare",quantity:1,weight:1.25}])}),elite:Object.freeze({id:"enemy-champions",label:"Avanto Champion Cache",entries:Object.freeze([{id:"frostwyrm-signet",name:"Frostwyrm Signet",description:"An icy signet ring that wreathes its bearer in frozen vapour.",rarity:"epic",quantity:1,weight:1.1},{id:"aurora-lattice",name:"Aurora Lattice",description:"Filigree latticework that channels auroral light into focused beams.",rarity:"legendary",quantity:1,weight:.4},{id:"midnight-bloodwine",name:"Midnight Bloodwine",description:"A mythical draught said to rekindle a warrior's lost resolve.",rarity:"mythic",quantity:1,weight:.12}])})}),m_=Object.freeze({base:Object.freeze({id:"deepwood-offerings",label:"Deepwood Offerings",entries:Object.freeze([{id:"spirit-oak-charm",name:"Spirit Oak Charm",description:"Carved from living oak, it whispers guidance between sauna rounds.",rarity:"uncommon",quantity:1,weight:4},{id:"sauna-incense",name:"Sauna Incense Pouches",description:"Fragrant blends that steady breathing before the next engagement.",rarity:"common",quantity:{min:1,max:4},weight:5},{id:"emberglass-arrow",name:"Emberglass Arrow Bundle",description:"Arrowheads that glow amber when a perfect shot reveals itself.",rarity:"rare",quantity:{min:1,max:2},weight:1.75}])}),elite:Object.freeze({id:"deepwood-ritual-cache",label:"Deepwood Ritual Cache",entries:Object.freeze([{id:"windstep-totem",name:"Windstep Totem",description:"Totem etched with gale sigils that lighten every cautious stride.",rarity:"epic",quantity:1,weight:.9},{id:"searing-chant-censer",name:"Searing Chant Censer",description:"An ornate censer that empowers allies with smouldering hymns.",rarity:"legendary",quantity:1,weight:.35}])})}),p_=Object.freeze({enemy:h_,deepwood:m_});function g_(t){return p_[t]??{base:f_}}function y_(t,a=!1){const s=g_(t);return a&&s.elite?s.elite:s.base}function b_(t){if(!Number.isFinite(t))return 1;const a=Math.floor(t);return a<=0?0:Math.min(10,a)}function v_(t,a){if(typeof t=="number"&&Number.isFinite(t))return Math.max(1,Math.round(t));if(!t)return 1;const s=t,r=Math.max(1,Math.round(s.min)),u=Math.max(r,Math.round(s.max))-r+1,f=Math.floor(Math.max(0,Math.min(.999999,a()))*u);return r+f}function S_(t){const a=d_[t.rarity]??1,s=typeof t.weight=="number"?t.weight:1;return Math.max(0,s)*Math.max(0,a)}function E_(t,a){const s=t.map(f=>({entry:f,weight:S_(f)})).filter(f=>f.weight>0);if(s.length===0)return null;const r=s.reduce((f,h)=>f+h.weight,0),l=Math.max(0,Math.min(.999999,a()))*r;let u=0;for(const f of s)if(u+=f.weight,l<u)return f.entry;return s[s.length-1]?.entry??null}function M_(t,a){return{id:t.id,name:t.name,description:t.description,icon:t.icon,rarity:t.rarity,quantity:a}}function x_(t){const a=typeof t.random=="function"?t.random:Math.random,s=!!t.elite,r=t.table??y_(t.factionId,s),l=b_(t.rolls),u=[];if(l<=0||r.entries.length===0)return{factionId:t.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u};for(let f=0;f<l;f+=1){const h=E_(r.entries,a);if(!h)break;const m=v_(h.quantity,a);u.push({entryId:h.id,rarity:h.rarity,quantity:m,item:M_(h,m)})}return{factionId:t.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u}}const w_=["city"],A_=1e4,C_=12e3;function __(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Kb(t){return Object.freeze({strongholds:{...t.strongholds},roster:{...t.roster},economy:{...t.economy},sauna:{...t.sauna},enemyKills:t.enemyKills,exploration:{...t.exploration},startedAt:t.startedAt})}function Qb(t){const a={[re.SAUNA_BEER]:0,[re.SAUNAKUNNIA]:0,[re.SISU]:0};return Object.values(re).forEach(s=>{a[s]=t.getResource(s)}),a}class T_{timeSource;state;map;getRosterCount;sauna;strongholdTypes;rosterGraceMs;bankruptcyGraceMs;progress;startResources;strongholds=new Map;revealedTiles=new Set;progressListeners=new Set;resolutionListeners=new Set;mapDisposer=null;rosterTimeout=null;bankruptcyTimeout=null;bankruptSince=null;wipeSince=null;saunaDestroyedAt=null;resolution=null;disposed=!1;constructor(a){this.timeSource=typeof a.timeSource=="function"?a.timeSource:__,this.state=a.state,this.map=a.map,this.getRosterCount=a.getRosterCount,this.sauna=a.sauna??null;const s=a.strongholdTypes?.length?a.strongholdTypes:w_;this.strongholdTypes=new Set(s),this.rosterGraceMs=Math.max(0,a.rosterWipeGraceMs??A_),this.bankruptcyGraceMs=Math.max(0,a.bankruptcyGraceMs??C_),this.startResources=Qb(this.state);const r=this.state.getResource(re.SAUNA_BEER),l=Math.max(0,Math.round(this.getRosterCount()))||0;this.progress={strongholds:{total:0,destroyed:0,remaining:0},roster:{active:l,totalDeaths:0,wipeSince:null,wipeDurationMs:0},economy:{beer:r,worstBeer:r,bankruptSince:null,bankruptDurationMs:0},sauna:this.createSaunaProgress(),enemyKills:0,exploration:{revealedHexes:0},startedAt:this.timeSource()},this.bootstrapStrongholds(),this.attachMapListener(),this.attachEventListeners(),this.emitProgress(),this.evaluateResolution()}onProgress(a){this.progressListeners.add(a)}offProgress(a){this.progressListeners.delete(a)}onResolution(a){if(this.resolution){a(this.resolution);return}this.resolutionListeners.add(a)}offResolution(a){this.resolutionListeners.delete(a)}getProgress(){return Kb(this.progress)}dispose(){if(!this.disposed){if(this.disposed=!0,this.clearRosterTimer(),this.clearBankruptcyTimer(),this.mapDisposer){try{this.mapDisposer()}catch(a){console.warn("Failed to detach map listener",a)}this.mapDisposer=null}se.off("unitDied",this.handleUnitDied),se.off("unitSpawned",this.handleUnitSpawned),se.off("resourceChanged",this.handleResourceChanged),se.off("saunaDamaged",this.handleSaunaDamaged),se.off("saunaDestroyed",this.handleSaunaDestroyed)}}bootstrapStrongholds(){this.map.forEachTile((a,s)=>{if(this.captureExploration(s,a),this.isStronghold(a.building)){const r=this.coordKey(s);this.strongholds.set(r,{alive:!0})}}),this.updateStrongholdTotals()}attachMapListener(){this.mapDisposer=this.map.addTileChangeListener((a,s,r)=>{let l=!1;if((r==="fog"||r==="created")&&this.captureExploration(a,s)&&(l=!0),r==="building"||r==="created"){const u=this.coordKey(a),f=this.strongholds.get(u);this.isStronghold(s.building)?f?f.alive||(f.alive=!0):this.strongholds.set(u,{alive:!0}):f?.alive&&(f.alive=!1),this.updateStrongholdTotals(),l=!0}l&&(this.emitProgress(),this.evaluateResolution())})}captureExploration(a,s){if(s.isFogged)return!1;const r=this.coordKey(a),l=this.revealedTiles.size;return this.revealedTiles.has(r)||(this.revealedTiles.add(r),this.progress.exploration.revealedHexes=this.revealedTiles.size),this.revealedTiles.size!==l}attachEventListeners(){se.on("unitDied",this.handleUnitDied),se.on("unitSpawned",this.handleUnitSpawned),se.on("resourceChanged",this.handleResourceChanged),se.on("saunaDamaged",this.handleSaunaDamaged),se.on("saunaDestroyed",this.handleSaunaDestroyed)}handleUnitDied=({unitFaction:a})=>{if(a==="player"){this.progress.roster.totalDeaths+=1,this.refreshRosterStatus(),this.emitProgress(),this.evaluateResolution();return}this.progress.enemyKills+=1,this.emitProgress()};handleUnitSpawned=({unit:a})=>{a.faction==="player"&&(this.refreshRosterStatus(),this.emitProgress())};handleResourceChanged=({resource:a,total:s})=>{a===re.SAUNA_BEER&&(this.progress.economy.beer=s,s<this.progress.economy.worstBeer&&(this.progress.economy.worstBeer=s),s<0?this.bankruptSince===null&&(this.bankruptSince=this.timeSource(),this.progress.economy.bankruptSince=this.bankruptSince,this.startBankruptcyTimer()):(this.updateBankruptcyDuration(),this.bankruptSince=null,this.progress.economy.bankruptSince=null,this.clearBankruptcyTimer()),this.emitProgress())};handleSaunaDamaged=({remainingHealth:a})=>{this.disposed||(this.updateSaunaSnapshot(a),this.emitProgress())};handleSaunaDestroyed=a=>{this.disposed||(this.markSaunaDestroyed(),this.emitProgress(),this.resolve("lose","saunaDestroyed"))};startBankruptcyTimer(){if(this.bankruptcyTimeout===null){if(this.bankruptcyGraceMs<=0){this.resolve("lose","bankruptcy");return}this.bankruptcyTimeout=setTimeout(()=>{this.updateBankruptcyDuration(),this.resolve("lose","bankruptcy")},this.bankruptcyGraceMs)}}clearBankruptcyTimer(){this.bankruptcyTimeout!==null&&(clearTimeout(this.bankruptcyTimeout),this.bankruptcyTimeout=null)}startRosterTimer(){if(this.rosterTimeout===null){if(this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.rosterTimeout=setTimeout(()=>{this.updateRosterDuration(),this.resolve("lose","rosterWipe")},this.rosterGraceMs)}}clearRosterTimer(){this.rosterTimeout!==null&&(clearTimeout(this.rosterTimeout),this.rosterTimeout=null)}updateStrongholdTotals(){const a=this.strongholds.size;let s=0;for(const r of this.strongholds.values())r.alive&&(s+=1);this.progress.strongholds.total=a,this.progress.strongholds.remaining=s,this.progress.strongholds.destroyed=Math.max(0,a-s)}refreshRosterStatus(){const a=Math.max(0,Math.round(this.getRosterCount()));this.progress.roster.active=a,a<=0?(this.wipeSince===null&&(this.wipeSince=this.timeSource(),this.progress.roster.wipeSince=this.wipeSince),this.startRosterTimer()):(this.updateRosterDuration(),this.wipeSince=null,this.progress.roster.wipeSince=null,this.clearRosterTimer())}updateBankruptcyDuration(){if(this.bankruptSince===null)return;const a=this.timeSource()-this.bankruptSince;a>this.progress.economy.bankruptDurationMs&&(this.progress.economy.bankruptDurationMs=a)}updateRosterDuration(){if(this.wipeSince===null)return;const a=this.timeSource()-this.wipeSince;a>this.progress.roster.wipeDurationMs&&(this.progress.roster.wipeDurationMs=a)}evaluateResolution(){if(!this.resolution){if(this.progress.sauna.destroyed){this.resolve("lose","saunaDestroyed");return}if(this.progress.strongholds.total>0&&this.progress.strongholds.remaining===0){this.resolve("win","strongholds");return}if(this.wipeSince!==null&&this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.bankruptSince!==null&&this.bankruptcyGraceMs<=0&&this.resolve("lose","bankruptcy")}}resolve(a,s){if(this.resolution)return;this.updateRosterDuration(),this.updateBankruptcyDuration();const r=this.timeSource(),l=Math.max(0,r-this.progress.startedAt),u=Kb({...this.progress,roster:{...this.progress.roster,wipeSince:this.wipeSince},economy:{...this.progress.economy,bankruptSince:this.bankruptSince},sauna:{...this.progress.sauna,destroyedAt:this.saunaDestroyedAt}}),f=this.computeRewards();this.resolution=Object.freeze({outcome:a,cause:s,timestamp:r,durationMs:l,summary:u,rewards:f}),this.emitResolution(),this.dispose()}emitProgress(){const a=this.getProgress();for(const s of this.progressListeners)try{s(a)}catch(r){console.error("Objective progress listener failed",r)}}emitResolution(){if(!this.resolution)return;const a=this.resolution;for(const s of this.resolutionListeners)try{s(a)}catch(r){console.error("Objective resolution listener failed",r)}this.resolutionListeners.clear()}computeRewards(){const a=Qb(this.state);return{resources:{[re.SAUNA_BEER]:{final:a[re.SAUNA_BEER],delta:a[re.SAUNA_BEER]-this.startResources[re.SAUNA_BEER]},[re.SAUNAKUNNIA]:{final:a[re.SAUNAKUNNIA],delta:a[re.SAUNAKUNNIA]-this.startResources[re.SAUNAKUNNIA]},[re.SISU]:{final:a[re.SISU],delta:a[re.SISU]-this.startResources[re.SISU]}}}}coordKey(a){return`${a.q},${a.r}`}isStronghold(a){return a?this.strongholdTypes.has(a):!1}createSaunaProgress(){if(!this.sauna)return{maxHealth:0,health:0,destroyed:!1,destroyedAt:null};const a=Math.max(0,Math.round(this.sauna.maxHealth??0)),s=Math.max(0,Math.round(this.sauna.health??0)),r=!!this.sauna.destroyed||s<=0;return r&&this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),{maxHealth:a,health:s,destroyed:r,destroyedAt:r?this.saunaDestroyedAt:null}}updateSaunaSnapshot(a){const s=Number.isFinite(a)?Math.max(0,Math.round(a)):0,r=this.sauna?Math.max(0,Math.round(this.sauna.maxHealth??0)):0,l=this.progress.sauna.maxHealth,u=Math.max(l,r,s);this.progress.sauna.maxHealth=u;const f=Math.max(0,Math.min(u,s));this.progress.sauna.health=f,f>0&&(this.progress.sauna.destroyed=!1,this.progress.sauna.destroyedAt=null,this.saunaDestroyedAt=null)}markSaunaDestroyed(){if(this.sauna){const a=Math.max(0,Math.round(this.sauna.maxHealth??0));a>this.progress.sauna.maxHealth&&(this.progress.sauna.maxHealth=a)}this.progress.sauna.health=0,this.progress.sauna.destroyed=!0,this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),this.progress.sauna.destroyedAt=this.saunaDestroyedAt}}function R_(t){return new T_(t)}const On=[{level:1,xpToNext:180,cumulativeXp:0,statAwards:{vigor:0,focus:0,resolve:0}},{level:2,xpToNext:220,cumulativeXp:180,statAwards:{vigor:5,focus:2,resolve:1}},{level:3,xpToNext:260,cumulativeXp:400,statAwards:{vigor:4,focus:3,resolve:1}},{level:4,xpToNext:320,cumulativeXp:660,statAwards:{vigor:4,focus:2,resolve:2}},{level:5,xpToNext:380,cumulativeXp:980,statAwards:{vigor:6,focus:3,resolve:2}},{level:6,xpToNext:460,cumulativeXp:1360,statAwards:{vigor:7,focus:3,resolve:3}},{level:7,xpToNext:540,cumulativeXp:1820,statAwards:{vigor:6,focus:4,resolve:3}},{level:8,xpToNext:640,cumulativeXp:2360,statAwards:{vigor:7,focus:4,resolve:4}},{level:9,xpToNext:760,cumulativeXp:3e3,statAwards:{vigor:8,focus:5,resolve:4}},{level:10,xpToNext:900,cumulativeXp:3760,statAwards:{vigor:9,focus:6,resolve:5}},{level:11,xpToNext:1060,cumulativeXp:4660,statAwards:{vigor:10,focus:6,resolve:6}},{level:12,xpToNext:null,cumulativeXp:5720,statAwards:{vigor:12,focus:7,resolve:6}}];function N_(t){return Number.isNaN(t)||!Number.isFinite(t)?0:Math.max(0,Math.floor(t))}function Yh(){return{vigor:0,focus:0,resolve:0}}function k_(t){return{vigor:t.vigor,focus:t.focus,resolve:t.resolve}}function su(t){const a=N_(t);let s=On[0];for(const f of On)if(a>=f.cumulativeXp)s=f;else break;const r=a-s.cumulativeXp,l=s.xpToNext,u=l?Math.min(1,r/l):1;return{level:s.level,xpIntoLevel:r,xpForNext:l,progressToNext:u,statAwards:s.statAwards}}function D_(t){const a=On[On.length-1].level,s=Math.max(On[0].level,Math.min(t,a)),r=On.find(l=>l.level===s);return r?k_(r.statAwards):Yh()}function L_(t){if(t<=On[0].level)return Yh();const a=On[On.length-1].level,s=Math.min(t,a),r=Yh();for(const l of On){if(l.level>s)break;l.level!==On[0].level&&(r.vigor+=l.statAwards.vigor,r.focus+=l.statAwards.focus,r.resolve+=l.statAwards.resolve)}return r}function U_(t){return su(t).level}function Nc(t){return Number.isFinite(t)?t:0}const Tv="progression:sauna-shop";function Rv(){try{return globalThis.localStorage??null}catch{return null}}function O_(t){if(!t||typeof t!="object")return{version:1,tiers:[]};const a=Array.isArray(t.tiers)?t.tiers.filter(Boolean):[];return{version:1,tiers:Array.from(new Set(a))}}function q_(){const t=Rv();if(!t)return{version:1,tiers:[]};try{const a=t.getItem(Tv);if(!a)return{version:1,tiers:[]};const s=JSON.parse(a);return O_(s)}catch(a){return console.warn("Failed to parse sauna shop state",a),{version:1,tiers:[]}}}function z_(t){const a=Rv();if(a)try{a.setItem(Tv,JSON.stringify(t))}catch(s){console.warn("Failed to persist sauna shop state",s)}}let Dt=new Set(q_().tiers);const Vh=new Set;function Xh(t){const a=new Set(Dt);for(const s of Vh)try{s({...t,purchased:a})}catch(r){console.warn("Sauna shop listener failure",r)}}function B_(t){return Vh.add(t),()=>Vh.delete(t)}function bi(){return new Set(Dt)}function Kh(t){Dt=new Set(t),z_({version:1,tiers:Array.from(Dt)})}function H_(t){const a=ss();if(!t||typeof t!="object")return{success:!1,balance:a,purchased:bi(),reason:"unsupported"};if(t.unlock.type!=="artocoin")return Dt.has(t.id)||(Dt.add(t.id),Kh(Dt),Xh({type:"grant",tierId:t.id,purchased:Dt,cost:0})),{success:!0,balance:a,purchased:bi()};if(Dt.has(t.id))return{success:!1,balance:a,purchased:bi(),reason:"already-owned"};const s=Math.max(0,Math.floor(t.unlock.cost)),r=v3(s,{reason:"purchase",metadata:{tierId:t.id,type:"sauna-tier"}});return r.success?(Dt.add(t.id),Kh(Dt),Xh({type:"purchase",tierId:t.id,purchased:Dt,spendResult:r,cost:s}),{success:!0,balance:r.balance,purchased:bi()}):{success:!1,balance:r.balance,purchased:bi(),shortfall:r.shortfall,reason:"insufficient-funds"}}function km(t){return Dt.has(t)||(Dt.add(t),Kh(Dt),Xh({type:"grant",tierId:t,purchased:Dt,cost:0})),bi()}function ph(t){return Number.isFinite(t)?Math.max(0,Math.floor(t)):0}function kc(t,a){return a<=0?"":`${t}/${a}`}function I_(t){let a=0;const s=Math.max(0,ph(t.queueCapacity??2)),r=(f,h)=>{f&&typeof t.log=="function"&&t.log({type:"system",message:f,metadata:{context:"spawn-queue",...h}})},l=()=>{const f=t.getTier();if(!f)return null;const h=ph(t.getRosterLimit()),m=ph(t.getRosterCount());return{tierId:f.id,tierName:f.name,rosterLimit:h,rosterCount:m,queued:a}};return{getSnapshot:()=>l(),hasQueuedSpawn:()=>a>0,takeQueuedSpawn:f=>a<=0?!1:(a-=1,a<=0?r(`The benches of ${f.tierName} exhale — queued attendants take the field.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} deploys a queued attendant. Relief teams remaining: ${kc(a,s)}.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0),restoreQueuedSpawn:f=>{s>0&&a>=s||(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} keeps the relief attendant on standby (${kc(a,s)} ready).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},queueBlockedSpawn:(f,h)=>s>0&&a>=s?(r(`${f.tierName} cannot hold more relief attendants — clear a slot to vent the pressure.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!1):h()?(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} queues a ready attendant in the wings (${kc(a,s)} poised).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0):!1,onSpawnResolved:(f,h)=>{h.usedQueue&&(a>0?r(`${f.tierName} still has relief attendants waiting (${kc(a,s)}).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} has cleared the relief queue.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},clearQueue:f=>{if(!(a<=0)&&(a=0,f==="tier-change")){const h=t.getTier();h&&r(`${h.name} ushers its queued attendants into the new hall.`,{tierId:h.id,tierName:h.name,queue:a,capacity:s})}}}}const Nv="autobattles:saunojas";function kv(){try{return globalThis.localStorage??null}catch{return null}}function j_(){const t=kv();if(!t)return[];try{const a=t.getItem(Nv);if(!a)return[];const s=JSON.parse(a);if(!Array.isArray(s))return[];const r=[];for(const l of s){if(!l||typeof l!="object")continue;const u=l,f=u.id;if(typeof f!="string"||f.length===0)continue;const h=u.coord,m=h&&typeof h=="object"&&typeof h.q=="number"&&Number.isFinite(h.q)&&typeof h.r=="number"&&Number.isFinite(h.r)?{q:h.q,r:h.r}:void 0,p=u.traits,g=Array.isArray(p)?p.filter(S=>typeof S=="string"):void 0,y=typeof u.upkeep=="number"?u.upkeep:void 0,v=typeof u.xp=="number"?u.xp:void 0;r.push(vm({id:f,name:typeof u.name=="string"?u.name:void 0,coord:m,maxHp:typeof u.maxHp=="number"?u.maxHp:void 0,hp:typeof u.hp=="number"?u.hp:void 0,steam:typeof u.steam=="number"?u.steam:void 0,behavior:u.behavior,traits:g,upkeep:y,xp:v,selected:!!u.selected,items:Array.isArray(u.items)?u.items:void 0,baseStats:u.baseStats,effectiveStats:u.effectiveStats,equipment:u.equipment,modifiers:Array.isArray(u.modifiers)?u.modifiers:void 0}))}return r}catch(a){return console.warn("Failed to load Saunoja units from storage",a),[]}}function G_(t){const a=kv();if(a)try{const s=t.map(r=>({id:r.id,name:r.name,coord:{q:r.coord.q,r:r.coord.r},maxHp:r.maxHp,hp:r.hp,steam:r.steam,behavior:r.behavior,traits:[...r.traits],upkeep:r.upkeep,xp:r.xp,selected:r.selected,baseStats:{health:r.baseStats.health,attackDamage:r.baseStats.attackDamage,attackRange:r.baseStats.attackRange,movementRange:r.baseStats.movementRange,...typeof r.baseStats.defense=="number"&&Number.isFinite(r.baseStats.defense)?{defense:r.baseStats.defense}:{},...typeof r.baseStats.shield=="number"&&Number.isFinite(r.baseStats.shield)?{shield:r.baseStats.shield}:{},...typeof r.baseStats.visionRange=="number"&&Number.isFinite(r.baseStats.visionRange)?{visionRange:r.baseStats.visionRange}:{}},effectiveStats:{health:r.effectiveStats.health,attackDamage:r.effectiveStats.attackDamage,attackRange:r.effectiveStats.attackRange,movementRange:r.effectiveStats.movementRange,...typeof r.effectiveStats.defense=="number"&&Number.isFinite(r.effectiveStats.defense)?{defense:r.effectiveStats.defense}:{},...typeof r.effectiveStats.shield=="number"&&Number.isFinite(r.effectiveStats.shield)?{shield:r.effectiveStats.shield}:{},...typeof r.effectiveStats.visionRange=="number"&&Number.isFinite(r.effectiveStats.visionRange)?{visionRange:r.effectiveStats.visionRange}:{}},equipment:cr.reduce((l,u)=>{const f=r.equipment?.[u]??null;return l[u]=f?{id:f.id,name:f.name,description:f.description,icon:f.icon,rarity:f.rarity,quantity:f.quantity,slot:f.slot}:null,l},{}),items:r.items.map(l=>({id:l.id,name:l.name,description:l.description,icon:l.icon,rarity:l.rarity,quantity:l.quantity})),modifiers:r.modifiers.map(l=>({id:l.id,name:l.name,description:l.description,remaining:l.remaining,duration:l.duration,appliedAt:l.appliedAt,stacks:l.stacks,source:l.source}))}));a.setItem(Nv,JSON.stringify(s))}catch(s){console.warn("Failed to persist Saunoja units",s)}}const Dv="autobattles:sauna-settings";function Lv(){try{return globalThis.localStorage??null}catch{return null}}function F_(t){return typeof t=="string"?wn(t).id:fr}function Pb(t){return Number.isFinite(t)?Math.max(0,Math.floor(t)):0}function Dm(t,a){const s=Pb(t),r=Pb(a),l=1+am;return Math.max(0,Math.min(l,s,r))}function Uv(t,a,s){const r=Dm(s,s),l=typeof t=="number"&&Number.isFinite(t)?t:a,u=Math.max(0,Math.floor(l));return Math.max(0,Math.min(r,u))}function Ov(t){return t===!0||t==="true"}function Eo(t,a){const s=F_(t?.activeTierId),r=wn(s),l=Dm(r.rosterCap,a);return{activeTierId:r.id,maxRosterSize:Uv(t?.maxRosterSize,l,l),useUiV2:Ov(t?.useUiV2)}}function qv(t=1+am){const a=Lv();if(!a)return Eo(null,t);try{const s=a.getItem(Dv);if(!s)return Eo(null,t);const r=JSON.parse(s);return Eo(!r||typeof r!="object"?null:r,t)}catch(s){return console.warn("Failed to load sauna settings from storage",s),Eo(null,t)}}function zv(t){const a=Lv();if(!a)return;const s=wn(t.activeTierId),r=Dm(s.rosterCap,s.rosterCap),l={activeTierId:s.id,maxRosterSize:Uv(t.maxRosterSize,r,r),useUiV2:Ov(t.useUiV2)};try{a.setItem(Dv,JSON.stringify(l))}catch(u){console.warn("Failed to persist sauna settings",u)}}const $_=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Y_=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Bv(t){return Number.isFinite(t)?Math.max(0,Math.min(100,Math.round(t*100))):0}function V_(t){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});if(t.xpForNext===null)return`${a.format(t.xp)} XP • Max level`;const s=Bv(t.progress);return`${a.format(t.xpIntoLevel)} / ${a.format(t.xpForNext)} XP • ${s}%`}function X_(t){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),s=[];return t.vigor>0&&s.push(`+${a.format(t.vigor)} Vigor`),t.focus>0&&s.push(`+${a.format(t.focus)} Focus`),t.resolve>0&&s.push(`+${a.format(t.resolve)} Resolve`),s.length>0?s.join(" • "):"No level bonuses yet"}function K_(t,a){const{rosterIcon:s,summaryLabel:r="Saunoja Roster"}=a;t.classList.add("sauna-roster"),t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("title","Active sauna battalion on the field"),t.dataset.tutorialTarget="upkeep",t.replaceChildren();const l=document.createElement("div");l.classList.add("sauna-roster__summary");const u=document.createElement("img");u.src=s,u.alt="Saunoja roster crest",u.decoding="async",u.classList.add("sauna-roster__icon");const f=document.createElement("div");f.classList.add("sauna-roster__text");const h=document.createElement("span");h.textContent=r,h.classList.add("sauna-roster__label");const m=document.createElement("span");m.textContent="0",m.classList.add("sauna-roster__value"),f.append(h,m),l.append(u,f);const p=document.createElement("div");p.classList.add("saunoja-card"),p.setAttribute("aria-live","polite"),p.hidden=!0;const g=document.createElement("div");g.classList.add("saunoja-card__header");const y=document.createElement("div");y.classList.add("saunoja-card__level"),y.setAttribute("role","img"),y.style.setProperty("--level-progress","0%");const v=document.createElement("span");v.classList.add("saunoja-card__level-value"),v.textContent="1",y.appendChild(v);const S=document.createElement("div");S.classList.add("saunoja-card__identity");const M=document.createElement("h3");M.classList.add("saunoja-card__name"),M.textContent="Saunoja";const _=document.createElement("div");_.classList.add("saunoja-card__xp"),_.textContent="0 / 0 XP • 0%",S.append(M,_),g.append(y,S);const T=document.createElement("p");T.classList.add("saunoja-card__traits");const N=document.createElement("div");N.classList.add("saunoja-card__callouts"),N.textContent="No level bonuses yet";const O=document.createElement("p");O.classList.add("saunoja-card__upkeep"),p.append(g,T,N,O),t.append(l,p);let B=null,Y=null;function X(C){if(!C){p.hidden=!0;return}p.hidden=!1,p.dataset.unitId=C.id,M.textContent=C.name||"Saunoja";const J=C.traits.filter(x=>x.length>0),I=J.length>0?J.join(", "):"No notable traits yet";T.textContent=I,T.title=I;const ae=V_(C.progression);_.textContent=ae,_.title=ae;const $=Bv(C.progression.progress);y.style.setProperty("--level-progress",`${$}%`),v.textContent=String(C.progression.level);const L=C.progression.xpForNext===null?`Level ${C.progression.level}, at mastery`:`Level ${C.progression.level}, ${$}% toward next level`;y.setAttribute("aria-label",L);const P=X_(C.progression.statBonuses);N.textContent=P,N.title=P;const le=Math.max(0,Math.round(C.upkeep)),ee=`Upkeep: ${Y_.format(le)} Beer`;O.textContent=ee,O.title=ee}function V(C){return C===1/0?"inf":!Number.isFinite(C)||C<=0?"0":String(Math.ceil(C))}function W(C){return[C.id,C.name,C.icon??"",C.rarity??"",C.description??"",C.quantity].join("^")}function ne(C){return[C.id,C.name,C.description??"",V(C.duration),V(C.remaining),C.appliedAt??"",C.stacks??1,C.source??""].join("^")}function F(C){const{stats:J}=C,I=C.traits.join("|"),ae=C.items.map(W).join("|"),$=C.modifiers.map(ne).join("|");return[C.id,C.name,C.upkeep,C.status,C.selected?1:0,C.progression.level,C.progression.xp,C.progression.xpIntoLevel,C.progression.xpForNext??"max",J.health,J.maxHealth,J.attackDamage,J.attackRange,J.movementRange,J.defense??0,J.shield??0,I,ae,$].join("~")}function H(C){return`${C.length}:${C.map(F).join("||")}`}return{updateSummary(C){const J=Math.max(0,Math.floor(C.count)),I=$_.format(J);m.textContent=I,t.setAttribute("aria-label",`Saunoja roster: ${I} active attendants`),t.setAttribute("title",`Saunoja roster • ${I} active attendants`),X(C.card)},installRenderer(C){Y=null,B=C},renderRoster(C){if(!B)return;const J=H(C);J!==Y&&(Y=J,B(C))},destroy(){B=null,Y=null,t.replaceChildren()}}}const Q_={[re.SAUNA_BEER]:"Sauna Beer",[re.SAUNAKUNNIA]:"Saunakunnia",[re.SISU]:"Sisu"},P_=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Z_='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function J_(t){if(!Number.isFinite(t)||t<=0)return"0:00";const a=Math.round(t/1e3),s=Math.max(0,a%60).toString().padStart(2,"0"),r=Math.floor(a/60),l=(r%60).toString().padStart(2,"0"),u=Math.floor(r/60);return u>0?`${u}:${l}:${s}`:`${r}:${s}`}function W_(t){switch(t.cause){case"strongholds":return"All rival strongholds have fallen.";case"rosterWipe":return"Every attendant is down—no one remains to hold the line.";case"bankruptcy":return"Upkeep debts have exhausted the steam reserves.";case"saunaDestroyed":return"The sauna collapsed under relentless assault—the sacred steamline has fallen silent.";default:return""}}function eT(t){if(!Number.isFinite(t)||t===0)return"±0";const a=Math.round(t*100)/100;return`${a>0?"+":""}${a}`}function tT(t,a){const s=document.createElement("ul");s.className="end-screen__rewards-list";for(const r of Object.values(re)){const l=t.rewards.resources[r];if(!l)continue;const u=document.createElement("li");u.className="end-screen__reward-item";const f=document.createElement("span");f.className="end-screen__reward-label",f.textContent=a[r]??r;const h=document.createElement("span");h.className="end-screen__reward-value",h.textContent=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(l.final));const m=document.createElement("span");m.className="end-screen__reward-delta",m.textContent=eT(l.delta),m.dataset.polarity=l.delta>=0?"positive":"negative",u.append(f,h,m),s.append(u)}return s}function nT(t,a,s){const r=l=>{if(l.key==="Escape"){l.preventDefault(),s?.();return}if(l.key!=="Tab")return;const u=a.querySelectorAll(Z_);if(u.length===0){l.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;l.shiftKey?(m===f||!a.contains(m))&&(l.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(l.preventDefault(),f.focus())};return t.addEventListener("keydown",r),()=>t.removeEventListener("keydown",r)}function aT(t){const{container:a,resolution:s,onNewRun:r,onDismiss:l}=t;if(!a)return{destroy(){},focusPrimary(){}};const u={...Q_,...t.resourceLabels??{}},f=document.createElement("div");f.className="end-screen",f.setAttribute("role","presentation");const h=document.createElement("section");h.className="end-screen__panel",h.setAttribute("role","dialog"),h.setAttribute("aria-modal","true");const m=`end-screen-title-${Date.now()}`;h.setAttribute("aria-labelledby",m),h.tabIndex=-1,h.dataset.outcome=s.outcome;const p=document.createElement("h2");p.className="end-screen__title",p.id=m,p.textContent=s.outcome==="win"?"Steamforged Victory":"Sauna Lost";const g=document.createElement("p");g.className="end-screen__subtitle",g.textContent=W_(s);const y=document.createElement("dl");y.className="end-screen__metrics";const v=(H,C)=>{const J=document.createElement("dt");J.textContent=H,J.className="end-screen__metric-label";const I=document.createElement("dd");I.textContent=C,I.className="end-screen__metric-value",y.append(J,I)};v("Run time",J_(s.durationMs)),v("Strongholds",`${s.summary.strongholds.destroyed}/${s.summary.strongholds.total}`),v("Roster losses",`${s.summary.roster.totalDeaths}`),v("Deepest beer reserve",`${Math.round(s.summary.economy.worstBeer)}`);const S=t.artocoinSummary??{balance:0,earned:0,spent:0},M=document.createElement("section");M.className="end-screen__artocoin";const _=document.createElement("h3");_.className="end-screen__section-title",_.textContent="Artocoin ledger";const T=document.createElement("dl");T.className="end-screen__artocoin-ledger";const N=(H,C,J)=>{const I=document.createElement("dt");I.className="end-screen__artocoin-label",I.textContent=H;const ae=document.createElement("dd");ae.className="end-screen__artocoin-value",ae.dataset.polarity=J,ae.textContent=P_.format(Math.max(0,Math.floor(Number.isFinite(C)?C:0))),T.append(I,ae)};N("Earned",S.earned,S.earned>0?"positive":"neutral"),N("Spent",S.spent,S.spent>0?"negative":"neutral"),N("Balance",S.balance,"neutral"),M.append(_,T);const O=document.createElement("h3");O.className="end-screen__section-title",O.textContent="Rewards";const B=tT(s,u),Y=document.createElement("div");Y.className="end-screen__actions";const X=document.createElement("button");X.type="button",X.className="end-screen__button end-screen__button--primary",X.textContent="New run",X.addEventListener("click",()=>{r()});const V=document.createElement("button");V.type="button",V.className="end-screen__button",V.textContent="Review battlefield",V.addEventListener("click",()=>{l?.()}),Y.append(X,V),h.append(p,g,y,M,O,B,Y),f.append(h),a.append(f);const W=nT(f,h,l),ne=()=>{W(),f.remove()},F=()=>{requestAnimationFrame(()=>{X.focus({preventScroll:!0})})};return F(),{destroy:ne,focusPrimary:F}}const Hv="autobattles4x.flags";function Iv(){if(typeof window>"u")return null;try{if("localStorage"in window&&window.localStorage)return window.localStorage}catch(t){console.warn("Unable to access localStorage for local flags",t)}return null}function jv(){const t=Iv();if(!t)return{};try{const a=t.getItem(Hv);if(!a)return{};const s=JSON.parse(a);if(s&&typeof s=="object")return s}catch(a){console.warn("Failed to parse local flags, resetting.",a)}return{}}function iT(t){const a=Iv();if(a)try{const s={};t.tutorial_done&&(s.tutorial_done=!0),a.setItem(Hv,JSON.stringify(s))}catch(s){console.warn("Failed to persist local flags",s)}}function sT(){return jv().tutorial_done===!0}function Zb(t){const a={...jv()};a.tutorial_done=!0,iT(a)}const gh=200,yh=3,rT=2,Jb=6,oT=40,lT=250,cT=200,uT=U_(Number.MAX_SAFE_INTEGER),Qh={[re.SAUNA_BEER]:"Sauna Beer",[re.SAUNAKUNNIA]:"Saunakunnia",[re.SISU]:"Sisu"};let as=ss(),os=new Set(bi()),Lm=0;const Ph=new Set;function Gv(){Ph.forEach(t=>{try{t()}catch(a){console.warn("Sauna shop listener failure",a)}})}function Fv(t,a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;if(!Number.isFinite(t))return s;const r=Math.max(0,Math.floor(t));return Math.max(0,Math.min(s,r))}const $v=.1,dT=3,fT=1;let ia=Da(UE()),Yv=Gc(ia.runSeed,1),Vv=Gc(ia.runSeed,2),Mu=null;function ru(t){ia=Da(t),Yv=Gc(ia.runSeed,1),Vv=Gc(ia.runSeed,2),Mu?.({persist:!0})}ru(ia);let ou=null,je=[];const sa=new Map,vi=new Map,ls=new Map;let Wb=0,lu=null,ea=null,Ba=null,ir=null,un=null,sr=null,_t=null,Wi=null,Lo=null,Oa=null,Si=null,es=!1,Mn=null,Ei=null,Zn=null,Uo=null,cu=!1,Qi=0;function xu(t){const a=vi.get(t.id);return a?ls.get(a)??null:null}function Xv(t,a,s){const r=s??xu(t),l=a,u=t.behavior!==l;return t.behavior=l,r&&r.setBehavior(l),u}function Kv(t,a){t.effectiveStats={...a},t.maxHp=Math.max(1,Math.round(a.health)),t.hp=Math.min(t.maxHp,Math.max(0,Math.round(t.hp))),t.defense=typeof a.defense=="number"?Math.max(0,a.defense):void 0,t.shield=typeof a.shield=="number"?Math.max(0,a.shield):0;const s=xu(t);if(s){Xv(t,t.behavior,s);const r={health:t.effectiveStats.health,attackDamage:t.effectiveStats.attackDamage,attackRange:t.effectiveStats.attackRange,movementRange:t.effectiveStats.movementRange};typeof t.effectiveStats.defense=="number"&&(r.defense=t.effectiveStats.defense),typeof t.effectiveStats.visionRange=="number"&&(r.visionRange=t.effectiveStats.visionRange),s.updateStats(r),typeof t.effectiveStats.shield=="number"?s.setShield(t.effectiveStats.shield):t.shield<=0&&s.setShield(0)}}function wu(t,a){const s=a??qn(t.equipment),r=Xc(t.baseStats,s);return Kv(t,r),r}function Qv(t){const a=su(t.xp);return{level:a.level,xp:Math.max(0,Math.floor(t.xp)),xpIntoLevel:a.xpIntoLevel,xpForNext:a.xpForNext,progress:a.progressToNext,statBonuses:L_(a.level)}}function hT(t){const a=[];return t.vigor>0&&a.push(`+${t.vigor} Vigor`),t.focus>0&&a.push(`+${t.focus} Focus`),t.resolve>0&&a.push(`+${t.resolve} Resolve`),a.length>0?a.join(", "):"+0 Vigor, +0 Focus, +0 Resolve"}function Pv(t,a,s){if(!Number.isFinite(a)||a<=0)return null;const r=su(t.xp),l=Math.max(0,Math.floor(t.xp+a));if(l===t.xp)return null;t.xp=l;const u=su(t.xp),f=Math.max(0,u.level-r.level),h={vigor:0,focus:0,resolve:0};let m=0;if(f>0){for(let g=r.level+1;g<=u.level&&g<=uT;g++){const y=D_(g);h.vigor+=y.vigor,h.focus+=y.focus,h.resolve+=y.resolve;const v=Number.isFinite(t.baseStats.health)?t.baseStats.health:t.effectiveStats.health;t.baseStats.health=Math.max(1,Math.round(v+y.vigor));const S=Number.isFinite(t.baseStats.attackDamage)?t.baseStats.attackDamage:t.effectiveStats.attackDamage;t.baseStats.attackDamage=Math.max(0,Math.round(S+y.focus));const _=(Number.isFinite(t.baseStats.defense)?t.baseStats.defense??0:t.effectiveStats.defense??0)+y.resolve;t.baseStats.defense=_>0?_:void 0}m=h.vigor}m>0&&(t.hp+=m),wu(t);const p=xu(t);if(p&&p.setExperience(t.xp),s.source==="kill"){const g=t.name?.trim()||"Our champion",y=s.label?.trim()||"their foe",v=s.boss?" Boss toppled!":s.elite?" Elite threat routed!":"";Lt({type:"combat",message:`${g} earns ${a} XP for defeating ${y}.${v}`,metadata:{slayer:g,foe:y,xpAward:a,boss:!!s.boss,elite:!!s.elite}})}if(f>0){const g=hT(h),y=t.name?.trim()||"Our champion";Lt({type:"progression",message:`${y} reaches Level ${u.level}! ${g}.`,metadata:{unit:y,level:u.level,levelsGained:f,bonuses:h}})}return{xpAwarded:a,totalXp:t.xp,level:u.level,levelsGained:f,statBonuses:h}}function mT(t,a,s){if(!t)return null;const r=sa.get(t.id);return r?Pv(r,a,s):null}function pT(t,a){if(!Number.isFinite(t)||t<=0)return!1;let s=!1;for(const r of je)Pv(r,t,a)&&(s=!0);return s}function gT(t){return t?(t.type?.toLowerCase?.()??"").includes("boss")?{xp:lT,elite:!0,boss:!0}:h1(t)?{xp:oT,elite:!0,boss:!1}:{xp:Jb,elite:!1,boss:!1}:{xp:Jb,elite:!1,boss:!1}}const Zv=t=>{if(!t)return;const a=Math.max(0,Math.floor(t.strongholds.destroyed));if(a>Qi){const s=a-Qi,r=cT*s;pT(r,{source:"objective",label:"stronghold"})&&(oa(),$t(),Lt({type:"progression",message:`Strategists toast the captured stronghold — roster gains ${r} XP.`,metadata:{source:"stronghold",xpAward:r}}))}if(a<Qi){Qi=a;return}Qi=a},yT=Object.freeze(["health","attackDamage","attackRange","movementRange","defense","shield"]);function e2(t){return t?{id:t.id,name:t.name,quantity:t.quantity,rarity:t.rarity}:null}function t2(t,a){const s=t[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function bT(t,a){const s=[];for(const r of yT){const l=t2(a,r),u=t2(t,r),f=l-u;f!==0&&s.push({stat:r,delta:f})}return s}function vT(t,a){if(!a||qn(t.equipment).length>0)return;const r={health:Math.max(1,Math.round(a.getMaxHealth())),attackDamage:Math.max(0,Math.round(a.stats.attackDamage)),attackRange:Math.max(0,Math.round(a.stats.attackRange)),movementRange:Math.max(0,Math.round(a.stats.movementRange)),defense:typeof a.stats.defense=="number"&&Number.isFinite(a.stats.defense)?Math.max(0,a.stats.defense):t.baseStats.defense,shield:t.baseStats.shield??0,visionRange:typeof a.stats.visionRange=="number"&&Number.isFinite(a.stats.visionRange)?Math.max(0,a.stats.visionRange):t.baseStats.visionRange};t.baseStats=r,wu(t)}function uu(){cu&&(bu(!1),cu=!1)}function Ao(){if(!Uo){uu();return}Uo.destroy(),Uo=null,uu()}function ST(){if(sT()){Ao();return}Ao(),_m()?cu=!1:(bu(!0),cu=!0),Uo=Iw({onComplete:()=>{Zb(),uu(),Ao()},onSkip:()=>{Zb(),uu(),Ao()}}),Uo.start()}function n2(t){Lo=t,_t&&(_t.installRenderer(t),Oa&&(_t.renderRoster(Oa),Oa=null))}function ET(){return j_()}function oa(){G_(je)}function MT(t=Math.random){const a=typeof t=="function"?t:Math.random,s=Math.ceil(Math.min(Oo,Rh)),r=Math.floor(Math.max(Oo,Rh)),l=Math.max(1,r-s+1),u=Number(a()),f=Number.isFinite(u)?u:Math.random(),h=Math.min(Math.max(f,0),1),m=Math.min(Math.floor(h*l),l-1);return s+m}function xT(t){const s=(Array.isArray(t.traits)?t.traits:[]).length>=3,r=Number.isFinite(t.upkeep),l=Number.isFinite(t.xp);return!s||!r||!l}function Jv(t){t.traits=mC(),t.upkeep=MT(),t.xp=0}function Wv(t,a,s,r={}){const l=r.hudVariant??"classic",u=l==="classic";s.dataset.hudVariant=l,ou=t,Mn&&(Mn.dispose(),Mn=null),Mn=oC({canvas:t,overlay:s,mapRenderer:Um,getUnitById:m=>ls.get(m),requestDraw:()=>{Ut()}}),_t&&(_t.destroy(),_t=null),u?(_t=K_(a,{rosterIcon:En.saunojaRoster}),Lo&&_t.installRenderer(Lo),Oa&&(_t.renderRoster(Oa),Oa=null),Wi&&(_t.updateSummary(Wi),Wi=null)):(Lo=null,Oa=null,Wi=null),un?.dispose(),un=null,u&&(un=m3(qe,{getActiveTierId:()=>We,setActiveTierId:(m,p)=>{const g=UT(m,{persist:p?.persist});return g&&(un?.update(),$t()),g},getTierContext:()=>jm()})),Ba?.dispose(),Ba=null,ir?.destroy(),ir=null;const f={useSisuBurst:()=>{const m=H3(Xe,bt);return m?(na("sisu"),Lt({type:"ability",message:`Sisu bursts forth, spending ${Pi} grit to steel our attendants.`,metadata:{ability:"sisu-burst",cost:Pi}})):na("error"),m},torille:()=>{const m=j3(Xe,bt,qe.pos,Ft);return m?Lt({type:"ability",message:`Torille! Our warriors regroup at the sauna to rally their spirits for ${Zi} SISU.`,metadata:{ability:"torille",cost:Zi}}):na("error"),m}};u&&(Ba=w3(Xe,{saunakunnia:En.resource,sisu:En.sisu,saunaBeer:En.saunaBeer,artocoin:En.artocoin})),ir=ow(Xe,s,f),sr?.destroy(),sr=null;const h=()=>({balance:as,tiers:xm().map(m=>({tier:m,status:is(m,qm())}))});u&&(sr=u_(Bo,{getSelectedUnitId:()=>je.find(m=>m.selected)?.id??null,getComparisonContext:()=>BT(),onEquip:(m,p,g)=>Fm(m,p),getUseUiV2:DT,onUseUiV2Change:c1,getSaunaShopViewModel:()=>h(),onPurchaseSaunaTier:m=>H_(wn(m)),subscribeToSaunaShop:m=>(Ph.add(m),()=>Ph.delete(m))})),u?(HT(),Om(),$t(),ST()):ea&&(ea(),ea=null)}const Ft=new GE(10,10,32),e1=new GA(()=>Ut()),wT=new ux(Ft,e1),Um=new RA(Ft),du=()=>{Um.invalidateCache(),Ut()};se.on("buildingPlaced",du);se.on("buildingRemoved",du);Ft.forEachTile(t=>t.setFogged(!0));kE();const bt=[];function a2(t){return`${t.q},${t.r}`}function AT(){const t=new Set;for(const m of bt)m.isDead()||t.add(a2(m.coord));const a=[],{minQ:s,maxQ:r,minR:l,maxR:u}=Ft,f=m=>{const p=a2(m);t.has(p)||(Ft.ensureTile(m.q,m.r),a.push(m))};for(let m=s;m<=r;m++)f({q:m,r:l}),u!==l&&f({q:m,r:u});for(let m=l+1;m<=u-1;m++)f({q:s,r:m}),r!==s&&f({q:r,r:m});if(a.length===0)return;const h=Math.floor(Math.random()*a.length);return a[h]}function CT(t){const a=sa.get(t);a&&(sa.delete(t),vi.get(a.id)===t&&vi.delete(a.id))}function _T(t){const a=sa.get(t.id);if(a)return{saunoja:a,created:!1,attached:!1};let s=je.find(f=>f.id===t.id);s||(s=je.find(f=>!vi.has(f.id)));let r=!1;s||(s=vm({id:`saunoja-${je.length+1}`,coord:{q:t.coord.q,r:t.coord.r}}),je.push(s),r=!0);const l=vi.get(s.id);l&&l!==t.id&&sa.delete(l),sa.set(t.id,s),vi.set(s.id,t.id),Xv(s,s.behavior,t),vT(s,t),Kv(s,s.effectiveStats),t.setExperience(s.xp);const u=xT(s);return(r||u)&&Jv(s),{saunoja:s,created:r,attached:!0}}function Om(){let t=!1;for(const a of bt){if(a.faction!=="player"||a.isDead())continue;const{saunoja:s,created:r,attached:l}=_T(a);(r||l)&&(t=!0);const u=Number.isFinite(a.stats.health)?Math.max(0,a.stats.health):0;s.hp!==u&&(s.hp=u,t=!0);const f=Number.isFinite(a.getMaxHealth())?Math.max(1,a.getMaxHealth()):1;s.maxHp!==f&&(s.maxHp=f,t=!0);const h=a.getShield(),m=Number.isFinite(h)?Math.max(0,h):0;s.shield!==m&&(s.shield=m,t=!0);const g=a?.lastHitAt;Number.isFinite(g)&&s.lastHitAt!==g&&(s.lastHitAt=g,t=!0);const{q:y,r:v}=a.coord;(s.coord.q!==y||s.coord.r!==v)&&(s.coord={q:y,r:v},t=!0,s.selected&&Gm(s.coord))}return t&&oa(),t}function t1(t,a){if(t.faction==="player"){const u=(a??sa.get(t.id)??null)?.name?.trim();if(u)return u}return`${(t.constructor?.name??"Unit").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase()} ${t.id}`.trim()}function Au(t){if(ls.has(t.id))return;bt.push(t),ls.set(t.id,t);let a=null;if(t.faction==="player"&&(Om()||$o(),a=sa.get(t.id)??null),ou&&Ut(),t.faction==="player"){const r=t1(t,a);Lt({type:"spawn",message:`Our ${r} emerges from the steam.`,metadata:{unitId:t.id,unitName:r,steward:"Our"}}),$t()}}const n1=({unit:t})=>{Au(t)};se.on("unitSpawned",n1);const a1=()=>{$o()},rr=()=>{$o()};se.on("inventoryChanged",a1);se.on("modifierAdded",rr);se.on("modifierRemoved",rr);se.on("modifierExpired",rr);const i1=t=>{un?.handleDamage?.(t)},s1=t=>{un?.handleDestroyed?.(t)};se.on("saunaDamaged",i1);se.on("saunaDestroyed",s1);const r1=()=>{$t()};se.on("unit:stats:changed",r1);function TT(t){const a=sa.get(t.id);if(!a)return 0;const s=Number.isFinite(a.upkeep)?a.upkeep:0;return s>0?s:0}const Xe=new zE(1e3),Bo=new SC;as=ss();os=new Set(bi());Lm=0;const o1=Xe.load(Ft);if(o1){const t=Xe.getNgPlusState();ru(t),Eh(t)}else{const t=Xe.setNgPlusState(ia);ru(t),Eh(t)}Xe.setEnemyScalingBase({aggression:1,cadence:1,strength:1});const Ha=qv();ia.unlockSlots>=2&&(os=new Set(km("aurora-ward")));ia.ngPlusLevel>=3&&(os=new Set(km("mythic-conclave")));Ha.activeTierId!==fr&&!os.has(Ha.activeTierId)&&(os=new Set(km(Ha.activeTierId)));const qm=()=>({artocoinBalance:as,ownedTierIds:os});let We=Ha.activeTierId,dr=Ha.useUiV2;const RT=is(wn(We),qm());RT.unlocked||(We=fr);const l1=wn(We),Cu=()=>{const t=wn(We);return Math.max(0,Math.floor(t.rosterCap))},fu=Fv(Ha.maxRosterSize,Cu());(fu!==Ha.maxRosterSize||Ha.activeTierId!==We||Ha.useUiV2!==dr)&&zv({maxRosterSize:fu,activeTierId:We,useUiV2:dr});const qe=ox({q:Math.floor(Ft.width/2),r:Math.floor(Ft.height/2)},void 0,{maxRosterSize:fu,tier:l1}),NT=t=>Math.max(0,Math.floor(Number.isFinite(t)?t:0)),zm=(t,a={})=>{const s=NT(t.visionRange);s!==qe.visionRange&&(qe.visionRange=s),a.reveal&&Ft.revealAround(qe.pos,qe.visionRange)};zm(l1);const kT=()=>Math.max(dT,qe.maxRosterSize),DT=()=>dr,c1=t=>{const a=!!t;dr!==a&&Im(qe.maxRosterSize,{useUiV2:a})},LT=()=>{c1(!1)},Bm=I_({getTier:()=>wn(We),getRosterLimit:()=>Cu(),getRosterCount:()=>_u(),log:t=>Lt(t),queueCapacity:3});let u1=fu,Hm=We;const Im=(t,a)=>{typeof a?.useUiV2=="boolean"&&(dr=a.useUiV2),zv({maxRosterSize:t,activeTierId:We,useUiV2:dr}),u1=t,Hm=We},jm=()=>qm(),Ho=(t,a={})=>{const s=Cu(),r=Fv(t,s);return r!==qe.maxRosterSize&&(qe.maxRosterSize=r),a.persist&&(We!==Hm||r!==u1)&&Im(r),r};Mu=(t={})=>{const a=jm(),s=xm();let r=fr;for(const f of s)if(is(f,a).unlocked)r=f.id;else break;if(!is(wn(We),a).unlocked||We!==r){const f=We;We=r;const h=wn(We);zm(h,{reveal:!0}),Bm.clearQueue?.("tier-change"),Ho(qe.maxRosterSize,{persist:t.persist}),f!==We&&un?.update?.(),$t();return}t.persist&&(Ho(qe.maxRosterSize,{persist:!0}),$t())};Mu({persist:!0});B_(t=>{os=new Set(t.purchased),t.type==="purchase"&&t.cost&&t.spendResult?.success&&(Lm+=Math.max(0,Math.floor(t.cost))),Gv(),Mu({persist:!0}),un?.update?.()});Y2(t=>{as=t.balance,Gv(),un?.update?.()});const UT=(t,a={})=>{const s=wn(t);return is(s,jm()).unlocked?s.id===We?(a.persist&&We!==Hm&&Im(qe.maxRosterSize),!0):(We=s.id,zm(s,{reveal:!0}),Bm.clearQueue?.("tier-change"),Ho(qe.maxRosterSize,{persist:a.persist}),!0):!1},OT=t=>{Wb+=1;const a=`p${Date.now()}-${Wb}`,s=ym(Xe,"soldier",a,t,"player");return s&&Au(s),s??null},Zh=new a3({difficulty:fT,random:Yv,eliteOdds:$v}),d1=new BE(1e3,t=>{const a=t/1e3;Xe.tick(),Co.tick(a,{state:Xe});const s=Xe.getEnemyScalingSnapshot(),r=Ho(qe.maxRosterSize);yC({dt:a,state:Xe,sauna:qe,heat:qe.heatTracker,units:bt,getUnitUpkeep:TT,pickSpawnTile:()=>A2(qe.pos,bt),spawnBaseUnit:OT,minUpkeepReserve:Math.max(1,Oo),maxSpawns:kT(),rosterCap:r,getRosterCount:_u,tierHelpers:Bm});const l={aggressionMultiplier:s.aggression,cadenceMultiplier:s.cadence,strengthMultiplier:s.strength,calmSecondsRemaining:s.calmSecondsRemaining};Zh.update(a,bt,Au,AT,l),Xe.advanceEnemyCalm(a);const u=Zh.getSnapshot(),f=Math.max(s.calmSecondsRemaining,u.calmSecondsRemaining);if(Ba){const m={stage:u.rampStageLabel,stageIndex:u.rampStageIndex,bundleTier:u.bundleTier,multiplier:u.difficultyMultiplier,cadenceSeconds:u.cadence,effectiveDifficulty:u.effectiveDifficulty,aggressionMultiplier:u.aggressionMultiplier,cadenceMultiplier:u.cadenceMultiplier,strengthMultiplier:u.strengthMultiplier,calmSecondsRemaining:f,spawnCycles:u.spawnCycles};Ba.setEnemyRampSummary(m)}const h=Ei?.getProgress().roster;l3(u,{wipeSince:h?.wipeSince??null,wipeDurationMs:h?.wipeDurationMs??0}),wT.tick(bt,a,qe),jM(a),Om()&&$t(),Xe.save();for(const m of bt)m.isDead()||m.faction!=="player"||Ft.revealAround(m.coord,m.getVisionRange(),{autoFrame:!1});Ut()}),qT=t=>{es&&(es=!1),d1.stop(),Si!==null&&(cancelAnimationFrame(Si),Si=null),Ut();const a=document.getElementById("ui-overlay");if(!a)return;Zn&&(Zn.destroy(),Zn=null);const s=Zh.getSnapshot(),r=x3(t.outcome,{tierId:We,runSeconds:Math.max(0,Nc(t.durationMs)/1e3),enemyKills:Math.max(0,Nc(t.summary.enemyKills)),tilesExplored:Math.max(0,Nc(t.summary.exploration.revealedHexes)),rosterLosses:Math.max(0,Nc(t.summary.roster.totalDeaths)),difficultyScalar:s.effectiveDifficulty,rampStageIndex:s.rampStageIndex});r.artocoins>0&&(as=b3(r.artocoins,{reason:"payout",metadata:{outcome:t.outcome,tier:We},previousBalance:as}));const l=OE(ia,{outcome:t.outcome});Eh(l),Xe.setNgPlusState(l),ru(l),Zn=aT({container:a,resolution:t,artocoinSummary:{balance:as,earned:r.artocoins,spent:Lm},resourceLabels:Qh,onNewRun:()=>{try{typeof window<"u"&&window.localStorage?.removeItem?.("gameState")}catch(f){console.warn("Failed to reset saved game state for NG+",f)}typeof window<"u"&&typeof window.location?.reload=="function"&&window.setTimeout(()=>window.location.reload(),75)},onDismiss:()=>{Zn&&(Zn.destroy(),Zn=null)}})};je=ET();if(je.length===0){const t=vm({id:"saunoja-1",coord:qe.pos,selected:!0,upkeep:Kc});Jv(t),t.upkeep=Kc,je.push(t),oa()}else{let t=!1,a=!1;for(const s of je)s.selected&&(t?(s.selected=!1,a=!0):t=!0);a&&oa()}const zT=bt.some(t=>t.faction==="player"&&!t.isDead());if(!zT){Xe.canAfford(Yy,re.SAUNA_BEER)||Xe.addResource(re.SAUNA_BEER,Yy);const t=`u${bt.length+1}`,a=ym(Xe,"soldier",t,qe.pos,"player");a&&Au(a)}Ft.revealAround(qe.pos,qe.visionRange);Ei=R_({state:Xe,map:Ft,getRosterCount:_u,sauna:qe,rosterWipeGraceMs:8e3,bankruptcyGraceMs:12e3});Qi=Ei.getProgress().strongholds.destroyed;Ei.onProgress(Zv);Ei.onResolution(qT);function BT(){const t=je.find(a=>a.selected)??null;return t?{baseStats:{...t.baseStats},loadout:qn(t.equipment),currentStats:{...t.effectiveStats}}:null}function HT(){ea&&(ea(),ea=null);const t=qw(Xe,{onRosterSelect:FT,onRosterRendererReady:n2,onRosterEquipSlot:YT,onRosterUnequipSlot:VT,getRosterCap:()=>Math.max(0,Math.floor(qe.maxRosterSize)),getRosterCapLimit:()=>Cu(),updateMaxRosterSize:(a,s)=>{const r=Ho(a,{persist:s?.persist});return s?.persist&&$t(),r}});t.addEvent,n2(t.renderRoster),ea=t.dispose}function IT(){un?.update()}function i2(t){Ba?.update(t)}o1||(Xe.addResource(re.SAUNA_BEER,gh),Lt({type:"resource",message:`Quartermaster stocks ${gh} bottles of ${Qh[re.SAUNA_BEER]} to launch your campaign.`,metadata:{resource:re.SAUNA_BEER,amount:gh,context:"initial"}}),Xe.addResource(re.SAUNAKUNNIA,yh),Lt({type:"resource",message:`Sauna elders honor your leadership with ${yh} ${Qh[re.SAUNAKUNNIA]} to celebrate your arrival.`,metadata:{resource:re.SAUNAKUNNIA,amount:yh,context:"initial"}}));const bh=je.find(t=>t.selected);bh&&(lu={q:bh.coord.q,r:bh.coord.r});function jT(t,a){return!t||!a?t===a:t.q===a.q&&t.r===a.r}function Gm(t){return jT(lu,t)?!1:(lu=t?{q:t.q,r:t.r}:null,!0)}function f1(t){let a=!1;for(const s of je)t&&s===t||s.selected&&(s.selected=!1,a=!0);return a}function GT(){let t=!1;return f1()&&(t=!0),Gm(null)&&(t=!0),t}function h1(t){if(!t)return!1;const a=gm(t.type);if(!a)return!1;const s=jo(a,1),r=t.stats;return r.health>s.health||r.attackDamage>s.attackDamage||r.attackRange>s.attackRange||r.movementRange>s.movementRange}function m1(t){let a=!1;return t.selected||(t.selected=!0,a=!0),f1(t)&&(a=!0),Gm(t.coord)&&(a=!0),a}function FT(t){const a=je.find(s=>s.id===t);a&&m1(a)&&(oa(),$t(),Ut())}function p1(t){const a=CE(t.x,t.y,Ft.hexSize),s=je.find(l=>l.coord.q===a.q&&l.coord.r===a.r);(s?m1(s):GT())&&(oa(),$t(),Ut())}function Fm(t,a){const s=je.find(p=>p.id===t);if(!s)return{success:!1,reason:"unit-missing"};const r=qn(s.equipment),l=Xc(s.baseStats,r),u=Mx(s,a);if(!u.success)return{success:!1,reason:u.reason};const f=wu(s,u.loadout);se.emit("unit:stats:changed",{unitId:s.id,stats:f}),se.emit("inventoryChanged",{}),oa(),$t();const h=r.find(p=>p.slot===u.slot)??null;return{success:!0,comparison:{slot:u.slot,previous:e2(h),next:e2(u.item??null),deltas:bT(l,f)}}}function $T(t,a){const s=je.find(y=>y.id===t);if(!s)return null;const r=xx(s,a);if(!r.success||!r.removed)return null;const l=wu(s,r.loadout);se.emit("unit:stats:changed",{unitId:s.id,stats:l}),se.emit("inventoryChanged",{}),oa(),$t();const{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}=r.removed;return{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}}function YT(t,a){const r=Bo.getStash().findIndex(l=>wx(l.id,a));return r===-1?!1:Bo.equipFromStash(r,t,Fm)}function VT(t,a){return Bo.unequipToStash(t,a,$T)}function Ut(){if(!ou)return;const t=ou.getContext("2d"),a=Cv();if(!t||!a)return;if(Mn){const m=typeof performance<"u"?performance.now():Date.now();Mn.step(m)}const s=Mn?.getShakeOffset()??{x:0,y:0},r=Mn?{getUnitAlpha:m=>Mn.getUnitAlpha(m.id)}:void 0,l=Array.isArray(je)&&je.length>0,u=bt.filter(m=>m.faction==="player"&&!m.isDead()),f=qe?{coord:qe.pos,range:qe.visionRange}:null,h=l?bt.filter(m=>m.faction!=="player"):bt;t.save(),(s.x!==0||s.y!==0)&&t.translate(s.x,s.y),HA(t,Um,a.images,h,lu,{saunojas:{units:je,draw:uC,resolveRenderCoord:m=>{const p=xu(m);return p?p.renderCoord??p.coord:null}},sauna:qe,saunaVision:f,fx:r,friendlyVisionSources:u}),t.restore()}const g1=({policy:t})=>{Lt({type:"policy",message:`Sauna council toasts a fresh keg for policy: ${t.name}.`,metadata:{policy:t.id,name:t.name}})};se.on(Gt.APPLIED,g1);const y1=({unitId:t,attackerId:a,attackerFaction:s,unitFaction:r})=>{const l=bt.findIndex(v=>v.id===t),u=l!==-1?bt[l]:null,f=u?{q:u.coord.q,r:u.coord.r}:null,h=r==="player"?sa.get(t)??null:null;let m=!1;if(r==="player"){const v=h??je.find(S=>vi.get(S.id)===t||S.id===t)??null;v&&(v.hp!==0&&(v.hp=0,m=!0),v.shield!==0&&(v.shield=0,m=!0))}const p=u?t1(u,h):`unit ${t}`;let g=!1;if(s==="player"&&r&&r!=="player"){const v=a?ls.get(a)??null:null,{xp:S,elite:M,boss:_}=gT(u);S>0&&mT(v,S,{source:"kill",label:p,elite:M,boss:_})&&(g=!0)}if(l!==-1&&(u&&e1.clear(u,{snap:!0}),bt.splice(l,1),ls.delete(t),CT(t),Ut()),(m||g)&&oa(),(r==="player"||g)&&$t(),s==="player"&&r&&r!=="player"){const v=h1(u??null)||Vv()<$v,S=x_({factionId:r,elite:v});if(S.rolls.length>0){const M=je.find(_=>_.selected)??null;for(const _ of S.rolls)if(Bo.addLoot(_,{unitId:M?.id,sourceTableId:S.tableId,equip:Fm}).equipped){const N=M?.name??"our champion";Lt({type:"loot",message:`Quartermaster fastens ${_.item.name} to ${N}.`,metadata:{item:_.item.name,equipped:!0,owner:N,source:p}})}else Lt({type:"loot",message:`Quartermaster stores ${_.item.name} recovered from ${p}.`,metadata:{item:_.item.name,equipped:!1,source:p}})}}s==="player"&&r&&r!=="player"&&(Xe.addResource(re.SAUNAKUNNIA,rT),Xe.addResource(re.SISU,1),Lt({type:"resource",message:"Our grit surges — +1 SISU earned for the vanquished foe.",metadata:{resource:re.SISU,amount:1,context:"victory"}})),f&&Ft.revealAround(f,1,{autoFrame:!1});const y=r==="player"?"our":"a rival";Lt({type:"combat",message:`The steam hushes as ${y} ${p} grows still.`,metadata:{side:y,unit:p}})};se.on("unitDied",y1);function Jh(){es=!1,Ei?.offProgress(Zv),Ei?.dispose(),Ei=null,Qi=0,F3(),Zn&&(Zn.destroy(),Zn=null),Si!==null&&(cancelAnimationFrame(Si),Si=null);try{Xe.save()}catch(t){console.warn("Failed to persist game state during cleanup",t)}try{oa()}catch(t){console.warn("Failed to persist Saunoja roster during cleanup",t)}Mn&&(Mn.dispose(),Mn=null),se.off(Gt.APPLIED,g1),se.off("unitDied",y1),se.off("unitSpawned",n1),se.off("inventoryChanged",a1),se.off("modifierAdded",rr),se.off("modifierRemoved",rr),se.off("modifierExpired",rr),se.off("unit:stats:changed",r1),se.off("saunaDamaged",i1),se.off("saunaDestroyed",s1),se.off("buildingPlaced",du),se.off("buildingRemoved",du),ea&&(ea(),ea=null),sr&&(sr.destroy(),sr=null),un&&(un.dispose(),un=null),Ba&&(Ba.dispose(),Ba=null),ir&&(ir.destroy(),ir=null),_t&&(_t.destroy(),_t=null),Oa=null,Wi=null,Lo=null,Ao()}async function XT(){if(es)return;if(!Cv()){console.error("Cannot start game without loaded assets.");return}es=!0,$t(),Ut();try{await xv(()=>{Ut()}).then(()=>{Ut()})}catch(r){console.warn("Failed to preload Saunoja icon before starting the game",r)}let a=performance.now();function s(r){if(!es)return;const l=r-a;a=r;const u=_m();d1.tick(u?0:l),u?i2(0):(IT(),i2(l),$o()),Ut(),es&&(Si=requestAnimationFrame(s))}Si=requestAnimationFrame(s)}function _u(){let t=0;for(const a of bt)a.faction==="player"&&!a.isDead()&&(t+=1);return t}function KT(){const t={engaged:0,reserve:1,downed:2},a=je.map(s=>{const r=vi.get(s.id),l=r?ls.get(r):void 0,u=l?!l.isDead()&&l.stats.health>0:!1,f=s.effectiveStats,h=s.baseStats,m=Math.round(l?Math.max(0,l.stats.health):Math.max(0,s.hp)),p=Math.round(l?Math.max(1,l.getMaxHealth()):Math.max(1,f.health)),g=Math.round(l?Math.max(0,l.stats.attackDamage):Math.max(0,f.attackDamage)),y=Math.round(l?Math.max(0,l.stats.attackRange):Math.max(0,f.attackRange)),v=Math.round(l?Math.max(0,l.stats.movementRange):Math.max(0,f.movementRange)),S=l?.stats.defense??f.defense??0,M=Math.round(Math.max(0,S)),_=l?l.getShield():f.shield??s.shield,T=Math.round(Math.max(0,_)),N=Math.max(0,Math.round(s.upkeep)),O=m<=0?"downed":u?"engaged":"reserve",B=Qv(s),Y=s.items.map(ne=>({...ne})),X=s.modifiers.map(ne=>({...ne})),V=cr.map(ne=>{const F=Go(ne),H=s.equipment[ne],C=H?{id:H.id,name:H.name,description:H.description,icon:H.icon,rarity:H.rarity,quantity:H.quantity,slot:ne}:null,J=H?PT(H.modifiers,H.quantity):null;return{id:ne,label:F.label,description:F.description,maxStacks:F.maxStacks,item:C,modifiers:J}}),W={health:Math.round(Math.max(0,h.health)),maxHealth:Math.round(Math.max(1,h.health)),attackDamage:Math.round(Math.max(0,h.attackDamage)),attackRange:Math.round(Math.max(0,h.attackRange)),movementRange:Math.round(Math.max(0,h.movementRange)),defense:typeof h.defense=="number"&&h.defense>0?Math.round(h.defense):void 0,shield:typeof h.shield=="number"&&h.shield>0?Math.round(h.shield):void 0};return{id:s.id,name:s.name,upkeep:N,status:O,selected:!!s.selected,traits:[...s.traits],stats:{health:m,maxHealth:p,attackDamage:g,attackRange:y,movementRange:v,defense:M>0?M:void 0,shield:T>0?T:void 0},baseStats:W,progression:B,equipment:V,items:Y,modifiers:X}});return a.sort((s,r)=>{const l=t[s.status]-t[r.status];return l!==0?l:s.name.localeCompare(r.name,"en")}),a}function QT(){return je.length===0?null:je.find(t=>t.selected)??je.find(t=>t.hp>0)??je[0]}function PT(t,a){const s=Math.max(1,Math.round(a)),r={};return typeof t.health=="number"&&(r.health=t.health*s),typeof t.attackDamage=="number"&&(r.attackDamage=t.attackDamage*s),typeof t.attackRange=="number"&&(r.attackRange=t.attackRange*s),typeof t.movementRange=="number"&&(r.movementRange=t.movementRange*s),typeof t.defense=="number"&&(r.defense=t.defense*s),typeof t.shield=="number"&&(r.shield=t.shield*s),r}function ZT(){const t=_u(),a=QT();let s=null;return a&&(s={id:a.id,name:a.name||"Saunoja",traits:[...a.traits],upkeep:Math.max(0,Math.round(a.upkeep)),progression:Qv(a)}),{count:t,card:s}}function $o(t){const a=KT();Oa=a,_t&&_t.renderRoster(a)}function $t(){const t=ZT();_t?(_t.updateSummary(t),Wi=null):Wi=t,$o()}function JT(t){const{overlay:a,resourceBar:s,onReturnToClassic:r}=t,l=hr(a),{regions:u}=l,f=document.createElement("div");f.className="pointer-events-none absolute inset-0 grid place-items-center bg-[radial-gradient(circle_at_top,rgba(18,28,45,0.92),rgba(6,10,18,0.94))] p-[clamp(1.5rem,4vw,3.25rem)] z-overlay";const h=document.createElement("section");h.className="pointer-events-auto relative grid w-full max-w-[min(640px,90vw)] gap-4 overflow-hidden rounded-[28px] border border-[rgba(128,168,236,0.28)] bg-[linear-gradient(145deg,rgba(31,46,74,0.95),rgba(14,20,33,0.95))] p-[clamp(1.75rem,4vw,2.5rem)] text-slate-100 shadow-[0_40px_90px_rgba(10,14,28,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)]",h.setAttribute("aria-live","polite"),h.setAttribute("role","status");const m=document.createElement("h1");m.className="m-0 text-[clamp(1.6rem,3vw,2.1rem)] font-semibold uppercase tracking-[0.04em]",m.textContent="Experimental HUD Enabled",h.appendChild(m);const p=document.createElement("p");p.className="m-0 text-base leading-relaxed text-slate-100/90",p.textContent="The React/Tailwind interface is bootstrapped for this session. Gameplay systems continue to run, and classic HUD elements are paused while the new shell is under construction.",h.appendChild(p);const g=document.createElement("p");g.id="ui-v2-classic-hint",g.className="m-0 text-sm leading-relaxed text-slate-200/75",g.textContent="Need the familiar layout? Use the control below to restore the classic HUD instantly. You can always revisit the experimental overlay from the quartermaster.",h.appendChild(g);const y=document.createElement("button");y.type="button",y.dataset.testid="return-to-classic-hud",y.setAttribute("aria-describedby",g.id),y.className="inline-flex items-center justify-center self-start rounded-full border border-[rgba(122,170,255,0.45)] bg-[rgba(16,24,38,0.92)] px-5 py-2 text-sm font-semibold uppercase tracking-[0.12em] text-slate-100 shadow-[0_14px_40px_rgba(8,12,24,0.45)] transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[rgba(90,164,255,0.85)] hover:border-[rgba(164,202,255,0.65)] hover:bg-[rgba(24,34,52,0.97)] disabled:cursor-progress disabled:opacity-80",y.textContent="Return to Classic HUD";const v=()=>{if(y.disabled)return;y.disabled=!0,y.setAttribute("aria-busy","true");const _="Return to Classic HUD";y.textContent="Restoring Classic HUD…";try{r()}catch(T){console.error("Failed to restore the classic HUD",T),y.disabled=!1,y.removeAttribute("aria-busy"),y.textContent=_}};y.addEventListener("click",v),h.appendChild(y);const S=document.createElement("div");S.className="pointer-events-none absolute -left-[30%] -top-[40%] h-[420px] w-[420px] bg-[radial-gradient(circle,rgba(90,164,255,0.35),rgba(90,164,255,0))] blur-[0.5px]",h.appendChild(S);const M=document.createElement("div");return M.className="mt-2 rounded-[18px] border border-[rgba(128,168,236,0.2)] bg-[rgba(10,16,26,0.55)] p-4 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]",M.appendChild(s),h.appendChild(M),f.appendChild(h),u.content.appendChild(f),{destroy(){y.removeEventListener("click",v),M.contains(s)&&a.prepend(s),f.remove()}}}function b1(t){if(!t)return{showLoader:()=>({update:()=>{},clear:()=>{},dispose:()=>{}}),showBanner:()=>null,removeTransientUI:()=>{}};const a=()=>{let f=t.querySelector(".hud-banner-stack");return f||(f=document.createElement("div"),f.className="hud-banner-stack",t.append(f)),f},s=(f,h,m)=>{let p=!1;const g=()=>{p||(p=!0,f.removeEventListener("transitionend",g),m())};f.addEventListener("transitionend",g),requestAnimationFrame(()=>{f.classList.add(h)}),window.setTimeout(g,400)};return{showLoader:(f="Heating the sauna stones…")=>{const h=document.createElement("div");h.className="hud-loader",h.setAttribute("role","status"),h.setAttribute("aria-live","polite");const m=document.createElement("div");m.className="hud-loader__card";const p=document.createElement("div");p.className="hud-loader__spinner",p.setAttribute("aria-hidden","true");const g=document.createElement("p");g.className="hud-loader__message",g.textContent=f,m.append(p,g),h.append(m),t.append(h);let y=!1;return{update(v){g.textContent=v},clear(){y||s(h,"hud-loader--hidden",()=>{y=!0,h.remove()})},dispose(){y||(y=!0,h.remove())}}},showBanner:(f,h)=>{const m=a(),p=document.createElement("section");p.className=`hud-banner hud-banner--${f}`,p.setAttribute("role",f==="error"?"alert":"status"),p.setAttribute("aria-live",f==="error"?"assertive":"polite");const g=document.createElement("header");g.className="hud-banner__header";const y=document.createElement("p");y.className="hud-banner__title",y.textContent=h.title??(f==="error"?"Attention required":f==="warning"?"Heads up":"Status update"),g.append(y);const v=document.createElement("ul");v.className="hud-banner__list";for(const T of h.messages){const N=document.createElement("li");N.textContent=T,v.append(N)}if(p.append(g),h.messages.length&&p.append(v),h.actions?.length){const T=document.createElement("div");T.className="hud-banner__actions";for(const N of h.actions){const O=document.createElement("button");O.type="button",O.className=N.variant==="secondary"?"hud-banner__button hud-banner__button--secondary":"hud-banner__button",O.textContent=N.label,O.addEventListener("click",()=>{N.onClick()}),T.append(O)}p.append(T)}let S,M=!1;const _=()=>{M||(M=!0,S&&window.clearTimeout(S),s(p,"hud-banner--hide",()=>{p.remove(),m.hasChildNodes()||m.remove()}))};if(h.dismissible!==!1){const T=document.createElement("button");T.type="button",T.className="hud-banner__close",T.setAttribute("aria-label","Dismiss notification"),T.textContent="×",T.addEventListener("click",()=>{_()}),g.append(T)}return m.append(p),h.autoCloseMs&&h.autoCloseMs>0&&(S=window.setTimeout(()=>_(),h.autoCloseMs)),{element:p,dismiss:_}},removeTransientUI:()=>{t.querySelectorAll(".hud-loader").forEach(f=>{f.remove()}),t.querySelectorAll(".hud-banner-stack").forEach(f=>{f.remove()})}}}async function WT(t){const a=Object.entries(t),s=await Promise.allSettled(a.map(([f,h])=>h.load().then(m=>({key:f,descriptor:h,value:m})))),r={},l=[],u=[];return s.forEach((f,h)=>{const[m,p]=a[h],g=p.label??String(m);if(f.status==="fulfilled"){const{value:v}=f.value;if(r[m]=v.value,v.warnings?.length)for(const S of v.warnings)l.push(g?`${g}: ${S}`:S);if(v.errors?.length)for(const S of v.errors)u.push(g?`${g}: ${S}`:S);return}const y=eR(f.reason);u.push(g?`${g}: ${y}`:y)}),{resources:r,warnings:l,errors:u}}function eR(t){if(t instanceof Error)return t.message;if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return String(t)}}const tR="Heating the sauna stones…",nR="Polishing sauna ambience…";function aR(t){if(t instanceof Error&&t.message)return t.message;if(typeof t=="string"&&t.trim().length>0)return t;try{return JSON.stringify(t)}catch{return String(t)}}function iR(t){const a=new Set,s=f=>{a.forEach(h=>h(f))},r=t.formatError??aR;return{run:async f=>{s({type:"status",phase:"start",message:tR});try{const{resources:h,warnings:m,errors:p}=await WT({assets:{label:"Core assets",load:async()=>{const y=await t.loadAssets(t.assetPaths);return{value:y.assets,errors:y.failures}}},saunojaIcon:{label:"Saunoja icon",load:async()=>{try{return await t.preloadSaunojaIcon(),{value:!0}}catch(y){return{value:!1,warnings:[`Unable to preload Saunoja icon (${r(y)})`]}}}}});if(t.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"status",phase:"progress",message:nR});const g=h.assets;if(!g){const y=p.length?[...p]:["Critical assets were unavailable. Please refresh to try again."];s({type:"fatal",messages:y});return}if(p.length&&s({type:"errors",errors:p}),m.length&&s({type:"warnings",warnings:m}),t.setAssets(g),t.shouldAbort?.(f)){s({type:"cancelled"});return}t.startGame(),s({type:"ready",assets:g,warnings:m,errors:p})}catch(h){if(t.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"failure",error:h,message:r(h)})}},subscribe:f=>(a.add(f),()=>{a.delete(f)})}}const sR="grabbing";function rR(t,a){const s=a.dragCursor??sR;let r=!1,l=null,u=0,f=0,h=null;const m=S=>{S.pointerType!=="mouse"||S.button!==0||(r=!0,l=S.pointerId,u=S.clientX,f=S.clientY,h=t.style.cursor??"",t.setPointerCapture?.(S.pointerId),t.style.cursor=s,a.onPanStart?.(S))},p=S=>{if(!r||l!==S.pointerId)return;const M=S.clientX-u,_=S.clientY-f;u=S.clientX,f=S.clientY,a.onPan(M,_,S)},g=S=>{!r||l!==S.pointerId||(r=!1,l=null,t.releasePointerCapture?.(S.pointerId),t.style.cursor=h??"",a.onPanEnd?.(S))},y=S=>{g(S)},v=S=>{g(S)};return t.addEventListener("pointerdown",m),t.addEventListener("pointermove",p),t.addEventListener("pointerup",y),t.addEventListener("pointercancel",v),t.addEventListener("pointerleave",v),()=>{t.removeEventListener("pointerdown",m),t.removeEventListener("pointermove",p),t.removeEventListener("pointerup",y),t.removeEventListener("pointercancel",v),t.removeEventListener("pointerleave",v),r&&l!==null&&t.releasePointerCapture?.(l),t.style.cursor=h??""}}const oR=10,lR=250;function Vi(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function cR(t,a){const s=a.tapMaxMovement??oR,r=a.tapMaxDuration??lR;let l=null;const u=y=>{if(y.touches.length===1){const v=y.touches[0];l={mode:"pan",lastX:v.clientX,lastY:v.clientY,startX:v.clientX,startY:v.clientY,startTime:Vi(),moved:!1};return}if(y.touches.length>=2){const[v,S]=[y.touches[0],y.touches[1]];l={mode:"pinch",lastCenterX:(v.clientX+S.clientX)/2,lastCenterY:(v.clientY+S.clientY)/2,lastDistance:Math.hypot(v.clientX-S.clientX,v.clientY-S.clientY),startTime:Vi(),moved:!1}}},f=(y,v)=>{if(!l||l.mode!=="pan")return;const S=y.clientX-l.lastX,M=y.clientY-l.lastY;!l.moved&&Math.hypot(S,M)>1&&(l.moved=!0),l.lastX=y.clientX,l.lastY=y.clientY,a.onPan(S,M,v)},h=(y,v,S)=>{const M=(y.clientX+v.clientX)/2,_=(y.clientY+v.clientY)/2,T=Math.hypot(y.clientX-v.clientX,y.clientY-v.clientY);let N=1,O=0,B=0;l&&l.mode==="pinch"?(N=T/l.lastDistance,O=M-l.lastCenterX,B=_-l.lastCenterY):l={mode:"pinch",lastCenterX:M,lastCenterY:_,lastDistance:T,startTime:Vi(),moved:!1},!(!l||l.mode!=="pinch")&&(l.lastCenterX=M,l.lastCenterY=_,l.lastDistance=T,l.moved=!0,a.onPinch({centerX:M,centerY:_,scale:N,deltaCenterX:O,deltaCenterY:B},S))},m=y=>{if(!l||y.touches.length===0)return;if(y.preventDefault(),y.touches.length===1){const M=y.touches[0];l.mode!=="pan"&&(l={mode:"pan",lastX:M.clientX,lastY:M.clientY,startX:M.clientX,startY:M.clientY,startTime:Vi(),moved:!0}),f(M,y);return}const[v,S]=[y.touches[0],y.touches[1]];h(v,S,y)},p=()=>!l||l.mode!=="pan"||Math.hypot(l.lastX-l.startX,l.lastY-l.startY)>s?!1:Vi()-l.startTime<=r,g=y=>{if(l){if(y.touches.length===0){l.mode==="pan"&&a.onTap&&p()&&a.onTap({x:l.startX,y:l.startY},y),l=null;return}if(y.touches.length===1){const v=y.touches[0];l={mode:"pan",lastX:v.clientX,lastY:v.clientY,startX:v.clientX,startY:v.clientY,startTime:Vi(),moved:!0};return}if(y.touches.length>=2){const[v,S]=[y.touches[0],y.touches[1]];l={mode:"pinch",lastCenterX:(v.clientX+S.clientX)/2,lastCenterY:(v.clientY+S.clientY)/2,lastDistance:Math.hypot(v.clientX-S.clientX,v.clientY-S.clientY),startTime:Vi(),moved:!0}}}};return t.addEventListener("touchstart",u,{passive:!1}),t.addEventListener("touchmove",m,{passive:!1}),t.addEventListener("touchend",g),t.addEventListener("touchcancel",g),()=>{t.removeEventListener("touchstart",u),t.removeEventListener("touchmove",m),t.removeEventListener("touchend",g),t.removeEventListener("touchcancel",g),l=null}}const uR=.5,dR=3.5;function Wh(t,a,s,r,l){const u=t.getBoundingClientRect(),f=a-u.left,h=s-u.top,m=u.width/2,p=u.height/2;return{x:l.x+(f-m)/r,y:l.y+(h-p)/r}}function fR(t){return Math.min(dR,Math.max(uR,t))}function v1(t,a,s,r=xe.zoom,l=xe){return Wh(t,a,s,r,l)}function S1(t,a,s,r){const l=fR(r);if(l===xe.zoom)return;const u={x:xe.x,y:xe.y},f=Wh(t,a,s,xe.zoom,u),h=Wh(t,a,s,l,u);xe.x+=f.x-h.x,xe.y+=f.y-h.y,xe.zoom=l,Ut()}function vh(t,a){t===0&&a===0||(xe.x-=t/xe.zoom,xe.y-=a/xe.zoom,Ut())}function hR(t){const a=window.devicePixelRatio||1,s=Math.max(window.innerWidth,1),r=Math.max(window.innerHeight,1);t.style.width=`${s}px`,t.style.height=`${r}px`,t.width=Math.round(s*a),t.height=Math.round(r*a);const l=t.getContext("2d");l&&l.setTransform(1,0,0,1,0,0),Ut()}const mR=.0015,em=[];let $m=0,ra=null,Tu=b1(null),kt=null,or="classic",ts=null,Ym=null,Vm=null;function pR(){if(typeof document>"u")return;const t=document.querySelector("[data-build-commit]");if(!t)return;const a="a660996".trim(),s=a.length>0&&a!=="unknown",r=s?`#${a}`:"DEV BUILD";t.textContent=r,t.dataset.state=s?"commit":"dev";const l=t.closest("#build-id");if(l){const u=s?`Build commit ${a}`:"Development build";l.setAttribute("aria-label",u),l.title=s?`Autobattles build ${a}`:"Unversioned development build",l.dataset.buildState=s?"release":"development"}}pR();function qa(t){em.push(t)}function gR(){for(;em.length;){const t=em.pop();try{t?.()}catch(a){console.error("Error during cleanup",a)}}}function yR(t){qa(()=>t.dispose())}function Dc(t,a){const s=Tu.showBanner(t,a);s&&qa(()=>s.dismiss())}function bR(t){switch(t.type){case"status":if(t.phase==="start"){kt?.dispose();const a=Tu.showLoader(t.message);kt=a,yR(a)}else kt&&(kt.update(t.message),kt.clear(),kt=null);break;case"ready":kt?.clear(),kt=null;break;case"warnings":t.warnings.length&&(console.warn("Resource loader warnings",t.warnings),Dc("warning",{title:"Heads up",messages:t.warnings,autoCloseMs:12e3}));break;case"errors":t.errors.length&&(console.error("Resource loader errors",t.errors),Dc("error",{title:"Some resources failed to load",messages:t.errors,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]}));break;case"fatal":console.error("Critical assets failed to load",t.messages),kt?.clear(),kt=null,Dc("error",{title:"Unable to start the sauna battle",messages:t.messages,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}],dismissible:!1});break;case"failure":console.error("Failed to initialize resources",t.error),kt?.clear(),kt=null,Dc("error",{title:"Failed to initialize",messages:[t.message],actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]});break;case"cancelled":kt?.dispose(),kt=null;break}}const E1=iR({assetPaths:Q5,loadAssets:DE,preloadSaunojaIcon:xv,setAssets:P5,startGame:XT,shouldAbort:t=>t!==$m});E1.subscribe(bR);function s2(t){if(!ra)return;t.preventDefault();const a=Math.exp(-t.deltaY*mR),s=xe.zoom*a;S1(ra,t.clientX,t.clientY,s)}function r2(t){if(!ra)return;const a=v1(ra,t.clientX,t.clientY);p1(a)}function vR(t){t.addEventListener("click",r2),qa(()=>t.removeEventListener("click",r2)),t.addEventListener("wheel",s2,{passive:!1}),qa(()=>t.removeEventListener("wheel",s2));const a=rR(t,{onPan:(r,l)=>{vh(r,l)},dragCursor:"grabbing"});qa(a);const s=cR(t,{onPan:(r,l)=>{vh(r,l)},onPinch:({centerX:r,centerY:l,scale:u,deltaCenterX:f,deltaCenterY:h})=>{S1(t,r,l,xe.zoom*u),vh(f,h)},onTap:r=>{const l=v1(t,r.x,r.y);p1(l)}});qa(s)}function SR(){$m+=1,gR(),ts?.destroy(),ts=null,kt?.dispose(),kt=null,ra&&(ra.style.cursor=""),ra=null,Ym=null,Vm=null,Tu.removeTransientUI(),Jh()}function ER(){if(LT(),or==="classic")return;const t=Vm,a=Ym,s=ra;if(!t||!a||!s){console.warn("Unable to restore the classic HUD: required DOM references are unavailable."),ts?.destroy(),ts=null,or="classic";return}ts?.destroy(),ts=null,or="classic",Wv(s,a,t,{hudVariant:"classic"})}function MR(){const t=document.getElementById("game-canvas"),a=document.getElementById("resource-bar"),s=document.getElementById("ui-overlay");if(!t||!a||!s){console.error("Autobattles4xFinsauna shell is missing the required canvas, overlay, or resource bar elements.",{hasCanvas:!!t,hasResourceBar:!!a,hasOverlay:!!s});return}ra&&SR();const r=++$m;or=qv().useUiV2?"v2":"classic",ra=t,Ym=a,Vm=s,Tu=b1(s);const u=dw();qa(()=>u.dispose()),Wv(t,a,s,{hudVariant:or}),or==="v2"&&(ts=JT({overlay:s,resourceBar:a,onReturnToClassic:ER})),vR(t);const f=()=>hR(t);window.addEventListener("resize",f),qa(()=>window.removeEventListener("resize",f)),window.addEventListener("beforeunload",Jh),qa(()=>window.removeEventListener("beforeunload",Jh)),f(),import.meta.vitest||E1.run(r)}function xR(){if(typeof document>"u")return;const t=()=>{document.removeEventListener("DOMContentLoaded",t),MR()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",t);return}t()}import.meta.vitest||xR();
