(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function s(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(l){if(l.ep)return;l.ep=!0;const u=s(l);fetch(l.href,u)}})();class wM{listeners=new Map;on(a,s){const r=this.listeners.get(a)??[];r.push(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);if(!r)return;const l=r.indexOf(s);l!==-1&&(r.splice(l,1),r.length===0?this.listeners.delete(a):this.listeners.set(a,r))}emit(a,s){const r=this.listeners.get(a);if(r)for(const l of r)l(s)}}const se=new wM;class nm{type="farm";cost=50;beerPerTick=1}class r2{type="barracks";cost=100;trainingCapacity=1}const o2=Math.sqrt(3),l2=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function na(t,a){return{x:a*o2*(t.q+t.r/2),y:a*(3/2)*t.r}}function Mo(t,a,s){const r=(o2/3*t-.3333333333333333*a)/s,l=2/3*a/s;return{q:r,r:l}}function CM(t,a,s){return TM(Mo(t,a,s))}function Bc(t){return l2.map(a=>({q:t.q+a.q,r:t.r+a.r}))}function Zs(t,a){const s=-t.q-t.r,r=-a.q-a.r;return Math.max(Math.abs(t.q-a.q),Math.abs(t.r-a.r),Math.abs(s-r))}function TM(t){let a=t.q,s=t.r,r=-a-s,l=Math.round(a),u=Math.round(r),f=Math.round(s);const h=Math.abs(l-a),m=Math.abs(u-r),p=Math.abs(f-s);return h>m&&h>p?l=-u-f:m>p?u=-l-f:f=-l-u,{q:l,r:f}}const qc=new Set;let Lc=32;function _M(t){return`${t.q},${t.r}`}function Mh(t,a){Lc=a,qc.add(_M(t))}function NM(t){if(qc.size===0)return{center:{x:0,y:0},zoom:1};const a=Lc*Math.sqrt(3),s=Lc*2,r=a/2,l=s/2;let u=1/0,f=1/0,h=-1/0,m=-1/0;for(const B of qc){const[V,X]=B.split(",").map(Number),{x:$,y:W}=na({q:V,r:X},Lc),ne=$-r,Y=W-l;u=Math.min(u,ne),f=Math.min(f,Y),h=Math.max(h,ne+a),m=Math.max(m,Y+s)}const p=h-u,g=m-f,b=96,v={x:u+p/2,y:f+g/2},S=Math.max(0,Math.min(t.safeRight??0,t.width)),T=Math.max(t.width-S,1)/(p+b*2),_=t.height/(g+b*2),R=Math.min(T,_);return{center:{x:R>0?v.x-S/(2*R):v.x,y:v.y},zoom:R}}const xe={x:0,y:0,zoom:1};function RM(t,a=300){const s=xe.x,r=xe.y,l=xe.zoom,u=typeof performance<"u"?performance.now():Date.now(),f=h=>{const m=Math.min((h-u)/a,1);xe.x=s+(t.center.x-s)*m,xe.y=r+(t.center.y-r)*m,xe.zoom=l+(t.zoom-l)*m,m<1&&(typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),16))};typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),0)}function kM(){qc.clear()}async function LM(t){const a={},s={},r=[],l=Object.entries(t.images??{}).map(([f,h])=>new Promise(m=>{const p=new Image;p.onload=()=>{a[f]=p,m()},p.onerror=()=>{const g=`Failed to load image: ${h}`;console.error(g),r.push(g),m()},p.src=h})),u=Object.entries(t.sounds??{}).map(([f,h])=>new Promise(m=>{const p=new Audio;p.oncanplaythrough=()=>{s[f]=p,m()},p.onerror=()=>{const g=`Failed to load sound: ${h}`;console.error(g),r.push(g),m()},p.src=h,p.load()}));return await Promise.all([...l,...u]),{assets:{images:a,sounds:s},failures:r}}function am(t){if(typeof globalThis.localStorage>"u")return;const a=globalThis.localStorage.getItem(t);if(a)try{return JSON.parse(a)}catch(s){console.warn(`Failed to parse data for "${t}", clearing`,s),globalThis.localStorage.removeItem(t);return}}var re=(t=>(t.SAUNA_BEER="sauna-beer",t.SAUNAKUNNIA="saunakunnia",t.SISU="sisu",t))(re||{});const uc={"sauna-beer":1,saunakunnia:0,sisu:0},c2="/assets/sauna-beer-CgafwOhX.svg",u2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eResource%20Icon%3c/title%3e%3cdesc%20id='desc'%3eA%20luminous%20crest%20symbolising%20generic%20resources.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='resource-bg'%20cx='50%25'%20cy='50%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='resource-core'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2338bdf8'%20/%3e%3c/linearGradient%3e%3cfilter%20id='resource-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='6'%20flood-color='%2338bdf8'%20flood-opacity='0.45'%20/%3e%3c/filter%3e%3c/defs%3e%3cg%20filter='url(%23resource-glow)'%3e%3ccircle%20cx='32'%20cy='32'%20r='22'%20fill='%230f172a'%20stroke='url(%23resource-bg)'%20stroke-width='4'%20/%3e%3cpath%20d='M32%2016l-12%2014%2012%2022%2012-22z'%20fill='url(%23resource-core)'%20stroke='%23f8fafc'%20stroke-width='2'%20/%3e%3cpath%20d='M20%2030l-4%208%2016%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M44%2030l4%208-16%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/g%3e%3c/svg%3e",d2="/assets/saunoja-roster-Bfn4ZKxh.svg",Gt={APPLIED:"policy:applied",REJECTED:"policy:rejected"},f2=[{id:"eco",name:"Evergreen Eco Mandate",description:"Increase passive sauna beer brewing by one bottle each production tick.",cost:15,resource:re.SAUNAKUNNIA,prerequisites:[],visuals:{icon:u2,gradient:"linear-gradient(135deg, rgba(66, 240, 155, 0.9), rgba(13, 114, 234, 0.85))",accentColor:"#34d399",badges:["Economy","Sustainability"],flair:"Green-lit by the council of whisked sauna masters."},effects:[{event:Gt.APPLIED,once:!0,invoke:({state:t})=>{t.modifyPassiveGeneration(re.SAUNA_BEER,1)}}],spotlight:"Sustainably expand your brewing line with solar-heated mash tuns."},{id:"temperance",name:"Aurora Temperance Treaty",description:"Boost night shift work speed by 5% once the eco initiative is live.",cost:25,resource:re.SAUNAKUNNIA,prerequisites:[{description:"Enact the Evergreen Eco Mandate.",isSatisfied:t=>t.hasPolicy("eco")},{description:"Stockpile at least 30 Sauna Beer bottles to brief the midnight crews.",isSatisfied:t=>t.getResource(re.SAUNA_BEER)>=30}],visuals:{icon:d2,gradient:"linear-gradient(140deg, rgba(46, 51, 227, 0.9), rgba(118, 75, 162, 0.85))",accentColor:"#6366f1",badges:["Discipline","Night Ops"],flair:"Whispers of aurora spirits keep the crew laser-focused after dusk."},effects:[{event:Gt.APPLIED,once:!0,invoke:({state:t})=>{t.nightWorkSpeedMultiplier=Number((t.nightWorkSpeedMultiplier*1.05).toFixed(4))}}],spotlight:"Glow-lit helmets and synchronized chants keep the late shift on tempo."},{id:"steam-diplomats",name:"Steam Diplomats Accord",description:"Import two additional sauna beer bottles per tick via gilded trade routes.",cost:35,resource:re.SAUNAKUNNIA,prerequisites:[{description:"Secure the Aurora Temperance Treaty for your envoys.",isSatisfied:t=>t.hasPolicy("temperance")},{description:"Hold a reserve of 50 Sauna Beer bottles to fund the embassy festivities.",isSatisfied:t=>t.getResource(re.SAUNA_BEER)>=50}],visuals:{icon:c2,gradient:"linear-gradient(150deg, rgba(255, 173, 94, 0.92), rgba(255, 99, 71, 0.85))",accentColor:"#fb923c",badges:["Diplomacy","Logistics"],flair:"Silver samovars arrive with diplomatic steam-born delights."},effects:[{event:Gt.APPLIED,once:!0,invoke:({state:t})=>{t.modifyPassiveGeneration(re.SAUNA_BEER,2)}}],spotlight:"Trade envoys pipe artisanal steam through every new supply line."}],h2=new Map;for(const t of f2)h2.set(t.id,t);function m2(){return f2}function by(t){return h2.get(t)}const Hc="progression:ngPlusState",im=5,p2=1831565813,Dc=Object.freeze({aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1}),Ic=Object.freeze({runSeed:0,ngPlusLevel:0,unlockSlots:0,enemyTuning:Dc});function Uf(t,a,s,r){const l=Number(t);return Number.isFinite(l)?Math.min(s,Math.max(a,l)):r}function DM(t){return{aggressionMultiplier:Uf(t?.aggressionMultiplier,.25,6,Dc.aggressionMultiplier),cadenceMultiplier:Uf(t?.cadenceMultiplier,.25,4,Dc.cadenceMultiplier),strengthMultiplier:Uf(t?.strengthMultiplier,.25,6,Dc.strengthMultiplier)}}function g2(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(t){return console.warn("Local storage unavailable for NG+ state",t),null}}function vy(t,a,s){const r=Number.isFinite(t)?t:Number(t);if(!Number.isFinite(r))return a;const l=Math.trunc(r);return Math.min(s,Math.max(a,l))}function y2(t){const a=Number.isFinite(t)?t:Number(t);return!Number.isFinite(a)||a===0?0:Math.trunc(Math.abs(a))}function b2(t=Math.random){let a=t();(!Number.isFinite(a)||a<=0||a>=1)&&(a=Math.random());const s=Math.floor(a*4294967295);return s===0?p2:s}function za(t={}){const a=Ic,s=y2(t.runSeed??a.runSeed),r=vy(t.ngPlusLevel??a.ngPlusLevel,0,Number.MAX_SAFE_INTEGER),l=vy(t.unlockSlots??a.unlockSlots,0,im),u=DM(t.enemyTuning??a.enemyTuning);return{runSeed:s,ngPlusLevel:r,unlockSlots:l,enemyTuning:u}}function La(t,a=Math.random){const s=za(t);return s.runSeed!==0?s:za({...s,runSeed:b2(a)})}function IM(t=Math.random){const a=g2();if(!a)return La(Ic,t);const s=a.getItem(Hc);if(!s)return La(Ic,t);try{const r=JSON.parse(s);return La(za(r),t)}catch(r){return console.warn("Failed to parse NG+ state",r),La(Ic,t)}}function Eh(t){const a=g2();if(!a)return;const s=za(t);a.setItem(Hc,JSON.stringify(s))}function UM(t,a){const s=za(t),r=typeof a.random=="function"?a.random:Math.random,l=b2(r);return La(za({...s,runSeed:l}),r)}function jc(t,a=0){let s=y2(t)^(a|0);return s===0&&(s=p2^(a|0)),()=>{s=s+1831565813|0;let r=Math.imul(s^s>>>15,1|s);return r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296}}function Of(t){return`${t.q},${t.r}`}const v2={farm:()=>new nm,barracks:()=>new r2};function OM(t){return v2[t]?.()}const Sy=Object.freeze({aggression:1,cadence:1,strength:1});function er(t,a,s,r){const l=Number(t);return Number.isFinite(l)?Math.min(s,Math.max(a,l)):r}function My(t,a){return{aggression:er(a.aggression??t.aggression,.1,8,t.aggression),cadence:er(a.cadence??t.cadence,.25,6,t.cadence),strength:er(a.strength??t.strength,.25,12,t.strength)}}class zM{constructor(a,s="gameState"){this.tickInterval=a,this.storageKey=s}resources={[re.SAUNA_BEER]:0,[re.SAUNAKUNNIA]:0,[re.SISU]:0};passiveGeneration={...uc};lastSaved=Date.now();buildings={};buildingPlacements=new Map;policies=new Set;nightWorkSpeedMultiplier=1;enemyScaling={...Sy};enemyCalmSecondsRemaining=0;ngPlus=za();tick(){Object.keys(this.passiveGeneration).forEach(a=>{this.addResource(a,this.passiveGeneration[a])})}save(){this.lastSaved=Date.now();const a={};this.buildingPlacements.forEach((l,u)=>{a[u]=l.type});const s={resources:this.resources,lastSaved:this.lastSaved,buildings:this.buildings,buildingPlacements:a,policies:Array.from(this.policies),passiveGeneration:{...this.passiveGeneration},nightWorkSpeedMultiplier:this.nightWorkSpeedMultiplier,enemyScaling:{...this.enemyScaling},ngPlus:this.ngPlus},r=typeof localStorage<"u"&&localStorage?localStorage:void 0;if(!r){console.warn("GameState.save: localStorage is unavailable, skipping persistence.");return}try{r.setItem(this.storageKey,JSON.stringify(s))}catch(l){console.warn("GameState.save: Failed to persist state to localStorage.",l)}}load(a){const s=am(this.storageKey);if(!s)return this.lastSaved=Date.now(),!1;this.resources={...this.resources,...s.resources??{}},Object.keys(this.resources).forEach(m=>{Number.isFinite(this.resources[m])||(this.resources[m]=0)}),this.enemyScaling=My(Sy,s.enemyScaling??{}),this.enemyCalmSecondsRemaining=0;const r={};Object.entries(s.buildings??{}).forEach(([m,p])=>{v2[m]&&(r[m]=p)}),this.buildings=r,this.buildingPlacements.clear(),s.buildingPlacements&&Object.entries(s.buildingPlacements).forEach(([m,p])=>{const g=OM(p);if(!g)return;this.buildingPlacements.set(m,g);const[b,v]=m.split(",").map(Number);if(a){const S=a.ensureTile(b,v);S.placeBuilding(g.type),S.reveal(),Mh({q:b,r:v},a.hexSize)}se.emit("buildingPlaced",{building:g,coord:{q:b,r:v},state:this})}),this.lastSaved=s.lastSaved??Date.now();const l=s.ngPlus?za(s.ngPlus):this.ngPlus;if(this.ngPlus=La(l),this.policies=new Set,this.passiveGeneration={...uc},this.nightWorkSpeedMultiplier=1,(Array.isArray(s.policies)?s.policies.filter(m=>typeof m=="string"):[]).forEach(m=>{const p=by(m);p&&(this.policies.add(p.id),se.emit(Gt.APPLIED,{policy:p,state:this}))}),s.passiveGeneration){const m={...uc};Object.keys(uc).forEach(p=>{const g=s.passiveGeneration?.[p];typeof g=="number"&&Number.isFinite(g)&&(m[p]=g)}),this.passiveGeneration=m}typeof s.nightWorkSpeedMultiplier=="number"&&Number.isFinite(s.nightWorkSpeedMultiplier)&&(this.nightWorkSpeedMultiplier=s.nightWorkSpeedMultiplier);const f=Date.now()-this.lastSaved,h=Math.floor(f/this.tickInterval);return Object.keys(this.passiveGeneration).forEach(m=>{this.resources[m]+=h*this.passiveGeneration[m]}),!0}getResource(a){return this.resources[a]}canAfford(a,s=re.SAUNA_BEER){return this.resources[s]>=a}spendResource(a,s=re.SAUNA_BEER){return this.spend(a,s)}spend(a,s=re.SAUNA_BEER){return this.canAfford(a,s)?(this.resources[s]-=a,se.emit("resourceChanged",{resource:s,amount:-a,total:this.resources[s]}),!0):!1}addResource(a,s){this.resources[a]+=s,se.emit("resourceChanged",{resource:a,amount:s,total:this.resources[a]})}modifyPassiveGeneration(a,s){this.passiveGeneration[a]=(this.passiveGeneration[a]??0)+s}setEnemyScalingBase(a){return this.enemyScaling=My(this.enemyScaling,a),{...this.enemyScaling}}applyEnemyScalingModifiers(a){const s={aggression:er(this.enemyScaling.aggression*(a.aggression??1),.1,8,this.enemyScaling.aggression),cadence:er(this.enemyScaling.cadence*(a.cadence??1),.25,6,this.enemyScaling.cadence),strength:er(this.enemyScaling.strength*(a.strength??1),.25,12,this.enemyScaling.strength)};return this.enemyScaling=s,{...this.enemyScaling}}getEnemyScalingSnapshot(){return{...this.enemyScaling,calmSecondsRemaining:Math.max(0,this.enemyCalmSecondsRemaining)}}requestEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(this.enemyCalmSecondsRemaining,s),this.enemyCalmSecondsRemaining)}advanceEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(0,this.enemyCalmSecondsRemaining-s),this.enemyCalmSecondsRemaining)}clearEnemyCalm(){this.enemyCalmSecondsRemaining=0}construct(a,s,r=re.SAUNA_BEER){return this.spend(s,r)?(this.buildings[a]=(this.buildings[a]??0)+1,!0):!1}placeBuilding(a,s,r,l=re.SAUNA_BEER){const u=r.getTile(s.q,s.r);return!u||u.building||!this.construct(a.type,a.cost,l)?!1:(this.buildingPlacements.set(Of(s),a),u.placeBuilding(a.type),se.emit("buildingPlaced",{building:a,coord:s,state:this}),!0)}getBuildingAt(a){return this.buildingPlacements.get(Of(a))}removeBuilding(a,s){const r=Of(a),l=this.buildingPlacements.get(r);return l?(this.buildingPlacements.delete(r),s.getTile(a.q,a.r)?.placeBuilding(null),this.buildings[l.type]!==void 0&&(this.buildings[l.type]-=1,this.buildings[l.type]<=0&&delete this.buildings[l.type]),se.emit("buildingRemoved",{building:l,coord:a,state:this}),!0):!1}upgrade(a,s,r=re.SAUNA_BEER){return this.construct(`upgrade:${a}`,s,r)}applyPolicy(a){const s=by(a);if(!s){const u={policyId:a,state:this,reason:"unknown-policy"};return se.emit(Gt.REJECTED,u),!1}if(this.hasPolicy(s.id)){const u={policyId:s.id,policy:s,state:this,reason:"already-applied"};return se.emit(Gt.REJECTED,u),!1}const r=s.prerequisites.filter(u=>!u.isSatisfied(this));if(r.length>0){const u={policyId:s.id,policy:s,state:this,reason:"prerequisites-not-met",missingPrerequisites:r};return se.emit(Gt.REJECTED,u),!1}if(!this.spend(s.cost,s.resource)){const u={policyId:s.id,policy:s,state:this,reason:"insufficient-resources"};return se.emit(Gt.REJECTED,u),!1}this.policies.add(s.id);const l={policy:s,state:this};return se.emit(Gt.APPLIED,l),!0}hasPolicy(a){return this.policies.has(a)}getNgPlusState(){return{...this.ngPlus}}setNgPlusState(a){const s=za({...this.ngPlus,...a});return this.ngPlus=La(s),this.ngPlus}}class BM{constructor(a,s){this.baseInterval=a,this.onTick=s}timer=null;speed=1;lastTick=0;accumulator=0;start(){this.stop(),this.lastTick=Date.now();const a=this.baseInterval/this.speed;this.timer=setInterval(()=>{const s=Date.now(),r=s-this.lastTick;this.lastTick=s,this.onTick(r)},a)}stop(){this.timer!==null&&(clearInterval(this.timer),this.timer=null)}setSpeed(a){if(a<=0)throw new Error("Speed multiplier must be positive");this.speed=a,this.timer!==null&&this.start()}getSpeed(){return this.speed}getBaseInterval(){return this.baseInterval}tick(a){for(this.accumulator+=a*this.speed;this.accumulator>=this.baseInterval;)this.accumulator-=this.baseInterval,this.onTick(this.baseInterval)}}var En=(t=>(t[t.Plains=0]="Plains",t[t.Forest=1]="Forest",t[t.Hills=2]="Hills",t[t.Lake=3]="Lake",t))(En||{});function qM(t,a,s){let r=t*374761393+a*668265263+s*0x14057b7ef7678100;return r=(r^r>>13)*1274126177,r^=r>>16,(r>>>0)/4294967295}function HM(t,a,s=0){const r=qM(t,a,s);return r<.1?3:r<.3?1:r<.5?2:0}class jM{_terrain;_building;_isFogged;listeners=new Set;constructor(a=En.Plains,s=null,r=!0){this._terrain=a,this._building=s,this._isFogged=r}get terrain(){return this._terrain}set terrain(a){this._terrain!==a&&(this._terrain=a,this.notify("terrain"))}get building(){return this._building}set building(a){this._building!==a&&(this._building=a,this.notify("building"))}get isFogged(){return this._isFogged}set isFogged(a){this._isFogged!==a&&(this._isFogged=a,this.notify("fog"))}reveal(){this.isFogged=!1}placeBuilding(a){this.building=a}setFogged(a){this.isFogged=a}addMutationListener(a){return this.listeners.add(a),()=>this.listeners.delete(a)}notify(a){for(const s of this.listeners)s(a)}}class GM{constructor(a=10,s=10,r=32,l=0){this.hexSize=r,this.seed=l,this.minQ=0,this.minR=0,this.maxQ=a-1,this.maxR=s-1}tiles=new Map;tileSubscriptions=new Map;changeListeners=new Set;minQ;maxQ;minR;maxR;get width(){return this.maxQ-this.minQ+1}get height(){return this.maxR-this.minR+1}key(a,s){return`${a},${s}`}addTileChangeListener(a){return this.changeListeners.add(a),()=>this.changeListeners.delete(a)}notifyTileChange(a,s,r){for(const l of this.changeListeners)l(a,s,r)}attachTileListener(a,s,r){const l=s.addMutationListener(u=>{this.notifyTileChange(r,s,u)});this.tileSubscriptions.set(a,l)}ensureTile(a,s){const r=this.key(a,s);let l=this.tiles.get(r);return l||(l=new jM(HM(a,s,this.seed)),this.tiles.set(r,l),this.minQ=Math.min(this.minQ,a),this.maxQ=Math.max(this.maxQ,a),this.minR=Math.min(this.minR,s),this.maxR=Math.max(this.maxR,s),this.attachTileListener(r,l,{q:a,r:s}),this.notifyTileChange({q:a,r:s},l,"created"),l.isFogged||Mh({q:a,r:s},this.hexSize)),l}getTile(a,s){return this.tiles.get(this.key(a,s))}forEachTile(a){for(const[s,r]of this.tiles){const[l,u]=s.split(",").map(Number);a(r,{q:l,r:u})}}getNeighbors(a,s){return Bc({q:a,r:s}).map(r=>this.ensureTile(r.q,r.r))}revealAround(a,s,r={}){const{autoFrame:l=!0}=r;for(let h=-s;h<=s;h++){const m=Math.max(-s,-h-s),p=Math.min(s,-h+s);for(let g=m;g<=p;g++){const b={q:a.q+h,r:a.r+g};this.ensureTile(b.q,b.r).reveal(),Mh(b,this.hexSize)}}if(!l)return;const u=typeof window<"u"?(()=>{const h=Math.max(window.innerWidth,0),m=Math.max(window.innerHeight,0);let p=0;if(typeof document<"u"){const b=document.getElementById("right-panel");if(b){const v=b.getBoundingClientRect();if(v.width>0){const S=b.closest("#ui-overlay");if(S){const E=S.getBoundingClientRect(),T=window.getComputedStyle(S),_=Number.parseFloat(T.paddingRight||"0"),R=E.right-v.left,U=v.width+(Number.isFinite(_)?_:0);p=Math.max(0,Math.max(R,U))}else p=Math.max(0,v.width)}}}const g=Math.min(Math.max(p,0),h);return{width:h,height:m,safeRight:g}})():{width:0,height:0,safeRight:0},f=NM(u);RM(f,300)}}const Gc={TRIGGERED:"scheduler:eventTriggered",RESOLVED:"scheduler:eventResolved"},YM=new Map;function FM(){return globalThis.localStorage??null}function co(t){return typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}function S2(t){const a=globalThis.crypto;return a?.randomUUID?a.randomUUID():`${t}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function VM(t){const a={id:String(t.id??""),label:String(t.label??""),description:t.description?String(t.description):void 0,event:t.event?String(t.event):void 0,payload:t.payload,accent:t.accent??void 0};return a.id||(a.id=S2("choice")),a.label||(a.label="Choose"),a}function Yc(t){const a={id:String(t.id??""),headline:String(t.headline??""),body:String(t.body??""),art:t.art?String(t.art):void 0,typography:t.typography,animation:t.animation,accentColor:t.accentColor?String(t.accentColor):void 0,acknowledgeText:t.acknowledgeText?String(t.acknowledgeText):void 0,choices:Array.isArray(t.choices)?t.choices.map(s=>VM(s)):void 0};return a.id||(a.id=S2("event")),a}function $M(t){return{content:Yc(t.content),trigger:t.trigger.type==="time"?{type:"time",at:Number.isFinite(t.trigger.at)?t.trigger.at:0}:{type:"condition",conditionId:String(t.trigger.conditionId),params:t.trigger.params}}}function Ey(t){return{content:Yc(t.content),triggeredAt:Number.isFinite(t.triggeredAt)?t.triggeredAt:0}}const zf=Object.freeze({clock:0,queue:[],active:[]});class XM{storageKey;eventBus;getStorage;state=co(zf);subscribers=new Set;constructor(a={}){this.storageKey=a.storageKey??"autobattles:event-scheduler",this.eventBus=a.eventBus??se,this.getStorage=a.storageProvider??FM,this.load()}subscribe(a){return this.subscribers.add(a),a(this.getActiveEvents()),()=>{this.subscribers.delete(a)}}getActiveEvents(){return this.state.active.map(a=>({...co(a.content),triggeredAt:a.triggeredAt}))}schedule(a){const s=Yc(a.content);if(!s.headline||!s.body||this.containsEvent(s.id))return!1;const r=a.trigger.type==="condition"?{type:"condition",conditionId:String(a.trigger.conditionId),params:a.trigger.params}:{type:"time",at:this.resolveTriggerTime(a.trigger)};return this.state.queue.push({content:s,trigger:r}),this.sortQueue(),this.save(),!0}publish(a){const s=Yc(a);this.containsEvent(s.id)||(this.state.queue=this.state.queue.filter(r=>r.content.id!==s.id),this.activateEvent({content:s,triggeredAt:this.state.clock}))}tick(a,s={}){if(!Number.isFinite(a)||a<=0)return;this.state.clock+=a;const r=[],l=[];for(const u of this.state.queue)this.shouldTrigger(u.trigger,s)?r.push(u):l.push(u);this.state.queue=l;for(const u of r)this.activateEvent({content:u.content,triggeredAt:this.state.clock});this.save()}resolve(a,s){const r=this.state.active.findIndex(h=>h.content.id===a);if(r===-1)return!1;const l=this.state.active[r],u=this.pickChoice(l.content,s),f=u?u.id:null;return this.state.active.splice(r,1),this.save(),this.notify(),this.eventBus.emit(Gc.RESOLVED,{eventId:a,choiceId:f,event:l.content}),u?.event&&this.eventBus.emit(u.event,{eventId:a,choiceId:f,payload:u.payload,event:l.content}),!0}reset(){this.state=co(zf),this.save(),this.notify()}activateEvent(a){const s=Ey(a);this.state.active.push(s),this.save(),this.notify(),this.eventBus.emit(Gc.TRIGGERED,{event:{...co(s.content),triggeredAt:s.triggeredAt}})}pickChoice(a,s){const r=a.choices??[];if(r.length!==0){if(s){const l=r.find(u=>u.id===s);if(l)return l}return r[0]}}shouldTrigger(a,s){if(a.type==="time")return this.state.clock>=a.at;const r=YM.get(a.conditionId);if(!r)return!1;try{return!!r(a.params,s)}catch(l){return console.warn("Scheduler condition evaluation failed",a.conditionId,l),!1}}resolveTriggerTime(a){if(Number.isFinite(a.at))return Number(a.at);const s=Number.isFinite(a.in)?Number(a.in):0;return Math.max(0,this.state.clock+s)}sortQueue(){this.state.queue.sort((a,s)=>{const r=a.trigger.type==="time"?a.trigger.at:Number.POSITIVE_INFINITY,l=s.trigger.type==="time"?s.trigger.at:Number.POSITIVE_INFINITY;return r-l})}containsEvent(a){return this.state.active.some(s=>s.content.id===a)||this.state.queue.some(s=>s.content.id===a)}notify(){const a=this.getActiveEvents();for(const s of this.subscribers)try{s(a)}catch(r){console.warn("Scheduler subscriber failed",r)}}load(){const a=am(this.storageKey);if(!a){this.state=co(zf);return}const s=Number(a.clock);this.state={clock:Number.isFinite(s)?s:0,queue:Array.isArray(a.queue)?a.queue.map(r=>$M(r)):[],active:Array.isArray(a.active)?a.active.map(r=>Ey(r)):[]}}save(){const a=this.getStorage();if(a)try{a.setItem(this.storageKey,JSON.stringify({clock:this.state.clock,queue:this.state.queue,active:this.state.active}))}catch(s){console.warn("Scheduler persistence failed",s)}}}const wo=new XM;function QM(t,a){const s=new WeakSet,r=l=>{l.policy.id===t.id&&(a.once!==!1&&s.has(l.state)||(a.invoke(l),a.once!==!1&&s.add(l.state)))};se.on(a.event,r)}for(const t of m2())for(const a of t.effects)QM(t,a);const KM="modulepreload",PM=function(t){return"/"+t},xy={},ZM=function(a,s,r){let l=Promise.resolve();if(s&&s.length>0){let m=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),h=f?.nonce||f?.getAttribute("nonce");l=m(s.map(p=>{if(p=PM(p),p in xy)return;xy[p]=!0;const g=p.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const v=document.createElement("link");if(v.rel=g?"stylesheet":KM,g||(v.as="script"),v.crossOrigin="",v.href=p,h&&v.setAttribute("nonce",h),document.head.appendChild(v),g)return new Promise((S,E)=>{v.addEventListener("load",S),v.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${p}`)))})}))}function u(f){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=f,window.dispatchEvent(h),!h.defaultPrevented)throw f}return l.then(f=>{for(const h of f||[])h.status==="rejected"&&u(h.reason);return a().catch(u)})},JM=({building:t,coord:a,state:s})=>{t instanceof nm?s.modifyPassiveGeneration(re.SAUNA_BEER,t.beerPerTick):t instanceof r2&&ZM(async()=>{const{spawnUnit:r}=await Promise.resolve().then(()=>px);return{spawnUnit:r}},void 0).then(({spawnUnit:r})=>{r(s,"soldier",`barracks-${a.q}-${a.r}`,a,"player")})},WM=({building:t,state:a})=>{t instanceof nm&&a.modifyPassiveGeneration(re.SAUNA_BEER,-t.beerPerTick)};se.on("buildingPlaced",JM);se.on("buildingRemoved",WM);const On={master:{defaultVolume:.9,volumeKey:"audio.mixer.master.volume",muteKey:"audio.mixer.master.muted"},music:{defaultVolume:.65,volumeKey:"audio.mixer.music.volume",muteKey:"audio.mixer.music.muted"},sfx:{defaultVolume:1,volumeKey:"audio.mixer.sfx.volume",muteKey:"audio.mixer.sfx.muted"}},Je={master:{volume:On.master.defaultVolume,muted:!1},music:{volume:On.music.defaultVolume,muted:!1},sfx:{volume:On.sfx.defaultVolume,muted:!1}},Pn={};let Ln=null,xh=!1;const Ah=new Set;function sm(t,a){return Number.isFinite(t)?t<=0?0:t>=1?1:t:a}function mu(){if(typeof localStorage>"u")return null;try{return localStorage}catch(t){return console.warn("Audio mixer storage unavailable",t),null}}function eE(t){const a=mu();if(!a)return null;try{const s=a.getItem(On[t].volumeKey);if(s===null)return null;const r=Number.parseFloat(s);return Number.isFinite(r)?sm(r,On[t].defaultVolume):null}catch(s){return console.warn("Failed to restore volume setting",t,s),null}}function tE(t){const a=mu();if(!a)return null;try{const s=a.getItem(On[t].muteKey);return s===null?null:s==="true"}catch(s){return console.warn("Failed to restore mute setting",t,s),null}}for(const t of Object.keys(On)){const a=eE(t),s=tE(t);a!==null&&(Je[t].volume=sm(a,On[t].defaultVolume)),s!==null&&(Je[t].muted=s)}function nE(t){const a=mu();if(a)try{a.setItem(On[t].volumeKey,Je[t].volume.toFixed(3))}catch(s){console.warn("Failed to persist volume setting",t,s)}}function aE(t){const a=mu();if(a)try{a.setItem(On[t].muteKey,Je[t].muted?"true":"false")}catch(s){console.warn("Failed to persist mute setting",t,s)}}function Ay(){if(typeof window>"u"||!Ln||xh)return;const t=()=>{Ln?.resume().catch(()=>{})};window.addEventListener("pointerdown",t,{once:!0}),window.addEventListener("keydown",t,{once:!0}),xh=!0}function rm(t){const a=Pn[t];if(!a)return;const{volume:s,muted:r}=Je[t],l=r?0:s;a.gain.value=l}function M2(t){if(!Pn.master){const a=t.createGain();a.gain.value=Je.master.muted?0:Je.master.volume,a.connect(t.destination),Pn.master=a}if(!Pn.music){const a=t.createGain();a.gain.value=Je.music.muted?0:Je.music.volume,a.connect(Pn.master),Pn.music=a}if(!Pn.sfx){const a=t.createGain();a.gain.value=Je.sfx.muted?0:Je.sfx.volume,a.connect(Pn.master),Pn.sfx=a}}function om(){if(Ln||typeof window>"u")return Ln;const t=window.AudioContext||window.webkitAudioContext;if(!t)return console.warn("Web Audio API not supported"),null;try{Ln=new t,M2(Ln),Ay()}catch(a){return console.warn("Unable to create AudioContext",a),Ln=null,null}return Ln.state==="suspended"&&(xh=!1,Ay()),Ln}function iE(){return Ln??om()}function Bf(t){const a=Je.master;if(t==="master")return a.muted?0:a.volume;const s=Je[t];return s.muted||a.muted?0:s.volume*a.volume}function lm(t){const a=iE();if(!a)return null;M2(a);const s=Pn[t];return s?(rm(t),s):null}function pu(){return{channels:{master:{volume:Je.master.volume,muted:Je.master.muted,effectiveVolume:Bf("master")},music:{volume:Je.music.volume,muted:Je.music.muted,effectiveVolume:Bf("music")},sfx:{volume:Je.sfx.volume,muted:Je.sfx.muted,effectiveVolume:Bf("sfx")}},contextState:Ln?.state??"uninitialized"}}function E2(){const t=pu();for(const a of Ah)a(t)}function cm(t){return Ah.add(t),()=>{Ah.delete(t)}}function um(t,a){const s=sm(a,On[t].defaultVolume);Je[t].volume!==s&&(Je[t].volume=s,nE(t),rm(t),E2())}function dm(t,a){Je[t].muted!==a&&(Je[t].muted=a,aE(t),rm(t),E2())}function sE(t){um("master",t)}function rE(t){um("music",t)}function oE(t){um("sfx",t)}function lE(t){dm("master",t)}function cE(t){dm("music",t)}function uE(t){dm("sfx",t)}function Fc(t){return pu().channels[t]}const dE=48e3;function fE(t){let a=t>>>0;return()=>{a+=1831565813;let s=a;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}}function hE(t,a,s){const{attack:r,decay:l,sustain:u,release:f,sustainLevel:h}=t;if(r>0&&s<r)return s/r;if(l>0&&s<r+l){const m=(s-r)/l;return 1-(1-h)*m}if(s<a-f)return h;if(f>0&&s<a){const m=(s-(a-f))/f;return h*(1-m)}return 0}function mE(t,a,s){const r=t.phase??0,l=t.vibrato,u=t.tremolo,f=l?1+l.depth*Math.sin(2*Math.PI*l.speed*s):1,h=u?t.gain*(1-u.depth+u.depth*Math.sin(2*Math.PI*u.speed*s)):t.gain,m=a*t.ratio*f;return h*Math.sin(2*Math.PI*m*s+r)}function pE(t,a){return t.gain*(a()*2-1)}function gE(t,a=dE){const s=Math.max(1,Math.floor(t.duration*a)),r=new Float32Array(s),l=fE(t.seed);for(let u=0;u<s;u++){const f=u/a;let h=0;for(const p of t.layers)p.type==="sine"?h+=mE(p,t.baseFrequency,f):h+=pE(p,l);const m=hE(t.envelope,t.duration,f);r[u]=h*m}return r}const qf={attack:{variants:[{id:"attack-a",label:"Gentle Birch Strike",description:"Soft mallet transient with subtle shimmer.",duration:.9,baseFrequency:220,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:421,loudness:{lufs:-14.775,peakDb:-2.134,gain:.8684}},{id:"attack-b",label:"Rounded Pluck Echo",description:"A slightly brighter chime tuned above the root.",duration:.9,baseFrequency:232,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:947,loudness:{lufs:-14.758,peakDb:-2.101,gain:.8667}},{id:"attack-c",label:"High Drift Pluck",description:"Upper register tap with airy decay.",duration:.9,baseFrequency:244,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:1337,loudness:{lufs:-14.731,peakDb:-2.076,gain:.8641}}]},death:{variants:[{id:"death-a",label:"Hollow Exhale",description:"Low cedar drum pulse with airy noise tail.",duration:1.15,baseFrequency:150,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:615,loudness:{lufs:-14.365,peakDb:-.218,gain:.8284}},{id:"death-b",label:"Soft Ember Fall",description:"Mid register thump with drifting undertone.",duration:1.15,baseFrequency:168,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:274,loudness:{lufs:-14.204,peakDb:-.185,gain:.8132}},{id:"death-c",label:"Warm Resolve",description:"Higher pitch breathy release with gentle rumble.",duration:1.15,baseFrequency:184,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:978,loudness:{lufs:-14.079,peakDb:-.16,gain:.8015}}]},sisu:{variants:[{id:"sisu-a",label:"Rising Steam",description:"Slow bloom of airy sine pads with hushed texture.",duration:1.9,baseFrequency:176,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1204,loudness:{lufs:-12.754,peakDb:-.501,gain:.6882}},{id:"sisu-b",label:"Glowing Drift",description:"Warmer harmonic swell with chorus shimmer.",duration:1.9,baseFrequency:188,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1642,loudness:{lufs:-12.943,peakDb:-.271,gain:.7033}},{id:"sisu-c",label:"Morning Brilliance",description:"Bright tonic swell with shimmering overtones.",duration:1.9,baseFrequency:200,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:2019,loudness:{lufs:-12.888,peakDb:-.235,gain:.6989}}]}};function Hf(t){return{id:t.id,label:t.label,envelope:t.envelope,gain:t.loudness.gain,loader:a=>{const s=gE(t,a.sampleRate),r=a.createBuffer(1,s.length,a.sampleRate);return r.getChannelData(0).set(s),r}}}const yE={click:{variants:[{id:"ui-click-soft",label:"UI soft tap",envelope:{attack:0,decay:.05,sustain:0,release:.03,sustainLevel:0},loader:t=>vE(t)}],debounce:{windowMs:35,weight:.5,maxWeight:1.5},polyphony:6},spawn:{variants:[{id:"ui-spawn-chime",label:"Roster invite tone",envelope:{attack:0,decay:.2,sustain:.5,release:.2,sustainLevel:.5},loader:t=>SE(t)}],debounce:{windowMs:150,weight:.7,maxWeight:1.4},polyphony:3},error:{variants:[{id:"ui-error-tone",label:"Gentle warning tap",envelope:{attack:.01,decay:.2,sustain:.2,release:.2,sustainLevel:.2},loader:t=>ME(t)}],debounce:{windowMs:220,weight:1,maxWeight:1},polyphony:2},attack:{variants:qf.attack.variants.map(Hf),debounce:{windowMs:120,weight:.6,maxWeight:1.2},polyphony:3},death:{variants:qf.death.variants.map(Hf),debounce:{windowMs:360,weight:1,maxWeight:1.5},polyphony:3},sisu:{variants:qf.sisu.variants.map(Hf),debounce:{windowMs:900,weight:1,maxWeight:1},polyphony:1}};let dc=null;const wy=new Map,fc=new Map,Vc=new Map,tr=new Map,Eo=new Map,Cy=new Map,jt={node:null,destination:null,envelope:0,lastUpdate:0},uo={attackSeconds:.04,releaseSeconds:.6,depth:.55,floor:.25},wh=new Set;function fm(){const t=Fc("master"),a=Fc("sfx");return t.muted||a.muted}function bE(){const t=fm();for(const a of wh)a(t)}function hm(t,a,s){const r=Math.floor(t.sampleRate*a),l=t.createBuffer(1,r,t.sampleRate),u=l.getChannelData(0);for(let f=0;f<r;f++){const h=f/t.sampleRate;u[f]=s(h)}return l}function vE(t){return hm(t,.05,a=>Math.sin(2*Math.PI*1e3*a)*Math.exp(-40*a))}function SE(t){return hm(t,.2,a=>(Math.sin(2*Math.PI*440*a)+Math.sin(2*Math.PI*660*a))*.5*Math.exp(-6*a))}function ME(t){return hm(t,.3,a=>Math.sin(2*Math.PI*110*a)*Math.exp(-8*a))}function Ty(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function EE(t,a){return`${t}:${a}`}function xE(t,a,s){const r=EE(t,a),l=wy.get(r);if(l)return Promise.resolve(l);const u=fc.get(r);if(u)return u;const f=mm();if(!f)return Promise.reject(new Error("Audio context unavailable"));const h=Promise.resolve(s.loader(f)).then(m=>(wy.set(r,m),fc.delete(r),m)).catch(m=>{throw fc.delete(r),m});return fc.set(r,h),h}function _y(t){const a=t.polyphony;return!Number.isFinite(a)||!a||a<=0?Number.POSITIVE_INFINITY:a}function AE(t,a){const s=Vc.get(t);if(!s||s.length===0)return[];const r=[];for(const l of s)l.time>=a&&r.push(l);return Vc.set(t,r),r}function wE(t,a,s){const r=a.debounce;if(!r)return{blocked:!1,weight:0};const l=r.weight??1,u=r.windowMs,f=s-u,h=AE(t,f);let m=0;for(const p of h)m+=p.weight;return m+l>r.maxWeight?{blocked:!0}:{blocked:!1,weight:l}}function CE(t,a,s){if(s<=0)return;const r=Vc.get(t)??[];r.push({time:a,weight:s}),Vc.set(t,r)}function TE(t){const a=(tr.get(t)??0)+1;tr.set(t,a)}function _E(t){const a=tr.get(t)??0;if(a<=1){tr.delete(t);return}tr.set(t,a-1)}function Ny(t,a){if(!Number.isFinite(a))return!1;const s=Eo.get(t)?.size??0,r=tr.get(t)??0;return s+r>=a}function NE(t,a){let s=Eo.get(t);s||(s=new Set,Eo.set(t,s)),s.add(a);let r=!1;const l=()=>{if(r)return;r=!0;const u=Eo.get(t);u?.delete(a),u&&u.size===0&&Eo.delete(t)};if(typeof a.addEventListener=="function")a.addEventListener("ended",()=>{l()},{once:!0});else{const u=a.onended;a.onended=()=>{try{u?.call(a)}finally{l()}}}return l}function RE(t,a){const s=jt.node;if(!s||s.context!==t){jt.node?.disconnect();const r=t.createGain();return r.gain.value=1,r.connect(a),jt.node=r,jt.destination=a,jt.envelope=0,jt.lastUpdate=t.currentTime,r}return jt.destination!==a&&(s.disconnect(),s.connect(a),jt.destination=a),s}function kE(t){const a=jt.node;if(!a)return;const s=t.currentTime,r=.6,l=.55,u=Math.max(0,s-jt.lastUpdate),f=Math.exp(-u/r);jt.envelope*=f,jt.envelope=Math.min(1,jt.envelope+l),jt.lastUpdate=s;const p=Math.max(.35,1-jt.envelope*.5),g=.02;a.gain.cancelScheduledValues(s),a.gain.setValueAtTime(a.gain.value,s),a.gain.linearRampToValueAtTime(p,s+g),a.gain.setTargetAtTime(1,s+g,r)}function LE(t){const a=lm("music");if(!a)return;const s=Fc("master"),r=Fc("music");if(s.muted||r.muted)return;const l=r.volume;if(l<=0)return;const u=t.currentTime,f=a.gain.value,h=l*(1-uo.depth),m=l*uo.floor,p=Math.min(f,Math.max(h,m));a.gain.cancelScheduledValues(u),a.gain.setValueAtTime(f,u),a.gain.linearRampToValueAtTime(p,u+uo.attackSeconds),a.gain.setTargetAtTime(l,u+uo.attackSeconds,uo.releaseSeconds)}function aa(t){if(Ch())return;const a=yE[t];if(!a)return;const s=a.variants;if(!s||s.length===0)return;let r=0,l=s[0];s.length>1&&(r=((Cy.get(t)??Math.floor(Math.random()*s.length)-1)+1)%s.length,l=s[r],Cy.set(t,r));const u=Ty(),f=wE(t,a,u);if(f.blocked)return;const h=_y(a);if(Ny(t,h))return;TE(t);let m=!1;const p=()=>{m||(_E(t),m=!0)};xE(t,r,l).then(g=>{if(p(),Ch())return;const b=mm();if(!b)return;const v=lm("sfx");if(!v)return;const S=_y(a);if(Ny(t,S))return;const E=b.createBufferSource();E.buffer=g;const T=l.gain;let _=E;if(typeof T=="number"&&T>0&&T!==1){const B=b.createGain();B.gain.value=T,E.connect(B),_=B}const R=t==="attack"?RE(b,v):v;_.connect(R);const U=NE(t,E);try{E.start(),t==="attack"&&kE(b),t==="sisu"&&LE(b);const B=Ty();!f.blocked&&f.weight>0&&CE(t,B,f.weight)}catch(B){console.warn("Unable to start sound",B),U()}}).catch(g=>{p(),!(g instanceof Error&&g.message==="Audio context unavailable")&&console.warn("Failed to play sound",t,g)}).finally(()=>{p()})}function Ch(){return fm()}function DE(t){return wh.add(t),()=>{wh.delete(t)}}typeof document<"u"&&document.addEventListener("click",t=>{t.target instanceof HTMLButtonElement&&aa("click")});let Ry=fm();cm(t=>{const a=t.channels.master.muted||t.channels.sfx.muted;a!==Ry&&(Ry=a,bE())});function mm(){return dc||(dc=om(),dc)}mm();const ky="__autobattlesAudioEvents__",Ly=globalThis;Ly[ky]||(se.on("unitDamaged",t=>{!t||t.amount<=0||aa("attack")}),se.on("unitDied",()=>{aa("death")}),se.on("sisuBurstStart",()=>{aa("sisu")}),Ly[ky]=!0);const IE=[{content:{id:"command-briefing",headline:"Command Briefing: Ember Shift",body:"Sauna Command uplinks a focused playbook for your opening salvo. Keep the roster nimble, channel the ember currents, and set the tone for this run.",art:"/assets/ui/saunoja-roster.svg",typography:"serif",animation:"aurora",accentColor:"#7bdff2",acknowledgeText:"Deploy the roster"},trigger:{type:"time",in:2}},{content:{id:"recon-telemetry",headline:"Recon Telemetry Uploaded",body:"Forward drones stitched together a glacial panorama of enemy routes. Prioritize rapid response teams while the snowpack is still undisturbed.",art:"/assets/ui/resource.svg",typography:"sans",animation:"pulse",accentColor:"#fbcfe8",acknowledgeText:"Queue countermeasures"},trigger:{type:"time",in:12}},{content:{id:"supply-courier",headline:"Sauna Courier Docked",body:"A lacquered supply skiff glides into the bay with artisan tonics and reinforced stave kits. Decide how to allocate the haul before the next assault.",art:"/assets/ui/sauna-beer.svg",typography:"serif",animation:"tilt",accentColor:"#fde68a",choices:[{id:"frontline",label:"Stage for the frontline",description:"Prep the vanguard with the premium kit as morale surges.",accent:"primary"},{id:"reserve",label:"Stock the reserves",description:"Archive the crate for a later wave when pressure spikes.",accent:"ghost"}]},trigger:{type:"time",in:24}}];function UE(t=wo){for(const a of IE)t.schedule(a)}UE();function OE(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function zE(t){const a={};if(!t)return a;for(const[s,r]of Object.entries(t))typeof r=="function"&&(a[s]=r);return a}class BE{constructor(a=se){this.emitter=a}modifiers=new Map;hookIndex=new Map;listeners=new Map;add(a){if(typeof a.id!="string"||a.id.length===0)throw new Error("Modifier id must be a non-empty string");if((typeof a.duration!="number"||!Number.isFinite(a.duration))&&a.duration!==1/0)throw new Error("Modifier duration must be a positive number or Infinity");if(Number.isFinite(a.duration)&&a.duration<=0)throw new Error("Modifier duration must be greater than zero");const s=zE(a.hooks),r=OE();this.modifiers.has(a.id)&&this.remove(a.id,"replaced");const l={...a,hooks:s,remaining:a.duration,appliedAt:r};this.modifiers.set(l.id,l),this.indexHooks(l);const u={runtime:this,modifier:l};return a.onApply?.(u),this.emit("modifierAdded",{modifier:l}),this.emitter?.emit("modifierAdded",{modifier:l}),Number.isFinite(l.remaining)&&l.remaining<=0&&this.remove(l.id,"expired"),l}has(a){return this.modifiers.has(a)}list(){return Array.from(this.modifiers.values()).map(a=>({...a,hooks:{...a.hooks}}))}remove(a,s="manual"){const r=this.modifiers.get(a);if(!r)return!1;this.modifiers.delete(a),this.unindexHooks(r);const l={runtime:this,modifier:r,reason:s};return r.onExpire?.(l),s==="expired"&&(this.emit("modifierExpired",{modifier:r}),this.emitter?.emit("modifierExpired",{modifier:r})),this.emit("modifierRemoved",{modifier:r,reason:s}),this.emitter?.emit("modifierRemoved",{modifier:r,reason:s}),!0}advance(a){if(typeof a!="number"||a<=0)return;const s=[];for(const r of this.modifiers.values())Number.isFinite(r.remaining)&&(r.remaining=Math.max(0,r.remaining-a),r.remaining<=0&&s.push(r.id));for(const r of s)this.remove(r,"expired")}trigger(a,s){const r=this.hookIndex.get(a);if(!r||r.size===0)return;const l=Array.from(r);for(const u of l){const f=this.modifiers.get(u);if(!f){r.delete(u);continue}const h=f.hooks[a];if(!h){r.delete(u);continue}h(s,{runtime:this,modifier:f})}}clear(){const a=Array.from(this.modifiers.keys());for(const s of a)this.remove(s,"manual")}on(a,s){const r=this.listeners.get(a)??new Set;r.add(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);r&&(r.delete(s),r.size===0&&this.listeners.delete(a))}emit(a,s){const r=this.listeners.get(a);if(!(!r||r.size===0))for(const l of Array.from(r))l(s)}indexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s)??new Set;r.add(a.id),this.hookIndex.set(s,r)}}unindexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s);r&&(r.delete(a.id),r.size===0&&this.hookIndex.delete(s))}}}const gu=new BE,qE=t=>gu.add(t),HE=(t,a="manual")=>gu.remove(t,a),jE=t=>{gu.advance(t)},hc=(t,a)=>{gu.trigger(t,a)};class GE{constructor(a,s,r){this.owner=a,this.entries=s,this.log=r}runTick(a,s){for(const{definition:r,state:l}of this.entries){if(!r.onTick)continue;const u=r.onTick({owner:this.owner,state:l,self:a,opponent:s}),f=Xi(u?.shieldDamage??0);if(f>0){const m=Math.min(a.shield,f);m>0&&(a.shield-=m,this.log.tickShieldDamage+=m)}const h=Xi(u?.hpDamage??0);if(h>0){const m=Math.min(a.health,h);m>0&&(a.health-=m,this.log.tickHpDamage+=m)}}}grantShield(a,s){let r=0;for(const{definition:l,state:u}of this.entries){if(!l.onGrantShield)continue;const f=Xi(l.onGrantShield({owner:this.owner,state:u,self:a,opponent:s})??0);f>0&&(r+=f)}return r>0&&(a.shield+=r,this.log.shieldGranted+=r),r}consumeShield(a,s,r){let l=Xi(a);if(l<=0)return 0;let u=0;for(const{definition:f,state:h}of this.entries){if(!f.onConsumeShield||l<=0)continue;const m=Xi(f.onConsumeShield({owner:this.owner,state:h,self:s,opponent:r,amount:l})??0);if(m<=0)continue;const p=Math.min(l,m);u+=p,l-=p}return u>0&&(this.log.shieldConsumed+=u),u}applyHit(a,s,r){if(a<=0)return 0;let l=0;for(const{definition:h,state:m}of this.entries){if(!h.onHit)continue;const p=Xi(h.onHit({owner:this.owner,state:m,self:s,opponent:r,hpDamage:a})??0);p>0&&(l+=p)}if(l<=0)return 0;const u=Math.max(0,s.maxHealth-s.health);if(u<=0)return 0;const f=Math.min(u,l);return f>0&&(s.health+=f,this.log.lifesteal+=f),f}getShieldValue(){let a=0;for(const{definition:s,state:r}of this.entries){if(!s.onGrantShield||r.keyword!=="Shield")continue;const l=Th(r);if(l<=0)continue;const u=Math.max(0,Number.isFinite(r.stacks)?r.stacks:0);u<=0||(a+=u*l)}return a}}function YE(){return{attacker:Iy(),defender:Iy()}}function Dy(t,a,s){const r=FE(t);if(r.length===0)return null;const l=[];for(const u of r){const f=x2.get(u.keyword);f&&l.push({state:u,definition:f})}return l.length===0?null:new GE(a,l,s)}const x2=new Map;function yu(t,a){x2.set(t,a)}function Iy(){return{tickHpDamage:0,tickShieldDamage:0,shieldGranted:0,shieldConsumed:0,lifesteal:0,keywordShieldRemaining:0}}function Xi(t){return typeof t!="number"||!Number.isFinite(t)?0:t>0?t:0}function or(t){return typeof t!="number"||!Number.isFinite(t)?0:t>0?t:0}function Ho(t){return typeof t!="number"||!Number.isFinite(t)?0:t>0?t:0}function FE(t){if(!t)return[];const a=[],s=t;if(typeof s[Symbol.iterator]=="function"){for(const r of s){const l=Uy(r);l&&a.push(l)}return a}if(typeof t=="object")for(const r of Object.values(t)){const l=Uy(r);l&&a.push(l)}return a}function Uy(t){if(!t||typeof t!="object")return null;const a=t;if(!Object.prototype.hasOwnProperty.call(a,"stacks"))return null;const s=VE(a.keyword);if(!s)return null;const r=a;return r.keyword=s,r.stacks=or(r.stacks),Object.prototype.hasOwnProperty.call(a,"potency")&&r.potency!==void 0&&(r.potency=Ho(r.potency)),r}function VE(t){if(typeof t!="string")return null;switch(t.trim().toLowerCase()){case"bleed":return"Bleed";case"burn":return"Burn";case"lifesteal":case"life-steal":return"Lifesteal";case"shield":return"Shield";default:return null}}function Th(t){const a=t.potency!==void 0?Ho(t.potency):1;return a>0?a:0}function $E(t){if(t.potency!==void 0){const r=Ho(t.potency);return r>0?r:0}const a=or(t.stacks);if(a<=0)return 0;const s=a*.2;return s>0?s:0}yu("Bleed",{onTick({state:t,self:a}){const s=or(t.stacks);if(s<=0||a.health<=0){t.stacks=s;return}const r=t.potency!==void 0?Ho(t.potency):1,l=s*r;if(l<=0)return;const u=Math.min(a.health,l);return t.stacks=Math.max(0,s-1),{hpDamage:u}}});yu("Burn",{onTick({state:t,self:a}){const s=or(t.stacks);if(s<=0){t.stacks=s;return}const r=t.potency!==void 0?Ho(t.potency):1,l=s*r;if(l<=0)return;const u=Math.min(a.shield,l),f=l-u,h=Math.min(a.health,f);return t.stacks=Math.max(0,s-1),{shieldDamage:u,hpDamage:h}}});yu("Shield",{onGrantShield({state:t}){const a=or(t.stacks);if(a<=0)return t.stacks=a,0;const s=a*Th(t);return s>0?s:0},onConsumeShield({state:t,amount:a}){const s=or(t.stacks);if(s<=0)return t.stacks=0,0;const r=Th(t);if(r<=0)return t.stacks=0,0;const l=s*r;if(l<=0)return t.stacks=0,0;const u=Math.min(l,Xi(a)),f=u/r;return t.stacks=Math.max(0,s-f),u>0?u:0}});yu("Lifesteal",{onHit({state:t,hpDamage:a}){if(a<=0)return 0;const s=$E(t);if(s<=0)return 0;const r=a*s;return r>0?r:0}});function Dn(t){return Number.isFinite(t)?Math.max(0,t):0}function Oy(t,a){const s=Dn(a?.health??t?.health??0),r=Dn(a?.shield??t?.shield??0);return{id:t?.id??"unknown",faction:t?.faction,health:s,maxHealth:t?.maxHealth,shield:r}}function zy(t){if(!t)return!1;const a=t;return typeof a.onHit=="function"||typeof a.onKill=="function"||Array.isArray(a.onHit)||Array.isArray(a.onKill)}function By(t){return t?Array.isArray(t)?t.filter(a=>typeof a=="function"):typeof t=="function"?[t]:[]:[]}function XE(t){if(!t)return[];if(typeof t[Symbol.iterator]=="function"){const s=[];for(const r of t)zy(r)&&s.push(r);return s}return Object.values(t).filter(s=>zy(s))}function mc(t,a,s){if(!t)return;const r=By(t.hooks?.[a]);for(const u of r)u(s);const l=XE(t.keywords);for(const u of l)for(const f of By(u[a]))f(s)}function qy(t){const a=Dn(t?.health??0),s=Dn(t?.maxHealth??a);return{health:a,maxHealth:Math.max(s,a),shield:Dn(t?.shield??0)}}function QE(){return{health:0,maxHealth:0,shield:0}}function KE(t){const a=t.attacker??null,s=t.defender,r=t.baseDamage,l=Dn(t.minimumDamage??1),u=Number.isFinite(r)?Dn(r):Dn(a?.attack??0),f=Dn(s.defense??0),h=YE(),m=qy(s),p=a?qy(a):null,g=Dy(s.keywords??null,"defender",h.defender),b=a?Dy(a.keywords??null,"attacker",h.attacker):null,v=p??QE();g&&g.runTick(m,v),b&&p&&b.runTick(p,m);const S=m.health>0,E=Dn(m.shield);g&&g.grantShield(m,v);const T=Dn(m.shield),_=S?Math.max(l,u-f):0,R=S?Math.min(T,_):0,U=S?Math.max(0,_-R):0;m.shield=Math.max(0,T-R);const B=Math.min(E,R),V=Math.max(0,R-B);g&&V>0&&g.consumeShield(V,m,v);const X=g?g.getShieldValue():0;h.defender.keywordShieldRemaining=X;const $=Math.max(0,E-B);m.shield=$+X;const W=m.health;m.health=Math.max(0,W-U);const ne=m.health,Y=ne<=0;let q=0;b&&p?(q=b.applyHit(U,p,m),h.attacker.keywordShieldRemaining=b.getShieldValue()):h.attacker.keywordShieldRemaining=0;const C=Oy(a,p??void 0),J=Oy(s,{health:ne,shield:$+X}),H={attacker:C,defender:J,damage:_,shieldDamage:R,hpDamage:U,lethal:Y},ae={...H,source:"defender"};if(mc(s,"onHit",ae),hc("combat:onHit",ae),a){const F={...H,source:"attacker"};mc(a,"onHit",F),hc("combat:onHit",F),Y&&(mc(a,"onKill",F),hc("combat:onKill",F))}return Y&&(mc(s,"onKill",ae),hc("combat:onKill",ae)),{damage:_,shieldDamage:R,hpDamage:U,lethal:Y,remainingHealth:ne,remainingShield:$+X,attackerHealing:q,attackerRemainingHealth:p?.health,attackerRemainingShield:p?.shield,keywordEffects:h}}const Hy=5;function cn(t){return`${t.q},${t.r}`}function jy(t){const[a,s]=t.split(",").map(Number);return{q:a,r:s}}function Vs(t){return{q:t.q,r:t.r}}class PE{constructor(a,s,r,l,u,f=[],h){this.id=a,this.type=s,this.faction=l,this.stats=u,this.priorityFactions=f,this.coord=Vs(r),this.renderCoord=Vs(r),this.maxHealth=u.health,this.behavior=h??(l==="player"?"defend":"attack")}alive=!0;listeners={};maxHealth;healMarkerElapsed=0;healAmountBuffer=0;cachedTargetKey;cachedStartKey;cachedPath;movementCooldownSeconds=0;shield=0;immortal=!1;experience=0;behavior;combatHooks=null;combatKeywords=null;coord;renderCoord;setCoord(a,s){this.coord=Vs(a),(s?.snapRender??!0)&&(this.renderCoord=Vs(a))}setRenderCoord(a){this.renderCoord=Vs(a)}snapRenderToCoord(a=this.coord){this.renderCoord=Vs(a)}onDeath(a){(this.listeners.death??=[]).push(a)}emitDeath(){for(const a of this.listeners.death??[])a()}isDead(){return!this.alive}getMaxHealth(){return this.maxHealth}distanceTo(a){return Zs(this.coord,a)}getVisionRange(){const{visionRange:a}=this.stats;return Number.isFinite(a)?a:3}getBehavior(){return this.behavior}setBehavior(a){this.behavior=a}attack(a){return this.distanceTo(a.coord)>this.stats.attackRange?null:a.takeDamage(this.stats.attackDamage,this)}update(a,s){if(!(this.isDead()||!s))if(Zs(this.coord,s.pos)<=s.auraRadius){const r=this.stats.health;if(this.stats.health=Math.min(this.stats.health+s.regenPerSec*a,this.maxHealth),this.stats.health>r){const l=this.stats.health-r;this.healMarkerElapsed+=a,this.healAmountBuffer+=l,(this.healMarkerElapsed>=.9||this.healAmountBuffer>=2)&&this.flushHealEvent()}}else this.healAmountBuffer>0&&this.flushHealEvent(),this.healMarkerElapsed=0,this.healAmountBuffer=0}flushHealEvent(){if(this.healAmountBuffer<=0){this.healMarkerElapsed=0;return}const a=Math.round(this.healAmountBuffer*10)/10;a>0&&se.emit("unitHealed",{unitId:this.id,amount:a,remainingHealth:this.stats.health}),this.healAmountBuffer=0,this.healMarkerElapsed=0}takeDamage(a,s){const r=Number.isFinite(a);if(r&&a<=0||!r&&!s)return null;const l=s?s.toCombatParticipant():null,u=this.toCombatParticipant(),f=KE({attacker:l,defender:u,baseDamage:r?a:void 0});this.stats.health=f.remainingHealth,this.shield=f.remainingShield;let h=f;if(f.lethal&&this.alive&&this.immortal&&(this.stats.health=Math.max(1,this.stats.health),h={...f,lethal:!1,remainingHealth:this.stats.health,remainingShield:this.shield}),s&&f.attackerRemainingHealth!==void 0){const m=Math.min(s.getMaxHealth(),Math.max(0,f.attackerRemainingHealth));s.stats.health=m}return s&&f.attackerRemainingShield!==void 0&&s.setShield(f.attackerRemainingShield),h.damage>0&&se.emit("unitDamaged",{attackerId:s?.id,targetId:this.id,amount:h.damage,remainingHealth:this.stats.health}),h.lethal&&this.alive&&(this.stats.health=0,this.alive=!1,this.snapRenderToCoord(),se.emit("unitDied",{unitId:this.id,attackerId:s?.id,unitFaction:this.faction,attackerFaction:s?.faction}),this.emitDeath()),h}getShield(){return this.shield}setShield(a){if(!Number.isFinite(a)||a<=0){this.shield=0;return}this.shield=a}updateStats(a){this.stats.attackDamage=a.attackDamage,this.stats.attackRange=a.attackRange,this.stats.movementRange=a.movementRange,typeof a.defense=="number"&&Number.isFinite(a.defense)?this.stats.defense=a.defense:delete this.stats.defense,typeof a.visionRange=="number"&&Number.isFinite(a.visionRange)&&(this.stats.visionRange=a.visionRange);const s=Math.max(1,Math.round(a.health));this.maxHealth=s,this.stats.health=Math.min(s,Math.max(0,this.stats.health))}isImmortal(){return this.immortal}setImmortal(a){this.immortal=!!a}getExperience(){return this.experience}setExperience(a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;s!==this.experience&&(this.experience=s,se.emit("unit:xpChanged",{unitId:this.id,xp:this.experience}))}addExperience(a){if(!Number.isFinite(a)||a===0)return this.experience;const s=Math.max(0,Math.floor(this.experience+a));return this.setExperience(s),this.experience}toCombatParticipant(){return{id:this.id,faction:this.faction,attack:this.stats.attackDamage,defense:this.stats.defense,health:this.stats.health,maxHealth:this.maxHealth,shield:this.shield,hooks:this.combatHooks,keywords:this.combatKeywords}}addMovementTime(a){!Number.isFinite(a)||a<=0||(this.movementCooldownSeconds+=a)}canStep(a=Hy){return this.movementCooldownSeconds>=a}consumeMovementCooldown(a=Hy){return this.canStep(a)?(this.movementCooldownSeconds-=a,!0):!1}moveTowards(a,s,r){const l=this.getPathTo(a,s,r);if(l.length<2)return[];let u=0;const f=cn(a);for(let m=1;m<l.length;m++){const p=cn(l[m]);if(r.has(p)){p!==f&&this.clearPathCache();break}u=m}if(u===0)return[];const h=Math.min(this.stats.movementRange,u);return l.slice(0,h+1)}getPathTo(a,s,r){const l=cn(this.coord),u=cn(a);return(!this.cachedPath||this.cachedTargetKey!==u||this.cachedStartKey!==l)&&(this.cachedPath=this.findPath(a,s,r),this.cachedTargetKey=u,this.cachedStartKey=l),this.cachedPath}advancePathCache(a){!this.cachedPath||a<=0||(this.cachedPath=this.cachedPath.slice(a),this.cachedPath.length>0?this.cachedStartKey=cn(this.cachedPath[0]):(this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0))}clearPathCache(){this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0}findPath(a,s,r){const l=this.coord,u=cn(l),f=cn(a),h=new Set([u]),m=new Map([[u,null]]),p=new Map([[u,0]]),g=new Map([[u,Zs(l,a)]]);for(;h.size>0;){let S=null,E=1/0;for(const R of h){const U=g.get(R)??1/0;U<E&&(E=U,S=R)}if(S===null||S===f)break;h.delete(S);const T=jy(S),_=p.get(S)??1/0;for(const R of Bc(T)){const U=cn(R);if(U!==f&&!this.isPassable(R,s,r))continue;const B=_+1;B<(p.get(U)??1/0)&&(m.set(U,S),p.set(U,B),g.set(U,B+Zs(R,a)),h.add(U))}}if(!m.has(f))return[l];const b=[];let v=f;for(;v;)b.push(jy(v)),v=m.get(v)??null;return b.reverse()}seekNearestEnemy(a,s,r){const l=new Map;for(const h of a)l.set(cn(h.coord),h);const u=[this.coord],f=new Set([cn(this.coord)]);for(;u.length>0;){const h=u.shift(),m=cn(h),p=l.get(m);if(p)return p;for(const g of Bc(h)){const b=cn(g),v=l.get(b);if(v)return v;this.isPassable(g,s,r)&&(f.has(b)||(f.add(b),u.push(g)))}}return null}canTraverse(a,s,r){return this.isPassable(a,s,r)}isPassable(a,s,r){const l=s.getTile(a.q,a.r);return!l||r&&r.has(cn(a))?!1:l.terrain!==En.Lake}}class ZE{static selectTarget(a,s){let r=s.filter(u=>u.faction!==a.faction&&!u.isDead());if(r.length===0)return null;if(a.priorityFactions.length>0){const u=r.filter(f=>a.priorityFactions.includes(f.faction));u.length>0&&(r=u)}const l=r.filter(u=>a.distanceTo(u.coord)<=a.stats.attackRange);return l.length>0?(l.sort((u,f)=>u.stats.health-f.stats.health),l[0]):(r.sort((u,f)=>a.distanceTo(u.coord)-a.distanceTo(f.coord)),r[0]??null)}}const JE=4,WE=8;class ex{buckets=[];bucketCount=0;currentBucket=0;minBuckets;maxBuckets;constructor(a={}){this.minBuckets=a.minBuckets??JE,this.maxBuckets=a.maxBuckets??WE}reset(){this.buckets=[],this.bucketCount=0,this.currentBucket=0}next(a){const s=a.length;if(s===0)return this.reset(),[];const r=this.computeBucketCount(s);r!==this.bucketCount&&(this.bucketCount=r,this.currentBucket=this.currentBucket%Math.max(1,r)),this.rebuildBuckets(a);const l=this.buckets[this.currentBucket]??[];return this.bucketCount>0&&(this.currentBucket=(this.currentBucket+1)%this.bucketCount),l}rebuildBuckets(a){const s=this.bucketCount;this.buckets=Array.from({length:s},()=>[]);const r=[...a].sort((l,u)=>l.id.localeCompare(u.id));for(let l=0;l<r.length;l++){const u=l%s;this.buckets[u].push(r[l])}}computeBucketCount(a){if(a<=0)return 0;const s=Math.ceil(a/12);let r=Math.max(this.minBuckets,s);return r=Math.min(this.maxBuckets,r),r=Math.min(r,a),r=Math.max(1,r),r}}function jf(t){return`${t.q},${t.r}`}const tx=500;class nx{cache=new Map;targetIndex=new Map;targetPositions=new Map;ttlMs;constructor(a=tx){this.ttlMs=a}clearExpired(a=Date.now()){for(const[s,r]of this.cache.entries())if(r.expiresAt<=a&&(this.cache.delete(s),r.targetId)){const l=this.targetIndex.get(r.targetId);l?.delete(s),l&&l.size===0&&this.targetIndex.delete(r.targetId)}}trackUnit(a){this.invalidateIfTargetMoved(a.id,jf(a.coord))}invalidateForUnit(a){const s=this.targetIndex.get(a);if(s){for(const r of s)this.cache.delete(r);this.targetIndex.delete(a)}this.targetPositions.delete(a)}getPath(a,s,r,l,u={}){const f=u.now??Date.now(),h=u.targetId,m=jf(s);h&&this.invalidateIfTargetMoved(h,m);const p=this.hashObstacles(l),g=this.createCacheKey(jf(a.coord),m,p),b=this.cache.get(g);if(b&&b.expiresAt>f)return b.path;a.clearPathCache();const v=a.getPathTo(s,r,l);if(this.cache.set(g,{path:v,expiresAt:f+this.ttlMs,targetId:h}),h){let S=this.targetIndex.get(h);S||(S=new Set,this.targetIndex.set(h,S)),S.add(g),this.targetPositions.set(h,m)}return v}invalidateIfTargetMoved(a,s){const r=this.targetPositions.get(a);if(!r){this.targetPositions.set(a,s);return}if(r===s)return;const l=this.targetIndex.get(a);if(l){for(const u of l)this.cache.delete(u);l.clear()}this.targetPositions.set(a,s)}hashObstacles(a){return a.size===0?"empty":Array.from(a).sort().join("|")}createCacheKey(a,s,r){return`${a}->${s}|${r}`}}const ax={baseThreshold:50,heatPerSecond:50/30,thresholdGrowth:.05,coolingPerSecond:0};function Bt(t,a=0){return Number.isFinite(t)?t:a}class ix{heat;threshold;baseThreshold;thresholdGrowthFactor;heatPerSecond;coolingPerSecond;maxStoredHeat;constructor(a={}){const s={...ax,...a},r=Math.max(1,Bt(s.baseThreshold,50)),l=Math.max(1,Bt(a.initialThreshold??r,r));this.baseThreshold=r,this.threshold=l,this.thresholdGrowthFactor=1+Math.max(0,Bt(s.thresholdGrowth,0)),this.heatPerSecond=Math.max(0,Bt(s.heatPerSecond,0)),this.coolingPerSecond=Math.max(0,Bt(s.coolingPerSecond,0));const u=Bt(s.maxStoredHeat??Number.NaN,Number.NaN);this.maxStoredHeat=Number.isFinite(u)&&u>=0?u:null;const f=Math.max(0,Bt(a.initialHeat??0,0));this.heat=this.setHeatInternal(f)}getHeat(){return this.heat}getThreshold(){return this.threshold}getBuildRate(){return this.heatPerSecond}getCoolingRate(){return this.coolingPerSecond}reset(){this.heat=0,this.threshold=this.baseThreshold}setHeat(a){const s=Math.max(0,Bt(a,0));return this.heat=this.setHeatInternal(s),this.heat}setHeatInternal(a){const s=Math.max(0,Bt(a,0));return this.maxStoredHeat===null?(this.heat=s,this.heat):(this.heat=Math.min(s,this.maxStoredHeat),this.heat)}addHeat(a){const s=Math.max(0,Bt(a,0));if(s<=0)return 0;const r=this.heat,l=r+s;return this.heat=this.maxStoredHeat===null?l:Math.min(l,this.maxStoredHeat),this.heat-r}cool(a){const s=Math.max(0,Bt(a,0));if(s<=0||this.heat<=0)return 0;const r=this.heat;return this.heat=Math.max(0,this.heat-s),r-this.heat}vent(a=1){const s=Math.max(0,Math.min(1,Bt(a,1)));return s<=0?0:this.cool(this.threshold*s)}advance(a,s){const r=Math.max(0,Bt(a,0)),l=this.heatPerSecond,u=r>0?l*r:0,f=Math.max(0,Bt(s?.bonusHeat??0,0)),h=u+f,m=this.addHeat(h),p=Math.max(0,Bt(s?.coolingMultiplier??1,1)),g=r>0?this.coolingPerSecond*r*p:0,b=this.cool(g);return{addedHeat:m,cooledHeat:b,heat:this.heat}}hasTriggerReady(){return this.heat>=this.threshold-1e-6}consumeTrigger(){return this.hasTriggerReady()?(this.cool(this.threshold),this.threshold=Math.max(this.baseThreshold,this.threshold*this.thresholdGrowthFactor),!0):!1}timeUntilNextTrigger(){return this.hasTriggerReady()?0:this.heatPerSecond<=0?Number.POSITIVE_INFINITY:Math.max(0,this.threshold-this.heat)/this.heatPerSecond}getCooldownSeconds(){return this.heatPerSecond<=0?Number.POSITIVE_INFINITY:this.threshold/this.heatPerSecond}}function sx(t){return new ix(t)}const Gy=500,rx=4;function A2(t,a,s){const r=typeof a=="number"?a:2,l=(typeof a=="number"?s:a)??[],u=[];for(let h=-r;h<=r;h++){const m=Math.max(-r,-h-r),p=Math.min(r,-h+r);for(let g=m;g<=p;g++){const b=Math.max(Math.abs(h),Math.abs(g),Math.abs(-h-g));if(b===0||b>r)continue;const v={q:t.q+h,r:t.r+g};l.some(E=>!E.isDead()&&E.coord.q===v.q&&E.coord.r===v.r)||u.push(v)}}if(u.length===0)return null;const f=Math.floor(Math.random()*u.length);return u[f]}function ox(t,a,s={}){const r=sx(a),l=r.getBuildRate(),u=r.getCooldownSeconds(),f=r.timeUntilNextTrigger(),h=Number.isFinite(s.maxRosterSize)?Math.max(0,Math.floor(s.maxRosterSize??0)):0,m=Number.isFinite(s.maxHealth)?Math.max(1,Math.floor(s.maxHealth??Gy)):Gy,p=Number.isFinite(s.health)?Math.max(0,Math.min(m,Math.floor(s.health??m))):m,g=Number.isFinite(s.visionRange)?Math.max(0,Math.floor(s.visionRange??0)):Math.max(0,Math.floor(s.tier?.visionRange??rx));return{id:"sauna",pos:t,auraRadius:2,visionRange:g,regenPerSec:1,rallyToFront:!1,maxRosterSize:h,maxHealth:m,health:p,destroyed:p<=0,heat:r.getHeat(),heatPerTick:l,playerSpawnThreshold:r.getThreshold(),playerSpawnCooldown:Number.isFinite(u)?u:0,playerSpawnTimer:Number.isFinite(f)?f:0,beerUpkeepAccumulator:0,heatTracker:r}}function lx(t,a){if(!Number.isFinite(a)||a<=0||t.destroyed)return{amount:0,remainingHealth:Math.max(0,t.health),destroyed:t.destroyed};const s=Math.max(0,t.health),r=Math.min(s,Math.max(0,Math.floor(a))),l=Math.max(0,s-r);return t.health=l,l<=0&&(t.health=0,t.destroyed=!0),{amount:r,remainingHealth:t.health,destroyed:t.destroyed}}const cx=30;function qt(t){return`${t.q},${t.r}`}class ux{constructor(a,s){this.map=a,this.animator=s}scheduler=new ex;pathCache=new nx;lastKnownCoords=new Map;findExplorationGoal(a,s){const r=a.coord;if(this.map.ensureTile(r.q,r.r).isFogged&&a.canTraverse(r,this.map,s))return r;const u=new Set([qt(r)]),f=[r];for(;f.length>0;){const h=f.shift(),m=Bc(h),p=this.map.getNeighbors(h.q,h.r);for(let g=0;g<m.length;g++){const b=m[g],v=p[g],S=qt(b);if(!u.has(S)&&(u.add(S),!!a.canTraverse(b,this.map,s))){if(v.isFogged)return b;f.push(b)}}}return null}tick(a,s,r){const l=a.length,u=Date.now();if(this.pathCache.clearExpired(u),l===0){this.scheduler.reset();return}const f=new Set,h=[],m=new Set;for(const g of a){if(g.addMovementTime(s),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g),this.lastKnownCoords.delete(g.id);continue}const b=this.lastKnownCoords.get(g.id);b&&Zs(b,g.coord)>1&&this.animator?.clear(g,{snap:!0}),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r}),this.pathCache.trackUnit(g),h.push(g),f.add(qt(g.coord)),m.add(g.id)}for(const g of[...this.lastKnownCoords.keys()])m.has(g)||this.lastKnownCoords.delete(g);if(h.length===0){this.scheduler.reset();return}const p=this.scheduler.next(h);if(p.length!==0)for(const g of p){const b=qt(g.coord);if(f.delete(b),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g);continue}const v=ZE.selectTarget(g,a);if(!v&&r&&!r.destroyed&&this.tryAttackSauna(g,r)){const U=qt(g.coord);f.add(U);continue}if(!v){let R=null;if(r&&!r.destroyed&&(R=r.pos),R||(R=this.findExplorationGoal(g,f)),R){const B=this.computeMovementPath(g,R,f,u);if(B.length>1&&g.stats.movementRange>0){const V=B[1],X=qt(V);if(f.has(X))g.clearPathCache();else{if(!g.canStep()){f.add(b);continue}if(g.consumeMovementCooldown()){const $={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(V,{snapRender:!1}),this.animator.enqueue(g,[$,V])):g.setCoord(V),g.advancePathCache(1);const W=qt(g.coord);W===qt(R)&&g.clearPathCache(),f.add(W),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});continue}}}else g.clearPathCache()}else g.clearPathCache();const U=qt(g.coord);f.add(U),r&&!r.destroyed&&this.tryAttackSauna(g,r);continue}if(v.isDead()){g.clearPathCache(),f.add(b);continue}const S=qt(v.coord),E=this.pathCache.getPath(g,v.coord,this.map,f,{now:u,targetId:v.id});if(E.length>1&&g.stats.movementRange>0){const R=E[1],U=qt(R),B=U===S;if(!f.has(U)||B){if(g.canStep()&&g.consumeMovementCooldown()){const V={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(R,{snapRender:!1}),this.animator.enqueue(g,[V,R])):g.setCoord(R),g.advancePathCache(1)}}else g.clearPathCache()}const T=qt(g.coord);f.add(T),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});const _=qt(v.coord);_!==S&&g.clearPathCache(),g.distanceTo(v.coord)<=g.stats.attackRange&&!v.isDead()&&((g.attack(v)?.lethal??!1)||v.isDead())&&(f.delete(_),g.clearPathCache(),this.pathCache.invalidateForUnit(v.id),this.animator?.clear(v))}}tryAttackSauna(a,s){if(a.faction==="player")return!1;const r=a.stats.attackRange;if(r<=0||a.distanceTo(s.pos)>r)return!1;const l=lx(s,a.stats.attackDamage);if(l.amount<=0)return!1;const u={attackerId:a.id,attackerFaction:a.faction,amount:l.amount,remainingHealth:l.remainingHealth};if(se.emit("saunaDamaged",u),l.destroyed){const f={attackerId:a.id,attackerFaction:a.faction};se.emit("saunaDestroyed",f)}return!0}computeMovementPath(a,s,r,l){const u=this.pathCache.getPath(a,s,this.map,r,{now:l});if(u.length<2)return[];let f=0;const h=qt(s);for(let p=1;p<u.length;p++){const g=qt(u[p]);if(r.has(g)){g!==h&&a.clearPathCache();break}f=p}if(f===0)return[];const m=Math.min(a.stats.movementRange,f);return u.slice(0,m+1)}}function bu(t){if(!Number.isFinite(t??NaN))return 1;const a=Math.floor(t);return Math.max(1,a)}function dx(t){return Math.max(0,bu(t)-1)}function fx(t,a="linear"){const s=dx(t);switch(a){case"accelerating":return s*(s+1)/2;case"diminishing":return s===0?0:Math.log2(s+1);case"linear":default:return s}}function hx(t,a="round"){switch(a){case"floor":return Math.floor(t);case"ceil":return Math.ceil(t);case"none":return t;case"round":default:return Math.round(t)}}function mx(t,a,s){let r=t;return Number.isFinite(a)&&(r=Math.max(r,a)),Number.isFinite(s)&&(r=Math.min(r,s)),r}function fo(t,a){const s=bu(a),r=t.curve??"linear",l=fx(s,r),u=t.base+t.growth*l,f=mx(u,t.min,t.max);return hx(f,t.round??"round")}function jo(t,a){const s=bu(a),r=t.stats,l={health:fo(r.health,s),attackDamage:fo(r.attackDamage,s),attackRange:fo(r.attackRange,s),movementRange:fo(r.movementRange,s)};return r.visionRange&&(l.visionRange=fo(r.visionRange,s)),l}function Yy(t){if(typeof t=="number"&&Number.isFinite(t))return t}function $c(t,a){let s=t.health,r=t.attackDamage,l=t.attackRange,u=t.movementRange,f=Yy(t.defense),h=Yy(t.shield);for(const p of a){const g=Math.max(1,Math.round(p.quantity)),b=p.modifiers;typeof b.health=="number"&&(s+=b.health*g),typeof b.attackDamage=="number"&&(r+=b.attackDamage*g),typeof b.attackRange=="number"&&(l+=b.attackRange*g),typeof b.movementRange=="number"&&(u+=b.movementRange*g),typeof b.defense=="number"&&(f=(f??0)+b.defense*g),typeof b.shield=="number"&&(h=(h??0)+b.shield*g)}const m={health:Math.max(1,Math.round(s)),attackDamage:Math.max(0,Math.round(r)),attackRange:Math.max(0,Math.round(l)),movementRange:Math.max(0,Math.round(u))};return f!==void 0&&(m.defense=Math.max(0,Math.round(f))),h!==void 0&&(m.shield=Math.max(0,Math.round(h))),typeof t.visionRange=="number"&&Number.isFinite(t.visionRange)&&(m.visionRange=Math.max(0,Math.round(t.visionRange))),m}const pm=Object.freeze({id:"soldier",displayName:"Sauna Soldier",cost:50,tags:["infantry","melee"],stats:{health:{base:20,growth:6,curve:"linear",round:"round"},attackDamage:{base:5,growth:1,curve:"linear",round:"round"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:0,round:"round"}}}),gm=Object.freeze({id:"archer",displayName:"Sauna Archer",cost:75,tags:["ranged"],stats:{health:{base:15,growth:4,curve:"linear",round:"round"},attackDamage:{base:3,growth:.4,curve:"accelerating",round:"ceil"},attackRange:{base:3,growth:.5,curve:"diminishing",round:"ceil",max:5},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:.25,curve:"linear",round:"round",max:5}}}),w2=Object.freeze({id:"avanto-marauder",displayName:"Avanto Marauder",cost:0,tags:["enemy","melee"],stats:{health:{base:12,growth:5,curve:"linear",round:"round"},attackDamage:{base:4,growth:.6,curve:"accelerating",round:"ceil"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:.25,curve:"linear",round:"round",max:2},visionRange:{base:3,growth:0,round:"round"}}}),C2=Object.freeze({soldier:pm,archer:gm,"avanto-marauder":w2});function ym(t){return C2[t]??null}Object.freeze(Object.keys(C2));const Fy=pm.cost;Object.freeze(jo(pm,1));gm.cost;Object.freeze(jo(gm,1));Object.freeze(jo(w2,1));function T2(t,a,s,r,l){const u=bu(l?.level),f=jo(t,u);return new PE(a,t.id,s,r,f,t.priorityFactions,l?.behavior)}function _2(t,a,s,r,l){const u=ym(t);return u?T2(u,a,s,r,l):null}function bm(t,a,s,r,l,u){const f=ym(a);if(!f)return null;const h=f.cost;if(!t.canAfford(h,re.SAUNA_BEER))return aa("error"),null;t.addResource(re.SAUNA_BEER,-h);const m=T2(f,s,r,l,u);return aa("spawn"),se.emit("unitSpawned",{unit:m}),m}const px=Object.freeze(Object.defineProperty({__proto__:null,createUnit:_2,spawnUnit:bm},Symbol.toStringTag,{value:"Module"})),gx=["Aino","Eero","Ilona","Kalevi","Lumi","Mika","Noora","Oskari","Saana","Tapio","Veera","Yrj"],yx=["Emberguard","Frostwalker","Steamcaller","Dawnwatch","Gritforged","Stormchant","Snowborn","Torchbearer","Chillwarden","Sisuheart"],bx=["Aalto","Halla","Karhu","Korhonen","Laine","Mets","Niemi","Salmi","Tuomi","Virta"];function Gf(t,a){if(t.length===0)throw new Error("Cannot select a name from an empty collection.");const s=Math.floor(a()*t.length);return t[Math.min(s,t.length-1)]}function vx(t=Math.random){const a=Gf(gx,t),s=Gf(yx,t),r=Gf(bx,t);return`${a} "${s}" ${r}`}const lr=Object.freeze(["supply","weapon","focus","relic"]);function N2(){return{supply:null,weapon:null,focus:null,relic:null}}const Sx=Object.freeze({supply:Object.freeze({id:"supply",label:"Supply Satchel",description:"Consumables and restorative provisions carried into battle.",maxStacks:5}),weapon:Object.freeze({id:"weapon",label:"Primary Armament",description:"The attendant's main weapon or ranged kit.",maxStacks:1}),focus:Object.freeze({id:"focus",label:"Battle Focus",description:"Tools that sharpen aim, steps, or battlefield intuition.",maxStacks:1}),relic:Object.freeze({id:"relic",label:"Sauna Relic",description:"Charms and relics that empower the attendant's resolve.",maxStacks:1})}),Mx=Object.freeze({"birch-sap-satchel":Object.freeze({id:"birch-sap-satchel",slot:"supply",modifiers:{health:3},maxStacks:3}),"steamed-bandages":Object.freeze({id:"steamed-bandages",slot:"supply",modifiers:{shield:4},maxStacks:2}),"aurora-distillate":Object.freeze({id:"aurora-distillate",slot:"supply",modifiers:{attackDamage:2,defense:1},maxStacks:1}),"stolen-sauna-tokens":Object.freeze({id:"stolen-sauna-tokens",slot:"supply",modifiers:{movementRange:.5},maxStacks:5}),"midnight-bloodwine":Object.freeze({id:"midnight-bloodwine",slot:"supply",modifiers:{health:6,attackDamage:1},maxStacks:1}),"sauna-incense":Object.freeze({id:"sauna-incense",slot:"supply",modifiers:{attackRange:1},maxStacks:2}),"glacier-brand":Object.freeze({id:"glacier-brand",slot:"weapon",modifiers:{attackDamage:3},maxStacks:1}),"emberglass-arrow":Object.freeze({id:"emberglass-arrow",slot:"weapon",modifiers:{attackDamage:1,attackRange:2},maxStacks:1}),"aurora-lattice":Object.freeze({id:"aurora-lattice",slot:"focus",modifiers:{attackDamage:2,attackRange:1},maxStacks:1}),"emberglass-shard":Object.freeze({id:"emberglass-shard",slot:"focus",modifiers:{attackDamage:1,movementRange:1},maxStacks:1}),"windstep-totem":Object.freeze({id:"windstep-totem",slot:"focus",modifiers:{movementRange:1,defense:1},maxStacks:1}),"searing-chant-censer":Object.freeze({id:"searing-chant-censer",slot:"focus",modifiers:{attackDamage:2,shield:2},maxStacks:1}),"cracked-ice-amulet":Object.freeze({id:"cracked-ice-amulet",slot:"relic",modifiers:{defense:2},maxStacks:1}),"myrsky-charm":Object.freeze({id:"myrsky-charm",slot:"relic",modifiers:{attackRange:1,defense:1},maxStacks:1}),"frostwyrm-signet":Object.freeze({id:"frostwyrm-signet",slot:"relic",modifiers:{shield:5},maxStacks:1}),"spirit-oak-charm":Object.freeze({id:"spirit-oak-charm",slot:"relic",modifiers:{defense:1,health:2},maxStacks:1})});function Go(t){const a=Sx[t];if(!a)throw new Error(`Unknown equipment slot: ${t}`);return a}function Yo(t){return Mx[t]}function R2(t){return Number.isFinite(t)?Math.max(1,Math.round(t)):1}function k2(t,a){return{id:t.id,name:t.name,description:t.description,icon:t.icon,rarity:t.rarity,quantity:a}}function L2(t,a,s,r){const l=Go(a),u=Math.max(1,Math.floor(s.maxStacks??l.maxStacks)),f=Math.min(u,r),h=s.modifiers??{};return{...k2(t,f),slot:a,maxStacks:u,modifiers:h}}function _h(t){t.equipment||(t.equipment=N2());for(const a of lr)t.equipment[a]??=null;return t.equipment}function Un(t){const a=[];for(const s of lr){const r=t[s];r&&a.push({...r})}return a}function vm(t){return Un(t).map(a=>k2(a,a.quantity))}function Yf(t){const a=N2();for(const s of t){const r=Yo(s.id);if(!r)continue;const l=R2(s.quantity),u=a[r.slot];if(u&&u.id!==s.id)continue;const f=(u?.quantity??0)+l,h=L2(s,r.slot,r,f);a[r.slot]=h}return a}function Ex(t,a){const s=Yo(a.id);if(!s)return{success:!1,slot:"supply",loadout:Un(_h(t)),item:null,reason:"unknown-item"};const r=_h(t),l=s.slot,u=Go(l),f=R2(a.quantity),h=Math.max(1,Math.floor(s.maxStacks??u.maxStacks)),m=r[l];if(m&&m.id!==a.id)return{success:!1,slot:l,loadout:Un(r),item:m,reason:"slot-occupied"};const p=Math.min(h,(m?.quantity??0)+f);if((m?.quantity??0)+f>h)return{success:!1,slot:l,loadout:Un(r),item:m,reason:"stack-limit"};const g=L2(a,l,s,p);return r[l]=g,t.items=vm(r),{success:!0,slot:l,loadout:Un(r),item:g}}function xx(t,a){const s=_h(t),r=s[a];return r?(s[a]=null,t.items=vm(s),{success:!0,slot:a,loadout:Un(s),removed:r}):{success:!1,slot:a,loadout:Un(s),removed:null,reason:"empty-slot"}}function Ax(t,a){return Yo(t)?.slot===a}const wx={q:0,r:0},Cx="Saunoja",Nh=18,Vy=0,Io=1,Rh=4,Xc=1,Tx="defend",pc={health:Nh,attackDamage:4,attackRange:1,movementRange:1,defense:0,shield:0},_x=["defend","attack","explore"];function gc(t,a,s){return Math.min(Math.max(t,a),s)}function yc(t,a,s){const r=typeof t=="number"&&Number.isFinite(t)?t:a;return Math.max(s,r)}function Ff(t,a,s=0){if(typeof t=="number"&&Number.isFinite(t))return Math.max(s,t);if(typeof a=="number"&&Number.isFinite(a))return Math.max(s,a)}function $y(t,a){if(!t||typeof t!="object")return{...a};const s=t,r=yc(s.health,a.health,1),l=yc(s.attackDamage,a.attackDamage,0),u=yc(s.attackRange,a.attackRange,0),f=yc(s.movementRange,a.movementRange,0),h=Ff(s.defense,a.defense,0),m=Ff(s.shield,a.shield,0),p=Ff(s.visionRange,a.visionRange,0);return{health:r,attackDamage:l,attackRange:u,movementRange:f,defense:h,shield:m,visionRange:p}}function Nx(t,a){if(!t||typeof t!="object")return Yf(a);const s=t,r=[];for(const l of Object.values(s)){const u=D2(l);u&&r.push(u)}return r.length===0?Yf(a):Yf(r)}function Rx(t,a=Tx){if(typeof t=="string"){const s=t.trim().toLowerCase();if(_x.includes(s))return s}return a}function D2(t){if(!t||typeof t!="object")return null;const a=t,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const l=typeof a.description=="string"?a.description.trim():void 0,u=typeof a.icon=="string"?a.icon.trim():void 0,f=typeof a.rarity=="string"?a.rarity.trim():void 0,h=typeof a.quantity=="number"?a.quantity:Number(a.quantity),m=Number.isFinite(h)?Math.max(1,Math.round(h)):1;return{id:s,name:r,description:l,icon:u,rarity:f,quantity:m}}function kx(t){if(!t||t.length===0)return[];const a=[];for(const s of t){const r=D2(s);r&&a.push(r)}return a}function Lx(t){if(!t||typeof t!="object")return null;const a=t,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const l=a.duration;let u=1/0;typeof l=="number"&&Number.isFinite(l)?u=Math.max(0,l):l!==1/0&&(u=1/0);const f=a.remaining;let h=u;typeof f=="number"&&Number.isFinite(f)?h=Math.max(0,f):f===1/0&&(h=1/0),u!==1/0&&h===1/0&&(h=u);const m=a.appliedAt,p=typeof m=="number"&&Number.isFinite(m)?Math.max(0,m):void 0,g=a.stacks,b=typeof g=="number"&&Number.isFinite(g)?Math.max(1,Math.round(g)):void 0,v=typeof a.description=="string"?a.description.trim():void 0,S=typeof a.source=="string"?a.source.trim():void 0;return{id:s,name:r,description:v,duration:u,remaining:h,appliedAt:p,stacks:b,source:S}}function Dx(t){if(!t||t.length===0)return[];const a=[];for(const s of t){const r=Lx(s);r&&a.push(r)}return a}function Ix(t){if(typeof t=="string"){const a=t.trim();if(a.length>0)return a}try{return vx()}catch(a){return console.warn("Falling back to default Saunoja name",a),Cx}}function Sm(t){const{id:a,name:s,coord:r=wx,maxHp:l=Nh,hp:u=l,steam:f=0,defense:h,shield:m=0,behavior:p,traits:g=[],upkeep:b=Xc,xp:v=0,lastHitAt:S=Vy,selected:E=!1,items:T,modifiers:_,combatKeywords:R=null,combatHooks:U=null}=t,B=Number.isFinite(l)?Math.max(1,l):Nh,V=Number.isFinite(u)?u:B,X=gc(V,0,B),$=Number.isFinite(f)?f:0,W=gc($,0,1),Y=(Array.isArray(g)?g:[]).filter(dn=>typeof dn=="string").map(dn=>dn.trim()).filter(dn=>dn.length>0),q=Number.isFinite(b)?b:Xc,C=gc(q,Io,Rh),J=Number.isFinite(v)?v:0,H=Math.max(0,J),ae=Number.isFinite(S)?S:Vy,F=Math.max(0,ae),D=Number.isFinite(m)?m:0,P=Math.max(0,D),le=Number.isFinite(h)?h:void 0,ee=le!==void 0?Math.max(0,le):void 0,x=kx(T),A=Dx(_),z=Rx(p),Q=Nx(t.equipment,x),oe=vm(Q),de={...pc,health:B,defense:ee??pc.defense,shield:pc.shield},ue=$y(t.baseStats,de),ve={...ue,health:B,defense:ee??ue.defense,shield:P},ge=$y(t.effectiveStats,ve),et=Math.max(1,ge.health),Ut=gc(X,0,et),Ot=typeof ge.defense=="number"?Math.max(0,ge.defense):ee??void 0,An=typeof ge.shield=="number"?Math.max(0,ge.shield):P,Bn={...ue,health:Math.max(1,ue.health),defense:typeof ue.defense=="number"?Math.max(0,ue.defense):ee??void 0,shield:typeof ue.shield=="number"?Math.max(0,ue.shield):pc.shield},ja={...ge,health:et,defense:Ot,shield:An},la=Ix(s);return{id:a,name:la,coord:{q:r.q,r:r.r},maxHp:et,hp:Ut,defense:Ot,shield:An,steam:W,behavior:z,traits:[...Y],upkeep:C,xp:H,lastHitAt:F,selected:E,items:oe,baseStats:Bn,effectiveStats:ja,equipment:Q,modifiers:A,combatKeywords:R,combatHooks:U}}const cr=32;function Co(t,a,s,r){t.beginPath();for(let l=0;l<6;l++){const u=Math.PI/3*l,f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?t.moveTo(f,h):t.lineTo(f,h)}t.closePath()}function Mm(t,a,s){return Math.min(Math.max(t,a),s)}function Ux(t,{centerX:a,centerY:s,hp:r,maxHp:l,radius:u=cr*.55}){const f=Number.isFinite(l)?Math.max(1,l):1,h=Number.isFinite(r)?r:f,m=Mm(h/f,0,1);if(t.save(),Co(t,a,s,u),t.fillStyle="rgba(7, 11, 18, 0.72)",t.fill(),t.restore(),m>0){t.save(),Co(t,a,s,u),t.clip();const p=t.createLinearGradient(a,s+u,a,s-u);p.addColorStop(0,"rgba(46, 160, 98, 0.35)"),p.addColorStop(1,"rgba(218, 255, 239, 0.95)"),t.fillStyle=p;const g=u*2*m,b=s+u-g;t.fillRect(a-u,b,u*2,g),t.restore()}t.save(),Co(t,a,s,u),t.lineWidth=Math.max(1,u*.12),t.strokeStyle="rgba(255, 255, 255, 0.28)",t.stroke(),t.restore()}function Ox(t,{centerX:a,centerY:s,radius:r=cr,progress:l=0}){const u=Mm(l,0,1);if(u<=0)return;const f=Number.isFinite(r)&&r>0?r:cr;t.save(),t.globalCompositeOperation="lighter",t.globalAlpha=u;const h=t.createRadialGradient(a,s,Math.max(1,f*.1),a,s,f);h.addColorStop(0,"rgba(255, 255, 255, 0.92)"),h.addColorStop(.45,"rgba(255, 255, 255, 0.68)"),h.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=h,t.beginPath(),t.arc(a,s,f,0,Math.PI*2),t.fill(),t.restore()}function zx(t,{centerX:a,centerY:s,radius:r=cr*.85,intensity:l=1}){const u=Mm(l,0,1);if(u<=0)return;t.save(),Co(t,a,s,r),t.clip();const f=t.createLinearGradient(a,s+r,a,s-r);f.addColorStop(0,"rgba(255, 255, 255, 0)"),f.addColorStop(.55,`rgba(255, 255, 255, ${.12*u})`),f.addColorStop(1,`rgba(255, 255, 255, ${.35*u})`),t.globalCompositeOperation="lighter",t.fillStyle=f,t.fillRect(a-r,s-r,r*2,r*2),t.restore(),t.save(),t.globalCompositeOperation="lighter",t.lineCap="round",t.strokeStyle=`rgba(255, 255, 255, ${.25*u})`,t.lineWidth=Math.max(1,r*.08);const h=r*.75,m=r*.35;for(let p=0;p<3;p++){const g=s-r*.5+p*m;t.beginPath(),t.moveTo(a-h,g),t.bezierCurveTo(a-h*.4,g-r*.4,a+h*.4,g+r*.2,a+h,g-r*.45),t.stroke()}t.restore()}function kh(t,a,s){return t<a?a:t>s?s:t}const Vf=Object.freeze([{id:"skirmish",label:"Skirmish Patrols",minRunSeconds:0,minClears:0,cadence:26,multiplier:1,bundleTier:0},{id:"raids",label:"Raid Pressure",minRunSeconds:90,minClears:2,cadence:19,multiplier:1.35,bundleTier:1},{id:"siege",label:"Siege Lines",minRunSeconds:210,minClears:5,cadence:13,multiplier:1.8,bundleTier:2},{id:"onslaught",label:"Winter Onslaught",minRunSeconds:360,minClears:9,cadence:8.5,multiplier:2.45,bundleTier:3},{id:"maelstrom",label:"Glacier Maelstrom",minRunSeconds:540,minClears:14,cadence:6.2,multiplier:3.25,bundleTier:4}]);function Bx(t){return t>=1?1/(1+(t-1)*.45):1+(1-t)*.35}function qx(t){if(t>=1)return 1+(t-1)*.85;const a=1-t;return kh(1-a*.4,.45,1)}function Hx(t){return{runSeconds:Math.max(0,Number.isFinite(t.runSeconds)?t.runSeconds:0),clears:Math.max(0,Number.isFinite(t.clears)?t.clears:0),spawnCycles:Math.max(0,Number.isFinite(t.spawnCycles)?t.spawnCycles:0)}}function Xy(t,a){const s=Hx(a);let r=0;for(let p=0;p<Vf.length;p+=1){const g=Vf[p];if(s.runSeconds<g.minRunSeconds||s.clears<g.minClears)break;r=p}const l=Vf[r],u=Bx(t),f=qx(t),h=Math.max(.75,l.cadence*u),m=l.multiplier*f;return{stage:l,stageIndex:r,cadenceTarget:h,multiplierBase:m}}function Qy(t){if(t>=1){const s=Math.min(3,t-1);return kh(.93-s*.035,.82,.93)}const a=Math.min(1,1-t);return kh(.93+a*.03,.9,.97)}function Ky(t){if(t>=1)return .024+Math.min(3,t-1)*.012;const a=Math.min(1,1-t);return Math.max(.012,.024-a*.01)}const I2="deepwood",U2="Deepwood Wardens",O2="Reclusive guardians attuned to sauna spirits.",z2=[{id:"warding-circle",label:"Warding Circle",weight:2,units:[{unit:"soldier",level:1,quantity:2},{unit:"archer",level:1,quantity:1}],items:["spirit-oak-charm","sauna-incense"],modifiers:["barkskin-ritual"]},{id:"spirit-strike",label:"Spirit Strike",weight:1,units:[{unit:"archer",level:2,quantity:2}],items:["emberglass-arrow"],modifiers:["searing-chant","windstep"]}],jx={id:I2,name:U2,description:O2,bundles:z2},Gx=Object.freeze(Object.defineProperty({__proto__:null,bundles:z2,default:jx,description:O2,id:I2,name:U2},Symbol.toStringTag,{value:"Module"})),B2="enemy",q2="Avanto Marauders",H2="Frostbitten raiders who harry the sauna frontier.",j2=[{id:"iceblade-scouts",label:"Iceblade Scouts",weight:3,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:1}],items:["cracked-ice-amulet"],modifiers:["frost-resilience"]},{id:"raiding-party",label:"Raiding Party",weight:2,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:2}],items:["stolen-sauna-tokens"],modifiers:["berserker-drift"]},{id:"frost-champion",label:"Frost Champion",weight:1,minRampTier:0,units:[{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand"],modifiers:["glacial-ward"]},{id:"icebreaker-vanguard",label:"Icebreaker Vanguard",weight:2.5,minRampTier:1,units:[{unit:"avanto-marauder",level:2,quantity:2},{unit:"avanto-marauder",level:1,quantity:1}],items:["stormglass-pendant"],modifiers:["frost-resilience","berserker-drift"]},{id:"glacial-phalanx",label:"Glacial Phalanx",weight:2,minRampTier:2,units:[{unit:"avanto-marauder",level:3,quantity:3},{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand","frostshard-relic"],modifiers:["glacial-ward","polar-endurance"]},{id:"avalanche-warhost",label:"Avalanche Warhost",weight:1.25,minRampTier:3,units:[{unit:"avanto-marauder",level:4,quantity:3},{unit:"avanto-marauder",level:3,quantity:2}],items:["avalanche-totem"],modifiers:["glacial-ward","polar-endurance","berserker-drift"]}],Yx={id:B2,name:q2,description:H2,bundles:j2},Fx=Object.freeze(Object.defineProperty({__proto__:null,bundles:j2,default:Yx,description:H2,id:B2,name:q2},Symbol.toStringTag,{value:"Module"})),Vx=Object.assign({"../content/factions/deepwood.json":Gx,"../content/factions/enemy.json":Fx}),Qc=new Map;for(const[t,a]of Object.entries(Vx)){const s=$x(a),r=Px(s,t);if(Qc.has(r.id))throw new Error(`Duplicate faction bundle id: ${r.id}`);Qc.set(r.id,r)}function $x(t){return typeof t=="object"&&t!==null&&"default"in t?t.default:t}function Em(t){return typeof t=="object"&&t!==null}function Lh(t,a){if(typeof t!="string")throw new Error(`Expected string at ${a}`);const s=t.trim();if(!s)throw new Error(`Expected non-empty string at ${a}`);return s}function Dh(t){if(typeof t!="string")return;const a=t.trim();return a||void 0}function Py(t,a){if(t===void 0)return Object.freeze([]);if(!Array.isArray(t))throw new Error(`Expected array at ${a}`);const s=t.map((r,l)=>{if(typeof r!="string")throw new Error(`Expected string at ${a}[${l}]`);const u=r.trim();if(!u)throw new Error(`Expected non-empty string at ${a}[${l}]`);return u});return Object.freeze(s)}function G2(t,a){const s=typeof t=="number"?t:Number(t);return!Number.isFinite(s)||s<=0?a:s}function Zy(t,a){const s=Math.floor(G2(t,a));return s>0?s:a}function Xx(t,a){if(!Em(t))throw new Error(`Expected object at ${a}`);const s=Lh(t.unit,`${a}.unit`),r=Zy(t.level,1),l=Zy(t.quantity,1);return Object.freeze({unit:s,level:r,quantity:l})}function Qx(t){if(t===void 0)return;const a=Number(t);if(!Number.isFinite(a))return;const s=Math.floor(a);return s>=0?s:void 0}function Kx(t,a,s){if(!Em(t))throw new Error(`Expected object at ${a}`);const r=Dh(t.id)??`${s}-bundle`,l=Dh(t.label)??r,u=G2(t.weight,1),f=t.units;if(!Array.isArray(f)||f.length===0)throw new Error(`Expected non-empty units array at ${a}.units`);const h=f.map((b,v)=>Xx(b,`${a}.units[${v}]`)),m=Py(t.items,`${a}.items`),p=Py(t.modifiers,`${a}.modifiers`),g=Qx(t.minRampTier);return Object.freeze({id:r,label:l,weight:u,units:Object.freeze(h),items:m,modifiers:p,minRampTier:g})}function Px(t,a){if(!Em(t))throw new Error(`Expected object at ${a}`);const s=Lh(t.id,`${a}.id`),r=Lh(t.name,`${a}.name`),l=Dh(t.description);if(!Array.isArray(t.bundles)||t.bundles.length===0)throw new Error(`Expected non-empty bundles array at ${a}.bundles`);const u=t.bundles.map((f,h)=>Kx(f,`${a}.bundles[${h}]`,`${s}-${h}`));return Object.freeze({id:s,name:r,description:l,bundles:Object.freeze(u)})}Object.freeze(Array.from(Qc.keys()));function Zx(t){return Qc.get(t)??null}function Jx(t){return Zx(t)?.bundles??Object.freeze([])}function Wx(){return`e${Date.now()}-${Math.floor(Math.random()*1e6)}`}function eA(t){return{level:t}}function tA(t,a,s){const r=Jx(t);if(r.length===0)throw new Error(`No bundles registered for faction: ${t}`);const l=Math.max(0,Math.floor(Number.isFinite(a)?a:0)),u=r.filter(b=>(typeof b.minRampTier=="number"?b.minRampTier:0)<=l),f=u.length>0?u:r,h=typeof s=="function"?s:Math.random,m=f.reduce((b,v)=>b+v.weight,0);if(!Number.isFinite(m)||m<=0)throw new Error(`Invalid bundle weights for faction: ${t}`);const p=h()*m;let g=0;for(const b of f)if(g+=b.weight,p<g)return b;return f[f.length-1]}function nA(t){let a=Math.max(0,Math.floor(t.availableSlots));const s=[];if(a<=0)return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers};const r=t.makeId??Wx,l=typeof t.random=="function"?t.random:Math.random,u=Math.max(0,Math.min(.95,typeof t.eliteOdds=="number"?t.eliteOdds:0)),f=Math.max(1,Number.isFinite(t.difficultyMultiplier)?t.difficultyMultiplier:1),h=Math.max(0,Math.floor(Number.isFinite(t.rampTier)?t.rampTier:0)),m=1+h*.25,p=Math.floor(h/2);for(const g of t.bundle.units){const b=Math.max(1,Math.round(g.quantity*f*m)),v=Math.min(b,a),S=g.unit,E=Math.max(1,Math.round((g.level+p)*f));for(let T=0;T<v;T+=1){const _=l()<u?1:0,R=Math.max(1,E+_),U=eA(R),B=t.pickEdge();if(!B)return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers};const V=_2(S,r(),B,t.factionId,U);if(V&&(t.addUnit(V),s.push(V),a-=1,a<=0))return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers}}}return{spawned:Object.freeze(s),items:t.bundle.items,modifiers:t.bundle.modifiers}}function bc(t,a,s,r=1){const l=Number(t);return Number.isFinite(l)?Math.max(a,Math.min(s,l)):r}const Jy=6;class aA{timer;interval;spawnCycles;factionId;random;makeId;difficulty;eliteOdds;cadenceDecay;multiplierGrowth;runSeconds=0;clearCount=0;boardEmpty=!0;lastClearAt=null;lastSpawnAt=null;lastCadence;lastMultiplier;rampEvaluation;rampStageIndex;currentDifficulty;cadenceScale=1;multiplierScale=1;pressureScale=1;calmUntil=null;calmSecondsRemaining=0;cadenceFloor=.3;constructor(a={}){this.factionId=a.factionId??"enemy",this.random=typeof a.random=="function"?a.random:Math.random;const s=Number.isFinite(a.difficulty)?Number(a.difficulty):1;this.difficulty=Math.max(.5,s);const r=typeof a.eliteOdds=="number"?a.eliteOdds:0;this.eliteOdds=Math.max(0,Math.min(.95,r)),this.currentDifficulty=this.difficulty,this.cadenceDecay=Qy(this.currentDifficulty),this.multiplierGrowth=Ky(this.currentDifficulty),this.spawnCycles=0,this.rampEvaluation=Xy(this.currentDifficulty,{runSeconds:0,clears:0,spawnCycles:0}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.interval=this.rampEvaluation.cadenceTarget,this.timer=this.interval,this.lastCadence=this.interval,this.lastMultiplier=this.rampEvaluation.multiplierBase;const l=(()=>{let u=0;return()=>`e${Date.now()}-${u+=1}`})();this.makeId=typeof a.idFactory=="function"?a.idFactory:l}update(a,s,r,l,u={}){if(!Number.isFinite(a)||a<=0)return;this.runSeconds+=a,this.applyRuntimeModifiers(u),this.resolveRampState();const f=this.countActiveEnemies(s);if(this.trackClears(f),this.calmUntil!==null&&this.runSeconds<this.calmUntil){const m=this.calmUntil-this.runSeconds;this.calmSecondsRemaining=m,this.timer=Math.max(this.timer,m);return}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0),this.timer-=a;let h=0;for(;this.timer<=0&&h<Jy;){const m=this.getAvailableSlots(s);if(m<=0){this.timer=Math.max(this.timer,.5);break}const p=this.resolveRampState(),g=tA(this.factionId,p.stage.bundleTier,this.random),b=this.computeMultiplier(p);if(nA({bundle:g,factionId:this.factionId,pickEdge:l,addUnit:r,makeId:this.makeId,availableSlots:m,eliteOdds:this.eliteOdds,random:this.random,difficultyMultiplier:b,rampTier:p.stage.bundleTier}).spawned.length===0){this.timer=Math.max(this.timer,.5);break}const S=this.runSeconds+this.timer;this.lastCadence=this.lastSpawnAt===null?this.interval:Math.max(.01,S-this.lastSpawnAt),this.lastSpawnAt=S,this.lastMultiplier=b,this.spawnCycles+=1,h+=1;const E=this.resolveRampState();this.interval=this.computeNextInterval(E),this.timer+=this.interval}h===Jy&&this.timer<=0&&(this.timer=this.interval)}getSnapshot(){const a=this.rampEvaluation.stage;return{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles,rampStageIndex:this.rampStageIndex,rampStageId:a.id,rampStageLabel:a.label,bundleTier:a.bundleTier,cadence:this.interval,lastCadence:this.lastCadence,lastSpawnAt:this.lastSpawnAt,lastClearAt:this.lastClearAt,difficultyMultiplier:this.lastMultiplier,effectiveDifficulty:this.currentDifficulty,aggressionMultiplier:this.currentDifficulty/this.difficulty,cadenceMultiplier:this.cadenceScale,strengthMultiplier:this.multiplierScale,pressureMultiplier:this.pressureScale,calmSecondsRemaining:this.calmSecondsRemaining}}resolveRampState(){return this.rampEvaluation=Xy(this.currentDifficulty,{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.rampEvaluation}applyRuntimeModifiers(a){const s=bc(a.aggressionMultiplier,.25,6,1),r=bc(a.cadenceMultiplier,.1,10,1),l=bc(a.strengthMultiplier,.1,12,1),u=bc(a.pressureMultiplier,.1,10,1),f=Number.isFinite(a.cadenceFloor)?Math.max(.1,a.cadenceFloor):this.cadenceFloor,h=Math.max(.25,this.difficulty*s);if(h!==this.currentDifficulty&&(this.currentDifficulty=h,this.cadenceDecay=Qy(this.currentDifficulty),this.multiplierGrowth=Ky(this.currentDifficulty),this.resolveRampState()),this.cadenceScale=r,this.multiplierScale=l,this.pressureScale=u,this.cadenceFloor=f,Object.prototype.hasOwnProperty.call(a,"calmSecondsRemaining")){const m=a.calmSecondsRemaining;m===null?this.calmUntil=null:typeof m=="number"&&Number.isFinite(m)&&m>0?this.calmUntil=this.runSeconds+m:typeof m=="number"&&m<=0&&(this.calmUntil=null)}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0)}computeNextInterval(a){const s=a.cadenceTarget*this.cadenceScale,r=Math.pow(this.spawnCycles+1,.6)*.018*this.pressureScale,l=1+Math.min(4,r),u=s/l,f=this.interval*this.cadenceDecay,h=Math.min(f,u);return Math.max(this.cadenceFloor,h)}computeMultiplier(a){const s=1+this.spawnCycles*this.multiplierGrowth*this.pressureScale,r=1+a.stageIndex*.15,l=a.multiplierBase*s*r*this.multiplierScale;return Math.min(16,Math.max(1,l))}countActiveEnemies(a){return a.filter(s=>s.faction===this.factionId&&!s.isDead()).length}getAvailableSlots(a){return cx-this.countActiveEnemies(a)}trackClears(a){if(a<=0){this.boardEmpty||(this.clearCount+=1,this.lastClearAt=this.runSeconds),this.boardEmpty=!0;return}this.boardEmpty=!1}}function iA(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(t){return console.warn("Structured telemetry storage unavailable",t),null}}function sA(t,a){const s={event:t,timestamp:Date.now(),payload:{...a}};return console.info(t,s),s}function rA(t,a,s={}){const r=iA();if(!r)return;const l=Number.isFinite(s.limit)?Math.max(1,Math.trunc(s.limit??16)):16,f=[...am(t)??[],a].slice(-l);try{r.setItem(t,JSON.stringify(f))}catch(h){console.warn("Failed to persist structured telemetry",{storageKey:t,error:h})}}let Wy=-1,eb=-1,$f=null,Xf=0,Qf=0;const oA="telemetry:enemy-scaling:summaries";function lA(t,a={}){const s=t.rampStageIndex!==Wy,r=t.spawnCycles>=eb+10,l=t.lastClearAt!==null&&t.lastClearAt!==$f;if(!s&&!r&&!l)return;Wy=t.rampStageIndex,eb=t.spawnCycles,$f=t.lastClearAt??$f,Xf=Math.max(Xf,t.difficultyMultiplier);const u=Math.max(0,Math.round(t.calmSecondsRemaining*1e3));u>Qf&&(Qf=u);const f={stage:t.rampStageLabel,stageIndex:t.rampStageIndex,bundleTier:t.bundleTier,cadenceSeconds:Number(t.cadence.toFixed(2)),lastCadenceSeconds:Number(t.lastCadence.toFixed(2)),multiplier:Number(t.difficultyMultiplier.toFixed(2)),effectiveDifficulty:Number(t.effectiveDifficulty.toFixed(2)),aggressionMultiplier:Number(t.aggressionMultiplier.toFixed(2)),cadenceMultiplier:Number(t.cadenceMultiplier.toFixed(2)),strengthMultiplier:Number(t.strengthMultiplier.toFixed(2)),pressureMultiplier:Number(t.pressureMultiplier.toFixed(2)),calmSecondsRemaining:Number(t.calmSecondsRemaining.toFixed(2)),runSeconds:Math.round(t.runSeconds),spawnCycles:t.spawnCycles,clears:t.clears,wipeSince:a.wipeSince??null,longestWipeMs:a.wipeDurationMs??0,peakMultiplier:Number(Xf.toFixed(2)),longestCalmMs:Qf},h=sA("enemy-scaling",f);rA(oA,h,{limit:24})}const Ih=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),cA=Object.freeze({artocoinBalance:0,ownedTierIds:Object.freeze(new Set)}),uA={default:"Included with the sauna key",artocoin:"Invest artocoins"},xm=Object.freeze([{id:"ember-circuit",name:"Primitive Smoke Sauna",rosterCap:3,description:"Soot-softened benches inside the Primitive Smoke Sauna shelter a loyal trio of attendants.",art:{badge:d2,glow:"linear-gradient(145deg, rgba(255,161,76,0.65), rgba(255,226,173,0.18))"},visionRange:4,unlock:{type:"default",label:"Included with the Primitive Smoke Sauna key"}},{id:"aurora-ward",name:"Modern Wooden Sauna",rosterCap:4,description:"Polished timber and copper buckets in the Modern Wooden Sauna rally a quartet ready for sieges.",art:{badge:c2,glow:"linear-gradient(140deg, rgba(128,208,255,0.7), rgba(61,184,255,0.2))"},visionRange:10,unlock:{type:"artocoin",cost:150,label:"Commission the Modern Wooden Sauna for 150 artocoins"}},{id:"mythic-conclave",name:"Futuristic Fission Sauna",rosterCap:6,description:"Iridescent shielding and fission-driven lyly crown the Futuristic Fission Sauna with six guardians.",art:{badge:u2,glow:"linear-gradient(135deg, rgba(176,106,255,0.72), rgba(245,199,255,0.2))"},visionRange:20,unlock:{type:"artocoin",cost:275,label:"Fund the Futuristic Fission Sauna with 275 artocoins"}}]),dr=xm[0].id,Kf=new Map(xm.map(t=>[t.id,t]));function Am(){return xm}function xn(t){return t&&Kf.has(t)?Kf.get(t):Kf.get(dr)}function dA(t,a,s){if(!Number.isFinite(t))return a;const r=Math.max(a,Math.min(s,t));return Number.isNaN(r)?a:r}function tb(t){if(t.label)return t.label;const a=uA[t.type];if(!a)return"";if(t.type==="artocoin"){const s=Math.max(0,Math.floor(Number.isFinite(t.cost)?t.cost:0));if(s>0)return`${a} ${Ih.format(s)}`}return a}function as(t,a){const s=a??cA,r=s.ownedTierIds,l=r instanceof Set?r:new Set(Array.isArray(r)?r:[]);if(t.unlock.type==="default")return{tier:t,unlocked:!0,owned:!0,affordable:!0,cost:null,progress:1,requirementLabel:tb(t.unlock)};if(t.unlock.type==="artocoin"){const u=Math.max(0,Math.floor(Number.isFinite(t.unlock.cost)?t.unlock.cost:0)),f=Math.max(0,Math.floor(Number.isFinite(s.artocoinBalance)?s.artocoinBalance:0)),h=l.has(t.id),m=f>=u,p=h,g=h||u===0?1:dA(f/u,0,1),b=Math.max(0,u-f),v=Ih.format(u),S=b>0?Ih.format(b):null;let E;if(h)E=`Roster cap ${t.rosterCap}`;else{const T=t.unlock.label??`Invest ${v} artocoins`;S?E=`${T}  Need ${S} more`:u>0?E=`${T}  Ready to unlock`:E=T}return{tier:t,unlocked:p,owned:h,affordable:m,cost:u,progress:g,requirementLabel:E}}return{tier:t,unlocked:!1,owned:!1,affordable:!1,cost:null,progress:0,requirementLabel:tb(t.unlock)}}const nb=["hud-grid","grid","grid-rows-[64px_1fr_80px]","grid-cols-[280px_1fr_clamp(260px,32vw,420px)]","gap-[clamp(16px,3vw,28px)]"],ab={top:["col-span-3","row-span-1","row-start-1"],left:["col-start-1","row-start-2","row-span-1"],content:["col-start-2","row-start-2","row-span-1"],right:["col-start-3","row-start-2","row-span-1"],bottom:["col-span-3","row-start-3","row-span-1"]};function fA(t,a){let s=t.querySelector("[data-hud-root]");return s||(s=a.createElement("div"),s.dataset.hudRoot="true",s.className="hud-layout-root",t.prepend(s)),s}function ho(t,a,s,r){let l=t.querySelector(`[data-hud-region="${s}"]`);return l||(l=a.createElement("div"),l.dataset.hudRegion=s,t.appendChild(l)),l.classList.add("hud-region",...r),l.parentElement!==t&&t.appendChild(l),l}function hA(t,a,s){if(s){t.classList.add(...nb);for(const[r,l]of Object.entries(ab))a[r].classList.add(...l)}else{t.classList.remove(...nb);for(const[r,l]of Object.entries(ab))a[r].classList.remove(...l)}}function fr(t){const a=t.ownerDocument??document,s=fA(t,a),r={top:ho(s,a,"top",["hud-top-row"]),left:ho(s,a,"left",["hud-actions"]),content:ho(s,a,"content",["hud-content"]),right:ho(s,a,"right",["hud-right-column"]),bottom:ho(s,a,"bottom",["hud-bottom-row"])};s.append(r.top,r.left,r.content,r.right,r.bottom);const l=t.dataset.hudVariant==="v2";if(hA(t,r,l),!l){const p=t.querySelector("#resource-bar");p&&p.parentElement!==r.right&&r.right.prepend(p)}const u=t.querySelector("#build-menu");u&&u.parentElement!==r.left&&r.left.appendChild(u);const f=t.querySelector("#build-id");f&&f.parentElement!==r.bottom&&r.bottom.appendChild(f);let h=t.querySelector(".hud-mobile-bar__tray"),m=h?.closest(".hud-mobile-bar")??null;return(!h||!m)&&(m=a.createElement("div"),m.className="hud-mobile-bar",h=a.createElement("div"),h.className="hud-mobile-bar__tray",m.appendChild(h)),m.parentElement!==r.bottom&&r.bottom.appendChild(m),{root:s,regions:r,actions:r.left,side:r.right,mobileBar:h}}const ib=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function mA(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const r=document.createElement("div");r.classList.add("sauna-control"),r.dataset.tutorialTarget="heat";const l=()=>{const fe=a.getActiveTierId?.();return xn(fe??dr).id},u=()=>a.getTierContext?.()??null,f=document.createElement("button");f.type="button",f.textContent="Sauna ",f.classList.add("topbar-button","sauna-toggle"),f.setAttribute("aria-expanded","false"),r.appendChild(f);const h=document.createElement("div");h.classList.add("sauna-card","hud-card"),h.hidden=!0;const m=document.createElement("section");m.classList.add("sauna-health"),m.dataset.tutorialTarget="sauna-integrity";const p=`sauna-health-label-${Math.floor(Math.random()*1e5)}`,g=document.createElement("div");g.classList.add("sauna-health__header");const b=document.createElement("span");b.id=p,b.classList.add("sauna-health__title"),b.textContent="Sauna Integrity",g.appendChild(b);const v=document.createElement("span");v.classList.add("sauna-health__value"),v.setAttribute("aria-live","polite"),g.appendChild(v),m.appendChild(g);const S=document.createElement("div");S.classList.add("sauna-health__bar"),S.setAttribute("role","meter"),S.setAttribute("aria-valuemin","0"),S.setAttribute("aria-labelledby",p);const E=document.createElement("div");E.classList.add("sauna-health__fill"),S.appendChild(E),m.appendChild(S);const T=document.createElement("div");T.classList.add("sauna-health__destruction"),T.hidden=!0,S.appendChild(T);const _=document.createElement("div");_.classList.add("sauna-progress");const R=document.createElement("div");R.classList.add("sauna-progress__fill"),_.appendChild(R),h.appendChild(m),h.appendChild(_);const U=Am(),B=new Map,V=document.createElement("section");V.classList.add("sauna-tier");const X=document.createElement("div");X.classList.add("sauna-tier__header");const $=document.createElement("span");$.classList.add("sauna-tier__title"),$.textContent="Premium Tiers",X.appendChild($);const W=document.createElement("p");W.classList.add("sauna-tier__subtitle"),W.textContent="Align the lyly with your prestige to unlock lavish benches and roster headroom.",X.appendChild(W),V.appendChild(X);const ne=document.createElement("div");ne.classList.add("sauna-tier__grid"),V.appendChild(ne);for(const fe of U){const _e=document.createElement("button");_e.type="button",_e.classList.add("sauna-tier__option"),_e.dataset.tierId=fe.id,_e.setAttribute("aria-pressed","false");const Ge=document.createElement("div");Ge.classList.add("sauna-tier__badge"),Ge.style.setProperty("--sauna-tier-badge-image",`url(${fe.art.badge})`),fe.art.glow&&Ge.style.setProperty("--sauna-tier-glow",fe.art.glow),_e.appendChild(Ge);const ze=document.createElement("div");ze.classList.add("sauna-tier__copy"),_e.appendChild(ze);const vt=document.createElement("span");vt.classList.add("sauna-tier__name"),vt.textContent=fe.name,ze.appendChild(vt);const fn=document.createElement("span");fn.classList.add("sauna-tier__cap"),fn.textContent=`Cap ${fe.rosterCap}`,ze.appendChild(fn);const Zt=document.createElement("p");Zt.classList.add("sauna-tier__description"),Zt.textContent=fe.description,ze.appendChild(Zt);const wn=document.createElement("div");wn.classList.add("sauna-tier__progress");const ca=document.createElement("div");ca.classList.add("sauna-tier__progress-fill"),wn.appendChild(ca);const Qe=document.createElement("span");Qe.classList.add("sauna-tier__progress-label"),wn.appendChild(Qe),ze.appendChild(wn);const Pe=document.createElement("span");Pe.classList.add("sauna-tier__requirement"),ze.appendChild(Pe);const Vt={tier:fe,button:_e,fill:ca,progressLabel:Qe,requirement:Pe,handleClick:()=>{x(fe,Vt)}};_e.addEventListener("click",Vt.handleClick),B.set(fe.id,Vt),ne.appendChild(_e)}h.appendChild(V),ee();const Y=document.createElement("label");Y.classList.add("sauna-option");const q=document.createElement("input");q.type="checkbox",q.classList.add("sauna-option__input"),q.checked=t.rallyToFront,q.addEventListener("change",()=>{t.rallyToFront=q.checked}),Y.appendChild(q);const C=document.createElement("span");C.textContent="Rally to Front",C.classList.add("sauna-option__label"),Y.appendChild(C),h.appendChild(Y),r.appendChild(h);const{regions:J}=fr(s),H=J.top,ae=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null;let F=!!ae?.matches;const D=(fe,_e)=>{typeof fe.addEventListener=="function"?fe.addEventListener("change",_e):typeof fe.addListener=="function"&&fe.addListener(_e)},P=(fe,_e)=>{typeof fe.removeEventListener=="function"?fe.removeEventListener("change",_e):typeof fe.removeListener=="function"&&fe.removeListener(_e)},le=fe=>{F=!!fe.matches,m.dataset.motion=F?"reduced":"full"};m.dataset.motion=F?"reduced":"full",ae&&D(ae,le);function ee(){const fe=l(),_e=u();for(const Ge of B.values()){const ze=as(Ge.tier,_e),vt=Math.round(Math.max(0,Math.min(ze.progress,1))*100);Ge.fill.style.width=`${vt}%`,Ge.progressLabel.textContent=ze.unlocked?"Unlocked":`${vt}% ready`,Ge.requirement.textContent=ze.unlocked?`Roster cap ${Ge.tier.rosterCap}`:ze.requirementLabel,Ge.button.dataset.state=ze.unlocked?Ge.tier.id===fe?"active":"available":"locked",Ge.button.setAttribute("aria-pressed",Ge.tier.id===fe?"true":"false"),Ge.button.setAttribute("aria-disabled",ze.unlocked?"false":"true")}}function x(fe,_e){if(!as(fe,u()).unlocked){_e.button.classList.remove("sauna-tier__option--denied"),_e.button.offsetWidth,_e.button.classList.add("sauna-tier__option--denied");return}a.setActiveTierId?.(fe.id,{persist:!0}),ee()}const A=()=>{r.parentElement!==H&&H.appendChild(r);const fe=H.querySelector("#topbar");return fe&&fe.parentElement===H?(fe.nextSibling!==r&&H.insertBefore(r,fe.nextSibling),!0):!1};let z=null;A()||(z=new MutationObserver(()=>{A()&&z?.disconnect()}),z.observe(H,{childList:!0}));const Q=()=>{const fe=!h.hidden;h.hidden=fe,f.setAttribute("aria-expanded",String(!fe))};f.addEventListener("click",Q);const oe=()=>{const fe=Math.max(1,Math.floor(t.maxHealth)),_e=Math.max(0,Math.min(fe,Math.floor(Number.isFinite(t.health)?t.health:0))),Ge=fe>0?_e/fe:0,ze=Math.max(0,Math.min(Ge,1));E.style.width=`${ze*100}%`;const vt=ib.format(_e),fn=ib.format(fe);v.textContent=`${vt} / ${fn}`,S.setAttribute("aria-valuenow",String(_e)),S.setAttribute("aria-valuemax",String(fe)),S.setAttribute("aria-valuetext",`${vt} of ${fn} health`);const Zt=t.destroyed?"offline":ze<=.2?"critical":ze<=.55?"warning":"stable";S.dataset.level=Zt,v.dataset.state=Zt,m.dataset.state=t.destroyed?"destroyed":"active"},de=()=>{T.classList.remove("sauna-health__destruction--active"),T.hidden=!0};let ue=null,ve=null;const ge=()=>{ue!==null&&(window.clearTimeout(ue),ue=null),S.classList.remove("sauna-health__bar--impact")},et=()=>{E.classList.remove("sauna-health__fill--damage")};E.addEventListener("animationend",et);const Ut=()=>{de()};T.addEventListener("animationend",Ut);const Ot=()=>{ge(),S.classList.add("sauna-health__bar--impact"),F||(E.classList.remove("sauna-health__fill--damage"),E.offsetWidth,E.classList.add("sauna-health__fill--damage")),ue=window.setTimeout(()=>{S.classList.remove("sauna-health__bar--impact"),ue=null},F?360:560)},An=()=>{ve!==null&&(window.clearTimeout(ve),ve=null),T.hidden=!1,T.classList.remove("sauna-health__destruction--active"),T.offsetWidth,T.classList.add("sauna-health__destruction--active"),ve=window.setTimeout(()=>{de(),ve=null},F?720:1100)},Bn=()=>{oe();const fe=t.playerSpawnCooldown>0?t.playerSpawnCooldown:1,_e=1-t.playerSpawnTimer/fe;R.style.width=`${Math.max(0,Math.min(_e,1))*100}%`,q.checked=t.rallyToFront,ee()};return oe(),{update:Bn,handleDamage:fe=>{oe(),Ot()},handleDestroyed:fe=>{h.hidden=!1,f.setAttribute("aria-expanded","true"),oe(),Ot(),An()},dispose:()=>{z?.disconnect(),z=null,f.removeEventListener("click",Q),ae&&P(ae,le),E.removeEventListener("animationend",et),T.removeEventListener("animationend",Ut),ge(),ve!==null&&(window.clearTimeout(ve),ve=null),de();for(const fe of B.values())fe.button.removeEventListener("click",fe.handleClick);B.clear(),r.remove()}}}const Uh="progression:artocoinBalance",Sn=0,Oh=new Set,sb=Object.freeze({"ember-circuit":{tierId:"ember-circuit",nextUnlockLabel:"Modern Wooden Sauna commission",unlockCost:150,baselinePayout:60,baselineDurationMinutes:12.5,baselineKills:150,baselineTiles:85},"aurora-ward":{tierId:"aurora-ward",nextUnlockLabel:"Futuristic Fission Sauna ignition",unlockCost:210,baselinePayout:84,baselineDurationMinutes:12,baselineKills:190,baselineTiles:100},"mythic-conclave":{tierId:"mythic-conclave",nextUnlockLabel:"Futuristic Fission Sauna prestige rotation",unlockCost:275,baselinePayout:110,baselineDurationMinutes:11.5,baselineKills:230,baselineTiles:115}}),Pf=Object.freeze([{minScalar:0,maxScalar:.95,multiplier:.85},{minScalar:.95,maxScalar:1.1,multiplier:1},{minScalar:1.1,maxScalar:1.3,multiplier:1.18},{minScalar:1.3,maxScalar:1.5,multiplier:1.32},{minScalar:1.5,multiplier:1.42,bonusPerStage:.03,maxMultiplier:1.58}]);function Y2(){try{const t=globalThis;return t.localStorage?t.localStorage:t.window?.localStorage?t.window.localStorage:null}catch(t){return console.warn("Local storage unavailable for artocoin progression",t),null}}function pA(t){for(const a of Oh)try{a(t)}catch(s){console.warn("Artocoin listener failure",s)}}function F2(t){return Oh.add(t),()=>{Oh.delete(t)}}function To(t){const a=Number(t);return!Number.isFinite(a)||a<0?Sn:Math.min(Number.MAX_SAFE_INTEGER,Math.floor(a))}function gA(t){if(!t)return Sn;const a=t.artocoins??t.artocoinBalance,s=To(a);return"artocoins"in t&&delete t.artocoins,"artocoinBalance"in t&&delete t.artocoinBalance,s}function yA(t){const a=t.getItem(Hc);if(!a)return Sn;try{const s=JSON.parse(a);if(!s||typeof s!="object")return Sn;const r=s,l=gA(r);try{t.setItem(Hc,JSON.stringify(r))}catch(u){console.warn("Failed to persist migrated NG+ state without artocoins",u)}return l}catch(s){return console.warn("Failed to parse legacy NG+ state during artocoin migration",s),Sn}}function is(){const t=Y2();if(!t)return Sn;const a=t.getItem(Uh);if(a!==null){const r=To(a);return r!==Sn?r:Sn}const s=yA(t);return s!==Sn?(wm(s,{reason:"migration",previousBalance:Sn}),s):Sn}function wm(t,a={}){const s=Y2(),r=To(t);let l=typeof a.previousBalance=="number"?To(a.previousBalance):Sn;if(s){if(typeof a.previousBalance!="number")try{const u=s.getItem(Uh);u!==null&&(l=To(u))}catch(u){console.warn("Failed to read previous artocoin balance",u)}try{s.setItem(Uh,r.toString())}catch(u){console.warn("Failed to persist artocoin balance",u)}}if(!a.silent){const u=r-l;pA({balance:r,delta:u,reason:a.reason??"set",metadata:a.metadata})}}function bA(t,a={}){const s=Math.max(0,Math.floor(Number.isFinite(t)?t:0));if(s===0)return is();const r=is(),l=Math.min(Number.MAX_SAFE_INTEGER,r+s);return wm(l,{...a,previousBalance:r,reason:a.reason??"payout"}),l}function vA(t,a={}){const s=Math.max(0,Math.floor(Number.isFinite(t)?t:0)),r=is();if(s===0)return{success:!0,balance:r};if(r<s)return{success:!1,balance:r,shortfall:s-r};const l=r-s;return wm(l,{...a,previousBalance:r,reason:a.reason??"purchase"}),{success:!0,balance:l}}function Uc(t,a,s){if(!Number.isFinite(s)||t===a||t>a)return t;const r=Math.max(t,Math.min(a,s));return Number.isNaN(r)?t:r}function SA(t){return Uc(0,1,t)}function V2(t,a){const s=Number.isFinite(t)?t:1,r=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;for(const l of Pf){const u=typeof l.maxScalar=="number"?s<l.maxScalar:!0;if(s>=l.minScalar&&u){if(l.bonusPerStage&&l.maxMultiplier){const h=Math.max(0,r-4)*l.bonusPerStage,m=l.multiplier+h;return Math.min(l.maxMultiplier,m)}return l.multiplier}}return Pf[Pf.length-1]?.multiplier??1}function $2(t){return sb[t]??sb["ember-circuit"]}function MA(t){const a=$2(t.tierId),s=a.baselinePayout,r=Number.isFinite(t.runSeconds)?t.runSeconds/60:0,l=a.baselineDurationMinutes,u=Uc(.75,1.2,1+(l-r)/l*.35),f=Uc(.6,1.45,t.enemyKills/a.baselineKills),h=Uc(.7,1.25,t.tilesExplored/a.baselineTiles),m=u*.3+f*.45+h*.25,p=1,g=V2(t.difficultyScalar,t.rampStageIndex);return{artocoins:Math.round(s*m*g),breakdown:{baseline:s,performanceMultiplier:m,lossPenalty:p,difficultyMultiplier:g}}}function EA(t){const a=$2(t.tierId),s=a.baselinePayout,r=V2(t.difficultyScalar,t.rampStageIndex),l=s*.2*r,u=t.runSeconds/(a.baselineDurationMinutes*60),f=t.enemyKills/a.baselineKills,h=SA(.5*u+.5*f),m=s*.45*h*r;return{artocoins:Math.round(Math.max(l,m)),breakdown:{baseline:s,performanceMultiplier:m/s,lossPenalty:1,difficultyMultiplier:r}}}function xA(t,a){return t==="win"?MA(a):EA(a)}function $s(t,a={}){const{iconSrc:s,description:r,srLabel:l}=a,u=document.createElement("div");if(u.classList.add("topbar-badge"),u.setAttribute("role","status"),u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),s){const b=document.createElement("img");b.src=s,b.alt=t,b.decoding="async",b.classList.add("topbar-badge-icon"),u.appendChild(b)}const f=document.createElement("div");f.classList.add("badge-text");const h=document.createElement("span");h.textContent=t,h.classList.add("badge-label"),f.appendChild(h);const m=document.createElement("span");m.textContent="0",m.classList.add("badge-value"),m.setAttribute("aria-hidden","true"),f.appendChild(m);const p=document.createElement("span");p.classList.add("badge-delta"),p.style.opacity="0",p.style.transform="translateY(-6px)",p.style.transition="opacity 0.5s ease, transform 0.5s ease",p.setAttribute("aria-hidden","true"),u.append(f,p),r&&(u.title=r);const g=l??t;return u.dataset.label=g,u.setAttribute("aria-label",`${g}: 0`),{container:u,value:m,delta:p,label:g}}function AA(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const{regions:r}=fr(s),l=r.top,u=document.createElement("div");u.id="topbar",l.prepend(u);const f=document.createElement("div");f.className="topbar-badge-row",u.appendChild(f);const h={[re.SAUNA_BEER]:"Sauna beer bottles chilled for construction crews and eager recruits.",[re.SAUNAKUNNIA]:"Saunakunniaprestige earned from sauna rituals and triumphant battles.",[re.SISU]:"Sisuthe relentless grit forged when your warriors triumph on the snow."},m=$s("Sauna Beer",{iconSrc:a.saunaBeer,description:h[re.SAUNA_BEER],srLabel:"Sauna beer reserves"});m.container.classList.add("badge-sauna-beer");const p=$s("Sisu",{iconSrc:a.sisu,description:h[re.SISU],srLabel:"Sisu reserves"});p.container.classList.add("badge-sisu"),p.container.dataset.tutorialTarget="sisu";const g=$s("Saunakunnia",{iconSrc:a.saunakunnia,description:h[re.SAUNAKUNNIA],srLabel:"Saunakunnia"});g.container.classList.add("badge-sauna"),g.container.dataset.tutorialTarget="victory";const b=$s("Artocoins",{iconSrc:a.artocoin,description:"Artocoin treasury minted from triumphant campaigns.",srLabel:"Artocoin balance"});b.container.classList.add("badge-artocoin");const v=$s("Time");v.container.classList.add("badge-time"),v.delta.style.display="none";const S=$s("Enemy Ramp",{srLabel:"Enemy ramp intensity"});S.container.classList.add("badge-ramp"),S.delta.style.display="none",S.container.dataset.tutorialTarget="enemy-ramp",S.container.title="Enemy ramp intensity and cadence.",f.appendChild(m.container),f.appendChild(p.container),f.appendChild(g.container),f.appendChild(b.container),f.appendChild(S.container),f.appendChild(v.container);const E=new Intl.NumberFormat("en-US"),T=new Intl.NumberFormat("en-US",{signDisplay:"exceptZero"}),_={[re.SAUNA_BEER]:"Sauna Beer",[re.SAUNAKUNNIA]:"Saunakunnia",[re.SISU]:"Sisu"},R={[re.SAUNA_BEER]:{singular:"bottle",plural:"bottles"},[re.SAUNAKUNNIA]:{singular:"Saunakunnia",plural:"Saunakunnia"},[re.SISU]:{singular:"Sisu",plural:"Sisu"}},U={[re.SAUNA_BEER]:"",[re.SAUNAKUNNIA]:"",[re.SISU]:""},B={[re.SAUNA_BEER]:m,[re.SAUNAKUNNIA]:g,[re.SISU]:p},V={};let X=is(),$=null,W=null;function ne(ee){if(W=ee,!ee){S.value.textContent="Stage 1  1.00",S.delta.textContent="",S.delta.style.display="none",S.container.dataset.state="idle",S.container.title="Enemy ramp idle",S.container.setAttribute("aria-label","Enemy ramp idle.");return}const x=ee.stage||`Stage ${ee.stageIndex+1}`,A=`${ee.multiplier.toFixed(2)}`,z=`${ee.cadenceSeconds.toFixed(2)}s cadence`,Q=`${ee.effectiveDifficulty.toFixed(2)}`,oe=ee.calmSecondsRemaining>.05,de=oe?`Calm remaining: ${Math.ceil(ee.calmSecondsRemaining)}s`:"Calm inactive";S.value.textContent=`${x}  ${A}`,S.delta.style.display=oe?"":"none",S.delta.textContent=oe?`Calm ${Math.ceil(ee.calmSecondsRemaining)}s`:"",S.container.dataset.state=oe?"calm":"active",S.container.title=[`Stage: ${x} (Tier ${ee.bundleTier})`,`Cadence: ${z}`,`Multiplier: ${A}`,`Difficulty: ${Q}`,`Aggression ${ee.aggressionMultiplier.toFixed(2)}  Cadence ${ee.cadenceMultiplier.toFixed(2)}  Strength ${ee.strengthMultiplier.toFixed(2)}`,de,`Spawn cycles: ${ee.spawnCycles}`].join(`
`),S.container.setAttribute("aria-label",[`Enemy ramp ${x}`,`Multiplier ${A}`,`Cadence ${ee.cadenceSeconds.toFixed(2)} seconds`,`Difficulty ${Q}`,oe?`Calm remaining ${Math.ceil(ee.calmSecondsRemaining)} seconds`:"Calm inactive"].join("  "))}function Y(ee,x){const A=Number.isFinite(x)?x:0;return ee===re.SAUNA_BEER?Math.trunc(A):Math.max(0,Math.round(A))}function q(ee,x){return E.format(Y(ee,x))}function C(ee,x){return x===0?"":`${T.format(x)}${U[ee]}`}function J(ee,x){if(x===0)return"";const A=x>0?"gained":"spent",z=E.format(Math.abs(x)),Q=R[ee];if(Q){const de=Math.abs(x)===1?Q.singular:Q.plural,ue=_[ee],ve=[ue];de&&de!==ue&&ve.push(de);const ge=ve.filter(Boolean).join(" ");return`${A} ${z}${ge?` ${ge}`:""}`}const oe=_[ee];return`${A} ${z}${oe?` ${oe}`:""}`}function H(ee,x,A=0){const z=B[ee];if(!z)return;const Q=Y(ee,x),oe=q(ee,x);z.value.textContent=oe;const de=ee===re.SAUNA_BEER&&Q<0;if(z.container.classList.toggle("topbar-badge--debt",de),A!==0){z.delta.textContent=C(ee,A),z.delta.style.opacity="1",z.delta.style.transform="translateY(0)";const ge=V[ee];ge&&clearTimeout(ge),V[ee]=setTimeout(()=>{z.delta.style.opacity="0",z.delta.style.transform="translateY(-6px)",delete V[ee]},1e3)}else z.delta.textContent="",z.delta.style.opacity="0",z.delta.style.transform="translateY(-6px)";const ue=J(ee,A),ve=[`${z.label} ${oe}`];if(de){const ge=E.format(Math.abs(Q)),et=R[ee];if(et){const Ut=Math.abs(Q)===1?et.singular:et.plural,Ot=Ut&&Ut!==_[ee];ve.push(Ot?`Debt of ${ge} ${Ut}`:`Debt of ${ge}`)}else ve.push(`Debt of ${ge}`)}ue&&ve.push(ue),z.container.setAttribute("aria-label",ve.join("  "))}function ae(ee,x=0){X=Math.max(0,Math.floor(Number.isFinite(ee)?ee:0));const A=E.format(X);b.value.textContent=A,x!==0?(b.delta.textContent=`${T.format(x)}`,b.delta.style.opacity="1",b.delta.style.transform="translateY(0)",$&&clearTimeout($),$=setTimeout(()=>{b.delta.style.opacity="0",b.delta.style.transform="translateY(-6px)",$=null},1e3)):(b.delta.textContent="",b.delta.style.opacity="0",b.delta.style.transform="translateY(-6px)");const z=x===0?"":x>0?`Gained ${E.format(x)} artocoins`:`Spent ${E.format(Math.abs(x))} artocoins`,Q=[`${b.label} ${A}`];z&&Q.push(z),b.container.setAttribute("aria-label",Q.join("  "))}H(re.SAUNA_BEER,t.getResource(re.SAUNA_BEER)),H(re.SAUNAKUNNIA,t.getResource(re.SAUNAKUNNIA)),H(re.SISU,t.getResource(re.SISU)),ae(X),ne(W);const F=({resource:ee,amount:x,total:A})=>{B[ee]&&H(ee,A,x)};se.on("resourceChanged",F);const P=F2(ee=>{ae(ee.balance,ee.delta)});let le=0;return{update(ee){le+=ee;const x=Math.floor(le/1e3),A=Math.floor(x/60),z=x%60;v.value.textContent=`${A}:${z.toString().padStart(2,"0")}`},setEnemyRampSummary(ee){ne(ee)},dispose(){se.off("resourceChanged",F),Object.values(V).forEach(ee=>{ee&&clearTimeout(ee)}),$&&clearTimeout($),P(),u.remove()}}}var Zf={exports:{}},mo={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rb;function wA(){if(rb)return mo;rb=1;var t=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function s(r,l,u){var f=null;if(u!==void 0&&(f=""+u),l.key!==void 0&&(f=""+l.key),"key"in l){u={};for(var h in l)h!=="key"&&(u[h]=l[h])}else u=l;return l=u.ref,{$$typeof:t,type:r,key:f,ref:l!==void 0?l:null,props:u}}return mo.Fragment=a,mo.jsx=s,mo.jsxs=s,mo}var ob;function CA(){return ob||(ob=1,Zf.exports=wA()),Zf.exports}var Pt=CA(),Jf={exports:{}},po={},Wf={exports:{}},eh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lb;function TA(){return lb||(lb=1,(function(t){function a(D,P){var le=D.length;D.push(P);e:for(;0<le;){var ee=le-1>>>1,x=D[ee];if(0<l(x,P))D[ee]=P,D[le]=x,le=ee;else break e}}function s(D){return D.length===0?null:D[0]}function r(D){if(D.length===0)return null;var P=D[0],le=D.pop();if(le!==P){D[0]=le;e:for(var ee=0,x=D.length,A=x>>>1;ee<A;){var z=2*(ee+1)-1,Q=D[z],oe=z+1,de=D[oe];if(0>l(Q,le))oe<x&&0>l(de,Q)?(D[ee]=de,D[oe]=le,ee=oe):(D[ee]=Q,D[z]=le,ee=z);else if(oe<x&&0>l(de,le))D[ee]=de,D[oe]=le,ee=oe;else break e}}return P}function l(D,P){var le=D.sortIndex-P.sortIndex;return le!==0?le:D.id-P.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var f=Date,h=f.now();t.unstable_now=function(){return f.now()-h}}var m=[],p=[],g=1,b=null,v=3,S=!1,E=!1,T=!1,_=!1,R=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function V(D){for(var P=s(p);P!==null;){if(P.callback===null)r(p);else if(P.startTime<=D)r(p),P.sortIndex=P.expirationTime,a(m,P);else break;P=s(p)}}function X(D){if(T=!1,V(D),!E)if(s(m)!==null)E=!0,$||($=!0,J());else{var P=s(p);P!==null&&F(X,P.startTime-D)}}var $=!1,W=-1,ne=5,Y=-1;function q(){return _?!0:!(t.unstable_now()-Y<ne)}function C(){if(_=!1,$){var D=t.unstable_now();Y=D;var P=!0;try{e:{E=!1,T&&(T=!1,U(W),W=-1),S=!0;var le=v;try{t:{for(V(D),b=s(m);b!==null&&!(b.expirationTime>D&&q());){var ee=b.callback;if(typeof ee=="function"){b.callback=null,v=b.priorityLevel;var x=ee(b.expirationTime<=D);if(D=t.unstable_now(),typeof x=="function"){b.callback=x,V(D),P=!0;break t}b===s(m)&&r(m),V(D)}else r(m);b=s(m)}if(b!==null)P=!0;else{var A=s(p);A!==null&&F(X,A.startTime-D),P=!1}}break e}finally{b=null,v=le,S=!1}P=void 0}}finally{P?J():$=!1}}}var J;if(typeof B=="function")J=function(){B(C)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,ae=H.port2;H.port1.onmessage=C,J=function(){ae.postMessage(null)}}else J=function(){R(C,0)};function F(D,P){W=R(function(){D(t.unstable_now())},P)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(D){D.callback=null},t.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<D?Math.floor(1e3/D):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(D){switch(v){case 1:case 2:case 3:var P=3;break;default:P=v}var le=v;v=P;try{return D()}finally{v=le}},t.unstable_requestPaint=function(){_=!0},t.unstable_runWithPriority=function(D,P){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var le=v;v=D;try{return P()}finally{v=le}},t.unstable_scheduleCallback=function(D,P,le){var ee=t.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?ee+le:ee):le=ee,D){case 1:var x=-1;break;case 2:x=250;break;case 5:x=1073741823;break;case 4:x=1e4;break;default:x=5e3}return x=le+x,D={id:g++,callback:P,priorityLevel:D,startTime:le,expirationTime:x,sortIndex:-1},le>ee?(D.sortIndex=le,a(p,D),s(m)===null&&D===s(p)&&(T?(U(W),W=-1):T=!0,F(X,le-ee))):(D.sortIndex=x,a(m,D),E||S||(E=!0,$||($=!0,J()))),D},t.unstable_shouldYield=q,t.unstable_wrapCallback=function(D){var P=v;return function(){var le=v;v=P;try{return D.apply(this,arguments)}finally{v=le}}}})(eh)),eh}var cb;function _A(){return cb||(cb=1,Wf.exports=TA()),Wf.exports}var th={exports:{}},Me={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ub;function NA(){if(ub)return Me;ub=1;var t=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),b=Symbol.iterator;function v(x){return x===null||typeof x!="object"?null:(x=b&&x[b]||x["@@iterator"],typeof x=="function"?x:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,T={};function _(x,A,z){this.props=x,this.context=A,this.refs=T,this.updater=z||S}_.prototype.isReactComponent={},_.prototype.setState=function(x,A){if(typeof x!="object"&&typeof x!="function"&&x!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,x,A,"setState")},_.prototype.forceUpdate=function(x){this.updater.enqueueForceUpdate(this,x,"forceUpdate")};function R(){}R.prototype=_.prototype;function U(x,A,z){this.props=x,this.context=A,this.refs=T,this.updater=z||S}var B=U.prototype=new R;B.constructor=U,E(B,_.prototype),B.isPureReactComponent=!0;var V=Array.isArray,X={H:null,A:null,T:null,S:null,V:null},$=Object.prototype.hasOwnProperty;function W(x,A,z,Q,oe,de){return z=de.ref,{$$typeof:t,type:x,key:A,ref:z!==void 0?z:null,props:de}}function ne(x,A){return W(x.type,A,void 0,void 0,void 0,x.props)}function Y(x){return typeof x=="object"&&x!==null&&x.$$typeof===t}function q(x){var A={"=":"=0",":":"=2"};return"$"+x.replace(/[=:]/g,function(z){return A[z]})}var C=/\/+/g;function J(x,A){return typeof x=="object"&&x!==null&&x.key!=null?q(""+x.key):A.toString(36)}function H(){}function ae(x){switch(x.status){case"fulfilled":return x.value;case"rejected":throw x.reason;default:switch(typeof x.status=="string"?x.then(H,H):(x.status="pending",x.then(function(A){x.status==="pending"&&(x.status="fulfilled",x.value=A)},function(A){x.status==="pending"&&(x.status="rejected",x.reason=A)})),x.status){case"fulfilled":return x.value;case"rejected":throw x.reason}}throw x}function F(x,A,z,Q,oe){var de=typeof x;(de==="undefined"||de==="boolean")&&(x=null);var ue=!1;if(x===null)ue=!0;else switch(de){case"bigint":case"string":case"number":ue=!0;break;case"object":switch(x.$$typeof){case t:case a:ue=!0;break;case g:return ue=x._init,F(ue(x._payload),A,z,Q,oe)}}if(ue)return oe=oe(x),ue=Q===""?"."+J(x,0):Q,V(oe)?(z="",ue!=null&&(z=ue.replace(C,"$&/")+"/"),F(oe,A,z,"",function(et){return et})):oe!=null&&(Y(oe)&&(oe=ne(oe,z+(oe.key==null||x&&x.key===oe.key?"":(""+oe.key).replace(C,"$&/")+"/")+ue)),A.push(oe)),1;ue=0;var ve=Q===""?".":Q+":";if(V(x))for(var ge=0;ge<x.length;ge++)Q=x[ge],de=ve+J(Q,ge),ue+=F(Q,A,z,de,oe);else if(ge=v(x),typeof ge=="function")for(x=ge.call(x),ge=0;!(Q=x.next()).done;)Q=Q.value,de=ve+J(Q,ge++),ue+=F(Q,A,z,de,oe);else if(de==="object"){if(typeof x.then=="function")return F(ae(x),A,z,Q,oe);throw A=String(x),Error("Objects are not valid as a React child (found: "+(A==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":A)+"). If you meant to render a collection of children, use an array instead.")}return ue}function D(x,A,z){if(x==null)return x;var Q=[],oe=0;return F(x,Q,"","",function(de){return A.call(z,de,oe++)}),Q}function P(x){if(x._status===-1){var A=x._result;A=A(),A.then(function(z){(x._status===0||x._status===-1)&&(x._status=1,x._result=z)},function(z){(x._status===0||x._status===-1)&&(x._status=2,x._result=z)}),x._status===-1&&(x._status=0,x._result=A)}if(x._status===1)return x._result.default;throw x._result}var le=typeof reportError=="function"?reportError:function(x){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var A=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof x=="object"&&x!==null&&typeof x.message=="string"?String(x.message):String(x),error:x});if(!window.dispatchEvent(A))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",x);return}console.error(x)};function ee(){}return Me.Children={map:D,forEach:function(x,A,z){D(x,function(){A.apply(this,arguments)},z)},count:function(x){var A=0;return D(x,function(){A++}),A},toArray:function(x){return D(x,function(A){return A})||[]},only:function(x){if(!Y(x))throw Error("React.Children.only expected to receive a single React element child.");return x}},Me.Component=_,Me.Fragment=s,Me.Profiler=l,Me.PureComponent=U,Me.StrictMode=r,Me.Suspense=m,Me.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=X,Me.__COMPILER_RUNTIME={__proto__:null,c:function(x){return X.H.useMemoCache(x)}},Me.cache=function(x){return function(){return x.apply(null,arguments)}},Me.cloneElement=function(x,A,z){if(x==null)throw Error("The argument must be a React element, but you passed "+x+".");var Q=E({},x.props),oe=x.key,de=void 0;if(A!=null)for(ue in A.ref!==void 0&&(de=void 0),A.key!==void 0&&(oe=""+A.key),A)!$.call(A,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&A.ref===void 0||(Q[ue]=A[ue]);var ue=arguments.length-2;if(ue===1)Q.children=z;else if(1<ue){for(var ve=Array(ue),ge=0;ge<ue;ge++)ve[ge]=arguments[ge+2];Q.children=ve}return W(x.type,oe,void 0,void 0,de,Q)},Me.createContext=function(x){return x={$$typeof:f,_currentValue:x,_currentValue2:x,_threadCount:0,Provider:null,Consumer:null},x.Provider=x,x.Consumer={$$typeof:u,_context:x},x},Me.createElement=function(x,A,z){var Q,oe={},de=null;if(A!=null)for(Q in A.key!==void 0&&(de=""+A.key),A)$.call(A,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(oe[Q]=A[Q]);var ue=arguments.length-2;if(ue===1)oe.children=z;else if(1<ue){for(var ve=Array(ue),ge=0;ge<ue;ge++)ve[ge]=arguments[ge+2];oe.children=ve}if(x&&x.defaultProps)for(Q in ue=x.defaultProps,ue)oe[Q]===void 0&&(oe[Q]=ue[Q]);return W(x,de,void 0,void 0,null,oe)},Me.createRef=function(){return{current:null}},Me.forwardRef=function(x){return{$$typeof:h,render:x}},Me.isValidElement=Y,Me.lazy=function(x){return{$$typeof:g,_payload:{_status:-1,_result:x},_init:P}},Me.memo=function(x,A){return{$$typeof:p,type:x,compare:A===void 0?null:A}},Me.startTransition=function(x){var A=X.T,z={};X.T=z;try{var Q=x(),oe=X.S;oe!==null&&oe(z,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(ee,le)}catch(de){le(de)}finally{X.T=A}},Me.unstable_useCacheRefresh=function(){return X.H.useCacheRefresh()},Me.use=function(x){return X.H.use(x)},Me.useActionState=function(x,A,z){return X.H.useActionState(x,A,z)},Me.useCallback=function(x,A){return X.H.useCallback(x,A)},Me.useContext=function(x){return X.H.useContext(x)},Me.useDebugValue=function(){},Me.useDeferredValue=function(x,A){return X.H.useDeferredValue(x,A)},Me.useEffect=function(x,A,z){var Q=X.H;if(typeof z=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Q.useEffect(x,A)},Me.useId=function(){return X.H.useId()},Me.useImperativeHandle=function(x,A,z){return X.H.useImperativeHandle(x,A,z)},Me.useInsertionEffect=function(x,A){return X.H.useInsertionEffect(x,A)},Me.useLayoutEffect=function(x,A){return X.H.useLayoutEffect(x,A)},Me.useMemo=function(x,A){return X.H.useMemo(x,A)},Me.useOptimistic=function(x,A){return X.H.useOptimistic(x,A)},Me.useReducer=function(x,A,z){return X.H.useReducer(x,A,z)},Me.useRef=function(x){return X.H.useRef(x)},Me.useState=function(x){return X.H.useState(x)},Me.useSyncExternalStore=function(x,A,z){return X.H.useSyncExternalStore(x,A,z)},Me.useTransition=function(){return X.H.useTransition()},Me.version="19.1.1",Me}var db;function Cm(){return db||(db=1,th.exports=NA()),th.exports}var nh={exports:{}},Rt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fb;function RA(){if(fb)return Rt;fb=1;var t=Cm();function a(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var r={d:{f:s,r:function(){throw Error(a(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},l=Symbol.for("react.portal");function u(m,p,g){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:b==null?null:""+b,children:m,containerInfo:p,implementation:g}}var f=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Rt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Rt.createPortal=function(m,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(a(299));return u(m,p,null,g)},Rt.flushSync=function(m){var p=f.T,g=r.p;try{if(f.T=null,r.p=2,m)return m()}finally{f.T=p,r.p=g,r.d.f()}},Rt.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,r.d.C(m,p))},Rt.prefetchDNS=function(m){typeof m=="string"&&r.d.D(m)},Rt.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var g=p.as,b=h(g,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,S=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;g==="style"?r.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:b,integrity:v,fetchPriority:S}):g==="script"&&r.d.X(m,{crossOrigin:b,integrity:v,fetchPriority:S,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Rt.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var g=h(p.as,p.crossOrigin);r.d.M(m,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&r.d.M(m)},Rt.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var g=p.as,b=h(g,p.crossOrigin);r.d.L(m,g,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Rt.preloadModule=function(m,p){if(typeof m=="string")if(p){var g=h(p.as,p.crossOrigin);r.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else r.d.m(m)},Rt.requestFormReset=function(m){r.d.r(m)},Rt.unstable_batchedUpdates=function(m,p){return m(p)},Rt.useFormState=function(m,p,g){return f.H.useFormState(m,p,g)},Rt.useFormStatus=function(){return f.H.useHostTransitionStatus()},Rt.version="19.1.1",Rt}var hb;function kA(){if(hb)return nh.exports;hb=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(a){console.error(a)}}return t(),nh.exports=RA(),nh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mb;function LA(){if(mb)return po;mb=1;var t=_A(),a=Cm(),s=kA();function r(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)n+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var n=e,i=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(i=n.return),e=n.return;while(e)}return n.tag===3?i:null}function f(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(r(188))}function m(e){var n=e.alternate;if(!n){if(n=u(e),n===null)throw Error(r(188));return n!==e?null:e}for(var i=e,o=n;;){var c=i.return;if(c===null)break;var d=c.alternate;if(d===null){if(o=c.return,o!==null){i=o;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===i)return h(c),e;if(d===o)return h(c),n;d=d.sibling}throw Error(r(188))}if(i.return!==o.return)i=c,o=d;else{for(var y=!1,M=c.child;M;){if(M===i){y=!0,i=c,o=d;break}if(M===o){y=!0,o=c,i=d;break}M=M.sibling}if(!y){for(M=d.child;M;){if(M===i){y=!0,i=d,o=c;break}if(M===o){y=!0,o=d,i=c;break}M=M.sibling}if(!y)throw Error(r(189))}}if(i.alternate!==o)throw Error(r(190))}if(i.tag!==3)throw Error(r(188));return i.stateNode.current===i?e:n}function p(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=p(e),n!==null)return n;e=e.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),U=Symbol.for("react.consumer"),B=Symbol.for("react.context"),V=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),W=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),Y=Symbol.for("react.activity"),q=Symbol.for("react.memo_cache_sentinel"),C=Symbol.iterator;function J(e){return e===null||typeof e!="object"?null:(e=C&&e[C]||e["@@iterator"],typeof e=="function"?e:null)}var H=Symbol.for("react.client.reference");function ae(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===H?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case E:return"Fragment";case _:return"Profiler";case T:return"StrictMode";case X:return"Suspense";case $:return"SuspenseList";case Y:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case S:return"Portal";case B:return(e.displayName||"Context")+".Provider";case U:return(e._context.displayName||"Context")+".Consumer";case V:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case W:return n=e.displayName||null,n!==null?n:ae(e.type)||"Memo";case ne:n=e._payload,e=e._init;try{return ae(e(n))}catch{}}return null}var F=Array.isArray,D=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le={pending:!1,data:null,method:null,action:null},ee=[],x=-1;function A(e){return{current:e}}function z(e){0>x||(e.current=ee[x],ee[x]=null,x--)}function Q(e,n){x++,ee[x]=e.current,e.current=n}var oe=A(null),de=A(null),ue=A(null),ve=A(null);function ge(e,n){switch(Q(ue,n),Q(de,e),Q(oe,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?$g(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=$g(n),e=Xg(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}z(oe),Q(oe,e)}function et(){z(oe),z(de),z(ue)}function Ut(e){e.memoizedState!==null&&Q(ve,e);var n=oe.current,i=Xg(n,e.type);n!==i&&(Q(de,e),Q(oe,i))}function Ot(e){de.current===e&&(z(oe),z(de)),ve.current===e&&(z(ve),io._currentValue=le)}var An=Object.prototype.hasOwnProperty,Bn=t.unstable_scheduleCallback,ja=t.unstable_cancelCallback,la=t.unstable_shouldYield,dn=t.unstable_requestPaint,fe=t.unstable_now,_e=t.unstable_getCurrentPriorityLevel,Ge=t.unstable_ImmediatePriority,ze=t.unstable_UserBlockingPriority,vt=t.unstable_NormalPriority,fn=t.unstable_LowPriority,Zt=t.unstable_IdlePriority,wn=t.log,ca=t.unstable_setDisableYieldValue,Qe=null,Pe=null;function Vt(e){if(typeof wn=="function"&&ca(e),Pe&&typeof Pe.setStrictMode=="function")try{Pe.setStrictMode(Qe,e)}catch{}}var _t=Math.clz32?Math.clz32:Vo,Ru=Math.log,ku=Math.LN2;function Vo(e){return e>>>=0,e===0?32:31-(Ru(e)/ku|0)|0}var ls=256,Ga=4194304;function qn(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function xi(e,n,i){var o=e.pendingLanes;if(o===0)return 0;var c=0,d=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var M=o&134217727;return M!==0?(o=M&~d,o!==0?c=qn(o):(y&=M,y!==0?c=qn(y):i||(i=M&~e,i!==0&&(c=qn(i))))):(M=o&~d,M!==0?c=qn(M):y!==0?c=qn(y):i||(i=o&~e,i!==0&&(c=qn(i)))),c===0?0:n!==0&&n!==c&&(n&d)===0&&(d=c&-c,i=n&-n,d>=i||d===32&&(i&4194048)!==0)?n:c}function ua(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function Lu(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $o(){var e=ls;return ls<<=1,(ls&4194048)===0&&(ls=256),e}function Xo(){var e=Ga;return Ga<<=1,(Ga&62914560)===0&&(Ga=4194304),e}function cs(e){for(var n=[],i=0;31>i;i++)n.push(e);return n}function Hn(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Qo(e,n,i,o,c,d){var y=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var M=e.entanglements,w=e.expirationTimes,O=e.hiddenUpdates;for(i=y&~i;0<i;){var Z=31-_t(i),ie=1<<Z;M[Z]=0,w[Z]=-1;var j=O[Z];if(j!==null)for(O[Z]=null,Z=0;Z<j.length;Z++){var G=j[Z];G!==null&&(G.lane&=-536870913)}i&=~ie}o!==0&&hr(e,o,0),d!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=d&~(y&~n))}function hr(e,n,i){e.pendingLanes|=n,e.suspendedLanes&=~n;var o=31-_t(n);e.entangledLanes|=n,e.entanglements[o]=e.entanglements[o]|1073741824|i&4194090}function mr(e,n){var i=e.entangledLanes|=n;for(e=e.entanglements;i;){var o=31-_t(i),c=1<<o;c&n|e[o]&n&&(e[o]|=n),i&=~c}}function pr(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function gr(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Ko(){var e=P.p;return e!==0?e:(e=window.event,e===void 0?32:fy(e.type))}function Po(e,n){var i=P.p;try{return P.p=e,n()}finally{P.p=i}}var jn=Math.random().toString(36).slice(2),tt="__reactFiber$"+jn,ft="__reactProps$"+jn,da="__reactContainer$"+jn,Ya="__reactEvents$"+jn,Cn="__reactListeners$"+jn,us="__reactHandles$"+jn,Ai="__reactResources$"+jn,wi="__reactMarker$"+jn;function ds(e){delete e[tt],delete e[ft],delete e[Ya],delete e[Cn],delete e[us]}function fa(e){var n=e[tt];if(n)return n;for(var i=e.parentNode;i;){if(n=i[da]||i[tt]){if(i=n.alternate,n.child!==null||i!==null&&i.child!==null)for(e=Zg(e);e!==null;){if(i=e[tt])return i;e=Zg(e)}return n}e=i,i=e.parentNode}return null}function Fa(e){if(e=e[tt]||e[da]){var n=e.tag;if(n===5||n===6||n===13||n===26||n===27||n===3)return e}return null}function ha(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(r(33))}function ma(e){var n=e[Ai];return n||(n=e[Ai]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function nt(e){e[wi]=!0}var fs=new Set,Zo={};function Gn(e,n){Va(e,n),Va(e+"Capture",n)}function Va(e,n){for(Zo[e]=n,e=0;e<n.length;e++)fs.add(n[e])}var Jo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wo={},el={};function tl(e){return An.call(el,e)?!0:An.call(Wo,e)?!1:Jo.test(e)?el[e]=!0:(Wo[e]=!0,!1)}function Ci(e,n,i){if(tl(n))if(i===null)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var o=n.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+i)}}function Ti(e,n,i){if(i===null)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+i)}}function Tn(e,n,i,o){if(o===null)e.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(n,i,""+o)}}var nl,k;function K(e){if(nl===void 0)try{throw Error()}catch(i){var n=i.stack.trim().match(/\n( *(at )?)/);nl=n&&n[1]||"",k=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+nl+e+k}var ce=!1;function me(e,n){if(!e||ce)return"";ce=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(n){var ie=function(){throw Error()};if(Object.defineProperty(ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ie,[])}catch(G){var j=G}Reflect.construct(e,[],ie)}else{try{ie.call()}catch(G){j=G}e.call(ie.prototype)}}else{try{throw Error()}catch(G){j=G}(ie=e())&&typeof ie.catch=="function"&&ie.catch(function(){})}}catch(G){if(G&&j&&typeof G.stack=="string")return[G.stack,j.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=o.DetermineComponentFrameRoot(),y=d[0],M=d[1];if(y&&M){var w=y.split(`
`),O=M.split(`
`);for(c=o=0;o<w.length&&!w[o].includes("DetermineComponentFrameRoot");)o++;for(;c<O.length&&!O[c].includes("DetermineComponentFrameRoot");)c++;if(o===w.length||c===O.length)for(o=w.length-1,c=O.length-1;1<=o&&0<=c&&w[o]!==O[c];)c--;for(;1<=o&&0<=c;o--,c--)if(w[o]!==O[c]){if(o!==1||c!==1)do if(o--,c--,0>c||w[o]!==O[c]){var Z=`
`+w[o].replace(" at new "," at ");return e.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",e.displayName)),Z}while(1<=o&&0<=c);break}}}finally{ce=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?K(i):""}function Ne(e){switch(e.tag){case 26:case 27:case 5:return K(e.type);case 16:return K("Lazy");case 13:return K("Suspense");case 19:return K("SuspenseList");case 0:case 15:return me(e.type,!1);case 11:return me(e.type.render,!1);case 1:return me(e.type,!0);case 31:return K("Activity");default:return""}}function Ye(e){try{var n="";do n+=Ne(e),e=e.return;while(e);return n}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function Te(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function at(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Jt(e){var n=at(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),o=""+e[n];if(!e.hasOwnProperty(n)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var c=i.get,d=i.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return c.call(this)},set:function(y){o=""+y,d.call(this,y)}}),Object.defineProperty(e,n,{enumerable:i.enumerable}),{getValue:function(){return o},setValue:function(y){o=""+y},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function St(e){e._valueTracker||(e._valueTracker=Jt(e))}function Wt(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var i=n.getValue(),o="";return e&&(o=at(e)?e.checked?"true":"false":e.value),e=o,e!==i?(n.setValue(e),!0):!1}function en(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var _i=/[\n"\\]/g;function ht(e){return e.replace(_i,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function it(e,n,i,o,c,d,y,M){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),n!=null?y==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+Te(n)):e.value!==""+Te(n)&&(e.value=""+Te(n)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),n!=null?Xa(e,y,Te(n)):i!=null?Xa(e,y,Te(i)):o!=null&&e.removeAttribute("value"),c==null&&d!=null&&(e.defaultChecked=!!d),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?e.name=""+Te(M):e.removeAttribute("name")}function $a(e,n,i,o,c,d,y,M){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),n!=null||i!=null){if(!(d!=="submit"&&d!=="reset"||n!=null))return;i=i!=null?""+Te(i):"",n=n!=null?""+Te(n):i,M||n===e.value||(e.value=n),e.defaultValue=n}o=o??c,o=typeof o!="function"&&typeof o!="symbol"&&!!o,e.checked=M?e.checked:!!o,e.defaultChecked=!!o,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y)}function Xa(e,n,i){n==="number"&&en(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function pa(e,n,i,o){if(e=e.options,n){n={};for(var c=0;c<i.length;c++)n["$"+i[c]]=!0;for(i=0;i<e.length;i++)c=n.hasOwnProperty("$"+e[i].value),e[i].selected!==c&&(e[i].selected=c),c&&o&&(e[i].defaultSelected=!0)}else{for(i=""+Te(i),n=null,c=0;c<e.length;c++){if(e[c].value===i){e[c].selected=!0,o&&(e[c].defaultSelected=!0);return}n!==null||e[c].disabled||(n=e[c])}n!==null&&(n.selected=!0)}}function Yn(e,n,i){if(n!=null&&(n=""+Te(n),n!==e.value&&(e.value=n),i==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=i!=null?""+Te(i):""}function al(e,n,i,o){if(n==null){if(o!=null){if(i!=null)throw Error(r(92));if(F(o)){if(1<o.length)throw Error(r(93));o=o[0]}i=o}i==null&&(i=""),n=i}i=Te(n),e.defaultValue=i,o=e.textContent,o===i&&o!==""&&o!==null&&(e.value=o)}function hs(e,n){if(n){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=n;return}}e.textContent=n}var E1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function $m(e,n,i){var o=n.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?o?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":o?e.setProperty(n,i):typeof i!="number"||i===0||E1.has(n)?n==="float"?e.cssFloat=i:e[n]=(""+i).trim():e[n]=i+"px"}function Xm(e,n,i){if(n!=null&&typeof n!="object")throw Error(r(62));if(e=e.style,i!=null){for(var o in i)!i.hasOwnProperty(o)||n!=null&&n.hasOwnProperty(o)||(o.indexOf("--")===0?e.setProperty(o,""):o==="float"?e.cssFloat="":e[o]="");for(var c in n)o=n[c],n.hasOwnProperty(c)&&i[c]!==o&&$m(e,c,o)}else for(var d in n)n.hasOwnProperty(d)&&$m(e,d,n[d])}function Du(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var x1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),A1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function il(e){return A1.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Iu=null;function Uu(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ms=null,ps=null;function Qm(e){var n=Fa(e);if(n&&(e=n.stateNode)){var i=e[ft]||null;e:switch(e=n.stateNode,n.type){case"input":if(it(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),n=i.name,i.type==="radio"&&n!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+ht(""+n)+'"][type="radio"]'),n=0;n<i.length;n++){var o=i[n];if(o!==e&&o.form===e.form){var c=o[ft]||null;if(!c)throw Error(r(90));it(o,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(n=0;n<i.length;n++)o=i[n],o.form===e.form&&Wt(o)}break e;case"textarea":Yn(e,i.value,i.defaultValue);break e;case"select":n=i.value,n!=null&&pa(e,!!i.multiple,n,!1)}}}var Ou=!1;function Km(e,n,i){if(Ou)return e(n,i);Ou=!0;try{var o=e(n);return o}finally{if(Ou=!1,(ms!==null||ps!==null)&&(Yl(),ms&&(n=ms,e=ps,ps=ms=null,Qm(n),e)))for(n=0;n<e.length;n++)Qm(e[n])}}function yr(e,n){var i=e.stateNode;if(i===null)return null;var o=i[ft]||null;if(o===null)return null;i=o[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(r(231,n,typeof i));return i}var ga=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),zu=!1;if(ga)try{var br={};Object.defineProperty(br,"passive",{get:function(){zu=!0}}),window.addEventListener("test",br,br),window.removeEventListener("test",br,br)}catch{zu=!1}var Qa=null,Bu=null,sl=null;function Pm(){if(sl)return sl;var e,n=Bu,i=n.length,o,c="value"in Qa?Qa.value:Qa.textContent,d=c.length;for(e=0;e<i&&n[e]===c[e];e++);var y=i-e;for(o=1;o<=y&&n[i-o]===c[d-o];o++);return sl=c.slice(e,1<o?1-o:void 0)}function rl(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function ol(){return!0}function Zm(){return!1}function $t(e){function n(i,o,c,d,y){this._reactName=i,this._targetInst=c,this.type=o,this.nativeEvent=d,this.target=y,this.currentTarget=null;for(var M in e)e.hasOwnProperty(M)&&(i=e[M],this[M]=i?i(d):d[M]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?ol:Zm,this.isPropagationStopped=Zm,this}return g(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=ol)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=ol)},persist:function(){},isPersistent:ol}),n}var Ni={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ll=$t(Ni),vr=g({},Ni,{view:0,detail:0}),w1=$t(vr),qu,Hu,Sr,cl=g({},vr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Sr&&(Sr&&e.type==="mousemove"?(qu=e.screenX-Sr.screenX,Hu=e.screenY-Sr.screenY):Hu=qu=0,Sr=e),qu)},movementY:function(e){return"movementY"in e?e.movementY:Hu}}),Jm=$t(cl),C1=g({},cl,{dataTransfer:0}),T1=$t(C1),_1=g({},vr,{relatedTarget:0}),ju=$t(_1),N1=g({},Ni,{animationName:0,elapsedTime:0,pseudoElement:0}),R1=$t(N1),k1=g({},Ni,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),L1=$t(k1),D1=g({},Ni,{data:0}),Wm=$t(D1),I1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},U1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},O1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function z1(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=O1[e])?!!n[e]:!1}function Gu(){return z1}var B1=g({},vr,{key:function(e){if(e.key){var n=I1[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=rl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?U1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gu,charCode:function(e){return e.type==="keypress"?rl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?rl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),q1=$t(B1),H1=g({},cl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ep=$t(H1),j1=g({},vr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gu}),G1=$t(j1),Y1=g({},Ni,{propertyName:0,elapsedTime:0,pseudoElement:0}),F1=$t(Y1),V1=g({},cl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),$1=$t(V1),X1=g({},Ni,{newState:0,oldState:0}),Q1=$t(X1),K1=[9,13,27,32],Yu=ga&&"CompositionEvent"in window,Mr=null;ga&&"documentMode"in document&&(Mr=document.documentMode);var P1=ga&&"TextEvent"in window&&!Mr,tp=ga&&(!Yu||Mr&&8<Mr&&11>=Mr),np=" ",ap=!1;function ip(e,n){switch(e){case"keyup":return K1.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sp(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var gs=!1;function Z1(e,n){switch(e){case"compositionend":return sp(n);case"keypress":return n.which!==32?null:(ap=!0,np);case"textInput":return e=n.data,e===np&&ap?null:e;default:return null}}function J1(e,n){if(gs)return e==="compositionend"||!Yu&&ip(e,n)?(e=Pm(),sl=Bu=Qa=null,gs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return tp&&n.locale!=="ko"?null:n.data;default:return null}}var W1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rp(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!W1[e.type]:n==="textarea"}function op(e,n,i,o){ms?ps?ps.push(o):ps=[o]:ms=o,n=Kl(n,"onChange"),0<n.length&&(i=new ll("onChange","change",null,i,o),e.push({event:i,listeners:n}))}var Er=null,xr=null;function eS(e){jg(e,0)}function ul(e){var n=ha(e);if(Wt(n))return e}function lp(e,n){if(e==="change")return n}var cp=!1;if(ga){var Fu;if(ga){var Vu="oninput"in document;if(!Vu){var up=document.createElement("div");up.setAttribute("oninput","return;"),Vu=typeof up.oninput=="function"}Fu=Vu}else Fu=!1;cp=Fu&&(!document.documentMode||9<document.documentMode)}function dp(){Er&&(Er.detachEvent("onpropertychange",fp),xr=Er=null)}function fp(e){if(e.propertyName==="value"&&ul(xr)){var n=[];op(n,xr,e,Uu(e)),Km(eS,n)}}function tS(e,n,i){e==="focusin"?(dp(),Er=n,xr=i,Er.attachEvent("onpropertychange",fp)):e==="focusout"&&dp()}function nS(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ul(xr)}function aS(e,n){if(e==="click")return ul(n)}function iS(e,n){if(e==="input"||e==="change")return ul(n)}function sS(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var tn=typeof Object.is=="function"?Object.is:sS;function Ar(e,n){if(tn(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var i=Object.keys(e),o=Object.keys(n);if(i.length!==o.length)return!1;for(o=0;o<i.length;o++){var c=i[o];if(!An.call(n,c)||!tn(e[c],n[c]))return!1}return!0}function hp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function mp(e,n){var i=hp(e);e=0;for(var o;i;){if(i.nodeType===3){if(o=e+i.textContent.length,e<=n&&o>=n)return{node:i,offset:n-e};e=o}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=hp(i)}}function pp(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?pp(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function gp(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=en(e.document);n instanceof e.HTMLIFrameElement;){try{var i=typeof n.contentWindow.location.href=="string"}catch{i=!1}if(i)e=n.contentWindow;else break;n=en(e.document)}return n}function $u(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var rS=ga&&"documentMode"in document&&11>=document.documentMode,ys=null,Xu=null,wr=null,Qu=!1;function yp(e,n,i){var o=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Qu||ys==null||ys!==en(o)||(o=ys,"selectionStart"in o&&$u(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),wr&&Ar(wr,o)||(wr=o,o=Kl(Xu,"onSelect"),0<o.length&&(n=new ll("onSelect","select",null,n,i),e.push({event:n,listeners:o}),n.target=ys)))}function Ri(e,n){var i={};return i[e.toLowerCase()]=n.toLowerCase(),i["Webkit"+e]="webkit"+n,i["Moz"+e]="moz"+n,i}var bs={animationend:Ri("Animation","AnimationEnd"),animationiteration:Ri("Animation","AnimationIteration"),animationstart:Ri("Animation","AnimationStart"),transitionrun:Ri("Transition","TransitionRun"),transitionstart:Ri("Transition","TransitionStart"),transitioncancel:Ri("Transition","TransitionCancel"),transitionend:Ri("Transition","TransitionEnd")},Ku={},bp={};ga&&(bp=document.createElement("div").style,"AnimationEvent"in window||(delete bs.animationend.animation,delete bs.animationiteration.animation,delete bs.animationstart.animation),"TransitionEvent"in window||delete bs.transitionend.transition);function ki(e){if(Ku[e])return Ku[e];if(!bs[e])return e;var n=bs[e],i;for(i in n)if(n.hasOwnProperty(i)&&i in bp)return Ku[e]=n[i];return e}var vp=ki("animationend"),Sp=ki("animationiteration"),Mp=ki("animationstart"),oS=ki("transitionrun"),lS=ki("transitionstart"),cS=ki("transitioncancel"),Ep=ki("transitionend"),xp=new Map,Pu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Pu.push("scrollEnd");function _n(e,n){xp.set(e,n),Gn(n,[e])}var Ap=new WeakMap;function hn(e,n){if(typeof e=="object"&&e!==null){var i=Ap.get(e);return i!==void 0?i:(n={value:e,source:n,stack:Ye(n)},Ap.set(e,n),n)}return{value:e,source:n,stack:Ye(n)}}var mn=[],vs=0,Zu=0;function dl(){for(var e=vs,n=Zu=vs=0;n<e;){var i=mn[n];mn[n++]=null;var o=mn[n];mn[n++]=null;var c=mn[n];mn[n++]=null;var d=mn[n];if(mn[n++]=null,o!==null&&c!==null){var y=o.pending;y===null?c.next=c:(c.next=y.next,y.next=c),o.pending=c}d!==0&&wp(i,c,d)}}function fl(e,n,i,o){mn[vs++]=e,mn[vs++]=n,mn[vs++]=i,mn[vs++]=o,Zu|=o,e.lanes|=o,e=e.alternate,e!==null&&(e.lanes|=o)}function Ju(e,n,i,o){return fl(e,n,i,o),hl(e)}function Ss(e,n){return fl(e,null,null,n),hl(e)}function wp(e,n,i){e.lanes|=i;var o=e.alternate;o!==null&&(o.lanes|=i);for(var c=!1,d=e.return;d!==null;)d.childLanes|=i,o=d.alternate,o!==null&&(o.childLanes|=i),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(c=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,c&&n!==null&&(c=31-_t(i),e=d.hiddenUpdates,o=e[c],o===null?e[c]=[n]:o.push(n),n.lane=i|536870912),d):null}function hl(e){if(50<Pr)throw Pr=0,sf=null,Error(r(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Ms={};function uS(e,n,i,o){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nn(e,n,i,o){return new uS(e,n,i,o)}function Wu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ya(e,n){var i=e.alternate;return i===null?(i=nn(e.tag,n,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=n,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,n=e.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function Cp(e,n){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,n=i.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function ml(e,n,i,o,c,d){var y=0;if(o=e,typeof e=="function")Wu(e)&&(y=1);else if(typeof e=="string")y=fM(e,i,oe.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case Y:return e=nn(31,i,n,c),e.elementType=Y,e.lanes=d,e;case E:return Li(i.children,c,d,n);case T:y=8,c|=24;break;case _:return e=nn(12,i,n,c|2),e.elementType=_,e.lanes=d,e;case X:return e=nn(13,i,n,c),e.elementType=X,e.lanes=d,e;case $:return e=nn(19,i,n,c),e.elementType=$,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case R:case B:y=10;break e;case U:y=9;break e;case V:y=11;break e;case W:y=14;break e;case ne:y=16,o=null;break e}y=29,i=Error(r(130,e===null?"null":typeof e,"")),o=null}return n=nn(y,i,n,c),n.elementType=e,n.type=o,n.lanes=d,n}function Li(e,n,i,o){return e=nn(7,e,o,n),e.lanes=i,e}function ed(e,n,i){return e=nn(6,e,null,n),e.lanes=i,e}function td(e,n,i){return n=nn(4,e.children!==null?e.children:[],e.key,n),n.lanes=i,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var Es=[],xs=0,pl=null,gl=0,pn=[],gn=0,Di=null,ba=1,va="";function Ii(e,n){Es[xs++]=gl,Es[xs++]=pl,pl=e,gl=n}function Tp(e,n,i){pn[gn++]=ba,pn[gn++]=va,pn[gn++]=Di,Di=e;var o=ba;e=va;var c=32-_t(o)-1;o&=~(1<<c),i+=1;var d=32-_t(n)+c;if(30<d){var y=c-c%5;d=(o&(1<<y)-1).toString(32),o>>=y,c-=y,ba=1<<32-_t(n)+c|i<<c|o,va=d+e}else ba=1<<d|i<<c|o,va=e}function nd(e){e.return!==null&&(Ii(e,1),Tp(e,1,0))}function ad(e){for(;e===pl;)pl=Es[--xs],Es[xs]=null,gl=Es[--xs],Es[xs]=null;for(;e===Di;)Di=pn[--gn],pn[gn]=null,va=pn[--gn],pn[gn]=null,ba=pn[--gn],pn[gn]=null}var zt=null,st=null,Le=!1,Ui=null,Fn=!1,id=Error(r(519));function Oi(e){var n=Error(r(418,""));throw _r(hn(n,e)),id}function _p(e){var n=e.stateNode,i=e.type,o=e.memoizedProps;switch(n[tt]=e,n[ft]=o,i){case"dialog":Ce("cancel",n),Ce("close",n);break;case"iframe":case"object":case"embed":Ce("load",n);break;case"video":case"audio":for(i=0;i<Jr.length;i++)Ce(Jr[i],n);break;case"source":Ce("error",n);break;case"img":case"image":case"link":Ce("error",n),Ce("load",n);break;case"details":Ce("toggle",n);break;case"input":Ce("invalid",n),$a(n,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0),St(n);break;case"select":Ce("invalid",n);break;case"textarea":Ce("invalid",n),al(n,o.value,o.defaultValue,o.children),St(n)}i=o.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||n.textContent===""+i||o.suppressHydrationWarning===!0||Vg(n.textContent,i)?(o.popover!=null&&(Ce("beforetoggle",n),Ce("toggle",n)),o.onScroll!=null&&Ce("scroll",n),o.onScrollEnd!=null&&Ce("scrollend",n),o.onClick!=null&&(n.onclick=Pl),n=!0):n=!1,n||Oi(e)}function Np(e){for(zt=e.return;zt;)switch(zt.tag){case 5:case 13:Fn=!1;return;case 27:case 3:Fn=!0;return;default:zt=zt.return}}function Cr(e){if(e!==zt)return!1;if(!Le)return Np(e),Le=!0,!1;var n=e.tag,i;if((i=n!==3&&n!==27)&&((i=n===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||Mf(e.type,e.memoizedProps)),i=!i),i&&st&&Oi(e),Np(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8)if(i=e.data,i==="/$"){if(n===0){st=Rn(e.nextSibling);break e}n--}else i!=="$"&&i!=="$!"&&i!=="$?"||n++;e=e.nextSibling}st=null}}else n===27?(n=st,ui(e.type)?(e=wf,wf=null,st=e):st=n):st=zt?Rn(e.stateNode.nextSibling):null;return!0}function Tr(){st=zt=null,Le=!1}function Rp(){var e=Ui;return e!==null&&(Kt===null?Kt=e:Kt.push.apply(Kt,e),Ui=null),e}function _r(e){Ui===null?Ui=[e]:Ui.push(e)}var sd=A(null),zi=null,Sa=null;function Ka(e,n,i){Q(sd,n._currentValue),n._currentValue=i}function Ma(e){e._currentValue=sd.current,z(sd)}function rd(e,n,i){for(;e!==null;){var o=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,o!==null&&(o.childLanes|=n)):o!==null&&(o.childLanes&n)!==n&&(o.childLanes|=n),e===i)break;e=e.return}}function od(e,n,i,o){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var d=c.dependencies;if(d!==null){var y=c.child;d=d.firstContext;e:for(;d!==null;){var M=d;d=c;for(var w=0;w<n.length;w++)if(M.context===n[w]){d.lanes|=i,M=d.alternate,M!==null&&(M.lanes|=i),rd(d.return,i,e),o||(y=null);break e}d=M.next}}else if(c.tag===18){if(y=c.return,y===null)throw Error(r(341));y.lanes|=i,d=y.alternate,d!==null&&(d.lanes|=i),rd(y,i,e),y=null}else y=c.child;if(y!==null)y.return=c;else for(y=c;y!==null;){if(y===e){y=null;break}if(c=y.sibling,c!==null){c.return=y.return,y=c;break}y=y.return}c=y}}function Nr(e,n,i,o){e=null;for(var c=n,d=!1;c!==null;){if(!d){if((c.flags&524288)!==0)d=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var y=c.alternate;if(y===null)throw Error(r(387));if(y=y.memoizedProps,y!==null){var M=c.type;tn(c.pendingProps.value,y.value)||(e!==null?e.push(M):e=[M])}}else if(c===ve.current){if(y=c.alternate,y===null)throw Error(r(387));y.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(io):e=[io])}c=c.return}e!==null&&od(n,e,i,o),n.flags|=262144}function yl(e){for(e=e.firstContext;e!==null;){if(!tn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Bi(e){zi=e,Sa=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Nt(e){return kp(zi,e)}function bl(e,n){return zi===null&&Bi(e),kp(e,n)}function kp(e,n){var i=n._currentValue;if(n={context:n,memoizedValue:i,next:null},Sa===null){if(e===null)throw Error(r(308));Sa=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else Sa=Sa.next=n;return i}var dS=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(i,o){e.push(o)}};this.abort=function(){n.aborted=!0,e.forEach(function(i){return i()})}},fS=t.unstable_scheduleCallback,hS=t.unstable_NormalPriority,mt={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ld(){return{controller:new dS,data:new Map,refCount:0}}function Rr(e){e.refCount--,e.refCount===0&&fS(hS,function(){e.controller.abort()})}var kr=null,cd=0,As=0,ws=null;function mS(e,n){if(kr===null){var i=kr=[];cd=0,As=ff(),ws={status:"pending",value:void 0,then:function(o){i.push(o)}}}return cd++,n.then(Lp,Lp),n}function Lp(){if(--cd===0&&kr!==null){ws!==null&&(ws.status="fulfilled");var e=kr;kr=null,As=0,ws=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function pS(e,n){var i=[],o={status:"pending",value:null,reason:null,then:function(c){i.push(c)}};return e.then(function(){o.status="fulfilled",o.value=n;for(var c=0;c<i.length;c++)(0,i[c])(n)},function(c){for(o.status="rejected",o.reason=c,c=0;c<i.length;c++)(0,i[c])(void 0)}),o}var Dp=D.S;D.S=function(e,n){typeof n=="object"&&n!==null&&typeof n.then=="function"&&mS(e,n),Dp!==null&&Dp(e,n)};var qi=A(null);function ud(){var e=qi.current;return e!==null?e:Ve.pooledCache}function vl(e,n){n===null?Q(qi,qi.current):Q(qi,n.pool)}function Ip(){var e=ud();return e===null?null:{parent:mt._currentValue,pool:e}}var Lr=Error(r(460)),Up=Error(r(474)),Sl=Error(r(542)),dd={then:function(){}};function Op(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Ml(){}function zp(e,n,i){switch(i=e[i],i===void 0?e.push(n):i!==n&&(n.then(Ml,Ml),n=i),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,qp(e),e;default:if(typeof n.status=="string")n.then(Ml,Ml);else{if(e=Ve,e!==null&&100<e.shellSuspendCounter)throw Error(r(482));e=n,e.status="pending",e.then(function(o){if(n.status==="pending"){var c=n;c.status="fulfilled",c.value=o}},function(o){if(n.status==="pending"){var c=n;c.status="rejected",c.reason=o}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,qp(e),e}throw Dr=n,Lr}}var Dr=null;function Bp(){if(Dr===null)throw Error(r(459));var e=Dr;return Dr=null,e}function qp(e){if(e===Lr||e===Sl)throw Error(r(483))}var Pa=!1;function fd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function hd(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Za(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ja(e,n,i){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,(De&2)!==0){var c=o.pending;return c===null?n.next=n:(n.next=c.next,c.next=n),o.pending=n,n=hl(e),wp(e,null,i),n}return fl(e,o,n,i),hl(e)}function Ir(e,n,i){if(n=n.updateQueue,n!==null&&(n=n.shared,(i&4194048)!==0)){var o=n.lanes;o&=e.pendingLanes,i|=o,n.lanes=i,mr(e,i)}}function md(e,n){var i=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,i===o)){var c=null,d=null;if(i=i.firstBaseUpdate,i!==null){do{var y={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};d===null?c=d=y:d=d.next=y,i=i.next}while(i!==null);d===null?c=d=n:d=d.next=n}else c=d=n;i={baseState:o.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:o.shared,callbacks:o.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=n:e.next=n,i.lastBaseUpdate=n}var pd=!1;function Ur(){if(pd){var e=ws;if(e!==null)throw e}}function Or(e,n,i,o){pd=!1;var c=e.updateQueue;Pa=!1;var d=c.firstBaseUpdate,y=c.lastBaseUpdate,M=c.shared.pending;if(M!==null){c.shared.pending=null;var w=M,O=w.next;w.next=null,y===null?d=O:y.next=O,y=w;var Z=e.alternate;Z!==null&&(Z=Z.updateQueue,M=Z.lastBaseUpdate,M!==y&&(M===null?Z.firstBaseUpdate=O:M.next=O,Z.lastBaseUpdate=w))}if(d!==null){var ie=c.baseState;y=0,Z=O=w=null,M=d;do{var j=M.lane&-536870913,G=j!==M.lane;if(G?(Re&j)===j:(o&j)===j){j!==0&&j===As&&(pd=!0),Z!==null&&(Z=Z.next={lane:0,tag:M.tag,payload:M.payload,callback:null,next:null});e:{var Se=e,ye=M;j=n;var He=i;switch(ye.tag){case 1:if(Se=ye.payload,typeof Se=="function"){ie=Se.call(He,ie,j);break e}ie=Se;break e;case 3:Se.flags=Se.flags&-65537|128;case 0:if(Se=ye.payload,j=typeof Se=="function"?Se.call(He,ie,j):Se,j==null)break e;ie=g({},ie,j);break e;case 2:Pa=!0}}j=M.callback,j!==null&&(e.flags|=64,G&&(e.flags|=8192),G=c.callbacks,G===null?c.callbacks=[j]:G.push(j))}else G={lane:j,tag:M.tag,payload:M.payload,callback:M.callback,next:null},Z===null?(O=Z=G,w=ie):Z=Z.next=G,y|=j;if(M=M.next,M===null){if(M=c.shared.pending,M===null)break;G=M,M=G.next,G.next=null,c.lastBaseUpdate=G,c.shared.pending=null}}while(!0);Z===null&&(w=ie),c.baseState=w,c.firstBaseUpdate=O,c.lastBaseUpdate=Z,d===null&&(c.shared.lanes=0),ri|=y,e.lanes=y,e.memoizedState=ie}}function Hp(e,n){if(typeof e!="function")throw Error(r(191,e));e.call(n)}function jp(e,n){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)Hp(i[e],n)}var Cs=A(null),El=A(0);function Gp(e,n){e=_a,Q(El,e),Q(Cs,n),_a=e|n.baseLanes}function gd(){Q(El,_a),Q(Cs,Cs.current)}function yd(){_a=El.current,z(Cs),z(El)}var Wa=0,Ee=null,Be=null,ut=null,xl=!1,Ts=!1,Hi=!1,Al=0,zr=0,_s=null,gS=0;function ot(){throw Error(r(321))}function bd(e,n){if(n===null)return!1;for(var i=0;i<n.length&&i<e.length;i++)if(!tn(e[i],n[i]))return!1;return!0}function vd(e,n,i,o,c,d){return Wa=d,Ee=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,D.H=e===null||e.memoizedState===null?w0:C0,Hi=!1,d=i(o,c),Hi=!1,Ts&&(d=Fp(n,i,o,c)),Yp(e),d}function Yp(e){D.H=Rl;var n=Be!==null&&Be.next!==null;if(Wa=0,ut=Be=Ee=null,xl=!1,zr=0,_s=null,n)throw Error(r(300));e===null||Mt||(e=e.dependencies,e!==null&&yl(e)&&(Mt=!0))}function Fp(e,n,i,o){Ee=e;var c=0;do{if(Ts&&(_s=null),zr=0,Ts=!1,25<=c)throw Error(r(301));if(c+=1,ut=Be=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}D.H=xS,d=n(i,o)}while(Ts);return d}function yS(){var e=D.H,n=e.useState()[0];return n=typeof n.then=="function"?Br(n):n,e=e.useState()[0],(Be!==null?Be.memoizedState:null)!==e&&(Ee.flags|=1024),n}function Sd(){var e=Al!==0;return Al=0,e}function Md(e,n,i){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~i}function Ed(e){if(xl){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}xl=!1}Wa=0,ut=Be=Ee=null,Ts=!1,zr=Al=0,_s=null}function Xt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ut===null?Ee.memoizedState=ut=e:ut=ut.next=e,ut}function dt(){if(Be===null){var e=Ee.alternate;e=e!==null?e.memoizedState:null}else e=Be.next;var n=ut===null?Ee.memoizedState:ut.next;if(n!==null)ut=n,Be=e;else{if(e===null)throw Ee.alternate===null?Error(r(467)):Error(r(310));Be=e,e={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},ut===null?Ee.memoizedState=ut=e:ut=ut.next=e}return ut}function xd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Br(e){var n=zr;return zr+=1,_s===null&&(_s=[]),e=zp(_s,e,n),n=Ee,(ut===null?n.memoizedState:ut.next)===null&&(n=n.alternate,D.H=n===null||n.memoizedState===null?w0:C0),e}function wl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Br(e);if(e.$$typeof===B)return Nt(e)}throw Error(r(438,String(e)))}function Ad(e){var n=null,i=Ee.updateQueue;if(i!==null&&(n=i.memoCache),n==null){var o=Ee.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(n={data:o.data.map(function(c){return c.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),i===null&&(i=xd(),Ee.updateQueue=i),i.memoCache=n,i=n.data[n.index],i===void 0)for(i=n.data[n.index]=Array(e),o=0;o<e;o++)i[o]=q;return n.index++,i}function Ea(e,n){return typeof n=="function"?n(e):n}function Cl(e){var n=dt();return wd(n,Be,e)}function wd(e,n,i){var o=e.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=i;var c=e.baseQueue,d=o.pending;if(d!==null){if(c!==null){var y=c.next;c.next=d.next,d.next=y}n.baseQueue=c=d,o.pending=null}if(d=e.baseState,c===null)e.memoizedState=d;else{n=c.next;var M=y=null,w=null,O=n,Z=!1;do{var ie=O.lane&-536870913;if(ie!==O.lane?(Re&ie)===ie:(Wa&ie)===ie){var j=O.revertLane;if(j===0)w!==null&&(w=w.next={lane:0,revertLane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),ie===As&&(Z=!0);else if((Wa&j)===j){O=O.next,j===As&&(Z=!0);continue}else ie={lane:0,revertLane:O.revertLane,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null},w===null?(M=w=ie,y=d):w=w.next=ie,Ee.lanes|=j,ri|=j;ie=O.action,Hi&&i(d,ie),d=O.hasEagerState?O.eagerState:i(d,ie)}else j={lane:ie,revertLane:O.revertLane,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null},w===null?(M=w=j,y=d):w=w.next=j,Ee.lanes|=ie,ri|=ie;O=O.next}while(O!==null&&O!==n);if(w===null?y=d:w.next=M,!tn(d,e.memoizedState)&&(Mt=!0,Z&&(i=ws,i!==null)))throw i;e.memoizedState=d,e.baseState=y,e.baseQueue=w,o.lastRenderedState=d}return c===null&&(o.lanes=0),[e.memoizedState,o.dispatch]}function Cd(e){var n=dt(),i=n.queue;if(i===null)throw Error(r(311));i.lastRenderedReducer=e;var o=i.dispatch,c=i.pending,d=n.memoizedState;if(c!==null){i.pending=null;var y=c=c.next;do d=e(d,y.action),y=y.next;while(y!==c);tn(d,n.memoizedState)||(Mt=!0),n.memoizedState=d,n.baseQueue===null&&(n.baseState=d),i.lastRenderedState=d}return[d,o]}function Vp(e,n,i){var o=Ee,c=dt(),d=Le;if(d){if(i===void 0)throw Error(r(407));i=i()}else i=n();var y=!tn((Be||c).memoizedState,i);y&&(c.memoizedState=i,Mt=!0),c=c.queue;var M=Qp.bind(null,o,c,e);if(qr(2048,8,M,[e]),c.getSnapshot!==n||y||ut!==null&&ut.memoizedState.tag&1){if(o.flags|=2048,Ns(9,Tl(),Xp.bind(null,o,c,i,n),null),Ve===null)throw Error(r(349));d||(Wa&124)!==0||$p(o,n,i)}return i}function $p(e,n,i){e.flags|=16384,e={getSnapshot:n,value:i},n=Ee.updateQueue,n===null?(n=xd(),Ee.updateQueue=n,n.stores=[e]):(i=n.stores,i===null?n.stores=[e]:i.push(e))}function Xp(e,n,i,o){n.value=i,n.getSnapshot=o,Kp(n)&&Pp(e)}function Qp(e,n,i){return i(function(){Kp(n)&&Pp(e)})}function Kp(e){var n=e.getSnapshot;e=e.value;try{var i=n();return!tn(e,i)}catch{return!0}}function Pp(e){var n=Ss(e,2);n!==null&&ln(n,e,2)}function Td(e){var n=Xt();if(typeof e=="function"){var i=e;if(e=i(),Hi){Vt(!0);try{i()}finally{Vt(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:e},n}function Zp(e,n,i,o){return e.baseState=i,wd(e,Be,typeof o=="function"?o:Ea)}function bS(e,n,i,o,c){if(Nl(e))throw Error(r(485));if(e=n.action,e!==null){var d={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){d.listeners.push(y)}};D.T!==null?i(!0):d.isTransition=!1,o(d),i=n.pending,i===null?(d.next=n.pending=d,Jp(n,d)):(d.next=i.next,n.pending=i.next=d)}}function Jp(e,n){var i=n.action,o=n.payload,c=e.state;if(n.isTransition){var d=D.T,y={};D.T=y;try{var M=i(c,o),w=D.S;w!==null&&w(y,M),Wp(e,n,M)}catch(O){_d(e,n,O)}finally{D.T=d}}else try{d=i(c,o),Wp(e,n,d)}catch(O){_d(e,n,O)}}function Wp(e,n,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(o){e0(e,n,o)},function(o){return _d(e,n,o)}):e0(e,n,i)}function e0(e,n,i){n.status="fulfilled",n.value=i,t0(n),e.state=i,n=e.pending,n!==null&&(i=n.next,i===n?e.pending=null:(i=i.next,n.next=i,Jp(e,i)))}function _d(e,n,i){var o=e.pending;if(e.pending=null,o!==null){o=o.next;do n.status="rejected",n.reason=i,t0(n),n=n.next;while(n!==o)}e.action=null}function t0(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function n0(e,n){return n}function a0(e,n){if(Le){var i=Ve.formState;if(i!==null){e:{var o=Ee;if(Le){if(st){t:{for(var c=st,d=Fn;c.nodeType!==8;){if(!d){c=null;break t}if(c=Rn(c.nextSibling),c===null){c=null;break t}}d=c.data,c=d==="F!"||d==="F"?c:null}if(c){st=Rn(c.nextSibling),o=c.data==="F!";break e}}Oi(o)}o=!1}o&&(n=i[0])}}return i=Xt(),i.memoizedState=i.baseState=n,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n0,lastRenderedState:n},i.queue=o,i=E0.bind(null,Ee,o),o.dispatch=i,o=Td(!1),d=Dd.bind(null,Ee,!1,o.queue),o=Xt(),c={state:n,dispatch:null,action:e,pending:null},o.queue=c,i=bS.bind(null,Ee,c,d,i),c.dispatch=i,o.memoizedState=e,[n,i,!1]}function i0(e){var n=dt();return s0(n,Be,e)}function s0(e,n,i){if(n=wd(e,n,n0)[0],e=Cl(Ea)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var o=Br(n)}catch(y){throw y===Lr?Sl:y}else o=n;n=dt();var c=n.queue,d=c.dispatch;return i!==n.memoizedState&&(Ee.flags|=2048,Ns(9,Tl(),vS.bind(null,c,i),null)),[o,d,e]}function vS(e,n){e.action=n}function r0(e){var n=dt(),i=Be;if(i!==null)return s0(n,i,e);dt(),n=n.memoizedState,i=dt();var o=i.queue.dispatch;return i.memoizedState=e,[n,o,!1]}function Ns(e,n,i,o){return e={tag:e,create:i,deps:o,inst:n,next:null},n=Ee.updateQueue,n===null&&(n=xd(),Ee.updateQueue=n),i=n.lastEffect,i===null?n.lastEffect=e.next=e:(o=i.next,i.next=e,e.next=o,n.lastEffect=e),e}function Tl(){return{destroy:void 0,resource:void 0}}function o0(){return dt().memoizedState}function _l(e,n,i,o){var c=Xt();o=o===void 0?null:o,Ee.flags|=e,c.memoizedState=Ns(1|n,Tl(),i,o)}function qr(e,n,i,o){var c=dt();o=o===void 0?null:o;var d=c.memoizedState.inst;Be!==null&&o!==null&&bd(o,Be.memoizedState.deps)?c.memoizedState=Ns(n,d,i,o):(Ee.flags|=e,c.memoizedState=Ns(1|n,d,i,o))}function l0(e,n){_l(8390656,8,e,n)}function c0(e,n){qr(2048,8,e,n)}function u0(e,n){return qr(4,2,e,n)}function d0(e,n){return qr(4,4,e,n)}function f0(e,n){if(typeof n=="function"){e=e();var i=n(e);return function(){typeof i=="function"?i():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function h0(e,n,i){i=i!=null?i.concat([e]):null,qr(4,4,f0.bind(null,n,e),i)}function Nd(){}function m0(e,n){var i=dt();n=n===void 0?null:n;var o=i.memoizedState;return n!==null&&bd(n,o[1])?o[0]:(i.memoizedState=[e,n],e)}function p0(e,n){var i=dt();n=n===void 0?null:n;var o=i.memoizedState;if(n!==null&&bd(n,o[1]))return o[0];if(o=e(),Hi){Vt(!0);try{e()}finally{Vt(!1)}}return i.memoizedState=[o,n],o}function Rd(e,n,i){return i===void 0||(Wa&1073741824)!==0?e.memoizedState=n:(e.memoizedState=i,e=bg(),Ee.lanes|=e,ri|=e,i)}function g0(e,n,i,o){return tn(i,n)?i:Cs.current!==null?(e=Rd(e,i,o),tn(e,n)||(Mt=!0),e):(Wa&42)===0?(Mt=!0,e.memoizedState=i):(e=bg(),Ee.lanes|=e,ri|=e,n)}function y0(e,n,i,o,c){var d=P.p;P.p=d!==0&&8>d?d:8;var y=D.T,M={};D.T=M,Dd(e,!1,n,i);try{var w=c(),O=D.S;if(O!==null&&O(M,w),w!==null&&typeof w=="object"&&typeof w.then=="function"){var Z=pS(w,o);Hr(e,n,Z,on(e))}else Hr(e,n,o,on(e))}catch(ie){Hr(e,n,{then:function(){},status:"rejected",reason:ie},on())}finally{P.p=d,D.T=y}}function SS(){}function kd(e,n,i,o){if(e.tag!==5)throw Error(r(476));var c=b0(e).queue;y0(e,c,n,le,i===null?SS:function(){return v0(e),i(o)})}function b0(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:le,baseState:le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:le},next:null};var i={};return n.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:i},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function v0(e){var n=b0(e).next.queue;Hr(e,n,{},on())}function Ld(){return Nt(io)}function S0(){return dt().memoizedState}function M0(){return dt().memoizedState}function MS(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var i=on();e=Za(i);var o=Ja(n,e,i);o!==null&&(ln(o,n,i),Ir(o,n,i)),n={cache:ld()},e.payload=n;return}n=n.return}}function ES(e,n,i){var o=on();i={lane:o,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},Nl(e)?x0(n,i):(i=Ju(e,n,i,o),i!==null&&(ln(i,e,o),A0(i,n,o)))}function E0(e,n,i){var o=on();Hr(e,n,i,o)}function Hr(e,n,i,o){var c={lane:o,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(Nl(e))x0(n,c);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=n.lastRenderedReducer,d!==null))try{var y=n.lastRenderedState,M=d(y,i);if(c.hasEagerState=!0,c.eagerState=M,tn(M,y))return fl(e,n,c,0),Ve===null&&dl(),!1}catch{}finally{}if(i=Ju(e,n,c,o),i!==null)return ln(i,e,o),A0(i,n,o),!0}return!1}function Dd(e,n,i,o){if(o={lane:2,revertLane:ff(),action:o,hasEagerState:!1,eagerState:null,next:null},Nl(e)){if(n)throw Error(r(479))}else n=Ju(e,i,o,2),n!==null&&ln(n,e,2)}function Nl(e){var n=e.alternate;return e===Ee||n!==null&&n===Ee}function x0(e,n){Ts=xl=!0;var i=e.pending;i===null?n.next=n:(n.next=i.next,i.next=n),e.pending=n}function A0(e,n,i){if((i&4194048)!==0){var o=n.lanes;o&=e.pendingLanes,i|=o,n.lanes=i,mr(e,i)}}var Rl={readContext:Nt,use:wl,useCallback:ot,useContext:ot,useEffect:ot,useImperativeHandle:ot,useLayoutEffect:ot,useInsertionEffect:ot,useMemo:ot,useReducer:ot,useRef:ot,useState:ot,useDebugValue:ot,useDeferredValue:ot,useTransition:ot,useSyncExternalStore:ot,useId:ot,useHostTransitionStatus:ot,useFormState:ot,useActionState:ot,useOptimistic:ot,useMemoCache:ot,useCacheRefresh:ot},w0={readContext:Nt,use:wl,useCallback:function(e,n){return Xt().memoizedState=[e,n===void 0?null:n],e},useContext:Nt,useEffect:l0,useImperativeHandle:function(e,n,i){i=i!=null?i.concat([e]):null,_l(4194308,4,f0.bind(null,n,e),i)},useLayoutEffect:function(e,n){return _l(4194308,4,e,n)},useInsertionEffect:function(e,n){_l(4,2,e,n)},useMemo:function(e,n){var i=Xt();n=n===void 0?null:n;var o=e();if(Hi){Vt(!0);try{e()}finally{Vt(!1)}}return i.memoizedState=[o,n],o},useReducer:function(e,n,i){var o=Xt();if(i!==void 0){var c=i(n);if(Hi){Vt(!0);try{i(n)}finally{Vt(!1)}}}else c=n;return o.memoizedState=o.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},o.queue=e,e=e.dispatch=ES.bind(null,Ee,e),[o.memoizedState,e]},useRef:function(e){var n=Xt();return e={current:e},n.memoizedState=e},useState:function(e){e=Td(e);var n=e.queue,i=E0.bind(null,Ee,n);return n.dispatch=i,[e.memoizedState,i]},useDebugValue:Nd,useDeferredValue:function(e,n){var i=Xt();return Rd(i,e,n)},useTransition:function(){var e=Td(!1);return e=y0.bind(null,Ee,e.queue,!0,!1),Xt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,i){var o=Ee,c=Xt();if(Le){if(i===void 0)throw Error(r(407));i=i()}else{if(i=n(),Ve===null)throw Error(r(349));(Re&124)!==0||$p(o,n,i)}c.memoizedState=i;var d={value:i,getSnapshot:n};return c.queue=d,l0(Qp.bind(null,o,d,e),[e]),o.flags|=2048,Ns(9,Tl(),Xp.bind(null,o,d,i,n),null),i},useId:function(){var e=Xt(),n=Ve.identifierPrefix;if(Le){var i=va,o=ba;i=(o&~(1<<32-_t(o)-1)).toString(32)+i,n=""+n+"R"+i,i=Al++,0<i&&(n+="H"+i.toString(32)),n+=""}else i=gS++,n=""+n+"r"+i.toString(32)+"";return e.memoizedState=n},useHostTransitionStatus:Ld,useFormState:a0,useActionState:a0,useOptimistic:function(e){var n=Xt();n.memoizedState=n.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=i,n=Dd.bind(null,Ee,!0,i),i.dispatch=n,[e,n]},useMemoCache:Ad,useCacheRefresh:function(){return Xt().memoizedState=MS.bind(null,Ee)}},C0={readContext:Nt,use:wl,useCallback:m0,useContext:Nt,useEffect:c0,useImperativeHandle:h0,useInsertionEffect:u0,useLayoutEffect:d0,useMemo:p0,useReducer:Cl,useRef:o0,useState:function(){return Cl(Ea)},useDebugValue:Nd,useDeferredValue:function(e,n){var i=dt();return g0(i,Be.memoizedState,e,n)},useTransition:function(){var e=Cl(Ea)[0],n=dt().memoizedState;return[typeof e=="boolean"?e:Br(e),n]},useSyncExternalStore:Vp,useId:S0,useHostTransitionStatus:Ld,useFormState:i0,useActionState:i0,useOptimistic:function(e,n){var i=dt();return Zp(i,Be,e,n)},useMemoCache:Ad,useCacheRefresh:M0},xS={readContext:Nt,use:wl,useCallback:m0,useContext:Nt,useEffect:c0,useImperativeHandle:h0,useInsertionEffect:u0,useLayoutEffect:d0,useMemo:p0,useReducer:Cd,useRef:o0,useState:function(){return Cd(Ea)},useDebugValue:Nd,useDeferredValue:function(e,n){var i=dt();return Be===null?Rd(i,e,n):g0(i,Be.memoizedState,e,n)},useTransition:function(){var e=Cd(Ea)[0],n=dt().memoizedState;return[typeof e=="boolean"?e:Br(e),n]},useSyncExternalStore:Vp,useId:S0,useHostTransitionStatus:Ld,useFormState:r0,useActionState:r0,useOptimistic:function(e,n){var i=dt();return Be!==null?Zp(i,Be,e,n):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:Ad,useCacheRefresh:M0},Rs=null,jr=0;function kl(e){var n=jr;return jr+=1,Rs===null&&(Rs=[]),zp(Rs,e,n)}function Gr(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function Ll(e,n){throw n.$$typeof===b?Error(r(525)):(e=Object.prototype.toString.call(n),Error(r(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function T0(e){var n=e._init;return n(e._payload)}function _0(e){function n(L,N){if(e){var I=L.deletions;I===null?(L.deletions=[N],L.flags|=16):I.push(N)}}function i(L,N){if(!e)return null;for(;N!==null;)n(L,N),N=N.sibling;return null}function o(L){for(var N=new Map;L!==null;)L.key!==null?N.set(L.key,L):N.set(L.index,L),L=L.sibling;return N}function c(L,N){return L=ya(L,N),L.index=0,L.sibling=null,L}function d(L,N,I){return L.index=I,e?(I=L.alternate,I!==null?(I=I.index,I<N?(L.flags|=67108866,N):I):(L.flags|=67108866,N)):(L.flags|=1048576,N)}function y(L){return e&&L.alternate===null&&(L.flags|=67108866),L}function M(L,N,I,te){return N===null||N.tag!==6?(N=ed(I,L.mode,te),N.return=L,N):(N=c(N,I),N.return=L,N)}function w(L,N,I,te){var he=I.type;return he===E?Z(L,N,I.props.children,te,I.key):N!==null&&(N.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===ne&&T0(he)===N.type)?(N=c(N,I.props),Gr(N,I),N.return=L,N):(N=ml(I.type,I.key,I.props,null,L.mode,te),Gr(N,I),N.return=L,N)}function O(L,N,I,te){return N===null||N.tag!==4||N.stateNode.containerInfo!==I.containerInfo||N.stateNode.implementation!==I.implementation?(N=td(I,L.mode,te),N.return=L,N):(N=c(N,I.children||[]),N.return=L,N)}function Z(L,N,I,te,he){return N===null||N.tag!==7?(N=Li(I,L.mode,te,he),N.return=L,N):(N=c(N,I),N.return=L,N)}function ie(L,N,I){if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return N=ed(""+N,L.mode,I),N.return=L,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case v:return I=ml(N.type,N.key,N.props,null,L.mode,I),Gr(I,N),I.return=L,I;case S:return N=td(N,L.mode,I),N.return=L,N;case ne:var te=N._init;return N=te(N._payload),ie(L,N,I)}if(F(N)||J(N))return N=Li(N,L.mode,I,null),N.return=L,N;if(typeof N.then=="function")return ie(L,kl(N),I);if(N.$$typeof===B)return ie(L,bl(L,N),I);Ll(L,N)}return null}function j(L,N,I,te){var he=N!==null?N.key:null;if(typeof I=="string"&&I!==""||typeof I=="number"||typeof I=="bigint")return he!==null?null:M(L,N,""+I,te);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case v:return I.key===he?w(L,N,I,te):null;case S:return I.key===he?O(L,N,I,te):null;case ne:return he=I._init,I=he(I._payload),j(L,N,I,te)}if(F(I)||J(I))return he!==null?null:Z(L,N,I,te,null);if(typeof I.then=="function")return j(L,N,kl(I),te);if(I.$$typeof===B)return j(L,N,bl(L,I),te);Ll(L,I)}return null}function G(L,N,I,te,he){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return L=L.get(I)||null,M(N,L,""+te,he);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case v:return L=L.get(te.key===null?I:te.key)||null,w(N,L,te,he);case S:return L=L.get(te.key===null?I:te.key)||null,O(N,L,te,he);case ne:var Ae=te._init;return te=Ae(te._payload),G(L,N,I,te,he)}if(F(te)||J(te))return L=L.get(I)||null,Z(N,L,te,he,null);if(typeof te.then=="function")return G(L,N,I,kl(te),he);if(te.$$typeof===B)return G(L,N,I,bl(N,te),he);Ll(N,te)}return null}function Se(L,N,I,te){for(var he=null,Ae=null,pe=N,be=N=0,xt=null;pe!==null&&be<I.length;be++){pe.index>be?(xt=pe,pe=null):xt=pe.sibling;var ke=j(L,pe,I[be],te);if(ke===null){pe===null&&(pe=xt);break}e&&pe&&ke.alternate===null&&n(L,pe),N=d(ke,N,be),Ae===null?he=ke:Ae.sibling=ke,Ae=ke,pe=xt}if(be===I.length)return i(L,pe),Le&&Ii(L,be),he;if(pe===null){for(;be<I.length;be++)pe=ie(L,I[be],te),pe!==null&&(N=d(pe,N,be),Ae===null?he=pe:Ae.sibling=pe,Ae=pe);return Le&&Ii(L,be),he}for(pe=o(pe);be<I.length;be++)xt=G(pe,L,be,I[be],te),xt!==null&&(e&&xt.alternate!==null&&pe.delete(xt.key===null?be:xt.key),N=d(xt,N,be),Ae===null?he=xt:Ae.sibling=xt,Ae=xt);return e&&pe.forEach(function(pi){return n(L,pi)}),Le&&Ii(L,be),he}function ye(L,N,I,te){if(I==null)throw Error(r(151));for(var he=null,Ae=null,pe=N,be=N=0,xt=null,ke=I.next();pe!==null&&!ke.done;be++,ke=I.next()){pe.index>be?(xt=pe,pe=null):xt=pe.sibling;var pi=j(L,pe,ke.value,te);if(pi===null){pe===null&&(pe=xt);break}e&&pe&&pi.alternate===null&&n(L,pe),N=d(pi,N,be),Ae===null?he=pi:Ae.sibling=pi,Ae=pi,pe=xt}if(ke.done)return i(L,pe),Le&&Ii(L,be),he;if(pe===null){for(;!ke.done;be++,ke=I.next())ke=ie(L,ke.value,te),ke!==null&&(N=d(ke,N,be),Ae===null?he=ke:Ae.sibling=ke,Ae=ke);return Le&&Ii(L,be),he}for(pe=o(pe);!ke.done;be++,ke=I.next())ke=G(pe,L,be,ke.value,te),ke!==null&&(e&&ke.alternate!==null&&pe.delete(ke.key===null?be:ke.key),N=d(ke,N,be),Ae===null?he=ke:Ae.sibling=ke,Ae=ke);return e&&pe.forEach(function(AM){return n(L,AM)}),Le&&Ii(L,be),he}function He(L,N,I,te){if(typeof I=="object"&&I!==null&&I.type===E&&I.key===null&&(I=I.props.children),typeof I=="object"&&I!==null){switch(I.$$typeof){case v:e:{for(var he=I.key;N!==null;){if(N.key===he){if(he=I.type,he===E){if(N.tag===7){i(L,N.sibling),te=c(N,I.props.children),te.return=L,L=te;break e}}else if(N.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===ne&&T0(he)===N.type){i(L,N.sibling),te=c(N,I.props),Gr(te,I),te.return=L,L=te;break e}i(L,N);break}else n(L,N);N=N.sibling}I.type===E?(te=Li(I.props.children,L.mode,te,I.key),te.return=L,L=te):(te=ml(I.type,I.key,I.props,null,L.mode,te),Gr(te,I),te.return=L,L=te)}return y(L);case S:e:{for(he=I.key;N!==null;){if(N.key===he)if(N.tag===4&&N.stateNode.containerInfo===I.containerInfo&&N.stateNode.implementation===I.implementation){i(L,N.sibling),te=c(N,I.children||[]),te.return=L,L=te;break e}else{i(L,N);break}else n(L,N);N=N.sibling}te=td(I,L.mode,te),te.return=L,L=te}return y(L);case ne:return he=I._init,I=he(I._payload),He(L,N,I,te)}if(F(I))return Se(L,N,I,te);if(J(I)){if(he=J(I),typeof he!="function")throw Error(r(150));return I=he.call(I),ye(L,N,I,te)}if(typeof I.then=="function")return He(L,N,kl(I),te);if(I.$$typeof===B)return He(L,N,bl(L,I),te);Ll(L,I)}return typeof I=="string"&&I!==""||typeof I=="number"||typeof I=="bigint"?(I=""+I,N!==null&&N.tag===6?(i(L,N.sibling),te=c(N,I),te.return=L,L=te):(i(L,N),te=ed(I,L.mode,te),te.return=L,L=te),y(L)):i(L,N)}return function(L,N,I,te){try{jr=0;var he=He(L,N,I,te);return Rs=null,he}catch(pe){if(pe===Lr||pe===Sl)throw pe;var Ae=nn(29,pe,null,L.mode);return Ae.lanes=te,Ae.return=L,Ae}finally{}}}var ks=_0(!0),N0=_0(!1),yn=A(null),Vn=null;function ei(e){var n=e.alternate;Q(pt,pt.current&1),Q(yn,e),Vn===null&&(n===null||Cs.current!==null||n.memoizedState!==null)&&(Vn=e)}function R0(e){if(e.tag===22){if(Q(pt,pt.current),Q(yn,e),Vn===null){var n=e.alternate;n!==null&&n.memoizedState!==null&&(Vn=e)}}else ti()}function ti(){Q(pt,pt.current),Q(yn,yn.current)}function xa(e){z(yn),Vn===e&&(Vn=null),z(pt)}var pt=A(0);function Dl(e){for(var n=e;n!==null;){if(n.tag===13){var i=n.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||Af(i)))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}function Id(e,n,i,o){n=e.memoizedState,i=i(o,n),i=i==null?n:g({},n,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Ud={enqueueSetState:function(e,n,i){e=e._reactInternals;var o=on(),c=Za(o);c.payload=n,i!=null&&(c.callback=i),n=Ja(e,c,o),n!==null&&(ln(n,e,o),Ir(n,e,o))},enqueueReplaceState:function(e,n,i){e=e._reactInternals;var o=on(),c=Za(o);c.tag=1,c.payload=n,i!=null&&(c.callback=i),n=Ja(e,c,o),n!==null&&(ln(n,e,o),Ir(n,e,o))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var i=on(),o=Za(i);o.tag=2,n!=null&&(o.callback=n),n=Ja(e,o,i),n!==null&&(ln(n,e,i),Ir(n,e,i))}};function k0(e,n,i,o,c,d,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,d,y):n.prototype&&n.prototype.isPureReactComponent?!Ar(i,o)||!Ar(c,d):!0}function L0(e,n,i,o){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(i,o),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(i,o),n.state!==e&&Ud.enqueueReplaceState(n,n.state,null)}function ji(e,n){var i=n;if("ref"in n){i={};for(var o in n)o!=="ref"&&(i[o]=n[o])}if(e=e.defaultProps){i===n&&(i=g({},i));for(var c in e)i[c]===void 0&&(i[c]=e[c])}return i}var Il=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function D0(e){Il(e)}function I0(e){console.error(e)}function U0(e){Il(e)}function Ul(e,n){try{var i=e.onUncaughtError;i(n.value,{componentStack:n.stack})}catch(o){setTimeout(function(){throw o})}}function O0(e,n,i){try{var o=e.onCaughtError;o(i.value,{componentStack:i.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Od(e,n,i){return i=Za(i),i.tag=3,i.payload={element:null},i.callback=function(){Ul(e,n)},i}function z0(e){return e=Za(e),e.tag=3,e}function B0(e,n,i,o){var c=i.type.getDerivedStateFromError;if(typeof c=="function"){var d=o.value;e.payload=function(){return c(d)},e.callback=function(){O0(n,i,o)}}var y=i.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){O0(n,i,o),typeof c!="function"&&(oi===null?oi=new Set([this]):oi.add(this));var M=o.stack;this.componentDidCatch(o.value,{componentStack:M!==null?M:""})})}function AS(e,n,i,o,c){if(i.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(n=i.alternate,n!==null&&Nr(n,i,c,!0),i=yn.current,i!==null){switch(i.tag){case 13:return Vn===null?of():i.alternate===null&&rt===0&&(rt=3),i.flags&=-257,i.flags|=65536,i.lanes=c,o===dd?i.flags|=16384:(n=i.updateQueue,n===null?i.updateQueue=new Set([o]):n.add(o),cf(e,o,c)),!1;case 22:return i.flags|=65536,o===dd?i.flags|=16384:(n=i.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([o])},i.updateQueue=n):(i=n.retryQueue,i===null?n.retryQueue=new Set([o]):i.add(o)),cf(e,o,c)),!1}throw Error(r(435,i.tag))}return cf(e,o,c),of(),!1}if(Le)return n=yn.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=c,o!==id&&(e=Error(r(422),{cause:o}),_r(hn(e,i)))):(o!==id&&(n=Error(r(423),{cause:o}),_r(hn(n,i))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,o=hn(o,i),c=Od(e.stateNode,o,c),md(e,c),rt!==4&&(rt=2)),!1;var d=Error(r(520),{cause:o});if(d=hn(d,i),Kr===null?Kr=[d]:Kr.push(d),rt!==4&&(rt=2),n===null)return!0;o=hn(o,i),i=n;do{switch(i.tag){case 3:return i.flags|=65536,e=c&-c,i.lanes|=e,e=Od(i.stateNode,o,e),md(i,e),!1;case 1:if(n=i.type,d=i.stateNode,(i.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(oi===null||!oi.has(d))))return i.flags|=65536,c&=-c,i.lanes|=c,c=z0(c),B0(c,e,i,o),md(i,c),!1}i=i.return}while(i!==null);return!1}var q0=Error(r(461)),Mt=!1;function At(e,n,i,o){n.child=e===null?N0(n,null,i,o):ks(n,e.child,i,o)}function H0(e,n,i,o,c){i=i.render;var d=n.ref;if("ref"in o){var y={};for(var M in o)M!=="ref"&&(y[M]=o[M])}else y=o;return Bi(n),o=vd(e,n,i,y,d,c),M=Sd(),e!==null&&!Mt?(Md(e,n,c),Aa(e,n,c)):(Le&&M&&nd(n),n.flags|=1,At(e,n,o,c),n.child)}function j0(e,n,i,o,c){if(e===null){var d=i.type;return typeof d=="function"&&!Wu(d)&&d.defaultProps===void 0&&i.compare===null?(n.tag=15,n.type=d,G0(e,n,d,o,c)):(e=ml(i.type,null,o,n,n.mode,c),e.ref=n.ref,e.return=n,n.child=e)}if(d=e.child,!Fd(e,c)){var y=d.memoizedProps;if(i=i.compare,i=i!==null?i:Ar,i(y,o)&&e.ref===n.ref)return Aa(e,n,c)}return n.flags|=1,e=ya(d,o),e.ref=n.ref,e.return=n,n.child=e}function G0(e,n,i,o,c){if(e!==null){var d=e.memoizedProps;if(Ar(d,o)&&e.ref===n.ref)if(Mt=!1,n.pendingProps=o=d,Fd(e,c))(e.flags&131072)!==0&&(Mt=!0);else return n.lanes=e.lanes,Aa(e,n,c)}return zd(e,n,i,o,c)}function Y0(e,n,i){var o=n.pendingProps,c=o.children,d=e!==null?e.memoizedState:null;if(o.mode==="hidden"){if((n.flags&128)!==0){if(o=d!==null?d.baseLanes|i:i,e!==null){for(c=n.child=e.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;n.childLanes=d&~o}else n.childLanes=0,n.child=null;return F0(e,n,o,i)}if((i&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&vl(n,d!==null?d.cachePool:null),d!==null?Gp(n,d):gd(),R0(n);else return n.lanes=n.childLanes=536870912,F0(e,n,d!==null?d.baseLanes|i:i,i)}else d!==null?(vl(n,d.cachePool),Gp(n,d),ti(),n.memoizedState=null):(e!==null&&vl(n,null),gd(),ti());return At(e,n,c,i),n.child}function F0(e,n,i,o){var c=ud();return c=c===null?null:{parent:mt._currentValue,pool:c},n.memoizedState={baseLanes:i,cachePool:c},e!==null&&vl(n,null),gd(),R0(n),e!==null&&Nr(e,n,o,!0),null}function Ol(e,n){var i=n.ref;if(i===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(r(284));(e===null||e.ref!==i)&&(n.flags|=4194816)}}function zd(e,n,i,o,c){return Bi(n),i=vd(e,n,i,o,void 0,c),o=Sd(),e!==null&&!Mt?(Md(e,n,c),Aa(e,n,c)):(Le&&o&&nd(n),n.flags|=1,At(e,n,i,c),n.child)}function V0(e,n,i,o,c,d){return Bi(n),n.updateQueue=null,i=Fp(n,o,i,c),Yp(e),o=Sd(),e!==null&&!Mt?(Md(e,n,d),Aa(e,n,d)):(Le&&o&&nd(n),n.flags|=1,At(e,n,i,d),n.child)}function $0(e,n,i,o,c){if(Bi(n),n.stateNode===null){var d=Ms,y=i.contextType;typeof y=="object"&&y!==null&&(d=Nt(y)),d=new i(o,d),n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Ud,n.stateNode=d,d._reactInternals=n,d=n.stateNode,d.props=o,d.state=n.memoizedState,d.refs={},fd(n),y=i.contextType,d.context=typeof y=="object"&&y!==null?Nt(y):Ms,d.state=n.memoizedState,y=i.getDerivedStateFromProps,typeof y=="function"&&(Id(n,i,y,o),d.state=n.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(y=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),y!==d.state&&Ud.enqueueReplaceState(d,d.state,null),Or(n,o,d,c),Ur(),d.state=n.memoizedState),typeof d.componentDidMount=="function"&&(n.flags|=4194308),o=!0}else if(e===null){d=n.stateNode;var M=n.memoizedProps,w=ji(i,M);d.props=w;var O=d.context,Z=i.contextType;y=Ms,typeof Z=="object"&&Z!==null&&(y=Nt(Z));var ie=i.getDerivedStateFromProps;Z=typeof ie=="function"||typeof d.getSnapshotBeforeUpdate=="function",M=n.pendingProps!==M,Z||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(M||O!==y)&&L0(n,d,o,y),Pa=!1;var j=n.memoizedState;d.state=j,Or(n,o,d,c),Ur(),O=n.memoizedState,M||j!==O||Pa?(typeof ie=="function"&&(Id(n,i,ie,o),O=n.memoizedState),(w=Pa||k0(n,i,w,o,j,O,y))?(Z||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(n.flags|=4194308)):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=o,n.memoizedState=O),d.props=o,d.state=O,d.context=y,o=w):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),o=!1)}else{d=n.stateNode,hd(e,n),y=n.memoizedProps,Z=ji(i,y),d.props=Z,ie=n.pendingProps,j=d.context,O=i.contextType,w=Ms,typeof O=="object"&&O!==null&&(w=Nt(O)),M=i.getDerivedStateFromProps,(O=typeof M=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(y!==ie||j!==w)&&L0(n,d,o,w),Pa=!1,j=n.memoizedState,d.state=j,Or(n,o,d,c),Ur();var G=n.memoizedState;y!==ie||j!==G||Pa||e!==null&&e.dependencies!==null&&yl(e.dependencies)?(typeof M=="function"&&(Id(n,i,M,o),G=n.memoizedState),(Z=Pa||k0(n,i,Z,o,j,G,w)||e!==null&&e.dependencies!==null&&yl(e.dependencies))?(O||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(o,G,w),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(o,G,w)),typeof d.componentDidUpdate=="function"&&(n.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&j===e.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&j===e.memoizedState||(n.flags|=1024),n.memoizedProps=o,n.memoizedState=G),d.props=o,d.state=G,d.context=w,o=Z):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&j===e.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&j===e.memoizedState||(n.flags|=1024),o=!1)}return d=o,Ol(e,n),o=(n.flags&128)!==0,d||o?(d=n.stateNode,i=o&&typeof i.getDerivedStateFromError!="function"?null:d.render(),n.flags|=1,e!==null&&o?(n.child=ks(n,e.child,null,c),n.child=ks(n,null,i,c)):At(e,n,i,c),n.memoizedState=d.state,e=n.child):e=Aa(e,n,c),e}function X0(e,n,i,o){return Tr(),n.flags|=256,At(e,n,i,o),n.child}var Bd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qd(e){return{baseLanes:e,cachePool:Ip()}}function Hd(e,n,i){return e=e!==null?e.childLanes&~i:0,n&&(e|=bn),e}function Q0(e,n,i){var o=n.pendingProps,c=!1,d=(n.flags&128)!==0,y;if((y=d)||(y=e!==null&&e.memoizedState===null?!1:(pt.current&2)!==0),y&&(c=!0,n.flags&=-129),y=(n.flags&32)!==0,n.flags&=-33,e===null){if(Le){if(c?ei(n):ti(),Le){var M=st,w;if(w=M){e:{for(w=M,M=Fn;w.nodeType!==8;){if(!M){M=null;break e}if(w=Rn(w.nextSibling),w===null){M=null;break e}}M=w}M!==null?(n.memoizedState={dehydrated:M,treeContext:Di!==null?{id:ba,overflow:va}:null,retryLane:536870912,hydrationErrors:null},w=nn(18,null,null,0),w.stateNode=M,w.return=n,n.child=w,zt=n,st=null,w=!0):w=!1}w||Oi(n)}if(M=n.memoizedState,M!==null&&(M=M.dehydrated,M!==null))return Af(M)?n.lanes=32:n.lanes=536870912,null;xa(n)}return M=o.children,o=o.fallback,c?(ti(),c=n.mode,M=zl({mode:"hidden",children:M},c),o=Li(o,c,i,null),M.return=n,o.return=n,M.sibling=o,n.child=M,c=n.child,c.memoizedState=qd(i),c.childLanes=Hd(e,y,i),n.memoizedState=Bd,o):(ei(n),jd(n,M))}if(w=e.memoizedState,w!==null&&(M=w.dehydrated,M!==null)){if(d)n.flags&256?(ei(n),n.flags&=-257,n=Gd(e,n,i)):n.memoizedState!==null?(ti(),n.child=e.child,n.flags|=128,n=null):(ti(),c=o.fallback,M=n.mode,o=zl({mode:"visible",children:o.children},M),c=Li(c,M,i,null),c.flags|=2,o.return=n,c.return=n,o.sibling=c,n.child=o,ks(n,e.child,null,i),o=n.child,o.memoizedState=qd(i),o.childLanes=Hd(e,y,i),n.memoizedState=Bd,n=c);else if(ei(n),Af(M)){if(y=M.nextSibling&&M.nextSibling.dataset,y)var O=y.dgst;y=O,o=Error(r(419)),o.stack="",o.digest=y,_r({value:o,source:null,stack:null}),n=Gd(e,n,i)}else if(Mt||Nr(e,n,i,!1),y=(i&e.childLanes)!==0,Mt||y){if(y=Ve,y!==null&&(o=i&-i,o=(o&42)!==0?1:pr(o),o=(o&(y.suspendedLanes|i))!==0?0:o,o!==0&&o!==w.retryLane))throw w.retryLane=o,Ss(e,o),ln(y,e,o),q0;M.data==="$?"||of(),n=Gd(e,n,i)}else M.data==="$?"?(n.flags|=192,n.child=e.child,n=null):(e=w.treeContext,st=Rn(M.nextSibling),zt=n,Le=!0,Ui=null,Fn=!1,e!==null&&(pn[gn++]=ba,pn[gn++]=va,pn[gn++]=Di,ba=e.id,va=e.overflow,Di=n),n=jd(n,o.children),n.flags|=4096);return n}return c?(ti(),c=o.fallback,M=n.mode,w=e.child,O=w.sibling,o=ya(w,{mode:"hidden",children:o.children}),o.subtreeFlags=w.subtreeFlags&65011712,O!==null?c=ya(O,c):(c=Li(c,M,i,null),c.flags|=2),c.return=n,o.return=n,o.sibling=c,n.child=o,o=c,c=n.child,M=e.child.memoizedState,M===null?M=qd(i):(w=M.cachePool,w!==null?(O=mt._currentValue,w=w.parent!==O?{parent:O,pool:O}:w):w=Ip(),M={baseLanes:M.baseLanes|i,cachePool:w}),c.memoizedState=M,c.childLanes=Hd(e,y,i),n.memoizedState=Bd,o):(ei(n),i=e.child,e=i.sibling,i=ya(i,{mode:"visible",children:o.children}),i.return=n,i.sibling=null,e!==null&&(y=n.deletions,y===null?(n.deletions=[e],n.flags|=16):y.push(e)),n.child=i,n.memoizedState=null,i)}function jd(e,n){return n=zl({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function zl(e,n){return e=nn(22,e,null,n),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Gd(e,n,i){return ks(n,e.child,null,i),e=jd(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function K0(e,n,i){e.lanes|=n;var o=e.alternate;o!==null&&(o.lanes|=n),rd(e.return,n,i)}function Yd(e,n,i,o,c){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:o,tail:i,tailMode:c}:(d.isBackwards=n,d.rendering=null,d.renderingStartTime=0,d.last=o,d.tail=i,d.tailMode=c)}function P0(e,n,i){var o=n.pendingProps,c=o.revealOrder,d=o.tail;if(At(e,n,o.children,i),o=pt.current,(o&2)!==0)o=o&1|2,n.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&K0(e,i,n);else if(e.tag===19)K0(e,i,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}switch(Q(pt,o),c){case"forwards":for(i=n.child,c=null;i!==null;)e=i.alternate,e!==null&&Dl(e)===null&&(c=i),i=i.sibling;i=c,i===null?(c=n.child,n.child=null):(c=i.sibling,i.sibling=null),Yd(n,!1,c,i,d);break;case"backwards":for(i=null,c=n.child,n.child=null;c!==null;){if(e=c.alternate,e!==null&&Dl(e)===null){n.child=c;break}e=c.sibling,c.sibling=i,i=c,c=e}Yd(n,!0,i,null,d);break;case"together":Yd(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Aa(e,n,i){if(e!==null&&(n.dependencies=e.dependencies),ri|=n.lanes,(i&n.childLanes)===0)if(e!==null){if(Nr(e,n,i,!1),(i&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(r(153));if(n.child!==null){for(e=n.child,i=ya(e,e.pendingProps),n.child=i,i.return=n;e.sibling!==null;)e=e.sibling,i=i.sibling=ya(e,e.pendingProps),i.return=n;i.sibling=null}return n.child}function Fd(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&yl(e)))}function wS(e,n,i){switch(n.tag){case 3:ge(n,n.stateNode.containerInfo),Ka(n,mt,e.memoizedState.cache),Tr();break;case 27:case 5:Ut(n);break;case 4:ge(n,n.stateNode.containerInfo);break;case 10:Ka(n,n.type,n.memoizedProps.value);break;case 13:var o=n.memoizedState;if(o!==null)return o.dehydrated!==null?(ei(n),n.flags|=128,null):(i&n.child.childLanes)!==0?Q0(e,n,i):(ei(n),e=Aa(e,n,i),e!==null?e.sibling:null);ei(n);break;case 19:var c=(e.flags&128)!==0;if(o=(i&n.childLanes)!==0,o||(Nr(e,n,i,!1),o=(i&n.childLanes)!==0),c){if(o)return P0(e,n,i);n.flags|=128}if(c=n.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),Q(pt,pt.current),o)break;return null;case 22:case 23:return n.lanes=0,Y0(e,n,i);case 24:Ka(n,mt,e.memoizedState.cache)}return Aa(e,n,i)}function Z0(e,n,i){if(e!==null)if(e.memoizedProps!==n.pendingProps)Mt=!0;else{if(!Fd(e,i)&&(n.flags&128)===0)return Mt=!1,wS(e,n,i);Mt=(e.flags&131072)!==0}else Mt=!1,Le&&(n.flags&1048576)!==0&&Tp(n,gl,n.index);switch(n.lanes=0,n.tag){case 16:e:{e=n.pendingProps;var o=n.elementType,c=o._init;if(o=c(o._payload),n.type=o,typeof o=="function")Wu(o)?(e=ji(o,e),n.tag=1,n=$0(null,n,o,e,i)):(n.tag=0,n=zd(null,n,o,e,i));else{if(o!=null){if(c=o.$$typeof,c===V){n.tag=11,n=H0(null,n,o,e,i);break e}else if(c===W){n.tag=14,n=j0(null,n,o,e,i);break e}}throw n=ae(o)||o,Error(r(306,n,""))}}return n;case 0:return zd(e,n,n.type,n.pendingProps,i);case 1:return o=n.type,c=ji(o,n.pendingProps),$0(e,n,o,c,i);case 3:e:{if(ge(n,n.stateNode.containerInfo),e===null)throw Error(r(387));o=n.pendingProps;var d=n.memoizedState;c=d.element,hd(e,n),Or(n,o,null,i);var y=n.memoizedState;if(o=y.cache,Ka(n,mt,o),o!==d.cache&&od(n,[mt],i,!0),Ur(),o=y.element,d.isDehydrated)if(d={element:o,isDehydrated:!1,cache:y.cache},n.updateQueue.baseState=d,n.memoizedState=d,n.flags&256){n=X0(e,n,o,i);break e}else if(o!==c){c=hn(Error(r(424)),n),_r(c),n=X0(e,n,o,i);break e}else{switch(e=n.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(st=Rn(e.firstChild),zt=n,Le=!0,Ui=null,Fn=!0,i=N0(n,null,o,i),n.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(Tr(),o===c){n=Aa(e,n,i);break e}At(e,n,o,i)}n=n.child}return n;case 26:return Ol(e,n),e===null?(i=ty(n.type,null,n.pendingProps,null))?n.memoizedState=i:Le||(i=n.type,e=n.pendingProps,o=Zl(ue.current).createElement(i),o[tt]=n,o[ft]=e,Ct(o,i,e),nt(o),n.stateNode=o):n.memoizedState=ty(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return Ut(n),e===null&&Le&&(o=n.stateNode=Jg(n.type,n.pendingProps,ue.current),zt=n,Fn=!0,c=st,ui(n.type)?(wf=c,st=Rn(o.firstChild)):st=c),At(e,n,n.pendingProps.children,i),Ol(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&Le&&((c=o=st)&&(o=WS(o,n.type,n.pendingProps,Fn),o!==null?(n.stateNode=o,zt=n,st=Rn(o.firstChild),Fn=!1,c=!0):c=!1),c||Oi(n)),Ut(n),c=n.type,d=n.pendingProps,y=e!==null?e.memoizedProps:null,o=d.children,Mf(c,d)?o=null:y!==null&&Mf(c,y)&&(n.flags|=32),n.memoizedState!==null&&(c=vd(e,n,yS,null,null,i),io._currentValue=c),Ol(e,n),At(e,n,o,i),n.child;case 6:return e===null&&Le&&((e=i=st)&&(i=eM(i,n.pendingProps,Fn),i!==null?(n.stateNode=i,zt=n,st=null,e=!0):e=!1),e||Oi(n)),null;case 13:return Q0(e,n,i);case 4:return ge(n,n.stateNode.containerInfo),o=n.pendingProps,e===null?n.child=ks(n,null,o,i):At(e,n,o,i),n.child;case 11:return H0(e,n,n.type,n.pendingProps,i);case 7:return At(e,n,n.pendingProps,i),n.child;case 8:return At(e,n,n.pendingProps.children,i),n.child;case 12:return At(e,n,n.pendingProps.children,i),n.child;case 10:return o=n.pendingProps,Ka(n,n.type,o.value),At(e,n,o.children,i),n.child;case 9:return c=n.type._context,o=n.pendingProps.children,Bi(n),c=Nt(c),o=o(c),n.flags|=1,At(e,n,o,i),n.child;case 14:return j0(e,n,n.type,n.pendingProps,i);case 15:return G0(e,n,n.type,n.pendingProps,i);case 19:return P0(e,n,i);case 31:return o=n.pendingProps,i=n.mode,o={mode:o.mode,children:o.children},e===null?(i=zl(o,i),i.ref=n.ref,n.child=i,i.return=n,n=i):(i=ya(e.child,o),i.ref=n.ref,n.child=i,i.return=n,n=i),n;case 22:return Y0(e,n,i);case 24:return Bi(n),o=Nt(mt),e===null?(c=ud(),c===null&&(c=Ve,d=ld(),c.pooledCache=d,d.refCount++,d!==null&&(c.pooledCacheLanes|=i),c=d),n.memoizedState={parent:o,cache:c},fd(n),Ka(n,mt,c)):((e.lanes&i)!==0&&(hd(e,n),Or(n,null,null,i),Ur()),c=e.memoizedState,d=n.memoizedState,c.parent!==o?(c={parent:o,cache:o},n.memoizedState=c,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=c),Ka(n,mt,o)):(o=d.cache,Ka(n,mt,o),o!==c.cache&&od(n,[mt],i,!0))),At(e,n,n.pendingProps.children,i),n.child;case 29:throw n.pendingProps}throw Error(r(156,n.tag))}function wa(e){e.flags|=4}function J0(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!ry(n)){if(n=yn.current,n!==null&&((Re&4194048)===Re?Vn!==null:(Re&62914560)!==Re&&(Re&536870912)===0||n!==Vn))throw Dr=dd,Up;e.flags|=8192}}function Bl(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?Xo():536870912,e.lanes|=n,Us|=n)}function Yr(e,n){if(!Le)switch(e.tailMode){case"hidden":n=e.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function Ze(e){var n=e.alternate!==null&&e.alternate.child===e.child,i=0,o=0;if(n)for(var c=e.child;c!==null;)i|=c.lanes|c.childLanes,o|=c.subtreeFlags&65011712,o|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)i|=c.lanes|c.childLanes,o|=c.subtreeFlags,o|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=o,e.childLanes=i,n}function CS(e,n,i){var o=n.pendingProps;switch(ad(n),n.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ze(n),null;case 1:return Ze(n),null;case 3:return i=n.stateNode,o=null,e!==null&&(o=e.memoizedState.cache),n.memoizedState.cache!==o&&(n.flags|=2048),Ma(mt),et(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(Cr(n)?wa(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Rp())),Ze(n),null;case 26:return i=n.memoizedState,e===null?(wa(n),i!==null?(Ze(n),J0(n,i)):(Ze(n),n.flags&=-16777217)):i?i!==e.memoizedState?(wa(n),Ze(n),J0(n,i)):(Ze(n),n.flags&=-16777217):(e.memoizedProps!==o&&wa(n),Ze(n),n.flags&=-16777217),null;case 27:Ot(n),i=ue.current;var c=n.type;if(e!==null&&n.stateNode!=null)e.memoizedProps!==o&&wa(n);else{if(!o){if(n.stateNode===null)throw Error(r(166));return Ze(n),null}e=oe.current,Cr(n)?_p(n):(e=Jg(c,o,i),n.stateNode=e,wa(n))}return Ze(n),null;case 5:if(Ot(n),i=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==o&&wa(n);else{if(!o){if(n.stateNode===null)throw Error(r(166));return Ze(n),null}if(e=oe.current,Cr(n))_p(n);else{switch(c=Zl(ue.current),e){case 1:e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof o.is=="string"?c.createElement("select",{is:o.is}):c.createElement("select"),o.multiple?e.multiple=!0:o.size&&(e.size=o.size);break;default:e=typeof o.is=="string"?c.createElement(i,{is:o.is}):c.createElement(i)}}e[tt]=n,e[ft]=o;e:for(c=n.child;c!==null;){if(c.tag===5||c.tag===6)e.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===n)break e;for(;c.sibling===null;){if(c.return===null||c.return===n)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}n.stateNode=e;e:switch(Ct(e,i,o),i){case"button":case"input":case"select":case"textarea":e=!!o.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&wa(n)}}return Ze(n),n.flags&=-16777217,null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==o&&wa(n);else{if(typeof o!="string"&&n.stateNode===null)throw Error(r(166));if(e=ue.current,Cr(n)){if(e=n.stateNode,i=n.memoizedProps,o=null,c=zt,c!==null)switch(c.tag){case 27:case 5:o=c.memoizedProps}e[tt]=n,e=!!(e.nodeValue===i||o!==null&&o.suppressHydrationWarning===!0||Vg(e.nodeValue,i)),e||Oi(n)}else e=Zl(e).createTextNode(o),e[tt]=n,n.stateNode=e}return Ze(n),null;case 13:if(o=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=Cr(n),o!==null&&o.dehydrated!==null){if(e===null){if(!c)throw Error(r(318));if(c=n.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));c[tt]=n}else Tr(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Ze(n),c=!1}else c=Rp(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return n.flags&256?(xa(n),n):(xa(n),null)}if(xa(n),(n.flags&128)!==0)return n.lanes=i,n;if(i=o!==null,e=e!==null&&e.memoizedState!==null,i){o=n.child,c=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(c=o.alternate.memoizedState.cachePool.pool);var d=null;o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),d!==c&&(o.flags|=2048)}return i!==e&&i&&(n.child.flags|=8192),Bl(n,n.updateQueue),Ze(n),null;case 4:return et(),e===null&&gf(n.stateNode.containerInfo),Ze(n),null;case 10:return Ma(n.type),Ze(n),null;case 19:if(z(pt),c=n.memoizedState,c===null)return Ze(n),null;if(o=(n.flags&128)!==0,d=c.rendering,d===null)if(o)Yr(c,!1);else{if(rt!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(d=Dl(e),d!==null){for(n.flags|=128,Yr(c,!1),e=d.updateQueue,n.updateQueue=e,Bl(n,e),n.subtreeFlags=0,e=i,i=n.child;i!==null;)Cp(i,e),i=i.sibling;return Q(pt,pt.current&1|2),n.child}e=e.sibling}c.tail!==null&&fe()>jl&&(n.flags|=128,o=!0,Yr(c,!1),n.lanes=4194304)}else{if(!o)if(e=Dl(d),e!==null){if(n.flags|=128,o=!0,e=e.updateQueue,n.updateQueue=e,Bl(n,e),Yr(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!Le)return Ze(n),null}else 2*fe()-c.renderingStartTime>jl&&i!==536870912&&(n.flags|=128,o=!0,Yr(c,!1),n.lanes=4194304);c.isBackwards?(d.sibling=n.child,n.child=d):(e=c.last,e!==null?e.sibling=d:n.child=d,c.last=d)}return c.tail!==null?(n=c.tail,c.rendering=n,c.tail=n.sibling,c.renderingStartTime=fe(),n.sibling=null,e=pt.current,Q(pt,o?e&1|2:e&1),n):(Ze(n),null);case 22:case 23:return xa(n),yd(),o=n.memoizedState!==null,e!==null?e.memoizedState!==null!==o&&(n.flags|=8192):o&&(n.flags|=8192),o?(i&536870912)!==0&&(n.flags&128)===0&&(Ze(n),n.subtreeFlags&6&&(n.flags|=8192)):Ze(n),i=n.updateQueue,i!==null&&Bl(n,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),o=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),o!==i&&(n.flags|=2048),e!==null&&z(qi),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),n.memoizedState.cache!==i&&(n.flags|=2048),Ma(mt),Ze(n),null;case 25:return null;case 30:return null}throw Error(r(156,n.tag))}function TS(e,n){switch(ad(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Ma(mt),et(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return Ot(n),null;case 13:if(xa(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(r(340));Tr()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return z(pt),null;case 4:return et(),null;case 10:return Ma(n.type),null;case 22:case 23:return xa(n),yd(),e!==null&&z(qi),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return Ma(mt),null;case 25:return null;default:return null}}function W0(e,n){switch(ad(n),n.tag){case 3:Ma(mt),et();break;case 26:case 27:case 5:Ot(n);break;case 4:et();break;case 13:xa(n);break;case 19:z(pt);break;case 10:Ma(n.type);break;case 22:case 23:xa(n),yd(),e!==null&&z(qi);break;case 24:Ma(mt)}}function Fr(e,n){try{var i=n.updateQueue,o=i!==null?i.lastEffect:null;if(o!==null){var c=o.next;i=c;do{if((i.tag&e)===e){o=void 0;var d=i.create,y=i.inst;o=d(),y.destroy=o}i=i.next}while(i!==c)}}catch(M){Fe(n,n.return,M)}}function ni(e,n,i){try{var o=n.updateQueue,c=o!==null?o.lastEffect:null;if(c!==null){var d=c.next;o=d;do{if((o.tag&e)===e){var y=o.inst,M=y.destroy;if(M!==void 0){y.destroy=void 0,c=n;var w=i,O=M;try{O()}catch(Z){Fe(c,w,Z)}}}o=o.next}while(o!==d)}}catch(Z){Fe(n,n.return,Z)}}function eg(e){var n=e.updateQueue;if(n!==null){var i=e.stateNode;try{jp(n,i)}catch(o){Fe(e,e.return,o)}}}function tg(e,n,i){i.props=ji(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(o){Fe(e,n,o)}}function Vr(e,n){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var o=e.stateNode;break;case 30:o=e.stateNode;break;default:o=e.stateNode}typeof i=="function"?e.refCleanup=i(o):i.current=o}}catch(c){Fe(e,n,c)}}function $n(e,n){var i=e.ref,o=e.refCleanup;if(i!==null)if(typeof o=="function")try{o()}catch(c){Fe(e,n,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(c){Fe(e,n,c)}else i.current=null}function ng(e){var n=e.type,i=e.memoizedProps,o=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":i.autoFocus&&o.focus();break e;case"img":i.src?o.src=i.src:i.srcSet&&(o.srcset=i.srcSet)}}catch(c){Fe(e,e.return,c)}}function Vd(e,n,i){try{var o=e.stateNode;QS(o,e.type,i,n),o[ft]=n}catch(c){Fe(e,e.return,c)}}function ag(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&ui(e.type)||e.tag===4}function $d(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ag(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&ui(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Xd(e,n,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,n):(n=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,n.appendChild(e),i=i._reactRootContainer,i!=null||n.onclick!==null||(n.onclick=Pl));else if(o!==4&&(o===27&&ui(e.type)&&(i=e.stateNode,n=null),e=e.child,e!==null))for(Xd(e,n,i),e=e.sibling;e!==null;)Xd(e,n,i),e=e.sibling}function ql(e,n,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?i.insertBefore(e,n):i.appendChild(e);else if(o!==4&&(o===27&&ui(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(ql(e,n,i),e=e.sibling;e!==null;)ql(e,n,i),e=e.sibling}function ig(e){var n=e.stateNode,i=e.memoizedProps;try{for(var o=e.type,c=n.attributes;c.length;)n.removeAttributeNode(c[0]);Ct(n,o,i),n[tt]=e,n[ft]=i}catch(d){Fe(e,e.return,d)}}var Ca=!1,lt=!1,Qd=!1,sg=typeof WeakSet=="function"?WeakSet:Set,Et=null;function _S(e,n){if(e=e.containerInfo,vf=ac,e=gp(e),$u(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var o=i.getSelection&&i.getSelection();if(o&&o.rangeCount!==0){i=o.anchorNode;var c=o.anchorOffset,d=o.focusNode;o=o.focusOffset;try{i.nodeType,d.nodeType}catch{i=null;break e}var y=0,M=-1,w=-1,O=0,Z=0,ie=e,j=null;t:for(;;){for(var G;ie!==i||c!==0&&ie.nodeType!==3||(M=y+c),ie!==d||o!==0&&ie.nodeType!==3||(w=y+o),ie.nodeType===3&&(y+=ie.nodeValue.length),(G=ie.firstChild)!==null;)j=ie,ie=G;for(;;){if(ie===e)break t;if(j===i&&++O===c&&(M=y),j===d&&++Z===o&&(w=y),(G=ie.nextSibling)!==null)break;ie=j,j=ie.parentNode}ie=G}i=M===-1||w===-1?null:{start:M,end:w}}else i=null}i=i||{start:0,end:0}}else i=null;for(Sf={focusedElem:e,selectionRange:i},ac=!1,Et=n;Et!==null;)if(n=Et,e=n.child,(n.subtreeFlags&1024)!==0&&e!==null)e.return=n,Et=e;else for(;Et!==null;){switch(n=Et,d=n.alternate,e=n.flags,n.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,i=n,c=d.memoizedProps,d=d.memoizedState,o=i.stateNode;try{var Se=ji(i.type,c,i.elementType===i.type);e=o.getSnapshotBeforeUpdate(Se,d),o.__reactInternalSnapshotBeforeUpdate=e}catch(ye){Fe(i,i.return,ye)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,i=e.nodeType,i===9)xf(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":xf(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(r(163))}if(e=n.sibling,e!==null){e.return=n.return,Et=e;break}Et=n.return}}function rg(e,n,i){var o=i.flags;switch(i.tag){case 0:case 11:case 15:ai(e,i),o&4&&Fr(5,i);break;case 1:if(ai(e,i),o&4)if(e=i.stateNode,n===null)try{e.componentDidMount()}catch(y){Fe(i,i.return,y)}else{var c=ji(i.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(c,n,e.__reactInternalSnapshotBeforeUpdate)}catch(y){Fe(i,i.return,y)}}o&64&&eg(i),o&512&&Vr(i,i.return);break;case 3:if(ai(e,i),o&64&&(e=i.updateQueue,e!==null)){if(n=null,i.child!==null)switch(i.child.tag){case 27:case 5:n=i.child.stateNode;break;case 1:n=i.child.stateNode}try{jp(e,n)}catch(y){Fe(i,i.return,y)}}break;case 27:n===null&&o&4&&ig(i);case 26:case 5:ai(e,i),n===null&&o&4&&ng(i),o&512&&Vr(i,i.return);break;case 12:ai(e,i);break;case 13:ai(e,i),o&4&&cg(e,i),o&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=zS.bind(null,i),tM(e,i))));break;case 22:if(o=i.memoizedState!==null||Ca,!o){n=n!==null&&n.memoizedState!==null||lt,c=Ca;var d=lt;Ca=o,(lt=n)&&!d?ii(e,i,(i.subtreeFlags&8772)!==0):ai(e,i),Ca=c,lt=d}break;case 30:break;default:ai(e,i)}}function og(e){var n=e.alternate;n!==null&&(e.alternate=null,og(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&ds(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ke=null,Qt=!1;function Ta(e,n,i){for(i=i.child;i!==null;)lg(e,n,i),i=i.sibling}function lg(e,n,i){if(Pe&&typeof Pe.onCommitFiberUnmount=="function")try{Pe.onCommitFiberUnmount(Qe,i)}catch{}switch(i.tag){case 26:lt||$n(i,n),Ta(e,n,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:lt||$n(i,n);var o=Ke,c=Qt;ui(i.type)&&(Ke=i.stateNode,Qt=!1),Ta(e,n,i),eo(i.stateNode),Ke=o,Qt=c;break;case 5:lt||$n(i,n);case 6:if(o=Ke,c=Qt,Ke=null,Ta(e,n,i),Ke=o,Qt=c,Ke!==null)if(Qt)try{(Ke.nodeType===9?Ke.body:Ke.nodeName==="HTML"?Ke.ownerDocument.body:Ke).removeChild(i.stateNode)}catch(d){Fe(i,n,d)}else try{Ke.removeChild(i.stateNode)}catch(d){Fe(i,n,d)}break;case 18:Ke!==null&&(Qt?(e=Ke,Pg(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),lo(e)):Pg(Ke,i.stateNode));break;case 4:o=Ke,c=Qt,Ke=i.stateNode.containerInfo,Qt=!0,Ta(e,n,i),Ke=o,Qt=c;break;case 0:case 11:case 14:case 15:lt||ni(2,i,n),lt||ni(4,i,n),Ta(e,n,i);break;case 1:lt||($n(i,n),o=i.stateNode,typeof o.componentWillUnmount=="function"&&tg(i,n,o)),Ta(e,n,i);break;case 21:Ta(e,n,i);break;case 22:lt=(o=lt)||i.memoizedState!==null,Ta(e,n,i),lt=o;break;default:Ta(e,n,i)}}function cg(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{lo(e)}catch(i){Fe(n,n.return,i)}}function NS(e){switch(e.tag){case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new sg),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new sg),n;default:throw Error(r(435,e.tag))}}function Kd(e,n){var i=NS(e);n.forEach(function(o){var c=BS.bind(null,e,o);i.has(o)||(i.add(o),o.then(c,c))})}function an(e,n){var i=n.deletions;if(i!==null)for(var o=0;o<i.length;o++){var c=i[o],d=e,y=n,M=y;e:for(;M!==null;){switch(M.tag){case 27:if(ui(M.type)){Ke=M.stateNode,Qt=!1;break e}break;case 5:Ke=M.stateNode,Qt=!1;break e;case 3:case 4:Ke=M.stateNode.containerInfo,Qt=!0;break e}M=M.return}if(Ke===null)throw Error(r(160));lg(d,y,c),Ke=null,Qt=!1,d=c.alternate,d!==null&&(d.return=null),c.return=null}if(n.subtreeFlags&13878)for(n=n.child;n!==null;)ug(n,e),n=n.sibling}var Nn=null;function ug(e,n){var i=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:an(n,e),sn(e),o&4&&(ni(3,e,e.return),Fr(3,e),ni(5,e,e.return));break;case 1:an(n,e),sn(e),o&512&&(lt||i===null||$n(i,i.return)),o&64&&Ca&&(e=e.updateQueue,e!==null&&(o=e.callbacks,o!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?o:i.concat(o))));break;case 26:var c=Nn;if(an(n,e),sn(e),o&512&&(lt||i===null||$n(i,i.return)),o&4){var d=i!==null?i.memoizedState:null;if(o=e.memoizedState,i===null)if(o===null)if(e.stateNode===null){e:{o=e.type,i=e.memoizedProps,c=c.ownerDocument||c;t:switch(o){case"title":d=c.getElementsByTagName("title")[0],(!d||d[wi]||d[tt]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=c.createElement(o),c.head.insertBefore(d,c.querySelector("head > title"))),Ct(d,o,i),d[tt]=e,nt(d),o=d;break e;case"link":var y=iy("link","href",c).get(o+(i.href||""));if(y){for(var M=0;M<y.length;M++)if(d=y[M],d.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&d.getAttribute("rel")===(i.rel==null?null:i.rel)&&d.getAttribute("title")===(i.title==null?null:i.title)&&d.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){y.splice(M,1);break t}}d=c.createElement(o),Ct(d,o,i),c.head.appendChild(d);break;case"meta":if(y=iy("meta","content",c).get(o+(i.content||""))){for(M=0;M<y.length;M++)if(d=y[M],d.getAttribute("content")===(i.content==null?null:""+i.content)&&d.getAttribute("name")===(i.name==null?null:i.name)&&d.getAttribute("property")===(i.property==null?null:i.property)&&d.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&d.getAttribute("charset")===(i.charSet==null?null:i.charSet)){y.splice(M,1);break t}}d=c.createElement(o),Ct(d,o,i),c.head.appendChild(d);break;default:throw Error(r(468,o))}d[tt]=e,nt(d),o=d}e.stateNode=o}else sy(c,e.type,e.stateNode);else e.stateNode=ay(c,o,e.memoizedProps);else d!==o?(d===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):d.count--,o===null?sy(c,e.type,e.stateNode):ay(c,o,e.memoizedProps)):o===null&&e.stateNode!==null&&Vd(e,e.memoizedProps,i.memoizedProps)}break;case 27:an(n,e),sn(e),o&512&&(lt||i===null||$n(i,i.return)),i!==null&&o&4&&Vd(e,e.memoizedProps,i.memoizedProps);break;case 5:if(an(n,e),sn(e),o&512&&(lt||i===null||$n(i,i.return)),e.flags&32){c=e.stateNode;try{hs(c,"")}catch(G){Fe(e,e.return,G)}}o&4&&e.stateNode!=null&&(c=e.memoizedProps,Vd(e,c,i!==null?i.memoizedProps:c)),o&1024&&(Qd=!0);break;case 6:if(an(n,e),sn(e),o&4){if(e.stateNode===null)throw Error(r(162));o=e.memoizedProps,i=e.stateNode;try{i.nodeValue=o}catch(G){Fe(e,e.return,G)}}break;case 3:if(ec=null,c=Nn,Nn=Jl(n.containerInfo),an(n,e),Nn=c,sn(e),o&4&&i!==null&&i.memoizedState.isDehydrated)try{lo(n.containerInfo)}catch(G){Fe(e,e.return,G)}Qd&&(Qd=!1,dg(e));break;case 4:o=Nn,Nn=Jl(e.stateNode.containerInfo),an(n,e),sn(e),Nn=o;break;case 12:an(n,e),sn(e);break;case 13:an(n,e),sn(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(tf=fe()),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Kd(e,o)));break;case 22:c=e.memoizedState!==null;var w=i!==null&&i.memoizedState!==null,O=Ca,Z=lt;if(Ca=O||c,lt=Z||w,an(n,e),lt=Z,Ca=O,sn(e),o&8192)e:for(n=e.stateNode,n._visibility=c?n._visibility&-2:n._visibility|1,c&&(i===null||w||Ca||lt||Gi(e)),i=null,n=e;;){if(n.tag===5||n.tag===26){if(i===null){w=i=n;try{if(d=w.stateNode,c)y=d.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{M=w.stateNode;var ie=w.memoizedProps.style,j=ie!=null&&ie.hasOwnProperty("display")?ie.display:null;M.style.display=j==null||typeof j=="boolean"?"":(""+j).trim()}}catch(G){Fe(w,w.return,G)}}}else if(n.tag===6){if(i===null){w=n;try{w.stateNode.nodeValue=c?"":w.memoizedProps}catch(G){Fe(w,w.return,G)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;i===n&&(i=null),n=n.return}i===n&&(i=null),n.sibling.return=n.return,n=n.sibling}o&4&&(o=e.updateQueue,o!==null&&(i=o.retryQueue,i!==null&&(o.retryQueue=null,Kd(e,i))));break;case 19:an(n,e),sn(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Kd(e,o)));break;case 30:break;case 21:break;default:an(n,e),sn(e)}}function sn(e){var n=e.flags;if(n&2){try{for(var i,o=e.return;o!==null;){if(ag(o)){i=o;break}o=o.return}if(i==null)throw Error(r(160));switch(i.tag){case 27:var c=i.stateNode,d=$d(e);ql(e,d,c);break;case 5:var y=i.stateNode;i.flags&32&&(hs(y,""),i.flags&=-33);var M=$d(e);ql(e,M,y);break;case 3:case 4:var w=i.stateNode.containerInfo,O=$d(e);Xd(e,O,w);break;default:throw Error(r(161))}}catch(Z){Fe(e,e.return,Z)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function dg(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;dg(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function ai(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)rg(e,n.alternate,n),n=n.sibling}function Gi(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:ni(4,n,n.return),Gi(n);break;case 1:$n(n,n.return);var i=n.stateNode;typeof i.componentWillUnmount=="function"&&tg(n,n.return,i),Gi(n);break;case 27:eo(n.stateNode);case 26:case 5:$n(n,n.return),Gi(n);break;case 22:n.memoizedState===null&&Gi(n);break;case 30:Gi(n);break;default:Gi(n)}e=e.sibling}}function ii(e,n,i){for(i=i&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var o=n.alternate,c=e,d=n,y=d.flags;switch(d.tag){case 0:case 11:case 15:ii(c,d,i),Fr(4,d);break;case 1:if(ii(c,d,i),o=d,c=o.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(O){Fe(o,o.return,O)}if(o=d,c=o.updateQueue,c!==null){var M=o.stateNode;try{var w=c.shared.hiddenCallbacks;if(w!==null)for(c.shared.hiddenCallbacks=null,c=0;c<w.length;c++)Hp(w[c],M)}catch(O){Fe(o,o.return,O)}}i&&y&64&&eg(d),Vr(d,d.return);break;case 27:ig(d);case 26:case 5:ii(c,d,i),i&&o===null&&y&4&&ng(d),Vr(d,d.return);break;case 12:ii(c,d,i);break;case 13:ii(c,d,i),i&&y&4&&cg(c,d);break;case 22:d.memoizedState===null&&ii(c,d,i),Vr(d,d.return);break;case 30:break;default:ii(c,d,i)}n=n.sibling}}function Pd(e,n){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Rr(i))}function Zd(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Rr(e))}function Xn(e,n,i,o){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)fg(e,n,i,o),n=n.sibling}function fg(e,n,i,o){var c=n.flags;switch(n.tag){case 0:case 11:case 15:Xn(e,n,i,o),c&2048&&Fr(9,n);break;case 1:Xn(e,n,i,o);break;case 3:Xn(e,n,i,o),c&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Rr(e)));break;case 12:if(c&2048){Xn(e,n,i,o),e=n.stateNode;try{var d=n.memoizedProps,y=d.id,M=d.onPostCommit;typeof M=="function"&&M(y,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(w){Fe(n,n.return,w)}}else Xn(e,n,i,o);break;case 13:Xn(e,n,i,o);break;case 23:break;case 22:d=n.stateNode,y=n.alternate,n.memoizedState!==null?d._visibility&2?Xn(e,n,i,o):$r(e,n):d._visibility&2?Xn(e,n,i,o):(d._visibility|=2,Ls(e,n,i,o,(n.subtreeFlags&10256)!==0)),c&2048&&Pd(y,n);break;case 24:Xn(e,n,i,o),c&2048&&Zd(n.alternate,n);break;default:Xn(e,n,i,o)}}function Ls(e,n,i,o,c){for(c=c&&(n.subtreeFlags&10256)!==0,n=n.child;n!==null;){var d=e,y=n,M=i,w=o,O=y.flags;switch(y.tag){case 0:case 11:case 15:Ls(d,y,M,w,c),Fr(8,y);break;case 23:break;case 22:var Z=y.stateNode;y.memoizedState!==null?Z._visibility&2?Ls(d,y,M,w,c):$r(d,y):(Z._visibility|=2,Ls(d,y,M,w,c)),c&&O&2048&&Pd(y.alternate,y);break;case 24:Ls(d,y,M,w,c),c&&O&2048&&Zd(y.alternate,y);break;default:Ls(d,y,M,w,c)}n=n.sibling}}function $r(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var i=e,o=n,c=o.flags;switch(o.tag){case 22:$r(i,o),c&2048&&Pd(o.alternate,o);break;case 24:$r(i,o),c&2048&&Zd(o.alternate,o);break;default:$r(i,o)}n=n.sibling}}var Xr=8192;function Ds(e){if(e.subtreeFlags&Xr)for(e=e.child;e!==null;)hg(e),e=e.sibling}function hg(e){switch(e.tag){case 26:Ds(e),e.flags&Xr&&e.memoizedState!==null&&mM(Nn,e.memoizedState,e.memoizedProps);break;case 5:Ds(e);break;case 3:case 4:var n=Nn;Nn=Jl(e.stateNode.containerInfo),Ds(e),Nn=n;break;case 22:e.memoizedState===null&&(n=e.alternate,n!==null&&n.memoizedState!==null?(n=Xr,Xr=16777216,Ds(e),Xr=n):Ds(e));break;default:Ds(e)}}function mg(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Qr(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];Et=o,gg(o,e)}mg(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)pg(e),e=e.sibling}function pg(e){switch(e.tag){case 0:case 11:case 15:Qr(e),e.flags&2048&&ni(9,e,e.return);break;case 3:Qr(e);break;case 12:Qr(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,Hl(e)):Qr(e);break;default:Qr(e)}}function Hl(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];Et=o,gg(o,e)}mg(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:ni(8,n,n.return),Hl(n);break;case 22:i=n.stateNode,i._visibility&2&&(i._visibility&=-3,Hl(n));break;default:Hl(n)}e=e.sibling}}function gg(e,n){for(;Et!==null;){var i=Et;switch(i.tag){case 0:case 11:case 15:ni(8,i,n);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var o=i.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:Rr(i.memoizedState.cache)}if(o=i.child,o!==null)o.return=i,Et=o;else e:for(i=e;Et!==null;){o=Et;var c=o.sibling,d=o.return;if(og(o),o===i){Et=null;break e}if(c!==null){c.return=d,Et=c;break e}Et=d}}}var RS={getCacheForType:function(e){var n=Nt(mt),i=n.data.get(e);return i===void 0&&(i=e(),n.data.set(e,i)),i}},kS=typeof WeakMap=="function"?WeakMap:Map,De=0,Ve=null,we=null,Re=0,Ie=0,rn=null,si=!1,Is=!1,Jd=!1,_a=0,rt=0,ri=0,Yi=0,Wd=0,bn=0,Us=0,Kr=null,Kt=null,ef=!1,tf=0,jl=1/0,Gl=null,oi=null,wt=0,li=null,Os=null,zs=0,nf=0,af=null,yg=null,Pr=0,sf=null;function on(){if((De&2)!==0&&Re!==0)return Re&-Re;if(D.T!==null){var e=As;return e!==0?e:ff()}return Ko()}function bg(){bn===0&&(bn=(Re&536870912)===0||Le?$o():536870912);var e=yn.current;return e!==null&&(e.flags|=32),bn}function ln(e,n,i){(e===Ve&&(Ie===2||Ie===9)||e.cancelPendingCommit!==null)&&(Bs(e,0),ci(e,Re,bn,!1)),Hn(e,i),((De&2)===0||e!==Ve)&&(e===Ve&&((De&2)===0&&(Yi|=i),rt===4&&ci(e,Re,bn,!1)),Qn(e))}function vg(e,n,i){if((De&6)!==0)throw Error(r(327));var o=!i&&(n&124)===0&&(n&e.expiredLanes)===0||ua(e,n),c=o?IS(e,n):lf(e,n,!0),d=o;do{if(c===0){Is&&!o&&ci(e,n,0,!1);break}else{if(i=e.current.alternate,d&&!LS(i)){c=lf(e,n,!1),d=!1;continue}if(c===2){if(d=n,e.errorRecoveryDisabledLanes&d)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){n=y;e:{var M=e;c=Kr;var w=M.current.memoizedState.isDehydrated;if(w&&(Bs(M,y).flags|=256),y=lf(M,y,!1),y!==2){if(Jd&&!w){M.errorRecoveryDisabledLanes|=d,Yi|=d,c=4;break e}d=Kt,Kt=c,d!==null&&(Kt===null?Kt=d:Kt.push.apply(Kt,d))}c=y}if(d=!1,c!==2)continue}}if(c===1){Bs(e,0),ci(e,n,0,!0);break}e:{switch(o=e,d=c,d){case 0:case 1:throw Error(r(345));case 4:if((n&4194048)!==n)break;case 6:ci(o,n,bn,!si);break e;case 2:Kt=null;break;case 3:case 5:break;default:throw Error(r(329))}if((n&62914560)===n&&(c=tf+300-fe(),10<c)){if(ci(o,n,bn,!si),xi(o,0,!0)!==0)break e;o.timeoutHandle=Qg(Sg.bind(null,o,i,Kt,Gl,ef,n,bn,Yi,Us,si,d,2,-0,0),c);break e}Sg(o,i,Kt,Gl,ef,n,bn,Yi,Us,si,d,0,-0,0)}}break}while(!0);Qn(e)}function Sg(e,n,i,o,c,d,y,M,w,O,Z,ie,j,G){if(e.timeoutHandle=-1,ie=n.subtreeFlags,(ie&8192||(ie&16785408)===16785408)&&(ao={stylesheets:null,count:0,unsuspend:hM},hg(n),ie=pM(),ie!==null)){e.cancelPendingCommit=ie(Tg.bind(null,e,n,d,i,o,c,y,M,w,Z,1,j,G)),ci(e,d,y,!O);return}Tg(e,n,d,i,o,c,y,M,w)}function LS(e){for(var n=e;;){var i=n.tag;if((i===0||i===11||i===15)&&n.flags&16384&&(i=n.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var o=0;o<i.length;o++){var c=i[o],d=c.getSnapshot;c=c.value;try{if(!tn(d(),c))return!1}catch{return!1}}if(i=n.child,n.subtreeFlags&16384&&i!==null)i.return=n,n=i;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function ci(e,n,i,o){n&=~Wd,n&=~Yi,e.suspendedLanes|=n,e.pingedLanes&=~n,o&&(e.warmLanes|=n),o=e.expirationTimes;for(var c=n;0<c;){var d=31-_t(c),y=1<<d;o[d]=-1,c&=~y}i!==0&&hr(e,i,n)}function Yl(){return(De&6)===0?(Zr(0),!1):!0}function rf(){if(we!==null){if(Ie===0)var e=we.return;else e=we,Sa=zi=null,Ed(e),Rs=null,jr=0,e=we;for(;e!==null;)W0(e.alternate,e),e=e.return;we=null}}function Bs(e,n){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,PS(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),rf(),Ve=e,we=i=ya(e.current,null),Re=n,Ie=0,rn=null,si=!1,Is=ua(e,n),Jd=!1,Us=bn=Wd=Yi=ri=rt=0,Kt=Kr=null,ef=!1,(n&8)!==0&&(n|=n&32);var o=e.entangledLanes;if(o!==0)for(e=e.entanglements,o&=n;0<o;){var c=31-_t(o),d=1<<c;n|=e[c],o&=~d}return _a=n,dl(),i}function Mg(e,n){Ee=null,D.H=Rl,n===Lr||n===Sl?(n=Bp(),Ie=3):n===Up?(n=Bp(),Ie=4):Ie=n===q0?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,rn=n,we===null&&(rt=1,Ul(e,hn(n,e.current)))}function Eg(){var e=D.H;return D.H=Rl,e===null?Rl:e}function xg(){var e=D.A;return D.A=RS,e}function of(){rt=4,si||(Re&4194048)!==Re&&yn.current!==null||(Is=!0),(ri&134217727)===0&&(Yi&134217727)===0||Ve===null||ci(Ve,Re,bn,!1)}function lf(e,n,i){var o=De;De|=2;var c=Eg(),d=xg();(Ve!==e||Re!==n)&&(Gl=null,Bs(e,n)),n=!1;var y=rt;e:do try{if(Ie!==0&&we!==null){var M=we,w=rn;switch(Ie){case 8:rf(),y=6;break e;case 3:case 2:case 9:case 6:yn.current===null&&(n=!0);var O=Ie;if(Ie=0,rn=null,qs(e,M,w,O),i&&Is){y=0;break e}break;default:O=Ie,Ie=0,rn=null,qs(e,M,w,O)}}DS(),y=rt;break}catch(Z){Mg(e,Z)}while(!0);return n&&e.shellSuspendCounter++,Sa=zi=null,De=o,D.H=c,D.A=d,we===null&&(Ve=null,Re=0,dl()),y}function DS(){for(;we!==null;)Ag(we)}function IS(e,n){var i=De;De|=2;var o=Eg(),c=xg();Ve!==e||Re!==n?(Gl=null,jl=fe()+500,Bs(e,n)):Is=ua(e,n);e:do try{if(Ie!==0&&we!==null){n=we;var d=rn;t:switch(Ie){case 1:Ie=0,rn=null,qs(e,n,d,1);break;case 2:case 9:if(Op(d)){Ie=0,rn=null,wg(n);break}n=function(){Ie!==2&&Ie!==9||Ve!==e||(Ie=7),Qn(e)},d.then(n,n);break e;case 3:Ie=7;break e;case 4:Ie=5;break e;case 7:Op(d)?(Ie=0,rn=null,wg(n)):(Ie=0,rn=null,qs(e,n,d,7));break;case 5:var y=null;switch(we.tag){case 26:y=we.memoizedState;case 5:case 27:var M=we;if(!y||ry(y)){Ie=0,rn=null;var w=M.sibling;if(w!==null)we=w;else{var O=M.return;O!==null?(we=O,Fl(O)):we=null}break t}}Ie=0,rn=null,qs(e,n,d,5);break;case 6:Ie=0,rn=null,qs(e,n,d,6);break;case 8:rf(),rt=6;break e;default:throw Error(r(462))}}US();break}catch(Z){Mg(e,Z)}while(!0);return Sa=zi=null,D.H=o,D.A=c,De=i,we!==null?0:(Ve=null,Re=0,dl(),rt)}function US(){for(;we!==null&&!la();)Ag(we)}function Ag(e){var n=Z0(e.alternate,e,_a);e.memoizedProps=e.pendingProps,n===null?Fl(e):we=n}function wg(e){var n=e,i=n.alternate;switch(n.tag){case 15:case 0:n=V0(i,n,n.pendingProps,n.type,void 0,Re);break;case 11:n=V0(i,n,n.pendingProps,n.type.render,n.ref,Re);break;case 5:Ed(n);default:W0(i,n),n=we=Cp(n,_a),n=Z0(i,n,_a)}e.memoizedProps=e.pendingProps,n===null?Fl(e):we=n}function qs(e,n,i,o){Sa=zi=null,Ed(n),Rs=null,jr=0;var c=n.return;try{if(AS(e,c,n,i,Re)){rt=1,Ul(e,hn(i,e.current)),we=null;return}}catch(d){if(c!==null)throw we=c,d;rt=1,Ul(e,hn(i,e.current)),we=null;return}n.flags&32768?(Le||o===1?e=!0:Is||(Re&536870912)!==0?e=!1:(si=e=!0,(o===2||o===9||o===3||o===6)&&(o=yn.current,o!==null&&o.tag===13&&(o.flags|=16384))),Cg(n,e)):Fl(n)}function Fl(e){var n=e;do{if((n.flags&32768)!==0){Cg(n,si);return}e=n.return;var i=CS(n.alternate,n,_a);if(i!==null){we=i;return}if(n=n.sibling,n!==null){we=n;return}we=n=e}while(n!==null);rt===0&&(rt=5)}function Cg(e,n){do{var i=TS(e.alternate,e);if(i!==null){i.flags&=32767,we=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!n&&(e=e.sibling,e!==null)){we=e;return}we=e=i}while(e!==null);rt=6,we=null}function Tg(e,n,i,o,c,d,y,M,w){e.cancelPendingCommit=null;do Vl();while(wt!==0);if((De&6)!==0)throw Error(r(327));if(n!==null){if(n===e.current)throw Error(r(177));if(d=n.lanes|n.childLanes,d|=Zu,Qo(e,i,d,y,M,w),e===Ve&&(we=Ve=null,Re=0),Os=n,li=e,zs=i,nf=d,af=c,yg=o,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,qS(vt,function(){return Lg(),null})):(e.callbackNode=null,e.callbackPriority=0),o=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||o){o=D.T,D.T=null,c=P.p,P.p=2,y=De,De|=4;try{_S(e,n,i)}finally{De=y,P.p=c,D.T=o}}wt=1,_g(),Ng(),Rg()}}function _g(){if(wt===1){wt=0;var e=li,n=Os,i=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||i){i=D.T,D.T=null;var o=P.p;P.p=2;var c=De;De|=4;try{ug(n,e);var d=Sf,y=gp(e.containerInfo),M=d.focusedElem,w=d.selectionRange;if(y!==M&&M&&M.ownerDocument&&pp(M.ownerDocument.documentElement,M)){if(w!==null&&$u(M)){var O=w.start,Z=w.end;if(Z===void 0&&(Z=O),"selectionStart"in M)M.selectionStart=O,M.selectionEnd=Math.min(Z,M.value.length);else{var ie=M.ownerDocument||document,j=ie&&ie.defaultView||window;if(j.getSelection){var G=j.getSelection(),Se=M.textContent.length,ye=Math.min(w.start,Se),He=w.end===void 0?ye:Math.min(w.end,Se);!G.extend&&ye>He&&(y=He,He=ye,ye=y);var L=mp(M,ye),N=mp(M,He);if(L&&N&&(G.rangeCount!==1||G.anchorNode!==L.node||G.anchorOffset!==L.offset||G.focusNode!==N.node||G.focusOffset!==N.offset)){var I=ie.createRange();I.setStart(L.node,L.offset),G.removeAllRanges(),ye>He?(G.addRange(I),G.extend(N.node,N.offset)):(I.setEnd(N.node,N.offset),G.addRange(I))}}}}for(ie=[],G=M;G=G.parentNode;)G.nodeType===1&&ie.push({element:G,left:G.scrollLeft,top:G.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<ie.length;M++){var te=ie[M];te.element.scrollLeft=te.left,te.element.scrollTop=te.top}}ac=!!vf,Sf=vf=null}finally{De=c,P.p=o,D.T=i}}e.current=n,wt=2}}function Ng(){if(wt===2){wt=0;var e=li,n=Os,i=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||i){i=D.T,D.T=null;var o=P.p;P.p=2;var c=De;De|=4;try{rg(e,n.alternate,n)}finally{De=c,P.p=o,D.T=i}}wt=3}}function Rg(){if(wt===4||wt===3){wt=0,dn();var e=li,n=Os,i=zs,o=yg;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?wt=5:(wt=0,Os=li=null,kg(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(oi=null),gr(i),n=n.stateNode,Pe&&typeof Pe.onCommitFiberRoot=="function")try{Pe.onCommitFiberRoot(Qe,n,void 0,(n.current.flags&128)===128)}catch{}if(o!==null){n=D.T,c=P.p,P.p=2,D.T=null;try{for(var d=e.onRecoverableError,y=0;y<o.length;y++){var M=o[y];d(M.value,{componentStack:M.stack})}}finally{D.T=n,P.p=c}}(zs&3)!==0&&Vl(),Qn(e),c=e.pendingLanes,(i&4194090)!==0&&(c&42)!==0?e===sf?Pr++:(Pr=0,sf=e):Pr=0,Zr(0)}}function kg(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,Rr(n)))}function Vl(e){return _g(),Ng(),Rg(),Lg()}function Lg(){if(wt!==5)return!1;var e=li,n=nf;nf=0;var i=gr(zs),o=D.T,c=P.p;try{P.p=32>i?32:i,D.T=null,i=af,af=null;var d=li,y=zs;if(wt=0,Os=li=null,zs=0,(De&6)!==0)throw Error(r(331));var M=De;if(De|=4,pg(d.current),fg(d,d.current,y,i),De=M,Zr(0,!1),Pe&&typeof Pe.onPostCommitFiberRoot=="function")try{Pe.onPostCommitFiberRoot(Qe,d)}catch{}return!0}finally{P.p=c,D.T=o,kg(e,n)}}function Dg(e,n,i){n=hn(i,n),n=Od(e.stateNode,n,2),e=Ja(e,n,2),e!==null&&(Hn(e,2),Qn(e))}function Fe(e,n,i){if(e.tag===3)Dg(e,e,i);else for(;n!==null;){if(n.tag===3){Dg(n,e,i);break}else if(n.tag===1){var o=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(oi===null||!oi.has(o))){e=hn(i,e),i=z0(2),o=Ja(n,i,2),o!==null&&(B0(i,o,n,e),Hn(o,2),Qn(o));break}}n=n.return}}function cf(e,n,i){var o=e.pingCache;if(o===null){o=e.pingCache=new kS;var c=new Set;o.set(n,c)}else c=o.get(n),c===void 0&&(c=new Set,o.set(n,c));c.has(i)||(Jd=!0,c.add(i),e=OS.bind(null,e,n,i),n.then(e,e))}function OS(e,n,i){var o=e.pingCache;o!==null&&o.delete(n),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Ve===e&&(Re&i)===i&&(rt===4||rt===3&&(Re&62914560)===Re&&300>fe()-tf?(De&2)===0&&Bs(e,0):Wd|=i,Us===Re&&(Us=0)),Qn(e)}function Ig(e,n){n===0&&(n=Xo()),e=Ss(e,n),e!==null&&(Hn(e,n),Qn(e))}function zS(e){var n=e.memoizedState,i=0;n!==null&&(i=n.retryLane),Ig(e,i)}function BS(e,n){var i=0;switch(e.tag){case 13:var o=e.stateNode,c=e.memoizedState;c!==null&&(i=c.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(r(314))}o!==null&&o.delete(n),Ig(e,i)}function qS(e,n){return Bn(e,n)}var $l=null,Hs=null,uf=!1,Xl=!1,df=!1,Fi=0;function Qn(e){e!==Hs&&e.next===null&&(Hs===null?$l=Hs=e:Hs=Hs.next=e),Xl=!0,uf||(uf=!0,jS())}function Zr(e,n){if(!df&&Xl){df=!0;do for(var i=!1,o=$l;o!==null;){if(e!==0){var c=o.pendingLanes;if(c===0)var d=0;else{var y=o.suspendedLanes,M=o.pingedLanes;d=(1<<31-_t(42|e)+1)-1,d&=c&~(y&~M),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(i=!0,Bg(o,d))}else d=Re,d=xi(o,o===Ve?d:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),(d&3)===0||ua(o,d)||(i=!0,Bg(o,d));o=o.next}while(i);df=!1}}function HS(){Ug()}function Ug(){Xl=uf=!1;var e=0;Fi!==0&&(KS()&&(e=Fi),Fi=0);for(var n=fe(),i=null,o=$l;o!==null;){var c=o.next,d=Og(o,n);d===0?(o.next=null,i===null?$l=c:i.next=c,c===null&&(Hs=i)):(i=o,(e!==0||(d&3)!==0)&&(Xl=!0)),o=c}Zr(e)}function Og(e,n){for(var i=e.suspendedLanes,o=e.pingedLanes,c=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var y=31-_t(d),M=1<<y,w=c[y];w===-1?((M&i)===0||(M&o)!==0)&&(c[y]=Lu(M,n)):w<=n&&(e.expiredLanes|=M),d&=~M}if(n=Ve,i=Re,i=xi(e,e===n?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o=e.callbackNode,i===0||e===n&&(Ie===2||Ie===9)||e.cancelPendingCommit!==null)return o!==null&&o!==null&&ja(o),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||ua(e,i)){if(n=i&-i,n===e.callbackPriority)return n;switch(o!==null&&ja(o),gr(i)){case 2:case 8:i=ze;break;case 32:i=vt;break;case 268435456:i=Zt;break;default:i=vt}return o=zg.bind(null,e),i=Bn(i,o),e.callbackPriority=n,e.callbackNode=i,n}return o!==null&&o!==null&&ja(o),e.callbackPriority=2,e.callbackNode=null,2}function zg(e,n){if(wt!==0&&wt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(Vl()&&e.callbackNode!==i)return null;var o=Re;return o=xi(e,e===Ve?o:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o===0?null:(vg(e,o,n),Og(e,fe()),e.callbackNode!=null&&e.callbackNode===i?zg.bind(null,e):null)}function Bg(e,n){if(Vl())return null;vg(e,n,!0)}function jS(){ZS(function(){(De&6)!==0?Bn(Ge,HS):Ug()})}function ff(){return Fi===0&&(Fi=$o()),Fi}function qg(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:il(""+e)}function Hg(e,n){var i=n.ownerDocument.createElement("input");return i.name=n.name,i.value=n.value,e.id&&i.setAttribute("form",e.id),n.parentNode.insertBefore(i,n),e=new FormData(e),i.parentNode.removeChild(i),e}function GS(e,n,i,o,c){if(n==="submit"&&i&&i.stateNode===c){var d=qg((c[ft]||null).action),y=o.submitter;y&&(n=(n=y[ft]||null)?qg(n.formAction):y.getAttribute("formAction"),n!==null&&(d=n,y=null));var M=new ll("action","action",null,o,c);e.push({event:M,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(Fi!==0){var w=y?Hg(c,y):new FormData(c);kd(i,{pending:!0,data:w,method:c.method,action:d},null,w)}}else typeof d=="function"&&(M.preventDefault(),w=y?Hg(c,y):new FormData(c),kd(i,{pending:!0,data:w,method:c.method,action:d},d,w))},currentTarget:c}]})}}for(var hf=0;hf<Pu.length;hf++){var mf=Pu[hf],YS=mf.toLowerCase(),FS=mf[0].toUpperCase()+mf.slice(1);_n(YS,"on"+FS)}_n(vp,"onAnimationEnd"),_n(Sp,"onAnimationIteration"),_n(Mp,"onAnimationStart"),_n("dblclick","onDoubleClick"),_n("focusin","onFocus"),_n("focusout","onBlur"),_n(oS,"onTransitionRun"),_n(lS,"onTransitionStart"),_n(cS,"onTransitionCancel"),_n(Ep,"onTransitionEnd"),Va("onMouseEnter",["mouseout","mouseover"]),Va("onMouseLeave",["mouseout","mouseover"]),Va("onPointerEnter",["pointerout","pointerover"]),Va("onPointerLeave",["pointerout","pointerover"]),Gn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),VS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Jr));function jg(e,n){n=(n&4)!==0;for(var i=0;i<e.length;i++){var o=e[i],c=o.event;o=o.listeners;e:{var d=void 0;if(n)for(var y=o.length-1;0<=y;y--){var M=o[y],w=M.instance,O=M.currentTarget;if(M=M.listener,w!==d&&c.isPropagationStopped())break e;d=M,c.currentTarget=O;try{d(c)}catch(Z){Il(Z)}c.currentTarget=null,d=w}else for(y=0;y<o.length;y++){if(M=o[y],w=M.instance,O=M.currentTarget,M=M.listener,w!==d&&c.isPropagationStopped())break e;d=M,c.currentTarget=O;try{d(c)}catch(Z){Il(Z)}c.currentTarget=null,d=w}}}}function Ce(e,n){var i=n[Ya];i===void 0&&(i=n[Ya]=new Set);var o=e+"__bubble";i.has(o)||(Gg(n,e,2,!1),i.add(o))}function pf(e,n,i){var o=0;n&&(o|=4),Gg(i,e,o,n)}var Ql="_reactListening"+Math.random().toString(36).slice(2);function gf(e){if(!e[Ql]){e[Ql]=!0,fs.forEach(function(i){i!=="selectionchange"&&(VS.has(i)||pf(i,!1,e),pf(i,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[Ql]||(n[Ql]=!0,pf("selectionchange",!1,n))}}function Gg(e,n,i,o){switch(fy(n)){case 2:var c=bM;break;case 8:c=vM;break;default:c=Rf}i=c.bind(null,n,i,e),c=void 0,!zu||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(c=!0),o?c!==void 0?e.addEventListener(n,i,{capture:!0,passive:c}):e.addEventListener(n,i,!0):c!==void 0?e.addEventListener(n,i,{passive:c}):e.addEventListener(n,i,!1)}function yf(e,n,i,o,c){var d=o;if((n&1)===0&&(n&2)===0&&o!==null)e:for(;;){if(o===null)return;var y=o.tag;if(y===3||y===4){var M=o.stateNode.containerInfo;if(M===c)break;if(y===4)for(y=o.return;y!==null;){var w=y.tag;if((w===3||w===4)&&y.stateNode.containerInfo===c)return;y=y.return}for(;M!==null;){if(y=fa(M),y===null)return;if(w=y.tag,w===5||w===6||w===26||w===27){o=d=y;continue e}M=M.parentNode}}o=o.return}Km(function(){var O=d,Z=Uu(i),ie=[];e:{var j=xp.get(e);if(j!==void 0){var G=ll,Se=e;switch(e){case"keypress":if(rl(i)===0)break e;case"keydown":case"keyup":G=q1;break;case"focusin":Se="focus",G=ju;break;case"focusout":Se="blur",G=ju;break;case"beforeblur":case"afterblur":G=ju;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=Jm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=T1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=G1;break;case vp:case Sp:case Mp:G=R1;break;case Ep:G=F1;break;case"scroll":case"scrollend":G=w1;break;case"wheel":G=$1;break;case"copy":case"cut":case"paste":G=L1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=ep;break;case"toggle":case"beforetoggle":G=Q1}var ye=(n&4)!==0,He=!ye&&(e==="scroll"||e==="scrollend"),L=ye?j!==null?j+"Capture":null:j;ye=[];for(var N=O,I;N!==null;){var te=N;if(I=te.stateNode,te=te.tag,te!==5&&te!==26&&te!==27||I===null||L===null||(te=yr(N,L),te!=null&&ye.push(Wr(N,te,I))),He)break;N=N.return}0<ye.length&&(j=new G(j,Se,null,i,Z),ie.push({event:j,listeners:ye}))}}if((n&7)===0){e:{if(j=e==="mouseover"||e==="pointerover",G=e==="mouseout"||e==="pointerout",j&&i!==Iu&&(Se=i.relatedTarget||i.fromElement)&&(fa(Se)||Se[da]))break e;if((G||j)&&(j=Z.window===Z?Z:(j=Z.ownerDocument)?j.defaultView||j.parentWindow:window,G?(Se=i.relatedTarget||i.toElement,G=O,Se=Se?fa(Se):null,Se!==null&&(He=u(Se),ye=Se.tag,Se!==He||ye!==5&&ye!==27&&ye!==6)&&(Se=null)):(G=null,Se=O),G!==Se)){if(ye=Jm,te="onMouseLeave",L="onMouseEnter",N="mouse",(e==="pointerout"||e==="pointerover")&&(ye=ep,te="onPointerLeave",L="onPointerEnter",N="pointer"),He=G==null?j:ha(G),I=Se==null?j:ha(Se),j=new ye(te,N+"leave",G,i,Z),j.target=He,j.relatedTarget=I,te=null,fa(Z)===O&&(ye=new ye(L,N+"enter",Se,i,Z),ye.target=I,ye.relatedTarget=He,te=ye),He=te,G&&Se)t:{for(ye=G,L=Se,N=0,I=ye;I;I=js(I))N++;for(I=0,te=L;te;te=js(te))I++;for(;0<N-I;)ye=js(ye),N--;for(;0<I-N;)L=js(L),I--;for(;N--;){if(ye===L||L!==null&&ye===L.alternate)break t;ye=js(ye),L=js(L)}ye=null}else ye=null;G!==null&&Yg(ie,j,G,ye,!1),Se!==null&&He!==null&&Yg(ie,He,Se,ye,!0)}}e:{if(j=O?ha(O):window,G=j.nodeName&&j.nodeName.toLowerCase(),G==="select"||G==="input"&&j.type==="file")var he=lp;else if(rp(j))if(cp)he=iS;else{he=nS;var Ae=tS}else G=j.nodeName,!G||G.toLowerCase()!=="input"||j.type!=="checkbox"&&j.type!=="radio"?O&&Du(O.elementType)&&(he=lp):he=aS;if(he&&(he=he(e,O))){op(ie,he,i,Z);break e}Ae&&Ae(e,j,O),e==="focusout"&&O&&j.type==="number"&&O.memoizedProps.value!=null&&Xa(j,"number",j.value)}switch(Ae=O?ha(O):window,e){case"focusin":(rp(Ae)||Ae.contentEditable==="true")&&(ys=Ae,Xu=O,wr=null);break;case"focusout":wr=Xu=ys=null;break;case"mousedown":Qu=!0;break;case"contextmenu":case"mouseup":case"dragend":Qu=!1,yp(ie,i,Z);break;case"selectionchange":if(rS)break;case"keydown":case"keyup":yp(ie,i,Z)}var pe;if(Yu)e:{switch(e){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else gs?ip(e,i)&&(be="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(be="onCompositionStart");be&&(tp&&i.locale!=="ko"&&(gs||be!=="onCompositionStart"?be==="onCompositionEnd"&&gs&&(pe=Pm()):(Qa=Z,Bu="value"in Qa?Qa.value:Qa.textContent,gs=!0)),Ae=Kl(O,be),0<Ae.length&&(be=new Wm(be,e,null,i,Z),ie.push({event:be,listeners:Ae}),pe?be.data=pe:(pe=sp(i),pe!==null&&(be.data=pe)))),(pe=P1?Z1(e,i):J1(e,i))&&(be=Kl(O,"onBeforeInput"),0<be.length&&(Ae=new Wm("onBeforeInput","beforeinput",null,i,Z),ie.push({event:Ae,listeners:be}),Ae.data=pe)),GS(ie,e,O,i,Z)}jg(ie,n)})}function Wr(e,n,i){return{instance:e,listener:n,currentTarget:i}}function Kl(e,n){for(var i=n+"Capture",o=[];e!==null;){var c=e,d=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||d===null||(c=yr(e,i),c!=null&&o.unshift(Wr(e,c,d)),c=yr(e,n),c!=null&&o.push(Wr(e,c,d))),e.tag===3)return o;e=e.return}return[]}function js(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Yg(e,n,i,o,c){for(var d=n._reactName,y=[];i!==null&&i!==o;){var M=i,w=M.alternate,O=M.stateNode;if(M=M.tag,w!==null&&w===o)break;M!==5&&M!==26&&M!==27||O===null||(w=O,c?(O=yr(i,d),O!=null&&y.unshift(Wr(i,O,w))):c||(O=yr(i,d),O!=null&&y.push(Wr(i,O,w)))),i=i.return}y.length!==0&&e.push({event:n,listeners:y})}var $S=/\r\n?/g,XS=/\u0000|\uFFFD/g;function Fg(e){return(typeof e=="string"?e:""+e).replace($S,`
`).replace(XS,"")}function Vg(e,n){return n=Fg(n),Fg(e)===n}function Pl(){}function qe(e,n,i,o,c,d){switch(i){case"children":typeof o=="string"?n==="body"||n==="textarea"&&o===""||hs(e,o):(typeof o=="number"||typeof o=="bigint")&&n!=="body"&&hs(e,""+o);break;case"className":Ti(e,"class",o);break;case"tabIndex":Ti(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":Ti(e,i,o);break;case"style":Xm(e,o,d);break;case"data":if(n!=="object"){Ti(e,"data",o);break}case"src":case"href":if(o===""&&(n!=="a"||i!=="href")){e.removeAttribute(i);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(i);break}o=il(""+o),e.setAttribute(i,o);break;case"action":case"formAction":if(typeof o=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(i==="formAction"?(n!=="input"&&qe(e,n,"name",c.name,c,null),qe(e,n,"formEncType",c.formEncType,c,null),qe(e,n,"formMethod",c.formMethod,c,null),qe(e,n,"formTarget",c.formTarget,c,null)):(qe(e,n,"encType",c.encType,c,null),qe(e,n,"method",c.method,c,null),qe(e,n,"target",c.target,c,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(i);break}o=il(""+o),e.setAttribute(i,o);break;case"onClick":o!=null&&(e.onclick=Pl);break;case"onScroll":o!=null&&Ce("scroll",e);break;case"onScrollEnd":o!=null&&Ce("scrollend",e);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(i=o.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"multiple":e.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":e.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){e.removeAttribute("xlink:href");break}i=il(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,""+o):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":o===!0?e.setAttribute(i,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,o):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?e.setAttribute(i,o):e.removeAttribute(i);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?e.removeAttribute(i):e.setAttribute(i,o);break;case"popover":Ce("beforetoggle",e),Ce("toggle",e),Ci(e,"popover",o);break;case"xlinkActuate":Tn(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":Tn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":Tn(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":Tn(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":Tn(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":Tn(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":Tn(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":Tn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":Tn(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":Ci(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=x1.get(i)||i,Ci(e,i,o))}}function bf(e,n,i,o,c,d){switch(i){case"style":Xm(e,o,d);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(i=o.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"children":typeof o=="string"?hs(e,o):(typeof o=="number"||typeof o=="bigint")&&hs(e,""+o);break;case"onScroll":o!=null&&Ce("scroll",e);break;case"onScrollEnd":o!=null&&Ce("scrollend",e);break;case"onClick":o!=null&&(e.onclick=Pl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Zo.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(c=i.endsWith("Capture"),n=i.slice(2,c?i.length-7:void 0),d=e[ft]||null,d=d!=null?d[i]:null,typeof d=="function"&&e.removeEventListener(n,d,c),typeof o=="function")){typeof d!="function"&&d!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(n,o,c);break e}i in e?e[i]=o:o===!0?e.setAttribute(i,""):Ci(e,i,o)}}}function Ct(e,n,i){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ce("error",e),Ce("load",e);var o=!1,c=!1,d;for(d in i)if(i.hasOwnProperty(d)){var y=i[d];if(y!=null)switch(d){case"src":o=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,n));default:qe(e,n,d,y,i,null)}}c&&qe(e,n,"srcSet",i.srcSet,i,null),o&&qe(e,n,"src",i.src,i,null);return;case"input":Ce("invalid",e);var M=d=y=c=null,w=null,O=null;for(o in i)if(i.hasOwnProperty(o)){var Z=i[o];if(Z!=null)switch(o){case"name":c=Z;break;case"type":y=Z;break;case"checked":w=Z;break;case"defaultChecked":O=Z;break;case"value":d=Z;break;case"defaultValue":M=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(r(137,n));break;default:qe(e,n,o,Z,i,null)}}$a(e,d,M,w,O,y,c,!1),St(e);return;case"select":Ce("invalid",e),o=y=d=null;for(c in i)if(i.hasOwnProperty(c)&&(M=i[c],M!=null))switch(c){case"value":d=M;break;case"defaultValue":y=M;break;case"multiple":o=M;default:qe(e,n,c,M,i,null)}n=d,i=y,e.multiple=!!o,n!=null?pa(e,!!o,n,!1):i!=null&&pa(e,!!o,i,!0);return;case"textarea":Ce("invalid",e),d=c=o=null;for(y in i)if(i.hasOwnProperty(y)&&(M=i[y],M!=null))switch(y){case"value":o=M;break;case"defaultValue":c=M;break;case"children":d=M;break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(r(91));break;default:qe(e,n,y,M,i,null)}al(e,o,c,d),St(e);return;case"option":for(w in i)if(i.hasOwnProperty(w)&&(o=i[w],o!=null))switch(w){case"selected":e.selected=o&&typeof o!="function"&&typeof o!="symbol";break;default:qe(e,n,w,o,i,null)}return;case"dialog":Ce("beforetoggle",e),Ce("toggle",e),Ce("cancel",e),Ce("close",e);break;case"iframe":case"object":Ce("load",e);break;case"video":case"audio":for(o=0;o<Jr.length;o++)Ce(Jr[o],e);break;case"image":Ce("error",e),Ce("load",e);break;case"details":Ce("toggle",e);break;case"embed":case"source":case"link":Ce("error",e),Ce("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(O in i)if(i.hasOwnProperty(O)&&(o=i[O],o!=null))switch(O){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,n));default:qe(e,n,O,o,i,null)}return;default:if(Du(n)){for(Z in i)i.hasOwnProperty(Z)&&(o=i[Z],o!==void 0&&bf(e,n,Z,o,i,void 0));return}}for(M in i)i.hasOwnProperty(M)&&(o=i[M],o!=null&&qe(e,n,M,o,i,null))}function QS(e,n,i,o){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,d=null,y=null,M=null,w=null,O=null,Z=null;for(G in i){var ie=i[G];if(i.hasOwnProperty(G)&&ie!=null)switch(G){case"checked":break;case"value":break;case"defaultValue":w=ie;default:o.hasOwnProperty(G)||qe(e,n,G,null,o,ie)}}for(var j in o){var G=o[j];if(ie=i[j],o.hasOwnProperty(j)&&(G!=null||ie!=null))switch(j){case"type":d=G;break;case"name":c=G;break;case"checked":O=G;break;case"defaultChecked":Z=G;break;case"value":y=G;break;case"defaultValue":M=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(r(137,n));break;default:G!==ie&&qe(e,n,j,G,o,ie)}}it(e,y,M,w,O,Z,d,c);return;case"select":G=y=M=j=null;for(d in i)if(w=i[d],i.hasOwnProperty(d)&&w!=null)switch(d){case"value":break;case"multiple":G=w;default:o.hasOwnProperty(d)||qe(e,n,d,null,o,w)}for(c in o)if(d=o[c],w=i[c],o.hasOwnProperty(c)&&(d!=null||w!=null))switch(c){case"value":j=d;break;case"defaultValue":M=d;break;case"multiple":y=d;default:d!==w&&qe(e,n,c,d,o,w)}n=M,i=y,o=G,j!=null?pa(e,!!i,j,!1):!!o!=!!i&&(n!=null?pa(e,!!i,n,!0):pa(e,!!i,i?[]:"",!1));return;case"textarea":G=j=null;for(M in i)if(c=i[M],i.hasOwnProperty(M)&&c!=null&&!o.hasOwnProperty(M))switch(M){case"value":break;case"children":break;default:qe(e,n,M,null,o,c)}for(y in o)if(c=o[y],d=i[y],o.hasOwnProperty(y)&&(c!=null||d!=null))switch(y){case"value":j=c;break;case"defaultValue":G=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(r(91));break;default:c!==d&&qe(e,n,y,c,o,d)}Yn(e,j,G);return;case"option":for(var Se in i)if(j=i[Se],i.hasOwnProperty(Se)&&j!=null&&!o.hasOwnProperty(Se))switch(Se){case"selected":e.selected=!1;break;default:qe(e,n,Se,null,o,j)}for(w in o)if(j=o[w],G=i[w],o.hasOwnProperty(w)&&j!==G&&(j!=null||G!=null))switch(w){case"selected":e.selected=j&&typeof j!="function"&&typeof j!="symbol";break;default:qe(e,n,w,j,o,G)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ye in i)j=i[ye],i.hasOwnProperty(ye)&&j!=null&&!o.hasOwnProperty(ye)&&qe(e,n,ye,null,o,j);for(O in o)if(j=o[O],G=i[O],o.hasOwnProperty(O)&&j!==G&&(j!=null||G!=null))switch(O){case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(r(137,n));break;default:qe(e,n,O,j,o,G)}return;default:if(Du(n)){for(var He in i)j=i[He],i.hasOwnProperty(He)&&j!==void 0&&!o.hasOwnProperty(He)&&bf(e,n,He,void 0,o,j);for(Z in o)j=o[Z],G=i[Z],!o.hasOwnProperty(Z)||j===G||j===void 0&&G===void 0||bf(e,n,Z,j,o,G);return}}for(var L in i)j=i[L],i.hasOwnProperty(L)&&j!=null&&!o.hasOwnProperty(L)&&qe(e,n,L,null,o,j);for(ie in o)j=o[ie],G=i[ie],!o.hasOwnProperty(ie)||j===G||j==null&&G==null||qe(e,n,ie,j,o,G)}var vf=null,Sf=null;function Zl(e){return e.nodeType===9?e:e.ownerDocument}function $g(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Xg(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function Mf(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Ef=null;function KS(){var e=window.event;return e&&e.type==="popstate"?e===Ef?!1:(Ef=e,!0):(Ef=null,!1)}var Qg=typeof setTimeout=="function"?setTimeout:void 0,PS=typeof clearTimeout=="function"?clearTimeout:void 0,Kg=typeof Promise=="function"?Promise:void 0,ZS=typeof queueMicrotask=="function"?queueMicrotask:typeof Kg<"u"?function(e){return Kg.resolve(null).then(e).catch(JS)}:Qg;function JS(e){setTimeout(function(){throw e})}function ui(e){return e==="head"}function Pg(e,n){var i=n,o=0,c=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(0<o&&8>o){i=o;var y=e.ownerDocument;if(i&1&&eo(y.documentElement),i&2&&eo(y.body),i&4)for(i=y.head,eo(i),y=i.firstChild;y;){var M=y.nextSibling,w=y.nodeName;y[wi]||w==="SCRIPT"||w==="STYLE"||w==="LINK"&&y.rel.toLowerCase()==="stylesheet"||i.removeChild(y),y=M}}if(c===0){e.removeChild(d),lo(n);return}c--}else i==="$"||i==="$?"||i==="$!"?c++:o=i.charCodeAt(0)-48;else o=0;i=d}while(i);lo(n)}function xf(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var i=n;switch(n=n.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":xf(i),ds(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function WS(e,n,i,o){for(;e.nodeType===1;){var c=i;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!o&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(o){if(!e[wi])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var d=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=Rn(e.nextSibling),e===null)break}return null}function eM(e,n,i){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=Rn(e.nextSibling),e===null))return null;return e}function Af(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function tM(e,n){var i=e.ownerDocument;if(e.data!=="$?"||i.readyState==="complete")n();else{var o=function(){n(),i.removeEventListener("DOMContentLoaded",o)};i.addEventListener("DOMContentLoaded",o),e._reactRetry=o}}function Rn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="F!"||n==="F")break;if(n==="/$")return null}}return e}var wf=null;function Zg(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(n===0)return e;n--}else i==="/$"&&n++}e=e.previousSibling}return null}function Jg(e,n,i){switch(n=Zl(i),e){case"html":if(e=n.documentElement,!e)throw Error(r(452));return e;case"head":if(e=n.head,!e)throw Error(r(453));return e;case"body":if(e=n.body,!e)throw Error(r(454));return e;default:throw Error(r(451))}}function eo(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);ds(e)}var vn=new Map,Wg=new Set;function Jl(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Na=P.d;P.d={f:nM,r:aM,D:iM,C:sM,L:rM,m:oM,X:cM,S:lM,M:uM};function nM(){var e=Na.f(),n=Yl();return e||n}function aM(e){var n=Fa(e);n!==null&&n.tag===5&&n.type==="form"?v0(n):Na.r(e)}var Gs=typeof document>"u"?null:document;function ey(e,n,i){var o=Gs;if(o&&typeof n=="string"&&n){var c=ht(n);c='link[rel="'+e+'"][href="'+c+'"]',typeof i=="string"&&(c+='[crossorigin="'+i+'"]'),Wg.has(c)||(Wg.add(c),e={rel:e,crossOrigin:i,href:n},o.querySelector(c)===null&&(n=o.createElement("link"),Ct(n,"link",e),nt(n),o.head.appendChild(n)))}}function iM(e){Na.D(e),ey("dns-prefetch",e,null)}function sM(e,n){Na.C(e,n),ey("preconnect",e,n)}function rM(e,n,i){Na.L(e,n,i);var o=Gs;if(o&&e&&n){var c='link[rel="preload"][as="'+ht(n)+'"]';n==="image"&&i&&i.imageSrcSet?(c+='[imagesrcset="'+ht(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(c+='[imagesizes="'+ht(i.imageSizes)+'"]')):c+='[href="'+ht(e)+'"]';var d=c;switch(n){case"style":d=Ys(e);break;case"script":d=Fs(e)}vn.has(d)||(e=g({rel:"preload",href:n==="image"&&i&&i.imageSrcSet?void 0:e,as:n},i),vn.set(d,e),o.querySelector(c)!==null||n==="style"&&o.querySelector(to(d))||n==="script"&&o.querySelector(no(d))||(n=o.createElement("link"),Ct(n,"link",e),nt(n),o.head.appendChild(n)))}}function oM(e,n){Na.m(e,n);var i=Gs;if(i&&e){var o=n&&typeof n.as=="string"?n.as:"script",c='link[rel="modulepreload"][as="'+ht(o)+'"][href="'+ht(e)+'"]',d=c;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=Fs(e)}if(!vn.has(d)&&(e=g({rel:"modulepreload",href:e},n),vn.set(d,e),i.querySelector(c)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(no(d)))return}o=i.createElement("link"),Ct(o,"link",e),nt(o),i.head.appendChild(o)}}}function lM(e,n,i){Na.S(e,n,i);var o=Gs;if(o&&e){var c=ma(o).hoistableStyles,d=Ys(e);n=n||"default";var y=c.get(d);if(!y){var M={loading:0,preload:null};if(y=o.querySelector(to(d)))M.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":n},i),(i=vn.get(d))&&Cf(e,i);var w=y=o.createElement("link");nt(w),Ct(w,"link",e),w._p=new Promise(function(O,Z){w.onload=O,w.onerror=Z}),w.addEventListener("load",function(){M.loading|=1}),w.addEventListener("error",function(){M.loading|=2}),M.loading|=4,Wl(y,n,o)}y={type:"stylesheet",instance:y,count:1,state:M},c.set(d,y)}}}function cM(e,n){Na.X(e,n);var i=Gs;if(i&&e){var o=ma(i).hoistableScripts,c=Fs(e),d=o.get(c);d||(d=i.querySelector(no(c)),d||(e=g({src:e,async:!0},n),(n=vn.get(c))&&Tf(e,n),d=i.createElement("script"),nt(d),Ct(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},o.set(c,d))}}function uM(e,n){Na.M(e,n);var i=Gs;if(i&&e){var o=ma(i).hoistableScripts,c=Fs(e),d=o.get(c);d||(d=i.querySelector(no(c)),d||(e=g({src:e,async:!0,type:"module"},n),(n=vn.get(c))&&Tf(e,n),d=i.createElement("script"),nt(d),Ct(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},o.set(c,d))}}function ty(e,n,i,o){var c=(c=ue.current)?Jl(c):null;if(!c)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(n=Ys(i.href),i=ma(c).hoistableStyles,o=i.get(n),o||(o={type:"style",instance:null,count:0,state:null},i.set(n,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=Ys(i.href);var d=ma(c).hoistableStyles,y=d.get(e);if(y||(c=c.ownerDocument||c,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,y),(d=c.querySelector(to(e)))&&!d._p&&(y.instance=d,y.state.loading=5),vn.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},vn.set(e,i),d||dM(c,e,i,y.state))),n&&o===null)throw Error(r(528,""));return y}if(n&&o!==null)throw Error(r(529,""));return null;case"script":return n=i.async,i=i.src,typeof i=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Fs(i),i=ma(c).hoistableScripts,o=i.get(n),o||(o={type:"script",instance:null,count:0,state:null},i.set(n,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function Ys(e){return'href="'+ht(e)+'"'}function to(e){return'link[rel="stylesheet"]['+e+"]"}function ny(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function dM(e,n,i,o){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?o.loading=1:(n=e.createElement("link"),o.preload=n,n.addEventListener("load",function(){return o.loading|=1}),n.addEventListener("error",function(){return o.loading|=2}),Ct(n,"link",i),nt(n),e.head.appendChild(n))}function Fs(e){return'[src="'+ht(e)+'"]'}function no(e){return"script[async]"+e}function ay(e,n,i){if(n.count++,n.instance===null)switch(n.type){case"style":var o=e.querySelector('style[data-href~="'+ht(i.href)+'"]');if(o)return n.instance=o,nt(o),o;var c=g({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return o=(e.ownerDocument||e).createElement("style"),nt(o),Ct(o,"style",c),Wl(o,i.precedence,e),n.instance=o;case"stylesheet":c=Ys(i.href);var d=e.querySelector(to(c));if(d)return n.state.loading|=4,n.instance=d,nt(d),d;o=ny(i),(c=vn.get(c))&&Cf(o,c),d=(e.ownerDocument||e).createElement("link"),nt(d);var y=d;return y._p=new Promise(function(M,w){y.onload=M,y.onerror=w}),Ct(d,"link",o),n.state.loading|=4,Wl(d,i.precedence,e),n.instance=d;case"script":return d=Fs(i.src),(c=e.querySelector(no(d)))?(n.instance=c,nt(c),c):(o=i,(c=vn.get(d))&&(o=g({},i),Tf(o,c)),e=e.ownerDocument||e,c=e.createElement("script"),nt(c),Ct(c,"link",o),e.head.appendChild(c),n.instance=c);case"void":return null;default:throw Error(r(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(o=n.instance,n.state.loading|=4,Wl(o,i.precedence,e));return n.instance}function Wl(e,n,i){for(var o=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=o.length?o[o.length-1]:null,d=c,y=0;y<o.length;y++){var M=o[y];if(M.dataset.precedence===n)d=M;else if(d!==c)break}d?d.parentNode.insertBefore(e,d.nextSibling):(n=i.nodeType===9?i.head:i,n.insertBefore(e,n.firstChild))}function Cf(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function Tf(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var ec=null;function iy(e,n,i){if(ec===null){var o=new Map,c=ec=new Map;c.set(i,o)}else c=ec,o=c.get(i),o||(o=new Map,c.set(i,o));if(o.has(e))return o;for(o.set(e,null),i=i.getElementsByTagName(e),c=0;c<i.length;c++){var d=i[c];if(!(d[wi]||d[tt]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var y=d.getAttribute(n)||"";y=e+y;var M=o.get(y);M?M.push(d):o.set(y,[d])}}return o}function sy(e,n,i){e=e.ownerDocument||e,e.head.insertBefore(i,n==="title"?e.querySelector("head > title"):null)}function fM(e,n,i){if(i===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function ry(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var ao=null;function hM(){}function mM(e,n,i){if(ao===null)throw Error(r(475));var o=ao;if(n.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(n.state.loading&4)===0){if(n.instance===null){var c=Ys(i.href),d=e.querySelector(to(c));if(d){e=d._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(o.count++,o=tc.bind(o),e.then(o,o)),n.state.loading|=4,n.instance=d,nt(d);return}d=e.ownerDocument||e,i=ny(i),(c=vn.get(c))&&Cf(i,c),d=d.createElement("link"),nt(d);var y=d;y._p=new Promise(function(M,w){y.onload=M,y.onerror=w}),Ct(d,"link",i),n.instance=d}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(n,e),(e=n.state.preload)&&(n.state.loading&3)===0&&(o.count++,n=tc.bind(o),e.addEventListener("load",n),e.addEventListener("error",n))}}function pM(){if(ao===null)throw Error(r(475));var e=ao;return e.stylesheets&&e.count===0&&_f(e,e.stylesheets),0<e.count?function(n){var i=setTimeout(function(){if(e.stylesheets&&_f(e,e.stylesheets),e.unsuspend){var o=e.unsuspend;e.unsuspend=null,o()}},6e4);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(i)}}:null}function tc(){if(this.count--,this.count===0){if(this.stylesheets)_f(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var nc=null;function _f(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,nc=new Map,n.forEach(gM,e),nc=null,tc.call(e))}function gM(e,n){if(!(n.state.loading&4)){var i=nc.get(e);if(i)var o=i.get(null);else{i=new Map,nc.set(e,i);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<c.length;d++){var y=c[d];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(i.set(y.dataset.precedence,y),o=y)}o&&i.set(null,o)}c=n.instance,y=c.getAttribute("data-precedence"),d=i.get(y)||o,d===o&&i.set(null,c),i.set(y,c),this.count++,o=tc.bind(this),c.addEventListener("load",o),c.addEventListener("error",o),d?d.parentNode.insertBefore(c,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),n.state.loading|=4}}var io={$$typeof:B,Provider:null,Consumer:null,_currentValue:le,_currentValue2:le,_threadCount:0};function yM(e,n,i,o,c,d,y,M){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=cs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cs(0),this.hiddenUpdates=cs(null),this.identifierPrefix=o,this.onUncaughtError=c,this.onCaughtError=d,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=M,this.incompleteTransitions=new Map}function oy(e,n,i,o,c,d,y,M,w,O,Z,ie){return e=new yM(e,n,i,y,M,w,O,ie),n=1,d===!0&&(n|=24),d=nn(3,null,null,n),e.current=d,d.stateNode=e,n=ld(),n.refCount++,e.pooledCache=n,n.refCount++,d.memoizedState={element:o,isDehydrated:i,cache:n},fd(d),e}function ly(e){return e?(e=Ms,e):Ms}function cy(e,n,i,o,c,d){c=ly(c),o.context===null?o.context=c:o.pendingContext=c,o=Za(n),o.payload={element:i},d=d===void 0?null:d,d!==null&&(o.callback=d),i=Ja(e,o,n),i!==null&&(ln(i,e,n),Ir(i,e,n))}function uy(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<n?i:n}}function Nf(e,n){uy(e,n),(e=e.alternate)&&uy(e,n)}function dy(e){if(e.tag===13){var n=Ss(e,67108864);n!==null&&ln(n,e,67108864),Nf(e,67108864)}}var ac=!0;function bM(e,n,i,o){var c=D.T;D.T=null;var d=P.p;try{P.p=2,Rf(e,n,i,o)}finally{P.p=d,D.T=c}}function vM(e,n,i,o){var c=D.T;D.T=null;var d=P.p;try{P.p=8,Rf(e,n,i,o)}finally{P.p=d,D.T=c}}function Rf(e,n,i,o){if(ac){var c=kf(o);if(c===null)yf(e,n,o,ic,i),hy(e,o);else if(MM(c,e,n,i,o))o.stopPropagation();else if(hy(e,o),n&4&&-1<SM.indexOf(e)){for(;c!==null;){var d=Fa(c);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var y=qn(d.pendingLanes);if(y!==0){var M=d;for(M.pendingLanes|=2,M.entangledLanes|=2;y;){var w=1<<31-_t(y);M.entanglements[1]|=w,y&=~w}Qn(d),(De&6)===0&&(jl=fe()+500,Zr(0))}}break;case 13:M=Ss(d,2),M!==null&&ln(M,d,2),Yl(),Nf(d,2)}if(d=kf(o),d===null&&yf(e,n,o,ic,i),d===c)break;c=d}c!==null&&o.stopPropagation()}else yf(e,n,o,null,i)}}function kf(e){return e=Uu(e),Lf(e)}var ic=null;function Lf(e){if(ic=null,e=fa(e),e!==null){var n=u(e);if(n===null)e=null;else{var i=n.tag;if(i===13){if(e=f(n),e!==null)return e;e=null}else if(i===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return ic=e,null}function fy(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_e()){case Ge:return 2;case ze:return 8;case vt:case fn:return 32;case Zt:return 268435456;default:return 32}default:return 32}}var Df=!1,di=null,fi=null,hi=null,so=new Map,ro=new Map,mi=[],SM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function hy(e,n){switch(e){case"focusin":case"focusout":di=null;break;case"dragenter":case"dragleave":fi=null;break;case"mouseover":case"mouseout":hi=null;break;case"pointerover":case"pointerout":so.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":ro.delete(n.pointerId)}}function oo(e,n,i,o,c,d){return e===null||e.nativeEvent!==d?(e={blockedOn:n,domEventName:i,eventSystemFlags:o,nativeEvent:d,targetContainers:[c]},n!==null&&(n=Fa(n),n!==null&&dy(n)),e):(e.eventSystemFlags|=o,n=e.targetContainers,c!==null&&n.indexOf(c)===-1&&n.push(c),e)}function MM(e,n,i,o,c){switch(n){case"focusin":return di=oo(di,e,n,i,o,c),!0;case"dragenter":return fi=oo(fi,e,n,i,o,c),!0;case"mouseover":return hi=oo(hi,e,n,i,o,c),!0;case"pointerover":var d=c.pointerId;return so.set(d,oo(so.get(d)||null,e,n,i,o,c)),!0;case"gotpointercapture":return d=c.pointerId,ro.set(d,oo(ro.get(d)||null,e,n,i,o,c)),!0}return!1}function my(e){var n=fa(e.target);if(n!==null){var i=u(n);if(i!==null){if(n=i.tag,n===13){if(n=f(i),n!==null){e.blockedOn=n,Po(e.priority,function(){if(i.tag===13){var o=on();o=pr(o);var c=Ss(i,o);c!==null&&ln(c,i,o),Nf(i,o)}});return}}else if(n===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function sc(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var i=kf(e.nativeEvent);if(i===null){i=e.nativeEvent;var o=new i.constructor(i.type,i);Iu=o,i.target.dispatchEvent(o),Iu=null}else return n=Fa(i),n!==null&&dy(n),e.blockedOn=i,!1;n.shift()}return!0}function py(e,n,i){sc(e)&&i.delete(n)}function EM(){Df=!1,di!==null&&sc(di)&&(di=null),fi!==null&&sc(fi)&&(fi=null),hi!==null&&sc(hi)&&(hi=null),so.forEach(py),ro.forEach(py)}function rc(e,n){e.blockedOn===n&&(e.blockedOn=null,Df||(Df=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,EM)))}var oc=null;function gy(e){oc!==e&&(oc=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){oc===e&&(oc=null);for(var n=0;n<e.length;n+=3){var i=e[n],o=e[n+1],c=e[n+2];if(typeof o!="function"){if(Lf(o||i)===null)continue;break}var d=Fa(i);d!==null&&(e.splice(n,3),n-=3,kd(d,{pending:!0,data:c,method:i.method,action:o},o,c))}}))}function lo(e){function n(w){return rc(w,e)}di!==null&&rc(di,e),fi!==null&&rc(fi,e),hi!==null&&rc(hi,e),so.forEach(n),ro.forEach(n);for(var i=0;i<mi.length;i++){var o=mi[i];o.blockedOn===e&&(o.blockedOn=null)}for(;0<mi.length&&(i=mi[0],i.blockedOn===null);)my(i),i.blockedOn===null&&mi.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(o=0;o<i.length;o+=3){var c=i[o],d=i[o+1],y=c[ft]||null;if(typeof d=="function")y||gy(i);else if(y){var M=null;if(d&&d.hasAttribute("formAction")){if(c=d,y=d[ft]||null)M=y.formAction;else if(Lf(c)!==null)continue}else M=y.action;typeof M=="function"?i[o+1]=M:(i.splice(o,3),o-=3),gy(i)}}}function If(e){this._internalRoot=e}lc.prototype.render=If.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(r(409));var i=n.current,o=on();cy(i,o,e,n,null,null)},lc.prototype.unmount=If.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;cy(e.current,2,null,e,null,null),Yl(),n[da]=null}};function lc(e){this._internalRoot=e}lc.prototype.unstable_scheduleHydration=function(e){if(e){var n=Ko();e={blockedOn:null,target:e,priority:n};for(var i=0;i<mi.length&&n!==0&&n<mi[i].priority;i++);mi.splice(i,0,e),i===0&&my(e)}};var yy=a.version;if(yy!=="19.1.1")throw Error(r(527,yy,"19.1.1"));P.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=m(n),e=e!==null?p(e):null,e=e===null?null:e.stateNode,e};var xM={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cc.isDisabled&&cc.supportsFiber)try{Qe=cc.inject(xM),Pe=cc}catch{}}return po.createRoot=function(e,n){if(!l(e))throw Error(r(299));var i=!1,o="",c=D0,d=I0,y=U0,M=null;return n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onUncaughtError!==void 0&&(c=n.onUncaughtError),n.onCaughtError!==void 0&&(d=n.onCaughtError),n.onRecoverableError!==void 0&&(y=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(M=n.unstable_transitionCallbacks)),n=oy(e,1,!1,null,null,i,o,c,d,y,M,null),e[da]=n.current,gf(e),new If(n)},po.hydrateRoot=function(e,n,i){if(!l(e))throw Error(r(299));var o=!1,c="",d=D0,y=I0,M=U0,w=null,O=null;return i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(d=i.onUncaughtError),i.onCaughtError!==void 0&&(y=i.onCaughtError),i.onRecoverableError!==void 0&&(M=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(w=i.unstable_transitionCallbacks),i.formState!==void 0&&(O=i.formState)),n=oy(e,1,!0,n,i??null,o,c,d,y,M,w,O),n.context=ly(null),i=n.current,o=on(),o=pr(o),c=Za(o),c.callback=null,Ja(i,c,o),i=o,n.current.lanes=i,Hn(n,i),Qn(n),e[da]=n.current,gf(e),new lc(n)},po.version="19.1.1",po}var pb;function DA(){if(pb)return Jf.exports;pb=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(a){console.error(a)}}return t(),Jf.exports=LA(),Jf.exports}var IA=DA(),gt=Cm();const vc=10,UA=1.5,OA=1.5,gb=1,zA=.6,yb=" +50% attack   Barrier   Immortal",Pi=5,Zi=3;let yt=null;function BA(){yt&&(yt.tickTimer&&clearInterval(yt.tickTimer),yt.timeout&&clearTimeout(yt.timeout),yt=null)}function Tm(){return yt!==null}function X2(){return yt?Math.max(0,yt.endTime-performance.now())/1e3:0}function qA(t,a){if(Tm()||!t.spendResource(Pi,re.SISU))return!1;const s=[];for(const l of a){if(l.faction!=="player"||l.isDead())continue;const u=`sisu-burst-${l.id}`,f={unit:l,attackDelta:0,movementDelta:0,shieldBonusApplied:gb,shieldBonusRemaining:gb,wasImmortal:l.isImmortal()};qE({id:u,duration:vc,data:f,onApply:()=>{const h=l.stats.attackDamage,m=Math.round(h*UA);f.attackDelta=Math.max(0,m-h),f.attackDelta!==0&&(l.stats.attackDamage=h+f.attackDelta);const p=l.stats.movementRange,g=Math.max(1,Math.round(p*OA));f.movementDelta=Math.max(0,g-p),f.movementDelta!==0&&(l.stats.movementRange=p+f.movementDelta),f.shieldBonusRemaining=f.shieldBonusApplied,l.setShield(l.getShield()+f.shieldBonusApplied),l.setImmortal(!0),l.fearless=!0},onExpire:()=>{let h=!1;if(f.attackDelta!==0){const p=l.stats.attackDamage,g=Math.max(0,p-f.attackDelta);g!==p&&(l.stats.attackDamage=g,h=!0)}if(f.movementDelta!==0){const p=l.stats.movementRange,g=Math.max(0,p-f.movementDelta);g!==p&&(l.stats.movementRange=g,h=!0)}l.setImmortal(f.wasImmortal);const m=Math.max(0,Math.min(f.shieldBonusApplied,f.shieldBonusRemaining));m>0&&l.setShield(Math.max(0,l.getShield()-m)),delete l.fearless,h&&se.emit("unit:stats:changed",{unitId:l.id,stats:{...l.stats}}),yt&&(yt.affected=yt.affected.filter(p=>p.modifierId!==u))},hooks:{"combat:onHit":h=>{const m=h;if(m.source!=="defender"||m.defender.id!==l.id||m.shieldDamage<=0||f.shieldBonusRemaining<=0)return;const p=Math.min(f.shieldBonusRemaining,m.shieldDamage);f.shieldBonusRemaining=Math.max(0,f.shieldBonusRemaining-p)}}}),s.push({unit:l,modifierId:u,state:f})}return yt={endTime:performance.now()+vc*1e3,status:yb,affected:s,tickTimer:null,timeout:null},se.emit("sisuBurstStart",{remaining:vc,status:yb}),yt.tickTimer=setInterval(()=>{if(!yt)return;const l=Math.max(0,Math.ceil(X2()));l>0&&se.emit("sisuBurstTick",{remaining:l,status:yt.status})},1e3),yt.timeout=setTimeout(()=>{HA()},vc*1e3),!0}function HA(){if(yt){for(const t of yt.affected)HE(t.modifierId);BA(),se.emit("sisuBurstEnd",{})}}function jA(t,a,s,r){const l=a.filter(u=>u.faction==="player"&&!u.isDead());if(l.length===0||!t.spendResource(Zi,re.SISU))return!1;for(const u of l){const f=A2(s,3,a)??{...s};u.setCoord(f);const h=Math.round(u.getMaxHealth()*zA);u.stats.health=Math.min(u.getMaxHealth(),Math.max(u.stats.health,h))}return r.revealAround(s,3,{autoFrame:!1}),se.emit("torilleRecalled",{count:l.length}),!0}let ts=!1;function _m(){return ts}function vu(t){ts!==t&&(ts=t,se.emit("game:pause-changed",{paused:ts}))}function GA(){return vu(!ts),ts}function YA(){ts&&vu(!1)}const FA=["/assets/sounds/sauna-forest.ogg","/assets/sounds/sauna-forest.mp3"],Q2="audio_enabled",zh=new Set,Su=new Set;let Ji=null,Sc=null,ka=null,_o=null;function VA(t){if(typeof localStorage>"u")return null;try{return localStorage.getItem(t)}catch(a){return console.warn("Unable to read ambience preference",t,a),null}}const K2=VA(Q2);let Ha=K2==="true",No=K2!==null;const Bh=pu();let Oc=Z2(Bh.channels.music.volume,.65),ss=!1,ia=Bh.channels.master.muted||Bh.channels.music.muted;const Ps=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)"):null;let P2=Ps?.matches??!1;if(Ps){const t=a=>{P2=a.matches};typeof Ps.addEventListener=="function"?Ps.addEventListener("change",t):typeof Ps.addListener=="function"&&Ps.addListener(t)}if(typeof window<"u"&&!No){const t=()=>{No||(No=!0,nv(!0),Mu())};window.addEventListener("pointerdown",t,{once:!0}),window.addEventListener("keydown",t,{once:!0})}cm(t=>{const a=Z2(t.channels.music.volume,Oc),s=t.channels.master.muted||t.channels.music.muted,r=Math.abs(a-Oc)>5e-4;if(Oc=a,s!==ia){ia=s,ia?tv():Ha?Mu():(Oo(!0),Uo());return}r&&Uo()});function Z2(t,a){return Number.isFinite(t)?t<0?0:t>1?1:t:a}function Uo(){const t=av();for(const a of zh)a(t)}function $A(t){if(!(typeof localStorage>"u"))try{localStorage.setItem(Q2,t?"true":"false")}catch(a){console.warn("Unable to persist ambience preference",a)}}function J2(t){if(ka)return ka;const a=t.createGain();a.gain.value=Ha&&!ia?1:0;const s=lm("music");return s?a.connect(s):a.connect(t.destination),ka=a,a}function Oo(t=!1){if(!ka)return;const a=ka.context,s=Ha&&!ia?1:0,r=a.currentTime;ka.gain.cancelScheduledValues(r),t?ka.gain.setValueAtTime(s,r):ka.gain.setTargetAtTime(s,r,.25)}function XA(){return P2?.6:4.2}function W2(){_o!==null&&(clearTimeout(_o),_o=null)}function qh(t){try{t.source.stop()}catch{}t.source.disconnect(),t.gain.disconnect(),Su.delete(t)}function QA(){for(const t of[...Su])qh(t)}async function KA(t){return Ji||(Sc||(Sc=(async()=>{for(const a of FA)try{const s=await fetch(a);if(!s.ok)continue;const r=await s.arrayBuffer();return await t.decodeAudioData(r)}catch(s){console.warn("Failed to fetch ambience source",a,s)}throw new Error("No ambience sources available")})().then(a=>(Ji=a,a)).catch(a=>{throw Sc=null,a})),Sc)}function PA(t,a){if(!ss)return;W2();const s=Math.max(0,t-a.currentTime-.05);_o=setTimeout(()=>{_o=null,ss&&ev(t)},s*1e3)}function ev(t){const a=ka?.context??iv();if(!a||!Ji)return;const s=a.createGain(),r=a.createBufferSource();r.buffer=Ji,r.loop=!1,r.connect(s),s.connect(J2(a));const l=Math.min(XA(),Ji.duration/2),u=Number.isFinite(l)&&l>0?l:.25,f=Math.max(a.currentTime,t);s.gain.setValueAtTime(0,f),s.gain.linearRampToValueAtTime(1,f+u);const h=t+Ji.duration,m=h-u;m>f&&s.gain.setValueAtTime(1,m),s.gain.linearRampToValueAtTime(.001,h+.1);const p={source:r,gain:s,stopTime:h};Su.add(p),r.addEventListener("ended",()=>{qh(p)});try{r.start(t)}catch(g){console.warn("Failed to start ambience layer",g),qh(p);return}PA(h-u,a)}async function Mu(){if(ss||!Ha||ia){Oo();return}const t=iv();if(t){J2(t),Oo();try{const a=await KA(t);if(!Ha||ia)return;await t.resume().catch(()=>{}),ss=!0;const s=Math.max(t.currentTime+.12,t.currentTime);ev(s),Uo()}catch(a){console.warn("Unable to start ambience",a)}}}function tv(){if(!ss&&Su.size===0){Oo(!0);return}ss=!1,W2(),QA(),Oo(!0),Uo()}function nv(t){Ha===t&&No||(Ha=t,No=!0,$A(t),t?ia||Mu():tv(),Uo())}function av(){return{enabled:Ha,playing:ss,volume:Oc,globallyMuted:ia}}function ZA(t){return zh.add(t),()=>{zh.delete(t)}}Ha&&!ia&&Mu();function iv(){return om()}const JA='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',ah={master:"Master mix",music:"Ambience soundscape",sfx:"Effects & interface"},WA={master:"Controls the overall loudness for every channel in the frontier.",music:"Shapes the ambience loops and atmospheric swells around the sauna.",sfx:"Balances unit callouts, UI clicks, and battle feedback cues."},e3="linear-gradient(90deg, rgba(59,130,246,0.85) 0%, rgba(14,165,233,0.9) VAR%, rgba(148,163,184,0.35) VAR%, rgba(71,85,105,0.2) 100%)";function Hh(t,a){t.style.backgroundImage=e3.replace(/VAR/g,`${a}%`)}function jh(t){return`${Math.round(t)}%`}function t3(t,a,s){const r=l=>{if(l.key==="Escape"){l.preventDefault(),s();return}if(l.key!=="Tab")return;const u=a.querySelectorAll(JA);if(u.length===0){l.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;l.shiftKey?(m===f||!a.contains(m))&&(l.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(l.preventDefault(),f.focus())};return t.addEventListener("keydown",r),()=>t.removeEventListener("keydown",r)}function sv(t,a,s){const r=a.channels[t],l=a.channels.master;if(t==="music"&&!s.enabled)return"Ambience paused";if(r.muted)return"Muted at mixer";if(t!=="master"&&l.muted)return"Master mute active";const u=Math.round(r.effectiveVolume*100);return u<=0?"Output silent":t==="master"?`Master output ${u}%`:t==="music"?`Soundscape live ${u}%`:`Effects live ${u}%`}function ih(t,a,s,r,l,u,f){const h=t.createElement("section");h.className="rounded-hud-xl border border-white/12 bg-[linear-gradient(155deg,rgba(15,26,56,0.92),rgba(9,14,34,0.96))] p-5 shadow-[0_24px_45px_rgba(4,10,25,0.55)] backdrop-blur-[18px] backdrop-saturate-[140%]";const m=t.createElement("header");m.className="flex flex-wrap items-start justify-between gap-3";const p=t.createElement("div");p.className="space-y-1";const g=t.createElement("h3");g.className="text-lg font-semibold tracking-tight text-white",g.textContent=ah[a];const b=t.createElement("p");b.className="max-w-[32ch] text-sm text-slate-300/85",b.textContent=WA[a],p.append(g,b);const v=t.createElement("span");v.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70",v.textContent=sv(a,s,r),m.append(p,v);const S=t.createElement("div");S.className="mt-5 flex items-center gap-4";const E=t.createElement("input");E.type="range",E.min="0",E.max="100",E.step="1",E.className="h-2 flex-1 appearance-none rounded-full bg-slate-600/30 accent-accent transition-[background-image] duration-200 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",E.setAttribute("aria-label",`${ah[a]} level`);const T=t.createElement("span");T.className="text-sm font-semibold text-slate-200",S.append(E,T);const _=t.createElement("div");_.className="mt-4 flex flex-wrap items-center gap-3";const R=t.createElement("button");if(R.type="button",R.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/60 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-white/80 transition-all duration-150 ease-out hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",R.setAttribute("aria-label",`Toggle mute for ${ah[a]}`),R.addEventListener("click",()=>{const V=!Qi.channels[a].muted;l(a,V)}),_.append(R),a==="sfx"){const V=t.createElement("button");V.type="button",V.className="inline-flex items-center gap-2 rounded-full border border-accent/40 bg-accent/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-accent-200 transition-all duration-150 ease-out hover:bg-accent/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",V.textContent="Play sample",V.addEventListener("click",()=>{aa("spawn")}),_.append(V)}let U;a==="music"&&f&&(U=t.createElement("button"),U.type="button",U.className="inline-flex items-center gap-2 rounded-full border border-emerald-300/25 bg-emerald-400/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-emerald-200 transition-all duration-150 ease-out hover:bg-emerald-400/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300",U.addEventListener("click",()=>{f()}),_.append(U));const B=Math.round(s.channels[a].volume*100);return E.value=String(B),Hh(E,B),T.textContent=jh(B),R.setAttribute("aria-pressed",s.channels[a].muted?"true":"false"),R.textContent=s.channels[a].muted?"Muted":"Active",a==="music"&&(E.title=r.enabled?"Adjust ambience loudness":"Ambience paused  set the level ahead of resuming."),E.addEventListener("input",()=>{const V=Number(E.value);Hh(E,V),T.textContent=jh(V),u(a,V/100)}),h.append(m,S,_),{card:h,slider:E,value:T,muteButton:R,status:v,ambienceToggle:U}}let Qi=pu();function n3(t){const{container:a,onClose:s}=t;if(!a)return{destroy(){},focus(){}};const r=a.ownerDocument??document,l=r.createElement("div");l.className="pointer-events-auto fixed inset-0 z-[1200] flex items-center justify-center bg-slate-950/75 p-4 backdrop-blur-[22px] backdrop-saturate-[140%]",l.setAttribute("role","presentation");const u=r.createElement("section");u.className="w-full max-w-[min(580px,92vw)] space-y-6 rounded-hud-xl border border-white/12 bg-[linear-gradient(145deg,rgba(12,22,45,0.95),rgba(7,13,29,0.97))] p-6 text-slate-100 shadow-[0_32px_60px_rgba(4,10,24,0.7)] backdrop-blur-[24px] backdrop-saturate-[150%]",u.setAttribute("role","dialog"),u.setAttribute("aria-modal","true");const f=`audio-mixer-title-${Date.now()}`;u.setAttribute("aria-labelledby",f),u.tabIndex=-1;const h=r.createElement("header");h.className="flex items-start justify-between gap-4";const m=r.createElement("div");m.className="space-y-1";const p=r.createElement("h2");p.id=f,p.className="text-2xl font-semibold tracking-tight text-white",p.textContent="Audio mixer";const g=r.createElement("p");g.className="max-w-[46ch] text-sm text-slate-300/85",g.textContent="Dial in the master bus, ambience beds, and tactical feedback without leaving the battlefield.",m.append(p,g);const b=r.createElement("button");b.type="button",b.className="rounded-full border border-white/20 bg-slate-800/70 px-3 py-1 text-sm font-semibold text-white/70 transition-all duration-150 hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",b.textContent="Close",h.append(m,b);const v=r.createElement("span");v.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70";const S=r.createElement("div");S.className="space-y-5";let E=av();const T={master:ih(r,"master",Qi,E,(q,C)=>{lE(C)},(q,C)=>{sE(C)},null),music:ih(r,"music",Qi,E,(q,C)=>{cE(C)},(q,C)=>{rE(C)},()=>{nv(!E.enabled)}),sfx:ih(r,"sfx",Qi,E,(q,C)=>{uE(C)},(q,C)=>{oE(C)},null)};S.append(T.master.card,T.music.card,T.sfx.card),u.append(h,v,S),l.append(u),a.append(l);let _=!1;function R(){const q=T.music.ambienceToggle;q&&(q.setAttribute("aria-pressed",E.enabled?"true":"false"),q.textContent=E.enabled?"Ambience enabled":"Ambience paused",q.title=E.enabled?"Disable ambience loops":"Enable ambience loops")}function U(q){Qi=q;const C=q.contextState==="uninitialized"?"Context idle":q.contextState==="running"?"Context running":"Context suspended";v.textContent=C,["master","music","sfx"].forEach(J=>{const H=T[J],ae=q.channels[J],F=Math.round(ae.volume*100);H.slider.value=String(F),Hh(H.slider,F),H.value.textContent=jh(F),H.muteButton.setAttribute("aria-pressed",ae.muted?"true":"false"),H.muteButton.textContent=ae.muted?"Muted":"Active",H.status.textContent=sv(J,q,E),J==="music"&&(H.slider.title=E.enabled?"Adjust ambience loudness":"Ambience paused  set the level ahead of resuming.")}),R()}function B(){_||(_=!0,V(),l.parentElement&&l.remove(),s?.())}function V(){X.forEach(q=>{try{q()}catch{}}),X.length=0}const X=[],$=q=>{q.target===l&&B()};l.addEventListener("click",$),X.push(()=>l.removeEventListener("click",$)),b.addEventListener("click",B),X.push(()=>b.removeEventListener("click",B));const W=t3(l,u,B);X.push(W);const ne=cm(q=>{U(q)});X.push(ne);const Y=ZA(q=>{E=q,R(),U(Qi)});return X.push(Y),U(Qi),u.focus(),{destroy(){B()},focus(){u.focus()}}}function bb(...t){return t.filter(Boolean).join(" ")}function vb(t,a){return!(t.code!==a.code||(a.shift??!1)!==t.shiftKey||(a.alt??!1)!==t.altKey||(a.meta??!1)!==t.metaKey||(a.ctrl??!1)!==t.ctrlKey)}function a3(t){return!Number.isFinite(t)||t<=0?"0s":`${Math.max(0,Math.ceil(t))}s`}function i3(){const[t,a]=gt.useState(()=>{const s=Tm();return{active:s,remaining:s?Math.ceil(X2()):0,status:s?"Burst active":void 0}});return gt.useEffect(()=>{const s=({remaining:u,status:f})=>{a({active:!0,remaining:Math.ceil(u),status:f})},r=({remaining:u,status:f})=>{a(h=>({active:!0,remaining:Math.ceil(u),status:f??h.status}))},l=()=>{a({active:!1,remaining:0,status:void 0})};return se.on("sisuBurstStart",s),se.on("sisuBurstTick",r),se.on("sisuBurstEnd",l),()=>{se.off("sisuBurstStart",s),se.off("sisuBurstTick",r),se.off("sisuBurstEnd",l)}},[]),t}function s3(){const[t,a]=gt.useState(()=>_m());return gt.useEffect(()=>{const s=({paused:r})=>{a(r)};return se.on("game:pause-changed",s),()=>{se.off("game:pause-changed",s)}},[]),t}function Sb(t){const a=t.target;if(!a)return!1;const s=a.tagName;return!!(s==="INPUT"||s==="TEXTAREA"||s==="SELECT"||a.isContentEditable)}function r3({state:t,abilities:a}){const[s,r]=gt.useState(()=>t.getResource(re.SISU)),[l,u]=gt.useState(()=>Ch()),[f,h]=gt.useState(!1),[m,p]=gt.useState(null),g=gt.useRef({}),[b,v]=gt.useState(()=>new Set),S=i3(),E=s3(),T=gt.useRef(null),_=gt.useCallback(C=>{v(H=>{const ae=new Set(H);return ae.add(C),ae});const J=g.current[C];J&&window.clearTimeout(J),g.current[C]=window.setTimeout(()=>{v(H=>{const ae=new Set(H);return ae.delete(C),ae}),delete g.current[C]},650)},[]);gt.useEffect(()=>{const C=({resource:J,total:H})=>{J===re.SISU&&r(H)};return se.on("resourceChanged",C),()=>{se.off("resourceChanged",C),Object.values(g.current).forEach(J=>{J&&window.clearTimeout(J)}),g.current={}}},[]),gt.useEffect(()=>DE(u),[]),gt.useEffect(()=>()=>{T.current?.destroy(),T.current=null},[]);const R=gt.useCallback(()=>{const C=document.getElementById("ui-overlay");if(!C)return!1;if(T.current)return T.current.destroy(),T.current=null,h(!1),!0;const J=n3({container:C,onClose:()=>{T.current=null,h(!1)}});return T.current=J,h(!0),J.focus(),!0},[]),U=a.useSisuBurst,B=a.torille,V=a.onOpenBuildPlanner,X=!U||S.active||s<Pi,$=U?S.active?"Burst already surging.":s<Pi?`Requires ${Pi} SISU.`:void 0:"Burst controls offline in this build.",W=!B||s<Zi,ne=B?s<Zi?`Requires ${Zi} SISU.`:void 0:"Torille rally is unavailable right now.",Y=gt.useMemo(()=>[{id:"burst",icon:"",label:"Sisu Burst",description:"Ignite a surge of fury and resilience across your warriors.",hotkey:{code:"KeyQ",label:"Q"},accent:"primary",cost:`-${Pi} SISU`,detail:S.active?`${S.status??"Burst active"}  ${a3(S.remaining)}`:void 0,blocked:X,blockedReason:$,interactive:!!U,onActivate:()=>U?U():!1},{id:"torille",icon:"",label:"Torille!",description:"Call every survivor home to the sauna to regroup and heal.",hotkey:{code:"KeyW",label:"W"},accent:"primary",cost:`-${Zi} SISU`,blocked:W,blockedReason:ne,interactive:!!B,onActivate:()=>B?B():!1},{id:"build",icon:"",label:"Build",description:"Draft new structures to reinforce your frontier.",hotkey:{code:"KeyE",label:"E"},accent:"neutral",blocked:!V,blockedReason:V?void 0:"Construction planner will unlock in a forthcoming update.",interactive:!!V,onActivate:()=>V?V()??!0:!1},{id:"sound",icon:l?"":f?"":"",label:"Audio",description:"Open the in-game mixer to balance master, ambience, and effects.",hotkey:{code:"KeyR",label:"R"},accent:"neutral",toggled:f,detail:f?"Mixer open":l?"Muted":"Live mix",interactive:!0,blocked:!1,onActivate:()=>!!R()},{id:"pause",icon:E?"":"",label:E?"Paused":"Pause",description:E?"Time is frozen  resume when your strategy is ready.":"Freeze the battlefield to reassess and issue commands.",hotkey:{code:"Space",label:"Space"},accent:"neutral",toggled:E,detail:E?"Combat frozen":"Time flowing",interactive:!0,blocked:!1,onActivate:()=>(GA(),!0)}],[S.active,S.remaining,X,$,B,f,l,V,E,W,ne,U]),q=gt.useCallback(C=>{if(!C.interactive){_(C.id);return}if(C.blocked){_(C.id);return}C.onActivate?.()===!1&&_(C.id)},[_]);return gt.useEffect(()=>{const C=H=>{if(H.repeat||Sb(H))return;const ae=Y.find(F=>vb(H,F.hotkey));ae&&(H.preventDefault(),p(ae.id),q(ae))},J=H=>{if(Sb(H))return;const ae=Y.find(F=>vb(H,F.hotkey));ae&&(H.preventDefault(),p(F=>F===ae.id?null:F))};return window.addEventListener("keydown",C),window.addEventListener("keyup",J),()=>{window.removeEventListener("keydown",C),window.removeEventListener("keyup",J)}},[Y,q]),Pt.jsx("div",{className:"pointer-events-none w-full",children:Pt.jsx("div",{className:"pointer-events-auto mx-auto flex w-full max-w-4xl flex-col gap-4 rounded-[26px] border border-white/10 bg-[linear-gradient(145deg,rgba(11,17,30,0.86),rgba(6,10,18,0.92))] p-6 shadow-[0_26px_65px_rgba(6,12,24,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)] backdrop-blur-xl","aria-label":"Combat and systems action bar",children:Pt.jsx("div",{className:"flex flex-wrap items-stretch justify-center gap-4",children:Y.map(C=>{const J=m===C.id,H=b.has(C.id),F=(C.blocked??!1)||!C.interactive,D=C.detail??C.blockedReason,P=bb("group relative flex min-w-[150px] flex-1 flex-col gap-2 rounded-[20px] border border-white/10 px-5 py-4 text-left transition-all duration-200 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70 focus-visible:ring-offset-0","bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.22),rgba(14,25,45,0.6))] shadow-[0_18px_42px_rgba(8,25,53,0.55)]",C.accent==="primary"&&"border-sky-300/40 bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.32),rgba(11,22,45,0.7))]",C.accent==="danger"&&"border-rose-400/45 bg-[radial-gradient(circle_at_top,rgba(244,114,182,0.32),rgba(45,9,25,0.75))]",J&&"ring-2 ring-sky-300/80 ring-offset-0 translate-y-[-2px] shadow-[0_24px_48px_rgba(56,189,248,0.45)]",H&&'animate-hud-shake after:pointer-events-none after:absolute after:inset-0 after:rounded-[inherit] after:border after:border-rose-300/45 after:bg-[radial-gradient(circle_at_center,rgba(248,113,113,0.18),rgba(248,113,113,0))] after:content-[""] after:animate-hud-pulse',!F&&!J&&"hover:-translate-y-1 hover:shadow-[0_24px_50px_rgba(56,189,248,0.4)]",F&&"cursor-not-allowed opacity-70",C.toggled&&"border-sky-400/60 shadow-[0_0_36px_rgba(56,189,248,0.45)]");return Pt.jsxs("button",{type:"button",className:P,"aria-pressed":C.toggled?"true":void 0,"aria-disabled":F?"true":void 0,"data-hotkey":C.hotkey.label,onClick:le=>{if(F){le.preventDefault(),_(C.id);return}q(C)},onKeyDown:le=>{(le.key==="Enter"||le.key===" ")&&(le.preventDefault(),q(C))},title:bb(C.description,C.blockedReason),children:[Pt.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Pt.jsxs("span",{className:"flex items-center gap-3 text-base font-semibold uppercase tracking-[0.18em] text-slate-100",children:[Pt.jsx("span",{"aria-hidden":"true",className:"text-2xl",children:C.icon}),C.label]}),Pt.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-slate-300/80",children:C.hotkey.label})]}),Pt.jsx("p",{className:"text-sm leading-relaxed text-slate-200/80",children:C.description}),Pt.jsxs("div",{className:"flex items-center justify-between text-xs font-medium uppercase tracking-[0.28em] text-slate-300/70",children:[Pt.jsx("span",{children:D??""}),C.cost?Pt.jsx("span",{className:"text-slate-200/90",children:C.cost}):Pt.jsx("span",{className:"opacity-0",children:"cost"})]})]},C.id)})})})})}function o3(t,a,s={}){const r=fr(a),l=a.ownerDocument.createElement("div");l.dataset.component="action-bar",l.dataset.tutorialTarget="combat",l.className="flex w-full justify-center";const u=r.regions.bottom,f=u.querySelector("#build-id");f?u.insertBefore(l,f):u.appendChild(l);const h=IA.createRoot(l);return h.render(Pt.jsx(r3,{state:t,abilities:s})),{destroy(){h.unmount(),l.remove()}}}const l3="(max-width: 820px)",rv="is-mobile",ov="is-desktop";let kn=null,Kc=null,Wn=!1,Mc=0;const Pc=new Set,Gh=new Set,Zc=t=>{for(const a of Gh)a.classList.toggle(rv,t),a.classList.toggle(ov,!t),a.dataset.viewport=t?"mobile":"desktop"},c3=t=>{if(Wn!==t){Wn=t,Zc(Wn);for(const a of Array.from(Pc))try{a(Wn)}catch(s){console.error("Failed to notify mobile listener",s)}}},lv=()=>{if(kn||typeof window>"u")return;kn=window.matchMedia(l3),Wn=kn.matches,Zc(Wn);const t=a=>{c3(a.matches)};typeof kn.addEventListener=="function"?(kn.addEventListener("change",t),Kc=()=>kn?.removeEventListener("change",t)):(kn.addListener(t),Kc=()=>kn?.removeListener(t))},u3=()=>{kn&&(Kc?.(),Kc=null,kn=null)},cv=(t,{immediate:a=!0}={})=>(lv(),Pc.add(t),a&&t(Wn),()=>{Pc.delete(t)}),d3=({root:t,onChange:a,immediate:s=!0}={})=>{lv();const r=t??(typeof document<"u"?document.documentElement:null);r&&(Gh.add(r),Zc(Wn)),Mc+=1;let l=null;return a?l=cv(a,{immediate:s}):s&&kn&&Zc(Wn),{matches:()=>Wn,dispose:()=>{r&&(Gh.delete(r),r.classList.remove(rv,ov),(r.dataset.viewport==="mobile"||r.dataset.viewport==="desktop")&&delete r.dataset.viewport),l&&(l(),l=null),Mc=Math.max(0,Mc-1),Mc===0&&Pc.size===0&&u3()}}};function f3(t){const a=[t.name];return t.description&&a.push(t.description),t.rarity&&a.push(`Rarity: ${t.rarity}`),t.quantity>1&&a.push(`Quantity: ${t.quantity}`),a.join("  ")}function h3(t){const a=document.createElement("span");a.classList.add("item-icon__fallback");const s=t.trim();return a.textContent=s?s[0]?.toUpperCase()??"?":"?",a.setAttribute("aria-hidden","true"),a}function m3(t,a){const s=document.createElement("img");return s.src=t,s.alt="",s.decoding="async",s.loading="lazy",s.classList.add("item-icon__image"),s.setAttribute("aria-hidden","true"),s.title=a,s}function p3(t){const a=document.createElement("li");a.classList.add("item-icon"),a.dataset.itemId=t.id;const s=f3(t);if(a.title=s,a.setAttribute("aria-label",s),a.setAttribute("role","listitem"),t.rarity&&(a.dataset.rarity=t.rarity.toLowerCase()),t.icon&&t.icon.trim().length>0?a.appendChild(m3(t.icon,t.name)):a.appendChild(h3(t.name)),t.quantity>1){const r=document.createElement("span");r.classList.add("item-icon__quantity"),r.textContent=`${t.quantity}`,r.setAttribute("aria-hidden","true"),a.appendChild(r)}return a}const g3=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Yh(t){return t===1/0?"":!Number.isFinite(t)||t<=0?"0s":`${g3.format(Math.ceil(t))}s`}function y3(t){const a=[t.name];return t.description&&a.push(t.description),t.source&&a.push(`Source: ${t.source}`),t.duration!==1/0&&a.push(`Duration: ${Yh(t.duration)}`),a.push(`Remaining: ${Yh(t.remaining)}`),t.stacks&&t.stacks>1&&a.push(`Stacks: ${t.stacks}`),a.join("  ")}function b3(t){const a=document.createElement("li");a.classList.add("mod-pill"),a.dataset.modifierId=t.id,a.title=y3(t),a.setAttribute("aria-label",a.title),a.setAttribute("role","listitem"),a.dataset.duration=t.duration===1/0?"infinite":String(t.duration),a.dataset.remaining=t.remaining===1/0?"infinite":String(t.remaining),t.appliedAt!==void 0&&(a.dataset.appliedAt=String(t.appliedAt)),t.stacks&&t.stacks>1&&(a.dataset.stacks=String(t.stacks));const s=document.createElement("span");if(s.classList.add("mod-pill__name"),s.textContent=t.name,s.setAttribute("aria-hidden","true"),a.appendChild(s),t.stacks&&t.stacks>1){const l=document.createElement("span");l.classList.add("mod-pill__stacks"),l.textContent=`${t.stacks}`,l.setAttribute("aria-hidden","true"),a.appendChild(l)}const r=document.createElement("span");return r.classList.add("mod-pill__timer"),r.textContent=Yh(t.remaining),r.setAttribute("aria-hidden","true"),a.appendChild(r),t.remaining!==1/0&&t.remaining<=5&&(a.dataset.urgent="true"),a}const Fh={engaged:"Engaged on the field",reserve:"On reserve duty",downed:"Recovering from battle"},$e=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Mb="panel-roster-title";function v3(t){return t.length===0?"No defining traits yet":t.join("  ")}function uv(t){return Number.isFinite(t)?Math.max(0,Math.min(100,Math.round(t*100))):0}function S3(t){const a=$e;if(t.xpForNext===null)return`${a.format(t.xp)} XP  Max level`;const s=uv(t.progress);return`${a.format(t.xpIntoLevel)} / ${a.format(t.xpForNext)} XP  ${s}%`}function dv(t){const a=[],s=(r,l)=>{l>0&&a.push(`+${$e.format(l)} ${r}`)};return s("Vigor",t.vigor),s("Focus",t.focus),s("Resolve",t.resolve),a.length===0?"No level bonuses yet":a.join("  ")}function Xs(t,a){const r=Math.round(t-(typeof a=="number"?a:0));if(r===0)return"";const l=$e.format(Math.abs(r));return r>0?` (+${l})`:` (-${l})`}function M3(t){if(!t)return"No stat changes";const a=[],s=(r,l)=>{if(typeof l=="number"&&l!==0){const u=l>0?"+":"";a.push(`${r} ${u}${$e.format(Math.abs(l))}`)}};return s("HP",t.health),s("ATK",t.attackDamage),s("RNG",t.attackRange),s("MOV",t.movementRange),s("DEF",t.defense),s("Shield",t.shield),a.length===0?"No stat changes":a.join(", ")}function E3(t){const{stats:a,baseStats:s}=t,r=[`HP ${$e.format(a.health)}/${$e.format(a.maxHealth)}${Xs(a.maxHealth,s.maxHealth)}`];return a.shield&&a.shield>0&&r.push(`Shield ${$e.format(a.shield)}${Xs(a.shield,s.shield)}`),r.push(`ATK ${$e.format(a.attackDamage)}${Xs(a.attackDamage,s.attackDamage)}`),r.push(`RNG ${$e.format(a.attackRange)}${Xs(a.attackRange,s.attackRange)}`),a.defense&&a.defense>0&&r.push(`DEF ${$e.format(a.defense)}${Xs(a.defense,s.defense)}`),r.push(`MOV ${$e.format(a.movementRange)}${Xs(a.movementRange,s.movementRange)}`),r.push(`Upkeep ${$e.format(t.upkeep)} beer`),r.join("  ")}function x3(t){const{stats:a}=t,s=[t.name,Fh[t.status]];s.push(`level ${t.progression.level}`),s.push(`health ${$e.format(a.health)} of ${$e.format(a.maxHealth)}`),a.shield&&a.shield>0&&s.push(`shield ${$e.format(a.shield)}`),s.push(`attack ${$e.format(a.attackDamage)}`),a.defense&&a.defense>0&&s.push(`defense ${$e.format(a.defense)}`),a.attackRange>0&&s.push(`attack range ${$e.format(a.attackRange)}`),s.push(`movement ${$e.format(a.movementRange)}`),s.push(`upkeep ${$e.format(t.upkeep)} beer`),t.progression.xpForNext===null?s.push(`${$e.format(t.progression.xp)} total experience`):s.push(`${$e.format(t.progression.xpIntoLevel)} of ${$e.format(t.progression.xpForNext)} experience toward next level`);const r=dv(t.progression.statBonuses);r&&s.push(`level bonuses ${r}`);const l=t.equipment.filter(u=>u.item).length;return l>0&&s.push(`${l} equipped item${l===1?"":"s"}`),t.modifiers.length>0&&s.push(`${t.modifiers.length} active modifier${t.modifiers.length===1?"":"s"}`),s.join(", ")}function A3(t,a){const s=a.filter(h=>h.status==="engaged").length,r=a.filter(h=>h.status==="reserve").length,l=a.filter(h=>h.status==="downed").length,u=(h,m,p)=>{const g=document.createElement("span");return g.classList.add("panel-roster__metric"),g.dataset.status=p,g.textContent=`${$e.format(m)} ${h}`,g.setAttribute("aria-label",g.textContent),g},f=document.createElement("div");f.classList.add("panel-roster__metrics"),f.append(u("engaged",s,"engaged"),u("reserve",r,"reserve"),u("downed",l,"downed")),t.appendChild(f)}function w3(t,a,s){const r=document.createElement("div");r.classList.add("panel-roster__loadout");const l=document.createElement("ul");l.classList.add("panel-roster__slots"),l.setAttribute("role","list"),l.setAttribute("aria-label",`${a.name} equipment slots`);for(const u of a.equipment){const f=document.createElement("li");f.classList.add("panel-roster__slot"),f.dataset.slot=u.id;const h=document.createElement("div");h.classList.add("panel-roster__slot-header");const m=document.createElement("span");m.classList.add("panel-roster__slot-label"),m.textContent=u.label,m.title=u.description,h.appendChild(m);const p=document.createElement("span");if(p.classList.add("panel-roster__slot-summary"),p.textContent=u.item?u.item.name:"Empty",p.title=u.description,h.appendChild(p),f.appendChild(h),u.item){const E=document.createElement("ul");E.classList.add("panel-roster__slot-icons"),E.setAttribute("role","list"),E.appendChild(p3(u.item)),f.appendChild(E)}const g=document.createElement("span");g.classList.add("panel-roster__slot-modifiers"),g.textContent=M3(u.modifiers),g.title=g.textContent,f.appendChild(g);const b=document.createElement("div");b.classList.add("panel-roster__slot-actions");const v=document.createElement("button");v.type="button",v.classList.add("panel-roster__slot-action"),v.textContent=u.item?"Replace":"Equip",v.setAttribute("aria-label",`Equip ${u.label} for ${a.name}`),v.addEventListener("click",E=>{E.stopPropagation(),s.onEquipSlot?.(a.id,u.id)}),b.appendChild(v);const S=document.createElement("button");S.type="button",S.classList.add("panel-roster__slot-action"),S.textContent="Unequip",S.disabled=u.item===null,S.setAttribute("aria-label",`Unequip ${u.label} from ${a.name}`),S.addEventListener("click",E=>{E.stopPropagation(),S.disabled||s.onUnequipSlot?.(a.id,u.id)}),b.appendChild(S),f.appendChild(b),l.appendChild(f)}if(r.appendChild(l),a.modifiers.length>0){const u=document.createElement("ul");u.classList.add("panel-roster__mods"),u.setAttribute("role","list"),u.setAttribute("aria-label",`${a.name} active modifiers`),u.title=a.modifiers.map(f=>f.name).join(", ");for(const f of a.modifiers)u.appendChild(b3(f));r.appendChild(u)}t.appendChild(r)}function C3(t,a={}){return{render:r=>{t.innerHTML="",t.dataset.count=String(r.length),t.classList.add("panel-roster");const l=document.createElement("div");l.classList.add("panel-roster__header");const u=document.createElement("h4");u.classList.add("panel-roster__title"),u.textContent="Battalion Roster",u.id=Mb,l.appendChild(u),t.setAttribute("aria-labelledby",Mb);const f=r.length===0?"No attendants mustered yet":`${$e.format(r.length)} attendant${r.length===1?"":"s"} enlisted`,h=document.createElement("span");if(h.classList.add("panel-roster__count"),h.textContent=f,l.appendChild(h),t.appendChild(l),(()=>{if(typeof a.getRosterCapLimit!="function"||typeof a.getRosterCap!="function")return;const g=document.createElement("section");g.classList.add("panel-roster__cap");const b=document.createElement("div");b.classList.add("panel-roster__cap-header");const v=document.createElement("span");v.classList.add("panel-roster__cap-title"),v.textContent="Roster Cap",b.appendChild(v);const S=document.createElement("span");S.classList.add("panel-roster__cap-value"),S.setAttribute("aria-live","polite"),b.appendChild(S),g.appendChild(b);const E=document.createElement("p");E.classList.add("panel-roster__cap-description"),E.textContent="Tune how many attendants rally before new recruits await the steam.",g.appendChild(E);const T=`panel-roster-cap-${Math.floor(Math.random()*1e5)}`,_=document.createElement("label");_.classList.add("panel-roster__cap-label"),_.htmlFor=T,_.textContent="Active attendants";const R=document.createElement("input");R.type="range",R.id=T,R.min="0",R.step="1",R.classList.add("panel-roster__cap-slider"),R.setAttribute("aria-label","Roster cap");const U=document.createElement("input");U.type="number",U.min="0",U.step="1",U.inputMode="numeric",U.classList.add("panel-roster__cap-number");const B=document.createElement("div");B.classList.add("panel-roster__cap-controls"),B.append(_,R,U),g.appendChild(B);const V=()=>{const Y=a.getRosterCapLimit?.();return typeof Y!="number"||!Number.isFinite(Y)?0:Math.max(0,Math.floor(Y))},X=()=>{const Y=a.getRosterCap?.();return typeof Y!="number"||!Number.isFinite(Y)?0:Math.max(0,Math.floor(Y))},$=(Y,q)=>{const C=Math.max(0,Math.min(Y,Math.floor(q))),J=$e.format(C);R.max=String(Y),R.value=String(C),R.setAttribute("aria-valuemin","0"),R.setAttribute("aria-valuemax",R.max),R.setAttribute("aria-valuenow",R.value),U.max=String(Y),U.value=String(C),U.setAttribute("aria-label",`Roster cap set to ${J}`);const H=C===0?"Paused":J;S.textContent=H,S.dataset.state=C===0?"paused":"active"},W=typeof a.updateMaxRosterSize=="function";R.disabled=!W,U.disabled=!W;const ne=(Y,q)=>{const C=V(),J=Math.max(0,Math.min(C,Number.isFinite(Y)?Math.floor(Y):0));let H=J;W&&(H=a.updateMaxRosterSize(J,{persist:q})),$(C,H)};if($(V(),X()),W){R.addEventListener("input",()=>{ne(Number(R.value),!1)}),R.addEventListener("change",()=>{ne(Number(R.value),!0)});const Y=q=>{ne(Number(U.value),q)};U.addEventListener("input",()=>Y(!1)),U.addEventListener("change",()=>Y(!0)),U.addEventListener("blur",()=>Y(!0))}t.appendChild(g)})(),r.length===0){const g=document.createElement("p");g.classList.add("panel-roster__empty"),g.textContent="No attendants have rallied to the sauna yet.",t.appendChild(g);return}A3(t,r);const p=document.createElement("ul");p.classList.add("panel-roster__list"),p.setAttribute("role","list");for(const g of r){const b=document.createElement("li");b.classList.add("panel-roster__row");const v=document.createElement("button");v.type="button",v.classList.add("panel-roster__item"),v.dataset.unitId=g.id,v.dataset.status=g.status,v.setAttribute("aria-pressed",g.selected?"true":"false"),v.setAttribute("aria-label",x3(g)),v.title=`${g.name}  ${Fh[g.status]}`,g.selected&&v.classList.add("is-selected"),g.status==="downed"&&v.classList.add("is-downed");const S=document.createElement("div");S.classList.add("panel-roster__name-row");const E=document.createElement("div");E.classList.add("panel-roster__identity");const T=document.createElement("span");T.classList.add("panel-roster__level"),T.dataset.level=String(g.progression.level),T.style.setProperty("--level-progress","0%");const _=uv(g.progression.progress);T.style.setProperty("--level-progress",`${_}%`),T.setAttribute("role","img");const R=g.progression.xpForNext===null?`Level ${g.progression.level}, at mastery`:`Level ${g.progression.level}, ${_}% toward next level`;T.setAttribute("aria-label",R);const U=document.createElement("span");U.classList.add("panel-roster__level-value"),U.textContent=String(g.progression.level),T.appendChild(U);const B=document.createElement("span");B.classList.add("panel-roster__name"),B.textContent=g.name,B.title=g.name,E.append(T,B),S.appendChild(E);const V=document.createElement("span");V.classList.add("panel-roster__status"),V.dataset.status=g.status,V.textContent=Fh[g.status],S.appendChild(V);const X=document.createElement("div");X.classList.add("panel-roster__meta");const $=E3(g);X.textContent=$,X.title=$;const W=document.createElement("div");W.classList.add("panel-roster__xp");const ne=S3(g.progression);W.textContent=ne,W.title=ne;const Y=document.createElement("div");Y.classList.add("panel-roster__callouts");const q=dv(g.progression.statBonuses);Y.textContent=q,Y.title=q;const C=document.createElement("div");C.classList.add("panel-roster__health");const J=document.createElement("div");J.classList.add("panel-roster__health-fill");const H=g.stats.maxHealth>0?Math.max(0,Math.min(100,Math.round(g.stats.health/g.stats.maxHealth*100))):0;J.style.width=`${H}%`,J.dataset.percent=`${H}`,C.appendChild(J);const ae=document.createElement("div");ae.classList.add("panel-roster__traits");const F=v3(g.traits);ae.textContent=F,ae.title=F,v.append(S,W,X,Y,C,ae),w3(v,g,a),typeof a.onSelect=="function"&&v.addEventListener("click",()=>a.onSelect?.(g.id)),b.appendChild(v),p.appendChild(b)}t.appendChild(p)}}}const T3=150,_3="autobattles:log-history:v2",fv="autobattles:log-preferences:v1",Nm=typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:null;let Eb=0;const xb=()=>(Eb+=1,`${Date.now().toString(36)}-${Eb.toString(36)}`),xo=t=>{if(Array.isArray(t))return t.map(a=>typeof a=="string"?a.trim():"").filter(a=>a.length>0);if(typeof t=="string"){const a=t.trim();return a?[a]:[]}return[]},sh=t=>t?typeof t!="object"?{}:{...t}:{},N3=t=>{if(!t)return null;if(typeof t.unitId=="string"&&t.unitId.trim().length>0)return t.unitId.trim();const a=xo(t.unitIds);return a.length>0?a[a.length-1]:null},R3=(t,a)=>{const s=xo(t.unitIds??t.unitId),r=xo(a.unitIds??a.unitId),l=Array.from(new Set([...s,...r])),u=xo(t.unitNames??t.unitName),f=xo(a.unitNames??a.unitName),h=Array.from(new Set([...u,...f])),m=typeof a.steward=="string"?a.steward:t.steward,p={...t,...a,unitIds:l,unitNames:h};return typeof m=="string"&&(p.steward=m),h.length>0&&(p.unitName=h[h.length-1]),l.length>0&&(p.unitId=l[l.length-1]),p};class k3{history=[];listeners=new Set;storage;storageKey;maxEntries;constructor(a={}){this.storage=a.storage??Nm,this.storageKey=a.storageKey??_3,this.maxEntries=Math.max(1,a.maxEntries??T3),this.hydrate()}hydrate(){if(this.storage)try{const a=this.storage.getItem(this.storageKey);if(!a)return;const s=JSON.parse(a);if(!Array.isArray(s))return;const r=[];for(const l of s){if(!l||typeof l!="object")continue;const u=l;if(typeof u.type!="string"||typeof u.message!="string")continue;const f={id:typeof u.id=="string"?u.id:xb(),type:u.type,message:u.message,metadata:sh(u.metadata),timestamp:typeof u.timestamp=="number"&&Number.isFinite(u.timestamp)?u.timestamp:Date.now(),occurrences:typeof u.occurrences=="number"&&u.occurrences>0?Math.floor(u.occurrences):1};r.push(f)}r.length>0&&(r.length>this.maxEntries?this.history=r.slice(-this.maxEntries):this.history=r)}catch{this.history=[]}}persist(){if(this.storage)try{const a=JSON.stringify(this.history.map(s=>({id:s.id,type:s.type,message:s.message,metadata:s.metadata,timestamp:s.timestamp,occurrences:s.occurrences})));this.storage.setItem(this.storageKey,a)}catch{}}getHistory(){return this.history.map(a=>({...a,metadata:sh(a.metadata)}))}subscribe(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}clear(){if(this.history.length===0)return;const a=this.history.slice();this.history=[],this.persist(),this.emitChange({kind:"remove",entries:a})}emit(a){const s=sh(a.metadata),r={id:xb(),type:a.type,message:a.message,metadata:s,timestamp:Date.now(),occurrences:1},l=this.tryAggregate(r);if(l)return this.history[l.index]=l.entry,this.persist(),this.emitChange({kind:"update",entry:l.entry,index:l.index}),l.entry;this.history.push(r);const u=[];for(;this.history.length>this.maxEntries;){const h=this.history.shift();h&&u.push(h)}this.persist(),u.length>0&&this.emitChange({kind:"remove",entries:u});const f=this.history.length-1;return this.emitChange({kind:"append",entry:r,index:f}),r}tryAggregate(a){if(a.type!=="spawn"||!N3(a.metadata)||this.history.length===0)return null;const r=this.history.length-1,l=this.history[r];return l.type!=="spawn"?null:{entry:{...l,id:l.id,message:a.message,metadata:R3(l.metadata??{},a.metadata??{}),timestamp:a.timestamp,occurrences:l.occurrences+a.occurrences},index:r}}emitChange(a){for(const s of this.listeners)try{s(a)}catch(r){console.warn("Failed to handle log change",r)}}}const Rm=new k3,Dt=t=>Rm.emit(t),L3=t=>Rm.subscribe(t),D3=()=>Rm.getHistory(),Ro={combat:{label:"Combat",accent:"var(--color-accent-red)"},spawn:{label:"Reinforcements",accent:"var(--color-accent-green)"},loot:{label:"Loot",accent:"var(--color-accent-gold)"},progression:{label:"Progression",accent:"var(--color-accent-blue)"},ability:{label:"Abilities",accent:"var(--color-accent-purple)"},resource:{label:"Economy",accent:"var(--color-accent-cyan)"},policy:{label:"Policies",accent:"var(--color-accent-orange)"},event:{label:"Events",accent:"var(--color-accent-pink)"},system:{label:"Systems",accent:"var(--color-muted)"}},Ab=["combat","spawn","loot","progression","ability","resource","policy","event","system"],Ec={mutedTypes:[]},I3=(t=Nm)=>{if(!t)return{...Ec};try{const a=t.getItem(fv);if(!a)return{...Ec};const s=JSON.parse(a);if(!s||typeof s!="object")return{...Ec};const r=Array.isArray(s.mutedTypes)?s.mutedTypes.filter(l=>typeof l=="string"&&l in Ro):[];return{mutedTypes:Array.from(new Set(r))}}catch{return{...Ec}}},U3=(t,a=Nm)=>{if(a)try{const s=Array.isArray(t.mutedTypes)?t.mutedTypes.filter(r=>r in Ro):[];a.setItem(fv,JSON.stringify({mutedTypes:Array.from(new Set(s))}))}catch{}},rh=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function O3(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{log:()=>{},addEvent:()=>{},renderRoster:()=>{},dispose:()=>{}};const{regions:r,mobileBar:l}=fr(s),u=r.top,f=r.right,h=s.querySelector("#right-panel");h&&h.remove();const m=s.querySelector(".right-panel-slide");m&&m.remove();const p=s.querySelector("#right-panel-toggle");p&&p.remove();const g=document.createElement("div");g.id="right-panel",g.classList.add("hud-card"),g.setAttribute("role","complementary"),g.setAttribute("aria-label","Sauna command console"),g.tabIndex=-1;const b=document.createElement("div");b.className="right-panel-slide",b.setAttribute("aria-hidden","true");const v=document.createElement("div");v.className="right-panel-slide__backdrop",v.setAttribute("aria-hidden","true");const S=document.createElement("div");S.className="right-panel-slide__sheet",S.appendChild(g),b.append(v,S);const E=window.matchMedia("(max-width: 1040px)"),T=[],_=document.createElement("button");_.type="button",_.id="right-panel-toggle",_.classList.add("hud-panel-toggle"),_.setAttribute("aria-controls",g.id);const R=document.createElement("span");R.classList.add("hud-panel-toggle__icon"),R.setAttribute("aria-hidden","true");const U=document.createElement("span");U.classList.add("hud-panel-toggle__icon-bars"),R.appendChild(U);const B=document.createElement("span");B.classList.add("hud-panel-toggle__text");const V=document.createElement("span");V.classList.add("hud-panel-toggle__title"),V.textContent="Command Console";const X=document.createElement("span");X.classList.add("hud-panel-toggle__state"),B.append(V,X),_.append(R,B);const $=()=>{const k=u.querySelector("#topbar");k&&k.parentElement===u?k.insertAdjacentElement("afterend",_):u.prepend(_)};let W=!1,ne=!1,Y=!1,q=!1;const C="is-mobile-panel-open",J=()=>{Y?X.textContent=q?"Close":"Menu":X.textContent=W?"Open":"Close"},H=()=>{if(Y){_.setAttribute("aria-expanded",q?"true":"false");const k=q?"Close command console panel":"Open command console panel";_.setAttribute("aria-label",k),_.title=q?"Close the sauna command console overlay":"Open the sauna command console overlay"}else{_.setAttribute("aria-expanded",W?"false":"true");const k=W?"Open command console panel":"Close command console panel";_.setAttribute("aria-label",k),_.title=W?"Open the sauna command console overlay":"Close the sauna command console overlay"}},ae=()=>{J(),H()},F=(k,K=E.matches)=>{if(Y)return;const ce=W;K&&(ne=k);const me=k&&K;W=me,g.classList.toggle("right-panel--collapsed",me),g.setAttribute("aria-hidden",me?"true":"false"),ae(),ce&&!me&&K&&g.focus({preventScroll:!0})},D=k=>{!Y||!q||k.key==="Escape"&&(k.preventDefault(),A())};let P=!1;const le=()=>{P||(document.addEventListener("keydown",D),P=!0)},ee=()=>{P&&(document.removeEventListener("keydown",D),P=!1)},x=()=>{!Y||q||(q=!0,b.classList.add("right-panel-slide--open"),b.setAttribute("aria-hidden","false"),g.setAttribute("aria-hidden","false"),document.body.classList.add(C),b.style.setProperty("--panel-drag-progress","1"),ae(),le(),requestAnimationFrame(()=>{g.focus({preventScroll:!0})}))},A=({skipFocus:k=!1}={})=>{!Y||!q||(ge(),q=!1,b.classList.remove("right-panel-slide--open"),b.setAttribute("aria-hidden","true"),g.setAttribute("aria-hidden","true"),document.body.classList.remove(C),b.style.setProperty("--panel-drag-progress","0"),ae(),ee(),k||_.focus({preventScroll:!0}))},z=k=>{if(Y)return;const K=k.matches;_.hidden=!K,F(K?ne:!1,K)};typeof E.addEventListener=="function"?(E.addEventListener("change",z),T.push(()=>E.removeEventListener("change",z))):(E.addListener(z),T.push(()=>E.removeListener(z)));const Q=()=>{if(Y){q?A():x();return}F(!W)};_.addEventListener("click",Q),T.push(()=>_.removeEventListener("click",Q));const oe=()=>{A()};v.addEventListener("click",oe),T.push(()=>v.removeEventListener("click",oe));let de=null,ue=0,ve=0;const ge=()=>{de!==null&&(S.releasePointerCapture(de),de=null),S.style.transition="",S.style.transform="",b.style.setProperty("--panel-drag-progress",q?"1":"0")},et=k=>{!Y||!q||k.pointerType==="mouse"&&k.button!==0||(de=k.pointerId,ue=k.clientX,ve=0,S.style.transition="none",S.setPointerCapture(k.pointerId))},Ut=k=>{if(!Y||k.pointerId!==de||!q)return;ve=Math.max(0,k.clientX-ue);const K=S.offsetWidth||1,ce=Math.min(ve,K);S.style.transform=`translateX(${ce}px)`,b.style.setProperty("--panel-drag-progress",String(1-ce/K))},Ot=k=>{ge(),k&&A()},An=k=>{if(k.pointerId!==de)return;const K=S.offsetWidth||1,ce=ve>K*.35;Ot(ce)},Bn=()=>{Ot(!1)};S.addEventListener("pointerdown",et),S.addEventListener("pointermove",Ut),S.addEventListener("pointerup",An),S.addEventListener("pointercancel",Bn),T.push(()=>{S.removeEventListener("pointerdown",et),S.removeEventListener("pointermove",Ut),S.removeEventListener("pointerup",An),S.removeEventListener("pointercancel",Bn)});const ja=cv(k=>{Y=k,Y?(S.appendChild(g),b.isConnected||s.appendChild(b),l.appendChild(_),_.classList.add("hud-panel-toggle--mobile"),_.hidden=!1,q||(g.setAttribute("aria-hidden","true"),b.setAttribute("aria-hidden","true"),b.style.setProperty("--panel-drag-progress","0"))):(A({skipFocus:!0}),b.style.setProperty("--panel-drag-progress","1"),b.remove(),f.appendChild(g),$(),_.classList.remove("hud-panel-toggle--mobile"),_.hidden=!E.matches,g.setAttribute("aria-hidden","false"),F(ne,E.matches)),ae()});T.push(ja);const la=document.createElement("div");la.classList.add("panel-tabs"),g.appendChild(la);const dn=document.createElement("div");dn.classList.add("panel-content"),g.appendChild(dn);const fe=document.createElement("div");fe.id="right-panel-roster",fe.setAttribute("role","region"),fe.setAttribute("aria-live","polite"),fe.setAttribute("aria-label","Battalion roster");const _e=document.createElement("div");_e.id="right-panel-policies";const Ge=document.createElement("div");Ge.id="right-panel-events";const ze=document.createElement("div");ze.id="right-panel-log",ze.setAttribute("role","region"),ze.setAttribute("aria-label","Combat log");const vt=document.createElement("section");vt.className="panel-log";const fn=document.createElement("header");fn.className="panel-log__header";const Zt=document.createElement("h3");Zt.className="panel-log__title",Zt.textContent="Combat Log";const wn=document.createElement("span");wn.className="panel-log__total",wn.textContent="0 entries",fn.append(Zt,wn);const ca=document.createElement("div");ca.className="panel-log__filters";const Qe=document.createElement("div");Qe.id="event-log",Qe.className="panel-log__feed",Qe.setAttribute("role","log"),Qe.setAttribute("aria-live","polite"),vt.append(fn,ca,Qe),ze.appendChild(vt);const Pe={Roster:fe,Policies:_e,Events:Ge,Log:ze},{onRosterSelect:Vt,onRosterRendererReady:_t,onRosterEquipSlot:Ru,onRosterUnequipSlot:ku}=a;for(const[k,K]of Object.entries(Pe))K.classList.add("panel-section","panel-section--scroll"),K.dataset.tab=k,K.hidden=!0;ze.classList.add("panel-section--log");function Vo(k){for(const[K,ce]of Object.entries(Pe))ce.hidden=K!==k;for(const K of Array.from(la.children)){const ce=K,me=ce.textContent===k;ce.disabled=me,ce.setAttribute("aria-pressed",me?"true":"false")}}for(const k of Object.keys(Pe)){const K=document.createElement("button");K.type="button",K.textContent=k;const ce=Pe[k];ce?.id&&K.setAttribute("aria-controls",ce.id),K.setAttribute("aria-pressed","false");const me=()=>Vo(k);K.addEventListener("click",me),T.push(()=>K.removeEventListener("click",me)),la.appendChild(K),dn.appendChild(Pe[k])}const ls=C3(fe,{onSelect:Vt,onEquipSlot:Ru,onUnequipSlot:ku,getRosterCap:a.getRosterCap,getRosterCapLimit:a.getRosterCapLimit,updateMaxRosterSize:a.updateMaxRosterSize}),Ga=k=>{ls.render(k)};Ga([]),typeof _t=="function"&&_t(Ga);const qn={[re.SAUNA_BEER]:"Sauna Beer Bottles",[re.SAUNAKUNNIA]:"Saunakunnia",[re.SISU]:"Sisu"},xi=m2(),ua=new Map;function Lu(k){const K=document.createElement("span");return K.className="policy-card__badge",K.textContent=k,K}function $o(k){const K=document.createElement("article");K.className="policy-card",K.style.setProperty("--policy-gradient",k.visuals.gradient),K.style.setProperty("--policy-accent",k.visuals.accentColor);const ce=document.createElement("div");ce.className="policy-card__header";const me=document.createElement("div");me.className="policy-card__icon-frame";const Ne=document.createElement("img");Ne.className="policy-card__icon",Ne.src=k.visuals.icon,Ne.alt=`${k.name} icon`,me.appendChild(Ne);const Ye=document.createElement("div");Ye.className="policy-card__heading";const Te=document.createElement("h4");if(Te.className="policy-card__title",Te.textContent=k.name,Ye.appendChild(Te),k.visuals.badges?.length){const Yn=document.createElement("div");Yn.className="policy-card__badges",k.visuals.badges.forEach(al=>Yn.appendChild(Lu(al))),Ye.appendChild(Yn)}const at=document.createElement("span");at.className="policy-card__state",at.textContent="Ready",ce.append(me,Ye,at);const Jt=document.createElement("p");Jt.className="policy-card__description",Jt.textContent=k.description;const St=k.visuals.flair?(()=>{const Yn=document.createElement("p");return Yn.className="policy-card__flair",Yn.textContent=k.visuals.flair??"",Yn})():null,Wt=document.createElement("div");Wt.className="policy-card__actions";const en=document.createElement("span");en.className="policy-card__cost";const _i=document.createElement("span");_i.className="policy-card__cost-label",_i.textContent="Cost";const ht=document.createElement("span");ht.className="policy-card__cost-value",ht.textContent=`${rh.format(k.cost)} ${qn[k.resource]}`,en.append(_i,ht);const it=document.createElement("button");it.type="button",it.className="policy-card__action",it.textContent="Enact Policy";const $a=document.createElement("p");$a.className="policy-card__status";const Xa=document.createElement("ul");Xa.className="policy-card__requirements",Xa.hidden=!0,Wt.append(en,it);const pa=()=>{t.applyPolicy(k.id)&&cs(k)};return it.addEventListener("click",pa),T.push(()=>it.removeEventListener("click",pa)),K.append(ce,Jt),St&&K.appendChild(St),K.append(Wt,$a,Xa),ua.set(k.id,{card:K,action:it,stateBadge:at,statusCopy:$a,requirements:Xa,costChip:en}),K}function Xo(){_e.innerHTML="",ua.clear();const k=document.createElement("div");k.className="policy-grid",xi.forEach(K=>{const ce=$o(K);k.appendChild(ce)}),_e.appendChild(k),Hn()}function cs(k){const K=ua.get(k.id);if(!K)return;const ce=t.hasPolicy(k.id),me=k.prerequisites.filter(St=>!St.isSatisfied(t)),Ne=t.canAfford(k.cost,k.resource);K.action.disabled=ce||me.length>0||!Ne,K.action.textContent=ce?"Enacted":"Enact Policy";let Ye="ready",Te="Ready",at=k.spotlight??"All signals point to go.";K.requirements.innerHTML="",K.requirements.hidden=!0,ce?(Ye="applied",Te="Enacted",at=k.visuals.flair??"Policy active."):me.length>0?(Ye="locked",Te="Locked",at="Awaiting requirements:",K.requirements.hidden=!1,me.forEach(St=>{const Wt=document.createElement("li");Wt.textContent=St.description,K.requirements.appendChild(Wt)})):Ne||(Ye="budget",Te="Needs Resources",at=`Earn ${rh.format(k.cost)} ${qn[k.resource]} to enact this edict.`),K.card.dataset.status=Ye,K.stateBadge.textContent=Te,K.statusCopy.textContent=at;const Jt=!ce&&me.length===0&&!Ne;K.costChip.classList.toggle("policy-card__cost--warning",Jt)}function Hn(){xi.forEach(k=>cs(k))}Xo();const Qo=k=>Hn(),hr=k=>Hn(),mr=k=>Hn();se.on("resourceChanged",Qo),se.on(Gt.APPLIED,hr),se.on(Gt.REJECTED,mr),T.push(()=>{se.off("resourceChanged",Qo),se.off(Gt.APPLIED,hr),se.off(Gt.REJECTED,mr)});function pr(k,K){const ce=document.createElement("button");ce.type="button",ce.classList.add("event-card__choice"),K.accent&&ce.classList.add(`event-card__choice--${K.accent}`),ce.dataset.choiceId=K.id;const me=document.createElement("span");if(me.className="event-card__choice-label",me.textContent=K.label,ce.appendChild(me),K.description){const Ne=document.createElement("span");Ne.className="event-card__choice-detail",Ne.textContent=K.description,ce.appendChild(Ne)}return ce.addEventListener("click",()=>{if(!ce.isConnected)return;ce.disabled=!0,wo.resolve(k.id,K.id)||(ce.disabled=!1)}),ce}function gr(k){if(Ge.innerHTML="",k.length===0){const ce=document.createElement("div");ce.className="event-card event-card--empty";const me=document.createElement("p");me.className="event-card__empty",me.textContent="All clear. Command will notify you when new briefings arrive.",ce.appendChild(me),Ge.appendChild(ce);return}const K=document.createDocumentFragment();for(const ce of k){const me=document.createElement("article");me.className="event-card",me.dataset.eventId=ce.id,me.style.setProperty("--event-accent",ce.accentColor??"var(--color-accent)");const Ne=(ce.typography??"sans").toLowerCase();me.classList.add(`event-card--${["serif","mono"].includes(Ne)?Ne:"sans"}`);const Ye=(ce.animation??"").toLowerCase();["aurora","pulse","tilt"].includes(Ye)&&me.classList.add(`event-card--${Ye}`);const Te=document.createElement("div");if(Te.className="event-card__frame",ce.art){const it=document.createElement("div");it.className="event-card__media",it.style.backgroundImage=`url(${ce.art})`,Te.appendChild(it)}const at=document.createElement("div");at.className="event-card__body";const Jt=document.createElement("span");Jt.className="event-card__badge",Jt.textContent="Priority Dispatch",at.appendChild(Jt);const St=document.createElement("h4");St.className="event-card__headline",St.textContent=ce.headline,at.appendChild(St);const Wt=document.createElement("p");Wt.className="event-card__copy",Wt.textContent=ce.body,at.appendChild(Wt);const en=document.createElement("div");en.className="event-card__choices";const _i=ce.choices&&ce.choices.length>0?ce.choices:[{id:"acknowledge",label:ce.acknowledgeText??"Acknowledge"}];for(const it of _i){const $a=pr(ce,{id:it.id,label:it.label,description:it.description,event:it.event,payload:it.payload,accent:it.accent});en.appendChild($a)}at.appendChild(en),Te.appendChild(at);const ht=document.createElement("span");ht.className="event-card__shimmer",me.append(Te,ht),K.appendChild(me)}Ge.appendChild(K)}const Ko=wo.subscribe(gr);T.push(Ko);const Po=({event:k})=>{Dt({type:"event",message:`Event  ${k.headline}`,metadata:{eventId:k?.id??k.headline,headline:k.headline}})};se.on(Gc.TRIGGERED,Po),T.push(()=>{se.off(Gc.TRIGGERED,Po)});function jn(k){wo.publish(k)}const tt=new Map,ft=new Map,da=new Map,Ya=new Set(I3().mutedTypes??[]),Cn=new Set;for(const k of Ab)Ya.has(k)||Cn.add(k),ft.set(k,0);let us=0,Ai=!0;const wi=typeof requestAnimationFrame=="function"?requestAnimationFrame:k=>setTimeout(k,16),ds=k=>rh.format(Math.max(0,k)),fa=()=>{const k=us===1?"entry":"entries";wn.textContent=`${ds(us)} ${k}`},Fa=k=>{const K=da.get(k);K&&(K.textContent=ds(ft.get(k)??0))},ha=(k,K)=>{if(K===0)return;const ce=ft.get(k)??0;ft.set(k,Math.max(0,ce+K)),us=Math.max(0,us+K),Fa(k),fa()},ma=()=>Qe.scrollHeight-(Qe.scrollTop+Qe.clientHeight)<48,nt=()=>{wi(()=>{Qe.scrollTop=Qe.scrollHeight,Ai=!0})},fs=k=>{const K=Cn.has(k.type);k.element.hidden=!K,k.element.classList.toggle("panel-log-entry--muted",!K)},Zo=k=>{const K=k.metadata??{};return(Array.isArray(K.unitNames)?K.unitNames:typeof K.unitName=="string"?[K.unitName]:[]).map(me=>typeof me=="string"?me.trim():"").filter(me=>me.length>0)},Gn=(k,K)=>{if(K.type!=="spawn"){k.replaceChildren(),k.hidden=!0;return}const ce=Zo(K),me=ce.map(Ye=>{const Te=document.createElement("span");return Te.className="panel-log-entry__token",Te.textContent=Ye,Te}),Ne=K.occurrences-ce.length;if(Ne>0){const Ye=document.createElement("span");Ye.className="panel-log-entry__token panel-log-entry__token--more",Ye.textContent=`+${Ne}`,me.push(Ye)}me.length===0?(k.replaceChildren(),k.hidden=!0):(k.replaceChildren(...me),k.hidden=!1)},Va=k=>{const K=document.createElement("article");K.className="panel-log-entry",K.dataset.logType=k.type,K.style.setProperty("--log-entry-accent",Ro[k.type]?.accent??"var(--color-accent)");const ce=document.createElement("div");ce.className="panel-log-entry__header";const me=document.createElement("span");me.className="panel-log-entry__type",me.textContent=Ro[k.type]?.label??k.type;const Ne=document.createElement("span");Ne.className="panel-log-entry__badge";const Ye=document.createElement("p");Ye.className="panel-log-entry__message",Ye.textContent=k.message;const Te=document.createElement("div");Te.className="panel-log-entry__tokens",Te.hidden=!0,ce.append(me,Ne),K.append(ce,Ye,Te);const at=St=>{St<=1?(Ne.textContent="",Ne.hidden=!0):(Ne.hidden=!1,Ne.textContent=`${St}`)},Jt={element:K,type:k.type,occurrences:k.occurrences,badge:Ne,message:Ye,tokens:Te,setBadge:at};return at(k.occurrences),Gn(Te,k),Jt},Jo=(k,K=!1)=>{const ce=K?!0:ma()||Ai,me=Va(k);tt.set(k.id,me),Qe.appendChild(me.element),ha(me.type,me.occurrences),fs(me),ce&&nt()},Wo=k=>{const K=tt.get(k.id);if(!K)return;const ce=k.occurrences-K.occurrences;ce!==0&&(K.occurrences=k.occurrences,ha(K.type,ce)),K.message.textContent=k.message,K.setBadge(k.occurrences),K.tokens&&Gn(K.tokens,k),fs(K),Ai&&nt()},el=k=>{const K=tt.get(k.id);K&&(tt.delete(k.id),ha(K.type,-K.occurrences),K.element.parentElement===Qe&&Qe.removeChild(K.element))},tl=()=>{for(const k of tt.values())fs(k)};for(const k of Ab){const K=Ro[k],ce=document.createElement("button");ce.type="button",ce.className="log-chip",ce.dataset.logFilter=k,ce.style.setProperty("--log-chip-accent",K?.accent??"var(--color-accent)"),ce.setAttribute("aria-pressed",Cn.has(k)?"true":"false"),ce.setAttribute("aria-label",`${K?.label??k} log filter`);const me=document.createElement("span");me.className="log-chip__label",me.textContent=K?.label??k;const Ne=document.createElement("span");Ne.className="log-chip__count",Ne.textContent="0",da.set(k,Ne),Cn.has(k)||ce.classList.add("is-muted"),ce.append(me,Ne),ca.appendChild(ce),ce.addEventListener("click",()=>{Cn.has(k)?(Cn.delete(k),Ya.add(k)):(Cn.add(k),Ya.delete(k)),ce.classList.toggle("is-muted",!Cn.has(k)),ce.setAttribute("aria-pressed",Cn.has(k)?"true":"false"),U3({mutedTypes:Array.from(Ya)}),tl()})}fa();const Ci=()=>{Ai=ma()};Qe.addEventListener("scroll",Ci,{passive:!0}),T.push(()=>Qe.removeEventListener("scroll",Ci));const Ti=D3();if(Ti.length>0){for(const k of Ti)Jo(k,!0);nt()}const Tn=L3(k=>{if(k.kind==="append")Jo(k.entry);else if(k.kind==="update")Wo(k.entry);else if(k.kind==="remove")for(const K of k.entries)el(K)});return T.push(Tn),tl(),Vo("Roster"),{log:k=>{Dt(k)},addEvent:jn,renderRoster:Ga,dispose:()=>{for(const k of T.splice(0))try{k()}catch(K){console.warn("Failed to dispose HUD listener",K)}ee(),ge(),document.body.classList.remove(C),b.remove(),_.remove(),g.remove()}}}const z3=t=>`[data-tutorial-target="${t}"]`,Kn=16,xc=12,wb="is-tutorial-highlighted",B3=[{id:"heat",target:"heat",title:"Heat the Sauna",description:"Keep the sauna fires roaring. This control shows when the next warrior emerges from the steam."},{id:"upkeep",target:"upkeep",title:"Mind Your Upkeep",description:"Every attendant draws upkeep. Track totals and see a featured roster member to balance your economy."},{id:"sisu",target:"sisu",title:"Stockpile SISU",description:"SISU fuels heroic bursts. Watch this meter to know when your grit reserves can power signature moves."},{id:"enemy-ramp",target:"enemy-ramp",title:"Read the Enemy Ramp",description:"The badge shows the current stage, upcoming multiplier surges, and calm lulls before the next pressure wave."},{id:"combat",target:"combat",title:"Command the Fight",description:"Trigger a Sisu Burst to supercharge allied attacks or rally everyone home with a Torille call."},{id:"victory",target:"victory",title:"Claim Victory",description:"Destroy every enemy stronghold to win the campaign. The Saunakunnia badge tracks your march toward total conquest."},{id:"defeat",target:"sauna-integrity",title:"Avert Defeat",description:"Defeat strikes if the sauna is razed, every attendant is downed for 8 seconds, or upkeep bankruptcy lingers for 12 seconds. Guard the integrity meter and keep your roster on its feet."}];function q3(t,a,s){return Math.max(a,Math.min(s,t))}function H3(t={}){const a=t.steps??B3;if(a.length===0)throw new Error("Tutorial requires at least one step.");let s=-1,r=null,l=!1;const u=document.createElement("div");u.className="tutorial-overlay";const f=document.createElement("div");f.className="tutorial-overlay__spotlight",f.setAttribute("aria-hidden","true");const h=document.createElement("section");h.className="tutorial-card",h.setAttribute("role","dialog"),h.setAttribute("aria-modal","false"),h.tabIndex=-1;const m=document.createElement("header");m.className="tutorial-card__header";const p=document.createElement("h2");p.className="tutorial-card__title";const g=document.createElement("button");g.type="button",g.className="tutorial-card__close",g.setAttribute("aria-label","Dismiss tutorial"),g.textContent="",m.append(p,g);const b=document.createElement("p");b.className="tutorial-card__description";const v=document.createElement("p");v.className="tutorial-card__progress";const S=document.createElement("div");S.className="tutorial-card__controls";const E=document.createElement("button");E.type="button",E.className="tutorial-card__button tutorial-card__button--secondary",E.textContent="Back";const T=document.createElement("button");T.type="button",T.className="tutorial-card__button",T.textContent="Next";const _=document.createElement("button");_.type="button",_.className="tutorial-card__skip",_.textContent="Skip tutorial",S.append(E,T),h.append(m,b,v,S,_),u.append(f,h);const R=typeof ResizeObserver<"u"?new ResizeObserver(()=>{s>=0&&W()}):null,U=()=>{s>=0&&W()};function B(){l||(document.body.appendChild(u),window.addEventListener("resize",W),document.addEventListener("scroll",U,!0),R?.observe(h),l=!0)}function V(){l&&(window.removeEventListener("resize",W),document.removeEventListener("scroll",U,!0),R?.disconnect(),u.remove(),l=!1)}function X(F){if(r&&r!==F&&(r.classList.remove(wb),r.removeAttribute("data-tutorial-highlight")),r=F,!F){f.style.opacity="0";return}F.classList.add(wb),F.setAttribute("data-tutorial-highlight","true"),f.style.opacity="1"}function $(){if(!r)return null;const F=r.getBoundingClientRect();return F.width===0&&F.height===0?null:{top:F.top,left:F.left,width:F.width,height:F.height}}function W(){const F=$();if(!F){h.style.top=`${Kn}px`,h.style.left=`${Kn}px`,h.classList.add("tutorial-card--floating"),f.style.opacity="0";return}h.classList.remove("tutorial-card--floating"),f.style.opacity="1";const D=F.top-xc,P=F.left-xc,le=F.width+xc*2,ee=F.height+xc*2;f.style.top=`${D}px`,f.style.left=`${P}px`,f.style.width=`${le}px`,f.style.height=`${ee}px`;const x=h.getBoundingClientRect();let z=window.innerHeight-F.top-F.height>=F.top?F.top+F.height+Kn:F.top-x.height-Kn;z<Kn?z=Kn:z+x.height>window.innerHeight-Kn&&(z=window.innerHeight-Kn-x.height);let oe=F.left+F.width/2-x.width/2;oe=q3(oe,Kn,window.innerWidth-x.width-Kn),h.style.top=`${Math.round(z)}px`,h.style.left=`${Math.round(oe)}px`}function ne(){requestAnimationFrame(()=>{h.focus({preventScroll:!0})})}function Y(F){if(F<0||F>=a.length)return;B(),s=F;const D=a[F];p.textContent=D.title,b.textContent=D.description,v.textContent=`Step ${F+1} of ${a.length}`,E.disabled=F===0,T.textContent=F===a.length-1?"Finish":"Next";const P=document.querySelector(z3(D.target));X(P??null),W(),ne()}function q(){if(s===-1){Y(0);return}if(s>=a.length-1){ae();return}Y(s+1)}function C(){s<=0||Y(s-1)}function J(){X(null),V(),s=-1}function H(){t.onSkip?.(),J()}function ae(){t.onComplete?.(),J()}return E.addEventListener("click",()=>{C()}),T.addEventListener("click",()=>{q()}),_.addEventListener("click",()=>{H()}),g.addEventListener("click",()=>{H()}),h.addEventListener("keydown",F=>{F.defaultPrevented||(F.key==="ArrowRight"?(F.preventDefault(),q()):F.key==="ArrowLeft"?(F.preventDefault(),C()):F.key==="Escape"&&(F.preventDefault(),H()))}),{start(){s===-1&&Y(0)},next:q,previous:C,skip:H,finish:ae,destroy(){J()}}}const j3=Math.sqrt(3),G3=2;function Jc(t){return{width:t*j3,height:t*G3}}const Da=16,Ac=2;function Y3(){return typeof window<"u"&&window.devicePixelRatio||1}function F3(t,a){const s=Math.max(t.qMin,a.minQ),r=Math.min(t.qMax,a.maxQ),l=Math.max(t.rMin,a.minR),u=Math.min(t.rMax,a.maxR);return s>r||l>u?null:{qMin:s,qMax:r,rMin:l,rMax:u}}function V3(t,a){const s=Y3(),r=a.width/(s*t.zoom),l=a.height/(s*t.zoom);return{x:t.x-r/2,y:t.y-l/2,width:r,height:l}}function $3(t,a){const s=[Mo(t.x,t.y,a),Mo(t.x+t.width,t.y,a),Mo(t.x,t.y+t.height,a),Mo(t.x+t.width,t.y+t.height,a)];let r=1/0,l=-1/0,u=1/0,f=-1/0;for(const h of s)r=Math.min(r,h.q),l=Math.max(l,h.q),u=Math.min(u,h.r),f=Math.max(f,h.r);return{qMin:Math.floor(r)-Ac,qMax:Math.ceil(l)+Ac,rMin:Math.floor(u)-Ac,rMax:Math.ceil(f)+Ac}}function X3(t,a,s,r){if(!s||typeof s.width!="number"||typeof s.height!="number")return{qMin:t.minQ,qMax:t.maxQ,rMin:t.minR,rMax:t.maxR};if(s.width===0||s.height===0)return{qMin:t.minQ,qMax:t.maxQ,rMin:t.minR,rMax:t.maxR};const l=V3(a,s);return F3($3(l,r),t)}function Js(t){return Math.floor(t/Da)}function hv(t){return`${t.q},${t.r}`}function Q3(t,a){return hv({q:Js(t),r:Js(a)})}function K3(t){return{qMin:Js(t.qMin),qMax:Js(t.qMax),rMin:Js(t.rMin),rMax:Js(t.rMax)}}function mv(t){const a=[];for(let s=t.rMin;s<=t.rMax;s++)for(let r=t.qMin;r<=t.qMax;r++)a.push({q:r,r:s});return a}function P3(t,a){const s=a.q*Da,r=a.r*Da,l=s+Da-1,u=r+Da-1,f=Math.max(s,t.minQ),h=Math.min(l,t.maxQ),m=Math.max(r,t.minR),p=Math.min(u,t.maxR);if(!(f>h||m>p))for(let g=m;g<=p;g++)for(let b=f;b<=h;b++)t.ensureTile(b,g)}function Z3(t,a){for(const s of mv(a))P3(t,s)}const J3="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3ePlains%20Tile%3c/title%3e%3cdesc%20id='desc'%3eRolling%20plains%20with%20sunrise%20gradients%20and%20glowing%20grasses.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='plains-bg'%20cx='50%25'%20cy='50%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='plains-field'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='0%25'%3e%3cstop%20offset='0%25'%20stop-color='%23facc15'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23eab308'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='plains-haze'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f59e0b'%20stop-opacity='0.2'%20/%3e%3c/linearGradient%3e%3cfilter%20id='plains-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='5'%20stdDeviation='6'%20flood-color='%23facc15'%20flood-opacity='0.35'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23plains-bg)'%20/%3e%3cg%20filter='url(%23plains-glow)'%3e%3cpath%20d='M16%2088c20-18%2036-22%2048-22s28%204%2048%2022'%20fill='url(%23plains-field)'%20stroke='%23fef9c3'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M24%20102c16-14%2032-18%2040-18s24%204%2040%2018'%20fill='none'%20stroke='%23fde68a'%20stroke-width='5'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M32%2070c12-10%2024-14%2032-14s20%204%2032%2014'%20fill='url(%23plains-haze)'%20opacity='0.7'%20/%3e%3cpath%20d='M52%2078l4%2012m8-12l4%2012m8-12l4%2012'%20stroke='%23fef3c7'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='36'%20r='8'%20fill='%23fef08a'%20opacity='0.7'%20/%3e%3c/svg%3e",W3="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eForest%20Tile%3c/title%3e%3cdesc%20id='desc'%3eStylised%20evergreen%20trees%20glowing%20against%20a%20deep%20night%20backdrop.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='forest-bg'%20cx='50%25'%20cy='40%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230b1120'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='forest-leaf'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%234ade80'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2315803d'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='forest-trunk'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23a855f7'%20/%3e%3cstop%20offset='100%25'%20stop-color='%237c3aed'%20/%3e%3c/linearGradient%3e%3cfilter%20id='forest-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%234ade80'%20flood-opacity='0.25'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23forest-bg)'%20/%3e%3cg%20filter='url(%23forest-glow)'%20stroke='%23bbf7d0'%20stroke-width='2'%3e%3cpath%20fill='url(%23forest-leaf)'%20d='M64%2026L32%2080h18l-12%2022h28l-10-22h16l-10%2022h28l-12-22h18z'%20/%3e%3crect%20x='58'%20y='74'%20width='12'%20height='18'%20rx='3'%20fill='url(%23forest-trunk)'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20stroke-opacity='0.5'%20d='M44%2086c6-4%2012-6%2020-6s14%202%2020%206'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='40'%20r='6'%20fill='%23fef3c7'%20opacity='0.6'%20/%3e%3ccircle%20cx='88'%20cy='32'%20r='4'%20fill='%23fef3c7'%20opacity='0.4'%20/%3e%3c/svg%3e",ew="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eMountain%20Tile%3c/title%3e%3cdesc%20id='desc'%3eJagged%20alpine%20peaks%20with%20luminous%20snowcaps.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='mountain-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%23111827'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='mountain-rock'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2364748b'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23334155'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mountain-snow'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23cbd5f5'%20/%3e%3c/linearGradient%3e%3cfilter%20id='mountain-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%23f8fafc'%20flood-opacity='0.2'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23mountain-bg)'%20/%3e%3cg%20filter='url(%23mountain-glow)'%20stroke='%23cbd5f5'%20stroke-width='2'%20stroke-linejoin='round'%3e%3cpath%20fill='url(%23mountain-rock)'%20d='M24%20100l32-52%2014%2022%2012-18%2022%2048z'%20/%3e%3cpath%20fill='url(%23mountain-snow)'%20d='M56%2048l14%2022%2012-18%2010%2022H48z'%20opacity='0.85'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20opacity='0.6'%20d='M32%2094c10-6%2020-9%2032-9s22%203%2032%209'%20/%3e%3c/g%3e%3ccircle%20cx='92'%20cy='32'%20r='6'%20fill='%23f1f5f9'%20opacity='0.5'%20/%3e%3c/svg%3e",tw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eWater%20Tile%3c/title%3e%3cdesc%20id='desc'%3eGlowing%20waves%20surrounding%20a%20crystalline%20droplet.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='water-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230b1120'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='water-wave'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='water-drop'%20x1='50%25'%20y1='0%25'%20x2='50%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230284c7'%20/%3e%3c/linearGradient%3e%3cfilter%20id='water-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='8'%20flood-color='%2338bdf8'%20flood-opacity='0.3'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23water-bg)'%20/%3e%3cg%20filter='url(%23water-glow)'%3e%3cpath%20d='M32%2076c12-10%2024-15%2032-15s20%205%2032%2015'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3cpath%20d='M28%2092c14-12%2030-18%2040-18s26%206%2040%2018'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='6'%20stroke-linecap='round'%20opacity='0.7'%20/%3e%3cpath%20d='M40%2060c10-8%2018-12%2024-12s14%204%2024%2012'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M64%2030c-12%2020-18%2032-18%2042%200%2011%208%2020%2018%2020s18-9%2018-20c0-10-6-22-18-42z'%20fill='url(%23water-drop)'%20stroke='%23e0f2fe'%20stroke-width='2'%20/%3e%3c/g%3e%3ccircle%20cx='94'%20cy='34'%20r='6'%20fill='%23f8fafc'%20opacity='0.45'%20/%3e%3c/svg%3e",nw=.01;function pv(t){return!Number.isFinite(t)||t<=nw?1:t}function aw(t,a){return t/pv(a)}function ea(t,a){const s=pv(a);return Math.round(t*s)/s}const Cb={[En.Plains]:{baseColor:"#d8b869",icon:J3},[En.Forest]:{baseColor:"#237a55",icon:W3},[En.Hills]:{baseColor:"#b57c57",icon:ew},[En.Lake]:{baseColor:"#3185d5",icon:tw}},iw=[255,255,255],km=[12,18,28],sw=[0,0,0],Tb="rgba(56, 189, 248, 0.85)",_b="rgba(56, 189, 248, 0.45)";let go=null,yo=null;const rw=t=>Math.min(1,Math.max(0,t));function ow(t){let a=t.trim().replace("#","");a.length===3&&(a=a.split("").map(r=>r+r).join(""));const s=Number.parseInt(a,16);return[s>>16&255,s>>8&255,s&255]}function Wc(t,a,s){const r=rw(s);return[Math.round(t[0]+(a[0]-t[0])*r),Math.round(t[1]+(a[1]-t[1])*r),Math.round(t[2]+(a[2]-t[2])*r)]}function Nb(t){return`rgb(${t[0]}, ${t[1]}, ${t[2]})`}function eu(t,a=1){return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${a})`}function tu(t,a=1){return eu(Wc(km,iw,t),a)}function nr(t,a=1){return eu(Wc(km,sw,t),a)}const lw={terrain:.05,hover:.065,selection:.085},cw={terrain:1,hover:1.35,selection:2.1};function nu(t,a,s="terrain"){const r=t*lw[s],l=aw(r,a);return Math.max(cw[s],l)}function uw(){if(go&&yo)return{stroke:go,glow:yo};if(typeof window<"u"){const t=getComputedStyle(document.documentElement),a=t.getPropertyValue("--tile-highlight-ring").trim(),s=t.getPropertyValue("--tile-highlight-glow").trim();go=a||Tb,yo=s||_b}else go=Tb,yo=_b;return{stroke:go,glow:yo}}function gv(t){return Math.min(1,Math.max(0,t))}function Eu(t){let a=t.trim();if(a.startsWith("#")&&(a=a.slice(1)),a.length===3){const s=Number.parseInt(a[0]+a[0],16),r=Number.parseInt(a[1]+a[1],16),l=Number.parseInt(a[2]+a[2],16);return[s,r,l]}if(a.length===6){const s=Number.parseInt(a,16),r=s>>16&255,l=s>>8&255,u=s&255;return[r,l,u]}return[0,0,0]}function dw(t,a,s){const r=gv(s),l=(u,f)=>Math.round(u+(f-u)*r);return[l(t[0],a[0]),l(t[1],a[1]),l(t[2],a[2])]}function fw([t,a,s],r){return`rgba(${t}, ${a}, ${s}, ${gv(r)})`}function Ei(t,a,s,r){return fw(dw(t,a,s),r)}function hw(t){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=t,m=Eu(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=Ei(m,[255,255,255],.35,.24);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.06);const g=3,b=6,v=s+l*.12,S=s+l*.88;for(let R=0;R<g;R++){const U=R/Math.max(1,g-1),B=r+u*.28+U*u*.32,V=f*(.18-U*.05);a.beginPath();for(let X=0;X<=b;X++){const $=X/b,W=v+(S-v)*$,ne=Math.sin($*Math.PI*1.6+R*.8)*V,Y=B-Math.abs(ne)*.55;X===0?a.moveTo(W,Y):a.lineTo(W,Y)}a.stroke()}const E=Ei(m,[18,54,32],.4,.2);a.strokeStyle=E,a.lineWidth=Math.max(.75,f*.035);const T=5,_=f*.22;for(let R=0;R<T;R++){const U=s+l*(.2+R/Math.max(1,T-1)*.6),B=r+u*.55-Math.cos(R*.9)*f*.08;a.beginPath(),a.arc(U,B,_,Math.PI*.2,Math.PI*.85),a.stroke(),a.beginPath(),a.arc(U+_*.35,B-_*.1,_*.55,Math.PI*.15,Math.PI*.95),a.stroke()}a.restore()}function mw(t){const{ctx:a,centerX:s,centerY:r,radius:l,baseColor:u}=t,f=Eu(u);a.save(),a.lineCap="round";const h=Ei(f,[255,235,214],.45,.22);a.strokeStyle=h,a.lineWidth=Math.max(1,l*.05);const m=4;for(let b=0;b<m;b++){const v=b/Math.max(1,m-1),S=l*(1.25-v*.45),E=l*(.72-v*.18),T=r+l*.18*(v-.5);a.beginPath(),a.ellipse(s,T,S,E,0,Math.PI*.12,Math.PI*.88),a.stroke()}const p=Ei(f,[60,36,20],.35,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,l*.032),a.setLineDash([l*.22,l*.18]);const g=3;for(let b=0;b<g;b++){const v=l*(.75-b*.1),S=r+l*.28+b*l*.08;a.beginPath(),a.arc(s+l*.08,S,v,Math.PI*.28,Math.PI*.76),a.stroke()}a.setLineDash([]),a.restore()}function pw(t){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=t,m=Eu(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=Ei(m,[255,255,255],.55,.28);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.045);const g=4,b=7,v=s+l*.12,S=s+l*.88,E=f*.16;for(let R=0;R<g;R++){const U=R/Math.max(1,g-1),B=r+u*.3+U*u*.4;a.beginPath();for(let V=0;V<=b;V++){const X=V/b,$=v+(S-v)*X,W=Math.sin(X*Math.PI*2+R*.6)*E*(.75-U*.2),ne=B+W;V===0?a.moveTo($,ne):a.lineTo($,ne)}a.stroke()}const T=Ei(m,[12,52,94],.4,.2);a.strokeStyle=T,a.lineWidth=Math.max(.8,f*.03);const _=3;for(let R=0;R<_;R++){const U=R/Math.max(1,_-1),B=r+u*.35+U*u*.35;a.beginPath();for(let V=0;V<=b;V++){const X=V/b,$=v+(S-v)*X,W=Math.sin(X*Math.PI*2+R)*E*.35,ne=B+W;V===0?a.moveTo($,ne):a.lineTo($,ne)}a.stroke()}a.restore()}function yv(t){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=t,m=Eu(h);a.save(),a.lineCap="round";const p=Ei(m,[255,255,255],.42,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,f*.03);const g=f*.55;for(let S=-1;S<=2;S++){const E=g*S;a.beginPath(),a.moveTo(s+E,r+u*.25),a.lineTo(s+E+l*.75,r+u*.85),a.stroke()}const b=Ei(m,[112,82,32],.3,.16);a.strokeStyle=b,a.lineWidth=Math.max(.7,f*.025),a.setLineDash([f*.24,f*.34]);const v=f*.48;for(let S=0;S<3;S++){const E=v*S;a.beginPath(),a.moveTo(s+l*.18+E,r+u*.78),a.lineTo(s+l*.7+E,r+u*.38),a.stroke()}a.setLineDash([]),a.restore()}const Rb=new Map;let Vi=null;function gw(){if(Vi)return Vi;const t="/";if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(t))return Vi=t,Vi;const s=t.startsWith("/")?t:`/${t}`;return typeof window<"u"&&typeof window.location?.origin=="string"?Vi=`${window.location.origin}${s}`:Vi=`http://localhost${s}`,Vi}function yw(t){let a=Rb.get(t);if(!a){a=new Image,a.decoding="async";const s=new URL(t,gw()).href;a.src=s,Rb.set(t,a)}if(a.complete&&a.naturalWidth>0&&a.naturalHeight>0)return a}const bw={[En.Plains]:yv,[En.Forest]:hw,[En.Hills]:mw,[En.Lake]:pw};function bv(t,a,s,r){t.beginPath();for(let l=0;l<6;l++){const u=Math.PI/180*(60*l-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?t.moveTo(f,h):t.lineTo(f,h)}t.closePath()}function vw(t,a,s,r){bv(t,a,s,r),t.save(),t.lineJoin="round",t.lineCap="round",t.lineWidth=nu(r,1,"terrain"),t.strokeStyle=tu(.16,.6),t.stroke(),t.restore()}function Sw(t,a,s,r,l,u,f,h){const m=Cb[a.terrain]??Cb[En.Plains],p=ow(m.baseColor),g=r+u/2,b=l+f/2;t.save(),bv(t,g,b,h),t.clip();const v=t.createRadialGradient(g,b,h*.2,g,b,h*1.05);v.addColorStop(0,Nb(Wc(p,[255,255,255],.3))),v.addColorStop(.7,m.baseColor),v.addColorStop(1,Nb(Wc(p,km,.4))),t.fillStyle=v,t.shadowColor=eu(p,.35),t.shadowBlur=h*.9,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillRect(r-h*.1,l-h*.1,u+h*.2,f+h*.2);const S={ctx:t,x:r,y:l,width:u,height:f,radius:h,centerX:g,centerY:b,baseColor:m.baseColor};(bw[a.terrain]??yv)(S),t.globalCompositeOperation="lighter";const T=t.createRadialGradient(g,b,h*.85,g,b,h*1.18);T.addColorStop(0,"rgba(255, 255, 255, 0)"),T.addColorStop(1,eu(p,.18)),t.fillStyle=T,t.fillRect(r-h*.1,l-h*.1,u+h*.2,f+h*.2),t.globalCompositeOperation="source-over",t.restore();const _=yw(m.icon);if(_){const R=Math.min(u,f)*.62,U=g-R/2,B=b-R/2;t.save(),t.globalAlpha*=.92,t.drawImage(_,U,B,R,R),t.restore()}if(a.building){const R=s[`building-${a.building}`]??s.placeholder;t.drawImage(R,r,l,u,f)}}function Mw(t,a){const s=Math.max(t.q*Da,a.minQ),r=Math.min(s+Da-1,a.maxQ),l=Math.max(t.r*Da,a.minR),u=Math.min(l+Da-1,a.maxR);return{qStart:s,qEnd:r,rStart:l,rEnd:u}}class Ew{constructor(a){this.map=a,this.unsubscribe=a.addTileChangeListener((s,r,l)=>{this.onTileChange(s,l)})}chunkCanvases=new Map;dirtyChunks=new Set;cachedImages;unsubscribe;dispose(){this.unsubscribe(),this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}invalidate(){this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}markChunkDirty(a){this.dirtyChunks.add(a)}markTileDirty(a,s){this.dirtyChunks.add(Q3(a,s))}getRenderableChunks(a,s,r,l){this.refreshAssets(r);const u=[],{width:f,height:h}=Jc(s);for(const m of mv(a)){const p=hv(m),g=this.ensureChunk(p,m,s,f,h,r,l);g&&u.push(g)}return u}refreshAssets(a){if(this.cachedImages!==a){this.cachedImages=a;for(const s of this.chunkCanvases.keys())this.dirtyChunks.add(s)}}onTileChange(a,s){(s==="created"||s==="terrain"||s==="building"||s==="fog")&&this.markTileDirty(a.q,a.r)}ensureChunk(a,s,r,l,u,f,h){const m=this.chunkCanvases.get(a);if(!m||this.dirtyChunks.has(a)){const p=this.renderChunk(a,s,r,l,u,f,h,m);return this.dirtyChunks.delete(a),p?(this.chunkCanvases.set(a,p),p):(this.chunkCanvases.delete(a),null)}return m}renderChunk(a,s,r,l,u,f,h,m){if(typeof document>"u")return null;const{qStart:p,qEnd:g,rStart:b,rEnd:v}=Mw(s,this.map);if(p>g||b>v)return null;const S=l/2,E=u/2;let T=1/0,_=1/0,R=-1/0,U=-1/0;const B=[];for(let ne=p;ne<=g;ne++)for(let Y=b;Y<=v;Y++){const q=this.map.getTile(ne,Y);if(!q||q.isFogged)continue;const{x:C,y:J}=na({q:ne,r:Y},r),H=C-h.x-S,ae=J-h.y-E;T=Math.min(T,H),_=Math.min(_,ae),R=Math.max(R,H+l),U=Math.max(U,ae+u),B.push({tile:q,x:H,y:ae})}if(!Number.isFinite(T)||!Number.isFinite(_)||!Number.isFinite(R)||!Number.isFinite(U))return null;const V=Math.max(1,Math.ceil(R-T)),X=Math.max(1,Math.ceil(U-_));let $=m?.canvas;(!$||$.width!==V||$.height!==X)&&($=document.createElement("canvas"),$.width=V,$.height=X);const W=$.getContext("2d");if(!W)throw new Error("Canvas 2D context not available for chunk rendering");W.setTransform(1,0,0,1,0,0),W.clearRect(0,0,V,X);for(const{tile:ne,x:Y,y:q}of B){const C=Y-T,J=q-_;W.save(),Sw(W,ne,f,C,J,l,u,r),vw(W,C+l/2,J+u/2,r),W.restore()}return{key:a,canvas:$,origin:{x:T,y:_},width:V,height:X}}}const xw=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Ra=new Array(512);for(let t=0;t<512;t++)Ra[t]=xw[t%256];const kb=new Map,Lb=t=>t*t*t*(t*(t*6-15)+10),oh=(t,a,s)=>t+s*(a-t),wc=(t,a,s)=>{switch(t&3){case 0:return a+s;case 1:return-a+s;case 2:return a-s;default:return-a-s}};function Aw(t,a){const s=Math.floor(t)&255,r=Math.floor(a)&255,l=t-Math.floor(t),u=a-Math.floor(a),f=Ra[Ra[s+1]+r+1],h=Ra[Ra[s]+r+1],m=Ra[Ra[s+1]+r],p=Ra[Ra[s]+r],g=Lb(l),b=Lb(u),v=oh(wc(p,l,u),wc(m,l-1,u),g),S=oh(wc(h,l,u-1),wc(f,l-1,u-1),g);return oh(v,S,b)}function ww(t,a,s=4){let r=0,l=1,u=1,f=0;for(let h=0;h<s;h++)r+=Aw(t*l,a*l)*u,f+=u,u*=.5,l*=2;return f>0?r/f:0}function Cw(t){const a=Math.max(32,Math.min(512,Math.round(t))),s=a,r=kb.get(s);if(r)return r;if(typeof document>"u")return null;const l=document.createElement("canvas");l.width=a,l.height=a;const u=l.getContext("2d");if(!u)return null;const f=u.createImageData(a,a),h=a/48;let m=0;for(let p=0;p<a;p++)for(let g=0;g<a;g++){const b=ww(g/h,p/h,5),v=Math.pow((b+1)/2,1.35),S=Math.round(v*255);f.data[m]=255,f.data[m+1]=255,f.data[m+2]=255,f.data[m+3]=S,m+=4}return u.putImageData(f,0,0),kb.set(s,l),l}function Db(t,a,s,r){t.beginPath();for(let l=0;l<6;l++){const u=Math.PI/180*(60*l-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?t.moveTo(f,h):t.lineTo(f,h)}t.closePath()}function Tw(t,a,s,r){const l=t.createRadialGradient(a,s,r*.08,a,s,r*1.12);return l.addColorStop(0,tu(.4,.35)),l.addColorStop(.35,tu(.2,.55)),l.addColorStop(.6,nr(.1,.78)),l.addColorStop(.82,nr(.2,.88)),l.addColorStop(1,nr(.35,.95)),l}function _w(t,a,s,r,l){if(r<=0)return;const u=Cw(r*2.2),f=r*2.5,h=a-f/2,m=s-f/2;t.save(),Db(t,a,s,r),t.clip();const p=Tw(t,a,s,r);t.fillStyle=p,t.fillRect(h,m,f,f),u&&(t.save(),t.globalCompositeOperation="lighter",t.globalAlpha*=.32,t.drawImage(u,a-r,s-r,r*2,r*2),t.restore()),t.restore(),t.save(),Db(t,a,s,r*.99),t.lineJoin="round",t.lineCap="round",t.lineWidth=nu(r,l,"hover"),t.strokeStyle=nr(.3,.88),t.shadowColor=nr(.45,.42),t.shadowBlur=Math.max(3,r*.45/Math.max(l,.1)),t.stroke(),t.restore()}class Nw{constructor(a){this.mapRef=a,this.terrainCache=new Ew(a),this.cachedHexSize=a.hexSize}terrainCache;cachedHexSize;get hexSize(){return this.mapRef.hexSize}getOrigin(){return na({q:this.mapRef.minQ,r:this.mapRef.minR},this.hexSize)}invalidateCache(){this.terrainCache.invalidate()}dispose(){this.terrainCache.dispose()}draw(a,s,r){this.ensureHexSize();const l=a.canvas??null,u=X3(this.mapRef,xe,l,this.hexSize);if(!u)return;const f=K3(u);Z3(this.mapRef,f);const h=this.getOrigin(),m=this.terrainCache.getRenderableChunks(f,this.hexSize,s,h);this.drawChunks(a,m),this.drawFogLayer(a,h,u),r&&this.drawSelection(a,h,r)}drawToCanvas(a,s,r){const l=a.getContext("2d");if(!l)throw new Error("Canvas 2D context not available");this.draw(l,s,r)}ensureHexSize(){this.cachedHexSize!==this.hexSize&&(this.cachedHexSize=this.hexSize,this.terrainCache.invalidate())}drawChunks(a,s){if(s.length!==0)for(const r of s)a.drawImage(r.canvas,r.origin.x,r.origin.y)}drawSelection(a,s,r){const{width:l,height:u}=Jc(this.hexSize),{x:f,y:h}=na(r,this.hexSize),m=f-s.x-l/2,p=h-s.y-u/2;this.strokeHex(a,m+l/2,p+u/2,this.hexSize,!0)}drawFogLayer(a,s,r){const{width:l,height:u}=Jc(this.hexSize),f=l/2,h=u/2;for(let m=r.rMin;m<=r.rMax;m++)for(let p=r.qMin;p<=r.qMax;p++){const g=this.mapRef.getTile(p,m);if(!g||!g.isFogged)continue;const{x:b,y:v}=na({q:p,r:m},this.hexSize),S=b-s.x-f,E=v-s.y-h,T=this.hexSize,_=S+l/2,R=E+u/2;_w(a,_,R,T,xe.zoom)}}strokeHex(a,s,r,l,u=!1){const{stroke:f,glow:h}=uw();this.hexPath(a,s,r,l),a.save(),a.lineJoin="round",a.lineCap="round",u?(a.shadowColor=h,a.shadowBlur=Math.max(6,l*.65/Math.max(xe.zoom,.1)),a.lineWidth=nu(l,xe.zoom,"selection"),a.strokeStyle=f,a.stroke()):(a.lineWidth=nu(l,xe.zoom,"hover"),a.shadowColor=tu(.1,.45),a.shadowBlur=Math.max(2,l*.4/Math.max(xe.zoom,.1)),a.strokeStyle=nr(.1,.72),a.stroke()),a.restore()}hexPath(a,s,r,l){a.beginPath();for(let u=0;u<6;u++){const f=Math.PI/180*(60*u-30),h=s+l*Math.cos(f),m=r+l*Math.sin(f);u===0?a.moveTo(h,m):a.lineTo(h,m)}a.closePath()}}const gi={accent:"#38bdf8",accentSoft:"rgba(56, 189, 248, 0.2)",warm:"#fbbf24",surface:"rgba(15, 23, 42, 0.92)",border:"rgba(148, 163, 184, 0.34)",text:"#e2e8f0"};let yi=null;function Qs(t,a){const s=t.trim();return s.length>0?s:a}function Rw(){if(yi)return yi;if(typeof window>"u"||typeof document>"u")return yi=gi,yi;try{const t=getComputedStyle(document.documentElement);return yi={accent:Qs(t.getPropertyValue("--color-accent"),gi.accent),accentSoft:Qs(t.getPropertyValue("--color-accent-soft"),gi.accentSoft),warm:Qs(t.getPropertyValue("--color-warning"),gi.warm),surface:Qs(t.getPropertyValue("--color-surface-strong"),gi.surface),border:Qs(t.getPropertyValue("--hud-border-strong"),gi.border),text:Qs(t.getPropertyValue("--color-foreground"),gi.text)},yi}catch(t){return console.warn("Failed to read sauna palette tokens from computed styles",t),yi=gi,yi}}function kw(t,a){const s=Math.max(0,t.auraRadius),r=na(t.pos,a),l=r.x+a,u=r.y+a;let f=a;if(s<=0)return a*1.6;for(const h of l2){const m=na({q:t.pos.q+h.q*s,r:t.pos.r+h.r*s},a),p=m.x+a,g=m.y+a,b=Math.hypot(p-l,g-u);b>f&&(f=b)}return f+a*.65}function Lw(t,a,s,r,l,u){const f=Math.max(0,Math.min(u,Math.min(r,l)/2));t.moveTo(a+f,s),t.lineTo(a+r-f,s),t.quadraticCurveTo(a+r,s,a+r,s+f),t.lineTo(a+r,s+l-f),t.quadraticCurveTo(a+r,s+l,a+r-f,s+l),t.lineTo(a+f,s+l),t.quadraticCurveTo(a,s+l,a,s+l-f),t.lineTo(a,s+f),t.quadraticCurveTo(a,s,a+f,s),t.closePath()}function Dw(t,a,{origin:s,hexSize:r,timestamp:l}){if(!a)return;const u=Rw(),f=Number.isFinite(l)?l:typeof performance<"u"?performance.now():Date.now(),h=.5+.5*Math.sin(f*.0035),m=na(a.pos,r),p=m.x-s.x+r,g=m.y-s.y+r,b=kw(a,r);t.save(),t.globalCompositeOperation="screen";const v=b+r*(.4+h*.3),S=Math.max(r*.6,b*.58),E=t.createRadialGradient(p,g,S,p,g,v);E.addColorStop(0,u.accentSoft),E.addColorStop(.55,`rgba(56, 189, 248, ${.18+h*.12})`),E.addColorStop(1,"rgba(2, 6, 23, 0)"),t.fillStyle=E,t.beginPath(),t.arc(p,g,v,0,Math.PI*2),t.fill(),t.restore(),t.save(),t.globalCompositeOperation="lighter",t.lineWidth=Math.max(r*.28,6),t.strokeStyle=`rgba(56, 189, 248, ${(.35+h*.2).toFixed(3)})`,t.shadowColor=`rgba(56, 189, 248, ${.45+h*.1})`,t.shadowBlur=r*(.9+h*.45),t.beginPath(),t.arc(p,g,b+r*.12,0,Math.PI*2),t.stroke(),t.restore();const T=r*.9;t.save(),t.beginPath(),t.arc(p,g,T,0,Math.PI*2),t.fillStyle=u.surface,t.globalAlpha*=.96,t.fill(),t.lineWidth=Math.max(1.5,r*.06),t.strokeStyle=u.border,t.shadowColor="rgba(8, 25, 53, 0.6)",t.shadowBlur=r*.45,t.stroke(),t.restore();const _=T*.78,R=Math.max(r*.22,5);t.save(),t.lineWidth=R,t.strokeStyle="rgba(148, 163, 184, 0.24)",t.beginPath(),t.arc(p,g,_,0,Math.PI*2),t.stroke(),t.restore();const U=a.playerSpawnCooldown>0?a.playerSpawnCooldown:1,V=1-Math.min(1,Math.max(0,a.playerSpawnTimer/U)),X=-Math.PI/2,$=X+Math.PI*2*V;if(V>0){t.save(),t.lineWidth=R,t.lineCap="round";const A=t.createLinearGradient(p,g-_,p,g+_);A.addColorStop(0,u.accent),A.addColorStop(1,u.warm),t.strokeStyle=A,t.shadowColor=`rgba(56, 189, 248, ${.42+h*.18})`,t.shadowBlur=r*(.65+h*.35),t.beginPath(),t.arc(p,g,_,X,$,!1),t.stroke(),t.restore()}const W=Math.max(0,a.playerSpawnTimer),ne=Math.ceil(W);t.save(),t.font=`600 ${Math.max(12,r*.9)}px "Inter", "Manrope", "Segoe UI", sans-serif`,t.fillStyle=u.text,t.textAlign="center",t.textBaseline="middle",t.shadowColor="rgba(2, 6, 23, 0.6)",t.shadowBlur=r*.35,t.fillText(String(ne),p,g),t.restore(),t.save(),t.font=`500 ${Math.max(10,r*.36)}px "Inter", "Manrope", "Segoe UI", sans-serif`,t.fillStyle="rgba(148, 163, 184, 0.78)",t.textAlign="center",t.textBaseline="top",t.fillText("sec",p,g+_*.45),t.restore();const Y="Sauna ",q=Math.max(12,r*.58);t.save(),t.font=`600 ${q}px "Inter", "Manrope", "Segoe UI", sans-serif`;const C=t.measureText(Y),J=r*.58,H=r*.32,ae=C.width+J*2,F=q+H*2,D=p-ae/2,P=g-b-F-r*.35,le=F/2;t.beginPath(),Lw(t,D,P,ae,F,le);const ee=t.createLinearGradient(D,P,D,P+F);ee.addColorStop(0,"rgba(15, 23, 42, 0.94)"),ee.addColorStop(.55,"rgba(15, 23, 42, 0.86)"),ee.addColorStop(1,"rgba(30, 41, 59, 0.9)"),t.fillStyle=ee,t.shadowColor="rgba(8, 25, 53, 0.6)",t.shadowBlur=r*.4,t.fill(),t.lineWidth=Math.max(1.5,r*.06);const x=t.createLinearGradient(D,P,D+ae,P);x.addColorStop(0,`${u.accent}`),x.addColorStop(1,`${u.warm}`),t.strokeStyle=x,t.stroke(),t.fillStyle=u.text,t.shadowColor="rgba(8, 25, 53, 0.65)",t.shadowBlur=r*.3,t.textAlign="center",t.textBaseline="middle",t.fillText(Y,p,P+F/2+q*.05),t.restore()}const vv={nativeSize:{width:64,height:64},anchor:{x:.5,y:.92},scale:{x:1,y:1},nudge:{x:0,y:-.05}},Iw={default:vv,soldier:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.9},scale:{x:1.12,y:1.24},nudge:{x:0,y:-.14}},archer:{nativeSize:{width:128,height:128},anchor:{x:.46,y:.88},scale:{x:1.1,y:1.22},nudge:{x:-.04,y:-.12}},"avanto-marauder":{nativeSize:{width:128,height:128},anchor:{x:.5,y:.92},scale:{x:1.18,y:1.3},nudge:{x:0,y:-.18}},saunoja:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.66},scale:{x:1,y:1},nudge:{x:0,y:-.02}}};function Sv(t){return Iw[t]??vv}function Mv(t,a,s,r){const{x:l,y:u}=na(t,a),f=r.nudge.x*a,h=r.nudge.y*a;return{x:l-s.x+f,y:u-s.y+h}}function Uw({coord:t,hexSize:a,origin:s,zoom:r,type:l}){const u=Sv(l),f=Mv(t,a,s,u);return{x:ea(f.x,r),y:ea(f.y,r)}}function Ow({coord:t,hexSize:a,origin:s,zoom:r,type:l}){const u=Sv(l),f=Mv(t,a,s,u),{width:h,height:m}=Jc(a),p=h*u.scale.x,g=m*u.scale.y,b=ea(f.x-p*u.anchor.x,r),v=ea(f.y-g*u.anchor.y,r),S=ea(p,r),E=ea(g,r),T=b+S*u.anchor.x,_=v+E*u.anchor.y;return{drawX:b,drawY:v,width:S,height:E,centerX:T,centerY:_,metadata:u}}function zw(t){if(!t||typeof t!="object")return!1;const a=t;return!!a.coord&&typeof a.coord=="object"&&typeof a.coord.q=="number"&&typeof a.coord.r=="number"&&typeof a.range=="number"}function Bw(t){if(!t)return null;if(zw(t)){const a=Number.isFinite(t.range)?Math.max(0,t.range):0;return{coord:t.coord,range:a}}if("pos"in t){const a="visionRange"in t&&Number.isFinite(t.visionRange)?t.visionRange:"auraRadius"in t&&Number.isFinite(t.auraRadius)?t.auraRadius:0,s=Math.max(0,Number.isFinite(a)?a:0);return{coord:t.pos,range:s}}return null}function qw(t,a,s,r,l,u){const f=window.devicePixelRatio||1,h=t.canvas.width,m=t.canvas.height;t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,h,m);const p=h/f,g=m/f;t.scale(f,f),t.translate(p/2,g/2),t.scale(xe.zoom,xe.zoom);const b=a.getOrigin();t.translate(-(xe.x-b.x),-(xe.y-b.y)),a.draw(t,s,l??void 0);const v=u?.saunojas;v&&Array.isArray(v.units)&&v.units.length>0&&v.draw(t,v.units,{originX:b.x,originY:b.y,hexRadius:a.hexSize,zoom:xe.zoom,resolveRenderCoord:v.resolveRenderCoord}),Hw(t,a,s,r,b,u?.fx,u?.friendlyVisionSources,u?.saunaVision??u?.sauna??null),u?.sauna&&Dw(t,u.sauna,{origin:b,hexSize:a.hexSize}),t.restore()}function Hw(t,a,s,r,l,u,f,h){const p=(f??r).filter(b=>b.faction==="player"&&!b.isDead()).map(b=>({coord:b.coord,range:b.getVisionRange()})),g=Bw(h);g&&p.push(g);for(const b of r){if(b.isDead()||b.faction==="enemy"&&!p.some(({coord:X,range:$})=>Zs(X,b.coord)<=$))continue;const v=s[`unit-${b.type}`]??s.placeholder,S=b.getMaxHealth();t.save();const E=u?.getUnitAlpha?.(b);if(typeof E=="number"){const X=Math.min(1,Math.max(0,E));if(X<=0){t.restore();continue}t.globalAlpha*=X}b.stats.health/S<.5&&(t.filter="saturate(0)");const T=b.renderCoord??b.coord,_=Ow({coord:T,hexSize:a.hexSize,origin:l,zoom:xe.zoom,type:b.type}),R=[];b.stats.health/S<.5&&R.push("saturate(0)");const U=Math.abs(T.q-b.coord.q),B=Math.abs(T.r-b.coord.r),V=Math.min(1,U+B);V>.01?(R.push("contrast(1.08)"),t.shadowColor="rgba(255, 255, 255, 0.28)",t.shadowBlur=Math.max(6,12*xe.zoom*V)):(t.shadowColor="rgba(0, 0, 0, 0)",t.shadowBlur=0),t.filter=R.length>0?R.join(" "):"none",t.drawImage(v,_.drawX,_.drawY,_.width,_.height),Tm()&&b.faction==="player"&&(t.strokeStyle="rgba(255,255,255,0.5)",t.lineWidth=2,t.strokeRect(_.drawX,_.drawY,_.width,_.height)),t.restore()}}const jw=200,Ib=.001;function lh(t){return{q:t.q,r:t.r}}function Cc(t,a){return!t||!a?!1:Math.abs(t.q-a.q)<Ib&&Math.abs(t.r-a.r)<Ib}class Gw{constructor(a){this.redraw=a}tracks=new Map;rafId=null;enqueue(a,s){const r=this.normalizePath(s);if(r.length<2){this.clear(a,{snap:!0});return}const l=r[0];let u=this.tracks.get(a.id);u?u.current?Cc(u.current.to,l)||(u=this.resetTrack(a,l)):Cc(a.renderCoord,l)||(u=this.resetTrack(a,l)):(u={unit:a,queue:[]},this.tracks.set(a.id,u),Cc(a.renderCoord,l)||a.setRenderCoord(l));for(let f=1;f<r.length;f++)u.queue.push(lh(r[f]));this.ensureRunning()}clear(a,s){if(!this.tracks.delete(a.id)){s?.snap&&(a.snapRenderToCoord(),this.redraw());return}(s?.snap??!0)&&(a.snapRenderToCoord(),this.redraw()),this.tracks.size===0&&this.rafId!==null&&(typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null)}clearAll(){for(const a of this.tracks.values())a.unit.snapRenderToCoord();this.tracks.clear(),this.rafId!==null&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null,this.redraw()}resetTrack(a,s){this.clear(a,{snap:!1});const r={unit:a,queue:[]};return this.tracks.set(a.id,r),a.setRenderCoord(s),r}ensureRunning(){this.rafId!==null||this.tracks.size===0||(this.rafId=requestAnimationFrame(this.step))}normalizePath(a){const s=[];for(const r of a){const l=lh(r);(s.length===0||!Cc(s[s.length-1],l))&&s.push(l)}return s}ease(a){return a<=0?0:a>=1?1:a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2}step=a=>{if(this.rafId=null,this.tracks.size===0)return;let s=!1;for(const[r,l]of this.tracks){if(!l.current){const v=l.queue.shift();if(!v){this.tracks.delete(r);continue}l.current={from:lh(l.unit.renderCoord??l.unit.coord),to:v,start:a}}const u=l.current;if(!u)continue;const h=(a-u.start)/jw,m=Math.min(1,Math.max(0,h)),p=this.ease(m),g=u.from.q+(u.to.q-u.from.q)*p,b=u.from.r+(u.to.r-u.from.r)*p;l.unit.setRenderCoord({q:g,r:b}),s=!0,m>=1&&(l.unit.setRenderCoord(u.to),l.current=void 0,l.queue.length===0&&this.tracks.delete(r))}s&&this.redraw(),this.tracks.size>0&&(this.rafId=requestAnimationFrame(this.step))}}const Yw=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,Fw=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null,Vw=900,$w=650;function Xw(t){switch(t){case"down":return{x:0,y:36};case"left":return{x:-26,y:-18};case"right":return{x:26,y:-18};case"up":default:return{x:0,y:-40}}}function Qw(t){const a=document.createElement("div");a.className="ui-floater-layer",t.appendChild(a);const s=!!Yw?.matches,r=!!Fw?.matches;return{spawn:({text:f,x:h,y:m,color:p,direction:g="up",durationMs:b,fontSize:v})=>{const S=document.createElement("span");S.className="ui-floater",S.textContent=f,S.style.left=`${Math.round(h)}px`,S.style.top=`${Math.round(m)}px`,p&&(S.style.color=p),v&&(S.style.fontSize=`${v}px`);const E=r?12:24;for(;a.childElementCount>=E;)a.firstElementChild?.remove();a.appendChild(S);const T=b??(r?$w:Vw);if(s||!S.animate){S.style.opacity="0",S.style.transition=`opacity ${Math.round(T*.8)}ms ease-out`,requestAnimationFrame(()=>{S.style.opacity="1",requestAnimationFrame(()=>{S.style.opacity="0"})}),window.setTimeout(()=>{S.remove()},T);return}const _=Xw(g),R=[{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:0},{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:1,offset:.18},{transform:`translate3d(-50%, -50%, 0) translate3d(${_.x}px, ${_.y}px, 0)`,opacity:0}],U=S.animate(R,{duration:T,easing:"cubic-bezier(0.18, 0.89, 0.32, 1.28)",fill:"forwards"});U.onfinish=()=>{S.remove()}},destroy:()=>{a.remove()}}}const Ub=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Kw=new Intl.NumberFormat("en-US",{maximumFractionDigits:1,minimumFractionDigits:0});function Ob(t){return 1-(1-t)*(1-t)}function Tc(t,a,s){return Math.min(s,Math.max(a,t))}const Pw="var(--color-danger)",Zw="color-mix(in srgb, #34d399 88%, white 12%)",Jw=720,Ww=540,eC=220,tC=180,nC=6,aC=3,iC="color-mix(in srgb, #fbbf24 82%, white 10%)",sC=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,rC=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null;function oC(t){const{canvas:a,overlay:s,mapRenderer:r,getUnitById:l,requestDraw:u}=t,f=Qw(s),h=new Map,m=new Map,p=[],g={x:0,y:0},b=!!sC?.matches,v=!!rC?.matches,S=v?Ww:Jw,E=v?tC:eC,T=v?aC:nC,_=()=>{u&&(typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>u()):u())},R=q=>{const C=a.getBoundingClientRect(),J=s.getBoundingClientRect();if(C.width===0||C.height===0)return null;const{x:H,y:ae}=na(q,r.hexSize),F=(H-xe.x)*xe.zoom+C.width/2,D=(ae-xe.y)*xe.zoom+C.height/2,P=r.hexSize*xe.zoom*.75;return{x:F+(C.left-J.left),y:D+(C.top-J.top)-P}},U=(q,C,J,H="up")=>{const ae=l(q);if(!ae)return;const F=R(ae.renderCoord??ae.coord);F&&f.spawn({text:C,x:F.x,y:F.y,color:J,direction:H,fontSize:v?18:void 0})},B=q=>{if(!q||q.amount<=0)return;const C=Ub.format(Math.max(1,Math.round(q.amount)));if(U(q.targetId,`-${C}`,Pw,"up"),!b){const J=typeof performance<"u"?performance.now():Date.now();p.push({start:J,duration:E,intensity:T,seedX:Math.random()*500,seedY:Math.random()*500})}_()},V=q=>{if(!q||q.amount<=0)return;const C=q.amount>=1?Ub.format(Math.round(q.amount)):Kw.format(Tc(q.amount,0,9.9));U(q.unitId,`+${C}`,Zw,"up"),_()},X=q=>{if(!q)return;const C=typeof performance<"u"?performance.now():Date.now();h.set(q.unitId,{start:C,duration:S}),U(q.unitId,"",iC,"down"),_()};return se.on("unitDamaged",B),se.on("unitHealed",V),se.on("unitDied",X),{step:q=>{if(b)g.x=0,g.y=0;else{let C=0,J=0;for(let H=p.length-1;H>=0;H--){const ae=p[H],F=q-ae.start;if(F>=ae.duration){p.splice(H,1);continue}const D=Tc(F/ae.duration,0,1),P=ae.intensity*Ob(1-D);C+=Math.sin((q+ae.seedX)/16)*P,J+=Math.cos((q+ae.seedY)/18)*P}g.x=C,g.y=J}for(const[C,J]of h){const H=q-J.start,ae=Tc(H/J.duration,0,1),F=1-Ob(ae);if(ae>=1){m.delete(C),h.delete(C);continue}m.set(C,Tc(F,0,1))}},getShakeOffset:()=>({x:g.x,y:g.y}),getUnitAlpha:q=>m.get(q)??1,dispose:()=>{se.off("unitDamaged",B),se.off("unitHealed",V),se.off("unitDied",X),p.length=0,h.clear(),m.clear(),f.destroy()}}}function lC(){return`${"/".endsWith("/")?"/":"//"}${"assets/units/saunoja.svg".replace(/^\/+/,"")}`}const zb=lC();let Ws=null,bo=null;function Vh(t){return!!(t&&t.complete&&t.naturalWidth>0&&t.naturalHeight>0)}function cC(t,a){if(!a)return t;try{a(t)}catch(s){console.error("Saunoja icon onLoad callback failed",s)}return t}function Ev(t){const a=r=>t?r.then(l=>cC(l,t)):r;if(Vh(Ws))return a(Promise.resolve(Ws));if(bo)return a(bo);if(typeof Image>"u")return Promise.reject(new Error("Image constructor is not available in this environment."));const s=new Image;return s.decoding="async",Ws=s,bo=new Promise((r,l)=>{const u=()=>{s.onload=null,s.onerror=null},f=()=>{u(),r(s)};s.onload=f,s.onerror=h=>{u(),Ws=null,bo=null;const m=new Error(`Failed to load saunoja icon from ${zb}`);console.warn(m.message,h),l(m)},s.src=zb,Vh(s)&&f()}),a(bo)}function uC(t,a,{originX:s=0,originY:r=0,hexRadius:l=cr,zoom:u=1,resolveRenderCoord:f}={}){if(!t||!Array.isArray(a)||a.length===0)return;const h=Vh(Ws)?Ws:null;if(!h)return;const m=Number.isFinite(l)&&l>0?l:cr,p=m*.965,g=a.map(b=>{const v=f?.(b),E=v&&typeof v=="object"&&Number.isFinite(v.q)&&Number.isFinite(v.r)?{q:v.q,r:v.r}:b.coord;return{unit:b,coord:E}}).sort((b,v)=>b.coord.r!==v.coord.r?b.coord.r-v.coord.r:b.coord.q!==v.coord.q?b.coord.q-v.coord.q:b.unit.id.localeCompare(v.unit.id));for(const{unit:b,coord:v}of g){const{x:S,y:E}=Uw({coord:v,hexSize:m,origin:{x:s,y:r},zoom:u,type:"saunoja"});t.save(),Co(t,S,E,p),t.clip();const T=h.naturalWidth||1,_=h.naturalHeight||1,R=p*1.85,U=p*2.4,B=Math.min(R/T,U/_),V=ea(T*B,u),X=ea(_*B,u),$=ea(S-V/2,u),W=ea(E-X*.78,u);t.save(),t.filter="saturate(112%) contrast(108%) brightness(1.04)",t.drawImage(h,$,W,V,X),t.restore(),t.save(),t.globalCompositeOperation="multiply";const ne=t.createRadialGradient(S,E+p*.38,p*.2,S,E+p*.38,p*1.05);ne.addColorStop(0,"rgba(22, 30, 50, 0.58)"),ne.addColorStop(1,"rgba(22, 30, 50, 0)"),t.fillStyle=ne,t.fillRect(S-p,E-p,p*2,p*2),t.restore(),t.save(),t.globalCompositeOperation="soft-light";const Y=t.createLinearGradient(S,E-p,S,E+p);Y.addColorStop(0,"rgba(233, 224, 255, 0.28)"),Y.addColorStop(.52,"rgba(196, 148, 255, 0.26)"),Y.addColorStop(1,"rgba(94, 75, 168, 0.35)"),t.fillStyle=Y,t.fillRect(S-p,E-p,p*2,p*2),t.restore(),t.save(),t.globalCompositeOperation="screen",t.globalAlpha=.68;const q=t.createRadialGradient(S,E-p*.68,p*.1,S,E,p*1.12);q.addColorStop(0,"rgba(255, 255, 255, 0.85)"),q.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=q,t.fillRect(S-p,E-p,p*2,p*2),t.restore();const J=performance.now()-b.lastHitAt,H=120;if(J<H){const D=1-J/H;Ox(t,{centerX:S,centerY:E,radius:p,progress:D})}t.restore(),zx(t,{centerX:S,centerY:E-m*.18,radius:m*.94,intensity:b.steam});const ae=m*.42,F=E+m*.34;Ux(t,{centerX:S,centerY:F,hp:b.hp,maxHp:b.maxHp,radius:ae})}}const dC=["Resolute Sauna Guardian","Steam Scholar","Frost-Hardened","Loyal Watchbearer","Aura Whisperer","Shield Brother","Stonefooted Scout","Sisu-Forged Veteran","Brewmaster Quartermaster","Icebreaker Herald","Runic Tactician","Torchbearer"],fC=["Heat Fickle","Soot Allergic","Slow to Spark","Overconfident","Distracted Dreamer","Stubborn Stoker","Thirsty Between Battles","Clumsy Footwork","Rust-Prone Gear","Echo-Lost Listener"];function Bb(t,a,s){const r=[...t],l=[],u=Math.max(0,Math.min(a,r.length));for(let f=0;f<u;f++){const h=Math.floor(s()*r.length),[m]=r.splice(h,1);m&&l.push(m)}return l}function hC(t,a){for(let s=t.length-1;s>0;s--){const r=Math.floor(a()*(s+1));[t[s],t[r]]=[t[r],t[s]]}return t}function mC(t=Math.random){typeof t!="function"&&(t=Math.random);const a=Bb(dC,2,t),s=Bb(fC,1,t),r=[...a,...s];return hC(r,t).map(l=>l.trim()).filter(l=>l.length>0)}const pC=1;function vo(t,a=0){return Number.isFinite(t)?t:a}function gC(t){const{heat:a,pickSpawnTile:s,spawnUnit:r,maxSpawns:l,tierHelpers:u}=t,f=Math.max(pC,Io),h=Math.max(0,vo(t.minUpkeepReserve??f,f));let m=Math.max(0,vo(t.availableUpkeep,0));const p=Math.max(0,Math.floor(vo(l??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY))),g=vo(t.rosterCap??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),b=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.POSITIVE_INFINITY,v=typeof t.getRosterCount=="function"?t.getRosterCount:()=>0;let S=0,E=0,T=0,_=0,R=0,U=0,B=0;for(;(a.hasTriggerReady()||u?.hasQueuedSpawn())&&S<p;){S+=1;const V=u?.getSnapshot()??null;if(Math.max(0,Math.floor(vo(v()??0,0)))>=b){U+=1;let Y=!1;V&&u&&(Y=u.queueBlockedSpawn(V,()=>a.consumeTrigger())),Y?E+=a.vent(.15):E+=a.vent(.35);break}let $=!1;if(V&&u&&u.hasQueuedSpawn()&&($=u.takeQueuedSpawn(V)),!$&&!a.hasTriggerReady())break;if(m<h){_+=1,$&&V&&u?.restoreQueuedSpawn(V),E+=a.vent(.5);break}const W=s();if(!W){R+=1,$&&V&&u?.restoreQueuedSpawn(V),E+=a.vent(.25);break}if(!r(W)){B+=1,$&&V&&u?.restoreQueuedSpawn(V),E+=a.vent(.25);break}if(!$&&!a.consumeTrigger()){B+=1;break}T+=1,m=Math.max(0,m-h),V&&u?.onSpawnResolved?.(V,{usedQueue:$})}return{spawned:T,blockedByUpkeep:_,blockedByPosition:R,blockedByRoster:U,failedSpawns:B,ventedHeat:E,remainingUpkeep:m}}function ch(t,a=0){return Number.isFinite(t)?t:a}function yC(t){const a=Math.max(0,ch(t.dt,0)),{addedHeat:s,cooledHeat:r}=t.heat.advance(a);let l=0;for(const S of t.units){if(S.isDead()||S.faction!=="player")continue;const E=Math.max(0,ch(t.getUnitUpkeep(S),0));E>0&&(l+=E)}const u=5;let h=Math.max(0,ch(t.sauna.beerUpkeepAccumulator,0)),m=0;if(l>0){if(h+=a,h>=u){const S=Math.floor(h/u);m=l*S,h-=S*u}}else h=0;t.sauna.beerUpkeepAccumulator=h,m>0&&t.state.addResource(re.SAUNA_BEER,-m);const p=t.state.getResource(re.SAUNA_BEER),g=gC({heat:t.heat,availableUpkeep:p,pickSpawnTile:t.pickSpawnTile,spawnUnit:t.spawnBaseUnit,minUpkeepReserve:t.minUpkeepReserve,maxSpawns:t.maxSpawns,rosterCap:t.rosterCap,getRosterCount:t.getRosterCount,tierHelpers:t.tierHelpers}),b=t.heat.getCooldownSeconds(),v=t.heat.timeUntilNextTrigger();return t.sauna.heat=t.heat.getHeat(),t.sauna.playerSpawnThreshold=t.heat.getThreshold(),t.sauna.playerSpawnCooldown=Number.isFinite(b)?b:0,t.sauna.playerSpawnTimer=Number.isFinite(v)?v:0,t.sauna.heatPerTick=t.heat.getBuildRate(),{addedHeat:s,cooledHeat:r,upkeepDrain:m,spawn:g,beerRemaining:t.state.getResource(re.SAUNA_BEER),availableUpkeep:g.remainingUpkeep}}function bC(){try{return globalThis.localStorage??null}catch(t){return console.warn("Unable to access localStorage for inventory persistence",t),null}}function vC(t,a){const s=t.getItem(a);if(s)try{return JSON.parse(s)}catch(r){console.warn(`Failed to parse persisted inventory for "${a}", clearing.`,r),t.removeItem(a);return}}function _c(t,a,s){const r=Number.isFinite(t.quantity)?t.quantity:1,l=Math.max(1,Math.round(r)),u=typeof t.rarity=="string"?t.rarity.trim():void 0,f=typeof t.icon=="string"?t.icon:void 0,h=typeof t.description=="string"?t.description:void 0;return{id:t.id,name:t.name,description:h,icon:f,rarity:u,quantity:l,acquiredAt:a,sourceTableId:s?.tableId,sourceEntryId:s?.entryId}}class SC{listeners=new Set;storageKey;now;maxStashSize;storage;autoEquip;stash=[];inventory=[];constructor(a={}){this.storageKey=a.storageKey??"autobattles:inventory",this.now=typeof a.now=="function"?a.now:()=>Date.now(),this.maxStashSize=Math.max(1,Math.floor(a.maxStashSize??24)),this.storage=bC(),this.autoEquip=a.autoEquip??!0,this.load()}load(){if(!this.storage)return;const a=vC(this.storage,this.storageKey);if(a){if(typeof a.autoEquip=="boolean"&&(this.autoEquip=a.autoEquip),Array.isArray(a.stash)){const s=[];for(const r of a.stash){if(!r||typeof r!="object")continue;const{id:l,name:u,quantity:f}=r;if(typeof l!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(_c({id:l,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.stash=s.slice(0,this.maxStashSize)}if(Array.isArray(a.inventory)){const s=[];for(const r of a.inventory){if(!r||typeof r!="object")continue;const{id:l,name:u,quantity:f}=r;if(typeof l!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(_c({id:l,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.inventory=s}}}persist(){if(!this.storage)return;const a={autoEquip:this.autoEquip,stash:this.stash.map(s=>({...s})),inventory:this.inventory.map(s=>({...s}))};try{this.storage.setItem(this.storageKey,JSON.stringify(a))}catch(s){console.warn("Failed to persist inventory state",s)}}emit(a){for(const s of this.listeners)s(a)}normalizeEquipResult(a){return typeof a=="boolean"?{success:a}:!a||typeof a!="object"?{success:!1}:{success:!!a.success,comparison:a.comparison,reason:a.reason}}on(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}isAutoEquipEnabled(){return this.autoEquip}setAutoEquip(a){this.autoEquip!==a&&(this.autoEquip=a,this.persist(),this.emit({type:"settings-updated",autoEquip:this.autoEquip}))}getStash(){return this.stash.map(a=>({...a}))}getStashSize(){return this.stash.length}getInventory(){return this.inventory.map(a=>({...a}))}getInventorySize(){return this.inventory.length}addLoot(a,s={}){return this.addItem({...a.item},{...s,sourceTableId:s.sourceTableId,sourceEntryId:s.sourceEntryId??a.entryId})}addItem(a,s={}){const r=Math.max(0,Math.round(this.now())),l=_c(a,r,{tableId:s.sourceTableId,entryId:s.sourceEntryId}),u=s.autoEquip??this.autoEquip;let f={success:!1};if(u&&s.unitId&&typeof s.equip=="function"){try{f=this.normalizeEquipResult(s.equip(s.unitId,l))}catch(h){console.warn("Failed to auto-equip inventory item",{item:l,error:h}),f={success:!1}}if(f.success)return this.persist(),this.emit({type:"item-acquired",item:l,equipped:!0,location:"equipped",unitId:s.unitId,stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:l,equipped:!0,location:"equipped"}}if(this.stash.push(l),this.stash.length>this.maxStashSize){const h=this.stash.splice(0,this.stash.length-this.maxStashSize);h.length>0&&console.warn("Inventory stash full, trimming oldest items",h)}return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-acquired",item:l,equipped:!1,unitId:s.unitId,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:l,equipped:!1,location:"stash",stashIndex:this.stash.length-1}}equipFromStash(a,s,r){if(a<0||a>=this.stash.length)return!1;const l=this.stash[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,l))}catch(h){console.warn("Failed to equip stash item",{item:l,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}equipFromInventory(a,s,r){if(a<0||a>=this.inventory.length)return!1;const l=this.inventory[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,l))}catch(h){console.warn("Failed to equip inventory item",{item:l,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}moveToInventory(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.inventory.push(s),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-moved",item:s,from:"stash",to:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}moveToStash(a){if(this.stash.length>=this.maxStashSize||a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.stash.push(s),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-moved",item:s,from:"inventory",to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}discardFromInventory(a){if(a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-discarded",item:s,location:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}unequipToStash(a,s,r){if(this.stash.length>=this.maxStashSize)return!1;let l=null;try{l=r(a,s)??null}catch(h){console.warn("Failed to unequip item",{unitId:a,slot:s,error:h}),l=null}if(!l)return!1;const u=Math.max(0,Math.round(this.now())),f=_c(l,u);return this.stash.push(f),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-unequipped",item:f,unitId:a,slot:s,to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),!0}discardFromStash(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-discarded",item:s,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}}const qb={toast:990},MC={stash:"Quartermaster Stash",inventory:"Ready Inventory"},EC={stash:"Your stash is empty. Conquer enemy elites to gather new equipment.",inventory:"No gear staged. Move items into the ready inventory for quick equipping."},xC={mythic:6,legendary:5,epic:4,rare:3,uncommon:2,common:1},AC=["health","attackDamage","attackRange","movementRange","defense","shield"],wC={"birch-sap-satchel":["healing","support"],"steamed-bandages":["restoration","shielding"],"aurora-distillate":["damage","defense"],"stolen-sauna-tokens":["mobility"],"midnight-bloodwine":["healing","damage"],"sauna-incense":["range","focus"],"glacier-brand":["damage"],"emberglass-arrow":["damage","range"],"aurora-lattice":["damage","range"],"emberglass-shard":["damage","mobility"],"windstep-totem":["mobility","defense"],"searing-chant-censer":["damage","shielding"],"cracked-ice-amulet":["defense"],"myrsky-charm":["range","defense"],"frostwyrm-signet":["shielding"],"spirit-oak-charm":["healing","defense"]};function Ia(t){return(t??"").trim().toLowerCase()}function uh(t){const a=new Set;for(const s of t){const r=Ia(s);r&&a.add(r)}return a}function dh(t,a){return{id:t.id,name:t.name,quantity:typeof a=="number"?a:t.quantity,rarity:t.rarity}}function Nc(t){return t?{id:t.id,name:t.name,quantity:t.quantity,rarity:t.rarity}:null}function Hb(t){return wC[t]??[]}function jb(t){const a=Ia(t)||"common",s=a.charAt(0).toUpperCase()+a.slice(1);return{key:a,label:s,rank:xC[a]??0}}function CC(t){const a=Yo(t.id);if(!a){const l=jb(t.rarity);return{slot:null,slotLabel:"Unassigned",rarity:l.key,rarityRank:l.rank,tags:Hb(t.id),acquiredAt:t.acquiredAt}}const s=Go(a.slot),r=jb(t.rarity);return{slot:a.slot,slotLabel:s.label,rarity:r.key,rarityRank:r.rank,tags:Hb(t.id),acquiredAt:t.acquiredAt}}function TC(t,a,s,r,l){return{id:t.id,name:t.name,description:t.description,icon:t.icon,rarity:t.rarity,quantity:l,slot:a,maxStacks:s,modifiers:r??{}}}function Gb(t,a){const s=t[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function _C(t,a){const s=Yo(t.item.id);if(!s)return{slot:null,canEquip:!1,reason:"unknown-item",equipped:null,projected:dh(t.item),stats:[]};const r=s.slot,l=Go(r),u=a.loadout.find(_=>_.slot===r)??null,f=Math.max(1,Math.round(t.item.quantity)),h=Math.max(1,Math.floor(s.maxStacks??l.maxStacks)),m=(u?.quantity??0)+f,p=m>h;if(u&&u.id!==t.item.id)return{slot:r,canEquip:!1,reason:"slot-occupied",equipped:Nc(u),projected:dh(t.item),stats:[]};if(p&&(!u||u.id!==t.item.id))return{slot:r,canEquip:!1,reason:"stack-limit",equipped:Nc(u),projected:dh(t.item,Math.min(h,m)),stats:[]};const g=Math.min(h,m),b=[];for(const _ of a.loadout)_.slot!==r&&b.push({..._});const v=u&&u.id===t.item.id?{...u,quantity:g}:TC(t.item,r,h,s.modifiers,g);b.push(v);const S=a.currentStats??$c(a.baseStats,a.loadout),E=$c(a.baseStats,b),T=AC.map(_=>{const R=Gb(S,_),U=Gb(E,_);return{stat:_,current:R,projected:U,delta:U-R}});return{slot:r,canEquip:!0,equipped:Nc(u),projected:Nc(v),stats:T}}function Yb(t,a){return t.map((s,r)=>({item:s,index:r,location:a,metadata:CC(s)}))}function NC(t,a){const s=new Map,r=new Map,l=new Map;for(const m of t){const{metadata:p}=m;if(p.slot){const S=p.slot,E=s.get(S);E?E.count+=1:s.set(S,{label:p.slotLabel,count:1})}const g=p.rarity,b=g.charAt(0).toUpperCase()+g.slice(1),v=r.get(g);v?v.count+=1:r.set(g,{label:b,count:1,rank:p.rarityRank});for(const S of p.tags){const E=Ia(S);if(!E)continue;const T=S.split(/[-_]/g).map(R=>R.charAt(0).toUpperCase()+R.slice(1)).join(" "),_=l.get(E);_?_.count+=1:l.set(E,{label:T,count:1})}}const u=Array.from(s.entries()).sort((m,p)=>{const g=lr.indexOf(m[0]),b=lr.indexOf(p[0]);return g-b}).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.slots.has(Ia(m))})),f=Array.from(r.entries()).sort((m,p)=>(p[1].rank??0)-(m[1].rank??0)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.rarities.has(Ia(m))})),h=Array.from(l.entries()).sort((m,p)=>m[1].label.localeCompare(p[1].label)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.tags.has(Ia(m))}));return{slots:u,rarities:f,tags:h}}function RC(t,a){if(a.slots.size>0){const s=t.metadata.slot?Ia(t.metadata.slot):"";if(!s||!a.slots.has(s))return!1}return!(a.rarities.size>0&&!a.rarities.has(t.metadata.rarity)||a.tags.size>0&&!t.metadata.tags.map(l=>Ia(l)).some(l=>a.tags.has(l)))}function kC(t,a){return a?[t.item.name,t.item.description??"",t.metadata.tags.join(" ")].join(" ").toLowerCase().includes(a):!0}function LC(t,a){switch(a){case"oldest":t.sort((s,r)=>s.metadata.acquiredAt-r.metadata.acquiredAt);break;case"rarity":t.sort((s,r)=>r.metadata.rarityRank!==s.metadata.rarityRank?r.metadata.rarityRank-s.metadata.rarityRank:r.metadata.acquiredAt-s.metadata.acquiredAt);break;case"name":t.sort((s,r)=>s.item.name.localeCompare(r.item.name));break;case"newest":default:t.sort((s,r)=>r.metadata.acquiredAt-s.metadata.acquiredAt);break}}function Fb(t){const a={slots:uh(t.filters.slots??new Set),rarities:uh(t.filters.rarities??new Set),tags:uh(t.filters.tags??new Set)},s=Ia(t.search),r=Math.max(1,Math.floor(t.page||1)),l=Math.max(1,Math.floor(t.pageSize||24)),u=t.collection??"stash",f=Yb(t.stash,"stash"),h=Yb(t.inventory,"inventory"),m=[...f,...h],p=NC(m,a),g=u==="stash"?f:h,v=[...g.filter(B=>RC(B,a)&&kC(B,s))];LC(v,t.sort??"newest");const S=Math.min(v.length,r*l),E=v.slice(0,S),T=v.length>S,_=t.comparisonContext??null,R=E.map(B=>({item:B.item,index:B.index,location:B.location,metadata:B.metadata,comparison:_?_C(B,_):null})),U=["stash","inventory"].map(B=>({id:B,label:MC[B],count:B==="stash"?t.stash.length:t.inventory.length,active:B===u}));return{collection:u,collections:U,filters:p,items:R,total:g.length,filteredTotal:v.length,search:t.search,sort:t.sort??"newest",hasMore:T,emptyMessage:EC[u]}}function DC(){return{slots:new Set,rarities:new Set,tags:new Set}}const IC="_panel_7op0d_1",UC="_header_7op0d_32",OC="_title_7op0d_42",zC="_meta_7op0d_49",BC="_close_7op0d_54",qC="_controls_7op0d_74",HC="_settings_7op0d_82",jC="_settingRow_7op0d_93",GC="_settingCopy_7op0d_107",YC="_settingLabel_7op0d_114",FC="_settingHint_7op0d_120",VC="_settingControl_7op0d_127",$C="_settingState_7op0d_133",XC="_settingInput_7op0d_143",QC="_settingSwitch_7op0d_149",KC="_settingTrack_7op0d_169",PC="_settingThumb_7op0d_181",ZC="_collections_7op0d_197",JC="_collectionButton_7op0d_205",WC="_searchRow_7op0d_234",eT="_search_7op0d_234",tT="_searchIcon_7op0d_266",nT="_sortSelect_7op0d_276",aT="_body_7op0d_286",iT="_grid_7op0d_292",sT="_empty_7op0d_301",rT="_footer_7op0d_312",oT="_loadMore_7op0d_317",Ue={panel:IC,header:UC,title:OC,meta:zC,close:BC,controls:qC,settings:HC,settingRow:jC,settingCopy:GC,settingLabel:YC,settingHint:FC,settingControl:VC,settingState:$C,settingInput:XC,settingSwitch:QC,settingTrack:KC,settingThumb:PC,collections:ZC,collectionButton:JC,searchRow:WC,search:eT,searchIcon:tT,sortSelect:nT,body:aT,grid:iT,empty:sT,footer:rT,loadMore:oT},lT="_group_18afl_1",cT="_label_18afl_11",uT="_row_18afl_19",dT="_chip_18afl_25",fT="_count_18afl_55",ko={group:lT,label:cT,row:uT,chip:dT,count:fT},hT="_card_1o0cv_1",mT="_header_1o0cv_26",pT="_icon_1o0cv_32",gT="_details_1o0cv_44",yT="_titleRow_1o0cv_51",bT="_title_1o0cv_51",vT="_rarity_1o0cv_63",ST="_slot_1o0cv_70",MT="_tags_1o0cv_75",ET="_tag_1o0cv_75",xT="_compare_1o0cv_91",AT="_tooltip_1o0cv_113",wT="_statList_1o0cv_144",CT="_stat_1o0cv_144",TT="_actions_1o0cv_169",_T="_action_1o0cv_169",NT="_primary_1o0cv_198",RT="_danger_1o0cv_209",kT="_badge_1o0cv_224",ct={card:hT,header:mT,icon:pT,details:gT,titleRow:yT,title:bT,rarity:vT,slot:ST,tags:MT,tag:ET,compare:xT,tooltip:AT,statList:wT,stat:CT,actions:TT,action:_T,primary:NT,danger:RT,badge:kT},LT={health:"HP",attackDamage:"ATK",attackRange:"Range",movementRange:"Move",defense:"Defense",shield:"Shield"},Vb={"slot-occupied":"Slot occupied. Unequip the current item first.","stack-limit":"Stack limit reached for this item.","unknown-item":"This item cannot be equipped yet."},zc=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function DT(t,a){if(a.item.icon){const r=document.createElement("img");r.src=a.item.icon,r.alt="",r.loading="lazy",r.decoding="async",r.width=48,r.height=48,t.appendChild(r);return}const s=document.createElement("span");s.textContent=a.item.name.trim()[0]?.toUpperCase()??"?",t.appendChild(s)}function xv(t){if(!(!t||t.canEquip))return t.reason&&Vb[t.reason]?Vb[t.reason]:"Unable to equip this item right now."}function IT(t,a){const s=document.createElement("div");s.className=ct.tooltip;const r=document.createElement("h4");if(a.projected?r.textContent=a.canEquip?"Projected stats":"Current loadout":r.textContent="Stats",s.appendChild(r),!a.canEquip){const u=xv(a);if(u){const f=document.createElement("p");f.textContent=u,f.style.margin="0 0 0.5rem",f.style.fontSize="0.78rem",s.appendChild(f)}}const l=document.createElement("ul");l.className=ct.statList;for(const u of t){const f=document.createElement("li");f.className=ct.stat,u.delta>0?f.dataset.delta="positive":u.delta<0&&(f.dataset.delta="negative");const h=document.createElement("span");h.textContent=LT[u.stat]??u.stat;const m=document.createElement("span"),p=zc.format(u.current),g=zc.format(u.projected),b=u.delta,v=b===0?"0":`${b>0?"+":""}${zc.format(Math.abs(b))}`;m.textContent=`${p}  ${g} (${v})`,f.append(h,m),l.appendChild(f)}return s.appendChild(l),s}function UT(t){const a=t.comparison;if(!a)return null;const s=document.createElement("div"),r=document.createElement("button");r.type="button",r.className=ct.compare,r.textContent=a.canEquip?"Compare stats":"View details";const l=`${t.item.id}-compare-${t.location}-${t.index}`;r.setAttribute("aria-controls",l),r.setAttribute("aria-expanded","false"),r.setAttribute("aria-describedby",l),r.addEventListener("focus",()=>{r.setAttribute("aria-expanded","true")}),r.addEventListener("blur",()=>{r.setAttribute("aria-expanded","false")}),s.appendChild(r);const u=IT(a.stats,a);return u.id=l,s.appendChild(u),s}function OT(t,a){if(a&&!a.canEquip){t.disabled=!0;const s=xv(a);s&&(t.title=s)}}function zT(t){return t.map(a=>{const s=a.trim();return s&&s.split(/[-_\s]/g).map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")})}function BT(t,a,s){const r=document.createElement("div");r.className=ct.actions;const l=document.createElement("button");l.type="button",l.className=`${ct.action} ${ct.primary}`,l.textContent="Equip",OT(l,a.comparison),l.addEventListener("click",()=>{s.onEquip?.()}),r.appendChild(l);const u=document.createElement("button");u.type="button",u.className=ct.action,u.textContent=a.location==="stash"?"Send to inventory":"Return to stash",u.addEventListener("click",()=>{s.onTransfer?.()}),r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=`${ct.action} ${ct.danger}`,f.textContent="Trash";let h=null;const m=()=>{h!==null&&(window.clearTimeout(h),h=null),f.dataset.confirm="false",f.textContent="Trash"};f.addEventListener("click",()=>{if(h!==null){m(),s.onTrash?.();return}f.dataset.confirm="true",f.textContent="Confirm trash",h=window.setTimeout(()=>{m()},2600)}),r.appendChild(f),t.appendChild(r)}function qT(t,a){const s=document.createElement("li");s.className=ct.card,s.dataset.location=t.location,s.setAttribute("role","listitem");const r=document.createElement("div");r.className=ct.header;const l=document.createElement("div");l.className=ct.icon,DT(l,t),r.appendChild(l);const u=document.createElement("div");u.className=ct.details;const f=document.createElement("div");f.className=ct.titleRow;const h=document.createElement("h4");h.className=ct.title,h.textContent=t.item.name,f.appendChild(h);const m=document.createElement("span");m.className=ct.rarity,m.textContent=t.metadata.rarity.toUpperCase(),f.appendChild(m),u.appendChild(f);const p=document.createElement("span");if(p.className=ct.slot,p.textContent=t.metadata.slot?t.metadata.slotLabel:"No slot",u.appendChild(p),t.metadata.tags.length>0){const b=document.createElement("div");b.className=ct.tags;for(const v of zT(t.metadata.tags)){const S=document.createElement("span");S.className=ct.tag,S.textContent=v,b.appendChild(S)}u.appendChild(b)}const g=UT(t);if(g&&u.appendChild(g),r.appendChild(u),s.appendChild(r),t.item.quantity>1){const b=document.createElement("span");b.className=ct.badge,b.textContent=`${zc.format(t.item.quantity)}`,s.appendChild(b)}return BT(s,t,a),s}const HT={newest:"Newest",oldest:"Oldest",rarity:"Rarity",name:"Name A-Z"};function fh(t){const a=document.createElement("div");a.className=ko.row;const s=document.createElement("div");s.className=ko.label,s.textContent=t;const r=document.createElement("div");return r.className=ko.group,a.append(s,r),{row:a,group:r}}function jT(t){const a=document.createElement("section");a.className=Ue.panel,a.tabIndex=-1,a.dataset.open="false",a.setAttribute("aria-label","Quartermaster stash");const s=document.createElement("header");s.className=Ue.header;const r=document.createElement("div"),l=document.createElement("h2");l.className=Ue.title,l.textContent="Quartermaster Stash",r.appendChild(l);const u=document.createElement("div");u.className=Ue.meta,u.textContent="Loading",r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=Ue.close,f.textContent="Close",f.addEventListener("click",()=>t.onClose?.()),s.append(r,f),a.appendChild(s);const h=document.createElement("div");h.className=Ue.controls;const m=document.createElement("div");m.className=Ue.collections;const p={stash:document.createElement("button"),inventory:document.createElement("button")};p.stash.type="button",p.stash.className=Ue.collectionButton,p.stash.textContent="Stash",p.stash.addEventListener("click",()=>t.onCollectionChange?.("stash")),p.inventory.type="button",p.inventory.className=Ue.collectionButton,p.inventory.textContent="Ready",p.inventory.addEventListener("click",()=>t.onCollectionChange?.("inventory")),m.append(p.stash,p.inventory),h.appendChild(m);const g=document.createElement("div");g.className=Ue.searchRow;const b=document.createElement("div");b.className=Ue.search;const v=document.createElement("input");v.type="search",v.placeholder="Search stash",v.addEventListener("input",()=>t.onSearchChange?.(v.value));const S=document.createElement("span");S.className=Ue.searchIcon,S.textContent="",b.append(S,v),g.appendChild(b);const E=document.createElement("select");E.className=Ue.sortSelect,["newest","oldest","rarity","name"].forEach(H=>{const ae=document.createElement("option");ae.value=H,ae.textContent=HT[H],E.appendChild(ae)}),E.addEventListener("change",()=>t.onSortChange?.(E.value)),g.appendChild(E),h.appendChild(g);const T=document.createElement("div");T.className=Ue.settings;const _=(H,ae,F,D)=>{const P=document.createElement("div");P.className=Ue.settingRow;const le=document.createElement("div");le.className=Ue.settingCopy;const ee=document.createElement("span");ee.className=Ue.settingLabel,ee.textContent=ae,le.appendChild(ee);const x=document.createElement("p");x.className=Ue.settingHint,x.textContent=F,le.appendChild(x);const A=document.createElement("div");A.className=Ue.settingControl;const z=document.createElement("span");z.className=Ue.settingState,z.textContent="Off";const Q=document.createElement("input");Q.type="checkbox",Q.id=H,Q.className=Ue.settingInput;const oe=document.createElement("label");oe.className=Ue.settingSwitch,oe.htmlFor=H,oe.dataset.state="off";const de=document.createElement("span");de.className=Ue.settingTrack;const ue=document.createElement("span");ue.className=Ue.settingThumb,oe.append(de,ue);const ve=ge=>{Q.checked=ge,oe.dataset.state=ge?"on":"off",z.textContent=ge?"On":"Off"};return Q.addEventListener("change",()=>{ve(Q.checked),D?.(Q.checked)}),A.append(z,Q,oe),P.append(le,A),{root:P,setChecked:ve}},R=_("inventory-autoequip-toggle","Auto-equip loot","Try outfitting the selected attendant as soon as new gear arrives.",H=>t.onAutoEquipChange?.(H)),U=_("inventory-ui-variant-toggle","Experimental HUD","Swap to the React/Tailwind HUD. You can revert at any time.",H=>t.onUiV2Change?.(H));R.setChecked(t.getAutoEquipState?.()??!1),U.setChecked(t.getUiV2State?.()??!1),T.append(R.root,U.root),h.appendChild(T);const B=document.createElement("div"),V={slots:fh("Slots"),rarities:fh("Rarity"),tags:fh("Tags")};B.append(V.slots.row,V.rarities.row,V.tags.row),h.appendChild(B),a.appendChild(h);const X=document.createElement("div");X.className=Ue.body;const $=document.createElement("ul");$.className=Ue.grid;const W=document.createElement("div");W.className=Ue.empty,W.textContent="No items match the current filters.",W.hidden=!0,X.append($,W),a.appendChild(X);const ne=document.createElement("div");ne.className=Ue.footer;const Y=document.createElement("button");Y.type="button",Y.className=Ue.loadMore,Y.textContent="Show more",Y.addEventListener("click",()=>t.onLoadMore?.()),ne.appendChild(Y),a.appendChild(ne);function q(H,ae,F){H.group.innerHTML="",H.row.hidden=F.length===0;for(const D of F){const P=document.createElement("button");if(P.type="button",P.className=ko.chip,P.dataset.active=D.active?"true":"false",P.textContent=D.label,D.count>0){const le=document.createElement("span");le.className=ko.count,le.textContent=String(D.count),P.appendChild(le)}P.addEventListener("click",()=>t.onFilterToggle?.(ae,D.id)),H.group.appendChild(P)}}function C(H){$.replaceChildren();const ae=document.createDocumentFragment();for(const F of H.items){const D={onEquip:()=>t.onItemEquip?.(F),onTransfer:()=>t.onItemTransfer?.(F),onTrash:()=>t.onItemTrash?.(F)};ae.appendChild(qT(F,D))}$.appendChild(ae),W.hidden=H.filteredTotal!==0,W.hidden||(W.textContent=H.emptyMessage)}return{element:a,render(H){u.textContent=H.total===0?"No items yet":`${H.filteredTotal} of ${H.total} item${H.total===1?"":"s"}`;for(const[ae,F]of Object.entries(p))F.dataset.active=ae===H.collection?"true":"false";v.value!==H.search&&(v.value=H.search),E.value!==H.sort&&(E.value=H.sort),q(V.slots,"slots",H.filters.slots),q(V.rarities,"rarities",H.filters.rarities),q(V.tags,"tags",H.filters.tags),C(H),Y.hidden=!H.hasMore},setOpen(H){a.dataset.open=H?"true":"false"},focus(){const H=a.focus.bind(a);try{H({preventScroll:!0})}catch(ae){console.warn("Stash panel focus without scroll prevention fallback",ae);try{H()}catch(F){console.warn("Unable to focus stash panel element",F)}}},destroy(){a.remove()},setAutoEquip(H){R.setChecked(H)},setUiV2(H){U.setChecked(H)}}}const Av="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcm9sZT0iaW1nIiBhcmlhLWxhYmVsbGVkYnk9InRpdGxlIiBmb2N1c2FibGU9ImZhbHNlIj4KICA8dGl0bGU+QXJ0b2NvaW4gaWNvbjwvdGl0bGU+CiAgPGRlZnM+CiAgICA8cmFkaWFsR3JhZGllbnQgaWQ9ImNvaW5Db3JlIiBjeD0iNTAlIiBjeT0iNDAlIiByPSI3MCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjZmZkZTlhIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjQ1JSIgc3RvcC1jb2xvcj0iI2Y4Yjg1OCIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjZDg3YTFkIiAvPgogICAgPC9yYWRpYWxHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iY29pblJpbSIgeDE9IjE1JSIgeTE9IjAlIiB4Mj0iODUlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmZGYxY2QiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iNDUlIiBzdG9wLWNvbG9yPSIjZjNjNDYzIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNiMTY0MTQiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJyaW1IaWdobGlnaHQiIHgxPSIzMCUiIHkxPSIxMCUiIHgyPSI3MCUiIHkyPSI5MCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjZmZmNGRjIiBzdG9wLW9wYWNpdHk9IjAuODUiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iNDAlIiBzdG9wLWNvbG9yPSIjZmZkZjliIiBzdG9wLW9wYWNpdHk9IjAuNTUiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iI2Y0YTg0OCIgc3RvcC1vcGFjaXR5PSIwLjMiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPHJhZGlhbEdyYWRpZW50IGlkPSJmYWNlVG9uZSIgY3g9IjU1JSIgY3k9IjM1JSIgcj0iNzAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZGNhOCIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI3MCUiIHN0b3AtY29sb3I9IiNmM2E5NWQiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iI2VhOGM0NCIgLz4KICAgIDwvcmFkaWFsR3JhZGllbnQ+CiAgICA8cGF0aCBpZD0ibGFiZWxQYXRoIiBkPSJNMjcgNTVhMzcgMzcgMCAwIDEgNzQgMCIgLz4KICA8L2RlZnM+CiAgPGcgZmlsbD0ibm9uZSI+CiAgICA8Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSI2MCIgZmlsbD0idXJsKCNjb2luUmltKSIgc3Ryb2tlPSIjNWUyYzAyIiBzdHJva2Utd2lkdGg9IjIiIC8+CiAgICA8Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSI2MCIgZmlsbD0idXJsKCNyaW1IaWdobGlnaHQpIiBvcGFjaXR5PSIwLjM1IiAvPgogICAgPGNpcmNsZSBjeD0iNjQiIGN5PSI2NCIgcj0iNDgiIGZpbGw9InVybCgjY29pbkNvcmUpIiBzdHJva2U9IiM1ZTJjMDIiIHN0cm9rZS13aWR0aD0iMS42IiAvPgogICAgPGNpcmNsZSBjeD0iNjQiIGN5PSI2NCIgcj0iNDIiIGZpbGw9InVybCgjY29pbkNvcmUpIiBvcGFjaXR5PSIwLjY1IiAvPgogICAgPGcgZmlsbD0iIzRiMjIwMCIgZm9udC1mYW1pbHk9IidNb250c2VycmF0JywnSW50ZXInLCdHaWxsIFNhbnMnLHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSI3MDAiIGxldHRlci1zcGFjaW5nPSIwLjQiPgogICAgICA8dGV4dD4KICAgICAgICA8dGV4dFBhdGggaHJlZj0iI2xhYmVsUGF0aCIgc3RhcnRPZmZzZXQ9IjUwJSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QVJUT0NPSU48L3RleHRQYXRoPgogICAgICA8L3RleHQ+CiAgICA8L2c+CiAgICA8Y2lyY2xlIGN4PSI0MCIgY3k9Ijc0IiByPSIzLjIiIGZpbGw9IiNjOTdhMjMiIC8+CiAgICA8Y2lyY2xlIGN4PSI4OCIgY3k9Ijc0IiByPSIzLjIiIGZpbGw9IiNjOTdhMjMiIC8+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2NCA3NCkiPgogICAgICA8ZWxsaXBzZSBjeD0iMCIgY3k9Ii0yIiByeD0iMjIiIHJ5PSIyNiIgZmlsbD0idXJsKCNmYWNlVG9uZSkiIHN0cm9rZT0iIzQ4MWUwNiIgc3Ryb2tlLXdpZHRoPSIxLjYiIC8+CiAgICAgIDxwYXRoIGQ9Ik0gLTIyIC02IEMgLTE2IC0xNSAtNyAtMjIgMCAtMjIgQyA3IC0yMiAxNiAtMTUgMjIgLTYgQyAyMCAtMjQgOSAtMzIgMCAtMzIgQyAtOSAtMzIgLTIwIC0yNCAtMjIgLTYgWiIgZmlsbD0iIzZjM2YyMyIgLz4KICAgICAgPHBhdGggZD0iTSAtMTMgLTI0IEMgLTcgLTMwIDEgLTMyIDggLTI4IEMgNiAtMzMgMSAtMzYgLTUgLTM2IEMgLTExIC0zNiAtMTYgLTMyIC0xNyAtMjcgQyAtMTYgLTI1IC0xNC41IC0yNC4yIC0xMyAtMjQgWiIgZmlsbD0iIzUzMmExMyIgLz4KICAgICAgPHJlY3QgeD0iLTE4IiB5PSItOSIgd2lkdGg9IjE0IiBoZWlnaHQ9IjkuNSIgcng9IjMuOCIgZmlsbD0iIzFjMWExOCIgLz4KICAgICAgPHJlY3QgeD0iNCIgeT0iLTkiIHdpZHRoPSIxNCIgaGVpZ2h0PSI5LjUiIHJ4PSIzLjgiIGZpbGw9IiMxYzFhMTgiIC8+CiAgICAgIDxyZWN0IHg9Ii00IiB5PSItNi40IiB3aWR0aD0iOCIgaGVpZ2h0PSIyLjYiIHJ4PSIxLjMiIGZpbGw9IiMxYzFhMTgiIC8+CiAgICAgIDxwYXRoIGQ9Ik0gLTguOCAtNiBWIC03LjQgQyAtOC44IC04LjYgLTcuOSAtOS40IC02LjYgLTkuNCBIIDEuNCBDIDIuNyAtOS40IDMuNiAtOC42IDMuNiAtNy40IFYgLTYgQyAzLjYgLTMuMSAxLjUgLTEuMiAtMS42IC0xLjIgQyAtNC43IC0xLjIgLTYuOCAtMy4xIC02LjggLTYgWiIgZmlsbD0iIzJiMjcyNCIgLz4KICAgICAgPHBhdGggZD0iTSAtMTEuMiAtMS4yIEMgLTguOCAxLjEgLTQuOCAyLjQgMCAyLjQgQyA0LjggMi40IDguOCAxLjEgMTEuMiAtMS4yIEMgMTAuOCAtMy4yIDkuNCAtNC44IDcgLTUuNiBDIDQuNyAtNC43IDIuNCAtNC4yIDAgLTQuMiBDIC0yLjQgLTQuMiAtNC43IC00LjcgLTcgLTUuNiBDIC05LjQgLTQuOCAtMTAuOCAtMy4yIC0xMS4yIC0xLjIgWiIgZmlsbD0iI2U0ODM0YSIgLz4KICAgICAgPHBhdGggZD0iTSAtMTAgMS42IEMgLTYgNi42IC0yIDguMiAwIDguMiBDIDIgOC4yIDYgNi42IDEwIDEuNiBWIC0xLjYgQyA2IC0wLjYgMiAwLjIgMCAwLjIgQyAtMiAwLjIgLTYgLTAuNiAtMTAgLTEuNiBWIDEuNiBaIiBmaWxsPSIjNmYyYjE5IiAvPgogICAgICA8cGF0aCBkPSJNIDAgMTIuMiBDIC00LjYgMTIuMiAtOC42IDEwLjggLTExLjggOC4yIEMgLTEwLjYgMTMuMSAtNi4xIDE2LjIgMCAxNi4yIEMgNi4xIDE2LjIgMTAuNiAxMy4xIDExLjggOC4yIEMgOC42IDEwLjggNC42IDEyLjIgMCAxMi4yIFoiIGZpbGw9IiNmNmIxNjciIC8+CiAgICA8L2c+CiAgICA8cGF0aCBkPSJNNjQgMjhjLTkuNiAwLTE4LjQgMi44LTI1LjggNy44LTEuNCAxLTEgMy4zIDAuNyAzLjggMTYuNCA0LjcgMzMuOCA0LjcgNTAuMiAwIDEuNy0wLjUgMi4xLTIuOCAwLjctMy44QzgyLjQgMzAuOCA3My42IDI4IDY0IDI4WiIgZmlsbD0iI2ZmZjdlNiIgb3BhY2l0eT0iMC40IiAvPgogICAgPHBhdGggZD0iTTY0IDEwNmMtMTIuNCAwLTIzLjUtMy43LTMyLjYtOS45LTEuNi0xLjEtMy44IDAuNS0zIDIuNCA1LjIgMTEuOCAxOCAyMC41IDM1LjYgMjAuNXMzMC40LTguNyAzNS42LTIwLjVjMC44LTEuOS0xLjQtMy41LTMtMi40LTkuMSA2LjItMjAuMiA5LjktMzIuNiA5LjlaIiBmaWxsPSIjOGQ0YjE0IiBvcGFjaXR5PSIwLjI1IiAvPgogIDwvZz4KPC9zdmc+Cg==",wv=new Intl.NumberFormat("en-US");function GT(t){return wv.format(Math.max(0,Math.floor(Number.isFinite(t)?t:0)))}function hh(t){return wv.format(Math.max(0,Math.floor(Number.isFinite(t)?t:0)))}function YT(t){const a=t.callbacks??{},s=document.createElement("section");s.className="sauna-shop-panel pointer-events-auto flex w-[min(26rem,92vw)] flex-col gap-5 rounded-hud-xl border border-white/10 bg-[linear-gradient(145deg,rgba(20,27,41,0.95),rgba(33,44,66,0.9))] p-5 text-slate-100 shadow-[0_32px_68px_rgba(10,16,32,0.55)] backdrop-blur-[16px] backdrop-saturate-[140%] transition-transform duration-200 ease-out",s.tabIndex=-1,s.dataset.open="false",s.setAttribute("role","dialog"),s.setAttribute("aria-modal","true"),s.setAttribute("aria-label","Steamforge atelier"),s.setAttribute("aria-hidden","true"),s.setAttribute("inert","");const r=document.createElement("header");r.className="flex items-start justify-between gap-3";const l=document.createElement("div");l.className="flex flex-col gap-1";const u=document.createElement("h2");u.className="text-lg font-semibold tracking-wide text-sky-50",u.textContent="Steamforge Atelier",l.appendChild(u);const f=document.createElement("p");f.className="text-sm text-slate-300/85",f.textContent="Commission tier upgrades with artocoins earned in the field.",l.appendChild(f);const h=document.createElement("button");h.type="button",h.className="group inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/5 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.12em] text-slate-200 transition-colors duration-150 hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",h.textContent="Close",h.addEventListener("click",()=>a.onClose?.()),r.append(l,h),s.appendChild(r);const m=document.createElement("div");m.className="flex items-center justify-between rounded-hud-lg border border-white/12 bg-[linear-gradient(135deg,rgba(255,245,224,0.18),rgba(255,192,120,0.12))] px-4 py-3 text-sm text-slate-100 shadow-[inset_0_0_18px_rgba(255,180,90,0.08)]";const p=document.createElement("div");p.className="flex flex-col gap-0.5";const g=document.createElement("span");g.className="text-xs font-semibold uppercase tracking-[0.14em] text-slate-200/80",g.textContent="Artocoin balance",p.appendChild(g);const b=document.createElement("span");b.className="text-xl font-bold text-amber-200 drop-shadow-[0_0_12px_rgba(255,190,100,0.25)]",b.textContent="0",p.appendChild(b);const v=document.createElement("div");v.className="relative h-12 w-12 flex-shrink-0",v.setAttribute("aria-hidden","true");const S=document.createElement("img");S.src=Av,S.alt="",S.className="h-full w-full drop-shadow-[0_12px_18px_rgba(255,186,92,0.35)]",S.decoding="async",v.appendChild(S),m.append(p,v),s.appendChild(m);const E=document.createElement("div");E.className="flex flex-col gap-4",s.appendChild(E);const T=new Map;function _($){const{tier:W}=$,ne=document.createElement("article");ne.className="relative overflow-hidden rounded-hud-lg border border-white/10 bg-[linear-gradient(135deg,rgba(24,30,46,0.86),rgba(42,56,78,0.9))] p-4 shadow-[0_16px_36px_rgba(10,16,32,0.4)] transition-transform duration-200 ease-out hover:-translate-y-1",ne.dataset.tierId=W.id;const Y=document.createElement("div");Y.className="pointer-events-none absolute inset-0 opacity-40",Y.style.background=W.art.glow??"radial-gradient(circle at 20% 20%, rgba(255,255,255,0.18), transparent 70%)",ne.appendChild(Y);const q=document.createElement("div");q.className="relative flex flex-col gap-3",ne.appendChild(q);const C=document.createElement("div");C.className="flex items-start justify-between gap-3",q.appendChild(C);const J=document.createElement("div");J.className="flex items-center gap-3",C.appendChild(J);const H=document.createElement("div");H.className="h-12 w-12 flex-shrink-0 overflow-hidden rounded-full border border-white/40 bg-slate-900/40 shadow-[0_8px_16px_rgba(0,0,0,0.35)]",H.style.backgroundImage=`url(${W.art.badge})`,H.style.backgroundSize="cover",H.style.backgroundPosition="center",H.setAttribute("aria-hidden","true"),J.appendChild(H);const ae=document.createElement("div");ae.className="flex flex-col gap-1",J.appendChild(ae);const F=document.createElement("h3");F.className="text-base font-semibold text-slate-50",F.textContent=W.name,ae.appendChild(F);const D=document.createElement("span");D.className="text-xs font-medium uppercase tracking-[0.16em] text-slate-300/85",D.textContent=`Cap ${W.rosterCap}`,ae.appendChild(D);const P=document.createElement("span");P.className="rounded-full border border-white/20 bg-white/10 px-3 py-1 text-[0.7rem] font-semibold uppercase tracking-[0.2em] text-slate-200 shadow-[0_4px_10px_rgba(12,17,32,0.45)]",P.textContent="Locked",C.appendChild(P);const le=document.createElement("p");le.className="text-sm leading-relaxed text-slate-200/85",le.textContent=W.description,q.appendChild(le);const ee=document.createElement("div");ee.className="flex items-center justify-between gap-3",q.appendChild(ee);const x=document.createElement("span");x.className="text-sm font-semibold text-amber-200/90",x.textContent="",ee.appendChild(x);const A=document.createElement("button");return A.type="button",A.className="group relative inline-flex items-center justify-center gap-2 rounded-full border border-amber-200/50 bg-[linear-gradient(135deg,rgba(255,200,120,0.9),rgba(255,157,66,0.92))] px-4 py-2 text-sm font-semibold uppercase tracking-[0.12em] text-slate-900 shadow-[0_12px_20px_rgba(255,168,74,0.35)] transition-all duration-150 ease-out hover:-translate-y-0.5 hover:shadow-[0_16px_28px_rgba(255,168,74,0.4)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-200",A.textContent="Unlock",ee.appendChild(A),A.addEventListener("click",()=>{if(!a.onPurchaseTier)return;const z=a.onPurchaseTier(W.id);if(z){if(z.success){const Q=typeof $.status.cost=="number"?$.status.cost:W.unlock.type==="artocoin"?W.unlock.cost:0;a.emitToast?.(`${W.name} unlocked for ${hh(Q)} artocoins.`,"success")}else z.reason==="insufficient-funds"?a.emitToast?.(`Need ${hh(z.shortfall??0)} more artocoins to commission ${W.name}.`,"warn"):z.reason==="already-owned"&&a.emitToast?.(`${W.name} is already unlocked.`,"info");U()}}),E.appendChild(ne),{root:ne,statusChip:P,description:le,rosterCap:D,actionButton:A,costLabel:x,status:$.status}}function R($,W){const{tier:ne,status:Y}=W;$.rosterCap.textContent=`Cap ${ne.rosterCap}`,$.description.textContent=ne.description,$.status=Y,$.root.setAttribute("aria-label",`${ne.name}  ${Y.requirementLabel}`),$.actionButton.title=Y.requirementLabel,$.actionButton.setAttribute("aria-label",Y.owned?`${ne.name} unlocked`:Y.requirementLabel),$.root.dataset.state=Y.owned?"owned":Y.affordable?"ready":"locked",Y.owned?($.statusChip.textContent="Unlocked",$.statusChip.classList.add("bg-emerald-300/15","text-emerald-200"),$.statusChip.classList.remove("text-slate-200"),$.actionButton.disabled=!0,$.actionButton.textContent="Unlocked",$.actionButton.classList.add("cursor-not-allowed","opacity-60"),$.costLabel.textContent="Owned",$.costLabel.dataset.state="owned"):($.statusChip.textContent=Y.affordable?"Ready":"Locked",$.statusChip.classList.remove("bg-emerald-300/15","text-emerald-200"),$.statusChip.classList.add("text-slate-200"),$.actionButton.disabled=!Y.affordable,$.actionButton.textContent=Y.affordable?"Unlock now":"Insufficient",$.actionButton.classList.toggle("opacity-60",!Y.affordable),$.actionButton.classList.toggle("cursor-not-allowed",!Y.affordable),$.costLabel.textContent=Y.cost?`${hh(Y.cost)} artocoins`:"Included",$.costLabel.dataset.state=Y.affordable?"ready":"locked")}function U($){const W=$??t.getViewModel();b.textContent=GT(W.balance),W.tiers.forEach(ne=>{const Y=T.get(ne.tier.id);if(Y){R(Y,ne);return}const q=_(ne);T.set(ne.tier.id,q),R(q,ne)})}function B($){s.dataset.open=$?"true":"false",s.setAttribute("aria-hidden",$?"false":"true"),$?s.removeAttribute("inert"):s.setAttribute("inert","")}function V(){requestAnimationFrame(()=>{s.focus({preventScroll:!0})})}function X(){s.remove(),T.clear()}return U(),{element:s,setOpen:B,update:U,focus:V,destroy:X}}const mh=24,FT=4500,VT=400,$T={health:"HP",attackDamage:"ATK",attackRange:"RNG",movementRange:"MOV",defense:"DEF",shield:"Shield"},$b="pointer-events-none ml-auto flex w-full max-w-[min(22rem,90vw)] flex-col gap-[clamp(6px,1vw,12px)]",XT="pointer-events-auto flex w-full items-center gap-[clamp(4px,0.8vw,12px)] rounded-hud-md border border-[color:var(--hud-border)] px-4 py-3 text-[0.9rem] font-semibold leading-[1.35] shadow-hud-lg backdrop-blur-[14px] backdrop-saturate-[135%] transition-all duration-300 ease-out",QT={loot:"bg-[linear-gradient(140deg,color-mix(in_srgb,var(--color-surface-strong)_82%,rgba(15,23,42,0.18))_0%,color-mix(in_srgb,var(--color-accent-gold)_46%,var(--color-surface))_100%)] text-[color:color-mix(in_srgb,var(--color-foreground)_95%,rgba(255,250,235,0.12))]",info:"bg-[linear-gradient(140deg,color-mix(in_srgb,var(--color-surface-strong)_84%,rgba(12,22,38,0.2))_0%,color-mix(in_srgb,var(--color-accent-blue)_48%,var(--color-surface))_100%)] text-[color:color-mix(in_srgb,var(--color-foreground)_95%,rgba(224,247,255,0.1))]",warn:"bg-[linear-gradient(140deg,color-mix(in_srgb,var(--color-surface-strong)_82%,rgba(40,18,12,0.35))_0%,color-mix(in_srgb,var(--color-accent-red)_52%,var(--color-surface))_100%)] text-[color:color-mix(in_srgb,var(--color-foreground)_92%,rgba(255,234,221,0.22))]"},KT=["-translate-y-2","opacity-0"];function au(t){t.hidden=t.childElementCount===0}function PT(t,a){const s=t.querySelector('[data-ui="loot-toast-stack"]');if(s)return s.parentElement!==a&&a.appendChild(s),s.className=$b,s.style.zIndex=String(qb.toast),au(s),s;const l=(t.ownerDocument??document).createElement("div");return l.dataset.ui="loot-toast-stack",l.className=$b,l.setAttribute("aria-live","polite"),l.setAttribute("role","status"),l.style.zIndex=String(qb.toast),au(l),a.appendChild(l),l}function Ht(t,a,s){const r=(t.ownerDocument??document).createElement("div");r.dataset.variant=s,r.className=`${XT} ${QT[s]}`,r.textContent=a,t.appendChild(r),au(t);const l=()=>{r.remove(),au(t)},u=window.setTimeout(()=>{r.classList.add(...KT),window.setTimeout(l,VT)},FT);r.addEventListener("click",()=>{window.clearTimeout(u),l()})}function ZT(t,a){t.has(a)?t.delete(a):t.add(a)}function JT(t){const a=t.comparison?.deltas??[];return a.length===0?null:a.map(r=>{const l=$T[r.stat]??r.stat;return`${r.delta>0?"+":""}${r.delta} ${l}`}).join(", ")}function ph(t){switch(t){case"inventory":return"ready inventory";case"stash":return"stash";case"equipped":default:return"loadout"}}function WT(){const t=document.createElement("button");t.type="button",t.dataset.testid="inventory-badge",t.dataset.ui="inventory-badge",t.className="group inline-flex items-center gap-2 rounded-hud-pill border border-white/15 bg-[linear-gradient(135deg,rgba(27,36,56,0.9),rgba(39,74,110,0.9))] px-3.5 py-2 font-semibold text-sky-50 shadow-hud-sm transition-all duration-150 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent hover:-translate-y-0.5 hover:shadow-hud-md data-[autoequip=off]:bg-[linear-gradient(135deg,rgba(56,44,25,0.9),rgba(92,72,40,0.9))]",t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","inventory-stash-panel"),t.setAttribute("aria-label","Open quartermaster stash");const a=document.createElement("span");a.className="relative flex h-[1.65rem] w-[1.65rem] flex-shrink-0 items-center justify-center rounded-full bg-[radial-gradient(circle_at_30%_30%,rgba(255,255,255,0.9),rgba(225,235,255,0.2))] text-slate-900 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.35)]",a.setAttribute("aria-hidden","true");const s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg");r.setAttribute("viewBox","0 0 24 24"),r.setAttribute("aria-hidden","true"),r.setAttribute("focusable","false"),r.setAttribute("class","h-[76%] w-[76%]");const l=document.createElementNS(s,"path");l.setAttribute("d","M8.25 7V6a3.75 3.75 0 0 1 7.5 0v1m3 0h-14.25a1.5 1.5 0 0 0-1.485 1.342l-.75 9a3 3 0 0 0 2.985 3.158h9.78a3 3 0 0 0 2.985-3.158l-.75-9A1.5 1.5 0 0 0 18.75 7Z"),l.setAttribute("fill","rgba(194, 216, 255, 0.32)"),l.setAttribute("stroke","rgba(255, 255, 255, 0.92)"),l.setAttribute("stroke-width","1.6"),l.setAttribute("stroke-linecap","round"),l.setAttribute("stroke-linejoin","round");const u=document.createElementNS(s,"path");u.setAttribute("d","M9.75 12.25h4.5"),u.setAttribute("fill","none"),u.setAttribute("stroke","rgba(255, 255, 255, 0.85)"),u.setAttribute("stroke-width","1.4"),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("opacity","0.9"),r.append(l,u),a.appendChild(r),t.appendChild(a);const f=document.createElement("span");f.className="text-[0.75rem] uppercase tracking-[0.08em]",f.textContent="Stash",t.appendChild(f);const h=document.createElement("span");return h.className="min-w-[1.5rem] rounded-full bg-white/15 px-2 py-[0.1rem] text-center text-xs font-semibold text-white/90",h.textContent="0",h.setAttribute("aria-hidden","true"),t.appendChild(h),{button:t,count:h}}function e5(){const t=document.createElement("button");t.type="button",t.className="group inline-flex items-center gap-2 rounded-hud-pill border border-white/12 bg-[linear-gradient(135deg,rgba(44,32,18,0.92),rgba(68,48,24,0.95))] px-3.5 py-2 font-semibold text-amber-200 shadow-[0_14px_24px_rgba(17,12,6,0.55)] transition-all duration-150 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-300 hover:-translate-y-0.5 hover:shadow-[0_18px_28px_rgba(17,12,6,0.65)]",t.setAttribute("aria-expanded","false"),t.setAttribute("aria-label","Open artocoin shop");const a=document.createElement("span");a.className="relative flex h-[1.65rem] w-[1.65rem] flex-shrink-0 items-center justify-center rounded-full bg-[radial-gradient(circle_at_35%_30%,rgba(255,210,128,0.95),rgba(114,68,17,0.85))] shadow-[inset_0_0_0_1px_rgba(255,236,196,0.55)]",a.setAttribute("aria-hidden","true");const s=document.createElement("img");s.src=Av,s.alt="",s.decoding="async",s.className="h-[78%] w-[78%] drop-shadow-[0_10px_18px_rgba(255,186,92,0.4)]",a.appendChild(s);const r=document.createElement("span");return r.className="text-[0.75rem] uppercase tracking-[0.08em]",r.textContent="Shop",t.append(a,r),t}function t5(t,a={}){const s=document.getElementById("ui-overlay");if(!s)return{destroy:()=>{}};const{regions:r}=fr(s),l=r.top,u=PT(s,l);s.querySelector("#inventory-stash-panel")?.remove(),s.querySelector("#inventory-shop-panel")?.remove(),s.querySelectorAll('[data-testid="inventory-badge"]').forEach(A=>A.remove());const{button:f,count:h}=WT();f.dataset.autoequip=t.isAutoEquipEnabled()?"on":"off",l.appendChild(f);const m=new Intl.NumberFormat("en-US");let p=null,g=null,b=!1,v=null,S=null,E=()=>{};const T=A=>{if(!g||!A)return;const z=m.format(Math.max(0,Math.floor(Number.isFinite(A.balance)?A.balance:0)));g.dataset.balance=z,g.title=`Artocoins ${z}`;const Q=A.tiers.some(de=>!de.status.owned&&de.status.affordable),oe=A.tiers.some(de=>!de.status.owned&&!de.status.affordable);g.dataset.state=Q?"ready":oe?"locked":"complete"},_={success:"loot",info:"info",warn:"warn"};if(typeof a.getSaunaShopViewModel=="function"){const A=()=>a.getSaunaShopViewModel?.()??{balance:0,tiers:[]};g=e5(),g.dataset.state="locked",l.appendChild(g),p=YT({getViewModel:A,callbacks:{onClose:()=>E(!1),onPurchaseTier:de=>{const ue=a.onPurchaseSaunaTier;return ue?ue(de):{success:!1,balance:A().balance,purchased:new Set,reason:"unsupported"}},emitToast:(de,ue)=>{const ve=_[ue]??"info";Ht(u,de,ve)}}}),p.element.id="inventory-shop-panel",g.setAttribute("aria-controls","inventory-shop-panel"),s.appendChild(p.element);const oe=A();p.update(oe),T(oe),E=de=>{if(b!==de)if(b=de,p?.setOpen(de),g?.setAttribute("aria-expanded",de?"true":"false"),g?.setAttribute("aria-label",de?"Close artocoin shop":"Open artocoin shop"),de){Y(!1),s.classList.add("inventory-shop-open");const ue=A();p?.update(ue),T(ue);try{p?.focus()}catch(ve){console.warn("Unable to focus artocoin shop",ve)}}else{s.classList.remove("inventory-shop-open");try{g?.focus({preventScroll:!0})}catch(ue){console.warn("Unable to restore focus to artocoin shop button",ue)}}},S=()=>E(!b),g.addEventListener("click",S),v=a.subscribeToSaunaShop?.(()=>{const de=A();p?.update(de),T(de)})}const U=jT({onClose:()=>Y(!1),onCollectionChange:A=>{V!==A&&(V=A,ne=1,C())},onFilterToggle:(A,z)=>{const Q=X[A];ZT(Q,z),ne=1,C()},onSearchChange:A=>{$=A,ne=1,C()},onSortChange:A=>{W=A,ne=1,C()},onLoadMore:()=>{ne+=1,C()},onItemEquip:A=>{H(A)},onItemTransfer:A=>{ae(A)},onItemTrash:A=>{F(A)},getAutoEquipState:()=>t.isAutoEquipEnabled(),onAutoEquipChange:A=>{t.setAutoEquip(A),f.dataset.autoequip=A?"on":"off",Ht(u,A?"Auto-equip enabled. Newly recovered gear will try to arm your selected attendant.":"Auto-equip disabled. Loot will head to the stash until you equip it manually.","info")},getUiV2State:()=>a.getUseUiV2?.()??!1,onUiV2Change:A=>{a.onUseUiV2Change?.(A),Ht(u,A?"Experimental HUD enabled. Reload to try the React/Tailwind experience.":"Classic HUD restored for your next session.","info")}});U.element.id="inventory-stash-panel",s.appendChild(U.element);let B=!1,V="stash";const X=DC();let $="",W="newest",ne=1;function Y(A){if(B!==A)if(B=A,U.setOpen(B),f.setAttribute("aria-expanded",B?"true":"false"),f.setAttribute("aria-label",B?"Close quartermaster stash":"Open quartermaster stash"),B){E(!1),s.classList.add("inventory-panel-open");try{U.focus()}catch(z){console.warn("Unable to focus stash panel",z)}}else s.classList.remove("inventory-panel-open")}function q(){const A=a.getComparisonContext?.()??null;let z=Fb({stash:t.getStash(),inventory:t.getInventory(),filters:X,search:$,sort:W,page:ne,pageSize:mh,collection:V,comparisonContext:A});if(z.filteredTotal>0){const Q=Math.max(1,Math.ceil(z.filteredTotal/mh));ne>Q&&(ne=Q,z=Fb({stash:t.getStash(),inventory:t.getInventory(),filters:X,search:$,sort:W,page:ne,pageSize:mh,collection:V,comparisonContext:A}))}return z}function C(){const A=q(),Q=A.collections.find(oe=>oe.id==="stash")?.count??0;h.textContent=String(Q),f.dataset.count=String(Q),U.render(A)}function J(){const A=a.getSelectedUnitId?.()??null;return A||(Ht(u,"Select an attendant before equipping an item.","warn"),null)}function H(A){const z=J();if(!z)return;const Q=a.onEquip??(()=>({success:!1}));(A.location==="stash"?t.equipFromStash(A.index,z,(ue,ve)=>Q(ue,ve,"stash")):t.equipFromInventory(A.index,z,(ue,ve)=>Q(ue,ve,"inventory")))||Ht(u,"Unable to equip that item right now.","warn")}function ae(A){const z=A.location==="stash"?t.moveToInventory(A.index):t.moveToStash(A.index);if(!z){Ht(u,"Unable to move that item right now.","warn");return}const Q=A.location==="stash"?"ready inventory":"stash";Ht(u,`Moved ${z.name} to the ${Q}.`,"info"),ne=1,C()}function F(A){const z=A.location==="stash"?t.discardFromStash(A.index):t.discardFromInventory(A.index);if(!z){Ht(u,"That item was already removed.","warn");return}const Q=A.location==="stash"?"stash":"ready inventory";Ht(u,`${z.name} discarded from the ${Q}.`,"warn"),C()}function D(A){switch(A.type){case"stash-updated":case"inventory-updated":C();break;case"item-acquired":if(A.equipped)Ht(u,`${A.item.name} auto-equipped successfully.`,"info");else{const z=ph(A.location);Ht(u,`New item secured: ${A.item.name} (${z}).`,"loot")}break;case"item-equipped":{const z=JT(A),Q=z?` (${z})`:"";Ht(u,`Equipped ${A.item.name}${Q}.`,"info");break}case"item-unequipped":Ht(u,`${A.item.name} returned to the stash from slot ${A.slot}.`,"info");break;case"item-moved":{const z=ph(A.to);Ht(u,`Moved ${A.item.name} to the ${z}.`,"info");break}case"item-discarded":{const z=ph(A.location);Ht(u,`${A.item.name} discarded from the ${z}.`,"warn");break}case"settings-updated":f.dataset.autoequip=A.autoEquip?"on":"off",U.setAutoEquip(A.autoEquip);break}}const P=t.on(A=>D(A)),le=()=>{Y(!B)};f.addEventListener("click",le);const ee=A=>{A.defaultPrevented||A.code==="KeyI"&&!A.metaKey&&!A.ctrlKey&&!A.altKey&&(A.preventDefault(),Y(!B))};return window.addEventListener("keydown",ee),C(),{destroy:()=>{P(),f.removeEventListener("click",le),window.removeEventListener("keydown",ee),f.remove(),U.destroy(),s.classList.remove("inventory-panel-open"),g&&S&&g.removeEventListener("click",S),p?.destroy(),g?.remove(),v?.(),s.classList.remove("inventory-shop-open"),u.hasChildNodes()||u.remove()}}}const n5=Object.freeze({common:1,uncommon:.6,rare:.35,epic:.18,legendary:.08,mythic:.03}),a5=Object.freeze({id:"general-salvage",label:"General Salvage",entries:Object.freeze([{id:"birch-sap-satchel",name:"Birch Sap Satchel",description:"Soothing birch sap that doubles as a brisk field tonic.",rarity:"common",quantity:{min:1,max:3},weight:6},{id:"steamed-bandages",name:"Steamed Linen Bandages",description:"Freshly steamed bandages infused with pine oils.",rarity:"common",quantity:1,weight:5},{id:"emberglass-shard",name:"Emberglass Shard",description:"A radiant shard used to kindle sauna braziers.",rarity:"uncommon",quantity:1,weight:3},{id:"aurora-distillate",name:"Aurora Distillate",description:"Vials of shimmering condensation that empower sauna rituals.",rarity:"rare",quantity:1,weight:1.5},{id:"myrsky-charm",name:"Myrsky Charm",description:"Storm-forged charm rumored to call down aurora flares.",rarity:"epic",quantity:1,weight:.7}])}),i5=Object.freeze({base:Object.freeze({id:"enemy-raiders",label:"Avanto Marauder Spoils",entries:Object.freeze([{id:"cracked-ice-amulet",name:"Cracked Ice Amulet",description:"Necklace of frostbitten charms that hum when danger nears.",rarity:"common",quantity:1,weight:5},{id:"stolen-sauna-tokens",name:"Stolen Sauna Tokens",description:"Pilfered entrance tokens, gladly accepted back at any sauna hall.",rarity:"uncommon",quantity:{min:2,max:5},weight:3},{id:"glacier-brand",name:"Glacier Brand",description:"A cleaver chilled in glacial meltwater that never dulls.",rarity:"rare",quantity:1,weight:1.25}])}),elite:Object.freeze({id:"enemy-champions",label:"Avanto Champion Cache",entries:Object.freeze([{id:"frostwyrm-signet",name:"Frostwyrm Signet",description:"An icy signet ring that wreathes its bearer in frozen vapour.",rarity:"epic",quantity:1,weight:1.1},{id:"aurora-lattice",name:"Aurora Lattice",description:"Filigree latticework that channels auroral light into focused beams.",rarity:"legendary",quantity:1,weight:.4},{id:"midnight-bloodwine",name:"Midnight Bloodwine",description:"A mythical draught said to rekindle a warrior's lost resolve.",rarity:"mythic",quantity:1,weight:.12}])})}),s5=Object.freeze({base:Object.freeze({id:"deepwood-offerings",label:"Deepwood Offerings",entries:Object.freeze([{id:"spirit-oak-charm",name:"Spirit Oak Charm",description:"Carved from living oak, it whispers guidance between sauna rounds.",rarity:"uncommon",quantity:1,weight:4},{id:"sauna-incense",name:"Sauna Incense Pouches",description:"Fragrant blends that steady breathing before the next engagement.",rarity:"common",quantity:{min:1,max:4},weight:5},{id:"emberglass-arrow",name:"Emberglass Arrow Bundle",description:"Arrowheads that glow amber when a perfect shot reveals itself.",rarity:"rare",quantity:{min:1,max:2},weight:1.75}])}),elite:Object.freeze({id:"deepwood-ritual-cache",label:"Deepwood Ritual Cache",entries:Object.freeze([{id:"windstep-totem",name:"Windstep Totem",description:"Totem etched with gale sigils that lighten every cautious stride.",rarity:"epic",quantity:1,weight:.9},{id:"searing-chant-censer",name:"Searing Chant Censer",description:"An ornate censer that empowers allies with smouldering hymns.",rarity:"legendary",quantity:1,weight:.35}])})}),r5=Object.freeze({enemy:i5,deepwood:s5});function o5(t){return r5[t]??{base:a5}}function l5(t,a=!1){const s=o5(t);return a&&s.elite?s.elite:s.base}function c5(t){if(!Number.isFinite(t))return 1;const a=Math.floor(t);return a<=0?0:Math.min(10,a)}function u5(t,a){if(typeof t=="number"&&Number.isFinite(t))return Math.max(1,Math.round(t));if(!t)return 1;const s=t,r=Math.max(1,Math.round(s.min)),u=Math.max(r,Math.round(s.max))-r+1,f=Math.floor(Math.max(0,Math.min(.999999,a()))*u);return r+f}function d5(t){const a=n5[t.rarity]??1,s=typeof t.weight=="number"?t.weight:1;return Math.max(0,s)*Math.max(0,a)}function f5(t,a){const s=t.map(f=>({entry:f,weight:d5(f)})).filter(f=>f.weight>0);if(s.length===0)return null;const r=s.reduce((f,h)=>f+h.weight,0),l=Math.max(0,Math.min(.999999,a()))*r;let u=0;for(const f of s)if(u+=f.weight,l<u)return f.entry;return s[s.length-1]?.entry??null}function h5(t,a){return{id:t.id,name:t.name,description:t.description,icon:t.icon,rarity:t.rarity,quantity:a}}function m5(t){const a=typeof t.random=="function"?t.random:Math.random,s=!!t.elite,r=t.table??l5(t.factionId,s),l=c5(t.rolls),u=[];if(l<=0||r.entries.length===0)return{factionId:t.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u};for(let f=0;f<l;f+=1){const h=f5(r.entries,a);if(!h)break;const m=u5(h.quantity,a);u.push({entryId:h.id,rarity:h.rarity,quantity:m,item:h5(h,m)})}return{factionId:t.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u}}const p5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23a4d67a'%20/%3e%3cpolygon%20points='16,48%2032,16%2048,48'%20fill='%23d2691e'%20/%3e%3crect%20x='24'%20y='32'%20width='16'%20height='16'%20fill='%23f4a460'%20/%3e%3c/svg%3e",g5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23c0c0c0'%20/%3e%3crect%20x='8'%20y='24'%20width='48'%20height='24'%20fill='%23808080'%20/%3e%3crect%20x='24'%20y='16'%20width='16'%20height='8'%20fill='%23606060'%20/%3e%3c/svg%3e",y5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23e0e0e0'%20/%3e%3crect%20x='10'%20y='22'%20width='12'%20height='30'%20fill='%23a9a9a9'%20/%3e%3crect%20x='26'%20y='14'%20width='12'%20height='38'%20fill='%23808080'%20/%3e%3crect%20x='42'%20y='26'%20width='12'%20height='26'%20fill='%23a9a9a9'%20/%3e%3c/svg%3e",b5="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%238b4513'%20/%3e%3cpolygon%20points='32,10%2042,22%2022,22'%20fill='%23555'%20/%3e%3crect%20x='30'%20y='22'%20width='4'%20height='32'%20fill='%23ccc'%20/%3e%3c/svg%3e",v5="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eAuric%20Warder%3c/title%3e%3cdesc%20id='desc'%3eRunic%20soldier%20with%20aurora-lit%20shield,%20sculpted%20armor,%20and%20crystalline%20broadsword.%3c/desc%3e%3cdefs%3e%3clinearGradient%20id='soldier-panel'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23091522'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23102a46'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-halo'%20cx='52%25'%20cy='18%25'%20r='68%25'%3e%3cstop%20offset='0%25'%20stop-color='rgba(186,%20230,%20253,%200.92)'%20/%3e%3cstop%20offset='45%25'%20stop-color='rgba(59,%20130,%20246,%200.42)'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(15,%2023,%2042,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-armor'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='55%25'%20stop-color='%23cbd5f5'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23475569'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-gold'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20/%3e%3cstop%20offset='45%25'%20stop-color='%23fbbf24'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f97316'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-cloak'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%231d4ed8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-shield'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23bfdbfe'%20/%3e%3cstop%20offset='65%25'%20stop-color='%2360a5fa'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231d4ed8'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-shield-core'%20cx='40%25'%20cy='40%25'%20r='45%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fef3c7'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(248,%20250,%20252,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-sword'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231f2937'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='128'%20height='128'%20rx='18'%20fill='url(%23soldier-panel)'%20/%3e%3ccircle%20cx='64'%20cy='40'%20r='46'%20fill='url(%23soldier-halo)'%20/%3e%3cellipse%20cx='64'%20cy='110'%20rx='34'%20ry='11'%20fill='%230f172a'%20opacity='0.45'%20/%3e%3cpath%20d='M34%2038c-8%2015-11%2034-6%2052l18%2010c-2-22%206-40%2020-50-12-4-22-8-32-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.88'%20/%3e%3cpath%20d='M94%2038c8%2015%2011%2034%206%2052l-18%2010c2-22-6-40-20-50%2012-4%2022-8%2032-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.68'%20/%3e%3cpath%20d='M58%2018l-12%2014c-5%207-8%2017-8%2028v20l14%2042h24l14-42V60c0-11-3-21-8-28L70%2018H58z'%20fill='url(%23soldier-armor)'%20stroke='%231f2937'%20stroke-width='2.4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M46%2060h36l6%2016c-10%2010-20%2016-24%2016s-14-6-24-16l6-16z'%20fill='%23e0f2fe'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2024c-7%200-14%205-20%2012l8%2010c8-6%2024-6%2032%200l8-10c-6-7-13-12-20-12z'%20fill='%23f8fafc'%20stroke='%23cbd5f5'%20stroke-width='2'%20/%3e%3cpath%20d='M56%2016h16l6%208-14%208-14-8%206-8z'%20fill='%23e2e8f0'%20stroke='%2394a3b8'%20stroke-width='1.8'%20/%3e%3cpath%20d='M52%2074h12l2%2020-10%2012-10-12%206-20z'%20fill='url(%23soldier-gold)'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2096l10%2010%2010-12-6-20H66l-2%2022z'%20fill='%23fef3c7'%20opacity='0.72'%20/%3e%3cpath%20d='M32%2068l-12%206%2014%2032%2016-8-18-30z'%20fill='url(%23soldier-shield)'%20stroke='%231e3a8a'%20stroke-width='2.2'%20/%3e%3ccircle%20cx='36'%20cy='82'%20r='8'%20fill='url(%23soldier-shield-core)'%20/%3e%3cpath%20d='M96%2060l-6-6-22%2044%208%2010%2020-48z'%20fill='url(%23soldier-sword)'%20stroke='%230f172a'%20stroke-width='2.2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M86%2050l-18%2040%2012%206%2016-36-10-10z'%20fill='%23f8fafc'%20opacity='0.7'%20/%3e%3cpath%20d='M64%20102c-9%200-18%207-22%2016%208%206%2014%208%2022%208s14-2%2022-8c-4-9-13-16-22-16z'%20fill='%23dbeafe'%20stroke='%2393c5fd'%20stroke-width='1.6'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M58%2056h12l3%2010-9%206-9-6%203-10z'%20fill='%231f2937'%20opacity='0.85'%20/%3e%3ccircle%20cx='64'%20cy='58'%20r='7'%20fill='%23f1f5f9'%20stroke='%23cbd5f5'%20stroke-width='1.4'%20/%3e%3cpath%20d='M54%2044c-5%200-8%205-8%2012%206-3%2012-6%2018-6s12%203%2018%206c0-7-3-12-8-12H54z'%20fill='%230f172a'%20opacity='0.82'%20/%3e%3c/svg%3e",S5="/assets/archer-DIBoEfQj.svg",M5="/assets/avanto-marauder-B6bFdUJV.svg",Ks="/",Jn={saunaBeer:`${Ks}assets/ui/sauna-beer.svg`,saunojaRoster:`${Ks}assets/ui/saunoja-roster.svg`,resource:`${Ks}assets/ui/resource.svg`,sisu:`${Ks}assets/ui/resource.svg`,sound:`${Ks}assets/ui/sound.svg`,artocoin:`${Ks}assets/ui/artocoin.svg`},E5={images:{placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=","building-farm":p5,"building-barracks":g5,"building-city":y5,"building-mine":b5,"unit-soldier":v5,"unit-archer":S5,"unit-avanto-marauder":M5,"icon-sauna-beer":Jn.saunaBeer,"icon-saunoja-roster":Jn.saunojaRoster,"icon-resource":Jn.resource,"icon-sound":Jn.sound,"icon-artocoin":Jn.artocoin}};let Cv=null;function x5(t){Cv=t}function Tv(){return Cv}const A5=["city"],w5=1e4,C5=12e3;function T5(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Xb(t){return Object.freeze({strongholds:{...t.strongholds},roster:{...t.roster},economy:{...t.economy},sauna:{...t.sauna},enemyKills:t.enemyKills,exploration:{...t.exploration},startedAt:t.startedAt})}function Qb(t){const a={[re.SAUNA_BEER]:0,[re.SAUNAKUNNIA]:0,[re.SISU]:0};return Object.values(re).forEach(s=>{a[s]=t.getResource(s)}),a}class _5{timeSource;state;map;getRosterCount;sauna;strongholdTypes;rosterGraceMs;bankruptcyGraceMs;progress;startResources;strongholds=new Map;revealedTiles=new Set;progressListeners=new Set;resolutionListeners=new Set;mapDisposer=null;rosterTimeout=null;bankruptcyTimeout=null;bankruptSince=null;wipeSince=null;saunaDestroyedAt=null;resolution=null;disposed=!1;constructor(a){this.timeSource=typeof a.timeSource=="function"?a.timeSource:T5,this.state=a.state,this.map=a.map,this.getRosterCount=a.getRosterCount,this.sauna=a.sauna??null;const s=a.strongholdTypes?.length?a.strongholdTypes:A5;this.strongholdTypes=new Set(s),this.rosterGraceMs=Math.max(0,a.rosterWipeGraceMs??w5),this.bankruptcyGraceMs=Math.max(0,a.bankruptcyGraceMs??C5),this.startResources=Qb(this.state);const r=this.state.getResource(re.SAUNA_BEER),l=Math.max(0,Math.round(this.getRosterCount()))||0;this.progress={strongholds:{total:0,destroyed:0,remaining:0},roster:{active:l,totalDeaths:0,wipeSince:null,wipeDurationMs:0},economy:{beer:r,worstBeer:r,bankruptSince:null,bankruptDurationMs:0},sauna:this.createSaunaProgress(),enemyKills:0,exploration:{revealedHexes:0},startedAt:this.timeSource()},this.bootstrapStrongholds(),this.attachMapListener(),this.attachEventListeners(),this.emitProgress(),this.evaluateResolution()}onProgress(a){this.progressListeners.add(a)}offProgress(a){this.progressListeners.delete(a)}onResolution(a){if(this.resolution){a(this.resolution);return}this.resolutionListeners.add(a)}offResolution(a){this.resolutionListeners.delete(a)}getProgress(){return Xb(this.progress)}dispose(){if(!this.disposed){if(this.disposed=!0,this.clearRosterTimer(),this.clearBankruptcyTimer(),this.mapDisposer){try{this.mapDisposer()}catch(a){console.warn("Failed to detach map listener",a)}this.mapDisposer=null}se.off("unitDied",this.handleUnitDied),se.off("unitSpawned",this.handleUnitSpawned),se.off("resourceChanged",this.handleResourceChanged),se.off("saunaDamaged",this.handleSaunaDamaged),se.off("saunaDestroyed",this.handleSaunaDestroyed)}}bootstrapStrongholds(){this.map.forEachTile((a,s)=>{if(this.captureExploration(s,a),this.isStronghold(a.building)){const r=this.coordKey(s);this.strongholds.set(r,{alive:!0})}}),this.updateStrongholdTotals()}attachMapListener(){this.mapDisposer=this.map.addTileChangeListener((a,s,r)=>{let l=!1;if((r==="fog"||r==="created")&&this.captureExploration(a,s)&&(l=!0),r==="building"||r==="created"){const u=this.coordKey(a),f=this.strongholds.get(u);this.isStronghold(s.building)?f?f.alive||(f.alive=!0):this.strongholds.set(u,{alive:!0}):f?.alive&&(f.alive=!1),this.updateStrongholdTotals(),l=!0}l&&(this.emitProgress(),this.evaluateResolution())})}captureExploration(a,s){if(s.isFogged)return!1;const r=this.coordKey(a),l=this.revealedTiles.size;return this.revealedTiles.has(r)||(this.revealedTiles.add(r),this.progress.exploration.revealedHexes=this.revealedTiles.size),this.revealedTiles.size!==l}attachEventListeners(){se.on("unitDied",this.handleUnitDied),se.on("unitSpawned",this.handleUnitSpawned),se.on("resourceChanged",this.handleResourceChanged),se.on("saunaDamaged",this.handleSaunaDamaged),se.on("saunaDestroyed",this.handleSaunaDestroyed)}handleUnitDied=({unitFaction:a})=>{if(a==="player"){this.progress.roster.totalDeaths+=1,this.refreshRosterStatus(),this.emitProgress(),this.evaluateResolution();return}this.progress.enemyKills+=1,this.emitProgress()};handleUnitSpawned=({unit:a})=>{a.faction==="player"&&(this.refreshRosterStatus(),this.emitProgress())};handleResourceChanged=({resource:a,total:s})=>{a===re.SAUNA_BEER&&(this.progress.economy.beer=s,s<this.progress.economy.worstBeer&&(this.progress.economy.worstBeer=s),s<0?this.bankruptSince===null&&(this.bankruptSince=this.timeSource(),this.progress.economy.bankruptSince=this.bankruptSince,this.startBankruptcyTimer()):(this.updateBankruptcyDuration(),this.bankruptSince=null,this.progress.economy.bankruptSince=null,this.clearBankruptcyTimer()),this.emitProgress())};handleSaunaDamaged=({remainingHealth:a})=>{this.disposed||(this.updateSaunaSnapshot(a),this.emitProgress())};handleSaunaDestroyed=a=>{this.disposed||(this.markSaunaDestroyed(),this.emitProgress(),this.resolve("lose","saunaDestroyed"))};startBankruptcyTimer(){if(this.bankruptcyTimeout===null){if(this.bankruptcyGraceMs<=0){this.resolve("lose","bankruptcy");return}this.bankruptcyTimeout=setTimeout(()=>{this.updateBankruptcyDuration(),this.resolve("lose","bankruptcy")},this.bankruptcyGraceMs)}}clearBankruptcyTimer(){this.bankruptcyTimeout!==null&&(clearTimeout(this.bankruptcyTimeout),this.bankruptcyTimeout=null)}startRosterTimer(){if(this.rosterTimeout===null){if(this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.rosterTimeout=setTimeout(()=>{this.updateRosterDuration(),this.resolve("lose","rosterWipe")},this.rosterGraceMs)}}clearRosterTimer(){this.rosterTimeout!==null&&(clearTimeout(this.rosterTimeout),this.rosterTimeout=null)}updateStrongholdTotals(){const a=this.strongholds.size;let s=0;for(const r of this.strongholds.values())r.alive&&(s+=1);this.progress.strongholds.total=a,this.progress.strongholds.remaining=s,this.progress.strongholds.destroyed=Math.max(0,a-s)}refreshRosterStatus(){const a=Math.max(0,Math.round(this.getRosterCount()));this.progress.roster.active=a,a<=0?(this.wipeSince===null&&(this.wipeSince=this.timeSource(),this.progress.roster.wipeSince=this.wipeSince),this.startRosterTimer()):(this.updateRosterDuration(),this.wipeSince=null,this.progress.roster.wipeSince=null,this.clearRosterTimer())}updateBankruptcyDuration(){if(this.bankruptSince===null)return;const a=this.timeSource()-this.bankruptSince;a>this.progress.economy.bankruptDurationMs&&(this.progress.economy.bankruptDurationMs=a)}updateRosterDuration(){if(this.wipeSince===null)return;const a=this.timeSource()-this.wipeSince;a>this.progress.roster.wipeDurationMs&&(this.progress.roster.wipeDurationMs=a)}evaluateResolution(){if(!this.resolution){if(this.progress.sauna.destroyed){this.resolve("lose","saunaDestroyed");return}if(this.progress.strongholds.total>0&&this.progress.strongholds.remaining===0){this.resolve("win","strongholds");return}if(this.wipeSince!==null&&this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.bankruptSince!==null&&this.bankruptcyGraceMs<=0&&this.resolve("lose","bankruptcy")}}resolve(a,s){if(this.resolution)return;this.updateRosterDuration(),this.updateBankruptcyDuration();const r=this.timeSource(),l=Math.max(0,r-this.progress.startedAt),u=Xb({...this.progress,roster:{...this.progress.roster,wipeSince:this.wipeSince},economy:{...this.progress.economy,bankruptSince:this.bankruptSince},sauna:{...this.progress.sauna,destroyedAt:this.saunaDestroyedAt}}),f=this.computeRewards();this.resolution=Object.freeze({outcome:a,cause:s,timestamp:r,durationMs:l,summary:u,rewards:f}),this.emitResolution(),this.dispose()}emitProgress(){const a=this.getProgress();for(const s of this.progressListeners)try{s(a)}catch(r){console.error("Objective progress listener failed",r)}}emitResolution(){if(!this.resolution)return;const a=this.resolution;for(const s of this.resolutionListeners)try{s(a)}catch(r){console.error("Objective resolution listener failed",r)}this.resolutionListeners.clear()}computeRewards(){const a=Qb(this.state);return{resources:{[re.SAUNA_BEER]:{final:a[re.SAUNA_BEER],delta:a[re.SAUNA_BEER]-this.startResources[re.SAUNA_BEER]},[re.SAUNAKUNNIA]:{final:a[re.SAUNAKUNNIA],delta:a[re.SAUNAKUNNIA]-this.startResources[re.SAUNAKUNNIA]},[re.SISU]:{final:a[re.SISU],delta:a[re.SISU]-this.startResources[re.SISU]}}}}coordKey(a){return`${a.q},${a.r}`}isStronghold(a){return a?this.strongholdTypes.has(a):!1}createSaunaProgress(){if(!this.sauna)return{maxHealth:0,health:0,destroyed:!1,destroyedAt:null};const a=Math.max(0,Math.round(this.sauna.maxHealth??0)),s=Math.max(0,Math.round(this.sauna.health??0)),r=!!this.sauna.destroyed||s<=0;return r&&this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),{maxHealth:a,health:s,destroyed:r,destroyedAt:r?this.saunaDestroyedAt:null}}updateSaunaSnapshot(a){const s=Number.isFinite(a)?Math.max(0,Math.round(a)):0,r=this.sauna?Math.max(0,Math.round(this.sauna.maxHealth??0)):0,l=this.progress.sauna.maxHealth,u=Math.max(l,r,s);this.progress.sauna.maxHealth=u;const f=Math.max(0,Math.min(u,s));this.progress.sauna.health=f,f>0&&(this.progress.sauna.destroyed=!1,this.progress.sauna.destroyedAt=null,this.saunaDestroyedAt=null)}markSaunaDestroyed(){if(this.sauna){const a=Math.max(0,Math.round(this.sauna.maxHealth??0));a>this.progress.sauna.maxHealth&&(this.progress.sauna.maxHealth=a)}this.progress.sauna.health=0,this.progress.sauna.destroyed=!0,this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),this.progress.sauna.destroyedAt=this.saunaDestroyedAt}}function N5(t){return new _5(t)}const In=[{level:1,xpToNext:180,cumulativeXp:0,statAwards:{vigor:0,focus:0,resolve:0}},{level:2,xpToNext:220,cumulativeXp:180,statAwards:{vigor:5,focus:2,resolve:1}},{level:3,xpToNext:260,cumulativeXp:400,statAwards:{vigor:4,focus:3,resolve:1}},{level:4,xpToNext:320,cumulativeXp:660,statAwards:{vigor:4,focus:2,resolve:2}},{level:5,xpToNext:380,cumulativeXp:980,statAwards:{vigor:6,focus:3,resolve:2}},{level:6,xpToNext:460,cumulativeXp:1360,statAwards:{vigor:7,focus:3,resolve:3}},{level:7,xpToNext:540,cumulativeXp:1820,statAwards:{vigor:6,focus:4,resolve:3}},{level:8,xpToNext:640,cumulativeXp:2360,statAwards:{vigor:7,focus:4,resolve:4}},{level:9,xpToNext:760,cumulativeXp:3e3,statAwards:{vigor:8,focus:5,resolve:4}},{level:10,xpToNext:900,cumulativeXp:3760,statAwards:{vigor:9,focus:6,resolve:5}},{level:11,xpToNext:1060,cumulativeXp:4660,statAwards:{vigor:10,focus:6,resolve:6}},{level:12,xpToNext:null,cumulativeXp:5720,statAwards:{vigor:12,focus:7,resolve:6}}];function R5(t){return Number.isNaN(t)||!Number.isFinite(t)?0:Math.max(0,Math.floor(t))}function $h(){return{vigor:0,focus:0,resolve:0}}function k5(t){return{vigor:t.vigor,focus:t.focus,resolve:t.resolve}}function iu(t){const a=R5(t);let s=In[0];for(const f of In)if(a>=f.cumulativeXp)s=f;else break;const r=a-s.cumulativeXp,l=s.xpToNext,u=l?Math.min(1,r/l):1;return{level:s.level,xpIntoLevel:r,xpForNext:l,progressToNext:u,statAwards:s.statAwards}}function L5(t){const a=In[In.length-1].level,s=Math.max(In[0].level,Math.min(t,a)),r=In.find(l=>l.level===s);return r?k5(r.statAwards):$h()}function D5(t){if(t<=In[0].level)return $h();const a=In[In.length-1].level,s=Math.min(t,a),r=$h();for(const l of In){if(l.level>s)break;l.level!==In[0].level&&(r.vigor+=l.statAwards.vigor,r.focus+=l.statAwards.focus,r.resolve+=l.statAwards.resolve)}return r}function I5(t){return iu(t).level}const _v="progression:sauna-shop";function Nv(){try{return globalThis.localStorage??null}catch{return null}}function U5(t){if(!t||typeof t!="object")return{version:1,tiers:[]};const a=Array.isArray(t.tiers)?t.tiers.filter(Boolean):[];return{version:1,tiers:Array.from(new Set(a))}}function O5(){const t=Nv();if(!t)return{version:1,tiers:[]};try{const a=t.getItem(_v);if(!a)return{version:1,tiers:[]};const s=JSON.parse(a);return U5(s)}catch(a){return console.warn("Failed to parse sauna shop state",a),{version:1,tiers:[]}}}function z5(t){const a=Nv();if(a)try{a.setItem(_v,JSON.stringify(t))}catch(s){console.warn("Failed to persist sauna shop state",s)}}let Lt=new Set(O5().tiers);const Xh=new Set;function Qh(t){const a=new Set(Lt);for(const s of Xh)try{s({...t,purchased:a})}catch(r){console.warn("Sauna shop listener failure",r)}}function B5(t){return Xh.add(t),()=>Xh.delete(t)}function bi(){return new Set(Lt)}function Kh(t){Lt=new Set(t),z5({version:1,tiers:Array.from(Lt)})}function q5(t){const a=is();if(!t||typeof t!="object")return{success:!1,balance:a,purchased:bi(),reason:"unsupported"};if(t.unlock.type!=="artocoin")return Lt.has(t.id)||(Lt.add(t.id),Kh(Lt),Qh({type:"grant",tierId:t.id,purchased:Lt,cost:0})),{success:!0,balance:a,purchased:bi()};if(Lt.has(t.id))return{success:!1,balance:a,purchased:bi(),reason:"already-owned"};const s=Math.max(0,Math.floor(t.unlock.cost)),r=vA(s,{reason:"purchase",metadata:{tierId:t.id,type:"sauna-tier"}});return r.success?(Lt.add(t.id),Kh(Lt),Qh({type:"purchase",tierId:t.id,purchased:Lt,spendResult:r,cost:s}),{success:!0,balance:r.balance,purchased:bi()}):{success:!1,balance:r.balance,purchased:bi(),shortfall:r.shortfall,reason:"insufficient-funds"}}function Lm(t){return Lt.has(t)||(Lt.add(t),Kh(Lt),Qh({type:"grant",tierId:t,purchased:Lt,cost:0})),bi()}function gh(t){return Number.isFinite(t)?Math.max(0,Math.floor(t)):0}function Rc(t,a){return a<=0?"":`${t}/${a}`}function H5(t){let a=0;const s=Math.max(0,gh(t.queueCapacity??2)),r=(f,h)=>{f&&typeof t.log=="function"&&t.log({type:"system",message:f,metadata:{context:"spawn-queue",...h}})},l=()=>{const f=t.getTier();if(!f)return null;const h=gh(t.getRosterLimit()),m=gh(t.getRosterCount());return{tierId:f.id,tierName:f.name,rosterLimit:h,rosterCount:m,queued:a}};return{getSnapshot:()=>l(),hasQueuedSpawn:()=>a>0,takeQueuedSpawn:f=>a<=0?!1:(a-=1,a<=0?r(`The benches of ${f.tierName} exhale  queued attendants take the field.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} deploys a queued attendant. Relief teams remaining: ${Rc(a,s)}.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0),restoreQueuedSpawn:f=>{s>0&&a>=s||(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} keeps the relief attendant on standby (${Rc(a,s)} ready).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},queueBlockedSpawn:(f,h)=>s>0&&a>=s?(r(`${f.tierName} cannot hold more relief attendants  clear a slot to vent the pressure.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!1):h()?(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} queues a ready attendant in the wings (${Rc(a,s)} poised).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0):!1,onSpawnResolved:(f,h)=>{h.usedQueue&&(a>0?r(`${f.tierName} still has relief attendants waiting (${Rc(a,s)}).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} has cleared the relief queue.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},clearQueue:f=>{if(!(a<=0)&&(a=0,f==="tier-change")){const h=t.getTier();h&&r(`${h.name} ushers its queued attendants into the new hall.`,{tierId:h.id,tierName:h.name,queue:a,capacity:s})}}}}const Rv="autobattles:saunojas";function kv(){try{return globalThis.localStorage??null}catch{return null}}function j5(){const t=kv();if(!t)return[];try{const a=t.getItem(Rv);if(!a)return[];const s=JSON.parse(a);if(!Array.isArray(s))return[];const r=[];for(const l of s){if(!l||typeof l!="object")continue;const u=l,f=u.id;if(typeof f!="string"||f.length===0)continue;const h=u.coord,m=h&&typeof h=="object"&&typeof h.q=="number"&&Number.isFinite(h.q)&&typeof h.r=="number"&&Number.isFinite(h.r)?{q:h.q,r:h.r}:void 0,p=u.traits,g=Array.isArray(p)?p.filter(S=>typeof S=="string"):void 0,b=typeof u.upkeep=="number"?u.upkeep:void 0,v=typeof u.xp=="number"?u.xp:void 0;r.push(Sm({id:f,name:typeof u.name=="string"?u.name:void 0,coord:m,maxHp:typeof u.maxHp=="number"?u.maxHp:void 0,hp:typeof u.hp=="number"?u.hp:void 0,steam:typeof u.steam=="number"?u.steam:void 0,behavior:u.behavior,traits:g,upkeep:b,xp:v,selected:!!u.selected,items:Array.isArray(u.items)?u.items:void 0,baseStats:u.baseStats,effectiveStats:u.effectiveStats,equipment:u.equipment,modifiers:Array.isArray(u.modifiers)?u.modifiers:void 0}))}return r}catch(a){return console.warn("Failed to load Saunoja units from storage",a),[]}}function G5(t){const a=kv();if(a)try{const s=t.map(r=>({id:r.id,name:r.name,coord:{q:r.coord.q,r:r.coord.r},maxHp:r.maxHp,hp:r.hp,steam:r.steam,behavior:r.behavior,traits:[...r.traits],upkeep:r.upkeep,xp:r.xp,selected:r.selected,baseStats:{health:r.baseStats.health,attackDamage:r.baseStats.attackDamage,attackRange:r.baseStats.attackRange,movementRange:r.baseStats.movementRange,...typeof r.baseStats.defense=="number"&&Number.isFinite(r.baseStats.defense)?{defense:r.baseStats.defense}:{},...typeof r.baseStats.shield=="number"&&Number.isFinite(r.baseStats.shield)?{shield:r.baseStats.shield}:{},...typeof r.baseStats.visionRange=="number"&&Number.isFinite(r.baseStats.visionRange)?{visionRange:r.baseStats.visionRange}:{}},effectiveStats:{health:r.effectiveStats.health,attackDamage:r.effectiveStats.attackDamage,attackRange:r.effectiveStats.attackRange,movementRange:r.effectiveStats.movementRange,...typeof r.effectiveStats.defense=="number"&&Number.isFinite(r.effectiveStats.defense)?{defense:r.effectiveStats.defense}:{},...typeof r.effectiveStats.shield=="number"&&Number.isFinite(r.effectiveStats.shield)?{shield:r.effectiveStats.shield}:{},...typeof r.effectiveStats.visionRange=="number"&&Number.isFinite(r.effectiveStats.visionRange)?{visionRange:r.effectiveStats.visionRange}:{}},equipment:lr.reduce((l,u)=>{const f=r.equipment?.[u]??null;return l[u]=f?{id:f.id,name:f.name,description:f.description,icon:f.icon,rarity:f.rarity,quantity:f.quantity,slot:f.slot}:null,l},{}),items:r.items.map(l=>({id:l.id,name:l.name,description:l.description,icon:l.icon,rarity:l.rarity,quantity:l.quantity})),modifiers:r.modifiers.map(l=>({id:l.id,name:l.name,description:l.description,remaining:l.remaining,duration:l.duration,appliedAt:l.appliedAt,stacks:l.stacks,source:l.source}))}));a.setItem(Rv,JSON.stringify(s))}catch(s){console.warn("Failed to persist Saunoja units",s)}}const Lv="autobattles:sauna-settings";function Dv(){try{return globalThis.localStorage??null}catch{return null}}function Y5(t){return typeof t=="string"?xn(t).id:dr}function Kb(t){return Number.isFinite(t)?Math.max(0,Math.floor(t)):0}function Dm(t,a){const s=Kb(t),r=Kb(a),l=1+im;return Math.max(0,Math.min(l,s,r))}function Iv(t,a,s){const r=Dm(s,s),l=typeof t=="number"&&Number.isFinite(t)?t:a,u=Math.max(0,Math.floor(l));return Math.max(0,Math.min(r,u))}function Uv(t){return t===!0||t==="true"}function So(t,a){const s=Y5(t?.activeTierId),r=xn(s),l=Dm(r.rosterCap,a);return{activeTierId:r.id,maxRosterSize:Iv(t?.maxRosterSize,l,l),useUiV2:Uv(t?.useUiV2)}}function Ov(t=1+im){const a=Dv();if(!a)return So(null,t);try{const s=a.getItem(Lv);if(!s)return So(null,t);const r=JSON.parse(s);return So(!r||typeof r!="object"?null:r,t)}catch(s){return console.warn("Failed to load sauna settings from storage",s),So(null,t)}}function zv(t){const a=Dv();if(!a)return;const s=xn(t.activeTierId),r=Dm(s.rosterCap,s.rosterCap),l={activeTierId:s.id,maxRosterSize:Iv(t.maxRosterSize,r,r),useUiV2:Uv(t.useUiV2)};try{a.setItem(Lv,JSON.stringify(l))}catch(u){console.warn("Failed to persist sauna settings",u)}}const F5=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),V5=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Bv(t){return Number.isFinite(t)?Math.max(0,Math.min(100,Math.round(t*100))):0}function $5(t){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});if(t.xpForNext===null)return`${a.format(t.xp)} XP  Max level`;const s=Bv(t.progress);return`${a.format(t.xpIntoLevel)} / ${a.format(t.xpForNext)} XP  ${s}%`}function X5(t){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),s=[];return t.vigor>0&&s.push(`+${a.format(t.vigor)} Vigor`),t.focus>0&&s.push(`+${a.format(t.focus)} Focus`),t.resolve>0&&s.push(`+${a.format(t.resolve)} Resolve`),s.length>0?s.join("  "):"No level bonuses yet"}function Q5(t,a){const{rosterIcon:s,summaryLabel:r="Saunoja Roster"}=a;t.classList.add("sauna-roster"),t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("title","Active sauna battalion on the field"),t.dataset.tutorialTarget="upkeep",t.replaceChildren();const l=document.createElement("div");l.classList.add("sauna-roster__summary");const u=document.createElement("img");u.src=s,u.alt="Saunoja roster crest",u.decoding="async",u.classList.add("sauna-roster__icon");const f=document.createElement("div");f.classList.add("sauna-roster__text");const h=document.createElement("span");h.textContent=r,h.classList.add("sauna-roster__label");const m=document.createElement("span");m.textContent="0",m.classList.add("sauna-roster__value"),f.append(h,m),l.append(u,f);const p=document.createElement("div");p.classList.add("saunoja-card"),p.setAttribute("aria-live","polite"),p.hidden=!0;const g=document.createElement("div");g.classList.add("saunoja-card__header");const b=document.createElement("div");b.classList.add("saunoja-card__level"),b.setAttribute("role","img"),b.style.setProperty("--level-progress","0%");const v=document.createElement("span");v.classList.add("saunoja-card__level-value"),v.textContent="1",b.appendChild(v);const S=document.createElement("div");S.classList.add("saunoja-card__identity");const E=document.createElement("h3");E.classList.add("saunoja-card__name"),E.textContent="Saunoja";const T=document.createElement("div");T.classList.add("saunoja-card__xp"),T.textContent="0 / 0 XP  0%",S.append(E,T),g.append(b,S);const _=document.createElement("p");_.classList.add("saunoja-card__traits");const R=document.createElement("div");R.classList.add("saunoja-card__callouts"),R.textContent="No level bonuses yet";const U=document.createElement("p");U.classList.add("saunoja-card__upkeep"),p.append(g,_,R,U),t.append(l,p);let B=null,V=null;function X(C){if(!C){p.hidden=!0;return}p.hidden=!1,p.dataset.unitId=C.id,E.textContent=C.name||"Saunoja";const J=C.traits.filter(x=>x.length>0),H=J.length>0?J.join(", "):"No notable traits yet";_.textContent=H,_.title=H;const ae=$5(C.progression);T.textContent=ae,T.title=ae;const F=Bv(C.progression.progress);b.style.setProperty("--level-progress",`${F}%`),v.textContent=String(C.progression.level);const D=C.progression.xpForNext===null?`Level ${C.progression.level}, at mastery`:`Level ${C.progression.level}, ${F}% toward next level`;b.setAttribute("aria-label",D);const P=X5(C.progression.statBonuses);R.textContent=P,R.title=P;const le=Math.max(0,Math.round(C.upkeep)),ee=`Upkeep: ${V5.format(le)} Beer`;U.textContent=ee,U.title=ee}function $(C){return C===1/0?"inf":!Number.isFinite(C)||C<=0?"0":String(Math.ceil(C))}function W(C){return[C.id,C.name,C.icon??"",C.rarity??"",C.description??"",C.quantity].join("^")}function ne(C){return[C.id,C.name,C.description??"",$(C.duration),$(C.remaining),C.appliedAt??"",C.stacks??1,C.source??""].join("^")}function Y(C){const{stats:J}=C,H=C.traits.join("|"),ae=C.items.map(W).join("|"),F=C.modifiers.map(ne).join("|");return[C.id,C.name,C.upkeep,C.status,C.selected?1:0,C.progression.level,C.progression.xp,C.progression.xpIntoLevel,C.progression.xpForNext??"max",J.health,J.maxHealth,J.attackDamage,J.attackRange,J.movementRange,J.defense??0,J.shield??0,H,ae,F].join("~")}function q(C){return`${C.length}:${C.map(Y).join("||")}`}return{updateSummary(C){const J=Math.max(0,Math.floor(C.count)),H=F5.format(J);m.textContent=H,t.setAttribute("aria-label",`Saunoja roster: ${H} active attendants`),t.setAttribute("title",`Saunoja roster  ${H} active attendants`),X(C.card)},installRenderer(C){V=null,B=C},renderRoster(C){if(!B)return;const J=q(C);J!==V&&(V=J,B(C))},destroy(){B=null,V=null,t.replaceChildren()}}}const K5={[re.SAUNA_BEER]:"Sauna Beer",[re.SAUNAKUNNIA]:"Saunakunnia",[re.SISU]:"Sisu"},P5=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Z5='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function J5(t){if(!Number.isFinite(t)||t<=0)return"0:00";const a=Math.round(t/1e3),s=Math.max(0,a%60).toString().padStart(2,"0"),r=Math.floor(a/60),l=(r%60).toString().padStart(2,"0"),u=Math.floor(r/60);return u>0?`${u}:${l}:${s}`:`${r}:${s}`}function W5(t){switch(t.cause){case"strongholds":return"All rival strongholds have fallen.";case"rosterWipe":return"Every attendant is downno one remains to hold the line.";case"bankruptcy":return"Upkeep debts have exhausted the steam reserves.";case"saunaDestroyed":return"The sauna collapsed under relentless assaultthe sacred steamline has fallen silent.";default:return""}}function e_(t){if(!Number.isFinite(t)||t===0)return"0";const a=Math.round(t*100)/100;return`${a>0?"+":""}${a}`}function t_(t,a){const s=document.createElement("ul");s.className="end-screen__rewards-list";for(const r of Object.values(re)){const l=t.rewards.resources[r];if(!l)continue;const u=document.createElement("li");u.className="end-screen__reward-item";const f=document.createElement("span");f.className="end-screen__reward-label",f.textContent=a[r]??r;const h=document.createElement("span");h.className="end-screen__reward-value",h.textContent=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(l.final));const m=document.createElement("span");m.className="end-screen__reward-delta",m.textContent=e_(l.delta),m.dataset.polarity=l.delta>=0?"positive":"negative",u.append(f,h,m),s.append(u)}return s}function n_(t,a,s){const r=l=>{if(l.key==="Escape"){l.preventDefault(),s?.();return}if(l.key!=="Tab")return;const u=a.querySelectorAll(Z5);if(u.length===0){l.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;l.shiftKey?(m===f||!a.contains(m))&&(l.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(l.preventDefault(),f.focus())};return t.addEventListener("keydown",r),()=>t.removeEventListener("keydown",r)}function a_(t){const{container:a,resolution:s,onNewRun:r,onDismiss:l}=t;if(!a)return{destroy(){},focusPrimary(){}};const u={...K5,...t.resourceLabels??{}},f=document.createElement("div");f.className="end-screen",f.setAttribute("role","presentation");const h=document.createElement("section");h.className="end-screen__panel",h.setAttribute("role","dialog"),h.setAttribute("aria-modal","true");const m=`end-screen-title-${Date.now()}`;h.setAttribute("aria-labelledby",m),h.tabIndex=-1,h.dataset.outcome=s.outcome;const p=document.createElement("h2");p.className="end-screen__title",p.id=m,p.textContent=s.outcome==="win"?"Steamforged Victory":"Sauna Lost";const g=document.createElement("p");g.className="end-screen__subtitle",g.textContent=W5(s);const b=document.createElement("dl");b.className="end-screen__metrics";const v=(q,C)=>{const J=document.createElement("dt");J.textContent=q,J.className="end-screen__metric-label";const H=document.createElement("dd");H.textContent=C,H.className="end-screen__metric-value",b.append(J,H)};v("Run time",J5(s.durationMs)),v("Strongholds",`${s.summary.strongholds.destroyed}/${s.summary.strongholds.total}`),v("Roster losses",`${s.summary.roster.totalDeaths}`),v("Deepest beer reserve",`${Math.round(s.summary.economy.worstBeer)}`);const S=t.artocoinSummary??{balance:0,earned:0,spent:0},E=document.createElement("section");E.className="end-screen__artocoin";const T=document.createElement("h3");T.className="end-screen__section-title",T.textContent="Artocoin ledger";const _=document.createElement("dl");_.className="end-screen__artocoin-ledger";const R=(q,C,J)=>{const H=document.createElement("dt");H.className="end-screen__artocoin-label",H.textContent=q;const ae=document.createElement("dd");ae.className="end-screen__artocoin-value",ae.dataset.polarity=J,ae.textContent=P5.format(Math.max(0,Math.floor(Number.isFinite(C)?C:0))),_.append(H,ae)};R("Earned",S.earned,S.earned>0?"positive":"neutral"),R("Spent",S.spent,S.spent>0?"negative":"neutral"),R("Balance",S.balance,"neutral"),E.append(T,_);const U=document.createElement("h3");U.className="end-screen__section-title",U.textContent="Rewards";const B=t_(s,u),V=document.createElement("div");V.className="end-screen__actions";const X=document.createElement("button");X.type="button",X.className="end-screen__button end-screen__button--primary",X.textContent="New run",X.addEventListener("click",()=>{r()});const $=document.createElement("button");$.type="button",$.className="end-screen__button",$.textContent="Review battlefield",$.addEventListener("click",()=>{l?.()}),V.append(X,$),h.append(p,g,b,E,U,B,V),f.append(h),a.append(f);const W=n_(f,h,l),ne=()=>{W(),f.remove()},Y=()=>{requestAnimationFrame(()=>{X.focus({preventScroll:!0})})};return Y(),{destroy:ne,focusPrimary:Y}}const qv="autobattles4x.flags";function Hv(){if(typeof window>"u")return null;try{if("localStorage"in window&&window.localStorage)return window.localStorage}catch(t){console.warn("Unable to access localStorage for local flags",t)}return null}function jv(){const t=Hv();if(!t)return{};try{const a=t.getItem(qv);if(!a)return{};const s=JSON.parse(a);if(s&&typeof s=="object")return s}catch(a){console.warn("Failed to parse local flags, resetting.",a)}return{}}function i_(t){const a=Hv();if(a)try{const s={};t.tutorial_done&&(s.tutorial_done=!0),a.setItem(qv,JSON.stringify(s))}catch(s){console.warn("Failed to persist local flags",s)}}function s_(){return jv().tutorial_done===!0}function Pb(t){const a={...jv()};a.tutorial_done=!0,i_(a)}const yh=200,bh=3,r_=2,Zb=6,o_=40,l_=250,c_=200,u_=I5(Number.MAX_SAFE_INTEGER),Ph={[re.SAUNA_BEER]:"Sauna Beer",[re.SAUNAKUNNIA]:"Saunakunnia",[re.SISU]:"Sisu"};let ns=is(),rs=new Set(bi()),Im=0;const Zh=new Set;function Gv(){Zh.forEach(t=>{try{t()}catch(a){console.warn("Sauna shop listener failure",a)}})}function Yv(t,a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;if(!Number.isFinite(t))return s;const r=Math.max(0,Math.floor(t));return Math.max(0,Math.min(s,r))}const Fv=.1,d_=3,f_=1;let sa=La(IM()),Vv=jc(sa.runSeed,1),$v=jc(sa.runSeed,2),xu=null;function su(t){sa=La(t),Vv=jc(sa.runSeed,1),$v=jc(sa.runSeed,2),xu?.({persist:!0})}su(sa);let ru=null,je=[];const ra=new Map,vi=new Map,os=new Map;let Jb=0,ou=null,ta=null,Ba=null,ar=null,un=null,ir=null,Tt=null,Wi=null,Lo=null,Ua=null,Si=null,es=!1,Mn=null,Mi=null,Zn=null,Do=null,lu=!1,Ki=0;function Au(t){const a=vi.get(t.id);return a?os.get(a)??null:null}function Xv(t,a,s){const r=s??Au(t),l=a,u=t.behavior!==l;return t.behavior=l,r&&r.setBehavior(l),u}function Qv(t,a){t.effectiveStats={...a},t.maxHp=Math.max(1,Math.round(a.health)),t.hp=Math.min(t.maxHp,Math.max(0,Math.round(t.hp))),t.defense=typeof a.defense=="number"?Math.max(0,a.defense):void 0,t.shield=typeof a.shield=="number"?Math.max(0,a.shield):0;const s=Au(t);if(s){Xv(t,t.behavior,s);const r={health:t.effectiveStats.health,attackDamage:t.effectiveStats.attackDamage,attackRange:t.effectiveStats.attackRange,movementRange:t.effectiveStats.movementRange};typeof t.effectiveStats.defense=="number"&&(r.defense=t.effectiveStats.defense),typeof t.effectiveStats.visionRange=="number"&&(r.visionRange=t.effectiveStats.visionRange),s.updateStats(r),typeof t.effectiveStats.shield=="number"?s.setShield(t.effectiveStats.shield):t.shield<=0&&s.setShield(0)}}function wu(t,a){const s=a??Un(t.equipment),r=$c(t.baseStats,s);return Qv(t,r),r}function Kv(t){const a=iu(t.xp);return{level:a.level,xp:Math.max(0,Math.floor(t.xp)),xpIntoLevel:a.xpIntoLevel,xpForNext:a.xpForNext,progress:a.progressToNext,statBonuses:D5(a.level)}}function h_(t){const a=[];return t.vigor>0&&a.push(`+${t.vigor} Vigor`),t.focus>0&&a.push(`+${t.focus} Focus`),t.resolve>0&&a.push(`+${t.resolve} Resolve`),a.length>0?a.join(", "):"+0 Vigor, +0 Focus, +0 Resolve"}function Pv(t,a,s){if(!Number.isFinite(a)||a<=0)return null;const r=iu(t.xp),l=Math.max(0,Math.floor(t.xp+a));if(l===t.xp)return null;t.xp=l;const u=iu(t.xp),f=Math.max(0,u.level-r.level),h={vigor:0,focus:0,resolve:0};let m=0;if(f>0){for(let g=r.level+1;g<=u.level&&g<=u_;g++){const b=L5(g);h.vigor+=b.vigor,h.focus+=b.focus,h.resolve+=b.resolve;const v=Number.isFinite(t.baseStats.health)?t.baseStats.health:t.effectiveStats.health;t.baseStats.health=Math.max(1,Math.round(v+b.vigor));const S=Number.isFinite(t.baseStats.attackDamage)?t.baseStats.attackDamage:t.effectiveStats.attackDamage;t.baseStats.attackDamage=Math.max(0,Math.round(S+b.focus));const T=(Number.isFinite(t.baseStats.defense)?t.baseStats.defense??0:t.effectiveStats.defense??0)+b.resolve;t.baseStats.defense=T>0?T:void 0}m=h.vigor}m>0&&(t.hp+=m),wu(t);const p=Au(t);if(p&&p.setExperience(t.xp),s.source==="kill"){const g=t.name?.trim()||"Our champion",b=s.label?.trim()||"their foe",v=s.boss?" Boss toppled!":s.elite?" Elite threat routed!":"";Dt({type:"combat",message:`${g} earns ${a} XP for defeating ${b}.${v}`,metadata:{slayer:g,foe:b,xpAward:a,boss:!!s.boss,elite:!!s.elite}})}if(f>0){const g=h_(h),b=t.name?.trim()||"Our champion";Dt({type:"progression",message:`${b} reaches Level ${u.level}! ${g}.`,metadata:{unit:b,level:u.level,levelsGained:f,bonuses:h}})}return{xpAwarded:a,totalXp:t.xp,level:u.level,levelsGained:f,statBonuses:h}}function m_(t,a,s){if(!t)return null;const r=ra.get(t.id);return r?Pv(r,a,s):null}function p_(t,a){if(!Number.isFinite(t)||t<=0)return!1;let s=!1;for(const r of je)Pv(r,t,a)&&(s=!0);return s}function g_(t){return t?(t.type?.toLowerCase?.()??"").includes("boss")?{xp:l_,elite:!0,boss:!0}:h1(t)?{xp:o_,elite:!0,boss:!1}:{xp:Zb,elite:!1,boss:!1}:{xp:Zb,elite:!1,boss:!1}}const Zv=t=>{if(!t)return;const a=Math.max(0,Math.floor(t.strongholds.destroyed));if(a>Ki){const s=a-Ki,r=c_*s;p_(r,{source:"objective",label:"stronghold"})&&(oa(),Ft(),Dt({type:"progression",message:`Strategists toast the captured stronghold  roster gains ${r} XP.`,metadata:{source:"stronghold",xpAward:r}}))}if(a<Ki){Ki=a;return}Ki=a},y_=Object.freeze(["health","attackDamage","attackRange","movementRange","defense","shield"]);function Wb(t){return t?{id:t.id,name:t.name,quantity:t.quantity,rarity:t.rarity}:null}function e2(t,a){const s=t[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function b_(t,a){const s=[];for(const r of y_){const l=e2(a,r),u=e2(t,r),f=l-u;f!==0&&s.push({stat:r,delta:f})}return s}function v_(t,a){if(!a||Un(t.equipment).length>0)return;const r={health:Math.max(1,Math.round(a.getMaxHealth())),attackDamage:Math.max(0,Math.round(a.stats.attackDamage)),attackRange:Math.max(0,Math.round(a.stats.attackRange)),movementRange:Math.max(0,Math.round(a.stats.movementRange)),defense:typeof a.stats.defense=="number"&&Number.isFinite(a.stats.defense)?Math.max(0,a.stats.defense):t.baseStats.defense,shield:t.baseStats.shield??0,visionRange:typeof a.stats.visionRange=="number"&&Number.isFinite(a.stats.visionRange)?Math.max(0,a.stats.visionRange):t.baseStats.visionRange};t.baseStats=r,wu(t)}function cu(){lu&&(vu(!1),lu=!1)}function Ao(){if(!Do){cu();return}Do.destroy(),Do=null,cu()}function S_(){if(s_()){Ao();return}Ao(),_m()?lu=!1:(vu(!0),lu=!0),Do=H3({onComplete:()=>{Pb(),cu(),Ao()},onSkip:()=>{Pb(),cu(),Ao()}}),Do.start()}function t2(t){Lo=t,Tt&&(Tt.installRenderer(t),Ua&&(Tt.renderRoster(Ua),Ua=null))}function M_(){return j5()}function oa(){G5(je)}function E_(t=Math.random){const a=typeof t=="function"?t:Math.random,s=Math.ceil(Math.min(Io,Rh)),r=Math.floor(Math.max(Io,Rh)),l=Math.max(1,r-s+1),u=Number(a()),f=Number.isFinite(u)?u:Math.random(),h=Math.min(Math.max(f,0),1),m=Math.min(Math.floor(h*l),l-1);return s+m}function x_(t){const s=(Array.isArray(t.traits)?t.traits:[]).length>=3,r=Number.isFinite(t.upkeep),l=Number.isFinite(t.xp);return!s||!r||!l}function Jv(t){t.traits=mC(),t.upkeep=E_(),t.xp=0}function Wv(t,a,s,r={}){const l=r.hudVariant??"classic",u=l==="classic";s.dataset.hudVariant=l,ru=t,Mn&&(Mn.dispose(),Mn=null),Mn=oC({canvas:t,overlay:s,mapRenderer:Um,getUnitById:m=>os.get(m),requestDraw:()=>{It()}}),Tt&&(Tt.destroy(),Tt=null),u?(Tt=Q5(a,{rosterIcon:Jn.saunojaRoster}),Lo&&Tt.installRenderer(Lo),Ua&&(Tt.renderRoster(Ua),Ua=null),Wi&&(Tt.updateSummary(Wi),Wi=null)):(Lo=null,Ua=null,Wi=null),un?.dispose(),un=null,u&&(un=mA(Oe,{getActiveTierId:()=>We,setActiveTierId:(m,p)=>{const g=D_(m,{persist:p?.persist});return g&&(un?.update(),Ft()),g},getTierContext:()=>Gm()})),Ba?.dispose(),Ba=null,ar?.destroy(),ar=null;const f={useSisuBurst:()=>{const m=qA(Xe,bt);return m?(aa("sisu"),Dt({type:"ability",message:`Sisu bursts forth, spending ${Pi} grit to steel our attendants.`,metadata:{ability:"sisu-burst",cost:Pi}})):aa("error"),m},torille:()=>{const m=jA(Xe,bt,Oe.pos,Yt);return m?Dt({type:"ability",message:`Torille! Our warriors regroup at the sauna to rally their spirits for ${Zi} SISU.`,metadata:{ability:"torille",cost:Zi}}):aa("error"),m}};u&&(Ba=AA(Xe,{saunakunnia:Jn.resource,sisu:Jn.sisu,saunaBeer:Jn.saunaBeer,artocoin:Jn.artocoin})),ar=o3(Xe,s,f),ir?.destroy(),ir=null;const h=()=>({balance:ns,tiers:Am().map(m=>({tier:m,status:as(m,zm())}))});u&&(ir=t5(zo,{getSelectedUnitId:()=>je.find(m=>m.selected)?.id??null,getComparisonContext:()=>z_(),onEquip:(m,p,g)=>Fm(m,p),getUseUiV2:L_,onUseUiV2Change:c1,getSaunaShopViewModel:()=>h(),onPurchaseSaunaTier:m=>q5(xn(m)),subscribeToSaunaShop:m=>(Zh.add(m),()=>Zh.delete(m))})),u?(B_(),Om(),Ft(),S_()):ta&&(ta(),ta=null)}const Yt=new GM(10,10,32),e1=new Gw(()=>It()),A_=new ux(Yt,e1),Um=new Nw(Yt),uu=()=>{Um.invalidateCache(),It()};se.on("buildingPlaced",uu);se.on("buildingRemoved",uu);Yt.forEachTile(t=>t.setFogged(!0));kM();const bt=[];function n2(t){return`${t.q},${t.r}`}function w_(){const t=new Set;for(const m of bt)m.isDead()||t.add(n2(m.coord));const a=[],{minQ:s,maxQ:r,minR:l,maxR:u}=Yt,f=m=>{const p=n2(m);t.has(p)||(Yt.ensureTile(m.q,m.r),a.push(m))};for(let m=s;m<=r;m++)f({q:m,r:l}),u!==l&&f({q:m,r:u});for(let m=l+1;m<=u-1;m++)f({q:s,r:m}),r!==s&&f({q:r,r:m});if(a.length===0)return;const h=Math.floor(Math.random()*a.length);return a[h]}function C_(t){const a=ra.get(t);a&&(ra.delete(t),vi.get(a.id)===t&&vi.delete(a.id))}function T_(t){const a=ra.get(t.id);if(a)return{saunoja:a,created:!1,attached:!1};let s=je.find(f=>f.id===t.id);s||(s=je.find(f=>!vi.has(f.id)));let r=!1;s||(s=Sm({id:`saunoja-${je.length+1}`,coord:{q:t.coord.q,r:t.coord.r}}),je.push(s),r=!0);const l=vi.get(s.id);l&&l!==t.id&&ra.delete(l),ra.set(t.id,s),vi.set(s.id,t.id),Xv(s,s.behavior,t),v_(s,t),Qv(s,s.effectiveStats),t.setExperience(s.xp);const u=x_(s);return(r||u)&&Jv(s),{saunoja:s,created:r,attached:!0}}function Om(){let t=!1;for(const a of bt){if(a.faction!=="player"||a.isDead())continue;const{saunoja:s,created:r,attached:l}=T_(a);(r||l)&&(t=!0);const u=Number.isFinite(a.stats.health)?Math.max(0,a.stats.health):0;s.hp!==u&&(s.hp=u,t=!0);const f=Number.isFinite(a.getMaxHealth())?Math.max(1,a.getMaxHealth()):1;s.maxHp!==f&&(s.maxHp=f,t=!0);const h=a.getShield(),m=Number.isFinite(h)?Math.max(0,h):0;s.shield!==m&&(s.shield=m,t=!0);const g=a?.lastHitAt;Number.isFinite(g)&&s.lastHitAt!==g&&(s.lastHitAt=g,t=!0);const{q:b,r:v}=a.coord;(s.coord.q!==b||s.coord.r!==v)&&(s.coord={q:b,r:v},t=!0,s.selected&&Ym(s.coord))}return t&&oa(),t}function t1(t,a){if(t.faction==="player"){const u=(a??ra.get(t.id)??null)?.name?.trim();if(u)return u}return`${(t.constructor?.name??"Unit").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase()} ${t.id}`.trim()}function Cu(t){if(os.has(t.id))return;bt.push(t),os.set(t.id,t);let a=null;if(t.faction==="player"&&(Om()||Fo(),a=ra.get(t.id)??null),ru&&It(),t.faction==="player"){const r=t1(t,a);Dt({type:"spawn",message:`Our ${r} emerges from the steam.`,metadata:{unitId:t.id,unitName:r,steward:"Our"}}),Ft()}}const n1=({unit:t})=>{Cu(t)};se.on("unitSpawned",n1);const a1=()=>{Fo()},sr=()=>{Fo()};se.on("inventoryChanged",a1);se.on("modifierAdded",sr);se.on("modifierRemoved",sr);se.on("modifierExpired",sr);const i1=t=>{un?.handleDamage?.(t)},s1=t=>{un?.handleDestroyed?.(t)};se.on("saunaDamaged",i1);se.on("saunaDestroyed",s1);const r1=()=>{Ft()};se.on("unit:stats:changed",r1);function __(t){const a=ra.get(t.id);if(!a)return 0;const s=Number.isFinite(a.upkeep)?a.upkeep:0;return s>0?s:0}const Xe=new zM(1e3),zo=new SC;ns=is();rs=new Set(bi());Im=0;const o1=Xe.load(Yt);if(o1){const t=Xe.getNgPlusState();su(t),Eh(t)}else{const t=Xe.setNgPlusState(sa);su(t),Eh(t)}Xe.setEnemyScalingBase({aggression:1,cadence:1,strength:1});const qa=Ov();sa.unlockSlots>=2&&(rs=new Set(Lm("aurora-ward")));sa.ngPlusLevel>=3&&(rs=new Set(Lm("mythic-conclave")));qa.activeTierId!==dr&&!rs.has(qa.activeTierId)&&(rs=new Set(Lm(qa.activeTierId)));const zm=()=>({artocoinBalance:ns,ownedTierIds:rs});let We=qa.activeTierId,ur=qa.useUiV2;const N_=as(xn(We),zm());N_.unlocked||(We=dr);const l1=xn(We),Tu=()=>{const t=xn(We);return Math.max(0,Math.floor(t.rosterCap))},du=Yv(qa.maxRosterSize,Tu());(du!==qa.maxRosterSize||qa.activeTierId!==We||qa.useUiV2!==ur)&&zv({maxRosterSize:du,activeTierId:We,useUiV2:ur});const Oe=ox({q:Math.floor(Yt.width/2),r:Math.floor(Yt.height/2)},void 0,{maxRosterSize:du,tier:l1}),R_=t=>Math.max(0,Math.floor(Number.isFinite(t)?t:0)),Bm=(t,a={})=>{const s=R_(t.visionRange);s!==Oe.visionRange&&(Oe.visionRange=s),a.reveal&&Yt.revealAround(Oe.pos,Oe.visionRange)};Bm(l1);const k_=()=>Math.max(d_,Oe.maxRosterSize),L_=()=>ur,c1=t=>{const a=!!t;ur!==a&&jm(Oe.maxRosterSize,{useUiV2:a})},qm=H5({getTier:()=>xn(We),getRosterLimit:()=>Tu(),getRosterCount:()=>_u(),log:t=>Dt(t),queueCapacity:3});let u1=du,Hm=We;const jm=(t,a)=>{typeof a?.useUiV2=="boolean"&&(ur=a.useUiV2),zv({maxRosterSize:t,activeTierId:We,useUiV2:ur}),u1=t,Hm=We},Gm=()=>zm(),Bo=(t,a={})=>{const s=Tu(),r=Yv(t,s);return r!==Oe.maxRosterSize&&(Oe.maxRosterSize=r),a.persist&&(We!==Hm||r!==u1)&&jm(r),r};xu=(t={})=>{const a=Gm(),s=Am();let r=dr;for(const f of s)if(as(f,a).unlocked)r=f.id;else break;if(!as(xn(We),a).unlocked||We!==r){const f=We;We=r;const h=xn(We);Bm(h,{reveal:!0}),qm.clearQueue?.("tier-change"),Bo(Oe.maxRosterSize,{persist:t.persist}),f!==We&&un?.update?.(),Ft();return}t.persist&&(Bo(Oe.maxRosterSize,{persist:!0}),Ft())};xu({persist:!0});B5(t=>{rs=new Set(t.purchased),t.type==="purchase"&&t.cost&&t.spendResult?.success&&(Im+=Math.max(0,Math.floor(t.cost))),Gv(),xu({persist:!0}),un?.update?.()});F2(t=>{ns=t.balance,Gv(),un?.update?.()});const D_=(t,a={})=>{const s=xn(t);return as(s,Gm()).unlocked?s.id===We?(a.persist&&We!==Hm&&jm(Oe.maxRosterSize),!0):(We=s.id,Bm(s,{reveal:!0}),qm.clearQueue?.("tier-change"),Bo(Oe.maxRosterSize,{persist:a.persist}),!0):!1},I_=t=>{Jb+=1;const a=`p${Date.now()}-${Jb}`,s=bm(Xe,"soldier",a,t,"player");return s&&Cu(s),s??null},Jh=new aA({difficulty:f_,random:Vv,eliteOdds:Fv}),d1=new BM(1e3,t=>{const a=t/1e3;Xe.tick(),wo.tick(a,{state:Xe});const s=Xe.getEnemyScalingSnapshot(),r=Bo(Oe.maxRosterSize);yC({dt:a,state:Xe,sauna:Oe,heat:Oe.heatTracker,units:bt,getUnitUpkeep:__,pickSpawnTile:()=>A2(Oe.pos,bt),spawnBaseUnit:I_,minUpkeepReserve:Math.max(1,Io),maxSpawns:k_(),rosterCap:r,getRosterCount:_u,tierHelpers:qm});const l={aggressionMultiplier:s.aggression,cadenceMultiplier:s.cadence,strengthMultiplier:s.strength,calmSecondsRemaining:s.calmSecondsRemaining};Jh.update(a,bt,Cu,w_,l),Xe.advanceEnemyCalm(a);const u=Jh.getSnapshot(),f=Math.max(s.calmSecondsRemaining,u.calmSecondsRemaining);if(Ba){const m={stage:u.rampStageLabel,stageIndex:u.rampStageIndex,bundleTier:u.bundleTier,multiplier:u.difficultyMultiplier,cadenceSeconds:u.cadence,effectiveDifficulty:u.effectiveDifficulty,aggressionMultiplier:u.aggressionMultiplier,cadenceMultiplier:u.cadenceMultiplier,strengthMultiplier:u.strengthMultiplier,calmSecondsRemaining:f,spawnCycles:u.spawnCycles};Ba.setEnemyRampSummary(m)}const h=Mi?.getProgress().roster;lA(u,{wipeSince:h?.wipeSince??null,wipeDurationMs:h?.wipeDurationMs??0}),A_.tick(bt,a,Oe),jE(a),Om()&&Ft(),Xe.save();for(const m of bt)m.isDead()||m.faction!=="player"||Yt.revealAround(m.coord,m.getVisionRange(),{autoFrame:!1});It()}),U_=t=>{es&&(es=!1),d1.stop(),Si!==null&&(cancelAnimationFrame(Si),Si=null),It();const a=document.getElementById("ui-overlay");if(!a)return;Zn&&(Zn.destroy(),Zn=null);const s=Jh.getSnapshot(),r=xA(t.outcome,{tierId:We,runSeconds:Math.max(0,t.durationMs/1e3),enemyKills:Math.max(0,t.summary.enemyKills),tilesExplored:Math.max(0,t.summary.exploration.revealedHexes),rosterLosses:Math.max(0,t.summary.roster.totalDeaths),difficultyScalar:s.effectiveDifficulty,rampStageIndex:s.rampStageIndex});r.artocoins>0&&(ns=bA(r.artocoins,{reason:"payout",metadata:{outcome:t.outcome,tier:We},previousBalance:ns}));const l=UM(sa,{outcome:t.outcome});Eh(l),Xe.setNgPlusState(l),su(l),Zn=a_({container:a,resolution:t,artocoinSummary:{balance:ns,earned:r.artocoins,spent:Im},resourceLabels:Ph,onNewRun:()=>{try{typeof window<"u"&&window.localStorage?.removeItem?.("gameState")}catch(f){console.warn("Failed to reset saved game state for NG+",f)}typeof window<"u"&&typeof window.location?.reload=="function"&&window.setTimeout(()=>window.location.reload(),75)},onDismiss:()=>{Zn&&(Zn.destroy(),Zn=null)}})};je=M_();if(je.length===0){const t=Sm({id:"saunoja-1",coord:Oe.pos,selected:!0,upkeep:Xc});Jv(t),t.upkeep=Xc,je.push(t),oa()}else{let t=!1,a=!1;for(const s of je)s.selected&&(t?(s.selected=!1,a=!0):t=!0);a&&oa()}const O_=bt.some(t=>t.faction==="player"&&!t.isDead());if(!O_){Xe.canAfford(Fy,re.SAUNA_BEER)||Xe.addResource(re.SAUNA_BEER,Fy);const t=`u${bt.length+1}`,a=bm(Xe,"soldier",t,Oe.pos,"player");a&&Cu(a)}Yt.revealAround(Oe.pos,Oe.visionRange);Mi=N5({state:Xe,map:Yt,getRosterCount:_u,sauna:Oe,rosterWipeGraceMs:8e3,bankruptcyGraceMs:12e3});Ki=Mi.getProgress().strongholds.destroyed;Mi.onProgress(Zv);Mi.onResolution(U_);function z_(){const t=je.find(a=>a.selected)??null;return t?{baseStats:{...t.baseStats},loadout:Un(t.equipment),currentStats:{...t.effectiveStats}}:null}function B_(){ta&&(ta(),ta=null);const t=O3(Xe,{onRosterSelect:G_,onRosterRendererReady:t2,onRosterEquipSlot:F_,onRosterUnequipSlot:V_,getRosterCap:()=>Math.max(0,Math.floor(Oe.maxRosterSize)),getRosterCapLimit:()=>Tu(),updateMaxRosterSize:(a,s)=>{const r=Bo(a,{persist:s?.persist});return s?.persist&&Ft(),r}});t.addEvent,t2(t.renderRoster),ta=t.dispose}function q_(){un?.update()}function a2(t){Ba?.update(t)}o1||(Xe.addResource(re.SAUNA_BEER,yh),Dt({type:"resource",message:`Quartermaster stocks ${yh} bottles of ${Ph[re.SAUNA_BEER]} to launch your campaign.`,metadata:{resource:re.SAUNA_BEER,amount:yh,context:"initial"}}),Xe.addResource(re.SAUNAKUNNIA,bh),Dt({type:"resource",message:`Sauna elders honor your leadership with ${bh} ${Ph[re.SAUNAKUNNIA]} to celebrate your arrival.`,metadata:{resource:re.SAUNAKUNNIA,amount:bh,context:"initial"}}));const vh=je.find(t=>t.selected);vh&&(ou={q:vh.coord.q,r:vh.coord.r});function H_(t,a){return!t||!a?t===a:t.q===a.q&&t.r===a.r}function Ym(t){return H_(ou,t)?!1:(ou=t?{q:t.q,r:t.r}:null,!0)}function f1(t){let a=!1;for(const s of je)t&&s===t||s.selected&&(s.selected=!1,a=!0);return a}function j_(){let t=!1;return f1()&&(t=!0),Ym(null)&&(t=!0),t}function h1(t){if(!t)return!1;const a=ym(t.type);if(!a)return!1;const s=jo(a,1),r=t.stats;return r.health>s.health||r.attackDamage>s.attackDamage||r.attackRange>s.attackRange||r.movementRange>s.movementRange}function m1(t){let a=!1;return t.selected||(t.selected=!0,a=!0),f1(t)&&(a=!0),Ym(t.coord)&&(a=!0),a}function G_(t){const a=je.find(s=>s.id===t);a&&m1(a)&&(oa(),Ft(),It())}function p1(t){const a=CM(t.x,t.y,Yt.hexSize),s=je.find(l=>l.coord.q===a.q&&l.coord.r===a.r);(s?m1(s):j_())&&(oa(),Ft(),It())}function Fm(t,a){const s=je.find(p=>p.id===t);if(!s)return{success:!1,reason:"unit-missing"};const r=Un(s.equipment),l=$c(s.baseStats,r),u=Ex(s,a);if(!u.success)return{success:!1,reason:u.reason};const f=wu(s,u.loadout);se.emit("unit:stats:changed",{unitId:s.id,stats:f}),se.emit("inventoryChanged",{}),oa(),Ft();const h=r.find(p=>p.slot===u.slot)??null;return{success:!0,comparison:{slot:u.slot,previous:Wb(h),next:Wb(u.item??null),deltas:b_(l,f)}}}function Y_(t,a){const s=je.find(b=>b.id===t);if(!s)return null;const r=xx(s,a);if(!r.success||!r.removed)return null;const l=wu(s,r.loadout);se.emit("unit:stats:changed",{unitId:s.id,stats:l}),se.emit("inventoryChanged",{}),oa(),Ft();const{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}=r.removed;return{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}}function F_(t,a){const r=zo.getStash().findIndex(l=>Ax(l.id,a));return r===-1?!1:zo.equipFromStash(r,t,Fm)}function V_(t,a){return zo.unequipToStash(t,a,Y_)}function It(){if(!ru)return;const t=ru.getContext("2d"),a=Tv();if(!t||!a)return;if(Mn){const m=typeof performance<"u"?performance.now():Date.now();Mn.step(m)}const s=Mn?.getShakeOffset()??{x:0,y:0},r=Mn?{getUnitAlpha:m=>Mn.getUnitAlpha(m.id)}:void 0,l=Array.isArray(je)&&je.length>0,u=bt.filter(m=>m.faction==="player"&&!m.isDead()),f=Oe?{coord:Oe.pos,range:Oe.visionRange}:null,h=l?bt.filter(m=>m.faction!=="player"):bt;t.save(),(s.x!==0||s.y!==0)&&t.translate(s.x,s.y),qw(t,Um,a.images,h,ou,{saunojas:{units:je,draw:uC,resolveRenderCoord:m=>{const p=Au(m);return p?p.renderCoord??p.coord:null}},sauna:Oe,saunaVision:f,fx:r,friendlyVisionSources:u}),t.restore()}const g1=({policy:t})=>{Dt({type:"policy",message:`Sauna council toasts a fresh keg for policy: ${t.name}.`,metadata:{policy:t.id,name:t.name}})};se.on(Gt.APPLIED,g1);const y1=({unitId:t,attackerId:a,attackerFaction:s,unitFaction:r})=>{const l=bt.findIndex(v=>v.id===t),u=l!==-1?bt[l]:null,f=u?{q:u.coord.q,r:u.coord.r}:null,h=r==="player"?ra.get(t)??null:null;let m=!1;if(r==="player"){const v=h??je.find(S=>vi.get(S.id)===t||S.id===t)??null;v&&(v.hp!==0&&(v.hp=0,m=!0),v.shield!==0&&(v.shield=0,m=!0))}const p=u?t1(u,h):`unit ${t}`;let g=!1;if(s==="player"&&r&&r!=="player"){const v=a?os.get(a)??null:null,{xp:S,elite:E,boss:T}=g_(u);S>0&&m_(v,S,{source:"kill",label:p,elite:E,boss:T})&&(g=!0)}if(l!==-1&&(u&&e1.clear(u,{snap:!0}),bt.splice(l,1),os.delete(t),C_(t),It()),(m||g)&&oa(),(r==="player"||g)&&Ft(),s==="player"&&r&&r!=="player"){const v=h1(u??null)||$v()<Fv,S=m5({factionId:r,elite:v});if(S.rolls.length>0){const E=je.find(T=>T.selected)??null;for(const T of S.rolls)if(zo.addLoot(T,{unitId:E?.id,sourceTableId:S.tableId,equip:Fm}).equipped){const R=E?.name??"our champion";Dt({type:"loot",message:`Quartermaster fastens ${T.item.name} to ${R}.`,metadata:{item:T.item.name,equipped:!0,owner:R,source:p}})}else Dt({type:"loot",message:`Quartermaster stores ${T.item.name} recovered from ${p}.`,metadata:{item:T.item.name,equipped:!1,source:p}})}}s==="player"&&r&&r!=="player"&&(Xe.addResource(re.SAUNAKUNNIA,r_),Xe.addResource(re.SISU,1),Dt({type:"resource",message:"Our grit surges  +1 SISU earned for the vanquished foe.",metadata:{resource:re.SISU,amount:1,context:"victory"}})),f&&Yt.revealAround(f,1,{autoFrame:!1});const b=r==="player"?"our":"a rival";Dt({type:"combat",message:`The steam hushes as ${b} ${p} grows still.`,metadata:{side:b,unit:p}})};se.on("unitDied",y1);function Wh(){es=!1,Mi?.offProgress(Zv),Mi?.dispose(),Mi=null,Ki=0,YA(),Zn&&(Zn.destroy(),Zn=null),Si!==null&&(cancelAnimationFrame(Si),Si=null);try{Xe.save()}catch(t){console.warn("Failed to persist game state during cleanup",t)}try{oa()}catch(t){console.warn("Failed to persist Saunoja roster during cleanup",t)}Mn&&(Mn.dispose(),Mn=null),se.off(Gt.APPLIED,g1),se.off("unitDied",y1),se.off("unitSpawned",n1),se.off("inventoryChanged",a1),se.off("modifierAdded",sr),se.off("modifierRemoved",sr),se.off("modifierExpired",sr),se.off("unit:stats:changed",r1),se.off("saunaDamaged",i1),se.off("saunaDestroyed",s1),se.off("buildingPlaced",uu),se.off("buildingRemoved",uu),ta&&(ta(),ta=null),ir&&(ir.destroy(),ir=null),un&&(un.dispose(),un=null),Ba&&(Ba.dispose(),Ba=null),ar&&(ar.destroy(),ar=null),Tt&&(Tt.destroy(),Tt=null),Ua=null,Wi=null,Lo=null,Ao()}async function $_(){if(es)return;if(!Tv()){console.error("Cannot start game without loaded assets.");return}es=!0,Ft(),It();try{await Ev(()=>{It()}).then(()=>{It()})}catch(r){console.warn("Failed to preload Saunoja icon before starting the game",r)}let a=performance.now();function s(r){if(!es)return;const l=r-a;a=r;const u=_m();d1.tick(u?0:l),u?a2(0):(q_(),a2(l),Fo()),It(),es&&(Si=requestAnimationFrame(s))}Si=requestAnimationFrame(s)}function _u(){let t=0;for(const a of bt)a.faction==="player"&&!a.isDead()&&(t+=1);return t}function X_(){const t={engaged:0,reserve:1,downed:2},a=je.map(s=>{const r=vi.get(s.id),l=r?os.get(r):void 0,u=l?!l.isDead()&&l.stats.health>0:!1,f=s.effectiveStats,h=s.baseStats,m=Math.round(l?Math.max(0,l.stats.health):Math.max(0,s.hp)),p=Math.round(l?Math.max(1,l.getMaxHealth()):Math.max(1,f.health)),g=Math.round(l?Math.max(0,l.stats.attackDamage):Math.max(0,f.attackDamage)),b=Math.round(l?Math.max(0,l.stats.attackRange):Math.max(0,f.attackRange)),v=Math.round(l?Math.max(0,l.stats.movementRange):Math.max(0,f.movementRange)),S=l?.stats.defense??f.defense??0,E=Math.round(Math.max(0,S)),T=l?l.getShield():f.shield??s.shield,_=Math.round(Math.max(0,T)),R=Math.max(0,Math.round(s.upkeep)),U=m<=0?"downed":u?"engaged":"reserve",B=Kv(s),V=s.items.map(ne=>({...ne})),X=s.modifiers.map(ne=>({...ne})),$=lr.map(ne=>{const Y=Go(ne),q=s.equipment[ne],C=q?{id:q.id,name:q.name,description:q.description,icon:q.icon,rarity:q.rarity,quantity:q.quantity,slot:ne}:null,J=q?K_(q.modifiers,q.quantity):null;return{id:ne,label:Y.label,description:Y.description,maxStacks:Y.maxStacks,item:C,modifiers:J}}),W={health:Math.round(Math.max(0,h.health)),maxHealth:Math.round(Math.max(1,h.health)),attackDamage:Math.round(Math.max(0,h.attackDamage)),attackRange:Math.round(Math.max(0,h.attackRange)),movementRange:Math.round(Math.max(0,h.movementRange)),defense:typeof h.defense=="number"&&h.defense>0?Math.round(h.defense):void 0,shield:typeof h.shield=="number"&&h.shield>0?Math.round(h.shield):void 0};return{id:s.id,name:s.name,upkeep:R,status:U,selected:!!s.selected,traits:[...s.traits],stats:{health:m,maxHealth:p,attackDamage:g,attackRange:b,movementRange:v,defense:E>0?E:void 0,shield:_>0?_:void 0},baseStats:W,progression:B,equipment:$,items:V,modifiers:X}});return a.sort((s,r)=>{const l=t[s.status]-t[r.status];return l!==0?l:s.name.localeCompare(r.name,"en")}),a}function Q_(){return je.length===0?null:je.find(t=>t.selected)??je.find(t=>t.hp>0)??je[0]}function K_(t,a){const s=Math.max(1,Math.round(a)),r={};return typeof t.health=="number"&&(r.health=t.health*s),typeof t.attackDamage=="number"&&(r.attackDamage=t.attackDamage*s),typeof t.attackRange=="number"&&(r.attackRange=t.attackRange*s),typeof t.movementRange=="number"&&(r.movementRange=t.movementRange*s),typeof t.defense=="number"&&(r.defense=t.defense*s),typeof t.shield=="number"&&(r.shield=t.shield*s),r}function P_(){const t=_u(),a=Q_();let s=null;return a&&(s={id:a.id,name:a.name||"Saunoja",traits:[...a.traits],upkeep:Math.max(0,Math.round(a.upkeep)),progression:Kv(a)}),{count:t,card:s}}function Fo(t){const a=X_();Ua=a,Tt&&Tt.renderRoster(a)}function Ft(){const t=P_();Tt?(Tt.updateSummary(t),Wi=null):Wi=t,Fo()}function Z_(t){const{overlay:a,resourceBar:s}=t,r=fr(a),{regions:l}=r,u=document.createElement("div");u.className="pointer-events-none absolute inset-0 grid place-items-center bg-[radial-gradient(circle_at_top,rgba(18,28,45,0.92),rgba(6,10,18,0.94))] p-[clamp(1.5rem,4vw,3.25rem)] z-overlay";const f=document.createElement("section");f.className="pointer-events-auto relative grid w-full max-w-[min(640px,90vw)] gap-4 overflow-hidden rounded-[28px] border border-[rgba(128,168,236,0.28)] bg-[linear-gradient(145deg,rgba(31,46,74,0.95),rgba(14,20,33,0.95))] p-[clamp(1.75rem,4vw,2.5rem)] text-slate-100 shadow-[0_40px_90px_rgba(10,14,28,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)]",f.setAttribute("aria-live","polite"),f.setAttribute("role","status");const h=document.createElement("h1");h.className="m-0 text-[clamp(1.6rem,3vw,2.1rem)] font-semibold uppercase tracking-[0.04em]",h.textContent="Experimental HUD Enabled",f.appendChild(h);const m=document.createElement("p");m.className="m-0 text-base leading-relaxed text-slate-100/90",m.textContent="The React/Tailwind interface is bootstrapped for this session. Gameplay systems continue to run, and classic HUD elements are paused while the new shell is under construction.",f.appendChild(m);const p=document.createElement("p");p.id="ui-v2-return-hint",p.className="m-0 text-sm leading-relaxed text-slate-200/75",p.textContent="Prefer the original layout? Use the control below to return to the classic HUD instantly.",f.appendChild(p);const g=document.createElement("div");g.className="pointer-events-auto mt-3 flex flex-col gap-2 rounded-[20px] border border-[rgba(128,168,236,0.28)] bg-[linear-gradient(145deg,rgba(18,28,45,0.62),rgba(12,18,31,0.72))] p-4 shadow-[0_18px_40px_rgba(6,10,20,0.55),_inset_0_1px_0_rgba(255,255,255,0.06)] backdrop-blur-[2px]";const b=document.createElement("span");b.id="ui-v2-return-label",b.className="text-[0.75rem] font-semibold uppercase tracking-[0.18em] text-slate-100/75",b.textContent="Classic HUD",g.appendChild(b);const v=document.createElement("button");v.type="button",v.dataset.testid="return-to-classic-hud",v.dataset.state="idle",v.className="inline-flex min-h-[2.75rem] items-center justify-center rounded-full border border-[rgba(132,172,236,0.45)] bg-[linear-gradient(135deg,rgba(66,121,206,0.92),rgba(40,78,142,0.92))] px-6 text-sm font-semibold uppercase tracking-[0.14em] text-white shadow-[0_16px_36px_rgba(7,12,22,0.65),_inset_0_1px_0_rgba(255,255,255,0.16)] transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-300/90 hover:brightness-110 active:scale-[0.99] disabled:cursor-not-allowed disabled:opacity-70",v.textContent="Return to Classic HUD",v.setAttribute("aria-describedby",`${p.id} ${b.id}`),v.setAttribute("aria-label","Return to the classic HUD");const S=async _=>{if(_.preventDefault(),!(!t.onReturnToClassicHud||v.disabled)){v.disabled=!0,v.dataset.state="pending",v.setAttribute("aria-disabled","true");try{const R=t.onReturnToClassicHud();R&&typeof R.then=="function"&&await R,v.dataset.state="complete"}catch(R){console.error("Failed to restore the classic HUD from the experimental overlay.",R),v.disabled=!1,v.dataset.state="idle",v.removeAttribute("aria-disabled")}}};v.addEventListener("click",S),g.appendChild(v),f.appendChild(g);const E=document.createElement("div");E.className="pointer-events-none absolute -left-[30%] -top-[40%] h-[420px] w-[420px] bg-[radial-gradient(circle,rgba(90,164,255,0.35),rgba(90,164,255,0))] blur-[0.5px]",f.appendChild(E);const T=document.createElement("div");return T.className="mt-2 rounded-[18px] border border-[rgba(128,168,236,0.2)] bg-[rgba(10,16,26,0.55)] p-4 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]",T.appendChild(s),f.appendChild(T),u.appendChild(f),l.content.appendChild(u),{destroy(){v.removeEventListener("click",S),T.contains(s)&&a.prepend(s),u.remove()}}}function b1(t){if(!t)return{showLoader:()=>({update:()=>{},clear:()=>{},dispose:()=>{}}),showBanner:()=>null,removeTransientUI:()=>{}};const a=()=>{let f=t.querySelector(".hud-banner-stack");return f||(f=document.createElement("div"),f.className="hud-banner-stack",t.append(f)),f},s=(f,h,m)=>{let p=!1;const g=()=>{p||(p=!0,f.removeEventListener("transitionend",g),m())};f.addEventListener("transitionend",g),requestAnimationFrame(()=>{f.classList.add(h)}),window.setTimeout(g,400)};return{showLoader:(f="Heating the sauna stones")=>{const h=document.createElement("div");h.className="hud-loader",h.setAttribute("role","status"),h.setAttribute("aria-live","polite");const m=document.createElement("div");m.className="hud-loader__card";const p=document.createElement("div");p.className="hud-loader__spinner",p.setAttribute("aria-hidden","true");const g=document.createElement("p");g.className="hud-loader__message",g.textContent=f,m.append(p,g),h.append(m),t.append(h);let b=!1;return{update(v){g.textContent=v},clear(){b||s(h,"hud-loader--hidden",()=>{b=!0,h.remove()})},dispose(){b||(b=!0,h.remove())}}},showBanner:(f,h)=>{const m=a(),p=document.createElement("section");p.className=`hud-banner hud-banner--${f}`,p.setAttribute("role",f==="error"?"alert":"status"),p.setAttribute("aria-live",f==="error"?"assertive":"polite");const g=document.createElement("header");g.className="hud-banner__header";const b=document.createElement("p");b.className="hud-banner__title",b.textContent=h.title??(f==="error"?"Attention required":f==="warning"?"Heads up":"Status update"),g.append(b);const v=document.createElement("ul");v.className="hud-banner__list";for(const _ of h.messages){const R=document.createElement("li");R.textContent=_,v.append(R)}if(p.append(g),h.messages.length&&p.append(v),h.actions?.length){const _=document.createElement("div");_.className="hud-banner__actions";for(const R of h.actions){const U=document.createElement("button");U.type="button",U.className=R.variant==="secondary"?"hud-banner__button hud-banner__button--secondary":"hud-banner__button",U.textContent=R.label,U.addEventListener("click",()=>{R.onClick()}),_.append(U)}p.append(_)}let S,E=!1;const T=()=>{E||(E=!0,S&&window.clearTimeout(S),s(p,"hud-banner--hide",()=>{p.remove(),m.hasChildNodes()||m.remove()}))};if(h.dismissible!==!1){const _=document.createElement("button");_.type="button",_.className="hud-banner__close",_.setAttribute("aria-label","Dismiss notification"),_.textContent="",_.addEventListener("click",()=>{T()}),g.append(_)}return m.append(p),h.autoCloseMs&&h.autoCloseMs>0&&(S=window.setTimeout(()=>T(),h.autoCloseMs)),{element:p,dismiss:T}},removeTransientUI:()=>{t.querySelectorAll(".hud-loader").forEach(f=>{f.remove()}),t.querySelectorAll(".hud-banner-stack").forEach(f=>{f.remove()})}}}async function J_(t){const a=Object.entries(t),s=await Promise.allSettled(a.map(([f,h])=>h.load().then(m=>({key:f,descriptor:h,value:m})))),r={},l=[],u=[];return s.forEach((f,h)=>{const[m,p]=a[h],g=p.label??String(m);if(f.status==="fulfilled"){const{value:v}=f.value;if(r[m]=v.value,v.warnings?.length)for(const S of v.warnings)l.push(g?`${g}: ${S}`:S);if(v.errors?.length)for(const S of v.errors)u.push(g?`${g}: ${S}`:S);return}const b=W_(f.reason);u.push(g?`${g}: ${b}`:b)}),{resources:r,warnings:l,errors:u}}function W_(t){if(t instanceof Error)return t.message;if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return String(t)}}const eN="Heating the sauna stones",tN="Polishing sauna ambience";function nN(t){if(t instanceof Error&&t.message)return t.message;if(typeof t=="string"&&t.trim().length>0)return t;try{return JSON.stringify(t)}catch{return String(t)}}function aN(t){const a=new Set,s=f=>{a.forEach(h=>h(f))},r=t.formatError??nN;return{run:async f=>{s({type:"status",phase:"start",message:eN});try{const{resources:h,warnings:m,errors:p}=await J_({assets:{label:"Core assets",load:async()=>{const b=await t.loadAssets(t.assetPaths);return{value:b.assets,errors:b.failures}}},saunojaIcon:{label:"Saunoja icon",load:async()=>{try{return await t.preloadSaunojaIcon(),{value:!0}}catch(b){return{value:!1,warnings:[`Unable to preload Saunoja icon (${r(b)})`]}}}}});if(t.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"status",phase:"progress",message:tN});const g=h.assets;if(!g){const b=p.length?[...p]:["Critical assets were unavailable. Please refresh to try again."];s({type:"fatal",messages:b});return}if(p.length&&s({type:"errors",errors:p}),m.length&&s({type:"warnings",warnings:m}),t.setAssets(g),t.shouldAbort?.(f)){s({type:"cancelled"});return}t.startGame(),s({type:"ready",assets:g,warnings:m,errors:p})}catch(h){if(t.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"failure",error:h,message:r(h)})}},subscribe:f=>(a.add(f),()=>{a.delete(f)})}}const iN="grabbing";function sN(t,a){const s=a.dragCursor??iN;let r=!1,l=null,u=0,f=0,h=null;const m=S=>{S.pointerType!=="mouse"||S.button!==0||(r=!0,l=S.pointerId,u=S.clientX,f=S.clientY,h=t.style.cursor??"",t.setPointerCapture?.(S.pointerId),t.style.cursor=s,a.onPanStart?.(S))},p=S=>{if(!r||l!==S.pointerId)return;const E=S.clientX-u,T=S.clientY-f;u=S.clientX,f=S.clientY,a.onPan(E,T,S)},g=S=>{!r||l!==S.pointerId||(r=!1,l=null,t.releasePointerCapture?.(S.pointerId),t.style.cursor=h??"",a.onPanEnd?.(S))},b=S=>{g(S)},v=S=>{g(S)};return t.addEventListener("pointerdown",m),t.addEventListener("pointermove",p),t.addEventListener("pointerup",b),t.addEventListener("pointercancel",v),t.addEventListener("pointerleave",v),()=>{t.removeEventListener("pointerdown",m),t.removeEventListener("pointermove",p),t.removeEventListener("pointerup",b),t.removeEventListener("pointercancel",v),t.removeEventListener("pointerleave",v),r&&l!==null&&t.releasePointerCapture?.(l),t.style.cursor=h??""}}const rN=10,oN=250;function $i(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function lN(t,a){const s=a.tapMaxMovement??rN,r=a.tapMaxDuration??oN;let l=null;const u=b=>{if(b.touches.length===1){const v=b.touches[0];l={mode:"pan",lastX:v.clientX,lastY:v.clientY,startX:v.clientX,startY:v.clientY,startTime:$i(),moved:!1};return}if(b.touches.length>=2){const[v,S]=[b.touches[0],b.touches[1]];l={mode:"pinch",lastCenterX:(v.clientX+S.clientX)/2,lastCenterY:(v.clientY+S.clientY)/2,lastDistance:Math.hypot(v.clientX-S.clientX,v.clientY-S.clientY),startTime:$i(),moved:!1}}},f=(b,v)=>{if(!l||l.mode!=="pan")return;const S=b.clientX-l.lastX,E=b.clientY-l.lastY;!l.moved&&Math.hypot(S,E)>1&&(l.moved=!0),l.lastX=b.clientX,l.lastY=b.clientY,a.onPan(S,E,v)},h=(b,v,S)=>{const E=(b.clientX+v.clientX)/2,T=(b.clientY+v.clientY)/2,_=Math.hypot(b.clientX-v.clientX,b.clientY-v.clientY);let R=1,U=0,B=0;l&&l.mode==="pinch"?(R=_/l.lastDistance,U=E-l.lastCenterX,B=T-l.lastCenterY):l={mode:"pinch",lastCenterX:E,lastCenterY:T,lastDistance:_,startTime:$i(),moved:!1},!(!l||l.mode!=="pinch")&&(l.lastCenterX=E,l.lastCenterY=T,l.lastDistance=_,l.moved=!0,a.onPinch({centerX:E,centerY:T,scale:R,deltaCenterX:U,deltaCenterY:B},S))},m=b=>{if(!l||b.touches.length===0)return;if(b.preventDefault(),b.touches.length===1){const E=b.touches[0];l.mode!=="pan"&&(l={mode:"pan",lastX:E.clientX,lastY:E.clientY,startX:E.clientX,startY:E.clientY,startTime:$i(),moved:!0}),f(E,b);return}const[v,S]=[b.touches[0],b.touches[1]];h(v,S,b)},p=()=>!l||l.mode!=="pan"||Math.hypot(l.lastX-l.startX,l.lastY-l.startY)>s?!1:$i()-l.startTime<=r,g=b=>{if(l){if(b.touches.length===0){l.mode==="pan"&&a.onTap&&p()&&a.onTap({x:l.startX,y:l.startY},b),l=null;return}if(b.touches.length===1){const v=b.touches[0];l={mode:"pan",lastX:v.clientX,lastY:v.clientY,startX:v.clientX,startY:v.clientY,startTime:$i(),moved:!0};return}if(b.touches.length>=2){const[v,S]=[b.touches[0],b.touches[1]];l={mode:"pinch",lastCenterX:(v.clientX+S.clientX)/2,lastCenterY:(v.clientY+S.clientY)/2,lastDistance:Math.hypot(v.clientX-S.clientX,v.clientY-S.clientY),startTime:$i(),moved:!0}}}};return t.addEventListener("touchstart",u,{passive:!1}),t.addEventListener("touchmove",m,{passive:!1}),t.addEventListener("touchend",g),t.addEventListener("touchcancel",g),()=>{t.removeEventListener("touchstart",u),t.removeEventListener("touchmove",m),t.removeEventListener("touchend",g),t.removeEventListener("touchcancel",g),l=null}}const cN=.5,uN=3.5;function em(t,a,s,r,l){const u=t.getBoundingClientRect(),f=a-u.left,h=s-u.top,m=u.width/2,p=u.height/2;return{x:l.x+(f-m)/r,y:l.y+(h-p)/r}}function dN(t){return Math.min(uN,Math.max(cN,t))}function v1(t,a,s,r=xe.zoom,l=xe){return em(t,a,s,r,l)}function S1(t,a,s,r){const l=dN(r);if(l===xe.zoom)return;const u={x:xe.x,y:xe.y},f=em(t,a,s,xe.zoom,u),h=em(t,a,s,l,u);xe.x+=f.x-h.x,xe.y+=f.y-h.y,xe.zoom=l,It()}function Sh(t,a){t===0&&a===0||(xe.x-=t/xe.zoom,xe.y-=a/xe.zoom,It())}function fN(t){const a=window.devicePixelRatio||1,s=Math.max(window.innerWidth,1),r=Math.max(window.innerHeight,1);t.style.width=`${s}px`,t.style.height=`${r}px`,t.width=Math.round(s*a),t.height=Math.round(r*a);const l=t.getContext("2d");l&&l.setTransform(1,0,0,1,0,0),It()}const hN=.0015,tm=[];let Vm=0,zn=null,Nu=b1(null),kt=null,rr="classic",qo=null,fu=null,hu=null;function mN(){if(typeof document>"u")return;const t=document.querySelector("[data-build-commit]");if(!t)return;const a="05e3a68".trim(),s=a.length>0&&a!=="unknown",r=s?`#${a}`:"DEV BUILD";t.textContent=r,t.dataset.state=s?"commit":"dev";const l=t.closest("#build-id");if(l){const u=s?`Build commit ${a}`:"Development build";l.setAttribute("aria-label",u),l.title=s?`Autobattles build ${a}`:"Unversioned development build",l.dataset.buildState=s?"release":"development"}}mN();function Oa(t){tm.push(t)}function pN(){for(;tm.length;){const t=tm.pop();try{t?.()}catch(a){console.error("Error during cleanup",a)}}}function gN(t){Oa(()=>t.dispose())}function kc(t,a){const s=Nu.showBanner(t,a);s&&Oa(()=>s.dismiss())}function yN(t){switch(t.type){case"status":if(t.phase==="start"){kt?.dispose();const a=Nu.showLoader(t.message);kt=a,gN(a)}else kt&&(kt.update(t.message),kt.clear(),kt=null);break;case"ready":kt?.clear(),kt=null;break;case"warnings":t.warnings.length&&(console.warn("Resource loader warnings",t.warnings),kc("warning",{title:"Heads up",messages:t.warnings,autoCloseMs:12e3}));break;case"errors":t.errors.length&&(console.error("Resource loader errors",t.errors),kc("error",{title:"Some resources failed to load",messages:t.errors,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]}));break;case"fatal":console.error("Critical assets failed to load",t.messages),kt?.clear(),kt=null,kc("error",{title:"Unable to start the sauna battle",messages:t.messages,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}],dismissible:!1});break;case"failure":console.error("Failed to initialize resources",t.error),kt?.clear(),kt=null,kc("error",{title:"Failed to initialize",messages:[t.message],actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]});break;case"cancelled":kt?.dispose(),kt=null;break}}const M1=aN({assetPaths:E5,loadAssets:LM,preloadSaunojaIcon:Ev,setAssets:x5,startGame:$_,shouldAbort:t=>t!==Vm});M1.subscribe(yN);function i2(t){if(!zn)return;t.preventDefault();const a=Math.exp(-t.deltaY*hN),s=xe.zoom*a;S1(zn,t.clientX,t.clientY,s)}function s2(t){if(!zn)return;const a=v1(zn,t.clientX,t.clientY);p1(a)}function bN(t){t.addEventListener("click",s2),Oa(()=>t.removeEventListener("click",s2)),t.addEventListener("wheel",i2,{passive:!1}),Oa(()=>t.removeEventListener("wheel",i2));const a=sN(t,{onPan:(r,l)=>{Sh(r,l)},dragCursor:"grabbing"});Oa(a);const s=lN(t,{onPan:(r,l)=>{Sh(r,l)},onPinch:({centerX:r,centerY:l,scale:u,deltaCenterX:f,deltaCenterY:h})=>{S1(t,r,l,xe.zoom*u),Sh(f,h)},onTap:r=>{const l=v1(t,r.x,r.y);p1(l)}});Oa(s)}function vN(){if(rr==="v2"){if(!zn||!fu||!hu)throw new Error("Unable to restore the classic HUD because shell references are missing.");c1(!1),qo?.destroy(),qo=null,rr="classic",Wv(zn,fu,hu,{hudVariant:"classic"})}}function SN(){Vm+=1,pN(),qo?.destroy(),qo=null,kt?.dispose(),kt=null,zn&&(zn.style.cursor=""),zn=null,fu=null,hu=null,rr="classic",Nu.removeTransientUI(),Wh()}function MN(){const t=document.getElementById("game-canvas"),a=document.getElementById("resource-bar"),s=document.getElementById("ui-overlay");if(!t||!a||!s){console.error("Autobattles4xFinsauna shell is missing the required canvas, overlay, or resource bar elements.",{hasCanvas:!!t,hasResourceBar:!!a,hasOverlay:!!s});return}zn&&SN();const r=++Vm;rr=Ov().useUiV2?"v2":"classic",zn=t,fu=a,hu=s,Nu=b1(s);const u=d3();Oa(()=>u.dispose()),Wv(t,a,s,{hudVariant:rr}),rr==="v2"&&(qo=Z_({overlay:s,resourceBar:a,canvas:t,onReturnToClassicHud:vN})),bN(t);const f=()=>fN(t);window.addEventListener("resize",f),Oa(()=>window.removeEventListener("resize",f)),window.addEventListener("beforeunload",Wh),Oa(()=>window.removeEventListener("beforeunload",Wh)),f(),import.meta.vitest||M1.run(r)}function EN(){if(typeof document>"u")return;const t=()=>{document.removeEventListener("DOMContentLoaded",t),MN()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",t);return}t()}import.meta.vitest||EN();
