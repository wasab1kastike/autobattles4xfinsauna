(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function s(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(l){if(l.ep)return;l.ep=!0;const u=s(l);fetch(l.href,u)}})();class WS{listeners=new Map;on(a,s){const r=this.listeners.get(a)??[];r.push(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);if(!r)return;const l=r.indexOf(s);l!==-1&&(r.splice(l,1),r.length===0?this.listeners.delete(a):this.listeners.set(a,r))}emit(a,s){const r=this.listeners.get(a);if(r)for(const l of r)l(s)}}const ne=new WS;class Hh{type="farm";cost=50;beerPerTick=1}class I2{type="barracks";cost=100;trainingCapacity=1}const j2=Math.sqrt(3),G2=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function Wn(n,a){return{x:a*j2*(n.q+n.r/2),y:a*(3/2)*n.r}}function mo(n,a,s){const r=(j2/3*n-.3333333333333333*a)/s,l=2/3*a/s;return{q:r,r:l}}function eE(n,a,s){return tE(mo(n,a,s))}function kc(n){return G2.map(a=>({q:n.q+a.q,r:n.r+a.r}))}function Gs(n,a){const s=-n.q-n.r,r=-a.q-a.r;return Math.max(Math.abs(n.q-a.q),Math.abs(n.r-a.r),Math.abs(s-r))}function tE(n){let a=n.q,s=n.r,r=-a-s,l=Math.round(a),u=Math.round(r),f=Math.round(s);const h=Math.abs(l-a),m=Math.abs(u-r),p=Math.abs(f-s);return h>m&&h>p?l=-u-f:m>p?u=-l-f:f=-l-u,{q:l,r:f}}const Dc=new Set;let Ac=32;function nE(n){return`${n.q},${n.r}`}function uh(n,a){Ac=a,Dc.add(nE(n))}function aE(n){if(Dc.size===0)return{center:{x:0,y:0},zoom:1};const a=Ac*Math.sqrt(3),s=Ac*2,r=a/2,l=s/2;let u=1/0,f=1/0,h=-1/0,m=-1/0;for(const I of Dc){const[Y,Q]=I.split(",").map(Number),{x:ie,y:ee}=Wn({q:Y,r:Q},Ac),oe=ie-r,P=ee-l;u=Math.min(u,oe),f=Math.min(f,P),h=Math.max(h,oe+a),m=Math.max(m,P+s)}const p=h-u,g=m-f,b=96,v={x:u+p/2,y:f+g/2},E=Math.max(0,Math.min(n.safeRight??0,n.width)),C=Math.max(n.width-E,1)/(p+b*2),R=n.height/(g+b*2),N=Math.min(C,R);return{center:{x:N>0?v.x-E/(2*N):v.x,y:v.y},zoom:N}}const Ee={x:0,y:0,zoom:1};function iE(n,a=300){const s=Ee.x,r=Ee.y,l=Ee.zoom,u=typeof performance<"u"?performance.now():Date.now(),f=h=>{const m=Math.min((h-u)/a,1);Ee.x=s+(n.center.x-s)*m,Ee.y=r+(n.center.y-r)*m,Ee.zoom=l+(n.zoom-l)*m,m<1&&(typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),16))};typeof requestAnimationFrame<"u"?requestAnimationFrame(f):setTimeout(()=>f(typeof performance<"u"?performance.now():Date.now()),0)}function sE(){Dc.clear()}async function rE(n){const a={},s={},r=[],l=Object.entries(n.images??{}).map(([f,h])=>new Promise(m=>{const p=new Image;p.onload=()=>{a[f]=p,m()},p.onerror=()=>{const g=`Failed to load image: ${h}`;console.error(g),r.push(g),m()},p.src=h})),u=Object.entries(n.sounds??{}).map(([f,h])=>new Promise(m=>{const p=new Audio;p.oncanplaythrough=()=>{s[f]=p,m()},p.onerror=()=>{const g=`Failed to load sound: ${h}`;console.error(g),r.push(g),m()},p.src=h,p.load()}));return await Promise.all([...l,...u]),{assets:{images:a,sounds:s},failures:r}}function Ih(n){if(typeof globalThis.localStorage>"u")return;const a=globalThis.localStorage.getItem(n);if(a)try{return JSON.parse(a)}catch(s){console.warn(`Failed to parse data for "${n}", clearing`,s),globalThis.localStorage.removeItem(n);return}}var se=(n=>(n.SAUNA_BEER="sauna-beer",n.SAUNAKUNNIA="saunakunnia",n.SISU="sisu",n))(se||{});const nc={"sauna-beer":1,saunakunnia:0,sisu:0},F2="/assets/sauna-beer-CgafwOhX.svg",Y2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eResource%20Icon%3c/title%3e%3cdesc%20id='desc'%3eA%20luminous%20crest%20symbolising%20generic%20resources.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='resource-bg'%20cx='50%25'%20cy='50%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='resource-core'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2338bdf8'%20/%3e%3c/linearGradient%3e%3cfilter%20id='resource-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='6'%20flood-color='%2338bdf8'%20flood-opacity='0.45'%20/%3e%3c/filter%3e%3c/defs%3e%3cg%20filter='url(%23resource-glow)'%3e%3ccircle%20cx='32'%20cy='32'%20r='22'%20fill='%230f172a'%20stroke='url(%23resource-bg)'%20stroke-width='4'%20/%3e%3cpath%20d='M32%2016l-12%2014%2012%2022%2012-22z'%20fill='url(%23resource-core)'%20stroke='%23f8fafc'%20stroke-width='2'%20/%3e%3cpath%20d='M20%2030l-4%208%2016%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M44%2030l4%208-16%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/g%3e%3c/svg%3e",$2="/assets/saunoja-roster-Bfn4ZKxh.svg",Bt={APPLIED:"policy:applied",REJECTED:"policy:rejected"},V2=[{id:"eco",name:"Evergreen Eco Mandate",description:"Increase passive sauna beer brewing by one bottle each production tick.",cost:15,resource:se.SAUNAKUNNIA,prerequisites:[],visuals:{icon:Y2,gradient:"linear-gradient(135deg, rgba(66, 240, 155, 0.9), rgba(13, 114, 234, 0.85))",accentColor:"#34d399",badges:["Economy","Sustainability"],flair:"Green-lit by the council of whisked sauna masters."},effects:[{event:Bt.APPLIED,once:!0,invoke:({state:n})=>{n.modifyPassiveGeneration(se.SAUNA_BEER,1)}}],spotlight:"Sustainably expand your brewing line with solar-heated mash tuns."},{id:"temperance",name:"Aurora Temperance Treaty",description:"Boost night shift work speed by 5% once the eco initiative is live.",cost:25,resource:se.SAUNAKUNNIA,prerequisites:[{description:"Enact the Evergreen Eco Mandate.",isSatisfied:n=>n.hasPolicy("eco")},{description:"Stockpile at least 30 Sauna Beer bottles to brief the midnight crews.",isSatisfied:n=>n.getResource(se.SAUNA_BEER)>=30}],visuals:{icon:$2,gradient:"linear-gradient(140deg, rgba(46, 51, 227, 0.9), rgba(118, 75, 162, 0.85))",accentColor:"#6366f1",badges:["Discipline","Night Ops"],flair:"Whispers of aurora spirits keep the crew laser-focused after dusk."},effects:[{event:Bt.APPLIED,once:!0,invoke:({state:n})=>{n.nightWorkSpeedMultiplier=Number((n.nightWorkSpeedMultiplier*1.05).toFixed(4))}}],spotlight:"Glow-lit helmets and synchronized chants keep the late shift on tempo."},{id:"steam-diplomats",name:"Steam Diplomats Accord",description:"Import two additional sauna beer bottles per tick via gilded trade routes.",cost:35,resource:se.SAUNAKUNNIA,prerequisites:[{description:"Secure the Aurora Temperance Treaty for your envoys.",isSatisfied:n=>n.hasPolicy("temperance")},{description:"Hold a reserve of 50 Sauna Beer bottles to fund the embassy festivities.",isSatisfied:n=>n.getResource(se.SAUNA_BEER)>=50}],visuals:{icon:F2,gradient:"linear-gradient(150deg, rgba(255, 173, 94, 0.92), rgba(255, 99, 71, 0.85))",accentColor:"#fb923c",badges:["Diplomacy","Logistics"],flair:"Silver samovars arrive with diplomatic steam-born delights."},effects:[{event:Bt.APPLIED,once:!0,invoke:({state:n})=>{n.modifyPassiveGeneration(se.SAUNA_BEER,2)}}],spotlight:"Trade envoys pipe artisanal steam through every new supply line."}],X2=new Map;for(const n of V2)X2.set(n.id,n);function K2(){return V2}function Jg(n){return X2.get(n)}const Lc="progression:ngPlusState",jh=5,Q2=1831565813,Cc=Object.freeze({aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1}),Tc=Object.freeze({runSeed:0,ngPlusLevel:0,unlockSlots:0,enemyTuning:Cc});function wf(n,a,s,r){const l=Number(n);return Number.isFinite(l)?Math.min(s,Math.max(a,l)):r}function oE(n){return{aggressionMultiplier:wf(n?.aggressionMultiplier,.25,6,Cc.aggressionMultiplier),cadenceMultiplier:wf(n?.cadenceMultiplier,.25,4,Cc.cadenceMultiplier),strengthMultiplier:wf(n?.strengthMultiplier,.25,6,Cc.strengthMultiplier)}}function P2(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(n){return console.warn("Local storage unavailable for NG+ state",n),null}}function Wg(n,a,s){const r=Number.isFinite(n)?n:Number(n);if(!Number.isFinite(r))return a;const l=Math.trunc(r);return Math.min(s,Math.max(a,l))}function Z2(n){const a=Number.isFinite(n)?n:Number(n);return!Number.isFinite(a)||a===0?0:Math.trunc(Math.abs(a))}function J2(n=Math.random){let a=n();(!Number.isFinite(a)||a<=0||a>=1)&&(a=Math.random());const s=Math.floor(a*4294967295);return s===0?Q2:s}function Da(n={}){const a=Tc,s=Z2(n.runSeed??a.runSeed),r=Wg(n.ngPlusLevel??a.ngPlusLevel,0,Number.MAX_SAFE_INTEGER),l=Wg(n.unlockSlots??a.unlockSlots,0,jh),u=oE(n.enemyTuning??a.enemyTuning);return{runSeed:s,ngPlusLevel:r,unlockSlots:l,enemyTuning:u}}function Ta(n,a=Math.random){const s=Da(n);return s.runSeed!==0?s:Da({...s,runSeed:J2(a)})}function lE(n=Math.random){const a=P2();if(!a)return Ta(Tc,n);const s=a.getItem(Lc);if(!s)return Ta(Tc,n);try{const r=JSON.parse(s);return Ta(Da(r),n)}catch(r){return console.warn("Failed to parse NG+ state",r),Ta(Tc,n)}}function dh(n){const a=P2();if(!a)return;const s=Da(n);a.setItem(Lc,JSON.stringify(s))}function cE(n,a){const s=Da(n),r=typeof a.random=="function"?a.random:Math.random,l=J2(r);return Ta(Da({...s,runSeed:l}),r)}function Uc(n,a=0){let s=Z2(n)^(a|0);return s===0&&(s=Q2^(a|0)),()=>{s=s+1831565813|0;let r=Math.imul(s^s>>>15,1|s);return r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296}}function Af(n){return`${n.q},${n.r}`}const W2={farm:()=>new Hh,barracks:()=>new I2};function uE(n){return W2[n]?.()}const ey=Object.freeze({aggression:1,cadence:1,strength:1});function $s(n,a,s,r){const l=Number(n);return Number.isFinite(l)?Math.min(s,Math.max(a,l)):r}function ty(n,a){return{aggression:$s(a.aggression??n.aggression,.1,8,n.aggression),cadence:$s(a.cadence??n.cadence,.25,6,n.cadence),strength:$s(a.strength??n.strength,.25,12,n.strength)}}class dE{constructor(a,s="gameState"){this.tickInterval=a,this.storageKey=s}resources={[se.SAUNA_BEER]:0,[se.SAUNAKUNNIA]:0,[se.SISU]:0};passiveGeneration={...nc};lastSaved=Date.now();buildings={};buildingPlacements=new Map;policies=new Set;nightWorkSpeedMultiplier=1;enemyScaling={...ey};enemyCalmSecondsRemaining=0;ngPlus=Da();tick(){Object.keys(this.passiveGeneration).forEach(a=>{this.addResource(a,this.passiveGeneration[a])})}save(){this.lastSaved=Date.now();const a={};this.buildingPlacements.forEach((l,u)=>{a[u]=l.type});const s={resources:this.resources,lastSaved:this.lastSaved,buildings:this.buildings,buildingPlacements:a,policies:Array.from(this.policies),passiveGeneration:{...this.passiveGeneration},nightWorkSpeedMultiplier:this.nightWorkSpeedMultiplier,enemyScaling:{...this.enemyScaling},ngPlus:this.ngPlus},r=typeof localStorage<"u"&&localStorage?localStorage:void 0;if(!r){console.warn("GameState.save: localStorage is unavailable, skipping persistence.");return}try{r.setItem(this.storageKey,JSON.stringify(s))}catch(l){console.warn("GameState.save: Failed to persist state to localStorage.",l)}}load(a){const s=Ih(this.storageKey);if(!s)return this.lastSaved=Date.now(),!1;this.resources={...this.resources,...s.resources??{}},Object.keys(this.resources).forEach(m=>{Number.isFinite(this.resources[m])||(this.resources[m]=0)}),this.enemyScaling=ty(ey,s.enemyScaling??{}),this.enemyCalmSecondsRemaining=0;const r={};Object.entries(s.buildings??{}).forEach(([m,p])=>{W2[m]&&(r[m]=p)}),this.buildings=r,this.buildingPlacements.clear(),s.buildingPlacements&&Object.entries(s.buildingPlacements).forEach(([m,p])=>{const g=uE(p);if(!g)return;this.buildingPlacements.set(m,g);const[b,v]=m.split(",").map(Number);if(a){const E=a.ensureTile(b,v);E.placeBuilding(g.type),E.reveal(),uh({q:b,r:v},a.hexSize)}ne.emit("buildingPlaced",{building:g,coord:{q:b,r:v},state:this})}),this.lastSaved=s.lastSaved??Date.now();const l=s.ngPlus?Da(s.ngPlus):this.ngPlus;if(this.ngPlus=Ta(l),this.policies=new Set,this.passiveGeneration={...nc},this.nightWorkSpeedMultiplier=1,(Array.isArray(s.policies)?s.policies.filter(m=>typeof m=="string"):[]).forEach(m=>{const p=Jg(m);p&&(this.policies.add(p.id),ne.emit(Bt.APPLIED,{policy:p,state:this}))}),s.passiveGeneration){const m={...nc};Object.keys(nc).forEach(p=>{const g=s.passiveGeneration?.[p];typeof g=="number"&&Number.isFinite(g)&&(m[p]=g)}),this.passiveGeneration=m}typeof s.nightWorkSpeedMultiplier=="number"&&Number.isFinite(s.nightWorkSpeedMultiplier)&&(this.nightWorkSpeedMultiplier=s.nightWorkSpeedMultiplier);const f=Date.now()-this.lastSaved,h=Math.floor(f/this.tickInterval);return Object.keys(this.passiveGeneration).forEach(m=>{this.resources[m]+=h*this.passiveGeneration[m]}),!0}getResource(a){return this.resources[a]}canAfford(a,s=se.SAUNA_BEER){return this.resources[s]>=a}spendResource(a,s=se.SAUNA_BEER){return this.spend(a,s)}spend(a,s=se.SAUNA_BEER){return this.canAfford(a,s)?(this.resources[s]-=a,ne.emit("resourceChanged",{resource:s,amount:-a,total:this.resources[s]}),!0):!1}addResource(a,s){this.resources[a]+=s,ne.emit("resourceChanged",{resource:a,amount:s,total:this.resources[a]})}modifyPassiveGeneration(a,s){this.passiveGeneration[a]=(this.passiveGeneration[a]??0)+s}setEnemyScalingBase(a){return this.enemyScaling=ty(this.enemyScaling,a),{...this.enemyScaling}}applyEnemyScalingModifiers(a){const s={aggression:$s(this.enemyScaling.aggression*(a.aggression??1),.1,8,this.enemyScaling.aggression),cadence:$s(this.enemyScaling.cadence*(a.cadence??1),.25,6,this.enemyScaling.cadence),strength:$s(this.enemyScaling.strength*(a.strength??1),.25,12,this.enemyScaling.strength)};return this.enemyScaling=s,{...this.enemyScaling}}getEnemyScalingSnapshot(){return{...this.enemyScaling,calmSecondsRemaining:Math.max(0,this.enemyCalmSecondsRemaining)}}requestEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(this.enemyCalmSecondsRemaining,s),this.enemyCalmSecondsRemaining)}advanceEnemyCalm(a){const s=Number(a);return!Number.isFinite(s)||s<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(0,this.enemyCalmSecondsRemaining-s),this.enemyCalmSecondsRemaining)}clearEnemyCalm(){this.enemyCalmSecondsRemaining=0}construct(a,s,r=se.SAUNA_BEER){return this.spend(s,r)?(this.buildings[a]=(this.buildings[a]??0)+1,!0):!1}placeBuilding(a,s,r,l=se.SAUNA_BEER){const u=r.getTile(s.q,s.r);return!u||u.building||!this.construct(a.type,a.cost,l)?!1:(this.buildingPlacements.set(Af(s),a),u.placeBuilding(a.type),ne.emit("buildingPlaced",{building:a,coord:s,state:this}),!0)}getBuildingAt(a){return this.buildingPlacements.get(Af(a))}removeBuilding(a,s){const r=Af(a),l=this.buildingPlacements.get(r);return l?(this.buildingPlacements.delete(r),s.getTile(a.q,a.r)?.placeBuilding(null),this.buildings[l.type]!==void 0&&(this.buildings[l.type]-=1,this.buildings[l.type]<=0&&delete this.buildings[l.type]),ne.emit("buildingRemoved",{building:l,coord:a,state:this}),!0):!1}upgrade(a,s,r=se.SAUNA_BEER){return this.construct(`upgrade:${a}`,s,r)}applyPolicy(a){const s=Jg(a);if(!s){const u={policyId:a,state:this,reason:"unknown-policy"};return ne.emit(Bt.REJECTED,u),!1}if(this.hasPolicy(s.id)){const u={policyId:s.id,policy:s,state:this,reason:"already-applied"};return ne.emit(Bt.REJECTED,u),!1}const r=s.prerequisites.filter(u=>!u.isSatisfied(this));if(r.length>0){const u={policyId:s.id,policy:s,state:this,reason:"prerequisites-not-met",missingPrerequisites:r};return ne.emit(Bt.REJECTED,u),!1}if(!this.spend(s.cost,s.resource)){const u={policyId:s.id,policy:s,state:this,reason:"insufficient-resources"};return ne.emit(Bt.REJECTED,u),!1}this.policies.add(s.id);const l={policy:s,state:this};return ne.emit(Bt.APPLIED,l),!0}hasPolicy(a){return this.policies.has(a)}getNgPlusState(){return{...this.ngPlus}}setNgPlusState(a){const s=Da({...this.ngPlus,...a});return this.ngPlus=Ta(s),this.ngPlus}}class fE{constructor(a,s){this.baseInterval=a,this.onTick=s}timer=null;speed=1;lastTick=0;accumulator=0;start(){this.stop(),this.lastTick=Date.now();const a=this.baseInterval/this.speed;this.timer=setInterval(()=>{const s=Date.now(),r=s-this.lastTick;this.lastTick=s,this.onTick(r)},a)}stop(){this.timer!==null&&(clearInterval(this.timer),this.timer=null)}setSpeed(a){if(a<=0)throw new Error("Speed multiplier must be positive");this.speed=a,this.timer!==null&&this.start()}getSpeed(){return this.speed}getBaseInterval(){return this.baseInterval}tick(a){for(this.accumulator+=a*this.speed;this.accumulator>=this.baseInterval;)this.accumulator-=this.baseInterval,this.onTick(this.baseInterval)}}var vn=(n=>(n[n.Plains=0]="Plains",n[n.Forest=1]="Forest",n[n.Hills=2]="Hills",n[n.Lake=3]="Lake",n))(vn||{});function hE(n,a,s){let r=n*374761393+a*668265263+s*0x14057b7ef7678100;return r=(r^r>>13)*1274126177,r^=r>>16,(r>>>0)/4294967295}function mE(n,a,s=0){const r=hE(n,a,s);return r<.1?3:r<.3?1:r<.5?2:0}class pE{_terrain;_building;_isFogged;listeners=new Set;constructor(a=vn.Plains,s=null,r=!0){this._terrain=a,this._building=s,this._isFogged=r}get terrain(){return this._terrain}set terrain(a){this._terrain!==a&&(this._terrain=a,this.notify("terrain"))}get building(){return this._building}set building(a){this._building!==a&&(this._building=a,this.notify("building"))}get isFogged(){return this._isFogged}set isFogged(a){this._isFogged!==a&&(this._isFogged=a,this.notify("fog"))}reveal(){this.isFogged=!1}placeBuilding(a){this.building=a}setFogged(a){this.isFogged=a}addMutationListener(a){return this.listeners.add(a),()=>this.listeners.delete(a)}notify(a){for(const s of this.listeners)s(a)}}class gE{constructor(a=10,s=10,r=32,l=0){this.hexSize=r,this.seed=l,this.minQ=0,this.minR=0,this.maxQ=a-1,this.maxR=s-1}tiles=new Map;tileSubscriptions=new Map;changeListeners=new Set;minQ;maxQ;minR;maxR;get width(){return this.maxQ-this.minQ+1}get height(){return this.maxR-this.minR+1}key(a,s){return`${a},${s}`}addTileChangeListener(a){return this.changeListeners.add(a),()=>this.changeListeners.delete(a)}notifyTileChange(a,s,r){for(const l of this.changeListeners)l(a,s,r)}attachTileListener(a,s,r){const l=s.addMutationListener(u=>{this.notifyTileChange(r,s,u)});this.tileSubscriptions.set(a,l)}ensureTile(a,s){const r=this.key(a,s);let l=this.tiles.get(r);return l||(l=new pE(mE(a,s,this.seed)),this.tiles.set(r,l),this.minQ=Math.min(this.minQ,a),this.maxQ=Math.max(this.maxQ,a),this.minR=Math.min(this.minR,s),this.maxR=Math.max(this.maxR,s),this.attachTileListener(r,l,{q:a,r:s}),this.notifyTileChange({q:a,r:s},l,"created"),l.isFogged||uh({q:a,r:s},this.hexSize)),l}getTile(a,s){return this.tiles.get(this.key(a,s))}forEachTile(a){for(const[s,r]of this.tiles){const[l,u]=s.split(",").map(Number);a(r,{q:l,r:u})}}getNeighbors(a,s){return kc({q:a,r:s}).map(r=>this.ensureTile(r.q,r.r))}revealAround(a,s,r={}){const{autoFrame:l=!0}=r;for(let h=-s;h<=s;h++){const m=Math.max(-s,-h-s),p=Math.min(s,-h+s);for(let g=m;g<=p;g++){const b={q:a.q+h,r:a.r+g};this.ensureTile(b.q,b.r).reveal(),uh(b,this.hexSize)}}if(!l)return;const u=typeof window<"u"?(()=>{const h=Math.max(window.innerWidth,0),m=Math.max(window.innerHeight,0);let p=0;if(typeof document<"u"){const b=document.getElementById("right-panel");if(b){const v=b.getBoundingClientRect();if(v.width>0){const E=b.closest("#ui-overlay");if(E){const M=E.getBoundingClientRect(),C=window.getComputedStyle(E),R=Number.parseFloat(C.paddingRight||"0"),N=M.right-v.left,q=v.width+(Number.isFinite(R)?R:0);p=Math.max(0,Math.max(N,q))}else p=Math.max(0,v.width)}}}const g=Math.min(Math.max(p,0),h);return{width:h,height:m,safeRight:g}})():{width:0,height:0,safeRight:0},f=aE(u);iE(f,300)}}const Oc={TRIGGERED:"scheduler:eventTriggered",RESOLVED:"scheduler:eventResolved"},yE=new Map;function bE(){return globalThis.localStorage??null}function eo(n){return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}function eb(n){const a=globalThis.crypto;return a?.randomUUID?a.randomUUID():`${n}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function vE(n){const a={id:String(n.id??""),label:String(n.label??""),description:n.description?String(n.description):void 0,event:n.event?String(n.event):void 0,payload:n.payload,accent:n.accent??void 0};return a.id||(a.id=eb("choice")),a.label||(a.label="Choose"),a}function qc(n){const a={id:String(n.id??""),headline:String(n.headline??""),body:String(n.body??""),art:n.art?String(n.art):void 0,typography:n.typography,animation:n.animation,accentColor:n.accentColor?String(n.accentColor):void 0,acknowledgeText:n.acknowledgeText?String(n.acknowledgeText):void 0,choices:Array.isArray(n.choices)?n.choices.map(s=>vE(s)):void 0};return a.id||(a.id=eb("event")),a}function SE(n){return{content:qc(n.content),trigger:n.trigger.type==="time"?{type:"time",at:Number.isFinite(n.trigger.at)?n.trigger.at:0}:{type:"condition",conditionId:String(n.trigger.conditionId),params:n.trigger.params}}}function ny(n){return{content:qc(n.content),triggeredAt:Number.isFinite(n.triggeredAt)?n.triggeredAt:0}}const Cf=Object.freeze({clock:0,queue:[],active:[]});class EE{storageKey;eventBus;getStorage;state=eo(Cf);subscribers=new Set;constructor(a={}){this.storageKey=a.storageKey??"autobattles:event-scheduler",this.eventBus=a.eventBus??ne,this.getStorage=a.storageProvider??bE,this.load()}subscribe(a){return this.subscribers.add(a),a(this.getActiveEvents()),()=>{this.subscribers.delete(a)}}getActiveEvents(){return this.state.active.map(a=>({...eo(a.content),triggeredAt:a.triggeredAt}))}schedule(a){const s=qc(a.content);if(!s.headline||!s.body||this.containsEvent(s.id))return!1;const r=a.trigger.type==="condition"?{type:"condition",conditionId:String(a.trigger.conditionId),params:a.trigger.params}:{type:"time",at:this.resolveTriggerTime(a.trigger)};return this.state.queue.push({content:s,trigger:r}),this.sortQueue(),this.save(),!0}publish(a){const s=qc(a);this.containsEvent(s.id)||(this.state.queue=this.state.queue.filter(r=>r.content.id!==s.id),this.activateEvent({content:s,triggeredAt:this.state.clock}))}tick(a,s={}){if(!Number.isFinite(a)||a<=0)return;this.state.clock+=a;const r=[],l=[];for(const u of this.state.queue)this.shouldTrigger(u.trigger,s)?r.push(u):l.push(u);this.state.queue=l;for(const u of r)this.activateEvent({content:u.content,triggeredAt:this.state.clock});this.save()}resolve(a,s){const r=this.state.active.findIndex(h=>h.content.id===a);if(r===-1)return!1;const l=this.state.active[r],u=this.pickChoice(l.content,s),f=u?u.id:null;return this.state.active.splice(r,1),this.save(),this.notify(),this.eventBus.emit(Oc.RESOLVED,{eventId:a,choiceId:f,event:l.content}),u?.event&&this.eventBus.emit(u.event,{eventId:a,choiceId:f,payload:u.payload,event:l.content}),!0}reset(){this.state=eo(Cf),this.save(),this.notify()}activateEvent(a){const s=ny(a);this.state.active.push(s),this.save(),this.notify(),this.eventBus.emit(Oc.TRIGGERED,{event:{...eo(s.content),triggeredAt:s.triggeredAt}})}pickChoice(a,s){const r=a.choices??[];if(r.length!==0){if(s){const l=r.find(u=>u.id===s);if(l)return l}return r[0]}}shouldTrigger(a,s){if(a.type==="time")return this.state.clock>=a.at;const r=yE.get(a.conditionId);if(!r)return!1;try{return!!r(a.params,s)}catch(l){return console.warn("Scheduler condition evaluation failed",a.conditionId,l),!1}}resolveTriggerTime(a){if(Number.isFinite(a.at))return Number(a.at);const s=Number.isFinite(a.in)?Number(a.in):0;return Math.max(0,this.state.clock+s)}sortQueue(){this.state.queue.sort((a,s)=>{const r=a.trigger.type==="time"?a.trigger.at:Number.POSITIVE_INFINITY,l=s.trigger.type==="time"?s.trigger.at:Number.POSITIVE_INFINITY;return r-l})}containsEvent(a){return this.state.active.some(s=>s.content.id===a)||this.state.queue.some(s=>s.content.id===a)}notify(){const a=this.getActiveEvents();for(const s of this.subscribers)try{s(a)}catch(r){console.warn("Scheduler subscriber failed",r)}}load(){const a=Ih(this.storageKey);if(!a){this.state=eo(Cf);return}const s=Number(a.clock);this.state={clock:Number.isFinite(s)?s:0,queue:Array.isArray(a.queue)?a.queue.map(r=>SE(r)):[],active:Array.isArray(a.active)?a.active.map(r=>ny(r)):[]}}save(){const a=this.getStorage();if(a)try{a.setItem(this.storageKey,JSON.stringify({clock:this.state.clock,queue:this.state.queue,active:this.state.active}))}catch(s){console.warn("Scheduler persistence failed",s)}}}const bo=new EE;function ME(n,a){const s=new WeakSet,r=l=>{l.policy.id===n.id&&(a.once!==!1&&s.has(l.state)||(a.invoke(l),a.once!==!1&&s.add(l.state)))};ne.on(a.event,r)}for(const n of K2())for(const a of n.effects)ME(n,a);const xE="modulepreload",wE=function(n){return"/"+n},ay={},AE=function(a,s,r){let l=Promise.resolve();if(s&&s.length>0){let m=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),h=f?.nonce||f?.getAttribute("nonce");l=m(s.map(p=>{if(p=wE(p),p in ay)return;ay[p]=!0;const g=p.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const v=document.createElement("link");if(v.rel=g?"stylesheet":xE,g||(v.as="script"),v.crossOrigin="",v.href=p,h&&v.setAttribute("nonce",h),document.head.appendChild(v),g)return new Promise((E,M)=>{v.addEventListener("load",E),v.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${p}`)))})}))}function u(f){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=f,window.dispatchEvent(h),!h.defaultPrevented)throw f}return l.then(f=>{for(const h of f||[])h.status==="rejected"&&u(h.reason);return a().catch(u)})},CE=({building:n,coord:a,state:s})=>{n instanceof Hh?s.modifyPassiveGeneration(se.SAUNA_BEER,n.beerPerTick):n instanceof I2&&AE(async()=>{const{spawnUnit:r}=await Promise.resolve().then(()=>GM);return{spawnUnit:r}},void 0).then(({spawnUnit:r})=>{r(s,"soldier",`barracks-${a.q}-${a.r}`,a,"player")})},TE=({building:n,state:a})=>{n instanceof Hh&&a.modifyPassiveGeneration(se.SAUNA_BEER,-n.beerPerTick)};ne.on("buildingPlaced",CE);ne.on("buildingRemoved",TE);const Dn={master:{defaultVolume:.9,volumeKey:"audio.mixer.master.volume",muteKey:"audio.mixer.master.muted"},music:{defaultVolume:.65,volumeKey:"audio.mixer.music.volume",muteKey:"audio.mixer.music.muted"},sfx:{defaultVolume:1,volumeKey:"audio.mixer.sfx.volume",muteKey:"audio.mixer.sfx.muted"}},Je={master:{volume:Dn.master.defaultVolume,muted:!1},music:{volume:Dn.music.defaultVolume,muted:!1},sfx:{volume:Dn.sfx.defaultVolume,muted:!1}},Xn={};let Tn=null,fh=!1;const hh=new Set;function Gh(n,a){return Number.isFinite(n)?n<=0?0:n>=1?1:n:a}function su(){if(typeof localStorage>"u")return null;try{return localStorage}catch(n){return console.warn("Audio mixer storage unavailable",n),null}}function _E(n){const a=su();if(!a)return null;try{const s=a.getItem(Dn[n].volumeKey);if(s===null)return null;const r=Number.parseFloat(s);return Number.isFinite(r)?Gh(r,Dn[n].defaultVolume):null}catch(s){return console.warn("Failed to restore volume setting",n,s),null}}function RE(n){const a=su();if(!a)return null;try{const s=a.getItem(Dn[n].muteKey);return s===null?null:s==="true"}catch(s){return console.warn("Failed to restore mute setting",n,s),null}}for(const n of Object.keys(Dn)){const a=_E(n),s=RE(n);a!==null&&(Je[n].volume=Gh(a,Dn[n].defaultVolume)),s!==null&&(Je[n].muted=s)}function NE(n){const a=su();if(a)try{a.setItem(Dn[n].volumeKey,Je[n].volume.toFixed(3))}catch(s){console.warn("Failed to persist volume setting",n,s)}}function kE(n){const a=su();if(a)try{a.setItem(Dn[n].muteKey,Je[n].muted?"true":"false")}catch(s){console.warn("Failed to persist mute setting",n,s)}}function iy(){if(typeof window>"u"||!Tn||fh)return;const n=()=>{Tn?.resume().catch(()=>{})};window.addEventListener("pointerdown",n,{once:!0}),window.addEventListener("keydown",n,{once:!0}),fh=!0}function Fh(n){const a=Xn[n];if(!a)return;const{volume:s,muted:r}=Je[n],l=r?0:s;a.gain.value=l}function tb(n){if(!Xn.master){const a=n.createGain();a.gain.value=Je.master.muted?0:Je.master.volume,a.connect(n.destination),Xn.master=a}if(!Xn.music){const a=n.createGain();a.gain.value=Je.music.muted?0:Je.music.volume,a.connect(Xn.master),Xn.music=a}if(!Xn.sfx){const a=n.createGain();a.gain.value=Je.sfx.muted?0:Je.sfx.volume,a.connect(Xn.master),Xn.sfx=a}}function Yh(){if(Tn||typeof window>"u")return Tn;const n=window.AudioContext||window.webkitAudioContext;if(!n)return console.warn("Web Audio API not supported"),null;try{Tn=new n,tb(Tn),iy()}catch(a){return console.warn("Unable to create AudioContext",a),Tn=null,null}return Tn.state==="suspended"&&(fh=!1,iy()),Tn}function DE(){return Tn??Yh()}function Tf(n){const a=Je.master;if(n==="master")return a.muted?0:a.volume;const s=Je[n];return s.muted||a.muted?0:s.volume*a.volume}function $h(n){const a=DE();if(!a)return null;tb(a);const s=Xn[n];return s?(Fh(n),s):null}function ru(){return{channels:{master:{volume:Je.master.volume,muted:Je.master.muted,effectiveVolume:Tf("master")},music:{volume:Je.music.volume,muted:Je.music.muted,effectiveVolume:Tf("music")},sfx:{volume:Je.sfx.volume,muted:Je.sfx.muted,effectiveVolume:Tf("sfx")}},contextState:Tn?.state??"uninitialized"}}function nb(){const n=ru();for(const a of hh)a(n)}function Vh(n){return hh.add(n),()=>{hh.delete(n)}}function Xh(n,a){const s=Gh(a,Dn[n].defaultVolume);Je[n].volume!==s&&(Je[n].volume=s,NE(n),Fh(n),nb())}function Kh(n,a){Je[n].muted!==a&&(Je[n].muted=a,kE(n),Fh(n),nb())}function LE(n){Xh("master",n)}function UE(n){Xh("music",n)}function OE(n){Xh("sfx",n)}function qE(n){Kh("master",n)}function zE(n){Kh("music",n)}function BE(n){Kh("sfx",n)}function zc(n){return ru().channels[n]}const HE=48e3;function IE(n){let a=n>>>0;return()=>{a+=1831565813;let s=a;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}}function jE(n,a,s){const{attack:r,decay:l,sustain:u,release:f,sustainLevel:h}=n;if(r>0&&s<r)return s/r;if(l>0&&s<r+l){const m=(s-r)/l;return 1-(1-h)*m}if(s<a-f)return h;if(f>0&&s<a){const m=(s-(a-f))/f;return h*(1-m)}return 0}function GE(n,a,s){const r=n.phase??0,l=n.vibrato,u=n.tremolo,f=l?1+l.depth*Math.sin(2*Math.PI*l.speed*s):1,h=u?n.gain*(1-u.depth+u.depth*Math.sin(2*Math.PI*u.speed*s)):n.gain,m=a*n.ratio*f;return h*Math.sin(2*Math.PI*m*s+r)}function FE(n,a){return n.gain*(a()*2-1)}function YE(n,a=HE){const s=Math.max(1,Math.floor(n.duration*a)),r=new Float32Array(s),l=IE(n.seed);for(let u=0;u<s;u++){const f=u/a;let h=0;for(const p of n.layers)p.type==="sine"?h+=GE(p,n.baseFrequency,f):h+=FE(p,l);const m=jE(n.envelope,n.duration,f);r[u]=h*m}return r}const _f={attack:{variants:[{id:"attack-a",label:"Gentle Birch Strike",description:"Soft mallet transient with subtle shimmer.",duration:.9,baseFrequency:220,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:421,loudness:{lufs:-14.775,peakDb:-2.134,gain:.8684}},{id:"attack-b",label:"Rounded Pluck Echo",description:"A slightly brighter chime tuned above the root.",duration:.9,baseFrequency:232,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:947,loudness:{lufs:-14.758,peakDb:-2.101,gain:.8667}},{id:"attack-c",label:"High Drift Pluck",description:"Upper register tap with airy decay.",duration:.9,baseFrequency:244,envelope:{attack:.02,decay:.18,sustain:.55,release:.35,sustainLevel:.55},layers:[{type:"sine",ratio:1,gain:.42,vibrato:{speed:6,depth:.0015}},{type:"sine",ratio:1.997,gain:.28,vibrato:{speed:6,depth:.001}},{type:"sine",ratio:2.97,gain:.18,vibrato:{speed:7,depth:.001}}],seed:1337,loudness:{lufs:-14.731,peakDb:-2.076,gain:.8641}}]},death:{variants:[{id:"death-a",label:"Hollow Exhale",description:"Low cedar drum pulse with airy noise tail.",duration:1.15,baseFrequency:150,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:615,loudness:{lufs:-14.365,peakDb:-.218,gain:.8284}},{id:"death-b",label:"Soft Ember Fall",description:"Mid register thump with drifting undertone.",duration:1.15,baseFrequency:168,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:274,loudness:{lufs:-14.204,peakDb:-.185,gain:.8132}},{id:"death-c",label:"Warm Resolve",description:"Higher pitch breathy release with gentle rumble.",duration:1.15,baseFrequency:184,envelope:{attack:.03,decay:.3,sustain:.45,release:.5,sustainLevel:.45},layers:[{type:"sine",ratio:1,gain:.55,tremolo:{speed:.6,depth:.25}},{type:"sine",ratio:.5,gain:.33},{type:"sine",ratio:.25,gain:.25},{type:"noise",gain:.22}],seed:978,loudness:{lufs:-14.079,peakDb:-.16,gain:.8015}}]},sisu:{variants:[{id:"sisu-a",label:"Rising Steam",description:"Slow bloom of airy sine pads with hushed texture.",duration:1.9,baseFrequency:176,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1204,loudness:{lufs:-12.754,peakDb:-.501,gain:.6882}},{id:"sisu-b",label:"Glowing Drift",description:"Warmer harmonic swell with chorus shimmer.",duration:1.9,baseFrequency:188,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:1642,loudness:{lufs:-12.943,peakDb:-.271,gain:.7033}},{id:"sisu-c",label:"Morning Brilliance",description:"Bright tonic swell with shimmering overtones.",duration:1.9,baseFrequency:200,envelope:{attack:.4,decay:.45,sustain:.75,release:.7,sustainLevel:.75},layers:[{type:"sine",ratio:1,gain:.38,tremolo:{speed:.45,depth:.15}},{type:"sine",ratio:2.6,gain:.12},{type:"sine",ratio:.5,gain:.27},{type:"sine",ratio:.75,gain:.2,vibrato:{speed:.9,depth:.01}},{type:"noise",gain:.12}],seed:2019,loudness:{lufs:-12.888,peakDb:-.235,gain:.6989}}]}};function Rf(n){return{id:n.id,label:n.label,envelope:n.envelope,gain:n.loudness.gain,loader:a=>{const s=YE(n,a.sampleRate),r=a.createBuffer(1,s.length,a.sampleRate);return r.getChannelData(0).set(s),r}}}const $E={click:{variants:[{id:"ui-click-soft",label:"UI soft tap",envelope:{attack:0,decay:.05,sustain:0,release:.03,sustainLevel:0},loader:n=>XE(n)}],debounce:{windowMs:35,weight:.5,maxWeight:1.5},polyphony:6},spawn:{variants:[{id:"ui-spawn-chime",label:"Roster invite tone",envelope:{attack:0,decay:.2,sustain:.5,release:.2,sustainLevel:.5},loader:n=>KE(n)}],debounce:{windowMs:150,weight:.7,maxWeight:1.4},polyphony:3},error:{variants:[{id:"ui-error-tone",label:"Gentle warning tap",envelope:{attack:.01,decay:.2,sustain:.2,release:.2,sustainLevel:.2},loader:n=>QE(n)}],debounce:{windowMs:220,weight:1,maxWeight:1},polyphony:2},attack:{variants:_f.attack.variants.map(Rf),debounce:{windowMs:120,weight:.6,maxWeight:1.2},polyphony:3},death:{variants:_f.death.variants.map(Rf),debounce:{windowMs:360,weight:1,maxWeight:1.5},polyphony:3},sisu:{variants:_f.sisu.variants.map(Rf),debounce:{windowMs:900,weight:1,maxWeight:1},polyphony:1}};let ac=null;const sy=new Map,ic=new Map,Bc=new Map,Vs=new Map,po=new Map,ry=new Map,zt={node:null,destination:null,envelope:0,lastUpdate:0},to={attackSeconds:.04,releaseSeconds:.6,depth:.55,floor:.25},mh=new Set;function Qh(){const n=zc("master"),a=zc("sfx");return n.muted||a.muted}function VE(){const n=Qh();for(const a of mh)a(n)}function Ph(n,a,s){const r=Math.floor(n.sampleRate*a),l=n.createBuffer(1,r,n.sampleRate),u=l.getChannelData(0);for(let f=0;f<r;f++){const h=f/n.sampleRate;u[f]=s(h)}return l}function XE(n){return Ph(n,.05,a=>Math.sin(2*Math.PI*1e3*a)*Math.exp(-40*a))}function KE(n){return Ph(n,.2,a=>(Math.sin(2*Math.PI*440*a)+Math.sin(2*Math.PI*660*a))*.5*Math.exp(-6*a))}function QE(n){return Ph(n,.3,a=>Math.sin(2*Math.PI*110*a)*Math.exp(-8*a))}function oy(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function PE(n,a){return`${n}:${a}`}function ZE(n,a,s){const r=PE(n,a),l=sy.get(r);if(l)return Promise.resolve(l);const u=ic.get(r);if(u)return u;const f=Zh();if(!f)return Promise.reject(new Error("Audio context unavailable"));const h=Promise.resolve(s.loader(f)).then(m=>(sy.set(r,m),ic.delete(r),m)).catch(m=>{throw ic.delete(r),m});return ic.set(r,h),h}function ly(n){const a=n.polyphony;return!Number.isFinite(a)||!a||a<=0?Number.POSITIVE_INFINITY:a}function JE(n,a){const s=Bc.get(n);if(!s||s.length===0)return[];const r=[];for(const l of s)l.time>=a&&r.push(l);return Bc.set(n,r),r}function WE(n,a,s){const r=a.debounce;if(!r)return{blocked:!1,weight:0};const l=r.weight??1,u=r.windowMs,f=s-u,h=JE(n,f);let m=0;for(const p of h)m+=p.weight;return m+l>r.maxWeight?{blocked:!0}:{blocked:!1,weight:l}}function eM(n,a,s){if(s<=0)return;const r=Bc.get(n)??[];r.push({time:a,weight:s}),Bc.set(n,r)}function tM(n){const a=(Vs.get(n)??0)+1;Vs.set(n,a)}function nM(n){const a=Vs.get(n)??0;if(a<=1){Vs.delete(n);return}Vs.set(n,a-1)}function cy(n,a){if(!Number.isFinite(a))return!1;const s=po.get(n)?.size??0,r=Vs.get(n)??0;return s+r>=a}function aM(n,a){let s=po.get(n);s||(s=new Set,po.set(n,s)),s.add(a);let r=!1;const l=()=>{if(r)return;r=!0;const u=po.get(n);u?.delete(a),u&&u.size===0&&po.delete(n)};if(typeof a.addEventListener=="function")a.addEventListener("ended",()=>{l()},{once:!0});else{const u=a.onended;a.onended=()=>{try{u?.call(a)}finally{l()}}}return l}function iM(n,a){const s=zt.node;if(!s||s.context!==n){zt.node?.disconnect();const r=n.createGain();return r.gain.value=1,r.connect(a),zt.node=r,zt.destination=a,zt.envelope=0,zt.lastUpdate=n.currentTime,r}return zt.destination!==a&&(s.disconnect(),s.connect(a),zt.destination=a),s}function sM(n){const a=zt.node;if(!a)return;const s=n.currentTime,r=.6,l=.55,u=Math.max(0,s-zt.lastUpdate),f=Math.exp(-u/r);zt.envelope*=f,zt.envelope=Math.min(1,zt.envelope+l),zt.lastUpdate=s;const p=Math.max(.35,1-zt.envelope*.5),g=.02;a.gain.cancelScheduledValues(s),a.gain.setValueAtTime(a.gain.value,s),a.gain.linearRampToValueAtTime(p,s+g),a.gain.setTargetAtTime(1,s+g,r)}function rM(n){const a=$h("music");if(!a)return;const s=zc("master"),r=zc("music");if(s.muted||r.muted)return;const l=r.volume;if(l<=0)return;const u=n.currentTime,f=a.gain.value,h=l*(1-to.depth),m=l*to.floor,p=Math.min(f,Math.max(h,m));a.gain.cancelScheduledValues(u),a.gain.setValueAtTime(f,u),a.gain.linearRampToValueAtTime(p,u+to.attackSeconds),a.gain.setTargetAtTime(l,u+to.attackSeconds,to.releaseSeconds)}function ea(n){if(ph())return;const a=$E[n];if(!a)return;const s=a.variants;if(!s||s.length===0)return;let r=0,l=s[0];s.length>1&&(r=((ry.get(n)??Math.floor(Math.random()*s.length)-1)+1)%s.length,l=s[r],ry.set(n,r));const u=oy(),f=WE(n,a,u);if(f.blocked)return;const h=ly(a);if(cy(n,h))return;tM(n);let m=!1;const p=()=>{m||(nM(n),m=!0)};ZE(n,r,l).then(g=>{if(p(),ph())return;const b=Zh();if(!b)return;const v=$h("sfx");if(!v)return;const E=ly(a);if(cy(n,E))return;const M=b.createBufferSource();M.buffer=g;const C=l.gain;let R=M;if(typeof C=="number"&&C>0&&C!==1){const I=b.createGain();I.gain.value=C,M.connect(I),R=I}const N=n==="attack"?iM(b,v):v;R.connect(N);const q=aM(n,M);try{M.start(),n==="attack"&&sM(b),n==="sisu"&&rM(b);const I=oy();!f.blocked&&f.weight>0&&eM(n,I,f.weight)}catch(I){console.warn("Unable to start sound",I),q()}}).catch(g=>{p(),!(g instanceof Error&&g.message==="Audio context unavailable")&&console.warn("Failed to play sound",n,g)}).finally(()=>{p()})}function ph(){return Qh()}function oM(n){return mh.add(n),()=>{mh.delete(n)}}typeof document<"u"&&document.addEventListener("click",n=>{n.target instanceof HTMLButtonElement&&ea("click")});let uy=Qh();Vh(n=>{const a=n.channels.master.muted||n.channels.sfx.muted;a!==uy&&(uy=a,VE())});function Zh(){return ac||(ac=Yh(),ac)}Zh();const dy="__autobattlesAudioEvents__",fy=globalThis;fy[dy]||(ne.on("unitDamaged",n=>{!n||n.amount<=0||ea("attack")}),ne.on("unitDied",()=>{ea("death")}),ne.on("sisuBurstStart",()=>{ea("sisu")}),fy[dy]=!0);const lM=[{content:{id:"command-briefing",headline:"Command Briefing: Ember Shift",body:"Sauna Command uplinks a focused playbook for your opening salvo. Keep the roster nimble, channel the ember currents, and set the tone for this run.",art:"/assets/ui/saunoja-roster.svg",typography:"serif",animation:"aurora",accentColor:"#7bdff2",acknowledgeText:"Deploy the roster"},trigger:{type:"time",in:2}},{content:{id:"recon-telemetry",headline:"Recon Telemetry Uploaded",body:"Forward drones stitched together a glacial panorama of enemy routes. Prioritize rapid response teams while the snowpack is still undisturbed.",art:"/assets/ui/resource.svg",typography:"sans",animation:"pulse",accentColor:"#fbcfe8",acknowledgeText:"Queue countermeasures"},trigger:{type:"time",in:12}},{content:{id:"supply-courier",headline:"Sauna Courier Docked",body:"A lacquered supply skiff glides into the bay with artisan tonics and reinforced stave kits. Decide how to allocate the haul before the next assault.",art:"/assets/ui/sauna-beer.svg",typography:"serif",animation:"tilt",accentColor:"#fde68a",choices:[{id:"frontline",label:"Stage for the frontline",description:"Prep the vanguard with the premium kit as morale surges.",accent:"primary"},{id:"reserve",label:"Stock the reserves",description:"Archive the crate for a later wave when pressure spikes.",accent:"ghost"}]},trigger:{type:"time",in:24}}];function cM(n=bo){for(const a of lM)n.schedule(a)}cM();function uM(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function dM(n){const a={};if(!n)return a;for(const[s,r]of Object.entries(n))typeof r=="function"&&(a[s]=r);return a}class fM{constructor(a=ne){this.emitter=a}modifiers=new Map;hookIndex=new Map;listeners=new Map;add(a){if(typeof a.id!="string"||a.id.length===0)throw new Error("Modifier id must be a non-empty string");if((typeof a.duration!="number"||!Number.isFinite(a.duration))&&a.duration!==1/0)throw new Error("Modifier duration must be a positive number or Infinity");if(Number.isFinite(a.duration)&&a.duration<=0)throw new Error("Modifier duration must be greater than zero");const s=dM(a.hooks),r=uM();this.modifiers.has(a.id)&&this.remove(a.id,"replaced");const l={...a,hooks:s,remaining:a.duration,appliedAt:r};this.modifiers.set(l.id,l),this.indexHooks(l);const u={runtime:this,modifier:l};return a.onApply?.(u),this.emit("modifierAdded",{modifier:l}),this.emitter?.emit("modifierAdded",{modifier:l}),Number.isFinite(l.remaining)&&l.remaining<=0&&this.remove(l.id,"expired"),l}has(a){return this.modifiers.has(a)}list(){return Array.from(this.modifiers.values()).map(a=>({...a,hooks:{...a.hooks}}))}remove(a,s="manual"){const r=this.modifiers.get(a);if(!r)return!1;this.modifiers.delete(a),this.unindexHooks(r);const l={runtime:this,modifier:r,reason:s};return r.onExpire?.(l),s==="expired"&&(this.emit("modifierExpired",{modifier:r}),this.emitter?.emit("modifierExpired",{modifier:r})),this.emit("modifierRemoved",{modifier:r,reason:s}),this.emitter?.emit("modifierRemoved",{modifier:r,reason:s}),!0}advance(a){if(typeof a!="number"||a<=0)return;const s=[];for(const r of this.modifiers.values())Number.isFinite(r.remaining)&&(r.remaining=Math.max(0,r.remaining-a),r.remaining<=0&&s.push(r.id));for(const r of s)this.remove(r,"expired")}trigger(a,s){const r=this.hookIndex.get(a);if(!r||r.size===0)return;const l=Array.from(r);for(const u of l){const f=this.modifiers.get(u);if(!f){r.delete(u);continue}const h=f.hooks[a];if(!h){r.delete(u);continue}h(s,{runtime:this,modifier:f})}}clear(){const a=Array.from(this.modifiers.keys());for(const s of a)this.remove(s,"manual")}on(a,s){const r=this.listeners.get(a)??new Set;r.add(s),this.listeners.set(a,r)}off(a,s){const r=this.listeners.get(a);r&&(r.delete(s),r.size===0&&this.listeners.delete(a))}emit(a,s){const r=this.listeners.get(a);if(!(!r||r.size===0))for(const l of Array.from(r))l(s)}indexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s)??new Set;r.add(a.id),this.hookIndex.set(s,r)}}unindexHooks(a){for(const s of Object.keys(a.hooks)){const r=this.hookIndex.get(s);r&&(r.delete(a.id),r.size===0&&this.hookIndex.delete(s))}}}const ou=new fM,hM=n=>ou.add(n),mM=(n,a="manual")=>ou.remove(n,a),pM=n=>{ou.advance(n)},sc=(n,a)=>{ou.trigger(n,a)};class gM{constructor(a,s,r){this.owner=a,this.entries=s,this.log=r}runTick(a,s){for(const{definition:r,state:l}of this.entries){if(!r.onTick)continue;const u=r.onTick({owner:this.owner,state:l,self:a,opponent:s}),f=Fi(u?.shieldDamage??0);if(f>0){const m=Math.min(a.shield,f);m>0&&(a.shield-=m,this.log.tickShieldDamage+=m)}const h=Fi(u?.hpDamage??0);if(h>0){const m=Math.min(a.health,h);m>0&&(a.health-=m,this.log.tickHpDamage+=m)}}}grantShield(a,s){let r=0;for(const{definition:l,state:u}of this.entries){if(!l.onGrantShield)continue;const f=Fi(l.onGrantShield({owner:this.owner,state:u,self:a,opponent:s})??0);f>0&&(r+=f)}return r>0&&(a.shield+=r,this.log.shieldGranted+=r),r}consumeShield(a,s,r){let l=Fi(a);if(l<=0)return 0;let u=0;for(const{definition:f,state:h}of this.entries){if(!f.onConsumeShield||l<=0)continue;const m=Fi(f.onConsumeShield({owner:this.owner,state:h,self:s,opponent:r,amount:l})??0);if(m<=0)continue;const p=Math.min(l,m);u+=p,l-=p}return u>0&&(this.log.shieldConsumed+=u),u}applyHit(a,s,r){if(a<=0)return 0;let l=0;for(const{definition:h,state:m}of this.entries){if(!h.onHit)continue;const p=Fi(h.onHit({owner:this.owner,state:m,self:s,opponent:r,hpDamage:a})??0);p>0&&(l+=p)}if(l<=0)return 0;const u=Math.max(0,s.maxHealth-s.health);if(u<=0)return 0;const f=Math.min(u,l);return f>0&&(s.health+=f,this.log.lifesteal+=f),f}getShieldValue(){let a=0;for(const{definition:s,state:r}of this.entries){if(!s.onGrantShield||r.keyword!=="Shield")continue;const l=gh(r);if(l<=0)continue;const u=Math.max(0,Number.isFinite(r.stacks)?r.stacks:0);u<=0||(a+=u*l)}return a}}function yM(){return{attacker:my(),defender:my()}}function hy(n,a,s){const r=bM(n);if(r.length===0)return null;const l=[];for(const u of r){const f=ab.get(u.keyword);f&&l.push({state:u,definition:f})}return l.length===0?null:new gM(a,l,s)}const ab=new Map;function lu(n,a){ab.set(n,a)}function my(){return{tickHpDamage:0,tickShieldDamage:0,shieldGranted:0,shieldConsumed:0,lifesteal:0,keywordShieldRemaining:0}}function Fi(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function Js(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function ko(n){return typeof n!="number"||!Number.isFinite(n)?0:n>0?n:0}function bM(n){if(!n)return[];const a=[],s=n;if(typeof s[Symbol.iterator]=="function"){for(const r of s){const l=py(r);l&&a.push(l)}return a}if(typeof n=="object")for(const r of Object.values(n)){const l=py(r);l&&a.push(l)}return a}function py(n){if(!n||typeof n!="object")return null;const a=n;if(!Object.prototype.hasOwnProperty.call(a,"stacks"))return null;const s=vM(a.keyword);if(!s)return null;const r=a;return r.keyword=s,r.stacks=Js(r.stacks),Object.prototype.hasOwnProperty.call(a,"potency")&&r.potency!==void 0&&(r.potency=ko(r.potency)),r}function vM(n){if(typeof n!="string")return null;switch(n.trim().toLowerCase()){case"bleed":return"Bleed";case"burn":return"Burn";case"lifesteal":case"life-steal":return"Lifesteal";case"shield":return"Shield";default:return null}}function gh(n){const a=n.potency!==void 0?ko(n.potency):1;return a>0?a:0}function SM(n){if(n.potency!==void 0){const r=ko(n.potency);return r>0?r:0}const a=Js(n.stacks);if(a<=0)return 0;const s=a*.2;return s>0?s:0}lu("Bleed",{onTick({state:n,self:a}){const s=Js(n.stacks);if(s<=0||a.health<=0){n.stacks=s;return}const r=n.potency!==void 0?ko(n.potency):1,l=s*r;if(l<=0)return;const u=Math.min(a.health,l);return n.stacks=Math.max(0,s-1),{hpDamage:u}}});lu("Burn",{onTick({state:n,self:a}){const s=Js(n.stacks);if(s<=0){n.stacks=s;return}const r=n.potency!==void 0?ko(n.potency):1,l=s*r;if(l<=0)return;const u=Math.min(a.shield,l),f=l-u,h=Math.min(a.health,f);return n.stacks=Math.max(0,s-1),{shieldDamage:u,hpDamage:h}}});lu("Shield",{onGrantShield({state:n}){const a=Js(n.stacks);if(a<=0)return n.stacks=a,0;const s=a*gh(n);return s>0?s:0},onConsumeShield({state:n,amount:a}){const s=Js(n.stacks);if(s<=0)return n.stacks=0,0;const r=gh(n);if(r<=0)return n.stacks=0,0;const l=s*r;if(l<=0)return n.stacks=0,0;const u=Math.min(l,Fi(a)),f=u/r;return n.stacks=Math.max(0,s-f),u>0?u:0}});lu("Lifesteal",{onHit({state:n,hpDamage:a}){if(a<=0)return 0;const s=SM(n);if(s<=0)return 0;const r=a*s;return r>0?r:0}});function _n(n){return Number.isFinite(n)?Math.max(0,n):0}function gy(n,a){const s=_n(a?.health??n?.health??0),r=_n(a?.shield??n?.shield??0);return{id:n?.id??"unknown",faction:n?.faction,health:s,maxHealth:n?.maxHealth,shield:r}}function yy(n){if(!n)return!1;const a=n;return typeof a.onHit=="function"||typeof a.onKill=="function"||Array.isArray(a.onHit)||Array.isArray(a.onKill)}function by(n){return n?Array.isArray(n)?n.filter(a=>typeof a=="function"):typeof n=="function"?[n]:[]:[]}function EM(n){if(!n)return[];if(typeof n[Symbol.iterator]=="function"){const s=[];for(const r of n)yy(r)&&s.push(r);return s}return Object.values(n).filter(s=>yy(s))}function rc(n,a,s){if(!n)return;const r=by(n.hooks?.[a]);for(const u of r)u(s);const l=EM(n.keywords);for(const u of l)for(const f of by(u[a]))f(s)}function vy(n){const a=_n(n?.health??0),s=_n(n?.maxHealth??a);return{health:a,maxHealth:Math.max(s,a),shield:_n(n?.shield??0)}}function MM(){return{health:0,maxHealth:0,shield:0}}function xM(n){const a=n.attacker??null,s=n.defender,r=n.baseDamage,l=_n(n.minimumDamage??1),u=Number.isFinite(r)?_n(r):_n(a?.attack??0),f=_n(s.defense??0),h=yM(),m=vy(s),p=a?vy(a):null,g=hy(s.keywords??null,"defender",h.defender),b=a?hy(a.keywords??null,"attacker",h.attacker):null,v=p??MM();g&&g.runTick(m,v),b&&p&&b.runTick(p,m);const E=m.health>0,M=_n(m.shield);g&&g.grantShield(m,v);const C=_n(m.shield),R=E?Math.max(l,u-f):0,N=E?Math.min(C,R):0,q=E?Math.max(0,R-N):0;m.shield=Math.max(0,C-N);const I=Math.min(M,N),Y=Math.max(0,N-I);g&&Y>0&&g.consumeShield(Y,m,v);const Q=g?g.getShieldValue():0;h.defender.keywordShieldRemaining=Q;const ie=Math.max(0,M-I);m.shield=ie+Q;const ee=m.health;m.health=Math.max(0,ee-q);const oe=m.health,P=oe<=0;let G=0;b&&p?(G=b.applyHit(q,p,m),h.attacker.keywordShieldRemaining=b.getShieldValue()):h.attacker.keywordShieldRemaining=0;const T=gy(a,p??void 0),k=gy(s,{health:oe,shield:ie+Q}),A={attacker:T,defender:k,damage:R,shieldDamage:N,hpDamage:q,lethal:P},F={...A,source:"defender"};if(rc(s,"onHit",F),sc("combat:onHit",F),a){const B={...A,source:"attacker"};rc(a,"onHit",B),sc("combat:onHit",B),P&&(rc(a,"onKill",B),sc("combat:onKill",B))}return P&&(rc(s,"onKill",F),sc("combat:onKill",F)),{damage:R,shieldDamage:N,hpDamage:q,lethal:P,remainingHealth:oe,remainingShield:ie+Q,attackerHealing:G,attackerRemainingHealth:p?.health,attackerRemainingShield:p?.shield,keywordEffects:h}}const Sy=5;function rn(n){return`${n.q},${n.r}`}function Ey(n){const[a,s]=n.split(",").map(Number);return{q:a,r:s}}function Bs(n){return{q:n.q,r:n.r}}class wM{constructor(a,s,r,l,u,f=[]){this.id=a,this.type=s,this.faction=l,this.stats=u,this.priorityFactions=f,this.coord=Bs(r),this.renderCoord=Bs(r),this.maxHealth=u.health}alive=!0;listeners={};maxHealth;healMarkerElapsed=0;healAmountBuffer=0;cachedTargetKey;cachedStartKey;cachedPath;movementCooldownSeconds=0;shield=0;immortal=!1;experience=0;combatHooks=null;combatKeywords=null;coord;renderCoord;setCoord(a,s){this.coord=Bs(a),(s?.snapRender??!0)&&(this.renderCoord=Bs(a))}setRenderCoord(a){this.renderCoord=Bs(a)}snapRenderToCoord(a=this.coord){this.renderCoord=Bs(a)}onDeath(a){(this.listeners.death??=[]).push(a)}emitDeath(){for(const a of this.listeners.death??[])a()}isDead(){return!this.alive}getMaxHealth(){return this.maxHealth}distanceTo(a){return Gs(this.coord,a)}getVisionRange(){const{visionRange:a}=this.stats;return Number.isFinite(a)?a:3}attack(a){return this.distanceTo(a.coord)>this.stats.attackRange?null:a.takeDamage(this.stats.attackDamage,this)}update(a,s){if(!(this.isDead()||!s))if(Gs(this.coord,s.pos)<=s.auraRadius){const r=this.stats.health;if(this.stats.health=Math.min(this.stats.health+s.regenPerSec*a,this.maxHealth),this.stats.health>r){const l=this.stats.health-r;this.healMarkerElapsed+=a,this.healAmountBuffer+=l,(this.healMarkerElapsed>=.9||this.healAmountBuffer>=2)&&this.flushHealEvent()}}else this.healAmountBuffer>0&&this.flushHealEvent(),this.healMarkerElapsed=0,this.healAmountBuffer=0}flushHealEvent(){if(this.healAmountBuffer<=0){this.healMarkerElapsed=0;return}const a=Math.round(this.healAmountBuffer*10)/10;a>0&&ne.emit("unitHealed",{unitId:this.id,amount:a,remainingHealth:this.stats.health}),this.healAmountBuffer=0,this.healMarkerElapsed=0}takeDamage(a,s){const r=Number.isFinite(a);if(r&&a<=0||!r&&!s)return null;const l=s?s.toCombatParticipant():null,u=this.toCombatParticipant(),f=xM({attacker:l,defender:u,baseDamage:r?a:void 0});this.stats.health=f.remainingHealth,this.shield=f.remainingShield;let h=f;if(f.lethal&&this.alive&&this.immortal&&(this.stats.health=Math.max(1,this.stats.health),h={...f,lethal:!1,remainingHealth:this.stats.health,remainingShield:this.shield}),s&&f.attackerRemainingHealth!==void 0){const m=Math.min(s.getMaxHealth(),Math.max(0,f.attackerRemainingHealth));s.stats.health=m}return s&&f.attackerRemainingShield!==void 0&&s.setShield(f.attackerRemainingShield),h.damage>0&&ne.emit("unitDamaged",{attackerId:s?.id,targetId:this.id,amount:h.damage,remainingHealth:this.stats.health}),h.lethal&&this.alive&&(this.stats.health=0,this.alive=!1,this.snapRenderToCoord(),ne.emit("unitDied",{unitId:this.id,attackerId:s?.id,unitFaction:this.faction,attackerFaction:s?.faction}),this.emitDeath()),h}getShield(){return this.shield}setShield(a){if(!Number.isFinite(a)||a<=0){this.shield=0;return}this.shield=a}updateStats(a){this.stats.attackDamage=a.attackDamage,this.stats.attackRange=a.attackRange,this.stats.movementRange=a.movementRange,typeof a.defense=="number"&&Number.isFinite(a.defense)?this.stats.defense=a.defense:delete this.stats.defense,typeof a.visionRange=="number"&&Number.isFinite(a.visionRange)&&(this.stats.visionRange=a.visionRange);const s=Math.max(1,Math.round(a.health));this.maxHealth=s,this.stats.health=Math.min(s,Math.max(0,this.stats.health))}isImmortal(){return this.immortal}setImmortal(a){this.immortal=!!a}getExperience(){return this.experience}setExperience(a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;s!==this.experience&&(this.experience=s,ne.emit("unit:xpChanged",{unitId:this.id,xp:this.experience}))}addExperience(a){if(!Number.isFinite(a)||a===0)return this.experience;const s=Math.max(0,Math.floor(this.experience+a));return this.setExperience(s),this.experience}toCombatParticipant(){return{id:this.id,faction:this.faction,attack:this.stats.attackDamage,defense:this.stats.defense,health:this.stats.health,maxHealth:this.maxHealth,shield:this.shield,hooks:this.combatHooks,keywords:this.combatKeywords}}addMovementTime(a){!Number.isFinite(a)||a<=0||(this.movementCooldownSeconds+=a)}canStep(a=Sy){return this.movementCooldownSeconds>=a}consumeMovementCooldown(a=Sy){return this.canStep(a)?(this.movementCooldownSeconds-=a,!0):!1}moveTowards(a,s,r){const l=this.getPathTo(a,s,r);if(l.length<2)return[];let u=0;const f=rn(a);for(let m=1;m<l.length;m++){const p=rn(l[m]);if(r.has(p)){p!==f&&this.clearPathCache();break}u=m}if(u===0)return[];const h=Math.min(this.stats.movementRange,u);return l.slice(0,h+1)}getPathTo(a,s,r){const l=rn(this.coord),u=rn(a);return(!this.cachedPath||this.cachedTargetKey!==u||this.cachedStartKey!==l)&&(this.cachedPath=this.findPath(a,s,r),this.cachedTargetKey=u,this.cachedStartKey=l),this.cachedPath}advancePathCache(a){!this.cachedPath||a<=0||(this.cachedPath=this.cachedPath.slice(a),this.cachedPath.length>0?this.cachedStartKey=rn(this.cachedPath[0]):(this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0))}clearPathCache(){this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0}findPath(a,s,r){const l=this.coord,u=rn(l),f=rn(a),h=new Set([u]),m=new Map([[u,null]]),p=new Map([[u,0]]),g=new Map([[u,Gs(l,a)]]);for(;h.size>0;){let E=null,M=1/0;for(const N of h){const q=g.get(N)??1/0;q<M&&(M=q,E=N)}if(E===null||E===f)break;h.delete(E);const C=Ey(E),R=p.get(E)??1/0;for(const N of kc(C)){const q=rn(N);if(q!==f&&!this.isPassable(N,s,r))continue;const I=R+1;I<(p.get(q)??1/0)&&(m.set(q,E),p.set(q,I),g.set(q,I+Gs(N,a)),h.add(q))}}if(!m.has(f))return[l];const b=[];let v=f;for(;v;)b.push(Ey(v)),v=m.get(v)??null;return b.reverse()}seekNearestEnemy(a,s,r){const l=new Map;for(const h of a)l.set(rn(h.coord),h);const u=[this.coord],f=new Set([rn(this.coord)]);for(;u.length>0;){const h=u.shift(),m=rn(h),p=l.get(m);if(p)return p;for(const g of kc(h)){const b=rn(g),v=l.get(b);if(v)return v;this.isPassable(g,s,r)&&(f.has(b)||(f.add(b),u.push(g)))}}return null}canTraverse(a,s,r){return this.isPassable(a,s,r)}isPassable(a,s,r){const l=s.getTile(a.q,a.r);return!l||r&&r.has(rn(a))?!1:l.terrain!==vn.Lake}}class AM{static selectTarget(a,s){let r=s.filter(u=>u.faction!==a.faction&&!u.isDead());if(r.length===0)return null;if(a.priorityFactions.length>0){const u=r.filter(f=>a.priorityFactions.includes(f.faction));u.length>0&&(r=u)}const l=r.filter(u=>a.distanceTo(u.coord)<=a.stats.attackRange);return l.length>0?(l.sort((u,f)=>u.stats.health-f.stats.health),l[0]):(r.sort((u,f)=>a.distanceTo(u.coord)-a.distanceTo(f.coord)),r[0]??null)}}const CM=4,TM=8;class _M{buckets=[];bucketCount=0;currentBucket=0;minBuckets;maxBuckets;constructor(a={}){this.minBuckets=a.minBuckets??CM,this.maxBuckets=a.maxBuckets??TM}reset(){this.buckets=[],this.bucketCount=0,this.currentBucket=0}next(a){const s=a.length;if(s===0)return this.reset(),[];const r=this.computeBucketCount(s);r!==this.bucketCount&&(this.bucketCount=r,this.currentBucket=this.currentBucket%Math.max(1,r)),this.rebuildBuckets(a);const l=this.buckets[this.currentBucket]??[];return this.bucketCount>0&&(this.currentBucket=(this.currentBucket+1)%this.bucketCount),l}rebuildBuckets(a){const s=this.bucketCount;this.buckets=Array.from({length:s},()=>[]);const r=[...a].sort((l,u)=>l.id.localeCompare(u.id));for(let l=0;l<r.length;l++){const u=l%s;this.buckets[u].push(r[l])}}computeBucketCount(a){if(a<=0)return 0;const s=Math.ceil(a/12);let r=Math.max(this.minBuckets,s);return r=Math.min(this.maxBuckets,r),r=Math.min(r,a),r=Math.max(1,r),r}}function Nf(n){return`${n.q},${n.r}`}const RM=500;class NM{cache=new Map;targetIndex=new Map;targetPositions=new Map;ttlMs;constructor(a=RM){this.ttlMs=a}clearExpired(a=Date.now()){for(const[s,r]of this.cache.entries())if(r.expiresAt<=a&&(this.cache.delete(s),r.targetId)){const l=this.targetIndex.get(r.targetId);l?.delete(s),l&&l.size===0&&this.targetIndex.delete(r.targetId)}}trackUnit(a){this.invalidateIfTargetMoved(a.id,Nf(a.coord))}invalidateForUnit(a){const s=this.targetIndex.get(a);if(s){for(const r of s)this.cache.delete(r);this.targetIndex.delete(a)}this.targetPositions.delete(a)}getPath(a,s,r,l,u={}){const f=u.now??Date.now(),h=u.targetId,m=Nf(s);h&&this.invalidateIfTargetMoved(h,m);const p=this.hashObstacles(l),g=this.createCacheKey(Nf(a.coord),m,p),b=this.cache.get(g);if(b&&b.expiresAt>f)return b.path;a.clearPathCache();const v=a.getPathTo(s,r,l);if(this.cache.set(g,{path:v,expiresAt:f+this.ttlMs,targetId:h}),h){let E=this.targetIndex.get(h);E||(E=new Set,this.targetIndex.set(h,E)),E.add(g),this.targetPositions.set(h,m)}return v}invalidateIfTargetMoved(a,s){const r=this.targetPositions.get(a);if(!r){this.targetPositions.set(a,s);return}if(r===s)return;const l=this.targetIndex.get(a);if(l){for(const u of l)this.cache.delete(u);l.clear()}this.targetPositions.set(a,s)}hashObstacles(a){return a.size===0?"empty":Array.from(a).sort().join("|")}createCacheKey(a,s,r){return`${a}->${s}|${r}`}}const kM={baseThreshold:50,heatPerSecond:50/30,thresholdGrowth:.05,coolingPerSecond:0};function Ot(n,a=0){return Number.isFinite(n)?n:a}class DM{heat;threshold;baseThreshold;thresholdGrowthFactor;heatPerSecond;coolingPerSecond;maxStoredHeat;constructor(a={}){const s={...kM,...a},r=Math.max(1,Ot(s.baseThreshold,50)),l=Math.max(1,Ot(a.initialThreshold??r,r));this.baseThreshold=r,this.threshold=l,this.thresholdGrowthFactor=1+Math.max(0,Ot(s.thresholdGrowth,0)),this.heatPerSecond=Math.max(0,Ot(s.heatPerSecond,0)),this.coolingPerSecond=Math.max(0,Ot(s.coolingPerSecond,0));const u=Ot(s.maxStoredHeat??Number.NaN,Number.NaN);this.maxStoredHeat=Number.isFinite(u)&&u>=0?u:null;const f=Math.max(0,Ot(a.initialHeat??0,0));this.heat=this.setHeatInternal(f)}getHeat(){return this.heat}getThreshold(){return this.threshold}getBuildRate(){return this.heatPerSecond}getCoolingRate(){return this.coolingPerSecond}reset(){this.heat=0,this.threshold=this.baseThreshold}setHeat(a){const s=Math.max(0,Ot(a,0));return this.heat=this.setHeatInternal(s),this.heat}setHeatInternal(a){const s=Math.max(0,Ot(a,0));return this.maxStoredHeat===null?(this.heat=s,this.heat):(this.heat=Math.min(s,this.maxStoredHeat),this.heat)}addHeat(a){const s=Math.max(0,Ot(a,0));if(s<=0)return 0;const r=this.heat,l=r+s;return this.heat=this.maxStoredHeat===null?l:Math.min(l,this.maxStoredHeat),this.heat-r}cool(a){const s=Math.max(0,Ot(a,0));if(s<=0||this.heat<=0)return 0;const r=this.heat;return this.heat=Math.max(0,this.heat-s),r-this.heat}vent(a=1){const s=Math.max(0,Math.min(1,Ot(a,1)));return s<=0?0:this.cool(this.threshold*s)}advance(a,s){const r=Math.max(0,Ot(a,0)),l=this.heatPerSecond,u=r>0?l*r:0,f=Math.max(0,Ot(s?.bonusHeat??0,0)),h=u+f,m=this.addHeat(h),p=Math.max(0,Ot(s?.coolingMultiplier??1,1)),g=r>0?this.coolingPerSecond*r*p:0,b=this.cool(g);return{addedHeat:m,cooledHeat:b,heat:this.heat}}hasTriggerReady(){return this.heat>=this.threshold-1e-6}consumeTrigger(){return this.hasTriggerReady()?(this.cool(this.threshold),this.threshold=Math.max(this.baseThreshold,this.threshold*this.thresholdGrowthFactor),!0):!1}timeUntilNextTrigger(){return this.hasTriggerReady()?0:this.heatPerSecond<=0?Number.POSITIVE_INFINITY:Math.max(0,this.threshold-this.heat)/this.heatPerSecond}getCooldownSeconds(){return this.heatPerSecond<=0?Number.POSITIVE_INFINITY:this.threshold/this.heatPerSecond}}function LM(n){return new DM(n)}const My=500;function ib(n,a,s){const r=typeof a=="number"?a:2,l=(typeof a=="number"?s:a)??[],u=[];for(let h=-r;h<=r;h++){const m=Math.max(-r,-h-r),p=Math.min(r,-h+r);for(let g=m;g<=p;g++){const b=Math.max(Math.abs(h),Math.abs(g),Math.abs(-h-g));if(b===0||b>r)continue;const v={q:n.q+h,r:n.r+g};l.some(M=>!M.isDead()&&M.coord.q===v.q&&M.coord.r===v.r)||u.push(v)}}if(u.length===0)return null;const f=Math.floor(Math.random()*u.length);return u[f]}function UM(n,a,s={}){const r=LM(a),l=r.getBuildRate(),u=r.getCooldownSeconds(),f=r.timeUntilNextTrigger(),h=Number.isFinite(s.maxRosterSize)?Math.max(0,Math.floor(s.maxRosterSize??0)):0,m=Number.isFinite(s.maxHealth)?Math.max(1,Math.floor(s.maxHealth??My)):My,p=Number.isFinite(s.health)?Math.max(0,Math.min(m,Math.floor(s.health??m))):m;return{id:"sauna",pos:n,auraRadius:2,regenPerSec:1,rallyToFront:!1,maxRosterSize:h,maxHealth:m,health:p,destroyed:p<=0,heat:r.getHeat(),heatPerTick:l,playerSpawnThreshold:r.getThreshold(),playerSpawnCooldown:Number.isFinite(u)?u:0,playerSpawnTimer:Number.isFinite(f)?f:0,beerUpkeepAccumulator:0,heatTracker:r}}function OM(n,a){if(!Number.isFinite(a)||a<=0||n.destroyed)return{amount:0,remainingHealth:Math.max(0,n.health),destroyed:n.destroyed};const s=Math.max(0,n.health),r=Math.min(s,Math.max(0,Math.floor(a))),l=Math.max(0,s-r);return n.health=l,l<=0&&(n.health=0,n.destroyed=!0),{amount:r,remainingHealth:n.health,destroyed:n.destroyed}}const qM=30;function qt(n){return`${n.q},${n.r}`}class zM{constructor(a,s){this.map=a,this.animator=s}scheduler=new _M;pathCache=new NM;lastKnownCoords=new Map;findExplorationGoal(a,s){const r=a.coord;if(this.map.ensureTile(r.q,r.r).isFogged&&a.canTraverse(r,this.map,s))return r;const u=new Set([qt(r)]),f=[r];for(;f.length>0;){const h=f.shift(),m=kc(h),p=this.map.getNeighbors(h.q,h.r);for(let g=0;g<m.length;g++){const b=m[g],v=p[g],E=qt(b);if(!u.has(E)&&(u.add(E),!!a.canTraverse(b,this.map,s))){if(v.isFogged)return b;f.push(b)}}}return null}tick(a,s,r){const l=a.length,u=Date.now();if(this.pathCache.clearExpired(u),l===0){this.scheduler.reset();return}const f=new Set,h=[],m=new Set;for(const g of a){if(g.addMovementTime(s),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g),this.lastKnownCoords.delete(g.id);continue}const b=this.lastKnownCoords.get(g.id);b&&Gs(b,g.coord)>1&&this.animator?.clear(g,{snap:!0}),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r}),this.pathCache.trackUnit(g),h.push(g),f.add(qt(g.coord)),m.add(g.id)}for(const g of[...this.lastKnownCoords.keys()])m.has(g)||this.lastKnownCoords.delete(g);if(h.length===0){this.scheduler.reset();return}const p=this.scheduler.next(h);if(p.length!==0)for(const g of p){const b=qt(g.coord);if(f.delete(b),g.isDead()){g.clearPathCache(),this.pathCache.invalidateForUnit(g.id),this.animator?.clear(g);continue}const v=AM.selectTarget(g,a);if(!v&&r&&!r.destroyed&&this.tryAttackSauna(g,r)){const q=qt(g.coord);f.add(q);continue}if(!v){let N=null;if(r&&!r.destroyed&&(N=r.pos),N||(N=this.findExplorationGoal(g,f)),N){const I=this.computeMovementPath(g,N,f,u);if(I.length>1&&g.stats.movementRange>0){const Y=I[1],Q=qt(Y);if(f.has(Q))g.clearPathCache();else{if(!g.canStep()){f.add(b);continue}if(g.consumeMovementCooldown()){const ie={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(Y,{snapRender:!1}),this.animator.enqueue(g,[ie,Y])):g.setCoord(Y),g.advancePathCache(1);const ee=qt(g.coord);ee===qt(N)&&g.clearPathCache(),f.add(ee),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});continue}}}else g.clearPathCache()}else g.clearPathCache();const q=qt(g.coord);f.add(q),r&&!r.destroyed&&this.tryAttackSauna(g,r);continue}if(v.isDead()){g.clearPathCache(),f.add(b);continue}const E=qt(v.coord),M=this.pathCache.getPath(g,v.coord,this.map,f,{now:u,targetId:v.id});if(M.length>1&&g.stats.movementRange>0){const N=M[1],q=qt(N),I=q===E;if(!f.has(q)||I){if(g.canStep()&&g.consumeMovementCooldown()){const Y={q:g.coord.q,r:g.coord.r};this.animator?(g.setCoord(N,{snapRender:!1}),this.animator.enqueue(g,[Y,N])):g.setCoord(N),g.advancePathCache(1)}}else g.clearPathCache()}const C=qt(g.coord);f.add(C),this.lastKnownCoords.set(g.id,{q:g.coord.q,r:g.coord.r});const R=qt(v.coord);R!==E&&g.clearPathCache(),g.distanceTo(v.coord)<=g.stats.attackRange&&!v.isDead()&&((g.attack(v)?.lethal??!1)||v.isDead())&&(f.delete(R),g.clearPathCache(),this.pathCache.invalidateForUnit(v.id),this.animator?.clear(v))}}tryAttackSauna(a,s){if(a.faction==="player")return!1;const r=a.stats.attackRange;if(r<=0||a.distanceTo(s.pos)>r)return!1;const l=OM(s,a.stats.attackDamage);if(l.amount<=0)return!1;const u={attackerId:a.id,attackerFaction:a.faction,amount:l.amount,remainingHealth:l.remainingHealth};if(ne.emit("saunaDamaged",u),l.destroyed){const f={attackerId:a.id,attackerFaction:a.faction};ne.emit("saunaDestroyed",f)}return!0}computeMovementPath(a,s,r,l){const u=this.pathCache.getPath(a,s,this.map,r,{now:l});if(u.length<2)return[];let f=0;const h=qt(s);for(let p=1;p<u.length;p++){const g=qt(u[p]);if(r.has(g)){g!==h&&a.clearPathCache();break}f=p}if(f===0)return[];const m=Math.min(a.stats.movementRange,f);return u.slice(0,m+1)}}function cu(n){if(!Number.isFinite(n??NaN))return 1;const a=Math.floor(n);return Math.max(1,a)}function BM(n){return Math.max(0,cu(n)-1)}function HM(n,a="linear"){const s=BM(n);switch(a){case"accelerating":return s*(s+1)/2;case"diminishing":return s===0?0:Math.log2(s+1);case"linear":default:return s}}function IM(n,a="round"){switch(a){case"floor":return Math.floor(n);case"ceil":return Math.ceil(n);case"none":return n;case"round":default:return Math.round(n)}}function jM(n,a,s){let r=n;return Number.isFinite(a)&&(r=Math.max(r,a)),Number.isFinite(s)&&(r=Math.min(r,s)),r}function no(n,a){const s=cu(a),r=n.curve??"linear",l=HM(s,r),u=n.base+n.growth*l,f=jM(u,n.min,n.max);return IM(f,n.round??"round")}function Do(n,a){const s=cu(a),r=n.stats,l={health:no(r.health,s),attackDamage:no(r.attackDamage,s),attackRange:no(r.attackRange,s),movementRange:no(r.movementRange,s)};return r.visionRange&&(l.visionRange=no(r.visionRange,s)),l}function xy(n){if(typeof n=="number"&&Number.isFinite(n))return n}function Hc(n,a){let s=n.health,r=n.attackDamage,l=n.attackRange,u=n.movementRange,f=xy(n.defense),h=xy(n.shield);for(const p of a){const g=Math.max(1,Math.round(p.quantity)),b=p.modifiers;typeof b.health=="number"&&(s+=b.health*g),typeof b.attackDamage=="number"&&(r+=b.attackDamage*g),typeof b.attackRange=="number"&&(l+=b.attackRange*g),typeof b.movementRange=="number"&&(u+=b.movementRange*g),typeof b.defense=="number"&&(f=(f??0)+b.defense*g),typeof b.shield=="number"&&(h=(h??0)+b.shield*g)}const m={health:Math.max(1,Math.round(s)),attackDamage:Math.max(0,Math.round(r)),attackRange:Math.max(0,Math.round(l)),movementRange:Math.max(0,Math.round(u))};return f!==void 0&&(m.defense=Math.max(0,Math.round(f))),h!==void 0&&(m.shield=Math.max(0,Math.round(h))),typeof n.visionRange=="number"&&Number.isFinite(n.visionRange)&&(m.visionRange=Math.max(0,Math.round(n.visionRange))),m}const Jh=Object.freeze({id:"soldier",displayName:"Sauna Soldier",cost:50,tags:["infantry","melee"],stats:{health:{base:20,growth:6,curve:"linear",round:"round"},attackDamage:{base:5,growth:1,curve:"linear",round:"round"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:0,round:"round"}}}),Wh=Object.freeze({id:"archer",displayName:"Sauna Archer",cost:75,tags:["ranged"],stats:{health:{base:15,growth:4,curve:"linear",round:"round"},attackDamage:{base:3,growth:.4,curve:"accelerating",round:"ceil"},attackRange:{base:3,growth:.5,curve:"diminishing",round:"ceil",max:5},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:.25,curve:"linear",round:"round",max:5}}}),sb=Object.freeze({id:"avanto-marauder",displayName:"Avanto Marauder",cost:0,tags:["enemy","melee"],stats:{health:{base:12,growth:5,curve:"linear",round:"round"},attackDamage:{base:4,growth:.6,curve:"accelerating",round:"ceil"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:.25,curve:"linear",round:"round",max:2},visionRange:{base:3,growth:0,round:"round"}}}),rb=Object.freeze({soldier:Jh,archer:Wh,"avanto-marauder":sb});function em(n){return rb[n]??null}Object.freeze(Object.keys(rb));const wy=Jh.cost;Object.freeze(Do(Jh,1));Wh.cost;Object.freeze(Do(Wh,1));Object.freeze(Do(sb,1));function ob(n,a,s,r,l){const u=cu(l?.level),f=Do(n,u);return new wM(a,n.id,s,r,f,n.priorityFactions)}function lb(n,a,s,r,l){const u=em(n);return u?ob(u,a,s,r,l):null}function tm(n,a,s,r,l,u){const f=em(a);if(!f)return null;const h=f.cost;if(!n.canAfford(h,se.SAUNA_BEER))return ea("error"),null;n.addResource(se.SAUNA_BEER,-h);const m=ob(f,s,r,l,u);return ea("spawn"),ne.emit("unitSpawned",{unit:m}),m}const GM=Object.freeze(Object.defineProperty({__proto__:null,createUnit:lb,spawnUnit:tm},Symbol.toStringTag,{value:"Module"})),FM=["Aino","Eero","Ilona","Kalevi","Lumi","Mika","Noora","Oskari","Saana","Tapio","Veera","Yrjö"],YM=["Emberguard","Frostwalker","Steamcaller","Dawnwatch","Gritforged","Stormchant","Snowborn","Torchbearer","Chillwarden","Sisuheart"],$M=["Aalto","Halla","Karhu","Korhonen","Laine","Metsä","Niemi","Salmi","Tuomi","Virta"];function kf(n,a){if(n.length===0)throw new Error("Cannot select a name from an empty collection.");const s=Math.floor(a()*n.length);return n[Math.min(s,n.length-1)]}function VM(n=Math.random){const a=kf(FM,n),s=kf(YM,n),r=kf($M,n);return`${a} "${s}" ${r}`}const Ws=Object.freeze(["supply","weapon","focus","relic"]);function cb(){return{supply:null,weapon:null,focus:null,relic:null}}const XM=Object.freeze({supply:Object.freeze({id:"supply",label:"Supply Satchel",description:"Consumables and restorative provisions carried into battle.",maxStacks:5}),weapon:Object.freeze({id:"weapon",label:"Primary Armament",description:"The attendant's main weapon or ranged kit.",maxStacks:1}),focus:Object.freeze({id:"focus",label:"Battle Focus",description:"Tools that sharpen aim, steps, or battlefield intuition.",maxStacks:1}),relic:Object.freeze({id:"relic",label:"Sauna Relic",description:"Charms and relics that empower the attendant's resolve.",maxStacks:1})}),KM=Object.freeze({"birch-sap-satchel":Object.freeze({id:"birch-sap-satchel",slot:"supply",modifiers:{health:3},maxStacks:3}),"steamed-bandages":Object.freeze({id:"steamed-bandages",slot:"supply",modifiers:{shield:4},maxStacks:2}),"aurora-distillate":Object.freeze({id:"aurora-distillate",slot:"supply",modifiers:{attackDamage:2,defense:1},maxStacks:1}),"stolen-sauna-tokens":Object.freeze({id:"stolen-sauna-tokens",slot:"supply",modifiers:{movementRange:.5},maxStacks:5}),"midnight-bloodwine":Object.freeze({id:"midnight-bloodwine",slot:"supply",modifiers:{health:6,attackDamage:1},maxStacks:1}),"sauna-incense":Object.freeze({id:"sauna-incense",slot:"supply",modifiers:{attackRange:1},maxStacks:2}),"glacier-brand":Object.freeze({id:"glacier-brand",slot:"weapon",modifiers:{attackDamage:3},maxStacks:1}),"emberglass-arrow":Object.freeze({id:"emberglass-arrow",slot:"weapon",modifiers:{attackDamage:1,attackRange:2},maxStacks:1}),"aurora-lattice":Object.freeze({id:"aurora-lattice",slot:"focus",modifiers:{attackDamage:2,attackRange:1},maxStacks:1}),"emberglass-shard":Object.freeze({id:"emberglass-shard",slot:"focus",modifiers:{attackDamage:1,movementRange:1},maxStacks:1}),"windstep-totem":Object.freeze({id:"windstep-totem",slot:"focus",modifiers:{movementRange:1,defense:1},maxStacks:1}),"searing-chant-censer":Object.freeze({id:"searing-chant-censer",slot:"focus",modifiers:{attackDamage:2,shield:2},maxStacks:1}),"cracked-ice-amulet":Object.freeze({id:"cracked-ice-amulet",slot:"relic",modifiers:{defense:2},maxStacks:1}),"myrsky-charm":Object.freeze({id:"myrsky-charm",slot:"relic",modifiers:{attackRange:1,defense:1},maxStacks:1}),"frostwyrm-signet":Object.freeze({id:"frostwyrm-signet",slot:"relic",modifiers:{shield:5},maxStacks:1}),"spirit-oak-charm":Object.freeze({id:"spirit-oak-charm",slot:"relic",modifiers:{defense:1,health:2},maxStacks:1})});function Lo(n){const a=XM[n];if(!a)throw new Error(`Unknown equipment slot: ${n}`);return a}function Uo(n){return KM[n]}function ub(n){return Number.isFinite(n)?Math.max(1,Math.round(n)):1}function db(n,a){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:a}}function fb(n,a,s,r){const l=Lo(a),u=Math.max(1,Math.floor(s.maxStacks??l.maxStacks)),f=Math.min(u,r),h=s.modifiers??{};return{...db(n,f),slot:a,maxStacks:u,modifiers:h}}function yh(n){n.equipment||(n.equipment=cb());for(const a of Ws)n.equipment[a]??=null;return n.equipment}function Nn(n){const a=[];for(const s of Ws){const r=n[s];r&&a.push({...r})}return a}function nm(n){return Nn(n).map(a=>db(a,a.quantity))}function Df(n){const a=cb();for(const s of n){const r=Uo(s.id);if(!r)continue;const l=ub(s.quantity),u=a[r.slot];if(u&&u.id!==s.id)continue;const f=(u?.quantity??0)+l,h=fb(s,r.slot,r,f);a[r.slot]=h}return a}function QM(n,a){const s=Uo(a.id);if(!s)return{success:!1,slot:"supply",loadout:Nn(yh(n)),item:null,reason:"unknown-item"};const r=yh(n),l=s.slot,u=Lo(l),f=ub(a.quantity),h=Math.max(1,Math.floor(s.maxStacks??u.maxStacks)),m=r[l];if(m&&m.id!==a.id)return{success:!1,slot:l,loadout:Nn(r),item:m,reason:"slot-occupied"};const p=Math.min(h,(m?.quantity??0)+f);if((m?.quantity??0)+f>h)return{success:!1,slot:l,loadout:Nn(r),item:m,reason:"stack-limit"};const g=fb(a,l,s,p);return r[l]=g,n.items=nm(r),{success:!0,slot:l,loadout:Nn(r),item:g}}function PM(n,a){const s=yh(n),r=s[a];return r?(s[a]=null,n.items=nm(s),{success:!0,slot:a,loadout:Nn(s),removed:r}):{success:!1,slot:a,loadout:Nn(s),removed:null,reason:"empty-slot"}}function ZM(n,a){return Uo(n)?.slot===a}const JM={q:0,r:0},WM="Saunoja",bh=18,Ay=0,Co=1,vh=4,Ic=1,oc={health:bh,attackDamage:4,attackRange:1,movementRange:1,defense:0,shield:0};function lc(n,a,s){return Math.min(Math.max(n,a),s)}function cc(n,a,s){const r=typeof n=="number"&&Number.isFinite(n)?n:a;return Math.max(s,r)}function Lf(n,a,s=0){if(typeof n=="number"&&Number.isFinite(n))return Math.max(s,n);if(typeof a=="number"&&Number.isFinite(a))return Math.max(s,a)}function Cy(n,a){if(!n||typeof n!="object")return{...a};const s=n,r=cc(s.health,a.health,1),l=cc(s.attackDamage,a.attackDamage,0),u=cc(s.attackRange,a.attackRange,0),f=cc(s.movementRange,a.movementRange,0),h=Lf(s.defense,a.defense,0),m=Lf(s.shield,a.shield,0),p=Lf(s.visionRange,a.visionRange,0);return{health:r,attackDamage:l,attackRange:u,movementRange:f,defense:h,shield:m,visionRange:p}}function e3(n,a){if(!n||typeof n!="object")return Df(a);const s=n,r=[];for(const l of Object.values(s)){const u=hb(l);u&&r.push(u)}return r.length===0?Df(a):Df(r)}function hb(n){if(!n||typeof n!="object")return null;const a=n,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const l=typeof a.description=="string"?a.description.trim():void 0,u=typeof a.icon=="string"?a.icon.trim():void 0,f=typeof a.rarity=="string"?a.rarity.trim():void 0,h=typeof a.quantity=="number"?a.quantity:Number(a.quantity),m=Number.isFinite(h)?Math.max(1,Math.round(h)):1;return{id:s,name:r,description:l,icon:u,rarity:f,quantity:m}}function t3(n){if(!n||n.length===0)return[];const a=[];for(const s of n){const r=hb(s);r&&a.push(r)}return a}function n3(n){if(!n||typeof n!="object")return null;const a=n,s=typeof a.id=="string"?a.id.trim():"",r=typeof a.name=="string"?a.name.trim():"";if(!s||!r)return null;const l=a.duration;let u=1/0;typeof l=="number"&&Number.isFinite(l)?u=Math.max(0,l):l!==1/0&&(u=1/0);const f=a.remaining;let h=u;typeof f=="number"&&Number.isFinite(f)?h=Math.max(0,f):f===1/0&&(h=1/0),u!==1/0&&h===1/0&&(h=u);const m=a.appliedAt,p=typeof m=="number"&&Number.isFinite(m)?Math.max(0,m):void 0,g=a.stacks,b=typeof g=="number"&&Number.isFinite(g)?Math.max(1,Math.round(g)):void 0,v=typeof a.description=="string"?a.description.trim():void 0,E=typeof a.source=="string"?a.source.trim():void 0;return{id:s,name:r,description:v,duration:u,remaining:h,appliedAt:p,stacks:b,source:E}}function a3(n){if(!n||n.length===0)return[];const a=[];for(const s of n){const r=n3(s);r&&a.push(r)}return a}function i3(n){if(typeof n=="string"){const a=n.trim();if(a.length>0)return a}try{return VM()}catch(a){return console.warn("Falling back to default Saunoja name",a),WM}}function am(n){const{id:a,name:s,coord:r=JM,maxHp:l=bh,hp:u=l,steam:f=0,defense:h,shield:m=0,traits:p=[],upkeep:g=Ic,xp:b=0,lastHitAt:v=Ay,selected:E=!1,items:M,modifiers:C,combatKeywords:R=null,combatHooks:N=null}=n,q=Number.isFinite(l)?Math.max(1,l):bh,I=Number.isFinite(u)?u:q,Y=lc(I,0,q),Q=Number.isFinite(f)?f:0,ie=lc(Q,0,1),oe=(Array.isArray(p)?p:[]).filter(cn=>typeof cn=="string").map(cn=>cn.trim()).filter(cn=>cn.length>0),P=Number.isFinite(g)?g:Ic,G=lc(P,Co,vh),T=Number.isFinite(b)?b:0,k=Math.max(0,T),A=Number.isFinite(v)?v:Ay,F=Math.max(0,A),B=Number.isFinite(m)?m:0,D=Math.max(0,B),V=Number.isFinite(h)?h:void 0,te=V!==void 0?Math.max(0,V):void 0,he=t3(M),w=a3(C),$=e3(n.equipment,he),W=nm($),ae={...oc,health:q,defense:te??oc.defense,shield:oc.shield},le=Cy(n.baseStats,ae),ge={...le,health:q,defense:te??le.defense,shield:D},de=Cy(n.effectiveStats,ge),Te=Math.max(1,de.health),xe=lc(Y,0,Te),xt=typeof de.defense=="number"?Math.max(0,de.defense):te??void 0,on=typeof de.shield=="number"?Math.max(0,de.shield):D,ln={...le,health:Math.max(1,le.health),defense:typeof le.defense=="number"?Math.max(0,le.defense):te??void 0,shield:typeof le.shield=="number"?Math.max(0,le.shield):oc.shield},Un={...de,health:Te,defense:xt,shield:on},On=i3(s);return{id:a,name:On,coord:{q:r.q,r:r.r},maxHp:Te,hp:xe,defense:xt,shield:on,steam:ie,traits:[...oe],upkeep:G,xp:k,lastHitAt:F,selected:E,items:W,baseStats:ln,effectiveStats:Un,equipment:$,modifiers:w,combatKeywords:R,combatHooks:N}}const er=32;function vo(n,a,s,r){n.beginPath();for(let l=0;l<6;l++){const u=Math.PI/3*l,f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function im(n,a,s){return Math.min(Math.max(n,a),s)}function s3(n,{centerX:a,centerY:s,hp:r,maxHp:l,radius:u=er*.55}){const f=Number.isFinite(l)?Math.max(1,l):1,h=Number.isFinite(r)?r:f,m=im(h/f,0,1);if(n.save(),vo(n,a,s,u),n.fillStyle="rgba(7, 11, 18, 0.72)",n.fill(),n.restore(),m>0){n.save(),vo(n,a,s,u),n.clip();const p=n.createLinearGradient(a,s+u,a,s-u);p.addColorStop(0,"rgba(46, 160, 98, 0.35)"),p.addColorStop(1,"rgba(218, 255, 239, 0.95)"),n.fillStyle=p;const g=u*2*m,b=s+u-g;n.fillRect(a-u,b,u*2,g),n.restore()}n.save(),vo(n,a,s,u),n.lineWidth=Math.max(1,u*.12),n.strokeStyle="rgba(255, 255, 255, 0.28)",n.stroke(),n.restore()}function r3(n,{centerX:a,centerY:s,radius:r=er,progress:l=0}){const u=im(l,0,1);if(u<=0)return;const f=Number.isFinite(r)&&r>0?r:er;n.save(),n.globalCompositeOperation="lighter",n.globalAlpha=u;const h=n.createRadialGradient(a,s,Math.max(1,f*.1),a,s,f);h.addColorStop(0,"rgba(255, 255, 255, 0.92)"),h.addColorStop(.45,"rgba(255, 255, 255, 0.68)"),h.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=h,n.beginPath(),n.arc(a,s,f,0,Math.PI*2),n.fill(),n.restore()}function o3(n,{centerX:a,centerY:s,radius:r=er*.85,intensity:l=1}){const u=im(l,0,1);if(u<=0)return;n.save(),vo(n,a,s,r),n.clip();const f=n.createLinearGradient(a,s+r,a,s-r);f.addColorStop(0,"rgba(255, 255, 255, 0)"),f.addColorStop(.55,`rgba(255, 255, 255, ${.12*u})`),f.addColorStop(1,`rgba(255, 255, 255, ${.35*u})`),n.globalCompositeOperation="lighter",n.fillStyle=f,n.fillRect(a-r,s-r,r*2,r*2),n.restore(),n.save(),n.globalCompositeOperation="lighter",n.lineCap="round",n.strokeStyle=`rgba(255, 255, 255, ${.25*u})`,n.lineWidth=Math.max(1,r*.08);const h=r*.75,m=r*.35;for(let p=0;p<3;p++){const g=s-r*.5+p*m;n.beginPath(),n.moveTo(a-h,g),n.bezierCurveTo(a-h*.4,g-r*.4,a+h*.4,g+r*.2,a+h,g-r*.45),n.stroke()}n.restore()}function Sh(n,a,s){return n<a?a:n>s?s:n}const Uf=Object.freeze([{id:"skirmish",label:"Skirmish Patrols",minRunSeconds:0,minClears:0,cadence:26,multiplier:1,bundleTier:0},{id:"raids",label:"Raid Pressure",minRunSeconds:90,minClears:2,cadence:19,multiplier:1.35,bundleTier:1},{id:"siege",label:"Siege Lines",minRunSeconds:210,minClears:5,cadence:13,multiplier:1.8,bundleTier:2},{id:"onslaught",label:"Winter Onslaught",minRunSeconds:360,minClears:9,cadence:8.5,multiplier:2.45,bundleTier:3},{id:"maelstrom",label:"Glacier Maelstrom",minRunSeconds:540,minClears:14,cadence:6.2,multiplier:3.25,bundleTier:4}]);function l3(n){return n>=1?1/(1+(n-1)*.45):1+(1-n)*.35}function c3(n){if(n>=1)return 1+(n-1)*.85;const a=1-n;return Sh(1-a*.4,.45,1)}function u3(n){return{runSeconds:Math.max(0,Number.isFinite(n.runSeconds)?n.runSeconds:0),clears:Math.max(0,Number.isFinite(n.clears)?n.clears:0),spawnCycles:Math.max(0,Number.isFinite(n.spawnCycles)?n.spawnCycles:0)}}function Ty(n,a){const s=u3(a);let r=0;for(let p=0;p<Uf.length;p+=1){const g=Uf[p];if(s.runSeconds<g.minRunSeconds||s.clears<g.minClears)break;r=p}const l=Uf[r],u=l3(n),f=c3(n),h=Math.max(.75,l.cadence*u),m=l.multiplier*f;return{stage:l,stageIndex:r,cadenceTarget:h,multiplierBase:m}}function _y(n){if(n>=1){const s=Math.min(3,n-1);return Sh(.93-s*.035,.82,.93)}const a=Math.min(1,1-n);return Sh(.93+a*.03,.9,.97)}function Ry(n){if(n>=1)return .024+Math.min(3,n-1)*.012;const a=Math.min(1,1-n);return Math.max(.012,.024-a*.01)}const mb="deepwood",pb="Deepwood Wardens",gb="Reclusive guardians attuned to sauna spirits.",yb=[{id:"warding-circle",label:"Warding Circle",weight:2,units:[{unit:"soldier",level:1,quantity:2},{unit:"archer",level:1,quantity:1}],items:["spirit-oak-charm","sauna-incense"],modifiers:["barkskin-ritual"]},{id:"spirit-strike",label:"Spirit Strike",weight:1,units:[{unit:"archer",level:2,quantity:2}],items:["emberglass-arrow"],modifiers:["searing-chant","windstep"]}],d3={id:mb,name:pb,description:gb,bundles:yb},f3=Object.freeze(Object.defineProperty({__proto__:null,bundles:yb,default:d3,description:gb,id:mb,name:pb},Symbol.toStringTag,{value:"Module"})),bb="enemy",vb="Avanto Marauders",Sb="Frostbitten raiders who harry the sauna frontier.",Eb=[{id:"iceblade-scouts",label:"Iceblade Scouts",weight:3,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:1}],items:["cracked-ice-amulet"],modifiers:["frost-resilience"]},{id:"raiding-party",label:"Raiding Party",weight:2,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:2}],items:["stolen-sauna-tokens"],modifiers:["berserker-drift"]},{id:"frost-champion",label:"Frost Champion",weight:1,minRampTier:0,units:[{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand"],modifiers:["glacial-ward"]},{id:"icebreaker-vanguard",label:"Icebreaker Vanguard",weight:2.5,minRampTier:1,units:[{unit:"avanto-marauder",level:2,quantity:2},{unit:"avanto-marauder",level:1,quantity:1}],items:["stormglass-pendant"],modifiers:["frost-resilience","berserker-drift"]},{id:"glacial-phalanx",label:"Glacial Phalanx",weight:2,minRampTier:2,units:[{unit:"avanto-marauder",level:3,quantity:3},{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand","frostshard-relic"],modifiers:["glacial-ward","polar-endurance"]},{id:"avalanche-warhost",label:"Avalanche Warhost",weight:1.25,minRampTier:3,units:[{unit:"avanto-marauder",level:4,quantity:3},{unit:"avanto-marauder",level:3,quantity:2}],items:["avalanche-totem"],modifiers:["glacial-ward","polar-endurance","berserker-drift"]}],h3={id:bb,name:vb,description:Sb,bundles:Eb},m3=Object.freeze(Object.defineProperty({__proto__:null,bundles:Eb,default:h3,description:Sb,id:bb,name:vb},Symbol.toStringTag,{value:"Module"})),p3=Object.assign({"../content/factions/deepwood.json":f3,"../content/factions/enemy.json":m3}),jc=new Map;for(const[n,a]of Object.entries(p3)){const s=g3(a),r=S3(s,n);if(jc.has(r.id))throw new Error(`Duplicate faction bundle id: ${r.id}`);jc.set(r.id,r)}function g3(n){return typeof n=="object"&&n!==null&&"default"in n?n.default:n}function sm(n){return typeof n=="object"&&n!==null}function Eh(n,a){if(typeof n!="string")throw new Error(`Expected string at ${a}`);const s=n.trim();if(!s)throw new Error(`Expected non-empty string at ${a}`);return s}function Mh(n){if(typeof n!="string")return;const a=n.trim();return a||void 0}function Ny(n,a){if(n===void 0)return Object.freeze([]);if(!Array.isArray(n))throw new Error(`Expected array at ${a}`);const s=n.map((r,l)=>{if(typeof r!="string")throw new Error(`Expected string at ${a}[${l}]`);const u=r.trim();if(!u)throw new Error(`Expected non-empty string at ${a}[${l}]`);return u});return Object.freeze(s)}function Mb(n,a){const s=typeof n=="number"?n:Number(n);return!Number.isFinite(s)||s<=0?a:s}function ky(n,a){const s=Math.floor(Mb(n,a));return s>0?s:a}function y3(n,a){if(!sm(n))throw new Error(`Expected object at ${a}`);const s=Eh(n.unit,`${a}.unit`),r=ky(n.level,1),l=ky(n.quantity,1);return Object.freeze({unit:s,level:r,quantity:l})}function b3(n){if(n===void 0)return;const a=Number(n);if(!Number.isFinite(a))return;const s=Math.floor(a);return s>=0?s:void 0}function v3(n,a,s){if(!sm(n))throw new Error(`Expected object at ${a}`);const r=Mh(n.id)??`${s}-bundle`,l=Mh(n.label)??r,u=Mb(n.weight,1),f=n.units;if(!Array.isArray(f)||f.length===0)throw new Error(`Expected non-empty units array at ${a}.units`);const h=f.map((b,v)=>y3(b,`${a}.units[${v}]`)),m=Ny(n.items,`${a}.items`),p=Ny(n.modifiers,`${a}.modifiers`),g=b3(n.minRampTier);return Object.freeze({id:r,label:l,weight:u,units:Object.freeze(h),items:m,modifiers:p,minRampTier:g})}function S3(n,a){if(!sm(n))throw new Error(`Expected object at ${a}`);const s=Eh(n.id,`${a}.id`),r=Eh(n.name,`${a}.name`),l=Mh(n.description);if(!Array.isArray(n.bundles)||n.bundles.length===0)throw new Error(`Expected non-empty bundles array at ${a}.bundles`);const u=n.bundles.map((f,h)=>v3(f,`${a}.bundles[${h}]`,`${s}-${h}`));return Object.freeze({id:s,name:r,description:l,bundles:Object.freeze(u)})}Object.freeze(Array.from(jc.keys()));function E3(n){return jc.get(n)??null}function M3(n){return E3(n)?.bundles??Object.freeze([])}function x3(){return`e${Date.now()}-${Math.floor(Math.random()*1e6)}`}function w3(n){return{level:n}}function A3(n,a,s){const r=M3(n);if(r.length===0)throw new Error(`No bundles registered for faction: ${n}`);const l=Math.max(0,Math.floor(Number.isFinite(a)?a:0)),u=r.filter(b=>(typeof b.minRampTier=="number"?b.minRampTier:0)<=l),f=u.length>0?u:r,h=typeof s=="function"?s:Math.random,m=f.reduce((b,v)=>b+v.weight,0);if(!Number.isFinite(m)||m<=0)throw new Error(`Invalid bundle weights for faction: ${n}`);const p=h()*m;let g=0;for(const b of f)if(g+=b.weight,p<g)return b;return f[f.length-1]}function C3(n){let a=Math.max(0,Math.floor(n.availableSlots));const s=[];if(a<=0)return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers};const r=n.makeId??x3,l=typeof n.random=="function"?n.random:Math.random,u=Math.max(0,Math.min(.95,typeof n.eliteOdds=="number"?n.eliteOdds:0)),f=Math.max(1,Number.isFinite(n.difficultyMultiplier)?n.difficultyMultiplier:1),h=Math.max(0,Math.floor(Number.isFinite(n.rampTier)?n.rampTier:0)),m=1+h*.25,p=Math.floor(h/2);for(const g of n.bundle.units){const b=Math.max(1,Math.round(g.quantity*f*m)),v=Math.min(b,a),E=g.unit,M=Math.max(1,Math.round((g.level+p)*f));for(let C=0;C<v;C+=1){const R=l()<u?1:0,N=Math.max(1,M+R),q=w3(N),I=n.pickEdge();if(!I)return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers};const Y=lb(E,r(),I,n.factionId,q);if(Y&&(n.addUnit(Y),s.push(Y),a-=1,a<=0))return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers}}}return{spawned:Object.freeze(s),items:n.bundle.items,modifiers:n.bundle.modifiers}}function uc(n,a,s,r=1){const l=Number(n);return Number.isFinite(l)?Math.max(a,Math.min(s,l)):r}const Dy=6;class T3{timer;interval;spawnCycles;factionId;random;makeId;difficulty;eliteOdds;cadenceDecay;multiplierGrowth;runSeconds=0;clearCount=0;boardEmpty=!0;lastClearAt=null;lastSpawnAt=null;lastCadence;lastMultiplier;rampEvaluation;rampStageIndex;currentDifficulty;cadenceScale=1;multiplierScale=1;pressureScale=1;calmUntil=null;calmSecondsRemaining=0;cadenceFloor=.3;constructor(a={}){this.factionId=a.factionId??"enemy",this.random=typeof a.random=="function"?a.random:Math.random;const s=Number.isFinite(a.difficulty)?Number(a.difficulty):1;this.difficulty=Math.max(.5,s);const r=typeof a.eliteOdds=="number"?a.eliteOdds:0;this.eliteOdds=Math.max(0,Math.min(.95,r)),this.currentDifficulty=this.difficulty,this.cadenceDecay=_y(this.currentDifficulty),this.multiplierGrowth=Ry(this.currentDifficulty),this.spawnCycles=0,this.rampEvaluation=Ty(this.currentDifficulty,{runSeconds:0,clears:0,spawnCycles:0}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.interval=this.rampEvaluation.cadenceTarget,this.timer=this.interval,this.lastCadence=this.interval,this.lastMultiplier=this.rampEvaluation.multiplierBase;const l=(()=>{let u=0;return()=>`e${Date.now()}-${u+=1}`})();this.makeId=typeof a.idFactory=="function"?a.idFactory:l}update(a,s,r,l,u={}){if(!Number.isFinite(a)||a<=0)return;this.runSeconds+=a,this.applyRuntimeModifiers(u),this.resolveRampState();const f=this.countActiveEnemies(s);if(this.trackClears(f),this.calmUntil!==null&&this.runSeconds<this.calmUntil){const m=this.calmUntil-this.runSeconds;this.calmSecondsRemaining=m,this.timer=Math.max(this.timer,m);return}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0),this.timer-=a;let h=0;for(;this.timer<=0&&h<Dy;){const m=this.getAvailableSlots(s);if(m<=0){this.timer=Math.max(this.timer,.5);break}const p=this.resolveRampState(),g=A3(this.factionId,p.stage.bundleTier,this.random),b=this.computeMultiplier(p);if(C3({bundle:g,factionId:this.factionId,pickEdge:l,addUnit:r,makeId:this.makeId,availableSlots:m,eliteOdds:this.eliteOdds,random:this.random,difficultyMultiplier:b,rampTier:p.stage.bundleTier}).spawned.length===0){this.timer=Math.max(this.timer,.5);break}const E=this.runSeconds+this.timer;this.lastCadence=this.lastSpawnAt===null?this.interval:Math.max(.01,E-this.lastSpawnAt),this.lastSpawnAt=E,this.lastMultiplier=b,this.spawnCycles+=1,h+=1;const M=this.resolveRampState();this.interval=this.computeNextInterval(M),this.timer+=this.interval}h===Dy&&this.timer<=0&&(this.timer=this.interval)}getSnapshot(){const a=this.rampEvaluation.stage;return{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles,rampStageIndex:this.rampStageIndex,rampStageId:a.id,rampStageLabel:a.label,bundleTier:a.bundleTier,cadence:this.interval,lastCadence:this.lastCadence,lastSpawnAt:this.lastSpawnAt,lastClearAt:this.lastClearAt,difficultyMultiplier:this.lastMultiplier,effectiveDifficulty:this.currentDifficulty,aggressionMultiplier:this.currentDifficulty/this.difficulty,cadenceMultiplier:this.cadenceScale,strengthMultiplier:this.multiplierScale,pressureMultiplier:this.pressureScale,calmSecondsRemaining:this.calmSecondsRemaining}}resolveRampState(){return this.rampEvaluation=Ty(this.currentDifficulty,{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.rampEvaluation}applyRuntimeModifiers(a){const s=uc(a.aggressionMultiplier,.25,6,1),r=uc(a.cadenceMultiplier,.1,10,1),l=uc(a.strengthMultiplier,.1,12,1),u=uc(a.pressureMultiplier,.1,10,1),f=Number.isFinite(a.cadenceFloor)?Math.max(.1,a.cadenceFloor):this.cadenceFloor,h=Math.max(.25,this.difficulty*s);if(h!==this.currentDifficulty&&(this.currentDifficulty=h,this.cadenceDecay=_y(this.currentDifficulty),this.multiplierGrowth=Ry(this.currentDifficulty),this.resolveRampState()),this.cadenceScale=r,this.multiplierScale=l,this.pressureScale=u,this.cadenceFloor=f,Object.prototype.hasOwnProperty.call(a,"calmSecondsRemaining")){const m=a.calmSecondsRemaining;m===null?this.calmUntil=null:typeof m=="number"&&Number.isFinite(m)&&m>0?this.calmUntil=this.runSeconds+m:typeof m=="number"&&m<=0&&(this.calmUntil=null)}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0)}computeNextInterval(a){const s=a.cadenceTarget*this.cadenceScale,r=Math.pow(this.spawnCycles+1,.6)*.018*this.pressureScale,l=1+Math.min(4,r),u=s/l,f=this.interval*this.cadenceDecay,h=Math.min(f,u);return Math.max(this.cadenceFloor,h)}computeMultiplier(a){const s=1+this.spawnCycles*this.multiplierGrowth*this.pressureScale,r=1+a.stageIndex*.15,l=a.multiplierBase*s*r*this.multiplierScale;return Math.min(16,Math.max(1,l))}countActiveEnemies(a){return a.filter(s=>s.faction===this.factionId&&!s.isDead()).length}getAvailableSlots(a){return qM-this.countActiveEnemies(a)}trackClears(a){if(a<=0){this.boardEmpty||(this.clearCount+=1,this.lastClearAt=this.runSeconds),this.boardEmpty=!0;return}this.boardEmpty=!1}}function _3(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(n){return console.warn("Structured telemetry storage unavailable",n),null}}function R3(n,a){const s={event:n,timestamp:Date.now(),payload:{...a}};return console.info(n,s),s}function N3(n,a,s={}){const r=_3();if(!r)return;const l=Number.isFinite(s.limit)?Math.max(1,Math.trunc(s.limit??16)):16,f=[...Ih(n)??[],a].slice(-l);try{r.setItem(n,JSON.stringify(f))}catch(h){console.warn("Failed to persist structured telemetry",{storageKey:n,error:h})}}let Ly=-1,Uy=-1,Of=null,qf=0,zf=0;const k3="telemetry:enemy-scaling:summaries";function D3(n,a={}){const s=n.rampStageIndex!==Ly,r=n.spawnCycles>=Uy+10,l=n.lastClearAt!==null&&n.lastClearAt!==Of;if(!s&&!r&&!l)return;Ly=n.rampStageIndex,Uy=n.spawnCycles,Of=n.lastClearAt??Of,qf=Math.max(qf,n.difficultyMultiplier);const u=Math.max(0,Math.round(n.calmSecondsRemaining*1e3));u>zf&&(zf=u);const f={stage:n.rampStageLabel,stageIndex:n.rampStageIndex,bundleTier:n.bundleTier,cadenceSeconds:Number(n.cadence.toFixed(2)),lastCadenceSeconds:Number(n.lastCadence.toFixed(2)),multiplier:Number(n.difficultyMultiplier.toFixed(2)),effectiveDifficulty:Number(n.effectiveDifficulty.toFixed(2)),aggressionMultiplier:Number(n.aggressionMultiplier.toFixed(2)),cadenceMultiplier:Number(n.cadenceMultiplier.toFixed(2)),strengthMultiplier:Number(n.strengthMultiplier.toFixed(2)),pressureMultiplier:Number(n.pressureMultiplier.toFixed(2)),calmSecondsRemaining:Number(n.calmSecondsRemaining.toFixed(2)),runSeconds:Math.round(n.runSeconds),spawnCycles:n.spawnCycles,clears:n.clears,wipeSince:a.wipeSince??null,longestWipeMs:a.wipeDurationMs??0,peakMultiplier:Number(qf.toFixed(2)),longestCalmMs:zf},h=R3("enemy-scaling",f);N3(k3,h,{limit:24})}const L3=Object.freeze({ngPlusLevel:0,unlockSlots:0}),U3={default:"Included with the sauna key",ngPlusLevel:"Reach NG+ level",unlockSlots:"Earn roster unlocks"},rm=Object.freeze([{id:"ember-circuit",name:"Ember Circuit",rosterCap:3,description:"Classic cedar benches with a loyal trio of attendants.",art:{badge:$2,glow:"linear-gradient(145deg, rgba(255,161,76,0.65), rgba(255,226,173,0.18))"},unlock:{type:"default",label:"Available from the first steam session"}},{id:"aurora-ward",name:"Aurora Ward",rosterCap:4,description:"Glacial glass benches and a quartet ready to repel sieges.",art:{badge:F2,glow:"linear-gradient(140deg, rgba(128,208,255,0.7), rgba(61,184,255,0.2))"},unlock:{type:"unlockSlots",slots:2,label:"Secure 2 roster unlocks"}},{id:"mythic-conclave",name:"Mythic Conclave",rosterCap:6,description:"Runic obsidian tiers where six legends guard the löyly.",art:{badge:Y2,glow:"linear-gradient(135deg, rgba(176,106,255,0.72), rgba(245,199,255,0.2))"},unlock:{type:"ngPlusLevel",level:3,label:"Prestige to NG+ level 3"}}]),Oo=rm[0].id,Bf=new Map(rm.map(n=>[n.id,n]));function xb(){return rm}function qa(n){return n&&Bf.has(n)?Bf.get(n):Bf.get(Oo)}function Oy(n,a,s){if(!Number.isFinite(n))return a;const r=Math.max(a,Math.min(s,n));return Number.isNaN(r)?a:r}function dc(n){if(n.label)return n.label;const a=U3[n.type];if(!a)return"";switch(n.type){case"ngPlusLevel":return`${a} ${n.level}`;case"unlockSlots":return`${a} ${n.slots}`;default:return a}}function tr(n,a){const s=a??L3;if(n.unlock.type==="default")return{tier:n,unlocked:!0,progress:1,requirementLabel:dc(n.unlock)};if(n.unlock.type==="ngPlusLevel"){const r=Oy(s.ngPlusLevel/n.unlock.level,0,1);return{tier:n,unlocked:s.ngPlusLevel>=n.unlock.level,progress:r,requirementLabel:dc(n.unlock)}}if(n.unlock.type==="unlockSlots"){const r=Oy(s.unlockSlots/n.unlock.slots,0,1);return{tier:n,unlocked:s.unlockSlots>=n.unlock.slots,progress:r,requirementLabel:dc(n.unlock)}}return{tier:n,unlocked:!1,progress:0,requirementLabel:dc(n.unlock)}}const qy=["hud-grid","grid","grid-rows-[64px_1fr_80px]","grid-cols-[280px_1fr_clamp(260px,32vw,420px)]","gap-[clamp(16px,3vw,28px)]"],zy={top:["col-span-3","row-span-1","row-start-1"],left:["col-start-1","row-start-2","row-span-1"],content:["col-start-2","row-start-2","row-span-1"],right:["col-start-3","row-start-2","row-span-1"],bottom:["col-span-3","row-start-3","row-span-1"]};function O3(n,a){let s=n.querySelector("[data-hud-root]");return s||(s=a.createElement("div"),s.dataset.hudRoot="true",s.className="hud-layout-root",n.prepend(s)),s}function ao(n,a,s,r){let l=n.querySelector(`[data-hud-region="${s}"]`);return l||(l=a.createElement("div"),l.dataset.hudRegion=s,n.appendChild(l)),l.classList.add("hud-region",...r),l.parentElement!==n&&n.appendChild(l),l}function q3(n,a,s){if(s){n.classList.add(...qy);for(const[r,l]of Object.entries(zy))a[r].classList.add(...l)}else{n.classList.remove(...qy);for(const[r,l]of Object.entries(zy))a[r].classList.remove(...l)}}function ar(n){const a=n.ownerDocument??document,s=O3(n,a),r={top:ao(s,a,"top",["hud-top-row"]),left:ao(s,a,"left",["hud-actions"]),content:ao(s,a,"content",["hud-content"]),right:ao(s,a,"right",["hud-right-column"]),bottom:ao(s,a,"bottom",["hud-bottom-row"])};s.append(r.top,r.left,r.content,r.right,r.bottom);const l=n.dataset.hudVariant==="v2";if(q3(n,r,l),!l){const p=n.querySelector("#resource-bar");p&&p.parentElement!==r.right&&r.right.prepend(p)}const u=n.querySelector("#build-menu");u&&u.parentElement!==r.left&&r.left.appendChild(u);const f=n.querySelector("#build-id");f&&f.parentElement!==r.bottom&&r.bottom.appendChild(f);let h=n.querySelector(".hud-mobile-bar__tray"),m=h?.closest(".hud-mobile-bar")??null;return(!h||!m)&&(m=a.createElement("div"),m.className="hud-mobile-bar",h=a.createElement("div"),h.className="hud-mobile-bar__tray",m.appendChild(h)),m.parentElement!==r.bottom&&r.bottom.appendChild(m),{root:s,regions:r,actions:r.left,side:r.right,mobileBar:h}}const By=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function z3(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const r=document.createElement("div");r.classList.add("sauna-control"),r.dataset.tutorialTarget="heat";const l=()=>{const ce=a.getActiveTierId?.();return qa(ce??Oo).id},u=()=>a.getTierContext?.()??null,f=document.createElement("button");f.type="button",f.textContent="Sauna ♨️",f.classList.add("topbar-button","sauna-toggle"),f.setAttribute("aria-expanded","false"),r.appendChild(f);const h=document.createElement("div");h.classList.add("sauna-card","hud-card"),h.hidden=!0;const m=document.createElement("section");m.classList.add("sauna-health"),m.dataset.tutorialTarget="sauna-integrity";const p=`sauna-health-label-${Math.floor(Math.random()*1e5)}`,g=document.createElement("div");g.classList.add("sauna-health__header");const b=document.createElement("span");b.id=p,b.classList.add("sauna-health__title"),b.textContent="Sauna Integrity",g.appendChild(b);const v=document.createElement("span");v.classList.add("sauna-health__value"),v.setAttribute("aria-live","polite"),g.appendChild(v),m.appendChild(g);const E=document.createElement("div");E.classList.add("sauna-health__bar"),E.setAttribute("role","meter"),E.setAttribute("aria-valuemin","0"),E.setAttribute("aria-labelledby",p);const M=document.createElement("div");M.classList.add("sauna-health__fill"),E.appendChild(M),m.appendChild(E);const C=document.createElement("div");C.classList.add("sauna-health__destruction"),C.hidden=!0,E.appendChild(C);const R=document.createElement("div");R.classList.add("sauna-progress");const N=document.createElement("div");N.classList.add("sauna-progress__fill"),R.appendChild(N),h.appendChild(m),h.appendChild(R);const q=xb(),I=new Map,Y=document.createElement("section");Y.classList.add("sauna-tier");const Q=document.createElement("div");Q.classList.add("sauna-tier__header");const ie=document.createElement("span");ie.classList.add("sauna-tier__title"),ie.textContent="Premium Tiers",Q.appendChild(ie);const ee=document.createElement("p");ee.classList.add("sauna-tier__subtitle"),ee.textContent="Align the löyly with your prestige to unlock lavish benches and roster headroom.",Q.appendChild(ee),Y.appendChild(Q);const oe=document.createElement("div");oe.classList.add("sauna-tier__grid"),Y.appendChild(oe);for(const ce of q){const _e=document.createElement("button");_e.type="button",_e.classList.add("sauna-tier__option"),_e.dataset.tierId=ce.id,_e.setAttribute("aria-pressed","false");const je=document.createElement("div");je.classList.add("sauna-tier__badge"),je.style.setProperty("--sauna-tier-badge-image",`url(${ce.art.badge})`),ce.art.glow&&je.style.setProperty("--sauna-tier-glow",ce.art.glow),_e.appendChild(je);const qe=document.createElement("div");qe.classList.add("sauna-tier__copy"),_e.appendChild(qe);const bt=document.createElement("span");bt.classList.add("sauna-tier__name"),bt.textContent=ce.name,qe.appendChild(bt);const un=document.createElement("span");un.classList.add("sauna-tier__cap"),un.textContent=`Cap ${ce.rosterCap}`,qe.appendChild(un);const Kt=document.createElement("p");Kt.classList.add("sauna-tier__description"),Kt.textContent=ce.description,qe.appendChild(Kt);const Sn=document.createElement("div");Sn.classList.add("sauna-tier__progress");const ia=document.createElement("div");ia.classList.add("sauna-tier__progress-fill"),Sn.appendChild(ia);const Xe=document.createElement("span");Xe.classList.add("sauna-tier__progress-label"),Sn.appendChild(Xe),qe.appendChild(Sn);const Pe=document.createElement("span");Pe.classList.add("sauna-tier__requirement"),qe.appendChild(Pe);const It={tier:ce,button:_e,fill:ia,progressLabel:Xe,requirement:Pe,handleClick:()=>{w(ce,It)}};_e.addEventListener("click",It.handleClick),I.set(ce.id,It),oe.appendChild(_e)}h.appendChild(Y),he();const P=document.createElement("label");P.classList.add("sauna-option");const G=document.createElement("input");G.type="checkbox",G.classList.add("sauna-option__input"),G.checked=n.rallyToFront,G.addEventListener("change",()=>{n.rallyToFront=G.checked}),P.appendChild(G);const T=document.createElement("span");T.textContent="Rally to Front",T.classList.add("sauna-option__label"),P.appendChild(T),h.appendChild(P),r.appendChild(h);const{regions:k}=ar(s),A=k.top,F=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null;let B=!!F?.matches;const D=(ce,_e)=>{typeof ce.addEventListener=="function"?ce.addEventListener("change",_e):typeof ce.addListener=="function"&&ce.addListener(_e)},V=(ce,_e)=>{typeof ce.removeEventListener=="function"?ce.removeEventListener("change",_e):typeof ce.removeListener=="function"&&ce.removeListener(_e)},te=ce=>{B=!!ce.matches,m.dataset.motion=B?"reduced":"full"};m.dataset.motion=B?"reduced":"full",F&&D(F,te);function he(){const ce=l(),_e=u();for(const je of I.values()){const qe=tr(je.tier,_e),bt=Math.round(Math.max(0,Math.min(qe.progress,1))*100);je.fill.style.width=`${bt}%`,je.progressLabel.textContent=qe.unlocked?"Unlocked":`${bt}% ready`,je.requirement.textContent=qe.unlocked?`Roster cap ${je.tier.rosterCap}`:qe.requirementLabel,je.button.dataset.state=qe.unlocked?je.tier.id===ce?"active":"available":"locked",je.button.setAttribute("aria-pressed",je.tier.id===ce?"true":"false"),je.button.setAttribute("aria-disabled",qe.unlocked?"false":"true")}}function w(ce,_e){if(!tr(ce,u()).unlocked){_e.button.classList.remove("sauna-tier__option--denied"),_e.button.offsetWidth,_e.button.classList.add("sauna-tier__option--denied");return}a.setActiveTierId?.(ce.id,{persist:!0}),he()}const $=()=>{r.parentElement!==A&&A.appendChild(r);const ce=A.querySelector("#topbar");return ce&&ce.parentElement===A?(ce.nextSibling!==r&&A.insertBefore(r,ce.nextSibling),!0):!1};let W=null;$()||(W=new MutationObserver(()=>{$()&&W?.disconnect()}),W.observe(A,{childList:!0}));const ae=()=>{const ce=!h.hidden;h.hidden=ce,f.setAttribute("aria-expanded",String(!ce))};f.addEventListener("click",ae);const le=()=>{const ce=Math.max(1,Math.floor(n.maxHealth)),_e=Math.max(0,Math.min(ce,Math.floor(Number.isFinite(n.health)?n.health:0))),je=ce>0?_e/ce:0,qe=Math.max(0,Math.min(je,1));M.style.width=`${qe*100}%`;const bt=By.format(_e),un=By.format(ce);v.textContent=`${bt} / ${un}`,E.setAttribute("aria-valuenow",String(_e)),E.setAttribute("aria-valuemax",String(ce)),E.setAttribute("aria-valuetext",`${bt} of ${un} health`);const Kt=n.destroyed?"offline":qe<=.2?"critical":qe<=.55?"warning":"stable";E.dataset.level=Kt,v.dataset.state=Kt,m.dataset.state=n.destroyed?"destroyed":"active"},ge=()=>{C.classList.remove("sauna-health__destruction--active"),C.hidden=!0};let de=null,Te=null;const xe=()=>{de!==null&&(window.clearTimeout(de),de=null),E.classList.remove("sauna-health__bar--impact")},xt=()=>{M.classList.remove("sauna-health__fill--damage")};M.addEventListener("animationend",xt);const on=()=>{ge()};C.addEventListener("animationend",on);const ln=()=>{xe(),E.classList.add("sauna-health__bar--impact"),B||(M.classList.remove("sauna-health__fill--damage"),M.offsetWidth,M.classList.add("sauna-health__fill--damage")),de=window.setTimeout(()=>{E.classList.remove("sauna-health__bar--impact"),de=null},B?360:560)},Un=()=>{Te!==null&&(window.clearTimeout(Te),Te=null),C.hidden=!1,C.classList.remove("sauna-health__destruction--active"),C.offsetWidth,C.classList.add("sauna-health__destruction--active"),Te=window.setTimeout(()=>{ge(),Te=null},B?720:1100)},On=()=>{le();const ce=n.playerSpawnCooldown>0?n.playerSpawnCooldown:1,_e=1-n.playerSpawnTimer/ce;N.style.width=`${Math.max(0,Math.min(_e,1))*100}%`,G.checked=n.rallyToFront,he()};return le(),{update:On,handleDamage:ce=>{le(),ln()},handleDestroyed:ce=>{h.hidden=!1,f.setAttribute("aria-expanded","true"),le(),ln(),Un()},dispose:()=>{W?.disconnect(),W=null,f.removeEventListener("click",ae),F&&V(F,te),M.removeEventListener("animationend",xt),C.removeEventListener("animationend",on),xe(),Te!==null&&(window.clearTimeout(Te),Te=null),ge();for(const ce of I.values())ce.button.removeEventListener("click",ce.handleClick);I.clear(),r.remove()}}}function io(n,a={}){const{iconSrc:s,description:r,srLabel:l}=a,u=document.createElement("div");if(u.classList.add("topbar-badge"),u.setAttribute("role","status"),u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),s){const b=document.createElement("img");b.src=s,b.alt=n,b.decoding="async",b.classList.add("topbar-badge-icon"),u.appendChild(b)}const f=document.createElement("div");f.classList.add("badge-text");const h=document.createElement("span");h.textContent=n,h.classList.add("badge-label"),f.appendChild(h);const m=document.createElement("span");m.textContent="0",m.classList.add("badge-value"),m.setAttribute("aria-hidden","true"),f.appendChild(m);const p=document.createElement("span");p.classList.add("badge-delta"),p.style.opacity="0",p.style.transform="translateY(-6px)",p.style.transition="opacity 0.5s ease, transform 0.5s ease",p.setAttribute("aria-hidden","true"),u.append(f,p),r&&(u.title=r);const g=l??n;return u.dataset.label=g,u.setAttribute("aria-label",`${g}: 0`),{container:u,value:m,delta:p,label:g}}function B3(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const{regions:r}=ar(s),l=r.top,u=document.createElement("div");u.id="topbar",l.prepend(u);const f=document.createElement("div");f.className="topbar-badge-row",u.appendChild(f);const h={[se.SAUNA_BEER]:"Sauna beer bottles chilled for construction crews and eager recruits.",[se.SAUNAKUNNIA]:"Saunakunnia—prestige earned from sauna rituals and triumphant battles.",[se.SISU]:"Sisu—the relentless grit forged when your warriors triumph on the snow."},m=io("Sauna Beer",{iconSrc:a.saunaBeer,description:h[se.SAUNA_BEER],srLabel:"Sauna beer reserves"});m.container.classList.add("badge-sauna-beer");const p=io("Sisu",{iconSrc:a.sisu,description:h[se.SISU],srLabel:"Sisu reserves"});p.container.classList.add("badge-sisu"),p.container.dataset.tutorialTarget="sisu";const g=io("Saunakunnia",{iconSrc:a.saunakunnia,description:h[se.SAUNAKUNNIA],srLabel:"Saunakunnia"});g.container.classList.add("badge-sauna"),g.container.dataset.tutorialTarget="victory";const b=io("Time");b.container.classList.add("badge-time"),b.delta.style.display="none";const v=io("Enemy Ramp",{srLabel:"Enemy ramp intensity"});v.container.classList.add("badge-ramp"),v.delta.style.display="none",v.container.dataset.tutorialTarget="enemy-ramp",v.container.title="Enemy ramp intensity and cadence.",f.appendChild(m.container),f.appendChild(p.container),f.appendChild(g.container),f.appendChild(v.container),f.appendChild(b.container);const E=new Intl.NumberFormat("en-US"),M=new Intl.NumberFormat("en-US",{signDisplay:"exceptZero"}),C={[se.SAUNA_BEER]:"Sauna Beer",[se.SAUNAKUNNIA]:"Saunakunnia",[se.SISU]:"Sisu"},R={[se.SAUNA_BEER]:{singular:"bottle",plural:"bottles"},[se.SAUNAKUNNIA]:{singular:"Saunakunnia",plural:"Saunakunnia"},[se.SISU]:{singular:"Sisu",plural:"Sisu"}},N={[se.SAUNA_BEER]:"🍺",[se.SAUNAKUNNIA]:"⚜️",[se.SISU]:"🔥"},q={[se.SAUNA_BEER]:m,[se.SAUNAKUNNIA]:g,[se.SISU]:p},I={};let Y=null;function Q(A){if(Y=A,!A){v.value.textContent="Stage 1 · ×1.00",v.delta.textContent="",v.delta.style.display="none",v.container.dataset.state="idle",v.container.title="Enemy ramp idle",v.container.setAttribute("aria-label","Enemy ramp idle.");return}const F=A.stage||`Stage ${A.stageIndex+1}`,B=`×${A.multiplier.toFixed(2)}`,D=`${A.cadenceSeconds.toFixed(2)}s cadence`,V=`×${A.effectiveDifficulty.toFixed(2)}`,te=A.calmSecondsRemaining>.05,he=te?`Calm remaining: ${Math.ceil(A.calmSecondsRemaining)}s`:"Calm inactive";v.value.textContent=`${F} · ${B}`,v.delta.style.display=te?"":"none",v.delta.textContent=te?`Calm ${Math.ceil(A.calmSecondsRemaining)}s`:"",v.container.dataset.state=te?"calm":"active",v.container.title=[`Stage: ${F} (Tier ${A.bundleTier})`,`Cadence: ${D}`,`Multiplier: ${B}`,`Difficulty: ${V}`,`Aggression ×${A.aggressionMultiplier.toFixed(2)} · Cadence ×${A.cadenceMultiplier.toFixed(2)} · Strength ×${A.strengthMultiplier.toFixed(2)}`,he,`Spawn cycles: ${A.spawnCycles}`].join(`
`),v.container.setAttribute("aria-label",[`Enemy ramp ${F}`,`Multiplier ${B}`,`Cadence ${A.cadenceSeconds.toFixed(2)} seconds`,`Difficulty ${V}`,te?`Calm remaining ${Math.ceil(A.calmSecondsRemaining)} seconds`:"Calm inactive"].join(" — "))}function ie(A,F){const B=Number.isFinite(F)?F:0;return A===se.SAUNA_BEER?Math.trunc(B):Math.max(0,Math.round(B))}function ee(A,F){return E.format(ie(A,F))}function oe(A,F){return F===0?"":`${M.format(F)} ${N[A]}`}function P(A,F){if(F===0)return"";const B=F>0?"gained":"spent",D=E.format(Math.abs(F)),V=R[A];if(V){const he=Math.abs(F)===1?V.singular:V.plural,w=C[A],$=[w];he&&he!==w&&$.push(he);const W=$.filter(Boolean).join(" ");return`${B} ${D}${W?` ${W}`:""}`}const te=C[A];return`${B} ${D}${te?` ${te}`:""}`}function G(A,F,B=0){const D=q[A];if(!D)return;const V=ie(A,F),te=ee(A,F);D.value.textContent=te;const he=A===se.SAUNA_BEER&&V<0;if(D.container.classList.toggle("topbar-badge--debt",he),B!==0){D.delta.textContent=oe(A,B),D.delta.style.opacity="1",D.delta.style.transform="translateY(0)";const W=I[A];W&&clearTimeout(W),I[A]=setTimeout(()=>{D.delta.style.opacity="0",D.delta.style.transform="translateY(-6px)",delete I[A]},1e3)}else D.delta.textContent="",D.delta.style.opacity="0",D.delta.style.transform="translateY(-6px)";const w=P(A,B),$=[`${D.label} ${te}`];if(he){const W=E.format(Math.abs(V)),ae=R[A];if(ae){const le=Math.abs(V)===1?ae.singular:ae.plural,ge=le&&le!==C[A];$.push(ge?`Debt of ${W} ${le}`:`Debt of ${W}`)}else $.push(`Debt of ${W}`)}w&&$.push(w),D.container.setAttribute("aria-label",$.join(" — "))}G(se.SAUNA_BEER,n.getResource(se.SAUNA_BEER)),G(se.SAUNAKUNNIA,n.getResource(se.SAUNAKUNNIA)),G(se.SISU,n.getResource(se.SISU)),Q(Y);const T=({resource:A,amount:F,total:B})=>{q[A]&&G(A,B,F)};ne.on("resourceChanged",T);let k=0;return{update(A){k+=A;const F=Math.floor(k/1e3),B=Math.floor(F/60),D=F%60;b.value.textContent=`${B}:${D.toString().padStart(2,"0")}`},setEnemyRampSummary(A){Q(A)},dispose(){ne.off("resourceChanged",T),Object.values(I).forEach(A=>{A&&clearTimeout(A)}),u.remove()}}}var Hf={exports:{}},so={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hy;function H3(){if(Hy)return so;Hy=1;var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function s(r,l,u){var f=null;if(u!==void 0&&(f=""+u),l.key!==void 0&&(f=""+l.key),"key"in l){u={};for(var h in l)h!=="key"&&(u[h]=l[h])}else u=l;return l=u.ref,{$$typeof:n,type:r,key:f,ref:l!==void 0?l:null,props:u}}return so.Fragment=a,so.jsx=s,so.jsxs=s,so}var Iy;function I3(){return Iy||(Iy=1,Hf.exports=H3()),Hf.exports}var Vt=I3(),If={exports:{}},ro={},jf={exports:{}},Gf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jy;function j3(){return jy||(jy=1,(function(n){function a(D,V){var te=D.length;D.push(V);e:for(;0<te;){var he=te-1>>>1,w=D[he];if(0<l(w,V))D[he]=V,D[te]=w,te=he;else break e}}function s(D){return D.length===0?null:D[0]}function r(D){if(D.length===0)return null;var V=D[0],te=D.pop();if(te!==V){D[0]=te;e:for(var he=0,w=D.length,$=w>>>1;he<$;){var W=2*(he+1)-1,ae=D[W],le=W+1,ge=D[le];if(0>l(ae,te))le<w&&0>l(ge,ae)?(D[he]=ge,D[le]=te,he=le):(D[he]=ae,D[W]=te,he=W);else if(le<w&&0>l(ge,te))D[he]=ge,D[le]=te,he=le;else break e}}return V}function l(D,V){var te=D.sortIndex-V.sortIndex;return te!==0?te:D.id-V.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,h=f.now();n.unstable_now=function(){return f.now()-h}}var m=[],p=[],g=1,b=null,v=3,E=!1,M=!1,C=!1,R=!1,N=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function Y(D){for(var V=s(p);V!==null;){if(V.callback===null)r(p);else if(V.startTime<=D)r(p),V.sortIndex=V.expirationTime,a(m,V);else break;V=s(p)}}function Q(D){if(C=!1,Y(D),!M)if(s(m)!==null)M=!0,ie||(ie=!0,k());else{var V=s(p);V!==null&&B(Q,V.startTime-D)}}var ie=!1,ee=-1,oe=5,P=-1;function G(){return R?!0:!(n.unstable_now()-P<oe)}function T(){if(R=!1,ie){var D=n.unstable_now();P=D;var V=!0;try{e:{M=!1,C&&(C=!1,q(ee),ee=-1),E=!0;var te=v;try{t:{for(Y(D),b=s(m);b!==null&&!(b.expirationTime>D&&G());){var he=b.callback;if(typeof he=="function"){b.callback=null,v=b.priorityLevel;var w=he(b.expirationTime<=D);if(D=n.unstable_now(),typeof w=="function"){b.callback=w,Y(D),V=!0;break t}b===s(m)&&r(m),Y(D)}else r(m);b=s(m)}if(b!==null)V=!0;else{var $=s(p);$!==null&&B(Q,$.startTime-D),V=!1}}break e}finally{b=null,v=te,E=!1}V=void 0}}finally{V?k():ie=!1}}}var k;if(typeof I=="function")k=function(){I(T)};else if(typeof MessageChannel<"u"){var A=new MessageChannel,F=A.port2;A.port1.onmessage=T,k=function(){F.postMessage(null)}}else k=function(){N(T,0)};function B(D,V){ee=N(function(){D(n.unstable_now())},V)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(D){D.callback=null},n.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):oe=0<D?Math.floor(1e3/D):5},n.unstable_getCurrentPriorityLevel=function(){return v},n.unstable_next=function(D){switch(v){case 1:case 2:case 3:var V=3;break;default:V=v}var te=v;v=V;try{return D()}finally{v=te}},n.unstable_requestPaint=function(){R=!0},n.unstable_runWithPriority=function(D,V){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var te=v;v=D;try{return V()}finally{v=te}},n.unstable_scheduleCallback=function(D,V,te){var he=n.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?he+te:he):te=he,D){case 1:var w=-1;break;case 2:w=250;break;case 5:w=1073741823;break;case 4:w=1e4;break;default:w=5e3}return w=te+w,D={id:g++,callback:V,priorityLevel:D,startTime:te,expirationTime:w,sortIndex:-1},te>he?(D.sortIndex=te,a(p,D),s(m)===null&&D===s(p)&&(C?(q(ee),ee=-1):C=!0,B(Q,te-he))):(D.sortIndex=w,a(m,D),M||E||(M=!0,ie||(ie=!0,k()))),D},n.unstable_shouldYield=G,n.unstable_wrapCallback=function(D){var V=v;return function(){var te=v;v=V;try{return D.apply(this,arguments)}finally{v=te}}}})(Gf)),Gf}var Gy;function G3(){return Gy||(Gy=1,jf.exports=j3()),jf.exports}var Ff={exports:{}},ve={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fy;function F3(){if(Fy)return ve;Fy=1;var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),b=Symbol.iterator;function v(w){return w===null||typeof w!="object"?null:(w=b&&w[b]||w["@@iterator"],typeof w=="function"?w:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,C={};function R(w,$,W){this.props=w,this.context=$,this.refs=C,this.updater=W||E}R.prototype.isReactComponent={},R.prototype.setState=function(w,$){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,$,"setState")},R.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function N(){}N.prototype=R.prototype;function q(w,$,W){this.props=w,this.context=$,this.refs=C,this.updater=W||E}var I=q.prototype=new N;I.constructor=q,M(I,R.prototype),I.isPureReactComponent=!0;var Y=Array.isArray,Q={H:null,A:null,T:null,S:null,V:null},ie=Object.prototype.hasOwnProperty;function ee(w,$,W,ae,le,ge){return W=ge.ref,{$$typeof:n,type:w,key:$,ref:W!==void 0?W:null,props:ge}}function oe(w,$){return ee(w.type,$,void 0,void 0,void 0,w.props)}function P(w){return typeof w=="object"&&w!==null&&w.$$typeof===n}function G(w){var $={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(W){return $[W]})}var T=/\/+/g;function k(w,$){return typeof w=="object"&&w!==null&&w.key!=null?G(""+w.key):$.toString(36)}function A(){}function F(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(A,A):(w.status="pending",w.then(function($){w.status==="pending"&&(w.status="fulfilled",w.value=$)},function($){w.status==="pending"&&(w.status="rejected",w.reason=$)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function B(w,$,W,ae,le){var ge=typeof w;(ge==="undefined"||ge==="boolean")&&(w=null);var de=!1;if(w===null)de=!0;else switch(ge){case"bigint":case"string":case"number":de=!0;break;case"object":switch(w.$$typeof){case n:case a:de=!0;break;case g:return de=w._init,B(de(w._payload),$,W,ae,le)}}if(de)return le=le(w),de=ae===""?"."+k(w,0):ae,Y(le)?(W="",de!=null&&(W=de.replace(T,"$&/")+"/"),B(le,$,W,"",function(xt){return xt})):le!=null&&(P(le)&&(le=oe(le,W+(le.key==null||w&&w.key===le.key?"":(""+le.key).replace(T,"$&/")+"/")+de)),$.push(le)),1;de=0;var Te=ae===""?".":ae+":";if(Y(w))for(var xe=0;xe<w.length;xe++)ae=w[xe],ge=Te+k(ae,xe),de+=B(ae,$,W,ge,le);else if(xe=v(w),typeof xe=="function")for(w=xe.call(w),xe=0;!(ae=w.next()).done;)ae=ae.value,ge=Te+k(ae,xe++),de+=B(ae,$,W,ge,le);else if(ge==="object"){if(typeof w.then=="function")return B(F(w),$,W,ae,le);throw $=String(w),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return de}function D(w,$,W){if(w==null)return w;var ae=[],le=0;return B(w,ae,"","",function(ge){return $.call(W,ge,le++)}),ae}function V(w){if(w._status===-1){var $=w._result;$=$(),$.then(function(W){(w._status===0||w._status===-1)&&(w._status=1,w._result=W)},function(W){(w._status===0||w._status===-1)&&(w._status=2,w._result=W)}),w._status===-1&&(w._status=0,w._result=$)}if(w._status===1)return w._result.default;throw w._result}var te=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)};function he(){}return ve.Children={map:D,forEach:function(w,$,W){D(w,function(){$.apply(this,arguments)},W)},count:function(w){var $=0;return D(w,function(){$++}),$},toArray:function(w){return D(w,function($){return $})||[]},only:function(w){if(!P(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},ve.Component=R,ve.Fragment=s,ve.Profiler=l,ve.PureComponent=q,ve.StrictMode=r,ve.Suspense=m,ve.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Q,ve.__COMPILER_RUNTIME={__proto__:null,c:function(w){return Q.H.useMemoCache(w)}},ve.cache=function(w){return function(){return w.apply(null,arguments)}},ve.cloneElement=function(w,$,W){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var ae=M({},w.props),le=w.key,ge=void 0;if($!=null)for(de in $.ref!==void 0&&(ge=void 0),$.key!==void 0&&(le=""+$.key),$)!ie.call($,de)||de==="key"||de==="__self"||de==="__source"||de==="ref"&&$.ref===void 0||(ae[de]=$[de]);var de=arguments.length-2;if(de===1)ae.children=W;else if(1<de){for(var Te=Array(de),xe=0;xe<de;xe++)Te[xe]=arguments[xe+2];ae.children=Te}return ee(w.type,le,void 0,void 0,ge,ae)},ve.createContext=function(w){return w={$$typeof:f,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:u,_context:w},w},ve.createElement=function(w,$,W){var ae,le={},ge=null;if($!=null)for(ae in $.key!==void 0&&(ge=""+$.key),$)ie.call($,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(le[ae]=$[ae]);var de=arguments.length-2;if(de===1)le.children=W;else if(1<de){for(var Te=Array(de),xe=0;xe<de;xe++)Te[xe]=arguments[xe+2];le.children=Te}if(w&&w.defaultProps)for(ae in de=w.defaultProps,de)le[ae]===void 0&&(le[ae]=de[ae]);return ee(w,ge,void 0,void 0,null,le)},ve.createRef=function(){return{current:null}},ve.forwardRef=function(w){return{$$typeof:h,render:w}},ve.isValidElement=P,ve.lazy=function(w){return{$$typeof:g,_payload:{_status:-1,_result:w},_init:V}},ve.memo=function(w,$){return{$$typeof:p,type:w,compare:$===void 0?null:$}},ve.startTransition=function(w){var $=Q.T,W={};Q.T=W;try{var ae=w(),le=Q.S;le!==null&&le(W,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(he,te)}catch(ge){te(ge)}finally{Q.T=$}},ve.unstable_useCacheRefresh=function(){return Q.H.useCacheRefresh()},ve.use=function(w){return Q.H.use(w)},ve.useActionState=function(w,$,W){return Q.H.useActionState(w,$,W)},ve.useCallback=function(w,$){return Q.H.useCallback(w,$)},ve.useContext=function(w){return Q.H.useContext(w)},ve.useDebugValue=function(){},ve.useDeferredValue=function(w,$){return Q.H.useDeferredValue(w,$)},ve.useEffect=function(w,$,W){var ae=Q.H;if(typeof W=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ae.useEffect(w,$)},ve.useId=function(){return Q.H.useId()},ve.useImperativeHandle=function(w,$,W){return Q.H.useImperativeHandle(w,$,W)},ve.useInsertionEffect=function(w,$){return Q.H.useInsertionEffect(w,$)},ve.useLayoutEffect=function(w,$){return Q.H.useLayoutEffect(w,$)},ve.useMemo=function(w,$){return Q.H.useMemo(w,$)},ve.useOptimistic=function(w,$){return Q.H.useOptimistic(w,$)},ve.useReducer=function(w,$,W){return Q.H.useReducer(w,$,W)},ve.useRef=function(w){return Q.H.useRef(w)},ve.useState=function(w){return Q.H.useState(w)},ve.useSyncExternalStore=function(w,$,W){return Q.H.useSyncExternalStore(w,$,W)},ve.useTransition=function(){return Q.H.useTransition()},ve.version="19.1.1",ve}var Yy;function om(){return Yy||(Yy=1,Ff.exports=F3()),Ff.exports}var Yf={exports:{}},Nt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $y;function Y3(){if($y)return Nt;$y=1;var n=om();function a(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var r={d:{f:s,r:function(){throw Error(a(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},l=Symbol.for("react.portal");function u(m,p,g){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:b==null?null:""+b,children:m,containerInfo:p,implementation:g}}var f=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Nt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Nt.createPortal=function(m,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(a(299));return u(m,p,null,g)},Nt.flushSync=function(m){var p=f.T,g=r.p;try{if(f.T=null,r.p=2,m)return m()}finally{f.T=p,r.p=g,r.d.f()}},Nt.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,r.d.C(m,p))},Nt.prefetchDNS=function(m){typeof m=="string"&&r.d.D(m)},Nt.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var g=p.as,b=h(g,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,E=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;g==="style"?r.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:b,integrity:v,fetchPriority:E}):g==="script"&&r.d.X(m,{crossOrigin:b,integrity:v,fetchPriority:E,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Nt.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var g=h(p.as,p.crossOrigin);r.d.M(m,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&r.d.M(m)},Nt.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var g=p.as,b=h(g,p.crossOrigin);r.d.L(m,g,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Nt.preloadModule=function(m,p){if(typeof m=="string")if(p){var g=h(p.as,p.crossOrigin);r.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else r.d.m(m)},Nt.requestFormReset=function(m){r.d.r(m)},Nt.unstable_batchedUpdates=function(m,p){return m(p)},Nt.useFormState=function(m,p,g){return f.H.useFormState(m,p,g)},Nt.useFormStatus=function(){return f.H.useHostTransitionStatus()},Nt.version="19.1.1",Nt}var Vy;function $3(){if(Vy)return Yf.exports;Vy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(a){console.error(a)}}return n(),Yf.exports=Y3(),Yf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xy;function V3(){if(Xy)return ro;Xy=1;var n=G3(),a=om(),s=$3();function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function f(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(r(188))}function m(e){var t=e.alternate;if(!t){if(t=u(e),t===null)throw Error(r(188));return t!==e?null:e}for(var i=e,o=t;;){var c=i.return;if(c===null)break;var d=c.alternate;if(d===null){if(o=c.return,o!==null){i=o;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===i)return h(c),e;if(d===o)return h(c),t;d=d.sibling}throw Error(r(188))}if(i.return!==o.return)i=c,o=d;else{for(var y=!1,S=c.child;S;){if(S===i){y=!0,i=c,o=d;break}if(S===o){y=!0,o=c,i=d;break}S=S.sibling}if(!y){for(S=d.child;S;){if(S===i){y=!0,i=d,o=c;break}if(S===o){y=!0,o=d,i=c;break}S=S.sibling}if(!y)throw Error(r(189))}}if(i.alternate!==o)throw Error(r(190))}if(i.tag!==3)throw Error(r(188));return i.stateNode.current===i?e:t}function p(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=p(e),t!==null)return t;e=e.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),q=Symbol.for("react.consumer"),I=Symbol.for("react.context"),Y=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),ie=Symbol.for("react.suspense_list"),ee=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),G=Symbol.for("react.memo_cache_sentinel"),T=Symbol.iterator;function k(e){return e===null||typeof e!="object"?null:(e=T&&e[T]||e["@@iterator"],typeof e=="function"?e:null)}var A=Symbol.for("react.client.reference");function F(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===A?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case M:return"Fragment";case R:return"Profiler";case C:return"StrictMode";case Q:return"Suspense";case ie:return"SuspenseList";case P:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case E:return"Portal";case I:return(e.displayName||"Context")+".Provider";case q:return(e._context.displayName||"Context")+".Consumer";case Y:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ee:return t=e.displayName||null,t!==null?t:F(e.type)||"Memo";case oe:t=e._payload,e=e._init;try{return F(e(t))}catch{}}return null}var B=Array.isArray,D=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},he=[],w=-1;function $(e){return{current:e}}function W(e){0>w||(e.current=he[w],he[w]=null,w--)}function ae(e,t){w++,he[w]=e.current,e.current=t}var le=$(null),ge=$(null),de=$(null),Te=$(null);function xe(e,t){switch(ae(de,t),ae(ge,e),ae(le,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Cg(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Cg(t),e=Tg(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(le),ae(le,e)}function xt(){W(le),W(ge),W(de)}function on(e){e.memoizedState!==null&&ae(Te,e);var t=le.current,i=Tg(t,e.type);t!==i&&(ae(ge,e),ae(le,i))}function ln(e){ge.current===e&&(W(le),W(ge)),Te.current===e&&(W(Te),Qr._currentValue=te)}var Un=Object.prototype.hasOwnProperty,On=n.unstable_scheduleCallback,cn=n.unstable_cancelCallback,bi=n.unstable_shouldYield,es=n.unstable_requestPaint,ce=n.unstable_now,_e=n.unstable_getCurrentPriorityLevel,je=n.unstable_ImmediatePriority,qe=n.unstable_UserBlockingPriority,bt=n.unstable_NormalPriority,un=n.unstable_LowPriority,Kt=n.unstable_IdlePriority,Sn=n.log,ia=n.unstable_setDisableYieldValue,Xe=null,Pe=null;function It(e){if(typeof Sn=="function"&&ia(e),Pe&&typeof Pe.setStrictMode=="function")try{Pe.setStrictMode(Xe,e)}catch{}}var _t=Math.clz32?Math.clz32:zo,vu=Math.log,Su=Math.LN2;function zo(e){return e>>>=0,e===0?32:31-(vu(e)/Su|0)|0}var ts=256,za=4194304;function qn(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function vi(e,t,i){var o=e.pendingLanes;if(o===0)return 0;var c=0,d=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var S=o&134217727;return S!==0?(o=S&~d,o!==0?c=qn(o):(y&=S,y!==0?c=qn(y):i||(i=S&~e,i!==0&&(c=qn(i))))):(S=o&~d,S!==0?c=qn(S):y!==0?c=qn(y):i||(i=o&~e,i!==0&&(c=qn(i)))),c===0?0:t!==0&&t!==c&&(t&d)===0&&(d=c&-c,i=t&-t,d>=i||d===32&&(i&4194048)!==0)?t:c}function sa(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Eu(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bo(){var e=ts;return ts<<=1,(ts&4194048)===0&&(ts=256),e}function Ho(){var e=za;return za<<=1,(za&62914560)===0&&(za=4194304),e}function ns(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function zn(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Io(e,t,i,o,c,d){var y=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var S=e.entanglements,x=e.expirationTimes,z=e.hiddenUpdates;for(i=y&~i;0<i;){var K=31-_t(i),J=1<<K;S[K]=0,x[K]=-1;var H=z[K];if(H!==null)for(z[K]=null,K=0;K<H.length;K++){var j=H[K];j!==null&&(j.lane&=-536870913)}i&=~J}o!==0&&ir(e,o,0),d!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=d&~(y&~t))}function ir(e,t,i){e.pendingLanes|=t,e.suspendedLanes&=~t;var o=31-_t(t);e.entangledLanes|=t,e.entanglements[o]=e.entanglements[o]|1073741824|i&4194090}function sr(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var o=31-_t(i),c=1<<o;c&t|e[o]&t&&(e[o]|=t),i&=~c}}function rr(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function or(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function jo(){var e=V.p;return e!==0?e:(e=window.event,e===void 0?32:Vg(e.type))}function Go(e,t){var i=V.p;try{return V.p=e,t()}finally{V.p=i}}var Bn=Math.random().toString(36).slice(2),We="__reactFiber$"+Bn,dt="__reactProps$"+Bn,ra="__reactContainer$"+Bn,Ba="__reactEvents$"+Bn,En="__reactListeners$"+Bn,as="__reactHandles$"+Bn,Si="__reactResources$"+Bn,Ei="__reactMarker$"+Bn;function is(e){delete e[We],delete e[dt],delete e[Ba],delete e[En],delete e[as]}function oa(e){var t=e[We];if(t)return t;for(var i=e.parentNode;i;){if(t=i[ra]||i[We]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=kg(e);e!==null;){if(i=e[We])return i;e=kg(e)}return t}e=i,i=e.parentNode}return null}function Ha(e){if(e=e[We]||e[ra]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function la(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(r(33))}function ca(e){var t=e[Si];return t||(t=e[Si]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function et(e){e[Ei]=!0}var ss=new Set,Fo={};function Hn(e,t){Ia(e,t),Ia(e+"Capture",t)}function Ia(e,t){for(Fo[e]=t,e=0;e<t.length;e++)ss.add(t[e])}var Yo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),$o={},Vo={};function Xo(e){return Un.call(Vo,e)?!0:Un.call($o,e)?!1:Yo.test(e)?Vo[e]=!0:($o[e]=!0,!1)}function Mi(e,t,i){if(Xo(t))if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var o=t.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+i)}}function xi(e,t,i){if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+i)}}function Mn(e,t,i,o){if(o===null)e.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(t,i,""+o)}}var Ko,L;function X(e){if(Ko===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);Ko=t&&t[1]||"",L=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ko+e+L}var re=!1;function fe(e,t){if(!e||re)return"";re=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(t){var J=function(){throw Error()};if(Object.defineProperty(J.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(J,[])}catch(j){var H=j}Reflect.construct(e,[],J)}else{try{J.call()}catch(j){H=j}e.call(J.prototype)}}else{try{throw Error()}catch(j){H=j}(J=e())&&typeof J.catch=="function"&&J.catch(function(){})}}catch(j){if(j&&H&&typeof j.stack=="string")return[j.stack,H.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=o.DetermineComponentFrameRoot(),y=d[0],S=d[1];if(y&&S){var x=y.split(`
`),z=S.split(`
`);for(c=o=0;o<x.length&&!x[o].includes("DetermineComponentFrameRoot");)o++;for(;c<z.length&&!z[c].includes("DetermineComponentFrameRoot");)c++;if(o===x.length||c===z.length)for(o=x.length-1,c=z.length-1;1<=o&&0<=c&&x[o]!==z[c];)c--;for(;1<=o&&0<=c;o--,c--)if(x[o]!==z[c]){if(o!==1||c!==1)do if(o--,c--,0>c||x[o]!==z[c]){var K=`
`+x[o].replace(" at new "," at ");return e.displayName&&K.includes("<anonymous>")&&(K=K.replace("<anonymous>",e.displayName)),K}while(1<=o&&0<=c);break}}}finally{re=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?X(i):""}function Re(e){switch(e.tag){case 26:case 27:case 5:return X(e.type);case 16:return X("Lazy");case 13:return X("Suspense");case 19:return X("SuspenseList");case 0:case 15:return fe(e.type,!1);case 11:return fe(e.type.render,!1);case 1:return fe(e.type,!0);case 31:return X("Activity");default:return""}}function Ge(e){try{var t="";do t+=Re(e),e=e.return;while(e);return t}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function Ce(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function tt(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Qt(e){var t=tt(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),o=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var c=i.get,d=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(y){o=""+y,d.call(this,y)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return o},setValue:function(y){o=""+y},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function vt(e){e._valueTracker||(e._valueTracker=Qt(e))}function Pt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),o="";return e&&(o=tt(e)?e.checked?"true":"false":e.value),e=o,e!==i?(t.setValue(e),!0):!1}function Zt(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var wi=/[\n"\\]/g;function ft(e){return e.replace(wi,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function nt(e,t,i,o,c,d,y,S){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),t!=null?y==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Ce(t)):e.value!==""+Ce(t)&&(e.value=""+Ce(t)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),t!=null?Ga(e,y,Ce(t)):i!=null?Ga(e,y,Ce(i)):o!=null&&e.removeAttribute("value"),c==null&&d!=null&&(e.defaultChecked=!!d),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?e.name=""+Ce(S):e.removeAttribute("name")}function ja(e,t,i,o,c,d,y,S){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),t!=null||i!=null){if(!(d!=="submit"&&d!=="reset"||t!=null))return;i=i!=null?""+Ce(i):"",t=t!=null?""+Ce(t):i,S||t===e.value||(e.value=t),e.defaultValue=t}o=o??c,o=typeof o!="function"&&typeof o!="symbol"&&!!o,e.checked=S?e.checked:!!o,e.defaultChecked=!!o,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y)}function Ga(e,t,i){t==="number"&&Zt(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function ua(e,t,i,o){if(e=e.options,t){t={};for(var c=0;c<i.length;c++)t["$"+i[c]]=!0;for(i=0;i<e.length;i++)c=t.hasOwnProperty("$"+e[i].value),e[i].selected!==c&&(e[i].selected=c),c&&o&&(e[i].defaultSelected=!0)}else{for(i=""+Ce(i),t=null,c=0;c<e.length;c++){if(e[c].value===i){e[c].selected=!0,o&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function In(e,t,i){if(t!=null&&(t=""+Ce(t),t!==e.value&&(e.value=t),i==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=i!=null?""+Ce(i):""}function Qo(e,t,i,o){if(t==null){if(o!=null){if(i!=null)throw Error(r(92));if(B(o)){if(1<o.length)throw Error(r(93));o=o[0]}i=o}i==null&&(i=""),t=i}i=Ce(t),e.defaultValue=i,o=e.textContent,o===i&&o!==""&&o!==null&&(e.value=o)}function rs(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var Pv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Cm(e,t,i){var o=t.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?o?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":o?e.setProperty(t,i):typeof i!="number"||i===0||Pv.has(t)?t==="float"?e.cssFloat=i:e[t]=(""+i).trim():e[t]=i+"px"}function Tm(e,t,i){if(t!=null&&typeof t!="object")throw Error(r(62));if(e=e.style,i!=null){for(var o in i)!i.hasOwnProperty(o)||t!=null&&t.hasOwnProperty(o)||(o.indexOf("--")===0?e.setProperty(o,""):o==="float"?e.cssFloat="":e[o]="");for(var c in t)o=t[c],t.hasOwnProperty(c)&&i[c]!==o&&Cm(e,c,o)}else for(var d in t)t.hasOwnProperty(d)&&Cm(e,d,t[d])}function Mu(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Jv=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Po(e){return Jv.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var xu=null;function wu(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var os=null,ls=null;function _m(e){var t=Ha(e);if(t&&(e=t.stateNode)){var i=e[dt]||null;e:switch(e=t.stateNode,t.type){case"input":if(nt(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+ft(""+t)+'"][type="radio"]'),t=0;t<i.length;t++){var o=i[t];if(o!==e&&o.form===e.form){var c=o[dt]||null;if(!c)throw Error(r(90));nt(o,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(t=0;t<i.length;t++)o=i[t],o.form===e.form&&Pt(o)}break e;case"textarea":In(e,i.value,i.defaultValue);break e;case"select":t=i.value,t!=null&&ua(e,!!i.multiple,t,!1)}}}var Au=!1;function Rm(e,t,i){if(Au)return e(t,i);Au=!0;try{var o=e(t);return o}finally{if(Au=!1,(os!==null||ls!==null)&&(Ol(),os&&(t=os,e=ls,ls=os=null,_m(t),e)))for(t=0;t<e.length;t++)_m(e[t])}}function lr(e,t){var i=e.stateNode;if(i===null)return null;var o=i[dt]||null;if(o===null)return null;i=o[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(r(231,t,typeof i));return i}var da=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Cu=!1;if(da)try{var cr={};Object.defineProperty(cr,"passive",{get:function(){Cu=!0}}),window.addEventListener("test",cr,cr),window.removeEventListener("test",cr,cr)}catch{Cu=!1}var Fa=null,Tu=null,Zo=null;function Nm(){if(Zo)return Zo;var e,t=Tu,i=t.length,o,c="value"in Fa?Fa.value:Fa.textContent,d=c.length;for(e=0;e<i&&t[e]===c[e];e++);var y=i-e;for(o=1;o<=y&&t[i-o]===c[d-o];o++);return Zo=c.slice(e,1<o?1-o:void 0)}function Jo(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Wo(){return!0}function km(){return!1}function jt(e){function t(i,o,c,d,y){this._reactName=i,this._targetInst=c,this.type=o,this.nativeEvent=d,this.target=y,this.currentTarget=null;for(var S in e)e.hasOwnProperty(S)&&(i=e[S],this[S]=i?i(d):d[S]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?Wo:km,this.isPropagationStopped=km,this}return g(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Wo)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Wo)},persist:function(){},isPersistent:Wo}),t}var Ai={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},el=jt(Ai),ur=g({},Ai,{view:0,detail:0}),Wv=jt(ur),_u,Ru,dr,tl=g({},ur,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ku,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==dr&&(dr&&e.type==="mousemove"?(_u=e.screenX-dr.screenX,Ru=e.screenY-dr.screenY):Ru=_u=0,dr=e),_u)},movementY:function(e){return"movementY"in e?e.movementY:Ru}}),Dm=jt(tl),e1=g({},tl,{dataTransfer:0}),t1=jt(e1),n1=g({},ur,{relatedTarget:0}),Nu=jt(n1),a1=g({},Ai,{animationName:0,elapsedTime:0,pseudoElement:0}),i1=jt(a1),s1=g({},Ai,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),r1=jt(s1),o1=g({},Ai,{data:0}),Lm=jt(o1),l1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},c1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},u1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function d1(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=u1[e])?!!t[e]:!1}function ku(){return d1}var f1=g({},ur,{key:function(e){if(e.key){var t=l1[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Jo(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?c1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ku,charCode:function(e){return e.type==="keypress"?Jo(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Jo(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),h1=jt(f1),m1=g({},tl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Um=jt(m1),p1=g({},ur,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ku}),g1=jt(p1),y1=g({},Ai,{propertyName:0,elapsedTime:0,pseudoElement:0}),b1=jt(y1),v1=g({},tl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),S1=jt(v1),E1=g({},Ai,{newState:0,oldState:0}),M1=jt(E1),x1=[9,13,27,32],Du=da&&"CompositionEvent"in window,fr=null;da&&"documentMode"in document&&(fr=document.documentMode);var w1=da&&"TextEvent"in window&&!fr,Om=da&&(!Du||fr&&8<fr&&11>=fr),qm=" ",zm=!1;function Bm(e,t){switch(e){case"keyup":return x1.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var cs=!1;function A1(e,t){switch(e){case"compositionend":return Hm(t);case"keypress":return t.which!==32?null:(zm=!0,qm);case"textInput":return e=t.data,e===qm&&zm?null:e;default:return null}}function C1(e,t){if(cs)return e==="compositionend"||!Du&&Bm(e,t)?(e=Nm(),Zo=Tu=Fa=null,cs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Om&&t.locale!=="ko"?null:t.data;default:return null}}var T1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Im(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!T1[e.type]:t==="textarea"}function jm(e,t,i,o){os?ls?ls.push(o):ls=[o]:os=o,t=jl(t,"onChange"),0<t.length&&(i=new el("onChange","change",null,i,o),e.push({event:i,listeners:t}))}var hr=null,mr=null;function _1(e){Eg(e,0)}function nl(e){var t=la(e);if(Pt(t))return e}function Gm(e,t){if(e==="change")return t}var Fm=!1;if(da){var Lu;if(da){var Uu="oninput"in document;if(!Uu){var Ym=document.createElement("div");Ym.setAttribute("oninput","return;"),Uu=typeof Ym.oninput=="function"}Lu=Uu}else Lu=!1;Fm=Lu&&(!document.documentMode||9<document.documentMode)}function $m(){hr&&(hr.detachEvent("onpropertychange",Vm),mr=hr=null)}function Vm(e){if(e.propertyName==="value"&&nl(mr)){var t=[];jm(t,mr,e,wu(e)),Rm(_1,t)}}function R1(e,t,i){e==="focusin"?($m(),hr=t,mr=i,hr.attachEvent("onpropertychange",Vm)):e==="focusout"&&$m()}function N1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return nl(mr)}function k1(e,t){if(e==="click")return nl(t)}function D1(e,t){if(e==="input"||e==="change")return nl(t)}function L1(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Jt=typeof Object.is=="function"?Object.is:L1;function pr(e,t){if(Jt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;for(o=0;o<i.length;o++){var c=i[o];if(!Un.call(t,c)||!Jt(e[c],t[c]))return!1}return!0}function Xm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Km(e,t){var i=Xm(e);e=0;for(var o;i;){if(i.nodeType===3){if(o=e+i.textContent.length,e<=t&&o>=t)return{node:i,offset:t-e};e=o}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Xm(i)}}function Qm(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Qm(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Pm(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=Zt(e.document);t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=Zt(e.document)}return t}function Ou(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var U1=da&&"documentMode"in document&&11>=document.documentMode,us=null,qu=null,gr=null,zu=!1;function Zm(e,t,i){var o=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;zu||us==null||us!==Zt(o)||(o=us,"selectionStart"in o&&Ou(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),gr&&pr(gr,o)||(gr=o,o=jl(qu,"onSelect"),0<o.length&&(t=new el("onSelect","select",null,t,i),e.push({event:t,listeners:o}),t.target=us)))}function Ci(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var ds={animationend:Ci("Animation","AnimationEnd"),animationiteration:Ci("Animation","AnimationIteration"),animationstart:Ci("Animation","AnimationStart"),transitionrun:Ci("Transition","TransitionRun"),transitionstart:Ci("Transition","TransitionStart"),transitioncancel:Ci("Transition","TransitionCancel"),transitionend:Ci("Transition","TransitionEnd")},Bu={},Jm={};da&&(Jm=document.createElement("div").style,"AnimationEvent"in window||(delete ds.animationend.animation,delete ds.animationiteration.animation,delete ds.animationstart.animation),"TransitionEvent"in window||delete ds.transitionend.transition);function Ti(e){if(Bu[e])return Bu[e];if(!ds[e])return e;var t=ds[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in Jm)return Bu[e]=t[i];return e}var Wm=Ti("animationend"),ep=Ti("animationiteration"),tp=Ti("animationstart"),O1=Ti("transitionrun"),q1=Ti("transitionstart"),z1=Ti("transitioncancel"),np=Ti("transitionend"),ap=new Map,Hu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Hu.push("scrollEnd");function xn(e,t){ap.set(e,t),Hn(t,[e])}var ip=new WeakMap;function dn(e,t){if(typeof e=="object"&&e!==null){var i=ip.get(e);return i!==void 0?i:(t={value:e,source:t,stack:Ge(t)},ip.set(e,t),t)}return{value:e,source:t,stack:Ge(t)}}var fn=[],fs=0,Iu=0;function al(){for(var e=fs,t=Iu=fs=0;t<e;){var i=fn[t];fn[t++]=null;var o=fn[t];fn[t++]=null;var c=fn[t];fn[t++]=null;var d=fn[t];if(fn[t++]=null,o!==null&&c!==null){var y=o.pending;y===null?c.next=c:(c.next=y.next,y.next=c),o.pending=c}d!==0&&sp(i,c,d)}}function il(e,t,i,o){fn[fs++]=e,fn[fs++]=t,fn[fs++]=i,fn[fs++]=o,Iu|=o,e.lanes|=o,e=e.alternate,e!==null&&(e.lanes|=o)}function ju(e,t,i,o){return il(e,t,i,o),sl(e)}function hs(e,t){return il(e,null,null,t),sl(e)}function sp(e,t,i){e.lanes|=i;var o=e.alternate;o!==null&&(o.lanes|=i);for(var c=!1,d=e.return;d!==null;)d.childLanes|=i,o=d.alternate,o!==null&&(o.childLanes|=i),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(c=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,c&&t!==null&&(c=31-_t(i),e=d.hiddenUpdates,o=e[c],o===null?e[c]=[t]:o.push(t),t.lane=i|536870912),d):null}function sl(e){if(50<jr)throw jr=0,Xd=null,Error(r(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var ms={};function B1(e,t,i,o){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wt(e,t,i,o){return new B1(e,t,i,o)}function Gu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function fa(e,t){var i=e.alternate;return i===null?(i=Wt(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function rp(e,t){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,t=i.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function rl(e,t,i,o,c,d){var y=0;if(o=e,typeof e=="function")Gu(e)&&(y=1);else if(typeof e=="string")y=IS(e,i,le.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case P:return e=Wt(31,i,t,c),e.elementType=P,e.lanes=d,e;case M:return _i(i.children,c,d,t);case C:y=8,c|=24;break;case R:return e=Wt(12,i,t,c|2),e.elementType=R,e.lanes=d,e;case Q:return e=Wt(13,i,t,c),e.elementType=Q,e.lanes=d,e;case ie:return e=Wt(19,i,t,c),e.elementType=ie,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case N:case I:y=10;break e;case q:y=9;break e;case Y:y=11;break e;case ee:y=14;break e;case oe:y=16,o=null;break e}y=29,i=Error(r(130,e===null?"null":typeof e,"")),o=null}return t=Wt(y,i,t,c),t.elementType=e,t.type=o,t.lanes=d,t}function _i(e,t,i,o){return e=Wt(7,e,o,t),e.lanes=i,e}function Fu(e,t,i){return e=Wt(6,e,null,t),e.lanes=i,e}function Yu(e,t,i){return t=Wt(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var ps=[],gs=0,ol=null,ll=0,hn=[],mn=0,Ri=null,ha=1,ma="";function Ni(e,t){ps[gs++]=ll,ps[gs++]=ol,ol=e,ll=t}function op(e,t,i){hn[mn++]=ha,hn[mn++]=ma,hn[mn++]=Ri,Ri=e;var o=ha;e=ma;var c=32-_t(o)-1;o&=~(1<<c),i+=1;var d=32-_t(t)+c;if(30<d){var y=c-c%5;d=(o&(1<<y)-1).toString(32),o>>=y,c-=y,ha=1<<32-_t(t)+c|i<<c|o,ma=d+e}else ha=1<<d|i<<c|o,ma=e}function $u(e){e.return!==null&&(Ni(e,1),op(e,1,0))}function Vu(e){for(;e===ol;)ol=ps[--gs],ps[gs]=null,ll=ps[--gs],ps[gs]=null;for(;e===Ri;)Ri=hn[--mn],hn[mn]=null,ma=hn[--mn],hn[mn]=null,ha=hn[--mn],hn[mn]=null}var Ut=null,at=null,De=!1,ki=null,jn=!1,Xu=Error(r(519));function Di(e){var t=Error(r(418,""));throw vr(dn(t,e)),Xu}function lp(e){var t=e.stateNode,i=e.type,o=e.memoizedProps;switch(t[We]=e,t[dt]=o,i){case"dialog":Ae("cancel",t),Ae("close",t);break;case"iframe":case"object":case"embed":Ae("load",t);break;case"video":case"audio":for(i=0;i<Fr.length;i++)Ae(Fr[i],t);break;case"source":Ae("error",t);break;case"img":case"image":case"link":Ae("error",t),Ae("load",t);break;case"details":Ae("toggle",t);break;case"input":Ae("invalid",t),ja(t,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0),vt(t);break;case"select":Ae("invalid",t);break;case"textarea":Ae("invalid",t),Qo(t,o.value,o.defaultValue,o.children),vt(t)}i=o.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||t.textContent===""+i||o.suppressHydrationWarning===!0||Ag(t.textContent,i)?(o.popover!=null&&(Ae("beforetoggle",t),Ae("toggle",t)),o.onScroll!=null&&Ae("scroll",t),o.onScrollEnd!=null&&Ae("scrollend",t),o.onClick!=null&&(t.onclick=Gl),t=!0):t=!1,t||Di(e)}function cp(e){for(Ut=e.return;Ut;)switch(Ut.tag){case 5:case 13:jn=!1;return;case 27:case 3:jn=!0;return;default:Ut=Ut.return}}function yr(e){if(e!==Ut)return!1;if(!De)return cp(e),De=!0,!1;var t=e.tag,i;if((i=t!==3&&t!==27)&&((i=t===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||uf(e.type,e.memoizedProps)),i=!i),i&&at&&Di(e),cp(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(i=e.data,i==="/$"){if(t===0){at=An(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++;e=e.nextSibling}at=null}}else t===27?(t=at,si(e.type)?(e=mf,mf=null,at=e):at=t):at=Ut?An(e.stateNode.nextSibling):null;return!0}function br(){at=Ut=null,De=!1}function up(){var e=ki;return e!==null&&(Yt===null?Yt=e:Yt.push.apply(Yt,e),ki=null),e}function vr(e){ki===null?ki=[e]:ki.push(e)}var Ku=$(null),Li=null,pa=null;function Ya(e,t,i){ae(Ku,t._currentValue),t._currentValue=i}function ga(e){e._currentValue=Ku.current,W(Ku)}function Qu(e,t,i){for(;e!==null;){var o=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,o!==null&&(o.childLanes|=t)):o!==null&&(o.childLanes&t)!==t&&(o.childLanes|=t),e===i)break;e=e.return}}function Pu(e,t,i,o){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var d=c.dependencies;if(d!==null){var y=c.child;d=d.firstContext;e:for(;d!==null;){var S=d;d=c;for(var x=0;x<t.length;x++)if(S.context===t[x]){d.lanes|=i,S=d.alternate,S!==null&&(S.lanes|=i),Qu(d.return,i,e),o||(y=null);break e}d=S.next}}else if(c.tag===18){if(y=c.return,y===null)throw Error(r(341));y.lanes|=i,d=y.alternate,d!==null&&(d.lanes|=i),Qu(y,i,e),y=null}else y=c.child;if(y!==null)y.return=c;else for(y=c;y!==null;){if(y===e){y=null;break}if(c=y.sibling,c!==null){c.return=y.return,y=c;break}y=y.return}c=y}}function Sr(e,t,i,o){e=null;for(var c=t,d=!1;c!==null;){if(!d){if((c.flags&524288)!==0)d=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var y=c.alternate;if(y===null)throw Error(r(387));if(y=y.memoizedProps,y!==null){var S=c.type;Jt(c.pendingProps.value,y.value)||(e!==null?e.push(S):e=[S])}}else if(c===Te.current){if(y=c.alternate,y===null)throw Error(r(387));y.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(Qr):e=[Qr])}c=c.return}e!==null&&Pu(t,e,i,o),t.flags|=262144}function cl(e){for(e=e.firstContext;e!==null;){if(!Jt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ui(e){Li=e,pa=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Rt(e){return dp(Li,e)}function ul(e,t){return Li===null&&Ui(e),dp(e,t)}function dp(e,t){var i=t._currentValue;if(t={context:t,memoizedValue:i,next:null},pa===null){if(e===null)throw Error(r(308));pa=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else pa=pa.next=t;return i}var H1=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(i,o){e.push(o)}};this.abort=function(){t.aborted=!0,e.forEach(function(i){return i()})}},I1=n.unstable_scheduleCallback,j1=n.unstable_NormalPriority,ht={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zu(){return{controller:new H1,data:new Map,refCount:0}}function Er(e){e.refCount--,e.refCount===0&&I1(j1,function(){e.controller.abort()})}var Mr=null,Ju=0,ys=0,bs=null;function G1(e,t){if(Mr===null){var i=Mr=[];Ju=0,ys=ef(),bs={status:"pending",value:void 0,then:function(o){i.push(o)}}}return Ju++,t.then(fp,fp),t}function fp(){if(--Ju===0&&Mr!==null){bs!==null&&(bs.status="fulfilled");var e=Mr;Mr=null,ys=0,bs=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function F1(e,t){var i=[],o={status:"pending",value:null,reason:null,then:function(c){i.push(c)}};return e.then(function(){o.status="fulfilled",o.value=t;for(var c=0;c<i.length;c++)(0,i[c])(t)},function(c){for(o.status="rejected",o.reason=c,c=0;c<i.length;c++)(0,i[c])(void 0)}),o}var hp=D.S;D.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&G1(e,t),hp!==null&&hp(e,t)};var Oi=$(null);function Wu(){var e=Oi.current;return e!==null?e:Ye.pooledCache}function dl(e,t){t===null?ae(Oi,Oi.current):ae(Oi,t.pool)}function mp(){var e=Wu();return e===null?null:{parent:ht._currentValue,pool:e}}var xr=Error(r(460)),pp=Error(r(474)),fl=Error(r(542)),ed={then:function(){}};function gp(e){return e=e.status,e==="fulfilled"||e==="rejected"}function hl(){}function yp(e,t,i){switch(i=e[i],i===void 0?e.push(t):i!==t&&(t.then(hl,hl),t=i),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,vp(e),e;default:if(typeof t.status=="string")t.then(hl,hl);else{if(e=Ye,e!==null&&100<e.shellSuspendCounter)throw Error(r(482));e=t,e.status="pending",e.then(function(o){if(t.status==="pending"){var c=t;c.status="fulfilled",c.value=o}},function(o){if(t.status==="pending"){var c=t;c.status="rejected",c.reason=o}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,vp(e),e}throw wr=t,xr}}var wr=null;function bp(){if(wr===null)throw Error(r(459));var e=wr;return wr=null,e}function vp(e){if(e===xr||e===fl)throw Error(r(483))}var $a=!1;function td(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function nd(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Va(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Xa(e,t,i){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,(Le&2)!==0){var c=o.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),o.pending=t,t=sl(e),sp(e,null,i),t}return il(e,o,t,i),sl(e)}function Ar(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194048)!==0)){var o=t.lanes;o&=e.pendingLanes,i|=o,t.lanes=i,sr(e,i)}}function ad(e,t){var i=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,i===o)){var c=null,d=null;if(i=i.firstBaseUpdate,i!==null){do{var y={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};d===null?c=d=y:d=d.next=y,i=i.next}while(i!==null);d===null?c=d=t:d=d.next=t}else c=d=t;i={baseState:o.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:o.shared,callbacks:o.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}var id=!1;function Cr(){if(id){var e=bs;if(e!==null)throw e}}function Tr(e,t,i,o){id=!1;var c=e.updateQueue;$a=!1;var d=c.firstBaseUpdate,y=c.lastBaseUpdate,S=c.shared.pending;if(S!==null){c.shared.pending=null;var x=S,z=x.next;x.next=null,y===null?d=z:y.next=z,y=x;var K=e.alternate;K!==null&&(K=K.updateQueue,S=K.lastBaseUpdate,S!==y&&(S===null?K.firstBaseUpdate=z:S.next=z,K.lastBaseUpdate=x))}if(d!==null){var J=c.baseState;y=0,K=z=x=null,S=d;do{var H=S.lane&-536870913,j=H!==S.lane;if(j?(Ne&H)===H:(o&H)===H){H!==0&&H===ys&&(id=!0),K!==null&&(K=K.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var be=e,pe=S;H=t;var He=i;switch(pe.tag){case 1:if(be=pe.payload,typeof be=="function"){J=be.call(He,J,H);break e}J=be;break e;case 3:be.flags=be.flags&-65537|128;case 0:if(be=pe.payload,H=typeof be=="function"?be.call(He,J,H):be,H==null)break e;J=g({},J,H);break e;case 2:$a=!0}}H=S.callback,H!==null&&(e.flags|=64,j&&(e.flags|=8192),j=c.callbacks,j===null?c.callbacks=[H]:j.push(H))}else j={lane:H,tag:S.tag,payload:S.payload,callback:S.callback,next:null},K===null?(z=K=j,x=J):K=K.next=j,y|=H;if(S=S.next,S===null){if(S=c.shared.pending,S===null)break;j=S,S=j.next,j.next=null,c.lastBaseUpdate=j,c.shared.pending=null}}while(!0);K===null&&(x=J),c.baseState=x,c.firstBaseUpdate=z,c.lastBaseUpdate=K,d===null&&(c.shared.lanes=0),ti|=y,e.lanes=y,e.memoizedState=J}}function Sp(e,t){if(typeof e!="function")throw Error(r(191,e));e.call(t)}function Ep(e,t){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)Sp(i[e],t)}var vs=$(null),ml=$(0);function Mp(e,t){e=xa,ae(ml,e),ae(vs,t),xa=e|t.baseLanes}function sd(){ae(ml,xa),ae(vs,vs.current)}function rd(){xa=ml.current,W(vs),W(ml)}var Ka=0,Se=null,ze=null,lt=null,pl=!1,Ss=!1,qi=!1,gl=0,_r=0,Es=null,Y1=0;function st(){throw Error(r(321))}function od(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!Jt(e[i],t[i]))return!1;return!0}function ld(e,t,i,o,c,d){return Ka=d,Se=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,D.H=e===null||e.memoizedState===null?s0:r0,qi=!1,d=i(o,c),qi=!1,Ss&&(d=wp(t,i,o,c)),xp(e),d}function xp(e){D.H=Ml;var t=ze!==null&&ze.next!==null;if(Ka=0,lt=ze=Se=null,pl=!1,_r=0,Es=null,t)throw Error(r(300));e===null||St||(e=e.dependencies,e!==null&&cl(e)&&(St=!0))}function wp(e,t,i,o){Se=e;var c=0;do{if(Ss&&(Es=null),_r=0,Ss=!1,25<=c)throw Error(r(301));if(c+=1,lt=ze=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}D.H=Z1,d=t(i,o)}while(Ss);return d}function $1(){var e=D.H,t=e.useState()[0];return t=typeof t.then=="function"?Rr(t):t,e=e.useState()[0],(ze!==null?ze.memoizedState:null)!==e&&(Se.flags|=1024),t}function cd(){var e=gl!==0;return gl=0,e}function ud(e,t,i){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i}function dd(e){if(pl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}pl=!1}Ka=0,lt=ze=Se=null,Ss=!1,_r=gl=0,Es=null}function Gt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lt===null?Se.memoizedState=lt=e:lt=lt.next=e,lt}function ct(){if(ze===null){var e=Se.alternate;e=e!==null?e.memoizedState:null}else e=ze.next;var t=lt===null?Se.memoizedState:lt.next;if(t!==null)lt=t,ze=e;else{if(e===null)throw Se.alternate===null?Error(r(467)):Error(r(310));ze=e,e={memoizedState:ze.memoizedState,baseState:ze.baseState,baseQueue:ze.baseQueue,queue:ze.queue,next:null},lt===null?Se.memoizedState=lt=e:lt=lt.next=e}return lt}function fd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Rr(e){var t=_r;return _r+=1,Es===null&&(Es=[]),e=yp(Es,e,t),t=Se,(lt===null?t.memoizedState:lt.next)===null&&(t=t.alternate,D.H=t===null||t.memoizedState===null?s0:r0),e}function yl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Rr(e);if(e.$$typeof===I)return Rt(e)}throw Error(r(438,String(e)))}function hd(e){var t=null,i=Se.updateQueue;if(i!==null&&(t=i.memoCache),t==null){var o=Se.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(t={data:o.data.map(function(c){return c.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),i===null&&(i=fd(),Se.updateQueue=i),i.memoCache=t,i=t.data[t.index],i===void 0)for(i=t.data[t.index]=Array(e),o=0;o<e;o++)i[o]=G;return t.index++,i}function ya(e,t){return typeof t=="function"?t(e):t}function bl(e){var t=ct();return md(t,ze,e)}function md(e,t,i){var o=e.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=i;var c=e.baseQueue,d=o.pending;if(d!==null){if(c!==null){var y=c.next;c.next=d.next,d.next=y}t.baseQueue=c=d,o.pending=null}if(d=e.baseState,c===null)e.memoizedState=d;else{t=c.next;var S=y=null,x=null,z=t,K=!1;do{var J=z.lane&-536870913;if(J!==z.lane?(Ne&J)===J:(Ka&J)===J){var H=z.revertLane;if(H===0)x!==null&&(x=x.next={lane:0,revertLane:0,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),J===ys&&(K=!0);else if((Ka&H)===H){z=z.next,H===ys&&(K=!0);continue}else J={lane:0,revertLane:z.revertLane,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},x===null?(S=x=J,y=d):x=x.next=J,Se.lanes|=H,ti|=H;J=z.action,qi&&i(d,J),d=z.hasEagerState?z.eagerState:i(d,J)}else H={lane:J,revertLane:z.revertLane,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},x===null?(S=x=H,y=d):x=x.next=H,Se.lanes|=J,ti|=J;z=z.next}while(z!==null&&z!==t);if(x===null?y=d:x.next=S,!Jt(d,e.memoizedState)&&(St=!0,K&&(i=bs,i!==null)))throw i;e.memoizedState=d,e.baseState=y,e.baseQueue=x,o.lastRenderedState=d}return c===null&&(o.lanes=0),[e.memoizedState,o.dispatch]}function pd(e){var t=ct(),i=t.queue;if(i===null)throw Error(r(311));i.lastRenderedReducer=e;var o=i.dispatch,c=i.pending,d=t.memoizedState;if(c!==null){i.pending=null;var y=c=c.next;do d=e(d,y.action),y=y.next;while(y!==c);Jt(d,t.memoizedState)||(St=!0),t.memoizedState=d,t.baseQueue===null&&(t.baseState=d),i.lastRenderedState=d}return[d,o]}function Ap(e,t,i){var o=Se,c=ct(),d=De;if(d){if(i===void 0)throw Error(r(407));i=i()}else i=t();var y=!Jt((ze||c).memoizedState,i);y&&(c.memoizedState=i,St=!0),c=c.queue;var S=_p.bind(null,o,c,e);if(Nr(2048,8,S,[e]),c.getSnapshot!==t||y||lt!==null&&lt.memoizedState.tag&1){if(o.flags|=2048,Ms(9,vl(),Tp.bind(null,o,c,i,t),null),Ye===null)throw Error(r(349));d||(Ka&124)!==0||Cp(o,t,i)}return i}function Cp(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Se.updateQueue,t===null?(t=fd(),Se.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function Tp(e,t,i,o){t.value=i,t.getSnapshot=o,Rp(t)&&Np(e)}function _p(e,t,i){return i(function(){Rp(t)&&Np(e)})}function Rp(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!Jt(e,i)}catch{return!0}}function Np(e){var t=hs(e,2);t!==null&&sn(t,e,2)}function gd(e){var t=Gt();if(typeof e=="function"){var i=e;if(e=i(),qi){It(!0);try{i()}finally{It(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ya,lastRenderedState:e},t}function kp(e,t,i,o){return e.baseState=i,md(e,ze,typeof o=="function"?o:ya)}function V1(e,t,i,o,c){if(El(e))throw Error(r(485));if(e=t.action,e!==null){var d={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){d.listeners.push(y)}};D.T!==null?i(!0):d.isTransition=!1,o(d),i=t.pending,i===null?(d.next=t.pending=d,Dp(t,d)):(d.next=i.next,t.pending=i.next=d)}}function Dp(e,t){var i=t.action,o=t.payload,c=e.state;if(t.isTransition){var d=D.T,y={};D.T=y;try{var S=i(c,o),x=D.S;x!==null&&x(y,S),Lp(e,t,S)}catch(z){yd(e,t,z)}finally{D.T=d}}else try{d=i(c,o),Lp(e,t,d)}catch(z){yd(e,t,z)}}function Lp(e,t,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(o){Up(e,t,o)},function(o){return yd(e,t,o)}):Up(e,t,i)}function Up(e,t,i){t.status="fulfilled",t.value=i,Op(t),e.state=i,t=e.pending,t!==null&&(i=t.next,i===t?e.pending=null:(i=i.next,t.next=i,Dp(e,i)))}function yd(e,t,i){var o=e.pending;if(e.pending=null,o!==null){o=o.next;do t.status="rejected",t.reason=i,Op(t),t=t.next;while(t!==o)}e.action=null}function Op(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function qp(e,t){return t}function zp(e,t){if(De){var i=Ye.formState;if(i!==null){e:{var o=Se;if(De){if(at){t:{for(var c=at,d=jn;c.nodeType!==8;){if(!d){c=null;break t}if(c=An(c.nextSibling),c===null){c=null;break t}}d=c.data,c=d==="F!"||d==="F"?c:null}if(c){at=An(c.nextSibling),o=c.data==="F!";break e}}Di(o)}o=!1}o&&(t=i[0])}}return i=Gt(),i.memoizedState=i.baseState=t,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qp,lastRenderedState:t},i.queue=o,i=n0.bind(null,Se,o),o.dispatch=i,o=gd(!1),d=Md.bind(null,Se,!1,o.queue),o=Gt(),c={state:t,dispatch:null,action:e,pending:null},o.queue=c,i=V1.bind(null,Se,c,d,i),c.dispatch=i,o.memoizedState=e,[t,i,!1]}function Bp(e){var t=ct();return Hp(t,ze,e)}function Hp(e,t,i){if(t=md(e,t,qp)[0],e=bl(ya)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var o=Rr(t)}catch(y){throw y===xr?fl:y}else o=t;t=ct();var c=t.queue,d=c.dispatch;return i!==t.memoizedState&&(Se.flags|=2048,Ms(9,vl(),X1.bind(null,c,i),null)),[o,d,e]}function X1(e,t){e.action=t}function Ip(e){var t=ct(),i=ze;if(i!==null)return Hp(t,i,e);ct(),t=t.memoizedState,i=ct();var o=i.queue.dispatch;return i.memoizedState=e,[t,o,!1]}function Ms(e,t,i,o){return e={tag:e,create:i,deps:o,inst:t,next:null},t=Se.updateQueue,t===null&&(t=fd(),Se.updateQueue=t),i=t.lastEffect,i===null?t.lastEffect=e.next=e:(o=i.next,i.next=e,e.next=o,t.lastEffect=e),e}function vl(){return{destroy:void 0,resource:void 0}}function jp(){return ct().memoizedState}function Sl(e,t,i,o){var c=Gt();o=o===void 0?null:o,Se.flags|=e,c.memoizedState=Ms(1|t,vl(),i,o)}function Nr(e,t,i,o){var c=ct();o=o===void 0?null:o;var d=c.memoizedState.inst;ze!==null&&o!==null&&od(o,ze.memoizedState.deps)?c.memoizedState=Ms(t,d,i,o):(Se.flags|=e,c.memoizedState=Ms(1|t,d,i,o))}function Gp(e,t){Sl(8390656,8,e,t)}function Fp(e,t){Nr(2048,8,e,t)}function Yp(e,t){return Nr(4,2,e,t)}function $p(e,t){return Nr(4,4,e,t)}function Vp(e,t){if(typeof t=="function"){e=e();var i=t(e);return function(){typeof i=="function"?i():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Xp(e,t,i){i=i!=null?i.concat([e]):null,Nr(4,4,Vp.bind(null,t,e),i)}function bd(){}function Kp(e,t){var i=ct();t=t===void 0?null:t;var o=i.memoizedState;return t!==null&&od(t,o[1])?o[0]:(i.memoizedState=[e,t],e)}function Qp(e,t){var i=ct();t=t===void 0?null:t;var o=i.memoizedState;if(t!==null&&od(t,o[1]))return o[0];if(o=e(),qi){It(!0);try{e()}finally{It(!1)}}return i.memoizedState=[o,t],o}function vd(e,t,i){return i===void 0||(Ka&1073741824)!==0?e.memoizedState=t:(e.memoizedState=i,e=J0(),Se.lanes|=e,ti|=e,i)}function Pp(e,t,i,o){return Jt(i,t)?i:vs.current!==null?(e=vd(e,i,o),Jt(e,t)||(St=!0),e):(Ka&42)===0?(St=!0,e.memoizedState=i):(e=J0(),Se.lanes|=e,ti|=e,t)}function Zp(e,t,i,o,c){var d=V.p;V.p=d!==0&&8>d?d:8;var y=D.T,S={};D.T=S,Md(e,!1,t,i);try{var x=c(),z=D.S;if(z!==null&&z(S,x),x!==null&&typeof x=="object"&&typeof x.then=="function"){var K=F1(x,o);kr(e,t,K,an(e))}else kr(e,t,o,an(e))}catch(J){kr(e,t,{then:function(){},status:"rejected",reason:J},an())}finally{V.p=d,D.T=y}}function K1(){}function Sd(e,t,i,o){if(e.tag!==5)throw Error(r(476));var c=Jp(e).queue;Zp(e,c,t,te,i===null?K1:function(){return Wp(e),i(o)})}function Jp(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ya,lastRenderedState:te},next:null};var i={};return t.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ya,lastRenderedState:i},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Wp(e){var t=Jp(e).next.queue;kr(e,t,{},an())}function Ed(){return Rt(Qr)}function e0(){return ct().memoizedState}function t0(){return ct().memoizedState}function Q1(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var i=an();e=Va(i);var o=Xa(t,e,i);o!==null&&(sn(o,t,i),Ar(o,t,i)),t={cache:Zu()},e.payload=t;return}t=t.return}}function P1(e,t,i){var o=an();i={lane:o,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},El(e)?a0(t,i):(i=ju(e,t,i,o),i!==null&&(sn(i,e,o),i0(i,t,o)))}function n0(e,t,i){var o=an();kr(e,t,i,o)}function kr(e,t,i,o){var c={lane:o,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(El(e))a0(t,c);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=t.lastRenderedReducer,d!==null))try{var y=t.lastRenderedState,S=d(y,i);if(c.hasEagerState=!0,c.eagerState=S,Jt(S,y))return il(e,t,c,0),Ye===null&&al(),!1}catch{}finally{}if(i=ju(e,t,c,o),i!==null)return sn(i,e,o),i0(i,t,o),!0}return!1}function Md(e,t,i,o){if(o={lane:2,revertLane:ef(),action:o,hasEagerState:!1,eagerState:null,next:null},El(e)){if(t)throw Error(r(479))}else t=ju(e,i,o,2),t!==null&&sn(t,e,2)}function El(e){var t=e.alternate;return e===Se||t!==null&&t===Se}function a0(e,t){Ss=pl=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function i0(e,t,i){if((i&4194048)!==0){var o=t.lanes;o&=e.pendingLanes,i|=o,t.lanes=i,sr(e,i)}}var Ml={readContext:Rt,use:yl,useCallback:st,useContext:st,useEffect:st,useImperativeHandle:st,useLayoutEffect:st,useInsertionEffect:st,useMemo:st,useReducer:st,useRef:st,useState:st,useDebugValue:st,useDeferredValue:st,useTransition:st,useSyncExternalStore:st,useId:st,useHostTransitionStatus:st,useFormState:st,useActionState:st,useOptimistic:st,useMemoCache:st,useCacheRefresh:st},s0={readContext:Rt,use:yl,useCallback:function(e,t){return Gt().memoizedState=[e,t===void 0?null:t],e},useContext:Rt,useEffect:Gp,useImperativeHandle:function(e,t,i){i=i!=null?i.concat([e]):null,Sl(4194308,4,Vp.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Sl(4194308,4,e,t)},useInsertionEffect:function(e,t){Sl(4,2,e,t)},useMemo:function(e,t){var i=Gt();t=t===void 0?null:t;var o=e();if(qi){It(!0);try{e()}finally{It(!1)}}return i.memoizedState=[o,t],o},useReducer:function(e,t,i){var o=Gt();if(i!==void 0){var c=i(t);if(qi){It(!0);try{i(t)}finally{It(!1)}}}else c=t;return o.memoizedState=o.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},o.queue=e,e=e.dispatch=P1.bind(null,Se,e),[o.memoizedState,e]},useRef:function(e){var t=Gt();return e={current:e},t.memoizedState=e},useState:function(e){e=gd(e);var t=e.queue,i=n0.bind(null,Se,t);return t.dispatch=i,[e.memoizedState,i]},useDebugValue:bd,useDeferredValue:function(e,t){var i=Gt();return vd(i,e,t)},useTransition:function(){var e=gd(!1);return e=Zp.bind(null,Se,e.queue,!0,!1),Gt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,i){var o=Se,c=Gt();if(De){if(i===void 0)throw Error(r(407));i=i()}else{if(i=t(),Ye===null)throw Error(r(349));(Ne&124)!==0||Cp(o,t,i)}c.memoizedState=i;var d={value:i,getSnapshot:t};return c.queue=d,Gp(_p.bind(null,o,d,e),[e]),o.flags|=2048,Ms(9,vl(),Tp.bind(null,o,d,i,t),null),i},useId:function(){var e=Gt(),t=Ye.identifierPrefix;if(De){var i=ma,o=ha;i=(o&~(1<<32-_t(o)-1)).toString(32)+i,t="«"+t+"R"+i,i=gl++,0<i&&(t+="H"+i.toString(32)),t+="»"}else i=Y1++,t="«"+t+"r"+i.toString(32)+"»";return e.memoizedState=t},useHostTransitionStatus:Ed,useFormState:zp,useActionState:zp,useOptimistic:function(e){var t=Gt();t.memoizedState=t.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=i,t=Md.bind(null,Se,!0,i),i.dispatch=t,[e,t]},useMemoCache:hd,useCacheRefresh:function(){return Gt().memoizedState=Q1.bind(null,Se)}},r0={readContext:Rt,use:yl,useCallback:Kp,useContext:Rt,useEffect:Fp,useImperativeHandle:Xp,useInsertionEffect:Yp,useLayoutEffect:$p,useMemo:Qp,useReducer:bl,useRef:jp,useState:function(){return bl(ya)},useDebugValue:bd,useDeferredValue:function(e,t){var i=ct();return Pp(i,ze.memoizedState,e,t)},useTransition:function(){var e=bl(ya)[0],t=ct().memoizedState;return[typeof e=="boolean"?e:Rr(e),t]},useSyncExternalStore:Ap,useId:e0,useHostTransitionStatus:Ed,useFormState:Bp,useActionState:Bp,useOptimistic:function(e,t){var i=ct();return kp(i,ze,e,t)},useMemoCache:hd,useCacheRefresh:t0},Z1={readContext:Rt,use:yl,useCallback:Kp,useContext:Rt,useEffect:Fp,useImperativeHandle:Xp,useInsertionEffect:Yp,useLayoutEffect:$p,useMemo:Qp,useReducer:pd,useRef:jp,useState:function(){return pd(ya)},useDebugValue:bd,useDeferredValue:function(e,t){var i=ct();return ze===null?vd(i,e,t):Pp(i,ze.memoizedState,e,t)},useTransition:function(){var e=pd(ya)[0],t=ct().memoizedState;return[typeof e=="boolean"?e:Rr(e),t]},useSyncExternalStore:Ap,useId:e0,useHostTransitionStatus:Ed,useFormState:Ip,useActionState:Ip,useOptimistic:function(e,t){var i=ct();return ze!==null?kp(i,ze,e,t):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:hd,useCacheRefresh:t0},xs=null,Dr=0;function xl(e){var t=Dr;return Dr+=1,xs===null&&(xs=[]),yp(xs,e,t)}function Lr(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function wl(e,t){throw t.$$typeof===b?Error(r(525)):(e=Object.prototype.toString.call(t),Error(r(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function o0(e){var t=e._init;return t(e._payload)}function l0(e){function t(U,_){if(e){var O=U.deletions;O===null?(U.deletions=[_],U.flags|=16):O.push(_)}}function i(U,_){if(!e)return null;for(;_!==null;)t(U,_),_=_.sibling;return null}function o(U){for(var _=new Map;U!==null;)U.key!==null?_.set(U.key,U):_.set(U.index,U),U=U.sibling;return _}function c(U,_){return U=fa(U,_),U.index=0,U.sibling=null,U}function d(U,_,O){return U.index=O,e?(O=U.alternate,O!==null?(O=O.index,O<_?(U.flags|=67108866,_):O):(U.flags|=67108866,_)):(U.flags|=1048576,_)}function y(U){return e&&U.alternate===null&&(U.flags|=67108866),U}function S(U,_,O,Z){return _===null||_.tag!==6?(_=Fu(O,U.mode,Z),_.return=U,_):(_=c(_,O),_.return=U,_)}function x(U,_,O,Z){var ue=O.type;return ue===M?K(U,_,O.props.children,Z,O.key):_!==null&&(_.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===oe&&o0(ue)===_.type)?(_=c(_,O.props),Lr(_,O),_.return=U,_):(_=rl(O.type,O.key,O.props,null,U.mode,Z),Lr(_,O),_.return=U,_)}function z(U,_,O,Z){return _===null||_.tag!==4||_.stateNode.containerInfo!==O.containerInfo||_.stateNode.implementation!==O.implementation?(_=Yu(O,U.mode,Z),_.return=U,_):(_=c(_,O.children||[]),_.return=U,_)}function K(U,_,O,Z,ue){return _===null||_.tag!==7?(_=_i(O,U.mode,Z,ue),_.return=U,_):(_=c(_,O),_.return=U,_)}function J(U,_,O){if(typeof _=="string"&&_!==""||typeof _=="number"||typeof _=="bigint")return _=Fu(""+_,U.mode,O),_.return=U,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case v:return O=rl(_.type,_.key,_.props,null,U.mode,O),Lr(O,_),O.return=U,O;case E:return _=Yu(_,U.mode,O),_.return=U,_;case oe:var Z=_._init;return _=Z(_._payload),J(U,_,O)}if(B(_)||k(_))return _=_i(_,U.mode,O,null),_.return=U,_;if(typeof _.then=="function")return J(U,xl(_),O);if(_.$$typeof===I)return J(U,ul(U,_),O);wl(U,_)}return null}function H(U,_,O,Z){var ue=_!==null?_.key:null;if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return ue!==null?null:S(U,_,""+O,Z);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case v:return O.key===ue?x(U,_,O,Z):null;case E:return O.key===ue?z(U,_,O,Z):null;case oe:return ue=O._init,O=ue(O._payload),H(U,_,O,Z)}if(B(O)||k(O))return ue!==null?null:K(U,_,O,Z,null);if(typeof O.then=="function")return H(U,_,xl(O),Z);if(O.$$typeof===I)return H(U,_,ul(U,O),Z);wl(U,O)}return null}function j(U,_,O,Z,ue){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return U=U.get(O)||null,S(_,U,""+Z,ue);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case v:return U=U.get(Z.key===null?O:Z.key)||null,x(_,U,Z,ue);case E:return U=U.get(Z.key===null?O:Z.key)||null,z(_,U,Z,ue);case oe:var Me=Z._init;return Z=Me(Z._payload),j(U,_,O,Z,ue)}if(B(Z)||k(Z))return U=U.get(O)||null,K(_,U,Z,ue,null);if(typeof Z.then=="function")return j(U,_,O,xl(Z),ue);if(Z.$$typeof===I)return j(U,_,O,ul(_,Z),ue);wl(_,Z)}return null}function be(U,_,O,Z){for(var ue=null,Me=null,me=_,ye=_=0,Mt=null;me!==null&&ye<O.length;ye++){me.index>ye?(Mt=me,me=null):Mt=me.sibling;var ke=H(U,me,O[ye],Z);if(ke===null){me===null&&(me=Mt);break}e&&me&&ke.alternate===null&&t(U,me),_=d(ke,_,ye),Me===null?ue=ke:Me.sibling=ke,Me=ke,me=Mt}if(ye===O.length)return i(U,me),De&&Ni(U,ye),ue;if(me===null){for(;ye<O.length;ye++)me=J(U,O[ye],Z),me!==null&&(_=d(me,_,ye),Me===null?ue=me:Me.sibling=me,Me=me);return De&&Ni(U,ye),ue}for(me=o(me);ye<O.length;ye++)Mt=j(me,U,ye,O[ye],Z),Mt!==null&&(e&&Mt.alternate!==null&&me.delete(Mt.key===null?ye:Mt.key),_=d(Mt,_,ye),Me===null?ue=Mt:Me.sibling=Mt,Me=Mt);return e&&me.forEach(function(ui){return t(U,ui)}),De&&Ni(U,ye),ue}function pe(U,_,O,Z){if(O==null)throw Error(r(151));for(var ue=null,Me=null,me=_,ye=_=0,Mt=null,ke=O.next();me!==null&&!ke.done;ye++,ke=O.next()){me.index>ye?(Mt=me,me=null):Mt=me.sibling;var ui=H(U,me,ke.value,Z);if(ui===null){me===null&&(me=Mt);break}e&&me&&ui.alternate===null&&t(U,me),_=d(ui,_,ye),Me===null?ue=ui:Me.sibling=ui,Me=ui,me=Mt}if(ke.done)return i(U,me),De&&Ni(U,ye),ue;if(me===null){for(;!ke.done;ye++,ke=O.next())ke=J(U,ke.value,Z),ke!==null&&(_=d(ke,_,ye),Me===null?ue=ke:Me.sibling=ke,Me=ke);return De&&Ni(U,ye),ue}for(me=o(me);!ke.done;ye++,ke=O.next())ke=j(me,U,ye,ke.value,Z),ke!==null&&(e&&ke.alternate!==null&&me.delete(ke.key===null?ye:ke.key),_=d(ke,_,ye),Me===null?ue=ke:Me.sibling=ke,Me=ke);return e&&me.forEach(function(JS){return t(U,JS)}),De&&Ni(U,ye),ue}function He(U,_,O,Z){if(typeof O=="object"&&O!==null&&O.type===M&&O.key===null&&(O=O.props.children),typeof O=="object"&&O!==null){switch(O.$$typeof){case v:e:{for(var ue=O.key;_!==null;){if(_.key===ue){if(ue=O.type,ue===M){if(_.tag===7){i(U,_.sibling),Z=c(_,O.props.children),Z.return=U,U=Z;break e}}else if(_.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===oe&&o0(ue)===_.type){i(U,_.sibling),Z=c(_,O.props),Lr(Z,O),Z.return=U,U=Z;break e}i(U,_);break}else t(U,_);_=_.sibling}O.type===M?(Z=_i(O.props.children,U.mode,Z,O.key),Z.return=U,U=Z):(Z=rl(O.type,O.key,O.props,null,U.mode,Z),Lr(Z,O),Z.return=U,U=Z)}return y(U);case E:e:{for(ue=O.key;_!==null;){if(_.key===ue)if(_.tag===4&&_.stateNode.containerInfo===O.containerInfo&&_.stateNode.implementation===O.implementation){i(U,_.sibling),Z=c(_,O.children||[]),Z.return=U,U=Z;break e}else{i(U,_);break}else t(U,_);_=_.sibling}Z=Yu(O,U.mode,Z),Z.return=U,U=Z}return y(U);case oe:return ue=O._init,O=ue(O._payload),He(U,_,O,Z)}if(B(O))return be(U,_,O,Z);if(k(O)){if(ue=k(O),typeof ue!="function")throw Error(r(150));return O=ue.call(O),pe(U,_,O,Z)}if(typeof O.then=="function")return He(U,_,xl(O),Z);if(O.$$typeof===I)return He(U,_,ul(U,O),Z);wl(U,O)}return typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint"?(O=""+O,_!==null&&_.tag===6?(i(U,_.sibling),Z=c(_,O),Z.return=U,U=Z):(i(U,_),Z=Fu(O,U.mode,Z),Z.return=U,U=Z),y(U)):i(U,_)}return function(U,_,O,Z){try{Dr=0;var ue=He(U,_,O,Z);return xs=null,ue}catch(me){if(me===xr||me===fl)throw me;var Me=Wt(29,me,null,U.mode);return Me.lanes=Z,Me.return=U,Me}finally{}}}var ws=l0(!0),c0=l0(!1),pn=$(null),Gn=null;function Qa(e){var t=e.alternate;ae(mt,mt.current&1),ae(pn,e),Gn===null&&(t===null||vs.current!==null||t.memoizedState!==null)&&(Gn=e)}function u0(e){if(e.tag===22){if(ae(mt,mt.current),ae(pn,e),Gn===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(Gn=e)}}else Pa()}function Pa(){ae(mt,mt.current),ae(pn,pn.current)}function ba(e){W(pn),Gn===e&&(Gn=null),W(mt)}var mt=$(0);function Al(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||hf(i)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function xd(e,t,i,o){t=e.memoizedState,i=i(o,t),i=i==null?t:g({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var wd={enqueueSetState:function(e,t,i){e=e._reactInternals;var o=an(),c=Va(o);c.payload=t,i!=null&&(c.callback=i),t=Xa(e,c,o),t!==null&&(sn(t,e,o),Ar(t,e,o))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var o=an(),c=Va(o);c.tag=1,c.payload=t,i!=null&&(c.callback=i),t=Xa(e,c,o),t!==null&&(sn(t,e,o),Ar(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=an(),o=Va(i);o.tag=2,t!=null&&(o.callback=t),t=Xa(e,o,i),t!==null&&(sn(t,e,i),Ar(t,e,i))}};function d0(e,t,i,o,c,d,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,d,y):t.prototype&&t.prototype.isPureReactComponent?!pr(i,o)||!pr(c,d):!0}function f0(e,t,i,o){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,o),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,o),t.state!==e&&wd.enqueueReplaceState(t,t.state,null)}function zi(e,t){var i=t;if("ref"in t){i={};for(var o in t)o!=="ref"&&(i[o]=t[o])}if(e=e.defaultProps){i===t&&(i=g({},i));for(var c in e)i[c]===void 0&&(i[c]=e[c])}return i}var Cl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function h0(e){Cl(e)}function m0(e){console.error(e)}function p0(e){Cl(e)}function Tl(e,t){try{var i=e.onUncaughtError;i(t.value,{componentStack:t.stack})}catch(o){setTimeout(function(){throw o})}}function g0(e,t,i){try{var o=e.onCaughtError;o(i.value,{componentStack:i.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Ad(e,t,i){return i=Va(i),i.tag=3,i.payload={element:null},i.callback=function(){Tl(e,t)},i}function y0(e){return e=Va(e),e.tag=3,e}function b0(e,t,i,o){var c=i.type.getDerivedStateFromError;if(typeof c=="function"){var d=o.value;e.payload=function(){return c(d)},e.callback=function(){g0(t,i,o)}}var y=i.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){g0(t,i,o),typeof c!="function"&&(ni===null?ni=new Set([this]):ni.add(this));var S=o.stack;this.componentDidCatch(o.value,{componentStack:S!==null?S:""})})}function J1(e,t,i,o,c){if(i.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(t=i.alternate,t!==null&&Sr(t,i,c,!0),i=pn.current,i!==null){switch(i.tag){case 13:return Gn===null?Qd():i.alternate===null&&it===0&&(it=3),i.flags&=-257,i.flags|=65536,i.lanes=c,o===ed?i.flags|=16384:(t=i.updateQueue,t===null?i.updateQueue=new Set([o]):t.add(o),Zd(e,o,c)),!1;case 22:return i.flags|=65536,o===ed?i.flags|=16384:(t=i.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([o])},i.updateQueue=t):(i=t.retryQueue,i===null?t.retryQueue=new Set([o]):i.add(o)),Zd(e,o,c)),!1}throw Error(r(435,i.tag))}return Zd(e,o,c),Qd(),!1}if(De)return t=pn.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=c,o!==Xu&&(e=Error(r(422),{cause:o}),vr(dn(e,i)))):(o!==Xu&&(t=Error(r(423),{cause:o}),vr(dn(t,i))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,o=dn(o,i),c=Ad(e.stateNode,o,c),ad(e,c),it!==4&&(it=2)),!1;var d=Error(r(520),{cause:o});if(d=dn(d,i),Ir===null?Ir=[d]:Ir.push(d),it!==4&&(it=2),t===null)return!0;o=dn(o,i),i=t;do{switch(i.tag){case 3:return i.flags|=65536,e=c&-c,i.lanes|=e,e=Ad(i.stateNode,o,e),ad(i,e),!1;case 1:if(t=i.type,d=i.stateNode,(i.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(ni===null||!ni.has(d))))return i.flags|=65536,c&=-c,i.lanes|=c,c=y0(c),b0(c,e,i,o),ad(i,c),!1}i=i.return}while(i!==null);return!1}var v0=Error(r(461)),St=!1;function wt(e,t,i,o){t.child=e===null?c0(t,null,i,o):ws(t,e.child,i,o)}function S0(e,t,i,o,c){i=i.render;var d=t.ref;if("ref"in o){var y={};for(var S in o)S!=="ref"&&(y[S]=o[S])}else y=o;return Ui(t),o=ld(e,t,i,y,d,c),S=cd(),e!==null&&!St?(ud(e,t,c),va(e,t,c)):(De&&S&&$u(t),t.flags|=1,wt(e,t,o,c),t.child)}function E0(e,t,i,o,c){if(e===null){var d=i.type;return typeof d=="function"&&!Gu(d)&&d.defaultProps===void 0&&i.compare===null?(t.tag=15,t.type=d,M0(e,t,d,o,c)):(e=rl(i.type,null,o,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(d=e.child,!Ld(e,c)){var y=d.memoizedProps;if(i=i.compare,i=i!==null?i:pr,i(y,o)&&e.ref===t.ref)return va(e,t,c)}return t.flags|=1,e=fa(d,o),e.ref=t.ref,e.return=t,t.child=e}function M0(e,t,i,o,c){if(e!==null){var d=e.memoizedProps;if(pr(d,o)&&e.ref===t.ref)if(St=!1,t.pendingProps=o=d,Ld(e,c))(e.flags&131072)!==0&&(St=!0);else return t.lanes=e.lanes,va(e,t,c)}return Cd(e,t,i,o,c)}function x0(e,t,i){var o=t.pendingProps,c=o.children,d=e!==null?e.memoizedState:null;if(o.mode==="hidden"){if((t.flags&128)!==0){if(o=d!==null?d.baseLanes|i:i,e!==null){for(c=t.child=e.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;t.childLanes=d&~o}else t.childLanes=0,t.child=null;return w0(e,t,o,i)}if((i&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&dl(t,d!==null?d.cachePool:null),d!==null?Mp(t,d):sd(),u0(t);else return t.lanes=t.childLanes=536870912,w0(e,t,d!==null?d.baseLanes|i:i,i)}else d!==null?(dl(t,d.cachePool),Mp(t,d),Pa(),t.memoizedState=null):(e!==null&&dl(t,null),sd(),Pa());return wt(e,t,c,i),t.child}function w0(e,t,i,o){var c=Wu();return c=c===null?null:{parent:ht._currentValue,pool:c},t.memoizedState={baseLanes:i,cachePool:c},e!==null&&dl(t,null),sd(),u0(t),e!==null&&Sr(e,t,o,!0),null}function _l(e,t){var i=t.ref;if(i===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(r(284));(e===null||e.ref!==i)&&(t.flags|=4194816)}}function Cd(e,t,i,o,c){return Ui(t),i=ld(e,t,i,o,void 0,c),o=cd(),e!==null&&!St?(ud(e,t,c),va(e,t,c)):(De&&o&&$u(t),t.flags|=1,wt(e,t,i,c),t.child)}function A0(e,t,i,o,c,d){return Ui(t),t.updateQueue=null,i=wp(t,o,i,c),xp(e),o=cd(),e!==null&&!St?(ud(e,t,d),va(e,t,d)):(De&&o&&$u(t),t.flags|=1,wt(e,t,i,d),t.child)}function C0(e,t,i,o,c){if(Ui(t),t.stateNode===null){var d=ms,y=i.contextType;typeof y=="object"&&y!==null&&(d=Rt(y)),d=new i(o,d),t.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=wd,t.stateNode=d,d._reactInternals=t,d=t.stateNode,d.props=o,d.state=t.memoizedState,d.refs={},td(t),y=i.contextType,d.context=typeof y=="object"&&y!==null?Rt(y):ms,d.state=t.memoizedState,y=i.getDerivedStateFromProps,typeof y=="function"&&(xd(t,i,y,o),d.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(y=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),y!==d.state&&wd.enqueueReplaceState(d,d.state,null),Tr(t,o,d,c),Cr(),d.state=t.memoizedState),typeof d.componentDidMount=="function"&&(t.flags|=4194308),o=!0}else if(e===null){d=t.stateNode;var S=t.memoizedProps,x=zi(i,S);d.props=x;var z=d.context,K=i.contextType;y=ms,typeof K=="object"&&K!==null&&(y=Rt(K));var J=i.getDerivedStateFromProps;K=typeof J=="function"||typeof d.getSnapshotBeforeUpdate=="function",S=t.pendingProps!==S,K||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(S||z!==y)&&f0(t,d,o,y),$a=!1;var H=t.memoizedState;d.state=H,Tr(t,o,d,c),Cr(),z=t.memoizedState,S||H!==z||$a?(typeof J=="function"&&(xd(t,i,J,o),z=t.memoizedState),(x=$a||d0(t,i,x,o,H,z,y))?(K||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=o,t.memoizedState=z),d.props=o,d.state=z,d.context=y,o=x):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),o=!1)}else{d=t.stateNode,nd(e,t),y=t.memoizedProps,K=zi(i,y),d.props=K,J=t.pendingProps,H=d.context,z=i.contextType,x=ms,typeof z=="object"&&z!==null&&(x=Rt(z)),S=i.getDerivedStateFromProps,(z=typeof S=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(y!==J||H!==x)&&f0(t,d,o,x),$a=!1,H=t.memoizedState,d.state=H,Tr(t,o,d,c),Cr();var j=t.memoizedState;y!==J||H!==j||$a||e!==null&&e.dependencies!==null&&cl(e.dependencies)?(typeof S=="function"&&(xd(t,i,S,o),j=t.memoizedState),(K=$a||d0(t,i,K,o,H,j,x)||e!==null&&e.dependencies!==null&&cl(e.dependencies))?(z||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(o,j,x),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(o,j,x)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(t.flags|=1024),t.memoizedProps=o,t.memoizedState=j),d.props=o,d.state=j,d.context=x,o=K):(typeof d.componentDidUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&H===e.memoizedState||(t.flags|=1024),o=!1)}return d=o,_l(e,t),o=(t.flags&128)!==0,d||o?(d=t.stateNode,i=o&&typeof i.getDerivedStateFromError!="function"?null:d.render(),t.flags|=1,e!==null&&o?(t.child=ws(t,e.child,null,c),t.child=ws(t,null,i,c)):wt(e,t,i,c),t.memoizedState=d.state,e=t.child):e=va(e,t,c),e}function T0(e,t,i,o){return br(),t.flags|=256,wt(e,t,i,o),t.child}var Td={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _d(e){return{baseLanes:e,cachePool:mp()}}function Rd(e,t,i){return e=e!==null?e.childLanes&~i:0,t&&(e|=gn),e}function _0(e,t,i){var o=t.pendingProps,c=!1,d=(t.flags&128)!==0,y;if((y=d)||(y=e!==null&&e.memoizedState===null?!1:(mt.current&2)!==0),y&&(c=!0,t.flags&=-129),y=(t.flags&32)!==0,t.flags&=-33,e===null){if(De){if(c?Qa(t):Pa(),De){var S=at,x;if(x=S){e:{for(x=S,S=jn;x.nodeType!==8;){if(!S){S=null;break e}if(x=An(x.nextSibling),x===null){S=null;break e}}S=x}S!==null?(t.memoizedState={dehydrated:S,treeContext:Ri!==null?{id:ha,overflow:ma}:null,retryLane:536870912,hydrationErrors:null},x=Wt(18,null,null,0),x.stateNode=S,x.return=t,t.child=x,Ut=t,at=null,x=!0):x=!1}x||Di(t)}if(S=t.memoizedState,S!==null&&(S=S.dehydrated,S!==null))return hf(S)?t.lanes=32:t.lanes=536870912,null;ba(t)}return S=o.children,o=o.fallback,c?(Pa(),c=t.mode,S=Rl({mode:"hidden",children:S},c),o=_i(o,c,i,null),S.return=t,o.return=t,S.sibling=o,t.child=S,c=t.child,c.memoizedState=_d(i),c.childLanes=Rd(e,y,i),t.memoizedState=Td,o):(Qa(t),Nd(t,S))}if(x=e.memoizedState,x!==null&&(S=x.dehydrated,S!==null)){if(d)t.flags&256?(Qa(t),t.flags&=-257,t=kd(e,t,i)):t.memoizedState!==null?(Pa(),t.child=e.child,t.flags|=128,t=null):(Pa(),c=o.fallback,S=t.mode,o=Rl({mode:"visible",children:o.children},S),c=_i(c,S,i,null),c.flags|=2,o.return=t,c.return=t,o.sibling=c,t.child=o,ws(t,e.child,null,i),o=t.child,o.memoizedState=_d(i),o.childLanes=Rd(e,y,i),t.memoizedState=Td,t=c);else if(Qa(t),hf(S)){if(y=S.nextSibling&&S.nextSibling.dataset,y)var z=y.dgst;y=z,o=Error(r(419)),o.stack="",o.digest=y,vr({value:o,source:null,stack:null}),t=kd(e,t,i)}else if(St||Sr(e,t,i,!1),y=(i&e.childLanes)!==0,St||y){if(y=Ye,y!==null&&(o=i&-i,o=(o&42)!==0?1:rr(o),o=(o&(y.suspendedLanes|i))!==0?0:o,o!==0&&o!==x.retryLane))throw x.retryLane=o,hs(e,o),sn(y,e,o),v0;S.data==="$?"||Qd(),t=kd(e,t,i)}else S.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=x.treeContext,at=An(S.nextSibling),Ut=t,De=!0,ki=null,jn=!1,e!==null&&(hn[mn++]=ha,hn[mn++]=ma,hn[mn++]=Ri,ha=e.id,ma=e.overflow,Ri=t),t=Nd(t,o.children),t.flags|=4096);return t}return c?(Pa(),c=o.fallback,S=t.mode,x=e.child,z=x.sibling,o=fa(x,{mode:"hidden",children:o.children}),o.subtreeFlags=x.subtreeFlags&65011712,z!==null?c=fa(z,c):(c=_i(c,S,i,null),c.flags|=2),c.return=t,o.return=t,o.sibling=c,t.child=o,o=c,c=t.child,S=e.child.memoizedState,S===null?S=_d(i):(x=S.cachePool,x!==null?(z=ht._currentValue,x=x.parent!==z?{parent:z,pool:z}:x):x=mp(),S={baseLanes:S.baseLanes|i,cachePool:x}),c.memoizedState=S,c.childLanes=Rd(e,y,i),t.memoizedState=Td,o):(Qa(t),i=e.child,e=i.sibling,i=fa(i,{mode:"visible",children:o.children}),i.return=t,i.sibling=null,e!==null&&(y=t.deletions,y===null?(t.deletions=[e],t.flags|=16):y.push(e)),t.child=i,t.memoizedState=null,i)}function Nd(e,t){return t=Rl({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Rl(e,t){return e=Wt(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function kd(e,t,i){return ws(t,e.child,null,i),e=Nd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function R0(e,t,i){e.lanes|=t;var o=e.alternate;o!==null&&(o.lanes|=t),Qu(e.return,t,i)}function Dd(e,t,i,o,c){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:o,tail:i,tailMode:c}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=o,d.tail=i,d.tailMode=c)}function N0(e,t,i){var o=t.pendingProps,c=o.revealOrder,d=o.tail;if(wt(e,t,o.children,i),o=mt.current,(o&2)!==0)o=o&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&R0(e,i,t);else if(e.tag===19)R0(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}switch(ae(mt,o),c){case"forwards":for(i=t.child,c=null;i!==null;)e=i.alternate,e!==null&&Al(e)===null&&(c=i),i=i.sibling;i=c,i===null?(c=t.child,t.child=null):(c=i.sibling,i.sibling=null),Dd(t,!1,c,i,d);break;case"backwards":for(i=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&Al(e)===null){t.child=c;break}e=c.sibling,c.sibling=i,i=c,c=e}Dd(t,!0,i,null,d);break;case"together":Dd(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function va(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),ti|=t.lanes,(i&t.childLanes)===0)if(e!==null){if(Sr(e,t,i,!1),(i&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(r(153));if(t.child!==null){for(e=t.child,i=fa(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=fa(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function Ld(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&cl(e)))}function W1(e,t,i){switch(t.tag){case 3:xe(t,t.stateNode.containerInfo),Ya(t,ht,e.memoizedState.cache),br();break;case 27:case 5:on(t);break;case 4:xe(t,t.stateNode.containerInfo);break;case 10:Ya(t,t.type,t.memoizedProps.value);break;case 13:var o=t.memoizedState;if(o!==null)return o.dehydrated!==null?(Qa(t),t.flags|=128,null):(i&t.child.childLanes)!==0?_0(e,t,i):(Qa(t),e=va(e,t,i),e!==null?e.sibling:null);Qa(t);break;case 19:var c=(e.flags&128)!==0;if(o=(i&t.childLanes)!==0,o||(Sr(e,t,i,!1),o=(i&t.childLanes)!==0),c){if(o)return N0(e,t,i);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),ae(mt,mt.current),o)break;return null;case 22:case 23:return t.lanes=0,x0(e,t,i);case 24:Ya(t,ht,e.memoizedState.cache)}return va(e,t,i)}function k0(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps)St=!0;else{if(!Ld(e,i)&&(t.flags&128)===0)return St=!1,W1(e,t,i);St=(e.flags&131072)!==0}else St=!1,De&&(t.flags&1048576)!==0&&op(t,ll,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var o=t.elementType,c=o._init;if(o=c(o._payload),t.type=o,typeof o=="function")Gu(o)?(e=zi(o,e),t.tag=1,t=C0(null,t,o,e,i)):(t.tag=0,t=Cd(null,t,o,e,i));else{if(o!=null){if(c=o.$$typeof,c===Y){t.tag=11,t=S0(null,t,o,e,i);break e}else if(c===ee){t.tag=14,t=E0(null,t,o,e,i);break e}}throw t=F(o)||o,Error(r(306,t,""))}}return t;case 0:return Cd(e,t,t.type,t.pendingProps,i);case 1:return o=t.type,c=zi(o,t.pendingProps),C0(e,t,o,c,i);case 3:e:{if(xe(t,t.stateNode.containerInfo),e===null)throw Error(r(387));o=t.pendingProps;var d=t.memoizedState;c=d.element,nd(e,t),Tr(t,o,null,i);var y=t.memoizedState;if(o=y.cache,Ya(t,ht,o),o!==d.cache&&Pu(t,[ht],i,!0),Cr(),o=y.element,d.isDehydrated)if(d={element:o,isDehydrated:!1,cache:y.cache},t.updateQueue.baseState=d,t.memoizedState=d,t.flags&256){t=T0(e,t,o,i);break e}else if(o!==c){c=dn(Error(r(424)),t),vr(c),t=T0(e,t,o,i);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(at=An(e.firstChild),Ut=t,De=!0,ki=null,jn=!0,i=c0(t,null,o,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(br(),o===c){t=va(e,t,i);break e}wt(e,t,o,i)}t=t.child}return t;case 26:return _l(e,t),e===null?(i=Og(t.type,null,t.pendingProps,null))?t.memoizedState=i:De||(i=t.type,e=t.pendingProps,o=Fl(de.current).createElement(i),o[We]=t,o[dt]=e,Ct(o,i,e),et(o),t.stateNode=o):t.memoizedState=Og(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return on(t),e===null&&De&&(o=t.stateNode=Dg(t.type,t.pendingProps,de.current),Ut=t,jn=!0,c=at,si(t.type)?(mf=c,at=An(o.firstChild)):at=c),wt(e,t,t.pendingProps.children,i),_l(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&De&&((c=o=at)&&(o=TS(o,t.type,t.pendingProps,jn),o!==null?(t.stateNode=o,Ut=t,at=An(o.firstChild),jn=!1,c=!0):c=!1),c||Di(t)),on(t),c=t.type,d=t.pendingProps,y=e!==null?e.memoizedProps:null,o=d.children,uf(c,d)?o=null:y!==null&&uf(c,y)&&(t.flags|=32),t.memoizedState!==null&&(c=ld(e,t,$1,null,null,i),Qr._currentValue=c),_l(e,t),wt(e,t,o,i),t.child;case 6:return e===null&&De&&((e=i=at)&&(i=_S(i,t.pendingProps,jn),i!==null?(t.stateNode=i,Ut=t,at=null,e=!0):e=!1),e||Di(t)),null;case 13:return _0(e,t,i);case 4:return xe(t,t.stateNode.containerInfo),o=t.pendingProps,e===null?t.child=ws(t,null,o,i):wt(e,t,o,i),t.child;case 11:return S0(e,t,t.type,t.pendingProps,i);case 7:return wt(e,t,t.pendingProps,i),t.child;case 8:return wt(e,t,t.pendingProps.children,i),t.child;case 12:return wt(e,t,t.pendingProps.children,i),t.child;case 10:return o=t.pendingProps,Ya(t,t.type,o.value),wt(e,t,o.children,i),t.child;case 9:return c=t.type._context,o=t.pendingProps.children,Ui(t),c=Rt(c),o=o(c),t.flags|=1,wt(e,t,o,i),t.child;case 14:return E0(e,t,t.type,t.pendingProps,i);case 15:return M0(e,t,t.type,t.pendingProps,i);case 19:return N0(e,t,i);case 31:return o=t.pendingProps,i=t.mode,o={mode:o.mode,children:o.children},e===null?(i=Rl(o,i),i.ref=t.ref,t.child=i,i.return=t,t=i):(i=fa(e.child,o),i.ref=t.ref,t.child=i,i.return=t,t=i),t;case 22:return x0(e,t,i);case 24:return Ui(t),o=Rt(ht),e===null?(c=Wu(),c===null&&(c=Ye,d=Zu(),c.pooledCache=d,d.refCount++,d!==null&&(c.pooledCacheLanes|=i),c=d),t.memoizedState={parent:o,cache:c},td(t),Ya(t,ht,c)):((e.lanes&i)!==0&&(nd(e,t),Tr(t,null,null,i),Cr()),c=e.memoizedState,d=t.memoizedState,c.parent!==o?(c={parent:o,cache:o},t.memoizedState=c,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=c),Ya(t,ht,o)):(o=d.cache,Ya(t,ht,o),o!==c.cache&&Pu(t,[ht],i,!0))),wt(e,t,t.pendingProps.children,i),t.child;case 29:throw t.pendingProps}throw Error(r(156,t.tag))}function Sa(e){e.flags|=4}function D0(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Ig(t)){if(t=pn.current,t!==null&&((Ne&4194048)===Ne?Gn!==null:(Ne&62914560)!==Ne&&(Ne&536870912)===0||t!==Gn))throw wr=ed,pp;e.flags|=8192}}function Nl(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?Ho():536870912,e.lanes|=t,_s|=t)}function Ur(e,t){if(!De)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function Ze(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,o=0;if(t)for(var c=e.child;c!==null;)i|=c.lanes|c.childLanes,o|=c.subtreeFlags&65011712,o|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)i|=c.lanes|c.childLanes,o|=c.subtreeFlags,o|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=o,e.childLanes=i,t}function eS(e,t,i){var o=t.pendingProps;switch(Vu(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ze(t),null;case 1:return Ze(t),null;case 3:return i=t.stateNode,o=null,e!==null&&(o=e.memoizedState.cache),t.memoizedState.cache!==o&&(t.flags|=2048),ga(ht),xt(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(yr(t)?Sa(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,up())),Ze(t),null;case 26:return i=t.memoizedState,e===null?(Sa(t),i!==null?(Ze(t),D0(t,i)):(Ze(t),t.flags&=-16777217)):i?i!==e.memoizedState?(Sa(t),Ze(t),D0(t,i)):(Ze(t),t.flags&=-16777217):(e.memoizedProps!==o&&Sa(t),Ze(t),t.flags&=-16777217),null;case 27:ln(t),i=de.current;var c=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==o&&Sa(t);else{if(!o){if(t.stateNode===null)throw Error(r(166));return Ze(t),null}e=le.current,yr(t)?lp(t):(e=Dg(c,o,i),t.stateNode=e,Sa(t))}return Ze(t),null;case 5:if(ln(t),i=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==o&&Sa(t);else{if(!o){if(t.stateNode===null)throw Error(r(166));return Ze(t),null}if(e=le.current,yr(t))lp(t);else{switch(c=Fl(de.current),e){case 1:e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":e=c.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":e=c.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof o.is=="string"?c.createElement("select",{is:o.is}):c.createElement("select"),o.multiple?e.multiple=!0:o.size&&(e.size=o.size);break;default:e=typeof o.is=="string"?c.createElement(i,{is:o.is}):c.createElement(i)}}e[We]=t,e[dt]=o;e:for(c=t.child;c!==null;){if(c.tag===5||c.tag===6)e.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===t)break e;for(;c.sibling===null;){if(c.return===null||c.return===t)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}t.stateNode=e;e:switch(Ct(e,i,o),i){case"button":case"input":case"select":case"textarea":e=!!o.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Sa(t)}}return Ze(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==o&&Sa(t);else{if(typeof o!="string"&&t.stateNode===null)throw Error(r(166));if(e=de.current,yr(t)){if(e=t.stateNode,i=t.memoizedProps,o=null,c=Ut,c!==null)switch(c.tag){case 27:case 5:o=c.memoizedProps}e[We]=t,e=!!(e.nodeValue===i||o!==null&&o.suppressHydrationWarning===!0||Ag(e.nodeValue,i)),e||Di(t)}else e=Fl(e).createTextNode(o),e[We]=t,t.stateNode=e}return Ze(t),null;case 13:if(o=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=yr(t),o!==null&&o.dehydrated!==null){if(e===null){if(!c)throw Error(r(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));c[We]=t}else br(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Ze(t),c=!1}else c=up(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return t.flags&256?(ba(t),t):(ba(t),null)}if(ba(t),(t.flags&128)!==0)return t.lanes=i,t;if(i=o!==null,e=e!==null&&e.memoizedState!==null,i){o=t.child,c=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(c=o.alternate.memoizedState.cachePool.pool);var d=null;o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),d!==c&&(o.flags|=2048)}return i!==e&&i&&(t.child.flags|=8192),Nl(t,t.updateQueue),Ze(t),null;case 4:return xt(),e===null&&sf(t.stateNode.containerInfo),Ze(t),null;case 10:return ga(t.type),Ze(t),null;case 19:if(W(mt),c=t.memoizedState,c===null)return Ze(t),null;if(o=(t.flags&128)!==0,d=c.rendering,d===null)if(o)Ur(c,!1);else{if(it!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(d=Al(e),d!==null){for(t.flags|=128,Ur(c,!1),e=d.updateQueue,t.updateQueue=e,Nl(t,e),t.subtreeFlags=0,e=i,i=t.child;i!==null;)rp(i,e),i=i.sibling;return ae(mt,mt.current&1|2),t.child}e=e.sibling}c.tail!==null&&ce()>Ll&&(t.flags|=128,o=!0,Ur(c,!1),t.lanes=4194304)}else{if(!o)if(e=Al(d),e!==null){if(t.flags|=128,o=!0,e=e.updateQueue,t.updateQueue=e,Nl(t,e),Ur(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!De)return Ze(t),null}else 2*ce()-c.renderingStartTime>Ll&&i!==536870912&&(t.flags|=128,o=!0,Ur(c,!1),t.lanes=4194304);c.isBackwards?(d.sibling=t.child,t.child=d):(e=c.last,e!==null?e.sibling=d:t.child=d,c.last=d)}return c.tail!==null?(t=c.tail,c.rendering=t,c.tail=t.sibling,c.renderingStartTime=ce(),t.sibling=null,e=mt.current,ae(mt,o?e&1|2:e&1),t):(Ze(t),null);case 22:case 23:return ba(t),rd(),o=t.memoizedState!==null,e!==null?e.memoizedState!==null!==o&&(t.flags|=8192):o&&(t.flags|=8192),o?(i&536870912)!==0&&(t.flags&128)===0&&(Ze(t),t.subtreeFlags&6&&(t.flags|=8192)):Ze(t),i=t.updateQueue,i!==null&&Nl(t,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),o=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),o!==i&&(t.flags|=2048),e!==null&&W(Oi),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),ga(ht),Ze(t),null;case 25:return null;case 30:return null}throw Error(r(156,t.tag))}function tS(e,t){switch(Vu(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ga(ht),xt(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return ln(t),null;case 13:if(ba(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(r(340));br()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return W(mt),null;case 4:return xt(),null;case 10:return ga(t.type),null;case 22:case 23:return ba(t),rd(),e!==null&&W(Oi),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return ga(ht),null;case 25:return null;default:return null}}function L0(e,t){switch(Vu(t),t.tag){case 3:ga(ht),xt();break;case 26:case 27:case 5:ln(t);break;case 4:xt();break;case 13:ba(t);break;case 19:W(mt);break;case 10:ga(t.type);break;case 22:case 23:ba(t),rd(),e!==null&&W(Oi);break;case 24:ga(ht)}}function Or(e,t){try{var i=t.updateQueue,o=i!==null?i.lastEffect:null;if(o!==null){var c=o.next;i=c;do{if((i.tag&e)===e){o=void 0;var d=i.create,y=i.inst;o=d(),y.destroy=o}i=i.next}while(i!==c)}}catch(S){Fe(t,t.return,S)}}function Za(e,t,i){try{var o=t.updateQueue,c=o!==null?o.lastEffect:null;if(c!==null){var d=c.next;o=d;do{if((o.tag&e)===e){var y=o.inst,S=y.destroy;if(S!==void 0){y.destroy=void 0,c=t;var x=i,z=S;try{z()}catch(K){Fe(c,x,K)}}}o=o.next}while(o!==d)}}catch(K){Fe(t,t.return,K)}}function U0(e){var t=e.updateQueue;if(t!==null){var i=e.stateNode;try{Ep(t,i)}catch(o){Fe(e,e.return,o)}}}function O0(e,t,i){i.props=zi(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(o){Fe(e,t,o)}}function qr(e,t){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var o=e.stateNode;break;case 30:o=e.stateNode;break;default:o=e.stateNode}typeof i=="function"?e.refCleanup=i(o):i.current=o}}catch(c){Fe(e,t,c)}}function Fn(e,t){var i=e.ref,o=e.refCleanup;if(i!==null)if(typeof o=="function")try{o()}catch(c){Fe(e,t,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(c){Fe(e,t,c)}else i.current=null}function q0(e){var t=e.type,i=e.memoizedProps,o=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":i.autoFocus&&o.focus();break e;case"img":i.src?o.src=i.src:i.srcSet&&(o.srcset=i.srcSet)}}catch(c){Fe(e,e.return,c)}}function Ud(e,t,i){try{var o=e.stateNode;MS(o,e.type,i,t),o[dt]=t}catch(c){Fe(e,e.return,c)}}function z0(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&si(e.type)||e.tag===4}function Od(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||z0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&si(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function qd(e,t,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,t):(t=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,t.appendChild(e),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=Gl));else if(o!==4&&(o===27&&si(e.type)&&(i=e.stateNode,t=null),e=e.child,e!==null))for(qd(e,t,i),e=e.sibling;e!==null;)qd(e,t,i),e=e.sibling}function kl(e,t,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(o!==4&&(o===27&&si(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(kl(e,t,i),e=e.sibling;e!==null;)kl(e,t,i),e=e.sibling}function B0(e){var t=e.stateNode,i=e.memoizedProps;try{for(var o=e.type,c=t.attributes;c.length;)t.removeAttributeNode(c[0]);Ct(t,o,i),t[We]=e,t[dt]=i}catch(d){Fe(e,e.return,d)}}var Ea=!1,rt=!1,zd=!1,H0=typeof WeakSet=="function"?WeakSet:Set,Et=null;function nS(e,t){if(e=e.containerInfo,lf=Ql,e=Pm(e),Ou(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var o=i.getSelection&&i.getSelection();if(o&&o.rangeCount!==0){i=o.anchorNode;var c=o.anchorOffset,d=o.focusNode;o=o.focusOffset;try{i.nodeType,d.nodeType}catch{i=null;break e}var y=0,S=-1,x=-1,z=0,K=0,J=e,H=null;t:for(;;){for(var j;J!==i||c!==0&&J.nodeType!==3||(S=y+c),J!==d||o!==0&&J.nodeType!==3||(x=y+o),J.nodeType===3&&(y+=J.nodeValue.length),(j=J.firstChild)!==null;)H=J,J=j;for(;;){if(J===e)break t;if(H===i&&++z===c&&(S=y),H===d&&++K===o&&(x=y),(j=J.nextSibling)!==null)break;J=H,H=J.parentNode}J=j}i=S===-1||x===-1?null:{start:S,end:x}}else i=null}i=i||{start:0,end:0}}else i=null;for(cf={focusedElem:e,selectionRange:i},Ql=!1,Et=t;Et!==null;)if(t=Et,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,Et=e;else for(;Et!==null;){switch(t=Et,d=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,i=t,c=d.memoizedProps,d=d.memoizedState,o=i.stateNode;try{var be=zi(i.type,c,i.elementType===i.type);e=o.getSnapshotBeforeUpdate(be,d),o.__reactInternalSnapshotBeforeUpdate=e}catch(pe){Fe(i,i.return,pe)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,i=e.nodeType,i===9)ff(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":ff(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(r(163))}if(e=t.sibling,e!==null){e.return=t.return,Et=e;break}Et=t.return}}function I0(e,t,i){var o=i.flags;switch(i.tag){case 0:case 11:case 15:Ja(e,i),o&4&&Or(5,i);break;case 1:if(Ja(e,i),o&4)if(e=i.stateNode,t===null)try{e.componentDidMount()}catch(y){Fe(i,i.return,y)}else{var c=zi(i.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(c,t,e.__reactInternalSnapshotBeforeUpdate)}catch(y){Fe(i,i.return,y)}}o&64&&U0(i),o&512&&qr(i,i.return);break;case 3:if(Ja(e,i),o&64&&(e=i.updateQueue,e!==null)){if(t=null,i.child!==null)switch(i.child.tag){case 27:case 5:t=i.child.stateNode;break;case 1:t=i.child.stateNode}try{Ep(e,t)}catch(y){Fe(i,i.return,y)}}break;case 27:t===null&&o&4&&B0(i);case 26:case 5:Ja(e,i),t===null&&o&4&&q0(i),o&512&&qr(i,i.return);break;case 12:Ja(e,i);break;case 13:Ja(e,i),o&4&&F0(e,i),o&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=dS.bind(null,i),RS(e,i))));break;case 22:if(o=i.memoizedState!==null||Ea,!o){t=t!==null&&t.memoizedState!==null||rt,c=Ea;var d=rt;Ea=o,(rt=t)&&!d?Wa(e,i,(i.subtreeFlags&8772)!==0):Ja(e,i),Ea=c,rt=d}break;case 30:break;default:Ja(e,i)}}function j0(e){var t=e.alternate;t!==null&&(e.alternate=null,j0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&is(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ke=null,Ft=!1;function Ma(e,t,i){for(i=i.child;i!==null;)G0(e,t,i),i=i.sibling}function G0(e,t,i){if(Pe&&typeof Pe.onCommitFiberUnmount=="function")try{Pe.onCommitFiberUnmount(Xe,i)}catch{}switch(i.tag){case 26:rt||Fn(i,t),Ma(e,t,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:rt||Fn(i,t);var o=Ke,c=Ft;si(i.type)&&(Ke=i.stateNode,Ft=!1),Ma(e,t,i),$r(i.stateNode),Ke=o,Ft=c;break;case 5:rt||Fn(i,t);case 6:if(o=Ke,c=Ft,Ke=null,Ma(e,t,i),Ke=o,Ft=c,Ke!==null)if(Ft)try{(Ke.nodeType===9?Ke.body:Ke.nodeName==="HTML"?Ke.ownerDocument.body:Ke).removeChild(i.stateNode)}catch(d){Fe(i,t,d)}else try{Ke.removeChild(i.stateNode)}catch(d){Fe(i,t,d)}break;case 18:Ke!==null&&(Ft?(e=Ke,Ng(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),Wr(e)):Ng(Ke,i.stateNode));break;case 4:o=Ke,c=Ft,Ke=i.stateNode.containerInfo,Ft=!0,Ma(e,t,i),Ke=o,Ft=c;break;case 0:case 11:case 14:case 15:rt||Za(2,i,t),rt||Za(4,i,t),Ma(e,t,i);break;case 1:rt||(Fn(i,t),o=i.stateNode,typeof o.componentWillUnmount=="function"&&O0(i,t,o)),Ma(e,t,i);break;case 21:Ma(e,t,i);break;case 22:rt=(o=rt)||i.memoizedState!==null,Ma(e,t,i),rt=o;break;default:Ma(e,t,i)}}function F0(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Wr(e)}catch(i){Fe(t,t.return,i)}}function aS(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new H0),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new H0),t;default:throw Error(r(435,e.tag))}}function Bd(e,t){var i=aS(e);t.forEach(function(o){var c=fS.bind(null,e,o);i.has(o)||(i.add(o),o.then(c,c))})}function en(e,t){var i=t.deletions;if(i!==null)for(var o=0;o<i.length;o++){var c=i[o],d=e,y=t,S=y;e:for(;S!==null;){switch(S.tag){case 27:if(si(S.type)){Ke=S.stateNode,Ft=!1;break e}break;case 5:Ke=S.stateNode,Ft=!1;break e;case 3:case 4:Ke=S.stateNode.containerInfo,Ft=!0;break e}S=S.return}if(Ke===null)throw Error(r(160));G0(d,y,c),Ke=null,Ft=!1,d=c.alternate,d!==null&&(d.return=null),c.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)Y0(t,e),t=t.sibling}var wn=null;function Y0(e,t){var i=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:en(t,e),tn(e),o&4&&(Za(3,e,e.return),Or(3,e),Za(5,e,e.return));break;case 1:en(t,e),tn(e),o&512&&(rt||i===null||Fn(i,i.return)),o&64&&Ea&&(e=e.updateQueue,e!==null&&(o=e.callbacks,o!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?o:i.concat(o))));break;case 26:var c=wn;if(en(t,e),tn(e),o&512&&(rt||i===null||Fn(i,i.return)),o&4){var d=i!==null?i.memoizedState:null;if(o=e.memoizedState,i===null)if(o===null)if(e.stateNode===null){e:{o=e.type,i=e.memoizedProps,c=c.ownerDocument||c;t:switch(o){case"title":d=c.getElementsByTagName("title")[0],(!d||d[Ei]||d[We]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=c.createElement(o),c.head.insertBefore(d,c.querySelector("head > title"))),Ct(d,o,i),d[We]=e,et(d),o=d;break e;case"link":var y=Bg("link","href",c).get(o+(i.href||""));if(y){for(var S=0;S<y.length;S++)if(d=y[S],d.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&d.getAttribute("rel")===(i.rel==null?null:i.rel)&&d.getAttribute("title")===(i.title==null?null:i.title)&&d.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){y.splice(S,1);break t}}d=c.createElement(o),Ct(d,o,i),c.head.appendChild(d);break;case"meta":if(y=Bg("meta","content",c).get(o+(i.content||""))){for(S=0;S<y.length;S++)if(d=y[S],d.getAttribute("content")===(i.content==null?null:""+i.content)&&d.getAttribute("name")===(i.name==null?null:i.name)&&d.getAttribute("property")===(i.property==null?null:i.property)&&d.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&d.getAttribute("charset")===(i.charSet==null?null:i.charSet)){y.splice(S,1);break t}}d=c.createElement(o),Ct(d,o,i),c.head.appendChild(d);break;default:throw Error(r(468,o))}d[We]=e,et(d),o=d}e.stateNode=o}else Hg(c,e.type,e.stateNode);else e.stateNode=zg(c,o,e.memoizedProps);else d!==o?(d===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):d.count--,o===null?Hg(c,e.type,e.stateNode):zg(c,o,e.memoizedProps)):o===null&&e.stateNode!==null&&Ud(e,e.memoizedProps,i.memoizedProps)}break;case 27:en(t,e),tn(e),o&512&&(rt||i===null||Fn(i,i.return)),i!==null&&o&4&&Ud(e,e.memoizedProps,i.memoizedProps);break;case 5:if(en(t,e),tn(e),o&512&&(rt||i===null||Fn(i,i.return)),e.flags&32){c=e.stateNode;try{rs(c,"")}catch(j){Fe(e,e.return,j)}}o&4&&e.stateNode!=null&&(c=e.memoizedProps,Ud(e,c,i!==null?i.memoizedProps:c)),o&1024&&(zd=!0);break;case 6:if(en(t,e),tn(e),o&4){if(e.stateNode===null)throw Error(r(162));o=e.memoizedProps,i=e.stateNode;try{i.nodeValue=o}catch(j){Fe(e,e.return,j)}}break;case 3:if(Vl=null,c=wn,wn=Yl(t.containerInfo),en(t,e),wn=c,tn(e),o&4&&i!==null&&i.memoizedState.isDehydrated)try{Wr(t.containerInfo)}catch(j){Fe(e,e.return,j)}zd&&(zd=!1,$0(e));break;case 4:o=wn,wn=Yl(e.stateNode.containerInfo),en(t,e),tn(e),wn=o;break;case 12:en(t,e),tn(e);break;case 13:en(t,e),tn(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(Yd=ce()),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Bd(e,o)));break;case 22:c=e.memoizedState!==null;var x=i!==null&&i.memoizedState!==null,z=Ea,K=rt;if(Ea=z||c,rt=K||x,en(t,e),rt=K,Ea=z,tn(e),o&8192)e:for(t=e.stateNode,t._visibility=c?t._visibility&-2:t._visibility|1,c&&(i===null||x||Ea||rt||Bi(e)),i=null,t=e;;){if(t.tag===5||t.tag===26){if(i===null){x=i=t;try{if(d=x.stateNode,c)y=d.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{S=x.stateNode;var J=x.memoizedProps.style,H=J!=null&&J.hasOwnProperty("display")?J.display:null;S.style.display=H==null||typeof H=="boolean"?"":(""+H).trim()}}catch(j){Fe(x,x.return,j)}}}else if(t.tag===6){if(i===null){x=t;try{x.stateNode.nodeValue=c?"":x.memoizedProps}catch(j){Fe(x,x.return,j)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;i===t&&(i=null),t=t.return}i===t&&(i=null),t.sibling.return=t.return,t=t.sibling}o&4&&(o=e.updateQueue,o!==null&&(i=o.retryQueue,i!==null&&(o.retryQueue=null,Bd(e,i))));break;case 19:en(t,e),tn(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Bd(e,o)));break;case 30:break;case 21:break;default:en(t,e),tn(e)}}function tn(e){var t=e.flags;if(t&2){try{for(var i,o=e.return;o!==null;){if(z0(o)){i=o;break}o=o.return}if(i==null)throw Error(r(160));switch(i.tag){case 27:var c=i.stateNode,d=Od(e);kl(e,d,c);break;case 5:var y=i.stateNode;i.flags&32&&(rs(y,""),i.flags&=-33);var S=Od(e);kl(e,S,y);break;case 3:case 4:var x=i.stateNode.containerInfo,z=Od(e);qd(e,z,x);break;default:throw Error(r(161))}}catch(K){Fe(e,e.return,K)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function $0(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;$0(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function Ja(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)I0(e,t.alternate,t),t=t.sibling}function Bi(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Za(4,t,t.return),Bi(t);break;case 1:Fn(t,t.return);var i=t.stateNode;typeof i.componentWillUnmount=="function"&&O0(t,t.return,i),Bi(t);break;case 27:$r(t.stateNode);case 26:case 5:Fn(t,t.return),Bi(t);break;case 22:t.memoizedState===null&&Bi(t);break;case 30:Bi(t);break;default:Bi(t)}e=e.sibling}}function Wa(e,t,i){for(i=i&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var o=t.alternate,c=e,d=t,y=d.flags;switch(d.tag){case 0:case 11:case 15:Wa(c,d,i),Or(4,d);break;case 1:if(Wa(c,d,i),o=d,c=o.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(z){Fe(o,o.return,z)}if(o=d,c=o.updateQueue,c!==null){var S=o.stateNode;try{var x=c.shared.hiddenCallbacks;if(x!==null)for(c.shared.hiddenCallbacks=null,c=0;c<x.length;c++)Sp(x[c],S)}catch(z){Fe(o,o.return,z)}}i&&y&64&&U0(d),qr(d,d.return);break;case 27:B0(d);case 26:case 5:Wa(c,d,i),i&&o===null&&y&4&&q0(d),qr(d,d.return);break;case 12:Wa(c,d,i);break;case 13:Wa(c,d,i),i&&y&4&&F0(c,d);break;case 22:d.memoizedState===null&&Wa(c,d,i),qr(d,d.return);break;case 30:break;default:Wa(c,d,i)}t=t.sibling}}function Hd(e,t){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Er(i))}function Id(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Er(e))}function Yn(e,t,i,o){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)V0(e,t,i,o),t=t.sibling}function V0(e,t,i,o){var c=t.flags;switch(t.tag){case 0:case 11:case 15:Yn(e,t,i,o),c&2048&&Or(9,t);break;case 1:Yn(e,t,i,o);break;case 3:Yn(e,t,i,o),c&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Er(e)));break;case 12:if(c&2048){Yn(e,t,i,o),e=t.stateNode;try{var d=t.memoizedProps,y=d.id,S=d.onPostCommit;typeof S=="function"&&S(y,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(x){Fe(t,t.return,x)}}else Yn(e,t,i,o);break;case 13:Yn(e,t,i,o);break;case 23:break;case 22:d=t.stateNode,y=t.alternate,t.memoizedState!==null?d._visibility&2?Yn(e,t,i,o):zr(e,t):d._visibility&2?Yn(e,t,i,o):(d._visibility|=2,As(e,t,i,o,(t.subtreeFlags&10256)!==0)),c&2048&&Hd(y,t);break;case 24:Yn(e,t,i,o),c&2048&&Id(t.alternate,t);break;default:Yn(e,t,i,o)}}function As(e,t,i,o,c){for(c=c&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var d=e,y=t,S=i,x=o,z=y.flags;switch(y.tag){case 0:case 11:case 15:As(d,y,S,x,c),Or(8,y);break;case 23:break;case 22:var K=y.stateNode;y.memoizedState!==null?K._visibility&2?As(d,y,S,x,c):zr(d,y):(K._visibility|=2,As(d,y,S,x,c)),c&&z&2048&&Hd(y.alternate,y);break;case 24:As(d,y,S,x,c),c&&z&2048&&Id(y.alternate,y);break;default:As(d,y,S,x,c)}t=t.sibling}}function zr(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var i=e,o=t,c=o.flags;switch(o.tag){case 22:zr(i,o),c&2048&&Hd(o.alternate,o);break;case 24:zr(i,o),c&2048&&Id(o.alternate,o);break;default:zr(i,o)}t=t.sibling}}var Br=8192;function Cs(e){if(e.subtreeFlags&Br)for(e=e.child;e!==null;)X0(e),e=e.sibling}function X0(e){switch(e.tag){case 26:Cs(e),e.flags&Br&&e.memoizedState!==null&&GS(wn,e.memoizedState,e.memoizedProps);break;case 5:Cs(e);break;case 3:case 4:var t=wn;wn=Yl(e.stateNode.containerInfo),Cs(e),wn=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=Br,Br=16777216,Cs(e),Br=t):Cs(e));break;default:Cs(e)}}function K0(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Hr(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var o=t[i];Et=o,P0(o,e)}K0(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Q0(e),e=e.sibling}function Q0(e){switch(e.tag){case 0:case 11:case 15:Hr(e),e.flags&2048&&Za(9,e,e.return);break;case 3:Hr(e);break;case 12:Hr(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Dl(e)):Hr(e);break;default:Hr(e)}}function Dl(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var o=t[i];Et=o,P0(o,e)}K0(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Za(8,t,t.return),Dl(t);break;case 22:i=t.stateNode,i._visibility&2&&(i._visibility&=-3,Dl(t));break;default:Dl(t)}e=e.sibling}}function P0(e,t){for(;Et!==null;){var i=Et;switch(i.tag){case 0:case 11:case 15:Za(8,i,t);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var o=i.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:Er(i.memoizedState.cache)}if(o=i.child,o!==null)o.return=i,Et=o;else e:for(i=e;Et!==null;){o=Et;var c=o.sibling,d=o.return;if(j0(o),o===i){Et=null;break e}if(c!==null){c.return=d,Et=c;break e}Et=d}}}var iS={getCacheForType:function(e){var t=Rt(ht),i=t.data.get(e);return i===void 0&&(i=e(),t.data.set(e,i)),i}},sS=typeof WeakMap=="function"?WeakMap:Map,Le=0,Ye=null,we=null,Ne=0,Ue=0,nn=null,ei=!1,Ts=!1,jd=!1,xa=0,it=0,ti=0,Hi=0,Gd=0,gn=0,_s=0,Ir=null,Yt=null,Fd=!1,Yd=0,Ll=1/0,Ul=null,ni=null,At=0,ai=null,Rs=null,Ns=0,$d=0,Vd=null,Z0=null,jr=0,Xd=null;function an(){if((Le&2)!==0&&Ne!==0)return Ne&-Ne;if(D.T!==null){var e=ys;return e!==0?e:ef()}return jo()}function J0(){gn===0&&(gn=(Ne&536870912)===0||De?Bo():536870912);var e=pn.current;return e!==null&&(e.flags|=32),gn}function sn(e,t,i){(e===Ye&&(Ue===2||Ue===9)||e.cancelPendingCommit!==null)&&(ks(e,0),ii(e,Ne,gn,!1)),zn(e,i),((Le&2)===0||e!==Ye)&&(e===Ye&&((Le&2)===0&&(Hi|=i),it===4&&ii(e,Ne,gn,!1)),$n(e))}function W0(e,t,i){if((Le&6)!==0)throw Error(r(327));var o=!i&&(t&124)===0&&(t&e.expiredLanes)===0||sa(e,t),c=o?lS(e,t):Pd(e,t,!0),d=o;do{if(c===0){Ts&&!o&&ii(e,t,0,!1);break}else{if(i=e.current.alternate,d&&!rS(i)){c=Pd(e,t,!1),d=!1;continue}if(c===2){if(d=t,e.errorRecoveryDisabledLanes&d)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){t=y;e:{var S=e;c=Ir;var x=S.current.memoizedState.isDehydrated;if(x&&(ks(S,y).flags|=256),y=Pd(S,y,!1),y!==2){if(jd&&!x){S.errorRecoveryDisabledLanes|=d,Hi|=d,c=4;break e}d=Yt,Yt=c,d!==null&&(Yt===null?Yt=d:Yt.push.apply(Yt,d))}c=y}if(d=!1,c!==2)continue}}if(c===1){ks(e,0),ii(e,t,0,!0);break}e:{switch(o=e,d=c,d){case 0:case 1:throw Error(r(345));case 4:if((t&4194048)!==t)break;case 6:ii(o,t,gn,!ei);break e;case 2:Yt=null;break;case 3:case 5:break;default:throw Error(r(329))}if((t&62914560)===t&&(c=Yd+300-ce(),10<c)){if(ii(o,t,gn,!ei),vi(o,0,!0)!==0)break e;o.timeoutHandle=_g(eg.bind(null,o,i,Yt,Ul,Fd,t,gn,Hi,_s,ei,d,2,-0,0),c);break e}eg(o,i,Yt,Ul,Fd,t,gn,Hi,_s,ei,d,0,-0,0)}}break}while(!0);$n(e)}function eg(e,t,i,o,c,d,y,S,x,z,K,J,H,j){if(e.timeoutHandle=-1,J=t.subtreeFlags,(J&8192||(J&16785408)===16785408)&&(Kr={stylesheets:null,count:0,unsuspend:jS},X0(t),J=FS(),J!==null)){e.cancelPendingCommit=J(og.bind(null,e,t,d,i,o,c,y,S,x,K,1,H,j)),ii(e,d,y,!z);return}og(e,t,d,i,o,c,y,S,x)}function rS(e){for(var t=e;;){var i=t.tag;if((i===0||i===11||i===15)&&t.flags&16384&&(i=t.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var o=0;o<i.length;o++){var c=i[o],d=c.getSnapshot;c=c.value;try{if(!Jt(d(),c))return!1}catch{return!1}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ii(e,t,i,o){t&=~Gd,t&=~Hi,e.suspendedLanes|=t,e.pingedLanes&=~t,o&&(e.warmLanes|=t),o=e.expirationTimes;for(var c=t;0<c;){var d=31-_t(c),y=1<<d;o[d]=-1,c&=~y}i!==0&&ir(e,i,t)}function Ol(){return(Le&6)===0?(Gr(0),!1):!0}function Kd(){if(we!==null){if(Ue===0)var e=we.return;else e=we,pa=Li=null,dd(e),xs=null,Dr=0,e=we;for(;e!==null;)L0(e.alternate,e),e=e.return;we=null}}function ks(e,t){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,wS(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),Kd(),Ye=e,we=i=fa(e.current,null),Ne=t,Ue=0,nn=null,ei=!1,Ts=sa(e,t),jd=!1,_s=gn=Gd=Hi=ti=it=0,Yt=Ir=null,Fd=!1,(t&8)!==0&&(t|=t&32);var o=e.entangledLanes;if(o!==0)for(e=e.entanglements,o&=t;0<o;){var c=31-_t(o),d=1<<c;t|=e[c],o&=~d}return xa=t,al(),i}function tg(e,t){Se=null,D.H=Ml,t===xr||t===fl?(t=bp(),Ue=3):t===pp?(t=bp(),Ue=4):Ue=t===v0?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,nn=t,we===null&&(it=1,Tl(e,dn(t,e.current)))}function ng(){var e=D.H;return D.H=Ml,e===null?Ml:e}function ag(){var e=D.A;return D.A=iS,e}function Qd(){it=4,ei||(Ne&4194048)!==Ne&&pn.current!==null||(Ts=!0),(ti&134217727)===0&&(Hi&134217727)===0||Ye===null||ii(Ye,Ne,gn,!1)}function Pd(e,t,i){var o=Le;Le|=2;var c=ng(),d=ag();(Ye!==e||Ne!==t)&&(Ul=null,ks(e,t)),t=!1;var y=it;e:do try{if(Ue!==0&&we!==null){var S=we,x=nn;switch(Ue){case 8:Kd(),y=6;break e;case 3:case 2:case 9:case 6:pn.current===null&&(t=!0);var z=Ue;if(Ue=0,nn=null,Ds(e,S,x,z),i&&Ts){y=0;break e}break;default:z=Ue,Ue=0,nn=null,Ds(e,S,x,z)}}oS(),y=it;break}catch(K){tg(e,K)}while(!0);return t&&e.shellSuspendCounter++,pa=Li=null,Le=o,D.H=c,D.A=d,we===null&&(Ye=null,Ne=0,al()),y}function oS(){for(;we!==null;)ig(we)}function lS(e,t){var i=Le;Le|=2;var o=ng(),c=ag();Ye!==e||Ne!==t?(Ul=null,Ll=ce()+500,ks(e,t)):Ts=sa(e,t);e:do try{if(Ue!==0&&we!==null){t=we;var d=nn;t:switch(Ue){case 1:Ue=0,nn=null,Ds(e,t,d,1);break;case 2:case 9:if(gp(d)){Ue=0,nn=null,sg(t);break}t=function(){Ue!==2&&Ue!==9||Ye!==e||(Ue=7),$n(e)},d.then(t,t);break e;case 3:Ue=7;break e;case 4:Ue=5;break e;case 7:gp(d)?(Ue=0,nn=null,sg(t)):(Ue=0,nn=null,Ds(e,t,d,7));break;case 5:var y=null;switch(we.tag){case 26:y=we.memoizedState;case 5:case 27:var S=we;if(!y||Ig(y)){Ue=0,nn=null;var x=S.sibling;if(x!==null)we=x;else{var z=S.return;z!==null?(we=z,ql(z)):we=null}break t}}Ue=0,nn=null,Ds(e,t,d,5);break;case 6:Ue=0,nn=null,Ds(e,t,d,6);break;case 8:Kd(),it=6;break e;default:throw Error(r(462))}}cS();break}catch(K){tg(e,K)}while(!0);return pa=Li=null,D.H=o,D.A=c,Le=i,we!==null?0:(Ye=null,Ne=0,al(),it)}function cS(){for(;we!==null&&!bi();)ig(we)}function ig(e){var t=k0(e.alternate,e,xa);e.memoizedProps=e.pendingProps,t===null?ql(e):we=t}function sg(e){var t=e,i=t.alternate;switch(t.tag){case 15:case 0:t=A0(i,t,t.pendingProps,t.type,void 0,Ne);break;case 11:t=A0(i,t,t.pendingProps,t.type.render,t.ref,Ne);break;case 5:dd(t);default:L0(i,t),t=we=rp(t,xa),t=k0(i,t,xa)}e.memoizedProps=e.pendingProps,t===null?ql(e):we=t}function Ds(e,t,i,o){pa=Li=null,dd(t),xs=null,Dr=0;var c=t.return;try{if(J1(e,c,t,i,Ne)){it=1,Tl(e,dn(i,e.current)),we=null;return}}catch(d){if(c!==null)throw we=c,d;it=1,Tl(e,dn(i,e.current)),we=null;return}t.flags&32768?(De||o===1?e=!0:Ts||(Ne&536870912)!==0?e=!1:(ei=e=!0,(o===2||o===9||o===3||o===6)&&(o=pn.current,o!==null&&o.tag===13&&(o.flags|=16384))),rg(t,e)):ql(t)}function ql(e){var t=e;do{if((t.flags&32768)!==0){rg(t,ei);return}e=t.return;var i=eS(t.alternate,t,xa);if(i!==null){we=i;return}if(t=t.sibling,t!==null){we=t;return}we=t=e}while(t!==null);it===0&&(it=5)}function rg(e,t){do{var i=tS(e.alternate,e);if(i!==null){i.flags&=32767,we=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!t&&(e=e.sibling,e!==null)){we=e;return}we=e=i}while(e!==null);it=6,we=null}function og(e,t,i,o,c,d,y,S,x){e.cancelPendingCommit=null;do zl();while(At!==0);if((Le&6)!==0)throw Error(r(327));if(t!==null){if(t===e.current)throw Error(r(177));if(d=t.lanes|t.childLanes,d|=Iu,Io(e,i,d,y,S,x),e===Ye&&(we=Ye=null,Ne=0),Rs=t,ai=e,Ns=i,$d=d,Vd=c,Z0=o,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,hS(bt,function(){return fg(),null})):(e.callbackNode=null,e.callbackPriority=0),o=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||o){o=D.T,D.T=null,c=V.p,V.p=2,y=Le,Le|=4;try{nS(e,t,i)}finally{Le=y,V.p=c,D.T=o}}At=1,lg(),cg(),ug()}}function lg(){if(At===1){At=0;var e=ai,t=Rs,i=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||i){i=D.T,D.T=null;var o=V.p;V.p=2;var c=Le;Le|=4;try{Y0(t,e);var d=cf,y=Pm(e.containerInfo),S=d.focusedElem,x=d.selectionRange;if(y!==S&&S&&S.ownerDocument&&Qm(S.ownerDocument.documentElement,S)){if(x!==null&&Ou(S)){var z=x.start,K=x.end;if(K===void 0&&(K=z),"selectionStart"in S)S.selectionStart=z,S.selectionEnd=Math.min(K,S.value.length);else{var J=S.ownerDocument||document,H=J&&J.defaultView||window;if(H.getSelection){var j=H.getSelection(),be=S.textContent.length,pe=Math.min(x.start,be),He=x.end===void 0?pe:Math.min(x.end,be);!j.extend&&pe>He&&(y=He,He=pe,pe=y);var U=Km(S,pe),_=Km(S,He);if(U&&_&&(j.rangeCount!==1||j.anchorNode!==U.node||j.anchorOffset!==U.offset||j.focusNode!==_.node||j.focusOffset!==_.offset)){var O=J.createRange();O.setStart(U.node,U.offset),j.removeAllRanges(),pe>He?(j.addRange(O),j.extend(_.node,_.offset)):(O.setEnd(_.node,_.offset),j.addRange(O))}}}}for(J=[],j=S;j=j.parentNode;)j.nodeType===1&&J.push({element:j,left:j.scrollLeft,top:j.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<J.length;S++){var Z=J[S];Z.element.scrollLeft=Z.left,Z.element.scrollTop=Z.top}}Ql=!!lf,cf=lf=null}finally{Le=c,V.p=o,D.T=i}}e.current=t,At=2}}function cg(){if(At===2){At=0;var e=ai,t=Rs,i=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||i){i=D.T,D.T=null;var o=V.p;V.p=2;var c=Le;Le|=4;try{I0(e,t.alternate,t)}finally{Le=c,V.p=o,D.T=i}}At=3}}function ug(){if(At===4||At===3){At=0,es();var e=ai,t=Rs,i=Ns,o=Z0;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?At=5:(At=0,Rs=ai=null,dg(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(ni=null),or(i),t=t.stateNode,Pe&&typeof Pe.onCommitFiberRoot=="function")try{Pe.onCommitFiberRoot(Xe,t,void 0,(t.current.flags&128)===128)}catch{}if(o!==null){t=D.T,c=V.p,V.p=2,D.T=null;try{for(var d=e.onRecoverableError,y=0;y<o.length;y++){var S=o[y];d(S.value,{componentStack:S.stack})}}finally{D.T=t,V.p=c}}(Ns&3)!==0&&zl(),$n(e),c=e.pendingLanes,(i&4194090)!==0&&(c&42)!==0?e===Xd?jr++:(jr=0,Xd=e):jr=0,Gr(0)}}function dg(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Er(t)))}function zl(e){return lg(),cg(),ug(),fg()}function fg(){if(At!==5)return!1;var e=ai,t=$d;$d=0;var i=or(Ns),o=D.T,c=V.p;try{V.p=32>i?32:i,D.T=null,i=Vd,Vd=null;var d=ai,y=Ns;if(At=0,Rs=ai=null,Ns=0,(Le&6)!==0)throw Error(r(331));var S=Le;if(Le|=4,Q0(d.current),V0(d,d.current,y,i),Le=S,Gr(0,!1),Pe&&typeof Pe.onPostCommitFiberRoot=="function")try{Pe.onPostCommitFiberRoot(Xe,d)}catch{}return!0}finally{V.p=c,D.T=o,dg(e,t)}}function hg(e,t,i){t=dn(i,t),t=Ad(e.stateNode,t,2),e=Xa(e,t,2),e!==null&&(zn(e,2),$n(e))}function Fe(e,t,i){if(e.tag===3)hg(e,e,i);else for(;t!==null;){if(t.tag===3){hg(t,e,i);break}else if(t.tag===1){var o=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(ni===null||!ni.has(o))){e=dn(i,e),i=y0(2),o=Xa(t,i,2),o!==null&&(b0(i,o,t,e),zn(o,2),$n(o));break}}t=t.return}}function Zd(e,t,i){var o=e.pingCache;if(o===null){o=e.pingCache=new sS;var c=new Set;o.set(t,c)}else c=o.get(t),c===void 0&&(c=new Set,o.set(t,c));c.has(i)||(jd=!0,c.add(i),e=uS.bind(null,e,t,i),t.then(e,e))}function uS(e,t,i){var o=e.pingCache;o!==null&&o.delete(t),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Ye===e&&(Ne&i)===i&&(it===4||it===3&&(Ne&62914560)===Ne&&300>ce()-Yd?(Le&2)===0&&ks(e,0):Gd|=i,_s===Ne&&(_s=0)),$n(e)}function mg(e,t){t===0&&(t=Ho()),e=hs(e,t),e!==null&&(zn(e,t),$n(e))}function dS(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),mg(e,i)}function fS(e,t){var i=0;switch(e.tag){case 13:var o=e.stateNode,c=e.memoizedState;c!==null&&(i=c.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(r(314))}o!==null&&o.delete(t),mg(e,i)}function hS(e,t){return On(e,t)}var Bl=null,Ls=null,Jd=!1,Hl=!1,Wd=!1,Ii=0;function $n(e){e!==Ls&&e.next===null&&(Ls===null?Bl=Ls=e:Ls=Ls.next=e),Hl=!0,Jd||(Jd=!0,pS())}function Gr(e,t){if(!Wd&&Hl){Wd=!0;do for(var i=!1,o=Bl;o!==null;){if(e!==0){var c=o.pendingLanes;if(c===0)var d=0;else{var y=o.suspendedLanes,S=o.pingedLanes;d=(1<<31-_t(42|e)+1)-1,d&=c&~(y&~S),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(i=!0,bg(o,d))}else d=Ne,d=vi(o,o===Ye?d:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),(d&3)===0||sa(o,d)||(i=!0,bg(o,d));o=o.next}while(i);Wd=!1}}function mS(){pg()}function pg(){Hl=Jd=!1;var e=0;Ii!==0&&(xS()&&(e=Ii),Ii=0);for(var t=ce(),i=null,o=Bl;o!==null;){var c=o.next,d=gg(o,t);d===0?(o.next=null,i===null?Bl=c:i.next=c,c===null&&(Ls=i)):(i=o,(e!==0||(d&3)!==0)&&(Hl=!0)),o=c}Gr(e)}function gg(e,t){for(var i=e.suspendedLanes,o=e.pingedLanes,c=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var y=31-_t(d),S=1<<y,x=c[y];x===-1?((S&i)===0||(S&o)!==0)&&(c[y]=Eu(S,t)):x<=t&&(e.expiredLanes|=S),d&=~S}if(t=Ye,i=Ne,i=vi(e,e===t?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o=e.callbackNode,i===0||e===t&&(Ue===2||Ue===9)||e.cancelPendingCommit!==null)return o!==null&&o!==null&&cn(o),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||sa(e,i)){if(t=i&-i,t===e.callbackPriority)return t;switch(o!==null&&cn(o),or(i)){case 2:case 8:i=qe;break;case 32:i=bt;break;case 268435456:i=Kt;break;default:i=bt}return o=yg.bind(null,e),i=On(i,o),e.callbackPriority=t,e.callbackNode=i,t}return o!==null&&o!==null&&cn(o),e.callbackPriority=2,e.callbackNode=null,2}function yg(e,t){if(At!==0&&At!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(zl()&&e.callbackNode!==i)return null;var o=Ne;return o=vi(e,e===Ye?o:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o===0?null:(W0(e,o,t),gg(e,ce()),e.callbackNode!=null&&e.callbackNode===i?yg.bind(null,e):null)}function bg(e,t){if(zl())return null;W0(e,t,!0)}function pS(){AS(function(){(Le&6)!==0?On(je,mS):pg()})}function ef(){return Ii===0&&(Ii=Bo()),Ii}function vg(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Po(""+e)}function Sg(e,t){var i=t.ownerDocument.createElement("input");return i.name=t.name,i.value=t.value,e.id&&i.setAttribute("form",e.id),t.parentNode.insertBefore(i,t),e=new FormData(e),i.parentNode.removeChild(i),e}function gS(e,t,i,o,c){if(t==="submit"&&i&&i.stateNode===c){var d=vg((c[dt]||null).action),y=o.submitter;y&&(t=(t=y[dt]||null)?vg(t.formAction):y.getAttribute("formAction"),t!==null&&(d=t,y=null));var S=new el("action","action",null,o,c);e.push({event:S,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(Ii!==0){var x=y?Sg(c,y):new FormData(c);Sd(i,{pending:!0,data:x,method:c.method,action:d},null,x)}}else typeof d=="function"&&(S.preventDefault(),x=y?Sg(c,y):new FormData(c),Sd(i,{pending:!0,data:x,method:c.method,action:d},d,x))},currentTarget:c}]})}}for(var tf=0;tf<Hu.length;tf++){var nf=Hu[tf],yS=nf.toLowerCase(),bS=nf[0].toUpperCase()+nf.slice(1);xn(yS,"on"+bS)}xn(Wm,"onAnimationEnd"),xn(ep,"onAnimationIteration"),xn(tp,"onAnimationStart"),xn("dblclick","onDoubleClick"),xn("focusin","onFocus"),xn("focusout","onBlur"),xn(O1,"onTransitionRun"),xn(q1,"onTransitionStart"),xn(z1,"onTransitionCancel"),xn(np,"onTransitionEnd"),Ia("onMouseEnter",["mouseout","mouseover"]),Ia("onMouseLeave",["mouseout","mouseover"]),Ia("onPointerEnter",["pointerout","pointerover"]),Ia("onPointerLeave",["pointerout","pointerover"]),Hn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Hn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Hn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Hn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Hn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Hn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Fr));function Eg(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var o=e[i],c=o.event;o=o.listeners;e:{var d=void 0;if(t)for(var y=o.length-1;0<=y;y--){var S=o[y],x=S.instance,z=S.currentTarget;if(S=S.listener,x!==d&&c.isPropagationStopped())break e;d=S,c.currentTarget=z;try{d(c)}catch(K){Cl(K)}c.currentTarget=null,d=x}else for(y=0;y<o.length;y++){if(S=o[y],x=S.instance,z=S.currentTarget,S=S.listener,x!==d&&c.isPropagationStopped())break e;d=S,c.currentTarget=z;try{d(c)}catch(K){Cl(K)}c.currentTarget=null,d=x}}}}function Ae(e,t){var i=t[Ba];i===void 0&&(i=t[Ba]=new Set);var o=e+"__bubble";i.has(o)||(Mg(t,e,2,!1),i.add(o))}function af(e,t,i){var o=0;t&&(o|=4),Mg(i,e,o,t)}var Il="_reactListening"+Math.random().toString(36).slice(2);function sf(e){if(!e[Il]){e[Il]=!0,ss.forEach(function(i){i!=="selectionchange"&&(vS.has(i)||af(i,!1,e),af(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Il]||(t[Il]=!0,af("selectionchange",!1,t))}}function Mg(e,t,i,o){switch(Vg(t)){case 2:var c=VS;break;case 8:c=XS;break;default:c=vf}i=c.bind(null,t,i,e),c=void 0,!Cu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),o?c!==void 0?e.addEventListener(t,i,{capture:!0,passive:c}):e.addEventListener(t,i,!0):c!==void 0?e.addEventListener(t,i,{passive:c}):e.addEventListener(t,i,!1)}function rf(e,t,i,o,c){var d=o;if((t&1)===0&&(t&2)===0&&o!==null)e:for(;;){if(o===null)return;var y=o.tag;if(y===3||y===4){var S=o.stateNode.containerInfo;if(S===c)break;if(y===4)for(y=o.return;y!==null;){var x=y.tag;if((x===3||x===4)&&y.stateNode.containerInfo===c)return;y=y.return}for(;S!==null;){if(y=oa(S),y===null)return;if(x=y.tag,x===5||x===6||x===26||x===27){o=d=y;continue e}S=S.parentNode}}o=o.return}Rm(function(){var z=d,K=wu(i),J=[];e:{var H=ap.get(e);if(H!==void 0){var j=el,be=e;switch(e){case"keypress":if(Jo(i)===0)break e;case"keydown":case"keyup":j=h1;break;case"focusin":be="focus",j=Nu;break;case"focusout":be="blur",j=Nu;break;case"beforeblur":case"afterblur":j=Nu;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=Dm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=t1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=g1;break;case Wm:case ep:case tp:j=i1;break;case np:j=b1;break;case"scroll":case"scrollend":j=Wv;break;case"wheel":j=S1;break;case"copy":case"cut":case"paste":j=r1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=Um;break;case"toggle":case"beforetoggle":j=M1}var pe=(t&4)!==0,He=!pe&&(e==="scroll"||e==="scrollend"),U=pe?H!==null?H+"Capture":null:H;pe=[];for(var _=z,O;_!==null;){var Z=_;if(O=Z.stateNode,Z=Z.tag,Z!==5&&Z!==26&&Z!==27||O===null||U===null||(Z=lr(_,U),Z!=null&&pe.push(Yr(_,Z,O))),He)break;_=_.return}0<pe.length&&(H=new j(H,be,null,i,K),J.push({event:H,listeners:pe}))}}if((t&7)===0){e:{if(H=e==="mouseover"||e==="pointerover",j=e==="mouseout"||e==="pointerout",H&&i!==xu&&(be=i.relatedTarget||i.fromElement)&&(oa(be)||be[ra]))break e;if((j||H)&&(H=K.window===K?K:(H=K.ownerDocument)?H.defaultView||H.parentWindow:window,j?(be=i.relatedTarget||i.toElement,j=z,be=be?oa(be):null,be!==null&&(He=u(be),pe=be.tag,be!==He||pe!==5&&pe!==27&&pe!==6)&&(be=null)):(j=null,be=z),j!==be)){if(pe=Dm,Z="onMouseLeave",U="onMouseEnter",_="mouse",(e==="pointerout"||e==="pointerover")&&(pe=Um,Z="onPointerLeave",U="onPointerEnter",_="pointer"),He=j==null?H:la(j),O=be==null?H:la(be),H=new pe(Z,_+"leave",j,i,K),H.target=He,H.relatedTarget=O,Z=null,oa(K)===z&&(pe=new pe(U,_+"enter",be,i,K),pe.target=O,pe.relatedTarget=He,Z=pe),He=Z,j&&be)t:{for(pe=j,U=be,_=0,O=pe;O;O=Us(O))_++;for(O=0,Z=U;Z;Z=Us(Z))O++;for(;0<_-O;)pe=Us(pe),_--;for(;0<O-_;)U=Us(U),O--;for(;_--;){if(pe===U||U!==null&&pe===U.alternate)break t;pe=Us(pe),U=Us(U)}pe=null}else pe=null;j!==null&&xg(J,H,j,pe,!1),be!==null&&He!==null&&xg(J,He,be,pe,!0)}}e:{if(H=z?la(z):window,j=H.nodeName&&H.nodeName.toLowerCase(),j==="select"||j==="input"&&H.type==="file")var ue=Gm;else if(Im(H))if(Fm)ue=D1;else{ue=N1;var Me=R1}else j=H.nodeName,!j||j.toLowerCase()!=="input"||H.type!=="checkbox"&&H.type!=="radio"?z&&Mu(z.elementType)&&(ue=Gm):ue=k1;if(ue&&(ue=ue(e,z))){jm(J,ue,i,K);break e}Me&&Me(e,H,z),e==="focusout"&&z&&H.type==="number"&&z.memoizedProps.value!=null&&Ga(H,"number",H.value)}switch(Me=z?la(z):window,e){case"focusin":(Im(Me)||Me.contentEditable==="true")&&(us=Me,qu=z,gr=null);break;case"focusout":gr=qu=us=null;break;case"mousedown":zu=!0;break;case"contextmenu":case"mouseup":case"dragend":zu=!1,Zm(J,i,K);break;case"selectionchange":if(U1)break;case"keydown":case"keyup":Zm(J,i,K)}var me;if(Du)e:{switch(e){case"compositionstart":var ye="onCompositionStart";break e;case"compositionend":ye="onCompositionEnd";break e;case"compositionupdate":ye="onCompositionUpdate";break e}ye=void 0}else cs?Bm(e,i)&&(ye="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(ye="onCompositionStart");ye&&(Om&&i.locale!=="ko"&&(cs||ye!=="onCompositionStart"?ye==="onCompositionEnd"&&cs&&(me=Nm()):(Fa=K,Tu="value"in Fa?Fa.value:Fa.textContent,cs=!0)),Me=jl(z,ye),0<Me.length&&(ye=new Lm(ye,e,null,i,K),J.push({event:ye,listeners:Me}),me?ye.data=me:(me=Hm(i),me!==null&&(ye.data=me)))),(me=w1?A1(e,i):C1(e,i))&&(ye=jl(z,"onBeforeInput"),0<ye.length&&(Me=new Lm("onBeforeInput","beforeinput",null,i,K),J.push({event:Me,listeners:ye}),Me.data=me)),gS(J,e,z,i,K)}Eg(J,t)})}function Yr(e,t,i){return{instance:e,listener:t,currentTarget:i}}function jl(e,t){for(var i=t+"Capture",o=[];e!==null;){var c=e,d=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||d===null||(c=lr(e,i),c!=null&&o.unshift(Yr(e,c,d)),c=lr(e,t),c!=null&&o.push(Yr(e,c,d))),e.tag===3)return o;e=e.return}return[]}function Us(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function xg(e,t,i,o,c){for(var d=t._reactName,y=[];i!==null&&i!==o;){var S=i,x=S.alternate,z=S.stateNode;if(S=S.tag,x!==null&&x===o)break;S!==5&&S!==26&&S!==27||z===null||(x=z,c?(z=lr(i,d),z!=null&&y.unshift(Yr(i,z,x))):c||(z=lr(i,d),z!=null&&y.push(Yr(i,z,x)))),i=i.return}y.length!==0&&e.push({event:t,listeners:y})}var SS=/\r\n?/g,ES=/\u0000|\uFFFD/g;function wg(e){return(typeof e=="string"?e:""+e).replace(SS,`
`).replace(ES,"")}function Ag(e,t){return t=wg(t),wg(e)===t}function Gl(){}function Be(e,t,i,o,c,d){switch(i){case"children":typeof o=="string"?t==="body"||t==="textarea"&&o===""||rs(e,o):(typeof o=="number"||typeof o=="bigint")&&t!=="body"&&rs(e,""+o);break;case"className":xi(e,"class",o);break;case"tabIndex":xi(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":xi(e,i,o);break;case"style":Tm(e,o,d);break;case"data":if(t!=="object"){xi(e,"data",o);break}case"src":case"href":if(o===""&&(t!=="a"||i!=="href")){e.removeAttribute(i);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(i);break}o=Po(""+o),e.setAttribute(i,o);break;case"action":case"formAction":if(typeof o=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(i==="formAction"?(t!=="input"&&Be(e,t,"name",c.name,c,null),Be(e,t,"formEncType",c.formEncType,c,null),Be(e,t,"formMethod",c.formMethod,c,null),Be(e,t,"formTarget",c.formTarget,c,null)):(Be(e,t,"encType",c.encType,c,null),Be(e,t,"method",c.method,c,null),Be(e,t,"target",c.target,c,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(i);break}o=Po(""+o),e.setAttribute(i,o);break;case"onClick":o!=null&&(e.onclick=Gl);break;case"onScroll":o!=null&&Ae("scroll",e);break;case"onScrollEnd":o!=null&&Ae("scrollend",e);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(i=o.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"multiple":e.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":e.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){e.removeAttribute("xlink:href");break}i=Po(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,""+o):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":o===!0?e.setAttribute(i,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(i,o):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?e.setAttribute(i,o):e.removeAttribute(i);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?e.removeAttribute(i):e.setAttribute(i,o);break;case"popover":Ae("beforetoggle",e),Ae("toggle",e),Mi(e,"popover",o);break;case"xlinkActuate":Mn(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":Mn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":Mn(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":Mn(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":Mn(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":Mn(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":Mn(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":Mn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":Mn(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":Mi(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=Zv.get(i)||i,Mi(e,i,o))}}function of(e,t,i,o,c,d){switch(i){case"style":Tm(e,o,d);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(i=o.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"children":typeof o=="string"?rs(e,o):(typeof o=="number"||typeof o=="bigint")&&rs(e,""+o);break;case"onScroll":o!=null&&Ae("scroll",e);break;case"onScrollEnd":o!=null&&Ae("scrollend",e);break;case"onClick":o!=null&&(e.onclick=Gl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Fo.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(c=i.endsWith("Capture"),t=i.slice(2,c?i.length-7:void 0),d=e[dt]||null,d=d!=null?d[i]:null,typeof d=="function"&&e.removeEventListener(t,d,c),typeof o=="function")){typeof d!="function"&&d!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(t,o,c);break e}i in e?e[i]=o:o===!0?e.setAttribute(i,""):Mi(e,i,o)}}}function Ct(e,t,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ae("error",e),Ae("load",e);var o=!1,c=!1,d;for(d in i)if(i.hasOwnProperty(d)){var y=i[d];if(y!=null)switch(d){case"src":o=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:Be(e,t,d,y,i,null)}}c&&Be(e,t,"srcSet",i.srcSet,i,null),o&&Be(e,t,"src",i.src,i,null);return;case"input":Ae("invalid",e);var S=d=y=c=null,x=null,z=null;for(o in i)if(i.hasOwnProperty(o)){var K=i[o];if(K!=null)switch(o){case"name":c=K;break;case"type":y=K;break;case"checked":x=K;break;case"defaultChecked":z=K;break;case"value":d=K;break;case"defaultValue":S=K;break;case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(r(137,t));break;default:Be(e,t,o,K,i,null)}}ja(e,d,S,x,z,y,c,!1),vt(e);return;case"select":Ae("invalid",e),o=y=d=null;for(c in i)if(i.hasOwnProperty(c)&&(S=i[c],S!=null))switch(c){case"value":d=S;break;case"defaultValue":y=S;break;case"multiple":o=S;default:Be(e,t,c,S,i,null)}t=d,i=y,e.multiple=!!o,t!=null?ua(e,!!o,t,!1):i!=null&&ua(e,!!o,i,!0);return;case"textarea":Ae("invalid",e),d=c=o=null;for(y in i)if(i.hasOwnProperty(y)&&(S=i[y],S!=null))switch(y){case"value":o=S;break;case"defaultValue":c=S;break;case"children":d=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(r(91));break;default:Be(e,t,y,S,i,null)}Qo(e,o,c,d),vt(e);return;case"option":for(x in i)if(i.hasOwnProperty(x)&&(o=i[x],o!=null))switch(x){case"selected":e.selected=o&&typeof o!="function"&&typeof o!="symbol";break;default:Be(e,t,x,o,i,null)}return;case"dialog":Ae("beforetoggle",e),Ae("toggle",e),Ae("cancel",e),Ae("close",e);break;case"iframe":case"object":Ae("load",e);break;case"video":case"audio":for(o=0;o<Fr.length;o++)Ae(Fr[o],e);break;case"image":Ae("error",e),Ae("load",e);break;case"details":Ae("toggle",e);break;case"embed":case"source":case"link":Ae("error",e),Ae("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(z in i)if(i.hasOwnProperty(z)&&(o=i[z],o!=null))switch(z){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:Be(e,t,z,o,i,null)}return;default:if(Mu(t)){for(K in i)i.hasOwnProperty(K)&&(o=i[K],o!==void 0&&of(e,t,K,o,i,void 0));return}}for(S in i)i.hasOwnProperty(S)&&(o=i[S],o!=null&&Be(e,t,S,o,i,null))}function MS(e,t,i,o){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,d=null,y=null,S=null,x=null,z=null,K=null;for(j in i){var J=i[j];if(i.hasOwnProperty(j)&&J!=null)switch(j){case"checked":break;case"value":break;case"defaultValue":x=J;default:o.hasOwnProperty(j)||Be(e,t,j,null,o,J)}}for(var H in o){var j=o[H];if(J=i[H],o.hasOwnProperty(H)&&(j!=null||J!=null))switch(H){case"type":d=j;break;case"name":c=j;break;case"checked":z=j;break;case"defaultChecked":K=j;break;case"value":y=j;break;case"defaultValue":S=j;break;case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(r(137,t));break;default:j!==J&&Be(e,t,H,j,o,J)}}nt(e,y,S,x,z,K,d,c);return;case"select":j=y=S=H=null;for(d in i)if(x=i[d],i.hasOwnProperty(d)&&x!=null)switch(d){case"value":break;case"multiple":j=x;default:o.hasOwnProperty(d)||Be(e,t,d,null,o,x)}for(c in o)if(d=o[c],x=i[c],o.hasOwnProperty(c)&&(d!=null||x!=null))switch(c){case"value":H=d;break;case"defaultValue":S=d;break;case"multiple":y=d;default:d!==x&&Be(e,t,c,d,o,x)}t=S,i=y,o=j,H!=null?ua(e,!!i,H,!1):!!o!=!!i&&(t!=null?ua(e,!!i,t,!0):ua(e,!!i,i?[]:"",!1));return;case"textarea":j=H=null;for(S in i)if(c=i[S],i.hasOwnProperty(S)&&c!=null&&!o.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:Be(e,t,S,null,o,c)}for(y in o)if(c=o[y],d=i[y],o.hasOwnProperty(y)&&(c!=null||d!=null))switch(y){case"value":H=c;break;case"defaultValue":j=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(r(91));break;default:c!==d&&Be(e,t,y,c,o,d)}In(e,H,j);return;case"option":for(var be in i)if(H=i[be],i.hasOwnProperty(be)&&H!=null&&!o.hasOwnProperty(be))switch(be){case"selected":e.selected=!1;break;default:Be(e,t,be,null,o,H)}for(x in o)if(H=o[x],j=i[x],o.hasOwnProperty(x)&&H!==j&&(H!=null||j!=null))switch(x){case"selected":e.selected=H&&typeof H!="function"&&typeof H!="symbol";break;default:Be(e,t,x,H,o,j)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pe in i)H=i[pe],i.hasOwnProperty(pe)&&H!=null&&!o.hasOwnProperty(pe)&&Be(e,t,pe,null,o,H);for(z in o)if(H=o[z],j=i[z],o.hasOwnProperty(z)&&H!==j&&(H!=null||j!=null))switch(z){case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(r(137,t));break;default:Be(e,t,z,H,o,j)}return;default:if(Mu(t)){for(var He in i)H=i[He],i.hasOwnProperty(He)&&H!==void 0&&!o.hasOwnProperty(He)&&of(e,t,He,void 0,o,H);for(K in o)H=o[K],j=i[K],!o.hasOwnProperty(K)||H===j||H===void 0&&j===void 0||of(e,t,K,H,o,j);return}}for(var U in i)H=i[U],i.hasOwnProperty(U)&&H!=null&&!o.hasOwnProperty(U)&&Be(e,t,U,null,o,H);for(J in o)H=o[J],j=i[J],!o.hasOwnProperty(J)||H===j||H==null&&j==null||Be(e,t,J,H,o,j)}var lf=null,cf=null;function Fl(e){return e.nodeType===9?e:e.ownerDocument}function Cg(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Tg(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function uf(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var df=null;function xS(){var e=window.event;return e&&e.type==="popstate"?e===df?!1:(df=e,!0):(df=null,!1)}var _g=typeof setTimeout=="function"?setTimeout:void 0,wS=typeof clearTimeout=="function"?clearTimeout:void 0,Rg=typeof Promise=="function"?Promise:void 0,AS=typeof queueMicrotask=="function"?queueMicrotask:typeof Rg<"u"?function(e){return Rg.resolve(null).then(e).catch(CS)}:_g;function CS(e){setTimeout(function(){throw e})}function si(e){return e==="head"}function Ng(e,t){var i=t,o=0,c=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(0<o&&8>o){i=o;var y=e.ownerDocument;if(i&1&&$r(y.documentElement),i&2&&$r(y.body),i&4)for(i=y.head,$r(i),y=i.firstChild;y;){var S=y.nextSibling,x=y.nodeName;y[Ei]||x==="SCRIPT"||x==="STYLE"||x==="LINK"&&y.rel.toLowerCase()==="stylesheet"||i.removeChild(y),y=S}}if(c===0){e.removeChild(d),Wr(t);return}c--}else i==="$"||i==="$?"||i==="$!"?c++:o=i.charCodeAt(0)-48;else o=0;i=d}while(i);Wr(t)}function ff(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var i=t;switch(t=t.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":ff(i),is(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function TS(e,t,i,o){for(;e.nodeType===1;){var c=i;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!o&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(o){if(!e[Ei])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var d=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=An(e.nextSibling),e===null)break}return null}function _S(e,t,i){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=An(e.nextSibling),e===null))return null;return e}function hf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function RS(e,t){var i=e.ownerDocument;if(e.data!=="$?"||i.readyState==="complete")t();else{var o=function(){t(),i.removeEventListener("DOMContentLoaded",o)};i.addEventListener("DOMContentLoaded",o),e._reactRetry=o}}function An(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var mf=null;function kg(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}function Dg(e,t,i){switch(t=Fl(i),e){case"html":if(e=t.documentElement,!e)throw Error(r(452));return e;case"head":if(e=t.head,!e)throw Error(r(453));return e;case"body":if(e=t.body,!e)throw Error(r(454));return e;default:throw Error(r(451))}}function $r(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);is(e)}var yn=new Map,Lg=new Set;function Yl(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var wa=V.d;V.d={f:NS,r:kS,D:DS,C:LS,L:US,m:OS,X:zS,S:qS,M:BS};function NS(){var e=wa.f(),t=Ol();return e||t}function kS(e){var t=Ha(e);t!==null&&t.tag===5&&t.type==="form"?Wp(t):wa.r(e)}var Os=typeof document>"u"?null:document;function Ug(e,t,i){var o=Os;if(o&&typeof t=="string"&&t){var c=ft(t);c='link[rel="'+e+'"][href="'+c+'"]',typeof i=="string"&&(c+='[crossorigin="'+i+'"]'),Lg.has(c)||(Lg.add(c),e={rel:e,crossOrigin:i,href:t},o.querySelector(c)===null&&(t=o.createElement("link"),Ct(t,"link",e),et(t),o.head.appendChild(t)))}}function DS(e){wa.D(e),Ug("dns-prefetch",e,null)}function LS(e,t){wa.C(e,t),Ug("preconnect",e,t)}function US(e,t,i){wa.L(e,t,i);var o=Os;if(o&&e&&t){var c='link[rel="preload"][as="'+ft(t)+'"]';t==="image"&&i&&i.imageSrcSet?(c+='[imagesrcset="'+ft(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(c+='[imagesizes="'+ft(i.imageSizes)+'"]')):c+='[href="'+ft(e)+'"]';var d=c;switch(t){case"style":d=qs(e);break;case"script":d=zs(e)}yn.has(d)||(e=g({rel:"preload",href:t==="image"&&i&&i.imageSrcSet?void 0:e,as:t},i),yn.set(d,e),o.querySelector(c)!==null||t==="style"&&o.querySelector(Vr(d))||t==="script"&&o.querySelector(Xr(d))||(t=o.createElement("link"),Ct(t,"link",e),et(t),o.head.appendChild(t)))}}function OS(e,t){wa.m(e,t);var i=Os;if(i&&e){var o=t&&typeof t.as=="string"?t.as:"script",c='link[rel="modulepreload"][as="'+ft(o)+'"][href="'+ft(e)+'"]',d=c;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=zs(e)}if(!yn.has(d)&&(e=g({rel:"modulepreload",href:e},t),yn.set(d,e),i.querySelector(c)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(Xr(d)))return}o=i.createElement("link"),Ct(o,"link",e),et(o),i.head.appendChild(o)}}}function qS(e,t,i){wa.S(e,t,i);var o=Os;if(o&&e){var c=ca(o).hoistableStyles,d=qs(e);t=t||"default";var y=c.get(d);if(!y){var S={loading:0,preload:null};if(y=o.querySelector(Vr(d)))S.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":t},i),(i=yn.get(d))&&pf(e,i);var x=y=o.createElement("link");et(x),Ct(x,"link",e),x._p=new Promise(function(z,K){x.onload=z,x.onerror=K}),x.addEventListener("load",function(){S.loading|=1}),x.addEventListener("error",function(){S.loading|=2}),S.loading|=4,$l(y,t,o)}y={type:"stylesheet",instance:y,count:1,state:S},c.set(d,y)}}}function zS(e,t){wa.X(e,t);var i=Os;if(i&&e){var o=ca(i).hoistableScripts,c=zs(e),d=o.get(c);d||(d=i.querySelector(Xr(c)),d||(e=g({src:e,async:!0},t),(t=yn.get(c))&&gf(e,t),d=i.createElement("script"),et(d),Ct(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},o.set(c,d))}}function BS(e,t){wa.M(e,t);var i=Os;if(i&&e){var o=ca(i).hoistableScripts,c=zs(e),d=o.get(c);d||(d=i.querySelector(Xr(c)),d||(e=g({src:e,async:!0,type:"module"},t),(t=yn.get(c))&&gf(e,t),d=i.createElement("script"),et(d),Ct(d,"link",e),i.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},o.set(c,d))}}function Og(e,t,i,o){var c=(c=de.current)?Yl(c):null;if(!c)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(t=qs(i.href),i=ca(c).hoistableStyles,o=i.get(t),o||(o={type:"style",instance:null,count:0,state:null},i.set(t,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=qs(i.href);var d=ca(c).hoistableStyles,y=d.get(e);if(y||(c=c.ownerDocument||c,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,y),(d=c.querySelector(Vr(e)))&&!d._p&&(y.instance=d,y.state.loading=5),yn.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},yn.set(e,i),d||HS(c,e,i,y.state))),t&&o===null)throw Error(r(528,""));return y}if(t&&o!==null)throw Error(r(529,""));return null;case"script":return t=i.async,i=i.src,typeof i=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=zs(i),i=ca(c).hoistableScripts,o=i.get(t),o||(o={type:"script",instance:null,count:0,state:null},i.set(t,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function qs(e){return'href="'+ft(e)+'"'}function Vr(e){return'link[rel="stylesheet"]['+e+"]"}function qg(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function HS(e,t,i,o){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?o.loading=1:(t=e.createElement("link"),o.preload=t,t.addEventListener("load",function(){return o.loading|=1}),t.addEventListener("error",function(){return o.loading|=2}),Ct(t,"link",i),et(t),e.head.appendChild(t))}function zs(e){return'[src="'+ft(e)+'"]'}function Xr(e){return"script[async]"+e}function zg(e,t,i){if(t.count++,t.instance===null)switch(t.type){case"style":var o=e.querySelector('style[data-href~="'+ft(i.href)+'"]');if(o)return t.instance=o,et(o),o;var c=g({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return o=(e.ownerDocument||e).createElement("style"),et(o),Ct(o,"style",c),$l(o,i.precedence,e),t.instance=o;case"stylesheet":c=qs(i.href);var d=e.querySelector(Vr(c));if(d)return t.state.loading|=4,t.instance=d,et(d),d;o=qg(i),(c=yn.get(c))&&pf(o,c),d=(e.ownerDocument||e).createElement("link"),et(d);var y=d;return y._p=new Promise(function(S,x){y.onload=S,y.onerror=x}),Ct(d,"link",o),t.state.loading|=4,$l(d,i.precedence,e),t.instance=d;case"script":return d=zs(i.src),(c=e.querySelector(Xr(d)))?(t.instance=c,et(c),c):(o=i,(c=yn.get(d))&&(o=g({},i),gf(o,c)),e=e.ownerDocument||e,c=e.createElement("script"),et(c),Ct(c,"link",o),e.head.appendChild(c),t.instance=c);case"void":return null;default:throw Error(r(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(o=t.instance,t.state.loading|=4,$l(o,i.precedence,e));return t.instance}function $l(e,t,i){for(var o=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=o.length?o[o.length-1]:null,d=c,y=0;y<o.length;y++){var S=o[y];if(S.dataset.precedence===t)d=S;else if(d!==c)break}d?d.parentNode.insertBefore(e,d.nextSibling):(t=i.nodeType===9?i.head:i,t.insertBefore(e,t.firstChild))}function pf(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function gf(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Vl=null;function Bg(e,t,i){if(Vl===null){var o=new Map,c=Vl=new Map;c.set(i,o)}else c=Vl,o=c.get(i),o||(o=new Map,c.set(i,o));if(o.has(e))return o;for(o.set(e,null),i=i.getElementsByTagName(e),c=0;c<i.length;c++){var d=i[c];if(!(d[Ei]||d[We]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var y=d.getAttribute(t)||"";y=e+y;var S=o.get(y);S?S.push(d):o.set(y,[d])}}return o}function Hg(e,t,i){e=e.ownerDocument||e,e.head.insertBefore(i,t==="title"?e.querySelector("head > title"):null)}function IS(e,t,i){if(i===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function Ig(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var Kr=null;function jS(){}function GS(e,t,i){if(Kr===null)throw Error(r(475));var o=Kr;if(t.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var c=qs(i.href),d=e.querySelector(Vr(c));if(d){e=d._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(o.count++,o=Xl.bind(o),e.then(o,o)),t.state.loading|=4,t.instance=d,et(d);return}d=e.ownerDocument||e,i=qg(i),(c=yn.get(c))&&pf(i,c),d=d.createElement("link"),et(d);var y=d;y._p=new Promise(function(S,x){y.onload=S,y.onerror=x}),Ct(d,"link",i),t.instance=d}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(o.count++,t=Xl.bind(o),e.addEventListener("load",t),e.addEventListener("error",t))}}function FS(){if(Kr===null)throw Error(r(475));var e=Kr;return e.stylesheets&&e.count===0&&yf(e,e.stylesheets),0<e.count?function(t){var i=setTimeout(function(){if(e.stylesheets&&yf(e,e.stylesheets),e.unsuspend){var o=e.unsuspend;e.unsuspend=null,o()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(i)}}:null}function Xl(){if(this.count--,this.count===0){if(this.stylesheets)yf(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Kl=null;function yf(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Kl=new Map,t.forEach(YS,e),Kl=null,Xl.call(e))}function YS(e,t){if(!(t.state.loading&4)){var i=Kl.get(e);if(i)var o=i.get(null);else{i=new Map,Kl.set(e,i);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<c.length;d++){var y=c[d];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(i.set(y.dataset.precedence,y),o=y)}o&&i.set(null,o)}c=t.instance,y=c.getAttribute("data-precedence"),d=i.get(y)||o,d===o&&i.set(null,c),i.set(y,c),this.count++,o=Xl.bind(this),c.addEventListener("load",o),c.addEventListener("error",o),d?d.parentNode.insertBefore(c,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),t.state.loading|=4}}var Qr={$$typeof:I,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function $S(e,t,i,o,c,d,y,S){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ns(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ns(0),this.hiddenUpdates=ns(null),this.identifierPrefix=o,this.onUncaughtError=c,this.onCaughtError=d,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=S,this.incompleteTransitions=new Map}function jg(e,t,i,o,c,d,y,S,x,z,K,J){return e=new $S(e,t,i,y,S,x,z,J),t=1,d===!0&&(t|=24),d=Wt(3,null,null,t),e.current=d,d.stateNode=e,t=Zu(),t.refCount++,e.pooledCache=t,t.refCount++,d.memoizedState={element:o,isDehydrated:i,cache:t},td(d),e}function Gg(e){return e?(e=ms,e):ms}function Fg(e,t,i,o,c,d){c=Gg(c),o.context===null?o.context=c:o.pendingContext=c,o=Va(t),o.payload={element:i},d=d===void 0?null:d,d!==null&&(o.callback=d),i=Xa(e,o,t),i!==null&&(sn(i,e,t),Ar(i,e,t))}function Yg(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function bf(e,t){Yg(e,t),(e=e.alternate)&&Yg(e,t)}function $g(e){if(e.tag===13){var t=hs(e,67108864);t!==null&&sn(t,e,67108864),bf(e,67108864)}}var Ql=!0;function VS(e,t,i,o){var c=D.T;D.T=null;var d=V.p;try{V.p=2,vf(e,t,i,o)}finally{V.p=d,D.T=c}}function XS(e,t,i,o){var c=D.T;D.T=null;var d=V.p;try{V.p=8,vf(e,t,i,o)}finally{V.p=d,D.T=c}}function vf(e,t,i,o){if(Ql){var c=Sf(o);if(c===null)rf(e,t,o,Pl,i),Xg(e,o);else if(QS(c,e,t,i,o))o.stopPropagation();else if(Xg(e,o),t&4&&-1<KS.indexOf(e)){for(;c!==null;){var d=Ha(c);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var y=qn(d.pendingLanes);if(y!==0){var S=d;for(S.pendingLanes|=2,S.entangledLanes|=2;y;){var x=1<<31-_t(y);S.entanglements[1]|=x,y&=~x}$n(d),(Le&6)===0&&(Ll=ce()+500,Gr(0))}}break;case 13:S=hs(d,2),S!==null&&sn(S,d,2),Ol(),bf(d,2)}if(d=Sf(o),d===null&&rf(e,t,o,Pl,i),d===c)break;c=d}c!==null&&o.stopPropagation()}else rf(e,t,o,null,i)}}function Sf(e){return e=wu(e),Ef(e)}var Pl=null;function Ef(e){if(Pl=null,e=oa(e),e!==null){var t=u(e);if(t===null)e=null;else{var i=t.tag;if(i===13){if(e=f(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Pl=e,null}function Vg(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_e()){case je:return 2;case qe:return 8;case bt:case un:return 32;case Kt:return 268435456;default:return 32}default:return 32}}var Mf=!1,ri=null,oi=null,li=null,Pr=new Map,Zr=new Map,ci=[],KS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Xg(e,t){switch(e){case"focusin":case"focusout":ri=null;break;case"dragenter":case"dragleave":oi=null;break;case"mouseover":case"mouseout":li=null;break;case"pointerover":case"pointerout":Pr.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zr.delete(t.pointerId)}}function Jr(e,t,i,o,c,d){return e===null||e.nativeEvent!==d?(e={blockedOn:t,domEventName:i,eventSystemFlags:o,nativeEvent:d,targetContainers:[c]},t!==null&&(t=Ha(t),t!==null&&$g(t)),e):(e.eventSystemFlags|=o,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function QS(e,t,i,o,c){switch(t){case"focusin":return ri=Jr(ri,e,t,i,o,c),!0;case"dragenter":return oi=Jr(oi,e,t,i,o,c),!0;case"mouseover":return li=Jr(li,e,t,i,o,c),!0;case"pointerover":var d=c.pointerId;return Pr.set(d,Jr(Pr.get(d)||null,e,t,i,o,c)),!0;case"gotpointercapture":return d=c.pointerId,Zr.set(d,Jr(Zr.get(d)||null,e,t,i,o,c)),!0}return!1}function Kg(e){var t=oa(e.target);if(t!==null){var i=u(t);if(i!==null){if(t=i.tag,t===13){if(t=f(i),t!==null){e.blockedOn=t,Go(e.priority,function(){if(i.tag===13){var o=an();o=rr(o);var c=hs(i,o);c!==null&&sn(c,i,o),bf(i,o)}});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Zl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=Sf(e.nativeEvent);if(i===null){i=e.nativeEvent;var o=new i.constructor(i.type,i);xu=o,i.target.dispatchEvent(o),xu=null}else return t=Ha(i),t!==null&&$g(t),e.blockedOn=i,!1;t.shift()}return!0}function Qg(e,t,i){Zl(e)&&i.delete(t)}function PS(){Mf=!1,ri!==null&&Zl(ri)&&(ri=null),oi!==null&&Zl(oi)&&(oi=null),li!==null&&Zl(li)&&(li=null),Pr.forEach(Qg),Zr.forEach(Qg)}function Jl(e,t){e.blockedOn===t&&(e.blockedOn=null,Mf||(Mf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,PS)))}var Wl=null;function Pg(e){Wl!==e&&(Wl=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Wl===e&&(Wl=null);for(var t=0;t<e.length;t+=3){var i=e[t],o=e[t+1],c=e[t+2];if(typeof o!="function"){if(Ef(o||i)===null)continue;break}var d=Ha(i);d!==null&&(e.splice(t,3),t-=3,Sd(d,{pending:!0,data:c,method:i.method,action:o},o,c))}}))}function Wr(e){function t(x){return Jl(x,e)}ri!==null&&Jl(ri,e),oi!==null&&Jl(oi,e),li!==null&&Jl(li,e),Pr.forEach(t),Zr.forEach(t);for(var i=0;i<ci.length;i++){var o=ci[i];o.blockedOn===e&&(o.blockedOn=null)}for(;0<ci.length&&(i=ci[0],i.blockedOn===null);)Kg(i),i.blockedOn===null&&ci.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(o=0;o<i.length;o+=3){var c=i[o],d=i[o+1],y=c[dt]||null;if(typeof d=="function")y||Pg(i);else if(y){var S=null;if(d&&d.hasAttribute("formAction")){if(c=d,y=d[dt]||null)S=y.formAction;else if(Ef(c)!==null)continue}else S=y.action;typeof S=="function"?i[o+1]=S:(i.splice(o,3),o-=3),Pg(i)}}}function xf(e){this._internalRoot=e}ec.prototype.render=xf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(r(409));var i=t.current,o=an();Fg(i,o,e,t,null,null)},ec.prototype.unmount=xf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Fg(e.current,2,null,e,null,null),Ol(),t[ra]=null}};function ec(e){this._internalRoot=e}ec.prototype.unstable_scheduleHydration=function(e){if(e){var t=jo();e={blockedOn:null,target:e,priority:t};for(var i=0;i<ci.length&&t!==0&&t<ci[i].priority;i++);ci.splice(i,0,e),i===0&&Kg(e)}};var Zg=a.version;if(Zg!=="19.1.1")throw Error(r(527,Zg,"19.1.1"));V.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=m(t),e=e!==null?p(e):null,e=e===null?null:e.stateNode,e};var ZS={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tc.isDisabled&&tc.supportsFiber)try{Xe=tc.inject(ZS),Pe=tc}catch{}}return ro.createRoot=function(e,t){if(!l(e))throw Error(r(299));var i=!1,o="",c=h0,d=m0,y=p0,S=null;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onUncaughtError!==void 0&&(c=t.onUncaughtError),t.onCaughtError!==void 0&&(d=t.onCaughtError),t.onRecoverableError!==void 0&&(y=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(S=t.unstable_transitionCallbacks)),t=jg(e,1,!1,null,null,i,o,c,d,y,S,null),e[ra]=t.current,sf(e),new xf(t)},ro.hydrateRoot=function(e,t,i){if(!l(e))throw Error(r(299));var o=!1,c="",d=h0,y=m0,S=p0,x=null,z=null;return i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(d=i.onUncaughtError),i.onCaughtError!==void 0&&(y=i.onCaughtError),i.onRecoverableError!==void 0&&(S=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(x=i.unstable_transitionCallbacks),i.formState!==void 0&&(z=i.formState)),t=jg(e,1,!0,t,i??null,o,c,d,y,S,x,z),t.context=Gg(null),i=t.current,o=an(),o=rr(o),c=Va(o),c.callback=null,Xa(i,c,o),i=o,t.current.lanes=i,zn(t,i),$n(t),e[ra]=t.current,sf(e),new ec(t)},ro.version="19.1.1",ro}var Ky;function X3(){if(Ky)return If.exports;Ky=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(a){console.error(a)}}return n(),If.exports=V3(),If.exports}var K3=X3(),pt=om();const fc=10,Q3=1.5,P3=1.5,Qy=1,Z3=.6,Py="⚔️ +50% attack · 🛡️ Barrier · ♾️ Immortal",Vi=5,Xi=3;let gt=null;function J3(){gt&&(gt.tickTimer&&clearInterval(gt.tickTimer),gt.timeout&&clearTimeout(gt.timeout),gt=null)}function lm(){return gt!==null}function wb(){return gt?Math.max(0,gt.endTime-performance.now())/1e3:0}function W3(n,a){if(lm()||!n.spendResource(Vi,se.SISU))return!1;const s=[];for(const l of a){if(l.faction!=="player"||l.isDead())continue;const u=`sisu-burst-${l.id}`,f={unit:l,attackDelta:0,movementDelta:0,shieldBonusApplied:Qy,shieldBonusRemaining:Qy,wasImmortal:l.isImmortal()};hM({id:u,duration:fc,data:f,onApply:()=>{const h=l.stats.attackDamage,m=Math.round(h*Q3);f.attackDelta=Math.max(0,m-h),f.attackDelta!==0&&(l.stats.attackDamage=h+f.attackDelta);const p=l.stats.movementRange,g=Math.max(1,Math.round(p*P3));f.movementDelta=Math.max(0,g-p),f.movementDelta!==0&&(l.stats.movementRange=p+f.movementDelta),f.shieldBonusRemaining=f.shieldBonusApplied,l.setShield(l.getShield()+f.shieldBonusApplied),l.setImmortal(!0),l.fearless=!0},onExpire:()=>{let h=!1;if(f.attackDelta!==0){const p=l.stats.attackDamage,g=Math.max(0,p-f.attackDelta);g!==p&&(l.stats.attackDamage=g,h=!0)}if(f.movementDelta!==0){const p=l.stats.movementRange,g=Math.max(0,p-f.movementDelta);g!==p&&(l.stats.movementRange=g,h=!0)}l.setImmortal(f.wasImmortal);const m=Math.max(0,Math.min(f.shieldBonusApplied,f.shieldBonusRemaining));m>0&&l.setShield(Math.max(0,l.getShield()-m)),delete l.fearless,h&&ne.emit("unit:stats:changed",{unitId:l.id,stats:{...l.stats}}),gt&&(gt.affected=gt.affected.filter(p=>p.modifierId!==u))},hooks:{"combat:onHit":h=>{const m=h;if(m.source!=="defender"||m.defender.id!==l.id||m.shieldDamage<=0||f.shieldBonusRemaining<=0)return;const p=Math.min(f.shieldBonusRemaining,m.shieldDamage);f.shieldBonusRemaining=Math.max(0,f.shieldBonusRemaining-p)}}}),s.push({unit:l,modifierId:u,state:f})}return gt={endTime:performance.now()+fc*1e3,status:Py,affected:s,tickTimer:null,timeout:null},ne.emit("sisuBurstStart",{remaining:fc,status:Py}),gt.tickTimer=setInterval(()=>{if(!gt)return;const l=Math.max(0,Math.ceil(wb()));l>0&&ne.emit("sisuBurstTick",{remaining:l,status:gt.status})},1e3),gt.timeout=setTimeout(()=>{ex()},fc*1e3),!0}function ex(){if(gt){for(const n of gt.affected)mM(n.modifierId);J3(),ne.emit("sisuBurstEnd",{})}}function tx(n,a,s,r){const l=a.filter(u=>u.faction==="player"&&!u.isDead());if(l.length===0||!n.spendResource(Xi,se.SISU))return!1;for(const u of l){const f=ib(s,3,a)??{...s};u.setCoord(f);const h=Math.round(u.getMaxHealth()*Z3);u.stats.health=Math.min(u.getMaxHealth(),Math.max(u.stats.health,h))}return r.revealAround(s,3,{autoFrame:!1}),ne.emit("torilleRecalled",{count:l.length}),!0}let Zi=!1;function cm(){return Zi}function uu(n){Zi!==n&&(Zi=n,ne.emit("game:pause-changed",{paused:Zi}))}function nx(){return uu(!Zi),Zi}function ax(){Zi&&uu(!1)}const ix=["/assets/sounds/sauna-forest.ogg","/assets/sounds/sauna-forest.mp3"],Ab="audio_enabled",xh=new Set,du=new Set;let Ki=null,hc=null,Ca=null,So=null;function sx(n){if(typeof localStorage>"u")return null;try{return localStorage.getItem(n)}catch(a){return console.warn("Unable to read ambience preference",n,a),null}}const Cb=sx(Ab);let Oa=Cb==="true",Eo=Cb!==null;const wh=ru();let _c=_b(wh.channels.music.volume,.65),Ji=!1,ta=wh.channels.master.muted||wh.channels.music.muted;const js=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)"):null;let Tb=js?.matches??!1;if(js){const n=a=>{Tb=a.matches};typeof js.addEventListener=="function"?js.addEventListener("change",n):typeof js.addListener=="function"&&js.addListener(n)}if(typeof window<"u"&&!Eo){const n=()=>{Eo||(Eo=!0,Lb(!0),fu())};window.addEventListener("pointerdown",n,{once:!0}),window.addEventListener("keydown",n,{once:!0})}Vh(n=>{const a=_b(n.channels.music.volume,_c),s=n.channels.master.muted||n.channels.music.muted,r=Math.abs(a-_c)>5e-4;if(_c=a,s!==ta){ta=s,ta?Db():Oa?fu():(_o(!0),To());return}r&&To()});function _b(n,a){return Number.isFinite(n)?n<0?0:n>1?1:n:a}function To(){const n=Ub();for(const a of xh)a(n)}function rx(n){if(!(typeof localStorage>"u"))try{localStorage.setItem(Ab,n?"true":"false")}catch(a){console.warn("Unable to persist ambience preference",a)}}function Rb(n){if(Ca)return Ca;const a=n.createGain();a.gain.value=Oa&&!ta?1:0;const s=$h("music");return s?a.connect(s):a.connect(n.destination),Ca=a,a}function _o(n=!1){if(!Ca)return;const a=Ca.context,s=Oa&&!ta?1:0,r=a.currentTime;Ca.gain.cancelScheduledValues(r),n?Ca.gain.setValueAtTime(s,r):Ca.gain.setTargetAtTime(s,r,.25)}function ox(){return Tb?.6:4.2}function Nb(){So!==null&&(clearTimeout(So),So=null)}function Ah(n){try{n.source.stop()}catch{}n.source.disconnect(),n.gain.disconnect(),du.delete(n)}function lx(){for(const n of[...du])Ah(n)}async function cx(n){return Ki||(hc||(hc=(async()=>{for(const a of ix)try{const s=await fetch(a);if(!s.ok)continue;const r=await s.arrayBuffer();return await n.decodeAudioData(r)}catch(s){console.warn("Failed to fetch ambience source",a,s)}throw new Error("No ambience sources available")})().then(a=>(Ki=a,a)).catch(a=>{throw hc=null,a})),hc)}function ux(n,a){if(!Ji)return;Nb();const s=Math.max(0,n-a.currentTime-.05);So=setTimeout(()=>{So=null,Ji&&kb(n)},s*1e3)}function kb(n){const a=Ca?.context??Ob();if(!a||!Ki)return;const s=a.createGain(),r=a.createBufferSource();r.buffer=Ki,r.loop=!1,r.connect(s),s.connect(Rb(a));const l=Math.min(ox(),Ki.duration/2),u=Number.isFinite(l)&&l>0?l:.25,f=Math.max(a.currentTime,n);s.gain.setValueAtTime(0,f),s.gain.linearRampToValueAtTime(1,f+u);const h=n+Ki.duration,m=h-u;m>f&&s.gain.setValueAtTime(1,m),s.gain.linearRampToValueAtTime(.001,h+.1);const p={source:r,gain:s,stopTime:h};du.add(p),r.addEventListener("ended",()=>{Ah(p)});try{r.start(n)}catch(g){console.warn("Failed to start ambience layer",g),Ah(p);return}ux(h-u,a)}async function fu(){if(Ji||!Oa||ta){_o();return}const n=Ob();if(n){Rb(n),_o();try{const a=await cx(n);if(!Oa||ta)return;await n.resume().catch(()=>{}),Ji=!0;const s=Math.max(n.currentTime+.12,n.currentTime);kb(s),To()}catch(a){console.warn("Unable to start ambience",a)}}}function Db(){if(!Ji&&du.size===0){_o(!0);return}Ji=!1,Nb(),lx(),_o(!0),To()}function Lb(n){Oa===n&&Eo||(Oa=n,Eo=!0,rx(n),n?ta||fu():Db(),To())}function Ub(){return{enabled:Oa,playing:Ji,volume:_c,globallyMuted:ta}}function dx(n){return xh.add(n),()=>{xh.delete(n)}}Oa&&!ta&&fu();function Ob(){return Yh()}const fx='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',$f={master:"Master mix",music:"Ambience soundscape",sfx:"Effects & interface"},hx={master:"Controls the overall loudness for every channel in the frontier.",music:"Shapes the ambience loops and atmospheric swells around the sauna.",sfx:"Balances unit callouts, UI clicks, and battle feedback cues."},mx="linear-gradient(90deg, rgba(59,130,246,0.85) 0%, rgba(14,165,233,0.9) VAR%, rgba(148,163,184,0.35) VAR%, rgba(71,85,105,0.2) 100%)";function Ch(n,a){n.style.backgroundImage=mx.replace(/VAR/g,`${a}%`)}function Th(n){return`${Math.round(n)}%`}function px(n,a,s){const r=l=>{if(l.key==="Escape"){l.preventDefault(),s();return}if(l.key!=="Tab")return;const u=a.querySelectorAll(fx);if(u.length===0){l.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;l.shiftKey?(m===f||!a.contains(m))&&(l.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(l.preventDefault(),f.focus())};return n.addEventListener("keydown",r),()=>n.removeEventListener("keydown",r)}function qb(n,a,s){const r=a.channels[n],l=a.channels.master;if(n==="music"&&!s.enabled)return"Ambience paused";if(r.muted)return"Muted at mixer";if(n!=="master"&&l.muted)return"Master mute active";const u=Math.round(r.effectiveVolume*100);return u<=0?"Output silent":n==="master"?`Master output ${u}%`:n==="music"?`Soundscape live ${u}%`:`Effects live ${u}%`}function Vf(n,a,s,r,l,u,f){const h=n.createElement("section");h.className="rounded-hud-xl border border-white/12 bg-[linear-gradient(155deg,rgba(15,26,56,0.92),rgba(9,14,34,0.96))] p-5 shadow-[0_24px_45px_rgba(4,10,25,0.55)] backdrop-blur-[18px] backdrop-saturate-[140%]";const m=n.createElement("header");m.className="flex flex-wrap items-start justify-between gap-3";const p=n.createElement("div");p.className="space-y-1";const g=n.createElement("h3");g.className="text-lg font-semibold tracking-tight text-white",g.textContent=$f[a];const b=n.createElement("p");b.className="max-w-[32ch] text-sm text-slate-300/85",b.textContent=hx[a],p.append(g,b);const v=n.createElement("span");v.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70",v.textContent=qb(a,s,r),m.append(p,v);const E=n.createElement("div");E.className="mt-5 flex items-center gap-4";const M=n.createElement("input");M.type="range",M.min="0",M.max="100",M.step="1",M.className="h-2 flex-1 appearance-none rounded-full bg-slate-600/30 accent-accent transition-[background-image] duration-200 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",M.setAttribute("aria-label",`${$f[a]} level`);const C=n.createElement("span");C.className="text-sm font-semibold text-slate-200",E.append(M,C);const R=n.createElement("div");R.className="mt-4 flex flex-wrap items-center gap-3";const N=n.createElement("button");if(N.type="button",N.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/60 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-white/80 transition-all duration-150 ease-out hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",N.setAttribute("aria-label",`Toggle mute for ${$f[a]}`),N.addEventListener("click",()=>{const Y=!Yi.channels[a].muted;l(a,Y)}),R.append(N),a==="sfx"){const Y=n.createElement("button");Y.type="button",Y.className="inline-flex items-center gap-2 rounded-full border border-accent/40 bg-accent/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-accent-200 transition-all duration-150 ease-out hover:bg-accent/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",Y.textContent="Play sample",Y.addEventListener("click",()=>{ea("spawn")}),R.append(Y)}let q;a==="music"&&f&&(q=n.createElement("button"),q.type="button",q.className="inline-flex items-center gap-2 rounded-full border border-emerald-300/25 bg-emerald-400/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.08em] text-emerald-200 transition-all duration-150 ease-out hover:bg-emerald-400/25 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300",q.addEventListener("click",()=>{f()}),R.append(q));const I=Math.round(s.channels[a].volume*100);return M.value=String(I),Ch(M,I),C.textContent=Th(I),N.setAttribute("aria-pressed",s.channels[a].muted?"true":"false"),N.textContent=s.channels[a].muted?"Muted":"Active",a==="music"&&(M.title=r.enabled?"Adjust ambience loudness":"Ambience paused — set the level ahead of resuming."),M.addEventListener("input",()=>{const Y=Number(M.value);Ch(M,Y),C.textContent=Th(Y),u(a,Y/100)}),h.append(m,E,R),{card:h,slider:M,value:C,muteButton:N,status:v,ambienceToggle:q}}let Yi=ru();function gx(n){const{container:a,onClose:s}=n;if(!a)return{destroy(){},focus(){}};const r=a.ownerDocument??document,l=r.createElement("div");l.className="pointer-events-auto fixed inset-0 z-[1200] flex items-center justify-center bg-slate-950/75 p-4 backdrop-blur-[22px] backdrop-saturate-[140%]",l.setAttribute("role","presentation");const u=r.createElement("section");u.className="w-full max-w-[min(580px,92vw)] space-y-6 rounded-hud-xl border border-white/12 bg-[linear-gradient(145deg,rgba(12,22,45,0.95),rgba(7,13,29,0.97))] p-6 text-slate-100 shadow-[0_32px_60px_rgba(4,10,24,0.7)] backdrop-blur-[24px] backdrop-saturate-[150%]",u.setAttribute("role","dialog"),u.setAttribute("aria-modal","true");const f=`audio-mixer-title-${Date.now()}`;u.setAttribute("aria-labelledby",f),u.tabIndex=-1;const h=r.createElement("header");h.className="flex items-start justify-between gap-4";const m=r.createElement("div");m.className="space-y-1";const p=r.createElement("h2");p.id=f,p.className="text-2xl font-semibold tracking-tight text-white",p.textContent="Audio mixer";const g=r.createElement("p");g.className="max-w-[46ch] text-sm text-slate-300/85",g.textContent="Dial in the master bus, ambience beds, and tactical feedback without leaving the battlefield.",m.append(p,g);const b=r.createElement("button");b.type="button",b.className="rounded-full border border-white/20 bg-slate-800/70 px-3 py-1 text-sm font-semibold text-white/70 transition-all duration-150 hover:bg-slate-700/70 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent",b.textContent="Close",h.append(m,b);const v=r.createElement("span");v.className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-slate-800/65 px-3 py-1 text-xs font-semibold uppercase tracking-[0.08em] text-white/70";const E=r.createElement("div");E.className="space-y-5";let M=Ub();const C={master:Vf(r,"master",Yi,M,(G,T)=>{qE(T)},(G,T)=>{LE(T)},null),music:Vf(r,"music",Yi,M,(G,T)=>{zE(T)},(G,T)=>{UE(T)},()=>{Lb(!M.enabled)}),sfx:Vf(r,"sfx",Yi,M,(G,T)=>{BE(T)},(G,T)=>{OE(T)},null)};E.append(C.master.card,C.music.card,C.sfx.card),u.append(h,v,E),l.append(u),a.append(l);let R=!1;function N(){const G=C.music.ambienceToggle;G&&(G.setAttribute("aria-pressed",M.enabled?"true":"false"),G.textContent=M.enabled?"Ambience enabled":"Ambience paused",G.title=M.enabled?"Disable ambience loops":"Enable ambience loops")}function q(G){Yi=G;const T=G.contextState==="uninitialized"?"Context idle":G.contextState==="running"?"Context running":"Context suspended";v.textContent=T,["master","music","sfx"].forEach(k=>{const A=C[k],F=G.channels[k],B=Math.round(F.volume*100);A.slider.value=String(B),Ch(A.slider,B),A.value.textContent=Th(B),A.muteButton.setAttribute("aria-pressed",F.muted?"true":"false"),A.muteButton.textContent=F.muted?"Muted":"Active",A.status.textContent=qb(k,G,M),k==="music"&&(A.slider.title=M.enabled?"Adjust ambience loudness":"Ambience paused — set the level ahead of resuming.")}),N()}function I(){R||(R=!0,Y(),l.parentElement&&l.remove(),s?.())}function Y(){Q.forEach(G=>{try{G()}catch{}}),Q.length=0}const Q=[],ie=G=>{G.target===l&&I()};l.addEventListener("click",ie),Q.push(()=>l.removeEventListener("click",ie)),b.addEventListener("click",I),Q.push(()=>b.removeEventListener("click",I));const ee=px(l,u,I);Q.push(ee);const oe=Vh(G=>{q(G)});Q.push(oe);const P=dx(G=>{M=G,N(),q(Yi)});return Q.push(P),q(Yi),u.focus(),{destroy(){I()},focus(){u.focus()}}}function Zy(...n){return n.filter(Boolean).join(" ")}function Jy(n,a){return!(n.code!==a.code||(a.shift??!1)!==n.shiftKey||(a.alt??!1)!==n.altKey||(a.meta??!1)!==n.metaKey||(a.ctrl??!1)!==n.ctrlKey)}function yx(n){return!Number.isFinite(n)||n<=0?"0s":`${Math.max(0,Math.ceil(n))}s`}function bx(){const[n,a]=pt.useState(()=>{const s=lm();return{active:s,remaining:s?Math.ceil(wb()):0,status:s?"Burst active":void 0}});return pt.useEffect(()=>{const s=({remaining:u,status:f})=>{a({active:!0,remaining:Math.ceil(u),status:f})},r=({remaining:u,status:f})=>{a(h=>({active:!0,remaining:Math.ceil(u),status:f??h.status}))},l=()=>{a({active:!1,remaining:0,status:void 0})};return ne.on("sisuBurstStart",s),ne.on("sisuBurstTick",r),ne.on("sisuBurstEnd",l),()=>{ne.off("sisuBurstStart",s),ne.off("sisuBurstTick",r),ne.off("sisuBurstEnd",l)}},[]),n}function vx(){const[n,a]=pt.useState(()=>cm());return pt.useEffect(()=>{const s=({paused:r})=>{a(r)};return ne.on("game:pause-changed",s),()=>{ne.off("game:pause-changed",s)}},[]),n}function Wy(n){const a=n.target;if(!a)return!1;const s=a.tagName;return!!(s==="INPUT"||s==="TEXTAREA"||s==="SELECT"||a.isContentEditable)}function Sx({state:n,abilities:a}){const[s,r]=pt.useState(()=>n.getResource(se.SISU)),[l,u]=pt.useState(()=>ph()),[f,h]=pt.useState(!1),[m,p]=pt.useState(null),g=pt.useRef({}),[b,v]=pt.useState(()=>new Set),E=bx(),M=vx(),C=pt.useRef(null),R=pt.useCallback(T=>{v(A=>{const F=new Set(A);return F.add(T),F});const k=g.current[T];k&&window.clearTimeout(k),g.current[T]=window.setTimeout(()=>{v(A=>{const F=new Set(A);return F.delete(T),F}),delete g.current[T]},650)},[]);pt.useEffect(()=>{const T=({resource:k,total:A})=>{k===se.SISU&&r(A)};return ne.on("resourceChanged",T),()=>{ne.off("resourceChanged",T),Object.values(g.current).forEach(k=>{k&&window.clearTimeout(k)}),g.current={}}},[]),pt.useEffect(()=>oM(u),[]),pt.useEffect(()=>()=>{C.current?.destroy(),C.current=null},[]);const N=pt.useCallback(()=>{const T=document.getElementById("ui-overlay");if(!T)return!1;if(C.current)return C.current.destroy(),C.current=null,h(!1),!0;const k=gx({container:T,onClose:()=>{C.current=null,h(!1)}});return C.current=k,h(!0),k.focus(),!0},[]),q=a.useSisuBurst,I=a.torille,Y=a.onOpenBuildPlanner,Q=!q||E.active||s<Vi,ie=q?E.active?"Burst already surging.":s<Vi?`Requires ${Vi} SISU.`:void 0:"Burst controls offline in this build.",ee=!I||s<Xi,oe=I?s<Xi?`Requires ${Xi} SISU.`:void 0:"Torille rally is unavailable right now.",P=pt.useMemo(()=>[{id:"burst",icon:"⚡️",label:"Sisu Burst",description:"Ignite a surge of fury and resilience across your warriors.",hotkey:{code:"KeyQ",label:"Q"},accent:"primary",cost:`-${Vi} SISU`,detail:E.active?`${E.status??"Burst active"} · ${yx(E.remaining)}`:void 0,blocked:Q,blockedReason:ie,interactive:!!q,onActivate:()=>q?q():!1},{id:"torille",icon:"📣",label:"Torille!",description:"Call every survivor home to the sauna to regroup and heal.",hotkey:{code:"KeyW",label:"W"},accent:"primary",cost:`-${Xi} SISU`,blocked:ee,blockedReason:oe,interactive:!!I,onActivate:()=>I?I():!1},{id:"build",icon:"🛠️",label:"Build",description:"Draft new structures to reinforce your frontier.",hotkey:{code:"KeyE",label:"E"},accent:"neutral",blocked:!Y,blockedReason:Y?void 0:"Construction planner will unlock in a forthcoming update.",interactive:!!Y,onActivate:()=>Y?Y()??!0:!1},{id:"sound",icon:l?"🔇":f?"🎚️":"🎛️",label:"Audio",description:"Open the in-game mixer to balance master, ambience, and effects.",hotkey:{code:"KeyR",label:"R"},accent:"neutral",toggled:f,detail:f?"Mixer open":l?"Muted":"Live mix",interactive:!0,blocked:!1,onActivate:()=>!!N()},{id:"pause",icon:M?"⏸️":"▶️",label:M?"Paused":"Pause",description:M?"Time is frozen — resume when your strategy is ready.":"Freeze the battlefield to reassess and issue commands.",hotkey:{code:"Space",label:"Space"},accent:"neutral",toggled:M,detail:M?"Combat frozen":"Time flowing",interactive:!0,blocked:!1,onActivate:()=>(nx(),!0)}],[E.active,E.remaining,Q,ie,I,f,l,Y,M,ee,oe,q]),G=pt.useCallback(T=>{if(!T.interactive){R(T.id);return}if(T.blocked){R(T.id);return}T.onActivate?.()===!1&&R(T.id)},[R]);return pt.useEffect(()=>{const T=A=>{if(A.repeat||Wy(A))return;const F=P.find(B=>Jy(A,B.hotkey));F&&(A.preventDefault(),p(F.id),G(F))},k=A=>{if(Wy(A))return;const F=P.find(B=>Jy(A,B.hotkey));F&&(A.preventDefault(),p(B=>B===F.id?null:B))};return window.addEventListener("keydown",T),window.addEventListener("keyup",k),()=>{window.removeEventListener("keydown",T),window.removeEventListener("keyup",k)}},[P,G]),Vt.jsx("div",{className:"pointer-events-none w-full",children:Vt.jsx("div",{className:"pointer-events-auto mx-auto flex w-full max-w-4xl flex-col gap-4 rounded-[26px] border border-white/10 bg-[linear-gradient(145deg,rgba(11,17,30,0.86),rgba(6,10,18,0.92))] p-6 shadow-[0_26px_65px_rgba(6,12,24,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)] backdrop-blur-xl","aria-label":"Combat and systems action bar",children:Vt.jsx("div",{className:"flex flex-wrap items-stretch justify-center gap-4",children:P.map(T=>{const k=m===T.id,A=b.has(T.id),B=(T.blocked??!1)||!T.interactive,D=T.detail??T.blockedReason,V=Zy("group relative flex min-w-[150px] flex-1 flex-col gap-2 rounded-[20px] border border-white/10 px-5 py-4 text-left transition-all duration-200 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70 focus-visible:ring-offset-0","bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.22),rgba(14,25,45,0.6))] shadow-[0_18px_42px_rgba(8,25,53,0.55)]",T.accent==="primary"&&"border-sky-300/40 bg-[radial-gradient(circle_at_top,rgba(56,189,248,0.32),rgba(11,22,45,0.7))]",T.accent==="danger"&&"border-rose-400/45 bg-[radial-gradient(circle_at_top,rgba(244,114,182,0.32),rgba(45,9,25,0.75))]",k&&"ring-2 ring-sky-300/80 ring-offset-0 translate-y-[-2px] shadow-[0_24px_48px_rgba(56,189,248,0.45)]",A&&'animate-hud-shake after:pointer-events-none after:absolute after:inset-0 after:rounded-[inherit] after:border after:border-rose-300/45 after:bg-[radial-gradient(circle_at_center,rgba(248,113,113,0.18),rgba(248,113,113,0))] after:content-[""] after:animate-hud-pulse',!B&&!k&&"hover:-translate-y-1 hover:shadow-[0_24px_50px_rgba(56,189,248,0.4)]",B&&"cursor-not-allowed opacity-70",T.toggled&&"border-sky-400/60 shadow-[0_0_36px_rgba(56,189,248,0.45)]");return Vt.jsxs("button",{type:"button",className:V,"aria-pressed":T.toggled?"true":void 0,"aria-disabled":B?"true":void 0,"data-hotkey":T.hotkey.label,onClick:te=>{if(B){te.preventDefault(),R(T.id);return}G(T)},onKeyDown:te=>{(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),G(T))},title:Zy(T.description,T.blockedReason),children:[Vt.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Vt.jsxs("span",{className:"flex items-center gap-3 text-base font-semibold uppercase tracking-[0.18em] text-slate-100",children:[Vt.jsx("span",{"aria-hidden":"true",className:"text-2xl",children:T.icon}),T.label]}),Vt.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-slate-300/80",children:T.hotkey.label})]}),Vt.jsx("p",{className:"text-sm leading-relaxed text-slate-200/80",children:T.description}),Vt.jsxs("div",{className:"flex items-center justify-between text-xs font-medium uppercase tracking-[0.28em] text-slate-300/70",children:[Vt.jsx("span",{children:D??"​"}),T.cost?Vt.jsx("span",{className:"text-slate-200/90",children:T.cost}):Vt.jsx("span",{className:"opacity-0",children:"cost"})]})]},T.id)})})})})}function Ex(n,a,s={}){const r=ar(a),l=a.ownerDocument.createElement("div");l.dataset.component="action-bar",l.dataset.tutorialTarget="combat",l.className="flex w-full justify-center";const u=r.regions.bottom,f=u.querySelector("#build-id");f?u.insertBefore(l,f):u.appendChild(l);const h=K3.createRoot(l);return h.render(Vt.jsx(Sx,{state:n,abilities:s})),{destroy(){h.unmount(),l.remove()}}}const Mx="(max-width: 820px)",zb="is-mobile",Bb="is-desktop";let Cn=null,Gc=null,Pn=!1,mc=0;const Fc=new Set,_h=new Set,Yc=n=>{for(const a of _h)a.classList.toggle(zb,n),a.classList.toggle(Bb,!n),a.dataset.viewport=n?"mobile":"desktop"},xx=n=>{if(Pn!==n){Pn=n,Yc(Pn);for(const a of Array.from(Fc))try{a(Pn)}catch(s){console.error("Failed to notify mobile listener",s)}}},Hb=()=>{if(Cn||typeof window>"u")return;Cn=window.matchMedia(Mx),Pn=Cn.matches,Yc(Pn);const n=a=>{xx(a.matches)};typeof Cn.addEventListener=="function"?(Cn.addEventListener("change",n),Gc=()=>Cn?.removeEventListener("change",n)):(Cn.addListener(n),Gc=()=>Cn?.removeListener(n))},wx=()=>{Cn&&(Gc?.(),Gc=null,Cn=null)},Ib=(n,{immediate:a=!0}={})=>(Hb(),Fc.add(n),a&&n(Pn),()=>{Fc.delete(n)}),Ax=({root:n,onChange:a,immediate:s=!0}={})=>{Hb();const r=n??(typeof document<"u"?document.documentElement:null);r&&(_h.add(r),Yc(Pn)),mc+=1;let l=null;return a?l=Ib(a,{immediate:s}):s&&Cn&&Yc(Pn),{matches:()=>Pn,dispose:()=>{r&&(_h.delete(r),r.classList.remove(zb,Bb),(r.dataset.viewport==="mobile"||r.dataset.viewport==="desktop")&&delete r.dataset.viewport),l&&(l(),l=null),mc=Math.max(0,mc-1),mc===0&&Fc.size===0&&wx()}}};function Cx(n){const a=[n.name];return n.description&&a.push(n.description),n.rarity&&a.push(`Rarity: ${n.rarity}`),n.quantity>1&&a.push(`Quantity: ${n.quantity}`),a.join(" — ")}function Tx(n){const a=document.createElement("span");a.classList.add("item-icon__fallback");const s=n.trim();return a.textContent=s?s[0]?.toUpperCase()??"?":"?",a.setAttribute("aria-hidden","true"),a}function _x(n,a){const s=document.createElement("img");return s.src=n,s.alt="",s.decoding="async",s.loading="lazy",s.classList.add("item-icon__image"),s.setAttribute("aria-hidden","true"),s.title=a,s}function Rx(n){const a=document.createElement("li");a.classList.add("item-icon"),a.dataset.itemId=n.id;const s=Cx(n);if(a.title=s,a.setAttribute("aria-label",s),a.setAttribute("role","listitem"),n.rarity&&(a.dataset.rarity=n.rarity.toLowerCase()),n.icon&&n.icon.trim().length>0?a.appendChild(_x(n.icon,n.name)):a.appendChild(Tx(n.name)),n.quantity>1){const r=document.createElement("span");r.classList.add("item-icon__quantity"),r.textContent=`×${n.quantity}`,r.setAttribute("aria-hidden","true"),a.appendChild(r)}return a}const Nx=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Rh(n){return n===1/0?"∞":!Number.isFinite(n)||n<=0?"0s":`${Nx.format(Math.ceil(n))}s`}function kx(n){const a=[n.name];return n.description&&a.push(n.description),n.source&&a.push(`Source: ${n.source}`),n.duration!==1/0&&a.push(`Duration: ${Rh(n.duration)}`),a.push(`Remaining: ${Rh(n.remaining)}`),n.stacks&&n.stacks>1&&a.push(`Stacks: ${n.stacks}`),a.join(" — ")}function Dx(n){const a=document.createElement("li");a.classList.add("mod-pill"),a.dataset.modifierId=n.id,a.title=kx(n),a.setAttribute("aria-label",a.title),a.setAttribute("role","listitem"),a.dataset.duration=n.duration===1/0?"infinite":String(n.duration),a.dataset.remaining=n.remaining===1/0?"infinite":String(n.remaining),n.appliedAt!==void 0&&(a.dataset.appliedAt=String(n.appliedAt)),n.stacks&&n.stacks>1&&(a.dataset.stacks=String(n.stacks));const s=document.createElement("span");if(s.classList.add("mod-pill__name"),s.textContent=n.name,s.setAttribute("aria-hidden","true"),a.appendChild(s),n.stacks&&n.stacks>1){const l=document.createElement("span");l.classList.add("mod-pill__stacks"),l.textContent=`×${n.stacks}`,l.setAttribute("aria-hidden","true"),a.appendChild(l)}const r=document.createElement("span");return r.classList.add("mod-pill__timer"),r.textContent=Rh(n.remaining),r.setAttribute("aria-hidden","true"),a.appendChild(r),n.remaining!==1/0&&n.remaining<=5&&(a.dataset.urgent="true"),a}const Nh={engaged:"Engaged on the field",reserve:"On reserve duty",downed:"Recovering from battle"},$e=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),e2="panel-roster-title";function Lx(n){return n.length===0?"No defining traits yet":n.join(" • ")}function jb(n){return Number.isFinite(n)?Math.max(0,Math.min(100,Math.round(n*100))):0}function Ux(n){const a=$e;if(n.xpForNext===null)return`${a.format(n.xp)} XP • Max level`;const s=jb(n.progress);return`${a.format(n.xpIntoLevel)} / ${a.format(n.xpForNext)} XP • ${s}%`}function Gb(n){const a=[],s=(r,l)=>{l>0&&a.push(`+${$e.format(l)} ${r}`)};return s("Vigor",n.vigor),s("Focus",n.focus),s("Resolve",n.resolve),a.length===0?"No level bonuses yet":a.join(" • ")}function Hs(n,a){const r=Math.round(n-(typeof a=="number"?a:0));if(r===0)return"";const l=$e.format(Math.abs(r));return r>0?` (+${l})`:` (-${l})`}function Ox(n){if(!n)return"No stat changes";const a=[],s=(r,l)=>{if(typeof l=="number"&&l!==0){const u=l>0?"+":"−";a.push(`${r} ${u}${$e.format(Math.abs(l))}`)}};return s("HP",n.health),s("ATK",n.attackDamage),s("RNG",n.attackRange),s("MOV",n.movementRange),s("DEF",n.defense),s("Shield",n.shield),a.length===0?"No stat changes":a.join(", ")}function qx(n){const{stats:a,baseStats:s}=n,r=[`HP ${$e.format(a.health)}/${$e.format(a.maxHealth)}${Hs(a.maxHealth,s.maxHealth)}`];return a.shield&&a.shield>0&&r.push(`Shield ${$e.format(a.shield)}${Hs(a.shield,s.shield)}`),r.push(`ATK ${$e.format(a.attackDamage)}${Hs(a.attackDamage,s.attackDamage)}`),r.push(`RNG ${$e.format(a.attackRange)}${Hs(a.attackRange,s.attackRange)}`),a.defense&&a.defense>0&&r.push(`DEF ${$e.format(a.defense)}${Hs(a.defense,s.defense)}`),r.push(`MOV ${$e.format(a.movementRange)}${Hs(a.movementRange,s.movementRange)}`),r.push(`Upkeep ${$e.format(n.upkeep)} beer`),r.join(" • ")}function zx(n){const{stats:a}=n,s=[n.name,Nh[n.status]];s.push(`level ${n.progression.level}`),s.push(`health ${$e.format(a.health)} of ${$e.format(a.maxHealth)}`),a.shield&&a.shield>0&&s.push(`shield ${$e.format(a.shield)}`),s.push(`attack ${$e.format(a.attackDamage)}`),a.defense&&a.defense>0&&s.push(`defense ${$e.format(a.defense)}`),a.attackRange>0&&s.push(`attack range ${$e.format(a.attackRange)}`),s.push(`movement ${$e.format(a.movementRange)}`),s.push(`upkeep ${$e.format(n.upkeep)} beer`),n.progression.xpForNext===null?s.push(`${$e.format(n.progression.xp)} total experience`):s.push(`${$e.format(n.progression.xpIntoLevel)} of ${$e.format(n.progression.xpForNext)} experience toward next level`);const r=Gb(n.progression.statBonuses);r&&s.push(`level bonuses ${r}`);const l=n.equipment.filter(u=>u.item).length;return l>0&&s.push(`${l} equipped item${l===1?"":"s"}`),n.modifiers.length>0&&s.push(`${n.modifiers.length} active modifier${n.modifiers.length===1?"":"s"}`),s.join(", ")}function Bx(n,a){const s=a.filter(h=>h.status==="engaged").length,r=a.filter(h=>h.status==="reserve").length,l=a.filter(h=>h.status==="downed").length,u=(h,m,p)=>{const g=document.createElement("span");return g.classList.add("panel-roster__metric"),g.dataset.status=p,g.textContent=`${$e.format(m)} ${h}`,g.setAttribute("aria-label",g.textContent),g},f=document.createElement("div");f.classList.add("panel-roster__metrics"),f.append(u("engaged",s,"engaged"),u("reserve",r,"reserve"),u("downed",l,"downed")),n.appendChild(f)}function Hx(n,a,s){const r=document.createElement("div");r.classList.add("panel-roster__loadout");const l=document.createElement("ul");l.classList.add("panel-roster__slots"),l.setAttribute("role","list"),l.setAttribute("aria-label",`${a.name} equipment slots`);for(const u of a.equipment){const f=document.createElement("li");f.classList.add("panel-roster__slot"),f.dataset.slot=u.id;const h=document.createElement("div");h.classList.add("panel-roster__slot-header");const m=document.createElement("span");m.classList.add("panel-roster__slot-label"),m.textContent=u.label,m.title=u.description,h.appendChild(m);const p=document.createElement("span");if(p.classList.add("panel-roster__slot-summary"),p.textContent=u.item?u.item.name:"Empty",p.title=u.description,h.appendChild(p),f.appendChild(h),u.item){const M=document.createElement("ul");M.classList.add("panel-roster__slot-icons"),M.setAttribute("role","list"),M.appendChild(Rx(u.item)),f.appendChild(M)}const g=document.createElement("span");g.classList.add("panel-roster__slot-modifiers"),g.textContent=Ox(u.modifiers),g.title=g.textContent,f.appendChild(g);const b=document.createElement("div");b.classList.add("panel-roster__slot-actions");const v=document.createElement("button");v.type="button",v.classList.add("panel-roster__slot-action"),v.textContent=u.item?"Replace":"Equip",v.setAttribute("aria-label",`Equip ${u.label} for ${a.name}`),v.addEventListener("click",M=>{M.stopPropagation(),s.onEquipSlot?.(a.id,u.id)}),b.appendChild(v);const E=document.createElement("button");E.type="button",E.classList.add("panel-roster__slot-action"),E.textContent="Unequip",E.disabled=u.item===null,E.setAttribute("aria-label",`Unequip ${u.label} from ${a.name}`),E.addEventListener("click",M=>{M.stopPropagation(),E.disabled||s.onUnequipSlot?.(a.id,u.id)}),b.appendChild(E),f.appendChild(b),l.appendChild(f)}if(r.appendChild(l),a.modifiers.length>0){const u=document.createElement("ul");u.classList.add("panel-roster__mods"),u.setAttribute("role","list"),u.setAttribute("aria-label",`${a.name} active modifiers`),u.title=a.modifiers.map(f=>f.name).join(", ");for(const f of a.modifiers)u.appendChild(Dx(f));r.appendChild(u)}n.appendChild(r)}function Ix(n,a={}){return{render:r=>{n.innerHTML="",n.dataset.count=String(r.length),n.classList.add("panel-roster");const l=document.createElement("div");l.classList.add("panel-roster__header");const u=document.createElement("h4");u.classList.add("panel-roster__title"),u.textContent="Battalion Roster",u.id=e2,l.appendChild(u),n.setAttribute("aria-labelledby",e2);const f=r.length===0?"No attendants mustered yet":`${$e.format(r.length)} attendant${r.length===1?"":"s"} enlisted`,h=document.createElement("span");if(h.classList.add("panel-roster__count"),h.textContent=f,l.appendChild(h),n.appendChild(l),(()=>{if(typeof a.getRosterCapLimit!="function"||typeof a.getRosterCap!="function")return;const g=document.createElement("section");g.classList.add("panel-roster__cap");const b=document.createElement("div");b.classList.add("panel-roster__cap-header");const v=document.createElement("span");v.classList.add("panel-roster__cap-title"),v.textContent="Roster Cap",b.appendChild(v);const E=document.createElement("span");E.classList.add("panel-roster__cap-value"),E.setAttribute("aria-live","polite"),b.appendChild(E),g.appendChild(b);const M=document.createElement("p");M.classList.add("panel-roster__cap-description"),M.textContent="Tune how many attendants rally before new recruits await the steam.",g.appendChild(M);const C=`panel-roster-cap-${Math.floor(Math.random()*1e5)}`,R=document.createElement("label");R.classList.add("panel-roster__cap-label"),R.htmlFor=C,R.textContent="Active attendants";const N=document.createElement("input");N.type="range",N.id=C,N.min="0",N.step="1",N.classList.add("panel-roster__cap-slider"),N.setAttribute("aria-label","Roster cap");const q=document.createElement("input");q.type="number",q.min="0",q.step="1",q.inputMode="numeric",q.classList.add("panel-roster__cap-number");const I=document.createElement("div");I.classList.add("panel-roster__cap-controls"),I.append(R,N,q),g.appendChild(I);const Y=()=>{const P=a.getRosterCapLimit?.();return typeof P!="number"||!Number.isFinite(P)?0:Math.max(0,Math.floor(P))},Q=()=>{const P=a.getRosterCap?.();return typeof P!="number"||!Number.isFinite(P)?0:Math.max(0,Math.floor(P))},ie=(P,G)=>{const T=Math.max(0,Math.min(P,Math.floor(G))),k=$e.format(T);N.max=String(P),N.value=String(T),N.setAttribute("aria-valuemin","0"),N.setAttribute("aria-valuemax",N.max),N.setAttribute("aria-valuenow",N.value),q.max=String(P),q.value=String(T),q.setAttribute("aria-label",`Roster cap set to ${k}`);const A=T===0?"Paused":k;E.textContent=A,E.dataset.state=T===0?"paused":"active"},ee=typeof a.updateMaxRosterSize=="function";N.disabled=!ee,q.disabled=!ee;const oe=(P,G)=>{const T=Y(),k=Math.max(0,Math.min(T,Number.isFinite(P)?Math.floor(P):0));let A=k;ee&&(A=a.updateMaxRosterSize(k,{persist:G})),ie(T,A)};if(ie(Y(),Q()),ee){N.addEventListener("input",()=>{oe(Number(N.value),!1)}),N.addEventListener("change",()=>{oe(Number(N.value),!0)});const P=G=>{oe(Number(q.value),G)};q.addEventListener("input",()=>P(!1)),q.addEventListener("change",()=>P(!0)),q.addEventListener("blur",()=>P(!0))}n.appendChild(g)})(),r.length===0){const g=document.createElement("p");g.classList.add("panel-roster__empty"),g.textContent="No attendants have rallied to the sauna yet.",n.appendChild(g);return}Bx(n,r);const p=document.createElement("ul");p.classList.add("panel-roster__list"),p.setAttribute("role","list");for(const g of r){const b=document.createElement("li");b.classList.add("panel-roster__row");const v=document.createElement("button");v.type="button",v.classList.add("panel-roster__item"),v.dataset.unitId=g.id,v.dataset.status=g.status,v.setAttribute("aria-pressed",g.selected?"true":"false"),v.setAttribute("aria-label",zx(g)),v.title=`${g.name} • ${Nh[g.status]}`,g.selected&&v.classList.add("is-selected"),g.status==="downed"&&v.classList.add("is-downed");const E=document.createElement("div");E.classList.add("panel-roster__name-row");const M=document.createElement("div");M.classList.add("panel-roster__identity");const C=document.createElement("span");C.classList.add("panel-roster__level"),C.dataset.level=String(g.progression.level),C.style.setProperty("--level-progress","0%");const R=jb(g.progression.progress);C.style.setProperty("--level-progress",`${R}%`),C.setAttribute("role","img");const N=g.progression.xpForNext===null?`Level ${g.progression.level}, at mastery`:`Level ${g.progression.level}, ${R}% toward next level`;C.setAttribute("aria-label",N);const q=document.createElement("span");q.classList.add("panel-roster__level-value"),q.textContent=String(g.progression.level),C.appendChild(q);const I=document.createElement("span");I.classList.add("panel-roster__name"),I.textContent=g.name,I.title=g.name,M.append(C,I),E.appendChild(M);const Y=document.createElement("span");Y.classList.add("panel-roster__status"),Y.dataset.status=g.status,Y.textContent=Nh[g.status],E.appendChild(Y);const Q=document.createElement("div");Q.classList.add("panel-roster__meta");const ie=qx(g);Q.textContent=ie,Q.title=ie;const ee=document.createElement("div");ee.classList.add("panel-roster__xp");const oe=Ux(g.progression);ee.textContent=oe,ee.title=oe;const P=document.createElement("div");P.classList.add("panel-roster__callouts");const G=Gb(g.progression.statBonuses);P.textContent=G,P.title=G;const T=document.createElement("div");T.classList.add("panel-roster__health");const k=document.createElement("div");k.classList.add("panel-roster__health-fill");const A=g.stats.maxHealth>0?Math.max(0,Math.min(100,Math.round(g.stats.health/g.stats.maxHealth*100))):0;k.style.width=`${A}%`,k.dataset.percent=`${A}`,T.appendChild(k);const F=document.createElement("div");F.classList.add("panel-roster__traits");const B=Lx(g.traits);F.textContent=B,F.title=B,v.append(E,ee,Q,P,T,F),Hx(v,g,a),typeof a.onSelect=="function"&&v.addEventListener("click",()=>a.onSelect?.(g.id)),b.appendChild(v),p.appendChild(b)}n.appendChild(p)}}}const jx=150,Gx="autobattles:log-history:v2",Fb="autobattles:log-preferences:v1",um=typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:null;let t2=0;const n2=()=>(t2+=1,`${Date.now().toString(36)}-${t2.toString(36)}`),go=n=>{if(Array.isArray(n))return n.map(a=>typeof a=="string"?a.trim():"").filter(a=>a.length>0);if(typeof n=="string"){const a=n.trim();return a?[a]:[]}return[]},Xf=n=>n?typeof n!="object"?{}:{...n}:{},Fx=n=>{if(!n)return null;if(typeof n.unitId=="string"&&n.unitId.trim().length>0)return n.unitId.trim();const a=go(n.unitIds);return a.length>0?a[a.length-1]:null},Yx=(n,a)=>{const s=go(n.unitIds??n.unitId),r=go(a.unitIds??a.unitId),l=Array.from(new Set([...s,...r])),u=go(n.unitNames??n.unitName),f=go(a.unitNames??a.unitName),h=Array.from(new Set([...u,...f])),m=typeof a.steward=="string"?a.steward:n.steward,p={...n,...a,unitIds:l,unitNames:h};return typeof m=="string"&&(p.steward=m),h.length>0&&(p.unitName=h[h.length-1]),l.length>0&&(p.unitId=l[l.length-1]),p};class $x{history=[];listeners=new Set;storage;storageKey;maxEntries;constructor(a={}){this.storage=a.storage??um,this.storageKey=a.storageKey??Gx,this.maxEntries=Math.max(1,a.maxEntries??jx),this.hydrate()}hydrate(){if(this.storage)try{const a=this.storage.getItem(this.storageKey);if(!a)return;const s=JSON.parse(a);if(!Array.isArray(s))return;const r=[];for(const l of s){if(!l||typeof l!="object")continue;const u=l;if(typeof u.type!="string"||typeof u.message!="string")continue;const f={id:typeof u.id=="string"?u.id:n2(),type:u.type,message:u.message,metadata:Xf(u.metadata),timestamp:typeof u.timestamp=="number"&&Number.isFinite(u.timestamp)?u.timestamp:Date.now(),occurrences:typeof u.occurrences=="number"&&u.occurrences>0?Math.floor(u.occurrences):1};r.push(f)}r.length>0&&(r.length>this.maxEntries?this.history=r.slice(-this.maxEntries):this.history=r)}catch{this.history=[]}}persist(){if(this.storage)try{const a=JSON.stringify(this.history.map(s=>({id:s.id,type:s.type,message:s.message,metadata:s.metadata,timestamp:s.timestamp,occurrences:s.occurrences})));this.storage.setItem(this.storageKey,a)}catch{}}getHistory(){return this.history.map(a=>({...a,metadata:Xf(a.metadata)}))}subscribe(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}clear(){if(this.history.length===0)return;const a=this.history.slice();this.history=[],this.persist(),this.emitChange({kind:"remove",entries:a})}emit(a){const s=Xf(a.metadata),r={id:n2(),type:a.type,message:a.message,metadata:s,timestamp:Date.now(),occurrences:1},l=this.tryAggregate(r);if(l)return this.history[l.index]=l.entry,this.persist(),this.emitChange({kind:"update",entry:l.entry,index:l.index}),l.entry;this.history.push(r);const u=[];for(;this.history.length>this.maxEntries;){const h=this.history.shift();h&&u.push(h)}this.persist(),u.length>0&&this.emitChange({kind:"remove",entries:u});const f=this.history.length-1;return this.emitChange({kind:"append",entry:r,index:f}),r}tryAggregate(a){if(a.type!=="spawn"||!Fx(a.metadata)||this.history.length===0)return null;const r=this.history.length-1,l=this.history[r];return l.type!=="spawn"?null:{entry:{...l,id:l.id,message:a.message,metadata:Yx(l.metadata??{},a.metadata??{}),timestamp:a.timestamp,occurrences:l.occurrences+a.occurrences},index:r}}emitChange(a){for(const s of this.listeners)try{s(a)}catch(r){console.warn("Failed to handle log change",r)}}}const dm=new $x,Dt=n=>dm.emit(n),Vx=n=>dm.subscribe(n),Xx=()=>dm.getHistory(),Mo={combat:{label:"Combat",accent:"var(--color-accent-red)"},spawn:{label:"Reinforcements",accent:"var(--color-accent-green)"},loot:{label:"Loot",accent:"var(--color-accent-gold)"},progression:{label:"Progression",accent:"var(--color-accent-blue)"},ability:{label:"Abilities",accent:"var(--color-accent-purple)"},resource:{label:"Economy",accent:"var(--color-accent-cyan)"},policy:{label:"Policies",accent:"var(--color-accent-orange)"},event:{label:"Events",accent:"var(--color-accent-pink)"},system:{label:"Systems",accent:"var(--color-muted)"}},a2=["combat","spawn","loot","progression","ability","resource","policy","event","system"],pc={mutedTypes:[]},Kx=(n=um)=>{if(!n)return{...pc};try{const a=n.getItem(Fb);if(!a)return{...pc};const s=JSON.parse(a);if(!s||typeof s!="object")return{...pc};const r=Array.isArray(s.mutedTypes)?s.mutedTypes.filter(l=>typeof l=="string"&&l in Mo):[];return{mutedTypes:Array.from(new Set(r))}}catch{return{...pc}}},Qx=(n,a=um)=>{if(a)try{const s=Array.isArray(n.mutedTypes)?n.mutedTypes.filter(r=>r in Mo):[];a.setItem(Fb,JSON.stringify({mutedTypes:Array.from(new Set(s))}))}catch{}},Kf=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Px(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{log:()=>{},addEvent:()=>{},renderRoster:()=>{},dispose:()=>{}};const{regions:r,mobileBar:l}=ar(s),u=r.top,f=r.right,h=s.querySelector("#right-panel");h&&h.remove();const m=s.querySelector(".right-panel-slide");m&&m.remove();const p=s.querySelector("#right-panel-toggle");p&&p.remove();const g=document.createElement("div");g.id="right-panel",g.classList.add("hud-card"),g.setAttribute("role","complementary"),g.setAttribute("aria-label","Sauna command console"),g.tabIndex=-1;const b=document.createElement("div");b.className="right-panel-slide",b.setAttribute("aria-hidden","true");const v=document.createElement("div");v.className="right-panel-slide__backdrop",v.setAttribute("aria-hidden","true");const E=document.createElement("div");E.className="right-panel-slide__sheet",E.appendChild(g),b.append(v,E);const M=window.matchMedia("(max-width: 1040px)"),C=[],R=document.createElement("button");R.type="button",R.id="right-panel-toggle",R.classList.add("hud-panel-toggle"),R.setAttribute("aria-controls",g.id);const N=document.createElement("span");N.classList.add("hud-panel-toggle__icon"),N.setAttribute("aria-hidden","true");const q=document.createElement("span");q.classList.add("hud-panel-toggle__icon-bars"),N.appendChild(q);const I=document.createElement("span");I.classList.add("hud-panel-toggle__text");const Y=document.createElement("span");Y.classList.add("hud-panel-toggle__title"),Y.textContent="Command Console";const Q=document.createElement("span");Q.classList.add("hud-panel-toggle__state"),I.append(Y,Q),R.append(N,I);const ie=()=>{const L=u.querySelector("#topbar");L&&L.parentElement===u?L.insertAdjacentElement("afterend",R):u.prepend(R)};let ee=!1,oe=!1,P=!1,G=!1;const T="is-mobile-panel-open",k=()=>{P?Q.textContent=G?"Close":"Menu":Q.textContent=ee?"Open":"Close"},A=()=>{if(P){R.setAttribute("aria-expanded",G?"true":"false");const L=G?"Close command console panel":"Open command console panel";R.setAttribute("aria-label",L),R.title=G?"Close the sauna command console overlay":"Open the sauna command console overlay"}else{R.setAttribute("aria-expanded",ee?"false":"true");const L=ee?"Open command console panel":"Close command console panel";R.setAttribute("aria-label",L),R.title=ee?"Open the sauna command console overlay":"Close the sauna command console overlay"}},F=()=>{k(),A()},B=(L,X=M.matches)=>{if(P)return;const re=ee;X&&(oe=L);const fe=L&&X;ee=fe,g.classList.toggle("right-panel--collapsed",fe),g.setAttribute("aria-hidden",fe?"true":"false"),F(),re&&!fe&&X&&g.focus({preventScroll:!0})},D=L=>{!P||!G||L.key==="Escape"&&(L.preventDefault(),$())};let V=!1;const te=()=>{V||(document.addEventListener("keydown",D),V=!0)},he=()=>{V&&(document.removeEventListener("keydown",D),V=!1)},w=()=>{!P||G||(G=!0,b.classList.add("right-panel-slide--open"),b.setAttribute("aria-hidden","false"),g.setAttribute("aria-hidden","false"),document.body.classList.add(T),b.style.setProperty("--panel-drag-progress","1"),F(),te(),requestAnimationFrame(()=>{g.focus({preventScroll:!0})}))},$=({skipFocus:L=!1}={})=>{!P||!G||(xe(),G=!1,b.classList.remove("right-panel-slide--open"),b.setAttribute("aria-hidden","true"),g.setAttribute("aria-hidden","true"),document.body.classList.remove(T),b.style.setProperty("--panel-drag-progress","0"),F(),he(),L||R.focus({preventScroll:!0}))},W=L=>{if(P)return;const X=L.matches;R.hidden=!X,B(X?oe:!1,X)};typeof M.addEventListener=="function"?(M.addEventListener("change",W),C.push(()=>M.removeEventListener("change",W))):(M.addListener(W),C.push(()=>M.removeListener(W)));const ae=()=>{if(P){G?$():w();return}B(!ee)};R.addEventListener("click",ae),C.push(()=>R.removeEventListener("click",ae));const le=()=>{$()};v.addEventListener("click",le),C.push(()=>v.removeEventListener("click",le));let ge=null,de=0,Te=0;const xe=()=>{ge!==null&&(E.releasePointerCapture(ge),ge=null),E.style.transition="",E.style.transform="",b.style.setProperty("--panel-drag-progress",G?"1":"0")},xt=L=>{!P||!G||L.pointerType==="mouse"&&L.button!==0||(ge=L.pointerId,de=L.clientX,Te=0,E.style.transition="none",E.setPointerCapture(L.pointerId))},on=L=>{if(!P||L.pointerId!==ge||!G)return;Te=Math.max(0,L.clientX-de);const X=E.offsetWidth||1,re=Math.min(Te,X);E.style.transform=`translateX(${re}px)`,b.style.setProperty("--panel-drag-progress",String(1-re/X))},ln=L=>{xe(),L&&$()},Un=L=>{if(L.pointerId!==ge)return;const X=E.offsetWidth||1,re=Te>X*.35;ln(re)},On=()=>{ln(!1)};E.addEventListener("pointerdown",xt),E.addEventListener("pointermove",on),E.addEventListener("pointerup",Un),E.addEventListener("pointercancel",On),C.push(()=>{E.removeEventListener("pointerdown",xt),E.removeEventListener("pointermove",on),E.removeEventListener("pointerup",Un),E.removeEventListener("pointercancel",On)});const cn=Ib(L=>{P=L,P?(E.appendChild(g),b.isConnected||s.appendChild(b),l.appendChild(R),R.classList.add("hud-panel-toggle--mobile"),R.hidden=!1,G||(g.setAttribute("aria-hidden","true"),b.setAttribute("aria-hidden","true"),b.style.setProperty("--panel-drag-progress","0"))):($({skipFocus:!0}),b.style.setProperty("--panel-drag-progress","1"),b.remove(),f.appendChild(g),ie(),R.classList.remove("hud-panel-toggle--mobile"),R.hidden=!M.matches,g.setAttribute("aria-hidden","false"),B(oe,M.matches)),F()});C.push(cn);const bi=document.createElement("div");bi.classList.add("panel-tabs"),g.appendChild(bi);const es=document.createElement("div");es.classList.add("panel-content"),g.appendChild(es);const ce=document.createElement("div");ce.id="right-panel-roster",ce.setAttribute("role","region"),ce.setAttribute("aria-live","polite"),ce.setAttribute("aria-label","Battalion roster");const _e=document.createElement("div");_e.id="right-panel-policies";const je=document.createElement("div");je.id="right-panel-events";const qe=document.createElement("div");qe.id="right-panel-log",qe.setAttribute("role","region"),qe.setAttribute("aria-label","Combat log");const bt=document.createElement("section");bt.className="panel-log";const un=document.createElement("header");un.className="panel-log__header";const Kt=document.createElement("h3");Kt.className="panel-log__title",Kt.textContent="Combat Log";const Sn=document.createElement("span");Sn.className="panel-log__total",Sn.textContent="0 entries",un.append(Kt,Sn);const ia=document.createElement("div");ia.className="panel-log__filters";const Xe=document.createElement("div");Xe.id="event-log",Xe.className="panel-log__feed",Xe.setAttribute("role","log"),Xe.setAttribute("aria-live","polite"),bt.append(un,ia,Xe),qe.appendChild(bt);const Pe={Roster:ce,Policies:_e,Events:je,Log:qe},{onRosterSelect:It,onRosterRendererReady:_t,onRosterEquipSlot:vu,onRosterUnequipSlot:Su}=a;for(const[L,X]of Object.entries(Pe))X.classList.add("panel-section","panel-section--scroll"),X.dataset.tab=L,X.hidden=!0;qe.classList.add("panel-section--log");function zo(L){for(const[X,re]of Object.entries(Pe))re.hidden=X!==L;for(const X of Array.from(bi.children)){const re=X,fe=re.textContent===L;re.disabled=fe,re.setAttribute("aria-pressed",fe?"true":"false")}}for(const L of Object.keys(Pe)){const X=document.createElement("button");X.type="button",X.textContent=L;const re=Pe[L];re?.id&&X.setAttribute("aria-controls",re.id),X.setAttribute("aria-pressed","false");const fe=()=>zo(L);X.addEventListener("click",fe),C.push(()=>X.removeEventListener("click",fe)),bi.appendChild(X),es.appendChild(Pe[L])}const ts=Ix(ce,{onSelect:It,onEquipSlot:vu,onUnequipSlot:Su,getRosterCap:a.getRosterCap,getRosterCapLimit:a.getRosterCapLimit,updateMaxRosterSize:a.updateMaxRosterSize}),za=L=>{ts.render(L)};za([]),typeof _t=="function"&&_t(za);const qn={[se.SAUNA_BEER]:"Sauna Beer Bottles",[se.SAUNAKUNNIA]:"Saunakunnia",[se.SISU]:"Sisu"},vi=K2(),sa=new Map;function Eu(L){const X=document.createElement("span");return X.className="policy-card__badge",X.textContent=L,X}function Bo(L){const X=document.createElement("article");X.className="policy-card",X.style.setProperty("--policy-gradient",L.visuals.gradient),X.style.setProperty("--policy-accent",L.visuals.accentColor);const re=document.createElement("div");re.className="policy-card__header";const fe=document.createElement("div");fe.className="policy-card__icon-frame";const Re=document.createElement("img");Re.className="policy-card__icon",Re.src=L.visuals.icon,Re.alt=`${L.name} icon`,fe.appendChild(Re);const Ge=document.createElement("div");Ge.className="policy-card__heading";const Ce=document.createElement("h4");if(Ce.className="policy-card__title",Ce.textContent=L.name,Ge.appendChild(Ce),L.visuals.badges?.length){const In=document.createElement("div");In.className="policy-card__badges",L.visuals.badges.forEach(Qo=>In.appendChild(Eu(Qo))),Ge.appendChild(In)}const tt=document.createElement("span");tt.className="policy-card__state",tt.textContent="Ready",re.append(fe,Ge,tt);const Qt=document.createElement("p");Qt.className="policy-card__description",Qt.textContent=L.description;const vt=L.visuals.flair?(()=>{const In=document.createElement("p");return In.className="policy-card__flair",In.textContent=L.visuals.flair??"",In})():null,Pt=document.createElement("div");Pt.className="policy-card__actions";const Zt=document.createElement("span");Zt.className="policy-card__cost";const wi=document.createElement("span");wi.className="policy-card__cost-label",wi.textContent="Cost";const ft=document.createElement("span");ft.className="policy-card__cost-value",ft.textContent=`${Kf.format(L.cost)} ${qn[L.resource]}`,Zt.append(wi,ft);const nt=document.createElement("button");nt.type="button",nt.className="policy-card__action",nt.textContent="Enact Policy";const ja=document.createElement("p");ja.className="policy-card__status";const Ga=document.createElement("ul");Ga.className="policy-card__requirements",Ga.hidden=!0,Pt.append(Zt,nt);const ua=()=>{n.applyPolicy(L.id)&&ns(L)};return nt.addEventListener("click",ua),C.push(()=>nt.removeEventListener("click",ua)),X.append(re,Qt),vt&&X.appendChild(vt),X.append(Pt,ja,Ga),sa.set(L.id,{card:X,action:nt,stateBadge:tt,statusCopy:ja,requirements:Ga,costChip:Zt}),X}function Ho(){_e.innerHTML="",sa.clear();const L=document.createElement("div");L.className="policy-grid",vi.forEach(X=>{const re=Bo(X);L.appendChild(re)}),_e.appendChild(L),zn()}function ns(L){const X=sa.get(L.id);if(!X)return;const re=n.hasPolicy(L.id),fe=L.prerequisites.filter(vt=>!vt.isSatisfied(n)),Re=n.canAfford(L.cost,L.resource);X.action.disabled=re||fe.length>0||!Re,X.action.textContent=re?"Enacted":"Enact Policy";let Ge="ready",Ce="Ready",tt=L.spotlight??"All signals point to go.";X.requirements.innerHTML="",X.requirements.hidden=!0,re?(Ge="applied",Ce="Enacted",tt=L.visuals.flair??"Policy active."):fe.length>0?(Ge="locked",Ce="Locked",tt="Awaiting requirements:",X.requirements.hidden=!1,fe.forEach(vt=>{const Pt=document.createElement("li");Pt.textContent=vt.description,X.requirements.appendChild(Pt)})):Re||(Ge="budget",Ce="Needs Resources",tt=`Earn ${Kf.format(L.cost)} ${qn[L.resource]} to enact this edict.`),X.card.dataset.status=Ge,X.stateBadge.textContent=Ce,X.statusCopy.textContent=tt;const Qt=!re&&fe.length===0&&!Re;X.costChip.classList.toggle("policy-card__cost--warning",Qt)}function zn(){vi.forEach(L=>ns(L))}Ho();const Io=L=>zn(),ir=L=>zn(),sr=L=>zn();ne.on("resourceChanged",Io),ne.on(Bt.APPLIED,ir),ne.on(Bt.REJECTED,sr),C.push(()=>{ne.off("resourceChanged",Io),ne.off(Bt.APPLIED,ir),ne.off(Bt.REJECTED,sr)});function rr(L,X){const re=document.createElement("button");re.type="button",re.classList.add("event-card__choice"),X.accent&&re.classList.add(`event-card__choice--${X.accent}`),re.dataset.choiceId=X.id;const fe=document.createElement("span");if(fe.className="event-card__choice-label",fe.textContent=X.label,re.appendChild(fe),X.description){const Re=document.createElement("span");Re.className="event-card__choice-detail",Re.textContent=X.description,re.appendChild(Re)}return re.addEventListener("click",()=>{if(!re.isConnected)return;re.disabled=!0,bo.resolve(L.id,X.id)||(re.disabled=!1)}),re}function or(L){if(je.innerHTML="",L.length===0){const re=document.createElement("div");re.className="event-card event-card--empty";const fe=document.createElement("p");fe.className="event-card__empty",fe.textContent="All clear. Command will notify you when new briefings arrive.",re.appendChild(fe),je.appendChild(re);return}const X=document.createDocumentFragment();for(const re of L){const fe=document.createElement("article");fe.className="event-card",fe.dataset.eventId=re.id,fe.style.setProperty("--event-accent",re.accentColor??"var(--color-accent)");const Re=(re.typography??"sans").toLowerCase();fe.classList.add(`event-card--${["serif","mono"].includes(Re)?Re:"sans"}`);const Ge=(re.animation??"").toLowerCase();["aurora","pulse","tilt"].includes(Ge)&&fe.classList.add(`event-card--${Ge}`);const Ce=document.createElement("div");if(Ce.className="event-card__frame",re.art){const nt=document.createElement("div");nt.className="event-card__media",nt.style.backgroundImage=`url(${re.art})`,Ce.appendChild(nt)}const tt=document.createElement("div");tt.className="event-card__body";const Qt=document.createElement("span");Qt.className="event-card__badge",Qt.textContent="Priority Dispatch",tt.appendChild(Qt);const vt=document.createElement("h4");vt.className="event-card__headline",vt.textContent=re.headline,tt.appendChild(vt);const Pt=document.createElement("p");Pt.className="event-card__copy",Pt.textContent=re.body,tt.appendChild(Pt);const Zt=document.createElement("div");Zt.className="event-card__choices";const wi=re.choices&&re.choices.length>0?re.choices:[{id:"acknowledge",label:re.acknowledgeText??"Acknowledge"}];for(const nt of wi){const ja=rr(re,{id:nt.id,label:nt.label,description:nt.description,event:nt.event,payload:nt.payload,accent:nt.accent});Zt.appendChild(ja)}tt.appendChild(Zt),Ce.appendChild(tt);const ft=document.createElement("span");ft.className="event-card__shimmer",fe.append(Ce,ft),X.appendChild(fe)}je.appendChild(X)}const jo=bo.subscribe(or);C.push(jo);const Go=({event:L})=>{Dt({type:"event",message:`Event • ${L.headline}`,metadata:{eventId:L?.id??L.headline,headline:L.headline}})};ne.on(Oc.TRIGGERED,Go),C.push(()=>{ne.off(Oc.TRIGGERED,Go)});function Bn(L){bo.publish(L)}const We=new Map,dt=new Map,ra=new Map,Ba=new Set(Kx().mutedTypes??[]),En=new Set;for(const L of a2)Ba.has(L)||En.add(L),dt.set(L,0);let as=0,Si=!0;const Ei=typeof requestAnimationFrame=="function"?requestAnimationFrame:L=>setTimeout(L,16),is=L=>Kf.format(Math.max(0,L)),oa=()=>{const L=as===1?"entry":"entries";Sn.textContent=`${is(as)} ${L}`},Ha=L=>{const X=ra.get(L);X&&(X.textContent=is(dt.get(L)??0))},la=(L,X)=>{if(X===0)return;const re=dt.get(L)??0;dt.set(L,Math.max(0,re+X)),as=Math.max(0,as+X),Ha(L),oa()},ca=()=>Xe.scrollHeight-(Xe.scrollTop+Xe.clientHeight)<48,et=()=>{Ei(()=>{Xe.scrollTop=Xe.scrollHeight,Si=!0})},ss=L=>{const X=En.has(L.type);L.element.hidden=!X,L.element.classList.toggle("panel-log-entry--muted",!X)},Fo=L=>{const X=L.metadata??{};return(Array.isArray(X.unitNames)?X.unitNames:typeof X.unitName=="string"?[X.unitName]:[]).map(fe=>typeof fe=="string"?fe.trim():"").filter(fe=>fe.length>0)},Hn=(L,X)=>{if(X.type!=="spawn"){L.replaceChildren(),L.hidden=!0;return}const re=Fo(X),fe=re.map(Ge=>{const Ce=document.createElement("span");return Ce.className="panel-log-entry__token",Ce.textContent=Ge,Ce}),Re=X.occurrences-re.length;if(Re>0){const Ge=document.createElement("span");Ge.className="panel-log-entry__token panel-log-entry__token--more",Ge.textContent=`+${Re}`,fe.push(Ge)}fe.length===0?(L.replaceChildren(),L.hidden=!0):(L.replaceChildren(...fe),L.hidden=!1)},Ia=L=>{const X=document.createElement("article");X.className="panel-log-entry",X.dataset.logType=L.type,X.style.setProperty("--log-entry-accent",Mo[L.type]?.accent??"var(--color-accent)");const re=document.createElement("div");re.className="panel-log-entry__header";const fe=document.createElement("span");fe.className="panel-log-entry__type",fe.textContent=Mo[L.type]?.label??L.type;const Re=document.createElement("span");Re.className="panel-log-entry__badge";const Ge=document.createElement("p");Ge.className="panel-log-entry__message",Ge.textContent=L.message;const Ce=document.createElement("div");Ce.className="panel-log-entry__tokens",Ce.hidden=!0,re.append(fe,Re),X.append(re,Ge,Ce);const tt=vt=>{vt<=1?(Re.textContent="",Re.hidden=!0):(Re.hidden=!1,Re.textContent=`×${vt}`)},Qt={element:X,type:L.type,occurrences:L.occurrences,badge:Re,message:Ge,tokens:Ce,setBadge:tt};return tt(L.occurrences),Hn(Ce,L),Qt},Yo=(L,X=!1)=>{const re=X?!0:ca()||Si,fe=Ia(L);We.set(L.id,fe),Xe.appendChild(fe.element),la(fe.type,fe.occurrences),ss(fe),re&&et()},$o=L=>{const X=We.get(L.id);if(!X)return;const re=L.occurrences-X.occurrences;re!==0&&(X.occurrences=L.occurrences,la(X.type,re)),X.message.textContent=L.message,X.setBadge(L.occurrences),X.tokens&&Hn(X.tokens,L),ss(X),Si&&et()},Vo=L=>{const X=We.get(L.id);X&&(We.delete(L.id),la(X.type,-X.occurrences),X.element.parentElement===Xe&&Xe.removeChild(X.element))},Xo=()=>{for(const L of We.values())ss(L)};for(const L of a2){const X=Mo[L],re=document.createElement("button");re.type="button",re.className="log-chip",re.dataset.logFilter=L,re.style.setProperty("--log-chip-accent",X?.accent??"var(--color-accent)"),re.setAttribute("aria-pressed",En.has(L)?"true":"false"),re.setAttribute("aria-label",`${X?.label??L} log filter`);const fe=document.createElement("span");fe.className="log-chip__label",fe.textContent=X?.label??L;const Re=document.createElement("span");Re.className="log-chip__count",Re.textContent="0",ra.set(L,Re),En.has(L)||re.classList.add("is-muted"),re.append(fe,Re),ia.appendChild(re),re.addEventListener("click",()=>{En.has(L)?(En.delete(L),Ba.add(L)):(En.add(L),Ba.delete(L)),re.classList.toggle("is-muted",!En.has(L)),re.setAttribute("aria-pressed",En.has(L)?"true":"false"),Qx({mutedTypes:Array.from(Ba)}),Xo()})}oa();const Mi=()=>{Si=ca()};Xe.addEventListener("scroll",Mi,{passive:!0}),C.push(()=>Xe.removeEventListener("scroll",Mi));const xi=Xx();if(xi.length>0){for(const L of xi)Yo(L,!0);et()}const Mn=Vx(L=>{if(L.kind==="append")Yo(L.entry);else if(L.kind==="update")$o(L.entry);else if(L.kind==="remove")for(const X of L.entries)Vo(X)});return C.push(Mn),Xo(),zo("Roster"),{log:L=>{Dt(L)},addEvent:Bn,renderRoster:za,dispose:()=>{for(const L of C.splice(0))try{L()}catch(X){console.warn("Failed to dispose HUD listener",X)}he(),xe(),document.body.classList.remove(T),b.remove(),R.remove(),g.remove()}}}const Zx=n=>`[data-tutorial-target="${n}"]`,Vn=16,gc=12,i2="is-tutorial-highlighted",Jx=[{id:"heat",target:"heat",title:"Heat the Sauna",description:"Keep the sauna fires roaring. This control shows when the next warrior emerges from the steam."},{id:"upkeep",target:"upkeep",title:"Mind Your Upkeep",description:"Every attendant draws upkeep. Track totals and see a featured roster member to balance your economy."},{id:"sisu",target:"sisu",title:"Stockpile SISU",description:"SISU fuels heroic bursts. Watch this meter to know when your grit reserves can power signature moves."},{id:"enemy-ramp",target:"enemy-ramp",title:"Read the Enemy Ramp",description:"The badge shows the current stage, upcoming multiplier surges, and calm lulls before the next pressure wave."},{id:"combat",target:"combat",title:"Command the Fight",description:"Trigger a Sisu Burst to supercharge allied attacks or rally everyone home with a Torille call."},{id:"victory",target:"victory",title:"Claim Victory",description:"Destroy every enemy stronghold to win the campaign. The Saunakunnia badge tracks your march toward total conquest."},{id:"defeat",target:"sauna-integrity",title:"Avert Defeat",description:"Defeat strikes if the sauna is razed, every attendant is downed for 8 seconds, or upkeep bankruptcy lingers for 12 seconds. Guard the integrity meter and keep your roster on its feet."}];function Wx(n,a,s){return Math.max(a,Math.min(s,n))}function ew(n={}){const a=n.steps??Jx;if(a.length===0)throw new Error("Tutorial requires at least one step.");let s=-1,r=null,l=!1;const u=document.createElement("div");u.className="tutorial-overlay";const f=document.createElement("div");f.className="tutorial-overlay__spotlight",f.setAttribute("aria-hidden","true");const h=document.createElement("section");h.className="tutorial-card",h.setAttribute("role","dialog"),h.setAttribute("aria-modal","false"),h.tabIndex=-1;const m=document.createElement("header");m.className="tutorial-card__header";const p=document.createElement("h2");p.className="tutorial-card__title";const g=document.createElement("button");g.type="button",g.className="tutorial-card__close",g.setAttribute("aria-label","Dismiss tutorial"),g.textContent="×",m.append(p,g);const b=document.createElement("p");b.className="tutorial-card__description";const v=document.createElement("p");v.className="tutorial-card__progress";const E=document.createElement("div");E.className="tutorial-card__controls";const M=document.createElement("button");M.type="button",M.className="tutorial-card__button tutorial-card__button--secondary",M.textContent="Back";const C=document.createElement("button");C.type="button",C.className="tutorial-card__button",C.textContent="Next";const R=document.createElement("button");R.type="button",R.className="tutorial-card__skip",R.textContent="Skip tutorial",E.append(M,C),h.append(m,b,v,E,R),u.append(f,h);const N=typeof ResizeObserver<"u"?new ResizeObserver(()=>{s>=0&&ee()}):null,q=()=>{s>=0&&ee()};function I(){l||(document.body.appendChild(u),window.addEventListener("resize",ee),document.addEventListener("scroll",q,!0),N?.observe(h),l=!0)}function Y(){l&&(window.removeEventListener("resize",ee),document.removeEventListener("scroll",q,!0),N?.disconnect(),u.remove(),l=!1)}function Q(B){if(r&&r!==B&&(r.classList.remove(i2),r.removeAttribute("data-tutorial-highlight")),r=B,!B){f.style.opacity="0";return}B.classList.add(i2),B.setAttribute("data-tutorial-highlight","true"),f.style.opacity="1"}function ie(){if(!r)return null;const B=r.getBoundingClientRect();return B.width===0&&B.height===0?null:{top:B.top,left:B.left,width:B.width,height:B.height}}function ee(){const B=ie();if(!B){h.style.top=`${Vn}px`,h.style.left=`${Vn}px`,h.classList.add("tutorial-card--floating"),f.style.opacity="0";return}h.classList.remove("tutorial-card--floating"),f.style.opacity="1";const D=B.top-gc,V=B.left-gc,te=B.width+gc*2,he=B.height+gc*2;f.style.top=`${D}px`,f.style.left=`${V}px`,f.style.width=`${te}px`,f.style.height=`${he}px`;const w=h.getBoundingClientRect();let W=window.innerHeight-B.top-B.height>=B.top?B.top+B.height+Vn:B.top-w.height-Vn;W<Vn?W=Vn:W+w.height>window.innerHeight-Vn&&(W=window.innerHeight-Vn-w.height);let le=B.left+B.width/2-w.width/2;le=Wx(le,Vn,window.innerWidth-w.width-Vn),h.style.top=`${Math.round(W)}px`,h.style.left=`${Math.round(le)}px`}function oe(){requestAnimationFrame(()=>{h.focus({preventScroll:!0})})}function P(B){if(B<0||B>=a.length)return;I(),s=B;const D=a[B];p.textContent=D.title,b.textContent=D.description,v.textContent=`Step ${B+1} of ${a.length}`,M.disabled=B===0,C.textContent=B===a.length-1?"Finish":"Next";const V=document.querySelector(Zx(D.target));Q(V??null),ee(),oe()}function G(){if(s===-1){P(0);return}if(s>=a.length-1){F();return}P(s+1)}function T(){s<=0||P(s-1)}function k(){Q(null),Y(),s=-1}function A(){n.onSkip?.(),k()}function F(){n.onComplete?.(),k()}return M.addEventListener("click",()=>{T()}),C.addEventListener("click",()=>{G()}),R.addEventListener("click",()=>{A()}),g.addEventListener("click",()=>{A()}),h.addEventListener("keydown",B=>{B.defaultPrevented||(B.key==="ArrowRight"?(B.preventDefault(),G()):B.key==="ArrowLeft"?(B.preventDefault(),T()):B.key==="Escape"&&(B.preventDefault(),A()))}),{start(){s===-1&&P(0)},next:G,previous:T,skip:A,finish:F,destroy(){k()}}}const tw=Math.sqrt(3),nw=2;function $c(n){return{width:n*tw,height:n*nw}}const _a=16,yc=2;function aw(){return typeof window<"u"&&window.devicePixelRatio||1}function iw(n,a){const s=Math.max(n.qMin,a.minQ),r=Math.min(n.qMax,a.maxQ),l=Math.max(n.rMin,a.minR),u=Math.min(n.rMax,a.maxR);return s>r||l>u?null:{qMin:s,qMax:r,rMin:l,rMax:u}}function sw(n,a){const s=aw(),r=a.width/(s*n.zoom),l=a.height/(s*n.zoom);return{x:n.x-r/2,y:n.y-l/2,width:r,height:l}}function rw(n,a){const s=[mo(n.x,n.y,a),mo(n.x+n.width,n.y,a),mo(n.x,n.y+n.height,a),mo(n.x+n.width,n.y+n.height,a)];let r=1/0,l=-1/0,u=1/0,f=-1/0;for(const h of s)r=Math.min(r,h.q),l=Math.max(l,h.q),u=Math.min(u,h.r),f=Math.max(f,h.r);return{qMin:Math.floor(r)-yc,qMax:Math.ceil(l)+yc,rMin:Math.floor(u)-yc,rMax:Math.ceil(f)+yc}}function ow(n,a,s,r){if(!s||typeof s.width!="number"||typeof s.height!="number")return{qMin:n.minQ,qMax:n.maxQ,rMin:n.minR,rMax:n.maxR};if(s.width===0||s.height===0)return{qMin:n.minQ,qMax:n.maxQ,rMin:n.minR,rMax:n.maxR};const l=sw(a,s);return iw(rw(l,r),n)}function Fs(n){return Math.floor(n/_a)}function Yb(n){return`${n.q},${n.r}`}function lw(n,a){return Yb({q:Fs(n),r:Fs(a)})}function cw(n){return{qMin:Fs(n.qMin),qMax:Fs(n.qMax),rMin:Fs(n.rMin),rMax:Fs(n.rMax)}}function $b(n){const a=[];for(let s=n.rMin;s<=n.rMax;s++)for(let r=n.qMin;r<=n.qMax;r++)a.push({q:r,r:s});return a}function uw(n,a){const s=a.q*_a,r=a.r*_a,l=s+_a-1,u=r+_a-1,f=Math.max(s,n.minQ),h=Math.min(l,n.maxQ),m=Math.max(r,n.minR),p=Math.min(u,n.maxR);if(!(f>h||m>p))for(let g=m;g<=p;g++)for(let b=f;b<=h;b++)n.ensureTile(b,g)}function dw(n,a){for(const s of $b(a))uw(n,s)}const fw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3ePlains%20Tile%3c/title%3e%3cdesc%20id='desc'%3eRolling%20plains%20with%20sunrise%20gradients%20and%20glowing%20grasses.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='plains-bg'%20cx='50%25'%20cy='50%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='plains-field'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='0%25'%3e%3cstop%20offset='0%25'%20stop-color='%23facc15'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23eab308'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='plains-haze'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f59e0b'%20stop-opacity='0.2'%20/%3e%3c/linearGradient%3e%3cfilter%20id='plains-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='5'%20stdDeviation='6'%20flood-color='%23facc15'%20flood-opacity='0.35'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23plains-bg)'%20/%3e%3cg%20filter='url(%23plains-glow)'%3e%3cpath%20d='M16%2088c20-18%2036-22%2048-22s28%204%2048%2022'%20fill='url(%23plains-field)'%20stroke='%23fef9c3'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M24%20102c16-14%2032-18%2040-18s24%204%2040%2018'%20fill='none'%20stroke='%23fde68a'%20stroke-width='5'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M32%2070c12-10%2024-14%2032-14s20%204%2032%2014'%20fill='url(%23plains-haze)'%20opacity='0.7'%20/%3e%3cpath%20d='M52%2078l4%2012m8-12l4%2012m8-12l4%2012'%20stroke='%23fef3c7'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='36'%20r='8'%20fill='%23fef08a'%20opacity='0.7'%20/%3e%3c/svg%3e",hw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eForest%20Tile%3c/title%3e%3cdesc%20id='desc'%3eStylised%20evergreen%20trees%20glowing%20against%20a%20deep%20night%20backdrop.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='forest-bg'%20cx='50%25'%20cy='40%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230b1120'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='forest-leaf'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%234ade80'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2315803d'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='forest-trunk'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23a855f7'%20/%3e%3cstop%20offset='100%25'%20stop-color='%237c3aed'%20/%3e%3c/linearGradient%3e%3cfilter%20id='forest-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%234ade80'%20flood-opacity='0.25'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23forest-bg)'%20/%3e%3cg%20filter='url(%23forest-glow)'%20stroke='%23bbf7d0'%20stroke-width='2'%3e%3cpath%20fill='url(%23forest-leaf)'%20d='M64%2026L32%2080h18l-12%2022h28l-10-22h16l-10%2022h28l-12-22h18z'%20/%3e%3crect%20x='58'%20y='74'%20width='12'%20height='18'%20rx='3'%20fill='url(%23forest-trunk)'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20stroke-opacity='0.5'%20d='M44%2086c6-4%2012-6%2020-6s14%202%2020%206'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='40'%20r='6'%20fill='%23fef3c7'%20opacity='0.6'%20/%3e%3ccircle%20cx='88'%20cy='32'%20r='4'%20fill='%23fef3c7'%20opacity='0.4'%20/%3e%3c/svg%3e",mw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eMountain%20Tile%3c/title%3e%3cdesc%20id='desc'%3eJagged%20alpine%20peaks%20with%20luminous%20snowcaps.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='mountain-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%23111827'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='mountain-rock'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2364748b'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23334155'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mountain-snow'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23cbd5f5'%20/%3e%3c/linearGradient%3e%3cfilter%20id='mountain-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%23f8fafc'%20flood-opacity='0.2'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23mountain-bg)'%20/%3e%3cg%20filter='url(%23mountain-glow)'%20stroke='%23cbd5f5'%20stroke-width='2'%20stroke-linejoin='round'%3e%3cpath%20fill='url(%23mountain-rock)'%20d='M24%20100l32-52%2014%2022%2012-18%2022%2048z'%20/%3e%3cpath%20fill='url(%23mountain-snow)'%20d='M56%2048l14%2022%2012-18%2010%2022H48z'%20opacity='0.85'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20opacity='0.6'%20d='M32%2094c10-6%2020-9%2032-9s22%203%2032%209'%20/%3e%3c/g%3e%3ccircle%20cx='92'%20cy='32'%20r='6'%20fill='%23f1f5f9'%20opacity='0.5'%20/%3e%3c/svg%3e",pw="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eWater%20Tile%3c/title%3e%3cdesc%20id='desc'%3eGlowing%20waves%20surrounding%20a%20crystalline%20droplet.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='water-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230b1120'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='water-wave'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='water-drop'%20x1='50%25'%20y1='0%25'%20x2='50%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230284c7'%20/%3e%3c/linearGradient%3e%3cfilter%20id='water-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='8'%20flood-color='%2338bdf8'%20flood-opacity='0.3'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23water-bg)'%20/%3e%3cg%20filter='url(%23water-glow)'%3e%3cpath%20d='M32%2076c12-10%2024-15%2032-15s20%205%2032%2015'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3cpath%20d='M28%2092c14-12%2030-18%2040-18s26%206%2040%2018'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='6'%20stroke-linecap='round'%20opacity='0.7'%20/%3e%3cpath%20d='M40%2060c10-8%2018-12%2024-12s14%204%2024%2012'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M64%2030c-12%2020-18%2032-18%2042%200%2011%208%2020%2018%2020s18-9%2018-20c0-10-6-22-18-42z'%20fill='url(%23water-drop)'%20stroke='%23e0f2fe'%20stroke-width='2'%20/%3e%3c/g%3e%3ccircle%20cx='94'%20cy='34'%20r='6'%20fill='%23f8fafc'%20opacity='0.45'%20/%3e%3c/svg%3e",gw=.01;function Vb(n){return!Number.isFinite(n)||n<=gw?1:n}function yw(n,a){return n/Vb(a)}function Zn(n,a){const s=Vb(a);return Math.round(n*s)/s}const s2={[vn.Plains]:{baseColor:"#d8b869",icon:fw},[vn.Forest]:{baseColor:"#237a55",icon:hw},[vn.Hills]:{baseColor:"#b57c57",icon:mw},[vn.Lake]:{baseColor:"#3185d5",icon:pw}},bw=[255,255,255],fm=[12,18,28],vw=[0,0,0],r2="rgba(56, 189, 248, 0.85)",o2="rgba(56, 189, 248, 0.45)";let oo=null,lo=null;const Sw=n=>Math.min(1,Math.max(0,n));function Ew(n){let a=n.trim().replace("#","");a.length===3&&(a=a.split("").map(r=>r+r).join(""));const s=Number.parseInt(a,16);return[s>>16&255,s>>8&255,s&255]}function Vc(n,a,s){const r=Sw(s);return[Math.round(n[0]+(a[0]-n[0])*r),Math.round(n[1]+(a[1]-n[1])*r),Math.round(n[2]+(a[2]-n[2])*r)]}function l2(n){return`rgb(${n[0]}, ${n[1]}, ${n[2]})`}function Xc(n,a=1){return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${a})`}function Kc(n,a=1){return Xc(Vc(fm,bw,n),a)}function Xs(n,a=1){return Xc(Vc(fm,vw,n),a)}const Mw={terrain:.05,hover:.065,selection:.085},xw={terrain:1,hover:1.35,selection:2.1};function Qc(n,a,s="terrain"){const r=n*Mw[s],l=yw(r,a);return Math.max(xw[s],l)}function ww(){if(oo&&lo)return{stroke:oo,glow:lo};if(typeof window<"u"){const n=getComputedStyle(document.documentElement),a=n.getPropertyValue("--tile-highlight-ring").trim(),s=n.getPropertyValue("--tile-highlight-glow").trim();oo=a||r2,lo=s||o2}else oo=r2,lo=o2;return{stroke:oo,glow:lo}}function Xb(n){return Math.min(1,Math.max(0,n))}function hu(n){let a=n.trim();if(a.startsWith("#")&&(a=a.slice(1)),a.length===3){const s=Number.parseInt(a[0]+a[0],16),r=Number.parseInt(a[1]+a[1],16),l=Number.parseInt(a[2]+a[2],16);return[s,r,l]}if(a.length===6){const s=Number.parseInt(a,16),r=s>>16&255,l=s>>8&255,u=s&255;return[r,l,u]}return[0,0,0]}function Aw(n,a,s){const r=Xb(s),l=(u,f)=>Math.round(u+(f-u)*r);return[l(n[0],a[0]),l(n[1],a[1]),l(n[2],a[2])]}function Cw([n,a,s],r){return`rgba(${n}, ${a}, ${s}, ${Xb(r)})`}function yi(n,a,s,r){return Cw(Aw(n,a,s),r)}function Tw(n){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=n,m=hu(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=yi(m,[255,255,255],.35,.24);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.06);const g=3,b=6,v=s+l*.12,E=s+l*.88;for(let N=0;N<g;N++){const q=N/Math.max(1,g-1),I=r+u*.28+q*u*.32,Y=f*(.18-q*.05);a.beginPath();for(let Q=0;Q<=b;Q++){const ie=Q/b,ee=v+(E-v)*ie,oe=Math.sin(ie*Math.PI*1.6+N*.8)*Y,P=I-Math.abs(oe)*.55;Q===0?a.moveTo(ee,P):a.lineTo(ee,P)}a.stroke()}const M=yi(m,[18,54,32],.4,.2);a.strokeStyle=M,a.lineWidth=Math.max(.75,f*.035);const C=5,R=f*.22;for(let N=0;N<C;N++){const q=s+l*(.2+N/Math.max(1,C-1)*.6),I=r+u*.55-Math.cos(N*.9)*f*.08;a.beginPath(),a.arc(q,I,R,Math.PI*.2,Math.PI*.85),a.stroke(),a.beginPath(),a.arc(q+R*.35,I-R*.1,R*.55,Math.PI*.15,Math.PI*.95),a.stroke()}a.restore()}function _w(n){const{ctx:a,centerX:s,centerY:r,radius:l,baseColor:u}=n,f=hu(u);a.save(),a.lineCap="round";const h=yi(f,[255,235,214],.45,.22);a.strokeStyle=h,a.lineWidth=Math.max(1,l*.05);const m=4;for(let b=0;b<m;b++){const v=b/Math.max(1,m-1),E=l*(1.25-v*.45),M=l*(.72-v*.18),C=r+l*.18*(v-.5);a.beginPath(),a.ellipse(s,C,E,M,0,Math.PI*.12,Math.PI*.88),a.stroke()}const p=yi(f,[60,36,20],.35,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,l*.032),a.setLineDash([l*.22,l*.18]);const g=3;for(let b=0;b<g;b++){const v=l*(.75-b*.1),E=r+l*.28+b*l*.08;a.beginPath(),a.arc(s+l*.08,E,v,Math.PI*.28,Math.PI*.76),a.stroke()}a.setLineDash([]),a.restore()}function Rw(n){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=n,m=hu(h);a.save(),a.lineCap="round",a.lineJoin="round";const p=yi(m,[255,255,255],.55,.28);a.strokeStyle=p,a.lineWidth=Math.max(1,f*.045);const g=4,b=7,v=s+l*.12,E=s+l*.88,M=f*.16;for(let N=0;N<g;N++){const q=N/Math.max(1,g-1),I=r+u*.3+q*u*.4;a.beginPath();for(let Y=0;Y<=b;Y++){const Q=Y/b,ie=v+(E-v)*Q,ee=Math.sin(Q*Math.PI*2+N*.6)*M*(.75-q*.2),oe=I+ee;Y===0?a.moveTo(ie,oe):a.lineTo(ie,oe)}a.stroke()}const C=yi(m,[12,52,94],.4,.2);a.strokeStyle=C,a.lineWidth=Math.max(.8,f*.03);const R=3;for(let N=0;N<R;N++){const q=N/Math.max(1,R-1),I=r+u*.35+q*u*.35;a.beginPath();for(let Y=0;Y<=b;Y++){const Q=Y/b,ie=v+(E-v)*Q,ee=Math.sin(Q*Math.PI*2+N)*M*.35,oe=I+ee;Y===0?a.moveTo(ie,oe):a.lineTo(ie,oe)}a.stroke()}a.restore()}function Kb(n){const{ctx:a,x:s,y:r,width:l,height:u,radius:f,baseColor:h}=n,m=hu(h);a.save(),a.lineCap="round";const p=yi(m,[255,255,255],.42,.18);a.strokeStyle=p,a.lineWidth=Math.max(.85,f*.03);const g=f*.55;for(let E=-1;E<=2;E++){const M=g*E;a.beginPath(),a.moveTo(s+M,r+u*.25),a.lineTo(s+M+l*.75,r+u*.85),a.stroke()}const b=yi(m,[112,82,32],.3,.16);a.strokeStyle=b,a.lineWidth=Math.max(.7,f*.025),a.setLineDash([f*.24,f*.34]);const v=f*.48;for(let E=0;E<3;E++){const M=v*E;a.beginPath(),a.moveTo(s+l*.18+M,r+u*.78),a.lineTo(s+l*.7+M,r+u*.38),a.stroke()}a.setLineDash([]),a.restore()}const c2=new Map;let ji=null;function Nw(){if(ji)return ji;const n="/";if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(n))return ji=n,ji;const s=n.startsWith("/")?n:`/${n}`;return typeof window<"u"&&typeof window.location?.origin=="string"?ji=`${window.location.origin}${s}`:ji=`http://localhost${s}`,ji}function kw(n){let a=c2.get(n);if(!a){a=new Image,a.decoding="async";const s=new URL(n,Nw()).href;a.src=s,c2.set(n,a)}if(a.complete&&a.naturalWidth>0&&a.naturalHeight>0)return a}const Dw={[vn.Plains]:Kb,[vn.Forest]:Tw,[vn.Hills]:_w,[vn.Lake]:Rw};function Qb(n,a,s,r){n.beginPath();for(let l=0;l<6;l++){const u=Math.PI/180*(60*l-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function Lw(n,a,s,r){Qb(n,a,s,r),n.save(),n.lineJoin="round",n.lineCap="round",n.lineWidth=Qc(r,1,"terrain"),n.strokeStyle=Kc(.16,.6),n.stroke(),n.restore()}function Uw(n,a,s,r,l,u,f,h){const m=s2[a.terrain]??s2[vn.Plains],p=Ew(m.baseColor),g=r+u/2,b=l+f/2;n.save(),Qb(n,g,b,h),n.clip();const v=n.createRadialGradient(g,b,h*.2,g,b,h*1.05);v.addColorStop(0,l2(Vc(p,[255,255,255],.3))),v.addColorStop(.7,m.baseColor),v.addColorStop(1,l2(Vc(p,fm,.4))),n.fillStyle=v,n.shadowColor=Xc(p,.35),n.shadowBlur=h*.9,n.shadowOffsetX=0,n.shadowOffsetY=0,n.fillRect(r-h*.1,l-h*.1,u+h*.2,f+h*.2);const E={ctx:n,x:r,y:l,width:u,height:f,radius:h,centerX:g,centerY:b,baseColor:m.baseColor};(Dw[a.terrain]??Kb)(E),n.globalCompositeOperation="lighter";const C=n.createRadialGradient(g,b,h*.85,g,b,h*1.18);C.addColorStop(0,"rgba(255, 255, 255, 0)"),C.addColorStop(1,Xc(p,.18)),n.fillStyle=C,n.fillRect(r-h*.1,l-h*.1,u+h*.2,f+h*.2),n.globalCompositeOperation="source-over",n.restore();const R=kw(m.icon);if(R){const N=Math.min(u,f)*.62,q=g-N/2,I=b-N/2;n.save(),n.globalAlpha*=.92,n.drawImage(R,q,I,N,N),n.restore()}if(a.building){const N=s[`building-${a.building}`]??s.placeholder;n.drawImage(N,r,l,u,f)}}function Ow(n,a){const s=Math.max(n.q*_a,a.minQ),r=Math.min(s+_a-1,a.maxQ),l=Math.max(n.r*_a,a.minR),u=Math.min(l+_a-1,a.maxR);return{qStart:s,qEnd:r,rStart:l,rEnd:u}}class qw{constructor(a){this.map=a,this.unsubscribe=a.addTileChangeListener((s,r,l)=>{this.onTileChange(s,l)})}chunkCanvases=new Map;dirtyChunks=new Set;cachedImages;unsubscribe;dispose(){this.unsubscribe(),this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}invalidate(){this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}markChunkDirty(a){this.dirtyChunks.add(a)}markTileDirty(a,s){this.dirtyChunks.add(lw(a,s))}getRenderableChunks(a,s,r,l){this.refreshAssets(r);const u=[],{width:f,height:h}=$c(s);for(const m of $b(a)){const p=Yb(m),g=this.ensureChunk(p,m,s,f,h,r,l);g&&u.push(g)}return u}refreshAssets(a){if(this.cachedImages!==a){this.cachedImages=a;for(const s of this.chunkCanvases.keys())this.dirtyChunks.add(s)}}onTileChange(a,s){(s==="created"||s==="terrain"||s==="building"||s==="fog")&&this.markTileDirty(a.q,a.r)}ensureChunk(a,s,r,l,u,f,h){const m=this.chunkCanvases.get(a);if(!m||this.dirtyChunks.has(a)){const p=this.renderChunk(a,s,r,l,u,f,h,m);return this.dirtyChunks.delete(a),p?(this.chunkCanvases.set(a,p),p):(this.chunkCanvases.delete(a),null)}return m}renderChunk(a,s,r,l,u,f,h,m){if(typeof document>"u")return null;const{qStart:p,qEnd:g,rStart:b,rEnd:v}=Ow(s,this.map);if(p>g||b>v)return null;const E=l/2,M=u/2;let C=1/0,R=1/0,N=-1/0,q=-1/0;const I=[];for(let oe=p;oe<=g;oe++)for(let P=b;P<=v;P++){const G=this.map.getTile(oe,P);if(!G||G.isFogged)continue;const{x:T,y:k}=Wn({q:oe,r:P},r),A=T-h.x-E,F=k-h.y-M;C=Math.min(C,A),R=Math.min(R,F),N=Math.max(N,A+l),q=Math.max(q,F+u),I.push({tile:G,x:A,y:F})}if(!Number.isFinite(C)||!Number.isFinite(R)||!Number.isFinite(N)||!Number.isFinite(q))return null;const Y=Math.max(1,Math.ceil(N-C)),Q=Math.max(1,Math.ceil(q-R));let ie=m?.canvas;(!ie||ie.width!==Y||ie.height!==Q)&&(ie=document.createElement("canvas"),ie.width=Y,ie.height=Q);const ee=ie.getContext("2d");if(!ee)throw new Error("Canvas 2D context not available for chunk rendering");ee.setTransform(1,0,0,1,0,0),ee.clearRect(0,0,Y,Q);for(const{tile:oe,x:P,y:G}of I){const T=P-C,k=G-R;ee.save(),Uw(ee,oe,f,T,k,l,u,r),Lw(ee,T+l/2,k+u/2,r),ee.restore()}return{key:a,canvas:ie,origin:{x:C,y:R},width:Y,height:Q}}}const zw=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Aa=new Array(512);for(let n=0;n<512;n++)Aa[n]=zw[n%256];const u2=new Map,d2=n=>n*n*n*(n*(n*6-15)+10),Qf=(n,a,s)=>n+s*(a-n),bc=(n,a,s)=>{switch(n&3){case 0:return a+s;case 1:return-a+s;case 2:return a-s;default:return-a-s}};function Bw(n,a){const s=Math.floor(n)&255,r=Math.floor(a)&255,l=n-Math.floor(n),u=a-Math.floor(a),f=Aa[Aa[s+1]+r+1],h=Aa[Aa[s]+r+1],m=Aa[Aa[s+1]+r],p=Aa[Aa[s]+r],g=d2(l),b=d2(u),v=Qf(bc(p,l,u),bc(m,l-1,u),g),E=Qf(bc(h,l,u-1),bc(f,l-1,u-1),g);return Qf(v,E,b)}function Hw(n,a,s=4){let r=0,l=1,u=1,f=0;for(let h=0;h<s;h++)r+=Bw(n*l,a*l)*u,f+=u,u*=.5,l*=2;return f>0?r/f:0}function Iw(n){const a=Math.max(32,Math.min(512,Math.round(n))),s=a,r=u2.get(s);if(r)return r;if(typeof document>"u")return null;const l=document.createElement("canvas");l.width=a,l.height=a;const u=l.getContext("2d");if(!u)return null;const f=u.createImageData(a,a),h=a/48;let m=0;for(let p=0;p<a;p++)for(let g=0;g<a;g++){const b=Hw(g/h,p/h,5),v=Math.pow((b+1)/2,1.35),E=Math.round(v*255);f.data[m]=255,f.data[m+1]=255,f.data[m+2]=255,f.data[m+3]=E,m+=4}return u.putImageData(f,0,0),u2.set(s,l),l}function f2(n,a,s,r){n.beginPath();for(let l=0;l<6;l++){const u=Math.PI/180*(60*l-30),f=a+r*Math.cos(u),h=s+r*Math.sin(u);l===0?n.moveTo(f,h):n.lineTo(f,h)}n.closePath()}function jw(n,a,s,r){const l=n.createRadialGradient(a,s,r*.08,a,s,r*1.12);return l.addColorStop(0,Kc(.4,.35)),l.addColorStop(.35,Kc(.2,.55)),l.addColorStop(.6,Xs(.1,.78)),l.addColorStop(.82,Xs(.2,.88)),l.addColorStop(1,Xs(.35,.95)),l}function Gw(n,a,s,r,l){if(r<=0)return;const u=Iw(r*2.2),f=r*2.5,h=a-f/2,m=s-f/2;n.save(),f2(n,a,s,r),n.clip();const p=jw(n,a,s,r);n.fillStyle=p,n.fillRect(h,m,f,f),u&&(n.save(),n.globalCompositeOperation="lighter",n.globalAlpha*=.32,n.drawImage(u,a-r,s-r,r*2,r*2),n.restore()),n.restore(),n.save(),f2(n,a,s,r*.99),n.lineJoin="round",n.lineCap="round",n.lineWidth=Qc(r,l,"hover"),n.strokeStyle=Xs(.3,.88),n.shadowColor=Xs(.45,.42),n.shadowBlur=Math.max(3,r*.45/Math.max(l,.1)),n.stroke(),n.restore()}class Fw{constructor(a){this.mapRef=a,this.terrainCache=new qw(a),this.cachedHexSize=a.hexSize}terrainCache;cachedHexSize;get hexSize(){return this.mapRef.hexSize}getOrigin(){return Wn({q:this.mapRef.minQ,r:this.mapRef.minR},this.hexSize)}invalidateCache(){this.terrainCache.invalidate()}dispose(){this.terrainCache.dispose()}draw(a,s,r){this.ensureHexSize();const l=a.canvas??null,u=ow(this.mapRef,Ee,l,this.hexSize);if(!u)return;const f=cw(u);dw(this.mapRef,f);const h=this.getOrigin(),m=this.terrainCache.getRenderableChunks(f,this.hexSize,s,h);this.drawChunks(a,m),this.drawFogLayer(a,h,u),r&&this.drawSelection(a,h,r)}drawToCanvas(a,s,r){const l=a.getContext("2d");if(!l)throw new Error("Canvas 2D context not available");this.draw(l,s,r)}ensureHexSize(){this.cachedHexSize!==this.hexSize&&(this.cachedHexSize=this.hexSize,this.terrainCache.invalidate())}drawChunks(a,s){if(s.length!==0)for(const r of s)a.drawImage(r.canvas,r.origin.x,r.origin.y)}drawSelection(a,s,r){const{width:l,height:u}=$c(this.hexSize),{x:f,y:h}=Wn(r,this.hexSize),m=f-s.x-l/2,p=h-s.y-u/2;this.strokeHex(a,m+l/2,p+u/2,this.hexSize,!0)}drawFogLayer(a,s,r){const{width:l,height:u}=$c(this.hexSize),f=l/2,h=u/2;for(let m=r.rMin;m<=r.rMax;m++)for(let p=r.qMin;p<=r.qMax;p++){const g=this.mapRef.getTile(p,m);if(!g||!g.isFogged)continue;const{x:b,y:v}=Wn({q:p,r:m},this.hexSize),E=b-s.x-f,M=v-s.y-h,C=this.hexSize,R=E+l/2,N=M+u/2;Gw(a,R,N,C,Ee.zoom)}}strokeHex(a,s,r,l,u=!1){const{stroke:f,glow:h}=ww();this.hexPath(a,s,r,l),a.save(),a.lineJoin="round",a.lineCap="round",u?(a.shadowColor=h,a.shadowBlur=Math.max(6,l*.65/Math.max(Ee.zoom,.1)),a.lineWidth=Qc(l,Ee.zoom,"selection"),a.strokeStyle=f,a.stroke()):(a.lineWidth=Qc(l,Ee.zoom,"hover"),a.shadowColor=Kc(.1,.45),a.shadowBlur=Math.max(2,l*.4/Math.max(Ee.zoom,.1)),a.strokeStyle=Xs(.1,.72),a.stroke()),a.restore()}hexPath(a,s,r,l){a.beginPath();for(let u=0;u<6;u++){const f=Math.PI/180*(60*u-30),h=s+l*Math.cos(f),m=r+l*Math.sin(f);u===0?a.moveTo(h,m):a.lineTo(h,m)}a.closePath()}}const di={accent:"#38bdf8",accentSoft:"rgba(56, 189, 248, 0.2)",warm:"#fbbf24",surface:"rgba(15, 23, 42, 0.92)",border:"rgba(148, 163, 184, 0.34)",text:"#e2e8f0"};let fi=null;function Is(n,a){const s=n.trim();return s.length>0?s:a}function Yw(){if(fi)return fi;if(typeof window>"u"||typeof document>"u")return fi=di,fi;try{const n=getComputedStyle(document.documentElement);return fi={accent:Is(n.getPropertyValue("--color-accent"),di.accent),accentSoft:Is(n.getPropertyValue("--color-accent-soft"),di.accentSoft),warm:Is(n.getPropertyValue("--color-warning"),di.warm),surface:Is(n.getPropertyValue("--color-surface-strong"),di.surface),border:Is(n.getPropertyValue("--hud-border-strong"),di.border),text:Is(n.getPropertyValue("--color-foreground"),di.text)},fi}catch(n){return console.warn("Failed to read sauna palette tokens from computed styles",n),fi=di,fi}}function $w(n,a){const s=Math.max(0,n.auraRadius),r=Wn(n.pos,a),l=r.x+a,u=r.y+a;let f=a;if(s<=0)return a*1.6;for(const h of G2){const m=Wn({q:n.pos.q+h.q*s,r:n.pos.r+h.r*s},a),p=m.x+a,g=m.y+a,b=Math.hypot(p-l,g-u);b>f&&(f=b)}return f+a*.65}function Vw(n,a,s,r,l,u){const f=Math.max(0,Math.min(u,Math.min(r,l)/2));n.moveTo(a+f,s),n.lineTo(a+r-f,s),n.quadraticCurveTo(a+r,s,a+r,s+f),n.lineTo(a+r,s+l-f),n.quadraticCurveTo(a+r,s+l,a+r-f,s+l),n.lineTo(a+f,s+l),n.quadraticCurveTo(a,s+l,a,s+l-f),n.lineTo(a,s+f),n.quadraticCurveTo(a,s,a+f,s),n.closePath()}function Xw(n,a,{origin:s,hexSize:r,timestamp:l}){if(!a)return;const u=Yw(),f=Number.isFinite(l)?l:typeof performance<"u"?performance.now():Date.now(),h=.5+.5*Math.sin(f*.0035),m=Wn(a.pos,r),p=m.x-s.x+r,g=m.y-s.y+r,b=$w(a,r);n.save(),n.globalCompositeOperation="screen";const v=b+r*(.4+h*.3),E=Math.max(r*.6,b*.58),M=n.createRadialGradient(p,g,E,p,g,v);M.addColorStop(0,u.accentSoft),M.addColorStop(.55,`rgba(56, 189, 248, ${.18+h*.12})`),M.addColorStop(1,"rgba(2, 6, 23, 0)"),n.fillStyle=M,n.beginPath(),n.arc(p,g,v,0,Math.PI*2),n.fill(),n.restore(),n.save(),n.globalCompositeOperation="lighter",n.lineWidth=Math.max(r*.28,6),n.strokeStyle=`rgba(56, 189, 248, ${(.35+h*.2).toFixed(3)})`,n.shadowColor=`rgba(56, 189, 248, ${.45+h*.1})`,n.shadowBlur=r*(.9+h*.45),n.beginPath(),n.arc(p,g,b+r*.12,0,Math.PI*2),n.stroke(),n.restore();const C=r*.9;n.save(),n.beginPath(),n.arc(p,g,C,0,Math.PI*2),n.fillStyle=u.surface,n.globalAlpha*=.96,n.fill(),n.lineWidth=Math.max(1.5,r*.06),n.strokeStyle=u.border,n.shadowColor="rgba(8, 25, 53, 0.6)",n.shadowBlur=r*.45,n.stroke(),n.restore();const R=C*.78,N=Math.max(r*.22,5);n.save(),n.lineWidth=N,n.strokeStyle="rgba(148, 163, 184, 0.24)",n.beginPath(),n.arc(p,g,R,0,Math.PI*2),n.stroke(),n.restore();const q=a.playerSpawnCooldown>0?a.playerSpawnCooldown:1,Y=1-Math.min(1,Math.max(0,a.playerSpawnTimer/q)),Q=-Math.PI/2,ie=Q+Math.PI*2*Y;if(Y>0){n.save(),n.lineWidth=N,n.lineCap="round";const $=n.createLinearGradient(p,g-R,p,g+R);$.addColorStop(0,u.accent),$.addColorStop(1,u.warm),n.strokeStyle=$,n.shadowColor=`rgba(56, 189, 248, ${.42+h*.18})`,n.shadowBlur=r*(.65+h*.35),n.beginPath(),n.arc(p,g,R,Q,ie,!1),n.stroke(),n.restore()}const ee=Math.max(0,a.playerSpawnTimer),oe=Math.ceil(ee);n.save(),n.font=`600 ${Math.max(12,r*.9)}px "Inter", "Manrope", "Segoe UI", sans-serif`,n.fillStyle=u.text,n.textAlign="center",n.textBaseline="middle",n.shadowColor="rgba(2, 6, 23, 0.6)",n.shadowBlur=r*.35,n.fillText(String(oe),p,g),n.restore(),n.save(),n.font=`500 ${Math.max(10,r*.36)}px "Inter", "Manrope", "Segoe UI", sans-serif`,n.fillStyle="rgba(148, 163, 184, 0.78)",n.textAlign="center",n.textBaseline="top",n.fillText("sec",p,g+R*.45),n.restore();const P="Sauna ♨️",G=Math.max(12,r*.58);n.save(),n.font=`600 ${G}px "Inter", "Manrope", "Segoe UI", sans-serif`;const T=n.measureText(P),k=r*.58,A=r*.32,F=T.width+k*2,B=G+A*2,D=p-F/2,V=g-b-B-r*.35,te=B/2;n.beginPath(),Vw(n,D,V,F,B,te);const he=n.createLinearGradient(D,V,D,V+B);he.addColorStop(0,"rgba(15, 23, 42, 0.94)"),he.addColorStop(.55,"rgba(15, 23, 42, 0.86)"),he.addColorStop(1,"rgba(30, 41, 59, 0.9)"),n.fillStyle=he,n.shadowColor="rgba(8, 25, 53, 0.6)",n.shadowBlur=r*.4,n.fill(),n.lineWidth=Math.max(1.5,r*.06);const w=n.createLinearGradient(D,V,D+F,V);w.addColorStop(0,`${u.accent}`),w.addColorStop(1,`${u.warm}`),n.strokeStyle=w,n.stroke(),n.fillStyle=u.text,n.shadowColor="rgba(8, 25, 53, 0.65)",n.shadowBlur=r*.3,n.textAlign="center",n.textBaseline="middle",n.fillText(P,p,V+B/2+G*.05),n.restore()}const Pb={nativeSize:{width:64,height:64},anchor:{x:.5,y:.92},scale:{x:1,y:1},nudge:{x:0,y:-.05}},Kw={default:Pb,soldier:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.9},scale:{x:1.12,y:1.24},nudge:{x:0,y:-.14}},archer:{nativeSize:{width:128,height:128},anchor:{x:.46,y:.88},scale:{x:1.1,y:1.22},nudge:{x:-.04,y:-.12}},"avanto-marauder":{nativeSize:{width:128,height:128},anchor:{x:.5,y:.92},scale:{x:1.18,y:1.3},nudge:{x:0,y:-.18}},saunoja:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.66},scale:{x:1,y:1},nudge:{x:0,y:-.02}}};function Zb(n){return Kw[n]??Pb}function Jb(n,a,s,r){const{x:l,y:u}=Wn(n,a),f=r.nudge.x*a,h=r.nudge.y*a;return{x:l-s.x+f,y:u-s.y+h}}function Qw({coord:n,hexSize:a,origin:s,zoom:r,type:l}){const u=Zb(l),f=Jb(n,a,s,u);return{x:Zn(f.x,r),y:Zn(f.y,r)}}function Pw({coord:n,hexSize:a,origin:s,zoom:r,type:l}){const u=Zb(l),f=Jb(n,a,s,u),{width:h,height:m}=$c(a),p=h*u.scale.x,g=m*u.scale.y,b=Zn(f.x-p*u.anchor.x,r),v=Zn(f.y-g*u.anchor.y,r),E=Zn(p,r),M=Zn(g,r),C=b+E*u.anchor.x,R=v+M*u.anchor.y;return{drawX:b,drawY:v,width:E,height:M,centerX:C,centerY:R,metadata:u}}function Zw(n){if(!n||typeof n!="object")return!1;const a=n;return!!a.coord&&typeof a.coord=="object"&&typeof a.coord.q=="number"&&typeof a.coord.r=="number"&&typeof a.range=="number"}function Jw(n){if(!n)return null;if(Zw(n)){const a=Number.isFinite(n.range)?Math.max(0,n.range):0;return{coord:n.coord,range:a}}if("pos"in n&&"auraRadius"in n){const a=Number.isFinite(n.auraRadius)?Math.max(0,n.auraRadius):0;return{coord:n.pos,range:a}}return null}function Ww(n,a,s,r,l,u){const f=window.devicePixelRatio||1,h=n.canvas.width,m=n.canvas.height;n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,h,m);const p=h/f,g=m/f;n.scale(f,f),n.translate(p/2,g/2),n.scale(Ee.zoom,Ee.zoom);const b=a.getOrigin();n.translate(-(Ee.x-b.x),-(Ee.y-b.y)),a.draw(n,s,l??void 0);const v=u?.saunojas;v&&Array.isArray(v.units)&&v.units.length>0&&v.draw(n,v.units,{originX:b.x,originY:b.y,hexRadius:a.hexSize,zoom:Ee.zoom,resolveRenderCoord:v.resolveRenderCoord}),eA(n,a,s,r,b,u?.fx,u?.friendlyVisionSources,u?.saunaVision??u?.sauna??null),u?.sauna&&Xw(n,u.sauna,{origin:b,hexSize:a.hexSize}),n.restore()}function eA(n,a,s,r,l,u,f,h){const p=(f??r).filter(b=>b.faction==="player"&&!b.isDead()).map(b=>({coord:b.coord,range:b.getVisionRange()})),g=Jw(h);g&&p.push(g);for(const b of r){if(b.isDead()||b.faction==="enemy"&&!p.some(({coord:Q,range:ie})=>Gs(Q,b.coord)<=ie))continue;const v=s[`unit-${b.type}`]??s.placeholder,E=b.getMaxHealth();n.save();const M=u?.getUnitAlpha?.(b);if(typeof M=="number"){const Q=Math.min(1,Math.max(0,M));if(Q<=0){n.restore();continue}n.globalAlpha*=Q}b.stats.health/E<.5&&(n.filter="saturate(0)");const C=b.renderCoord??b.coord,R=Pw({coord:C,hexSize:a.hexSize,origin:l,zoom:Ee.zoom,type:b.type}),N=[];b.stats.health/E<.5&&N.push("saturate(0)");const q=Math.abs(C.q-b.coord.q),I=Math.abs(C.r-b.coord.r),Y=Math.min(1,q+I);Y>.01?(N.push("contrast(1.08)"),n.shadowColor="rgba(255, 255, 255, 0.28)",n.shadowBlur=Math.max(6,12*Ee.zoom*Y)):(n.shadowColor="rgba(0, 0, 0, 0)",n.shadowBlur=0),n.filter=N.length>0?N.join(" "):"none",n.drawImage(v,R.drawX,R.drawY,R.width,R.height),lm()&&b.faction==="player"&&(n.strokeStyle="rgba(255,255,255,0.5)",n.lineWidth=2,n.strokeRect(R.drawX,R.drawY,R.width,R.height)),n.restore()}}const tA=200,h2=.001;function Pf(n){return{q:n.q,r:n.r}}function vc(n,a){return!n||!a?!1:Math.abs(n.q-a.q)<h2&&Math.abs(n.r-a.r)<h2}class nA{constructor(a){this.redraw=a}tracks=new Map;rafId=null;enqueue(a,s){const r=this.normalizePath(s);if(r.length<2){this.clear(a,{snap:!0});return}const l=r[0];let u=this.tracks.get(a.id);u?u.current?vc(u.current.to,l)||(u=this.resetTrack(a,l)):vc(a.renderCoord,l)||(u=this.resetTrack(a,l)):(u={unit:a,queue:[]},this.tracks.set(a.id,u),vc(a.renderCoord,l)||a.setRenderCoord(l));for(let f=1;f<r.length;f++)u.queue.push(Pf(r[f]));this.ensureRunning()}clear(a,s){if(!this.tracks.delete(a.id)){s?.snap&&(a.snapRenderToCoord(),this.redraw());return}(s?.snap??!0)&&(a.snapRenderToCoord(),this.redraw()),this.tracks.size===0&&this.rafId!==null&&(typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null)}clearAll(){for(const a of this.tracks.values())a.unit.snapRenderToCoord();this.tracks.clear(),this.rafId!==null&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null,this.redraw()}resetTrack(a,s){this.clear(a,{snap:!1});const r={unit:a,queue:[]};return this.tracks.set(a.id,r),a.setRenderCoord(s),r}ensureRunning(){this.rafId!==null||this.tracks.size===0||(this.rafId=requestAnimationFrame(this.step))}normalizePath(a){const s=[];for(const r of a){const l=Pf(r);(s.length===0||!vc(s[s.length-1],l))&&s.push(l)}return s}ease(a){return a<=0?0:a>=1?1:a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2}step=a=>{if(this.rafId=null,this.tracks.size===0)return;let s=!1;for(const[r,l]of this.tracks){if(!l.current){const v=l.queue.shift();if(!v){this.tracks.delete(r);continue}l.current={from:Pf(l.unit.renderCoord??l.unit.coord),to:v,start:a}}const u=l.current;if(!u)continue;const h=(a-u.start)/tA,m=Math.min(1,Math.max(0,h)),p=this.ease(m),g=u.from.q+(u.to.q-u.from.q)*p,b=u.from.r+(u.to.r-u.from.r)*p;l.unit.setRenderCoord({q:g,r:b}),s=!0,m>=1&&(l.unit.setRenderCoord(u.to),l.current=void 0,l.queue.length===0&&this.tracks.delete(r))}s&&this.redraw(),this.tracks.size>0&&(this.rafId=requestAnimationFrame(this.step))}}const aA=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,iA=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null,sA=900,rA=650;function oA(n){switch(n){case"down":return{x:0,y:36};case"left":return{x:-26,y:-18};case"right":return{x:26,y:-18};case"up":default:return{x:0,y:-40}}}function lA(n){const a=document.createElement("div");a.className="ui-floater-layer",n.appendChild(a);const s=!!aA?.matches,r=!!iA?.matches;return{spawn:({text:f,x:h,y:m,color:p,direction:g="up",durationMs:b,fontSize:v})=>{const E=document.createElement("span");E.className="ui-floater",E.textContent=f,E.style.left=`${Math.round(h)}px`,E.style.top=`${Math.round(m)}px`,p&&(E.style.color=p),v&&(E.style.fontSize=`${v}px`);const M=r?12:24;for(;a.childElementCount>=M;)a.firstElementChild?.remove();a.appendChild(E);const C=b??(r?rA:sA);if(s||!E.animate){E.style.opacity="0",E.style.transition=`opacity ${Math.round(C*.8)}ms ease-out`,requestAnimationFrame(()=>{E.style.opacity="1",requestAnimationFrame(()=>{E.style.opacity="0"})}),window.setTimeout(()=>{E.remove()},C);return}const R=oA(g),N=[{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:0},{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:1,offset:.18},{transform:`translate3d(-50%, -50%, 0) translate3d(${R.x}px, ${R.y}px, 0)`,opacity:0}],q=E.animate(N,{duration:C,easing:"cubic-bezier(0.18, 0.89, 0.32, 1.28)",fill:"forwards"});q.onfinish=()=>{E.remove()}},destroy:()=>{a.remove()}}}const m2=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),cA=new Intl.NumberFormat("en-US",{maximumFractionDigits:1,minimumFractionDigits:0});function p2(n){return 1-(1-n)*(1-n)}function Sc(n,a,s){return Math.min(s,Math.max(a,n))}const uA="var(--color-danger)",dA="color-mix(in srgb, #34d399 88%, white 12%)",fA=720,hA=540,mA=220,pA=180,gA=6,yA=3,bA="color-mix(in srgb, #fbbf24 82%, white 10%)",vA=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,SA=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null;function EA(n){const{canvas:a,overlay:s,mapRenderer:r,getUnitById:l,requestDraw:u}=n,f=lA(s),h=new Map,m=new Map,p=[],g={x:0,y:0},b=!!vA?.matches,v=!!SA?.matches,E=v?hA:fA,M=v?pA:mA,C=v?yA:gA,R=()=>{u&&(typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>u()):u())},N=G=>{const T=a.getBoundingClientRect(),k=s.getBoundingClientRect();if(T.width===0||T.height===0)return null;const{x:A,y:F}=Wn(G,r.hexSize),B=(A-Ee.x)*Ee.zoom+T.width/2,D=(F-Ee.y)*Ee.zoom+T.height/2,V=r.hexSize*Ee.zoom*.75;return{x:B+(T.left-k.left),y:D+(T.top-k.top)-V}},q=(G,T,k,A="up")=>{const F=l(G);if(!F)return;const B=N(F.renderCoord??F.coord);B&&f.spawn({text:T,x:B.x,y:B.y,color:k,direction:A,fontSize:v?18:void 0})},I=G=>{if(!G||G.amount<=0)return;const T=m2.format(Math.max(1,Math.round(G.amount)));if(q(G.targetId,`-${T}`,uA,"up"),!b){const k=typeof performance<"u"?performance.now():Date.now();p.push({start:k,duration:M,intensity:C,seedX:Math.random()*500,seedY:Math.random()*500})}R()},Y=G=>{if(!G||G.amount<=0)return;const T=G.amount>=1?m2.format(Math.round(G.amount)):cA.format(Sc(G.amount,0,9.9));q(G.unitId,`+${T}`,dA,"up"),R()},Q=G=>{if(!G)return;const T=typeof performance<"u"?performance.now():Date.now();h.set(G.unitId,{start:T,duration:E}),q(G.unitId,"✖",bA,"down"),R()};return ne.on("unitDamaged",I),ne.on("unitHealed",Y),ne.on("unitDied",Q),{step:G=>{if(b)g.x=0,g.y=0;else{let T=0,k=0;for(let A=p.length-1;A>=0;A--){const F=p[A],B=G-F.start;if(B>=F.duration){p.splice(A,1);continue}const D=Sc(B/F.duration,0,1),V=F.intensity*p2(1-D);T+=Math.sin((G+F.seedX)/16)*V,k+=Math.cos((G+F.seedY)/18)*V}g.x=T,g.y=k}for(const[T,k]of h){const A=G-k.start,F=Sc(A/k.duration,0,1),B=1-p2(F);if(F>=1){m.delete(T),h.delete(T);continue}m.set(T,Sc(B,0,1))}},getShakeOffset:()=>({x:g.x,y:g.y}),getUnitAlpha:G=>m.get(G)??1,dispose:()=>{ne.off("unitDamaged",I),ne.off("unitHealed",Y),ne.off("unitDied",Q),p.length=0,h.clear(),m.clear(),f.destroy()}}}function MA(){return`${"/".endsWith("/")?"/":"//"}${"assets/units/saunoja.svg".replace(/^\/+/,"")}`}const g2=MA();let Ys=null,co=null;function kh(n){return!!(n&&n.complete&&n.naturalWidth>0&&n.naturalHeight>0)}function xA(n,a){if(!a)return n;try{a(n)}catch(s){console.error("Saunoja icon onLoad callback failed",s)}return n}function Wb(n){const a=r=>n?r.then(l=>xA(l,n)):r;if(kh(Ys))return a(Promise.resolve(Ys));if(co)return a(co);if(typeof Image>"u")return Promise.reject(new Error("Image constructor is not available in this environment."));const s=new Image;return s.decoding="async",Ys=s,co=new Promise((r,l)=>{const u=()=>{s.onload=null,s.onerror=null},f=()=>{u(),r(s)};s.onload=f,s.onerror=h=>{u(),Ys=null,co=null;const m=new Error(`Failed to load saunoja icon from ${g2}`);console.warn(m.message,h),l(m)},s.src=g2,kh(s)&&f()}),a(co)}function wA(n,a,{originX:s=0,originY:r=0,hexRadius:l=er,zoom:u=1,resolveRenderCoord:f}={}){if(!n||!Array.isArray(a)||a.length===0)return;const h=kh(Ys)?Ys:null;if(!h)return;const m=Number.isFinite(l)&&l>0?l:er,p=m*.965,g=a.map(b=>{const v=f?.(b),M=v&&typeof v=="object"&&Number.isFinite(v.q)&&Number.isFinite(v.r)?{q:v.q,r:v.r}:b.coord;return{unit:b,coord:M}}).sort((b,v)=>b.coord.r!==v.coord.r?b.coord.r-v.coord.r:b.coord.q!==v.coord.q?b.coord.q-v.coord.q:b.unit.id.localeCompare(v.unit.id));for(const{unit:b,coord:v}of g){const{x:E,y:M}=Qw({coord:v,hexSize:m,origin:{x:s,y:r},zoom:u,type:"saunoja"});n.save(),vo(n,E,M,p),n.clip();const C=h.naturalWidth||1,R=h.naturalHeight||1,N=p*1.85,q=p*2.4,I=Math.min(N/C,q/R),Y=Zn(C*I,u),Q=Zn(R*I,u),ie=Zn(E-Y/2,u),ee=Zn(M-Q*.78,u);n.save(),n.filter="saturate(112%) contrast(108%) brightness(1.04)",n.drawImage(h,ie,ee,Y,Q),n.restore(),n.save(),n.globalCompositeOperation="multiply";const oe=n.createRadialGradient(E,M+p*.38,p*.2,E,M+p*.38,p*1.05);oe.addColorStop(0,"rgba(22, 30, 50, 0.58)"),oe.addColorStop(1,"rgba(22, 30, 50, 0)"),n.fillStyle=oe,n.fillRect(E-p,M-p,p*2,p*2),n.restore(),n.save(),n.globalCompositeOperation="soft-light";const P=n.createLinearGradient(E,M-p,E,M+p);P.addColorStop(0,"rgba(233, 224, 255, 0.28)"),P.addColorStop(.52,"rgba(196, 148, 255, 0.26)"),P.addColorStop(1,"rgba(94, 75, 168, 0.35)"),n.fillStyle=P,n.fillRect(E-p,M-p,p*2,p*2),n.restore(),n.save(),n.globalCompositeOperation="screen",n.globalAlpha=.68;const G=n.createRadialGradient(E,M-p*.68,p*.1,E,M,p*1.12);G.addColorStop(0,"rgba(255, 255, 255, 0.85)"),G.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=G,n.fillRect(E-p,M-p,p*2,p*2),n.restore();const k=performance.now()-b.lastHitAt,A=120;if(k<A){const D=1-k/A;r3(n,{centerX:E,centerY:M,radius:p,progress:D})}n.restore(),o3(n,{centerX:E,centerY:M-m*.18,radius:m*.94,intensity:b.steam});const F=m*.42,B=M+m*.34;s3(n,{centerX:E,centerY:B,hp:b.hp,maxHp:b.maxHp,radius:F})}}const AA=["Resolute Sauna Guardian","Steam Scholar","Frost-Hardened","Loyal Watchbearer","Aura Whisperer","Shield Brother","Stonefooted Scout","Sisu-Forged Veteran","Brewmaster Quartermaster","Icebreaker Herald","Runic Tactician","Torchbearer"],CA=["Heat Fickle","Soot Allergic","Slow to Spark","Overconfident","Distracted Dreamer","Stubborn Stoker","Thirsty Between Battles","Clumsy Footwork","Rust-Prone Gear","Echo-Lost Listener"];function y2(n,a,s){const r=[...n],l=[],u=Math.max(0,Math.min(a,r.length));for(let f=0;f<u;f++){const h=Math.floor(s()*r.length),[m]=r.splice(h,1);m&&l.push(m)}return l}function TA(n,a){for(let s=n.length-1;s>0;s--){const r=Math.floor(a()*(s+1));[n[s],n[r]]=[n[r],n[s]]}return n}function _A(n=Math.random){typeof n!="function"&&(n=Math.random);const a=y2(AA,2,n),s=y2(CA,1,n),r=[...a,...s];return TA(r,n).map(l=>l.trim()).filter(l=>l.length>0)}const RA=1;function uo(n,a=0){return Number.isFinite(n)?n:a}function NA(n){const{heat:a,pickSpawnTile:s,spawnUnit:r,maxSpawns:l,tierHelpers:u}=n,f=Math.max(RA,Co),h=Math.max(0,uo(n.minUpkeepReserve??f,f));let m=Math.max(0,uo(n.availableUpkeep,0));const p=Math.max(0,Math.floor(uo(l??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY))),g=uo(n.rosterCap??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),b=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.POSITIVE_INFINITY,v=typeof n.getRosterCount=="function"?n.getRosterCount:()=>0;let E=0,M=0,C=0,R=0,N=0,q=0,I=0;for(;(a.hasTriggerReady()||u?.hasQueuedSpawn())&&E<p;){E+=1;const Y=u?.getSnapshot()??null;if(Math.max(0,Math.floor(uo(v()??0,0)))>=b){q+=1;let P=!1;Y&&u&&(P=u.queueBlockedSpawn(Y,()=>a.consumeTrigger())),P?M+=a.vent(.15):M+=a.vent(.35);break}let ie=!1;if(Y&&u&&u.hasQueuedSpawn()&&(ie=u.takeQueuedSpawn(Y)),!ie&&!a.hasTriggerReady())break;if(m<h){R+=1,ie&&Y&&u?.restoreQueuedSpawn(Y),M+=a.vent(.5);break}const ee=s();if(!ee){N+=1,ie&&Y&&u?.restoreQueuedSpawn(Y),M+=a.vent(.25);break}if(!r(ee)){I+=1,ie&&Y&&u?.restoreQueuedSpawn(Y),M+=a.vent(.25);break}if(!ie&&!a.consumeTrigger()){I+=1;break}C+=1,m=Math.max(0,m-h),Y&&u?.onSpawnResolved?.(Y,{usedQueue:ie})}return{spawned:C,blockedByUpkeep:R,blockedByPosition:N,blockedByRoster:q,failedSpawns:I,ventedHeat:M,remainingUpkeep:m}}function Zf(n,a=0){return Number.isFinite(n)?n:a}function kA(n){const a=Math.max(0,Zf(n.dt,0)),{addedHeat:s,cooledHeat:r}=n.heat.advance(a);let l=0;for(const E of n.units){if(E.isDead()||E.faction!=="player")continue;const M=Math.max(0,Zf(n.getUnitUpkeep(E),0));M>0&&(l+=M)}const u=5;let h=Math.max(0,Zf(n.sauna.beerUpkeepAccumulator,0)),m=0;if(l>0){if(h+=a,h>=u){const E=Math.floor(h/u);m=l*E,h-=E*u}}else h=0;n.sauna.beerUpkeepAccumulator=h,m>0&&n.state.addResource(se.SAUNA_BEER,-m);const p=n.state.getResource(se.SAUNA_BEER),g=NA({heat:n.heat,availableUpkeep:p,pickSpawnTile:n.pickSpawnTile,spawnUnit:n.spawnBaseUnit,minUpkeepReserve:n.minUpkeepReserve,maxSpawns:n.maxSpawns,rosterCap:n.rosterCap,getRosterCount:n.getRosterCount,tierHelpers:n.tierHelpers}),b=n.heat.getCooldownSeconds(),v=n.heat.timeUntilNextTrigger();return n.sauna.heat=n.heat.getHeat(),n.sauna.playerSpawnThreshold=n.heat.getThreshold(),n.sauna.playerSpawnCooldown=Number.isFinite(b)?b:0,n.sauna.playerSpawnTimer=Number.isFinite(v)?v:0,n.sauna.heatPerTick=n.heat.getBuildRate(),{addedHeat:s,cooledHeat:r,upkeepDrain:m,spawn:g,beerRemaining:n.state.getResource(se.SAUNA_BEER),availableUpkeep:g.remainingUpkeep}}function DA(){try{return globalThis.localStorage??null}catch(n){return console.warn("Unable to access localStorage for inventory persistence",n),null}}function LA(n,a){const s=n.getItem(a);if(s)try{return JSON.parse(s)}catch(r){console.warn(`Failed to parse persisted inventory for "${a}", clearing.`,r),n.removeItem(a);return}}function Ec(n,a,s){const r=Number.isFinite(n.quantity)?n.quantity:1,l=Math.max(1,Math.round(r)),u=typeof n.rarity=="string"?n.rarity.trim():void 0,f=typeof n.icon=="string"?n.icon:void 0,h=typeof n.description=="string"?n.description:void 0;return{id:n.id,name:n.name,description:h,icon:f,rarity:u,quantity:l,acquiredAt:a,sourceTableId:s?.tableId,sourceEntryId:s?.entryId}}class UA{listeners=new Set;storageKey;now;maxStashSize;storage;autoEquip;stash=[];inventory=[];constructor(a={}){this.storageKey=a.storageKey??"autobattles:inventory",this.now=typeof a.now=="function"?a.now:()=>Date.now(),this.maxStashSize=Math.max(1,Math.floor(a.maxStashSize??24)),this.storage=DA(),this.autoEquip=a.autoEquip??!0,this.load()}load(){if(!this.storage)return;const a=LA(this.storage,this.storageKey);if(a){if(typeof a.autoEquip=="boolean"&&(this.autoEquip=a.autoEquip),Array.isArray(a.stash)){const s=[];for(const r of a.stash){if(!r||typeof r!="object")continue;const{id:l,name:u,quantity:f}=r;if(typeof l!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(Ec({id:l,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.stash=s.slice(0,this.maxStashSize)}if(Array.isArray(a.inventory)){const s=[];for(const r of a.inventory){if(!r||typeof r!="object")continue;const{id:l,name:u,quantity:f}=r;if(typeof l!="string"||typeof u!="string")continue;const h=Number.isFinite(r.acquiredAt)?r.acquiredAt:this.now();s.push(Ec({id:l,name:u,description:r.description,icon:r.icon,rarity:r.rarity,quantity:f},h,{tableId:r.sourceTableId,entryId:r.sourceEntryId}))}this.inventory=s}}}persist(){if(!this.storage)return;const a={autoEquip:this.autoEquip,stash:this.stash.map(s=>({...s})),inventory:this.inventory.map(s=>({...s}))};try{this.storage.setItem(this.storageKey,JSON.stringify(a))}catch(s){console.warn("Failed to persist inventory state",s)}}emit(a){for(const s of this.listeners)s(a)}normalizeEquipResult(a){return typeof a=="boolean"?{success:a}:!a||typeof a!="object"?{success:!1}:{success:!!a.success,comparison:a.comparison,reason:a.reason}}on(a){return this.listeners.add(a),()=>{this.listeners.delete(a)}}isAutoEquipEnabled(){return this.autoEquip}setAutoEquip(a){this.autoEquip!==a&&(this.autoEquip=a,this.persist(),this.emit({type:"settings-updated",autoEquip:this.autoEquip}))}getStash(){return this.stash.map(a=>({...a}))}getStashSize(){return this.stash.length}getInventory(){return this.inventory.map(a=>({...a}))}getInventorySize(){return this.inventory.length}addLoot(a,s={}){return this.addItem({...a.item},{...s,sourceTableId:s.sourceTableId,sourceEntryId:s.sourceEntryId??a.entryId})}addItem(a,s={}){const r=Math.max(0,Math.round(this.now())),l=Ec(a,r,{tableId:s.sourceTableId,entryId:s.sourceEntryId}),u=s.autoEquip??this.autoEquip;let f={success:!1};if(u&&s.unitId&&typeof s.equip=="function"){try{f=this.normalizeEquipResult(s.equip(s.unitId,l))}catch(h){console.warn("Failed to auto-equip inventory item",{item:l,error:h}),f={success:!1}}if(f.success)return this.persist(),this.emit({type:"item-acquired",item:l,equipped:!0,location:"equipped",unitId:s.unitId,stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:l,equipped:!0,location:"equipped"}}if(this.stash.push(l),this.stash.length>this.maxStashSize){const h=this.stash.splice(0,this.stash.length-this.maxStashSize);h.length>0&&console.warn("Inventory stash full, trimming oldest items",h)}return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-acquired",item:l,equipped:!1,unitId:s.unitId,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:l,equipped:!1,location:"stash",stashIndex:this.stash.length-1}}equipFromStash(a,s,r){if(a<0||a>=this.stash.length)return!1;const l=this.stash[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,l))}catch(h){console.warn("Failed to equip stash item",{item:l,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}equipFromInventory(a,s,r){if(a<0||a>=this.inventory.length)return!1;const l=this.inventory[a];let u={success:!1};try{u=this.normalizeEquipResult(r(s,l))}catch(h){console.warn("Failed to equip inventory item",{item:l,error:h}),u={success:!1}}if(!u.success)return!1;const[f]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-equipped",item:f,unitId:s,from:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:u.comparison}),!0}moveToInventory(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.inventory.push(s),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-moved",item:s,from:"stash",to:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}moveToStash(a){if(this.stash.length>=this.maxStashSize||a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.stash.push(s),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-moved",item:s,from:"inventory",to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}discardFromInventory(a){if(a<0||a>=this.inventory.length)return null;const[s]=this.inventory.splice(a,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-discarded",item:s,location:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}unequipToStash(a,s,r){if(this.stash.length>=this.maxStashSize)return!1;let l=null;try{l=r(a,s)??null}catch(h){console.warn("Failed to unequip item",{unitId:a,slot:s,error:h}),l=null}if(!l)return!1;const u=Math.max(0,Math.round(this.now())),f=Ec(l,u);return this.stash.push(f),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-unequipped",item:f,unitId:a,slot:s,to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),!0}discardFromStash(a){if(a<0||a>=this.stash.length)return null;const[s]=this.stash.splice(a,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-discarded",item:s,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),s}}const b2={toast:990},OA={stash:"Quartermaster Stash",inventory:"Ready Inventory"},qA={stash:"Your stash is empty. Conquer enemy elites to gather new equipment.",inventory:"No gear staged. Move items into the ready inventory for quick equipping."},zA={mythic:6,legendary:5,epic:4,rare:3,uncommon:2,common:1},BA=["health","attackDamage","attackRange","movementRange","defense","shield"],HA={"birch-sap-satchel":["healing","support"],"steamed-bandages":["restoration","shielding"],"aurora-distillate":["damage","defense"],"stolen-sauna-tokens":["mobility"],"midnight-bloodwine":["healing","damage"],"sauna-incense":["range","focus"],"glacier-brand":["damage"],"emberglass-arrow":["damage","range"],"aurora-lattice":["damage","range"],"emberglass-shard":["damage","mobility"],"windstep-totem":["mobility","defense"],"searing-chant-censer":["damage","shielding"],"cracked-ice-amulet":["defense"],"myrsky-charm":["range","defense"],"frostwyrm-signet":["shielding"],"spirit-oak-charm":["healing","defense"]};function Ra(n){return(n??"").trim().toLowerCase()}function Jf(n){const a=new Set;for(const s of n){const r=Ra(s);r&&a.add(r)}return a}function Wf(n,a){return{id:n.id,name:n.name,quantity:typeof a=="number"?a:n.quantity,rarity:n.rarity}}function Mc(n){return n?{id:n.id,name:n.name,quantity:n.quantity,rarity:n.rarity}:null}function v2(n){return HA[n]??[]}function S2(n){const a=Ra(n)||"common",s=a.charAt(0).toUpperCase()+a.slice(1);return{key:a,label:s,rank:zA[a]??0}}function IA(n){const a=Uo(n.id);if(!a){const l=S2(n.rarity);return{slot:null,slotLabel:"Unassigned",rarity:l.key,rarityRank:l.rank,tags:v2(n.id),acquiredAt:n.acquiredAt}}const s=Lo(a.slot),r=S2(n.rarity);return{slot:a.slot,slotLabel:s.label,rarity:r.key,rarityRank:r.rank,tags:v2(n.id),acquiredAt:n.acquiredAt}}function jA(n,a,s,r,l){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:l,slot:a,maxStacks:s,modifiers:r??{}}}function E2(n,a){const s=n[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function GA(n,a){const s=Uo(n.item.id);if(!s)return{slot:null,canEquip:!1,reason:"unknown-item",equipped:null,projected:Wf(n.item),stats:[]};const r=s.slot,l=Lo(r),u=a.loadout.find(R=>R.slot===r)??null,f=Math.max(1,Math.round(n.item.quantity)),h=Math.max(1,Math.floor(s.maxStacks??l.maxStacks)),m=(u?.quantity??0)+f,p=m>h;if(u&&u.id!==n.item.id)return{slot:r,canEquip:!1,reason:"slot-occupied",equipped:Mc(u),projected:Wf(n.item),stats:[]};if(p&&(!u||u.id!==n.item.id))return{slot:r,canEquip:!1,reason:"stack-limit",equipped:Mc(u),projected:Wf(n.item,Math.min(h,m)),stats:[]};const g=Math.min(h,m),b=[];for(const R of a.loadout)R.slot!==r&&b.push({...R});const v=u&&u.id===n.item.id?{...u,quantity:g}:jA(n.item,r,h,s.modifiers,g);b.push(v);const E=a.currentStats??Hc(a.baseStats,a.loadout),M=Hc(a.baseStats,b),C=BA.map(R=>{const N=E2(E,R),q=E2(M,R);return{stat:R,current:N,projected:q,delta:q-N}});return{slot:r,canEquip:!0,equipped:Mc(u),projected:Mc(v),stats:C}}function M2(n,a){return n.map((s,r)=>({item:s,index:r,location:a,metadata:IA(s)}))}function FA(n,a){const s=new Map,r=new Map,l=new Map;for(const m of n){const{metadata:p}=m;if(p.slot){const E=p.slot,M=s.get(E);M?M.count+=1:s.set(E,{label:p.slotLabel,count:1})}const g=p.rarity,b=g.charAt(0).toUpperCase()+g.slice(1),v=r.get(g);v?v.count+=1:r.set(g,{label:b,count:1,rank:p.rarityRank});for(const E of p.tags){const M=Ra(E);if(!M)continue;const C=E.split(/[-_]/g).map(N=>N.charAt(0).toUpperCase()+N.slice(1)).join(" "),R=l.get(M);R?R.count+=1:l.set(M,{label:C,count:1})}}const u=Array.from(s.entries()).sort((m,p)=>{const g=Ws.indexOf(m[0]),b=Ws.indexOf(p[0]);return g-b}).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.slots.has(Ra(m))})),f=Array.from(r.entries()).sort((m,p)=>(p[1].rank??0)-(m[1].rank??0)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.rarities.has(Ra(m))})),h=Array.from(l.entries()).sort((m,p)=>m[1].label.localeCompare(p[1].label)).map(([m,p])=>({id:m,label:p.label,count:p.count,active:a.tags.has(Ra(m))}));return{slots:u,rarities:f,tags:h}}function YA(n,a){if(a.slots.size>0){const s=n.metadata.slot?Ra(n.metadata.slot):"";if(!s||!a.slots.has(s))return!1}return!(a.rarities.size>0&&!a.rarities.has(n.metadata.rarity)||a.tags.size>0&&!n.metadata.tags.map(l=>Ra(l)).some(l=>a.tags.has(l)))}function $A(n,a){return a?[n.item.name,n.item.description??"",n.metadata.tags.join(" ")].join(" ").toLowerCase().includes(a):!0}function VA(n,a){switch(a){case"oldest":n.sort((s,r)=>s.metadata.acquiredAt-r.metadata.acquiredAt);break;case"rarity":n.sort((s,r)=>r.metadata.rarityRank!==s.metadata.rarityRank?r.metadata.rarityRank-s.metadata.rarityRank:r.metadata.acquiredAt-s.metadata.acquiredAt);break;case"name":n.sort((s,r)=>s.item.name.localeCompare(r.item.name));break;case"newest":default:n.sort((s,r)=>r.metadata.acquiredAt-s.metadata.acquiredAt);break}}function x2(n){const a={slots:Jf(n.filters.slots??new Set),rarities:Jf(n.filters.rarities??new Set),tags:Jf(n.filters.tags??new Set)},s=Ra(n.search),r=Math.max(1,Math.floor(n.page||1)),l=Math.max(1,Math.floor(n.pageSize||24)),u=n.collection??"stash",f=M2(n.stash,"stash"),h=M2(n.inventory,"inventory"),m=[...f,...h],p=FA(m,a),g=u==="stash"?f:h,v=[...g.filter(I=>YA(I,a)&&$A(I,s))];VA(v,n.sort??"newest");const E=Math.min(v.length,r*l),M=v.slice(0,E),C=v.length>E,R=n.comparisonContext??null,N=M.map(I=>({item:I.item,index:I.index,location:I.location,metadata:I.metadata,comparison:R?GA(I,R):null})),q=["stash","inventory"].map(I=>({id:I,label:OA[I],count:I==="stash"?n.stash.length:n.inventory.length,active:I===u}));return{collection:u,collections:q,filters:p,items:N,total:g.length,filteredTotal:v.length,search:n.search,sort:n.sort??"newest",hasMore:C,emptyMessage:qA[u]}}function XA(){return{slots:new Set,rarities:new Set,tags:new Set}}const KA="_panel_7op0d_1",QA="_header_7op0d_32",PA="_title_7op0d_42",ZA="_meta_7op0d_49",JA="_close_7op0d_54",WA="_controls_7op0d_74",e5="_settings_7op0d_82",t5="_settingRow_7op0d_93",n5="_settingCopy_7op0d_107",a5="_settingLabel_7op0d_114",i5="_settingHint_7op0d_120",s5="_settingControl_7op0d_127",r5="_settingState_7op0d_133",o5="_settingInput_7op0d_143",l5="_settingSwitch_7op0d_149",c5="_settingTrack_7op0d_169",u5="_settingThumb_7op0d_181",d5="_collections_7op0d_197",f5="_collectionButton_7op0d_205",h5="_searchRow_7op0d_234",m5="_search_7op0d_234",p5="_searchIcon_7op0d_266",g5="_sortSelect_7op0d_276",y5="_body_7op0d_286",b5="_grid_7op0d_292",v5="_empty_7op0d_301",S5="_footer_7op0d_312",E5="_loadMore_7op0d_317",Oe={panel:KA,header:QA,title:PA,meta:ZA,close:JA,controls:WA,settings:e5,settingRow:t5,settingCopy:n5,settingLabel:a5,settingHint:i5,settingControl:s5,settingState:r5,settingInput:o5,settingSwitch:l5,settingTrack:c5,settingThumb:u5,collections:d5,collectionButton:f5,searchRow:h5,search:m5,searchIcon:p5,sortSelect:g5,body:y5,grid:b5,empty:v5,footer:S5,loadMore:E5},M5="_group_18afl_1",x5="_label_18afl_11",w5="_row_18afl_19",A5="_chip_18afl_25",C5="_count_18afl_55",xo={group:M5,label:x5,row:w5,chip:A5,count:C5},T5="_card_1o0cv_1",_5="_header_1o0cv_26",R5="_icon_1o0cv_32",N5="_details_1o0cv_44",k5="_titleRow_1o0cv_51",D5="_title_1o0cv_51",L5="_rarity_1o0cv_63",U5="_slot_1o0cv_70",O5="_tags_1o0cv_75",q5="_tag_1o0cv_75",z5="_compare_1o0cv_91",B5="_tooltip_1o0cv_113",H5="_statList_1o0cv_144",I5="_stat_1o0cv_144",j5="_actions_1o0cv_169",G5="_action_1o0cv_169",F5="_primary_1o0cv_198",Y5="_danger_1o0cv_209",$5="_badge_1o0cv_224",ot={card:T5,header:_5,icon:R5,details:N5,titleRow:k5,title:D5,rarity:L5,slot:U5,tags:O5,tag:q5,compare:z5,tooltip:B5,statList:H5,stat:I5,actions:j5,action:G5,primary:F5,danger:Y5,badge:$5},V5={health:"HP",attackDamage:"ATK",attackRange:"Range",movementRange:"Move",defense:"Defense",shield:"Shield"},w2={"slot-occupied":"Slot occupied. Unequip the current item first.","stack-limit":"Stack limit reached for this item.","unknown-item":"This item cannot be equipped yet."},Rc=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function X5(n,a){if(a.item.icon){const r=document.createElement("img");r.src=a.item.icon,r.alt="",r.loading="lazy",r.decoding="async",r.width=48,r.height=48,n.appendChild(r);return}const s=document.createElement("span");s.textContent=a.item.name.trim()[0]?.toUpperCase()??"?",n.appendChild(s)}function ev(n){if(!(!n||n.canEquip))return n.reason&&w2[n.reason]?w2[n.reason]:"Unable to equip this item right now."}function K5(n,a){const s=document.createElement("div");s.className=ot.tooltip;const r=document.createElement("h4");if(a.projected?r.textContent=a.canEquip?"Projected stats":"Current loadout":r.textContent="Stats",s.appendChild(r),!a.canEquip){const u=ev(a);if(u){const f=document.createElement("p");f.textContent=u,f.style.margin="0 0 0.5rem",f.style.fontSize="0.78rem",s.appendChild(f)}}const l=document.createElement("ul");l.className=ot.statList;for(const u of n){const f=document.createElement("li");f.className=ot.stat,u.delta>0?f.dataset.delta="positive":u.delta<0&&(f.dataset.delta="negative");const h=document.createElement("span");h.textContent=V5[u.stat]??u.stat;const m=document.createElement("span"),p=Rc.format(u.current),g=Rc.format(u.projected),b=u.delta,v=b===0?"±0":`${b>0?"+":"−"}${Rc.format(Math.abs(b))}`;m.textContent=`${p} → ${g} (${v})`,f.append(h,m),l.appendChild(f)}return s.appendChild(l),s}function Q5(n){const a=n.comparison;if(!a)return null;const s=document.createElement("div"),r=document.createElement("button");r.type="button",r.className=ot.compare,r.textContent=a.canEquip?"Compare stats":"View details";const l=`${n.item.id}-compare-${n.location}-${n.index}`;r.setAttribute("aria-controls",l),r.setAttribute("aria-expanded","false"),r.setAttribute("aria-describedby",l),r.addEventListener("focus",()=>{r.setAttribute("aria-expanded","true")}),r.addEventListener("blur",()=>{r.setAttribute("aria-expanded","false")}),s.appendChild(r);const u=K5(a.stats,a);return u.id=l,s.appendChild(u),s}function P5(n,a){if(a&&!a.canEquip){n.disabled=!0;const s=ev(a);s&&(n.title=s)}}function Z5(n){return n.map(a=>{const s=a.trim();return s&&s.split(/[-_\s]/g).map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")})}function J5(n,a,s){const r=document.createElement("div");r.className=ot.actions;const l=document.createElement("button");l.type="button",l.className=`${ot.action} ${ot.primary}`,l.textContent="Equip",P5(l,a.comparison),l.addEventListener("click",()=>{s.onEquip?.()}),r.appendChild(l);const u=document.createElement("button");u.type="button",u.className=ot.action,u.textContent=a.location==="stash"?"Send to inventory":"Return to stash",u.addEventListener("click",()=>{s.onTransfer?.()}),r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=`${ot.action} ${ot.danger}`,f.textContent="Trash";let h=null;const m=()=>{h!==null&&(window.clearTimeout(h),h=null),f.dataset.confirm="false",f.textContent="Trash"};f.addEventListener("click",()=>{if(h!==null){m(),s.onTrash?.();return}f.dataset.confirm="true",f.textContent="Confirm trash",h=window.setTimeout(()=>{m()},2600)}),r.appendChild(f),n.appendChild(r)}function W5(n,a){const s=document.createElement("li");s.className=ot.card,s.dataset.location=n.location,s.setAttribute("role","listitem");const r=document.createElement("div");r.className=ot.header;const l=document.createElement("div");l.className=ot.icon,X5(l,n),r.appendChild(l);const u=document.createElement("div");u.className=ot.details;const f=document.createElement("div");f.className=ot.titleRow;const h=document.createElement("h4");h.className=ot.title,h.textContent=n.item.name,f.appendChild(h);const m=document.createElement("span");m.className=ot.rarity,m.textContent=n.metadata.rarity.toUpperCase(),f.appendChild(m),u.appendChild(f);const p=document.createElement("span");if(p.className=ot.slot,p.textContent=n.metadata.slot?n.metadata.slotLabel:"No slot",u.appendChild(p),n.metadata.tags.length>0){const b=document.createElement("div");b.className=ot.tags;for(const v of Z5(n.metadata.tags)){const E=document.createElement("span");E.className=ot.tag,E.textContent=v,b.appendChild(E)}u.appendChild(b)}const g=Q5(n);if(g&&u.appendChild(g),r.appendChild(u),s.appendChild(r),n.item.quantity>1){const b=document.createElement("span");b.className=ot.badge,b.textContent=`×${Rc.format(n.item.quantity)}`,s.appendChild(b)}return J5(s,n,a),s}const eC={newest:"Newest",oldest:"Oldest",rarity:"Rarity",name:"Name A-Z"};function eh(n){const a=document.createElement("div");a.className=xo.row;const s=document.createElement("div");s.className=xo.label,s.textContent=n;const r=document.createElement("div");return r.className=xo.group,a.append(s,r),{row:a,group:r}}function tC(n){const a=document.createElement("section");a.className=Oe.panel,a.tabIndex=-1,a.dataset.open="false",a.setAttribute("aria-label","Quartermaster stash");const s=document.createElement("header");s.className=Oe.header;const r=document.createElement("div"),l=document.createElement("h2");l.className=Oe.title,l.textContent="Quartermaster Stash",r.appendChild(l);const u=document.createElement("div");u.className=Oe.meta,u.textContent="Loading…",r.appendChild(u);const f=document.createElement("button");f.type="button",f.className=Oe.close,f.textContent="Close",f.addEventListener("click",()=>n.onClose?.()),s.append(r,f),a.appendChild(s);const h=document.createElement("div");h.className=Oe.controls;const m=document.createElement("div");m.className=Oe.collections;const p={stash:document.createElement("button"),inventory:document.createElement("button")};p.stash.type="button",p.stash.className=Oe.collectionButton,p.stash.textContent="Stash",p.stash.addEventListener("click",()=>n.onCollectionChange?.("stash")),p.inventory.type="button",p.inventory.className=Oe.collectionButton,p.inventory.textContent="Ready",p.inventory.addEventListener("click",()=>n.onCollectionChange?.("inventory")),m.append(p.stash,p.inventory),h.appendChild(m);const g=document.createElement("div");g.className=Oe.searchRow;const b=document.createElement("div");b.className=Oe.search;const v=document.createElement("input");v.type="search",v.placeholder="Search stash…",v.addEventListener("input",()=>n.onSearchChange?.(v.value));const E=document.createElement("span");E.className=Oe.searchIcon,E.textContent="🔍",b.append(E,v),g.appendChild(b);const M=document.createElement("select");M.className=Oe.sortSelect,["newest","oldest","rarity","name"].forEach(A=>{const F=document.createElement("option");F.value=A,F.textContent=eC[A],M.appendChild(F)}),M.addEventListener("change",()=>n.onSortChange?.(M.value)),g.appendChild(M),h.appendChild(g);const C=document.createElement("div");C.className=Oe.settings;const R=(A,F,B,D)=>{const V=document.createElement("div");V.className=Oe.settingRow;const te=document.createElement("div");te.className=Oe.settingCopy;const he=document.createElement("span");he.className=Oe.settingLabel,he.textContent=F,te.appendChild(he);const w=document.createElement("p");w.className=Oe.settingHint,w.textContent=B,te.appendChild(w);const $=document.createElement("div");$.className=Oe.settingControl;const W=document.createElement("span");W.className=Oe.settingState,W.textContent="Off";const ae=document.createElement("input");ae.type="checkbox",ae.id=A,ae.className=Oe.settingInput;const le=document.createElement("label");le.className=Oe.settingSwitch,le.htmlFor=A,le.dataset.state="off";const ge=document.createElement("span");ge.className=Oe.settingTrack;const de=document.createElement("span");de.className=Oe.settingThumb,le.append(ge,de);const Te=xe=>{ae.checked=xe,le.dataset.state=xe?"on":"off",W.textContent=xe?"On":"Off"};return ae.addEventListener("change",()=>{Te(ae.checked),D?.(ae.checked)}),$.append(W,ae,le),V.append(te,$),{root:V,setChecked:Te}},N=R("inventory-autoequip-toggle","Auto-equip loot","Try outfitting the selected attendant as soon as new gear arrives.",A=>n.onAutoEquipChange?.(A)),q=R("inventory-ui-variant-toggle","Experimental HUD","Swap to the React/Tailwind HUD. You can revert at any time.",A=>n.onUiV2Change?.(A));N.setChecked(n.getAutoEquipState?.()??!1),q.setChecked(n.getUiV2State?.()??!1),C.append(N.root,q.root),h.appendChild(C);const I=document.createElement("div"),Y={slots:eh("Slots"),rarities:eh("Rarity"),tags:eh("Tags")};I.append(Y.slots.row,Y.rarities.row,Y.tags.row),h.appendChild(I),a.appendChild(h);const Q=document.createElement("div");Q.className=Oe.body;const ie=document.createElement("ul");ie.className=Oe.grid;const ee=document.createElement("div");ee.className=Oe.empty,ee.textContent="No items match the current filters.",ee.hidden=!0,Q.append(ie,ee),a.appendChild(Q);const oe=document.createElement("div");oe.className=Oe.footer;const P=document.createElement("button");P.type="button",P.className=Oe.loadMore,P.textContent="Show more",P.addEventListener("click",()=>n.onLoadMore?.()),oe.appendChild(P),a.appendChild(oe);function G(A,F,B){A.group.innerHTML="",A.row.hidden=B.length===0;for(const D of B){const V=document.createElement("button");if(V.type="button",V.className=xo.chip,V.dataset.active=D.active?"true":"false",V.textContent=D.label,D.count>0){const te=document.createElement("span");te.className=xo.count,te.textContent=String(D.count),V.appendChild(te)}V.addEventListener("click",()=>n.onFilterToggle?.(F,D.id)),A.group.appendChild(V)}}function T(A){ie.replaceChildren();const F=document.createDocumentFragment();for(const B of A.items){const D={onEquip:()=>n.onItemEquip?.(B),onTransfer:()=>n.onItemTransfer?.(B),onTrash:()=>n.onItemTrash?.(B)};F.appendChild(W5(B,D))}ie.appendChild(F),ee.hidden=A.filteredTotal!==0,ee.hidden||(ee.textContent=A.emptyMessage)}return{element:a,render(A){u.textContent=A.total===0?"No items yet":`${A.filteredTotal} of ${A.total} item${A.total===1?"":"s"}`;for(const[F,B]of Object.entries(p))B.dataset.active=F===A.collection?"true":"false";v.value!==A.search&&(v.value=A.search),M.value!==A.sort&&(M.value=A.sort),G(Y.slots,"slots",A.filters.slots),G(Y.rarities,"rarities",A.filters.rarities),G(Y.tags,"tags",A.filters.tags),T(A),P.hidden=!A.hasMore},setOpen(A){a.dataset.open=A?"true":"false"},focus(){const A=a.focus.bind(a);try{A({preventScroll:!0})}catch(F){console.warn("Stash panel focus without scroll prevention fallback",F);try{A()}catch(B){console.warn("Unable to focus stash panel element",B)}}},destroy(){a.remove()},setAutoEquip(A){N.setChecked(A)},setUiV2(A){q.setChecked(A)}}}const th=24,nC=4500,aC=400,iC={health:"HP",attackDamage:"ATK",attackRange:"RNG",movementRange:"MOV",defense:"DEF",shield:"Shield"},A2="pointer-events-none ml-auto flex w-full max-w-[min(22rem,90vw)] flex-col gap-[clamp(6px,1vw,12px)]",sC="pointer-events-auto flex w-full items-center gap-[clamp(4px,0.8vw,12px)] rounded-hud-md border border-white/15 px-4 py-3 text-[0.9rem] font-semibold leading-[1.35] shadow-[0_18px_32px_rgba(15,23,42,0.22)] backdrop-blur-[14px] backdrop-saturate-[135%] transition-all duration-300 ease-out",rC={loot:"bg-[linear-gradient(135deg,rgba(255,255,255,0.95),rgba(215,229,255,0.95))] text-slate-900",info:"bg-[linear-gradient(135deg,rgba(219,245,255,0.95),rgba(197,228,255,0.95))] text-slate-900",warn:"bg-[linear-gradient(135deg,rgba(255,231,217,0.95),rgba(255,214,196,0.95))] text-amber-900"},oC=["-translate-y-2","opacity-0"];function Pc(n){n.hidden=n.childElementCount===0}function lC(n,a){const s=n.querySelector('[data-ui="loot-toast-stack"]');if(s)return s.parentElement!==a&&a.appendChild(s),s.className=A2,s.style.zIndex=String(b2.toast),Pc(s),s;const l=(n.ownerDocument??document).createElement("div");return l.dataset.ui="loot-toast-stack",l.className=A2,l.setAttribute("aria-live","polite"),l.setAttribute("role","status"),l.style.zIndex=String(b2.toast),Pc(l),a.appendChild(l),l}function $t(n,a,s){const r=(n.ownerDocument??document).createElement("div");r.dataset.variant=s,r.className=`${sC} ${rC[s]}`,r.textContent=a,n.appendChild(r),Pc(n);const l=()=>{r.remove(),Pc(n)},u=window.setTimeout(()=>{r.classList.add(...oC),window.setTimeout(l,aC)},nC);r.addEventListener("click",()=>{window.clearTimeout(u),l()})}function cC(n,a){n.has(a)?n.delete(a):n.add(a)}function uC(n){const a=n.comparison?.deltas??[];return a.length===0?null:a.map(r=>{const l=iC[r.stat]??r.stat;return`${r.delta>0?"+":""}${r.delta} ${l}`}).join(", ")}function nh(n){switch(n){case"inventory":return"ready inventory";case"stash":return"stash";case"equipped":default:return"loadout"}}function dC(){const n=document.createElement("button");n.type="button",n.dataset.testid="inventory-badge",n.dataset.ui="inventory-badge",n.className="group inline-flex items-center gap-2 rounded-hud-pill border border-white/15 bg-[linear-gradient(135deg,rgba(27,36,56,0.9),rgba(39,74,110,0.9))] px-3.5 py-2 font-semibold text-sky-50 shadow-hud-sm transition-all duration-150 ease-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent hover:-translate-y-0.5 hover:shadow-hud-md data-[autoequip=off]:bg-[linear-gradient(135deg,rgba(56,44,25,0.9),rgba(92,72,40,0.9))]",n.setAttribute("aria-expanded","false"),n.setAttribute("aria-controls","inventory-stash-panel"),n.setAttribute("aria-label","Open quartermaster stash");const a=document.createElement("span");a.className="relative flex h-[1.65rem] w-[1.65rem] flex-shrink-0 items-center justify-center rounded-full bg-[radial-gradient(circle_at_30%_30%,rgba(255,255,255,0.9),rgba(225,235,255,0.2))] text-slate-900 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.35)]",a.setAttribute("aria-hidden","true");const s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg");r.setAttribute("viewBox","0 0 24 24"),r.setAttribute("aria-hidden","true"),r.setAttribute("focusable","false"),r.setAttribute("class","h-[76%] w-[76%]");const l=document.createElementNS(s,"path");l.setAttribute("d","M8.25 7V6a3.75 3.75 0 0 1 7.5 0v1m3 0h-14.25a1.5 1.5 0 0 0-1.485 1.342l-.75 9a3 3 0 0 0 2.985 3.158h9.78a3 3 0 0 0 2.985-3.158l-.75-9A1.5 1.5 0 0 0 18.75 7Z"),l.setAttribute("fill","rgba(194, 216, 255, 0.32)"),l.setAttribute("stroke","rgba(255, 255, 255, 0.92)"),l.setAttribute("stroke-width","1.6"),l.setAttribute("stroke-linecap","round"),l.setAttribute("stroke-linejoin","round");const u=document.createElementNS(s,"path");u.setAttribute("d","M9.75 12.25h4.5"),u.setAttribute("fill","none"),u.setAttribute("stroke","rgba(255, 255, 255, 0.85)"),u.setAttribute("stroke-width","1.4"),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("opacity","0.9"),r.append(l,u),a.appendChild(r),n.appendChild(a);const f=document.createElement("span");f.className="text-[0.75rem] uppercase tracking-[0.08em]",f.textContent="Stash",n.appendChild(f);const h=document.createElement("span");return h.className="min-w-[1.5rem] rounded-full bg-white/15 px-2 py-[0.1rem] text-center text-xs font-semibold text-white/90",h.textContent="0",h.setAttribute("aria-hidden","true"),n.appendChild(h),{button:n,count:h}}function fC(n,a={}){const s=document.getElementById("ui-overlay");if(!s)return{destroy:()=>{}};const{regions:r}=ar(s),l=r.top,u=lC(s,l);s.querySelectorAll('[data-testid="inventory-badge"]').forEach(k=>k.remove());const{button:f,count:h}=dC();f.dataset.autoequip=n.isAutoEquipEnabled()?"on":"off",l.appendChild(f),s.querySelector("#inventory-stash-panel")?.remove();const p=tC({onClose:()=>R(!1),onCollectionChange:k=>{b!==k&&(b=k,C=1,q())},onFilterToggle:(k,A)=>{const F=v[k];cC(F,A),C=1,q()},onSearchChange:k=>{E=k,C=1,q()},onSortChange:k=>{M=k,C=1,q()},onLoadMore:()=>{C+=1,q()},onItemEquip:k=>{Y(k)},onItemTransfer:k=>{Q(k)},onItemTrash:k=>{ie(k)},getAutoEquipState:()=>n.isAutoEquipEnabled(),onAutoEquipChange:k=>{n.setAutoEquip(k),f.dataset.autoequip=k?"on":"off",$t(u,k?"Auto-equip enabled. Newly recovered gear will try to arm your selected attendant.":"Auto-equip disabled. Loot will head to the stash until you equip it manually.","info")},getUiV2State:()=>a.getUseUiV2?.()??!1,onUiV2Change:k=>{a.onUseUiV2Change?.(k),$t(u,k?"Experimental HUD enabled. Reload to try the React/Tailwind experience.":"Classic HUD restored for your next session.","info")}});p.element.id="inventory-stash-panel",s.appendChild(p.element);let g=!1,b="stash";const v=XA();let E="",M="newest",C=1;function R(k){if(g!==k)if(g=k,p.setOpen(g),f.setAttribute("aria-expanded",g?"true":"false"),f.setAttribute("aria-label",g?"Close quartermaster stash":"Open quartermaster stash"),g){s.classList.add("inventory-panel-open");try{p.focus()}catch(A){console.warn("Unable to focus stash panel",A)}}else s.classList.remove("inventory-panel-open")}function N(){const k=a.getComparisonContext?.()??null;let A=x2({stash:n.getStash(),inventory:n.getInventory(),filters:v,search:E,sort:M,page:C,pageSize:th,collection:b,comparisonContext:k});if(A.filteredTotal>0){const F=Math.max(1,Math.ceil(A.filteredTotal/th));C>F&&(C=F,A=x2({stash:n.getStash(),inventory:n.getInventory(),filters:v,search:E,sort:M,page:C,pageSize:th,collection:b,comparisonContext:k}))}return A}function q(){const k=N(),F=k.collections.find(B=>B.id==="stash")?.count??0;h.textContent=String(F),f.dataset.count=String(F),p.render(k)}function I(){const k=a.getSelectedUnitId?.()??null;return k||($t(u,"Select an attendant before equipping an item.","warn"),null)}function Y(k){const A=I();if(!A)return;const F=a.onEquip??(()=>({success:!1}));(k.location==="stash"?n.equipFromStash(k.index,A,(V,te)=>F(V,te,"stash")):n.equipFromInventory(k.index,A,(V,te)=>F(V,te,"inventory")))||$t(u,"Unable to equip that item right now.","warn")}function Q(k){const A=k.location==="stash"?n.moveToInventory(k.index):n.moveToStash(k.index);if(!A){$t(u,"Unable to move that item right now.","warn");return}const F=k.location==="stash"?"ready inventory":"stash";$t(u,`Moved ${A.name} to the ${F}.`,"info"),C=1,q()}function ie(k){const A=k.location==="stash"?n.discardFromStash(k.index):n.discardFromInventory(k.index);if(!A){$t(u,"That item was already removed.","warn");return}const F=k.location==="stash"?"stash":"ready inventory";$t(u,`${A.name} discarded from the ${F}.`,"warn"),q()}function ee(k){switch(k.type){case"stash-updated":case"inventory-updated":q();break;case"item-acquired":if(k.equipped)$t(u,`${k.item.name} auto-equipped successfully.`,"info");else{const A=nh(k.location);$t(u,`New item secured: ${k.item.name} (${A}).`,"loot")}break;case"item-equipped":{const A=uC(k),F=A?` (${A})`:"";$t(u,`Equipped ${k.item.name}${F}.`,"info");break}case"item-unequipped":$t(u,`${k.item.name} returned to the stash from slot ${k.slot}.`,"info");break;case"item-moved":{const A=nh(k.to);$t(u,`Moved ${k.item.name} to the ${A}.`,"info");break}case"item-discarded":{const A=nh(k.location);$t(u,`${k.item.name} discarded from the ${A}.`,"warn");break}case"settings-updated":f.dataset.autoequip=k.autoEquip?"on":"off",p.setAutoEquip(k.autoEquip);break}}const oe=n.on(k=>ee(k)),P=()=>{R(!g)};f.addEventListener("click",P);const G=k=>{k.defaultPrevented||k.code==="KeyI"&&!k.metaKey&&!k.ctrlKey&&!k.altKey&&(k.preventDefault(),R(!g))};return window.addEventListener("keydown",G),q(),{destroy:()=>{oe(),f.removeEventListener("click",P),window.removeEventListener("keydown",G),f.remove(),p.destroy(),s.classList.remove("inventory-panel-open"),u.hasChildNodes()||u.remove()}}}const hC=Object.freeze({common:1,uncommon:.6,rare:.35,epic:.18,legendary:.08,mythic:.03}),mC=Object.freeze({id:"general-salvage",label:"General Salvage",entries:Object.freeze([{id:"birch-sap-satchel",name:"Birch Sap Satchel",description:"Soothing birch sap that doubles as a brisk field tonic.",rarity:"common",quantity:{min:1,max:3},weight:6},{id:"steamed-bandages",name:"Steamed Linen Bandages",description:"Freshly steamed bandages infused with pine oils.",rarity:"common",quantity:1,weight:5},{id:"emberglass-shard",name:"Emberglass Shard",description:"A radiant shard used to kindle sauna braziers.",rarity:"uncommon",quantity:1,weight:3},{id:"aurora-distillate",name:"Aurora Distillate",description:"Vials of shimmering condensation that empower sauna rituals.",rarity:"rare",quantity:1,weight:1.5},{id:"myrsky-charm",name:"Myrsky Charm",description:"Storm-forged charm rumored to call down aurora flares.",rarity:"epic",quantity:1,weight:.7}])}),pC=Object.freeze({base:Object.freeze({id:"enemy-raiders",label:"Avanto Marauder Spoils",entries:Object.freeze([{id:"cracked-ice-amulet",name:"Cracked Ice Amulet",description:"Necklace of frostbitten charms that hum when danger nears.",rarity:"common",quantity:1,weight:5},{id:"stolen-sauna-tokens",name:"Stolen Sauna Tokens",description:"Pilfered entrance tokens, gladly accepted back at any sauna hall.",rarity:"uncommon",quantity:{min:2,max:5},weight:3},{id:"glacier-brand",name:"Glacier Brand",description:"A cleaver chilled in glacial meltwater that never dulls.",rarity:"rare",quantity:1,weight:1.25}])}),elite:Object.freeze({id:"enemy-champions",label:"Avanto Champion Cache",entries:Object.freeze([{id:"frostwyrm-signet",name:"Frostwyrm Signet",description:"An icy signet ring that wreathes its bearer in frozen vapour.",rarity:"epic",quantity:1,weight:1.1},{id:"aurora-lattice",name:"Aurora Lattice",description:"Filigree latticework that channels auroral light into focused beams.",rarity:"legendary",quantity:1,weight:.4},{id:"midnight-bloodwine",name:"Midnight Bloodwine",description:"A mythical draught said to rekindle a warrior's lost resolve.",rarity:"mythic",quantity:1,weight:.12}])})}),gC=Object.freeze({base:Object.freeze({id:"deepwood-offerings",label:"Deepwood Offerings",entries:Object.freeze([{id:"spirit-oak-charm",name:"Spirit Oak Charm",description:"Carved from living oak, it whispers guidance between sauna rounds.",rarity:"uncommon",quantity:1,weight:4},{id:"sauna-incense",name:"Sauna Incense Pouches",description:"Fragrant blends that steady breathing before the next engagement.",rarity:"common",quantity:{min:1,max:4},weight:5},{id:"emberglass-arrow",name:"Emberglass Arrow Bundle",description:"Arrowheads that glow amber when a perfect shot reveals itself.",rarity:"rare",quantity:{min:1,max:2},weight:1.75}])}),elite:Object.freeze({id:"deepwood-ritual-cache",label:"Deepwood Ritual Cache",entries:Object.freeze([{id:"windstep-totem",name:"Windstep Totem",description:"Totem etched with gale sigils that lighten every cautious stride.",rarity:"epic",quantity:1,weight:.9},{id:"searing-chant-censer",name:"Searing Chant Censer",description:"An ornate censer that empowers allies with smouldering hymns.",rarity:"legendary",quantity:1,weight:.35}])})}),yC=Object.freeze({enemy:pC,deepwood:gC});function bC(n){return yC[n]??{base:mC}}function vC(n,a=!1){const s=bC(n);return a&&s.elite?s.elite:s.base}function SC(n){if(!Number.isFinite(n))return 1;const a=Math.floor(n);return a<=0?0:Math.min(10,a)}function EC(n,a){if(typeof n=="number"&&Number.isFinite(n))return Math.max(1,Math.round(n));if(!n)return 1;const s=n,r=Math.max(1,Math.round(s.min)),u=Math.max(r,Math.round(s.max))-r+1,f=Math.floor(Math.max(0,Math.min(.999999,a()))*u);return r+f}function MC(n){const a=hC[n.rarity]??1,s=typeof n.weight=="number"?n.weight:1;return Math.max(0,s)*Math.max(0,a)}function xC(n,a){const s=n.map(f=>({entry:f,weight:MC(f)})).filter(f=>f.weight>0);if(s.length===0)return null;const r=s.reduce((f,h)=>f+h.weight,0),l=Math.max(0,Math.min(.999999,a()))*r;let u=0;for(const f of s)if(u+=f.weight,l<u)return f.entry;return s[s.length-1]?.entry??null}function wC(n,a){return{id:n.id,name:n.name,description:n.description,icon:n.icon,rarity:n.rarity,quantity:a}}function AC(n){const a=typeof n.random=="function"?n.random:Math.random,s=!!n.elite,r=n.table??vC(n.factionId,s),l=SC(n.rolls),u=[];if(l<=0||r.entries.length===0)return{factionId:n.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u};for(let f=0;f<l;f+=1){const h=xC(r.entries,a);if(!h)break;const m=EC(h.quantity,a);u.push({entryId:h.id,rarity:h.rarity,quantity:m,item:wC(h,m)})}return{factionId:n.factionId,elite:s,tableId:r.id,tableLabel:r.label,rolls:u}}const CC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23a4d67a'%20/%3e%3cpolygon%20points='16,48%2032,16%2048,48'%20fill='%23d2691e'%20/%3e%3crect%20x='24'%20y='32'%20width='16'%20height='16'%20fill='%23f4a460'%20/%3e%3c/svg%3e",TC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23c0c0c0'%20/%3e%3crect%20x='8'%20y='24'%20width='48'%20height='24'%20fill='%23808080'%20/%3e%3crect%20x='24'%20y='16'%20width='16'%20height='8'%20fill='%23606060'%20/%3e%3c/svg%3e",_C="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23e0e0e0'%20/%3e%3crect%20x='10'%20y='22'%20width='12'%20height='30'%20fill='%23a9a9a9'%20/%3e%3crect%20x='26'%20y='14'%20width='12'%20height='38'%20fill='%23808080'%20/%3e%3crect%20x='42'%20y='26'%20width='12'%20height='26'%20fill='%23a9a9a9'%20/%3e%3c/svg%3e",RC="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%238b4513'%20/%3e%3cpolygon%20points='32,10%2042,22%2022,22'%20fill='%23555'%20/%3e%3crect%20x='30'%20y='22'%20width='4'%20height='32'%20fill='%23ccc'%20/%3e%3c/svg%3e",NC="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eAuric%20Warder%3c/title%3e%3cdesc%20id='desc'%3eRunic%20soldier%20with%20aurora-lit%20shield,%20sculpted%20armor,%20and%20crystalline%20broadsword.%3c/desc%3e%3cdefs%3e%3clinearGradient%20id='soldier-panel'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23091522'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23102a46'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-halo'%20cx='52%25'%20cy='18%25'%20r='68%25'%3e%3cstop%20offset='0%25'%20stop-color='rgba(186,%20230,%20253,%200.92)'%20/%3e%3cstop%20offset='45%25'%20stop-color='rgba(59,%20130,%20246,%200.42)'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(15,%2023,%2042,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-armor'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='55%25'%20stop-color='%23cbd5f5'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23475569'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-gold'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20/%3e%3cstop%20offset='45%25'%20stop-color='%23fbbf24'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f97316'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-cloak'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%231d4ed8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-shield'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23bfdbfe'%20/%3e%3cstop%20offset='65%25'%20stop-color='%2360a5fa'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231d4ed8'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-shield-core'%20cx='40%25'%20cy='40%25'%20r='45%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fef3c7'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(248,%20250,%20252,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-sword'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231f2937'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='128'%20height='128'%20rx='18'%20fill='url(%23soldier-panel)'%20/%3e%3ccircle%20cx='64'%20cy='40'%20r='46'%20fill='url(%23soldier-halo)'%20/%3e%3cellipse%20cx='64'%20cy='110'%20rx='34'%20ry='11'%20fill='%230f172a'%20opacity='0.45'%20/%3e%3cpath%20d='M34%2038c-8%2015-11%2034-6%2052l18%2010c-2-22%206-40%2020-50-12-4-22-8-32-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.88'%20/%3e%3cpath%20d='M94%2038c8%2015%2011%2034%206%2052l-18%2010c2-22-6-40-20-50%2012-4%2022-8%2032-12z'%20fill='url(%23soldier-cloak)'%20opacity='0.68'%20/%3e%3cpath%20d='M58%2018l-12%2014c-5%207-8%2017-8%2028v20l14%2042h24l14-42V60c0-11-3-21-8-28L70%2018H58z'%20fill='url(%23soldier-armor)'%20stroke='%231f2937'%20stroke-width='2.4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M46%2060h36l6%2016c-10%2010-20%2016-24%2016s-14-6-24-16l6-16z'%20fill='%23e0f2fe'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2024c-7%200-14%205-20%2012l8%2010c8-6%2024-6%2032%200l8-10c-6-7-13-12-20-12z'%20fill='%23f8fafc'%20stroke='%23cbd5f5'%20stroke-width='2'%20/%3e%3cpath%20d='M56%2016h16l6%208-14%208-14-8%206-8z'%20fill='%23e2e8f0'%20stroke='%2394a3b8'%20stroke-width='1.8'%20/%3e%3cpath%20d='M52%2074h12l2%2020-10%2012-10-12%206-20z'%20fill='url(%23soldier-gold)'%20opacity='0.92'%20/%3e%3cpath%20d='M64%2096l10%2010%2010-12-6-20H66l-2%2022z'%20fill='%23fef3c7'%20opacity='0.72'%20/%3e%3cpath%20d='M32%2068l-12%206%2014%2032%2016-8-18-30z'%20fill='url(%23soldier-shield)'%20stroke='%231e3a8a'%20stroke-width='2.2'%20/%3e%3ccircle%20cx='36'%20cy='82'%20r='8'%20fill='url(%23soldier-shield-core)'%20/%3e%3cpath%20d='M96%2060l-6-6-22%2044%208%2010%2020-48z'%20fill='url(%23soldier-sword)'%20stroke='%230f172a'%20stroke-width='2.2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M86%2050l-18%2040%2012%206%2016-36-10-10z'%20fill='%23f8fafc'%20opacity='0.7'%20/%3e%3cpath%20d='M64%20102c-9%200-18%207-22%2016%208%206%2014%208%2022%208s14-2%2022-8c-4-9-13-16-22-16z'%20fill='%23dbeafe'%20stroke='%2393c5fd'%20stroke-width='1.6'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M58%2056h12l3%2010-9%206-9-6%203-10z'%20fill='%231f2937'%20opacity='0.85'%20/%3e%3ccircle%20cx='64'%20cy='58'%20r='7'%20fill='%23f1f5f9'%20stroke='%23cbd5f5'%20stroke-width='1.4'%20/%3e%3cpath%20d='M54%2044c-5%200-8%205-8%2012%206-3%2012-6%2018-6s12%203%2018%206c0-7-3-12-8-12H54z'%20fill='%230f172a'%20opacity='0.82'%20/%3e%3c/svg%3e",kC="/assets/archer-DIBoEfQj.svg",DC="/assets/avanto-marauder-B6bFdUJV.svg",fo="/",hi={saunaBeer:`${fo}assets/ui/sauna-beer.svg`,saunojaRoster:`${fo}assets/ui/saunoja-roster.svg`,resource:`${fo}assets/ui/resource.svg`,sisu:`${fo}assets/ui/resource.svg`,sound:`${fo}assets/ui/sound.svg`},LC={images:{placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=","building-farm":CC,"building-barracks":TC,"building-city":_C,"building-mine":RC,"unit-soldier":NC,"unit-archer":kC,"unit-avanto-marauder":DC,"icon-sauna-beer":hi.saunaBeer,"icon-saunoja-roster":hi.saunojaRoster,"icon-resource":hi.resource,"icon-sound":hi.sound}};let tv=null;function UC(n){tv=n}function nv(){return tv}const OC=["city"],qC=1e4,zC=12e3;function BC(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function C2(n){return Object.freeze({strongholds:{...n.strongholds},roster:{...n.roster},economy:{...n.economy},sauna:{...n.sauna},enemyKills:n.enemyKills,exploration:{...n.exploration},startedAt:n.startedAt})}function T2(n){const a={[se.SAUNA_BEER]:0,[se.SAUNAKUNNIA]:0,[se.SISU]:0};return Object.values(se).forEach(s=>{a[s]=n.getResource(s)}),a}class HC{timeSource;state;map;getRosterCount;sauna;strongholdTypes;rosterGraceMs;bankruptcyGraceMs;progress;startResources;strongholds=new Map;revealedTiles=new Set;progressListeners=new Set;resolutionListeners=new Set;mapDisposer=null;rosterTimeout=null;bankruptcyTimeout=null;bankruptSince=null;wipeSince=null;saunaDestroyedAt=null;resolution=null;disposed=!1;constructor(a){this.timeSource=typeof a.timeSource=="function"?a.timeSource:BC,this.state=a.state,this.map=a.map,this.getRosterCount=a.getRosterCount,this.sauna=a.sauna??null;const s=a.strongholdTypes?.length?a.strongholdTypes:OC;this.strongholdTypes=new Set(s),this.rosterGraceMs=Math.max(0,a.rosterWipeGraceMs??qC),this.bankruptcyGraceMs=Math.max(0,a.bankruptcyGraceMs??zC),this.startResources=T2(this.state);const r=this.state.getResource(se.SAUNA_BEER),l=Math.max(0,Math.round(this.getRosterCount()))||0;this.progress={strongholds:{total:0,destroyed:0,remaining:0},roster:{active:l,totalDeaths:0,wipeSince:null,wipeDurationMs:0},economy:{beer:r,worstBeer:r,bankruptSince:null,bankruptDurationMs:0},sauna:this.createSaunaProgress(),enemyKills:0,exploration:{revealedHexes:0},startedAt:this.timeSource()},this.bootstrapStrongholds(),this.attachMapListener(),this.attachEventListeners(),this.emitProgress(),this.evaluateResolution()}onProgress(a){this.progressListeners.add(a)}offProgress(a){this.progressListeners.delete(a)}onResolution(a){if(this.resolution){a(this.resolution);return}this.resolutionListeners.add(a)}offResolution(a){this.resolutionListeners.delete(a)}getProgress(){return C2(this.progress)}dispose(){if(!this.disposed){if(this.disposed=!0,this.clearRosterTimer(),this.clearBankruptcyTimer(),this.mapDisposer){try{this.mapDisposer()}catch(a){console.warn("Failed to detach map listener",a)}this.mapDisposer=null}ne.off("unitDied",this.handleUnitDied),ne.off("unitSpawned",this.handleUnitSpawned),ne.off("resourceChanged",this.handleResourceChanged),ne.off("saunaDamaged",this.handleSaunaDamaged),ne.off("saunaDestroyed",this.handleSaunaDestroyed)}}bootstrapStrongholds(){this.map.forEachTile((a,s)=>{if(this.captureExploration(s,a),this.isStronghold(a.building)){const r=this.coordKey(s);this.strongholds.set(r,{alive:!0})}}),this.updateStrongholdTotals()}attachMapListener(){this.mapDisposer=this.map.addTileChangeListener((a,s,r)=>{let l=!1;if((r==="fog"||r==="created")&&this.captureExploration(a,s)&&(l=!0),r==="building"||r==="created"){const u=this.coordKey(a),f=this.strongholds.get(u);this.isStronghold(s.building)?f?f.alive||(f.alive=!0):this.strongholds.set(u,{alive:!0}):f?.alive&&(f.alive=!1),this.updateStrongholdTotals(),l=!0}l&&(this.emitProgress(),this.evaluateResolution())})}captureExploration(a,s){if(s.isFogged)return!1;const r=this.coordKey(a),l=this.revealedTiles.size;return this.revealedTiles.has(r)||(this.revealedTiles.add(r),this.progress.exploration.revealedHexes=this.revealedTiles.size),this.revealedTiles.size!==l}attachEventListeners(){ne.on("unitDied",this.handleUnitDied),ne.on("unitSpawned",this.handleUnitSpawned),ne.on("resourceChanged",this.handleResourceChanged),ne.on("saunaDamaged",this.handleSaunaDamaged),ne.on("saunaDestroyed",this.handleSaunaDestroyed)}handleUnitDied=({unitFaction:a})=>{if(a==="player"){this.progress.roster.totalDeaths+=1,this.refreshRosterStatus(),this.emitProgress(),this.evaluateResolution();return}this.progress.enemyKills+=1,this.emitProgress()};handleUnitSpawned=({unit:a})=>{a.faction==="player"&&(this.refreshRosterStatus(),this.emitProgress())};handleResourceChanged=({resource:a,total:s})=>{a===se.SAUNA_BEER&&(this.progress.economy.beer=s,s<this.progress.economy.worstBeer&&(this.progress.economy.worstBeer=s),s<0?this.bankruptSince===null&&(this.bankruptSince=this.timeSource(),this.progress.economy.bankruptSince=this.bankruptSince,this.startBankruptcyTimer()):(this.updateBankruptcyDuration(),this.bankruptSince=null,this.progress.economy.bankruptSince=null,this.clearBankruptcyTimer()),this.emitProgress())};handleSaunaDamaged=({remainingHealth:a})=>{this.disposed||(this.updateSaunaSnapshot(a),this.emitProgress())};handleSaunaDestroyed=a=>{this.disposed||(this.markSaunaDestroyed(),this.emitProgress(),this.resolve("lose","saunaDestroyed"))};startBankruptcyTimer(){if(this.bankruptcyTimeout===null){if(this.bankruptcyGraceMs<=0){this.resolve("lose","bankruptcy");return}this.bankruptcyTimeout=setTimeout(()=>{this.updateBankruptcyDuration(),this.resolve("lose","bankruptcy")},this.bankruptcyGraceMs)}}clearBankruptcyTimer(){this.bankruptcyTimeout!==null&&(clearTimeout(this.bankruptcyTimeout),this.bankruptcyTimeout=null)}startRosterTimer(){if(this.rosterTimeout===null){if(this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.rosterTimeout=setTimeout(()=>{this.updateRosterDuration(),this.resolve("lose","rosterWipe")},this.rosterGraceMs)}}clearRosterTimer(){this.rosterTimeout!==null&&(clearTimeout(this.rosterTimeout),this.rosterTimeout=null)}updateStrongholdTotals(){const a=this.strongholds.size;let s=0;for(const r of this.strongholds.values())r.alive&&(s+=1);this.progress.strongholds.total=a,this.progress.strongholds.remaining=s,this.progress.strongholds.destroyed=Math.max(0,a-s)}refreshRosterStatus(){const a=Math.max(0,Math.round(this.getRosterCount()));this.progress.roster.active=a,a<=0?(this.wipeSince===null&&(this.wipeSince=this.timeSource(),this.progress.roster.wipeSince=this.wipeSince),this.startRosterTimer()):(this.updateRosterDuration(),this.wipeSince=null,this.progress.roster.wipeSince=null,this.clearRosterTimer())}updateBankruptcyDuration(){if(this.bankruptSince===null)return;const a=this.timeSource()-this.bankruptSince;a>this.progress.economy.bankruptDurationMs&&(this.progress.economy.bankruptDurationMs=a)}updateRosterDuration(){if(this.wipeSince===null)return;const a=this.timeSource()-this.wipeSince;a>this.progress.roster.wipeDurationMs&&(this.progress.roster.wipeDurationMs=a)}evaluateResolution(){if(!this.resolution){if(this.progress.sauna.destroyed){this.resolve("lose","saunaDestroyed");return}if(this.progress.strongholds.total>0&&this.progress.strongholds.remaining===0){this.resolve("win","strongholds");return}if(this.wipeSince!==null&&this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.bankruptSince!==null&&this.bankruptcyGraceMs<=0&&this.resolve("lose","bankruptcy")}}resolve(a,s){if(this.resolution)return;this.updateRosterDuration(),this.updateBankruptcyDuration();const r=this.timeSource(),l=Math.max(0,r-this.progress.startedAt),u=C2({...this.progress,roster:{...this.progress.roster,wipeSince:this.wipeSince},economy:{...this.progress.economy,bankruptSince:this.bankruptSince},sauna:{...this.progress.sauna,destroyedAt:this.saunaDestroyedAt}}),f=this.computeRewards();this.resolution=Object.freeze({outcome:a,cause:s,timestamp:r,durationMs:l,summary:u,rewards:f}),this.emitResolution(),this.dispose()}emitProgress(){const a=this.getProgress();for(const s of this.progressListeners)try{s(a)}catch(r){console.error("Objective progress listener failed",r)}}emitResolution(){if(!this.resolution)return;const a=this.resolution;for(const s of this.resolutionListeners)try{s(a)}catch(r){console.error("Objective resolution listener failed",r)}this.resolutionListeners.clear()}computeRewards(){const a=T2(this.state);return{resources:{[se.SAUNA_BEER]:{final:a[se.SAUNA_BEER],delta:a[se.SAUNA_BEER]-this.startResources[se.SAUNA_BEER]},[se.SAUNAKUNNIA]:{final:a[se.SAUNAKUNNIA],delta:a[se.SAUNAKUNNIA]-this.startResources[se.SAUNAKUNNIA]},[se.SISU]:{final:a[se.SISU],delta:a[se.SISU]-this.startResources[se.SISU]}}}}coordKey(a){return`${a.q},${a.r}`}isStronghold(a){return a?this.strongholdTypes.has(a):!1}createSaunaProgress(){if(!this.sauna)return{maxHealth:0,health:0,destroyed:!1,destroyedAt:null};const a=Math.max(0,Math.round(this.sauna.maxHealth??0)),s=Math.max(0,Math.round(this.sauna.health??0)),r=!!this.sauna.destroyed||s<=0;return r&&this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),{maxHealth:a,health:s,destroyed:r,destroyedAt:r?this.saunaDestroyedAt:null}}updateSaunaSnapshot(a){const s=Number.isFinite(a)?Math.max(0,Math.round(a)):0,r=this.sauna?Math.max(0,Math.round(this.sauna.maxHealth??0)):0,l=this.progress.sauna.maxHealth,u=Math.max(l,r,s);this.progress.sauna.maxHealth=u;const f=Math.max(0,Math.min(u,s));this.progress.sauna.health=f,f>0&&(this.progress.sauna.destroyed=!1,this.progress.sauna.destroyedAt=null,this.saunaDestroyedAt=null)}markSaunaDestroyed(){if(this.sauna){const a=Math.max(0,Math.round(this.sauna.maxHealth??0));a>this.progress.sauna.maxHealth&&(this.progress.sauna.maxHealth=a)}this.progress.sauna.health=0,this.progress.sauna.destroyed=!0,this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),this.progress.sauna.destroyedAt=this.saunaDestroyedAt}}function IC(n){return new HC(n)}const Rn=[{level:1,xpToNext:180,cumulativeXp:0,statAwards:{vigor:0,focus:0,resolve:0}},{level:2,xpToNext:220,cumulativeXp:180,statAwards:{vigor:5,focus:2,resolve:1}},{level:3,xpToNext:260,cumulativeXp:400,statAwards:{vigor:4,focus:3,resolve:1}},{level:4,xpToNext:320,cumulativeXp:660,statAwards:{vigor:4,focus:2,resolve:2}},{level:5,xpToNext:380,cumulativeXp:980,statAwards:{vigor:6,focus:3,resolve:2}},{level:6,xpToNext:460,cumulativeXp:1360,statAwards:{vigor:7,focus:3,resolve:3}},{level:7,xpToNext:540,cumulativeXp:1820,statAwards:{vigor:6,focus:4,resolve:3}},{level:8,xpToNext:640,cumulativeXp:2360,statAwards:{vigor:7,focus:4,resolve:4}},{level:9,xpToNext:760,cumulativeXp:3e3,statAwards:{vigor:8,focus:5,resolve:4}},{level:10,xpToNext:900,cumulativeXp:3760,statAwards:{vigor:9,focus:6,resolve:5}},{level:11,xpToNext:1060,cumulativeXp:4660,statAwards:{vigor:10,focus:6,resolve:6}},{level:12,xpToNext:null,cumulativeXp:5720,statAwards:{vigor:12,focus:7,resolve:6}}];function jC(n){return Number.isNaN(n)||!Number.isFinite(n)?0:Math.max(0,Math.floor(n))}function Dh(){return{vigor:0,focus:0,resolve:0}}function GC(n){return{vigor:n.vigor,focus:n.focus,resolve:n.resolve}}function Zc(n){const a=jC(n);let s=Rn[0];for(const f of Rn)if(a>=f.cumulativeXp)s=f;else break;const r=a-s.cumulativeXp,l=s.xpToNext,u=l?Math.min(1,r/l):1;return{level:s.level,xpIntoLevel:r,xpForNext:l,progressToNext:u,statAwards:s.statAwards}}function FC(n){const a=Rn[Rn.length-1].level,s=Math.max(Rn[0].level,Math.min(n,a)),r=Rn.find(l=>l.level===s);return r?GC(r.statAwards):Dh()}function YC(n){if(n<=Rn[0].level)return Dh();const a=Rn[Rn.length-1].level,s=Math.min(n,a),r=Dh();for(const l of Rn){if(l.level>s)break;l.level!==Rn[0].level&&(r.vigor+=l.statAwards.vigor,r.focus+=l.statAwards.focus,r.resolve+=l.statAwards.resolve)}return r}function $C(n){return Zc(n).level}const av="progression:artocoinBalance",Qn=0,_2=Object.freeze({"ember-circuit":{tierId:"ember-circuit",nextUnlockLabel:"Aurora Ward key engraving",unlockCost:150,baselinePayout:60,baselineDurationMinutes:12.5,baselineKills:150,baselineTiles:85},"aurora-ward":{tierId:"aurora-ward",nextUnlockLabel:"Mythic Conclave rite",unlockCost:210,baselinePayout:84,baselineDurationMinutes:12,baselineKills:190,baselineTiles:100},"mythic-conclave":{tierId:"mythic-conclave",nextUnlockLabel:"Prestige cache rotation",unlockCost:275,baselinePayout:110,baselineDurationMinutes:11.5,baselineKills:230,baselineTiles:115}}),ah=Object.freeze([{minScalar:0,maxScalar:.95,multiplier:.85},{minScalar:.95,maxScalar:1.1,multiplier:1},{minScalar:1.1,maxScalar:1.3,multiplier:1.18},{minScalar:1.3,maxScalar:1.5,multiplier:1.32},{minScalar:1.5,multiplier:1.42,bonusPerStage:.03,maxMultiplier:1.58}]);function iv(){try{const n=globalThis;return n.localStorage?n.localStorage:n.window?.localStorage?n.window.localStorage:null}catch(n){return console.warn("Local storage unavailable for artocoin progression",n),null}}function hm(n){const a=Number(n);return!Number.isFinite(a)||a<0?Qn:Math.min(Number.MAX_SAFE_INTEGER,Math.floor(a))}function VC(n){if(!n)return Qn;const a=n.artocoins??n.artocoinBalance,s=hm(a);return"artocoins"in n&&delete n.artocoins,"artocoinBalance"in n&&delete n.artocoinBalance,s}function XC(n){const a=n.getItem(Lc);if(!a)return Qn;try{const s=JSON.parse(a);if(!s||typeof s!="object")return Qn;const r=s,l=VC(r);try{n.setItem(Lc,JSON.stringify(r))}catch(u){console.warn("Failed to persist migrated NG+ state without artocoins",u)}return l}catch(s){return console.warn("Failed to parse legacy NG+ state during artocoin migration",s),Qn}}function KC(){const n=iv();if(!n)return Qn;const a=n.getItem(av);if(a!==null){const r=hm(a);return r!==Qn?r:Qn}const s=XC(n);return s!==Qn?(sv(s),s):Qn}function sv(n){const a=iv();if(!a)return;const s=hm(n);try{a.setItem(av,s.toString())}catch(r){console.warn("Failed to persist artocoin balance",r)}}function Nc(n,a,s){if(!Number.isFinite(s)||n===a||n>a)return n;const r=Math.max(n,Math.min(a,s));return Number.isNaN(r)?n:r}function QC(n){return Nc(0,1,n)}function rv(n,a){const s=Number.isFinite(n)?n:1,r=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;for(const l of ah){const u=typeof l.maxScalar=="number"?s<l.maxScalar:!0;if(s>=l.minScalar&&u){if(l.bonusPerStage&&l.maxMultiplier){const h=Math.max(0,r-4)*l.bonusPerStage,m=l.multiplier+h;return Math.min(l.maxMultiplier,m)}return l.multiplier}}return ah[ah.length-1]?.multiplier??1}function ov(n){return _2[n]??_2["ember-circuit"]}function PC(n){const a=ov(n.tierId),s=a.baselinePayout,r=Number.isFinite(n.runSeconds)?n.runSeconds/60:0,l=a.baselineDurationMinutes,u=Nc(.75,1.2,1+(l-r)/l*.35),f=Nc(.6,1.45,n.enemyKills/a.baselineKills),h=Nc(.7,1.25,n.tilesExplored/a.baselineTiles),m=u*.3+f*.45+h*.25,p=Math.max(.4,1-Math.max(0,n.rosterLosses)*.22),g=rv(n.difficultyScalar,n.rampStageIndex);return{artocoins:Math.round(s*m*p*g),breakdown:{baseline:s,performanceMultiplier:m,lossPenalty:p,difficultyMultiplier:g}}}function ZC(n){const a=ov(n.tierId),s=a.baselinePayout,r=rv(n.difficultyScalar,n.rampStageIndex),l=s*.2*r,u=n.runSeconds/(a.baselineDurationMinutes*60),f=n.enemyKills/a.baselineKills,h=QC(.5*u+.5*f),m=s*.45*h*r,p=Math.max(.35,1-Math.max(0,n.rosterLosses)*.12);return{artocoins:Math.round(Math.max(l,m)*p),breakdown:{baseline:s,performanceMultiplier:m/s,lossPenalty:p,difficultyMultiplier:r}}}function JC(n,a){return n==="win"?PC(a):ZC(a)}function ih(n){return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function xc(n,a){return a<=0?"":`${n}/${a}`}function WC(n){let a=0;const s=Math.max(0,ih(n.queueCapacity??2)),r=(f,h)=>{f&&typeof n.log=="function"&&n.log({type:"system",message:f,metadata:{context:"spawn-queue",...h}})},l=()=>{const f=n.getTier();if(!f)return null;const h=ih(n.getRosterLimit()),m=ih(n.getRosterCount());return{tierId:f.id,tierName:f.name,rosterLimit:h,rosterCount:m,queued:a}};return{getSnapshot:()=>l(),hasQueuedSpawn:()=>a>0,takeQueuedSpawn:f=>a<=0?!1:(a-=1,a<=0?r(`The benches of ${f.tierName} exhale — queued attendants take the field.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} deploys a queued attendant. Relief teams remaining: ${xc(a,s)}.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0),restoreQueuedSpawn:f=>{s>0&&a>=s||(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} keeps the relief attendant on standby (${xc(a,s)} ready).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},queueBlockedSpawn:(f,h)=>s>0&&a>=s?(r(`${f.tierName} cannot hold more relief attendants — clear a slot to vent the pressure.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!1):h()?(a+=1,s>0&&(a=Math.min(a,s)),r(`${f.tierName} queues a ready attendant in the wings (${xc(a,s)} poised).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}),!0):!1,onSpawnResolved:(f,h)=>{h.usedQueue&&(a>0?r(`${f.tierName} still has relief attendants waiting (${xc(a,s)}).`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}):r(`${f.tierName} has cleared the relief queue.`,{tierId:f.tierId,tierName:f.tierName,queue:a,capacity:s}))},clearQueue:f=>{if(!(a<=0)&&(a=0,f==="tier-change")){const h=n.getTier();h&&r(`${h.name} ushers its queued attendants into the new hall.`,{tierId:h.id,tierName:h.name,queue:a,capacity:s})}}}}const lv="autobattles:saunojas";function cv(){try{return globalThis.localStorage??null}catch{return null}}function eT(){const n=cv();if(!n)return[];try{const a=n.getItem(lv);if(!a)return[];const s=JSON.parse(a);if(!Array.isArray(s))return[];const r=[];for(const l of s){if(!l||typeof l!="object")continue;const u=l,f=u.id;if(typeof f!="string"||f.length===0)continue;const h=u.coord,m=h&&typeof h=="object"&&typeof h.q=="number"&&Number.isFinite(h.q)&&typeof h.r=="number"&&Number.isFinite(h.r)?{q:h.q,r:h.r}:void 0,p=u.traits,g=Array.isArray(p)?p.filter(E=>typeof E=="string"):void 0,b=typeof u.upkeep=="number"?u.upkeep:void 0,v=typeof u.xp=="number"?u.xp:void 0;r.push(am({id:f,name:typeof u.name=="string"?u.name:void 0,coord:m,maxHp:typeof u.maxHp=="number"?u.maxHp:void 0,hp:typeof u.hp=="number"?u.hp:void 0,steam:typeof u.steam=="number"?u.steam:void 0,traits:g,upkeep:b,xp:v,selected:!!u.selected,items:Array.isArray(u.items)?u.items:void 0,baseStats:u.baseStats,effectiveStats:u.effectiveStats,equipment:u.equipment,modifiers:Array.isArray(u.modifiers)?u.modifiers:void 0}))}return r}catch(a){return console.warn("Failed to load Saunoja units from storage",a),[]}}function tT(n){const a=cv();if(a)try{const s=n.map(r=>({id:r.id,name:r.name,coord:{q:r.coord.q,r:r.coord.r},maxHp:r.maxHp,hp:r.hp,steam:r.steam,traits:[...r.traits],upkeep:r.upkeep,xp:r.xp,selected:r.selected,baseStats:{health:r.baseStats.health,attackDamage:r.baseStats.attackDamage,attackRange:r.baseStats.attackRange,movementRange:r.baseStats.movementRange,...typeof r.baseStats.defense=="number"&&Number.isFinite(r.baseStats.defense)?{defense:r.baseStats.defense}:{},...typeof r.baseStats.shield=="number"&&Number.isFinite(r.baseStats.shield)?{shield:r.baseStats.shield}:{},...typeof r.baseStats.visionRange=="number"&&Number.isFinite(r.baseStats.visionRange)?{visionRange:r.baseStats.visionRange}:{}},effectiveStats:{health:r.effectiveStats.health,attackDamage:r.effectiveStats.attackDamage,attackRange:r.effectiveStats.attackRange,movementRange:r.effectiveStats.movementRange,...typeof r.effectiveStats.defense=="number"&&Number.isFinite(r.effectiveStats.defense)?{defense:r.effectiveStats.defense}:{},...typeof r.effectiveStats.shield=="number"&&Number.isFinite(r.effectiveStats.shield)?{shield:r.effectiveStats.shield}:{},...typeof r.effectiveStats.visionRange=="number"&&Number.isFinite(r.effectiveStats.visionRange)?{visionRange:r.effectiveStats.visionRange}:{}},equipment:Ws.reduce((l,u)=>{const f=r.equipment?.[u]??null;return l[u]=f?{id:f.id,name:f.name,description:f.description,icon:f.icon,rarity:f.rarity,quantity:f.quantity,slot:f.slot}:null,l},{}),items:r.items.map(l=>({id:l.id,name:l.name,description:l.description,icon:l.icon,rarity:l.rarity,quantity:l.quantity})),modifiers:r.modifiers.map(l=>({id:l.id,name:l.name,description:l.description,remaining:l.remaining,duration:l.duration,appliedAt:l.appliedAt,stacks:l.stacks,source:l.source}))}));a.setItem(lv,JSON.stringify(s))}catch(s){console.warn("Failed to persist Saunoja units",s)}}const uv="autobattles:sauna-settings";function dv(){try{return globalThis.localStorage??null}catch{return null}}function nT(n){return typeof n=="string"?qa(n).id:Oo}function R2(n){return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function mm(n,a){const s=R2(n),r=R2(a),l=1+jh;return Math.max(0,Math.min(l,s,r))}function fv(n,a,s){const r=mm(s,s),l=typeof n=="number"&&Number.isFinite(n)?n:a,u=Math.max(0,Math.floor(l));return Math.max(0,Math.min(r,u))}function hv(n){return n===!0||n==="true"}function ho(n,a){const s=nT(n?.activeTierId),r=qa(s),l=mm(r.rosterCap,a);return{activeTierId:r.id,maxRosterSize:fv(n?.maxRosterSize,l,l),useUiV2:hv(n?.useUiV2)}}function mv(n=1+jh){const a=dv();if(!a)return ho(null,n);try{const s=a.getItem(uv);if(!s)return ho(null,n);const r=JSON.parse(s);return ho(!r||typeof r!="object"?null:r,n)}catch(s){return console.warn("Failed to load sauna settings from storage",s),ho(null,n)}}function pv(n){const a=dv();if(!a)return;const s=qa(n.activeTierId),r=mm(s.rosterCap,s.rosterCap),l={activeTierId:s.id,maxRosterSize:fv(n.maxRosterSize,r,r),useUiV2:hv(n.useUiV2)};try{a.setItem(uv,JSON.stringify(l))}catch(u){console.warn("Failed to persist sauna settings",u)}}const aT=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),iT=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function gv(n){return Number.isFinite(n)?Math.max(0,Math.min(100,Math.round(n*100))):0}function sT(n){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});if(n.xpForNext===null)return`${a.format(n.xp)} XP • Max level`;const s=gv(n.progress);return`${a.format(n.xpIntoLevel)} / ${a.format(n.xpForNext)} XP • ${s}%`}function rT(n){const a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),s=[];return n.vigor>0&&s.push(`+${a.format(n.vigor)} Vigor`),n.focus>0&&s.push(`+${a.format(n.focus)} Focus`),n.resolve>0&&s.push(`+${a.format(n.resolve)} Resolve`),s.length>0?s.join(" • "):"No level bonuses yet"}function oT(n,a){const{rosterIcon:s,summaryLabel:r="Saunoja Roster"}=a;n.classList.add("sauna-roster"),n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("title","Active sauna battalion on the field"),n.dataset.tutorialTarget="upkeep",n.replaceChildren();const l=document.createElement("div");l.classList.add("sauna-roster__summary");const u=document.createElement("img");u.src=s,u.alt="Saunoja roster crest",u.decoding="async",u.classList.add("sauna-roster__icon");const f=document.createElement("div");f.classList.add("sauna-roster__text");const h=document.createElement("span");h.textContent=r,h.classList.add("sauna-roster__label");const m=document.createElement("span");m.textContent="0",m.classList.add("sauna-roster__value"),f.append(h,m),l.append(u,f);const p=document.createElement("div");p.classList.add("saunoja-card"),p.setAttribute("aria-live","polite"),p.hidden=!0;const g=document.createElement("div");g.classList.add("saunoja-card__header");const b=document.createElement("div");b.classList.add("saunoja-card__level"),b.setAttribute("role","img"),b.style.setProperty("--level-progress","0%");const v=document.createElement("span");v.classList.add("saunoja-card__level-value"),v.textContent="1",b.appendChild(v);const E=document.createElement("div");E.classList.add("saunoja-card__identity");const M=document.createElement("h3");M.classList.add("saunoja-card__name"),M.textContent="Saunoja";const C=document.createElement("div");C.classList.add("saunoja-card__xp"),C.textContent="0 / 0 XP • 0%",E.append(M,C),g.append(b,E);const R=document.createElement("p");R.classList.add("saunoja-card__traits");const N=document.createElement("div");N.classList.add("saunoja-card__callouts"),N.textContent="No level bonuses yet";const q=document.createElement("p");q.classList.add("saunoja-card__upkeep"),p.append(g,R,N,q),n.append(l,p);let I=null,Y=null;function Q(T){if(!T){p.hidden=!0;return}p.hidden=!1,p.dataset.unitId=T.id,M.textContent=T.name||"Saunoja";const k=T.traits.filter(w=>w.length>0),A=k.length>0?k.join(", "):"No notable traits yet";R.textContent=A,R.title=A;const F=sT(T.progression);C.textContent=F,C.title=F;const B=gv(T.progression.progress);b.style.setProperty("--level-progress",`${B}%`),v.textContent=String(T.progression.level);const D=T.progression.xpForNext===null?`Level ${T.progression.level}, at mastery`:`Level ${T.progression.level}, ${B}% toward next level`;b.setAttribute("aria-label",D);const V=rT(T.progression.statBonuses);N.textContent=V,N.title=V;const te=Math.max(0,Math.round(T.upkeep)),he=`Upkeep: ${iT.format(te)} Beer`;q.textContent=he,q.title=he}function ie(T){return T===1/0?"inf":!Number.isFinite(T)||T<=0?"0":String(Math.ceil(T))}function ee(T){return[T.id,T.name,T.icon??"",T.rarity??"",T.description??"",T.quantity].join("^")}function oe(T){return[T.id,T.name,T.description??"",ie(T.duration),ie(T.remaining),T.appliedAt??"",T.stacks??1,T.source??""].join("^")}function P(T){const{stats:k}=T,A=T.traits.join("|"),F=T.items.map(ee).join("|"),B=T.modifiers.map(oe).join("|");return[T.id,T.name,T.upkeep,T.status,T.selected?1:0,T.progression.level,T.progression.xp,T.progression.xpIntoLevel,T.progression.xpForNext??"max",k.health,k.maxHealth,k.attackDamage,k.attackRange,k.movementRange,k.defense??0,k.shield??0,A,F,B].join("~")}function G(T){return`${T.length}:${T.map(P).join("||")}`}return{updateSummary(T){const k=Math.max(0,Math.floor(T.count)),A=aT.format(k);m.textContent=A,n.setAttribute("aria-label",`Saunoja roster: ${A} active attendants`),n.setAttribute("title",`Saunoja roster • ${A} active attendants`),Q(T.card)},installRenderer(T){Y=null,I=T},renderRoster(T){if(!I)return;const k=G(T);k!==Y&&(Y=k,I(T))},destroy(){I=null,Y=null,n.replaceChildren()}}}const lT={[se.SAUNA_BEER]:"Sauna Beer",[se.SAUNAKUNNIA]:"Saunakunnia",[se.SISU]:"Sisu"},cT='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function uT(n){if(!Number.isFinite(n)||n<=0)return"0:00";const a=Math.round(n/1e3),s=Math.max(0,a%60).toString().padStart(2,"0"),r=Math.floor(a/60),l=(r%60).toString().padStart(2,"0"),u=Math.floor(r/60);return u>0?`${u}:${l}:${s}`:`${r}:${s}`}function dT(n){switch(n.cause){case"strongholds":return"All rival strongholds have fallen.";case"rosterWipe":return"Every attendant is down—no one remains to hold the line.";case"bankruptcy":return"Upkeep debts have exhausted the steam reserves.";case"saunaDestroyed":return"The sauna collapsed under relentless assault—the sacred steamline has fallen silent.";default:return""}}function fT(n){if(!Number.isFinite(n)||n===0)return"±0";const a=Math.round(n*100)/100;return`${a>0?"+":""}${a}`}function hT(n,a){const s=document.createElement("ul");s.className="end-screen__rewards-list";for(const r of Object.values(se)){const l=n.rewards.resources[r];if(!l)continue;const u=document.createElement("li");u.className="end-screen__reward-item";const f=document.createElement("span");f.className="end-screen__reward-label",f.textContent=a[r]??r;const h=document.createElement("span");h.className="end-screen__reward-value",h.textContent=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(l.final));const m=document.createElement("span");m.className="end-screen__reward-delta",m.textContent=fT(l.delta),m.dataset.polarity=l.delta>=0?"positive":"negative",u.append(f,h,m),s.append(u)}return s}function mT(n,a,s){const r=l=>{if(l.key==="Escape"){l.preventDefault(),s?.();return}if(l.key!=="Tab")return;const u=a.querySelectorAll(cT);if(u.length===0){l.preventDefault(),a.focus();return}const f=u[0],h=u[u.length-1],m=document.activeElement;l.shiftKey?(m===f||!a.contains(m))&&(l.preventDefault(),h.focus()):(m===h||!a.contains(m))&&(l.preventDefault(),f.focus())};return n.addEventListener("keydown",r),()=>n.removeEventListener("keydown",r)}function pT(n){const{container:a,resolution:s,onNewRun:r,onDismiss:l,currentNgPlusLevel:u}=n;if(!a)return{destroy(){},focusPrimary(){}};const f={...lT,...n.resourceLabels??{}},h=document.createElement("div");h.className="end-screen",h.setAttribute("role","presentation");const m=document.createElement("section");m.className="end-screen__panel",m.setAttribute("role","dialog"),m.setAttribute("aria-modal","true");const p=`end-screen-title-${Date.now()}`;m.setAttribute("aria-labelledby",p),m.tabIndex=-1,m.dataset.outcome=s.outcome;const g=document.createElement("h2");g.className="end-screen__title",g.id=p,g.textContent=s.outcome==="win"?"Steamforged Victory":"Sauna Lost";const b=document.createElement("p");b.className="end-screen__subtitle",b.textContent=dT(s);const v=document.createElement("dl");v.className="end-screen__metrics";const E=(oe,P)=>{const G=document.createElement("dt");G.textContent=oe,G.className="end-screen__metric-label";const T=document.createElement("dd");T.textContent=P,T.className="end-screen__metric-value",v.append(G,T)};E("Run time",uT(s.durationMs)),E("Strongholds",`${s.summary.strongholds.destroyed}/${s.summary.strongholds.total}`),E("Roster losses",`${s.summary.roster.totalDeaths}`),E("Deepest beer reserve",`${Math.round(s.summary.economy.worstBeer)}`);const M=document.createElement("div");M.className="end-screen__badges";const C=document.createElement("span");C.className="end-screen__badge",C.textContent=`NG+ ${Math.max(0,u)}`,M.append(C);const R=document.createElement("h3");R.className="end-screen__section-title",R.textContent="Rewards";const N=hT(s,f),q=document.createElement("div");q.className="end-screen__actions";const I=document.createElement("button");I.type="button",I.className="end-screen__button end-screen__button--primary",I.textContent="New run (NG+)",I.addEventListener("click",()=>{r()});const Y=document.createElement("button");Y.type="button",Y.className="end-screen__button",Y.textContent="Review battlefield",Y.addEventListener("click",()=>{l?.()}),q.append(I,Y),m.append(g,b,M,v,R,N,q),h.append(m),a.append(h);const Q=mT(h,m,l),ie=()=>{Q(),h.remove()},ee=()=>{requestAnimationFrame(()=>{I.focus({preventScroll:!0})})};return ee(),{destroy:ie,focusPrimary:ee}}const yv="autobattles4x.flags";function bv(){if(typeof window>"u")return null;try{if("localStorage"in window&&window.localStorage)return window.localStorage}catch(n){console.warn("Unable to access localStorage for local flags",n)}return null}function vv(){const n=bv();if(!n)return{};try{const a=n.getItem(yv);if(!a)return{};const s=JSON.parse(a);if(s&&typeof s=="object")return s}catch(a){console.warn("Failed to parse local flags, resetting.",a)}return{}}function gT(n){const a=bv();if(a)try{const s={};n.tutorial_done&&(s.tutorial_done=!0),a.setItem(yv,JSON.stringify(s))}catch(s){console.warn("Failed to persist local flags",s)}}function yT(){return vv().tutorial_done===!0}function N2(n){const a={...vv()};a.tutorial_done=!0,gT(a)}const sh=200,rh=3,bT=2,k2=6,vT=40,ST=250,ET=200,MT=$C(Number.MAX_SAFE_INTEGER),Lh={[se.SAUNA_BEER]:"Sauna Beer",[se.SAUNAKUNNIA]:"Saunakunnia",[se.SISU]:"Sisu"};function Sv(n,a){const s=Number.isFinite(a)?Math.max(0,Math.floor(a)):0;if(!Number.isFinite(n))return s;const r=Math.max(0,Math.floor(n));return Math.max(0,Math.min(s,r))}const Ev=.1,xT=3,wT=1;let Ln=Ta(lE()),Mv=Uc(Ln.runSeed,1),xv=Uc(Ln.runSeed,2),pm=null;function Jc(n){Ln=Ta(n),Mv=Uc(Ln.runSeed,1),xv=Uc(Ln.runSeed,2),pm?.({persist:!0})}Jc(Ln);let Wc=null,Ie=[];const na=new Map,mi=new Map,Wi=new Map;let D2=0,eu=null,Jn=null,La=null,Ks=null,kn=null,Qs=null,Tt=null,Qi=null,wo=null,Na=null,pi=null,Pi=!1,bn=null,gi=null,Kn=null,Ao=null,tu=!1,$i=0;function gm(n){const a=mi.get(n.id);return a?Wi.get(a)??null:null}function wv(n,a){n.effectiveStats={...a},n.maxHp=Math.max(1,Math.round(a.health)),n.hp=Math.min(n.maxHp,Math.max(0,Math.round(n.hp))),n.defense=typeof a.defense=="number"?Math.max(0,a.defense):void 0,n.shield=typeof a.shield=="number"?Math.max(0,a.shield):0;const s=gm(n);if(s){const r={health:n.effectiveStats.health,attackDamage:n.effectiveStats.attackDamage,attackRange:n.effectiveStats.attackRange,movementRange:n.effectiveStats.movementRange};typeof n.effectiveStats.defense=="number"&&(r.defense=n.effectiveStats.defense),typeof n.effectiveStats.visionRange=="number"&&(r.visionRange=n.effectiveStats.visionRange),s.updateStats(r),typeof n.effectiveStats.shield=="number"?s.setShield(n.effectiveStats.shield):n.shield<=0&&s.setShield(0)}}function mu(n,a){const s=a??Nn(n.equipment),r=Hc(n.baseStats,s);return wv(n,r),r}function Av(n){const a=Zc(n.xp);return{level:a.level,xp:Math.max(0,Math.floor(n.xp)),xpIntoLevel:a.xpIntoLevel,xpForNext:a.xpForNext,progress:a.progressToNext,statBonuses:YC(a.level)}}function AT(n){const a=[];return n.vigor>0&&a.push(`+${n.vigor} Vigor`),n.focus>0&&a.push(`+${n.focus} Focus`),n.resolve>0&&a.push(`+${n.resolve} Resolve`),a.length>0?a.join(", "):"+0 Vigor, +0 Focus, +0 Resolve"}function Cv(n,a,s){if(!Number.isFinite(a)||a<=0)return null;const r=Zc(n.xp),l=Math.max(0,Math.floor(n.xp+a));if(l===n.xp)return null;n.xp=l;const u=Zc(n.xp),f=Math.max(0,u.level-r.level),h={vigor:0,focus:0,resolve:0};let m=0;if(f>0){for(let g=r.level+1;g<=u.level&&g<=MT;g++){const b=FC(g);h.vigor+=b.vigor,h.focus+=b.focus,h.resolve+=b.resolve;const v=Number.isFinite(n.baseStats.health)?n.baseStats.health:n.effectiveStats.health;n.baseStats.health=Math.max(1,Math.round(v+b.vigor));const E=Number.isFinite(n.baseStats.attackDamage)?n.baseStats.attackDamage:n.effectiveStats.attackDamage;n.baseStats.attackDamage=Math.max(0,Math.round(E+b.focus));const C=(Number.isFinite(n.baseStats.defense)?n.baseStats.defense??0:n.effectiveStats.defense??0)+b.resolve;n.baseStats.defense=C>0?C:void 0}m=h.vigor}m>0&&(n.hp+=m),mu(n);const p=gm(n);if(p&&p.setExperience(n.xp),s.source==="kill"){const g=n.name?.trim()||"Our champion",b=s.label?.trim()||"their foe",v=s.boss?" Boss toppled!":s.elite?" Elite threat routed!":"";Dt({type:"combat",message:`${g} earns ${a} XP for defeating ${b}.${v}`,metadata:{slayer:g,foe:b,xpAward:a,boss:!!s.boss,elite:!!s.elite}})}if(f>0){const g=AT(h),b=n.name?.trim()||"Our champion";Dt({type:"progression",message:`${b} reaches Level ${u.level}! ${g}.`,metadata:{unit:b,level:u.level,levelsGained:f,bonuses:h}})}return{xpAwarded:a,totalXp:n.xp,level:u.level,levelsGained:f,statBonuses:h}}function CT(n,a,s){if(!n)return null;const r=na.get(n.id);return r?Cv(r,a,s):null}function TT(n,a){if(!Number.isFinite(n)||n<=0)return!1;let s=!1;for(const r of Ie)Cv(r,n,a)&&(s=!0);return s}function _T(n){return n?(n.type?.toLowerCase?.()??"").includes("boss")?{xp:ST,elite:!0,boss:!0}:jv(n)?{xp:vT,elite:!0,boss:!1}:{xp:k2,elite:!1,boss:!1}:{xp:k2,elite:!1,boss:!1}}const Tv=n=>{if(!n)return;const a=Math.max(0,Math.floor(n.strongholds.destroyed));if(a>$i){const s=a-$i,r=ET*s;TT(r,{source:"objective",label:"stronghold"})&&(aa(),Ht(),Dt({type:"progression",message:`Strategists toast the captured stronghold — roster gains ${r} XP.`,metadata:{source:"stronghold",xpAward:r}}))}if(a<$i){$i=a;return}$i=a},RT=Object.freeze(["health","attackDamage","attackRange","movementRange","defense","shield"]);function L2(n){return n?{id:n.id,name:n.name,quantity:n.quantity,rarity:n.rarity}:null}function U2(n,a){const s=n[a];return typeof s=="number"&&Number.isFinite(s)?Math.round(s):0}function NT(n,a){const s=[];for(const r of RT){const l=U2(a,r),u=U2(n,r),f=l-u;f!==0&&s.push({stat:r,delta:f})}return s}function kT(n,a){if(!a||Nn(n.equipment).length>0)return;const r={health:Math.max(1,Math.round(a.getMaxHealth())),attackDamage:Math.max(0,Math.round(a.stats.attackDamage)),attackRange:Math.max(0,Math.round(a.stats.attackRange)),movementRange:Math.max(0,Math.round(a.stats.movementRange)),defense:typeof a.stats.defense=="number"&&Number.isFinite(a.stats.defense)?Math.max(0,a.stats.defense):n.baseStats.defense,shield:n.baseStats.shield??0,visionRange:typeof a.stats.visionRange=="number"&&Number.isFinite(a.stats.visionRange)?Math.max(0,a.stats.visionRange):n.baseStats.visionRange};n.baseStats=r,mu(n)}function nu(){tu&&(uu(!1),tu=!1)}function yo(){if(!Ao){nu();return}Ao.destroy(),Ao=null,nu()}function DT(){if(yT()){yo();return}yo(),cm()?tu=!1:(uu(!0),tu=!0),Ao=ew({onComplete:()=>{N2(),nu(),yo()},onSkip:()=>{N2(),nu(),yo()}}),Ao.start()}function O2(n){wo=n,Tt&&(Tt.installRenderer(n),Na&&(Tt.renderRoster(Na),Na=null))}function LT(){return eT()}function aa(){tT(Ie)}function UT(n=Math.random){const a=typeof n=="function"?n:Math.random,s=Math.ceil(Math.min(Co,vh)),r=Math.floor(Math.max(Co,vh)),l=Math.max(1,r-s+1),u=Number(a()),f=Number.isFinite(u)?u:Math.random(),h=Math.min(Math.max(f,0),1),m=Math.min(Math.floor(h*l),l-1);return s+m}function OT(n){const s=(Array.isArray(n.traits)?n.traits:[]).length>=3,r=Number.isFinite(n.upkeep),l=Number.isFinite(n.xp);return!s||!r||!l}function _v(n){n.traits=_A(),n.upkeep=UT(),n.xp=0}function qT(n,a,s,r={}){const l=r.hudVariant??"classic",u=l==="classic";s.dataset.hudVariant=l,Wc=n,bn&&(bn.dispose(),bn=null),bn=EA({canvas:n,overlay:s,mapRenderer:ym,getUnitById:h=>Wi.get(h),requestDraw:()=>{Lt()}}),Tt&&(Tt.destroy(),Tt=null),u?(Tt=oT(a,{rosterIcon:hi.saunojaRoster}),wo&&Tt.installRenderer(wo),Na&&(Tt.renderRoster(Na),Na=null),Qi&&(Tt.updateSummary(Qi),Qi=null)):(wo=null,Na=null,Qi=null),kn?.dispose(),kn=null,u&&(kn=z3(Qe,{getActiveTierId:()=>ut,setActiveTierId:(h,m)=>{const p=VT(h,{persist:m?.persist});return p&&(kn?.update(),Ht()),p},getTierContext:()=>Mm()})),La?.dispose(),La=null,Ks?.destroy(),Ks=null;const f={useSisuBurst:()=>{const h=W3(Ve,yt);return h?(ea("sisu"),Dt({type:"ability",message:`Sisu bursts forth, spending ${Vi} grit to steel our attendants.`,metadata:{ability:"sisu-burst",cost:Vi}})):ea("error"),h},torille:()=>{const h=tx(Ve,yt,Qe.pos,Xt);return h?Dt({type:"ability",message:`Torille! Our warriors regroup at the sauna to rally their spirits for ${Xi} SISU.`,metadata:{ability:"torille",cost:Xi}}):ea("error"),h}};u&&(La=B3(Ve,{saunakunnia:hi.resource,sisu:hi.sisu,saunaBeer:hi.saunaBeer})),Ks=Ex(Ve,s,f),Qs?.destroy(),Qs=null,u&&(Qs=fC(Ro,{getSelectedUnitId:()=>Ie.find(h=>h.selected)?.id??null,getComparisonContext:()=>PT(),onEquip:(h,m,p)=>wm(h,m),getUseUiV2:YT,onUseUiV2Change:$T})),u?(ZT(),bm(),Ht(),DT()):Jn&&(Jn(),Jn=null)}const Xt=new gE(10,10,32),Rv=new nA(()=>Lt()),zT=new zM(Xt,Rv),ym=new Fw(Xt),au=()=>{ym.invalidateCache(),Lt()};ne.on("buildingPlaced",au);ne.on("buildingRemoved",au);Xt.forEachTile(n=>n.setFogged(!0));sE();const yt=[];function q2(n){return`${n.q},${n.r}`}function BT(){const n=new Set;for(const m of yt)m.isDead()||n.add(q2(m.coord));const a=[],{minQ:s,maxQ:r,minR:l,maxR:u}=Xt,f=m=>{const p=q2(m);n.has(p)||(Xt.ensureTile(m.q,m.r),a.push(m))};for(let m=s;m<=r;m++)f({q:m,r:l}),u!==l&&f({q:m,r:u});for(let m=l+1;m<=u-1;m++)f({q:s,r:m}),r!==s&&f({q:r,r:m});if(a.length===0)return;const h=Math.floor(Math.random()*a.length);return a[h]}function HT(n){const a=na.get(n);a&&(na.delete(n),mi.get(a.id)===n&&mi.delete(a.id))}function IT(n){const a=na.get(n.id);if(a)return{saunoja:a,created:!1,attached:!1};let s=Ie.find(f=>f.id===n.id);s||(s=Ie.find(f=>!mi.has(f.id)));let r=!1;s||(s=am({id:`saunoja-${Ie.length+1}`,coord:{q:n.coord.q,r:n.coord.r}}),Ie.push(s),r=!0);const l=mi.get(s.id);l&&l!==n.id&&na.delete(l),na.set(n.id,s),mi.set(s.id,n.id),kT(s,n),wv(s,s.effectiveStats),n.setExperience(s.xp);const u=OT(s);return(r||u)&&_v(s),{saunoja:s,created:r,attached:!0}}function bm(){let n=!1;for(const a of yt){if(a.faction!=="player"||a.isDead())continue;const{saunoja:s,created:r,attached:l}=IT(a);(r||l)&&(n=!0);const u=Number.isFinite(a.stats.health)?Math.max(0,a.stats.health):0;s.hp!==u&&(s.hp=u,n=!0);const f=Number.isFinite(a.getMaxHealth())?Math.max(1,a.getMaxHealth()):1;s.maxHp!==f&&(s.maxHp=f,n=!0);const h=a.getShield(),m=Number.isFinite(h)?Math.max(0,h):0;s.shield!==m&&(s.shield=m,n=!0);const g=a?.lastHitAt;Number.isFinite(g)&&s.lastHitAt!==g&&(s.lastHitAt=g,n=!0);const{q:b,r:v}=a.coord;(s.coord.q!==b||s.coord.r!==v)&&(s.coord={q:b,r:v},n=!0,s.selected&&xm(s.coord))}return n&&aa(),n}function Nv(n,a){if(n.faction==="player"){const u=(a??na.get(n.id)??null)?.name?.trim();if(u)return u}return`${(n.constructor?.name??"Unit").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase()} ${n.id}`.trim()}function pu(n){if(Wi.has(n.id))return;yt.push(n),Wi.set(n.id,n);let a=null;if(n.faction==="player"&&(bm()||qo(),a=na.get(n.id)??null),Wc&&Lt(),n.faction==="player"){const r=Nv(n,a);Dt({type:"spawn",message:`Our ${r} emerges from the steam.`,metadata:{unitId:n.id,unitName:r,steward:"Our"}}),Ht()}}const kv=({unit:n})=>{pu(n)};ne.on("unitSpawned",kv);const Dv=()=>{qo()},Ps=()=>{qo()};ne.on("inventoryChanged",Dv);ne.on("modifierAdded",Ps);ne.on("modifierRemoved",Ps);ne.on("modifierExpired",Ps);const Lv=n=>{kn?.handleDamage?.(n)},Uv=n=>{kn?.handleDestroyed?.(n)};ne.on("saunaDamaged",Lv);ne.on("saunaDestroyed",Uv);const Ov=()=>{Ht()};ne.on("unit:stats:changed",Ov);function jT(n){const a=na.get(n.id);if(!a)return 0;const s=Number.isFinite(a.upkeep)?a.upkeep:0;return s>0?s:0}const Ve=new dE(1e3),Ro=new UA,qv=Ve.load(Xt);if(qv){const n=Ve.getNgPlusState();Jc(n),dh(n)}else{const n=Ve.setNgPlusState(Ln);Jc(n),dh(n)}Ve.setEnemyScalingBase({aggression:1,cadence:1,strength:1});const Zs=mv(),zv=()=>({ngPlusLevel:Ln.ngPlusLevel,unlockSlots:Ln.unlockSlots});let ut=Zs.activeTierId,nr=Zs.useUiV2;const GT=tr(qa(ut),zv());GT.unlocked||(ut=Oo);const gu=()=>{const n=qa(ut);return Math.max(0,Math.floor(n.rosterCap))},iu=Sv(Zs.maxRosterSize,gu());(iu!==Zs.maxRosterSize||Zs.activeTierId!==ut||Zs.useUiV2!==nr)&&pv({maxRosterSize:iu,activeTierId:ut,useUiV2:nr});const Qe=UM({q:Math.floor(Xt.width/2),r:Math.floor(Xt.height/2)},void 0,{maxRosterSize:iu}),FT=()=>Math.max(xT,Qe.maxRosterSize),YT=()=>nr,$T=n=>{const a=!!n;nr!==a&&Em(Qe.maxRosterSize,{useUiV2:a})},vm=WC({getTier:()=>qa(ut),getRosterLimit:()=>gu(),getRosterCount:()=>yu(),log:n=>Dt(n),queueCapacity:3});let Bv=iu,Sm=ut;const Em=(n,a)=>{typeof a?.useUiV2=="boolean"&&(nr=a.useUiV2),pv({maxRosterSize:n,activeTierId:ut,useUiV2:nr}),Bv=n,Sm=ut},Mm=()=>zv(),No=(n,a={})=>{const s=gu(),r=Sv(n,s);return r!==Qe.maxRosterSize&&(Qe.maxRosterSize=r),a.persist&&(ut!==Sm||r!==Bv)&&Em(r),r};pm=(n={})=>{const a=Mm(),s=xb();let r=Oo;for(const f of s)if(tr(f,a).unlocked)r=f.id;else break;if(!tr(qa(ut),a).unlocked||ut!==r){const f=ut;ut=r,vm.clearQueue?.("tier-change"),No(Qe.maxRosterSize,{persist:n.persist}),f!==ut&&kn?.update?.(),Ht();return}n.persist&&(No(Qe.maxRosterSize,{persist:!0}),Ht())};pm({persist:!0});const VT=(n,a={})=>{const s=qa(n);return tr(s,Mm()).unlocked?s.id===ut?(a.persist&&ut!==Sm&&Em(Qe.maxRosterSize),!0):(ut=s.id,vm.clearQueue?.("tier-change"),No(Qe.maxRosterSize,{persist:a.persist}),!0):!1},XT=n=>{D2+=1;const a=`p${Date.now()}-${D2}`,s=tm(Ve,"soldier",a,n,"player");return s&&pu(s),s??null},Uh=new T3({difficulty:wT,random:Mv,eliteOdds:Ev}),Hv=new fE(1e3,n=>{const a=n/1e3;Ve.tick(),bo.tick(a,{state:Ve});const s=Ve.getEnemyScalingSnapshot(),r=No(Qe.maxRosterSize);kA({dt:a,state:Ve,sauna:Qe,heat:Qe.heatTracker,units:yt,getUnitUpkeep:jT,pickSpawnTile:()=>ib(Qe.pos,yt),spawnBaseUnit:XT,minUpkeepReserve:Math.max(1,Co),maxSpawns:FT(),rosterCap:r,getRosterCount:yu,tierHelpers:vm});const l={aggressionMultiplier:s.aggression,cadenceMultiplier:s.cadence,strengthMultiplier:s.strength,calmSecondsRemaining:s.calmSecondsRemaining};Uh.update(a,yt,pu,BT,l),Ve.advanceEnemyCalm(a);const u=Uh.getSnapshot(),f=Math.max(s.calmSecondsRemaining,u.calmSecondsRemaining);if(La){const m={stage:u.rampStageLabel,stageIndex:u.rampStageIndex,bundleTier:u.bundleTier,multiplier:u.difficultyMultiplier,cadenceSeconds:u.cadence,effectiveDifficulty:u.effectiveDifficulty,aggressionMultiplier:u.aggressionMultiplier,cadenceMultiplier:u.cadenceMultiplier,strengthMultiplier:u.strengthMultiplier,calmSecondsRemaining:f,spawnCycles:u.spawnCycles};La.setEnemyRampSummary(m)}const h=gi?.getProgress().roster;D3(u,{wipeSince:h?.wipeSince??null,wipeDurationMs:h?.wipeDurationMs??0}),zT.tick(yt,a,Qe),pM(a),bm()&&Ht(),Ve.save();for(const m of yt)m.isDead()||m.faction!=="player"||Xt.revealAround(m.coord,m.getVisionRange(),{autoFrame:!1});Lt()}),KT=n=>{Pi&&(Pi=!1),Hv.stop(),pi!==null&&(cancelAnimationFrame(pi),pi=null),Lt();const a=document.getElementById("ui-overlay");if(!a)return;Kn&&(Kn.destroy(),Kn=null);const s=Uh.getSnapshot(),r=JC(n.outcome,{tierId:ut,runSeconds:Math.max(0,n.durationMs/1e3),enemyKills:Math.max(0,n.summary.enemyKills),tilesExplored:Math.max(0,n.summary.exploration.revealedHexes),rosterLosses:Math.max(0,n.summary.roster.totalDeaths),difficultyScalar:s.effectiveDifficulty,rampStageIndex:s.rampStageIndex});if(r.artocoins>0){const h=KC();sv(h+r.artocoins)}const l=Ln.ngPlusLevel,u=cE(Ln,{outcome:n.outcome});dh(u),Ve.setNgPlusState(u),Jc(u),Kn=pT({container:a,resolution:n,currentNgPlusLevel:l,resourceLabels:Lh,onNewRun:()=>{try{typeof window<"u"&&window.localStorage?.removeItem?.("gameState")}catch(h){console.warn("Failed to reset saved game state for NG+",h)}typeof window<"u"&&typeof window.location?.reload=="function"&&window.setTimeout(()=>window.location.reload(),75)},onDismiss:()=>{Kn&&(Kn.destroy(),Kn=null)}})};Ie=LT();if(Ie.length===0){const n=am({id:"saunoja-1",coord:Qe.pos,selected:!0,upkeep:Ic});_v(n),n.upkeep=Ic,Ie.push(n),aa()}else{let n=!1,a=!1;for(const s of Ie)s.selected&&(n?(s.selected=!1,a=!0):n=!0);a&&aa()}const QT=yt.some(n=>n.faction==="player"&&!n.isDead());if(!QT){Ve.canAfford(wy,se.SAUNA_BEER)||Ve.addResource(se.SAUNA_BEER,wy);const n=`u${yt.length+1}`,a=tm(Ve,"soldier",n,Qe.pos,"player");a&&pu(a)}Xt.revealAround(Qe.pos,3);gi=IC({state:Ve,map:Xt,getRosterCount:yu,sauna:Qe,rosterWipeGraceMs:8e3,bankruptcyGraceMs:12e3});$i=gi.getProgress().strongholds.destroyed;gi.onProgress(Tv);gi.onResolution(KT);function PT(){const n=Ie.find(a=>a.selected)??null;return n?{baseStats:{...n.baseStats},loadout:Nn(n.equipment),currentStats:{...n.effectiveStats}}:null}function ZT(){Jn&&(Jn(),Jn=null);const n=Px(Ve,{onRosterSelect:t_,onRosterRendererReady:O2,onRosterEquipSlot:a_,onRosterUnequipSlot:i_,getRosterCap:()=>Math.max(0,Math.floor(Qe.maxRosterSize)),getRosterCapLimit:()=>gu(),updateMaxRosterSize:(a,s)=>{const r=No(a,{persist:s?.persist});return s?.persist&&Ht(),r}});n.addEvent,O2(n.renderRoster),Jn=n.dispose}function JT(){kn?.update()}function z2(n){La?.update(n)}qv||(Ve.addResource(se.SAUNA_BEER,sh),Dt({type:"resource",message:`Quartermaster stocks ${sh} bottles of ${Lh[se.SAUNA_BEER]} to launch your campaign.`,metadata:{resource:se.SAUNA_BEER,amount:sh,context:"initial"}}),Ve.addResource(se.SAUNAKUNNIA,rh),Dt({type:"resource",message:`Sauna elders honor your leadership with ${rh} ${Lh[se.SAUNAKUNNIA]} to celebrate your arrival.`,metadata:{resource:se.SAUNAKUNNIA,amount:rh,context:"initial"}}));const oh=Ie.find(n=>n.selected);oh&&(eu={q:oh.coord.q,r:oh.coord.r});function WT(n,a){return!n||!a?n===a:n.q===a.q&&n.r===a.r}function xm(n){return WT(eu,n)?!1:(eu=n?{q:n.q,r:n.r}:null,!0)}function Iv(n){let a=!1;for(const s of Ie)n&&s===n||s.selected&&(s.selected=!1,a=!0);return a}function e_(){let n=!1;return Iv()&&(n=!0),xm(null)&&(n=!0),n}function jv(n){if(!n)return!1;const a=em(n.type);if(!a)return!1;const s=Do(a,1),r=n.stats;return r.health>s.health||r.attackDamage>s.attackDamage||r.attackRange>s.attackRange||r.movementRange>s.movementRange}function Gv(n){let a=!1;return n.selected||(n.selected=!0,a=!0),Iv(n)&&(a=!0),xm(n.coord)&&(a=!0),a}function t_(n){const a=Ie.find(s=>s.id===n);a&&Gv(a)&&(aa(),Ht(),Lt())}function Fv(n){const a=eE(n.x,n.y,Xt.hexSize),s=Ie.find(l=>l.coord.q===a.q&&l.coord.r===a.r);(s?Gv(s):e_())&&(aa(),Ht(),Lt())}function wm(n,a){const s=Ie.find(p=>p.id===n);if(!s)return{success:!1,reason:"unit-missing"};const r=Nn(s.equipment),l=Hc(s.baseStats,r),u=QM(s,a);if(!u.success)return{success:!1,reason:u.reason};const f=mu(s,u.loadout);ne.emit("unit:stats:changed",{unitId:s.id,stats:f}),ne.emit("inventoryChanged",{}),aa(),Ht();const h=r.find(p=>p.slot===u.slot)??null;return{success:!0,comparison:{slot:u.slot,previous:L2(h),next:L2(u.item??null),deltas:NT(l,f)}}}function n_(n,a){const s=Ie.find(b=>b.id===n);if(!s)return null;const r=PM(s,a);if(!r.success||!r.removed)return null;const l=mu(s,r.loadout);ne.emit("unit:stats:changed",{unitId:s.id,stats:l}),ne.emit("inventoryChanged",{}),aa(),Ht();const{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}=r.removed;return{id:u,name:f,description:h,icon:m,rarity:p,quantity:g}}function a_(n,a){const r=Ro.getStash().findIndex(l=>ZM(l.id,a));return r===-1?!1:Ro.equipFromStash(r,n,wm)}function i_(n,a){return Ro.unequipToStash(n,a,n_)}function Lt(){if(!Wc)return;const n=Wc.getContext("2d"),a=nv();if(!n||!a)return;if(bn){const m=typeof performance<"u"?performance.now():Date.now();bn.step(m)}const s=bn?.getShakeOffset()??{x:0,y:0},r=bn?{getUnitAlpha:m=>bn.getUnitAlpha(m.id)}:void 0,l=Array.isArray(Ie)&&Ie.length>0,u=yt.filter(m=>m.faction==="player"&&!m.isDead()),f=Qe?{coord:Qe.pos,range:Qe.auraRadius}:null,h=l?yt.filter(m=>m.faction!=="player"):yt;n.save(),(s.x!==0||s.y!==0)&&n.translate(s.x,s.y),Ww(n,ym,a.images,h,eu,{saunojas:{units:Ie,draw:wA,resolveRenderCoord:m=>{const p=gm(m);return p?p.renderCoord??p.coord:null}},sauna:Qe,saunaVision:f,fx:r,friendlyVisionSources:u}),n.restore()}const Yv=({policy:n})=>{Dt({type:"policy",message:`Sauna council toasts a fresh keg for policy: ${n.name}.`,metadata:{policy:n.id,name:n.name}})};ne.on(Bt.APPLIED,Yv);const $v=({unitId:n,attackerId:a,attackerFaction:s,unitFaction:r})=>{const l=yt.findIndex(v=>v.id===n),u=l!==-1?yt[l]:null,f=u?{q:u.coord.q,r:u.coord.r}:null,h=r==="player"?na.get(n)??null:null;let m=!1;if(r==="player"){const v=h??Ie.find(E=>mi.get(E.id)===n||E.id===n)??null;v&&(v.hp!==0&&(v.hp=0,m=!0),v.shield!==0&&(v.shield=0,m=!0))}const p=u?Nv(u,h):`unit ${n}`;let g=!1;if(s==="player"&&r&&r!=="player"){const v=a?Wi.get(a)??null:null,{xp:E,elite:M,boss:C}=_T(u);E>0&&CT(v,E,{source:"kill",label:p,elite:M,boss:C})&&(g=!0)}if(l!==-1&&(u&&Rv.clear(u,{snap:!0}),yt.splice(l,1),Wi.delete(n),HT(n),Lt()),(m||g)&&aa(),(r==="player"||g)&&Ht(),s==="player"&&r&&r!=="player"){const v=jv(u??null)||xv()<Ev,E=AC({factionId:r,elite:v});if(E.rolls.length>0){const M=Ie.find(C=>C.selected)??null;for(const C of E.rolls)if(Ro.addLoot(C,{unitId:M?.id,sourceTableId:E.tableId,equip:wm}).equipped){const N=M?.name??"our champion";Dt({type:"loot",message:`Quartermaster fastens ${C.item.name} to ${N}.`,metadata:{item:C.item.name,equipped:!0,owner:N,source:p}})}else Dt({type:"loot",message:`Quartermaster stores ${C.item.name} recovered from ${p}.`,metadata:{item:C.item.name,equipped:!1,source:p}})}}s==="player"&&r&&r!=="player"&&(Ve.addResource(se.SAUNAKUNNIA,bT),Ve.addResource(se.SISU,1),Dt({type:"resource",message:"Our grit surges — +1 SISU earned for the vanquished foe.",metadata:{resource:se.SISU,amount:1,context:"victory"}})),f&&Xt.revealAround(f,1,{autoFrame:!1});const b=r==="player"?"our":"a rival";Dt({type:"combat",message:`The steam hushes as ${b} ${p} grows still.`,metadata:{side:b,unit:p}})};ne.on("unitDied",$v);function Oh(){Pi=!1,gi?.offProgress(Tv),gi?.dispose(),gi=null,$i=0,ax(),Kn&&(Kn.destroy(),Kn=null),pi!==null&&(cancelAnimationFrame(pi),pi=null);try{Ve.save()}catch(n){console.warn("Failed to persist game state during cleanup",n)}try{aa()}catch(n){console.warn("Failed to persist Saunoja roster during cleanup",n)}bn&&(bn.dispose(),bn=null),ne.off(Bt.APPLIED,Yv),ne.off("unitDied",$v),ne.off("unitSpawned",kv),ne.off("inventoryChanged",Dv),ne.off("modifierAdded",Ps),ne.off("modifierRemoved",Ps),ne.off("modifierExpired",Ps),ne.off("unit:stats:changed",Ov),ne.off("saunaDamaged",Lv),ne.off("saunaDestroyed",Uv),ne.off("buildingPlaced",au),ne.off("buildingRemoved",au),Jn&&(Jn(),Jn=null),Qs&&(Qs.destroy(),Qs=null),kn&&(kn.dispose(),kn=null),La&&(La.dispose(),La=null),Ks&&(Ks.destroy(),Ks=null),Tt&&(Tt.destroy(),Tt=null),Na=null,Qi=null,wo=null,yo()}async function s_(){if(Pi)return;if(!nv()){console.error("Cannot start game without loaded assets.");return}Pi=!0,Ht(),Lt();try{await Wb(()=>{Lt()}).then(()=>{Lt()})}catch(r){console.warn("Failed to preload Saunoja icon before starting the game",r)}let a=performance.now();function s(r){if(!Pi)return;const l=r-a;a=r;const u=cm();Hv.tick(u?0:l),u?z2(0):(JT(),z2(l),qo()),Lt(),Pi&&(pi=requestAnimationFrame(s))}pi=requestAnimationFrame(s)}function yu(){let n=0;for(const a of yt)a.faction==="player"&&!a.isDead()&&(n+=1);return n}function r_(){const n={engaged:0,reserve:1,downed:2},a=Ie.map(s=>{const r=mi.get(s.id),l=r?Wi.get(r):void 0,u=l?!l.isDead()&&l.stats.health>0:!1,f=s.effectiveStats,h=s.baseStats,m=Math.round(l?Math.max(0,l.stats.health):Math.max(0,s.hp)),p=Math.round(l?Math.max(1,l.getMaxHealth()):Math.max(1,f.health)),g=Math.round(l?Math.max(0,l.stats.attackDamage):Math.max(0,f.attackDamage)),b=Math.round(l?Math.max(0,l.stats.attackRange):Math.max(0,f.attackRange)),v=Math.round(l?Math.max(0,l.stats.movementRange):Math.max(0,f.movementRange)),E=l?.stats.defense??f.defense??0,M=Math.round(Math.max(0,E)),C=l?l.getShield():f.shield??s.shield,R=Math.round(Math.max(0,C)),N=Math.max(0,Math.round(s.upkeep)),q=m<=0?"downed":u?"engaged":"reserve",I=Av(s),Y=s.items.map(oe=>({...oe})),Q=s.modifiers.map(oe=>({...oe})),ie=Ws.map(oe=>{const P=Lo(oe),G=s.equipment[oe],T=G?{id:G.id,name:G.name,description:G.description,icon:G.icon,rarity:G.rarity,quantity:G.quantity,slot:oe}:null,k=G?l_(G.modifiers,G.quantity):null;return{id:oe,label:P.label,description:P.description,maxStacks:P.maxStacks,item:T,modifiers:k}}),ee={health:Math.round(Math.max(0,h.health)),maxHealth:Math.round(Math.max(1,h.health)),attackDamage:Math.round(Math.max(0,h.attackDamage)),attackRange:Math.round(Math.max(0,h.attackRange)),movementRange:Math.round(Math.max(0,h.movementRange)),defense:typeof h.defense=="number"&&h.defense>0?Math.round(h.defense):void 0,shield:typeof h.shield=="number"&&h.shield>0?Math.round(h.shield):void 0};return{id:s.id,name:s.name,upkeep:N,status:q,selected:!!s.selected,traits:[...s.traits],stats:{health:m,maxHealth:p,attackDamage:g,attackRange:b,movementRange:v,defense:M>0?M:void 0,shield:R>0?R:void 0},baseStats:ee,progression:I,equipment:ie,items:Y,modifiers:Q}});return a.sort((s,r)=>{const l=n[s.status]-n[r.status];return l!==0?l:s.name.localeCompare(r.name,"en")}),a}function o_(){return Ie.length===0?null:Ie.find(n=>n.selected)??Ie.find(n=>n.hp>0)??Ie[0]}function l_(n,a){const s=Math.max(1,Math.round(a)),r={};return typeof n.health=="number"&&(r.health=n.health*s),typeof n.attackDamage=="number"&&(r.attackDamage=n.attackDamage*s),typeof n.attackRange=="number"&&(r.attackRange=n.attackRange*s),typeof n.movementRange=="number"&&(r.movementRange=n.movementRange*s),typeof n.defense=="number"&&(r.defense=n.defense*s),typeof n.shield=="number"&&(r.shield=n.shield*s),r}function c_(){const n=yu(),a=o_();let s=null;return a&&(s={id:a.id,name:a.name||"Saunoja",traits:[...a.traits],upkeep:Math.max(0,Math.round(a.upkeep)),progression:Av(a)}),{count:n,card:s}}function qo(n){const a=r_();Na=a,Tt&&Tt.renderRoster(a)}function Ht(){const n=c_();Tt?(Tt.updateSummary(n),Qi=null):Qi=n,qo()}function u_(n){const{overlay:a,resourceBar:s}=n,r=ar(a),{regions:l}=r,u=document.createElement("div");u.className="pointer-events-none absolute inset-0 grid place-items-center bg-[radial-gradient(circle_at_top,rgba(18,28,45,0.92),rgba(6,10,18,0.94))] p-[clamp(1.5rem,4vw,3.25rem)] z-overlay";const f=document.createElement("section");f.className="pointer-events-auto relative grid w-full max-w-[min(640px,90vw)] gap-4 overflow-hidden rounded-[28px] border border-[rgba(128,168,236,0.28)] bg-[linear-gradient(145deg,rgba(31,46,74,0.95),rgba(14,20,33,0.95))] p-[clamp(1.75rem,4vw,2.5rem)] text-slate-100 shadow-[0_40px_90px_rgba(10,14,28,0.6),_inset_0_1px_0_rgba(255,255,255,0.08)]",f.setAttribute("aria-live","polite"),f.setAttribute("role","status");const h=document.createElement("h1");h.className="m-0 text-[clamp(1.6rem,3vw,2.1rem)] font-semibold uppercase tracking-[0.04em]",h.textContent="Experimental HUD Enabled",f.appendChild(h);const m=document.createElement("p");m.className="m-0 text-base leading-relaxed text-slate-100/90",m.textContent="The React/Tailwind interface is bootstrapped for this session. Gameplay systems continue to run, and classic HUD elements are paused while the new shell is under construction.",f.appendChild(m);const p=document.createElement("p");p.className="m-0 text-sm leading-relaxed text-slate-200/75",p.textContent="Toggle the experimental HUD off from the quartermaster settings to return to the classic layout.",f.appendChild(p);const g=document.createElement("div");g.className="pointer-events-none absolute -left-[30%] -top-[40%] h-[420px] w-[420px] bg-[radial-gradient(circle,rgba(90,164,255,0.35),rgba(90,164,255,0))] blur-[0.5px]",f.appendChild(g);const b=document.createElement("div");return b.className="mt-2 rounded-[18px] border border-[rgba(128,168,236,0.2)] bg-[rgba(10,16,26,0.55)] p-4 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]",b.appendChild(s),f.appendChild(b),u.appendChild(f),l.content.appendChild(u),{destroy(){b.contains(s)&&a.prepend(s),u.remove()}}}function Vv(n){if(!n)return{showLoader:()=>({update:()=>{},clear:()=>{},dispose:()=>{}}),showBanner:()=>null,removeTransientUI:()=>{}};const a=()=>{let f=n.querySelector(".hud-banner-stack");return f||(f=document.createElement("div"),f.className="hud-banner-stack",n.append(f)),f},s=(f,h,m)=>{let p=!1;const g=()=>{p||(p=!0,f.removeEventListener("transitionend",g),m())};f.addEventListener("transitionend",g),requestAnimationFrame(()=>{f.classList.add(h)}),window.setTimeout(g,400)};return{showLoader:(f="Heating the sauna stones…")=>{const h=document.createElement("div");h.className="hud-loader",h.setAttribute("role","status"),h.setAttribute("aria-live","polite");const m=document.createElement("div");m.className="hud-loader__card";const p=document.createElement("div");p.className="hud-loader__spinner",p.setAttribute("aria-hidden","true");const g=document.createElement("p");g.className="hud-loader__message",g.textContent=f,m.append(p,g),h.append(m),n.append(h);let b=!1;return{update(v){g.textContent=v},clear(){b||s(h,"hud-loader--hidden",()=>{b=!0,h.remove()})},dispose(){b||(b=!0,h.remove())}}},showBanner:(f,h)=>{const m=a(),p=document.createElement("section");p.className=`hud-banner hud-banner--${f}`,p.setAttribute("role",f==="error"?"alert":"status"),p.setAttribute("aria-live",f==="error"?"assertive":"polite");const g=document.createElement("header");g.className="hud-banner__header";const b=document.createElement("p");b.className="hud-banner__title",b.textContent=h.title??(f==="error"?"Attention required":f==="warning"?"Heads up":"Status update"),g.append(b);const v=document.createElement("ul");v.className="hud-banner__list";for(const R of h.messages){const N=document.createElement("li");N.textContent=R,v.append(N)}if(p.append(g),h.messages.length&&p.append(v),h.actions?.length){const R=document.createElement("div");R.className="hud-banner__actions";for(const N of h.actions){const q=document.createElement("button");q.type="button",q.className=N.variant==="secondary"?"hud-banner__button hud-banner__button--secondary":"hud-banner__button",q.textContent=N.label,q.addEventListener("click",()=>{N.onClick()}),R.append(q)}p.append(R)}let E,M=!1;const C=()=>{M||(M=!0,E&&window.clearTimeout(E),s(p,"hud-banner--hide",()=>{p.remove(),m.hasChildNodes()||m.remove()}))};if(h.dismissible!==!1){const R=document.createElement("button");R.type="button",R.className="hud-banner__close",R.setAttribute("aria-label","Dismiss notification"),R.textContent="×",R.addEventListener("click",()=>{C()}),g.append(R)}return m.append(p),h.autoCloseMs&&h.autoCloseMs>0&&(E=window.setTimeout(()=>C(),h.autoCloseMs)),{element:p,dismiss:C}},removeTransientUI:()=>{n.querySelectorAll(".hud-loader").forEach(f=>{f.remove()}),n.querySelectorAll(".hud-banner-stack").forEach(f=>{f.remove()})}}}async function d_(n){const a=Object.entries(n),s=await Promise.allSettled(a.map(([f,h])=>h.load().then(m=>({key:f,descriptor:h,value:m})))),r={},l=[],u=[];return s.forEach((f,h)=>{const[m,p]=a[h],g=p.label??String(m);if(f.status==="fulfilled"){const{value:v}=f.value;if(r[m]=v.value,v.warnings?.length)for(const E of v.warnings)l.push(g?`${g}: ${E}`:E);if(v.errors?.length)for(const E of v.errors)u.push(g?`${g}: ${E}`:E);return}const b=f_(f.reason);u.push(g?`${g}: ${b}`:b)}),{resources:r,warnings:l,errors:u}}function f_(n){if(n instanceof Error)return n.message;if(typeof n=="string")return n;try{return JSON.stringify(n)}catch{return String(n)}}const h_="Heating the sauna stones…",m_="Polishing sauna ambience…";function p_(n){if(n instanceof Error&&n.message)return n.message;if(typeof n=="string"&&n.trim().length>0)return n;try{return JSON.stringify(n)}catch{return String(n)}}function g_(n){const a=new Set,s=f=>{a.forEach(h=>h(f))},r=n.formatError??p_;return{run:async f=>{s({type:"status",phase:"start",message:h_});try{const{resources:h,warnings:m,errors:p}=await d_({assets:{label:"Core assets",load:async()=>{const b=await n.loadAssets(n.assetPaths);return{value:b.assets,errors:b.failures}}},saunojaIcon:{label:"Saunoja icon",load:async()=>{try{return await n.preloadSaunojaIcon(),{value:!0}}catch(b){return{value:!1,warnings:[`Unable to preload Saunoja icon (${r(b)})`]}}}}});if(n.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"status",phase:"progress",message:m_});const g=h.assets;if(!g){const b=p.length?[...p]:["Critical assets were unavailable. Please refresh to try again."];s({type:"fatal",messages:b});return}if(p.length&&s({type:"errors",errors:p}),m.length&&s({type:"warnings",warnings:m}),n.setAssets(g),n.shouldAbort?.(f)){s({type:"cancelled"});return}n.startGame(),s({type:"ready",assets:g,warnings:m,errors:p})}catch(h){if(n.shouldAbort?.(f)){s({type:"cancelled"});return}s({type:"failure",error:h,message:r(h)})}},subscribe:f=>(a.add(f),()=>{a.delete(f)})}}const y_="grabbing";function b_(n,a){const s=a.dragCursor??y_;let r=!1,l=null,u=0,f=0,h=null;const m=E=>{E.pointerType!=="mouse"||E.button!==0||(r=!0,l=E.pointerId,u=E.clientX,f=E.clientY,h=n.style.cursor??"",n.setPointerCapture?.(E.pointerId),n.style.cursor=s,a.onPanStart?.(E))},p=E=>{if(!r||l!==E.pointerId)return;const M=E.clientX-u,C=E.clientY-f;u=E.clientX,f=E.clientY,a.onPan(M,C,E)},g=E=>{!r||l!==E.pointerId||(r=!1,l=null,n.releasePointerCapture?.(E.pointerId),n.style.cursor=h??"",a.onPanEnd?.(E))},b=E=>{g(E)},v=E=>{g(E)};return n.addEventListener("pointerdown",m),n.addEventListener("pointermove",p),n.addEventListener("pointerup",b),n.addEventListener("pointercancel",v),n.addEventListener("pointerleave",v),()=>{n.removeEventListener("pointerdown",m),n.removeEventListener("pointermove",p),n.removeEventListener("pointerup",b),n.removeEventListener("pointercancel",v),n.removeEventListener("pointerleave",v),r&&l!==null&&n.releasePointerCapture?.(l),n.style.cursor=h??""}}const v_=10,S_=250;function Gi(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function E_(n,a){const s=a.tapMaxMovement??v_,r=a.tapMaxDuration??S_;let l=null;const u=b=>{if(b.touches.length===1){const v=b.touches[0];l={mode:"pan",lastX:v.clientX,lastY:v.clientY,startX:v.clientX,startY:v.clientY,startTime:Gi(),moved:!1};return}if(b.touches.length>=2){const[v,E]=[b.touches[0],b.touches[1]];l={mode:"pinch",lastCenterX:(v.clientX+E.clientX)/2,lastCenterY:(v.clientY+E.clientY)/2,lastDistance:Math.hypot(v.clientX-E.clientX,v.clientY-E.clientY),startTime:Gi(),moved:!1}}},f=(b,v)=>{if(!l||l.mode!=="pan")return;const E=b.clientX-l.lastX,M=b.clientY-l.lastY;!l.moved&&Math.hypot(E,M)>1&&(l.moved=!0),l.lastX=b.clientX,l.lastY=b.clientY,a.onPan(E,M,v)},h=(b,v,E)=>{const M=(b.clientX+v.clientX)/2,C=(b.clientY+v.clientY)/2,R=Math.hypot(b.clientX-v.clientX,b.clientY-v.clientY);let N=1,q=0,I=0;l&&l.mode==="pinch"?(N=R/l.lastDistance,q=M-l.lastCenterX,I=C-l.lastCenterY):l={mode:"pinch",lastCenterX:M,lastCenterY:C,lastDistance:R,startTime:Gi(),moved:!1},!(!l||l.mode!=="pinch")&&(l.lastCenterX=M,l.lastCenterY=C,l.lastDistance=R,l.moved=!0,a.onPinch({centerX:M,centerY:C,scale:N,deltaCenterX:q,deltaCenterY:I},E))},m=b=>{if(!l||b.touches.length===0)return;if(b.preventDefault(),b.touches.length===1){const M=b.touches[0];l.mode!=="pan"&&(l={mode:"pan",lastX:M.clientX,lastY:M.clientY,startX:M.clientX,startY:M.clientY,startTime:Gi(),moved:!0}),f(M,b);return}const[v,E]=[b.touches[0],b.touches[1]];h(v,E,b)},p=()=>!l||l.mode!=="pan"||Math.hypot(l.lastX-l.startX,l.lastY-l.startY)>s?!1:Gi()-l.startTime<=r,g=b=>{if(l){if(b.touches.length===0){l.mode==="pan"&&a.onTap&&p()&&a.onTap({x:l.startX,y:l.startY},b),l=null;return}if(b.touches.length===1){const v=b.touches[0];l={mode:"pan",lastX:v.clientX,lastY:v.clientY,startX:v.clientX,startY:v.clientY,startTime:Gi(),moved:!0};return}if(b.touches.length>=2){const[v,E]=[b.touches[0],b.touches[1]];l={mode:"pinch",lastCenterX:(v.clientX+E.clientX)/2,lastCenterY:(v.clientY+E.clientY)/2,lastDistance:Math.hypot(v.clientX-E.clientX,v.clientY-E.clientY),startTime:Gi(),moved:!0}}}};return n.addEventListener("touchstart",u,{passive:!1}),n.addEventListener("touchmove",m,{passive:!1}),n.addEventListener("touchend",g),n.addEventListener("touchcancel",g),()=>{n.removeEventListener("touchstart",u),n.removeEventListener("touchmove",m),n.removeEventListener("touchend",g),n.removeEventListener("touchcancel",g),l=null}}const M_=.5,x_=3.5;function qh(n,a,s,r,l){const u=n.getBoundingClientRect(),f=a-u.left,h=s-u.top,m=u.width/2,p=u.height/2;return{x:l.x+(f-m)/r,y:l.y+(h-p)/r}}function w_(n){return Math.min(x_,Math.max(M_,n))}function Xv(n,a,s,r=Ee.zoom,l=Ee){return qh(n,a,s,r,l)}function Kv(n,a,s,r){const l=w_(r);if(l===Ee.zoom)return;const u={x:Ee.x,y:Ee.y},f=qh(n,a,s,Ee.zoom,u),h=qh(n,a,s,l,u);Ee.x+=f.x-h.x,Ee.y+=f.y-h.y,Ee.zoom=l,Lt()}function lh(n,a){n===0&&a===0||(Ee.x-=n/Ee.zoom,Ee.y-=a/Ee.zoom,Lt())}function A_(n){const a=window.devicePixelRatio||1,s=Math.max(window.innerWidth,1),r=Math.max(window.innerHeight,1);n.style.width=`${s}px`,n.style.height=`${r}px`,n.width=Math.round(s*a),n.height=Math.round(r*a);const l=n.getContext("2d");l&&l.setTransform(1,0,0,1,0,0),Lt()}const C_=.0015,zh=[];let Am=0,Ua=null,bu=Vv(null),kt=null,ch="classic",Bh=null;function T_(){if(typeof document>"u")return;const n=document.querySelector("[data-build-commit]");if(!n)return;const a="f420883".trim(),s=a.length>0&&a!=="unknown",r=s?`#${a}`:"DEV BUILD";n.textContent=r,n.dataset.state=s?"commit":"dev";const l=n.closest("#build-id");if(l){const u=s?`Build commit ${a}`:"Development build";l.setAttribute("aria-label",u),l.title=s?`Autobattles build ${a}`:"Unversioned development build",l.dataset.buildState=s?"release":"development"}}T_();function ka(n){zh.push(n)}function __(){for(;zh.length;){const n=zh.pop();try{n?.()}catch(a){console.error("Error during cleanup",a)}}}function R_(n){ka(()=>n.dispose())}function wc(n,a){const s=bu.showBanner(n,a);s&&ka(()=>s.dismiss())}function N_(n){switch(n.type){case"status":if(n.phase==="start"){kt?.dispose();const a=bu.showLoader(n.message);kt=a,R_(a)}else kt&&(kt.update(n.message),kt.clear(),kt=null);break;case"ready":kt?.clear(),kt=null;break;case"warnings":n.warnings.length&&(console.warn("Resource loader warnings",n.warnings),wc("warning",{title:"Heads up",messages:n.warnings,autoCloseMs:12e3}));break;case"errors":n.errors.length&&(console.error("Resource loader errors",n.errors),wc("error",{title:"Some resources failed to load",messages:n.errors,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]}));break;case"fatal":console.error("Critical assets failed to load",n.messages),kt?.clear(),kt=null,wc("error",{title:"Unable to start the sauna battle",messages:n.messages,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}],dismissible:!1});break;case"failure":console.error("Failed to initialize resources",n.error),kt?.clear(),kt=null,wc("error",{title:"Failed to initialize",messages:[n.message],actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]});break;case"cancelled":kt?.dispose(),kt=null;break}}const Qv=g_({assetPaths:LC,loadAssets:rE,preloadSaunojaIcon:Wb,setAssets:UC,startGame:s_,shouldAbort:n=>n!==Am});Qv.subscribe(N_);function B2(n){if(!Ua)return;n.preventDefault();const a=Math.exp(-n.deltaY*C_),s=Ee.zoom*a;Kv(Ua,n.clientX,n.clientY,s)}function H2(n){if(!Ua)return;const a=Xv(Ua,n.clientX,n.clientY);Fv(a)}function k_(n){n.addEventListener("click",H2),ka(()=>n.removeEventListener("click",H2)),n.addEventListener("wheel",B2,{passive:!1}),ka(()=>n.removeEventListener("wheel",B2));const a=b_(n,{onPan:(r,l)=>{lh(r,l)},dragCursor:"grabbing"});ka(a);const s=E_(n,{onPan:(r,l)=>{lh(r,l)},onPinch:({centerX:r,centerY:l,scale:u,deltaCenterX:f,deltaCenterY:h})=>{Kv(n,r,l,Ee.zoom*u),lh(f,h)},onTap:r=>{const l=Xv(n,r.x,r.y);Fv(l)}});ka(s)}function D_(){Am+=1,__(),Bh?.destroy(),Bh=null,kt?.dispose(),kt=null,Ua&&(Ua.style.cursor=""),Ua=null,bu.removeTransientUI(),Oh()}function L_(){const n=document.getElementById("game-canvas"),a=document.getElementById("resource-bar"),s=document.getElementById("ui-overlay");if(!n||!a||!s){console.error("Autobattles4xFinsauna shell is missing the required canvas, overlay, or resource bar elements.",{hasCanvas:!!n,hasResourceBar:!!a,hasOverlay:!!s});return}Ua&&D_();const r=++Am;ch=mv().useUiV2?"v2":"classic",Ua=n,bu=Vv(s);const u=Ax();ka(()=>u.dispose()),qT(n,a,s,{hudVariant:ch}),ch==="v2"&&(Bh=u_({overlay:s,resourceBar:a})),k_(n);const f=()=>A_(n);window.addEventListener("resize",f),ka(()=>window.removeEventListener("resize",f)),window.addEventListener("beforeunload",Oh),ka(()=>window.removeEventListener("beforeunload",Oh)),f(),import.meta.vitest||Qv.run(r)}function U_(){if(typeof document>"u")return;const n=()=>{document.removeEventListener("DOMContentLoaded",n),L_()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",n);return}n()}import.meta.vitest||U_();
