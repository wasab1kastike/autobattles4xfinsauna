(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();class Sl{listeners=new Map;on(t,n){const s=this.listeners.get(t)??[];s.push(n),this.listeners.set(t,s)}off(t,n){const s=this.listeners.get(t);if(!s)return;const a=s.indexOf(n);a!==-1&&(s.splice(a,1),s.length===0?this.listeners.delete(t):this.listeners.set(t,s))}emit(t,n){const s=this.listeners.get(t);if(s)for(const a of s)a(n)}}const R=new Sl;class mr{type="farm";cost=50;beerPerTick=1}class vi{type="barracks";cost=100;trainingCapacity=1}const bi=Math.sqrt(3),wi=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function ft(e,t){return{x:t*bi*(e.q+e.r/2),y:t*(3/2)*e.r}}function qn(e,t,n){const s=(bi/3*e-.3333333333333333*t)/n,a=2/3*t/n;return{q:s,r:a}}function Cl(e,t,n){return xl(qn(e,t,n))}function Us(e){return wi.map(t=>({q:e.q+t.q,r:e.r+t.r}))}function gn(e,t){const n=-e.q-e.r,s=-t.q-t.r;return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(n-s))}function xl(e){let t=e.q,n=e.r,s=-t-n,a=Math.round(t),r=Math.round(s),o=Math.round(n);const i=Math.abs(a-t),c=Math.abs(r-s),u=Math.abs(o-n);return i>c&&i>u?a=-r-o:c>u?r=-a-o:o=-a-r,{q:a,r:o}}const zs=new Set;let Fs=32;function Bl(e){return`${e.q},${e.r}`}function Ya(e,t){Fs=t,zs.add(Bl(e))}function Pl(e){if(zs.size===0)return{center:{x:0,y:0},zoom:1};const t=Fs*Math.sqrt(3),n=Fs*2,s=t/2,a=n/2;let r=1/0,o=1/0,i=-1/0,c=-1/0;for(const C of zs){const[S,F]=C.split(",").map(Number),{x:H,y:T}=ft({q:S,r:F},Fs),Q=H-s,I=T-a;r=Math.min(r,Q),o=Math.min(o,I),i=Math.max(i,Q+t),c=Math.max(c,I+n)}const u=i-r,l=c-o,d=96,h={x:r+u/2,y:o+l/2},f=Math.max(0,Math.min(e.safeRight??0,e.width)),A=Math.max(e.width-f,1)/(u+d*2),g=e.height/(l+d*2),p=Math.min(A,g);return{center:{x:p>0?h.x-f/(2*p):h.x,y:h.y},zoom:p}}const X={x:0,y:0,zoom:1};function kl(e,t=300){const n=X.x,s=X.y,a=X.zoom,r=typeof performance<"u"?performance.now():Date.now(),o=i=>{const c=Math.min((i-r)/t,1);X.x=n+(e.center.x-n)*c,X.y=s+(e.center.y-s)*c,X.zoom=a+(e.zoom-a)*c,c<1&&(typeof requestAnimationFrame<"u"?requestAnimationFrame(o):setTimeout(()=>o(typeof performance<"u"?performance.now():Date.now()),16))};typeof requestAnimationFrame<"u"?requestAnimationFrame(o):setTimeout(()=>o(typeof performance<"u"?performance.now():Date.now()),0)}function Rl(){zs.clear()}async function Ml(e){const t={},n={},s=[],a=Object.entries(e.images??{}).map(([o,i])=>new Promise(c=>{const u=new Image;u.onload=()=>{t[o]=u,c()},u.onerror=()=>{const l=`Failed to load image: ${i}`;console.error(l),s.push(l),c()},u.src=i})),r=Object.entries(e.sounds??{}).map(([o,i])=>new Promise(c=>{const u=new Audio;u.oncanplaythrough=()=>{n[o]=u,c()},u.onerror=()=>{const l=`Failed to load sound: ${i}`;console.error(l),s.push(l),c()},u.src=i,u.load()}));return await Promise.all([...a,...r]),{assets:{images:t,sounds:n},failures:s}}function gr(e){if(typeof globalThis.localStorage>"u")return;const t=globalThis.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(n){console.warn(`Failed to parse data for "${e}", clearing`,n),globalThis.localStorage.removeItem(e);return}}var k=(e=>(e.SAUNA_BEER="sauna-beer",e.SAUNAKUNNIA="saunakunnia",e.SISU="sisu",e))(k||{});const ms={"sauna-beer":1,saunakunnia:0,sisu:0},yi="/assets/sauna-beer-CgafwOhX.svg",Ei="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eResource%20Icon%3c/title%3e%3cdesc%20id='desc'%3eA%20luminous%20crest%20symbolising%20generic%20resources.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='resource-bg'%20cx='50%25'%20cy='50%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='resource-core'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2338bdf8'%20/%3e%3c/linearGradient%3e%3cfilter%20id='resource-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='6'%20flood-color='%2338bdf8'%20flood-opacity='0.45'%20/%3e%3c/filter%3e%3c/defs%3e%3cg%20filter='url(%23resource-glow)'%3e%3ccircle%20cx='32'%20cy='32'%20r='22'%20fill='%230f172a'%20stroke='url(%23resource-bg)'%20stroke-width='4'%20/%3e%3cpath%20d='M32%2016l-12%2014%2012%2022%2012-22z'%20fill='url(%23resource-core)'%20stroke='%23f8fafc'%20stroke-width='2'%20/%3e%3cpath%20d='M20%2030l-4%208%2016%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M44%2030l4%208-16%2010'%20fill='none'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/g%3e%3c/svg%3e",Si="/assets/saunoja-roster-Bfn4ZKxh.svg",De={APPLIED:"policy:applied",REJECTED:"policy:rejected"},Ci=[{id:"eco",name:"Evergreen Eco Mandate",description:"Increase passive sauna beer brewing by one bottle each production tick.",cost:15,resource:k.SAUNAKUNNIA,prerequisites:[],visuals:{icon:Ei,gradient:"linear-gradient(135deg, rgba(66, 240, 155, 0.9), rgba(13, 114, 234, 0.85))",accentColor:"#34d399",badges:["Economy","Sustainability"],flair:"Green-lit by the council of whisked sauna masters."},effects:[{event:De.APPLIED,once:!0,invoke:({state:e})=>{e.modifyPassiveGeneration(k.SAUNA_BEER,1)}}],spotlight:"Sustainably expand your brewing line with solar-heated mash tuns."},{id:"temperance",name:"Aurora Temperance Treaty",description:"Boost night shift work speed by 5% once the eco initiative is live.",cost:25,resource:k.SAUNAKUNNIA,prerequisites:[{description:"Enact the Evergreen Eco Mandate.",isSatisfied:e=>e.hasPolicy("eco")},{description:"Stockpile at least 30 Sauna Beer bottles to brief the midnight crews.",isSatisfied:e=>e.getResource(k.SAUNA_BEER)>=30}],visuals:{icon:Si,gradient:"linear-gradient(140deg, rgba(46, 51, 227, 0.9), rgba(118, 75, 162, 0.85))",accentColor:"#6366f1",badges:["Discipline","Night Ops"],flair:"Whispers of aurora spirits keep the crew laser-focused after dusk."},effects:[{event:De.APPLIED,once:!0,invoke:({state:e})=>{e.nightWorkSpeedMultiplier=Number((e.nightWorkSpeedMultiplier*1.05).toFixed(4))}}],spotlight:"Glow-lit helmets and synchronized chants keep the late shift on tempo."},{id:"steam-diplomats",name:"Steam Diplomats Accord",description:"Import two additional sauna beer bottles per tick via gilded trade routes.",cost:35,resource:k.SAUNAKUNNIA,prerequisites:[{description:"Secure the Aurora Temperance Treaty for your envoys.",isSatisfied:e=>e.hasPolicy("temperance")},{description:"Hold a reserve of 50 Sauna Beer bottles to fund the embassy festivities.",isSatisfied:e=>e.getResource(k.SAUNA_BEER)>=50}],visuals:{icon:yi,gradient:"linear-gradient(150deg, rgba(255, 173, 94, 0.92), rgba(255, 99, 71, 0.85))",accentColor:"#fb923c",badges:["Diplomacy","Logistics"],flair:"Silver samovars arrive with diplomatic steam-born delights."},effects:[{event:De.APPLIED,once:!0,invoke:({state:e})=>{e.modifyPassiveGeneration(k.SAUNA_BEER,2)}}],spotlight:"Trade envoys pipe artisanal steam through every new supply line."}],xi=new Map;for(const e of Ci)xi.set(e.id,e);function Bi(){return Ci}function Kr(e){return xi.get(e)}const Pi="progression:ngPlusState",ca=5,ki=1831565813,vn=Object.freeze({aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1}),Ls=Object.freeze({runSeed:0,ngPlusLevel:0,unlockSlots:0,enemyTuning:vn});function ya(e,t,n,s){const a=Number(e);return Number.isFinite(a)?Math.min(n,Math.max(t,a)):s}function pr(e){return{aggressionMultiplier:ya(e?.aggressionMultiplier,.25,6,vn.aggressionMultiplier),cadenceMultiplier:ya(e?.cadenceMultiplier,.25,4,vn.cadenceMultiplier),strengthMultiplier:ya(e?.strengthMultiplier,.25,6,vn.strengthMultiplier)}}function Ri(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(e){return console.warn("Local storage unavailable for NG+ state",e),null}}function Vr(e,t,n){const s=Number.isFinite(e)?e:Number(e);if(!Number.isFinite(s))return t;const a=Math.trunc(s);return Math.min(n,Math.max(t,a))}function Mi(e){const t=Number.isFinite(e)?e:Number(e);return!Number.isFinite(t)||t===0?0:Math.trunc(Math.abs(t))}function Di(e=Math.random){let t=e();(!Number.isFinite(t)||t<=0||t>=1)&&(t=Math.random());const n=Math.floor(t*4294967295);return n===0?ki:n}function Rt(e={}){const t=Ls,n=Mi(e.runSeed??t.runSeed),s=Vr(e.ngPlusLevel??t.ngPlusLevel,0,Number.MAX_SAFE_INTEGER),a=Vr(e.unlockSlots??t.unlockSlots,0,ca),r=pr(e.enemyTuning??t.enemyTuning);return{runSeed:n,ngPlusLevel:s,unlockSlots:a,enemyTuning:r}}function Ct(e,t=Math.random){const n=Rt(e);return n.runSeed!==0?n:Rt({...n,runSeed:Di(t)})}function Dl(e=Math.random){const t=Ri();if(!t)return Ct(Ls,e);const n=t.getItem(Pi);if(!n)return Ct(Ls,e);try{const s=JSON.parse(n);return Ct(Rt(s),e)}catch(s){return console.warn("Failed to parse NG+ state",s),Ct(Ls,e)}}function Ka(e){const t=Ri();if(!t)return;const n=Rt(e);t.setItem(Pi,JSON.stringify(n))}function Il(e,t){const n=Rt(e),s=typeof t.random=="function"?t.random:Math.random;let a=n.ngPlusLevel,r=n.unlockSlots;if(t.outcome==="win"){a+=1;const i=Math.max(0,Math.trunc(t.bonusUnlocks??1));i>0&&(r=Math.min(ca,r+i))}const o=Di(s);return Ct(Rt({runSeed:o,ngPlusLevel:a,unlockSlots:r,enemyTuning:n.enemyTuning}),s)}function Tl(e){const t=Math.max(0,e.ngPlusLevel),n=Math.max(0,e.unlockSlots)*.02;return Math.min(3,1+t*.12+n)}function Hl(e){const t=Math.max(0,e.ngPlusLevel),n=Math.max(0,e.unlockSlots)*.01,s=.1+t*.05+n;return Math.max(0,Math.min(.85,s))}function Fl(e){const t=Math.max(0,e.ngPlusLevel),n=Math.max(.5,1+t*.25),s=pr(e.enemyTuning??vn);return Math.max(.25,Math.min(8,n*s.aggressionMultiplier))}function Ll(e){return 1+Math.max(0,e.unlockSlots)}function Ql(e){return pr(e.enemyTuning??vn)}function Zr(e,t=0){let n=Mi(e)^(t|0);return n===0&&(n=ki^(t|0)),()=>{n=n+1831565813|0;let s=Math.imul(n^n>>>15,1|n);return s^=s+Math.imul(s^s>>>7,61|s),((s^s>>>14)>>>0)/4294967296}}function Ea(e){return`${e.q},${e.r}`}const Ii={farm:()=>new mr,barracks:()=>new vi};function Nl(e){return Ii[e]?.()}const _r=Object.freeze({aggression:1,cadence:1,strength:1});function bn(e,t,n,s){const a=Number(e);return Number.isFinite(a)?Math.min(n,Math.max(t,a)):s}function Jr(e,t){return{aggression:bn(t.aggression??e.aggression,.1,8,e.aggression),cadence:bn(t.cadence??e.cadence,.25,6,e.cadence),strength:bn(t.strength??e.strength,.25,12,e.strength)}}class Gl{constructor(t,n="gameState"){this.tickInterval=t,this.storageKey=n}resources={[k.SAUNA_BEER]:0,[k.SAUNAKUNNIA]:0,[k.SISU]:0};passiveGeneration={...ms};lastSaved=Date.now();buildings={};buildingPlacements=new Map;policies=new Set;nightWorkSpeedMultiplier=1;enemyScaling={..._r};enemyCalmSecondsRemaining=0;ngPlus=Rt();tick(){Object.keys(this.passiveGeneration).forEach(t=>{this.addResource(t,this.passiveGeneration[t])})}save(){this.lastSaved=Date.now();const t={};this.buildingPlacements.forEach((a,r)=>{t[r]=a.type});const n={resources:this.resources,lastSaved:this.lastSaved,buildings:this.buildings,buildingPlacements:t,policies:Array.from(this.policies),passiveGeneration:{...this.passiveGeneration},nightWorkSpeedMultiplier:this.nightWorkSpeedMultiplier,enemyScaling:{...this.enemyScaling},ngPlus:this.ngPlus},s=typeof localStorage<"u"&&localStorage?localStorage:void 0;if(!s){console.warn("GameState.save: localStorage is unavailable, skipping persistence.");return}try{s.setItem(this.storageKey,JSON.stringify(n))}catch(a){console.warn("GameState.save: Failed to persist state to localStorage.",a)}}load(t){const n=gr(this.storageKey);if(!n)return this.lastSaved=Date.now(),!1;this.resources={...this.resources,...n.resources??{}},Object.keys(this.resources).forEach(c=>{Number.isFinite(this.resources[c])||(this.resources[c]=0)}),this.enemyScaling=Jr(_r,n.enemyScaling??{}),this.enemyCalmSecondsRemaining=0;const s={};Object.entries(n.buildings??{}).forEach(([c,u])=>{Ii[c]&&(s[c]=u)}),this.buildings=s,this.buildingPlacements.clear(),n.buildingPlacements&&Object.entries(n.buildingPlacements).forEach(([c,u])=>{const l=Nl(u);if(!l)return;this.buildingPlacements.set(c,l);const[d,h]=c.split(",").map(Number);if(t){const f=t.ensureTile(d,h);f.placeBuilding(l.type),f.reveal(),Ya({q:d,r:h},t.hexSize)}R.emit("buildingPlaced",{building:l,coord:{q:d,r:h},state:this})}),this.lastSaved=n.lastSaved??Date.now();const a=n.ngPlus?Rt(n.ngPlus):this.ngPlus;if(this.ngPlus=Ct(a),this.policies=new Set,this.passiveGeneration={...ms},this.nightWorkSpeedMultiplier=1,(Array.isArray(n.policies)?n.policies.filter(c=>typeof c=="string"):[]).forEach(c=>{const u=Kr(c);u&&(this.policies.add(u.id),R.emit(De.APPLIED,{policy:u,state:this}))}),n.passiveGeneration){const c={...ms};Object.keys(ms).forEach(u=>{const l=n.passiveGeneration?.[u];typeof l=="number"&&Number.isFinite(l)&&(c[u]=l)}),this.passiveGeneration=c}typeof n.nightWorkSpeedMultiplier=="number"&&Number.isFinite(n.nightWorkSpeedMultiplier)&&(this.nightWorkSpeedMultiplier=n.nightWorkSpeedMultiplier);const o=Date.now()-this.lastSaved,i=Math.floor(o/this.tickInterval);return Object.keys(this.passiveGeneration).forEach(c=>{this.resources[c]+=i*this.passiveGeneration[c]}),!0}getResource(t){return this.resources[t]}canAfford(t,n=k.SAUNA_BEER){return this.resources[n]>=t}spendResource(t,n=k.SAUNA_BEER){return this.spend(t,n)}spend(t,n=k.SAUNA_BEER){return this.canAfford(t,n)?(this.resources[n]-=t,R.emit("resourceChanged",{resource:n,amount:-t,total:this.resources[n]}),!0):!1}addResource(t,n){this.resources[t]+=n,R.emit("resourceChanged",{resource:t,amount:n,total:this.resources[t]})}modifyPassiveGeneration(t,n){this.passiveGeneration[t]=(this.passiveGeneration[t]??0)+n}setEnemyScalingBase(t){return this.enemyScaling=Jr(this.enemyScaling,t),{...this.enemyScaling}}applyEnemyScalingModifiers(t){const n={aggression:bn(this.enemyScaling.aggression*(t.aggression??1),.1,8,this.enemyScaling.aggression),cadence:bn(this.enemyScaling.cadence*(t.cadence??1),.25,6,this.enemyScaling.cadence),strength:bn(this.enemyScaling.strength*(t.strength??1),.25,12,this.enemyScaling.strength)};return this.enemyScaling=n,{...this.enemyScaling}}getEnemyScalingSnapshot(){return{...this.enemyScaling,calmSecondsRemaining:Math.max(0,this.enemyCalmSecondsRemaining)}}requestEnemyCalm(t){const n=Number(t);return!Number.isFinite(n)||n<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(this.enemyCalmSecondsRemaining,n),this.enemyCalmSecondsRemaining)}advanceEnemyCalm(t){const n=Number(t);return!Number.isFinite(n)||n<=0?this.enemyCalmSecondsRemaining:(this.enemyCalmSecondsRemaining=Math.max(0,this.enemyCalmSecondsRemaining-n),this.enemyCalmSecondsRemaining)}clearEnemyCalm(){this.enemyCalmSecondsRemaining=0}construct(t,n,s=k.SAUNA_BEER){return this.spend(n,s)?(this.buildings[t]=(this.buildings[t]??0)+1,!0):!1}placeBuilding(t,n,s,a=k.SAUNA_BEER){const r=s.getTile(n.q,n.r);return!r||r.building||!this.construct(t.type,t.cost,a)?!1:(this.buildingPlacements.set(Ea(n),t),r.placeBuilding(t.type),R.emit("buildingPlaced",{building:t,coord:n,state:this}),!0)}getBuildingAt(t){return this.buildingPlacements.get(Ea(t))}removeBuilding(t,n){const s=Ea(t),a=this.buildingPlacements.get(s);return a?(this.buildingPlacements.delete(s),n.getTile(t.q,t.r)?.placeBuilding(null),this.buildings[a.type]!==void 0&&(this.buildings[a.type]-=1,this.buildings[a.type]<=0&&delete this.buildings[a.type]),R.emit("buildingRemoved",{building:a,coord:t,state:this}),!0):!1}upgrade(t,n,s=k.SAUNA_BEER){return this.construct(`upgrade:${t}`,n,s)}applyPolicy(t){const n=Kr(t);if(!n){const r={policyId:t,state:this,reason:"unknown-policy"};return R.emit(De.REJECTED,r),!1}if(this.hasPolicy(n.id)){const r={policyId:n.id,policy:n,state:this,reason:"already-applied"};return R.emit(De.REJECTED,r),!1}const s=n.prerequisites.filter(r=>!r.isSatisfied(this));if(s.length>0){const r={policyId:n.id,policy:n,state:this,reason:"prerequisites-not-met",missingPrerequisites:s};return R.emit(De.REJECTED,r),!1}if(!this.spend(n.cost,n.resource)){const r={policyId:n.id,policy:n,state:this,reason:"insufficient-resources"};return R.emit(De.REJECTED,r),!1}this.policies.add(n.id);const a={policy:n,state:this};return R.emit(De.APPLIED,a),!0}hasPolicy(t){return this.policies.has(t)}getNgPlusState(){return{...this.ngPlus}}setNgPlusState(t){const n=Rt({...this.ngPlus,...t});return this.ngPlus=Ct(n),this.ngPlus}}class Ol{constructor(t,n){this.baseInterval=t,this.onTick=n}timer=null;speed=1;lastTick=0;accumulator=0;start(){this.stop(),this.lastTick=Date.now();const t=this.baseInterval/this.speed;this.timer=setInterval(()=>{const n=Date.now(),s=n-this.lastTick;this.lastTick=n,this.onTick(s)},t)}stop(){this.timer!==null&&(clearInterval(this.timer),this.timer=null)}setSpeed(t){if(t<=0)throw new Error("Speed multiplier must be positive");this.speed=t,this.timer!==null&&this.start()}getSpeed(){return this.speed}getBaseInterval(){return this.baseInterval}tick(t){for(this.accumulator+=t*this.speed;this.accumulator>=this.baseInterval;)this.accumulator-=this.baseInterval,this.onTick(this.baseInterval)}}var Xe=(e=>(e[e.Plains=0]="Plains",e[e.Forest=1]="Forest",e[e.Hills=2]="Hills",e[e.Lake=3]="Lake",e))(Xe||{});function jl(e,t,n){let s=e*374761393+t*668265263+n*0x14057b7ef7678100;return s=(s^s>>13)*1274126177,s^=s>>16,(s>>>0)/4294967295}function Ul(e,t,n=0){const s=jl(e,t,n);return s<.1?3:s<.3?1:s<.5?2:0}class zl{_terrain;_building;_isFogged;listeners=new Set;constructor(t=Xe.Plains,n=null,s=!0){this._terrain=t,this._building=n,this._isFogged=s}get terrain(){return this._terrain}set terrain(t){this._terrain!==t&&(this._terrain=t,this.notify("terrain"))}get building(){return this._building}set building(t){this._building!==t&&(this._building=t,this.notify("building"))}get isFogged(){return this._isFogged}set isFogged(t){this._isFogged!==t&&(this._isFogged=t,this.notify("fog"))}reveal(){this.isFogged=!1}placeBuilding(t){this.building=t}setFogged(t){this.isFogged=t}addMutationListener(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(t){for(const n of this.listeners)n(t)}}class Xl{constructor(t=10,n=10,s=32,a=0){this.hexSize=s,this.seed=a,this.minQ=0,this.minR=0,this.maxQ=t-1,this.maxR=n-1}tiles=new Map;tileSubscriptions=new Map;changeListeners=new Set;minQ;maxQ;minR;maxR;get width(){return this.maxQ-this.minQ+1}get height(){return this.maxR-this.minR+1}key(t,n){return`${t},${n}`}addTileChangeListener(t){return this.changeListeners.add(t),()=>this.changeListeners.delete(t)}notifyTileChange(t,n,s){for(const a of this.changeListeners)a(t,n,s)}attachTileListener(t,n,s){const a=n.addMutationListener(r=>{this.notifyTileChange(s,n,r)});this.tileSubscriptions.set(t,a)}ensureTile(t,n){const s=this.key(t,n);let a=this.tiles.get(s);return a||(a=new zl(Ul(t,n,this.seed)),this.tiles.set(s,a),this.minQ=Math.min(this.minQ,t),this.maxQ=Math.max(this.maxQ,t),this.minR=Math.min(this.minR,n),this.maxR=Math.max(this.maxR,n),this.attachTileListener(s,a,{q:t,r:n}),this.notifyTileChange({q:t,r:n},a,"created"),a.isFogged||Ya({q:t,r:n},this.hexSize)),a}getTile(t,n){return this.tiles.get(this.key(t,n))}forEachTile(t){for(const[n,s]of this.tiles){const[a,r]=n.split(",").map(Number);t(s,{q:a,r})}}getNeighbors(t,n){return Us({q:t,r:n}).map(s=>this.ensureTile(s.q,s.r))}revealAround(t,n,s={}){const{autoFrame:a=!0}=s;for(let i=-n;i<=n;i++){const c=Math.max(-n,-i-n),u=Math.min(n,-i+n);for(let l=c;l<=u;l++){const d={q:t.q+i,r:t.r+l};this.ensureTile(d.q,d.r).reveal(),Ya(d,this.hexSize)}}if(!a)return;const r=typeof window<"u"?(()=>{const i=Math.max(window.innerWidth,0),c=Math.max(window.innerHeight,0);let u=0;if(typeof document<"u"){const d=document.getElementById("right-panel");if(d){const h=d.getBoundingClientRect();if(h.width>0){const f=d.closest("#ui-overlay");if(f){const m=f.getBoundingClientRect(),A=window.getComputedStyle(f),g=Number.parseFloat(A.paddingRight||"0"),p=m.right-h.left,b=h.width+(Number.isFinite(g)?g:0);u=Math.max(0,Math.max(p,b))}else u=Math.max(0,h.width)}}}const l=Math.min(Math.max(u,0),i);return{width:i,height:c,safeRight:l}})():{width:0,height:0,safeRight:0},o=Pl(r);kl(o,300)}}const Xs={TRIGGERED:"scheduler:eventTriggered",RESOLVED:"scheduler:eventResolved"},ql=new Map;function Yl(){return globalThis.localStorage??null}function Ln(e){return typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}function Ti(e){const t=globalThis.crypto;return t?.randomUUID?t.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function Kl(e){const t={id:String(e.id??""),label:String(e.label??""),description:e.description?String(e.description):void 0,event:e.event?String(e.event):void 0,payload:e.payload,accent:e.accent??void 0};return t.id||(t.id=Ti("choice")),t.label||(t.label="Choose"),t}function qs(e){const t={id:String(e.id??""),headline:String(e.headline??""),body:String(e.body??""),art:e.art?String(e.art):void 0,typography:e.typography,animation:e.animation,accentColor:e.accentColor?String(e.accentColor):void 0,acknowledgeText:e.acknowledgeText?String(e.acknowledgeText):void 0,choices:Array.isArray(e.choices)?e.choices.map(n=>Kl(n)):void 0};return t.id||(t.id=Ti("event")),t}function Vl(e){return{content:qs(e.content),trigger:e.trigger.type==="time"?{type:"time",at:Number.isFinite(e.trigger.at)?e.trigger.at:0}:{type:"condition",conditionId:String(e.trigger.conditionId),params:e.trigger.params}}}function Wr(e){return{content:qs(e.content),triggeredAt:Number.isFinite(e.triggeredAt)?e.triggeredAt:0}}const Sa=Object.freeze({clock:0,queue:[],active:[]});class Zl{storageKey;eventBus;getStorage;state=Ln(Sa);subscribers=new Set;constructor(t={}){this.storageKey=t.storageKey??"autobattles:event-scheduler",this.eventBus=t.eventBus??R,this.getStorage=t.storageProvider??Yl,this.load()}subscribe(t){return this.subscribers.add(t),t(this.getActiveEvents()),()=>{this.subscribers.delete(t)}}getActiveEvents(){return this.state.active.map(t=>({...Ln(t.content),triggeredAt:t.triggeredAt}))}schedule(t){const n=qs(t.content);if(!n.headline||!n.body||this.containsEvent(n.id))return!1;const s=t.trigger.type==="condition"?{type:"condition",conditionId:String(t.trigger.conditionId),params:t.trigger.params}:{type:"time",at:this.resolveTriggerTime(t.trigger)};return this.state.queue.push({content:n,trigger:s}),this.sortQueue(),this.save(),!0}publish(t){const n=qs(t);this.containsEvent(n.id)||(this.state.queue=this.state.queue.filter(s=>s.content.id!==n.id),this.activateEvent({content:n,triggeredAt:this.state.clock}))}tick(t,n={}){if(!Number.isFinite(t)||t<=0)return;this.state.clock+=t;const s=[],a=[];for(const r of this.state.queue)this.shouldTrigger(r.trigger,n)?s.push(r):a.push(r);this.state.queue=a;for(const r of s)this.activateEvent({content:r.content,triggeredAt:this.state.clock});this.save()}resolve(t,n){const s=this.state.active.findIndex(i=>i.content.id===t);if(s===-1)return!1;const a=this.state.active[s],r=this.pickChoice(a.content,n),o=r?r.id:null;return this.state.active.splice(s,1),this.save(),this.notify(),this.eventBus.emit(Xs.RESOLVED,{eventId:t,choiceId:o,event:a.content}),r?.event&&this.eventBus.emit(r.event,{eventId:t,choiceId:o,payload:r.payload,event:a.content}),!0}reset(){this.state=Ln(Sa),this.save(),this.notify()}activateEvent(t){const n=Wr(t);this.state.active.push(n),this.save(),this.notify(),this.eventBus.emit(Xs.TRIGGERED,{event:{...Ln(n.content),triggeredAt:n.triggeredAt}})}pickChoice(t,n){const s=t.choices??[];if(s.length!==0){if(n){const a=s.find(r=>r.id===n);if(a)return a}return s[0]}}shouldTrigger(t,n){if(t.type==="time")return this.state.clock>=t.at;const s=ql.get(t.conditionId);if(!s)return!1;try{return!!s(t.params,n)}catch(a){return console.warn("Scheduler condition evaluation failed",t.conditionId,a),!1}}resolveTriggerTime(t){if(Number.isFinite(t.at))return Number(t.at);const n=Number.isFinite(t.in)?Number(t.in):0;return Math.max(0,this.state.clock+n)}sortQueue(){this.state.queue.sort((t,n)=>{const s=t.trigger.type==="time"?t.trigger.at:Number.POSITIVE_INFINITY,a=n.trigger.type==="time"?n.trigger.at:Number.POSITIVE_INFINITY;return s-a})}containsEvent(t){return this.state.active.some(n=>n.content.id===t)||this.state.queue.some(n=>n.content.id===t)}notify(){const t=this.getActiveEvents();for(const n of this.subscribers)try{n(t)}catch(s){console.warn("Scheduler subscriber failed",s)}}load(){const t=gr(this.storageKey);if(!t){this.state=Ln(Sa);return}const n=Number(t.clock);this.state={clock:Number.isFinite(n)?n:0,queue:Array.isArray(t.queue)?t.queue.map(s=>Vl(s)):[],active:Array.isArray(t.active)?t.active.map(s=>Wr(s)):[]}}save(){const t=this.getStorage();if(t)try{t.setItem(this.storageKey,JSON.stringify({clock:this.state.clock,queue:this.state.queue,active:this.state.active}))}catch(n){console.warn("Scheduler persistence failed",n)}}}const Qs=new Zl;function _l(e,t){const n=new WeakSet,s=a=>{a.policy.id===e.id&&(t.once!==!1&&n.has(a.state)||(t.invoke(a),t.once!==!1&&n.add(a.state)))};R.on(t.event,s)}for(const e of Bi())for(const t of e.effects)_l(e,t);const Jl="modulepreload",Wl=function(e){return"/"+e},$r={},$l=function(t,n,s){let a=Promise.resolve();if(n&&n.length>0){let c=function(u){return Promise.all(u.map(l=>Promise.resolve(l).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),i=o?.nonce||o?.getAttribute("nonce");a=c(n.map(u=>{if(u=Wl(u),u in $r)return;$r[u]=!0;const l=u.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":Jl,l||(h.as="script"),h.crossOrigin="",h.href=u,i&&h.setAttribute("nonce",i),document.head.appendChild(h),l)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(o){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o}return a.then(o=>{for(const i of o||[])i.status==="rejected"&&r(i.reason);return t().catch(r)})},eu=({building:e,coord:t,state:n})=>{e instanceof mr?n.modifyPassiveGeneration(k.SAUNA_BEER,e.beerPerTick):e instanceof vi&&$l(async()=>{const{spawnUnit:s}=await Promise.resolve().then(()=>zu);return{spawnUnit:s}},void 0).then(({spawnUnit:s})=>{s(n,"soldier",`barracks-${t.q}-${t.r}`,t,"player")})},tu=({building:e,state:t})=>{e instanceof mr&&t.modifyPassiveGeneration(k.SAUNA_BEER,-e.beerPerTick)};R.on("buildingPlaced",eu);R.on("buildingRemoved",tu);const ln={attack:{payload:"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",loudness:{gain:1}},death:{payload:"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",loudness:{gain:1}},sisu:{payload:"UklGRrh4AABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YZR4AAAAAAAAAQACAAMABQAIAAsADgARABQAGAAbAB4AIQAkACcAKQArAC0ALgAuAC4ALgAuACwAKgAoACYAIwAgABwAGQAWABIADwALAAkABgADAAEAAAD///3//f/9//3//f/+////AAABAAIAAwADAAQABAADAAMAAQD///v/9//z/+3/5v/e/9b/zP/D/7j/rf+i/5b/iv9+/3P/Z/9d/1P/Sv9C/zz/N/8z/zL/Mv80/zn/Pv9G/1H/Xv9r/3z/jv+h/7b/zP/j//v/EgArAEQAXAB0AIsAogC2AMoA3ADsAPoABQEOARUBGgEcARwBGQEVAQ4BBQH6AO0A4ADRAMEAsACfAI0AfABrAFsASwA9AC8AIgAYAA4ABgAAAPv/+P/2//X/9f/3//n//P///wIABQAIAAoACwALAAsACAADAP7/9v/s/+D/0v/C/7D/nP+G/2//WP8+/yX/C//x/tf+v/6n/pH+ff5s/l3+UP5H/kL+Qf5D/kn+VP5i/nb+jP6n/sb+6P4N/zX/X/+M/7v/6v8aAEsAewCqANgABAEvAVYBegGbAbgB0QHmAfcBAwIKAgwCCwIFAvwB7gHdAcgBsQGXAXsBXgE/ASABAAHhAMMApQCJAG8AVwBBAC0AHAANAAIA+f/z/+//7v/u//D/8//4//3/AgAHAAwAEAASABMAEgAPAAgA///z/+T/0f+7/6P/hv9o/0f/I//+/tf+sP6I/mD+Of4T/u/9zf2u/ZP9fP1p/Vz9VP1S/VX9X/1v/YX9of3D/ez9Gv5N/oX+wf4A/0P/iP/P/xYAXgCmAOwAMQFzAbEB6wEhAlICfQKiAsEC2QLrAvYC+wL5AvEC4wLPArYCmQJ3AlICKgL/AdQBpgF5AUwBHwH0AMwApgCCAGIARQAsABgABgD5/+//6v/m/+b/6f/u//P/+v8BAAkAEAAVABkAGgAaABUADQABAPL/3v/G/6n/iP9j/zr/Dv/e/qz+eP5D/g3+1/2i/W/9Pv0Q/ef8wvyi/Ij8dfxp/GX8afx1/In8pfzK/Pf8LP1o/az99f1E/pj+8f5M/6r/CQBoAMcAJAF/AdYBKQJ3Ar4CAAM5A2sDlQO2A88D3wPmA+UD3APKA7EDkgNsA0ADEQPdAqYCbAIxAvYBuwGBAUkBEwHhALIAhwBiAEAAJAANAPv/7v/k/+D/3//h/+b/7v/3/wAACQASABoAHwAiACEAHQAUAAYA8//c/77/mv9y/0T/Ev/a/p/+Yf4g/t39mv1W/RT90/yV/Fv8Jvz2+837rPuT+4P7fPt/+4z7pPvF+/L7KPxo/LL8BP1e/cD9KP6V/gb/ev/w/2YA3QBRAcIBLwKXAvgCUgOkA+0DLQRiBI0ErgTDBM4EzgTEBLAEkwRuBEEEDATSA5MDTwMJA8ECeAIvAugBogFgASEB5wCyAIEAVwA0ABYA///t/+D/2v/X/9r/3//o//L//f8JABQAHQAkACkAKQAkABsADAD3/9v/uf+P/1//Kv/u/qz+Zv4c/s/9f/0u/d38jPw+/PP7rfts+zH7//rV+rX6n/qV+pf6pPq++uT6F/tW+6D79vtX/MH8NP2v/TD+tv5A/83/WgDnAHIB+gF9AvoCbwPdA0AEmQTnBCgFXgWHBaMFswW1BasFlgV2BUsFFwXbBJYETAT9A6sDVQP/AqkCVAIBArEBZgEfAd8ApQByAEYAIQADAO7/3v/U/9D/0v/X/+D/7P/5/wcAFAAgACoALwAwAC0AIwASAPv/3P+2/4j/Uv8U/8/+hf40/t79hf0p/cr8a/wN/LL7WvsG+7n6c/o3+gT63fnB+bL5sfm++dn5A/o7+oH61fo3+6T7Hfyh/C39wv1d/vz+oP9DAOcAiQEnAsACUwPdA10E0wQ8BZkF6AUpBlsGfwaTBpkGkQZ7BlgGKQbvBasFXgUJBbAEUATvA4sDJwPEAmQCBwKvAV0BEQHNAJAAWwAvAAsA7//c/8//yf/K/8//2f/m//X/BQAUACIALgA1ADgANQArABoAAQDg/7b/g/9H/wP/tv5i/gj+p/1C/dn8bvwB/Jb7LfvH+mf6Dfq8+XX5OfkJ+ef40/jO+Nr49fgi+V75qvkH+nL67fp0+wf8pfxM/fv9sP5o/yIA3ACVAUoC+QKhA0AE1ARcBdcFQwagBu0GKQdVB3AHegd0B14HOgcHB8gGfQYnBsoFZQX6BIwEHASqAzoDzAJiAv0BnwFHAfgAsQB0AD8AFADz/9v/y//D/8L/x//R/9//7/8BABIAIwAxADoAPwA9ADQAIgAJAOb/uf+B/0D/9v6i/kX+4f12/QX9kPwZ/J/7Jvuw+j36z/lp+Qz5uvh0+Dv4Efj49+/3+PcT+ED4gPjS+Db5q/kw+sX6Z/sV/M78kP1Z/if/9//HAJYBYgInA+UDmARBBdsFaAbkBlAHqgfxByYISAhYCFQIQAgaCOUHoQdQB/QGjAYeBqgFLgWwBDIEtQM6A8ICUQLlAYIBJwHWAI8AUwAhAPr/3P/J/77/u/+//8n/2P/q//3/EQAjADMAPwBFAEUAPQAsABEA7f+9/4L/PP/s/pH+Lf6//Ur9z/xO/Mr7RPu++jr6uvk/+cz4Y/gG+LT3c/dB9yD3E/cY9zL3YPei9/j3Y/jg+HD5EfrA+n/7Sfwd/fn93P7B/6cAjQFuAkoDHgTnBKMFUgbwBn4H+AdgCLMI8ggcCTEJMgkgCfoIwwh7CCUIwgdTB9oGWgbUBUoFvwQ0BKsDJwOoAjACwQFbAf8ArgBpADAAAQDf/8f/uf+0/7f/wf/Q/+P/+P8NACIANABDAEsATQBFADUAGgD1/8P/hv88/+b+hv4Z/qT9Jf2f/BP8g/vx+l36zPk/+bf4N/jB91f3/Paw9nX2TvY69jz2U/aA9sT2HveO9xP4q/hX+RX64fq8+6L8kv2H/oL/fgB5AXECYwNMBCsF/AW/BnAHDgiZCA8Jbwm4CesJBwoNCv0J2QmhCVYJ+wiRCBsImQcOB30G5wVQBbgEIgSQAwQDgAIEApIBLAHRAIMAQQAMAOT/x/+1/63/r/+4/8f/2//x/wkAIAA1AEUAUABUAE4APwAkAP//y/+L/z7/5P59/gv+jP0F/XX83vtD+6T6BPpm+cr4Nvio9yb3sPZK9vP1r/WA9Wb1YvV29aP15/VD9rf2Qvfj95r4Y/k++ij7H/wh/Sr+Ov9LAFsBagJxA3EEZQVLBiIH5geWCDIJtgkjCnkKtQrYCuQK2Aq1Cn0KMQrSCWIJ5QhbCMYHKgeJBuUFQQWeBP8DZgPUAkwCzgFdAfcAnwBVABkA6v/J/7P/p/+n/6//v//T/+v/BAAdADQARwBVAFoAVwBJAC8ACADV/5P/Qv/l/nj+//17/ev8Ufyw+wn7Xvqy+Qf5Xvi89yL3kvYQ9p31PPXv9Lf0lfSM9Jz0xvQJ9Wf13/Vv9hj32Pet+JX5jfqU+6j8xf3n/g0ANAFXAnUDiwSUBZAGewdTCBYJwglWCtEKMgt6C6YLuAuwC5ALWAsLC6kKNQqxCR8JggjbBzAHfwbOBR8FcgTMAy0DmQIOApEBIQHAAGwAKADz/8v/sf+j/6D/p/+1/8r/4////xkAMwBJAFkAYABfAFMAOQAUAOD/nP9K/+j+eP75/W391fwz/Ij71vof+mf5r/j690r3ovYG9nf1+PSM9DT08/PJ87rzxPPr8y30jPQG9Zv1SvYS9/H35fjs+QL7J/xW/Yz+x/8CATsCbwOaBLoFywbKB7YIjAlKCu4KeAvmCzgMbgyIDIYMaQwzDOULgQsJC38K5glACZAI2QceB2AGowXqBDcEiwPpAlMCygFPAeMAhwA6AP7/0P+x/5//mf+e/6z/wf/b//f/FAAwAEkAWwBmAGcAXABFACAA7P+n/1P/7v56/vb9ZP3E/Br8Zfup+uf5I/le+Jz33/Yq9oH15fRa9OHzf/M08wHz6/Lw8hPzU/Ox8y30xfR69Un2Mvcw+EX5avqe+9/8KP53/8YAFQJfA6AE1QX7BhAIEAn5CckKfgsXDJQM8QwxDVMNVw0/DQsNvgxZDN0LTwuvCgEKSAmGCMAH9gYtBmcFpgTtAz8DnAIHAoABCgGkAE8ACwDW/7L/nP+T/5b/ov+3/9L/8P8PAC0ASABdAGoAbgBmAFAALAD4/7P/Xv/3/n/+9/1f/bj8BvxJ+4L6tvnl+BX4Rfd79rr1A/Va9MLzPvPP8nryP/Ig8h/yPfJ68tbyU/Pu86j0ffVu9nj3l/jL+Q/7YPy7/R3/gQDlAUQDmwTmBSIHTAhgCV0KPwsGDK8MOQ2kDe8NGg4mDhMO4g2WDTANsgwfDHoLxQoDCjgJZgiRB7sG6AUbBVUEmQPqAkkCtwE1AcUAZgAaAN//tf+a/43/jv+Z/63/yf/o/wgAKABGAF4AbgB1AG8AWwA5AAUAwf9r/wL/h/77/V79sfz3+zH7YfqL+a/40vf29h/2UPWM9NXzMfOg8ibyxvGB8VrxUfFq8aPx/fF58hbz0/Ou9Kf1ufbl9yX5ePra+0b9u/4zAKsBIAOMBO0FPgd9CKYJtwqtC4YMQA3ZDVEOqA7dDvAO4w63Dm0OBw6HDfEMRgyLC8EK7AkQCS8ITgduBpMFwQT4AzwDjgLwAWMB6QCBACwA6v+5/5n/if+G/5D/pP++/97/AQAjAEMAXgByAHoAeABmAEUAEwDQ/3n/D/+R/gL+YP2u/O37H/tG+mb5f/iW9672yvXu9Bz0WfOn8gryhPEY8cnwmPCI8JrwzvAm8aDxPvL98t3z3PT39S33evjb+Uz7yvxR/tz/aAHxAnME6QVRB6YI5AkJCxIM/QzIDXEO+A5bD5oPtw+wD4kPQg/dDl0Oww0UDVMMgQujCr4J0gjlB/kGEQYxBVwEkgPYAi4ClgERAZ8AQQD3/8D/mv+F/3//hv+Z/7T/1P/5/x0APwBdAHQAfwB/AHEAUwAiAOD/iP8d/5/+DP5m/a/86PsS+zH6RvlV+GH3bfZ89ZP0tPPj8iPyefHn8HDwFvDb78Lvze/870/wyPBl8SbyCvMO9DH1cPbI9zb5t/pF/N39fP8bAboCUATcBVkHwwgXClELbgxsDUkOAg+XDwcQUxB4EHoQWBAVELIPMQ+WDuQNHA1EDF4Lbwp4CYAIiAeTBqcFwwTtAyYDcALMATwBwABZAAYAyP+c/4P/ef9+/4//qf/K/+//FgA7AFsAdACEAIcAfABfADEA7/+a/y7/rv4Z/m/9tPzm+wr7Ifot+TL4M/cz9jb1P/RT83TyqPHw8FHwze9o7yPvAe8E7y3ve+/x743wT/E18j7zZ/Sv9RL3jPga+rj7Yv0T/8YAeAIkBMYFWAfYCEAKjwvADNINwQ6LDzAQrxAGETYRQBElEeYQhhAGEGoPtA7oDQoNHAwjCyMKHgkbCBoHIAYwBU0EeQO2AgcCawHlAHQAGADS/6H/gv90/3b/hP+e/7//5v8NADUAWAB0AIcAjQCFAGwAQAAAAKv/QP+//ij+fP28/Or7B/sW+hn5FfgL9//19fTz8/nyDfIy8W7wwe8x78DucO5F7j/uYO6p7hvvte928F/xa/Kb8+r0Vvbc93f5JPve/KH+ZwAtAu4DpQVNB+IIYQrECwoNLw4xDw0QwhBPEbMR7hECEu4RtRFYEdkQPRCFD7UO0Q3cDNsL0ArCCbIIpQeeBqEFsQTQAwADRQKeAQwBkQAtAOD/p/+C/3D/bv97/5P/tP/b/wUALgBUAHQAiQCTAI4AeABPABEAvv9U/9L+Ov6L/cj88fsI+xD6C/n99+n20vW99K3zpvKt8cXw8u8475vuHu7D7Yztfe2X7drtR+7e7p7vh/CX8cvyIfSW9Sb3zviK+lP8J/4AANkBrgN6BTgH4gh3CvALSw2EDpgPhxBMEegRWxKiEr8StBKBEigSrBEQEVcQgw+aDp8NlgyCC2kKTQk1CCEHGAYaBSsETwOHAtQBNwGyAEUA7/+v/4T/bf9n/3H/iP+p/9D/+/8mAE8AcgCLAJkAlwCEAF4AIgDR/2f/5/5N/p391/z8+w37D/oC+ev3zfar9Yr0bvNa8lPxXvB977buDO6B7Rrt2ezA7NHsDe117Qjuxu6v78Hw+fFV89L0bPYf+Oj5wful/ZD/fAFlA0YFGQfZCIMKEgyBDdAO+A/4EM8RfBL8ElATeRN2E0oT9hJ+EuIRKBFTEGUPZA5SDTYMEwvtCckIqQeSBocFjASjA80CDgJmAdYAXwAAALn/h/9r/2H/aP99/53/xf/x/x4ASQBuAIsAnQCfAI8AbAA0AOT/ff/8/mP+sf3p/An8F/sS+v743/e39ov1XvQ28xXyAfH97w/vOu6C7evseOwr7AjsD+xD7KTsM+3v7dfu6e8k8YXyCfSs9Wr3QPkn+xz9GP8XARMDCAXwBscIhgoqDLANEg9OEGIRSxIIE5cT+RMsFDQUEBTCE04TtBL6ESMRMRArDxMO7gzCC5AKYAk1CBEH+QXwBPoDGANNApkB/gB8ABQAxf+M/2r/XP9f/3L/kf+5/+b/FABCAGoAiwCfAKUAmgB6AEUA+f+S/xT/ev7I/f38G/wk+xn6//jY96f2cfU59ATz1/G28KXvqO7G7QDtW+zb64PrVOtS633r1+tg7Bjt/u0R707ws/E98+j0sfaS+Ib6ivyX/qgAuALBBL4GqQh/CjkM1A1LD5wQwxG/EowTLBSbFNwU7hTSFIsUGxSFE8wS8xH+EPQP1g6pDXMMOAv8CcUIlAdvBloFVgRnA48CzwEpAZ0AKwDT/5T/a/9Y/1j/Z/+E/6z/2v8KADkAZQCJAKEAqwCkAIgAVgAMAKn/K/+T/uD9FP0w/DX7JfoF+db3nPZd9Rr02vKf8XHwU+9J7ljthOzS60Tr3+ql6pjquuoM64/rQ+wm7Tfudu/e8G3yH/Tx9d333/ny+w/+MgBUAnEEgwaECG8KPgzuDXsP4RAcEisTChS6FDgVhhWjFZEVUhXnFFUUnRPEEs0RvhCaD2cOKA3jC5wKWQkcCOoGyAW3BLsD1gIKAlcBwQBFAOT/nP9t/1X/UP9e/3n/n//N////MQBfAIYAogCwAKwAlQBmACAAwP9E/63++/0u/Uf8Sfs1+g/52feY9k71AfS18m/xM/AI7+/t8OwP7E7rtOpB6vvp4+n76UXqwOpv607sXu2d7gfwm/FT8y71JPcy+VL7f/2z/+cBGAQ+BlQIVAo6DAAOog8dEWwSjhOAFEAVzhUqFlQWTBYVFrEVIxVtFJQTnRKKEWEQJg/gDZIMQAvxCagIagc6BhwFEgQhA0gCigHoAGIA9/+o/3L/U/9K/1T/bf+S/8H/8/8mAFgAggCiALQAtAChAHcANADX/17/yP4X/kn9Yfxg+0n6Hfnh95j2RfXv85fyRvH978Punu2Q7KDr0eop6qrpVukz6UHpgen06Zzqd+uF7MPtLu/F8ITyZfRl9n74rPro/C3/cwG2A/AFGwgxCiwMCA7AD1ARtBLqE+4UwRVfFskWABcDF9UWeBbvFTwVZRRsE1cSKRHpD5sOQw3oC40KOAntB7AGhQVuBG8DigLAARIBgQANALX/eP9T/0X/Sv9h/4X/s//n/xwATwB9AKEAtgC8AKwAhwBHAO7/eP/l/jT+Z/1+/Hv7YPov+e73nfZC9eHzgPIi8c3vhu5S7TfsOetb6qTpGOm36IjoiujA6CvpzOmi6qvr6OxU7u3vsfGZ86H1xff/+Un8nv71AEwDmQXZBwQKFQwHDtUPehHzEj0UVRU5FugWYhemF7UXkRc8F7kWChY1FTwUJRP0Ea4QWA/4DZMMLgvNCXUILAfzBc8EwgPRAvoBQAGkACYAxf+A/1T/QP9C/1b/eP+m/9r/EABGAHcAngC4AMIAtwCVAFoABQCS/wH/U/6G/Z38mPt6+kb5/ven9kT12vNu8gXxo+9Q7g7t5OvX6uzpJ+mM6B7o4efX5wPoZej+6M7p0+oN7HntFO/b8Mjy2PQH90z5pPsH/nAA2QI6BY0HzQn0C/wN4A+bESoTiBS0FasWaxf1F0cYYxhKGP0XgRfXFgQWDBXzE78SdBEZELEOQg3SC2UKAgmrB2YGNAUaBBsDOAJyAcsAQgDY/4r/WP8+/zv/S/9r/5j/zP8DADsAbwCaALgAxwDBAKQAbgAbAK3/H/9y/qf9vvy4+5f6YPkT+Lb2S/XZ82Py7vCB7yDu0eyZ633qg+mv6AXoiudA5ynnSuei5zLo++j86TPrnew57gLw9fEM9EL2k/j4+mr95P9dAtEEOQeOCcoL6A3iD7MRVxPLFAsWFRfnF4EY4hgLGf4YuxhGGKIX0xbcFcMUjBM9EtsQaw/0DXoMAwuTCS8I3AadBXYEagN5AqcB9QBhAO7/lv9c/zz/Nf9B/17/if++//f/MABnAJUAuADKAMkAsQB/ADIAx/88/5P+yf3g/Nr7uPp9+S34yfZY9d3zXfLe8GXv9+2a7FTrKuoh6T7ohef75qTmgeaW5uPmaucr6CXpWOrA61vtJ+8d8TvzevXV90b6xvxP/9kBYATbBkUJlwvKDdoPwRF8EwUVWhZ3F1wYBxl4Ga8Zrhl2GQkZaxifF6sWkhVaFAcToBEpEKkOJg2jCycKtwhXBwsG1wS8A78C4QEiAYMABQCm/2P/PP8v/zf/Uv97/6//6f8kAF0AjwC2AM0A0QC+AJEASADi/1v/tP7s/QT9/vvc+p75Sfjh9mj15vNd8tPwTu/U7WrsFuvd6cXo0+cM53PmDebd5eXlJ+al5l3nUeh+6ePqfuxK7kPwZvKs9BD3jfkb/LL+TgHmA3UG8whaC6MNyQ/HEZcTNhWgFtIXyhiHGQgaThpZGiwayBkyGWwYehdiFikV0hNmEukQYg/VDUgMwQpDCdcHfQY7BRQECQMeAlMBqAAfALf/bP8+/yv/L/9G/23/oP/b/xcAUwCIALIAzgDXAMkAoQBdAPv/ef/V/hD+Kv0k/AH7wflp+P32fvX082Lyz/A+77jtQezf6pfpcOhv55nm8eV95T/lOuVw5eLlkuZ+56XoB+qf62vtZ++O8dvzSPbO+Gj7D/66AGUDBgaYCBQLcw2wD8MRqhNfFd4WJBgwGf8ZkRrmGv8a3hqFGvYZNhlIGDEX9xWfFC8TrBEdEIcO7wxdC9UJWgj0BqQFbwRXA18ChwHRAD0Ayv93/0L/KP8n/zr/X/+R/8z/CgBHAIAArgDOANwA0wCxAHIAFACX//f+Nf5R/U38Kfvo+Y34HPeZ9Qf0bfLQ8DXvou0e7K7qWOkj6BLnLOZ25fLkpeST5L3kJOXJ5a3mzucq6cDqi+yI7rPwBfN69Qv4sfpl/SAA2wKQBTUIxgo6DY0PtxGzE34VExdvGI4ZcRoVG3oboRuMGz4btxr9GRQZARjHFm0V+RNxEtsQPQ+bDf4LaQrjCG8HEgbPBKkDpALAAf4AXgDh/4T/R/8n/yD/L/9S/4L/vf/8/zsAdgCoAM0A4ADcAMAAhgAuALX/Gf9b/nn9dvxT+xH6tPg/97b1H/R98tfwMe+T7QLshOog6dvnvObG5QDlbeQS5PLjDuRp5ATl3+X45k/o4Omq66ft1e8s8qj0Qffy+bT8fv9JAhAFyQduCvgMYA+gEbQTlRVAF7EY5RnbGpEbBxw+HDYc8xt2G8Ma3xnPGJYXPBbFFDgTnBH1D0sOowwCC28J7geDBjMFAATtAvwBLQGCAPv/lP9P/yf/Gv8l/0T/c/+t/+3/LgBsAKIAywDiAOQAzQCZAEYA0v87/4H+ov2h/H/7Pfre+Gb32fU79JLy4vAz74rt7Oth6u/om+ds5mblkeTu44TjVeNk47LjQuQS5SPmdOcB6cjqxuz07k/x0vNz9i/5/PvV/rABiARUBw4KrQwqD4ERqxOjFWQX6hg0Gj4bBhyOHNQc2xykHDEchxupGpwZZhgLF5IVARRfErAQ/Q5LDZ8LAApyCPkGmwVbBDoDOwJhAaoAFgCn/1j/Kf8W/xz/OP9k/53/3f8gAGAAmgDHAOMA6gDZAKsAXgDv/17/p/7M/c78rPtr+gr5kPf/9Vz0rPL08Dvvhu3d60XqxOhh5yPmDuUo5Hbj/OK+4r/iAOOD40rkUeWa5iPo5uni6xLucPD38qH1Zfg/+yX+DwH5A9cGpQlYDOwOWRGaE6gVgBcdGXsamRt1HA8dZh17HVEd6RxIHHAbaRo0GdsXYBbMFCQTbxGzD/YNQAyUCvkIdAcIBrkEjAN/ApgB1AA2ALz/ZP8t/xP/FP8r/1X/jf/N/xEAVACRAMIA4wDwAOQAvAB0AAsAf//O/vb9+/zc+5r6Ovm+9yn2gfTK8gvxSO+J7dTrLuqg6C7n4eW75MXjA+N64i3iHuJS4snig+OC5MPlROcE6f7qLe2O7xnyyfSX93v6bv1oAGEDUgYyCfsLpA4nEX8TpBWSF0YZuhrtG90ciR3xHRUe+R2dHQUdNhw0GwMaqhgvF5gV6xMwEmwQpg7kDC4LhQnzB3kGHQXhA8cC0gECAVkA1P9z/zP/Ev8N/yD/Rv99/73/AQBHAIYAvADiAPQA7gDLAIoAJwCg//T+If4p/Qz8zPps+e73Vvaq9O3yJvFb75Lt0Ose6oLoAuek5XDkauOY4v7hoeGE4anhEuLB4rTj7eRn5iLoGepH7KnuOPHu88P2svmx/Ln/wgLFBbgIlQtTDu0QWxOXFZwXZhnwGjkcPR38HXYeqx6cHk0ewB35HP0b0Rp6Gf8XZRa0FPMSJxFYD40NygsWCnYI7waFBTsEEwMRAjQBfgDv/4P/Ov8S/wf/Ff85/23/rP/x/zgAewC0AN8A9gD2ANsAnwBCAMH/Gf9M/lj9Pvz/+p/5IPiG9tb0FfNH8XPvoO3U6xXqa+jc5nDlK+QU4zLiiOEa4e7gBOFg4QLi6uIZ5IvlQOcz6WDrwu1U8A/z6/Xj+O77BP8cAjAFNggnC/oNqhAuE4EVnRd+GR4bfRyWHWke9R47Hzsf+R53HrodxRydG0kazhgzF38VuRPmEQ8QOA5rDKsK/QhpB/EFmARjA1MCagGnAAwAlv9E/xT/Av8M/yv/XP+b/+H/KQBuAKwA2wD4AP4A6ACzAFwA4f9A/3f+h/1w/DT71flV+Lr2B/VA82zxkO+z7dzrEupb6L3mQeXt48fi0+EY4ZrgXuBl4LLgR+Ej4kfjseRf5k3oeOrZ7G3vK/IP9Q/4JftI/m8BkwSrB68KmA1dEPgSYhWVF40ZRRu5HOgdzh5uH8Uf1R+hHysfdx6KHWgcFxueGQIYSxaAFKcSyBDoDg8NQwuJCecHYQb7BLgDmgKjAdQALACt/1H/GP///gL/Hv9M/4r/0P8ZAGEAoQDVAPgAAwH0AMYAdQAAAGX/ov62/aP8avsM+o348PY69W/zlfGy78zt6+sV6lDopeYa5bbjf+J64a/gIODT38rfCOCQ4GDheeLZ43/laOeO6e/rg+5G8S/0N/dX+oX9uwDvAxkHMQotDQgQuRI6FYQXkxljG+0cMR4tH98fSSBpIEQg2x8xH00eMh3lG24a0xgZF0oVaxODEZoPtw3fCxkKaQjWBmEFEATkAuABBAFRAMX/X/8e//7++/4S/z3/ef++/wgAUwCXAM8A9gAHAf4A1wCNAB4Aiv/M/ub91/yh+0b6x/gq93H1ovPC8djv6u3/6x3qTOiT5vnkheM94ijhTOCs307fNt9l393foOCs4QPjoeSD5qXoBOuY7VzwSvNa9oP5vfwAAEQDfwapCboMqg9yEgoVaxeRGXcbGR1zHoQfSyDGIPkg4iCGIOkfDh/5HbIcPhujGegXFRYwFEISURBjDoAMrQrwCE8HzAVtBDMDIQI4AXgA4f9x/yf//v70/gb/Lv9n/6z/9/9DAIoAxgDzAAoBBwHmAKMAPACu//b+Fv4M/dn7gPoD+WX3qvXZ8/XxBPAO7hjsLOpO6Ifm3uRa4wPi3eDv3z7fz96m3sXeLt/j3+TgL+LE457lvOcX6qvsce9i8nj1qfjv+z//kQLdBRoJPgxEDyESzxRIF4YZhBs8Ha0e1B+vID4hgSF7IS4hnSDLH78efh0MHHMatxjiFvgUAxMKERIPJA1FC3sJzAc7Bs4EhgNmAm8BogAAAIX/Mf8A//D+/P4f/1b/mv/m/zMAfQC9AO4ACwEPAfQAuQBYANH/IP9F/kD9Evy8+kD5ovfn9RL0KvIz8DXuOOw/6lbogubK5Dfjz+GY4Jnf195W3hzeK96F3ivfHuBf4enivOTT5irpveuD7njxkvTL9xv7d/7YATQFggi6C9QOyBGNFB0XchmHG1cd3x4cIAwhryEFIg8i0SFMIYYggx9IHtscQxuIGa8XwhXHE8URxQ/LDeELCgpNCK8GMwXdA68CqwHRACIAnP8+/wT/7f7y/hL/Rv+I/9T/IgBuALIA6QALARUBAgHNAHQA8/9J/3T+df1L/Pn6f/nj9yf2UPRj8mjwYu5b7FnqZOiD5r3kGuOi4VrgSd923uTdmN2W3d/dd95d35DgEOLa4+rlPejM6pPtivCp8+r2Qvqq/RcBgwTjBy4LXQ5lEUEU6RZVGYIbah0JH1wgYiEZIoIiniJvIvghPSFEIBAfqB0UHFgafxiOFo0UhBJ6EHcOgAyeCtMIJgecBTgE/ALpAQIBRwC2/03/Cv/r/uv+Bf81/3X/wf8QAF8ApgDhAAkBGQENAd8AjQAUAHH/o/6q/YT8Nvu/+ST4aPaQ9KDyn/CU7oXseep46Irmt+QF43zhI+AB3xzeeN0a3QfdQN3I3Z/exd864friA+VQ59zpoeyZ773yA/Zk+db8UQDMAzwHmgrdDfsQ7ROsFjAZdRt0HSoflSCwIXwi+SInIwgjoCLyIQIh1h90HuMcKhtPGVsXVRVGEzMRJQ8kDTQLXQmjBwoGlwRNAywCOAFwANL/X/8T/+v+5P75/iX/Y/+u////TwCZANkABgEcARcB8ACmADQAmP/R/t79vvx0+wH6Z/is9tL04PLb8Mnusuyd6pHol+a15PXiXOHz37/eyN0R3aLcfdyl3B3d5d393mbgG+Ic5GPm6+iu66buzfEY9YD4/fuE/w0Djgb+CVQNiBCQE2YWAhlfG3YdRB/FIPch2SJpI6ojnCNDI6IivSGaID8fsh36Gx8aKRggFgkU7xHYD8sNzwvrCSMIfAb7BKEDdAJxAZsA8v90/x3/7f7f/u7+Fv9S/5v/7P89AIsAzwABAR0BHwEAAb0AUwC///7+Ev74/LP7Q/qt+PL2GPUj8xvxBO/l7Mfqseiq5rvk7OJD4cjfg9563bLcMNz52xDcd9ww3Treld8/4TfjduX557rqsu3a8Cr0mfcf+7L+SALZBVsJxAwMECsTFxbLGD8bbh1UH+0gNiIuI9MjJyQrJOIjTiN1IlwhCCCAHssc8Rr5GOsWzxSuEo0Qdg5vDH0KqAjyBmMF+wO+Aq4BywAVAIv/K//x/tv+5P4I/0D/h//Y/ywAfADEAPsAHQElAQ4B0gBwAOT/K/9F/jL98vuG+vP4Ofdf9WnzXfFB7xzt9urW6MPmxuTp4jDhpd9O3jPdWNzE23vbgNvW23/cet3H3mbgU+KK5Afnxem87OXvOPOt9jz62v19AR0FsAgsDIkPvBK/FYsYFxtfHV0fDiFuInwjNiSeJLQkfCT3IyojGyLPIE0fnB3DG8oZuReYFW8TRhElDxINEwswCW0HzgVYBA0D7wH+ADsApv86//f+2f7b/vr+L/90/8X/GQBsALcA8wAbASoBGgHnAIwABwBX/3j+a/0x/Mr6OvmD96n1svOj8YPvWO0p6//o4ebY5OziJOGI3yDe89wG3F/bBNv22jrb0tu93P3dj99x4aDjFubP6MPr7e5D8r71VPn8/KwAWgT+B4wL/Q5FEl8VQhjmGkcdXR8mIZ0iwiOTJA8lOCUQJZsk2yPXIpQhGSBrHpQcmxqIGGIWMxQCEtcPuA2uC70J7Ac/BroEYAMzAjUBZQDD/0z/AP/Z/tT+7f4d/2H/sf8FAFoAqQDqABgBLQElAfkApgAqAIH/qv6k/XD8DvuC+c739fX+8+3xyO+Y7WHrLukG5/Dk9eIe4XLf+d263LrbANuS2nLapNor2wbcN9273pLgt+Il5dnnyurz7Uvxy/Ro+Bn81f+RA0QH5AppDscR9xTxF60aJh1UHzUhxSIBJOgkeSW1JaAlOiWIJJAjVyLjIDsfZh1tG1gZLhf6FMASixBjDkwMTgpvCLMGIAW3A3wCbwGSAOT/Yf8K/9v+zv7h/g7/Tv+c//L/SQCbAOAAEwEvAS0BCgG/AEsAq//b/tz9r/xT+8v5GvhD9kz0OfIR8Nvtnuti6S/nDeUF4x/hY9/Y3Yfcdduo2iba89kT2ojaU9t03OvdtN/P4TXk4+bR6fjsUfDU83f3Mfv4/sEChAY1Cs0NPxGFFJcXaxr7HEMfPSHlIjgkNSXcJS0mKSbUJTElRiQXI6shCCA3HkAcKRr9F8IVghNEERAP7QzjCvYILAeKBRMEyQKuAcMABwB6/xf/3/7K/tf+/v47/4j/3v82AIoA1AANAS8BNAEYAdYAagDS/wz/Ff7u/Jj7Ffpn+JL2nPSI8l3wIu7f65vpXucx5RvjJuFa377dWtw221bawdl72YjZ69mk2rXbHd3a3urgR+Ps5dbo++tV79rygvZE+hX+6wG8BX8JKQ2wEAwUNBcgGskcKh88If0iaCR8JTgmniatJmom1iX4JNUjcSLVIAgfEh37GswYjRZFFP8RwQ+TDXwLgQmqB/kFcgQaA/AB9wAuAJT/J//l/sj+zv7w/in/dP/J/yIAegDHAAUBLQE6ASYB7ACIAPn/Ov9L/iz93Ptf+rX45Pbu9NnyrPBu7iTs2OmS51nlN+M04Vffq9013P7aC9pi2QnZA9lT2fvZ+9pU3APeBuBZ4vfk2+f96lbu3fGK9VP5Lf0PAe8EwQh+DBkQihPJFswZjhwHHzMhDCOPJLsljiYIJywn+iZ3JqcljyQ1I6Ah2B/lHc4bnRlZFwwVvhJ2ED0OGQwRCisIawbXBG8DNwIvAVkAs/86/+3+yP7G/uL+F/9g/7X/DgBoALkA/AAqAT4BMQEAAaQAHgBo/4L+af0h/Kn6BPk190H1LfP+8Lzubuwb6svnh+VZ40fhW9+e3RbczNrG2QrZndiD2MHYVtlF2o7bLt0l323hA+Tg5v7pVu3e8I70XfhB/C4AGgT9B8sLeQ8AE1UWcBlKHNweICESI64k8iXcJm0npCeFJxMnUSZGJfYjaiKnILceoRxuGicY1BV/Ey4R6g66DKUKsQjiBj4FyAOBAmsBhwDU/1D/+P7J/sD+1v4H/0z/oP/6/1UAqQDxACUBQAE6AREBwABBAJT/tv6m/WX88/pT+Yn3l/WD81PxDu+77GHqCei75X/jYOFm35fd/9ui2ojZuNg42AvYNNi32JTZzNpe3Efeg+AQ4+bl/+hU7N3vkPNk90/7R/9AAzIHEQvTDm4S2RULGf4bqB4GIREjxiQiJiMnyicWKAsoqSf3JvkltSQxI3UhiR90HUEb9xifFkIU6BGaD14NPQs7CV4HqwUlBM8CqwG4APj/aP8F/83+u/7L/vb+Of+K/+X/QQCZAOUAHwFAAUIBIQHYAGMAv//q/uL9qfw9+6P53ffu9dvzq/Fj7wztq+pL6PPlrOOA4Xbfl93t233aUdlu2NjXl9et1x3Y6NgO2pDba92c3x3i6+T/51Hr2e6O8mf2Wfpb/mACYAZQCiQO1BFVFZ4YqRtsHuMgByPVJEkmYycgKIEoiig7KJknqSZxJfYjQiJaIEgeFBzIGWwXCBWnEk4QBw7YC8gJ3QccBocEIQPuAe4AIACD/xX/0/64/sH+5/4l/3X/z/8sAIcA1wAXAT4BSAEwAe8AgwDp/xz/Hf7r/If78/kx+Eb2NfQE8rvvX+366pLoMObf46Xhjd+e3eLbYNoh2SnYgNcr1yzXiNdB2FbZx9qT3LfeLuHy4wDnTerU7YrxZvVf+Wn9egGIBYgJbg0xEcgUKBhLGycetyD1ItskaSaaJ28o5ygEKccoNihVJykmuSQMIyohGx/oHJoaOhjRFWcTBRGzDngMWwphCJAG7AR4AzYCJwFLAKL/J//b/rf+uP7Z/hP/YP+5/xgAdADJAA0BOwFNATwBBQGiABAATf9X/i390ftD+ob4n/aQ9GDyFvC37Uzr3ehz5hbk0OGp36vd3ttK2vbY7Ncu18TWstb61p/XotgC2r/b1N0/4PviAOZJ6c3sg/Bj9GH4dPyPAKoEuQixDIgQNBSrF+Qa2R2CINki2iSBJsontyhFKXcpTinPKP0n3yZ5JdUj+SHuH70dbhsKGZwWKhS/EWIPGw3xCukICQdWBdMDgQJkAXoAw/89/+X+uP6y/sz+Af9L/6T/AgBhALgAAgE2AU8BRwEYAb4ANgB9/4/+b/0a/JP63Pj59u30vvJz8BLuoust6brmU+QA4szfvt3g2zra09i11+PWZNY91nHWAtfy10HZ7dr03FPfBOIB5UToxet7713zYPd5+6D/xgPkB+0L1w+XEyQXdRqDHUUgtiLQJJEm8yf4KJ0p5CnQKWIpoCiQJzcmnCTHIsAgkR5CHNwZaRfwFHwSFRDCDYsLdQmHB8QFMQTRAqUBrADo/1b/8v68/qz+wP7w/jf/jf/s/00ApwD2ADABUAFQASkB2QBaAKr/x/6v/WP84/oy+VP3S/Ue89Lwb+7764HpBueV5Dfi9d/Y3enbMdq42IXXntYL1s/V7tVr1kjXhdgg2hjcad4P4QPkQOe86nHuVPJa9nv6qv7dAggHIgseD/ISlhb+GSQdACCKIr4kmCYUKDAp7SlLKksq8ClAKT4o8SZgJZMjkiFlHxYdrxo3GLkVPBPLEG0OKQwFCggINwaUBCUD6QHjABAAcf8C/8L+qf62/uD+I/93/9b/NwCVAOgAJwFOAVYBOAHyAHwA1v/8/u79qvwy+4f5rveq9X/zNPHP7lns2OlW59zkcuIj4Pfd+Nsu2qLYW9dg1rfVZ9Vx1drVo9bN11fZP9uC3RzgB+M75rPpZe1I8VL1ePmw/e0BJwZQCl4ORxL/FX8ZvRyxH1UioySXJiwoYik3KqsqwCp5Ktop6CioJyImXSRjIjkg7B2CGwcZgxb/E4URGw/KDJkKjgiuBvwEfQMyAhwBPACQ/xb/yv6o/qz+0f4Q/2H/v/8iAIIA2QAeAUwBWwFGAQgBnQAAADH/K/7w/IH73fkK+Ar24fOX8TLvuOwz6qrnJ+Wz4lfgHN4N3DLak9g41ynWa9UF1fvUTtUD1hrXkthq2p7cK98L4jflqehZ7DvwRvRy+LH8+QA/BXgJlw2TEWEV+BhNHFofGCKAJI4mPSiMKXkqBCsvK/wqcCqNKVwo4SYmJTEjDCHBHlcc2RlPF8UUQRLND3ANMQsYCSgHaAXZA38CWgFrALL/K//T/qn+pf7D/v3+TP+o/wsAbgDIABMBRwFdAVIBHQG7ACgAY/9n/jX9zvsy+mX4avZF9P3xl+8b7ZHqAuh35fjikOBI3incPNqL2BzX+NUm1arUitTJ1GnVbNbS15jZvds83hHhNOSg50rrK+8582j3rvsAAFIEmAjJDNcQuhRoGNUb+x7TIVUkfCZFKK4ptCpWK5creisAKy4qCymeJ+wl/yPfIZYfLB2sGh4YjBUAE4IQGQ7NC6YJqAfYBTkEzwKcAZ8A1/9E/+H+rP6f/rb+6/43/5L/9f9ZALYABgFAAV8BWwEvAdcATwCU/6L+ev0b/Ij6wfjL9qr0ZPL/74Ht8+pf6MvlQ+PP4HneS9xN2onYB9fP1efUVtQg1EnU1dTE1RbXy9jf2lDdGeAy45bmPOob7inyW/an+gL/XwO0B/QLFRANFNAXVRuUHoQhICRiJkYoyCnmKqEr+ivxK4oryyq3KVcosCbMJLEiayACHoAb7hhXFsMTOhHGDm0MOAorCEwGngQlA+IB1QAAAF//8f6x/pv+q/7a/iH/e//e/0MAowD4ADgBXQFiAUAB8gB0AMP/2/69/Wf83Poc+Sz3EPXM8mjw6e1Y677oJOaS4xPhsN5y3GTajtj41qzVr9QI1L3T0dNH1CHVX9YB2AXaaNwi3zLijeUt6QntF/FL9Z35//1nAskGGQtMD1cTMBfMGiMeLSHkI0AmPijaKRIr5StVLGIsECxjK18qDClxJ5YlgiNAIdgeVRzAGSMXhxT1EXYPEQ3OCrMIxAYHBX4DKwIPASwAfv8D/7j+mv6h/sr+Dv9j/8b/LACPAOgALgFbAWgBTgEKAZYA7/8S//79svwv+3f5jvd29Tbz0/BU7sHrIumA5ubjXOHs3qDcgdqZ2PHWkNV+1MHTYNNe077Tg9Su1T3XL9mC2y/eM+GF5B/o9usD8Dn0j/j5/GoB2AU3CnwOmhKIFjsaqh3OIJ4jFSYuKOQpNisiLKoszSyQLPUrAyu/KTAoXSZRJBQirh8rHZQa8RdOFbQSKhC5DWgLPglBB3QF2wN5Ak4BWwCg/xn/w/6a/pn+vP76/k3/rv8VAHsA1wAjAVYBawFbASABtgAaAEj/Pf78/IL70vnv9931oPM/8cDuLOyJ6eHmPuSq4S7f09yk2qvY8NZ71VPUgdMK0/HSO9Pr0wHVfdZd2J/aPt014H3jEOfj6u3uJPN99+77aADiBFAJpQ3WEdgVoxkqHWcgUCPiJRUo5SlSK1gs9ywyLQktgyyhK20q6igjJx8l5yKEIAIeaBvBGBgWdRPhEGQOBgzOCcEH5QU9BMsCkAGPAMb/Mf/P/p3+k/6u/uf+N/+W//7/ZQDFABYBUAFtAWUBNAHVAEIAe/98/kT90/ss+lD4RPYM9K3xL++Z7PPpRuec5P3hdd8N3c7axNj11mzVMNRI07rSi9K/0lnTWtTC1ZDXwdlQ3DrfeOIC5s/p1u0N8mn23/pi/+cDYgjHDAsRIhUBGaEc9h/6IqYl8yfgKWYrhSw+LY8tfS0LLTwsFyujKeYn6yW5I1oh2B4+HJMZ5BY5FJsREw+oDGIKRghaBqIEIQPXAcYA7/9N/9/+of6P/qP+1f4h/3//5v9PALIACAFIAWwBbQFGAfAAaQCt/7j+iv0k/IX6sfir9nj0HPKf7wjtYOqu5/zkVOLB30vd/tri2AHXZNUT1BbTcdIs0krSzdK50wzVxtbl2GXbQt504fTku+i+7PTwU/XN+Vj+5gJuB+MLOBBjFFkYEBx9H5siYiXKJ9EpciusLH0t5y3rLY0t0Sy8K1cqpyi1JookMCKwHxQdZxqyFwAVWBLFD04N+QrPCNQGDAV6AyECAgEaAGz/8f6p/o3+mP7F/gz/Z//O/zcAnQD4AD4BaQFzAVYBCgGNANz/8v7P/XL83foS+RL35PSN8hLwe+3P6hnoYeWx4hLgkN0z2wfZFNdj1f7T6tIv0tPR2tFI0h3TW9QC1g/YftpL3XHg6OOn56br2u859Lf4Sf3iAXUG+QpgD54TqRd2G/0eNCIVJZgnuil2K8kstC03LlIuCi5hLV4sBytkKX0nWiUEI4cg6x08G4IYyBUYE3oQ9w2VC10JUQd6BdgDcAJAAUsAjv8H/7L+jf6Q/rb++P5Q/7X/HwCHAOYAMgFkAXcBYgEhAbAACQAr/xX+xPw6+3n5g/de9Q3zmPAF7lzrp+jt5TnjleAL3qXbbdls163VNtQQ00LS0dHD0RvS2tID1JPVi9fm2aDcs98Z48nmu+rk7jrzsvc//NUAawXwCV0OoxK4FpEaJh5tIV8k9SYrKfsqZCxlLfwtLS76LWUtdiwyK58pxiexJWgj9CBhHrcbARlJFpkT+RByDgsMywm5B9gFLAS4An4BfQC1/yP/xP6T/o7+rP7p/jz/nv8HAHAA0QAhAVkBcwFoATIBzQA0AGT/W/4a/Z777PkF+O31qfNA8bbuFexm6bDm/uNZ4c3eYdwh2hbYSdbD1I3Tq9Im0gHSQdLn0vbTbdVL14zZLdwo33fiEubw6QjuTvK59jz7y/9aBN4ISw2UEa8VkhkyHYYgiCMwJngoXSrcK/IsoS3oLcstTS1zLEQrxCn9J/glvSNVIcweKhx6GcYWFxR3Ee0OgQw8CiEINwaCBAQDvgGxAN7/QP/W/p3+jv6l/tv+Kf+I/+//WAC7AA8BTQFvAWwBQQHnAFoAmf+f/mv9//tc+oP4efZC9OPxZO/M7CPqcefC5B3ijd8d3dXawdjo1lTVDNQY037SQ9Js0vrS8NNN1RHXOdnB26Te3OFh5SvpMe1n8cT1PPrD/k0Dzgc6DIcQpxSSGDwcnR+uImclwSe7KU4reyxALZ4tmC0wLWwsUCvlKTAoOyYOJLQhNB+bHPEZQReUFPQRaA/4DK0KiwiYBtkEUQMAAugACABg/+z+qP6Q/p/+zv4W/3H/2P9AAKQA/ABAAWgBbgFNAf4AfgDK/97+uf1d/Mj6/fgB99b0hPIP8IDt3eox6ITl4OJO4Nrdi9tt2YjX5tWO1InT29KK0pzSEtPv0zPV3dbs2FvbJt5H4bbkbOhe7IXw1PRA+b/9QQK/BisLeQ+fE5EXRRuzHtIhmyQIJxUpvSoALNssUC1gLQ8tYCxZKwEqXih6JlwkDiKaHwodZxq7FxAVcBLiD3ANHgv2CPsGMwWfA0QCIQE2AIL/A/+1/pT+mv7C/gb/Xf/B/ygAjQDoADEBXwFuAVYBEwGfAPj/Gv8E/rb8L/t0+YX3aPUh87fwMe6W6+/oReai4w/hlt5B3BvaK9h81hTV/dM709bS0dIv0/TTH9Ww1qXY+9qu3bfgEOSy55Lrp+/o80j4vfw5AbMFHQptDpcSjxZNGsYd8yDNI0smaygoKoArcSz8LCMt6CxOLF0rGCqIKLUmpiRmIv0fdh3aGjMYjBXsEl0Q5g2RC2IJXweOBfEDiwJcAWYAp/8d/8T+mv6X/rj+9v5I/6n/EQB2ANMAIQFWAWsBXQElAbwAIgBS/0v+C/2T++b5Bvj19bvzXPHf7kvsqukE52Pkz+FT3/ncytrP2BTXndV01KDTJtML01LT/9MR1YnWZNii2jzdLeBw4/3myurP7gDzVPe/+zQAqQQRCWINjhGOFVQZ2BwTIPsijCW+J48p/CoDLKQs4iy9LDksXCsrKq4o7CbtJLoiXSDfHUsbqhgGFmcT1xBfDgQMzwnFB+sFRATTApoBmADO/zn/1v6i/pf+sP7n/jX/k//5/18AvwAPAUoBZwFiATMB1wBJAIf/jf5c/fT7VfqC+H/2UfT98Yrv/uxk6sHnIuWO4hDgsN1623bZrdco1u/UCdR700rTe9MP1AjVZ9Yq2E7a0Nyq39biTuYI6vvtHfJk9sT6Mv+hAwcIVwyIEIwUWhjpGzEfKCLJJA4n8ih0KpErSCybLI0sHixXKzoqzygfJy8lCyO6IEYeuhsfGX4W4hNREdYOeAw9CisISQaYBB0D2QHMAPf/WP/q/qz+mP6p/tr+I/9+/+L/SACpAP0APQFhAWUBQAHvAG4Auf/N/qr9T/y/+vv4Bffk9JvyMfCv7Rvrfejg5Uzjy+Bo3ivcHtpJ2LfWbdV11NPTjdOo0yTUBdVL1vXXAdpq3CzfQuKk5UvpLO0/8Xj1zfky/psC/gZPC4EPihNgF/kaTB5SIQMkWiZSKOgpGivnK1AsWCz/K00rRCrsKE4nbyVYIxQhqx4nHJIZ9hZbFMsRTg/sDKsKlAioBu8EagMbAgMBIgB4/wD/uP6b/qX+zv4S/2n/y/8wAJMA6gAvAVoBZQFKAQQBjwDn/wj/9P2o/Cb7cPmH93P1NvPX8Fzuz+s36Z3mCuSH4SDf3dzG2ufYSNfv1eXUMNTV09nTP9QI1TbWx9e52Qrctd604QHlk+hi7GXwkPTa+DX9mAH3BUYKeg6IEmUWCBpmHXogOyOkJa4nWCmfKoIrASweLNwrPitKKgYpeCeqJaIjayEMH5IcBBpsF9MURBLFD2ANGwv9CAkHRwW4A14CPAFQAJv/GP/G/qD+of7E/gL/Vf+1/xkAfQDXAB8BUQFkAVIBFwGsABEAQf86/vz8ifvg+Qb4/vXN83jxCO+B7O7pWOfG5EPi19+P3XHbh9na13PWWNWR1CLUENRf1BDVJdae13fZsNtD3izhY+Th557rkO+t8+r3PPyYAPMEQAl1DYcRahUVGX8coB9wIukkByfFKCAqGSutK+ArsysqK0sqGimfJ+El6CO+IWwf+hxzGuAXSxW8Ej0Q1Q2LC2YJbAehBQgEpAJ3AYAAwP8z/9b+p/6g/rz+9P5C/57/AgBmAMIADwFGAWEBVwEmAccAOAB2/33+Tv3o+036gfiG9mH0F/Kv7zHtpOoR6IHl/eKQ4EHeHNwo2nDY+tbP1fXUctRL1ITUHtUb1nvXPNlc29jdqeDK4zTn3uq/7s3y/vZH+5z/8QM8CHEMhhBuFCIYlxvEHqMhLCRcJi4onSmqKlUrnSuGKxMrRyoqKcEnFCYrJA4ixx9fHeAaUxjBFTQTtBBKDvwL0QnQB/wFWgTsArQBsgDo/1D/6f6w/qD+tP7n/i//if/s/08ArQD+ADoBWwFbATQB4ABdAKf/vP6b/UT8t/r5+Ar38fSy8lTw3u1Y68noO+a440fh9N7I3MvaCNmE10nWXtXI1IzUrdQx1RXWXdcG2Q7bct0s4DfjjOYk6vPt8vEW9lT6of7wAjkHbguFD3MTLhesGuYd0yBtI64lkicWKTkq+CpWK1Qr9io/KjYp3ydDJmokWyIgIMIdSxvEGDYWqxMrEb4ObQw9CjUIWQauBDYD8wHnABEAbv/+/rv+o/6v/tr+H/91/9X/OACYAOwALQFVAVwBPgH2AH4A1v/4/uT9m/wd+2z5i/d+9Uvz9vCJ7gnsf+n05nHk/+Go33XdcNuh2RDYxtbJ1SDV0NTc1EjVFtZF19bYxtoS3bXfquLq5W7pLe0c8TL1Zfmq/fMBOAZsCoUOeBI5FsIZBx0CIKsi/ST0JosowimXKgsrHivVKjMqPSn5J24mpSSlInYgIx60GzMZqhYhFKIRMw/eDKkKmgi3BgMFggM1Ah4BPACQ/xT/yP6n/qv+z/4P/2H/v/8iAIIA2QAfAUwBWwFHAQkBnQAAADD/Kv7v/H/72/kI+Aj23/OV8TDvuOwz6qvnKeW24lvgI94V3Dvan9hG1znWfdUZ1RDVZtUc1jPXrNiE2rjcRN8j4k/lvuhq7ErwUvR6+LX8+AA5BWwJhg18EUQV1RglHC4f5iFJJFIm/SdIKTEquirjKq8qIipAKQ8olibcJOoiyCCAHhocoRkcF5YUFxKoD1ANFgsBCRcHWgXPA3gCVwFqALP/Lf/X/qz+qf7H/gD/Tv+p/wsAbADGAA8BQgFZAU0BGQG4ACgAZf9t/j/93ftI+oH4jfZx9DHy1u9k7eXqYejg5WzjD+HR3rvc2dov2cnXq9be1WbVSNWH1SfWJ9eH2EfaZNzY3qHht+QT6K3rfO9385P3xPsAADwEbQiIDIIQTxToF0MbVx4eIZIjrSVrJ8ooyClmKqQqhSoMKj4pICi5JhAlLSMYIdsefxwMGowXChWMEhwQwQ2EC2oJeAezBR4EvgKSAZsA2P9I/+j+tP6p/r/+8v48/5T/9f9WALEA/gA3AVUBUgEnAdEATQCW/6z+jP04/LD69/gQ9//0yvJ38A7ulOsU6ZbmIuTC4YDfY91328PZTtgh10LWt9WF1a7VN9Yf12jYENoW3HPeJuEm5G7n9uq07qDyr/bW+gv/QgNwB4sLhw9aE/sWYBqAHVUg2CIEJdUmSChbKQ0qYCpWKvIpOCktKNgmPyVrI2QhMx/gHHUa+xd8FQATkBA0DvIL0gnZBwwGbwQFA84BzQAAAGX//P6+/qr+uf7m/iv/gP/f/0AAnQDtACsBTwFUATIB6ABuAMX/5/7V/Y/8FPtp+Y/3ivVg8xfxte5C7MbpSufX5HXiLuAM3hbcV9rV2JrXqtYM1sbV2tVN1h7XT9jg2c3bFN6v4JrjzuZD6vDtzfHP9ez5Gf5JAnUGjwqNDmUSDBZ6GacciR8cIlkkOybCJ+kosCkYKiQq1CktKTYo8yZrJacjrSGHHz8d3BppGO0VdBMEEaUOYQw8Cj0IaAbCBE4DDQIBASkAhf8R/8r+rf60/tv+G/9s/8n/KgCHANsAHQFIAVQBPAH7AI0A8P8f/xv+4vx1+9f5CvgS9vPzs/FZ7+3sdur+54vlKOPd4LXeuNzu2l/ZFdgV12XWC9YL1mbWIdc72LTZitu53T/gFOMz5pXpMe3/8PP0Bfkp/VQBewWUCZQNcBEeFZQYzBu7HlwhqiOfJTgncyhPKcwp7CmxKR8pOigKJ5Ml3iPzIdkfmx1BG9QYXhbmE3cRGA/QDKUKoAjFBhYFmQNOAjgBVQCn/yn/2P6y/rL+0v4M/1r/tP8TAHIAyAAPAT4BUgFDAQwBqgAYAFT/Xf4y/dP7QvqC+JX2gvRM8vvvlu0l66/oPubZ44zhX99Z3Ybb7NmT2IPXwtZV1kDWhtYr1y3YjtlN22Xd1N+T4p7l7eh37DXwG/Qh+Dz8YACEBJsImwx7EC8UrhfwGusdmyD5Iv8kqyb5J+oofCmwKYkpCyk6KBwntyUSJDUiKSD1HaMbPhnMFlgU6hGJDz8NEAsFCSIHbAXlA5ECcAGDAMr/Qv/o/rn+sf7K/v7+SP+f//7/XAC1AP8ANAFOAUgBGwHDAD0Ahv+c/n79Lfyp+vb4FvcN9eLymvA97tHrX+nv5ovkO+IJ4P3dINx72hXZ9dcj16LWedar1jnXJNhu2RXbFt1u3xjiDuVJ6MLrb+9I80L3U/tx/44DowekC4cPQBPGFhIaGh3XH0UiXSQaJn0ngSgnKXApXSn0KDYoKyfXJUIkdCJ0IEweBBylGTkXyBRbEvoPrg17C2sJggfDBTME1gKrAbQA8P9e//r+wv6y/sT+8v43/4v/6P9HAKEA7gApAUkBSgEnAdkAXwC1/9f+x/2D/A37ZvmT95b1dvM38eHufOwN6qDnPOXq4rPgoN673AvbmNlq2IbX9Na31tPWS9cg2FTZ49rN3A/fo+GE5KvnEuuu7nnyZvZt+oP+mwKuBq4Kkg5QEt4VMxlGHBIfjiG2I4Yl+yYTKM0oKyktKdgoLig1J/MlbiSvIrwgoB5hHAoapBc3FcwSaxAdDucL0QnhBxwGgwQcA+cB5gAYAHv/Dv/N/rT+vv7n/if/d//T/zIAjQDdABwBQgFMATEB7gB+AOD/EP8M/tX8bfvT+Qz4G/YG9NHxg+8j7brqT+js5ZjjXuFF31fdndse2uHY7tdJ1/jWANdj1yLYPtm32orctN4y4f7jEudm6vLtrfGO9Yv5mP2rAboFuQmfDWER9hRTGHIbSh7UIA0j7yR2JqIncCjjKPkouCghKDonCyaXJOYiASHxHr0cbRoOGKUVPBPbEIwOUww5CkIIdQbVBGUDJgIbAUIAnP8k/9r+uP67/t3+F/9l/77/HAB4AMsADgE6AUoBOAH/AJsACABE/07+Jf3J+z36gvie9pP0aPIi8MntZev96JvmRuQI4uvf9d0x3KbaW9lY2KLXP9cz13/XKNgu2Y/aTNxg3sjgf+N+5sDpOu3m8Lr0q/iw/LwAxwTGCK0MchANFHIXmxp/HRkgYSJUJO4lLScPKJUowCiTKBAoPCceJrskGiNDIT8fFR3PGnUYERarE0wR+w6/DKEKpQjRBigFrwNmAlEBbgC9/zz/6f6+/rr+1P4K/1P/qf8GAGMAuAD/ADEBSAE+AQ4BtAAtAHb/jf5x/SL8o/r1+Bz3HPX78r7wbO4O7KrpSefz5LPikOCU3sfcMNvY2cbY/9eJ12nXodc02CPZbtoU3BHeY+AF4/DlHumI7CTw6/PQ98v70f/YA9MHuwuDDyMTkRbEGbQcWx+zIbYjYiW0JqonRCiDKGoo+yc6Jy4m2yRKI4IhiR9qHS4b2hh7FhkUuxFpDysNCQsICSwHfAX6A6gCiQGcAOL/V//5/sb+uv7O/v3+Qv+W//H/TgCkAO8AJgFDAUIBGwHLAFAApf/I/rn9ePwG+2T5mPej9YzzWPEN77TsVer256DlXuM24TTfXd2821faNtle2NfXo9fH10XYHdlS2uHbyN0E4JDiZ+WC6NrrZ+8e8/j26frp/ukC4wbKCpUOOhKvFeoY5xubHgEhFiPTJDgmQSfvJ0IoPSjhJzQnOib4JHcjvSHRH74diRs+GeUWhRQpEtcPmA1yC2wJigfSBUcE7QLEAc0ABwBz/wz/0P67/sj+8v4y/4L/3P85AJEA3gAaAT0BQwElAeAAbwDQ/wD//v3K/GX70fkP+Cf2GvTv8azvWe3+6qHoTOYI5N3h1N/13Urc2dqp2cLYKdji1/HXWtgd2Tvas9uE3anfIOLj5OvnMeut7lfyJPYL+gL+/gH1BdsJqA1QEcsUEBgXG9kdTiByIkEktyXUJpYn/ScLKMMnKSdBJhEloCP0IRYgDh7jG6AZTRfxFJcSRRAEDtsL0AnpBykGlgQyAwAC/wAwAJH/If/c/r7+xP7o/iP/cP/I/yQAfQDNAA0BNgFDAS4B8gCMAPn/Nf8//hj9wPs5+oT4p/ak9IPySfD87aXrS+n35rHkg+J14I/e2dxd2yDaKdl+2CTYINh02CHZKdqL20XdVd+24WTkWOeN6vntk/FU9TD5H/0UAQcF7Qi7DGcQ6RM2F0YaFB2XH8shrCM0JWMmOCezJ9UnoScaJ0QmJiXFIygiVyBbHjscABqzF1sVBBOyEHAORAw1CkgIggbnBHoDPgIzAVoAsf84/+r+xP7C/t/+Ff9e/7P/DwBoALsA/gAtAUEBNAECAaYAHgBn/37+ZP0Z/J369fgk9yz1FPPi8J3uSuz06aHnW+Uq4xfhKd9r3eLbmNqS2dfYa9hT2JPYK9kc2mjbDN0F31Hh6uPM5u7pSO3U8If0Wfg//C4AHAQACM8Lfw8FE1oWdRlOHN8eIiESI60k7yXXJmUnnCd7JwcnQyY3JeYjWSKWIKUekBxdGhYYxBVvEx8R3Q6uDJsKqAjbBjgFwwN+AmkBhgDU/1D/+f7L/sL+1/4I/03/oP/6/1QAqADvACMBPQE4AQ8BvgBBAJX/uf6s/W38//pj+Z33sPWj83nxOu/u7JvqSugE5tDjuOHE3/3datwT2//ZM9m22IvYttg42RXaStvY3Lze8uB340TmU+md7Bnwv/OF92L7Sv80AxUH5AqWDiISfhWiGIYbJR52IHciIiR3JXImFCddJ1An7yY/JkQlBCSGItEg7R7iHLgaeBgsFtoTixFIDxgNAQsJCTYHjAUOBL8CoQG0APn/a/8L/9P+wv7R/vz+Pf+N/+b/PwCVAN8AFwE4AToBGwHTAGAAwf/x/vD9vvxd+875E/gy9i70DfLW74/tQOvy6Kvmd+Ra4mHgkd703JHbbtqT2QTZxtjd2EzZEtoy26rcd96Y4AjjweW+6PbrY+/78rX2iPpo/k0CKwb6Ca4NPhGgFM4XvRpoHcgf2SGVI/wkCSa/JhsnISfUJjYmTSUeJK8iCCExHzEdERvZGJEWQxT3EbMPgQ1nC2oJkQfgBVoEAwPcAeUAHgCI/x7/3/7F/s7+8v4u/3v/0f8rAIEAzwAMATEBOwEjAeUAfgDq/yb/Mv4M/bj7NfqG+LD2t/Sf8m/wL+7k65jpUucc5f3i/eAm34DdENzh2vbZVtkG2QrZY9kU2h/bgNw53kTgnuJD5S3oVOuw7jry6PWw+Yr9aAFEBREJxwxbEMMT+BbyGakcFx83IQQjfCSdJWUm1SbvJrQmKSZSJTQk1SI9IXIffh1mGzYZ9RarFGESHxDrDc4LzQnuBzYGqARIAxcCFwFHAKf/M//r/sr+y/7p/iD/af+9/xYAbgC+AP4AKQE6ASsB9gCZAA8AWP9w/lj9D/yZ+vb4K/c89S7zBvHM7ofsPur558Hln+Ob4bzfDN6T3FXbXNqr2UrZOtl/2RzaENtc3P/d9d864svkoue26gPufvEf9d34rvyGAF4EKgjhC3cP5hIjFiYZ6RtkHpMgcSL6Iy0lCCaLJrgmkSYYJlIlRST3Im4hsB/HHbobkhlXFxIVyhKJEFUONQwwCkwIjAb4BI8DVQJLAXEAx/9L//n+z/7K/uH+FP9Y/6r/AgBaAKsA7wAgATcBLwEEAbAAMgCG/6r+n/1j/Pn6Yvmj9771uvOa8WfvJ+3h6p7oZuZC5DniVOCb3hbdzNvE2gTakdlu2aDZKNoH2z3cyt2r39vhV+Qb5x7qWe3G8Fr0DfjV+6f/egNEB/sKlQ4IEkwVWBgmG68d7B/aIXUjuiSnJT0mfiZpJgMmUCVUJBUjmiHrHw4eDBzsGbgXdxUzE/MQvg6cDJMKqgjlBkgF1wOVAoEBngDq/2T/Cv/X/sr+2/4I/0j/l//u/0YAmQDgABUBMgEyAQ8BxgBSALL/4v7j/bT8VvvM+Rj4PvZC9CzyAPDF7YPrQ+kK5+Tk1uLs4Crfm91G3DDbYNrc2afZxdk42gLbJNyb3WXfguHq45nmi+m17BLwmfNA9//6yv6YAmAGFgqyDSoRdRSKF2Ma9xxDH0Eh7CJCJEIl7CU/Jj0m6iVIJV4kMCPEISMgUh5aHEMaFhjbFZoTXBEnDwMN9woJCT4HmgUhBNUCuQHMAA8Af/8c/+H+zP7X/v3+Of+F/9r/MgCGANAACgEtATMBGQHZAHAA2v8X/yT+Af2w+zL6ifi69sn0u/KW8GHuJOzl6a7nheV144ThvN8j3sHcntvA2ira49nu2U3aA9sO3HDdJt8t4YHjHeb76BXsY+/c8nf2LPrw/bgBfQUzCdAMTBCdE7sWnRk+HJgepCBgIsgj2iSWJfwlDSbNJT0lZSRGI+ohVyCSHqYcmBpzGD0WABTDEY8Pag1bC2gJmAftBWwEGAPzAfwANQCd/zD/7f7P/tP+9P4r/3P/x/8eAHMAwAD9ACUBMgEhAeoAiwAAAEj/Yv5L/Qf8lPr3+DP3TPVH8yrx/O7C7IfqUOgn5hPkHeJO4KzeQN0P3CHbfNok2hzaZ9oI2//bS93s3t3gHeOm5XHoeuu47iPysvVc+Rj92wCcBFAI7wtuD8US6hXXGIQb6h0GINEhSiNuJD0ltSXZJaslLyVmJFojDSKIINAe7hzrGs0YnhZlFCoS9w/RDcALyQnzB0EGuQRdAy4CLwFeALz/Rv/6/tX+0f7r/h7/Y/+z/woAYACuAO8AHQExASYB+ACjACMAd/+c/pL9Wfz0+mL5qvfN9dHzvPGU71/tJ+vy6MjmseS34uHgNt+/3YPchtvR2mjaTdqF2hHb89sr3bbek+C+4jPl7Ofj6hHubfHw9JD4RPwAALwDcAcPC5EO7BEZFQ8Yxxo6HWQfPyHJIv8j3yRrJaIlhiUbJWUkaSMsIrUgCx81HTsbJRn8FsgUkRJeEDgOJAwpCk4IlwYHBaMDawJiAYgA3f9e/wn/2/7R/uX+Ev9T/6H/9/9MAJ0A4QATAS0BKgEEAbkAQwCj/9T+1v2q/FD7y/kd+Er2WPRK8inw++3G65LpaOdQ5VHjdOHC30He+Nzv2yrbr9qD2qjaINvt2w/dht5O4GXixuRs51Hqb+298DL0x/dx+yj/3wKQBi8KtA0UEUcURhcIGogcwB6rIEUijCN+JBwlZSVdJQQlYCR1I0gi3yBCH3gdiBt7GVkXKhX2EsUQng6IDIsKqwjtBlcF6gOqApgBtAAAAHj/Gv/k/tL+3/4H/0T/j//j/zgAigDRAAgBKAErAQ4BzABiAMz/CP8X/vf8qPsv+oz4xfbc9NfyvfCU7mPsMuoH6O7l6+MJ4k/gxN5w3Vnchdv62rzaztoz2+zb+txa3g7gEOJd5PHmxOnR7BDwePMB96P6Uf4FArMFUQnYDDwQdRN8FkkZ1RsZHhMgvSEWIxskyiQmJTAl6SRXJHwjXyIGIXYfuB3TG88ZtBeKFVoTKxEED+0M7AoICUUHpwUzBOoC0AHjACQAlP8t/+/+1f7b/v7+Nv9+/9D/JQB4AMIA/AAhASwBFwHdAH0A8v86/1T+QP3++5D6+fg89131YfNO8Svv/uzP6qfojOaG5J7i3eBJ3+ndxtzk20nb+dr52krb79vo3DTe09/A4frjeuY76TjsZ+/C8kD21/l+/SsB1wR0CPwLYw+jErEVhxgeG3EdeR8zIZ0isiN0JOMk/iTKJEkkgCNzIikhpx/2HRscIRoNGOkVvROQEWoPUQ1OC2UJnQf5BX0ELAMJAhMBSwCx/0L/+/7Z/tn+9f4p/23/vf8RAGQAsADuABkBKgEdAewAlQAVAGn/j/6H/VH87/pj+bD32/Xp893xwO+Y7W3rROko5yDlNONs4dDfZt423UXcm9s62yfbZtv329vcE96d33bhm+MI5rjoo+vD7hDygvUO+a78VQD8A5gHIAuLDtAR5RTFF2caxxzdHqYgICJHIxskmyTKJKgkOSSAI4QiSSHVHzAeYRxvGmQYRxYeFPQRzw+2DbALxAn2B0wGyQRwA0QCRQF0AND/WP8J/+D+2P7v/h3/Xv+r////UgCfAOEAEAEnASEB+QCsADYAlP/G/sr9oPxK+8n5IvhX9m30avJT8DDuCOzi6cXnu+XK4/zhV+Dj3qfdqtzw237bWtuG2wPc09z33WzfMOFC45zlOegT6yPuYfHH9En44PuB/yMDvgZGCrQN/BAZFAIXrxkZHD4eFyCgIdgiviNRJJEkgSQkJH0jkCJkIf8fZx6kHLwauRiiFn4UVxIzEBkOEgwiClAIoAYVBbUDgAJ5AZ8A8v9x/xn/6P7Z/un+Ev9O/5n/7P8/AI4A0gAGASMBIwEEAcAAVAC+//r+Cv7s/KL7LfqQ+ND27/T08uTwx+6i7H7qYehV5mHkjOLg4GPfHN4R3UjcxtuR26nbFNzQ3N/dQN/w4O3iNOW/54fqh+248BD0h/cV+7D+TQLlBW0J3AwpEEwTPRb0GGsbnR2EHx4hZyJeIwIkVSRXJAskdSOZIn0hJiCcHuQcBxsLGfsW3RS5EpcQfQ50DIEKqgj0BmQF/AO/Aq4BywAUAIv/K//x/tv+5P4I/0D/iP/Y/ywAfADDAPoAHQElAQ0B0QBwAOT/LP9H/jX99vuN+vz4Rfdu9Xzzc/Fb7zrtGOv86O/m9+Qe42rh49+R3nrdo9wS3Mvb0tsp3NHczN0Z37XgnuLR5EnnAOrw7BHwXfPI9k364P15AQ0FlQgGDFYPfxJ3FTgYuxr5HO8emCDyIfoisCMVJCgk7iNqI58ikiFKIMweIB1OG1wZUxc6FRkT+RDhDtYM4AoFCUoHswVDBP4C5gH5ADoAp/8+//z+3/7h/v/+M/93/8b/GABqALMA7gAVASMBEwHhAIkABwBb/4L+e/1I/Ov6ZPm49+v1APT/8e3v0e2x65bpiOeO5bDj9eFm4Anf5d0B3WDcCdz+20Lc19y+3fbefuBU4nPk2OZ+6V3sb++t8g72iPkU/aYANwS+BzALhA6xEbEUexcIGlQcVx4PIHkhkiJaI9Ej9iPOI1sjoCKkIWog+h5bHZMbqhmoF5YVeRNcEUMPOA1AC2EJoQcDBo0EQAMeAikBYQDF/1T/Cv/k/uD++P4n/2f/tP8FAFcAogDhAA0BIQEZAe4AnwAoAIb/uP6+/Zf8RfvJ+Sj4ZPaD9InyffBm7knsMOoh6CXmQuSB4urghN9U3mHdstxL3C3cX9zh3LTd2N5M4A7iGuRt5gDpzuvS7gHyVvXG+En81/9kA+gGWgqxDeMQ6hO8FlUZrBu9HYQf/iAoIgEjiSPBI6ojSCOeIrIhhyAlH5Id1Rv2GfwX7xXYE7wRpg+aDZ8LvQn4B1UG1wSCA1gCWwGKAOb/a/8Y/+v+4P7y/hv/WP+i//P/RQCRANMABAEdARsB+gC0AEYAr//t/v394vyc+yv6lfjb9gP1EfML8fnu4OzJ6rrou+bU5A7jb+H/38Texd0H3Y/cYdyB3PDcr92/3h/gzeHF4wbmh+hE6zjuWvGi9Aj4g/sK/5ICFAaGCd8MFRAiE/0VnxgCGyAd9h6AILohpCI+I4cjgiMxI5giuyGgIEwfxh0UHD8aTRhHFjQUHBIHEPsN/wsZClAIpwYjBccDlQKOAbQABwCE/yn/9P7h/u3+Ev9K/5H/4f8yAIAAxAD4ABgBHQEDAcYAYgDW/x7/Ov4r/fD7ivr/+E/3gPWW85fxiu917WDrUelR52jlnOP24XzgNt8r3l/d19yY3KbcAt2v3ave99+R4Xbjo+UT6L/qo+228PLzTfe++j7+wgFCBbMIDQxID1oSPBXoF1YaghxmHv4fSSFEIu8iSiNWIxcjjyLCIbYgcB/3HVEchhqcGJ0WjxR7EmgQXA5fDHcKqQj7BnAFDATTAsQB4QAqAJ7/O//+/uX+6f4I/z3/gf/O/x8AbgC1AO0AEQEdAQoB1gB8APr/Tf90/nD9QPzn+mb5wPf69Rn0IvIa8Anu9uvo6efn+uUq5H3i++Cr35Peud0j3dPc0NwZ3bPdm97U31rhLONF5aPnPuoS7RfwRfOV9v75df30AHAE4Qc8C3oOkhF8FDAXqRnhG9Mdeh/VIOAhnSIJIycj+SKCIsUhyCCRHyUeixzKGuoY8hbpFNkSyBC8Dr4M1AoCCU8HvgVTBBED+wEPAU8Au/9P/wr/6f7n/gH/Mf9x/73/DQBcAKQA4QAKARsBEAHkAJMAGgB5/6v+sv2O/ED7yfku+HL2mfSp8qjwm+6L7H7qfOiN5rnkBeN74SHg/d4W3nHdEt393DTdut2Q3rTfKOHm4u3kN+fC6YXse++c8uH1P/mw/CgAoQMQB2wKrA3JELoTdxb7GD4bPR3zHl4geiFHIsQi9CLXInAixSHYIK4fUB7CHAsbNBlEF0IVNRMnERwPHg0xC1wJowcNBpwEUgMzAj8BdgDZ/2X/GP/v/uf++v4l/2L/q//7/0oAlQDTAAEBGAETAe8AqAA5AKL/3/7y/dn8lvsq+pr45/YX9S7zM/Er7x/tFOsS6SDnR+WO4/zhmeBq33bewt1U3S7dU93H3Ynem9/54KXimOTR5krp/evk7vfxMPWE+Oz7X//TAkAGnQngDAAQ9xK9FUoYmhqmHGoe5B8QIe4hfCK9IrIiXCLAIeMgyR93HvUcSxt9GZQXmBWQE4URew99DY4Ltgn5B10G5QSUA20CcQGfAPn/ff8n//f+6P71/hv/VP+a/+n/OACDAMUA9wATARUB+QC6AFUAyf8R/y7+If3o+4j6AvlZ95H1sPO88brvse2o66bps+fW5Rjkf+IT4dnf2N4X3pndY9123djdh96F39DgaOJJ5G/m1+h561HuVvGD9Mz3LPuY/ggCcgXOCBMMNw80EgIVmRfzGQwc3h1nH6MgkSExIoMiiCJEIrkh6yDfH5weJx2HG8MZ4hftFeoT4hHaD9sN6wsQClAIrgYwBdgDqAKjAckAGgCW/zn/AP/q/vH+Ev9H/4r/1/8mAHIAtgDsAA4BFgEBAcsAbwDs/z//aP5l/Tn84/po+cj3CvYx9EPyR/BB7jrsOepF6GXmouQD443hSuA9327e4d2b3Z3d7d2J3nTfrOAx4v7jEuZo6Prqwu258NnzGPdv+tT9PgGmBAAIRwtvDnERRRTmFksZcBtQHeceMyAxIeIhRiJcIigirSHvIPIfvR5VHcAbBhouGEAWQxQ9EjgQOg5IDGsKpgj/BnsFHATlAtgB9gA+ALH/TP8M/+7+7/4K/zr/e//F/xQAYQCnAOAABgEVAQcB2QCGAA0Aa/+f/qj9hvw7+8r5NfiA9q/0yfLR8NDuzOzM6tfo9eYt5YfjCuK84KTfyN4t3tbdyN0F3pDeZ9+M4P7huOO65f7nfuo37SDwMvNn9rT5Ev12ANoDNAd7CqYNrRCIEzEWoRjSGr8cZR7AH88gkCEEIisiCSKeIfAgAiDbHn8d9xtHGngYkRaZFJgSlRCXDqUMxgr9CFIHyAViBCQDDgIkAWQAzv9g/xj/8/7u/gP/L/9s/7T/AQBPAJcA0wD+ABIBDAHlAJsALACU/9P+5v3Q/JH7Kvqf+PP2K/VL81rxXe9d7V7raOmE57jlDOSH4jDhDuAk33veFd733SLemt5f33Hgz+F342blmOcI6rDsi++Q8rj1/PhS/LH/EQNpBrAJ3gzqD8wSfBX2FzIaLBzgHUofaSA7Ib8h+CHlIYsh7SAPIPYeqB0rHIYavxjgFu4U8RLxEPUOAw0gC1UJpQcWBqkEYwNHAlQBiwDt/3f/J//6/u7+/v4l/17/pP/w/z0AhwDGAPQADgEOAe8ArgBIALv/BP8i/hf94vuG+gb5Y/ek9czz4fHp7+vt7uv56RPoROaS5Afjp+F54ITfzN5X3ijeQ96p3lvfWuCl4TrjFuU355bpLuz67vHxDvVI+JX77/5KAqAF5wgWDCUPDRLGFEkXkBmXG1kd0R4AIOEgdyHAIb8hdSHnIBggDR/NHVwcwRoFGS0XQhVKE0wRUQ9fDXsLrQn5B2QG8gSlA4AChQG0AA0Ajv83/wP/8P76/hv/UP+U/9//LAB2ALgA6gAKAQ8B+ADAAGIA3/8z/1z+XP0y/OD6avnR9xr2SvRm8nPwee5+7InqoujQ5hnlhuMd4ubg5d8g35zeXt5o3rveW99I4IDhAuPM5NrmJ+mw62zuV/Fn9Jb33Pou/oQB2AQeCE8LYg5PEQ8UmxbtGP8azhxWHpMfhiArIYUhlSFcId0gHSAiH+4dihz7GkcZeBeTFaATphGtD7sN1wsGCk4IswY7BecDuwK4Ad8ALwCo/0j/Df/z/vb+E/9E/4T/zv8aAGUAqQDfAAMBDwH+AM4AegAAAF7/kv6d/X78N/vL+Tz4jvbG9Ojy/PAG7w3tGesx6VvnoOUH5JbiVeFI4Hbf5N6W3o/e0t5g3zrgX+HO4obkgua+6Dbr5O2/8MTz6PYk+m/9wQARBFcHiAqeDZAQVxPrFUgYZhpCHNgdJB8nINwgRyFnIT4h0CAgIDIfDR61HDEbiBnBF+MV9RP/EQgQFw4xDF4KoggDB4UFKwT4AuwBCwFTAMT/XP8Z//j+9f4M/zn/df+9/wkAVQCaANMA+wANAQQB2wCQAB8Ah//G/tv9yPyL+yr6pPj/9j/1afOC8ZDvmu2o67/p5+co5onkEePG4a7g0N8w39Peu97s3mjfMOBD4aDiROQu5lnowOpe7S3wJPM99nD5tPwAAEwDkAbCCdsM0Q+fEjsVoRfLGbQbVx2zHsQfiiAFITUhHSG/IB8gQB8oHt0cZBvGGQgYMRZJFFcSYxByDowMtwr4CFUH0AVvBDUDIgI4AXgA4f9x/yb//v70/gb/Lv9n/6z/9/9DAIoAxgDyAAoBBwHmAKMAOwCu//f+F/4O/d37hfoK+W73tvXn8wbyGfAm7jXsTOpy6LDmC+WM4zjiFuEr4H7fEt/q3gvfdd8r4CrhdeII5N/l+edP6t3sne+I8pX1v/j6+0H/iQLLBf0IFwwSD+YRihT6Fi4ZIxvUHD4eXh81IMAgASH5IKsgGiBKH0AeAh2VGwEaTBh9FpsUrRK8EMwO5gwPC00JpgcdBrYEdANaAmgBnwAAAIj/Nf8G//b+Av8l/1r/nP/m/zIAegC5AOkABQEIAe4AtABWANL/Jf9Q/lL9K/ze+m352/cr9mP0iPKg8LHuwuzZ6v7oOOeP5Qjkq+KA4Yngz99U3x3fLd+G3yngF+FP4s/jleWc5+LpYewS7+/x8fQQ+ET7hP7IAQcFOQhVC1MOLBHYE1AWjxiQGk4cxx33HtwfeCDIINEgkyARIFEfVh4kHcQbOhqOGMcW6xQCExQRJg9ADWgLpAn4B2oG/QS1A5MCmQHIACAAoP9G/w//+P7+/hz/Tv+N/9b/IABqAKoA3gD/AAgB9gDEAG4A9P9S/4b+kv13/DT7zflE+J323fQJ8yXxOu9N7WXrienB5xLmhuQh4+vh6uAi4JnfU99T35vfLOAH4S3im+NP5UXneuno64vuW/FQ9GX3kPrK/QgBRQR2B5MKlQ1yECUTpRXvF/sZxhtNHYsegR8sII0gpiB4IAYgVB9nHkMd7xtwGs4YDxc6FVYTaxF/D5oNwQv6CUsIuAZFBfYDzQLMAfIAQgC7/1j/Gf/8/vz+Ff9C/3//xf8PAFkAnADTAPgABwH7ANEAhAASAHv/uv7R/cD8h/sq+qv4DfdU9YfzqfHC79jt8OsU6knoluYE5ZjjWOJM4Xjg4d+M33zfs98z4PzgEOJr4wzl8eYW6XTrB+7J8LPzvfbf+RL9SwCEA7MG0QnWDLcPcRL6FE0XZRk8G9AcHR4iH90fTiB3IFkg9x9UH3UeXx0XHKQaCxlUF4YVqBPBEdgP8w0ZDFAKnggHB44FOQQJA/8BHwFmANb/bP8m/wL/+/4O/zf/cf+1////SACNAMYA8AAEAf8A3ACYADAAov/r/gz+Bv3Y+4T6Dvl698r1AvQr8kjwYO577J7q0egb54PlD+TH4rDh0OAt4Mnfqd/P3z7g9eD24T/j0OSj5rboBOuI7TzwGfMY9jH5XPyQ/8UC8wURCRcM/Q69EU0UqhbNGLAaURysHcEeix8MIEUgNyDkH1EfgB54HTwc1BpGGZgX0RX5ExYSLxBLDnEMpwrxCFYH2AV9BEYDNQJMAYwA9P+C/zT/CP/8/gr/Lf9j/6X/7v83AH0AugDnAAABAQHlAKkASgDF/xn/Rf5I/SX83Ppw+eT3PPZ99KvyzfDo7gTtJ+tZ6aDnAuaI5DfjF+Is4XvgCODZ3+/fTODy4OHhGeOW5FjmWuiY6g3ts++D8nf1hvip+9f+CAI0BVIIWQtDDggRoBMFFjIYIRrQGzkdWx41H8cfDyARIM8fSx+IHo0dXxwDG34Z2hcaFkgUaRKGEKMOyQz9CkUJpgcjBsEEhANsAnwBswASAJn/RP8R//7+Bv8l/1f/lv/d/yYAbQCsAN0A+wACAe0AuQBiAOj/Rf97/on9cPwx+8/5TPis9vT0KPNP8W/vje2x6+HpJOiD5gPlquN/4ojhy+BK4AzgEuBf4PTg0eH24mLkEuYD6DDqluwt7/Hx2PTe9/n6IP5MAXUEkwecCokNUxDyEl8VlheRGUwbwxz0Hd4efh/XH+gfth9BH40eoR1/HC4btBkYGGEWlRS8EtsQ+w4hDVQLmQn2B28GBwXDA6QCrAHcADMAsv9V/xv/Af8D/x3/S/+H/8z/FQBdAJ4A0gD1AAEB8wDHAHgABgBu/67+x/24/IP7Kvqx+Br3afWl89Hx9O8U7jnsaOqp6APnfeUd5Oni5+Ee4ZDgQuA54HXg+eDE4djiMuTQ5bDnzekj7KzuYvE+9Dn3S/pr/ZMAuQPVBt8JzwydD0MSuBT5Fv8YxxpLHIodgh4zH5sfvR+ZHzMfjx6wHZscVxvnGVUYphbhFAwTLxFRD3gNqgvtCUcIuwZPBQQE3gLeAQYBVQDM/2j/J/8G/wL/F/9A/3n/vf8FAE0AjwDGAO0A/wD4ANIAjQAjAJX/3/4C/v380/uE+hT5hffd9R70UPJ38JvuwOzv6i/phef45ZHkVeNJ4nPh2OB94GTgj+AB4bzhveIG5JPlYedu6bTrLu7X8Kfzl/ag+br83P/+AhgGIwkVDOcOkxEQFFoWbBg/GtAbHR0lHuQeXB+NH3kfIh+NHrwdtRx8GxgakBjoFisVXBODEacPzw0ADEIKmAgIB5YFRgQZAxICMgF6AOj/fP80/wz/Av8S/zf/bP+t//X/PACAALoA5QD8APoA3QCfAD4Auf8N/zr+QP0g/Nv6dPnu9032lvTN8vnwH+9H7Xbrs+kG6HXmB+XC46ziy+Ej4bngkeCt4A/huOGn4t7jWuUX5xPpSeu17U/wE/P49ff4Cvwn/0UCXQVnCFwLMg7jEGcTuxXWF7QZUxuuHMQdkh4aH1ofVh8OH4gexR3LHJ8bRhrHGCkXchWpE9QR+w8lDlYMlgrqCFYH3wWJBFUDRwJfAZ8ABQCS/0L/FP8D/w3/Lf9f/57/5P8sAHEArQDbAPcA/ADlAK4AVwDb/zn/cP6A/Wr8L/vR+VT4u/YL9UnzevGj78zt++s46ojo8uZ95TDkEeMl4nDh+eDC4M7gH+G34Zbiu+Mk5dHmvOji6j7tzO+C8l31Uvhd+3P+jQGjBK0Howp8DTIQvhIZFT4XKBnTGjwcYB09HtQeJB8wH/cefx7LHd4cvhtxGv0YaBe4FfUTJRJPEHoOrAzrCjsJpAcpBs0EkwN9Ao4BxgAlAKr/Uv8d/wb/Cv8m/1T/kP/U/xwAYQCfANEA8QD7AOsAvQBtAPv/Yv+j/r39sfyA+yz6uPgo93/1wvP48SbwUe6B7LzqCelv5/TloOR444HiwOE84fXg8uA04brhiOKb4/Tkj+Zp6IDqzexM7/XxxPSw97L6wv3XAOsD9AbqCcYMgQ8TEncUphaaGFIayBv5HOUdjB7rHgYf3R50Hs0d7hzbG5oaMBmkF/wVPxR0EqIQzw4BDT8LjgnzB3MGEQXRA7UCvwHvAEYAw/9k/yf/Cv8I/x//Sf+C/8X/CwBRAJEAxgDqAPoA8ADJAIEAFwCI/9P+9/32/M/7hPoa+ZH38PU69HXypvDU7gXtQOuL6e3nbeYR5eDj3uIS4oHhLeEa4UvhwuF+4oDjx+RR5hvoIepf7M/ubfEv9BH3CvoU/SQANAM7BjIJEQzQDmgR0xMLFgsYzhlRG5Acix1AHq8e2B6/HmUezR37HPUbwBphGd4XPhaIFMIS8xAjD1YNkwvgCUIIvgZXBREE7gLxARkBaADe/3f/M/8Q/wj/Gf8//3X/tf/7/0EAgwC6AOMA9wDzANMAlAAyAK3/Av8w/jj9G/za+nj5+Pdf9q/08PIm8Vfvie3D6w3qa+jm5oPlSuQ+42fiyeFn4UXhZuHN4XjiaeOf5Bjm0efH6fXrV+7m8J3zdfZm+Wf8cv9+AoQFewhcCx8OvBAvE3AVehdIGdcaJRwuHfEdbx6oHp4eUh7JHQUdDBzjGo8ZFhh+Fs8UDxNEEXUPqg3mCzMKkggJB50FUgQpAyQCRQGNAPr/jP9B/xb/Cf8V/zb/aP+m/+z/MgB0AK4A2gDzAPUA3ACkAEsAz/8t/2X+d/1k/C371Pld+Mv2I/Vp86Px2O8L7kbsjerp6GDn9uW15KDjvuIT4qThdOGF4dvhduJW43rk4uWL53Hpj+vj7WXwD/Pc9cP4vfvC/soBzgTFB6cKbg0REIkS0xTmFsAYXBq2G80cnx0tHnUeeh49HsIdDR0hHAMbuhlKGLwWFBVaE5MRxw/+DToMhAriCFUH5QWTBGQDWAJyAbIAGACj/1D/H/8L/xL/Lv9d/5j/3P8hAGUAoQDQAO4A9QDjALIAYgDv/1b/mP60/av8ffsu+r/4NfeV9eHzIPJX8I3uyOwP62fp2edr5iHlBOQW42Di4+Gl4ajh7uF44kfjW+Sy5UnnHukt63Lt5++F8kb1JPgW+xX+GQEaBBAH8wm9DGQP5BE1FFIWNxjeGUUbahxLHecdPh5SHiUeuB0RHTEcIBvjGX0Y+BZXFaMT4REZEFAOjgzXCjIJogctBtYEoQOOAqEB2QA3ALv/Yf8o/w7/D/8n/1L/iv/M/xEAVQCTAMYA5wD0AOkAwAB2AAsAff/I/u797/zL+4X6IPme9wT2VvSa8tXwDe9K7ZDr5ulU6N/mj+Vp5HLjr+Im4trhzeEE4n3iPOM+5ITlC+fQ6M/qBu1s7/3xs/SH93H6af1oAGcDXAZACQsMuA49EZYTvBWrF18Z0hoFHPQcnx0FHiceCR6qHREdQBw7GwgarhgwF5gV6hMuEmgQog7gDCkLgQnvB3YGGgXeA8UC0QECAVgA1P9z/zP/E/8O/yH/SP99/73/AQBGAIUAugDgAPIA7ADKAIkAJwCh//b+Jv4w/Rb82vp9+QP4cfbK9BPzUvGN78rtEOxk6s/oVef+5c/kz+MB42viEuL24R3ihuI14yfkW+XS5oboduqd7PXuevEk9O32z/nB/Lv/tQKpBY0IWwsLDpYQ9hIlFR4X3BhdGp0bmhxTHcgd+h3qHZsdDx1KHFMbKxrbGGgX1xUwFHgSuBDzDjMNewvSCT0IvwZfBR0E/gICAiwBewDv/4b/QP8Z/w7/HP8+/3H/r//y/zYAdwCuANgA7gDuANMAmgBAAMP/If9b/m/9X/wr+9f5Z/jc9jv1ivPO8QzwSu6Q7OPqSunL527mN+Ut5FXjs+JM4iLiOuKU4jHjEuQ25ZzmQOgg6jjsgu768JjzWPYv+Rr8D/8FAvcE2werCl4N7g9VEo0UjxZZGOUZMhs9HAUdiB3JHccdhx0JHVIcZxtMGgcZnRcUFnQUwhIFEUQPhQ3NCyIKiggJB6MFXQQ3AzUCVwGfAAsAnP9O/yH/EP8Y/zf/Zf+g/+P/JgBoAKIAzwDqAO8A2wCpAFcA4/9K/43+q/2k/Hv7MPrH+ET3qvX/80fyifDJ7g/tYevF6ULo3+ag5Y7kquP94ojiUuJa4qTiMuMC5Bbla+b+58/p1+sT7n3wEPPE9ZP4dvtk/lcBRgQqB/oJsQxHD7MR8xP/FdQXbBnFGt0bsxxFHZUdox1wHQEdWBx5G2oaLxnPF08WthQKE1IRkw/VDR4McwrYCFQH6gWeBHIDaQKEAcQAKQCz/17/Kf8T/xb/L/9a/5L/1P8XAFkAlQDFAOUA7wDhALYAbAAAAHH/vv7k/ef8x/uG+ib5qvcX9nL0v/IE8Ufvju3e60HquuhQ5wvm7+QC5EnjyeKE4n3iuOI14/bj+eQ95sHngel666ftBPCL8jT1+vfU+r39qgCXA3kGSwkEDJ4OERFYE20VTBfwGFYafBtfHAAdXh16HVYd9RxaHIgbhRpVGf8XiBb2FFATnRHiDyYObwzDCiYJnwcxBt8ErQOeArMB6wBJAMv/b/80/xf/FP8p/1D/hv/F/wcASgCHALoA3QDtAOUAwQB/ABsAlv/r/hz+KP0R/Nr6gvkO+IP25PQ2837xxO8L7lzsvOox6cPnd+ZT5VzkmOML47nipOLQ4j3j7ePg5BPmh+c36SHrQO2P7wjyp/Ri9zX6",loudness:{gain:1}}},Hi={click:{loader:e=>su(e),debounceMs:30},spawn:{loader:e=>au(e),debounceMs:120},error:{loader:e=>ru(e)},attack:{loader:e=>Ca(ln.attack.payload,e),debounceMs:70,gain:ln.attack.loudness.gain},death:{loader:e=>Ca(ln.death.payload,e),debounceMs:180,gain:ln.death.loudness.gain},sisu:{loader:e=>Ca(ln.sisu.payload,e),debounceMs:800,gain:ln.sisu.loudness.gain}};let Qt=null,Kn=null;const eo=new Map,gs=new Map,to=new Map;let Mt=!1;typeof localStorage<"u"&&(Mt=localStorage.getItem("sfx-muted")==="true");const Va=new Set;function nu(){for(const e of Va)e(Mt)}function Fi(e){if(Kn)return Kn;const t=e.createGain();return t.gain.value=Mt?0:1,t.connect(e.destination),Kn=t,t}function Ar(e,t,n){const s=Math.floor(e.sampleRate*t),a=e.createBuffer(1,s,e.sampleRate),r=a.getChannelData(0);for(let o=0;o<s;o++){const i=o/e.sampleRate;r[o]=n(i)}return a}function su(e){return Ar(e,.05,t=>Math.sin(2*Math.PI*1e3*t)*Math.exp(-40*t))}function au(e){return Ar(e,.2,t=>(Math.sin(2*Math.PI*440*t)+Math.sin(2*Math.PI*660*t))*.5*Math.exp(-6*t))}function ru(e){return Ar(e,.3,t=>Math.sin(2*Math.PI*110*t)*Math.exp(-8*t))}function ou(e){const t=globalThis;if(typeof t.atob=="function"){const n=t.atob(e),s=n.length,a=new Uint8Array(s);for(let r=0;r<s;r++)a[r]=n.charCodeAt(r);return a}if(t.Buffer){const n=t.Buffer.from(e,"base64"),s=new Uint8Array(n.length);for(let a=0;a<n.length;a++)s[a]=n[a];return s}throw new Error("No base64 decoder available for sound payloads.")}async function Ca(e,t){const n=ou(e),s=n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);return await t.decodeAudioData(s)}function as(){if(Qt||typeof window>"u")return Qt;const e=window.AudioContext||window.webkitAudioContext;if(!e)return console.warn("Web Audio API not supported"),null;try{Qt=new e,Fi(Qt)}catch(t){return console.warn("Unable to create AudioContext",t),Qt=null,null}if(Qt.state==="suspended"){const t=()=>{Qt?.resume()};window.addEventListener("pointerdown",t,{once:!0}),window.addEventListener("keydown",t,{once:!0})}return Qt}function iu(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function cu(e){const t=eo.get(e);if(t)return Promise.resolve(t);const n=gs.get(e);if(n)return n;const s=as();if(!s)return Promise.reject(new Error("Audio context unavailable"));const a=Hi[e];if(!a)return Promise.reject(new Error(`No sound registered for ${e}`));const r=Promise.resolve(a.loader(s)).then(o=>(eo.set(e,o),gs.delete(e),o)).catch(o=>{throw gs.delete(e),o});return gs.set(e,r),r}function Dt(e){if(Mt)return;const t=Hi[e];if(!t)return;const n=iu(),s=t.debounceMs??0,a=to.get(e)??0;s>0&&n-a<s||(to.set(e,n),cu(e).then(r=>{if(Mt)return;const o=as();if(!o)return;const i=Fi(o),c=o.createBufferSource();c.buffer=r;const u=t.gain;if(typeof u=="number"&&u>0&&u!==1){const l=o.createGain();l.gain.value=u,c.connect(l),l.connect(i)}else c.connect(i);try{c.start()}catch(l){console.warn("Unable to start sound",l)}}).catch(r=>{r instanceof Error&&r.message==="Audio context unavailable"||console.warn("Failed to play sound",e,r)}))}function Za(){return Mt}function lu(e){Mt=e,Kn&&(Kn.gain.value=Mt?0:1),typeof localStorage<"u"&&localStorage.setItem("sfx-muted",Mt?"true":"false"),nu()}function uu(e){return Va.add(e),()=>{Va.delete(e)}}typeof document<"u"&&document.addEventListener("click",e=>{e.target instanceof HTMLButtonElement&&Dt("click")});as();const no="__autobattlesAudioEvents__",so=globalThis;so[no]||(R.on("unitDamaged",e=>{!e||e.amount<=0||Dt("attack")}),R.on("unitDied",()=>{Dt("death")}),R.on("sisuBurstStart",()=>{Dt("sisu")}),so[no]=!0);function du(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function hu(e){const t={};if(!e)return t;for(const[n,s]of Object.entries(e))typeof s=="function"&&(t[n]=s);return t}class fu{constructor(t=R){this.emitter=t}modifiers=new Map;hookIndex=new Map;listeners=new Map;add(t){if(typeof t.id!="string"||t.id.length===0)throw new Error("Modifier id must be a non-empty string");if((typeof t.duration!="number"||!Number.isFinite(t.duration))&&t.duration!==1/0)throw new Error("Modifier duration must be a positive number or Infinity");if(Number.isFinite(t.duration)&&t.duration<=0)throw new Error("Modifier duration must be greater than zero");const n=hu(t.hooks),s=du();this.modifiers.has(t.id)&&this.remove(t.id,"replaced");const a={...t,hooks:n,remaining:t.duration,appliedAt:s};this.modifiers.set(a.id,a),this.indexHooks(a);const r={runtime:this,modifier:a};return t.onApply?.(r),this.emit("modifierAdded",{modifier:a}),this.emitter?.emit("modifierAdded",{modifier:a}),Number.isFinite(a.remaining)&&a.remaining<=0&&this.remove(a.id,"expired"),a}has(t){return this.modifiers.has(t)}list(){return Array.from(this.modifiers.values()).map(t=>({...t,hooks:{...t.hooks}}))}remove(t,n="manual"){const s=this.modifiers.get(t);if(!s)return!1;this.modifiers.delete(t),this.unindexHooks(s);const a={runtime:this,modifier:s,reason:n};return s.onExpire?.(a),n==="expired"&&(this.emit("modifierExpired",{modifier:s}),this.emitter?.emit("modifierExpired",{modifier:s})),this.emit("modifierRemoved",{modifier:s,reason:n}),this.emitter?.emit("modifierRemoved",{modifier:s,reason:n}),!0}advance(t){if(typeof t!="number"||t<=0)return;const n=[];for(const s of this.modifiers.values())Number.isFinite(s.remaining)&&(s.remaining=Math.max(0,s.remaining-t),s.remaining<=0&&n.push(s.id));for(const s of n)this.remove(s,"expired")}trigger(t,n){const s=this.hookIndex.get(t);if(!s||s.size===0)return;const a=Array.from(s);for(const r of a){const o=this.modifiers.get(r);if(!o){s.delete(r);continue}const i=o.hooks[t];if(!i){s.delete(r);continue}i(n,{runtime:this,modifier:o})}}clear(){const t=Array.from(this.modifiers.keys());for(const n of t)this.remove(n,"manual")}on(t,n){const s=this.listeners.get(t)??new Set;s.add(n),this.listeners.set(t,s)}off(t,n){const s=this.listeners.get(t);s&&(s.delete(n),s.size===0&&this.listeners.delete(t))}emit(t,n){const s=this.listeners.get(t);if(!(!s||s.size===0))for(const a of Array.from(s))a(n)}indexHooks(t){for(const n of Object.keys(t.hooks)){const s=this.hookIndex.get(n)??new Set;s.add(t.id),this.hookIndex.set(n,s)}}unindexHooks(t){for(const n of Object.keys(t.hooks)){const s=this.hookIndex.get(n);s&&(s.delete(t.id),s.size===0&&this.hookIndex.delete(n))}}}const la=new fu,mu=e=>la.add(e),gu=(e,t="manual")=>la.remove(e,t),pu=e=>{la.advance(e)},ps=(e,t)=>{la.trigger(e,t)};class Au{constructor(t,n,s){this.owner=t,this.entries=n,this.log=s}runTick(t,n){for(const{definition:s,state:a}of this.entries){if(!s.onTick)continue;const r=s.onTick({owner:this.owner,state:a,self:t,opponent:n}),o=Wt(r?.shieldDamage??0);if(o>0){const c=Math.min(t.shield,o);c>0&&(t.shield-=c,this.log.tickShieldDamage+=c)}const i=Wt(r?.hpDamage??0);if(i>0){const c=Math.min(t.health,i);c>0&&(t.health-=c,this.log.tickHpDamage+=c)}}}grantShield(t,n){let s=0;for(const{definition:a,state:r}of this.entries){if(!a.onGrantShield)continue;const o=Wt(a.onGrantShield({owner:this.owner,state:r,self:t,opponent:n})??0);o>0&&(s+=o)}return s>0&&(t.shield+=s,this.log.shieldGranted+=s),s}consumeShield(t,n,s){let a=Wt(t);if(a<=0)return 0;let r=0;for(const{definition:o,state:i}of this.entries){if(!o.onConsumeShield||a<=0)continue;const c=Wt(o.onConsumeShield({owner:this.owner,state:i,self:n,opponent:s,amount:a})??0);if(c<=0)continue;const u=Math.min(a,c);r+=u,a-=u}return r>0&&(this.log.shieldConsumed+=r),r}applyHit(t,n,s){if(t<=0)return 0;let a=0;for(const{definition:i,state:c}of this.entries){if(!i.onHit)continue;const u=Wt(i.onHit({owner:this.owner,state:c,self:n,opponent:s,hpDamage:t})??0);u>0&&(a+=u)}if(a<=0)return 0;const r=Math.max(0,n.maxHealth-n.health);if(r<=0)return 0;const o=Math.min(r,a);return o>0&&(n.health+=o,this.log.lifesteal+=o),o}getShieldValue(){let t=0;for(const{definition:n,state:s}of this.entries){if(!n.onGrantShield||s.keyword!=="Shield")continue;const a=_a(s);if(a<=0)continue;const r=Math.max(0,Number.isFinite(s.stacks)?s.stacks:0);r<=0||(t+=r*a)}return t}}function vu(){return{attacker:ro(),defender:ro()}}function ao(e,t,n){const s=bu(e);if(s.length===0)return null;const a=[];for(const r of s){const o=Li.get(r.keyword);o&&a.push({state:r,definition:o})}return a.length===0?null:new Au(t,a,n)}const Li=new Map;function ua(e,t){Li.set(e,t)}function ro(){return{tickHpDamage:0,tickShieldDamage:0,shieldGranted:0,shieldConsumed:0,lifesteal:0,keywordShieldRemaining:0}}function Wt(e){return typeof e!="number"||!Number.isFinite(e)?0:e>0?e:0}function Bn(e){return typeof e!="number"||!Number.isFinite(e)?0:e>0?e:0}function rs(e){return typeof e!="number"||!Number.isFinite(e)?0:e>0?e:0}function bu(e){if(!e)return[];const t=[],n=e;if(typeof n[Symbol.iterator]=="function"){for(const s of n){const a=oo(s);a&&t.push(a)}return t}if(typeof e=="object")for(const s of Object.values(e)){const a=oo(s);a&&t.push(a)}return t}function oo(e){if(!e||typeof e!="object")return null;const t=e;if(!Object.prototype.hasOwnProperty.call(t,"stacks"))return null;const n=wu(t.keyword);if(!n)return null;const s=t;return s.keyword=n,s.stacks=Bn(s.stacks),Object.prototype.hasOwnProperty.call(t,"potency")&&s.potency!==void 0&&(s.potency=rs(s.potency)),s}function wu(e){if(typeof e!="string")return null;switch(e.trim().toLowerCase()){case"bleed":return"Bleed";case"burn":return"Burn";case"lifesteal":case"life-steal":return"Lifesteal";case"shield":return"Shield";default:return null}}function _a(e){const t=e.potency!==void 0?rs(e.potency):1;return t>0?t:0}function yu(e){if(e.potency!==void 0){const s=rs(e.potency);return s>0?s:0}const t=Bn(e.stacks);if(t<=0)return 0;const n=t*.2;return n>0?n:0}ua("Bleed",{onTick({state:e,self:t}){const n=Bn(e.stacks);if(n<=0||t.health<=0){e.stacks=n;return}const s=e.potency!==void 0?rs(e.potency):1,a=n*s;if(a<=0)return;const r=Math.min(t.health,a);return e.stacks=Math.max(0,n-1),{hpDamage:r}}});ua("Burn",{onTick({state:e,self:t}){const n=Bn(e.stacks);if(n<=0){e.stacks=n;return}const s=e.potency!==void 0?rs(e.potency):1,a=n*s;if(a<=0)return;const r=Math.min(t.shield,a),o=a-r,i=Math.min(t.health,o);return e.stacks=Math.max(0,n-1),{shieldDamage:r,hpDamage:i}}});ua("Shield",{onGrantShield({state:e}){const t=Bn(e.stacks);if(t<=0)return e.stacks=t,0;const n=t*_a(e);return n>0?n:0},onConsumeShield({state:e,amount:t}){const n=Bn(e.stacks);if(n<=0)return e.stacks=0,0;const s=_a(e);if(s<=0)return e.stacks=0,0;const a=n*s;if(a<=0)return e.stacks=0,0;const r=Math.min(a,Wt(t)),o=r/s;return e.stacks=Math.max(0,n-o),r>0?r:0}});ua("Lifesteal",{onHit({state:e,hpDamage:t}){if(t<=0)return 0;const n=yu(e);if(n<=0)return 0;const s=t*n;return s>0?s:0}});function Ze(e){return Number.isFinite(e)?Math.max(0,e):0}function io(e,t){const n=Ze(t?.health??e?.health??0),s=Ze(t?.shield??e?.shield??0);return{id:e?.id??"unknown",faction:e?.faction,health:n,maxHealth:e?.maxHealth,shield:s}}function co(e){if(!e)return!1;const t=e;return typeof t.onHit=="function"||typeof t.onKill=="function"||Array.isArray(t.onHit)||Array.isArray(t.onKill)}function lo(e){return e?Array.isArray(e)?e.filter(t=>typeof t=="function"):typeof e=="function"?[e]:[]:[]}function Eu(e){if(!e)return[];if(typeof e[Symbol.iterator]=="function"){const n=[];for(const s of e)co(s)&&n.push(s);return n}return Object.values(e).filter(n=>co(n))}function As(e,t,n){if(!e)return;const s=lo(e.hooks?.[t]);for(const r of s)r(n);const a=Eu(e.keywords);for(const r of a)for(const o of lo(r[t]))o(n)}function uo(e){const t=Ze(e?.health??0),n=Ze(e?.maxHealth??t);return{health:t,maxHealth:Math.max(n,t),shield:Ze(e?.shield??0)}}function Su(){return{health:0,maxHealth:0,shield:0}}function Cu(e){const t=e.attacker??null,n=e.defender,s=e.baseDamage,a=Ze(e.minimumDamage??1),r=Number.isFinite(s)?Ze(s):Ze(t?.attack??0),o=Ze(n.defense??0),i=vu(),c=uo(n),u=t?uo(t):null,l=ao(n.keywords??null,"defender",i.defender),d=t?ao(t.keywords??null,"attacker",i.attacker):null,h=u??Su();l&&l.runTick(c,h),d&&u&&d.runTick(u,c);const f=c.health>0,m=Ze(c.shield);l&&l.grantShield(c,h);const A=Ze(c.shield),g=f?Math.max(a,r-o):0,p=f?Math.min(A,g):0,b=f?Math.max(0,g-p):0;c.shield=Math.max(0,A-p);const C=Math.min(m,p),S=Math.max(0,p-C);l&&S>0&&l.consumeShield(S,c,h);const F=l?l.getShieldValue():0;i.defender.keywordShieldRemaining=F;const H=Math.max(0,m-C);c.shield=H+F;const T=c.health;c.health=Math.max(0,T-b);const Q=c.health,I=Q<=0;let B=0;d&&u?(B=d.applyHit(b,u,c),i.attacker.keywordShieldRemaining=d.getShieldValue()):i.attacker.keywordShieldRemaining=0;const w=io(t,u??void 0),v=io(n,{health:Q,shield:H+F}),y={attacker:w,defender:v,damage:g,shieldDamage:p,hpDamage:b,lethal:I},M={...y,source:"defender"};if(As(n,"onHit",M),ps("combat:onHit",M),t){const x={...y,source:"attacker"};As(t,"onHit",x),ps("combat:onHit",x),I&&(As(t,"onKill",x),ps("combat:onKill",x))}return I&&(As(n,"onKill",M),ps("combat:onKill",M)),{damage:g,shieldDamage:p,hpDamage:b,lethal:I,remainingHealth:Q,remainingShield:H+F,attackerHealing:B,attackerRemainingHealth:u?.health,attackerRemainingShield:u?.shield,keywordEffects:i}}const ho=5;function Ge(e){return`${e.q},${e.r}`}function fo(e){const[t,n]=e.split(",").map(Number);return{q:t,r:n}}function un(e){return{q:e.q,r:e.r}}class xu{constructor(t,n,s,a,r,o=[]){this.id=t,this.type=n,this.faction=a,this.stats=r,this.priorityFactions=o,this.coord=un(s),this.renderCoord=un(s),this.maxHealth=r.health}alive=!0;listeners={};maxHealth;healMarkerElapsed=0;healAmountBuffer=0;cachedTargetKey;cachedStartKey;cachedPath;movementCooldownSeconds=0;shield=0;immortal=!1;experience=0;combatHooks=null;combatKeywords=null;coord;renderCoord;setCoord(t,n){this.coord=un(t),(n?.snapRender??!0)&&(this.renderCoord=un(t))}setRenderCoord(t){this.renderCoord=un(t)}snapRenderToCoord(t=this.coord){this.renderCoord=un(t)}onDeath(t){(this.listeners.death??=[]).push(t)}emitDeath(){for(const t of this.listeners.death??[])t()}isDead(){return!this.alive}getMaxHealth(){return this.maxHealth}distanceTo(t){return gn(this.coord,t)}getVisionRange(){const{visionRange:t}=this.stats;return Number.isFinite(t)?t:3}attack(t){return this.distanceTo(t.coord)>this.stats.attackRange?null:t.takeDamage(this.stats.attackDamage,this)}update(t,n){if(!(this.isDead()||!n))if(gn(this.coord,n.pos)<=n.auraRadius){const s=this.stats.health;if(this.stats.health=Math.min(this.stats.health+n.regenPerSec*t,this.maxHealth),this.stats.health>s){const a=this.stats.health-s;this.healMarkerElapsed+=t,this.healAmountBuffer+=a,(this.healMarkerElapsed>=.9||this.healAmountBuffer>=2)&&this.flushHealEvent()}}else this.healAmountBuffer>0&&this.flushHealEvent(),this.healMarkerElapsed=0,this.healAmountBuffer=0}flushHealEvent(){if(this.healAmountBuffer<=0){this.healMarkerElapsed=0;return}const t=Math.round(this.healAmountBuffer*10)/10;t>0&&R.emit("unitHealed",{unitId:this.id,amount:t,remainingHealth:this.stats.health}),this.healAmountBuffer=0,this.healMarkerElapsed=0}takeDamage(t,n){const s=Number.isFinite(t);if(s&&t<=0||!s&&!n)return null;const a=n?n.toCombatParticipant():null,r=this.toCombatParticipant(),o=Cu({attacker:a,defender:r,baseDamage:s?t:void 0});this.stats.health=o.remainingHealth,this.shield=o.remainingShield;let i=o;if(o.lethal&&this.alive&&this.immortal&&(this.stats.health=Math.max(1,this.stats.health),i={...o,lethal:!1,remainingHealth:this.stats.health,remainingShield:this.shield}),n&&o.attackerRemainingHealth!==void 0){const c=Math.min(n.getMaxHealth(),Math.max(0,o.attackerRemainingHealth));n.stats.health=c}return n&&o.attackerRemainingShield!==void 0&&n.setShield(o.attackerRemainingShield),i.damage>0&&R.emit("unitDamaged",{attackerId:n?.id,targetId:this.id,amount:i.damage,remainingHealth:this.stats.health}),i.lethal&&this.alive&&(this.stats.health=0,this.alive=!1,this.snapRenderToCoord(),R.emit("unitDied",{unitId:this.id,attackerId:n?.id,unitFaction:this.faction,attackerFaction:n?.faction}),this.emitDeath()),i}getShield(){return this.shield}setShield(t){if(!Number.isFinite(t)||t<=0){this.shield=0;return}this.shield=t}updateStats(t){this.stats.attackDamage=t.attackDamage,this.stats.attackRange=t.attackRange,this.stats.movementRange=t.movementRange,typeof t.defense=="number"&&Number.isFinite(t.defense)?this.stats.defense=t.defense:delete this.stats.defense,typeof t.visionRange=="number"&&Number.isFinite(t.visionRange)&&(this.stats.visionRange=t.visionRange);const n=Math.max(1,Math.round(t.health));this.maxHealth=n,this.stats.health=Math.min(n,Math.max(0,this.stats.health))}isImmortal(){return this.immortal}setImmortal(t){this.immortal=!!t}getExperience(){return this.experience}setExperience(t){const n=Number.isFinite(t)?Math.max(0,Math.floor(t)):0;n!==this.experience&&(this.experience=n,R.emit("unit:xpChanged",{unitId:this.id,xp:this.experience}))}addExperience(t){if(!Number.isFinite(t)||t===0)return this.experience;const n=Math.max(0,Math.floor(this.experience+t));return this.setExperience(n),this.experience}toCombatParticipant(){return{id:this.id,faction:this.faction,attack:this.stats.attackDamage,defense:this.stats.defense,health:this.stats.health,maxHealth:this.maxHealth,shield:this.shield,hooks:this.combatHooks,keywords:this.combatKeywords}}addMovementTime(t){!Number.isFinite(t)||t<=0||(this.movementCooldownSeconds+=t)}canStep(t=ho){return this.movementCooldownSeconds>=t}consumeMovementCooldown(t=ho){return this.canStep(t)?(this.movementCooldownSeconds-=t,!0):!1}moveTowards(t,n,s){const a=this.getPathTo(t,n,s);if(a.length<2)return[];let r=0;const o=Ge(t);for(let c=1;c<a.length;c++){const u=Ge(a[c]);if(s.has(u)){u!==o&&this.clearPathCache();break}r=c}if(r===0)return[];const i=Math.min(this.stats.movementRange,r);return a.slice(0,i+1)}getPathTo(t,n,s){const a=Ge(this.coord),r=Ge(t);return(!this.cachedPath||this.cachedTargetKey!==r||this.cachedStartKey!==a)&&(this.cachedPath=this.findPath(t,n,s),this.cachedTargetKey=r,this.cachedStartKey=a),this.cachedPath}advancePathCache(t){!this.cachedPath||t<=0||(this.cachedPath=this.cachedPath.slice(t),this.cachedPath.length>0?this.cachedStartKey=Ge(this.cachedPath[0]):(this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0))}clearPathCache(){this.cachedPath=void 0,this.cachedStartKey=void 0,this.cachedTargetKey=void 0}findPath(t,n,s){const a=this.coord,r=Ge(a),o=Ge(t),i=new Set([r]),c=new Map([[r,null]]),u=new Map([[r,0]]),l=new Map([[r,gn(a,t)]]);for(;i.size>0;){let f=null,m=1/0;for(const p of i){const b=l.get(p)??1/0;b<m&&(m=b,f=p)}if(f===null||f===o)break;i.delete(f);const A=fo(f),g=u.get(f)??1/0;for(const p of Us(A)){const b=Ge(p);if(b!==o&&!this.isPassable(p,n,s))continue;const C=g+1;C<(u.get(b)??1/0)&&(c.set(b,f),u.set(b,C),l.set(b,C+gn(p,t)),i.add(b))}}if(!c.has(o))return[a];const d=[];let h=o;for(;h;)d.push(fo(h)),h=c.get(h)??null;return d.reverse()}seekNearestEnemy(t,n,s){const a=new Map;for(const i of t)a.set(Ge(i.coord),i);const r=[this.coord],o=new Set([Ge(this.coord)]);for(;r.length>0;){const i=r.shift(),c=Ge(i),u=a.get(c);if(u)return u;for(const l of Us(i)){const d=Ge(l),h=a.get(d);if(h)return h;this.isPassable(l,n,s)&&(o.has(d)||(o.add(d),r.push(l)))}}return null}canTraverse(t,n,s){return this.isPassable(t,n,s)}isPassable(t,n,s){const a=n.getTile(t.q,t.r);return!a||s&&s.has(Ge(t))?!1:a.terrain!==Xe.Lake}}class Bu{static selectTarget(t,n){let s=n.filter(r=>r.faction!==t.faction&&!r.isDead());if(s.length===0)return null;if(t.priorityFactions.length>0){const r=s.filter(o=>t.priorityFactions.includes(o.faction));r.length>0&&(s=r)}const a=s.filter(r=>t.distanceTo(r.coord)<=t.stats.attackRange);return a.length>0?(a.sort((r,o)=>r.stats.health-o.stats.health),a[0]):(s.sort((r,o)=>t.distanceTo(r.coord)-t.distanceTo(o.coord)),s[0]??null)}}const Pu=4,ku=8;class Ru{buckets=[];bucketCount=0;currentBucket=0;minBuckets;maxBuckets;constructor(t={}){this.minBuckets=t.minBuckets??Pu,this.maxBuckets=t.maxBuckets??ku}reset(){this.buckets=[],this.bucketCount=0,this.currentBucket=0}next(t){const n=t.length;if(n===0)return this.reset(),[];const s=this.computeBucketCount(n);s!==this.bucketCount&&(this.bucketCount=s,this.currentBucket=this.currentBucket%Math.max(1,s)),this.rebuildBuckets(t);const a=this.buckets[this.currentBucket]??[];return this.bucketCount>0&&(this.currentBucket=(this.currentBucket+1)%this.bucketCount),a}rebuildBuckets(t){const n=this.bucketCount;this.buckets=Array.from({length:n},()=>[]);const s=[...t].sort((a,r)=>a.id.localeCompare(r.id));for(let a=0;a<s.length;a++){const r=a%n;this.buckets[r].push(s[a])}}computeBucketCount(t){if(t<=0)return 0;const n=Math.ceil(t/12);let s=Math.max(this.minBuckets,n);return s=Math.min(this.maxBuckets,s),s=Math.min(s,t),s=Math.max(1,s),s}}function xa(e){return`${e.q},${e.r}`}const Mu=500;class Du{cache=new Map;targetIndex=new Map;targetPositions=new Map;ttlMs;constructor(t=Mu){this.ttlMs=t}clearExpired(t=Date.now()){for(const[n,s]of this.cache.entries())if(s.expiresAt<=t&&(this.cache.delete(n),s.targetId)){const a=this.targetIndex.get(s.targetId);a?.delete(n),a&&a.size===0&&this.targetIndex.delete(s.targetId)}}trackUnit(t){this.invalidateIfTargetMoved(t.id,xa(t.coord))}invalidateForUnit(t){const n=this.targetIndex.get(t);if(n){for(const s of n)this.cache.delete(s);this.targetIndex.delete(t)}this.targetPositions.delete(t)}getPath(t,n,s,a,r={}){const o=r.now??Date.now(),i=r.targetId,c=xa(n);i&&this.invalidateIfTargetMoved(i,c);const u=this.hashObstacles(a),l=this.createCacheKey(xa(t.coord),c,u),d=this.cache.get(l);if(d&&d.expiresAt>o)return d.path;t.clearPathCache();const h=t.getPathTo(n,s,a);if(this.cache.set(l,{path:h,expiresAt:o+this.ttlMs,targetId:i}),i){let f=this.targetIndex.get(i);f||(f=new Set,this.targetIndex.set(i,f)),f.add(l),this.targetPositions.set(i,c)}return h}invalidateIfTargetMoved(t,n){const s=this.targetPositions.get(t);if(!s){this.targetPositions.set(t,n);return}if(s===n)return;const a=this.targetIndex.get(t);if(a){for(const r of a)this.cache.delete(r);a.clear()}this.targetPositions.set(t,n)}hashObstacles(t){return t.size===0?"empty":Array.from(t).sort().join("|")}createCacheKey(t,n,s){return`${t}->${n}|${s}`}}const Iu={baseThreshold:50,heatPerSecond:50/30,thresholdGrowth:.05,coolingPerSecond:0};function Re(e,t=0){return Number.isFinite(e)?e:t}class Tu{heat;threshold;baseThreshold;thresholdGrowthFactor;heatPerSecond;coolingPerSecond;maxStoredHeat;constructor(t={}){const n={...Iu,...t},s=Math.max(1,Re(n.baseThreshold,50)),a=Math.max(1,Re(t.initialThreshold??s,s));this.baseThreshold=s,this.threshold=a,this.thresholdGrowthFactor=1+Math.max(0,Re(n.thresholdGrowth,0)),this.heatPerSecond=Math.max(0,Re(n.heatPerSecond,0)),this.coolingPerSecond=Math.max(0,Re(n.coolingPerSecond,0));const r=Re(n.maxStoredHeat??Number.NaN,Number.NaN);this.maxStoredHeat=Number.isFinite(r)&&r>=0?r:null;const o=Math.max(0,Re(t.initialHeat??0,0));this.heat=this.setHeatInternal(o)}getHeat(){return this.heat}getThreshold(){return this.threshold}getBuildRate(){return this.heatPerSecond}getCoolingRate(){return this.coolingPerSecond}reset(){this.heat=0,this.threshold=this.baseThreshold}setHeat(t){const n=Math.max(0,Re(t,0));return this.heat=this.setHeatInternal(n),this.heat}setHeatInternal(t){const n=Math.max(0,Re(t,0));return this.maxStoredHeat===null?(this.heat=n,this.heat):(this.heat=Math.min(n,this.maxStoredHeat),this.heat)}addHeat(t){const n=Math.max(0,Re(t,0));if(n<=0)return 0;const s=this.heat,a=s+n;return this.heat=this.maxStoredHeat===null?a:Math.min(a,this.maxStoredHeat),this.heat-s}cool(t){const n=Math.max(0,Re(t,0));if(n<=0||this.heat<=0)return 0;const s=this.heat;return this.heat=Math.max(0,this.heat-n),s-this.heat}vent(t=1){const n=Math.max(0,Math.min(1,Re(t,1)));return n<=0?0:this.cool(this.threshold*n)}advance(t,n){const s=Math.max(0,Re(t,0)),a=this.heatPerSecond,r=s>0?a*s:0,o=Math.max(0,Re(n?.bonusHeat??0,0)),i=r+o,c=this.addHeat(i),u=Math.max(0,Re(n?.coolingMultiplier??1,1)),l=s>0?this.coolingPerSecond*s*u:0,d=this.cool(l);return{addedHeat:c,cooledHeat:d,heat:this.heat}}hasTriggerReady(){return this.heat>=this.threshold-1e-6}consumeTrigger(){return this.hasTriggerReady()?(this.cool(this.threshold),this.threshold=Math.max(this.baseThreshold,this.threshold*this.thresholdGrowthFactor),!0):!1}timeUntilNextTrigger(){return this.hasTriggerReady()?0:this.heatPerSecond<=0?Number.POSITIVE_INFINITY:Math.max(0,this.threshold-this.heat)/this.heatPerSecond}getCooldownSeconds(){return this.heatPerSecond<=0?Number.POSITIVE_INFINITY:this.threshold/this.heatPerSecond}}function Hu(e){return new Tu(e)}const mo=500;function Qi(e,t,n){const s=typeof t=="number"?t:2,a=(typeof t=="number"?n:t)??[],r=[];for(let i=-s;i<=s;i++){const c=Math.max(-s,-i-s),u=Math.min(s,-i+s);for(let l=c;l<=u;l++){const d=Math.max(Math.abs(i),Math.abs(l),Math.abs(-i-l));if(d===0||d>s)continue;const h={q:e.q+i,r:e.r+l};a.some(m=>!m.isDead()&&m.coord.q===h.q&&m.coord.r===h.r)||r.push(h)}}if(r.length===0)return null;const o=Math.floor(Math.random()*r.length);return r[o]}function Fu(e,t,n={}){const s=Hu(t),a=s.getBuildRate(),r=s.getCooldownSeconds(),o=s.timeUntilNextTrigger(),i=Number.isFinite(n.maxRosterSize)?Math.max(0,Math.floor(n.maxRosterSize??0)):0,c=Number.isFinite(n.maxHealth)?Math.max(1,Math.floor(n.maxHealth??mo)):mo,u=Number.isFinite(n.health)?Math.max(0,Math.min(c,Math.floor(n.health??c))):c;return{id:"sauna",pos:e,auraRadius:2,regenPerSec:1,rallyToFront:!1,maxRosterSize:i,maxHealth:c,health:u,destroyed:u<=0,heat:s.getHeat(),heatPerTick:a,playerSpawnThreshold:s.getThreshold(),playerSpawnCooldown:Number.isFinite(r)?r:0,playerSpawnTimer:Number.isFinite(o)?o:0,beerUpkeepAccumulator:0,heatTracker:s}}function Lu(e,t){if(!Number.isFinite(t)||t<=0||e.destroyed)return{amount:0,remainingHealth:Math.max(0,e.health),destroyed:e.destroyed};const n=Math.max(0,e.health),s=Math.min(n,Math.max(0,Math.floor(t))),a=Math.max(0,n-s);return e.health=a,a<=0&&(e.health=0,e.destroyed=!0),{amount:s,remainingHealth:e.health,destroyed:e.destroyed}}const Qu=30;function Me(e){return`${e.q},${e.r}`}class Nu{constructor(t,n){this.map=t,this.animator=n}scheduler=new Ru;pathCache=new Du;lastKnownCoords=new Map;findExplorationGoal(t,n){const s=t.coord;if(this.map.ensureTile(s.q,s.r).isFogged&&t.canTraverse(s,this.map,n))return s;const r=new Set([Me(s)]),o=[s];for(;o.length>0;){const i=o.shift(),c=Us(i),u=this.map.getNeighbors(i.q,i.r);for(let l=0;l<c.length;l++){const d=c[l],h=u[l],f=Me(d);if(!r.has(f)&&(r.add(f),!!t.canTraverse(d,this.map,n))){if(h.isFogged)return d;o.push(d)}}}return null}tick(t,n,s){const a=t.length,r=Date.now();if(this.pathCache.clearExpired(r),a===0){this.scheduler.reset();return}const o=new Set,i=[],c=new Set;for(const l of t){if(l.addMovementTime(n),l.isDead()){l.clearPathCache(),this.pathCache.invalidateForUnit(l.id),this.animator?.clear(l),this.lastKnownCoords.delete(l.id);continue}const d=this.lastKnownCoords.get(l.id);d&&gn(d,l.coord)>1&&this.animator?.clear(l,{snap:!0}),this.lastKnownCoords.set(l.id,{q:l.coord.q,r:l.coord.r}),this.pathCache.trackUnit(l),i.push(l),o.add(Me(l.coord)),c.add(l.id)}for(const l of[...this.lastKnownCoords.keys()])c.has(l)||this.lastKnownCoords.delete(l);if(i.length===0){this.scheduler.reset();return}const u=this.scheduler.next(i);if(u.length!==0)for(const l of u){const d=Me(l.coord);if(o.delete(d),l.isDead()){l.clearPathCache(),this.pathCache.invalidateForUnit(l.id),this.animator?.clear(l);continue}const h=Bu.selectTarget(l,t);if(!h&&s&&!s.destroyed&&this.tryAttackSauna(l,s)){const b=Me(l.coord);o.add(b);continue}if(!h){let p=null;if(s&&!s.destroyed&&(p=s.pos),p||(p=this.findExplorationGoal(l,o)),p){const C=this.computeMovementPath(l,p,o,r);if(C.length>1&&l.stats.movementRange>0){const S=C[1],F=Me(S);if(o.has(F))l.clearPathCache();else{if(!l.canStep()){o.add(d);continue}if(l.consumeMovementCooldown()){const H={q:l.coord.q,r:l.coord.r};this.animator?(l.setCoord(S,{snapRender:!1}),this.animator.enqueue(l,[H,S])):l.setCoord(S),l.advancePathCache(1);const T=Me(l.coord);T===Me(p)&&l.clearPathCache(),o.add(T),this.lastKnownCoords.set(l.id,{q:l.coord.q,r:l.coord.r});continue}}}else l.clearPathCache()}else l.clearPathCache();const b=Me(l.coord);o.add(b),s&&!s.destroyed&&this.tryAttackSauna(l,s);continue}if(h.isDead()){l.clearPathCache(),o.add(d);continue}const f=Me(h.coord),m=this.pathCache.getPath(l,h.coord,this.map,o,{now:r,targetId:h.id});if(m.length>1&&l.stats.movementRange>0){const p=m[1],b=Me(p),C=b===f;if(!o.has(b)||C){if(l.canStep()&&l.consumeMovementCooldown()){const S={q:l.coord.q,r:l.coord.r};this.animator?(l.setCoord(p,{snapRender:!1}),this.animator.enqueue(l,[S,p])):l.setCoord(p),l.advancePathCache(1)}}else l.clearPathCache()}const A=Me(l.coord);o.add(A),this.lastKnownCoords.set(l.id,{q:l.coord.q,r:l.coord.r});const g=Me(h.coord);g!==f&&l.clearPathCache(),l.distanceTo(h.coord)<=l.stats.attackRange&&!h.isDead()&&((l.attack(h)?.lethal??!1)||h.isDead())&&(o.delete(g),l.clearPathCache(),this.pathCache.invalidateForUnit(h.id),this.animator?.clear(h))}}tryAttackSauna(t,n){if(t.faction==="player")return!1;const s=t.stats.attackRange;if(s<=0||t.distanceTo(n.pos)>s)return!1;const a=Lu(n,t.stats.attackDamage);if(a.amount<=0)return!1;const r={attackerId:t.id,attackerFaction:t.faction,amount:a.amount,remainingHealth:a.remainingHealth};if(R.emit("saunaDamaged",r),a.destroyed){const o={attackerId:t.id,attackerFaction:t.faction};R.emit("saunaDestroyed",o)}return!0}computeMovementPath(t,n,s,a){const r=this.pathCache.getPath(t,n,this.map,s,{now:a});if(r.length<2)return[];let o=0;const i=Me(n);for(let u=1;u<r.length;u++){const l=Me(r[u]);if(s.has(l)){l!==i&&t.clearPathCache();break}o=u}if(o===0)return[];const c=Math.min(t.stats.movementRange,o);return r.slice(0,c+1)}}function da(e){if(!Number.isFinite(e??NaN))return 1;const t=Math.floor(e);return Math.max(1,t)}function Gu(e){return Math.max(0,da(e)-1)}function Ou(e,t="linear"){const n=Gu(e);switch(t){case"accelerating":return n*(n+1)/2;case"diminishing":return n===0?0:Math.log2(n+1);case"linear":default:return n}}function ju(e,t="round"){switch(t){case"floor":return Math.floor(e);case"ceil":return Math.ceil(e);case"none":return e;case"round":default:return Math.round(e)}}function Uu(e,t,n){let s=e;return Number.isFinite(t)&&(s=Math.max(s,t)),Number.isFinite(n)&&(s=Math.min(s,n)),s}function Qn(e,t){const n=da(t),s=e.curve??"linear",a=Ou(n,s),r=e.base+e.growth*a,o=Uu(r,e.min,e.max);return ju(o,e.round??"round")}function os(e,t){const n=da(t),s=e.stats,a={health:Qn(s.health,n),attackDamage:Qn(s.attackDamage,n),attackRange:Qn(s.attackRange,n),movementRange:Qn(s.movementRange,n)};return s.visionRange&&(a.visionRange=Qn(s.visionRange,n)),a}function go(e){if(typeof e=="number"&&Number.isFinite(e))return e}function Ys(e,t){let n=e.health,s=e.attackDamage,a=e.attackRange,r=e.movementRange,o=go(e.defense),i=go(e.shield);for(const u of t){const l=Math.max(1,Math.round(u.quantity)),d=u.modifiers;typeof d.health=="number"&&(n+=d.health*l),typeof d.attackDamage=="number"&&(s+=d.attackDamage*l),typeof d.attackRange=="number"&&(a+=d.attackRange*l),typeof d.movementRange=="number"&&(r+=d.movementRange*l),typeof d.defense=="number"&&(o=(o??0)+d.defense*l),typeof d.shield=="number"&&(i=(i??0)+d.shield*l)}const c={health:Math.max(1,Math.round(n)),attackDamage:Math.max(0,Math.round(s)),attackRange:Math.max(0,Math.round(a)),movementRange:Math.max(0,Math.round(r))};return o!==void 0&&(c.defense=Math.max(0,Math.round(o))),i!==void 0&&(c.shield=Math.max(0,Math.round(i))),typeof e.visionRange=="number"&&Number.isFinite(e.visionRange)&&(c.visionRange=Math.max(0,Math.round(e.visionRange))),c}const vr=Object.freeze({id:"soldier",displayName:"Sauna Soldier",cost:50,tags:["infantry","melee"],stats:{health:{base:20,growth:6,curve:"linear",round:"round"},attackDamage:{base:5,growth:1,curve:"linear",round:"round"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:0,round:"round"}}}),br=Object.freeze({id:"archer",displayName:"Sauna Archer",cost:75,tags:["ranged"],stats:{health:{base:15,growth:4,curve:"linear",round:"round"},attackDamage:{base:3,growth:.4,curve:"accelerating",round:"ceil"},attackRange:{base:3,growth:.5,curve:"diminishing",round:"ceil",max:5},movementRange:{base:1,growth:0,round:"round"},visionRange:{base:3,growth:.25,curve:"linear",round:"round",max:5}}}),Ni=Object.freeze({id:"avanto-marauder",displayName:"Avanto Marauder",cost:0,tags:["enemy","melee"],stats:{health:{base:12,growth:5,curve:"linear",round:"round"},attackDamage:{base:4,growth:.6,curve:"accelerating",round:"ceil"},attackRange:{base:1,growth:0,round:"round"},movementRange:{base:1,growth:.25,curve:"linear",round:"round",max:2},visionRange:{base:3,growth:0,round:"round"}}}),Gi=Object.freeze({soldier:vr,archer:br,"avanto-marauder":Ni});function wr(e){return Gi[e]??null}Object.freeze(Object.keys(Gi));const po=vr.cost;Object.freeze(os(vr,1));br.cost;Object.freeze(os(br,1));Object.freeze(os(Ni,1));function Oi(e,t,n,s,a){const r=da(a?.level),o=os(e,r);return new xu(t,e.id,n,s,o,e.priorityFactions)}function ji(e,t,n,s,a){const r=wr(e);return r?Oi(r,t,n,s,a):null}function yr(e,t,n,s,a,r){const o=wr(t);if(!o)return null;const i=o.cost;if(!e.canAfford(i,k.SAUNA_BEER))return Dt("error"),null;e.addResource(k.SAUNA_BEER,-i);const c=Oi(o,n,s,a,r);return Dt("spawn"),R.emit("unitSpawned",{unit:c}),c}const zu=Object.freeze(Object.defineProperty({__proto__:null,createUnit:ji,spawnUnit:yr},Symbol.toStringTag,{value:"Module"})),Xu=["Aino","Eero","Ilona","Kalevi","Lumi","Mika","Noora","Oskari","Saana","Tapio","Veera","Yrjö"],qu=["Emberguard","Frostwalker","Steamcaller","Dawnwatch","Gritforged","Stormchant","Snowborn","Torchbearer","Chillwarden","Sisuheart"],Yu=["Aalto","Halla","Karhu","Korhonen","Laine","Metsä","Niemi","Salmi","Tuomi","Virta"];function Ba(e,t){if(e.length===0)throw new Error("Cannot select a name from an empty collection.");const n=Math.floor(t()*e.length);return e[Math.min(n,e.length-1)]}function Ku(e=Math.random){const t=Ba(Xu,e),n=Ba(qu,e),s=Ba(Yu,e);return`${t} "${n}" ${s}`}const Pn=Object.freeze(["supply","weapon","focus","relic"]);function Ui(){return{supply:null,weapon:null,focus:null,relic:null}}const Vu=Object.freeze({supply:Object.freeze({id:"supply",label:"Supply Satchel",description:"Consumables and restorative provisions carried into battle.",maxStacks:5}),weapon:Object.freeze({id:"weapon",label:"Primary Armament",description:"The attendant's main weapon or ranged kit.",maxStacks:1}),focus:Object.freeze({id:"focus",label:"Battle Focus",description:"Tools that sharpen aim, steps, or battlefield intuition.",maxStacks:1}),relic:Object.freeze({id:"relic",label:"Sauna Relic",description:"Charms and relics that empower the attendant's resolve.",maxStacks:1})}),Zu=Object.freeze({"birch-sap-satchel":Object.freeze({id:"birch-sap-satchel",slot:"supply",modifiers:{health:3},maxStacks:3}),"steamed-bandages":Object.freeze({id:"steamed-bandages",slot:"supply",modifiers:{shield:4},maxStacks:2}),"aurora-distillate":Object.freeze({id:"aurora-distillate",slot:"supply",modifiers:{attackDamage:2,defense:1},maxStacks:1}),"stolen-sauna-tokens":Object.freeze({id:"stolen-sauna-tokens",slot:"supply",modifiers:{movementRange:.5},maxStacks:5}),"midnight-bloodwine":Object.freeze({id:"midnight-bloodwine",slot:"supply",modifiers:{health:6,attackDamage:1},maxStacks:1}),"sauna-incense":Object.freeze({id:"sauna-incense",slot:"supply",modifiers:{attackRange:1},maxStacks:2}),"glacier-brand":Object.freeze({id:"glacier-brand",slot:"weapon",modifiers:{attackDamage:3},maxStacks:1}),"emberglass-arrow":Object.freeze({id:"emberglass-arrow",slot:"weapon",modifiers:{attackDamage:1,attackRange:2},maxStacks:1}),"aurora-lattice":Object.freeze({id:"aurora-lattice",slot:"focus",modifiers:{attackDamage:2,attackRange:1},maxStacks:1}),"emberglass-shard":Object.freeze({id:"emberglass-shard",slot:"focus",modifiers:{attackDamage:1,movementRange:1},maxStacks:1}),"windstep-totem":Object.freeze({id:"windstep-totem",slot:"focus",modifiers:{movementRange:1,defense:1},maxStacks:1}),"searing-chant-censer":Object.freeze({id:"searing-chant-censer",slot:"focus",modifiers:{attackDamage:2,shield:2},maxStacks:1}),"cracked-ice-amulet":Object.freeze({id:"cracked-ice-amulet",slot:"relic",modifiers:{defense:2},maxStacks:1}),"myrsky-charm":Object.freeze({id:"myrsky-charm",slot:"relic",modifiers:{attackRange:1,defense:1},maxStacks:1}),"frostwyrm-signet":Object.freeze({id:"frostwyrm-signet",slot:"relic",modifiers:{shield:5},maxStacks:1}),"spirit-oak-charm":Object.freeze({id:"spirit-oak-charm",slot:"relic",modifiers:{defense:1,health:2},maxStacks:1})});function is(e){const t=Vu[e];if(!t)throw new Error(`Unknown equipment slot: ${e}`);return t}function cs(e){return Zu[e]}function zi(e){return Number.isFinite(e)?Math.max(1,Math.round(e)):1}function Xi(e,t){return{id:e.id,name:e.name,description:e.description,icon:e.icon,rarity:e.rarity,quantity:t}}function qi(e,t,n,s){const a=is(t),r=Math.max(1,Math.floor(n.maxStacks??a.maxStacks)),o=Math.min(r,s),i=n.modifiers??{};return{...Xi(e,o),slot:t,maxStacks:r,modifiers:i}}function Ja(e){e.equipment||(e.equipment=Ui());for(const t of Pn)e.equipment[t]??=null;return e.equipment}function Je(e){const t=[];for(const n of Pn){const s=e[n];s&&t.push({...s})}return t}function Er(e){return Je(e).map(t=>Xi(t,t.quantity))}function Pa(e){const t=Ui();for(const n of e){const s=cs(n.id);if(!s)continue;const a=zi(n.quantity),r=t[s.slot];if(r&&r.id!==n.id)continue;const o=(r?.quantity??0)+a,i=qi(n,s.slot,s,o);t[s.slot]=i}return t}function _u(e,t){const n=cs(t.id);if(!n)return{success:!1,slot:"supply",loadout:Je(Ja(e)),item:null,reason:"unknown-item"};const s=Ja(e),a=n.slot,r=is(a),o=zi(t.quantity),i=Math.max(1,Math.floor(n.maxStacks??r.maxStacks)),c=s[a];if(c&&c.id!==t.id)return{success:!1,slot:a,loadout:Je(s),item:c,reason:"slot-occupied"};const u=Math.min(i,(c?.quantity??0)+o);if((c?.quantity??0)+o>i)return{success:!1,slot:a,loadout:Je(s),item:c,reason:"stack-limit"};const l=qi(t,a,n,u);return s[a]=l,e.items=Er(s),{success:!0,slot:a,loadout:Je(s),item:l}}function Ju(e,t){const n=Ja(e),s=n[t];return s?(n[t]=null,e.items=Er(n),{success:!0,slot:t,loadout:Je(n),removed:s}):{success:!1,slot:t,loadout:Je(n),removed:null,reason:"empty-slot"}}function Wu(e,t){return cs(e)?.slot===t}const $u={q:0,r:0},ed="Saunoja",Wa=18,Ao=0,wn=0,Ns=10,vo=1,vs={health:Wa,attackDamage:4,attackRange:1,movementRange:1,defense:0,shield:0};function bs(e,t,n){return Math.min(Math.max(e,t),n)}function ws(e,t,n){const s=typeof e=="number"&&Number.isFinite(e)?e:t;return Math.max(n,s)}function ka(e,t,n=0){if(typeof e=="number"&&Number.isFinite(e))return Math.max(n,e);if(typeof t=="number"&&Number.isFinite(t))return Math.max(n,t)}function bo(e,t){if(!e||typeof e!="object")return{...t};const n=e,s=ws(n.health,t.health,1),a=ws(n.attackDamage,t.attackDamage,0),r=ws(n.attackRange,t.attackRange,0),o=ws(n.movementRange,t.movementRange,0),i=ka(n.defense,t.defense,0),c=ka(n.shield,t.shield,0),u=ka(n.visionRange,t.visionRange,0);return{health:s,attackDamage:a,attackRange:r,movementRange:o,defense:i,shield:c,visionRange:u}}function td(e,t){if(!e||typeof e!="object")return Pa(t);const n=e,s=[];for(const a of Object.values(n)){const r=Yi(a);r&&s.push(r)}return s.length===0?Pa(t):Pa(s)}function Yi(e){if(!e||typeof e!="object")return null;const t=e,n=typeof t.id=="string"?t.id.trim():"",s=typeof t.name=="string"?t.name.trim():"";if(!n||!s)return null;const a=typeof t.description=="string"?t.description.trim():void 0,r=typeof t.icon=="string"?t.icon.trim():void 0,o=typeof t.rarity=="string"?t.rarity.trim():void 0,i=typeof t.quantity=="number"?t.quantity:Number(t.quantity),c=Number.isFinite(i)?Math.max(1,Math.round(i)):1;return{id:n,name:s,description:a,icon:r,rarity:o,quantity:c}}function nd(e){if(!e||e.length===0)return[];const t=[];for(const n of e){const s=Yi(n);s&&t.push(s)}return t}function sd(e){if(!e||typeof e!="object")return null;const t=e,n=typeof t.id=="string"?t.id.trim():"",s=typeof t.name=="string"?t.name.trim():"";if(!n||!s)return null;const a=t.duration;let r=1/0;typeof a=="number"&&Number.isFinite(a)?r=Math.max(0,a):a!==1/0&&(r=1/0);const o=t.remaining;let i=r;typeof o=="number"&&Number.isFinite(o)?i=Math.max(0,o):o===1/0&&(i=1/0),r!==1/0&&i===1/0&&(i=r);const c=t.appliedAt,u=typeof c=="number"&&Number.isFinite(c)?Math.max(0,c):void 0,l=t.stacks,d=typeof l=="number"&&Number.isFinite(l)?Math.max(1,Math.round(l)):void 0,h=typeof t.description=="string"?t.description.trim():void 0,f=typeof t.source=="string"?t.source.trim():void 0;return{id:n,name:s,description:h,duration:r,remaining:i,appliedAt:u,stacks:d,source:f}}function ad(e){if(!e||e.length===0)return[];const t=[];for(const n of e){const s=sd(n);s&&t.push(s)}return t}function rd(e){if(typeof e=="string"){const t=e.trim();if(t.length>0)return t}try{return Ku()}catch(t){return console.warn("Falling back to default Saunoja name",t),ed}}function Sr(e){const{id:t,name:n,coord:s=$u,maxHp:a=Wa,hp:r=a,steam:o=0,defense:i,shield:c=0,traits:u=[],upkeep:l=vo,xp:d=0,lastHitAt:h=Ao,selected:f=!1,items:m,modifiers:A,combatKeywords:g=null,combatHooks:p=null}=e,b=Number.isFinite(a)?Math.max(1,a):Wa,C=Number.isFinite(r)?r:b,S=bs(C,0,b),F=Number.isFinite(o)?o:0,H=bs(F,0,1),Q=(Array.isArray(u)?u:[]).filter(Pe=>typeof Pe=="string").map(Pe=>Pe.trim()).filter(Pe=>Pe.length>0),I=Number.isFinite(l)?l:vo,B=bs(I,wn,Ns),w=Number.isFinite(d)?d:0,v=Math.max(0,w),y=Number.isFinite(h)?h:Ao,M=Math.max(0,y),x=Number.isFinite(c)?c:0,O=Math.max(0,x),N=Number.isFinite(i)?i:void 0,U=N!==void 0?Math.max(0,N):void 0,J=nd(m),$=ad(A),V=td(e.equipment,J),ae=Er(V),re={...vs,health:b,defense:U??vs.defense,shield:vs.shield},W=bo(e.baseStats,re),ie={...W,health:b,defense:U??W.defense,shield:O},me=bo(e.effectiveStats,ie),ve=Math.max(1,me.health),be=bs(S,0,ve),et=typeof me.defense=="number"?Math.max(0,me.defense):U??void 0,Le=typeof me.shield=="number"?Math.max(0,me.shield):O,At={...W,health:Math.max(1,W.health),defense:typeof W.defense=="number"?Math.max(0,W.defense):U??void 0,shield:typeof W.shield=="number"?Math.max(0,W.shield):vs.shield},qe={...me,health:ve,defense:et,shield:Le},Qe=rd(n);return{id:t,name:Qe,coord:{q:s.q,r:s.r},maxHp:ve,hp:be,defense:et,shield:Le,steam:H,traits:[...Q],upkeep:B,xp:v,lastHitAt:M,selected:f,items:ae,baseStats:At,effectiveStats:qe,equipment:V,modifiers:$,combatKeywords:g,combatHooks:p}}const kn=32;function Vn(e,t,n,s){e.beginPath();for(let a=0;a<6;a++){const r=Math.PI/3*a,o=t+s*Math.cos(r),i=n+s*Math.sin(r);a===0?e.moveTo(o,i):e.lineTo(o,i)}e.closePath()}function Cr(e,t,n){return Math.min(Math.max(e,t),n)}function od(e,{centerX:t,centerY:n,hp:s,maxHp:a,radius:r=kn*.55}){const o=Number.isFinite(a)?Math.max(1,a):1,i=Number.isFinite(s)?s:o,c=Cr(i/o,0,1);if(e.save(),Vn(e,t,n,r),e.fillStyle="rgba(7, 11, 18, 0.72)",e.fill(),e.restore(),c>0){e.save(),Vn(e,t,n,r),e.clip();const u=e.createLinearGradient(t,n+r,t,n-r);u.addColorStop(0,"rgba(46, 160, 98, 0.35)"),u.addColorStop(1,"rgba(218, 255, 239, 0.95)"),e.fillStyle=u;const l=r*2*c,d=n+r-l;e.fillRect(t-r,d,r*2,l),e.restore()}e.save(),Vn(e,t,n,r),e.lineWidth=Math.max(1,r*.12),e.strokeStyle="rgba(255, 255, 255, 0.28)",e.stroke(),e.restore()}function id(e,{centerX:t,centerY:n,radius:s=kn,progress:a=0}){const r=Cr(a,0,1);if(r<=0)return;const o=Number.isFinite(s)&&s>0?s:kn;e.save(),e.globalCompositeOperation="lighter",e.globalAlpha=r;const i=e.createRadialGradient(t,n,Math.max(1,o*.1),t,n,o);i.addColorStop(0,"rgba(255, 255, 255, 0.92)"),i.addColorStop(.45,"rgba(255, 255, 255, 0.68)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=i,e.beginPath(),e.arc(t,n,o,0,Math.PI*2),e.fill(),e.restore()}function cd(e,{centerX:t,centerY:n,radius:s=kn*.85,intensity:a=1}){const r=Cr(a,0,1);if(r<=0)return;e.save(),Vn(e,t,n,s),e.clip();const o=e.createLinearGradient(t,n+s,t,n-s);o.addColorStop(0,"rgba(255, 255, 255, 0)"),o.addColorStop(.55,`rgba(255, 255, 255, ${.12*r})`),o.addColorStop(1,`rgba(255, 255, 255, ${.35*r})`),e.globalCompositeOperation="lighter",e.fillStyle=o,e.fillRect(t-s,n-s,s*2,s*2),e.restore(),e.save(),e.globalCompositeOperation="lighter",e.lineCap="round",e.strokeStyle=`rgba(255, 255, 255, ${.25*r})`,e.lineWidth=Math.max(1,s*.08);const i=s*.75,c=s*.35;for(let u=0;u<3;u++){const l=n-s*.5+u*c;e.beginPath(),e.moveTo(t-i,l),e.bezierCurveTo(t-i*.4,l-s*.4,t+i*.4,l+s*.2,t+i,l-s*.45),e.stroke()}e.restore()}function $a(e,t,n){return e<t?t:e>n?n:e}const Ra=Object.freeze([{id:"skirmish",label:"Skirmish Patrols",minRunSeconds:0,minClears:0,cadence:26,multiplier:1,bundleTier:0},{id:"raids",label:"Raid Pressure",minRunSeconds:90,minClears:2,cadence:19,multiplier:1.35,bundleTier:1},{id:"siege",label:"Siege Lines",minRunSeconds:210,minClears:5,cadence:13,multiplier:1.8,bundleTier:2},{id:"onslaught",label:"Winter Onslaught",minRunSeconds:360,minClears:9,cadence:8.5,multiplier:2.45,bundleTier:3},{id:"maelstrom",label:"Glacier Maelstrom",minRunSeconds:540,minClears:14,cadence:6.2,multiplier:3.25,bundleTier:4}]);function ld(e){return e>=1?1/(1+(e-1)*.45):1+(1-e)*.35}function ud(e){if(e>=1)return 1+(e-1)*.85;const t=1-e;return $a(1-t*.4,.45,1)}function dd(e){return{runSeconds:Math.max(0,Number.isFinite(e.runSeconds)?e.runSeconds:0),clears:Math.max(0,Number.isFinite(e.clears)?e.clears:0),spawnCycles:Math.max(0,Number.isFinite(e.spawnCycles)?e.spawnCycles:0)}}function wo(e,t){const n=dd(t);let s=0;for(let u=0;u<Ra.length;u+=1){const l=Ra[u];if(n.runSeconds<l.minRunSeconds||n.clears<l.minClears)break;s=u}const a=Ra[s],r=ld(e),o=ud(e),i=Math.max(.75,a.cadence*r),c=a.multiplier*o;return{stage:a,stageIndex:s,cadenceTarget:i,multiplierBase:c}}function yo(e){if(e>=1){const n=Math.min(3,e-1);return $a(.93-n*.035,.82,.93)}const t=Math.min(1,1-e);return $a(.93+t*.03,.9,.97)}function Eo(e){if(e>=1)return .024+Math.min(3,e-1)*.012;const t=Math.min(1,1-e);return Math.max(.012,.024-t*.01)}const Ki="deepwood",Vi="Deepwood Wardens",Zi="Reclusive guardians attuned to sauna spirits.",_i=[{id:"warding-circle",label:"Warding Circle",weight:2,units:[{unit:"soldier",level:1,quantity:2},{unit:"archer",level:1,quantity:1}],items:["spirit-oak-charm","sauna-incense"],modifiers:["barkskin-ritual"]},{id:"spirit-strike",label:"Spirit Strike",weight:1,units:[{unit:"archer",level:2,quantity:2}],items:["emberglass-arrow"],modifiers:["searing-chant","windstep"]}],hd={id:Ki,name:Vi,description:Zi,bundles:_i},fd=Object.freeze(Object.defineProperty({__proto__:null,bundles:_i,default:hd,description:Zi,id:Ki,name:Vi},Symbol.toStringTag,{value:"Module"})),Ji="enemy",Wi="Avanto Marauders",$i="Frostbitten raiders who harry the sauna frontier.",ec=[{id:"iceblade-scouts",label:"Iceblade Scouts",weight:3,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:1}],items:["cracked-ice-amulet"],modifiers:["frost-resilience"]},{id:"raiding-party",label:"Raiding Party",weight:2,minRampTier:0,units:[{unit:"avanto-marauder",level:1,quantity:2}],items:["stolen-sauna-tokens"],modifiers:["berserker-drift"]},{id:"frost-champion",label:"Frost Champion",weight:1,minRampTier:0,units:[{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand"],modifiers:["glacial-ward"]},{id:"icebreaker-vanguard",label:"Icebreaker Vanguard",weight:2.5,minRampTier:1,units:[{unit:"avanto-marauder",level:2,quantity:2},{unit:"avanto-marauder",level:1,quantity:1}],items:["stormglass-pendant"],modifiers:["frost-resilience","berserker-drift"]},{id:"glacial-phalanx",label:"Glacial Phalanx",weight:2,minRampTier:2,units:[{unit:"avanto-marauder",level:3,quantity:3},{unit:"avanto-marauder",level:2,quantity:1}],items:["glacier-brand","frostshard-relic"],modifiers:["glacial-ward","polar-endurance"]},{id:"avalanche-warhost",label:"Avalanche Warhost",weight:1.25,minRampTier:3,units:[{unit:"avanto-marauder",level:4,quantity:3},{unit:"avanto-marauder",level:3,quantity:2}],items:["avalanche-totem"],modifiers:["glacial-ward","polar-endurance","berserker-drift"]}],md={id:Ji,name:Wi,description:$i,bundles:ec},gd=Object.freeze(Object.defineProperty({__proto__:null,bundles:ec,default:md,description:$i,id:Ji,name:Wi},Symbol.toStringTag,{value:"Module"})),pd=Object.assign({"../content/factions/deepwood.json":fd,"../content/factions/enemy.json":gd}),Ks=new Map;for(const[e,t]of Object.entries(pd)){const n=Ad(t),s=yd(n,e);if(Ks.has(s.id))throw new Error(`Duplicate faction bundle id: ${s.id}`);Ks.set(s.id,s)}function Ad(e){return typeof e=="object"&&e!==null&&"default"in e?e.default:e}function xr(e){return typeof e=="object"&&e!==null}function er(e,t){if(typeof e!="string")throw new Error(`Expected string at ${t}`);const n=e.trim();if(!n)throw new Error(`Expected non-empty string at ${t}`);return n}function tr(e){if(typeof e!="string")return;const t=e.trim();return t||void 0}function So(e,t){if(e===void 0)return Object.freeze([]);if(!Array.isArray(e))throw new Error(`Expected array at ${t}`);const n=e.map((s,a)=>{if(typeof s!="string")throw new Error(`Expected string at ${t}[${a}]`);const r=s.trim();if(!r)throw new Error(`Expected non-empty string at ${t}[${a}]`);return r});return Object.freeze(n)}function tc(e,t){const n=typeof e=="number"?e:Number(e);return!Number.isFinite(n)||n<=0?t:n}function Co(e,t){const n=Math.floor(tc(e,t));return n>0?n:t}function vd(e,t){if(!xr(e))throw new Error(`Expected object at ${t}`);const n=er(e.unit,`${t}.unit`),s=Co(e.level,1),a=Co(e.quantity,1);return Object.freeze({unit:n,level:s,quantity:a})}function bd(e){if(e===void 0)return;const t=Number(e);if(!Number.isFinite(t))return;const n=Math.floor(t);return n>=0?n:void 0}function wd(e,t,n){if(!xr(e))throw new Error(`Expected object at ${t}`);const s=tr(e.id)??`${n}-bundle`,a=tr(e.label)??s,r=tc(e.weight,1),o=e.units;if(!Array.isArray(o)||o.length===0)throw new Error(`Expected non-empty units array at ${t}.units`);const i=o.map((d,h)=>vd(d,`${t}.units[${h}]`)),c=So(e.items,`${t}.items`),u=So(e.modifiers,`${t}.modifiers`),l=bd(e.minRampTier);return Object.freeze({id:s,label:a,weight:r,units:Object.freeze(i),items:c,modifiers:u,minRampTier:l})}function yd(e,t){if(!xr(e))throw new Error(`Expected object at ${t}`);const n=er(e.id,`${t}.id`),s=er(e.name,`${t}.name`),a=tr(e.description);if(!Array.isArray(e.bundles)||e.bundles.length===0)throw new Error(`Expected non-empty bundles array at ${t}.bundles`);const r=e.bundles.map((o,i)=>wd(o,`${t}.bundles[${i}]`,`${n}-${i}`));return Object.freeze({id:n,name:s,description:a,bundles:Object.freeze(r)})}Object.freeze(Array.from(Ks.keys()));function Ed(e){return Ks.get(e)??null}function Sd(e){return Ed(e)?.bundles??Object.freeze([])}function Cd(){return`e${Date.now()}-${Math.floor(Math.random()*1e6)}`}function xd(e){return{level:e}}function Bd(e,t,n){const s=Sd(e);if(s.length===0)throw new Error(`No bundles registered for faction: ${e}`);const a=Math.max(0,Math.floor(Number.isFinite(t)?t:0)),r=s.filter(d=>(typeof d.minRampTier=="number"?d.minRampTier:0)<=a),o=r.length>0?r:s,i=typeof n=="function"?n:Math.random,c=o.reduce((d,h)=>d+h.weight,0);if(!Number.isFinite(c)||c<=0)throw new Error(`Invalid bundle weights for faction: ${e}`);const u=i()*c;let l=0;for(const d of o)if(l+=d.weight,u<l)return d;return o[o.length-1]}function Pd(e){let t=Math.max(0,Math.floor(e.availableSlots));const n=[];if(t<=0)return{spawned:Object.freeze(n),items:e.bundle.items,modifiers:e.bundle.modifiers};const s=e.makeId??Cd,a=typeof e.random=="function"?e.random:Math.random,r=Math.max(0,Math.min(.95,typeof e.eliteOdds=="number"?e.eliteOdds:0)),o=Math.max(1,Number.isFinite(e.difficultyMultiplier)?e.difficultyMultiplier:1),i=Math.max(0,Math.floor(Number.isFinite(e.rampTier)?e.rampTier:0)),c=1+i*.25,u=Math.floor(i/2);for(const l of e.bundle.units){const d=Math.max(1,Math.round(l.quantity*o*c)),h=Math.min(d,t),f=l.unit,m=Math.max(1,Math.round((l.level+u)*o));for(let A=0;A<h;A+=1){const g=a()<r?1:0,p=Math.max(1,m+g),b=xd(p),C=e.pickEdge();if(!C)return{spawned:Object.freeze(n),items:e.bundle.items,modifiers:e.bundle.modifiers};const S=ji(f,s(),C,e.factionId,b);if(S&&(e.addUnit(S),n.push(S),t-=1,t<=0))return{spawned:Object.freeze(n),items:e.bundle.items,modifiers:e.bundle.modifiers}}}return{spawned:Object.freeze(n),items:e.bundle.items,modifiers:e.bundle.modifiers}}function ys(e,t,n,s=1){const a=Number(e);return Number.isFinite(a)?Math.max(t,Math.min(n,a)):s}const xo=6;class kd{timer;interval;spawnCycles;factionId;random;makeId;difficulty;eliteOdds;cadenceDecay;multiplierGrowth;runSeconds=0;clearCount=0;boardEmpty=!0;lastClearAt=null;lastSpawnAt=null;lastCadence;lastMultiplier;rampEvaluation;rampStageIndex;currentDifficulty;cadenceScale=1;multiplierScale=1;pressureScale=1;calmUntil=null;calmSecondsRemaining=0;cadenceFloor=.3;constructor(t={}){this.factionId=t.factionId??"enemy",this.random=typeof t.random=="function"?t.random:Math.random;const n=Number.isFinite(t.difficulty)?Number(t.difficulty):1;this.difficulty=Math.max(.5,n);const s=typeof t.eliteOdds=="number"?t.eliteOdds:0;this.eliteOdds=Math.max(0,Math.min(.95,s)),this.currentDifficulty=this.difficulty,this.cadenceDecay=yo(this.currentDifficulty),this.multiplierGrowth=Eo(this.currentDifficulty),this.spawnCycles=0,this.rampEvaluation=wo(this.currentDifficulty,{runSeconds:0,clears:0,spawnCycles:0}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.interval=this.rampEvaluation.cadenceTarget,this.timer=this.interval,this.lastCadence=this.interval,this.lastMultiplier=this.rampEvaluation.multiplierBase;const a=(()=>{let r=0;return()=>`e${Date.now()}-${r+=1}`})();this.makeId=typeof t.idFactory=="function"?t.idFactory:a}update(t,n,s,a,r={}){if(!Number.isFinite(t)||t<=0)return;this.runSeconds+=t,this.applyRuntimeModifiers(r),this.resolveRampState();const o=this.countActiveEnemies(n);if(this.trackClears(o),this.calmUntil!==null&&this.runSeconds<this.calmUntil){const c=this.calmUntil-this.runSeconds;this.calmSecondsRemaining=c,this.timer=Math.max(this.timer,c);return}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0),this.timer-=t;let i=0;for(;this.timer<=0&&i<xo;){const c=this.getAvailableSlots(n);if(c<=0){this.timer=Math.max(this.timer,.5);break}const u=this.resolveRampState(),l=Bd(this.factionId,u.stage.bundleTier,this.random),d=this.computeMultiplier(u);if(Pd({bundle:l,factionId:this.factionId,pickEdge:a,addUnit:s,makeId:this.makeId,availableSlots:c,eliteOdds:this.eliteOdds,random:this.random,difficultyMultiplier:d,rampTier:u.stage.bundleTier}).spawned.length===0){this.timer=Math.max(this.timer,.5);break}const f=this.runSeconds+this.timer;this.lastCadence=this.lastSpawnAt===null?this.interval:Math.max(.01,f-this.lastSpawnAt),this.lastSpawnAt=f,this.lastMultiplier=d,this.spawnCycles+=1,i+=1;const m=this.resolveRampState();this.interval=this.computeNextInterval(m),this.timer+=this.interval}i===xo&&this.timer<=0&&(this.timer=this.interval)}getSnapshot(){const t=this.rampEvaluation.stage;return{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles,rampStageIndex:this.rampStageIndex,rampStageId:t.id,rampStageLabel:t.label,bundleTier:t.bundleTier,cadence:this.interval,lastCadence:this.lastCadence,lastSpawnAt:this.lastSpawnAt,lastClearAt:this.lastClearAt,difficultyMultiplier:this.lastMultiplier,effectiveDifficulty:this.currentDifficulty,aggressionMultiplier:this.currentDifficulty/this.difficulty,cadenceMultiplier:this.cadenceScale,strengthMultiplier:this.multiplierScale,pressureMultiplier:this.pressureScale,calmSecondsRemaining:this.calmSecondsRemaining}}resolveRampState(){return this.rampEvaluation=wo(this.currentDifficulty,{runSeconds:this.runSeconds,clears:this.clearCount,spawnCycles:this.spawnCycles}),this.rampStageIndex=this.rampEvaluation.stageIndex,this.rampEvaluation}applyRuntimeModifiers(t){const n=ys(t.aggressionMultiplier,.25,6,1),s=ys(t.cadenceMultiplier,.1,10,1),a=ys(t.strengthMultiplier,.1,12,1),r=ys(t.pressureMultiplier,.1,10,1),o=Number.isFinite(t.cadenceFloor)?Math.max(.1,t.cadenceFloor):this.cadenceFloor,i=Math.max(.25,this.difficulty*n);if(i!==this.currentDifficulty&&(this.currentDifficulty=i,this.cadenceDecay=yo(this.currentDifficulty),this.multiplierGrowth=Eo(this.currentDifficulty),this.resolveRampState()),this.cadenceScale=s,this.multiplierScale=a,this.pressureScale=r,this.cadenceFloor=o,Object.prototype.hasOwnProperty.call(t,"calmSecondsRemaining")){const c=t.calmSecondsRemaining;c===null?this.calmUntil=null:typeof c=="number"&&Number.isFinite(c)&&c>0?this.calmUntil=this.runSeconds+c:typeof c=="number"&&c<=0&&(this.calmUntil=null)}this.calmSecondsRemaining=Math.max(0,this.calmUntil!==null?this.calmUntil-this.runSeconds:0)}computeNextInterval(t){const n=t.cadenceTarget*this.cadenceScale,s=Math.pow(this.spawnCycles+1,.6)*.018*this.pressureScale,a=1+Math.min(4,s),r=n/a,o=this.interval*this.cadenceDecay,i=Math.min(o,r);return Math.max(this.cadenceFloor,i)}computeMultiplier(t){const n=1+this.spawnCycles*this.multiplierGrowth*this.pressureScale,s=1+t.stageIndex*.15,a=t.multiplierBase*n*s*this.multiplierScale;return Math.min(16,Math.max(1,a))}countActiveEnemies(t){return t.filter(n=>n.faction===this.factionId&&!n.isDead()).length}getAvailableSlots(t){return Qu-this.countActiveEnemies(t)}trackClears(t){if(t<=0){this.boardEmpty||(this.clearCount+=1,this.lastClearAt=this.runSeconds),this.boardEmpty=!0;return}this.boardEmpty=!1}}function Rd(){if(typeof window>"u")return null;try{return window.localStorage??null}catch(e){return console.warn("Structured telemetry storage unavailable",e),null}}function Md(e,t){const n={event:e,timestamp:Date.now(),payload:{...t}};return console.info(e,n),n}function Dd(e,t,n={}){const s=Rd();if(!s)return;const a=Number.isFinite(n.limit)?Math.max(1,Math.trunc(n.limit??16)):16,o=[...gr(e)??[],t].slice(-a);try{s.setItem(e,JSON.stringify(o))}catch(i){console.warn("Failed to persist structured telemetry",{storageKey:e,error:i})}}let Bo=-1,Po=-1,Ma=null,Da=0,Ia=0;const Id="telemetry:enemy-scaling:summaries";function Td(e,t={}){const n=e.rampStageIndex!==Bo,s=e.spawnCycles>=Po+10,a=e.lastClearAt!==null&&e.lastClearAt!==Ma;if(!n&&!s&&!a)return;Bo=e.rampStageIndex,Po=e.spawnCycles,Ma=e.lastClearAt??Ma,Da=Math.max(Da,e.difficultyMultiplier);const r=Math.max(0,Math.round(e.calmSecondsRemaining*1e3));r>Ia&&(Ia=r);const o={stage:e.rampStageLabel,stageIndex:e.rampStageIndex,bundleTier:e.bundleTier,cadenceSeconds:Number(e.cadence.toFixed(2)),lastCadenceSeconds:Number(e.lastCadence.toFixed(2)),multiplier:Number(e.difficultyMultiplier.toFixed(2)),effectiveDifficulty:Number(e.effectiveDifficulty.toFixed(2)),aggressionMultiplier:Number(e.aggressionMultiplier.toFixed(2)),cadenceMultiplier:Number(e.cadenceMultiplier.toFixed(2)),strengthMultiplier:Number(e.strengthMultiplier.toFixed(2)),pressureMultiplier:Number(e.pressureMultiplier.toFixed(2)),calmSecondsRemaining:Number(e.calmSecondsRemaining.toFixed(2)),runSeconds:Math.round(e.runSeconds),spawnCycles:e.spawnCycles,clears:e.clears,wipeSince:t.wipeSince??null,longestWipeMs:t.wipeDurationMs??0,peakMultiplier:Number(Da.toFixed(2)),longestCalmMs:Ia},i=Md("enemy-scaling",o);Dd(Id,i,{limit:24})}const Hd=Object.freeze({ngPlusLevel:0,unlockSlots:0}),Fd={default:"Included with the sauna key",ngPlusLevel:"Reach NG+ level",unlockSlots:"Earn roster unlocks"},Br=Object.freeze([{id:"ember-circuit",name:"Ember Circuit",rosterCap:3,description:"Classic cedar benches with a loyal trio of attendants.",art:{badge:Si,glow:"linear-gradient(145deg, rgba(255,161,76,0.65), rgba(255,226,173,0.18))"},unlock:{type:"default",label:"Available from the first steam session"}},{id:"aurora-ward",name:"Aurora Ward",rosterCap:4,description:"Glacial glass benches and a quartet ready to repel sieges.",art:{badge:yi,glow:"linear-gradient(140deg, rgba(128,208,255,0.7), rgba(61,184,255,0.2))"},unlock:{type:"unlockSlots",slots:2,label:"Secure 2 roster unlocks"}},{id:"mythic-conclave",name:"Mythic Conclave",rosterCap:6,description:"Runic obsidian tiers where six legends guard the löyly.",art:{badge:Ei,glow:"linear-gradient(135deg, rgba(176,106,255,0.72), rgba(245,199,255,0.2))"},unlock:{type:"ngPlusLevel",level:3,label:"Prestige to NG+ level 3"}}]),ls=Br[0].id,Ta=new Map(Br.map(e=>[e.id,e]));function nc(){return Br}function gt(e){return e&&Ta.has(e)?Ta.get(e):Ta.get(ls)}function ko(e,t,n){if(!Number.isFinite(e))return t;const s=Math.max(t,Math.min(n,e));return Number.isNaN(s)?t:s}function Es(e){if(e.label)return e.label;const t=Fd[e.type];if(!t)return"";switch(e.type){case"ngPlusLevel":return`${t} ${e.level}`;case"unlockSlots":return`${t} ${e.slots}`;default:return t}}function Rn(e,t){const n=t??Hd;if(e.unlock.type==="default")return{tier:e,unlocked:!0,progress:1,requirementLabel:Es(e.unlock)};if(e.unlock.type==="ngPlusLevel"){const s=ko(n.ngPlusLevel/e.unlock.level,0,1);return{tier:e,unlocked:n.ngPlusLevel>=e.unlock.level,progress:s,requirementLabel:Es(e.unlock)}}if(e.unlock.type==="unlockSlots"){const s=ko(n.unlockSlots/e.unlock.slots,0,1);return{tier:e,unlocked:n.unlockSlots>=e.unlock.slots,progress:s,requirementLabel:Es(e.unlock)}}return{tier:e,unlocked:!1,progress:0,requirementLabel:Es(e.unlock)}}const Ro=["hud-grid","grid","grid-rows-[64px_1fr_80px]","grid-cols-[280px_1fr_340px]","gap-[clamp(16px,3vw,28px)]"],Mo={top:["col-span-3","row-span-1","row-start-1"],left:["col-start-1","row-start-2","row-span-1"],content:["col-start-2","row-start-2","row-span-1"],right:["col-start-3","row-start-2","row-span-1"],bottom:["col-span-3","row-start-3","row-span-1"]};function Ld(e,t){let n=e.querySelector("[data-hud-root]");return n||(n=t.createElement("div"),n.dataset.hudRoot="true",n.className="hud-layout-root",e.prepend(n)),n}function Nn(e,t,n,s){let a=e.querySelector(`[data-hud-region="${n}"]`);return a||(a=t.createElement("div"),a.dataset.hudRegion=n,e.appendChild(a)),a.classList.add("hud-region",...s),a.parentElement!==e&&e.appendChild(a),a}function Qd(e,t,n){if(n){e.classList.add(...Ro);for(const[s,a]of Object.entries(Mo))t[s].classList.add(...a)}else{e.classList.remove(...Ro);for(const[s,a]of Object.entries(Mo))t[s].classList.remove(...a)}}function us(e){const t=e.ownerDocument??document,n=Ld(e,t),s={top:Nn(n,t,"top",["hud-top-row"]),left:Nn(n,t,"left",["hud-actions"]),content:Nn(n,t,"content",["hud-content"]),right:Nn(n,t,"right",["hud-right-column"]),bottom:Nn(n,t,"bottom",["hud-bottom-row"])};n.append(s.top,s.left,s.content,s.right,s.bottom);const a=e.dataset.hudVariant==="v2";if(Qd(e,s,a),!a){const u=e.querySelector("#resource-bar");u&&u.parentElement!==s.right&&s.right.prepend(u)}const r=e.querySelector("#build-menu");r&&r.parentElement!==s.left&&s.left.appendChild(r);const o=e.querySelector("#build-id");o&&o.parentElement!==s.bottom&&s.bottom.appendChild(o);let i=e.querySelector(".hud-mobile-bar__tray"),c=i?.closest(".hud-mobile-bar")??null;return(!i||!c)&&(c=t.createElement("div"),c.className="hud-mobile-bar",i=t.createElement("div"),i.className="hud-mobile-bar__tray",c.appendChild(i)),c.parentElement!==s.bottom&&s.bottom.appendChild(c),{root:n,regions:s,actions:s.left,side:s.right,mobileBar:i}}const Do=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Nd(e,t={}){const n=document.getElementById("ui-overlay");if(!n)return{update:()=>{},dispose:()=>{}};const s=document.createElement("div");s.classList.add("sauna-control"),s.dataset.tutorialTarget="heat";const a=()=>{const L=t.getActiveTierId?.();return gt(L??ls).id},r=()=>t.getTierContext?.()??null,o=document.createElement("button");o.type="button",o.textContent="Sauna ♨️",o.classList.add("topbar-button","sauna-toggle"),o.setAttribute("aria-expanded","false"),s.appendChild(o);const i=document.createElement("div");i.classList.add("sauna-card","hud-card"),i.hidden=!0;const c=document.createElement("section");c.classList.add("sauna-health");const u=`sauna-health-label-${Math.floor(Math.random()*1e5)}`,l=document.createElement("div");l.classList.add("sauna-health__header");const d=document.createElement("span");d.id=u,d.classList.add("sauna-health__title"),d.textContent="Sauna Integrity",l.appendChild(d);const h=document.createElement("span");h.classList.add("sauna-health__value"),h.setAttribute("aria-live","polite"),l.appendChild(h),c.appendChild(l);const f=document.createElement("div");f.classList.add("sauna-health__bar"),f.setAttribute("role","meter"),f.setAttribute("aria-valuemin","0"),f.setAttribute("aria-labelledby",u);const m=document.createElement("div");m.classList.add("sauna-health__fill"),f.appendChild(m),c.appendChild(f);const A=document.createElement("div");A.classList.add("sauna-health__destruction"),A.hidden=!0,f.appendChild(A);const g=document.createElement("div");g.classList.add("sauna-progress");const p=document.createElement("div");p.classList.add("sauna-progress__fill"),g.appendChild(p),i.appendChild(c),i.appendChild(g);const b=nc(),C=new Map,S=document.createElement("section");S.classList.add("sauna-tier");const F=document.createElement("div");F.classList.add("sauna-tier__header");const H=document.createElement("span");H.classList.add("sauna-tier__title"),H.textContent="Premium Tiers",F.appendChild(H);const T=document.createElement("p");T.classList.add("sauna-tier__subtitle"),T.textContent="Align the löyly with your prestige to unlock lavish benches and roster headroom.",F.appendChild(T),S.appendChild(F);const Q=document.createElement("div");Q.classList.add("sauna-tier__grid"),S.appendChild(Q);for(const L of b){const q=document.createElement("button");q.type="button",q.classList.add("sauna-tier__option"),q.dataset.tierId=L.id,q.setAttribute("aria-pressed","false");const z=document.createElement("div");z.classList.add("sauna-tier__badge"),z.style.setProperty("--sauna-tier-badge-image",`url(${L.art.badge})`),L.art.glow&&z.style.setProperty("--sauna-tier-glow",L.art.glow),q.appendChild(z);const Z=document.createElement("div");Z.classList.add("sauna-tier__copy"),q.appendChild(Z);const ke=document.createElement("span");ke.classList.add("sauna-tier__name"),ke.textContent=L.name,Z.appendChild(ke);const Te=document.createElement("span");Te.classList.add("sauna-tier__cap"),Te.textContent=`Cap ${L.rosterCap}`,Z.appendChild(Te);const Ft=document.createElement("p");Ft.classList.add("sauna-tier__description"),Ft.textContent=L.description,Z.appendChild(Ft);const Kt=document.createElement("div");Kt.classList.add("sauna-tier__progress");const Tn=document.createElement("div");Tn.classList.add("sauna-tier__progress-fill"),Kt.appendChild(Tn);const on=document.createElement("span");on.classList.add("sauna-tier__progress-label"),Kt.appendChild(on),Z.appendChild(Kt);const rt=document.createElement("span");rt.classList.add("sauna-tier__requirement"),Z.appendChild(rt);const bt={tier:L,button:q,fill:Tn,progressLabel:on,requirement:rt,handleClick:()=>{At(L,bt)}};q.addEventListener("click",bt.handleClick),C.set(L.id,bt),Q.appendChild(q)}i.appendChild(S),Le();const I=document.createElement("div");I.classList.add("sauna-roster");const B=document.createElement("div");B.classList.add("sauna-roster__header");const w=document.createElement("span");w.textContent="Roster Cap",w.classList.add("sauna-roster__title"),B.appendChild(w);const v=document.createElement("span");v.classList.add("sauna-roster__value"),v.setAttribute("aria-live","polite"),B.appendChild(v),I.appendChild(B);const y=document.createElement("p");y.classList.add("sauna-roster__description"),y.textContent="Tune how many attendants may be active before new recruits wait in the steam.",I.appendChild(y);const M=`sauna-roster-${Math.floor(Math.random()*1e5)}`,x=document.createElement("label");x.classList.add("sauna-roster__label"),x.htmlFor=M,x.textContent="Active attendants";const O=document.createElement("input");O.type="range",O.id=M,O.min="0",O.step="1",O.classList.add("sauna-roster__slider");const N=document.createElement("input");N.type="number",N.min="0",N.step="1",N.inputMode="numeric",N.classList.add("sauna-roster__number");const U=document.createElement("div");U.classList.add("sauna-roster__controls"),U.appendChild(x),U.appendChild(O),U.appendChild(N),I.appendChild(U),i.appendChild(I);const J=document.createElement("label");J.classList.add("sauna-option");const $=document.createElement("input");$.type="checkbox",$.classList.add("sauna-option__input"),$.checked=e.rallyToFront,$.addEventListener("change",()=>{e.rallyToFront=$.checked}),J.appendChild($);const V=document.createElement("span");V.textContent="Rally to Front",V.classList.add("sauna-option__label"),J.appendChild(V),i.appendChild(J),s.appendChild(i);const{regions:ae}=us(n),re=ae.top,W=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null;let ie=!!W?.matches;const me=(L,q)=>{typeof L.addEventListener=="function"?L.addEventListener("change",q):typeof L.addListener=="function"&&L.addListener(q)},ve=(L,q)=>{typeof L.removeEventListener=="function"?L.removeEventListener("change",q):typeof L.removeListener=="function"&&L.removeListener(q)},be=L=>{ie=!!L.matches,c.dataset.motion=ie?"reduced":"full"};c.dataset.motion=ie?"reduced":"full",W&&me(W,be);const et=()=>{const L=gt(a()),q=Math.max(0,Math.floor(L.rosterCap)),z=t.getRosterCapLimit?.();if(typeof z=="number"&&Number.isFinite(z)){const Z=Math.max(0,Math.floor(z));return Math.max(0,Math.min(q,Z))}return q};function Le(){const L=a(),q=r();for(const z of C.values()){const Z=Rn(z.tier,q),ke=Math.round(Math.max(0,Math.min(Z.progress,1))*100);z.fill.style.width=`${ke}%`,z.progressLabel.textContent=Z.unlocked?"Unlocked":`${ke}% ready`,z.requirement.textContent=Z.unlocked?`Roster cap ${z.tier.rosterCap}`:Z.requirementLabel,z.button.dataset.state=Z.unlocked?z.tier.id===L?"active":"available":"locked",z.button.setAttribute("aria-pressed",z.tier.id===L?"true":"false"),z.button.setAttribute("aria-disabled",Z.unlocked?"false":"true")}}function At(L,q){if(!Rn(L,r()).unlocked){q.button.classList.remove("sauna-tier__option--denied"),q.button.offsetWidth,q.button.classList.add("sauna-tier__option--denied");return}(t.setActiveTierId?.(L.id,{persist:!0})??!1)&&Qe(e.maxRosterSize,!0),Le()}const qe=(L,q)=>{const z=Math.max(0,Math.min(L,Math.floor(q)));O.max=String(L),O.value=String(z),O.setAttribute("aria-valuemax",O.max),O.setAttribute("aria-valuenow",O.value),N.max=String(L),N.value=String(z),v.textContent=z===0?"Paused":`${z}`,v.dataset.state=z===0?"paused":"active",N.setAttribute("aria-label",`Roster cap set to ${z}`)};function Qe(L,q){const z=Number(L),Z=et(),ke=Number.isFinite(z)?Math.max(0,Math.floor(z)):0;let Te=Math.max(0,Math.min(Z,ke));return t.updateMaxRosterSize?Te=t.updateMaxRosterSize(Te,{persist:q}):e.maxRosterSize=Te,qe(Z,Te),Te}const Pe=()=>{Qe(Number(O.value),!1)},tt=()=>{Qe(Number(O.value),!0)};O.addEventListener("input",Pe),O.addEventListener("change",tt);const nt=L=>{Qe(Number(N.value),L)},Oe=()=>{nt(!1)},vt=()=>{nt(!0)},st=()=>{nt(!0)};N.addEventListener("input",Oe),N.addEventListener("change",vt),N.addEventListener("blur",st),Qe(e.maxRosterSize,!1);const he=()=>{s.parentElement!==re&&re.appendChild(s);const L=re.querySelector("#topbar");return L&&L.parentElement===re?(L.nextSibling!==s&&re.insertBefore(s,L.nextSibling),!0):!1};let we=null;he()||(we=new MutationObserver(()=>{he()&&we?.disconnect()}),we.observe(re,{childList:!0}));const qt=()=>{const L=!i.hidden;i.hidden=L,o.setAttribute("aria-expanded",String(!L))};o.addEventListener("click",qt);const at=()=>{const L=Math.max(1,Math.floor(e.maxHealth)),q=Math.max(0,Math.min(L,Math.floor(Number.isFinite(e.health)?e.health:0))),z=L>0?q/L:0,Z=Math.max(0,Math.min(z,1));m.style.width=`${Z*100}%`;const ke=Do.format(q),Te=Do.format(L);h.textContent=`${ke} / ${Te}`,f.setAttribute("aria-valuenow",String(q)),f.setAttribute("aria-valuemax",String(L)),f.setAttribute("aria-valuetext",`${ke} of ${Te} health`);const Ft=e.destroyed?"offline":Z<=.2?"critical":Z<=.55?"warning":"stable";f.dataset.level=Ft,h.dataset.state=Ft,c.dataset.state=e.destroyed?"destroyed":"active"},P=()=>{A.classList.remove("sauna-health__destruction--active"),A.hidden=!0};let j=null,K=null;const _=()=>{j!==null&&(window.clearTimeout(j),j=null),f.classList.remove("sauna-health__bar--impact")},ge=()=>{m.classList.remove("sauna-health__fill--damage")};m.addEventListener("animationend",ge);const pe=()=>{P()};A.addEventListener("animationend",pe);const Ie=()=>{_(),f.classList.add("sauna-health__bar--impact"),ie||(m.classList.remove("sauna-health__fill--damage"),m.offsetWidth,m.classList.add("sauna-health__fill--damage")),j=window.setTimeout(()=>{f.classList.remove("sauna-health__bar--impact"),j=null},ie?360:560)},Ye=()=>{K!==null&&(window.clearTimeout(K),K=null),A.hidden=!1,A.classList.remove("sauna-health__destruction--active"),A.offsetWidth,A.classList.add("sauna-health__destruction--active"),K=window.setTimeout(()=>{P(),K=null},ie?720:1100)},Ke=()=>{at();const L=e.playerSpawnCooldown>0?e.playerSpawnCooldown:1,q=1-e.playerSpawnTimer/L;p.style.width=`${Math.max(0,Math.min(q,1))*100}%`,$.checked=e.rallyToFront;const z=et(),Z=Math.max(0,Math.min(z,Math.floor(e.maxRosterSize)));if(Z!==e.maxRosterSize)if(t.updateMaxRosterSize){const ke=t.updateMaxRosterSize(Z,{persist:!0});qe(z,ke)}else e.maxRosterSize=Z,qe(z,Z);else qe(z,Z);Le()};return at(),{update:Ke,handleDamage:L=>{at(),Ie()},handleDestroyed:L=>{i.hidden=!1,o.setAttribute("aria-expanded","true"),at(),Ie(),Ye()},dispose:()=>{we?.disconnect(),we=null,o.removeEventListener("click",qt),O.removeEventListener("input",Pe),O.removeEventListener("change",tt),N.removeEventListener("input",Oe),N.removeEventListener("change",vt),N.removeEventListener("blur",st),W&&ve(W,be),m.removeEventListener("animationend",ge),A.removeEventListener("animationend",pe),_(),K!==null&&(window.clearTimeout(K),K=null),P();for(const L of C.values())L.button.removeEventListener("click",L.handleClick);C.clear(),s.remove()}}}const Gd=["/assets/sounds/sauna-forest.ogg","/assets/sounds/sauna-forest.mp3"],sc="audio_enabled",ac="audio_volume",nr=new Set,ha=new Set;let en=null,Ss=null,Et=null,Zn=null;function rc(e){if(typeof localStorage>"u")return null;try{return localStorage.getItem(e)}catch(t){return console.warn("Unable to read ambience preference",e,t),null}}const oc=rc(sc);let Ht=oc==="true",_n=oc!==null;const Io=rc(ac);let yn=Od(Io?Number(Io):NaN,.65),sn=!1,zt=Za();const mn=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)"):null;let ic=mn?.matches??!1;if(mn){const e=t=>{ic=t.matches};typeof mn.addEventListener=="function"?mn.addEventListener("change",e):typeof mn.addListener=="function"&&mn.addListener(e)}if(typeof window<"u"&&!_n){const e=()=>{_n||(_n=!0,hc(!0),Dn())};window.addEventListener("pointerdown",e,{once:!0}),window.addEventListener("keydown",e,{once:!0})}uu(e=>{zt=e,e?dc():Ht?Dn():Mn(!0),ds()});function Od(e,t){return Number.isFinite(e)?e<0?0:e>1?1:e:t}function ds(){const e=Gs();for(const t of nr)t(e)}function jd(e){if(!(typeof localStorage>"u"))try{localStorage.setItem(sc,e?"true":"false")}catch(t){console.warn("Unable to persist ambience preference",t)}}function Ud(e){if(!(typeof localStorage>"u"))try{localStorage.setItem(ac,e.toFixed(3))}catch(t){console.warn("Unable to persist ambience volume",t)}}function cc(e){if(Et)return Et;const t=e.createGain();return t.gain.value=Ht&&!zt?yn:0,t.connect(e.destination),Et=t,t}function Mn(e=!1){if(!Et)return;const t=Et.context,n=Ht&&!zt?yn:0,s=t.currentTime;Et.gain.cancelScheduledValues(s),e?Et.gain.setValueAtTime(n,s):Et.gain.setTargetAtTime(n,s,.25)}function zd(){return ic?.6:4.2}function lc(){Zn!==null&&(clearTimeout(Zn),Zn=null)}function sr(e){try{e.source.stop()}catch{}e.source.disconnect(),e.gain.disconnect(),ha.delete(e)}function Xd(){for(const e of[...ha])sr(e)}async function qd(e){return en||(Ss||(Ss=(async()=>{for(const t of Gd)try{const n=await fetch(t);if(!n.ok)continue;const s=await n.arrayBuffer();return await e.decodeAudioData(s)}catch(n){console.warn("Failed to fetch ambience source",t,n)}throw new Error("No ambience sources available")})().then(t=>(en=t,t)).catch(t=>{throw Ss=null,t})),Ss)}function Yd(e,t){if(!sn)return;lc();const n=Math.max(0,e-t.currentTime-.05);Zn=setTimeout(()=>{Zn=null,sn&&uc(e)},n*1e3)}function uc(e){const t=Et?.context??as();if(!t||!en)return;const n=t.createGain(),s=t.createBufferSource();s.buffer=en,s.loop=!1,s.connect(n),n.connect(cc(t));const a=Math.min(zd(),en.duration/2),r=Number.isFinite(a)&&a>0?a:.25,o=Math.max(t.currentTime,e);n.gain.setValueAtTime(0,o),n.gain.linearRampToValueAtTime(1,o+r);const i=e+en.duration,c=i-r;c>o&&n.gain.setValueAtTime(1,c),n.gain.linearRampToValueAtTime(.001,i+.1);const u={source:s,gain:n,stopTime:i};ha.add(u),s.addEventListener("ended",()=>{sr(u)});try{s.start(e)}catch(l){console.warn("Failed to start ambience layer",l),sr(u);return}Yd(i-r,t)}async function Dn(){if(sn||!Ht||zt){Mn();return}const e=as();if(e){cc(e),Mn();try{const t=await qd(e);if(!Ht||zt)return;await e.resume().catch(()=>{}),sn=!0;const n=Math.max(e.currentTime+.12,e.currentTime);uc(n),ds()}catch(t){console.warn("Unable to start ambience",t)}}}function dc(){if(!sn&&ha.size===0){Mn(!0);return}sn=!1,lc(),Xd(),Mn(!0),ds()}function hc(e){Ht===e&&_n||(Ht=e,_n=!0,jd(e),e?zt||Dn():dc(),ds())}function Kd(e){const t=Math.max(0,Math.min(1,e));t!==yn&&(yn=t,Ud(yn),Mn(),ds())}function Gs(){return{enabled:Ht,playing:sn,volume:yn,globallyMuted:zt}}function Vd(e){return nr.add(e),()=>{nr.delete(e)}}Ht&&!zt&&Dn();const Cs=10,Zd=1.5,_d=1.5,To=1,Jd=.6,Ho="⚔️ +50% attack · 🛡️ Barrier · ♾️ Immortal",Jn=5,Wn=3;let ue=null;function Wd(){ue&&(ue.tickTimer&&clearInterval(ue.tickTimer),ue.timeout&&clearTimeout(ue.timeout),ue=null)}function Pr(){return ue!==null}function $d(){return ue?Math.max(0,ue.endTime-performance.now())/1e3:0}function eh(e,t){if(Pr()||!e.spendResource(Jn,k.SISU))return!1;const n=[];for(const a of t){if(a.faction!=="player"||a.isDead())continue;const r=`sisu-burst-${a.id}`,o={unit:a,attackDelta:0,movementDelta:0,shieldBonusApplied:To,shieldBonusRemaining:To,wasImmortal:a.isImmortal()};mu({id:r,duration:Cs,data:o,onApply:()=>{const i=a.stats.attackDamage,c=Math.round(i*Zd);o.attackDelta=Math.max(0,c-i),o.attackDelta!==0&&(a.stats.attackDamage=i+o.attackDelta);const u=a.stats.movementRange,l=Math.max(1,Math.round(u*_d));o.movementDelta=Math.max(0,l-u),o.movementDelta!==0&&(a.stats.movementRange=u+o.movementDelta),o.shieldBonusRemaining=o.shieldBonusApplied,a.setShield(a.getShield()+o.shieldBonusApplied),a.setImmortal(!0),a.fearless=!0},onExpire:()=>{let i=!1;if(o.attackDelta!==0){const u=a.stats.attackDamage,l=Math.max(0,u-o.attackDelta);l!==u&&(a.stats.attackDamage=l,i=!0)}if(o.movementDelta!==0){const u=a.stats.movementRange,l=Math.max(0,u-o.movementDelta);l!==u&&(a.stats.movementRange=l,i=!0)}a.setImmortal(o.wasImmortal);const c=Math.max(0,Math.min(o.shieldBonusApplied,o.shieldBonusRemaining));c>0&&a.setShield(Math.max(0,a.getShield()-c)),delete a.fearless,i&&R.emit("unit:stats:changed",{unitId:a.id,stats:{...a.stats}}),ue&&(ue.affected=ue.affected.filter(u=>u.modifierId!==r))},hooks:{"combat:onHit":i=>{const c=i;if(c.source!=="defender"||c.defender.id!==a.id||c.shieldDamage<=0||o.shieldBonusRemaining<=0)return;const u=Math.min(o.shieldBonusRemaining,c.shieldDamage);o.shieldBonusRemaining=Math.max(0,o.shieldBonusRemaining-u)}}}),n.push({unit:a,modifierId:r,state:o})}return ue={endTime:performance.now()+Cs*1e3,status:Ho,affected:n,tickTimer:null,timeout:null},R.emit("sisuBurstStart",{remaining:Cs,status:Ho}),ue.tickTimer=setInterval(()=>{if(!ue)return;const a=Math.max(0,Math.ceil($d()));a>0&&R.emit("sisuBurstTick",{remaining:a,status:ue.status})},1e3),ue.timeout=setTimeout(()=>{th()},Cs*1e3),!0}function th(){if(ue){for(const e of ue.affected)gu(e.modifierId);Wd(),R.emit("sisuBurstEnd",{})}}function nh(e,t,n,s){const a=t.filter(r=>r.faction==="player"&&!r.isDead());if(a.length===0||!e.spendResource(Wn,k.SISU))return!1;for(const r of a){const o=Qi(n,3,t)??{...n};r.setCoord(o);const i=Math.round(r.getMaxHealth()*Jd);r.stats.health=Math.min(r.getMaxHealth(),Math.max(r.stats.health,i))}return s.revealAround(n,3,{autoFrame:!1}),R.emit("torilleRecalled",{count:a.length}),!0}const sh="(max-width: 820px)",fc="is-mobile",mc="is-desktop";let Ve=null,Vs=null,ut=!1,xs=0;const Zs=new Set,ar=new Set,_s=e=>{for(const t of ar)t.classList.toggle(fc,e),t.classList.toggle(mc,!e),t.dataset.viewport=e?"mobile":"desktop"},ah=e=>{if(ut!==e){ut=e,_s(ut);for(const t of Array.from(Zs))try{t(ut)}catch(n){console.error("Failed to notify mobile listener",n)}}},gc=()=>{if(Ve||typeof window>"u")return;Ve=window.matchMedia(sh),ut=Ve.matches,_s(ut);const e=t=>{ah(t.matches)};typeof Ve.addEventListener=="function"?(Ve.addEventListener("change",e),Vs=()=>Ve?.removeEventListener("change",e)):(Ve.addListener(e),Vs=()=>Ve?.removeListener(e))},rh=()=>{Ve&&(Vs?.(),Vs=null,Ve=null)},kr=(e,{immediate:t=!0}={})=>(gc(),Zs.add(e),t&&e(ut),()=>{Zs.delete(e)}),oh=({root:e,onChange:t,immediate:n=!0}={})=>{gc();const s=e??(typeof document<"u"?document.documentElement:null);s&&(ar.add(s),_s(ut)),xs+=1;let a=null;return t?a=kr(t,{immediate:n}):n&&Ve&&_s(ut),{matches:()=>ut,dispose:()=>{s&&(ar.delete(s),s.classList.remove(fc,mc),(s.dataset.viewport==="mobile"||s.dataset.viewport==="desktop")&&delete s.dataset.viewport),a&&(a(),a=null),xs=Math.max(0,xs-1),xs===0&&Zs.size===0&&rh()}}};function dn(e,t={}){const{iconSrc:n,description:s,srLabel:a}=t,r=document.createElement("div");if(r.classList.add("topbar-badge"),r.setAttribute("role","status"),r.setAttribute("aria-live","polite"),r.setAttribute("aria-atomic","true"),n){const d=document.createElement("img");d.src=n,d.alt=e,d.decoding="async",d.classList.add("topbar-badge-icon"),r.appendChild(d)}const o=document.createElement("div");o.classList.add("badge-text");const i=document.createElement("span");i.textContent=e,i.classList.add("badge-label"),o.appendChild(i);const c=document.createElement("span");c.textContent="0",c.classList.add("badge-value"),c.setAttribute("aria-hidden","true"),o.appendChild(c);const u=document.createElement("span");u.classList.add("badge-delta"),u.style.opacity="0",u.style.transform="translateY(-6px)",u.style.transition="opacity 0.5s ease, transform 0.5s ease",u.setAttribute("aria-hidden","true"),r.append(o,u),s&&(r.title=s);const l=a??e;return r.dataset.label=l,r.setAttribute("aria-label",`${l}: 0`),{container:r,value:c,delta:u,label:l}}function ih(e,t={},n={}){const s=document.getElementById("ui-overlay");if(!s)return{update:()=>{},dispose:()=>{}};const{regions:a,mobileBar:r}=us(s),o=a.top,i=document.createElement("div");i.id="topbar",o.prepend(i);const c=document.createElement("div");c.className="topbar-badge-row",i.appendChild(c);const u=document.createElement("div");u.className="topbar-action-tray",u.setAttribute("role","group"),u.setAttribute("aria-label","Combat and audio controls"),u.dataset.tutorialTarget="combat";const l={[k.SAUNA_BEER]:"Sauna beer bottles chilled for construction crews and eager recruits.",[k.SAUNAKUNNIA]:"Saunakunnia—prestige earned from sauna rituals and triumphant battles.",[k.SISU]:"Sisu—the relentless grit forged when your warriors triumph on the snow."},d=dn("Sauna Beer",{iconSrc:t.saunaBeer,description:l[k.SAUNA_BEER],srLabel:"Sauna beer reserves"});d.container.classList.add("badge-sauna-beer");const h=dn("Sisu",{iconSrc:t.sisu,description:l[k.SISU],srLabel:"Sisu reserves"});h.container.classList.add("badge-sisu"),h.container.dataset.tutorialTarget="sisu";const f=dn("Saunakunnia",{iconSrc:t.saunakunnia,description:l[k.SAUNAKUNNIA],srLabel:"Saunakunnia"});f.container.classList.add("badge-sauna"),f.container.dataset.tutorialTarget="victory";const m=dn("Burst 🔥",{srLabel:"Sisu burst countdown"});m.container.classList.add("badge-sisu"),m.container.style.display="none",m.delta.style.display="none";const A=dn("Time");A.container.classList.add("badge-time"),A.delta.style.display="none";const g=dn("Enemy Ramp",{srLabel:"Enemy ramp intensity"});g.container.classList.add("badge-ramp"),g.delta.style.display="none",g.container.dataset.tutorialTarget="enemy-ramp",g.container.title="Enemy ramp intensity and cadence.",c.appendChild(d.container),c.appendChild(h.container),c.appendChild(f.container),c.appendChild(m.container),c.appendChild(g.container),c.appendChild(A.container);let p=null,b=null;n.useSisuBurst&&(p=document.createElement("button"),p.type="button",p.classList.add("topbar-button","sisu-button"),p.textContent=`Sisu Burst −${Jn}🔥`,p.title="Spend SISU to ignite a short-lived surge in allied attack and movement.",p.addEventListener("click",()=>{n.useSisuBurst?.(),C()}),p.classList.add("topbar-action"),u.appendChild(p)),n.torille&&(b=document.createElement("button"),b.type="button",b.classList.add("topbar-button","torille-button"),b.textContent=`Torille! −${Wn}🔥`,b.title="Call every surviving fighter back to the sauna to regroup.",b.addEventListener("click",()=>{n.torille?.(),C()}),b.classList.add("topbar-action"),u.appendChild(b));function C(){const P=e.getResource(k.SISU);if(p){const j=P>=Jn,K=Pr();p.disabled=!j||K;const _=["Spend SISU to ignite a short-lived surge in allied attack and movement."];j||_.push(`Requires ${Jn} SISU.`),K&&_.push("Burst already active."),p.title=_.join(" ")}if(b){const j=P>=Wn;b.disabled=!j,b.title=j?"Call every surviving fighter back to the sauna to regroup.":`Requires ${Wn} SISU to rally everyone home.`}}C();const S=document.createElement("button");S.type="button",S.title="Toggle sound",S.classList.add("topbar-button","sound-button");const F=document.createElement("span");if(F.textContent="Sound",t.sound){const P=document.createElement("img");P.src=t.sound,P.alt="",P.decoding="async",P.setAttribute("aria-hidden","true"),S.appendChild(P)}S.appendChild(F);function H(){const P=Za();F.textContent=P?"Muted":"Sound",S.setAttribute("aria-pressed",P?"true":"false"),S.classList.toggle("is-muted",P)}S.addEventListener("click",()=>{lu(!Za()),H()}),H(),S.classList.add("topbar-action","topbar-action--sound"),u.appendChild(S);const T=document.createElement("div");T.className="topbar-ambience";const Q=document.createElement("div");Q.className="topbar-ambience__header";const I=document.createElement("span");I.className="topbar-ambience__icon",I.textContent="🌲",I.setAttribute("aria-hidden","true");const B=document.createElement("span");B.className="topbar-ambience__title",B.textContent="Sauna ambience";const w=document.createElement("button");w.type="button",w.className="ambience-toggle",w.setAttribute("role","switch"),w.setAttribute("aria-label","Toggle sauna ambience soundscape");const v=document.createElement("span");v.className="ambience-toggle__track";const y=document.createElement("span");y.className="ambience-toggle__thumb";const M=document.createElement("span");M.className="ambience-toggle__label",w.append(v,y,M),Q.append(I,B,w);const x=document.createElement("div");x.className="topbar-ambience__slider";const O=document.createElement("span");O.className="topbar-ambience__caption",O.textContent="Volume";const N=document.createElement("span");N.className="topbar-ambience__value";const U=document.createElement("input");U.type="range",U.min="0",U.max="100",U.step="1",U.className="topbar-ambience__range",U.setAttribute("aria-label","Ambient volume"),x.append(O,U,N);const J=document.createElement("p");J.className="topbar-ambience__status",J.setAttribute("aria-live","polite"),T.append(Q,x,J),i.appendChild(T);const $=kr(P=>{P?(r.appendChild(u),u.classList.add("topbar-action-tray--mobile")):(i.appendChild(u),u.classList.remove("topbar-action-tray--mobile"))});let V=Gs();const ae=(P=V)=>{V=P;const j=Math.round(P.volume*100);U.value=String(j),U.title=`Ambient volume ${j}%`,U.style.setProperty("--value",`${j}`),N.textContent=`${j}%`,U.disabled=!P.enabled||P.globallyMuted,w.setAttribute("aria-checked",P.enabled?"true":"false"),w.classList.toggle("is-on",P.enabled),w.classList.toggle("is-muted",P.globallyMuted),M.textContent=P.enabled?"On":"Off",w.title=P.enabled?"Disable sauna ambience":"Enable sauna ambience",T.classList.toggle("is-off",!P.enabled),T.classList.toggle("is-globally-muted",P.globallyMuted),P.globallyMuted?J.textContent="Muted by master toggle":P.enabled?P.playing?J.textContent="Forest loop playing":J.textContent="Ambience ready":J.textContent="Ambience paused"};w.addEventListener("click",()=>{const P=!V.enabled;hc(P),V=Gs(),P&&!V.globallyMuted&&Dn(),ae(V)}),U.addEventListener("input",()=>{const P=U.valueAsNumber/100;Kd(P),V=Gs(),V.enabled&&!V.globallyMuted&&Dn(),ae(V)}),ae(V);const re=Vd(P=>{ae(P)});function W(P,j){const K=Math.max(0,Math.ceil(P));m.container.style.display="block",m.value.textContent=String(K),j?(m.delta.style.display="block",m.delta.textContent=j,m.container.title=`Sisu burst active: ${j}`):(m.delta.style.display="none",m.delta.textContent="",m.container.removeAttribute("title"));const _=[`Sisu burst active — ${K} seconds remaining`];j&&_.push(j),m.container.setAttribute("aria-label",_.join(" — "))}const ie=({remaining:P,status:j})=>{W(P,j),C()},me=({remaining:P,status:j})=>{W(P,j)},ve=()=>{m.container.style.display="none",m.value.textContent="0",m.delta.textContent="",m.delta.style.display="none",m.container.removeAttribute("title"),C()};R.on("sisuBurstStart",ie),R.on("sisuBurstTick",me),R.on("sisuBurstEnd",ve);const be=new Intl.NumberFormat("en-US"),et=new Intl.NumberFormat("en-US",{signDisplay:"exceptZero"}),Le={[k.SAUNA_BEER]:"Sauna Beer",[k.SAUNAKUNNIA]:"Saunakunnia",[k.SISU]:"Sisu"},At={[k.SAUNA_BEER]:{singular:"bottle",plural:"bottles"},[k.SAUNAKUNNIA]:{singular:"Saunakunnia",plural:"Saunakunnia"},[k.SISU]:{singular:"Sisu",plural:"Sisu"}},qe={[k.SAUNA_BEER]:"🍺",[k.SAUNAKUNNIA]:"⚜️",[k.SISU]:"🔥"},Qe={[k.SAUNA_BEER]:d,[k.SAUNAKUNNIA]:f,[k.SISU]:h},Pe={};let tt=null;function nt(P){if(tt=P,!P){g.value.textContent="Stage 1 · ×1.00",g.delta.textContent="",g.delta.style.display="none",g.container.dataset.state="idle",g.container.title="Enemy ramp idle",g.container.setAttribute("aria-label","Enemy ramp idle.");return}const j=P.stage||`Stage ${P.stageIndex+1}`,K=`×${P.multiplier.toFixed(2)}`,_=`${P.cadenceSeconds.toFixed(2)}s cadence`,ge=`×${P.effectiveDifficulty.toFixed(2)}`,pe=P.calmSecondsRemaining>.05,Ie=pe?`Calm remaining: ${Math.ceil(P.calmSecondsRemaining)}s`:"Calm inactive";g.value.textContent=`${j} · ${K}`,g.delta.style.display=pe?"":"none",g.delta.textContent=pe?`Calm ${Math.ceil(P.calmSecondsRemaining)}s`:"",g.container.dataset.state=pe?"calm":"active",g.container.title=[`Stage: ${j} (Tier ${P.bundleTier})`,`Cadence: ${_}`,`Multiplier: ${K}`,`Difficulty: ${ge}`,`Aggression ×${P.aggressionMultiplier.toFixed(2)} · Cadence ×${P.cadenceMultiplier.toFixed(2)} · Strength ×${P.strengthMultiplier.toFixed(2)}`,Ie,`Spawn cycles: ${P.spawnCycles}`].join(`
`),g.container.setAttribute("aria-label",[`Enemy ramp ${j}`,`Multiplier ${K}`,`Cadence ${P.cadenceSeconds.toFixed(2)} seconds`,`Difficulty ${ge}`,pe?`Calm remaining ${Math.ceil(P.calmSecondsRemaining)} seconds`:"Calm inactive"].join(" — "))}function Oe(P,j){const K=Number.isFinite(j)?j:0;return P===k.SAUNA_BEER?Math.trunc(K):Math.max(0,Math.round(K))}function vt(P,j){return be.format(Oe(P,j))}function st(P,j){return j===0?"":`${et.format(j)} ${qe[P]}`}function he(P,j){if(j===0)return"";const K=j>0?"gained":"spent",_=be.format(Math.abs(j)),ge=At[P];if(ge){const Ie=Math.abs(j)===1?ge.singular:ge.plural,Ye=Le[P],Ke=[Ye];Ie&&Ie!==Ye&&Ke.push(Ie);const je=Ke.filter(Boolean).join(" ");return`${K} ${_}${je?` ${je}`:""}`}const pe=Le[P];return`${K} ${_}${pe?` ${pe}`:""}`}function we(P,j,K=0){const _=Qe[P];if(!_)return;const ge=Oe(P,j),pe=vt(P,j);_.value.textContent=pe;const Ie=P===k.SAUNA_BEER&&ge<0;if(_.container.classList.toggle("topbar-badge--debt",Ie),K!==0){_.delta.textContent=st(P,K),_.delta.style.opacity="1",_.delta.style.transform="translateY(0)";const je=Pe[P];je&&clearTimeout(je),Pe[P]=setTimeout(()=>{_.delta.style.opacity="0",_.delta.style.transform="translateY(-6px)",delete Pe[P]},1e3)}else _.delta.textContent="",_.delta.style.opacity="0",_.delta.style.transform="translateY(-6px)";const Ye=he(P,K),Ke=[`${_.label} ${pe}`];if(Ie){const je=be.format(Math.abs(ge)),rn=At[P];if(rn){const Yt=Math.abs(ge)===1?rn.singular:rn.plural,L=Yt&&Yt!==Le[P];Ke.push(L?`Debt of ${je} ${Yt}`:`Debt of ${je}`)}else Ke.push(`Debt of ${je}`)}Ye&&Ke.push(Ye),_.container.setAttribute("aria-label",Ke.join(" — "))}we(k.SAUNA_BEER,e.getResource(k.SAUNA_BEER)),we(k.SAUNAKUNNIA,e.getResource(k.SAUNAKUNNIA)),we(k.SISU,e.getResource(k.SISU)),nt(tt);const qt=({resource:P,amount:j,total:K})=>{Qe[P]&&(we(P,K,j),P===k.SISU&&C())};R.on("resourceChanged",qt);let at=0;return{update(P){at+=P;const j=Math.floor(at/1e3),K=Math.floor(j/60),_=j%60;A.value.textContent=`${K}:${_.toString().padStart(2,"0")}`},setEnemyRampSummary(P){nt(P)},dispose(){R.off("sisuBurstStart",ie),R.off("sisuBurstTick",me),R.off("sisuBurstEnd",ve),R.off("resourceChanged",qt),Object.values(Pe).forEach(P=>{P&&clearTimeout(P)}),re(),$(),u.remove(),i.remove()}}}function ch(e){const t=[e.name];return e.description&&t.push(e.description),e.rarity&&t.push(`Rarity: ${e.rarity}`),e.quantity>1&&t.push(`Quantity: ${e.quantity}`),t.join(" — ")}function lh(e){const t=document.createElement("span");t.classList.add("item-icon__fallback");const n=e.trim();return t.textContent=n?n[0]?.toUpperCase()??"?":"?",t.setAttribute("aria-hidden","true"),t}function uh(e,t){const n=document.createElement("img");return n.src=e,n.alt="",n.decoding="async",n.loading="lazy",n.classList.add("item-icon__image"),n.setAttribute("aria-hidden","true"),n.title=t,n}function dh(e){const t=document.createElement("li");t.classList.add("item-icon"),t.dataset.itemId=e.id;const n=ch(e);if(t.title=n,t.setAttribute("aria-label",n),t.setAttribute("role","listitem"),e.rarity&&(t.dataset.rarity=e.rarity.toLowerCase()),e.icon&&e.icon.trim().length>0?t.appendChild(uh(e.icon,e.name)):t.appendChild(lh(e.name)),e.quantity>1){const s=document.createElement("span");s.classList.add("item-icon__quantity"),s.textContent=`×${e.quantity}`,s.setAttribute("aria-hidden","true"),t.appendChild(s)}return t}const hh=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function rr(e){return e===1/0?"∞":!Number.isFinite(e)||e<=0?"0s":`${hh.format(Math.ceil(e))}s`}function fh(e){const t=[e.name];return e.description&&t.push(e.description),e.source&&t.push(`Source: ${e.source}`),e.duration!==1/0&&t.push(`Duration: ${rr(e.duration)}`),t.push(`Remaining: ${rr(e.remaining)}`),e.stacks&&e.stacks>1&&t.push(`Stacks: ${e.stacks}`),t.join(" — ")}function mh(e){const t=document.createElement("li");t.classList.add("mod-pill"),t.dataset.modifierId=e.id,t.title=fh(e),t.setAttribute("aria-label",t.title),t.setAttribute("role","listitem"),t.dataset.duration=e.duration===1/0?"infinite":String(e.duration),t.dataset.remaining=e.remaining===1/0?"infinite":String(e.remaining),e.appliedAt!==void 0&&(t.dataset.appliedAt=String(e.appliedAt)),e.stacks&&e.stacks>1&&(t.dataset.stacks=String(e.stacks));const n=document.createElement("span");if(n.classList.add("mod-pill__name"),n.textContent=e.name,n.setAttribute("aria-hidden","true"),t.appendChild(n),e.stacks&&e.stacks>1){const a=document.createElement("span");a.classList.add("mod-pill__stacks"),a.textContent=`×${e.stacks}`,a.setAttribute("aria-hidden","true"),t.appendChild(a)}const s=document.createElement("span");return s.classList.add("mod-pill__timer"),s.textContent=rr(e.remaining),s.setAttribute("aria-hidden","true"),t.appendChild(s),e.remaining!==1/0&&e.remaining<=5&&(t.dataset.urgent="true"),t}const or={engaged:"Engaged on the field",reserve:"On reserve duty",downed:"Recovering from battle"},se=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Fo="panel-roster-title";function gh(e){return e.length===0?"No defining traits yet":e.join(" • ")}function pc(e){return Number.isFinite(e)?Math.max(0,Math.min(100,Math.round(e*100))):0}function ph(e){const t=se;if(e.xpForNext===null)return`${t.format(e.xp)} XP • Max level`;const n=pc(e.progress);return`${t.format(e.xpIntoLevel)} / ${t.format(e.xpForNext)} XP • ${n}%`}function Ac(e){const t=[],n=(s,a)=>{a>0&&t.push(`+${se.format(a)} ${s}`)};return n("Vigor",e.vigor),n("Focus",e.focus),n("Resolve",e.resolve),t.length===0?"No level bonuses yet":t.join(" • ")}function hn(e,t){const s=Math.round(e-(typeof t=="number"?t:0));if(s===0)return"";const a=se.format(Math.abs(s));return s>0?` (+${a})`:` (-${a})`}function Ah(e){if(!e)return"No stat changes";const t=[],n=(s,a)=>{if(typeof a=="number"&&a!==0){const r=a>0?"+":"−";t.push(`${s} ${r}${se.format(Math.abs(a))}`)}};return n("HP",e.health),n("ATK",e.attackDamage),n("RNG",e.attackRange),n("MOV",e.movementRange),n("DEF",e.defense),n("Shield",e.shield),t.length===0?"No stat changes":t.join(", ")}function vh(e){const{stats:t,baseStats:n}=e,s=[`HP ${se.format(t.health)}/${se.format(t.maxHealth)}${hn(t.maxHealth,n.maxHealth)}`];return t.shield&&t.shield>0&&s.push(`Shield ${se.format(t.shield)}${hn(t.shield,n.shield)}`),s.push(`ATK ${se.format(t.attackDamage)}${hn(t.attackDamage,n.attackDamage)}`),s.push(`RNG ${se.format(t.attackRange)}${hn(t.attackRange,n.attackRange)}`),t.defense&&t.defense>0&&s.push(`DEF ${se.format(t.defense)}${hn(t.defense,n.defense)}`),s.push(`MOV ${se.format(t.movementRange)}${hn(t.movementRange,n.movementRange)}`),s.push(`Upkeep ${se.format(e.upkeep)} beer`),s.join(" • ")}function bh(e){const{stats:t}=e,n=[e.name,or[e.status]];n.push(`level ${e.progression.level}`),n.push(`health ${se.format(t.health)} of ${se.format(t.maxHealth)}`),t.shield&&t.shield>0&&n.push(`shield ${se.format(t.shield)}`),n.push(`attack ${se.format(t.attackDamage)}`),t.defense&&t.defense>0&&n.push(`defense ${se.format(t.defense)}`),t.attackRange>0&&n.push(`attack range ${se.format(t.attackRange)}`),n.push(`movement ${se.format(t.movementRange)}`),n.push(`upkeep ${se.format(e.upkeep)} beer`),e.progression.xpForNext===null?n.push(`${se.format(e.progression.xp)} total experience`):n.push(`${se.format(e.progression.xpIntoLevel)} of ${se.format(e.progression.xpForNext)} experience toward next level`);const s=Ac(e.progression.statBonuses);s&&n.push(`level bonuses ${s}`);const a=e.equipment.filter(r=>r.item).length;return a>0&&n.push(`${a} equipped item${a===1?"":"s"}`),e.modifiers.length>0&&n.push(`${e.modifiers.length} active modifier${e.modifiers.length===1?"":"s"}`),n.join(", ")}function wh(e,t){const n=t.filter(i=>i.status==="engaged").length,s=t.filter(i=>i.status==="reserve").length,a=t.filter(i=>i.status==="downed").length,r=(i,c,u)=>{const l=document.createElement("span");return l.classList.add("panel-roster__metric"),l.dataset.status=u,l.textContent=`${se.format(c)} ${i}`,l.setAttribute("aria-label",l.textContent),l},o=document.createElement("div");o.classList.add("panel-roster__metrics"),o.append(r("engaged",n,"engaged"),r("reserve",s,"reserve"),r("downed",a,"downed")),e.appendChild(o)}function yh(e,t,n){const s=document.createElement("div");s.classList.add("panel-roster__loadout");const a=document.createElement("ul");a.classList.add("panel-roster__slots"),a.setAttribute("role","list"),a.setAttribute("aria-label",`${t.name} equipment slots`);for(const r of t.equipment){const o=document.createElement("li");o.classList.add("panel-roster__slot"),o.dataset.slot=r.id;const i=document.createElement("div");i.classList.add("panel-roster__slot-header");const c=document.createElement("span");c.classList.add("panel-roster__slot-label"),c.textContent=r.label,c.title=r.description,i.appendChild(c);const u=document.createElement("span");if(u.classList.add("panel-roster__slot-summary"),u.textContent=r.item?r.item.name:"Empty",u.title=r.description,i.appendChild(u),o.appendChild(i),r.item){const m=document.createElement("ul");m.classList.add("panel-roster__slot-icons"),m.setAttribute("role","list"),m.appendChild(dh(r.item)),o.appendChild(m)}const l=document.createElement("span");l.classList.add("panel-roster__slot-modifiers"),l.textContent=Ah(r.modifiers),l.title=l.textContent,o.appendChild(l);const d=document.createElement("div");d.classList.add("panel-roster__slot-actions");const h=document.createElement("button");h.type="button",h.classList.add("panel-roster__slot-action"),h.textContent=r.item?"Replace":"Equip",h.setAttribute("aria-label",`Equip ${r.label} for ${t.name}`),h.addEventListener("click",m=>{m.stopPropagation(),n.onEquipSlot?.(t.id,r.id)}),d.appendChild(h);const f=document.createElement("button");f.type="button",f.classList.add("panel-roster__slot-action"),f.textContent="Unequip",f.disabled=r.item===null,f.setAttribute("aria-label",`Unequip ${r.label} from ${t.name}`),f.addEventListener("click",m=>{m.stopPropagation(),f.disabled||n.onUnequipSlot?.(t.id,r.id)}),d.appendChild(f),o.appendChild(d),a.appendChild(o)}if(s.appendChild(a),t.modifiers.length>0){const r=document.createElement("ul");r.classList.add("panel-roster__mods"),r.setAttribute("role","list"),r.setAttribute("aria-label",`${t.name} active modifiers`),r.title=t.modifiers.map(o=>o.name).join(", ");for(const o of t.modifiers)r.appendChild(mh(o));s.appendChild(r)}e.appendChild(s)}function Eh(e,t={}){return{render:s=>{e.innerHTML="",e.dataset.count=String(s.length),e.classList.add("panel-roster");const a=document.createElement("div");a.classList.add("panel-roster__header");const r=document.createElement("h4");r.classList.add("panel-roster__title"),r.textContent="Battalion Roster",r.id=Fo,a.appendChild(r),e.setAttribute("aria-labelledby",Fo);const o=s.length===0?"No attendants mustered yet":`${se.format(s.length)} attendant${s.length===1?"":"s"} enlisted`,i=document.createElement("span");if(i.classList.add("panel-roster__count"),i.textContent=o,a.appendChild(i),e.appendChild(a),s.length===0){const u=document.createElement("p");u.classList.add("panel-roster__empty"),u.textContent="No attendants have rallied to the sauna yet.",e.appendChild(u);return}wh(e,s);const c=document.createElement("ul");c.classList.add("panel-roster__list"),c.setAttribute("role","list");for(const u of s){const l=document.createElement("li");l.classList.add("panel-roster__row");const d=document.createElement("button");d.type="button",d.classList.add("panel-roster__item"),d.dataset.unitId=u.id,d.dataset.status=u.status,d.setAttribute("aria-pressed",u.selected?"true":"false"),d.setAttribute("aria-label",bh(u)),d.title=`${u.name} • ${or[u.status]}`,u.selected&&d.classList.add("is-selected"),u.status==="downed"&&d.classList.add("is-downed");const h=document.createElement("div");h.classList.add("panel-roster__name-row");const f=document.createElement("div");f.classList.add("panel-roster__identity");const m=document.createElement("span");m.classList.add("panel-roster__level"),m.dataset.level=String(u.progression.level),m.style.setProperty("--level-progress","0%");const A=pc(u.progression.progress);m.style.setProperty("--level-progress",`${A}%`),m.setAttribute("role","img");const g=u.progression.xpForNext===null?`Level ${u.progression.level}, at mastery`:`Level ${u.progression.level}, ${A}% toward next level`;m.setAttribute("aria-label",g);const p=document.createElement("span");p.classList.add("panel-roster__level-value"),p.textContent=String(u.progression.level),m.appendChild(p);const b=document.createElement("span");b.classList.add("panel-roster__name"),b.textContent=u.name,b.title=u.name,f.append(m,b),h.appendChild(f);const C=document.createElement("span");C.classList.add("panel-roster__status"),C.dataset.status=u.status,C.textContent=or[u.status],h.appendChild(C);const S=document.createElement("div");S.classList.add("panel-roster__meta");const F=vh(u);S.textContent=F,S.title=F;const H=document.createElement("div");H.classList.add("panel-roster__xp");const T=ph(u.progression);H.textContent=T,H.title=T;const Q=document.createElement("div");Q.classList.add("panel-roster__callouts");const I=Ac(u.progression.statBonuses);Q.textContent=I,Q.title=I;const B=document.createElement("div");B.classList.add("panel-roster__health");const w=document.createElement("div");w.classList.add("panel-roster__health-fill");const v=u.stats.maxHealth>0?Math.max(0,Math.min(100,Math.round(u.stats.health/u.stats.maxHealth*100))):0;w.style.width=`${v}%`,w.dataset.percent=`${v}`,B.appendChild(w);const y=document.createElement("div");y.classList.add("panel-roster__traits");const M=gh(u.traits);y.textContent=M,y.title=M,d.append(h,H,S,Q,B,y),yh(d,u,t),typeof t.onSelect=="function"&&d.addEventListener("click",()=>t.onSelect?.(u.id)),l.appendChild(d),c.appendChild(l)}e.appendChild(c)}}}const Lo=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Sh(e,t={}){const n=document.getElementById("ui-overlay");if(!n)return{log:()=>{},addEvent:()=>{},renderRoster:()=>{},dispose:()=>{}};const{regions:s,mobileBar:a}=us(n),r=s.top,o=s.right,i=n.querySelector("#right-panel");i&&i.remove();const c=n.querySelector(".right-panel-slide");c&&c.remove();const u=n.querySelector("#right-panel-toggle");u&&u.remove();const l=document.createElement("div");l.id="right-panel",l.classList.add("hud-card"),l.setAttribute("role","complementary"),l.setAttribute("aria-label","Sauna command console"),l.tabIndex=-1;const d=document.createElement("div");d.className="right-panel-slide",d.setAttribute("aria-hidden","true");const h=document.createElement("div");h.className="right-panel-slide__backdrop",h.setAttribute("aria-hidden","true");const f=document.createElement("div");f.className="right-panel-slide__sheet",f.appendChild(l),d.append(h,f);const m=window.matchMedia("(max-width: 1040px)"),A=[],g=document.createElement("button");g.type="button",g.id="right-panel-toggle",g.classList.add("hud-panel-toggle"),g.setAttribute("aria-controls",l.id);const p=document.createElement("span");p.classList.add("hud-panel-toggle__icon"),p.setAttribute("aria-hidden","true");const b=document.createElement("span");b.classList.add("hud-panel-toggle__icon-bars"),p.appendChild(b);const C=document.createElement("span");C.classList.add("hud-panel-toggle__text");const S=document.createElement("span");S.classList.add("hud-panel-toggle__title"),S.textContent="Command Console";const F=document.createElement("span");F.classList.add("hud-panel-toggle__state"),C.append(S,F),g.append(p,C);const H=()=>{const E=r.querySelector("#topbar");E&&E.parentElement===r?E.insertAdjacentElement("afterend",g):r.prepend(g)};let T=!1,Q=!1,I=!1,B=!1;const w="is-mobile-panel-open",v=()=>{I?F.textContent=B?"Close":"Menu":F.textContent=T?"Open":"Close"},y=()=>{if(I){g.setAttribute("aria-expanded",B?"true":"false");const E=B?"Close command console panel":"Open command console panel";g.setAttribute("aria-label",E),g.title=B?"Close the sauna command console overlay":"Open the sauna command console overlay"}else{g.setAttribute("aria-expanded",T?"false":"true");const E=T?"Open command console panel":"Close command console panel";g.setAttribute("aria-label",E),g.title=T?"Open the sauna command console overlay":"Close the sauna command console overlay"}},M=()=>{v(),y()},x=(E,D=m.matches)=>{if(I)return;const G=T;D&&(Q=E);const Y=E&&D;T=Y,l.classList.toggle("right-panel--collapsed",Y),l.setAttribute("aria-hidden",Y?"true":"false"),M(),G&&!Y&&D&&l.focus({preventScroll:!0})},O=E=>{!I||!B||E.key==="Escape"&&(E.preventDefault(),V())};let N=!1;const U=()=>{N||(document.addEventListener("keydown",O),N=!0)},J=()=>{N&&(document.removeEventListener("keydown",O),N=!1)},$=()=>{!I||B||(B=!0,d.classList.add("right-panel-slide--open"),d.setAttribute("aria-hidden","false"),l.setAttribute("aria-hidden","false"),document.body.classList.add(w),d.style.setProperty("--panel-drag-progress","1"),M(),U(),requestAnimationFrame(()=>{l.focus({preventScroll:!0})}))},V=({skipFocus:E=!1}={})=>{!I||!B||(be(),B=!1,d.classList.remove("right-panel-slide--open"),d.setAttribute("aria-hidden","true"),l.setAttribute("aria-hidden","true"),document.body.classList.remove(w),d.style.setProperty("--panel-drag-progress","0"),M(),J(),E||g.focus({preventScroll:!0}))},ae=E=>{if(I)return;const D=E.matches;g.hidden=!D,x(D?Q:!1,D)};typeof m.addEventListener=="function"?(m.addEventListener("change",ae),A.push(()=>m.removeEventListener("change",ae))):(m.addListener(ae),A.push(()=>m.removeListener(ae)));const re=()=>{if(I){B?V():$();return}x(!T)};g.addEventListener("click",re),A.push(()=>g.removeEventListener("click",re));const W=()=>{V()};h.addEventListener("click",W),A.push(()=>h.removeEventListener("click",W));let ie=null,me=0,ve=0;const be=()=>{ie!==null&&(f.releasePointerCapture(ie),ie=null),f.style.transition="",f.style.transform="",d.style.setProperty("--panel-drag-progress",B?"1":"0")},et=E=>{!I||!B||E.pointerType==="mouse"&&E.button!==0||(ie=E.pointerId,me=E.clientX,ve=0,f.style.transition="none",f.setPointerCapture(E.pointerId))},Le=E=>{if(!I||E.pointerId!==ie||!B)return;ve=Math.max(0,E.clientX-me);const D=f.offsetWidth||1,G=Math.min(ve,D);f.style.transform=`translateX(${G}px)`,d.style.setProperty("--panel-drag-progress",String(1-G/D))},At=E=>{be(),E&&V()},qe=E=>{if(E.pointerId!==ie)return;const D=f.offsetWidth||1,G=ve>D*.35;At(G)},Qe=()=>{At(!1)};f.addEventListener("pointerdown",et),f.addEventListener("pointermove",Le),f.addEventListener("pointerup",qe),f.addEventListener("pointercancel",Qe),A.push(()=>{f.removeEventListener("pointerdown",et),f.removeEventListener("pointermove",Le),f.removeEventListener("pointerup",qe),f.removeEventListener("pointercancel",Qe)});const Pe=kr(E=>{I=E,I?(f.appendChild(l),d.isConnected||n.appendChild(d),a.appendChild(g),g.classList.add("hud-panel-toggle--mobile"),g.hidden=!1,B||(l.setAttribute("aria-hidden","true"),d.setAttribute("aria-hidden","true"),d.style.setProperty("--panel-drag-progress","0"))):(V({skipFocus:!0}),d.style.setProperty("--panel-drag-progress","1"),d.remove(),o.appendChild(l),H(),g.classList.remove("hud-panel-toggle--mobile"),g.hidden=!m.matches,l.setAttribute("aria-hidden","false"),x(Q,m.matches)),M()});A.push(Pe);const tt=document.createElement("div");tt.classList.add("panel-tabs"),l.appendChild(tt);const nt=document.createElement("div");nt.classList.add("panel-content"),l.appendChild(nt);const Oe=document.createElement("div");Oe.id="right-panel-roster",Oe.setAttribute("role","region"),Oe.setAttribute("aria-live","polite"),Oe.setAttribute("aria-label","Battalion roster");const vt=document.createElement("div");vt.id="right-panel-policies";const st=document.createElement("div");st.id="right-panel-events";const he=document.createElement("div");he.id="event-log",he.setAttribute("role","log"),he.setAttribute("aria-live","polite");const we={Roster:Oe,Policies:vt,Events:st,Log:he},{onRosterSelect:qt,onRosterRendererReady:at,onRosterEquipSlot:P,onRosterUnequipSlot:j}=t;for(const[E,D]of Object.entries(we))D.classList.add("panel-section","panel-section--scroll"),D.dataset.tab=E,D.hidden=!0;he.classList.add("panel-section--log");function K(E){for(const[D,G]of Object.entries(we))G.hidden=D!==E;for(const D of Array.from(tt.children)){const G=D,Y=G.textContent===E;G.disabled=Y,G.setAttribute("aria-pressed",Y?"true":"false")}}for(const E of Object.keys(we)){const D=document.createElement("button");D.type="button",D.textContent=E;const G=we[E];G?.id&&D.setAttribute("aria-controls",G.id),D.setAttribute("aria-pressed","false");const Y=()=>K(E);D.addEventListener("click",Y),A.push(()=>D.removeEventListener("click",Y)),tt.appendChild(D),nt.appendChild(we[E])}const _=Eh(Oe,{onSelect:qt,onEquipSlot:P,onUnequipSlot:j}),ge=E=>{_.render(E)};ge([]),typeof at=="function"&&at(ge);const pe={[k.SAUNA_BEER]:"Sauna Beer Bottles",[k.SAUNAKUNNIA]:"Saunakunnia",[k.SISU]:"Sisu"},Ie=Bi(),Ye=new Map;function Ke(E){const D=document.createElement("span");return D.className="policy-card__badge",D.textContent=E,D}function je(E){const D=document.createElement("article");D.className="policy-card",D.style.setProperty("--policy-gradient",E.visuals.gradient),D.style.setProperty("--policy-accent",E.visuals.accentColor);const G=document.createElement("div");G.className="policy-card__header";const Y=document.createElement("div");Y.className="policy-card__icon-frame";const ye=document.createElement("img");ye.className="policy-card__icon",ye.src=E.visuals.icon,ye.alt=`${E.name} icon`,Y.appendChild(ye);const Ue=document.createElement("div");Ue.className="policy-card__heading";const Ne=document.createElement("h4");if(Ne.className="policy-card__title",Ne.textContent=E.name,Ue.appendChild(Ne),E.visuals.badges?.length){const Zt=document.createElement("div");Zt.className="policy-card__badges",E.visuals.badges.forEach(El=>Zt.appendChild(Ke(El))),Ue.appendChild(Zt)}const Ee=document.createElement("span");Ee.className="policy-card__state",Ee.textContent="Ready",G.append(Y,Ue,Ee);const wt=document.createElement("p");wt.className="policy-card__description",wt.textContent=E.description;const ot=E.visuals.flair?(()=>{const Zt=document.createElement("p");return Zt.className="policy-card__flair",Zt.textContent=E.visuals.flair??"",Zt})():null,it=document.createElement("div");it.className="policy-card__actions";const Lt=document.createElement("span");Lt.className="policy-card__cost";const Hn=document.createElement("span");Hn.className="policy-card__cost-label",Hn.textContent="Cost";const cn=document.createElement("span");cn.className="policy-card__cost-value",cn.textContent=`${Lo.format(E.cost)} ${pe[E.resource]}`,Lt.append(Hn,cn);const fe=document.createElement("button");fe.type="button",fe.className="policy-card__action",fe.textContent="Enact Policy";const Fn=document.createElement("p");Fn.className="policy-card__status";const fs=document.createElement("ul");fs.className="policy-card__requirements",fs.hidden=!0,it.append(Lt,fe);const Yr=()=>{e.applyPolicy(E.id)&&Yt(E)};return fe.addEventListener("click",Yr),A.push(()=>fe.removeEventListener("click",Yr)),D.append(G,wt),ot&&D.appendChild(ot),D.append(it,Fn,fs),Ye.set(E.id,{card:D,action:fe,stateBadge:Ee,statusCopy:Fn,requirements:fs,costChip:Lt}),D}function rn(){vt.innerHTML="",Ye.clear();const E=document.createElement("div");E.className="policy-grid",Ie.forEach(D=>{const G=je(D);E.appendChild(G)}),vt.appendChild(E),L()}function Yt(E){const D=Ye.get(E.id);if(!D)return;const G=e.hasPolicy(E.id),Y=E.prerequisites.filter(ot=>!ot.isSatisfied(e)),ye=e.canAfford(E.cost,E.resource);D.action.disabled=G||Y.length>0||!ye,D.action.textContent=G?"Enacted":"Enact Policy";let Ue="ready",Ne="Ready",Ee=E.spotlight??"All signals point to go.";D.requirements.innerHTML="",D.requirements.hidden=!0,G?(Ue="applied",Ne="Enacted",Ee=E.visuals.flair??"Policy active."):Y.length>0?(Ue="locked",Ne="Locked",Ee="Awaiting requirements:",D.requirements.hidden=!1,Y.forEach(ot=>{const it=document.createElement("li");it.textContent=ot.description,D.requirements.appendChild(it)})):ye||(Ue="budget",Ne="Needs Resources",Ee=`Earn ${Lo.format(E.cost)} ${pe[E.resource]} to enact this edict.`),D.card.dataset.status=Ue,D.stateBadge.textContent=Ne,D.statusCopy.textContent=Ee;const wt=!G&&Y.length===0&&!ye;D.costChip.classList.toggle("policy-card__cost--warning",wt)}function L(){Ie.forEach(E=>Yt(E))}rn();const q=E=>L(),z=E=>L(),Z=E=>L();R.on("resourceChanged",q),R.on(De.APPLIED,z),R.on(De.REJECTED,Z),A.push(()=>{R.off("resourceChanged",q),R.off(De.APPLIED,z),R.off(De.REJECTED,Z)});function ke(E,D){const G=document.createElement("button");G.type="button",G.classList.add("event-card__choice"),D.accent&&G.classList.add(`event-card__choice--${D.accent}`),G.dataset.choiceId=D.id;const Y=document.createElement("span");if(Y.className="event-card__choice-label",Y.textContent=D.label,G.appendChild(Y),D.description){const ye=document.createElement("span");ye.className="event-card__choice-detail",ye.textContent=D.description,G.appendChild(ye)}return G.addEventListener("click",()=>{if(!G.isConnected)return;G.disabled=!0,Qs.resolve(E.id,D.id)||(G.disabled=!1)}),G}function Te(E){if(st.innerHTML="",E.length===0){const G=document.createElement("div");G.className="event-card event-card--empty";const Y=document.createElement("p");Y.className="event-card__empty",Y.textContent="All clear. Command will notify you when new briefings arrive.",G.appendChild(Y),st.appendChild(G);return}const D=document.createDocumentFragment();for(const G of E){const Y=document.createElement("article");Y.className="event-card",Y.dataset.eventId=G.id,Y.style.setProperty("--event-accent",G.accentColor??"var(--color-accent)");const ye=(G.typography??"sans").toLowerCase();Y.classList.add(`event-card--${["serif","mono"].includes(ye)?ye:"sans"}`);const Ue=(G.animation??"").toLowerCase();["aurora","pulse","tilt"].includes(Ue)&&Y.classList.add(`event-card--${Ue}`);const Ne=document.createElement("div");if(Ne.className="event-card__frame",G.art){const fe=document.createElement("div");fe.className="event-card__media",fe.style.backgroundImage=`url(${G.art})`,Ne.appendChild(fe)}const Ee=document.createElement("div");Ee.className="event-card__body";const wt=document.createElement("span");wt.className="event-card__badge",wt.textContent="Priority Dispatch",Ee.appendChild(wt);const ot=document.createElement("h4");ot.className="event-card__headline",ot.textContent=G.headline,Ee.appendChild(ot);const it=document.createElement("p");it.className="event-card__copy",it.textContent=G.body,Ee.appendChild(it);const Lt=document.createElement("div");Lt.className="event-card__choices";const Hn=G.choices&&G.choices.length>0?G.choices:[{id:"acknowledge",label:G.acknowledgeText??"Acknowledge"}];for(const fe of Hn){const Fn=ke(G,{id:fe.id,label:fe.label,description:fe.description,event:fe.event,payload:fe.payload,accent:fe.accent});Lt.appendChild(Fn)}Ee.appendChild(Lt),Ne.appendChild(Ee);const cn=document.createElement("span");cn.className="event-card__shimmer",Y.append(Ne,cn),D.appendChild(Y)}st.appendChild(D)}const Ft=Qs.subscribe(Te);A.push(Ft);const Kt=({event:E})=>{qr(`Event • ${E.headline}`)};R.on(Xs.TRIGGERED,Kt),A.push(()=>{R.off(Xs.TRIGGERED,Kt)});function Tn(E){Qs.publish(E)}const on="autobattles:panel-log",rt=100,bt=[];let wa=!1;const Vt=[],wl=()=>{if(typeof window>"u"||typeof window.localStorage>"u")return[];try{const E=window.localStorage.getItem(on);if(!E)return[];const D=JSON.parse(E);if(!Array.isArray(D))return[];const G=D.filter(Y=>typeof Y=="string");return G.length>rt?G.slice(-rt):G}catch{return[]}},zr=E=>{if(!(typeof window>"u"||typeof window.localStorage>"u"))try{const D=E.length>rt?E.slice(-rt):E;window.localStorage.setItem(on,JSON.stringify(D))}catch{}},Xr=E=>{const D=document.createElement("div");D.textContent=E,D.classList.add("panel-log-entry"),he.appendChild(D)};(()=>{const E=wl();if(E.length!==0){for(const D of E)Xr(D),Vt.push(D);he.scrollTop=he.scrollHeight}})();function yl(){for(const E of bt)Xr(E);if(bt.length>0&&(Vt.push(...bt),Vt.length>rt)){const E=Vt.length-rt;Vt.splice(0,E);for(let D=0;D<E;D+=1)he.firstChild&&he.removeChild(he.firstChild)}he.scrollTop=he.scrollHeight,bt.length=0,wa=!1,Vt.length>0?zr(Vt):zr([])}function qr(E){bt.push(E),wa||(wa=!0,(typeof requestAnimationFrame=="function"?requestAnimationFrame:D=>setTimeout(D,16))(yl))}return K("Roster"),{log:qr,addEvent:Tn,renderRoster:ge,dispose:()=>{for(const E of A.splice(0))try{E()}catch(D){console.warn("Failed to dispose HUD listener",D)}J(),be(),document.body.classList.remove(w),d.remove(),g.remove(),l.remove()}}}const Ch=e=>`[data-tutorial-target="${e}"]`,ct=16,Bs=12,Qo="is-tutorial-highlighted",xh=[{id:"heat",target:"heat",title:"Heat the Sauna",description:"Keep the sauna fires roaring. This control shows when the next warrior emerges from the steam."},{id:"upkeep",target:"upkeep",title:"Mind Your Upkeep",description:"Every attendant draws upkeep. Track totals and see a featured roster member to balance your economy."},{id:"sisu",target:"sisu",title:"Stockpile SISU",description:"SISU fuels heroic bursts. Watch this meter to know when your grit reserves can power signature moves."},{id:"combat",target:"combat",title:"Command the Fight",description:"Trigger a Sisu Burst to supercharge allied attacks or rally everyone home with a Torille call."},{id:"victory",target:"victory",title:"Claim Victory",description:"Saunakunnia measures renown. Push it ever higher to unlock triumphs and close the campaign in glory."}];function Bh(e,t,n){return Math.max(t,Math.min(n,e))}function Ph(e={}){const t=e.steps??xh;if(t.length===0)throw new Error("Tutorial requires at least one step.");let n=-1,s=null,a=!1;const r=document.createElement("div");r.className="tutorial-overlay";const o=document.createElement("div");o.className="tutorial-overlay__spotlight",o.setAttribute("aria-hidden","true");const i=document.createElement("section");i.className="tutorial-card",i.setAttribute("role","dialog"),i.setAttribute("aria-modal","false"),i.tabIndex=-1;const c=document.createElement("header");c.className="tutorial-card__header";const u=document.createElement("h2");u.className="tutorial-card__title";const l=document.createElement("button");l.type="button",l.className="tutorial-card__close",l.setAttribute("aria-label","Dismiss tutorial"),l.textContent="×",c.append(u,l);const d=document.createElement("p");d.className="tutorial-card__description";const h=document.createElement("p");h.className="tutorial-card__progress";const f=document.createElement("div");f.className="tutorial-card__controls";const m=document.createElement("button");m.type="button",m.className="tutorial-card__button tutorial-card__button--secondary",m.textContent="Back";const A=document.createElement("button");A.type="button",A.className="tutorial-card__button",A.textContent="Next";const g=document.createElement("button");g.type="button",g.className="tutorial-card__skip",g.textContent="Skip tutorial",f.append(m,A),i.append(c,d,h,f,g),r.append(o,i);const p=typeof ResizeObserver<"u"?new ResizeObserver(()=>{n>=0&&T()}):null,b=()=>{n>=0&&T()};function C(){a||(document.body.appendChild(r),window.addEventListener("resize",T),document.addEventListener("scroll",b,!0),p?.observe(i),a=!0)}function S(){a&&(window.removeEventListener("resize",T),document.removeEventListener("scroll",b,!0),p?.disconnect(),r.remove(),a=!1)}function F(x){if(s&&s!==x&&(s.classList.remove(Qo),s.removeAttribute("data-tutorial-highlight")),s=x,!x){o.style.opacity="0";return}x.classList.add(Qo),x.setAttribute("data-tutorial-highlight","true"),o.style.opacity="1"}function H(){if(!s)return null;const x=s.getBoundingClientRect();return x.width===0&&x.height===0?null:{top:x.top,left:x.left,width:x.width,height:x.height}}function T(){const x=H();if(!x){i.style.top=`${ct}px`,i.style.left=`${ct}px`,i.classList.add("tutorial-card--floating"),o.style.opacity="0";return}i.classList.remove("tutorial-card--floating"),o.style.opacity="1";const O=x.top-Bs,N=x.left-Bs,U=x.width+Bs*2,J=x.height+Bs*2;o.style.top=`${O}px`,o.style.left=`${N}px`,o.style.width=`${U}px`,o.style.height=`${J}px`;const $=i.getBoundingClientRect();let ae=window.innerHeight-x.top-x.height>=x.top?x.top+x.height+ct:x.top-$.height-ct;ae<ct?ae=ct:ae+$.height>window.innerHeight-ct&&(ae=window.innerHeight-ct-$.height);let W=x.left+x.width/2-$.width/2;W=Bh(W,ct,window.innerWidth-$.width-ct),i.style.top=`${Math.round(ae)}px`,i.style.left=`${Math.round(W)}px`}function Q(){requestAnimationFrame(()=>{i.focus({preventScroll:!0})})}function I(x){if(x<0||x>=t.length)return;C(),n=x;const O=t[x];u.textContent=O.title,d.textContent=O.description,h.textContent=`Step ${x+1} of ${t.length}`,m.disabled=x===0,A.textContent=x===t.length-1?"Finish":"Next";const N=document.querySelector(Ch(O.target));F(N??null),T(),Q()}function B(){if(n===-1){I(0);return}if(n>=t.length-1){M();return}I(n+1)}function w(){n<=0||I(n-1)}function v(){F(null),S(),n=-1}function y(){e.onSkip?.(),v()}function M(){e.onComplete?.(),v()}return m.addEventListener("click",()=>{w()}),A.addEventListener("click",()=>{B()}),g.addEventListener("click",()=>{y()}),l.addEventListener("click",()=>{y()}),i.addEventListener("keydown",x=>{x.defaultPrevented||(x.key==="ArrowRight"?(x.preventDefault(),B()):x.key==="ArrowLeft"?(x.preventDefault(),w()):x.key==="Escape"&&(x.preventDefault(),y()))}),{start(){n===-1&&I(0)},next:B,previous:w,skip:y,finish:M,destroy(){v()}}}const kh=Math.sqrt(3),Rh=2;function Js(e){return{width:e*kh,height:e*Rh}}const xt=16,Ps=2;function Mh(){return typeof window<"u"&&window.devicePixelRatio||1}function Dh(e,t){const n=Math.max(e.qMin,t.minQ),s=Math.min(e.qMax,t.maxQ),a=Math.max(e.rMin,t.minR),r=Math.min(e.rMax,t.maxR);return n>s||a>r?null:{qMin:n,qMax:s,rMin:a,rMax:r}}function Ih(e,t){const n=Mh(),s=t.width/(n*e.zoom),a=t.height/(n*e.zoom);return{x:e.x-s/2,y:e.y-a/2,width:s,height:a}}function Th(e,t){const n=[qn(e.x,e.y,t),qn(e.x+e.width,e.y,t),qn(e.x,e.y+e.height,t),qn(e.x+e.width,e.y+e.height,t)];let s=1/0,a=-1/0,r=1/0,o=-1/0;for(const i of n)s=Math.min(s,i.q),a=Math.max(a,i.q),r=Math.min(r,i.r),o=Math.max(o,i.r);return{qMin:Math.floor(s)-Ps,qMax:Math.ceil(a)+Ps,rMin:Math.floor(r)-Ps,rMax:Math.ceil(o)+Ps}}function Hh(e,t,n,s){if(!n||typeof n.width!="number"||typeof n.height!="number")return{qMin:e.minQ,qMax:e.maxQ,rMin:e.minR,rMax:e.maxR};if(n.width===0||n.height===0)return{qMin:e.minQ,qMax:e.maxQ,rMin:e.minR,rMax:e.maxR};const a=Ih(t,n);return Dh(Th(a,s),e)}function pn(e){return Math.floor(e/xt)}function vc(e){return`${e.q},${e.r}`}function Fh(e,t){return vc({q:pn(e),r:pn(t)})}function Lh(e){return{qMin:pn(e.qMin),qMax:pn(e.qMax),rMin:pn(e.rMin),rMax:pn(e.rMax)}}function bc(e){const t=[];for(let n=e.rMin;n<=e.rMax;n++)for(let s=e.qMin;s<=e.qMax;s++)t.push({q:s,r:n});return t}function Qh(e,t){const n=t.q*xt,s=t.r*xt,a=n+xt-1,r=s+xt-1,o=Math.max(n,e.minQ),i=Math.min(a,e.maxQ),c=Math.max(s,e.minR),u=Math.min(r,e.maxR);if(!(o>i||c>u))for(let l=c;l<=u;l++)for(let d=o;d<=i;d++)e.ensureTile(d,l)}function Nh(e,t){for(const n of bc(t))Qh(e,n)}const Gh="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3ePlains%20Tile%3c/title%3e%3cdesc%20id='desc'%3eRolling%20plains%20with%20sunrise%20gradients%20and%20glowing%20grasses.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='plains-bg'%20cx='50%25'%20cy='50%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='plains-field'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='0%25'%3e%3cstop%20offset='0%25'%20stop-color='%23facc15'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23eab308'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='plains-haze'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23fde68a'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f59e0b'%20stop-opacity='0.2'%20/%3e%3c/linearGradient%3e%3cfilter%20id='plains-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='5'%20stdDeviation='6'%20flood-color='%23facc15'%20flood-opacity='0.35'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23plains-bg)'%20/%3e%3cg%20filter='url(%23plains-glow)'%3e%3cpath%20d='M16%2088c20-18%2036-22%2048-22s28%204%2048%2022'%20fill='url(%23plains-field)'%20stroke='%23fef9c3'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M24%20102c16-14%2032-18%2040-18s24%204%2040%2018'%20fill='none'%20stroke='%23fde68a'%20stroke-width='5'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M32%2070c12-10%2024-14%2032-14s20%204%2032%2014'%20fill='url(%23plains-haze)'%20opacity='0.7'%20/%3e%3cpath%20d='M52%2078l4%2012m8-12l4%2012m8-12l4%2012'%20stroke='%23fef3c7'%20stroke-width='3'%20stroke-linecap='round'%20opacity='0.8'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='36'%20r='8'%20fill='%23fef08a'%20opacity='0.7'%20/%3e%3c/svg%3e",Oh="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eForest%20Tile%3c/title%3e%3cdesc%20id='desc'%3eStylised%20evergreen%20trees%20glowing%20against%20a%20deep%20night%20backdrop.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='forest-bg'%20cx='50%25'%20cy='40%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230f172a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230b1120'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='forest-leaf'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%234ade80'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2315803d'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='forest-trunk'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23a855f7'%20/%3e%3cstop%20offset='100%25'%20stop-color='%237c3aed'%20/%3e%3c/linearGradient%3e%3cfilter%20id='forest-glow'%20x='-40%25'%20y='-40%25'%20width='180%25'%20height='180%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%234ade80'%20flood-opacity='0.25'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23forest-bg)'%20/%3e%3cg%20filter='url(%23forest-glow)'%20stroke='%23bbf7d0'%20stroke-width='2'%3e%3cpath%20fill='url(%23forest-leaf)'%20d='M64%2026L32%2080h18l-12%2022h28l-10-22h16l-10%2022h28l-12-22h18z'%20/%3e%3crect%20x='58'%20y='74'%20width='12'%20height='18'%20rx='3'%20fill='url(%23forest-trunk)'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20stroke-opacity='0.5'%20d='M44%2086c6-4%2012-6%2020-6s14%202%2020%206'%20/%3e%3c/g%3e%3ccircle%20cx='40'%20cy='40'%20r='6'%20fill='%23fef3c7'%20opacity='0.6'%20/%3e%3ccircle%20cx='88'%20cy='32'%20r='4'%20fill='%23fef3c7'%20opacity='0.4'%20/%3e%3c/svg%3e",jh="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eMountain%20Tile%3c/title%3e%3cdesc%20id='desc'%3eJagged%20alpine%20peaks%20with%20luminous%20snowcaps.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='mountain-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%23111827'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='mountain-rock'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2364748b'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23334155'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='mountain-snow'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23f8fafc'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23cbd5f5'%20/%3e%3c/linearGradient%3e%3cfilter%20id='mountain-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='6'%20stdDeviation='6'%20flood-color='%23f8fafc'%20flood-opacity='0.2'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23mountain-bg)'%20/%3e%3cg%20filter='url(%23mountain-glow)'%20stroke='%23cbd5f5'%20stroke-width='2'%20stroke-linejoin='round'%3e%3cpath%20fill='url(%23mountain-rock)'%20d='M24%20100l32-52%2014%2022%2012-18%2022%2048z'%20/%3e%3cpath%20fill='url(%23mountain-snow)'%20d='M56%2048l14%2022%2012-18%2010%2022H48z'%20opacity='0.85'%20/%3e%3cpath%20fill='none'%20stroke-linecap='round'%20opacity='0.6'%20d='M32%2094c10-6%2020-9%2032-9s22%203%2032%209'%20/%3e%3c/g%3e%3ccircle%20cx='92'%20cy='32'%20r='6'%20fill='%23f1f5f9'%20opacity='0.5'%20/%3e%3c/svg%3e",Uh="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eWater%20Tile%3c/title%3e%3cdesc%20id='desc'%3eGlowing%20waves%20surrounding%20a%20crystalline%20droplet.%3c/desc%3e%3cdefs%3e%3cradialGradient%20id='water-bg'%20cx='50%25'%20cy='45%25'%20r='75%25'%3e%3cstop%20offset='0%25'%20stop-color='%230b1120'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23020617'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='water-wave'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2338bdf8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230ea5e9'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='water-drop'%20x1='50%25'%20y1='0%25'%20x2='50%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230284c7'%20/%3e%3c/linearGradient%3e%3cfilter%20id='water-glow'%20x='-30%25'%20y='-30%25'%20width='160%25'%20height='160%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='8'%20flood-color='%2338bdf8'%20flood-opacity='0.3'%20/%3e%3c/filter%3e%3c/defs%3e%3crect%20x='8'%20y='8'%20width='112'%20height='112'%20rx='24'%20fill='url(%23water-bg)'%20/%3e%3cg%20filter='url(%23water-glow)'%3e%3cpath%20d='M32%2076c12-10%2024-15%2032-15s20%205%2032%2015'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3cpath%20d='M28%2092c14-12%2030-18%2040-18s26%206%2040%2018'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='6'%20stroke-linecap='round'%20opacity='0.7'%20/%3e%3cpath%20d='M40%2060c10-8%2018-12%2024-12s14%204%2024%2012'%20fill='none'%20stroke='url(%23water-wave)'%20stroke-width='4'%20stroke-linecap='round'%20opacity='0.5'%20/%3e%3cpath%20d='M64%2030c-12%2020-18%2032-18%2042%200%2011%208%2020%2018%2020s18-9%2018-20c0-10-6-22-18-42z'%20fill='url(%23water-drop)'%20stroke='%23e0f2fe'%20stroke-width='2'%20/%3e%3c/g%3e%3ccircle%20cx='94'%20cy='34'%20r='6'%20fill='%23f8fafc'%20opacity='0.45'%20/%3e%3c/svg%3e",zh=.01;function wc(e){return!Number.isFinite(e)||e<=zh?1:e}function Xh(e,t){return e/wc(t)}function dt(e,t){const n=wc(t);return Math.round(e*n)/n}const No={[Xe.Plains]:{baseColor:"#d8b869",icon:Gh},[Xe.Forest]:{baseColor:"#237a55",icon:Oh},[Xe.Hills]:{baseColor:"#b57c57",icon:jh},[Xe.Lake]:{baseColor:"#3185d5",icon:Uh}},qh=[255,255,255],Rr=[12,18,28],Yh=[0,0,0],Go="rgba(56, 189, 248, 0.85)",Oo="rgba(56, 189, 248, 0.45)";let Gn=null,On=null;const Kh=e=>Math.min(1,Math.max(0,e));function Vh(e){let t=e.trim().replace("#","");t.length===3&&(t=t.split("").map(s=>s+s).join(""));const n=Number.parseInt(t,16);return[n>>16&255,n>>8&255,n&255]}function Ws(e,t,n){const s=Kh(n);return[Math.round(e[0]+(t[0]-e[0])*s),Math.round(e[1]+(t[1]-e[1])*s),Math.round(e[2]+(t[2]-e[2])*s)]}function jo(e){return`rgb(${e[0]}, ${e[1]}, ${e[2]})`}function $s(e,t=1){return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${t})`}function ea(e,t=1){return $s(Ws(Rr,qh,e),t)}function En(e,t=1){return $s(Ws(Rr,Yh,e),t)}const Zh={terrain:.05,hover:.065,selection:.085},_h={terrain:1,hover:1.35,selection:2.1};function ta(e,t,n="terrain"){const s=e*Zh[n],a=Xh(s,t);return Math.max(_h[n],a)}function Jh(){if(Gn&&On)return{stroke:Gn,glow:On};if(typeof window<"u"){const e=getComputedStyle(document.documentElement),t=e.getPropertyValue("--tile-highlight-ring").trim(),n=e.getPropertyValue("--tile-highlight-glow").trim();Gn=t||Go,On=n||Oo}else Gn=Go,On=Oo;return{stroke:Gn,glow:On}}function yc(e){return Math.min(1,Math.max(0,e))}function fa(e){let t=e.trim();if(t.startsWith("#")&&(t=t.slice(1)),t.length===3){const n=Number.parseInt(t[0]+t[0],16),s=Number.parseInt(t[1]+t[1],16),a=Number.parseInt(t[2]+t[2],16);return[n,s,a]}if(t.length===6){const n=Number.parseInt(t,16),s=n>>16&255,a=n>>8&255,r=n&255;return[s,a,r]}return[0,0,0]}function Wh(e,t,n){const s=yc(n),a=(r,o)=>Math.round(r+(o-r)*s);return[a(e[0],t[0]),a(e[1],t[1]),a(e[2],t[2])]}function $h([e,t,n],s){return`rgba(${e}, ${t}, ${n}, ${yc(s)})`}function Xt(e,t,n,s){return $h(Wh(e,t,n),s)}function ef(e){const{ctx:t,x:n,y:s,width:a,height:r,radius:o,baseColor:i}=e,c=fa(i);t.save(),t.lineCap="round",t.lineJoin="round";const u=Xt(c,[255,255,255],.35,.24);t.strokeStyle=u,t.lineWidth=Math.max(1,o*.06);const l=3,d=6,h=n+a*.12,f=n+a*.88;for(let p=0;p<l;p++){const b=p/Math.max(1,l-1),C=s+r*.28+b*r*.32,S=o*(.18-b*.05);t.beginPath();for(let F=0;F<=d;F++){const H=F/d,T=h+(f-h)*H,Q=Math.sin(H*Math.PI*1.6+p*.8)*S,I=C-Math.abs(Q)*.55;F===0?t.moveTo(T,I):t.lineTo(T,I)}t.stroke()}const m=Xt(c,[18,54,32],.4,.2);t.strokeStyle=m,t.lineWidth=Math.max(.75,o*.035);const A=5,g=o*.22;for(let p=0;p<A;p++){const b=n+a*(.2+p/Math.max(1,A-1)*.6),C=s+r*.55-Math.cos(p*.9)*o*.08;t.beginPath(),t.arc(b,C,g,Math.PI*.2,Math.PI*.85),t.stroke(),t.beginPath(),t.arc(b+g*.35,C-g*.1,g*.55,Math.PI*.15,Math.PI*.95),t.stroke()}t.restore()}function tf(e){const{ctx:t,centerX:n,centerY:s,radius:a,baseColor:r}=e,o=fa(r);t.save(),t.lineCap="round";const i=Xt(o,[255,235,214],.45,.22);t.strokeStyle=i,t.lineWidth=Math.max(1,a*.05);const c=4;for(let d=0;d<c;d++){const h=d/Math.max(1,c-1),f=a*(1.25-h*.45),m=a*(.72-h*.18),A=s+a*.18*(h-.5);t.beginPath(),t.ellipse(n,A,f,m,0,Math.PI*.12,Math.PI*.88),t.stroke()}const u=Xt(o,[60,36,20],.35,.18);t.strokeStyle=u,t.lineWidth=Math.max(.85,a*.032),t.setLineDash([a*.22,a*.18]);const l=3;for(let d=0;d<l;d++){const h=a*(.75-d*.1),f=s+a*.28+d*a*.08;t.beginPath(),t.arc(n+a*.08,f,h,Math.PI*.28,Math.PI*.76),t.stroke()}t.setLineDash([]),t.restore()}function nf(e){const{ctx:t,x:n,y:s,width:a,height:r,radius:o,baseColor:i}=e,c=fa(i);t.save(),t.lineCap="round",t.lineJoin="round";const u=Xt(c,[255,255,255],.55,.28);t.strokeStyle=u,t.lineWidth=Math.max(1,o*.045);const l=4,d=7,h=n+a*.12,f=n+a*.88,m=o*.16;for(let p=0;p<l;p++){const b=p/Math.max(1,l-1),C=s+r*.3+b*r*.4;t.beginPath();for(let S=0;S<=d;S++){const F=S/d,H=h+(f-h)*F,T=Math.sin(F*Math.PI*2+p*.6)*m*(.75-b*.2),Q=C+T;S===0?t.moveTo(H,Q):t.lineTo(H,Q)}t.stroke()}const A=Xt(c,[12,52,94],.4,.2);t.strokeStyle=A,t.lineWidth=Math.max(.8,o*.03);const g=3;for(let p=0;p<g;p++){const b=p/Math.max(1,g-1),C=s+r*.35+b*r*.35;t.beginPath();for(let S=0;S<=d;S++){const F=S/d,H=h+(f-h)*F,T=Math.sin(F*Math.PI*2+p)*m*.35,Q=C+T;S===0?t.moveTo(H,Q):t.lineTo(H,Q)}t.stroke()}t.restore()}function Ec(e){const{ctx:t,x:n,y:s,width:a,height:r,radius:o,baseColor:i}=e,c=fa(i);t.save(),t.lineCap="round";const u=Xt(c,[255,255,255],.42,.18);t.strokeStyle=u,t.lineWidth=Math.max(.85,o*.03);const l=o*.55;for(let f=-1;f<=2;f++){const m=l*f;t.beginPath(),t.moveTo(n+m,s+r*.25),t.lineTo(n+m+a*.75,s+r*.85),t.stroke()}const d=Xt(c,[112,82,32],.3,.16);t.strokeStyle=d,t.lineWidth=Math.max(.7,o*.025),t.setLineDash([o*.24,o*.34]);const h=o*.48;for(let f=0;f<3;f++){const m=h*f;t.beginPath(),t.moveTo(n+a*.18+m,s+r*.78),t.lineTo(n+a*.7+m,s+r*.38),t.stroke()}t.setLineDash([]),t.restore()}const Uo=new Map;let _t=null;function sf(){if(_t)return _t;const e="/";if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e))return _t=e,_t;const n=e.startsWith("/")?e:`/${e}`;return typeof window<"u"&&typeof window.location?.origin=="string"?_t=`${window.location.origin}${n}`:_t=`http://localhost${n}`,_t}function af(e){let t=Uo.get(e);if(!t){t=new Image,t.decoding="async";const n=new URL(e,sf()).href;t.src=n,Uo.set(e,t)}if(t.complete&&t.naturalWidth>0&&t.naturalHeight>0)return t}const rf={[Xe.Plains]:Ec,[Xe.Forest]:ef,[Xe.Hills]:tf,[Xe.Lake]:nf};function Sc(e,t,n,s){e.beginPath();for(let a=0;a<6;a++){const r=Math.PI/180*(60*a-30),o=t+s*Math.cos(r),i=n+s*Math.sin(r);a===0?e.moveTo(o,i):e.lineTo(o,i)}e.closePath()}function of(e,t,n,s){Sc(e,t,n,s),e.save(),e.lineJoin="round",e.lineCap="round",e.lineWidth=ta(s,1,"terrain"),e.strokeStyle=ea(.16,.6),e.stroke(),e.restore()}function cf(e,t,n,s,a,r,o,i){const c=No[t.terrain]??No[Xe.Plains],u=Vh(c.baseColor),l=s+r/2,d=a+o/2;e.save(),Sc(e,l,d,i),e.clip();const h=e.createRadialGradient(l,d,i*.2,l,d,i*1.05);h.addColorStop(0,jo(Ws(u,[255,255,255],.3))),h.addColorStop(.7,c.baseColor),h.addColorStop(1,jo(Ws(u,Rr,.4))),e.fillStyle=h,e.shadowColor=$s(u,.35),e.shadowBlur=i*.9,e.shadowOffsetX=0,e.shadowOffsetY=0,e.fillRect(s-i*.1,a-i*.1,r+i*.2,o+i*.2);const f={ctx:e,x:s,y:a,width:r,height:o,radius:i,centerX:l,centerY:d,baseColor:c.baseColor};(rf[t.terrain]??Ec)(f),e.globalCompositeOperation="lighter";const A=e.createRadialGradient(l,d,i*.85,l,d,i*1.18);A.addColorStop(0,"rgba(255, 255, 255, 0)"),A.addColorStop(1,$s(u,.18)),e.fillStyle=A,e.fillRect(s-i*.1,a-i*.1,r+i*.2,o+i*.2),e.globalCompositeOperation="source-over",e.restore();const g=af(c.icon);if(g){const p=Math.min(r,o)*.62,b=l-p/2,C=d-p/2;e.save(),e.globalAlpha*=.92,e.drawImage(g,b,C,p,p),e.restore()}if(t.building){const p=n[`building-${t.building}`]??n.placeholder;e.drawImage(p,s,a,r,o)}}function lf(e,t){const n=Math.max(e.q*xt,t.minQ),s=Math.min(n+xt-1,t.maxQ),a=Math.max(e.r*xt,t.minR),r=Math.min(a+xt-1,t.maxR);return{qStart:n,qEnd:s,rStart:a,rEnd:r}}class uf{constructor(t){this.map=t,this.unsubscribe=t.addTileChangeListener((n,s,a)=>{this.onTileChange(n,a)})}chunkCanvases=new Map;dirtyChunks=new Set;cachedImages;unsubscribe;dispose(){this.unsubscribe(),this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}invalidate(){this.chunkCanvases.clear(),this.dirtyChunks.clear(),this.cachedImages=void 0}markChunkDirty(t){this.dirtyChunks.add(t)}markTileDirty(t,n){this.dirtyChunks.add(Fh(t,n))}getRenderableChunks(t,n,s,a){this.refreshAssets(s);const r=[],{width:o,height:i}=Js(n);for(const c of bc(t)){const u=vc(c),l=this.ensureChunk(u,c,n,o,i,s,a);l&&r.push(l)}return r}refreshAssets(t){if(this.cachedImages!==t){this.cachedImages=t;for(const n of this.chunkCanvases.keys())this.dirtyChunks.add(n)}}onTileChange(t,n){(n==="created"||n==="terrain"||n==="building"||n==="fog")&&this.markTileDirty(t.q,t.r)}ensureChunk(t,n,s,a,r,o,i){const c=this.chunkCanvases.get(t);if(!c||this.dirtyChunks.has(t)){const u=this.renderChunk(t,n,s,a,r,o,i,c);return this.dirtyChunks.delete(t),u?(this.chunkCanvases.set(t,u),u):(this.chunkCanvases.delete(t),null)}return c}renderChunk(t,n,s,a,r,o,i,c){if(typeof document>"u")return null;const{qStart:u,qEnd:l,rStart:d,rEnd:h}=lf(n,this.map);if(u>l||d>h)return null;const f=a/2,m=r/2;let A=1/0,g=1/0,p=-1/0,b=-1/0;const C=[];for(let Q=u;Q<=l;Q++)for(let I=d;I<=h;I++){const B=this.map.getTile(Q,I);if(!B||B.isFogged)continue;const{x:w,y:v}=ft({q:Q,r:I},s),y=w-i.x-f,M=v-i.y-m;A=Math.min(A,y),g=Math.min(g,M),p=Math.max(p,y+a),b=Math.max(b,M+r),C.push({tile:B,x:y,y:M})}if(!Number.isFinite(A)||!Number.isFinite(g)||!Number.isFinite(p)||!Number.isFinite(b))return null;const S=Math.max(1,Math.ceil(p-A)),F=Math.max(1,Math.ceil(b-g));let H=c?.canvas;(!H||H.width!==S||H.height!==F)&&(H=document.createElement("canvas"),H.width=S,H.height=F);const T=H.getContext("2d");if(!T)throw new Error("Canvas 2D context not available for chunk rendering");T.setTransform(1,0,0,1,0,0),T.clearRect(0,0,S,F);for(const{tile:Q,x:I,y:B}of C){const w=I-A,v=B-g;T.save(),cf(T,Q,o,w,v,a,r,s),of(T,w+a/2,v+r/2,s),T.restore()}return{key:t,canvas:H,origin:{x:A,y:g},width:S,height:F}}}const df=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],yt=new Array(512);for(let e=0;e<512;e++)yt[e]=df[e%256];const zo=new Map,Xo=e=>e*e*e*(e*(e*6-15)+10),Ha=(e,t,n)=>e+n*(t-e),ks=(e,t,n)=>{switch(e&3){case 0:return t+n;case 1:return-t+n;case 2:return t-n;default:return-t-n}};function hf(e,t){const n=Math.floor(e)&255,s=Math.floor(t)&255,a=e-Math.floor(e),r=t-Math.floor(t),o=yt[yt[n+1]+s+1],i=yt[yt[n]+s+1],c=yt[yt[n+1]+s],u=yt[yt[n]+s],l=Xo(a),d=Xo(r),h=Ha(ks(u,a,r),ks(c,a-1,r),l),f=Ha(ks(i,a,r-1),ks(o,a-1,r-1),l);return Ha(h,f,d)}function ff(e,t,n=4){let s=0,a=1,r=1,o=0;for(let i=0;i<n;i++)s+=hf(e*a,t*a)*r,o+=r,r*=.5,a*=2;return o>0?s/o:0}function mf(e){const t=Math.max(32,Math.min(512,Math.round(e))),n=t,s=zo.get(n);if(s)return s;if(typeof document>"u")return null;const a=document.createElement("canvas");a.width=t,a.height=t;const r=a.getContext("2d");if(!r)return null;const o=r.createImageData(t,t),i=t/48;let c=0;for(let u=0;u<t;u++)for(let l=0;l<t;l++){const d=ff(l/i,u/i,5),h=Math.pow((d+1)/2,1.35),f=Math.round(h*255);o.data[c]=255,o.data[c+1]=255,o.data[c+2]=255,o.data[c+3]=f,c+=4}return r.putImageData(o,0,0),zo.set(n,a),a}function qo(e,t,n,s){e.beginPath();for(let a=0;a<6;a++){const r=Math.PI/180*(60*a-30),o=t+s*Math.cos(r),i=n+s*Math.sin(r);a===0?e.moveTo(o,i):e.lineTo(o,i)}e.closePath()}function gf(e,t,n,s){const a=e.createRadialGradient(t,n,s*.08,t,n,s*1.12);return a.addColorStop(0,ea(.4,.35)),a.addColorStop(.35,ea(.2,.55)),a.addColorStop(.6,En(.1,.78)),a.addColorStop(.82,En(.2,.88)),a.addColorStop(1,En(.35,.95)),a}function pf(e,t,n,s,a){if(s<=0)return;const r=mf(s*2.2),o=s*2.5,i=t-o/2,c=n-o/2;e.save(),qo(e,t,n,s),e.clip();const u=gf(e,t,n,s);e.fillStyle=u,e.fillRect(i,c,o,o),r&&(e.save(),e.globalCompositeOperation="lighter",e.globalAlpha*=.32,e.drawImage(r,t-s,n-s,s*2,s*2),e.restore()),e.restore(),e.save(),qo(e,t,n,s*.99),e.lineJoin="round",e.lineCap="round",e.lineWidth=ta(s,a,"hover"),e.strokeStyle=En(.3,.88),e.shadowColor=En(.45,.42),e.shadowBlur=Math.max(3,s*.45/Math.max(a,.1)),e.stroke(),e.restore()}class Af{constructor(t){this.mapRef=t,this.terrainCache=new uf(t),this.cachedHexSize=t.hexSize}terrainCache;cachedHexSize;get hexSize(){return this.mapRef.hexSize}getOrigin(){return ft({q:this.mapRef.minQ,r:this.mapRef.minR},this.hexSize)}invalidateCache(){this.terrainCache.invalidate()}dispose(){this.terrainCache.dispose()}draw(t,n,s){this.ensureHexSize();const a=t.canvas??null,r=Hh(this.mapRef,X,a,this.hexSize);if(!r)return;const o=Lh(r);Nh(this.mapRef,o);const i=this.getOrigin(),c=this.terrainCache.getRenderableChunks(o,this.hexSize,n,i);this.drawChunks(t,c),this.drawFogLayer(t,i,r),s&&this.drawSelection(t,i,s)}drawToCanvas(t,n,s){const a=t.getContext("2d");if(!a)throw new Error("Canvas 2D context not available");this.draw(a,n,s)}ensureHexSize(){this.cachedHexSize!==this.hexSize&&(this.cachedHexSize=this.hexSize,this.terrainCache.invalidate())}drawChunks(t,n){if(n.length!==0)for(const s of n)t.drawImage(s.canvas,s.origin.x,s.origin.y)}drawSelection(t,n,s){const{width:a,height:r}=Js(this.hexSize),{x:o,y:i}=ft(s,this.hexSize),c=o-n.x-a/2,u=i-n.y-r/2;this.strokeHex(t,c+a/2,u+r/2,this.hexSize,!0)}drawFogLayer(t,n,s){const{width:a,height:r}=Js(this.hexSize),o=a/2,i=r/2;for(let c=s.rMin;c<=s.rMax;c++)for(let u=s.qMin;u<=s.qMax;u++){const l=this.mapRef.getTile(u,c);if(!l||!l.isFogged)continue;const{x:d,y:h}=ft({q:u,r:c},this.hexSize),f=d-n.x-o,m=h-n.y-i,A=this.hexSize,g=f+a/2,p=m+r/2;pf(t,g,p,A,X.zoom)}}strokeHex(t,n,s,a,r=!1){const{stroke:o,glow:i}=Jh();this.hexPath(t,n,s,a),t.save(),t.lineJoin="round",t.lineCap="round",r?(t.shadowColor=i,t.shadowBlur=Math.max(6,a*.65/Math.max(X.zoom,.1)),t.lineWidth=ta(a,X.zoom,"selection"),t.strokeStyle=o,t.stroke()):(t.lineWidth=ta(a,X.zoom,"hover"),t.shadowColor=ea(.1,.45),t.shadowBlur=Math.max(2,a*.4/Math.max(X.zoom,.1)),t.strokeStyle=En(.1,.72),t.stroke()),t.restore()}hexPath(t,n,s,a){t.beginPath();for(let r=0;r<6;r++){const o=Math.PI/180*(60*r-30),i=n+a*Math.cos(o),c=s+a*Math.sin(o);r===0?t.moveTo(i,c):t.lineTo(i,c)}t.closePath()}}const Nt={accent:"#38bdf8",accentSoft:"rgba(56, 189, 248, 0.2)",warm:"#fbbf24",surface:"rgba(15, 23, 42, 0.92)",border:"rgba(148, 163, 184, 0.34)",text:"#e2e8f0"};let Gt=null;function fn(e,t){const n=e.trim();return n.length>0?n:t}function vf(){if(Gt)return Gt;if(typeof window>"u"||typeof document>"u")return Gt=Nt,Gt;try{const e=getComputedStyle(document.documentElement);return Gt={accent:fn(e.getPropertyValue("--color-accent"),Nt.accent),accentSoft:fn(e.getPropertyValue("--color-accent-soft"),Nt.accentSoft),warm:fn(e.getPropertyValue("--color-warning"),Nt.warm),surface:fn(e.getPropertyValue("--color-surface-strong"),Nt.surface),border:fn(e.getPropertyValue("--hud-border-strong"),Nt.border),text:fn(e.getPropertyValue("--color-foreground"),Nt.text)},Gt}catch(e){return console.warn("Failed to read sauna palette tokens from computed styles",e),Gt=Nt,Gt}}function bf(e,t){const n=Math.max(0,e.auraRadius),s=ft(e.pos,t),a=s.x+t,r=s.y+t;let o=t;if(n<=0)return t*1.6;for(const i of wi){const c=ft({q:e.pos.q+i.q*n,r:e.pos.r+i.r*n},t),u=c.x+t,l=c.y+t,d=Math.hypot(u-a,l-r);d>o&&(o=d)}return o+t*.65}function wf(e,t,n,s,a,r){const o=Math.max(0,Math.min(r,Math.min(s,a)/2));e.moveTo(t+o,n),e.lineTo(t+s-o,n),e.quadraticCurveTo(t+s,n,t+s,n+o),e.lineTo(t+s,n+a-o),e.quadraticCurveTo(t+s,n+a,t+s-o,n+a),e.lineTo(t+o,n+a),e.quadraticCurveTo(t,n+a,t,n+a-o),e.lineTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n),e.closePath()}function yf(e,t,{origin:n,hexSize:s,timestamp:a}){if(!t)return;const r=vf(),o=Number.isFinite(a)?a:typeof performance<"u"?performance.now():Date.now(),i=.5+.5*Math.sin(o*.0035),c=ft(t.pos,s),u=c.x-n.x+s,l=c.y-n.y+s,d=bf(t,s);e.save(),e.globalCompositeOperation="screen";const h=d+s*(.4+i*.3),f=Math.max(s*.6,d*.58),m=e.createRadialGradient(u,l,f,u,l,h);m.addColorStop(0,r.accentSoft),m.addColorStop(.55,`rgba(56, 189, 248, ${.18+i*.12})`),m.addColorStop(1,"rgba(2, 6, 23, 0)"),e.fillStyle=m,e.beginPath(),e.arc(u,l,h,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.globalCompositeOperation="lighter",e.lineWidth=Math.max(s*.28,6),e.strokeStyle=`rgba(56, 189, 248, ${(.35+i*.2).toFixed(3)})`,e.shadowColor=`rgba(56, 189, 248, ${.45+i*.1})`,e.shadowBlur=s*(.9+i*.45),e.beginPath(),e.arc(u,l,d+s*.12,0,Math.PI*2),e.stroke(),e.restore();const A=s*.9;e.save(),e.beginPath(),e.arc(u,l,A,0,Math.PI*2),e.fillStyle=r.surface,e.globalAlpha*=.96,e.fill(),e.lineWidth=Math.max(1.5,s*.06),e.strokeStyle=r.border,e.shadowColor="rgba(8, 25, 53, 0.6)",e.shadowBlur=s*.45,e.stroke(),e.restore();const g=A*.78,p=Math.max(s*.22,5);e.save(),e.lineWidth=p,e.strokeStyle="rgba(148, 163, 184, 0.24)",e.beginPath(),e.arc(u,l,g,0,Math.PI*2),e.stroke(),e.restore();const b=t.playerSpawnCooldown>0?t.playerSpawnCooldown:1,S=1-Math.min(1,Math.max(0,t.playerSpawnTimer/b)),F=-Math.PI/2,H=F+Math.PI*2*S;if(S>0){e.save(),e.lineWidth=p,e.lineCap="round";const V=e.createLinearGradient(u,l-g,u,l+g);V.addColorStop(0,r.accent),V.addColorStop(1,r.warm),e.strokeStyle=V,e.shadowColor=`rgba(56, 189, 248, ${.42+i*.18})`,e.shadowBlur=s*(.65+i*.35),e.beginPath(),e.arc(u,l,g,F,H,!1),e.stroke(),e.restore()}const T=Math.max(0,t.playerSpawnTimer),Q=Math.ceil(T);e.save(),e.font=`600 ${Math.max(12,s*.9)}px "Inter", "Manrope", "Segoe UI", sans-serif`,e.fillStyle=r.text,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(2, 6, 23, 0.6)",e.shadowBlur=s*.35,e.fillText(String(Q),u,l),e.restore(),e.save(),e.font=`500 ${Math.max(10,s*.36)}px "Inter", "Manrope", "Segoe UI", sans-serif`,e.fillStyle="rgba(148, 163, 184, 0.78)",e.textAlign="center",e.textBaseline="top",e.fillText("sec",u,l+g*.45),e.restore();const I="Sauna ♨️",B=Math.max(12,s*.58);e.save(),e.font=`600 ${B}px "Inter", "Manrope", "Segoe UI", sans-serif`;const w=e.measureText(I),v=s*.58,y=s*.32,M=w.width+v*2,x=B+y*2,O=u-M/2,N=l-d-x-s*.35,U=x/2;e.beginPath(),wf(e,O,N,M,x,U);const J=e.createLinearGradient(O,N,O,N+x);J.addColorStop(0,"rgba(15, 23, 42, 0.94)"),J.addColorStop(.55,"rgba(15, 23, 42, 0.86)"),J.addColorStop(1,"rgba(30, 41, 59, 0.9)"),e.fillStyle=J,e.shadowColor="rgba(8, 25, 53, 0.6)",e.shadowBlur=s*.4,e.fill(),e.lineWidth=Math.max(1.5,s*.06);const $=e.createLinearGradient(O,N,O+M,N);$.addColorStop(0,`${r.accent}`),$.addColorStop(1,`${r.warm}`),e.strokeStyle=$,e.stroke(),e.fillStyle=r.text,e.shadowColor="rgba(8, 25, 53, 0.65)",e.shadowBlur=s*.3,e.textAlign="center",e.textBaseline="middle",e.fillText(I,u,N+x/2+B*.05),e.restore()}const Cc={nativeSize:{width:64,height:64},anchor:{x:.5,y:.92},scale:{x:1,y:1},nudge:{x:0,y:-.05}},Ef={default:Cc,soldier:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.88},scale:{x:1.06,y:1.18},nudge:{x:0,y:-.1}},archer:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.86},scale:{x:1.04,y:1.16},nudge:{x:0,y:-.08}},"avanto-marauder":{nativeSize:{width:128,height:128},anchor:{x:.5,y:.86},scale:{x:1.08,y:1.12},nudge:{x:0,y:-.12}},saunoja:{nativeSize:{width:128,height:128},anchor:{x:.5,y:.66},scale:{x:1,y:1},nudge:{x:0,y:-.02}}};function xc(e){return Ef[e]??Cc}function Bc(e,t,n,s){const{x:a,y:r}=ft(e,t),o=s.nudge.x*t,i=s.nudge.y*t;return{x:a-n.x+o,y:r-n.y+i}}function Sf({coord:e,hexSize:t,origin:n,zoom:s,type:a}){const r=xc(a),o=Bc(e,t,n,r);return{x:dt(o.x,s),y:dt(o.y,s)}}function Cf({coord:e,hexSize:t,origin:n,zoom:s,type:a}){const r=xc(a),o=Bc(e,t,n,r),{width:i,height:c}=Js(t),u=i*r.scale.x,l=c*r.scale.y,d=dt(o.x-u*r.anchor.x,s),h=dt(o.y-l*r.anchor.y,s),f=dt(u,s),m=dt(l,s),A=d+f*r.anchor.x,g=h+m*r.anchor.y;return{drawX:d,drawY:h,width:f,height:m,centerX:A,centerY:g,metadata:r}}function xf(e){if(!e||typeof e!="object")return!1;const t=e;return!!t.coord&&typeof t.coord=="object"&&typeof t.coord.q=="number"&&typeof t.coord.r=="number"&&typeof t.range=="number"}function Bf(e){if(!e)return null;if(xf(e)){const t=Number.isFinite(e.range)?Math.max(0,e.range):0;return{coord:e.coord,range:t}}if("pos"in e&&"auraRadius"in e){const t=Number.isFinite(e.auraRadius)?Math.max(0,e.auraRadius):0;return{coord:e.pos,range:t}}return null}function Pf(e,t,n,s,a,r){const o=window.devicePixelRatio||1,i=e.canvas.width,c=e.canvas.height;e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i,c);const u=i/o,l=c/o;e.scale(o,o),e.translate(u/2,l/2),e.scale(X.zoom,X.zoom);const d=t.getOrigin();e.translate(-(X.x-d.x),-(X.y-d.y)),t.draw(e,n,a??void 0);const h=r?.saunojas;h&&Array.isArray(h.units)&&h.units.length>0&&h.draw(e,h.units,{originX:d.x,originY:d.y,hexRadius:t.hexSize,zoom:X.zoom}),kf(e,t,n,s,d,r?.fx,r?.friendlyVisionSources,r?.saunaVision??r?.sauna??null),r?.sauna&&yf(e,r.sauna,{origin:d,hexSize:t.hexSize}),e.restore()}function kf(e,t,n,s,a,r,o,i){const u=(o??s).filter(d=>d.faction==="player"&&!d.isDead()).map(d=>({coord:d.coord,range:d.getVisionRange()})),l=Bf(i);l&&u.push(l);for(const d of s){if(d.isDead()||d.faction==="enemy"&&!u.some(({coord:F,range:H})=>gn(F,d.coord)<=H))continue;const h=n[`unit-${d.type}`]??n.placeholder,f=d.getMaxHealth();e.save();const m=r?.getUnitAlpha?.(d);if(typeof m=="number"){const F=Math.min(1,Math.max(0,m));if(F<=0){e.restore();continue}e.globalAlpha*=F}d.stats.health/f<.5&&(e.filter="saturate(0)");const A=d.renderCoord??d.coord,g=Cf({coord:A,hexSize:t.hexSize,origin:a,zoom:X.zoom,type:d.type}),p=[];d.stats.health/f<.5&&p.push("saturate(0)");const b=Math.abs(A.q-d.coord.q),C=Math.abs(A.r-d.coord.r),S=Math.min(1,b+C);S>.01?(p.push("contrast(1.08)"),e.shadowColor="rgba(255, 255, 255, 0.28)",e.shadowBlur=Math.max(6,12*X.zoom*S)):(e.shadowColor="rgba(0, 0, 0, 0)",e.shadowBlur=0),e.filter=p.length>0?p.join(" "):"none",e.drawImage(h,g.drawX,g.drawY,g.width,g.height),Pr()&&d.faction==="player"&&(e.strokeStyle="rgba(255,255,255,0.5)",e.lineWidth=2,e.strokeRect(g.drawX,g.drawY,g.width,g.height)),e.restore()}}const Rf=200,Yo=.001;function Fa(e){return{q:e.q,r:e.r}}function Rs(e,t){return!e||!t?!1:Math.abs(e.q-t.q)<Yo&&Math.abs(e.r-t.r)<Yo}class Mf{constructor(t){this.redraw=t}tracks=new Map;rafId=null;enqueue(t,n){const s=this.normalizePath(n);if(s.length<2){this.clear(t,{snap:!0});return}const a=s[0];let r=this.tracks.get(t.id);r?r.current?Rs(r.current.to,a)||(r=this.resetTrack(t,a)):Rs(t.renderCoord,a)||(r=this.resetTrack(t,a)):(r={unit:t,queue:[]},this.tracks.set(t.id,r),Rs(t.renderCoord,a)||t.setRenderCoord(a));for(let o=1;o<s.length;o++)r.queue.push(Fa(s[o]));this.ensureRunning()}clear(t,n){if(!this.tracks.delete(t.id)){n?.snap&&(t.snapRenderToCoord(),this.redraw());return}(n?.snap??!0)&&(t.snapRenderToCoord(),this.redraw()),this.tracks.size===0&&this.rafId!==null&&(typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null)}clearAll(){for(const t of this.tracks.values())t.unit.snapRenderToCoord();this.tracks.clear(),this.rafId!==null&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(this.rafId),this.rafId=null,this.redraw()}resetTrack(t,n){this.clear(t,{snap:!1});const s={unit:t,queue:[]};return this.tracks.set(t.id,s),t.setRenderCoord(n),s}ensureRunning(){this.rafId!==null||this.tracks.size===0||(this.rafId=requestAnimationFrame(this.step))}normalizePath(t){const n=[];for(const s of t){const a=Fa(s);(n.length===0||!Rs(n[n.length-1],a))&&n.push(a)}return n}ease(t){return t<=0?0:t>=1?1:t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}step=t=>{if(this.rafId=null,this.tracks.size===0)return;let n=!1;for(const[s,a]of this.tracks){if(!a.current){const h=a.queue.shift();if(!h){this.tracks.delete(s);continue}a.current={from:Fa(a.unit.renderCoord??a.unit.coord),to:h,start:t}}const r=a.current;if(!r)continue;const i=(t-r.start)/Rf,c=Math.min(1,Math.max(0,i)),u=this.ease(c),l=r.from.q+(r.to.q-r.from.q)*u,d=r.from.r+(r.to.r-r.from.r)*u;a.unit.setRenderCoord({q:l,r:d}),n=!0,c>=1&&(a.unit.setRenderCoord(r.to),a.current=void 0,a.queue.length===0&&this.tracks.delete(s))}n&&this.redraw(),this.tracks.size>0&&(this.rafId=requestAnimationFrame(this.step))}}const Df=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,If=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null,Tf=900,Hf=650;function Ff(e){switch(e){case"down":return{x:0,y:36};case"left":return{x:-26,y:-18};case"right":return{x:26,y:-18};case"up":default:return{x:0,y:-40}}}function Lf(e){const t=document.createElement("div");t.className="ui-floater-layer",e.appendChild(t);const n=!!Df?.matches,s=!!If?.matches;return{spawn:({text:o,x:i,y:c,color:u,direction:l="up",durationMs:d,fontSize:h})=>{const f=document.createElement("span");f.className="ui-floater",f.textContent=o,f.style.left=`${Math.round(i)}px`,f.style.top=`${Math.round(c)}px`,u&&(f.style.color=u),h&&(f.style.fontSize=`${h}px`);const m=s?12:24;for(;t.childElementCount>=m;)t.firstElementChild?.remove();t.appendChild(f);const A=d??(s?Hf:Tf);if(n||!f.animate){f.style.opacity="0",f.style.transition=`opacity ${Math.round(A*.8)}ms ease-out`,requestAnimationFrame(()=>{f.style.opacity="1",requestAnimationFrame(()=>{f.style.opacity="0"})}),window.setTimeout(()=>{f.remove()},A);return}const g=Ff(l),p=[{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:0},{transform:"translate3d(-50%, -50%, 0) translate3d(0, 0, 0)",opacity:1,offset:.18},{transform:`translate3d(-50%, -50%, 0) translate3d(${g.x}px, ${g.y}px, 0)`,opacity:0}],b=f.animate(p,{duration:A,easing:"cubic-bezier(0.18, 0.89, 0.32, 1.28)",fill:"forwards"});b.onfinish=()=>{f.remove()}},destroy:()=>{t.remove()}}}const Ko=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Qf=new Intl.NumberFormat("en-US",{maximumFractionDigits:1,minimumFractionDigits:0});function Vo(e){return 1-(1-e)*(1-e)}function Ms(e,t,n){return Math.min(n,Math.max(t,e))}const Nf="var(--color-danger)",Gf="color-mix(in srgb, #34d399 88%, white 12%)",Of=720,jf=540,Uf=220,zf=180,Xf=6,qf=3,Yf="color-mix(in srgb, #fbbf24 82%, white 10%)",Kf=typeof matchMedia=="function"?matchMedia("(prefers-reduced-motion: reduce)"):null,Vf=typeof matchMedia=="function"?matchMedia("(pointer: coarse)"):null;function Zf(e){const{canvas:t,overlay:n,mapRenderer:s,getUnitById:a,requestDraw:r}=e,o=Lf(n),i=new Map,c=new Map,u=[],l={x:0,y:0},d=!!Kf?.matches,h=!!Vf?.matches,f=h?jf:Of,m=h?zf:Uf,A=h?qf:Xf,g=()=>{r&&(typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>r()):r())},p=B=>{const w=t.getBoundingClientRect(),v=n.getBoundingClientRect();if(w.width===0||w.height===0)return null;const{x:y,y:M}=ft(B,s.hexSize),x=(y-X.x)*X.zoom+w.width/2,O=(M-X.y)*X.zoom+w.height/2,N=s.hexSize*X.zoom*.75;return{x:x+(w.left-v.left),y:O+(w.top-v.top)-N}},b=(B,w,v,y="up")=>{const M=a(B);if(!M)return;const x=p(M.renderCoord??M.coord);x&&o.spawn({text:w,x:x.x,y:x.y,color:v,direction:y,fontSize:h?18:void 0})},C=B=>{if(!B||B.amount<=0)return;const w=Ko.format(Math.max(1,Math.round(B.amount)));if(b(B.targetId,`-${w}`,Nf,"up"),!d){const v=typeof performance<"u"?performance.now():Date.now();u.push({start:v,duration:m,intensity:A,seedX:Math.random()*500,seedY:Math.random()*500})}g()},S=B=>{if(!B||B.amount<=0)return;const w=B.amount>=1?Ko.format(Math.round(B.amount)):Qf.format(Ms(B.amount,0,9.9));b(B.unitId,`+${w}`,Gf,"up"),g()},F=B=>{if(!B)return;const w=typeof performance<"u"?performance.now():Date.now();i.set(B.unitId,{start:w,duration:f}),b(B.unitId,"✖",Yf,"down"),g()};return R.on("unitDamaged",C),R.on("unitHealed",S),R.on("unitDied",F),{step:B=>{if(d)l.x=0,l.y=0;else{let w=0,v=0;for(let y=u.length-1;y>=0;y--){const M=u[y],x=B-M.start;if(x>=M.duration){u.splice(y,1);continue}const O=Ms(x/M.duration,0,1),N=M.intensity*Vo(1-O);w+=Math.sin((B+M.seedX)/16)*N,v+=Math.cos((B+M.seedY)/18)*N}l.x=w,l.y=v}for(const[w,v]of i){const y=B-v.start,M=Ms(y/v.duration,0,1),x=1-Vo(M);if(M>=1){c.delete(w),i.delete(w);continue}c.set(w,Ms(x,0,1))}},getShakeOffset:()=>({x:l.x,y:l.y}),getUnitAlpha:B=>c.get(B)??1,dispose:()=>{R.off("unitDamaged",C),R.off("unitHealed",S),R.off("unitDied",F),u.length=0,i.clear(),c.clear(),o.destroy()}}}function _f(){return`${"/".endsWith("/")?"/":"//"}${"assets/units/saunoja.svg".replace(/^\/+/,"")}`}const Zo=_f();let An=null,jn=null;function ir(e){return!!(e&&e.complete&&e.naturalWidth>0&&e.naturalHeight>0)}function Jf(e,t){if(!t)return e;try{t(e)}catch(n){console.error("Saunoja icon onLoad callback failed",n)}return e}function Pc(e){const t=s=>e?s.then(a=>Jf(a,e)):s;if(ir(An))return t(Promise.resolve(An));if(jn)return t(jn);if(typeof Image>"u")return Promise.reject(new Error("Image constructor is not available in this environment."));const n=new Image;return n.decoding="async",An=n,jn=new Promise((s,a)=>{const r=()=>{n.onload=null,n.onerror=null},o=()=>{r(),s(n)};n.onload=o,n.onerror=i=>{r(),An=null,jn=null;const c=new Error(`Failed to load saunoja icon from ${Zo}`);console.warn(c.message,i),a(c)},n.src=Zo,ir(n)&&o()}),t(jn)}function Wf(e,t,{originX:n=0,originY:s=0,hexRadius:a=kn,zoom:r=1}={}){if(!e||!Array.isArray(t)||t.length===0)return;const o=ir(An)?An:null;if(!o)return;const i=Number.isFinite(a)&&a>0?a:kn,c=i*.98,u=[...t].sort((l,d)=>l.coord.r!==d.coord.r?l.coord.r-d.coord.r:l.coord.q!==d.coord.q?l.coord.q-d.coord.q:l.id.localeCompare(d.id));for(const l of u){const{x:d,y:h}=Sf({coord:l.coord,hexSize:i,origin:{x:n,y:s},zoom:r,type:"saunoja"});e.save(),Vn(e,d,h,c),e.clip();const f=i*2.15/Math.max(o.naturalWidth,o.naturalHeight||1),m=dt(o.naturalWidth*f,r),A=dt(o.naturalHeight*f,r),g=dt(d-m/2,r),p=dt(h-A*.72,r);e.save(),e.filter="grayscale(100%) contrast(112%)",e.globalAlpha*=.96,e.drawImage(o,g,p,m,A),e.restore(),e.save(),e.globalCompositeOperation="multiply";const b=e.createRadialGradient(d,h+c*.38,c*.2,d,h+c*.38,c*1.05);b.addColorStop(0,"rgba(15, 23, 42, 0.55)"),b.addColorStop(1,"rgba(15, 23, 42, 0)"),e.fillStyle=b,e.fillRect(d-c,h-c,c*2,c*2),e.restore(),e.save(),e.globalCompositeOperation="soft-light";const C=e.createLinearGradient(d,h-c,d,h+c);C.addColorStop(0,"rgba(255, 232, 210, 0.18)"),C.addColorStop(.52,"rgba(255, 183, 124, 0.32)"),C.addColorStop(1,"rgba(212, 97, 54, 0.5)"),e.fillStyle=C,e.fillRect(d-c,h-c,c*2,c*2),e.restore(),e.save(),e.globalCompositeOperation="screen",e.globalAlpha=.75;const S=e.createRadialGradient(d,h-c*.68,c*.1,d,h,c*1.12);S.addColorStop(0,"rgba(255, 255, 255, 0.85)"),S.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=S,e.fillRect(d-c,h-c,c*2,c*2),e.restore();const H=performance.now()-l.lastHitAt,T=120;if(H<T){const B=1-H/T;id(e,{centerX:d,centerY:h,radius:c,progress:B})}e.restore(),cd(e,{centerX:d,centerY:h-i*.18,radius:i*.94,intensity:l.steam});const Q=i*.42,I=h+i*.34;od(e,{centerX:d,centerY:I,hp:l.hp,maxHp:l.maxHp,radius:Q})}}const $f=["Resolute Sauna Guardian","Steam Scholar","Frost-Hardened","Loyal Watchbearer","Aura Whisperer","Shield Brother","Stonefooted Scout","Sisu-Forged Veteran","Brewmaster Quartermaster","Icebreaker Herald","Runic Tactician","Torchbearer"],em=["Heat Fickle","Soot Allergic","Slow to Spark","Overconfident","Distracted Dreamer","Stubborn Stoker","Thirsty Between Battles","Clumsy Footwork","Rust-Prone Gear","Echo-Lost Listener"];function _o(e,t,n){const s=[...e],a=[],r=Math.max(0,Math.min(t,s.length));for(let o=0;o<r;o++){const i=Math.floor(n()*s.length),[c]=s.splice(i,1);c&&a.push(c)}return a}function tm(e,t){for(let n=e.length-1;n>0;n--){const s=Math.floor(t()*(n+1));[e[n],e[s]]=[e[s],e[n]]}return e}function nm(e=Math.random){typeof e!="function"&&(e=Math.random);const t=_o($f,2,e),n=_o(em,1,e),s=[...t,...n];return tm(s,e).map(a=>a.trim()).filter(a=>a.length>0)}const sm=1;function Un(e,t=0){return Number.isFinite(e)?e:t}function am(e){const{heat:t,pickSpawnTile:n,spawnUnit:s,maxSpawns:a,tierHelpers:r}=e,o=Math.max(sm,wn),i=Math.max(0,Un(e.minUpkeepReserve??o,o));let c=Math.max(0,Un(e.availableUpkeep,0));const u=Math.max(0,Math.floor(Un(a??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY))),l=Un(e.rosterCap??Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),d=Number.isFinite(l)?Math.max(0,Math.floor(l)):Number.POSITIVE_INFINITY,h=typeof e.getRosterCount=="function"?e.getRosterCount:()=>0;let f=0,m=0,A=0,g=0,p=0,b=0,C=0;for(;(t.hasTriggerReady()||r?.hasQueuedSpawn())&&f<u;){f+=1;const S=r?.getSnapshot()??null;if(Math.max(0,Math.floor(Un(h()??0,0)))>=d){b+=1;let I=!1;S&&r&&(I=r.queueBlockedSpawn(S,()=>t.consumeTrigger())),I?m+=t.vent(.15):m+=t.vent(.35);break}let H=!1;if(S&&r&&r.hasQueuedSpawn()&&(H=r.takeQueuedSpawn(S)),!H&&!t.hasTriggerReady())break;if(c<i){g+=1,H&&S&&r?.restoreQueuedSpawn(S),m+=t.vent(.5);break}const T=n();if(!T){p+=1,H&&S&&r?.restoreQueuedSpawn(S),m+=t.vent(.25);break}if(!s(T)){C+=1,H&&S&&r?.restoreQueuedSpawn(S),m+=t.vent(.25);break}if(!H&&!t.consumeTrigger()){C+=1;break}A+=1,c=Math.max(0,c-i),S&&r?.onSpawnResolved?.(S,{usedQueue:H})}return{spawned:A,blockedByUpkeep:g,blockedByPosition:p,blockedByRoster:b,failedSpawns:C,ventedHeat:m,remainingUpkeep:c}}function La(e,t=0){return Number.isFinite(e)?e:t}function rm(e){const t=Math.max(0,La(e.dt,0)),{addedHeat:n,cooledHeat:s}=e.heat.advance(t);let a=0;for(const f of e.units){if(f.isDead()||f.faction!=="player")continue;const m=Math.max(0,La(e.getUnitUpkeep(f),0));m>0&&(a+=m)}const r=5;let i=Math.max(0,La(e.sauna.beerUpkeepAccumulator,0)),c=0;if(a>0){if(i+=t,i>=r){const f=Math.floor(i/r);c=a*f,i-=f*r}}else i=0;e.sauna.beerUpkeepAccumulator=i,c>0&&e.state.addResource(k.SAUNA_BEER,-c);const u=e.state.getResource(k.SAUNA_BEER),l=am({heat:e.heat,availableUpkeep:u,pickSpawnTile:e.pickSpawnTile,spawnUnit:e.spawnBaseUnit,minUpkeepReserve:e.minUpkeepReserve,maxSpawns:e.maxSpawns,rosterCap:e.rosterCap,getRosterCount:e.getRosterCount,tierHelpers:e.tierHelpers}),d=e.heat.getCooldownSeconds(),h=e.heat.timeUntilNextTrigger();return e.sauna.heat=e.heat.getHeat(),e.sauna.playerSpawnThreshold=e.heat.getThreshold(),e.sauna.playerSpawnCooldown=Number.isFinite(d)?d:0,e.sauna.playerSpawnTimer=Number.isFinite(h)?h:0,e.sauna.heatPerTick=e.heat.getBuildRate(),{addedHeat:n,cooledHeat:s,upkeepDrain:c,spawn:l,beerRemaining:e.state.getResource(k.SAUNA_BEER),availableUpkeep:l.remainingUpkeep}}function om(){try{return globalThis.localStorage??null}catch(e){return console.warn("Unable to access localStorage for inventory persistence",e),null}}function im(e,t){const n=e.getItem(t);if(n)try{return JSON.parse(n)}catch(s){console.warn(`Failed to parse persisted inventory for "${t}", clearing.`,s),e.removeItem(t);return}}function Ds(e,t,n){const s=Number.isFinite(e.quantity)?e.quantity:1,a=Math.max(1,Math.round(s)),r=typeof e.rarity=="string"?e.rarity.trim():void 0,o=typeof e.icon=="string"?e.icon:void 0,i=typeof e.description=="string"?e.description:void 0;return{id:e.id,name:e.name,description:i,icon:o,rarity:r,quantity:a,acquiredAt:t,sourceTableId:n?.tableId,sourceEntryId:n?.entryId}}class cm{listeners=new Set;storageKey;now;maxStashSize;storage;autoEquip;stash=[];inventory=[];constructor(t={}){this.storageKey=t.storageKey??"autobattles:inventory",this.now=typeof t.now=="function"?t.now:()=>Date.now(),this.maxStashSize=Math.max(1,Math.floor(t.maxStashSize??24)),this.storage=om(),this.autoEquip=t.autoEquip??!0,this.load()}load(){if(!this.storage)return;const t=im(this.storage,this.storageKey);if(t){if(typeof t.autoEquip=="boolean"&&(this.autoEquip=t.autoEquip),Array.isArray(t.stash)){const n=[];for(const s of t.stash){if(!s||typeof s!="object")continue;const{id:a,name:r,quantity:o}=s;if(typeof a!="string"||typeof r!="string")continue;const i=Number.isFinite(s.acquiredAt)?s.acquiredAt:this.now();n.push(Ds({id:a,name:r,description:s.description,icon:s.icon,rarity:s.rarity,quantity:o},i,{tableId:s.sourceTableId,entryId:s.sourceEntryId}))}this.stash=n.slice(0,this.maxStashSize)}if(Array.isArray(t.inventory)){const n=[];for(const s of t.inventory){if(!s||typeof s!="object")continue;const{id:a,name:r,quantity:o}=s;if(typeof a!="string"||typeof r!="string")continue;const i=Number.isFinite(s.acquiredAt)?s.acquiredAt:this.now();n.push(Ds({id:a,name:r,description:s.description,icon:s.icon,rarity:s.rarity,quantity:o},i,{tableId:s.sourceTableId,entryId:s.sourceEntryId}))}this.inventory=n}}}persist(){if(!this.storage)return;const t={autoEquip:this.autoEquip,stash:this.stash.map(n=>({...n})),inventory:this.inventory.map(n=>({...n}))};try{this.storage.setItem(this.storageKey,JSON.stringify(t))}catch(n){console.warn("Failed to persist inventory state",n)}}emit(t){for(const n of this.listeners)n(t)}normalizeEquipResult(t){return typeof t=="boolean"?{success:t}:!t||typeof t!="object"?{success:!1}:{success:!!t.success,comparison:t.comparison,reason:t.reason}}on(t){return this.listeners.add(t),()=>{this.listeners.delete(t)}}isAutoEquipEnabled(){return this.autoEquip}setAutoEquip(t){this.autoEquip!==t&&(this.autoEquip=t,this.persist(),this.emit({type:"settings-updated",autoEquip:this.autoEquip}))}getStash(){return this.stash.map(t=>({...t}))}getStashSize(){return this.stash.length}getInventory(){return this.inventory.map(t=>({...t}))}getInventorySize(){return this.inventory.length}addLoot(t,n={}){return this.addItem({...t.item},{...n,sourceTableId:n.sourceTableId,sourceEntryId:n.sourceEntryId??t.entryId})}addItem(t,n={}){const s=Math.max(0,Math.round(this.now())),a=Ds(t,s,{tableId:n.sourceTableId,entryId:n.sourceEntryId}),r=n.autoEquip??this.autoEquip;let o={success:!1};if(r&&n.unitId&&typeof n.equip=="function"){try{o=this.normalizeEquipResult(n.equip(n.unitId,a))}catch(i){console.warn("Failed to auto-equip inventory item",{item:a,error:i}),o={success:!1}}if(o.success)return this.persist(),this.emit({type:"item-acquired",item:a,equipped:!0,location:"equipped",unitId:n.unitId,stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:a,equipped:!0,location:"equipped"}}if(this.stash.push(a),this.stash.length>this.maxStashSize){const i=this.stash.splice(0,this.stash.length-this.maxStashSize);i.length>0&&console.warn("Inventory stash full, trimming oldest items",i)}return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-acquired",item:a,equipped:!1,unitId:n.unitId,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),{item:a,equipped:!1,location:"stash",stashIndex:this.stash.length-1}}equipFromStash(t,n,s){if(t<0||t>=this.stash.length)return!1;const a=this.stash[t];let r={success:!1};try{r=this.normalizeEquipResult(s(n,a))}catch(i){console.warn("Failed to equip stash item",{item:a,error:i}),r={success:!1}}if(!r.success)return!1;const[o]=this.stash.splice(t,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-equipped",item:o,unitId:n,from:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:r.comparison}),!0}equipFromInventory(t,n,s){if(t<0||t>=this.inventory.length)return!1;const a=this.inventory[t];let r={success:!1};try{r=this.normalizeEquipResult(s(n,a))}catch(i){console.warn("Failed to equip inventory item",{item:a,error:i}),r={success:!1}}if(!r.success)return!1;const[o]=this.inventory.splice(t,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-equipped",item:o,unitId:n,from:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length,comparison:r.comparison}),!0}moveToInventory(t){if(t<0||t>=this.stash.length)return null;const[n]=this.stash.splice(t,1);return this.inventory.push(n),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-moved",item:n,from:"stash",to:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),n}moveToStash(t){if(this.stash.length>=this.maxStashSize||t<0||t>=this.inventory.length)return null;const[n]=this.inventory.splice(t,1);return this.stash.push(n),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-moved",item:n,from:"inventory",to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),n}discardFromInventory(t){if(t<0||t>=this.inventory.length)return null;const[n]=this.inventory.splice(t,1);return this.persist(),this.emit({type:"inventory-updated",inventory:this.getInventory()}),this.emit({type:"item-discarded",item:n,location:"inventory",stashSize:this.stash.length,inventorySize:this.inventory.length}),n}unequipToStash(t,n,s){if(this.stash.length>=this.maxStashSize)return!1;let a=null;try{a=s(t,n)??null}catch(i){console.warn("Failed to unequip item",{unitId:t,slot:n,error:i}),a=null}if(!a)return!1;const r=Math.max(0,Math.round(this.now())),o=Ds(a,r);return this.stash.push(o),this.stash.length>this.maxStashSize&&this.stash.splice(0,this.stash.length-this.maxStashSize),this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-unequipped",item:o,unitId:t,slot:n,to:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),!0}discardFromStash(t){if(t<0||t>=this.stash.length)return null;const[n]=this.stash.splice(t,1);return this.persist(),this.emit({type:"stash-updated",stash:this.getStash()}),this.emit({type:"item-discarded",item:n,location:"stash",stashSize:this.stash.length,inventorySize:this.inventory.length}),n}}const lm={stash:"Quartermaster Stash",inventory:"Ready Inventory"},um={stash:"Your stash is empty. Conquer enemy elites to gather new equipment.",inventory:"No gear staged. Move items into the ready inventory for quick equipping."},dm={mythic:6,legendary:5,epic:4,rare:3,uncommon:2,common:1},hm=["health","attackDamage","attackRange","movementRange","defense","shield"],fm={"birch-sap-satchel":["healing","support"],"steamed-bandages":["restoration","shielding"],"aurora-distillate":["damage","defense"],"stolen-sauna-tokens":["mobility"],"midnight-bloodwine":["healing","damage"],"sauna-incense":["range","focus"],"glacier-brand":["damage"],"emberglass-arrow":["damage","range"],"aurora-lattice":["damage","range"],"emberglass-shard":["damage","mobility"],"windstep-totem":["mobility","defense"],"searing-chant-censer":["damage","shielding"],"cracked-ice-amulet":["defense"],"myrsky-charm":["range","defense"],"frostwyrm-signet":["shielding"],"spirit-oak-charm":["healing","defense"]};function Bt(e){return(e??"").trim().toLowerCase()}function Qa(e){const t=new Set;for(const n of e){const s=Bt(n);s&&t.add(s)}return t}function Na(e,t){return{id:e.id,name:e.name,quantity:typeof t=="number"?t:e.quantity,rarity:e.rarity}}function Is(e){return e?{id:e.id,name:e.name,quantity:e.quantity,rarity:e.rarity}:null}function Jo(e){return fm[e]??[]}function Wo(e){const t=Bt(e)||"common",n=t.charAt(0).toUpperCase()+t.slice(1);return{key:t,label:n,rank:dm[t]??0}}function mm(e){const t=cs(e.id);if(!t){const a=Wo(e.rarity);return{slot:null,slotLabel:"Unassigned",rarity:a.key,rarityRank:a.rank,tags:Jo(e.id),acquiredAt:e.acquiredAt}}const n=is(t.slot),s=Wo(e.rarity);return{slot:t.slot,slotLabel:n.label,rarity:s.key,rarityRank:s.rank,tags:Jo(e.id),acquiredAt:e.acquiredAt}}function gm(e,t,n,s,a){return{id:e.id,name:e.name,description:e.description,icon:e.icon,rarity:e.rarity,quantity:a,slot:t,maxStacks:n,modifiers:s??{}}}function $o(e,t){const n=e[t];return typeof n=="number"&&Number.isFinite(n)?Math.round(n):0}function pm(e,t){const n=cs(e.item.id);if(!n)return{slot:null,canEquip:!1,reason:"unknown-item",equipped:null,projected:Na(e.item),stats:[]};const s=n.slot,a=is(s),r=t.loadout.find(g=>g.slot===s)??null,o=Math.max(1,Math.round(e.item.quantity)),i=Math.max(1,Math.floor(n.maxStacks??a.maxStacks)),c=(r?.quantity??0)+o,u=c>i;if(r&&r.id!==e.item.id)return{slot:s,canEquip:!1,reason:"slot-occupied",equipped:Is(r),projected:Na(e.item),stats:[]};if(u&&(!r||r.id!==e.item.id))return{slot:s,canEquip:!1,reason:"stack-limit",equipped:Is(r),projected:Na(e.item,Math.min(i,c)),stats:[]};const l=Math.min(i,c),d=[];for(const g of t.loadout)g.slot!==s&&d.push({...g});const h=r&&r.id===e.item.id?{...r,quantity:l}:gm(e.item,s,i,n.modifiers,l);d.push(h);const f=t.currentStats??Ys(t.baseStats,t.loadout),m=Ys(t.baseStats,d),A=hm.map(g=>{const p=$o(f,g),b=$o(m,g);return{stat:g,current:p,projected:b,delta:b-p}});return{slot:s,canEquip:!0,equipped:Is(r),projected:Is(h),stats:A}}function ei(e,t){return e.map((n,s)=>({item:n,index:s,location:t,metadata:mm(n)}))}function Am(e,t){const n=new Map,s=new Map,a=new Map;for(const c of e){const{metadata:u}=c;if(u.slot){const f=u.slot,m=n.get(f);m?m.count+=1:n.set(f,{label:u.slotLabel,count:1})}const l=u.rarity,d=l.charAt(0).toUpperCase()+l.slice(1),h=s.get(l);h?h.count+=1:s.set(l,{label:d,count:1,rank:u.rarityRank});for(const f of u.tags){const m=Bt(f);if(!m)continue;const A=f.split(/[-_]/g).map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" "),g=a.get(m);g?g.count+=1:a.set(m,{label:A,count:1})}}const r=Array.from(n.entries()).sort((c,u)=>{const l=Pn.indexOf(c[0]),d=Pn.indexOf(u[0]);return l-d}).map(([c,u])=>({id:c,label:u.label,count:u.count,active:t.slots.has(Bt(c))})),o=Array.from(s.entries()).sort((c,u)=>(u[1].rank??0)-(c[1].rank??0)).map(([c,u])=>({id:c,label:u.label,count:u.count,active:t.rarities.has(Bt(c))})),i=Array.from(a.entries()).sort((c,u)=>c[1].label.localeCompare(u[1].label)).map(([c,u])=>({id:c,label:u.label,count:u.count,active:t.tags.has(Bt(c))}));return{slots:r,rarities:o,tags:i}}function vm(e,t){if(t.slots.size>0){const n=e.metadata.slot?Bt(e.metadata.slot):"";if(!n||!t.slots.has(n))return!1}return!(t.rarities.size>0&&!t.rarities.has(e.metadata.rarity)||t.tags.size>0&&!e.metadata.tags.map(a=>Bt(a)).some(a=>t.tags.has(a)))}function bm(e,t){return t?[e.item.name,e.item.description??"",e.metadata.tags.join(" ")].join(" ").toLowerCase().includes(t):!0}function wm(e,t){switch(t){case"oldest":e.sort((n,s)=>n.metadata.acquiredAt-s.metadata.acquiredAt);break;case"rarity":e.sort((n,s)=>s.metadata.rarityRank!==n.metadata.rarityRank?s.metadata.rarityRank-n.metadata.rarityRank:s.metadata.acquiredAt-n.metadata.acquiredAt);break;case"name":e.sort((n,s)=>n.item.name.localeCompare(s.item.name));break;case"newest":default:e.sort((n,s)=>s.metadata.acquiredAt-n.metadata.acquiredAt);break}}function ti(e){const t={slots:Qa(e.filters.slots??new Set),rarities:Qa(e.filters.rarities??new Set),tags:Qa(e.filters.tags??new Set)},n=Bt(e.search),s=Math.max(1,Math.floor(e.page||1)),a=Math.max(1,Math.floor(e.pageSize||24)),r=e.collection??"stash",o=ei(e.stash,"stash"),i=ei(e.inventory,"inventory"),c=[...o,...i],u=Am(c,t),l=r==="stash"?o:i,h=[...l.filter(C=>vm(C,t)&&bm(C,n))];wm(h,e.sort??"newest");const f=Math.min(h.length,s*a),m=h.slice(0,f),A=h.length>f,g=e.comparisonContext??null,p=m.map(C=>({item:C.item,index:C.index,location:C.location,metadata:C.metadata,comparison:g?pm(C,g):null})),b=["stash","inventory"].map(C=>({id:C,label:lm[C],count:C==="stash"?e.stash.length:e.inventory.length,active:C===r}));return{collection:r,collections:b,filters:u,items:p,total:l.length,filteredTotal:h.length,search:e.search,sort:e.sort??"newest",hasMore:A,emptyMessage:um[r]}}function ym(){return{slots:new Set,rarities:new Set,tags:new Set}}const Em="_panel_7op0d_1",Sm="_header_7op0d_32",Cm="_title_7op0d_42",xm="_meta_7op0d_49",Bm="_close_7op0d_54",Pm="_controls_7op0d_74",km="_settings_7op0d_82",Rm="_settingRow_7op0d_93",Mm="_settingCopy_7op0d_107",Dm="_settingLabel_7op0d_114",Im="_settingHint_7op0d_120",Tm="_settingControl_7op0d_127",Hm="_settingState_7op0d_133",Fm="_settingInput_7op0d_143",Lm="_settingSwitch_7op0d_149",Qm="_settingTrack_7op0d_169",Nm="_settingThumb_7op0d_181",Gm="_collections_7op0d_197",Om="_collectionButton_7op0d_205",jm="_searchRow_7op0d_234",Um="_search_7op0d_234",zm="_searchIcon_7op0d_266",Xm="_sortSelect_7op0d_276",qm="_body_7op0d_286",Ym="_grid_7op0d_292",Km="_empty_7op0d_301",Vm="_footer_7op0d_312",Zm="_loadMore_7op0d_317",ee={panel:Em,header:Sm,title:Cm,meta:xm,close:Bm,controls:Pm,settings:km,settingRow:Rm,settingCopy:Mm,settingLabel:Dm,settingHint:Im,settingControl:Tm,settingState:Hm,settingInput:Fm,settingSwitch:Lm,settingTrack:Qm,settingThumb:Nm,collections:Gm,collectionButton:Om,searchRow:jm,search:Um,searchIcon:zm,sortSelect:Xm,body:qm,grid:Ym,empty:Km,footer:Vm,loadMore:Zm},_m="_group_18afl_1",Jm="_label_18afl_11",Wm="_row_18afl_19",$m="_chip_18afl_25",eg="_count_18afl_55",$n={group:_m,label:Jm,row:Wm,chip:$m,count:eg},tg="_card_1o0cv_1",ng="_header_1o0cv_26",sg="_icon_1o0cv_32",ag="_details_1o0cv_44",rg="_titleRow_1o0cv_51",og="_title_1o0cv_51",ig="_rarity_1o0cv_63",cg="_slot_1o0cv_70",lg="_tags_1o0cv_75",ug="_tag_1o0cv_75",dg="_compare_1o0cv_91",hg="_tooltip_1o0cv_113",fg="_statList_1o0cv_144",mg="_stat_1o0cv_144",gg="_actions_1o0cv_169",pg="_action_1o0cv_169",Ag="_primary_1o0cv_198",vg="_danger_1o0cv_209",bg="_badge_1o0cv_224",ce={card:tg,header:ng,icon:sg,details:ag,titleRow:rg,title:og,rarity:ig,slot:cg,tags:lg,tag:ug,compare:dg,tooltip:hg,statList:fg,stat:mg,actions:gg,action:pg,primary:Ag,danger:vg,badge:bg},wg={health:"HP",attackDamage:"ATK",attackRange:"Range",movementRange:"Move",defense:"Defense",shield:"Shield"},ni={"slot-occupied":"Slot occupied. Unequip the current item first.","stack-limit":"Stack limit reached for this item.","unknown-item":"This item cannot be equipped yet."},Os=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function yg(e,t){if(t.item.icon){const s=document.createElement("img");s.src=t.item.icon,s.alt="",s.loading="lazy",s.decoding="async",s.width=48,s.height=48,e.appendChild(s);return}const n=document.createElement("span");n.textContent=t.item.name.trim()[0]?.toUpperCase()??"?",e.appendChild(n)}function kc(e){if(!(!e||e.canEquip))return e.reason&&ni[e.reason]?ni[e.reason]:"Unable to equip this item right now."}function Eg(e,t){const n=document.createElement("div");n.className=ce.tooltip;const s=document.createElement("h4");if(t.projected?s.textContent=t.canEquip?"Projected stats":"Current loadout":s.textContent="Stats",n.appendChild(s),!t.canEquip){const r=kc(t);if(r){const o=document.createElement("p");o.textContent=r,o.style.margin="0 0 0.5rem",o.style.fontSize="0.78rem",n.appendChild(o)}}const a=document.createElement("ul");a.className=ce.statList;for(const r of e){const o=document.createElement("li");o.className=ce.stat,r.delta>0?o.dataset.delta="positive":r.delta<0&&(o.dataset.delta="negative");const i=document.createElement("span");i.textContent=wg[r.stat]??r.stat;const c=document.createElement("span"),u=Os.format(r.current),l=Os.format(r.projected),d=r.delta,h=d===0?"±0":`${d>0?"+":"−"}${Os.format(Math.abs(d))}`;c.textContent=`${u} → ${l} (${h})`,o.append(i,c),a.appendChild(o)}return n.appendChild(a),n}function Sg(e){const t=e.comparison;if(!t)return null;const n=document.createElement("div"),s=document.createElement("button");s.type="button",s.className=ce.compare,s.textContent=t.canEquip?"Compare stats":"View details";const a=`${e.item.id}-compare-${e.location}-${e.index}`;s.setAttribute("aria-controls",a),s.setAttribute("aria-expanded","false"),s.setAttribute("aria-describedby",a),s.addEventListener("focus",()=>{s.setAttribute("aria-expanded","true")}),s.addEventListener("blur",()=>{s.setAttribute("aria-expanded","false")}),n.appendChild(s);const r=Eg(t.stats,t);return r.id=a,n.appendChild(r),n}function Cg(e,t){if(t&&!t.canEquip){e.disabled=!0;const n=kc(t);n&&(e.title=n)}}function xg(e){return e.map(t=>{const n=t.trim();return n&&n.split(/[-_\s]/g).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")})}function Bg(e,t,n){const s=document.createElement("div");s.className=ce.actions;const a=document.createElement("button");a.type="button",a.className=`${ce.action} ${ce.primary}`,a.textContent="Equip",Cg(a,t.comparison),a.addEventListener("click",()=>{n.onEquip?.()}),s.appendChild(a);const r=document.createElement("button");r.type="button",r.className=ce.action,r.textContent=t.location==="stash"?"Send to inventory":"Return to stash",r.addEventListener("click",()=>{n.onTransfer?.()}),s.appendChild(r);const o=document.createElement("button");o.type="button",o.className=`${ce.action} ${ce.danger}`,o.textContent="Trash";let i=null;const c=()=>{i!==null&&(window.clearTimeout(i),i=null),o.dataset.confirm="false",o.textContent="Trash"};o.addEventListener("click",()=>{if(i!==null){c(),n.onTrash?.();return}o.dataset.confirm="true",o.textContent="Confirm trash",i=window.setTimeout(()=>{c()},2600)}),s.appendChild(o),e.appendChild(s)}function Pg(e,t){const n=document.createElement("li");n.className=ce.card,n.dataset.location=e.location,n.setAttribute("role","listitem");const s=document.createElement("div");s.className=ce.header;const a=document.createElement("div");a.className=ce.icon,yg(a,e),s.appendChild(a);const r=document.createElement("div");r.className=ce.details;const o=document.createElement("div");o.className=ce.titleRow;const i=document.createElement("h4");i.className=ce.title,i.textContent=e.item.name,o.appendChild(i);const c=document.createElement("span");c.className=ce.rarity,c.textContent=e.metadata.rarity.toUpperCase(),o.appendChild(c),r.appendChild(o);const u=document.createElement("span");if(u.className=ce.slot,u.textContent=e.metadata.slot?e.metadata.slotLabel:"No slot",r.appendChild(u),e.metadata.tags.length>0){const d=document.createElement("div");d.className=ce.tags;for(const h of xg(e.metadata.tags)){const f=document.createElement("span");f.className=ce.tag,f.textContent=h,d.appendChild(f)}r.appendChild(d)}const l=Sg(e);if(l&&r.appendChild(l),s.appendChild(r),n.appendChild(s),e.item.quantity>1){const d=document.createElement("span");d.className=ce.badge,d.textContent=`×${Os.format(e.item.quantity)}`,n.appendChild(d)}return Bg(n,e,t),n}const kg={newest:"Newest",oldest:"Oldest",rarity:"Rarity",name:"Name A-Z"};function Ga(e){const t=document.createElement("div");t.className=$n.row;const n=document.createElement("div");n.className=$n.label,n.textContent=e;const s=document.createElement("div");return s.className=$n.group,t.append(n,s),{row:t,group:s}}function Rg(e){const t=document.createElement("section");t.className=ee.panel,t.tabIndex=-1,t.dataset.open="false",t.setAttribute("aria-label","Quartermaster stash");const n=document.createElement("header");n.className=ee.header;const s=document.createElement("div"),a=document.createElement("h2");a.className=ee.title,a.textContent="Quartermaster Stash",s.appendChild(a);const r=document.createElement("div");r.className=ee.meta,r.textContent="Loading…",s.appendChild(r);const o=document.createElement("button");o.type="button",o.className=ee.close,o.textContent="Close",o.addEventListener("click",()=>e.onClose?.()),n.append(s,o),t.appendChild(n);const i=document.createElement("div");i.className=ee.controls;const c=document.createElement("div");c.className=ee.collections;const u={stash:document.createElement("button"),inventory:document.createElement("button")};u.stash.type="button",u.stash.className=ee.collectionButton,u.stash.textContent="Stash",u.stash.addEventListener("click",()=>e.onCollectionChange?.("stash")),u.inventory.type="button",u.inventory.className=ee.collectionButton,u.inventory.textContent="Ready",u.inventory.addEventListener("click",()=>e.onCollectionChange?.("inventory")),c.append(u.stash,u.inventory),i.appendChild(c);const l=document.createElement("div");l.className=ee.searchRow;const d=document.createElement("div");d.className=ee.search;const h=document.createElement("input");h.type="search",h.placeholder="Search stash…",h.addEventListener("input",()=>e.onSearchChange?.(h.value));const f=document.createElement("span");f.className=ee.searchIcon,f.textContent="🔍",d.append(f,h),l.appendChild(d);const m=document.createElement("select");m.className=ee.sortSelect,["newest","oldest","rarity","name"].forEach(y=>{const M=document.createElement("option");M.value=y,M.textContent=kg[y],m.appendChild(M)}),m.addEventListener("change",()=>e.onSortChange?.(m.value)),l.appendChild(m),i.appendChild(l);const A=document.createElement("div");A.className=ee.settings;const g=(y,M,x,O)=>{const N=document.createElement("div");N.className=ee.settingRow;const U=document.createElement("div");U.className=ee.settingCopy;const J=document.createElement("span");J.className=ee.settingLabel,J.textContent=M,U.appendChild(J);const $=document.createElement("p");$.className=ee.settingHint,$.textContent=x,U.appendChild($);const V=document.createElement("div");V.className=ee.settingControl;const ae=document.createElement("span");ae.className=ee.settingState,ae.textContent="Off";const re=document.createElement("input");re.type="checkbox",re.id=y,re.className=ee.settingInput;const W=document.createElement("label");W.className=ee.settingSwitch,W.htmlFor=y,W.dataset.state="off";const ie=document.createElement("span");ie.className=ee.settingTrack;const me=document.createElement("span");me.className=ee.settingThumb,W.append(ie,me);const ve=be=>{re.checked=be,W.dataset.state=be?"on":"off",ae.textContent=be?"On":"Off"};return re.addEventListener("change",()=>{ve(re.checked),O?.(re.checked)}),V.append(ae,re,W),N.append(U,V),{root:N,setChecked:ve}},p=g("inventory-autoequip-toggle","Auto-equip loot","Try outfitting the selected attendant as soon as new gear arrives.",y=>e.onAutoEquipChange?.(y)),b=g("inventory-ui-variant-toggle","Experimental HUD","Swap to the React/Tailwind HUD. You can revert at any time.",y=>e.onUiV2Change?.(y));p.setChecked(e.getAutoEquipState?.()??!1),b.setChecked(e.getUiV2State?.()??!1),A.append(p.root,b.root),i.appendChild(A);const C=document.createElement("div"),S={slots:Ga("Slots"),rarities:Ga("Rarity"),tags:Ga("Tags")};C.append(S.slots.row,S.rarities.row,S.tags.row),i.appendChild(C),t.appendChild(i);const F=document.createElement("div");F.className=ee.body;const H=document.createElement("ul");H.className=ee.grid;const T=document.createElement("div");T.className=ee.empty,T.textContent="No items match the current filters.",T.hidden=!0,F.append(H,T),t.appendChild(F);const Q=document.createElement("div");Q.className=ee.footer;const I=document.createElement("button");I.type="button",I.className=ee.loadMore,I.textContent="Show more",I.addEventListener("click",()=>e.onLoadMore?.()),Q.appendChild(I),t.appendChild(Q);function B(y,M,x){y.group.innerHTML="",y.row.hidden=x.length===0;for(const O of x){const N=document.createElement("button");if(N.type="button",N.className=$n.chip,N.dataset.active=O.active?"true":"false",N.textContent=O.label,O.count>0){const U=document.createElement("span");U.className=$n.count,U.textContent=String(O.count),N.appendChild(U)}N.addEventListener("click",()=>e.onFilterToggle?.(M,O.id)),y.group.appendChild(N)}}function w(y){H.replaceChildren();const M=document.createDocumentFragment();for(const x of y.items){const O={onEquip:()=>e.onItemEquip?.(x),onTransfer:()=>e.onItemTransfer?.(x),onTrash:()=>e.onItemTrash?.(x)};M.appendChild(Pg(x,O))}H.appendChild(M),T.hidden=y.filteredTotal!==0,T.hidden||(T.textContent=y.emptyMessage)}return{element:t,render(y){r.textContent=y.total===0?"No items yet":`${y.filteredTotal} of ${y.total} item${y.total===1?"":"s"}`;for(const[M,x]of Object.entries(u))x.dataset.active=M===y.collection?"true":"false";h.value!==y.search&&(h.value=y.search),m.value!==y.sort&&(m.value=y.sort),B(S.slots,"slots",y.filters.slots),B(S.rarities,"rarities",y.filters.rarities),B(S.tags,"tags",y.filters.tags),w(y),I.hidden=!y.hasMore},setOpen(y){t.dataset.open=y?"true":"false"},focus(){const y=t.focus.bind(t);try{y({preventScroll:!0})}catch(M){console.warn("Stash panel focus without scroll prevention fallback",M);try{y()}catch(x){console.warn("Unable to focus stash panel element",x)}}},destroy(){t.remove()},setAutoEquip(y){p.setChecked(y)},setUiV2(y){b.setChecked(y)}}}const Oa=24,Mg=4500,Dg=400,Ig={health:"HP",attackDamage:"ATK",attackRange:"RNG",movementRange:"MOV",defense:"DEF",shield:"Shield"};function Tg(e,t){const n=e.querySelector(".loot-toast-stack");if(n)return n.parentElement!==t&&t.appendChild(n),n;const a=(e.ownerDocument??document).createElement("div");return a.classList.add("loot-toast-stack"),a.setAttribute("aria-live","polite"),a.setAttribute("role","status"),t.appendChild(a),a}function He(e,t,n){const s=document.createElement("div");s.classList.add("loot-toast"),s.dataset.variant=n,s.textContent=t,e.appendChild(s);const a=window.setTimeout(()=>{s.classList.add("loot-toast--exit"),window.setTimeout(()=>s.remove(),Dg)},Mg);s.addEventListener("click",()=>{window.clearTimeout(a),s.remove()})}function Hg(e,t){e.has(t)?e.delete(t):e.add(t)}function Fg(e){const t=e.comparison?.deltas??[];return t.length===0?null:t.map(s=>{const a=Ig[s.stat]??s.stat;return`${s.delta>0?"+":""}${s.delta} ${a}`}).join(", ")}function ja(e){switch(e){case"inventory":return"ready inventory";case"stash":return"stash";case"equipped":default:return"loadout"}}function Lg(){const e=document.createElement("button");e.type="button",e.classList.add("inventory-badge"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-controls","inventory-stash-panel"),e.setAttribute("aria-label","Open quartermaster stash");const t=document.createElement("span");t.classList.add("inventory-badge__icon"),t.setAttribute("aria-hidden","true");const n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg");s.setAttribute("viewBox","0 0 24 24"),s.setAttribute("aria-hidden","true"),s.setAttribute("focusable","false"),s.classList.add("inventory-badge__svg");const a=document.createElementNS(n,"path");a.setAttribute("d","M8.25 7V6a3.75 3.75 0 0 1 7.5 0v1m3 0h-14.25a1.5 1.5 0 0 0-1.485 1.342l-.75 9a3 3 0 0 0 2.985 3.158h9.78a3 3 0 0 0 2.985-3.158l-.75-9A1.5 1.5 0 0 0 18.75 7Z"),a.classList.add("inventory-badge__icon-outline");const r=document.createElementNS(n,"path");r.setAttribute("d","M9.75 12.25h4.5"),r.classList.add("inventory-badge__icon-detail"),s.append(a,r),t.appendChild(s),e.appendChild(t);const o=document.createElement("span");o.classList.add("inventory-badge__text"),o.textContent="Stash",e.appendChild(o);const i=document.createElement("span");return i.classList.add("inventory-badge__count"),i.textContent="0",i.setAttribute("aria-hidden","true"),e.appendChild(i),{button:e,count:i}}function Qg(e,t={}){const n=document.getElementById("ui-overlay");if(!n)return{destroy:()=>{}};const{regions:s}=us(n),a=s.top,r=Tg(n,a);n.querySelectorAll(".inventory-badge").forEach(v=>v.remove());const{button:o,count:i}=Lg();o.dataset.autoequip=e.isAutoEquipEnabled()?"on":"off",a.appendChild(o),n.querySelector("#inventory-stash-panel")?.remove();const u=Rg({onClose:()=>g(!1),onCollectionChange:v=>{d!==v&&(d=v,A=1,b())},onFilterToggle:(v,y)=>{const M=h[v];Hg(M,y),A=1,b()},onSearchChange:v=>{f=v,A=1,b()},onSortChange:v=>{m=v,A=1,b()},onLoadMore:()=>{A+=1,b()},onItemEquip:v=>{S(v)},onItemTransfer:v=>{F(v)},onItemTrash:v=>{H(v)},getAutoEquipState:()=>e.isAutoEquipEnabled(),onAutoEquipChange:v=>{e.setAutoEquip(v),o.dataset.autoequip=v?"on":"off",He(r,v?"Auto-equip enabled. Newly recovered gear will try to arm your selected attendant.":"Auto-equip disabled. Loot will head to the stash until you equip it manually.","info")},getUiV2State:()=>t.getUseUiV2?.()??!1,onUiV2Change:v=>{t.onUseUiV2Change?.(v),He(r,v?"Experimental HUD enabled. Reload to try the React/Tailwind experience.":"Classic HUD restored for your next session.","info")}});u.element.id="inventory-stash-panel",n.appendChild(u.element);let l=!1,d="stash";const h=ym();let f="",m="newest",A=1;function g(v){if(l!==v)if(l=v,u.setOpen(l),o.setAttribute("aria-expanded",l?"true":"false"),o.setAttribute("aria-label",l?"Close quartermaster stash":"Open quartermaster stash"),l){n.classList.add("inventory-panel-open");try{u.focus()}catch(y){console.warn("Unable to focus stash panel",y)}}else n.classList.remove("inventory-panel-open")}function p(){const v=t.getComparisonContext?.()??null;let y=ti({stash:e.getStash(),inventory:e.getInventory(),filters:h,search:f,sort:m,page:A,pageSize:Oa,collection:d,comparisonContext:v});if(y.filteredTotal>0){const M=Math.max(1,Math.ceil(y.filteredTotal/Oa));A>M&&(A=M,y=ti({stash:e.getStash(),inventory:e.getInventory(),filters:h,search:f,sort:m,page:A,pageSize:Oa,collection:d,comparisonContext:v}))}return y}function b(){const v=p(),M=v.collections.find(x=>x.id==="stash")?.count??0;i.textContent=String(M),o.dataset.count=String(M),u.render(v)}function C(){const v=t.getSelectedUnitId?.()??null;return v||(He(r,"Select an attendant before equipping an item.","warn"),null)}function S(v){const y=C();if(!y)return;const M=t.onEquip??(()=>({success:!1}));(v.location==="stash"?e.equipFromStash(v.index,y,(N,U)=>M(N,U,"stash")):e.equipFromInventory(v.index,y,(N,U)=>M(N,U,"inventory")))||He(r,"Unable to equip that item right now.","warn")}function F(v){const y=v.location==="stash"?e.moveToInventory(v.index):e.moveToStash(v.index);if(!y){He(r,"Unable to move that item right now.","warn");return}const M=v.location==="stash"?"ready inventory":"stash";He(r,`Moved ${y.name} to the ${M}.`,"info"),A=1,b()}function H(v){const y=v.location==="stash"?e.discardFromStash(v.index):e.discardFromInventory(v.index);if(!y){He(r,"That item was already removed.","warn");return}const M=v.location==="stash"?"stash":"ready inventory";He(r,`${y.name} discarded from the ${M}.`,"warn"),b()}function T(v){switch(v.type){case"stash-updated":case"inventory-updated":b();break;case"item-acquired":if(v.equipped)He(r,`${v.item.name} auto-equipped successfully.`,"info");else{const y=ja(v.location);He(r,`New item secured: ${v.item.name} (${y}).`,"loot")}break;case"item-equipped":{const y=Fg(v),M=y?` (${y})`:"";He(r,`Equipped ${v.item.name}${M}.`,"info");break}case"item-unequipped":He(r,`${v.item.name} returned to the stash from slot ${v.slot}.`,"info");break;case"item-moved":{const y=ja(v.to);He(r,`Moved ${v.item.name} to the ${y}.`,"info");break}case"item-discarded":{const y=ja(v.location);He(r,`${v.item.name} discarded from the ${y}.`,"warn");break}case"settings-updated":o.dataset.autoequip=v.autoEquip?"on":"off",u.setAutoEquip(v.autoEquip);break}}const Q=e.on(v=>T(v)),I=()=>{g(!l)};o.addEventListener("click",I);const B=v=>{v.defaultPrevented||v.code==="KeyI"&&!v.metaKey&&!v.ctrlKey&&!v.altKey&&(v.preventDefault(),g(!l))};return window.addEventListener("keydown",B),b(),{destroy:()=>{Q(),o.removeEventListener("click",I),window.removeEventListener("keydown",B),o.remove(),u.destroy(),n.classList.remove("inventory-panel-open"),r.hasChildNodes()||r.remove()}}}const Ng=Object.freeze({common:1,uncommon:.6,rare:.35,epic:.18,legendary:.08,mythic:.03}),Gg=Object.freeze({id:"general-salvage",label:"General Salvage",entries:Object.freeze([{id:"birch-sap-satchel",name:"Birch Sap Satchel",description:"Soothing birch sap that doubles as a brisk field tonic.",rarity:"common",quantity:{min:1,max:3},weight:6},{id:"steamed-bandages",name:"Steamed Linen Bandages",description:"Freshly steamed bandages infused with pine oils.",rarity:"common",quantity:1,weight:5},{id:"emberglass-shard",name:"Emberglass Shard",description:"A radiant shard used to kindle sauna braziers.",rarity:"uncommon",quantity:1,weight:3},{id:"aurora-distillate",name:"Aurora Distillate",description:"Vials of shimmering condensation that empower sauna rituals.",rarity:"rare",quantity:1,weight:1.5},{id:"myrsky-charm",name:"Myrsky Charm",description:"Storm-forged charm rumored to call down aurora flares.",rarity:"epic",quantity:1,weight:.7}])}),Og=Object.freeze({base:Object.freeze({id:"enemy-raiders",label:"Avanto Marauder Spoils",entries:Object.freeze([{id:"cracked-ice-amulet",name:"Cracked Ice Amulet",description:"Necklace of frostbitten charms that hum when danger nears.",rarity:"common",quantity:1,weight:5},{id:"stolen-sauna-tokens",name:"Stolen Sauna Tokens",description:"Pilfered entrance tokens, gladly accepted back at any sauna hall.",rarity:"uncommon",quantity:{min:2,max:5},weight:3},{id:"glacier-brand",name:"Glacier Brand",description:"A cleaver chilled in glacial meltwater that never dulls.",rarity:"rare",quantity:1,weight:1.25}])}),elite:Object.freeze({id:"enemy-champions",label:"Avanto Champion Cache",entries:Object.freeze([{id:"frostwyrm-signet",name:"Frostwyrm Signet",description:"An icy signet ring that wreathes its bearer in frozen vapour.",rarity:"epic",quantity:1,weight:1.1},{id:"aurora-lattice",name:"Aurora Lattice",description:"Filigree latticework that channels auroral light into focused beams.",rarity:"legendary",quantity:1,weight:.4},{id:"midnight-bloodwine",name:"Midnight Bloodwine",description:"A mythical draught said to rekindle a warrior's lost resolve.",rarity:"mythic",quantity:1,weight:.12}])})}),jg=Object.freeze({base:Object.freeze({id:"deepwood-offerings",label:"Deepwood Offerings",entries:Object.freeze([{id:"spirit-oak-charm",name:"Spirit Oak Charm",description:"Carved from living oak, it whispers guidance between sauna rounds.",rarity:"uncommon",quantity:1,weight:4},{id:"sauna-incense",name:"Sauna Incense Pouches",description:"Fragrant blends that steady breathing before the next engagement.",rarity:"common",quantity:{min:1,max:4},weight:5},{id:"emberglass-arrow",name:"Emberglass Arrow Bundle",description:"Arrowheads that glow amber when a perfect shot reveals itself.",rarity:"rare",quantity:{min:1,max:2},weight:1.75}])}),elite:Object.freeze({id:"deepwood-ritual-cache",label:"Deepwood Ritual Cache",entries:Object.freeze([{id:"windstep-totem",name:"Windstep Totem",description:"Totem etched with gale sigils that lighten every cautious stride.",rarity:"epic",quantity:1,weight:.9},{id:"searing-chant-censer",name:"Searing Chant Censer",description:"An ornate censer that empowers allies with smouldering hymns.",rarity:"legendary",quantity:1,weight:.35}])})}),Ug=Object.freeze({enemy:Og,deepwood:jg});function zg(e){return Ug[e]??{base:Gg}}function Xg(e,t=!1){const n=zg(e);return t&&n.elite?n.elite:n.base}function qg(e){if(!Number.isFinite(e))return 1;const t=Math.floor(e);return t<=0?0:Math.min(10,t)}function Yg(e,t){if(typeof e=="number"&&Number.isFinite(e))return Math.max(1,Math.round(e));if(!e)return 1;const n=e,s=Math.max(1,Math.round(n.min)),r=Math.max(s,Math.round(n.max))-s+1,o=Math.floor(Math.max(0,Math.min(.999999,t()))*r);return s+o}function Kg(e){const t=Ng[e.rarity]??1,n=typeof e.weight=="number"?e.weight:1;return Math.max(0,n)*Math.max(0,t)}function Vg(e,t){const n=e.map(o=>({entry:o,weight:Kg(o)})).filter(o=>o.weight>0);if(n.length===0)return null;const s=n.reduce((o,i)=>o+i.weight,0),a=Math.max(0,Math.min(.999999,t()))*s;let r=0;for(const o of n)if(r+=o.weight,a<r)return o.entry;return n[n.length-1]?.entry??null}function Zg(e,t){return{id:e.id,name:e.name,description:e.description,icon:e.icon,rarity:e.rarity,quantity:t}}function _g(e){const t=typeof e.random=="function"?e.random:Math.random,n=!!e.elite,s=e.table??Xg(e.factionId,n),a=qg(e.rolls),r=[];if(a<=0||s.entries.length===0)return{factionId:e.factionId,elite:n,tableId:s.id,tableLabel:s.label,rolls:r};for(let o=0;o<a;o+=1){const i=Vg(s.entries,t);if(!i)break;const c=Yg(i.quantity,t);r.push({entryId:i.id,rarity:i.rarity,quantity:c,item:Zg(i,c)})}return{factionId:e.factionId,elite:n,tableId:s.id,tableLabel:s.label,rolls:r}}const Jg="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23a4d67a'%20/%3e%3cpolygon%20points='16,48%2032,16%2048,48'%20fill='%23d2691e'%20/%3e%3crect%20x='24'%20y='32'%20width='16'%20height='16'%20fill='%23f4a460'%20/%3e%3c/svg%3e",Wg="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23c0c0c0'%20/%3e%3crect%20x='8'%20y='24'%20width='48'%20height='24'%20fill='%23808080'%20/%3e%3crect%20x='24'%20y='16'%20width='16'%20height='8'%20fill='%23606060'%20/%3e%3c/svg%3e",$g="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%23e0e0e0'%20/%3e%3crect%20x='10'%20y='22'%20width='12'%20height='30'%20fill='%23a9a9a9'%20/%3e%3crect%20x='26'%20y='14'%20width='12'%20height='38'%20fill='%23808080'%20/%3e%3crect%20x='42'%20y='26'%20width='12'%20height='26'%20fill='%23a9a9a9'%20/%3e%3c/svg%3e",ep="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3crect%20width='64'%20height='64'%20fill='%238b4513'%20/%3e%3cpolygon%20points='32,10%2042,22%2022,22'%20fill='%23555'%20/%3e%3crect%20x='30'%20y='22'%20width='4'%20height='32'%20fill='%23ccc'%20/%3e%3c/svg%3e",tp="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eFrostguard%20Soldier%3c/title%3e%3cdesc%20id='desc'%3eArmored%20nordic%20soldier%20with%20glacial%20blade,%20frosted%20shield,%20and%20aurora%20glow.%3c/desc%3e%3cdefs%3e%3clinearGradient%20id='soldier-bg'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%230b2a44'%20/%3e%3cstop%20offset='100%25'%20stop-color='%2310243b'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-glow'%20cx='50%25'%20cy='28%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='rgba(191,%20219,%20254,%200.85)'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(14,%20116,%20144,%200)'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='soldier-armor'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e2e8f0'%20/%3e%3cstop%20offset='50%25'%20stop-color='%23cbd5f5'%20/%3e%3cstop%20offset='100%25'%20stop-color='%234b5563'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-trim'%20x1='0'%20y1='0'%20x2='1'%20y2='0'%3e%3cstop%20offset='0%25'%20stop-color='%23fcd34d'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23f97316'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-cloak'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%231e3a8a'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231d4ed8'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='soldier-steel'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%2394a3b8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231f2937'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='soldier-shield'%20cx='38%25'%20cy='38%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='70%25'%20stop-color='%2360a5fa'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231d4ed8'%20/%3e%3c/radialGradient%3e%3c/defs%3e%3crect%20width='128'%20height='128'%20rx='18'%20fill='url(%23soldier-bg)'%20/%3e%3ccircle%20cx='64'%20cy='40'%20r='44'%20fill='url(%23soldier-glow)'%20opacity='0.9'%20/%3e%3cellipse%20cx='64'%20cy='108'%20rx='36'%20ry='10'%20fill='%230f172a'%20opacity='0.4'%20/%3e%3cpath%20d='M38%2038c-10%2014-14%2032-10%2052l14%208c0-18%208-34%2022-42-8-6-18-12-26-18z'%20fill='url(%23soldier-cloak)'%20opacity='0.85'%20/%3e%3cpath%20d='M90%2038c10%2014%2014%2032%2010%2052l-14%208c0-18-8-34-22-42%208-6%2018-12%2026-18z'%20fill='url(%23soldier-cloak)'%20opacity='0.65'%20/%3e%3cpath%20d='M58%2022l-8%2010c-4%206-6%2014-6%2022v20l12%2038h16l12-38V54c0-8-2-16-6-22l-8-10h-12z'%20fill='url(%23soldier-armor)'%20stroke='%231f2937'%20stroke-width='2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M50%2054h28l4%2012c-8%208-16%2012-18%2012s-10-4-18-12l4-12z'%20fill='%23e0f2fe'%20opacity='0.85'%20/%3e%3cpath%20d='M64%2022c-6%200-12%204-16%2010l6%208c6-6%2020-6%2026%200l6-8c-4-6-10-10-16-10z'%20fill='%23f8fafc'%20stroke='%23cbd5f5'%20stroke-width='1.5'%20/%3e%3cpath%20d='M58%2018h12l4%206-10%206-10-6%204-6z'%20fill='%23e0f2fe'%20stroke='%2394a3b8'%20stroke-width='1.5'%20/%3e%3crect%20x='46'%20y='68'%20width='12'%20height='26'%20rx='5'%20fill='%230ea5e9'%20opacity='0.8'%20/%3e%3crect%20x='70'%20y='68'%20width='12'%20height='26'%20rx='5'%20fill='%2338bdf8'%20opacity='0.8'%20/%3e%3cpath%20d='M34%2066l-10%206%2012%2028%2012-6-14-28z'%20fill='url(%23soldier-shield)'%20stroke='%231e3a8a'%20stroke-width='2'%20/%3e%3ccircle%20cx='36'%20cy='78'%20r='6'%20fill='rgba(226,%20232,%20240,%200.95)'%20/%3e%3cpath%20d='M94%2064l-4-4-18%2036%206%206%2016-38z'%20fill='url(%23soldier-steel)'%20stroke='%230f172a'%20stroke-width='2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M86%2054l-16%2034%2010%204%2014-32-8-6z'%20fill='%23f8fafc'%20opacity='0.75'%20/%3e%3cpath%20d='M64%2090c-8%200-14%206-18%2014%208%204%2012%206%2018%206s10-2%2018-6c-4-8-10-14-18-14z'%20fill='%23dbeafe'%20stroke='%2393c5fd'%20stroke-width='1.5'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M54%2058l-6%2012c8%2010%2016%2014%2016%2014s8-4%2016-14l-6-12H54z'%20fill='url(%23soldier-trim)'%20opacity='0.85'%20/%3e%3cpath%20d='M60%2048h8l2%208-6%204-6-4%202-8z'%20fill='%23334155'%20/%3e%3ccircle%20cx='64'%20cy='52'%20r='6'%20fill='%23f1f5f9'%20stroke='%23cbd5f5'%20stroke-width='1'%20/%3e%3cpath%20d='M58%2038c-4%200-6%204-6%2010%204-2%208-4%2012-4s8%202%2012%204c0-6-2-10-6-10H58z'%20fill='%231f2937'%20opacity='0.85'%20/%3e%3c/svg%3e",np="/assets/archer-DKJNMRtW.svg",sp="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%20role='img'%20aria-labelledby='title%20desc'%3e%3ctitle%20id='title'%3eAvanto%20Marauder%3c/title%3e%3cdesc%20id='desc'%3eFrost-clad%20marauder%20icon%20with%20jagged%20pauldrons,%20icy%20beard,%20and%20polar%20glow.%3c/desc%3e%3cdefs%3e%3clinearGradient%20id='bg'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23082f49'%20/%3e%3cstop%20offset='100%25'%20stop-color='%230f172a'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='armor'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e2e8f0'%20/%3e%3cstop%20offset='60%25'%20stop-color='%2394a3b8'%20/%3e%3cstop%20offset='100%25'%20stop-color='%231f2937'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='beard'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23e0f2fe'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23bae6fd'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='glow'%20cx='50%25'%20cy='20%25'%20r='60%25'%3e%3cstop%20offset='0%25'%20stop-color='rgba(191,%20219,%20254,%200.85)'%20/%3e%3cstop%20offset='100%25'%20stop-color='rgba(14,%20116,%20144,%200)'%20/%3e%3c/radialGradient%3e%3c/defs%3e%3crect%20width='128'%20height='128'%20rx='20'%20fill='url(%23bg)'%20/%3e%3ccircle%20cx='64'%20cy='46'%20r='38'%20fill='url(%23glow)'%20opacity='0.85'%20/%3e%3cpath%20d='M64%2018c-14%200-26%208-32%2020l10%204c6-8%2014-12%2022-12s16%204%2022%2012l10-4C90%2026%2078%2018%2064%2018z'%20fill='%23cffafe'%20opacity='0.4'%20/%3e%3cpath%20d='M64%2036c-14%200-28%2010-28%2028v10l-12%2016%2018%2010%2022-10%2022%2010%2018-10-12-16V64c0-18-14-28-28-28z'%20fill='url(%23armor)'%20stroke='%230f172a'%20stroke-width='2'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M48%2090l-12%206-10%2020%2020-8%2018%208%2018-8%2020%208-10-20-12-6'%20fill='%230f172a'%20opacity='0.85'%20/%3e%3cpath%20d='M64%2046c-10%200-18%208-18%2018v10c12-8%2024-8%2036%200V64c0-10-8-18-18-18z'%20fill='%230f172a'%20/%3e%3cpath%20d='M64%2050c-8%200-14%206-14%2014%206-4%2012-6%2014-6s8%202%2014%206c0-8-6-14-14-14z'%20fill='%23bae6fd'%20opacity='0.85'%20/%3e%3cpath%20d='M58%2084c-4%200-8%202-10%206%204%200%208%200%2010-2s4-2%206-2%204%200%206%202%206%202%2010%202c-2-4-6-6-10-6h-12z'%20fill='%23f8fafc'%20opacity='0.75'%20/%3e%3cpath%20d='M64%2086c-6%200-12%204-14%2010%204%202%2010%204%2014%204s10-2%2014-4c-2-6-8-10-14-10z'%20fill='url(%23beard)'%20stroke='%23bae6fd'%20stroke-width='1.4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M42%2064c-4-8-6-18-6-28-6%208-10%2018-10%2030%204-2%2010-2%2016-2z'%20fill='%230ea5e9'%20opacity='0.5'%20/%3e%3cpath%20d='M86%2064c4-8%206-18%206-28%206%208%2010%2018%2010%2030-4-2-10-2-16-2z'%20fill='%230ea5e9'%20opacity='0.5'%20/%3e%3cpath%20d='M34%2098c-6%202-12%206-14%2012%206%200%2012-2%2018-4'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3cpath%20d='M94%20106c6%202%2012%204%2018%204-2-6-8-10-14-12'%20stroke='%23bae6fd'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/svg%3e",zn="/",St={saunaBeer:`${zn}assets/ui/sauna-beer.svg`,saunojaRoster:`${zn}assets/ui/saunoja-roster.svg`,resource:`${zn}assets/ui/resource.svg`,sisu:`${zn}assets/ui/resource.svg`,sound:`${zn}assets/ui/sound.svg`},ap={images:{placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=","building-farm":Jg,"building-barracks":Wg,"building-city":$g,"building-mine":ep,"unit-soldier":tp,"unit-archer":np,"unit-avanto-marauder":sp,"icon-sauna-beer":St.saunaBeer,"icon-saunoja-roster":St.saunojaRoster,"icon-resource":St.resource,"icon-sound":St.sound}};let Rc=null;function rp(e){Rc=e}function Mc(){return Rc}const op=["city"],ip=1e4,cp=12e3;function lp(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function si(e){return Object.freeze({strongholds:{...e.strongholds},roster:{...e.roster},economy:{...e.economy},sauna:{...e.sauna},startedAt:e.startedAt})}function ai(e){const t={[k.SAUNA_BEER]:0,[k.SAUNAKUNNIA]:0,[k.SISU]:0};return Object.values(k).forEach(n=>{t[n]=e.getResource(n)}),t}class up{timeSource;state;map;getRosterCount;sauna;strongholdTypes;rosterGraceMs;bankruptcyGraceMs;progress;startResources;strongholds=new Map;progressListeners=new Set;resolutionListeners=new Set;mapDisposer=null;rosterTimeout=null;bankruptcyTimeout=null;bankruptSince=null;wipeSince=null;saunaDestroyedAt=null;resolution=null;disposed=!1;constructor(t){this.timeSource=typeof t.timeSource=="function"?t.timeSource:lp,this.state=t.state,this.map=t.map,this.getRosterCount=t.getRosterCount,this.sauna=t.sauna??null;const n=t.strongholdTypes?.length?t.strongholdTypes:op;this.strongholdTypes=new Set(n),this.rosterGraceMs=Math.max(0,t.rosterWipeGraceMs??ip),this.bankruptcyGraceMs=Math.max(0,t.bankruptcyGraceMs??cp),this.startResources=ai(this.state);const s=this.state.getResource(k.SAUNA_BEER),a=Math.max(0,Math.round(this.getRosterCount()))||0;this.progress={strongholds:{total:0,destroyed:0,remaining:0},roster:{active:a,totalDeaths:0,wipeSince:null,wipeDurationMs:0},economy:{beer:s,worstBeer:s,bankruptSince:null,bankruptDurationMs:0},sauna:this.createSaunaProgress(),startedAt:this.timeSource()},this.bootstrapStrongholds(),this.attachMapListener(),this.attachEventListeners(),this.emitProgress(),this.evaluateResolution()}onProgress(t){this.progressListeners.add(t)}offProgress(t){this.progressListeners.delete(t)}onResolution(t){if(this.resolution){t(this.resolution);return}this.resolutionListeners.add(t)}offResolution(t){this.resolutionListeners.delete(t)}getProgress(){return si(this.progress)}dispose(){if(!this.disposed){if(this.disposed=!0,this.clearRosterTimer(),this.clearBankruptcyTimer(),this.mapDisposer){try{this.mapDisposer()}catch(t){console.warn("Failed to detach map listener",t)}this.mapDisposer=null}R.off("unitDied",this.handleUnitDied),R.off("unitSpawned",this.handleUnitSpawned),R.off("resourceChanged",this.handleResourceChanged),R.off("saunaDamaged",this.handleSaunaDamaged),R.off("saunaDestroyed",this.handleSaunaDestroyed)}}bootstrapStrongholds(){this.map.forEachTile((t,n)=>{if(this.isStronghold(t.building)){const s=this.coordKey(n);this.strongholds.set(s,{alive:!0})}}),this.updateStrongholdTotals()}attachMapListener(){this.mapDisposer=this.map.addTileChangeListener((t,n,s)=>{if(s!=="building"&&s!=="created")return;const a=this.coordKey(t),r=this.strongholds.get(a);this.isStronghold(n.building)?r?r.alive||(r.alive=!0):this.strongholds.set(a,{alive:!0}):r?.alive&&(r.alive=!1),this.updateStrongholdTotals(),this.emitProgress(),this.evaluateResolution()})}attachEventListeners(){R.on("unitDied",this.handleUnitDied),R.on("unitSpawned",this.handleUnitSpawned),R.on("resourceChanged",this.handleResourceChanged),R.on("saunaDamaged",this.handleSaunaDamaged),R.on("saunaDestroyed",this.handleSaunaDestroyed)}handleUnitDied=({unitFaction:t})=>{t==="player"&&(this.progress.roster.totalDeaths+=1,this.refreshRosterStatus(),this.emitProgress(),this.evaluateResolution())};handleUnitSpawned=({unit:t})=>{t.faction==="player"&&(this.refreshRosterStatus(),this.emitProgress())};handleResourceChanged=({resource:t,total:n})=>{t===k.SAUNA_BEER&&(this.progress.economy.beer=n,n<this.progress.economy.worstBeer&&(this.progress.economy.worstBeer=n),n<0?this.bankruptSince===null&&(this.bankruptSince=this.timeSource(),this.progress.economy.bankruptSince=this.bankruptSince,this.startBankruptcyTimer()):(this.updateBankruptcyDuration(),this.bankruptSince=null,this.progress.economy.bankruptSince=null,this.clearBankruptcyTimer()),this.emitProgress())};handleSaunaDamaged=({remainingHealth:t})=>{this.disposed||(this.updateSaunaSnapshot(t),this.emitProgress())};handleSaunaDestroyed=t=>{this.disposed||(this.markSaunaDestroyed(),this.emitProgress(),this.resolve("lose","saunaDestroyed"))};startBankruptcyTimer(){if(this.bankruptcyTimeout===null){if(this.bankruptcyGraceMs<=0){this.resolve("lose","bankruptcy");return}this.bankruptcyTimeout=setTimeout(()=>{this.updateBankruptcyDuration(),this.resolve("lose","bankruptcy")},this.bankruptcyGraceMs)}}clearBankruptcyTimer(){this.bankruptcyTimeout!==null&&(clearTimeout(this.bankruptcyTimeout),this.bankruptcyTimeout=null)}startRosterTimer(){if(this.rosterTimeout===null){if(this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.rosterTimeout=setTimeout(()=>{this.updateRosterDuration(),this.resolve("lose","rosterWipe")},this.rosterGraceMs)}}clearRosterTimer(){this.rosterTimeout!==null&&(clearTimeout(this.rosterTimeout),this.rosterTimeout=null)}updateStrongholdTotals(){const t=this.strongholds.size;let n=0;for(const s of this.strongholds.values())s.alive&&(n+=1);this.progress.strongholds.total=t,this.progress.strongholds.remaining=n,this.progress.strongholds.destroyed=Math.max(0,t-n)}refreshRosterStatus(){const t=Math.max(0,Math.round(this.getRosterCount()));this.progress.roster.active=t,t<=0?(this.wipeSince===null&&(this.wipeSince=this.timeSource(),this.progress.roster.wipeSince=this.wipeSince),this.startRosterTimer()):(this.updateRosterDuration(),this.wipeSince=null,this.progress.roster.wipeSince=null,this.clearRosterTimer())}updateBankruptcyDuration(){if(this.bankruptSince===null)return;const t=this.timeSource()-this.bankruptSince;t>this.progress.economy.bankruptDurationMs&&(this.progress.economy.bankruptDurationMs=t)}updateRosterDuration(){if(this.wipeSince===null)return;const t=this.timeSource()-this.wipeSince;t>this.progress.roster.wipeDurationMs&&(this.progress.roster.wipeDurationMs=t)}evaluateResolution(){if(!this.resolution){if(this.progress.sauna.destroyed){this.resolve("lose","saunaDestroyed");return}if(this.progress.strongholds.total>0&&this.progress.strongholds.remaining===0){this.resolve("win","strongholds");return}if(this.wipeSince!==null&&this.rosterGraceMs<=0){this.resolve("lose","rosterWipe");return}this.bankruptSince!==null&&this.bankruptcyGraceMs<=0&&this.resolve("lose","bankruptcy")}}resolve(t,n){if(this.resolution)return;this.updateRosterDuration(),this.updateBankruptcyDuration();const s=this.timeSource(),a=Math.max(0,s-this.progress.startedAt),r=si({...this.progress,roster:{...this.progress.roster,wipeSince:this.wipeSince},economy:{...this.progress.economy,bankruptSince:this.bankruptSince},sauna:{...this.progress.sauna,destroyedAt:this.saunaDestroyedAt}}),o=this.computeRewards();this.resolution=Object.freeze({outcome:t,cause:n,timestamp:s,durationMs:a,summary:r,rewards:o}),this.emitResolution(),this.dispose()}emitProgress(){const t=this.getProgress();for(const n of this.progressListeners)try{n(t)}catch(s){console.error("Objective progress listener failed",s)}}emitResolution(){if(!this.resolution)return;const t=this.resolution;for(const n of this.resolutionListeners)try{n(t)}catch(s){console.error("Objective resolution listener failed",s)}this.resolutionListeners.clear()}computeRewards(){const t=ai(this.state);return{resources:{[k.SAUNA_BEER]:{final:t[k.SAUNA_BEER],delta:t[k.SAUNA_BEER]-this.startResources[k.SAUNA_BEER]},[k.SAUNAKUNNIA]:{final:t[k.SAUNAKUNNIA],delta:t[k.SAUNAKUNNIA]-this.startResources[k.SAUNAKUNNIA]},[k.SISU]:{final:t[k.SISU],delta:t[k.SISU]-this.startResources[k.SISU]}}}}coordKey(t){return`${t.q},${t.r}`}isStronghold(t){return t?this.strongholdTypes.has(t):!1}createSaunaProgress(){if(!this.sauna)return{maxHealth:0,health:0,destroyed:!1,destroyedAt:null};const t=Math.max(0,Math.round(this.sauna.maxHealth??0)),n=Math.max(0,Math.round(this.sauna.health??0)),s=!!this.sauna.destroyed||n<=0;return s&&this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),{maxHealth:t,health:n,destroyed:s,destroyedAt:s?this.saunaDestroyedAt:null}}updateSaunaSnapshot(t){const n=Number.isFinite(t)?Math.max(0,Math.round(t)):0,s=this.sauna?Math.max(0,Math.round(this.sauna.maxHealth??0)):0,a=this.progress.sauna.maxHealth,r=Math.max(a,s,n);this.progress.sauna.maxHealth=r;const o=Math.max(0,Math.min(r,n));this.progress.sauna.health=o,o>0&&(this.progress.sauna.destroyed=!1,this.progress.sauna.destroyedAt=null,this.saunaDestroyedAt=null)}markSaunaDestroyed(){if(this.sauna){const t=Math.max(0,Math.round(this.sauna.maxHealth??0));t>this.progress.sauna.maxHealth&&(this.progress.sauna.maxHealth=t)}this.progress.sauna.health=0,this.progress.sauna.destroyed=!0,this.saunaDestroyedAt===null&&(this.saunaDestroyedAt=this.timeSource()),this.progress.sauna.destroyedAt=this.saunaDestroyedAt}}function dp(e){return new up(e)}const _e=[{level:1,xpToNext:180,cumulativeXp:0,statAwards:{vigor:0,focus:0,resolve:0}},{level:2,xpToNext:220,cumulativeXp:180,statAwards:{vigor:5,focus:2,resolve:1}},{level:3,xpToNext:260,cumulativeXp:400,statAwards:{vigor:4,focus:3,resolve:1}},{level:4,xpToNext:320,cumulativeXp:660,statAwards:{vigor:4,focus:2,resolve:2}},{level:5,xpToNext:380,cumulativeXp:980,statAwards:{vigor:6,focus:3,resolve:2}},{level:6,xpToNext:460,cumulativeXp:1360,statAwards:{vigor:7,focus:3,resolve:3}},{level:7,xpToNext:540,cumulativeXp:1820,statAwards:{vigor:6,focus:4,resolve:3}},{level:8,xpToNext:640,cumulativeXp:2360,statAwards:{vigor:7,focus:4,resolve:4}},{level:9,xpToNext:760,cumulativeXp:3e3,statAwards:{vigor:8,focus:5,resolve:4}},{level:10,xpToNext:900,cumulativeXp:3760,statAwards:{vigor:9,focus:6,resolve:5}},{level:11,xpToNext:1060,cumulativeXp:4660,statAwards:{vigor:10,focus:6,resolve:6}},{level:12,xpToNext:null,cumulativeXp:5720,statAwards:{vigor:12,focus:7,resolve:6}}];function hp(e){return Number.isNaN(e)||!Number.isFinite(e)?0:Math.max(0,Math.floor(e))}function cr(){return{vigor:0,focus:0,resolve:0}}function fp(e){return{vigor:e.vigor,focus:e.focus,resolve:e.resolve}}function na(e){const t=hp(e);let n=_e[0];for(const o of _e)if(t>=o.cumulativeXp)n=o;else break;const s=t-n.cumulativeXp,a=n.xpToNext,r=a?Math.min(1,s/a):1;return{level:n.level,xpIntoLevel:s,xpForNext:a,progressToNext:r,statAwards:n.statAwards}}function mp(e){const t=_e[_e.length-1].level,n=Math.max(_e[0].level,Math.min(e,t)),s=_e.find(a=>a.level===n);return s?fp(s.statAwards):cr()}function gp(e){if(e<=_e[0].level)return cr();const t=_e[_e.length-1].level,n=Math.min(e,t),s=cr();for(const a of _e){if(a.level>n)break;a.level!==_e[0].level&&(s.vigor+=a.statAwards.vigor,s.focus+=a.statAwards.focus,s.resolve+=a.statAwards.resolve)}return s}function pp(e){return na(e).level}function Ua(e){return Number.isFinite(e)?Math.max(0,Math.floor(e)):0}function Ts(e,t){return t<=0?"":`${e}/${t}`}function Ap(e){let t=0;const n=Math.max(0,Ua(e.queueCapacity??2)),s=o=>{o&&typeof e.log=="function"&&e.log(o)},a=()=>{const o=e.getTier();if(!o)return null;const i=Ua(e.getRosterLimit()),c=Ua(e.getRosterCount());return{tierId:o.id,tierName:o.name,rosterLimit:i,rosterCount:c,queued:t}};return{getSnapshot:()=>a(),hasQueuedSpawn:()=>t>0,takeQueuedSpawn:o=>t<=0?!1:(t-=1,t<=0?s(`The benches of ${o.tierName} exhale — queued attendants take the field.`):s(`${o.tierName} deploys a queued attendant. Relief teams remaining: ${Ts(t,n)}.`),!0),restoreQueuedSpawn:o=>{n>0&&t>=n||(t+=1,n>0&&(t=Math.min(t,n)),s(`${o.tierName} keeps the relief attendant on standby (${Ts(t,n)} ready).`))},queueBlockedSpawn:(o,i)=>n>0&&t>=n?(s(`${o.tierName} cannot hold more relief attendants — clear a slot to vent the pressure.`),!1):i()?(t+=1,n>0&&(t=Math.min(t,n)),s(`${o.tierName} queues a ready attendant in the wings (${Ts(t,n)} poised).`),!0):!1,onSpawnResolved:(o,i)=>{i.usedQueue&&(t>0?s(`${o.tierName} still has relief attendants waiting (${Ts(t,n)}).`):s(`${o.tierName} has cleared the relief queue.`))},clearQueue:o=>{if(!(t<=0)&&(t=0,o==="tier-change")){const i=e.getTier();i&&s(`${i.name} ushers its queued attendants into the new hall.`)}}}}const Dc="autobattles:saunojas";function Ic(){try{return globalThis.localStorage??null}catch{return null}}function vp(){const e=Ic();if(!e)return[];try{const t=e.getItem(Dc);if(!t)return[];const n=JSON.parse(t);if(!Array.isArray(n))return[];const s=[];for(const a of n){if(!a||typeof a!="object")continue;const r=a,o=r.id;if(typeof o!="string"||o.length===0)continue;const i=r.coord,c=i&&typeof i=="object"&&typeof i.q=="number"&&Number.isFinite(i.q)&&typeof i.r=="number"&&Number.isFinite(i.r)?{q:i.q,r:i.r}:void 0,u=r.traits,l=Array.isArray(u)?u.filter(f=>typeof f=="string"):void 0,d=typeof r.upkeep=="number"?r.upkeep:void 0,h=typeof r.xp=="number"?r.xp:void 0;s.push(Sr({id:o,name:typeof r.name=="string"?r.name:void 0,coord:c,maxHp:typeof r.maxHp=="number"?r.maxHp:void 0,hp:typeof r.hp=="number"?r.hp:void 0,steam:typeof r.steam=="number"?r.steam:void 0,traits:l,upkeep:d,xp:h,selected:!!r.selected,items:Array.isArray(r.items)?r.items:void 0,baseStats:r.baseStats,effectiveStats:r.effectiveStats,equipment:r.equipment,modifiers:Array.isArray(r.modifiers)?r.modifiers:void 0}))}return s}catch(t){return console.warn("Failed to load Saunoja units from storage",t),[]}}function bp(e){const t=Ic();if(t)try{const n=e.map(s=>({id:s.id,name:s.name,coord:{q:s.coord.q,r:s.coord.r},maxHp:s.maxHp,hp:s.hp,steam:s.steam,traits:[...s.traits],upkeep:s.upkeep,xp:s.xp,selected:s.selected,baseStats:{health:s.baseStats.health,attackDamage:s.baseStats.attackDamage,attackRange:s.baseStats.attackRange,movementRange:s.baseStats.movementRange,...typeof s.baseStats.defense=="number"&&Number.isFinite(s.baseStats.defense)?{defense:s.baseStats.defense}:{},...typeof s.baseStats.shield=="number"&&Number.isFinite(s.baseStats.shield)?{shield:s.baseStats.shield}:{},...typeof s.baseStats.visionRange=="number"&&Number.isFinite(s.baseStats.visionRange)?{visionRange:s.baseStats.visionRange}:{}},effectiveStats:{health:s.effectiveStats.health,attackDamage:s.effectiveStats.attackDamage,attackRange:s.effectiveStats.attackRange,movementRange:s.effectiveStats.movementRange,...typeof s.effectiveStats.defense=="number"&&Number.isFinite(s.effectiveStats.defense)?{defense:s.effectiveStats.defense}:{},...typeof s.effectiveStats.shield=="number"&&Number.isFinite(s.effectiveStats.shield)?{shield:s.effectiveStats.shield}:{},...typeof s.effectiveStats.visionRange=="number"&&Number.isFinite(s.effectiveStats.visionRange)?{visionRange:s.effectiveStats.visionRange}:{}},equipment:Pn.reduce((a,r)=>{const o=s.equipment?.[r]??null;return a[r]=o?{id:o.id,name:o.name,description:o.description,icon:o.icon,rarity:o.rarity,quantity:o.quantity,slot:o.slot}:null,a},{}),items:s.items.map(a=>({id:a.id,name:a.name,description:a.description,icon:a.icon,rarity:a.rarity,quantity:a.quantity})),modifiers:s.modifiers.map(a=>({id:a.id,name:a.name,description:a.description,remaining:a.remaining,duration:a.duration,appliedAt:a.appliedAt,stacks:a.stacks,source:a.source}))}));t.setItem(Dc,JSON.stringify(n))}catch(n){console.warn("Failed to persist Saunoja units",n)}}const Tc="autobattles:sauna-settings";function Hc(){try{return globalThis.localStorage??null}catch{return null}}function wp(e){return typeof e=="string"?gt(e).id:ls}function ri(e){return Number.isFinite(e)?Math.max(0,Math.floor(e)):0}function Mr(e,t){const n=ri(e),s=ri(t),a=1+ca;return Math.max(0,Math.min(a,n,s))}function Fc(e,t,n){const s=Mr(n,n),a=typeof e=="number"&&Number.isFinite(e)?e:t,r=Math.max(0,Math.floor(a));return Math.max(0,Math.min(s,r))}function Lc(e){return e===!0||e==="true"}function Xn(e,t){const n=wp(e?.activeTierId),s=gt(n),a=Mr(s.rosterCap,t);return{activeTierId:s.id,maxRosterSize:Fc(e?.maxRosterSize,a,a),useUiV2:Lc(e?.useUiV2)}}function Qc(e=1+ca){const t=Hc();if(!t)return Xn(null,e);try{const n=t.getItem(Tc);if(!n)return Xn(null,e);const s=JSON.parse(n);return Xn(!s||typeof s!="object"?null:s,e)}catch(n){return console.warn("Failed to load sauna settings from storage",n),Xn(null,e)}}function Nc(e){const t=Hc();if(!t)return;const n=gt(e.activeTierId),s=Mr(n.rosterCap,n.rosterCap),a={activeTierId:n.id,maxRosterSize:Fc(e.maxRosterSize,s,s),useUiV2:Lc(e.useUiV2)};try{t.setItem(Tc,JSON.stringify(a))}catch(r){console.warn("Failed to persist sauna settings",r)}}const yp=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),Ep=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function Gc(e){return Number.isFinite(e)?Math.max(0,Math.min(100,Math.round(e*100))):0}function Sp(e){const t=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});if(e.xpForNext===null)return`${t.format(e.xp)} XP • Max level`;const n=Gc(e.progress);return`${t.format(e.xpIntoLevel)} / ${t.format(e.xpForNext)} XP • ${n}%`}function Cp(e){const t=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}),n=[];return e.vigor>0&&n.push(`+${t.format(e.vigor)} Vigor`),e.focus>0&&n.push(`+${t.format(e.focus)} Focus`),e.resolve>0&&n.push(`+${t.format(e.resolve)} Resolve`),n.length>0?n.join(" • "):"No level bonuses yet"}function xp(e,t){const{rosterIcon:n,summaryLabel:s="Saunoja Roster"}=t;e.classList.add("sauna-roster"),e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("title","Active sauna battalion on the field"),e.dataset.tutorialTarget="upkeep",e.replaceChildren();const a=document.createElement("div");a.classList.add("sauna-roster__summary");const r=document.createElement("img");r.src=n,r.alt="Saunoja roster crest",r.decoding="async",r.classList.add("sauna-roster__icon");const o=document.createElement("div");o.classList.add("sauna-roster__text");const i=document.createElement("span");i.textContent=s,i.classList.add("sauna-roster__label");const c=document.createElement("span");c.textContent="0",c.classList.add("sauna-roster__value"),o.append(i,c),a.append(r,o);const u=document.createElement("div");u.classList.add("saunoja-card"),u.setAttribute("aria-live","polite"),u.hidden=!0;const l=document.createElement("div");l.classList.add("saunoja-card__header");const d=document.createElement("div");d.classList.add("saunoja-card__level"),d.setAttribute("role","img"),d.style.setProperty("--level-progress","0%");const h=document.createElement("span");h.classList.add("saunoja-card__level-value"),h.textContent="1",d.appendChild(h);const f=document.createElement("div");f.classList.add("saunoja-card__identity");const m=document.createElement("h3");m.classList.add("saunoja-card__name"),m.textContent="Saunoja";const A=document.createElement("div");A.classList.add("saunoja-card__xp"),A.textContent="0 / 0 XP • 0%",f.append(m,A),l.append(d,f);const g=document.createElement("p");g.classList.add("saunoja-card__traits");const p=document.createElement("div");p.classList.add("saunoja-card__callouts"),p.textContent="No level bonuses yet";const b=document.createElement("p");b.classList.add("saunoja-card__upkeep"),u.append(l,g,p,b),e.append(a,u);let C=null,S=null;function F(w){if(!w){u.hidden=!0;return}u.hidden=!1,u.dataset.unitId=w.id,m.textContent=w.name||"Saunoja";const v=w.traits.filter($=>$.length>0),y=v.length>0?v.join(", "):"No notable traits yet";g.textContent=y,g.title=y;const M=Sp(w.progression);A.textContent=M,A.title=M;const x=Gc(w.progression.progress);d.style.setProperty("--level-progress",`${x}%`),h.textContent=String(w.progression.level);const O=w.progression.xpForNext===null?`Level ${w.progression.level}, at mastery`:`Level ${w.progression.level}, ${x}% toward next level`;d.setAttribute("aria-label",O);const N=Cp(w.progression.statBonuses);p.textContent=N,p.title=N;const U=Math.max(0,Math.round(w.upkeep)),J=`Upkeep: ${Ep.format(U)} Beer`;b.textContent=J,b.title=J}function H(w){return w===1/0?"inf":!Number.isFinite(w)||w<=0?"0":String(Math.ceil(w))}function T(w){return[w.id,w.name,w.icon??"",w.rarity??"",w.description??"",w.quantity].join("^")}function Q(w){return[w.id,w.name,w.description??"",H(w.duration),H(w.remaining),w.appliedAt??"",w.stacks??1,w.source??""].join("^")}function I(w){const{stats:v}=w,y=w.traits.join("|"),M=w.items.map(T).join("|"),x=w.modifiers.map(Q).join("|");return[w.id,w.name,w.upkeep,w.status,w.selected?1:0,w.progression.level,w.progression.xp,w.progression.xpIntoLevel,w.progression.xpForNext??"max",v.health,v.maxHealth,v.attackDamage,v.attackRange,v.movementRange,v.defense??0,v.shield??0,y,M,x].join("~")}function B(w){return`${w.length}:${w.map(I).join("||")}`}return{updateSummary(w){const v=Math.max(0,Math.floor(w.count)),y=yp.format(v);c.textContent=y,e.setAttribute("aria-label",`Saunoja roster: ${y} active attendants`),e.setAttribute("title",`Saunoja roster • ${y} active attendants`),F(w.card)},installRenderer(w){S=null,C=w},renderRoster(w){if(!C)return;const v=B(w);v!==S&&(S=v,C(w))},destroy(){C=null,S=null,e.replaceChildren()}}}const Bp={[k.SAUNA_BEER]:"Sauna Beer",[k.SAUNAKUNNIA]:"Saunakunnia",[k.SISU]:"Sisu"},Pp='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function kp(e){if(!Number.isFinite(e)||e<=0)return"0:00";const t=Math.round(e/1e3),n=Math.max(0,t%60).toString().padStart(2,"0"),s=Math.floor(t/60),a=(s%60).toString().padStart(2,"0"),r=Math.floor(s/60);return r>0?`${r}:${a}:${n}`:`${s}:${n}`}function Rp(e){switch(e.cause){case"strongholds":return"All rival strongholds have fallen.";case"rosterWipe":return"Every attendant is down—no one remains to hold the line.";case"bankruptcy":return"Upkeep debts have exhausted the steam reserves.";case"saunaDestroyed":return"The sauna collapsed under relentless assault—the sacred steamline has fallen silent.";default:return""}}function Mp(e){if(!Number.isFinite(e)||e===0)return"±0";const t=Math.round(e*100)/100;return`${t>0?"+":""}${t}`}function Dp(e,t){const n=document.createElement("ul");n.className="end-screen__rewards-list";for(const s of Object.values(k)){const a=e.rewards.resources[s];if(!a)continue;const r=document.createElement("li");r.className="end-screen__reward-item";const o=document.createElement("span");o.className="end-screen__reward-label",o.textContent=t[s]??s;const i=document.createElement("span");i.className="end-screen__reward-value",i.textContent=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(a.final));const c=document.createElement("span");c.className="end-screen__reward-delta",c.textContent=Mp(a.delta),c.dataset.polarity=a.delta>=0?"positive":"negative",r.append(o,i,c),n.append(r)}return n}function Ip(e,t,n){const s=a=>{if(a.key==="Escape"){a.preventDefault(),n?.();return}if(a.key!=="Tab")return;const r=t.querySelectorAll(Pp);if(r.length===0){a.preventDefault(),t.focus();return}const o=r[0],i=r[r.length-1],c=document.activeElement;a.shiftKey?(c===o||!t.contains(c))&&(a.preventDefault(),i.focus()):(c===i||!t.contains(c))&&(a.preventDefault(),o.focus())};return e.addEventListener("keydown",s),()=>e.removeEventListener("keydown",s)}function Tp(e){const{container:t,resolution:n,onNewRun:s,onDismiss:a,currentNgPlusLevel:r}=e;if(!t)return{destroy(){},focusPrimary(){}};const o={...Bp,...e.resourceLabels??{}},i=document.createElement("div");i.className="end-screen",i.setAttribute("role","presentation");const c=document.createElement("section");c.className="end-screen__panel",c.setAttribute("role","dialog"),c.setAttribute("aria-modal","true");const u=`end-screen-title-${Date.now()}`;c.setAttribute("aria-labelledby",u),c.tabIndex=-1,c.dataset.outcome=n.outcome;const l=document.createElement("h2");l.className="end-screen__title",l.id=u,l.textContent=n.outcome==="win"?"Steamforged Victory":"Sauna Lost";const d=document.createElement("p");d.className="end-screen__subtitle",d.textContent=Rp(n);const h=document.createElement("dl");h.className="end-screen__metrics";const f=(Q,I)=>{const B=document.createElement("dt");B.textContent=Q,B.className="end-screen__metric-label";const w=document.createElement("dd");w.textContent=I,w.className="end-screen__metric-value",h.append(B,w)};f("Run time",kp(n.durationMs)),f("Strongholds",`${n.summary.strongholds.destroyed}/${n.summary.strongholds.total}`),f("Roster losses",`${n.summary.roster.totalDeaths}`),f("Deepest beer reserve",`${Math.round(n.summary.economy.worstBeer)}`);const m=document.createElement("div");m.className="end-screen__badges";const A=document.createElement("span");A.className="end-screen__badge",A.textContent=`NG+ ${Math.max(0,r)}`,m.append(A);const g=document.createElement("h3");g.className="end-screen__section-title",g.textContent="Rewards";const p=Dp(n,o),b=document.createElement("div");b.className="end-screen__actions";const C=document.createElement("button");C.type="button",C.className="end-screen__button end-screen__button--primary",C.textContent="New run (NG+)",C.addEventListener("click",()=>{s()});const S=document.createElement("button");S.type="button",S.className="end-screen__button",S.textContent="Review battlefield",S.addEventListener("click",()=>{a?.()}),b.append(C,S),c.append(l,d,m,h,g,p,b),i.append(c),t.append(i);const F=Ip(i,c,a),H=()=>{F(),i.remove()},T=()=>{requestAnimationFrame(()=>{C.focus({preventScroll:!0})})};return T(),{destroy:H,focusPrimary:T}}const Oc="autobattles4x.flags";function jc(){if(typeof window>"u")return null;try{if("localStorage"in window&&window.localStorage)return window.localStorage}catch(e){console.warn("Unable to access localStorage for local flags",e)}return null}function Uc(){const e=jc();if(!e)return{};try{const t=e.getItem(Oc);if(!t)return{};const n=JSON.parse(t);if(n&&typeof n=="object")return n}catch(t){console.warn("Failed to parse local flags, resetting.",t)}return{}}function Hp(e){const t=jc();if(t)try{const n={};e.tutorial_done&&(n.tutorial_done=!0),t.setItem(Oc,JSON.stringify(n))}catch(n){console.warn("Failed to persist local flags",n)}}function Fp(){return Uc().tutorial_done===!0}function oi(e){const t={...Uc()};t.tutorial_done=!0,Hp(t)}const ii=200,ci=3,Lp=2,li=6,Qp=40,Np=250,Gp=200,Op=pp(Number.MAX_SAFE_INTEGER),lr={[k.SAUNA_BEER]:"Sauna Beer",[k.SAUNAKUNNIA]:"Saunakunnia",[k.SISU]:"Sisu"};function zc(e,t){const n=Number.isFinite(t)?Math.max(0,Math.floor(t)):0;if(!Number.isFinite(e))return n;const s=Math.max(0,Math.floor(e));return Math.max(0,Math.min(n,s))}let Ce=Ct(Dl()),Xc=1,Dr=0,ma=1,js={aggressionMultiplier:1,cadenceMultiplier:1,strengthMultiplier:1},qc=1,Yc=Math.random,Kc=Math.random,Ir=null;function sa(e){Ce=Ct(e),Xc=Tl(Ce),Dr=Hl(Ce),ma=Ll(Ce),js=Ql(Ce),qc=Fl(Ce),Yc=Zr(Ce.runSeed,1),Kc=Zr(Ce.runSeed,2),Ir?.({persist:!0})}sa(Ce);let aa=null,te=[];const mt=new Map,Ot=new Map,an=new Map;let ui=0,ra=null,xe=()=>{},ht=null,It=null,We=null,Sn=null,Ae=null,tn=null,es=null,Pt=null,jt=null,nn=!1,ze=null,Ut=null,lt=null,ts=null,$t=0;function Vc(e){const t=Ot.get(e.id);return t?an.get(t)??null:null}function Zc(e,t){e.effectiveStats={...t},e.maxHp=Math.max(1,Math.round(t.health)),e.hp=Math.min(e.maxHp,Math.max(0,Math.round(e.hp))),e.defense=typeof t.defense=="number"?Math.max(0,t.defense):void 0,e.shield=typeof t.shield=="number"?Math.max(0,t.shield):0;const n=Vc(e);if(n){const s={health:e.effectiveStats.health,attackDamage:e.effectiveStats.attackDamage,attackRange:e.effectiveStats.attackRange,movementRange:e.effectiveStats.movementRange};typeof e.effectiveStats.defense=="number"&&(s.defense=e.effectiveStats.defense),typeof e.effectiveStats.visionRange=="number"&&(s.visionRange=e.effectiveStats.visionRange),n.updateStats(s),typeof e.effectiveStats.shield=="number"?n.setShield(e.effectiveStats.shield):e.shield<=0&&n.setShield(0)}}function ga(e,t){const n=t??Je(e.equipment),s=Ys(e.baseStats,n);return Zc(e,s),s}function _c(e){const t=na(e.xp);return{level:t.level,xp:Math.max(0,Math.floor(e.xp)),xpIntoLevel:t.xpIntoLevel,xpForNext:t.xpForNext,progress:t.progressToNext,statBonuses:gp(t.level)}}function jp(e){const t=[];return e.vigor>0&&t.push(`+${e.vigor} Vigor`),e.focus>0&&t.push(`+${e.focus} Focus`),e.resolve>0&&t.push(`+${e.resolve} Resolve`),t.length>0?t.join(", "):"+0 Vigor, +0 Focus, +0 Resolve"}function Jc(e,t,n){if(!Number.isFinite(t)||t<=0)return null;const s=na(e.xp),a=Math.max(0,Math.floor(e.xp+t));if(a===e.xp)return null;e.xp=a;const r=na(e.xp),o=Math.max(0,r.level-s.level),i={vigor:0,focus:0,resolve:0};let c=0;if(o>0){for(let l=s.level+1;l<=r.level&&l<=Op;l++){const d=mp(l);i.vigor+=d.vigor,i.focus+=d.focus,i.resolve+=d.resolve;const h=Number.isFinite(e.baseStats.health)?e.baseStats.health:e.effectiveStats.health;e.baseStats.health=Math.max(1,Math.round(h+d.vigor));const f=Number.isFinite(e.baseStats.attackDamage)?e.baseStats.attackDamage:e.effectiveStats.attackDamage;e.baseStats.attackDamage=Math.max(0,Math.round(f+d.focus));const A=(Number.isFinite(e.baseStats.defense)?e.baseStats.defense??0:e.effectiveStats.defense??0)+d.resolve;e.baseStats.defense=A>0?A:void 0}c=i.vigor}c>0&&(e.hp+=c),ga(e);const u=Vc(e);if(u&&u.setExperience(e.xp),n.source==="kill"){const l=e.name?.trim()||"Our champion",d=n.label?.trim()||"their foe",h=n.boss?" Boss toppled!":n.elite?" Elite threat routed!":"";xe(`${l} earns ${t} XP for defeating ${d}.${h}`)}if(o>0){const l=jp(i),d=e.name?.trim()||"Our champion";xe(`${d} reaches Level ${r.level}! ${l}.`)}return{xpAwarded:t,totalXp:e.xp,level:r.level,levelsGained:o,statBonuses:i}}function Up(e,t,n){if(!e)return null;const s=mt.get(e.id);return s?Jc(s,t,n):null}function zp(e,t){if(!Number.isFinite(e)||e<=0)return!1;let n=!1;for(const s of te)Jc(s,e,t)&&(n=!0);return n}function Xp(e){return e?(e.type?.toLowerCase?.()??"").includes("boss")?{xp:Np,elite:!0,boss:!0}:dl(e)?{xp:Qp,elite:!0,boss:!1}:{xp:li,elite:!1,boss:!1}:{xp:li,elite:!1,boss:!1}}const Wc=e=>{if(!e)return;const t=Math.max(0,Math.floor(e.strongholds.destroyed));if(t>$t){const n=t-$t,s=Gp*n;zp(s,{source:"objective",label:"stronghold"})&&(pt(),$e(),xe(`Strategists toast the captured stronghold — roster gains ${s} XP.`))}if(t<$t){$t=t;return}$t=t},qp=Object.freeze(["health","attackDamage","attackRange","movementRange","defense","shield"]);function di(e){return e?{id:e.id,name:e.name,quantity:e.quantity,rarity:e.rarity}:null}function hi(e,t){const n=e[t];return typeof n=="number"&&Number.isFinite(n)?Math.round(n):0}function Yp(e,t){const n=[];for(const s of qp){const a=hi(t,s),r=hi(e,s),o=a-r;o!==0&&n.push({stat:s,delta:o})}return n}function Kp(e,t){if(!t||Je(e.equipment).length>0)return;const s={health:Math.max(1,Math.round(t.getMaxHealth())),attackDamage:Math.max(0,Math.round(t.stats.attackDamage)),attackRange:Math.max(0,Math.round(t.stats.attackRange)),movementRange:Math.max(0,Math.round(t.stats.movementRange)),defense:typeof t.stats.defense=="number"&&Number.isFinite(t.stats.defense)?Math.max(0,t.stats.defense):e.baseStats.defense,shield:e.baseStats.shield??0,visionRange:typeof t.stats.visionRange=="number"&&Number.isFinite(t.stats.visionRange)?Math.max(0,t.stats.visionRange):e.baseStats.visionRange};e.baseStats=s,ga(e)}function Yn(){ts&&(ts.destroy(),ts=null)}function Vp(){if(Fp()){Yn();return}Yn(),ts=Ph({onComplete:()=>{oi(),Yn()},onSkip:()=>{oi(),Yn()}}),ts.start()}function fi(e){es=e,Ae&&(Ae.installRenderer(e),Pt&&(Ae.renderRoster(Pt),Pt=null))}function Zp(){return vp()}function pt(){bp(te)}function _p(e=Math.random){typeof e!="function"&&(e=Math.random);const t=Math.max(0,Math.floor(wn)),n=Math.max(t,Math.floor(Ns));if(n===t)return Math.max(wn,Math.min(Ns,t));const s=n-t+1,a=Math.floor(e()*s)+t;return Math.max(wn,Math.min(Ns,a))}function Jp(e){const n=(Array.isArray(e.traits)?e.traits:[]).length>=3,s=Number.isFinite(e.upkeep),a=Number.isFinite(e.xp);return!n||!s||!a}function $c(e){e.traits=nm(),e.upkeep=_p(),e.xp=0}function Wp(e,t,n,s={}){const a=s.hudVariant??"classic",r=a==="classic";n.dataset.hudVariant=a,aa=e,ze&&(ze.dispose(),ze=null),ze=Zf({canvas:e,overlay:n,mapRenderer:Tr,getUnitById:o=>an.get(o),requestDraw:()=>{Be()}}),Ae&&(Ae.destroy(),Ae=null),r?(Ae=xp(t,{rosterIcon:St.saunojaRoster}),es&&Ae.installRenderer(es),Pt&&(Ae.renderRoster(Pt),Pt=null),tn&&(Ae.updateSummary(tn),tn=null)):(es=null,Pt=null,tn=null),We?.dispose(),We=null,r&&(We=Nd(oe,{getRosterCapLimit:()=>Aa(),updateMaxRosterSize:(o,i)=>ss(o,{persist:i?.persist}),getActiveTierId:()=>le,setActiveTierId:(o,i)=>(i0(o,{persist:i?.persist})&&We?.update(),le),getTierContext:()=>Gr()})),It?.dispose(),It=null,r&&(It=ih(ne,{saunakunnia:St.resource,sisu:St.sisu,saunaBeer:St.saunaBeer,sound:St.sound},{useSisuBurst:()=>{const o=eh(ne,de);return o?(Dt("sisu"),xe(`Sisu bursts forth, spending ${Jn} grit to steel our attendants.`)):Dt("error"),o},torille:()=>{const o=nh(ne,de,oe.pos,Fe);return o?xe(`Torille! Our warriors regroup at the sauna to rally their spirits for ${Wn} SISU.`):Dt("error"),o}})),Sn?.destroy(),Sn=null,r&&(Sn=Qg(ns,{getSelectedUnitId:()=>te.find(o=>o.selected)?.id??null,getComparisonContext:()=>d0(),onEquip:(o,i,c)=>jr(o,i),getUseUiV2:r0,onUseUiV2Change:o0})),r?(h0(),Hr(),$e(),Vp()):(ht&&(ht(),ht=null),xe=()=>{})}const Fe=new Xl(10,10,32),el=new Mf(()=>Be()),$p=new Nu(Fe,el),Tr=new Af(Fe),oa=()=>{Tr.invalidateCache(),Be()};R.on("buildingPlaced",oa);R.on("buildingRemoved",oa);Fe.forEachTile(e=>e.setFogged(!0));Rl();const de=[];function mi(e){return`${e.q},${e.r}`}function e0(){const e=new Set;for(const c of de)c.isDead()||e.add(mi(c.coord));const t=[],{minQ:n,maxQ:s,minR:a,maxR:r}=Fe,o=c=>{const u=mi(c);e.has(u)||(Fe.ensureTile(c.q,c.r),t.push(c))};for(let c=n;c<=s;c++)o({q:c,r:a}),r!==a&&o({q:c,r});for(let c=a+1;c<=r-1;c++)o({q:n,r:c}),s!==n&&o({q:s,r:c});if(t.length===0)return;const i=Math.floor(Math.random()*t.length);return t[i]}function t0(e){const t=mt.get(e);t&&(mt.delete(e),Ot.get(t.id)===e&&Ot.delete(t.id))}function n0(e){const t=mt.get(e.id);if(t)return{saunoja:t,created:!1,attached:!1};let n=te.find(o=>o.id===e.id);n||(n=te.find(o=>!Ot.has(o.id)));let s=!1;n||(n=Sr({id:`saunoja-${te.length+1}`,coord:{q:e.coord.q,r:e.coord.r}}),te.push(n),s=!0);const a=Ot.get(n.id);a&&a!==e.id&&mt.delete(a),mt.set(e.id,n),Ot.set(n.id,e.id),Kp(n,e),Zc(n,n.effectiveStats),e.setExperience(n.xp);const r=Jp(n);return(s||r)&&$c(n),{saunoja:n,created:s,attached:!0}}function Hr(){let e=!1;for(const t of de){if(t.faction!=="player"||t.isDead())continue;const{saunoja:n,created:s,attached:a}=n0(t);(s||a)&&(e=!0);const r=Number.isFinite(t.stats.health)?Math.max(0,t.stats.health):0;n.hp!==r&&(n.hp=r,e=!0);const o=Number.isFinite(t.getMaxHealth())?Math.max(1,t.getMaxHealth()):1;n.maxHp!==o&&(n.maxHp=o,e=!0);const i=t.getShield(),c=Number.isFinite(i)?Math.max(0,i):0;n.shield!==c&&(n.shield=c,e=!0);const l=t?.lastHitAt;Number.isFinite(l)&&n.lastHitAt!==l&&(n.lastHitAt=l,e=!0);const{q:d,r:h}=t.coord;(n.coord.q!==d||n.coord.r!==h)&&(n.coord={q:d,r:h},e=!0,n.selected&&Or(n.coord))}return e&&pt(),e}function tl(e,t){if(e.faction==="player"){const r=(t??mt.get(e.id)??null)?.name?.trim();if(r)return r}return`${(e.constructor?.name??"Unit").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase()} ${e.id}`.trim()}function pa(e){if(an.has(e.id))return;de.push(e),an.set(e.id,e);let t=null;e.faction==="player"&&(Hr()||hs(),t=mt.get(e.id)??null),aa&&Be(),e.faction==="player"&&(xe(`Our ${tl(e,t)} emerges from the steam.`),$e())}const nl=({unit:e})=>{pa(e)};R.on("unitSpawned",nl);const sl=()=>{hs()},Cn=()=>{hs()};R.on("inventoryChanged",sl);R.on("modifierAdded",Cn);R.on("modifierRemoved",Cn);R.on("modifierExpired",Cn);const al=e=>{We?.handleDamage?.(e)},rl=e=>{We?.handleDestroyed?.(e)};R.on("saunaDamaged",al);R.on("saunaDestroyed",rl);const ol=()=>{$e()};R.on("unit:stats:changed",ol);function s0(e){const t=mt.get(e.id);if(!t)return 0;const n=Number.isFinite(t.upkeep)?t.upkeep:0;return n>0?n*Xc:0}const ne=new Gl(1e3),ns=new cm,Fr=ne.load(Fe);if(Fr){const e=ne.getNgPlusState();sa(e),Ka(e)}else{const e=ne.setNgPlusState(Ce);sa(e),Ka(e)}ne.setEnemyScalingBase({aggression:js.aggressionMultiplier,cadence:js.cadenceMultiplier,strength:js.strengthMultiplier});if(!Fr&&Ce.ngPlusLevel>0){const e=Math.round(75*Ce.ngPlusLevel);e>0&&ne.addResource(k.SAUNA_BEER,e)}const xn=Qc(ma),il=()=>({ngPlusLevel:Ce.ngPlusLevel,unlockSlots:Ce.unlockSlots});let le=xn.activeTierId,In=xn.useUiV2;const a0=Rn(gt(le),il());a0.unlocked||(le=ls);const Aa=()=>{const e=gt(le),t=Math.max(0,Math.floor(e.rosterCap));return Math.min(t,ma)},ia=zc(xn.maxRosterSize,Aa());(ia!==xn.maxRosterSize||xn.activeTierId!==le||xn.useUiV2!==In)&&Nc({maxRosterSize:ia,activeTierId:le,useUiV2:In});const oe=Fu({q:Math.floor(Fe.width/2),r:Math.floor(Fe.height/2)},void 0,{maxRosterSize:ia}),r0=()=>In,o0=e=>{const t=!!e;In!==t&&Nr(oe.maxRosterSize,{useUiV2:t})},Lr=Ap({getTier:()=>gt(le),getRosterLimit:()=>Aa(),getRosterCount:()=>va(),log:e=>xe(e),queueCapacity:3});let cl=ia,Qr=le;const Nr=(e,t)=>{typeof t?.useUiV2=="boolean"&&(In=t.useUiV2),Nc({maxRosterSize:e,activeTierId:le,useUiV2:In}),cl=e,Qr=le},Gr=()=>il(),ss=(e,t={})=>{const n=Aa(),s=zc(e,n);return s!==oe.maxRosterSize&&(oe.maxRosterSize=s),t.persist&&(le!==Qr||s!==cl)&&Nr(s),s};Ir=(e={})=>{const t=Gr(),n=nc();let s=ls;for(const o of n)if(Rn(o,t).unlocked)s=o.id;else break;if(!Rn(gt(le),t).unlocked||le!==s){const o=le;le=s,Lr.clearQueue?.("tier-change"),ss(oe.maxRosterSize,{persist:e.persist}),o!==le&&We?.update?.();return}e.persist&&ss(oe.maxRosterSize,{persist:!0})};Ir({persist:!0});const i0=(e,t={})=>{const n=gt(e);return Rn(n,Gr()).unlocked?n.id===le?(t.persist&&le!==Qr&&Nr(oe.maxRosterSize),!0):(le=n.id,Lr.clearQueue?.("tier-change"),ss(oe.maxRosterSize,{persist:t.persist}),!0):!1},c0=e=>{ui+=1;const t=`p${Date.now()}-${ui}`,n=yr(ne,"soldier",t,e,"player");return n&&pa(n),n??null},gi=new kd({difficulty:qc,random:Yc,eliteOdds:Dr}),ll=new Ol(1e3,e=>{const t=e/1e3;ne.tick(),Qs.tick(t,{state:ne});const n=ne.getEnemyScalingSnapshot(),s=ss(oe.maxRosterSize);rm({dt:t,state:ne,sauna:oe,heat:oe.heatTracker,units:de,getUnitUpkeep:s0,pickSpawnTile:()=>Qi(oe.pos,de),spawnBaseUnit:c0,minUpkeepReserve:Math.max(1,wn),maxSpawns:ma,rosterCap:s,getRosterCount:va,tierHelpers:Lr});const a={aggressionMultiplier:n.aggression,cadenceMultiplier:n.cadence,strengthMultiplier:n.strength,calmSecondsRemaining:n.calmSecondsRemaining};gi.update(t,de,pa,e0,a),ne.advanceEnemyCalm(t);const r=gi.getSnapshot(),o=Math.max(n.calmSecondsRemaining,r.calmSecondsRemaining);if(It){const c={stage:r.rampStageLabel,stageIndex:r.rampStageIndex,bundleTier:r.bundleTier,multiplier:r.difficultyMultiplier,cadenceSeconds:r.cadence,effectiveDifficulty:r.effectiveDifficulty,aggressionMultiplier:r.aggressionMultiplier,cadenceMultiplier:r.cadenceMultiplier,strengthMultiplier:r.strengthMultiplier,calmSecondsRemaining:o,spawnCycles:r.spawnCycles};It.setEnemyRampSummary(c)}const i=Ut?.getProgress().roster;Td(r,{wipeSince:i?.wipeSince??null,wipeDurationMs:i?.wipeDurationMs??0}),$p.tick(de,t,oe),pu(t),Hr()&&$e(),ne.save();for(const c of de)c.isDead()||c.faction!=="player"||Fe.revealAround(c.coord,c.getVisionRange(),{autoFrame:!1});Be()}),l0=e=>{nn&&(nn=!1),ll.stop(),jt!==null&&(cancelAnimationFrame(jt),jt=null),Be();const t=document.getElementById("ui-overlay");if(!t)return;lt&&(lt.destroy(),lt=null);const n=Ce.ngPlusLevel,s=Il(Ce,{outcome:e.outcome});Ka(s),ne.setNgPlusState(s),sa(s),lt=Tp({container:t,resolution:e,currentNgPlusLevel:n,resourceLabels:lr,onNewRun:()=>{try{typeof window<"u"&&window.localStorage?.removeItem?.("gameState")}catch(r){console.warn("Failed to reset saved game state for NG+",r)}typeof window<"u"&&typeof window.location?.reload=="function"&&window.setTimeout(()=>window.location.reload(),75)},onDismiss:()=>{lt&&(lt.destroy(),lt=null)}})};te=Zp();if(te.length===0){const e=Sr({id:"saunoja-1",coord:oe.pos,selected:!0,upkeep:0});$c(e),e.upkeep=0,te.push(e),pt()}else{let e=!1,t=!1;for(const n of te)n.selected&&(e?(n.selected=!1,t=!0):e=!0);t&&pt()}const u0=de.some(e=>e.faction==="player"&&!e.isDead());if(!u0){ne.canAfford(po,k.SAUNA_BEER)||ne.addResource(k.SAUNA_BEER,po);const e=`u${de.length+1}`,t=yr(ne,"soldier",e,oe.pos,"player");t&&pa(t)}Fe.revealAround(oe.pos,3);Ut=dp({state:ne,map:Fe,getRosterCount:va,sauna:oe,rosterWipeGraceMs:8e3,bankruptcyGraceMs:12e3});$t=Ut.getProgress().strongholds.destroyed;Ut.onProgress(Wc);Ut.onResolution(l0);function d0(){const e=te.find(t=>t.selected)??null;return e?{baseStats:{...e.baseStats},loadout:Je(e.equipment),currentStats:{...e.effectiveStats}}:null}function h0(){ht&&(ht(),ht=null);const e=Sh(ne,{onRosterSelect:A0,onRosterRendererReady:fi,onRosterEquipSlot:b0,onRosterUnequipSlot:w0});xe=e.log,e.addEvent,fi(e.renderRoster),ht=e.dispose}function f0(){We?.update()}function m0(e){It?.update(e)}Fr||(ne.addResource(k.SAUNA_BEER,ii),xe(`Quartermaster stocks ${ii} bottles of ${lr[k.SAUNA_BEER]} to launch your campaign.`),ne.addResource(k.SAUNAKUNNIA,ci),xe(`Sauna elders honor your leadership with ${ci} ${lr[k.SAUNAKUNNIA]} to celebrate your arrival.`));const za=te.find(e=>e.selected);za&&(ra={q:za.coord.q,r:za.coord.r});function g0(e,t){return!e||!t?e===t:e.q===t.q&&e.r===t.r}function Or(e){return g0(ra,e)?!1:(ra=e?{q:e.q,r:e.r}:null,!0)}function ul(e){let t=!1;for(const n of te)e&&n===e||n.selected&&(n.selected=!1,t=!0);return t}function p0(){let e=!1;return ul()&&(e=!0),Or(null)&&(e=!0),e}function dl(e){if(!e)return!1;const t=wr(e.type);if(!t)return!1;const n=os(t,1),s=e.stats;return s.health>n.health||s.attackDamage>n.attackDamage||s.attackRange>n.attackRange||s.movementRange>n.movementRange}function hl(e){let t=!1;return e.selected||(e.selected=!0,t=!0),ul(e)&&(t=!0),Or(e.coord)&&(t=!0),t}function A0(e){const t=te.find(n=>n.id===e);t&&hl(t)&&(pt(),$e(),Be())}function fl(e){const t=Cl(e.x,e.y,Fe.hexSize),n=te.find(a=>a.coord.q===t.q&&a.coord.r===t.r);(n?hl(n):p0())&&(pt(),$e(),Be())}function jr(e,t){const n=te.find(u=>u.id===e);if(!n)return{success:!1,reason:"unit-missing"};const s=Je(n.equipment),a=Ys(n.baseStats,s),r=_u(n,t);if(!r.success)return{success:!1,reason:r.reason};const o=ga(n,r.loadout);R.emit("unit:stats:changed",{unitId:n.id,stats:o}),R.emit("inventoryChanged",{}),pt(),$e();const i=s.find(u=>u.slot===r.slot)??null;return{success:!0,comparison:{slot:r.slot,previous:di(i),next:di(r.item??null),deltas:Yp(a,o)}}}function v0(e,t){const n=te.find(d=>d.id===e);if(!n)return null;const s=Ju(n,t);if(!s.success||!s.removed)return null;const a=ga(n,s.loadout);R.emit("unit:stats:changed",{unitId:n.id,stats:a}),R.emit("inventoryChanged",{}),pt(),$e();const{id:r,name:o,description:i,icon:c,rarity:u,quantity:l}=s.removed;return{id:r,name:o,description:i,icon:c,rarity:u,quantity:l}}function b0(e,t){const s=ns.getStash().findIndex(a=>Wu(a.id,t));return s===-1?!1:ns.equipFromStash(s,e,jr)}function w0(e,t){return ns.unequipToStash(e,t,v0)}function Be(){if(!aa)return;const e=aa.getContext("2d"),t=Mc();if(!e||!t)return;if(ze){const c=typeof performance<"u"?performance.now():Date.now();ze.step(c)}const n=ze?.getShakeOffset()??{x:0,y:0},s=ze?{getUnitAlpha:c=>ze.getUnitAlpha(c.id)}:void 0,a=Array.isArray(te)&&te.length>0,r=de.filter(c=>c.faction==="player"&&!c.isDead()),o=oe?{coord:oe.pos,range:oe.auraRadius}:null,i=a?de.filter(c=>c.faction!=="player"):de;e.save(),(n.x!==0||n.y!==0)&&e.translate(n.x,n.y),Pf(e,Tr,t.images,i,ra,{saunojas:{units:te,draw:Wf},sauna:oe,saunaVision:o,fx:s,friendlyVisionSources:r}),e.restore()}const ml=({policy:e})=>{xe(`Sauna council toasts a fresh keg for policy: ${e.name}.`)};R.on(De.APPLIED,ml);const gl=({unitId:e,attackerId:t,attackerFaction:n,unitFaction:s})=>{const a=de.findIndex(h=>h.id===e),r=a!==-1?de[a]:null,o=r?{q:r.coord.q,r:r.coord.r}:null,i=s==="player"?mt.get(e)??null:null;let c=!1;if(s==="player"){const h=i??te.find(f=>Ot.get(f.id)===e||f.id===e)??null;h&&(h.hp!==0&&(h.hp=0,c=!0),h.shield!==0&&(h.shield=0,c=!0))}const u=r?tl(r,i):`unit ${e}`;let l=!1;if(n==="player"&&s&&s!=="player"){const h=t?an.get(t)??null:null,{xp:f,elite:m,boss:A}=Xp(r);f>0&&Up(h,f,{source:"kill",label:u,elite:m,boss:A})&&(l=!0)}if(a!==-1&&(r&&el.clear(r,{snap:!0}),de.splice(a,1),an.delete(e),t0(e),Be()),(c||l)&&pt(),(s==="player"||l)&&$e(),n==="player"&&s&&s!=="player"){const h=dl(r??null)||Kc()<Dr,f=_g({factionId:s,elite:h});if(f.rolls.length>0){const m=te.find(A=>A.selected)??null;for(const A of f.rolls)if(ns.addLoot(A,{unitId:m?.id,sourceTableId:f.tableId,equip:jr}).equipped){const p=m?.name??"our champion";xe(`Quartermaster fastens ${A.item.name} to ${p}.`)}else xe(`Quartermaster stores ${A.item.name} recovered from ${u}.`)}}n==="player"&&s&&s!=="player"&&(ne.addResource(k.SAUNAKUNNIA,Lp),ne.addResource(k.SISU,1),xe("Our grit surges — +1 SISU earned for the vanquished foe.")),o&&Fe.revealAround(o,1,{autoFrame:!1}),xe(`The steam hushes as ${s==="player"?"our":"a rival"} ${u} grows still.`)};R.on("unitDied",gl);function ur(){nn=!1,Ut?.offProgress(Wc),Ut?.dispose(),Ut=null,$t=0,lt&&(lt.destroy(),lt=null),jt!==null&&(cancelAnimationFrame(jt),jt=null);try{ne.save()}catch(e){console.warn("Failed to persist game state during cleanup",e)}try{pt()}catch(e){console.warn("Failed to persist Saunoja roster during cleanup",e)}ze&&(ze.dispose(),ze=null),R.off(De.APPLIED,ml),R.off("unitDied",gl),R.off("unitSpawned",nl),R.off("inventoryChanged",sl),R.off("modifierAdded",Cn),R.off("modifierRemoved",Cn),R.off("modifierExpired",Cn),R.off("unit:stats:changed",ol),R.off("saunaDamaged",al),R.off("saunaDestroyed",rl),R.off("buildingPlaced",oa),R.off("buildingRemoved",oa),ht&&(ht(),ht=null),Sn&&(Sn.destroy(),Sn=null),We&&(We.dispose(),We=null),It&&(It.dispose(),It=null),Ae&&(Ae.destroy(),Ae=null),Pt=null,tn=null,es=null,Yn()}async function y0(){if(nn)return;if(!Mc()){console.error("Cannot start game without loaded assets.");return}nn=!0,$e(),Be();try{await Pc(()=>{Be()}).then(()=>{Be()})}catch(s){console.warn("Failed to preload Saunoja icon before starting the game",s)}let t=performance.now();function n(s){if(!nn)return;const a=s-t;t=s,ll.tick(a),f0(),m0(a),hs(),Be(),nn&&(jt=requestAnimationFrame(n))}jt=requestAnimationFrame(n)}function va(){let e=0;for(const t of de)t.faction==="player"&&!t.isDead()&&(e+=1);return e}function E0(){const e={engaged:0,reserve:1,downed:2},t=te.map(n=>{const s=Ot.get(n.id),a=s?an.get(s):void 0,r=a?!a.isDead()&&a.stats.health>0:!1,o=n.effectiveStats,i=n.baseStats,c=Math.round(a?Math.max(0,a.stats.health):Math.max(0,n.hp)),u=Math.round(a?Math.max(1,a.getMaxHealth()):Math.max(1,o.health)),l=Math.round(a?Math.max(0,a.stats.attackDamage):Math.max(0,o.attackDamage)),d=Math.round(a?Math.max(0,a.stats.attackRange):Math.max(0,o.attackRange)),h=Math.round(a?Math.max(0,a.stats.movementRange):Math.max(0,o.movementRange)),f=a?.stats.defense??o.defense??0,m=Math.round(Math.max(0,f)),A=a?a.getShield():o.shield??n.shield,g=Math.round(Math.max(0,A)),p=Math.max(0,Math.round(n.upkeep)),b=c<=0?"downed":r?"engaged":"reserve",C=_c(n),S=n.items.map(Q=>({...Q})),F=n.modifiers.map(Q=>({...Q})),H=Pn.map(Q=>{const I=is(Q),B=n.equipment[Q],w=B?{id:B.id,name:B.name,description:B.description,icon:B.icon,rarity:B.rarity,quantity:B.quantity,slot:Q}:null,v=B?C0(B.modifiers,B.quantity):null;return{id:Q,label:I.label,description:I.description,maxStacks:I.maxStacks,item:w,modifiers:v}}),T={health:Math.round(Math.max(0,i.health)),maxHealth:Math.round(Math.max(1,i.health)),attackDamage:Math.round(Math.max(0,i.attackDamage)),attackRange:Math.round(Math.max(0,i.attackRange)),movementRange:Math.round(Math.max(0,i.movementRange)),defense:typeof i.defense=="number"&&i.defense>0?Math.round(i.defense):void 0,shield:typeof i.shield=="number"&&i.shield>0?Math.round(i.shield):void 0};return{id:n.id,name:n.name,upkeep:p,status:b,selected:!!n.selected,traits:[...n.traits],stats:{health:c,maxHealth:u,attackDamage:l,attackRange:d,movementRange:h,defense:m>0?m:void 0,shield:g>0?g:void 0},baseStats:T,progression:C,equipment:H,items:S,modifiers:F}});return t.sort((n,s)=>{const a=e[n.status]-e[s.status];return a!==0?a:n.name.localeCompare(s.name,"en")}),t}function S0(){return te.length===0?null:te.find(e=>e.selected)??te.find(e=>e.hp>0)??te[0]}function C0(e,t){const n=Math.max(1,Math.round(t)),s={};return typeof e.health=="number"&&(s.health=e.health*n),typeof e.attackDamage=="number"&&(s.attackDamage=e.attackDamage*n),typeof e.attackRange=="number"&&(s.attackRange=e.attackRange*n),typeof e.movementRange=="number"&&(s.movementRange=e.movementRange*n),typeof e.defense=="number"&&(s.defense=e.defense*n),typeof e.shield=="number"&&(s.shield=e.shield*n),s}function x0(){const e=va(),t=S0();let n=null;return t&&(n={id:t.id,name:t.name||"Saunoja",traits:[...t.traits],upkeep:Math.max(0,Math.round(t.upkeep)),progression:_c(t)}),{count:e,card:n}}function hs(e){const t=E0();Pt=t,Ae&&Ae.renderRoster(t)}function $e(){const e=x0();Ae?(Ae.updateSummary(e),tn=null):tn=e,hs()}function B0(e){const{overlay:t,resourceBar:n}=e,s=us(t),{regions:a}=s,r=document.createElement("div");r.className="ui-v2-overlay";const o=document.createElement("section");o.className="ui-v2-card",o.setAttribute("aria-live","polite"),o.setAttribute("role","status");const i=document.createElement("h1");i.className="ui-v2-card__title",i.textContent="Experimental HUD Enabled",o.appendChild(i);const c=document.createElement("p");c.className="ui-v2-card__body",c.textContent="The React/Tailwind interface is bootstrapped for this session. Gameplay systems continue to run, and classic HUD elements are paused while the new shell is under construction.",o.appendChild(c);const u=document.createElement("p");u.className="ui-v2-card__hint",u.textContent="Toggle the experimental HUD off from the quartermaster settings to return to the classic layout.",o.appendChild(u);const l=document.createElement("div");l.className="ui-v2-card__accent",o.appendChild(l);const d=document.createElement("div");return d.className="ui-v2-card__resource",d.appendChild(n),o.appendChild(d),r.appendChild(o),a.content.appendChild(r),{destroy(){d.contains(n)&&t.prepend(n),r.remove()}}}function pl(e){if(!e)return{showLoader:()=>({update:()=>{},clear:()=>{},dispose:()=>{}}),showBanner:()=>null,removeTransientUI:()=>{}};const t=()=>{let o=e.querySelector(".hud-banner-stack");return o||(o=document.createElement("div"),o.className="hud-banner-stack",e.append(o)),o},n=(o,i,c)=>{let u=!1;const l=()=>{u||(u=!0,o.removeEventListener("transitionend",l),c())};o.addEventListener("transitionend",l),requestAnimationFrame(()=>{o.classList.add(i)}),window.setTimeout(l,400)};return{showLoader:(o="Heating the sauna stones…")=>{const i=document.createElement("div");i.className="hud-loader",i.setAttribute("role","status"),i.setAttribute("aria-live","polite");const c=document.createElement("div");c.className="hud-loader__card";const u=document.createElement("div");u.className="hud-loader__spinner",u.setAttribute("aria-hidden","true");const l=document.createElement("p");l.className="hud-loader__message",l.textContent=o,c.append(u,l),i.append(c),e.append(i);let d=!1;return{update(h){l.textContent=h},clear(){d||n(i,"hud-loader--hidden",()=>{d=!0,i.remove()})},dispose(){d||(d=!0,i.remove())}}},showBanner:(o,i)=>{const c=t(),u=document.createElement("section");u.className=`hud-banner hud-banner--${o}`,u.setAttribute("role",o==="error"?"alert":"status"),u.setAttribute("aria-live",o==="error"?"assertive":"polite");const l=document.createElement("header");l.className="hud-banner__header";const d=document.createElement("p");d.className="hud-banner__title",d.textContent=i.title??(o==="error"?"Attention required":o==="warning"?"Heads up":"Status update"),l.append(d);const h=document.createElement("ul");h.className="hud-banner__list";for(const g of i.messages){const p=document.createElement("li");p.textContent=g,h.append(p)}if(u.append(l),i.messages.length&&u.append(h),i.actions?.length){const g=document.createElement("div");g.className="hud-banner__actions";for(const p of i.actions){const b=document.createElement("button");b.type="button",b.className=p.variant==="secondary"?"hud-banner__button hud-banner__button--secondary":"hud-banner__button",b.textContent=p.label,b.addEventListener("click",()=>{p.onClick()}),g.append(b)}u.append(g)}let f,m=!1;const A=()=>{m||(m=!0,f&&window.clearTimeout(f),n(u,"hud-banner--hide",()=>{u.remove(),c.hasChildNodes()||c.remove()}))};if(i.dismissible!==!1){const g=document.createElement("button");g.type="button",g.className="hud-banner__close",g.setAttribute("aria-label","Dismiss notification"),g.textContent="×",g.addEventListener("click",()=>{A()}),l.append(g)}return c.append(u),i.autoCloseMs&&i.autoCloseMs>0&&(f=window.setTimeout(()=>A(),i.autoCloseMs)),{element:u,dismiss:A}},removeTransientUI:()=>{e.querySelectorAll(".hud-loader").forEach(o=>{o.remove()}),e.querySelectorAll(".hud-banner-stack").forEach(o=>{o.remove()})}}}async function P0(e){const t=Object.entries(e),n=await Promise.allSettled(t.map(([o,i])=>i.load().then(c=>({key:o,descriptor:i,value:c})))),s={},a=[],r=[];return n.forEach((o,i)=>{const[c,u]=t[i],l=u.label??String(c);if(o.status==="fulfilled"){const{value:h}=o.value;if(s[c]=h.value,h.warnings?.length)for(const f of h.warnings)a.push(l?`${l}: ${f}`:f);if(h.errors?.length)for(const f of h.errors)r.push(l?`${l}: ${f}`:f);return}const d=k0(o.reason);r.push(l?`${l}: ${d}`:d)}),{resources:s,warnings:a,errors:r}}function k0(e){if(e instanceof Error)return e.message;if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return String(e)}}const R0="Heating the sauna stones…",M0="Polishing sauna ambience…";function D0(e){if(e instanceof Error&&e.message)return e.message;if(typeof e=="string"&&e.trim().length>0)return e;try{return JSON.stringify(e)}catch{return String(e)}}function I0(e){const t=new Set,n=o=>{t.forEach(i=>i(o))},s=e.formatError??D0;return{run:async o=>{n({type:"status",phase:"start",message:R0});try{const{resources:i,warnings:c,errors:u}=await P0({assets:{label:"Core assets",load:async()=>{const d=await e.loadAssets(e.assetPaths);return{value:d.assets,errors:d.failures}}},saunojaIcon:{label:"Saunoja icon",load:async()=>{try{return await e.preloadSaunojaIcon(),{value:!0}}catch(d){return{value:!1,warnings:[`Unable to preload Saunoja icon (${s(d)})`]}}}}});if(e.shouldAbort?.(o)){n({type:"cancelled"});return}n({type:"status",phase:"progress",message:M0});const l=i.assets;if(!l){const d=u.length?[...u]:["Critical assets were unavailable. Please refresh to try again."];n({type:"fatal",messages:d});return}if(u.length&&n({type:"errors",errors:u}),c.length&&n({type:"warnings",warnings:c}),e.setAssets(l),e.shouldAbort?.(o)){n({type:"cancelled"});return}e.startGame(),n({type:"ready",assets:l,warnings:c,errors:u})}catch(i){if(e.shouldAbort?.(o)){n({type:"cancelled"});return}n({type:"failure",error:i,message:s(i)})}},subscribe:o=>(t.add(o),()=>{t.delete(o)})}}const T0="grabbing";function H0(e,t){const n=t.dragCursor??T0;let s=!1,a=null,r=0,o=0,i=null;const c=f=>{f.pointerType!=="mouse"||f.button!==0||(s=!0,a=f.pointerId,r=f.clientX,o=f.clientY,i=e.style.cursor??"",e.setPointerCapture?.(f.pointerId),e.style.cursor=n,t.onPanStart?.(f))},u=f=>{if(!s||a!==f.pointerId)return;const m=f.clientX-r,A=f.clientY-o;r=f.clientX,o=f.clientY,t.onPan(m,A,f)},l=f=>{!s||a!==f.pointerId||(s=!1,a=null,e.releasePointerCapture?.(f.pointerId),e.style.cursor=i??"",t.onPanEnd?.(f))},d=f=>{l(f)},h=f=>{l(f)};return e.addEventListener("pointerdown",c),e.addEventListener("pointermove",u),e.addEventListener("pointerup",d),e.addEventListener("pointercancel",h),e.addEventListener("pointerleave",h),()=>{e.removeEventListener("pointerdown",c),e.removeEventListener("pointermove",u),e.removeEventListener("pointerup",d),e.removeEventListener("pointercancel",h),e.removeEventListener("pointerleave",h),s&&a!==null&&e.releasePointerCapture?.(a),e.style.cursor=i??""}}const F0=10,L0=250;function Jt(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Q0(e,t){const n=t.tapMaxMovement??F0,s=t.tapMaxDuration??L0;let a=null;const r=d=>{if(d.touches.length===1){const h=d.touches[0];a={mode:"pan",lastX:h.clientX,lastY:h.clientY,startX:h.clientX,startY:h.clientY,startTime:Jt(),moved:!1};return}if(d.touches.length>=2){const[h,f]=[d.touches[0],d.touches[1]];a={mode:"pinch",lastCenterX:(h.clientX+f.clientX)/2,lastCenterY:(h.clientY+f.clientY)/2,lastDistance:Math.hypot(h.clientX-f.clientX,h.clientY-f.clientY),startTime:Jt(),moved:!1}}},o=(d,h)=>{if(!a||a.mode!=="pan")return;const f=d.clientX-a.lastX,m=d.clientY-a.lastY;!a.moved&&Math.hypot(f,m)>1&&(a.moved=!0),a.lastX=d.clientX,a.lastY=d.clientY,t.onPan(f,m,h)},i=(d,h,f)=>{const m=(d.clientX+h.clientX)/2,A=(d.clientY+h.clientY)/2,g=Math.hypot(d.clientX-h.clientX,d.clientY-h.clientY);let p=1,b=0,C=0;a&&a.mode==="pinch"?(p=g/a.lastDistance,b=m-a.lastCenterX,C=A-a.lastCenterY):a={mode:"pinch",lastCenterX:m,lastCenterY:A,lastDistance:g,startTime:Jt(),moved:!1},!(!a||a.mode!=="pinch")&&(a.lastCenterX=m,a.lastCenterY=A,a.lastDistance=g,a.moved=!0,t.onPinch({centerX:m,centerY:A,scale:p,deltaCenterX:b,deltaCenterY:C},f))},c=d=>{if(!a||d.touches.length===0)return;if(d.preventDefault(),d.touches.length===1){const m=d.touches[0];a.mode!=="pan"&&(a={mode:"pan",lastX:m.clientX,lastY:m.clientY,startX:m.clientX,startY:m.clientY,startTime:Jt(),moved:!0}),o(m,d);return}const[h,f]=[d.touches[0],d.touches[1]];i(h,f,d)},u=()=>!a||a.mode!=="pan"||Math.hypot(a.lastX-a.startX,a.lastY-a.startY)>n?!1:Jt()-a.startTime<=s,l=d=>{if(a){if(d.touches.length===0){a.mode==="pan"&&t.onTap&&u()&&t.onTap({x:a.startX,y:a.startY},d),a=null;return}if(d.touches.length===1){const h=d.touches[0];a={mode:"pan",lastX:h.clientX,lastY:h.clientY,startX:h.clientX,startY:h.clientY,startTime:Jt(),moved:!0};return}if(d.touches.length>=2){const[h,f]=[d.touches[0],d.touches[1]];a={mode:"pinch",lastCenterX:(h.clientX+f.clientX)/2,lastCenterY:(h.clientY+f.clientY)/2,lastDistance:Math.hypot(h.clientX-f.clientX,h.clientY-f.clientY),startTime:Jt(),moved:!0}}}};return e.addEventListener("touchstart",r,{passive:!1}),e.addEventListener("touchmove",c,{passive:!1}),e.addEventListener("touchend",l),e.addEventListener("touchcancel",l),()=>{e.removeEventListener("touchstart",r),e.removeEventListener("touchmove",c),e.removeEventListener("touchend",l),e.removeEventListener("touchcancel",l),a=null}}const N0=.5,G0=3.5;function dr(e,t,n,s,a){const r=e.getBoundingClientRect(),o=t-r.left,i=n-r.top,c=r.width/2,u=r.height/2;return{x:a.x+(o-c)/s,y:a.y+(i-u)/s}}function O0(e){return Math.min(G0,Math.max(N0,e))}function Al(e,t,n,s=X.zoom,a=X){return dr(e,t,n,s,a)}function vl(e,t,n,s){const a=O0(s);if(a===X.zoom)return;const r={x:X.x,y:X.y},o=dr(e,t,n,X.zoom,r),i=dr(e,t,n,a,r);X.x+=o.x-i.x,X.y+=o.y-i.y,X.zoom=a,Be()}function Xa(e,t){e===0&&t===0||(X.x-=e/X.zoom,X.y-=t/X.zoom,Be())}function j0(e){const t=window.devicePixelRatio||1,n=Math.max(window.innerWidth,1),s=Math.max(window.innerHeight,1);e.style.width=`${n}px`,e.style.height=`${s}px`,e.width=Math.round(n*t),e.height=Math.round(s*t);const a=e.getContext("2d");a&&a.setTransform(1,0,0,1,0,0),Be()}const U0=.0015,hr=[];let Ur=0,Tt=null,ba=pl(null),Se=null,qa="classic",fr=null;function z0(){if(typeof document>"u")return;const e=document.querySelector("[data-build-commit]");if(!e)return;const t="ab23ec4".trim(),n=t.length>0&&t!=="unknown",s=n?`#${t}`:"DEV BUILD";e.textContent=s,e.dataset.state=n?"commit":"dev";const a=e.closest("#build-id");if(a){const r=n?`Build commit ${t}`:"Development build";a.setAttribute("aria-label",r),a.title=n?`Autobattles build ${t}`:"Unversioned development build",a.dataset.buildState=n?"release":"development"}}z0();function kt(e){hr.push(e)}function X0(){for(;hr.length;){const e=hr.pop();try{e?.()}catch(t){console.error("Error during cleanup",t)}}}function q0(e){kt(()=>e.dispose())}function Hs(e,t){const n=ba.showBanner(e,t);n&&kt(()=>n.dismiss())}function Y0(e){switch(e.type){case"status":if(e.phase==="start"){Se?.dispose();const t=ba.showLoader(e.message);Se=t,q0(t)}else Se&&(Se.update(e.message),Se.clear(),Se=null);break;case"ready":Se?.clear(),Se=null;break;case"warnings":e.warnings.length&&(console.warn("Resource loader warnings",e.warnings),Hs("warning",{title:"Heads up",messages:e.warnings,autoCloseMs:12e3}));break;case"errors":e.errors.length&&(console.error("Resource loader errors",e.errors),Hs("error",{title:"Some resources failed to load",messages:e.errors,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]}));break;case"fatal":console.error("Critical assets failed to load",e.messages),Se?.clear(),Se=null,Hs("error",{title:"Unable to start the sauna battle",messages:e.messages,actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}],dismissible:!1});break;case"failure":console.error("Failed to initialize resources",e.error),Se?.clear(),Se=null,Hs("error",{title:"Failed to initialize",messages:[e.message],actions:[{label:"Reload",onClick:()=>window.location.reload(),variant:"primary"}]});break;case"cancelled":Se?.dispose(),Se=null;break}}const bl=I0({assetPaths:ap,loadAssets:Ml,preloadSaunojaIcon:Pc,setAssets:rp,startGame:y0,shouldAbort:e=>e!==Ur});bl.subscribe(Y0);function pi(e){if(!Tt)return;e.preventDefault();const t=Math.exp(-e.deltaY*U0),n=X.zoom*t;vl(Tt,e.clientX,e.clientY,n)}function Ai(e){if(!Tt)return;const t=Al(Tt,e.clientX,e.clientY);fl(t)}function K0(e){e.addEventListener("click",Ai),kt(()=>e.removeEventListener("click",Ai)),e.addEventListener("wheel",pi,{passive:!1}),kt(()=>e.removeEventListener("wheel",pi));const t=H0(e,{onPan:(s,a)=>{Xa(s,a)},dragCursor:"grabbing"});kt(t);const n=Q0(e,{onPan:(s,a)=>{Xa(s,a)},onPinch:({centerX:s,centerY:a,scale:r,deltaCenterX:o,deltaCenterY:i})=>{vl(e,s,a,X.zoom*r),Xa(o,i)},onTap:s=>{const a=Al(e,s.x,s.y);fl(a)}});kt(n)}function V0(){Ur+=1,X0(),fr?.destroy(),fr=null,Se?.dispose(),Se=null,Tt&&(Tt.style.cursor=""),Tt=null,ba.removeTransientUI(),ur()}function Z0(){const e=document.getElementById("game-canvas"),t=document.getElementById("resource-bar"),n=document.getElementById("ui-overlay");if(!e||!t||!n){console.error("Autobattles4xFinsauna shell is missing the required canvas, overlay, or resource bar elements.",{hasCanvas:!!e,hasResourceBar:!!t,hasOverlay:!!n});return}Tt&&V0();const s=++Ur;qa=Qc().useUiV2?"v2":"classic",Tt=e,ba=pl(n);const r=oh();kt(()=>r.dispose()),Wp(e,t,n,{hudVariant:qa}),qa==="v2"&&(fr=B0({overlay:n,resourceBar:t})),K0(e);const o=()=>j0(e);window.addEventListener("resize",o),kt(()=>window.removeEventListener("resize",o)),window.addEventListener("beforeunload",ur),kt(()=>window.removeEventListener("beforeunload",ur)),o(),import.meta.vitest||bl.run(s)}function _0(){if(typeof document>"u")return;const e=()=>{document.removeEventListener("DOMContentLoaded",e),Z0()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",e);return}e()}import.meta.vitest||_0();
